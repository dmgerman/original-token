multiline_comment|/*&n; * Hardware-level driver for the COMX and HICOMX cards&n; * for Linux kernel 2.2.X&n; *&n; * Original authors:  Arpad Bakay &lt;bakay.arpad@synergon.hu&gt;,&n; *                    Peter Bajan &lt;bajan.peter@synergon.hu&gt;,&n; * Rewritten by: Tivadar Szemethy &lt;tiv@itc.hu&gt;&n; * Currently maintained by: Gergely Madarasz &lt;gorgo@itc.hu&gt;&n; *&n; * Copyright (C) 1995-2000 ITConsult-Pro Co. &lt;info@itc.hu&gt;&n; *&n; * Contributors:&n; * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - 0.86&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; *&n; * Version 0.80 (99/06/11):&n; *&t;&t;- port back to kernel, add support builtin driver &n; *&t;&t;- cleaned up the source code a bit&n; *&n; * Version 0.81 (99/06/22):&n; *&t;&t;- cleaned up the board load functions, no more long reset&n; *&t;&t;  timeouts&n; *&t;&t;- lower modem lines on close&n; *&t;&t;- some interrupt handling fixes&n; *&n; * Version 0.82 (99/08/24):&n; *&t;&t;- fix multiple board support&n; *&n; * Version 0.83 (99/11/30):&n; *&t;&t;- interrupt handling and locking fixes during initalization&n; *&t;&t;- really fix multiple board support&n; * &n; * Version 0.84 (99/12/02):&n; *&t;&t;- some workarounds for problematic hardware/firmware&n; *&n; * Version 0.85 (00/01/14):&n; *&t;&t;- some additional workarounds :/&n; *&t;&t;- printk cleanups&n; * Version 0.86 (00/08/15):&n; * &t;&t;- resource release on failure at COMX_init&n; */
DECL|macro|VERSION
mdefine_line|#define VERSION &quot;0.86&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;comx.h&quot;
macro_line|#include &quot;comxhw.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Gergely Madarasz &lt;gorgo@itc.hu&gt;, Tivadar Szemethy &lt;tiv@itc.hu&gt;, Arpad Bakay&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Hardware-level driver for the COMX and HICOMX adapters&bslash;n&quot;
)paren
suffix:semicolon
DECL|macro|COMX_readw
mdefine_line|#define&t;COMX_readw(dev, offset)&t;(readw(dev-&gt;mem_start + offset + &bslash;&n;&t;(unsigned int)(((struct comx_privdata *)&bslash;&n;&t;((struct comx_channel *)dev-&gt;priv)-&gt;HW_privdata)-&gt;channel) &bslash;&n;&t;* COMX_CHANNEL_OFFSET))
DECL|macro|COMX_WRITE
mdefine_line|#define COMX_WRITE(dev, offset, value)&t;(writew(value, dev-&gt;mem_start + offset &bslash;&n;&t;+ (unsigned int)(((struct comx_privdata *) &bslash;&n;&t;((struct comx_channel *)dev-&gt;priv)-&gt;HW_privdata)-&gt;channel) &bslash;&n;&t;* COMX_CHANNEL_OFFSET))
DECL|macro|COMX_CMD
mdefine_line|#define COMX_CMD(dev, cmd)&t;(COMX_WRITE(dev, OFF_A_L2_CMD, cmd))
DECL|struct|comx_firmware
r_struct
id|comx_firmware
(brace
DECL|member|len
r_int
id|len
suffix:semicolon
DECL|member|data
r_int
r_char
op_star
id|data
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|comx_privdata
r_struct
id|comx_privdata
(brace
DECL|member|firmware
r_struct
id|comx_firmware
op_star
id|firmware
suffix:semicolon
DECL|member|clock
id|u16
id|clock
suffix:semicolon
DECL|member|channel
r_char
id|channel
suffix:semicolon
singleline_comment|// channel no.
DECL|member|memory_size
r_int
id|memory_size
suffix:semicolon
DECL|member|io_extent
r_int
id|io_extent
suffix:semicolon
DECL|member|histogram
id|u_long
id|histogram
(braket
l_int|5
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|memory_used
r_static
r_struct
id|net_device
op_star
id|memory_used
(braket
(paren
id|COMX_MEM_MAX
op_minus
id|COMX_MEM_MIN
)paren
op_div
l_int|0x10000
)braket
suffix:semicolon
r_extern
r_struct
id|comx_hardware
id|hicomx_hw
suffix:semicolon
r_extern
r_struct
id|comx_hardware
id|comx_hw
suffix:semicolon
r_extern
r_struct
id|comx_hardware
id|cmx_hw
suffix:semicolon
r_static
r_void
id|COMX_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
DECL|function|COMX_board_on
r_static
r_void
id|COMX_board_on
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|outb_p
c_func
(paren
(paren
id|byte
)paren
(paren
(paren
(paren
id|dev-&gt;mem_start
op_amp
l_int|0xf0000
)paren
op_rshift
l_int|16
)paren
op_or
id|COMX_ENABLE_BOARD_IT
op_or
id|COMX_ENABLE_BOARD_MEM
)paren
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
)brace
DECL|function|COMX_board_off
r_static
r_void
id|COMX_board_off
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|outb_p
c_func
(paren
(paren
id|byte
)paren
(paren
(paren
(paren
id|dev-&gt;mem_start
op_amp
l_int|0xf0000
)paren
op_rshift
l_int|16
)paren
op_or
id|COMX_ENABLE_BOARD_IT
)paren
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
)brace
DECL|function|HICOMX_board_on
r_static
r_void
id|HICOMX_board_on
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|outb_p
c_func
(paren
(paren
id|byte
)paren
(paren
(paren
(paren
id|dev-&gt;mem_start
op_amp
l_int|0xf0000
)paren
op_rshift
l_int|12
)paren
op_or
id|HICOMX_ENABLE_BOARD_MEM
)paren
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
)brace
DECL|function|HICOMX_board_off
r_static
r_void
id|HICOMX_board_off
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|outb_p
c_func
(paren
(paren
id|byte
)paren
(paren
(paren
(paren
id|dev-&gt;mem_start
op_amp
l_int|0xf0000
)paren
op_rshift
l_int|12
)paren
op_or
id|HICOMX_DISABLE_BOARD_MEM
)paren
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
)brace
DECL|function|COMX_set_clock
r_static
r_void
id|COMX_set_clock
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
id|COMX_WRITE
c_func
(paren
id|dev
comma
id|OFF_A_L1_CLKINI
comma
id|hw-&gt;clock
)paren
suffix:semicolon
)brace
DECL|function|COMX_access_board
r_static
r_struct
id|net_device
op_star
id|COMX_access_board
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_device
op_star
id|ret
suffix:semicolon
r_int
id|mempos
op_assign
(paren
id|dev-&gt;mem_start
op_minus
id|COMX_MEM_MIN
)paren
op_rshift
l_int|16
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
id|memory_used
(braket
id|mempos
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|dev
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|memory_used
(braket
id|mempos
)braket
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ch-&gt;twin
op_logical_or
id|ret
op_ne
id|ch-&gt;twin
)paren
(brace
r_if
c_cond
(paren
id|ret
)paren
(paren
(paren
r_struct
id|comx_channel
op_star
)paren
id|ret-&gt;priv
)paren
op_member_access_from_pointer
id|HW_board_off
c_func
(paren
id|ret
)paren
suffix:semicolon
id|ch
op_member_access_from_pointer
id|HW_board_on
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|COMX_release_board
r_static
r_void
id|COMX_release_board
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|net_device
op_star
id|savep
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|mempos
op_assign
(paren
id|dev-&gt;mem_start
op_minus
id|COMX_MEM_MIN
)paren
op_rshift
l_int|16
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memory_used
(braket
id|mempos
)braket
op_eq
id|savep
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|memory_used
(braket
id|mempos
)braket
op_assign
id|savep
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ch-&gt;twin
op_logical_or
id|ch-&gt;twin
op_ne
id|savep
)paren
(brace
id|ch
op_member_access_from_pointer
id|HW_board_off
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|savep
)paren
(paren
(paren
r_struct
id|comx_channel
op_star
)paren
id|savep-&gt;priv
)paren
op_member_access_from_pointer
id|HW_board_on
c_func
(paren
id|savep
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|COMX_txe
r_static
r_int
id|COMX_txe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_device
op_star
id|savep
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|savep
op_assign
id|ch
op_member_access_from_pointer
id|HW_access_board
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
op_eq
id|LINKUP_READY
)paren
(brace
id|rc
op_assign
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_TxEMPTY
)paren
suffix:semicolon
)brace
id|ch
op_member_access_from_pointer
id|HW_release_board
c_func
(paren
id|dev
comma
id|savep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0xffff
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s, OFF_A_L2_TxEMPTY is %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rc
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|COMX_send_packet
r_static
r_int
id|COMX_send_packet
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|net_device
op_star
id|savep
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_int
id|ret
op_assign
id|FRAME_DROPPED
suffix:semicolon
id|word
id|tmp
suffix:semicolon
id|savep
op_assign
id|ch
op_member_access_from_pointer
id|HW_access_board
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|DEBUG_HW_TX
)paren
(brace
id|comx_debug_bytes
c_func
(paren
id|dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
l_string|&quot;COMX_send packet&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|COMX_MAX_TX_SIZE
)paren
(brace
id|ret
op_assign
id|FRAME_DROPPED
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|tmp
op_assign
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_TxEMPTY
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
op_logical_and
id|tmp
op_eq
l_int|1
)paren
(brace
r_int
id|lensave
op_assign
id|skb-&gt;len
suffix:semicolon
r_int
id|dest
op_assign
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_TxBUFP
)paren
suffix:semicolon
id|word
op_star
id|data
op_assign
(paren
id|word
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|dest
op_eq
l_int|0xffff
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: OFF_A_L2_TxBUFP is %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dest
)paren
suffix:semicolon
id|ret
op_assign
id|FRAME_DROPPED
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|writew
c_func
(paren
(paren
r_int
r_int
)paren
id|skb-&gt;len
comma
id|dev-&gt;mem_start
op_plus
id|dest
)paren
suffix:semicolon
id|dest
op_add_assign
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|skb-&gt;len
OG
l_int|1
)paren
(brace
id|writew
c_func
(paren
op_star
id|data
op_increment
comma
id|dev-&gt;mem_start
op_plus
id|dest
)paren
suffix:semicolon
id|dest
op_add_assign
l_int|2
suffix:semicolon
id|skb-&gt;len
op_sub_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
op_eq
l_int|1
)paren
(brace
id|writew
c_func
(paren
op_star
(paren
(paren
id|byte
op_star
)paren
id|data
)paren
comma
id|dev-&gt;mem_start
op_plus
id|dest
)paren
suffix:semicolon
)brace
id|writew
c_func
(paren
l_int|0
comma
id|dev-&gt;mem_start
op_plus
(paren
r_int
)paren
id|hw-&gt;channel
op_star
id|COMX_CHANNEL_OFFSET
op_plus
id|OFF_A_L2_TxEMPTY
)paren
suffix:semicolon
id|ch-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|ch-&gt;stats.tx_bytes
op_add_assign
id|lensave
suffix:semicolon
id|ret
op_assign
id|FRAME_ACCEPTED
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: frame dropped&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: OFF_A_L2_TxEMPTY is %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|ch
op_member_access_from_pointer
id|HW_release_board
c_func
(paren
id|dev
comma
id|savep
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|comx_read_buffer
r_static
r_inline
r_int
id|comx_read_buffer
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|word
id|rbuf_offs
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|word
id|len
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|word
op_star
id|writeptr
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
id|rbuf_offs
op_assign
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_RxBUFP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rbuf_offs
op_eq
l_int|0xffff
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: OFF_A_L2_RxBUFP is %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rbuf_offs
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|len
op_assign
id|readw
c_func
(paren
id|dev-&gt;mem_start
op_plus
id|rbuf_offs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|COMX_MAX_RX_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: packet length is %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
op_plus
l_int|16
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ch-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|COMX_WRITE
c_func
(paren
id|dev
comma
id|OFF_A_L2_DAV
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rbuf_offs
op_add_assign
l_int|2
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|16
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|writeptr
op_assign
(paren
id|word
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|len
)paren
(brace
op_star
id|writeptr
op_increment
op_assign
id|readw
c_func
(paren
id|dev-&gt;mem_start
op_plus
id|rbuf_offs
)paren
suffix:semicolon
id|rbuf_offs
op_add_assign
l_int|2
suffix:semicolon
id|i
op_add_assign
l_int|2
suffix:semicolon
)brace
id|COMX_WRITE
c_func
(paren
id|dev
comma
id|OFF_A_L2_DAV
comma
l_int|0
)paren
suffix:semicolon
id|ch-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|ch-&gt;stats.rx_bytes
op_add_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|DEBUG_HW_RX
)paren
(brace
id|comx_debug_skb
c_func
(paren
id|dev
comma
id|skb
comma
l_string|&quot;COMX_interrupt receiving&quot;
)paren
suffix:semicolon
)brace
id|ch
op_member_access_from_pointer
id|LINE_rx
c_func
(paren
id|dev
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|comx_line_change
r_static
r_inline
r_char
id|comx_line_change
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
id|linestat
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_char
id|idle
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|linestat
op_amp
id|LINE_UP
)paren
(brace
multiline_comment|/* Vonal fol */
r_if
c_cond
(paren
id|ch-&gt;lineup_delay
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|ch-&gt;lineup_pending
)paren
)paren
(brace
id|ch-&gt;lineup_timer.function
op_assign
id|comx_lineup_func
suffix:semicolon
id|ch-&gt;lineup_timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|ch-&gt;lineup_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
op_star
id|ch-&gt;lineup_delay
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ch-&gt;lineup_timer
)paren
suffix:semicolon
id|idle
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|idle
op_assign
l_int|0
suffix:semicolon
id|ch
op_member_access_from_pointer
id|LINE_status
c_func
(paren
id|dev
comma
id|ch-&gt;line_status
op_or_assign
id|LINE_UP
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Vonal le */
id|idle
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|ch-&gt;lineup_pending
)paren
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|ch-&gt;lineup_timer
)paren
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;line_status
op_and_assign
op_complement
id|LINE_UP
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;LINE_status
)paren
(brace
id|ch
op_member_access_from_pointer
id|LINE_status
c_func
(paren
id|dev
comma
id|ch-&gt;line_status
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
id|idle
suffix:semicolon
)brace
DECL|function|COMX_interrupt
r_static
r_void
id|COMX_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|net_device
op_star
id|interrupted
suffix:semicolon
r_int
r_int
id|jiffs
suffix:semicolon
r_char
id|idle
op_assign
l_int|0
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
id|word
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;COMX_interrupt: irq %d for unknown device&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|jiffs
op_assign
id|jiffies
suffix:semicolon
id|interrupted
op_assign
id|ch
op_member_access_from_pointer
id|HW_access_board
c_func
(paren
id|dev
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|idle
op_logical_and
id|count
OL
l_int|5000
)paren
(brace
r_char
id|channel
op_assign
l_int|0
suffix:semicolon
id|idle
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|channel
OL
l_int|2
)paren
(brace
r_char
id|linestat
op_assign
l_int|0
suffix:semicolon
r_char
id|buffers_emptied
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|channel
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ch-&gt;twin
)paren
(brace
id|dev
op_assign
id|ch-&gt;twin
suffix:semicolon
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
)brace
r_else
(brace
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|COMX_WRITE
c_func
(paren
id|dev
comma
id|OFF_A_L1_REPENA
comma
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L1_REPENA
)paren
op_amp
l_int|0xFF00
)paren
suffix:semicolon
)brace
id|channel
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;init_status
op_amp
(paren
id|HW_OPEN
op_or
id|LINE_OPEN
)paren
)paren
op_ne
(paren
id|HW_OPEN
op_or
id|LINE_OPEN
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
multiline_comment|/* Collect stats */
id|tmp
op_assign
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L1_ABOREC
)paren
suffix:semicolon
id|COMX_WRITE
c_func
(paren
id|dev
comma
id|OFF_A_L1_ABOREC
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_int|0xffff
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: OFF_A_L1_ABOREC is %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;stats.rx_missed_errors
op_add_assign
(paren
id|tmp
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ch-&gt;stats.rx_over_errors
op_add_assign
id|tmp
op_amp
l_int|0xff
suffix:semicolon
)brace
id|tmp
op_assign
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L1_CRCREC
)paren
suffix:semicolon
id|COMX_WRITE
c_func
(paren
id|dev
comma
id|OFF_A_L1_CRCREC
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_int|0xffff
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: OFF_A_L1_CRCREC is %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;stats.rx_crc_errors
op_add_assign
(paren
id|tmp
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ch-&gt;stats.rx_missed_errors
op_add_assign
id|tmp
op_amp
l_int|0xff
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
op_logical_and
id|ch-&gt;LINE_rx
)paren
(brace
id|tmp
op_assign
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_DAV
)paren
suffix:semicolon
r_while
c_loop
(paren
id|tmp
op_eq
l_int|1
)paren
(brace
id|idle
op_assign
l_int|0
suffix:semicolon
id|buffers_emptied
op_add_assign
id|comx_read_buffer
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tmp
op_assign
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_DAV
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmp
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: OFF_A_L2_DAV is %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|tmp
op_assign
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_TxEMPTY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_int|1
op_logical_and
id|ch-&gt;LINE_tx
)paren
(brace
id|ch
op_member_access_from_pointer
id|LINE_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmp
op_eq
l_int|0xffff
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: OFF_A_L2_TxEMPTY is %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L1_PBUFOVR
)paren
op_rshift
l_int|8
)paren
(brace
id|linestat
op_and_assign
op_complement
id|LINE_UP
suffix:semicolon
)brace
r_else
(brace
id|linestat
op_or_assign
id|LINE_UP
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|linestat
op_amp
id|LINE_UP
)paren
op_ne
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
)paren
(brace
id|ch-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
id|idle
op_and_assign
id|comx_line_change
c_func
(paren
id|dev
comma
id|linestat
)paren
suffix:semicolon
)brace
id|hw-&gt;histogram
(braket
(paren
r_int
)paren
id|buffers_emptied
)braket
op_increment
suffix:semicolon
)brace
id|count
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
op_eq
l_int|5000
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: interrupt stuck&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|ch
op_member_access_from_pointer
id|HW_release_board
c_func
(paren
id|dev
comma
id|interrupted
)paren
suffix:semicolon
)brace
DECL|function|COMX_open
r_static
r_int
id|COMX_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|procfile
op_assign
id|ch-&gt;procdir-&gt;subdir
suffix:semicolon
r_int
r_int
id|jiffs
suffix:semicolon
r_int
id|twin_open
op_assign
l_int|0
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_struct
id|net_device
op_star
id|savep
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;base_addr
op_logical_or
op_logical_neg
id|dev-&gt;irq
op_logical_or
op_logical_neg
id|dev-&gt;mem_start
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;twin
op_logical_and
(paren
(paren
(paren
r_struct
id|comx_channel
op_star
)paren
(paren
id|ch-&gt;twin-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|init_status
op_amp
id|HW_OPEN
)paren
)paren
(brace
id|twin_open
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|twin_open
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|hw-&gt;io_extent
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|COMX_interrupt
comma
l_int|0
comma
id|dev-&gt;name
comma
(paren
r_void
op_star
)paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;comx-hw-comx: unable to obtain irq %d&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|ch-&gt;init_status
op_or_assign
id|IRQ_ALLOCATED
suffix:semicolon
id|request_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|hw-&gt;io_extent
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ch-&gt;HW_load_board
op_logical_or
id|ch
op_member_access_from_pointer
id|HW_load_board
c_func
(paren
id|dev
)paren
)paren
(brace
id|ch-&gt;init_status
op_and_assign
op_complement
id|IRQ_ALLOCATED
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
)brace
id|savep
op_assign
id|ch
op_member_access_from_pointer
id|HW_access_board
c_func
(paren
id|dev
)paren
suffix:semicolon
id|COMX_WRITE
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;HW_set_clock
)paren
(brace
id|ch
op_member_access_from_pointer
id|HW_set_clock
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|COMX_CMD
c_func
(paren
id|dev
comma
id|COMX_CMD_INIT
)paren
suffix:semicolon
id|jiffs
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
op_ne
l_int|1
op_logical_and
id|jiffies
OL
id|jiffs
op_plus
id|HZ
)paren
(brace
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|jiffies
op_ge
id|jiffs
op_plus
id|HZ
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: board timeout on INIT command&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|ch
op_member_access_from_pointer
id|HW_release_board
c_func
(paren
id|dev
comma
id|savep
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|COMX_CMD
c_func
(paren
id|dev
comma
id|COMX_CMD_OPEN
)paren
suffix:semicolon
id|jiffs
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
op_ne
l_int|3
op_logical_and
id|jiffies
OL
id|jiffs
op_plus
id|HZ
)paren
(brace
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|jiffies
op_ge
id|jiffs
op_plus
id|HZ
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: board timeout on OPEN command&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|ch
op_member_access_from_pointer
id|HW_release_board
c_func
(paren
id|dev
comma
id|savep
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|ch-&gt;init_status
op_or_assign
id|HW_OPEN
suffix:semicolon
multiline_comment|/* Ez eleg ciki, de ilyen a rendszer */
r_if
c_cond
(paren
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L1_PBUFOVR
)paren
op_rshift
l_int|8
)paren
(brace
id|ch-&gt;line_status
op_and_assign
op_complement
id|LINE_UP
suffix:semicolon
)brace
r_else
(brace
id|ch-&gt;line_status
op_or_assign
id|LINE_UP
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;LINE_status
)paren
(brace
id|ch
op_member_access_from_pointer
id|LINE_status
c_func
(paren
id|dev
comma
id|ch-&gt;line_status
)paren
suffix:semicolon
)brace
id|ch
op_member_access_from_pointer
id|HW_release_board
c_func
(paren
id|dev
comma
id|savep
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|procfile
suffix:semicolon
id|procfile
op_assign
id|procfile-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_IRQ
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_IO
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_MEMADDR
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_CHANNEL
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_FIRMWARE
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_CLOCK
)paren
op_eq
l_int|0
)paren
(brace
id|procfile-&gt;mode
op_assign
id|S_IFREG
op_or
l_int|0444
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
id|error
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|twin_open
)paren
(brace
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|hw-&gt;io_extent
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
(paren
r_void
op_star
)paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|COMX_close
r_static
r_int
id|COMX_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|procfile
op_assign
id|ch-&gt;procdir-&gt;subdir
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|comx_channel
op_star
id|twin_ch
suffix:semicolon
r_struct
id|net_device
op_star
id|savep
suffix:semicolon
id|savep
op_assign
id|ch
op_member_access_from_pointer
id|HW_access_board
c_func
(paren
id|dev
)paren
suffix:semicolon
id|COMX_CMD
c_func
(paren
id|dev
comma
id|COMX_CMD_CLOSE
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|COMX_CMD
c_func
(paren
id|dev
comma
id|COMX_CMD_EXIT
)paren
suffix:semicolon
id|ch
op_member_access_from_pointer
id|HW_release_board
c_func
(paren
id|dev
comma
id|savep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;init_status
op_amp
id|IRQ_ALLOCATED
)paren
(brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
(paren
r_void
op_star
)paren
id|dev
)paren
suffix:semicolon
id|ch-&gt;init_status
op_and_assign
op_complement
id|IRQ_ALLOCATED
suffix:semicolon
)brace
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|hw-&gt;io_extent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;twin
op_logical_and
(paren
id|twin_ch
op_assign
id|ch-&gt;twin-&gt;priv
)paren
op_logical_and
(paren
id|twin_ch-&gt;init_status
op_amp
id|HW_OPEN
)paren
)paren
(brace
multiline_comment|/* Pass the irq to the twin */
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|COMX_interrupt
comma
l_int|0
comma
id|ch-&gt;twin-&gt;name
comma
(paren
r_void
op_star
)paren
id|ch-&gt;twin
)paren
op_eq
l_int|0
)paren
(brace
id|twin_ch-&gt;init_status
op_or_assign
id|IRQ_ALLOCATED
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
suffix:semicolon
id|procfile
suffix:semicolon
id|procfile
op_assign
id|procfile-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_IRQ
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_IO
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_MEMADDR
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_CHANNEL
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_FIRMWARE
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|procfile-&gt;name
comma
id|FILENAME_CLOCK
)paren
op_eq
l_int|0
)paren
(brace
id|procfile-&gt;mode
op_assign
id|S_IFREG
op_or
l_int|0644
suffix:semicolon
)brace
)brace
id|ch-&gt;init_status
op_and_assign
op_complement
id|HW_OPEN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|COMX_statistics
r_static
r_int
id|COMX_statistics
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|page
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|net_device
op_star
id|savep
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|savep
op_assign
id|ch
op_member_access_from_pointer
id|HW_access_board
c_func
(paren
id|dev
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Board data: %s %s %s %s&bslash;nPBUFOVR: %02x, &quot;
l_string|&quot;MODSTAT: %02x, LINKUP: %02x, DAV: %02x&bslash;nRxBUFP: %02x, &quot;
l_string|&quot;TxEMPTY: %02x, TxBUFP: %02x&bslash;n&quot;
comma
(paren
id|ch-&gt;init_status
op_amp
id|HW_OPEN
)paren
ques
c_cond
l_string|&quot;HW_OPEN&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|ch-&gt;init_status
op_amp
id|LINE_OPEN
)paren
ques
c_cond
l_string|&quot;LINE_OPEN&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|ch-&gt;init_status
op_amp
id|FW_LOADED
)paren
ques
c_cond
l_string|&quot;FW_LOADED&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|ch-&gt;init_status
op_amp
id|IRQ_ALLOCATED
)paren
ques
c_cond
l_string|&quot;IRQ_ALLOCATED&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L1_PBUFOVR
)paren
op_amp
l_int|0xff
comma
(paren
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L1_PBUFOVR
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
op_amp
l_int|0xff
comma
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_DAV
)paren
op_amp
l_int|0xff
comma
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_RxBUFP
)paren
op_amp
l_int|0xff
comma
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_TxEMPTY
)paren
op_amp
l_int|0xff
comma
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_TxBUFP
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;hist[0]: %8lu hist[1]: %8lu hist[2]: %8lu&bslash;n&quot;
l_string|&quot;hist[3]: %8lu hist[4]: %8lu&bslash;n&quot;
comma
id|hw-&gt;histogram
(braket
l_int|0
)braket
comma
id|hw-&gt;histogram
(braket
l_int|1
)braket
comma
id|hw-&gt;histogram
(braket
l_int|2
)braket
comma
id|hw-&gt;histogram
(braket
l_int|3
)braket
comma
id|hw-&gt;histogram
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|ch
op_member_access_from_pointer
id|HW_release_board
c_func
(paren
id|dev
comma
id|savep
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|COMX_load_board
r_static
r_int
id|COMX_load_board
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|comx_firmware
op_star
id|fw
op_assign
id|hw-&gt;firmware
suffix:semicolon
id|word
id|board_segment
op_assign
id|dev-&gt;mem_start
op_rshift
l_int|16
suffix:semicolon
r_int
id|mempos
op_assign
(paren
id|dev-&gt;mem_start
op_minus
id|COMX_MEM_MIN
)paren
op_rshift
l_int|16
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|id1
comma
id|id2
suffix:semicolon
r_struct
id|net_device
op_star
id|saved
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
id|loopcount
suffix:semicolon
r_int
id|len
suffix:semicolon
id|byte
op_star
id|COMX_address
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fw
op_logical_or
op_logical_neg
id|fw-&gt;len
)paren
(brace
r_struct
id|comx_channel
op_star
id|twin_ch
op_assign
id|ch-&gt;twin
ques
c_cond
id|ch-&gt;twin-&gt;priv
suffix:colon
l_int|NULL
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|twin_hw
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|twin_ch
op_logical_or
op_logical_neg
(paren
id|twin_hw
op_assign
id|twin_ch-&gt;HW_privdata
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fw
op_assign
id|twin_hw-&gt;firmware
)paren
op_logical_or
op_logical_neg
id|fw-&gt;len
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
id|id1
op_assign
id|fw-&gt;data
(braket
id|OFF_FW_L1_ID
)braket
suffix:semicolon
id|id2
op_assign
id|fw-&gt;data
(braket
id|OFF_FW_L1_ID
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|id1
op_ne
id|FW_L1_ID_1
op_logical_or
id|id2
op_ne
id|FW_L1_ID_2_COMX
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: incorrect firmware, load aborted&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Loading COMX Layer 1 firmware %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_char
op_star
)paren
(paren
id|fw-&gt;data
op_plus
id|OFF_FW_L1_ID
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|id1
op_assign
id|fw-&gt;data
(braket
id|OFF_FW_L2_ID
)braket
suffix:semicolon
id|id2
op_assign
id|fw-&gt;data
(braket
id|OFF_FW_L2_ID
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|id1
op_eq
id|FW_L2_ID_1
op_logical_and
(paren
id|id2
op_eq
l_int|0xc0
op_logical_or
id|id2
op_eq
l_int|0xc1
op_logical_or
id|id2
op_eq
l_int|0xc2
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;with Layer 2 code %s&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
(paren
id|fw-&gt;data
op_plus
id|OFF_FW_L2_ID
op_plus
l_int|2
)paren
)paren
suffix:semicolon
)brace
id|outb_p
c_func
(paren
id|board_segment
op_or
id|COMX_BOARD_RESET
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
multiline_comment|/* 10 usec should be enough here */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|saved
op_assign
id|memory_used
(braket
id|mempos
)braket
suffix:semicolon
r_if
c_cond
(paren
id|saved
)paren
(brace
(paren
(paren
r_struct
id|comx_channel
op_star
)paren
id|saved-&gt;priv
)paren
op_member_access_from_pointer
id|HW_board_off
c_func
(paren
id|saved
)paren
suffix:semicolon
)brace
id|memory_used
(braket
id|mempos
)braket
op_assign
id|dev
suffix:semicolon
id|outb_p
c_func
(paren
id|board_segment
op_or
id|COMX_ENABLE_BOARD_MEM
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|dev-&gt;mem_start
op_plus
id|COMX_JAIL_OFFSET
)paren
suffix:semicolon
id|loopcount
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|loopcount
op_increment
OL
l_int|10000
op_logical_and
id|readb
c_func
(paren
id|dev-&gt;mem_start
op_plus
id|COMX_JAIL_OFFSET
)paren
op_ne
id|COMX_JAIL_VALUE
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|readb
c_func
(paren
id|dev-&gt;mem_start
op_plus
id|COMX_JAIL_OFFSET
)paren
op_ne
id|COMX_JAIL_VALUE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Can&squot;t reset board, JAIL value is %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readb
c_func
(paren
id|dev-&gt;mem_start
op_plus
id|COMX_JAIL_OFFSET
)paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|writeb
c_func
(paren
l_int|0x55
comma
id|dev-&gt;mem_start
op_plus
l_int|0x18ff
)paren
suffix:semicolon
id|loopcount
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|loopcount
op_increment
OL
l_int|10000
op_logical_and
id|readb
c_func
(paren
id|dev-&gt;mem_start
op_plus
l_int|0x18ff
)paren
op_ne
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|readb
c_func
(paren
id|dev-&gt;mem_start
op_plus
l_int|0x18ff
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Can&squot;t reset board, reset timeout&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|len
op_assign
l_int|0
suffix:semicolon
id|COMX_address
op_assign
(paren
id|byte
op_star
)paren
id|dev-&gt;mem_start
suffix:semicolon
r_while
c_loop
(paren
id|fw-&gt;len
OG
id|len
)paren
(brace
id|writeb
c_func
(paren
id|fw-&gt;data
(braket
id|len
op_increment
)braket
comma
id|COMX_address
op_increment
)paren
suffix:semicolon
)brace
id|len
op_assign
l_int|0
suffix:semicolon
id|COMX_address
op_assign
(paren
id|byte
op_star
)paren
id|dev-&gt;mem_start
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
id|fw-&gt;len
op_logical_and
id|readb
c_func
(paren
id|COMX_address
op_increment
)paren
op_eq
id|fw-&gt;data
(braket
id|len
)braket
)paren
(brace
id|len
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_ne
id|fw-&gt;len
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error loading firmware: [%d] is 0x%02x &quot;
l_string|&quot;instead of 0x%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
comma
id|readb
c_func
(paren
id|COMX_address
op_minus
l_int|1
)paren
comma
id|fw-&gt;data
(braket
id|len
)braket
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|writeb
c_func
(paren
l_int|0
comma
id|dev-&gt;mem_start
op_plus
id|COMX_JAIL_OFFSET
)paren
suffix:semicolon
id|loopcount
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|loopcount
op_increment
OL
l_int|10000
op_logical_and
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
op_ne
l_int|1
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
op_ne
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error starting firmware, linkup word is %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|ch-&gt;init_status
op_or_assign
id|FW_LOADED
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|outb_p
c_func
(paren
id|board_segment
op_or
id|COMX_DISABLE_ALL
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|saved
)paren
(brace
(paren
(paren
r_struct
id|comx_channel
op_star
)paren
id|saved-&gt;priv
)paren
op_member_access_from_pointer
id|HW_board_on
c_func
(paren
id|saved
)paren
suffix:semicolon
)brace
id|memory_used
(braket
id|mempos
)braket
op_assign
id|saved
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|CMX_load_board
r_static
r_int
id|CMX_load_board
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|comx_firmware
op_star
id|fw
op_assign
id|hw-&gt;firmware
suffix:semicolon
id|word
id|board_segment
op_assign
id|dev-&gt;mem_start
op_rshift
l_int|16
suffix:semicolon
r_int
id|mempos
op_assign
(paren
id|dev-&gt;mem_start
op_minus
id|COMX_MEM_MIN
)paren
op_rshift
l_int|16
suffix:semicolon
macro_line|#if 0
r_int
r_char
id|id1
comma
id|id2
suffix:semicolon
macro_line|#endif
r_struct
id|net_device
op_star
id|saved
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
id|loopcount
suffix:semicolon
r_int
id|len
suffix:semicolon
id|byte
op_star
id|COMX_address
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fw
op_logical_or
op_logical_neg
id|fw-&gt;len
)paren
(brace
r_struct
id|comx_channel
op_star
id|twin_ch
op_assign
id|ch-&gt;twin
ques
c_cond
id|ch-&gt;twin-&gt;priv
suffix:colon
l_int|NULL
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|twin_hw
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|twin_ch
op_logical_or
op_logical_neg
(paren
id|twin_hw
op_assign
id|twin_ch-&gt;HW_privdata
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fw
op_assign
id|twin_hw-&gt;firmware
)paren
op_logical_or
op_logical_neg
id|fw-&gt;len
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
multiline_comment|/* Ide kell olyat tenni, hogy ellenorizze az ID-t */
r_if
c_cond
(paren
id|inb_p
c_func
(paren
id|dev-&gt;base_addr
)paren
op_ne
id|CMX_ID_BYTE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: CMX id byte is invalid(%02x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inb_p
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Loading CMX Layer 1 firmware %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_char
op_star
)paren
(paren
id|fw-&gt;data
op_plus
id|OFF_FW_L1_ID
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|saved
op_assign
id|memory_used
(braket
id|mempos
)braket
suffix:semicolon
r_if
c_cond
(paren
id|saved
)paren
(brace
(paren
(paren
r_struct
id|comx_channel
op_star
)paren
id|saved-&gt;priv
)paren
op_member_access_from_pointer
id|HW_board_off
c_func
(paren
id|saved
)paren
suffix:semicolon
)brace
id|memory_used
(braket
id|mempos
)braket
op_assign
id|dev
suffix:semicolon
id|outb_p
c_func
(paren
id|board_segment
op_or
id|COMX_ENABLE_BOARD_MEM
op_or
id|COMX_BOARD_RESET
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
id|COMX_address
op_assign
(paren
id|byte
op_star
)paren
id|dev-&gt;mem_start
suffix:semicolon
r_while
c_loop
(paren
id|fw-&gt;len
OG
id|len
)paren
(brace
id|writeb
c_func
(paren
id|fw-&gt;data
(braket
id|len
op_increment
)braket
comma
id|COMX_address
op_increment
)paren
suffix:semicolon
)brace
id|len
op_assign
l_int|0
suffix:semicolon
id|COMX_address
op_assign
(paren
id|byte
op_star
)paren
id|dev-&gt;mem_start
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
id|fw-&gt;len
op_logical_and
id|readb
c_func
(paren
id|COMX_address
op_increment
)paren
op_eq
id|fw-&gt;data
(braket
id|len
)braket
)paren
(brace
id|len
op_increment
suffix:semicolon
)brace
id|outb_p
c_func
(paren
id|board_segment
op_or
id|COMX_ENABLE_BOARD_MEM
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ne
id|fw-&gt;len
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error loading firmware: [%d] is 0x%02x &quot;
l_string|&quot;instead of 0x%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
comma
id|readb
c_func
(paren
id|COMX_address
op_minus
l_int|1
)paren
comma
id|fw-&gt;data
(braket
id|len
)braket
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|loopcount
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|loopcount
op_increment
OL
l_int|10000
op_logical_and
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
op_ne
l_int|1
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
op_ne
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error starting firmware, linkup word is %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|ch-&gt;init_status
op_or_assign
id|FW_LOADED
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|outb_p
c_func
(paren
id|board_segment
op_or
id|COMX_DISABLE_ALL
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|saved
)paren
(brace
(paren
(paren
r_struct
id|comx_channel
op_star
)paren
id|saved-&gt;priv
)paren
op_member_access_from_pointer
id|HW_board_on
c_func
(paren
id|saved
)paren
suffix:semicolon
)brace
id|memory_used
(braket
id|mempos
)braket
op_assign
id|saved
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|HICOMX_load_board
r_static
r_int
id|HICOMX_load_board
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|comx_firmware
op_star
id|fw
op_assign
id|hw-&gt;firmware
suffix:semicolon
id|word
id|board_segment
op_assign
id|dev-&gt;mem_start
op_rshift
l_int|12
suffix:semicolon
r_int
id|mempos
op_assign
(paren
id|dev-&gt;mem_start
op_minus
id|COMX_MEM_MIN
)paren
op_rshift
l_int|16
suffix:semicolon
r_struct
id|net_device
op_star
id|saved
suffix:semicolon
r_int
r_char
id|id1
comma
id|id2
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
id|loopcount
suffix:semicolon
r_int
id|len
suffix:semicolon
id|word
op_star
id|HICOMX_address
suffix:semicolon
r_char
id|id
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fw
op_logical_or
op_logical_neg
id|fw-&gt;len
)paren
(brace
r_struct
id|comx_channel
op_star
id|twin_ch
op_assign
id|ch-&gt;twin
ques
c_cond
id|ch-&gt;twin-&gt;priv
suffix:colon
l_int|NULL
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|twin_hw
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|twin_ch
op_logical_or
op_logical_neg
(paren
id|twin_hw
op_assign
id|twin_ch-&gt;HW_privdata
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fw
op_assign
id|twin_hw-&gt;firmware
)paren
op_logical_or
op_logical_neg
id|fw-&gt;len
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|id
op_ne
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|inb_p
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|id
op_increment
)paren
op_ne
id|HICOMX_ID_BYTE
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|id
op_ne
l_int|4
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: can&squot;t find HICOMX at 0x%04x, id[%d] = %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
r_int
)paren
id|dev-&gt;base_addr
comma
id|id
op_minus
l_int|1
comma
id|inb_p
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|id
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|id1
op_assign
id|fw-&gt;data
(braket
id|OFF_FW_L1_ID
)braket
suffix:semicolon
id|id2
op_assign
id|fw-&gt;data
(braket
id|OFF_FW_L1_ID
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|id1
op_ne
id|FW_L1_ID_1
op_logical_or
id|id2
op_ne
id|FW_L1_ID_2_HICOMX
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: incorrect firmware, load aborted&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Loading HICOMX Layer 1 firmware %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_char
op_star
)paren
(paren
id|fw-&gt;data
op_plus
id|OFF_FW_L1_ID
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|id1
op_assign
id|fw-&gt;data
(braket
id|OFF_FW_L2_ID
)braket
suffix:semicolon
id|id2
op_assign
id|fw-&gt;data
(braket
id|OFF_FW_L2_ID
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|id1
op_eq
id|FW_L2_ID_1
op_logical_and
(paren
id|id2
op_eq
l_int|0xc0
op_logical_or
id|id2
op_eq
l_int|0xc1
op_logical_or
id|id2
op_eq
l_int|0xc2
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;with Layer 2 code %s&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
(paren
id|fw-&gt;data
op_plus
id|OFF_FW_L2_ID
op_plus
l_int|2
)paren
)paren
suffix:semicolon
)brace
id|outb_p
c_func
(paren
id|board_segment
op_or
id|HICOMX_BOARD_RESET
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|saved
op_assign
id|memory_used
(braket
id|mempos
)braket
suffix:semicolon
r_if
c_cond
(paren
id|saved
)paren
(brace
(paren
(paren
r_struct
id|comx_channel
op_star
)paren
id|saved-&gt;priv
)paren
op_member_access_from_pointer
id|HW_board_off
c_func
(paren
id|saved
)paren
suffix:semicolon
)brace
id|memory_used
(braket
id|mempos
)braket
op_assign
id|dev
suffix:semicolon
id|outb_p
c_func
(paren
id|board_segment
op_or
id|HICOMX_ENABLE_BOARD_MEM
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|HICOMX_PRG_MEM
comma
id|dev-&gt;base_addr
op_plus
l_int|1
)paren
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
id|HICOMX_address
op_assign
(paren
id|word
op_star
)paren
id|dev-&gt;mem_start
suffix:semicolon
r_while
c_loop
(paren
id|fw-&gt;len
OG
id|len
)paren
(brace
id|writeb
c_func
(paren
id|fw-&gt;data
(braket
id|len
op_increment
)braket
comma
id|HICOMX_address
op_increment
)paren
suffix:semicolon
)brace
id|len
op_assign
l_int|0
suffix:semicolon
id|HICOMX_address
op_assign
(paren
id|word
op_star
)paren
id|dev-&gt;mem_start
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
id|fw-&gt;len
op_logical_and
(paren
id|readw
c_func
(paren
id|HICOMX_address
op_increment
)paren
op_amp
l_int|0xff
)paren
op_eq
id|fw-&gt;data
(braket
id|len
)braket
)paren
(brace
id|len
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_ne
id|fw-&gt;len
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error loading firmware: [%d] is 0x%02x &quot;
l_string|&quot;instead of 0x%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
comma
id|readw
c_func
(paren
id|HICOMX_address
op_minus
l_int|1
)paren
op_amp
l_int|0xff
comma
id|fw-&gt;data
(braket
id|len
)braket
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|outb_p
c_func
(paren
id|board_segment
op_or
id|HICOMX_BOARD_RESET
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|HICOMX_DATA_MEM
comma
id|dev-&gt;base_addr
op_plus
l_int|1
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|board_segment
op_or
id|HICOMX_ENABLE_BOARD_MEM
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|loopcount
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|loopcount
op_increment
OL
l_int|10000
op_logical_and
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
op_ne
l_int|1
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
op_ne
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error starting firmware, linkup word is %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|COMX_readw
c_func
(paren
id|dev
comma
id|OFF_A_L2_LINKUP
)paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|ch-&gt;init_status
op_or_assign
id|FW_LOADED
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|outb_p
c_func
(paren
id|board_segment
op_or
id|HICOMX_DISABLE_ALL
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|HICOMX_DATA_MEM
comma
id|dev-&gt;base_addr
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|saved
)paren
(brace
(paren
(paren
r_struct
id|comx_channel
op_star
)paren
id|saved-&gt;priv
)paren
op_member_access_from_pointer
id|HW_board_on
c_func
(paren
id|saved
)paren
suffix:semicolon
)brace
id|memory_used
(braket
id|mempos
)braket
op_assign
id|saved
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|comx_twin_check
r_static
r_struct
id|net_device
op_star
id|comx_twin_check
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|procfile
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_struct
id|net_device
op_star
id|twin
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch_twin
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw_twin
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|procfile
suffix:semicolon
id|procfile
op_assign
id|procfile-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|procfile-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
id|twin
op_assign
id|procfile-&gt;data
suffix:semicolon
id|ch_twin
op_assign
id|twin-&gt;priv
suffix:semicolon
id|hw_twin
op_assign
id|ch_twin-&gt;HW_privdata
suffix:semicolon
r_if
c_cond
(paren
id|twin
op_ne
id|dev
op_logical_and
id|dev-&gt;irq
op_logical_and
id|dev-&gt;base_addr
op_logical_and
id|dev-&gt;mem_start
op_logical_and
id|dev-&gt;irq
op_eq
id|twin-&gt;irq
op_logical_and
id|dev-&gt;base_addr
op_eq
id|twin-&gt;base_addr
op_logical_and
id|dev-&gt;mem_start
op_eq
id|twin-&gt;mem_start
op_logical_and
id|hw-&gt;channel
op_eq
(paren
l_int|1
op_minus
id|hw_twin-&gt;channel
)paren
op_logical_and
id|ch-&gt;hardware
op_eq
id|ch_twin-&gt;hardware
)paren
(brace
r_return
id|twin
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|comxhw_write_proc
r_static
r_int
id|comxhw_write_proc
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
id|u_long
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|entry-&gt;parent-&gt;data
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_char
op_star
id|page
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;init_status
op_amp
id|HW_OPEN
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FILENAME_FIRMWARE
comma
id|entry-&gt;name
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|page
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|copy_from_user
c_func
(paren
id|page
comma
id|buffer
comma
id|count
op_assign
(paren
id|min
c_func
(paren
id|count
comma
id|PAGE_SIZE
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
id|page
op_plus
id|count
op_minus
l_int|1
)paren
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
op_star
(paren
id|page
op_plus
id|count
op_minus
l_int|1
)paren
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|byte
op_star
id|tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hw-&gt;firmware
)paren
(brace
r_if
c_cond
(paren
(paren
id|hw-&gt;firmware
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|comx_firmware
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|hw-&gt;firmware-&gt;len
op_assign
l_int|0
suffix:semicolon
id|hw-&gt;firmware-&gt;data
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|kmalloc
c_func
(paren
id|count
op_plus
id|file-&gt;f_pos
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* Ha nem 0 a fpos, akkor meglevo file-t irunk. Gyenge trukk. */
r_if
c_cond
(paren
id|hw-&gt;firmware
op_logical_and
id|hw-&gt;firmware-&gt;len
op_logical_and
id|file-&gt;f_pos
op_logical_and
id|hw-&gt;firmware-&gt;len
OL
id|count
op_plus
id|file-&gt;f_pos
)paren
(brace
id|memcpy
c_func
(paren
id|tmp
comma
id|hw-&gt;firmware-&gt;data
comma
id|hw-&gt;firmware-&gt;len
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw-&gt;firmware-&gt;data
)paren
(brace
id|kfree
c_func
(paren
id|hw-&gt;firmware-&gt;data
)paren
suffix:semicolon
)brace
id|copy_from_user
c_func
(paren
id|tmp
op_plus
id|file-&gt;f_pos
comma
id|buffer
comma
id|count
)paren
suffix:semicolon
id|hw-&gt;firmware-&gt;len
op_assign
id|entry-&gt;size
op_assign
id|file-&gt;f_pos
op_plus
id|count
suffix:semicolon
id|hw-&gt;firmware-&gt;data
op_assign
id|tmp
suffix:semicolon
id|file-&gt;f_pos
op_add_assign
id|count
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_CHANNEL
)paren
op_eq
l_int|0
)paren
(brace
id|hw-&gt;channel
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;channel
op_ge
id|MAX_CHANNELNO
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Invalid channel number&bslash;n&quot;
)paren
suffix:semicolon
id|hw-&gt;channel
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ch-&gt;twin
op_assign
id|comx_twin_check
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|comx_channel
op_star
id|twin_ch
op_assign
id|ch-&gt;twin-&gt;priv
suffix:semicolon
id|twin_ch-&gt;twin
op_assign
id|dev
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_IRQ
)paren
op_eq
l_int|0
)paren
(brace
id|dev-&gt;irq
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;irq
op_eq
l_int|2
)paren
(brace
id|dev-&gt;irq
op_assign
l_int|9
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;irq
template_param
l_int|15
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;comxhw: Invalid irq number&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ch-&gt;twin
op_assign
id|comx_twin_check
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|comx_channel
op_star
id|twin_ch
op_assign
id|ch-&gt;twin-&gt;priv
suffix:semicolon
id|twin_ch-&gt;twin
op_assign
id|dev
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_IO
)paren
op_eq
l_int|0
)paren
(brace
id|dev-&gt;base_addr
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;base_addr
op_amp
l_int|3
)paren
op_ne
l_int|0
op_logical_or
id|dev-&gt;base_addr
template_param
l_int|0x3fc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Invalid io value&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ch-&gt;twin
op_assign
id|comx_twin_check
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|comx_channel
op_star
id|twin_ch
op_assign
id|ch-&gt;twin-&gt;priv
suffix:semicolon
id|twin_ch-&gt;twin
op_assign
id|dev
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_MEMADDR
)paren
op_eq
l_int|0
)paren
(brace
id|dev-&gt;mem_start
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mem_start
op_le
l_int|0xf000
op_logical_and
id|dev-&gt;mem_start
op_ge
l_int|0xa000
)paren
(brace
id|dev-&gt;mem_start
op_mul_assign
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev-&gt;mem_start
op_amp
l_int|0xfff
)paren
op_ne
l_int|0
op_logical_or
id|dev-&gt;mem_start
template_param
id|COMX_MEM_MAX
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Invalid memory page&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;mem_start
op_assign
l_int|0
suffix:semicolon
)brace
id|dev-&gt;mem_end
op_assign
id|dev-&gt;mem_start
op_plus
id|hw-&gt;memory_size
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;twin
op_assign
id|comx_twin_check
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|comx_channel
op_star
id|twin_ch
op_assign
id|ch-&gt;twin-&gt;priv
suffix:semicolon
id|twin_ch-&gt;twin
op_assign
id|dev
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_CLOCK
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;ext&quot;
comma
id|page
comma
l_int|3
)paren
op_eq
l_int|0
)paren
(brace
id|hw-&gt;clock
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_int
id|kbps
suffix:semicolon
id|kbps
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|hw-&gt;clock
op_assign
id|kbps
ques
c_cond
id|COMX_CLOCK_CONST
op_div
id|kbps
suffix:colon
l_int|0
suffix:semicolon
)brace
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|comxhw_read_proc
r_static
r_int
id|comxhw_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|file
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|file-&gt;parent-&gt;data
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_IO
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;0x%03x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_IRQ
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;0x%02x&bslash;n&quot;
comma
id|dev-&gt;irq
op_eq
l_int|9
ques
c_cond
l_int|2
suffix:colon
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_CHANNEL
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%01d&bslash;n&quot;
comma
id|hw-&gt;channel
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_MEMADDR
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;0x%05x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|dev-&gt;mem_start
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_TWIN
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|ch-&gt;twin
ques
c_cond
id|ch-&gt;twin-&gt;name
suffix:colon
l_string|&quot;none&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_CLOCK
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|hw-&gt;clock
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%-8d&bslash;n&quot;
comma
id|COMX_CLOCK_CONST
op_div
id|hw-&gt;clock
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;external&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_FIRMWARE
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|min
c_func
(paren
id|FILE_PAGESIZE
comma
id|min
c_func
(paren
id|count
comma
id|hw-&gt;firmware
ques
c_cond
(paren
id|hw-&gt;firmware-&gt;len
op_minus
id|off
)paren
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|hw-&gt;firmware
ques
c_cond
(paren
id|hw-&gt;firmware-&gt;data
op_plus
id|off
)paren
suffix:colon
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|off
op_plus
id|len
op_ge
(paren
id|hw-&gt;firmware
ques
c_cond
id|hw-&gt;firmware-&gt;len
suffix:colon
l_int|0
)paren
op_logical_or
id|len
op_eq
l_int|0
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
id|len
op_minus
id|off
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|min
c_func
(paren
id|count
comma
id|len
op_minus
id|off
)paren
suffix:semicolon
)brace
multiline_comment|/* Called on echo comx &gt;boardtype */
DECL|function|COMX_init
r_static
r_int
id|COMX_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|new_file
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;HW_privdata
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|comx_privdata
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|hw
op_assign
id|ch-&gt;HW_privdata
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|comx_privdata
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;hardware
op_eq
op_amp
id|comx_hw
op_logical_or
id|ch-&gt;hardware
op_eq
op_amp
id|cmx_hw
)paren
(brace
id|hw-&gt;memory_size
op_assign
id|COMX_MEMORY_SIZE
suffix:semicolon
id|hw-&gt;io_extent
op_assign
id|COMX_IO_EXTENT
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|COMX_DEFAULT_IO
suffix:semicolon
id|dev-&gt;irq
op_assign
id|COMX_DEFAULT_IRQ
suffix:semicolon
id|dev-&gt;mem_start
op_assign
id|COMX_DEFAULT_MEMADDR
suffix:semicolon
id|dev-&gt;mem_end
op_assign
id|COMX_DEFAULT_MEMADDR
op_plus
id|COMX_MEMORY_SIZE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ch-&gt;hardware
op_eq
op_amp
id|hicomx_hw
)paren
(brace
id|hw-&gt;memory_size
op_assign
id|HICOMX_MEMORY_SIZE
suffix:semicolon
id|hw-&gt;io_extent
op_assign
id|HICOMX_IO_EXTENT
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|HICOMX_DEFAULT_IO
suffix:semicolon
id|dev-&gt;irq
op_assign
id|HICOMX_DEFAULT_IRQ
suffix:semicolon
id|dev-&gt;mem_start
op_assign
id|HICOMX_DEFAULT_MEMADDR
suffix:semicolon
id|dev-&gt;mem_end
op_assign
id|HICOMX_DEFAULT_MEMADDR
op_plus
id|HICOMX_MEMORY_SIZE
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SERIOUS INTERNAL ERROR in %s, line %d&bslash;n&quot;
comma
id|__FILE__
comma
id|__LINE__
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_IO
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_HW_privdata
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|comxhw_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|comxhw_write_proc
suffix:semicolon
id|new_file-&gt;size
op_assign
l_int|6
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_IRQ
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_io
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|comxhw_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|comxhw_write_proc
suffix:semicolon
id|new_file-&gt;size
op_assign
l_int|5
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_CHANNEL
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_irq
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|comxhw_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|comxhw_write_proc
suffix:semicolon
id|new_file-&gt;size
op_assign
l_int|2
suffix:semicolon
singleline_comment|// Ezt tudjuk
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;hardware
op_eq
op_amp
id|hicomx_hw
op_logical_or
id|ch-&gt;hardware
op_eq
op_amp
id|cmx_hw
)paren
(brace
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_CLOCK
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_channel
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|comxhw_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|comxhw_write_proc
suffix:semicolon
id|new_file-&gt;size
op_assign
l_int|9
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_MEMADDR
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_clock
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|comxhw_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|comxhw_write_proc
suffix:semicolon
id|new_file-&gt;size
op_assign
l_int|8
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_TWIN
comma
id|S_IFREG
op_or
l_int|0444
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_memaddr
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|comxhw_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
l_int|NULL
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_FIRMWARE
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_twin
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|comxhw_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|comxhw_write_proc
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;hardware
op_eq
op_amp
id|comx_hw
)paren
(brace
id|ch-&gt;HW_board_on
op_assign
id|COMX_board_on
suffix:semicolon
id|ch-&gt;HW_board_off
op_assign
id|COMX_board_off
suffix:semicolon
id|ch-&gt;HW_load_board
op_assign
id|COMX_load_board
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ch-&gt;hardware
op_eq
op_amp
id|cmx_hw
)paren
(brace
id|ch-&gt;HW_board_on
op_assign
id|COMX_board_on
suffix:semicolon
id|ch-&gt;HW_board_off
op_assign
id|COMX_board_off
suffix:semicolon
id|ch-&gt;HW_load_board
op_assign
id|CMX_load_board
suffix:semicolon
id|ch-&gt;HW_set_clock
op_assign
id|COMX_set_clock
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ch-&gt;hardware
op_eq
op_amp
id|hicomx_hw
)paren
(brace
id|ch-&gt;HW_board_on
op_assign
id|HICOMX_board_on
suffix:semicolon
id|ch-&gt;HW_board_off
op_assign
id|HICOMX_board_off
suffix:semicolon
id|ch-&gt;HW_load_board
op_assign
id|HICOMX_load_board
suffix:semicolon
id|ch-&gt;HW_set_clock
op_assign
id|COMX_set_clock
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SERIOUS INTERNAL ERROR in %s, line %d&bslash;n&quot;
comma
id|__FILE__
comma
id|__LINE__
)paren
suffix:semicolon
)brace
id|ch-&gt;HW_access_board
op_assign
id|COMX_access_board
suffix:semicolon
id|ch-&gt;HW_release_board
op_assign
id|COMX_release_board
suffix:semicolon
id|ch-&gt;HW_txe
op_assign
id|COMX_txe
suffix:semicolon
id|ch-&gt;HW_open
op_assign
id|COMX_open
suffix:semicolon
id|ch-&gt;HW_close
op_assign
id|COMX_close
suffix:semicolon
id|ch-&gt;HW_send_packet
op_assign
id|COMX_send_packet
suffix:semicolon
id|ch-&gt;HW_statistics
op_assign
id|COMX_statistics
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;twin
op_assign
id|comx_twin_check
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|comx_channel
op_star
id|twin_ch
op_assign
id|ch-&gt;twin-&gt;priv
suffix:semicolon
id|twin_ch-&gt;twin
op_assign
id|dev
suffix:semicolon
)brace
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|cleanup_filename_twin
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_TWIN
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_filename_memaddr
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_MEMADDR
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_filename_clock
suffix:colon
r_if
c_cond
(paren
id|ch-&gt;hardware
op_eq
op_amp
id|hicomx_hw
op_logical_or
id|ch-&gt;hardware
op_eq
op_amp
id|cmx_hw
)paren
id|remove_proc_entry
c_func
(paren
id|FILENAME_CLOCK
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_filename_channel
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_CHANNEL
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_filename_irq
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_IRQ
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_filename_io
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_IO
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_HW_privdata
suffix:colon
id|kfree
c_func
(paren
id|ch-&gt;HW_privdata
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* Called on echo valami &gt;boardtype */
DECL|function|COMX_exit
r_static
r_int
id|COMX_exit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_privdata
op_star
id|hw
op_assign
id|ch-&gt;HW_privdata
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;firmware
)paren
(brace
r_if
c_cond
(paren
id|hw-&gt;firmware-&gt;data
)paren
id|kfree
c_func
(paren
id|hw-&gt;firmware-&gt;data
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|hw-&gt;firmware
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ch-&gt;twin
)paren
(brace
r_struct
id|comx_channel
op_star
id|twin_ch
op_assign
id|ch-&gt;twin-&gt;priv
suffix:semicolon
id|twin_ch-&gt;twin
op_assign
l_int|NULL
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|ch-&gt;HW_privdata
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_IO
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_IRQ
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_CHANNEL
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_MEMADDR
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_FIRMWARE
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_TWIN
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;hardware
op_eq
op_amp
id|hicomx_hw
op_logical_or
id|ch-&gt;hardware
op_eq
op_amp
id|cmx_hw
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|FILENAME_CLOCK
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|COMX_dump
r_static
r_int
id|COMX_dump
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: COMX_dump called, why ?&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|comx_hw
r_static
r_struct
id|comx_hardware
id|comx_hw
op_assign
(brace
l_string|&quot;comx&quot;
comma
id|VERSION
comma
id|COMX_init
comma
id|COMX_exit
comma
id|COMX_dump
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|cmx_hw
r_static
r_struct
id|comx_hardware
id|cmx_hw
op_assign
(brace
l_string|&quot;cmx&quot;
comma
id|VERSION
comma
id|COMX_init
comma
id|COMX_exit
comma
id|COMX_dump
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|hicomx_hw
r_static
r_struct
id|comx_hardware
id|hicomx_hw
op_assign
(brace
l_string|&quot;hicomx&quot;
comma
id|VERSION
comma
id|COMX_init
comma
id|COMX_exit
comma
id|COMX_dump
comma
l_int|NULL
)brace
suffix:semicolon
macro_line|#ifdef MODULE
DECL|macro|comx_hw_comx_init
mdefine_line|#define comx_hw_comx_init init_module
macro_line|#endif
DECL|function|comx_hw_comx_init
r_int
id|__init
id|comx_hw_comx_init
c_func
(paren
r_void
)paren
(brace
id|comx_register_hardware
c_func
(paren
op_amp
id|comx_hw
)paren
suffix:semicolon
id|comx_register_hardware
c_func
(paren
op_amp
id|cmx_hw
)paren
suffix:semicolon
id|comx_register_hardware
c_func
(paren
op_amp
id|hicomx_hw
)paren
suffix:semicolon
id|memset
c_func
(paren
id|memory_used
comma
l_int|0
comma
r_sizeof
(paren
id|memory_used
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|comx_unregister_hardware
c_func
(paren
l_string|&quot;comx&quot;
)paren
suffix:semicolon
id|comx_unregister_hardware
c_func
(paren
l_string|&quot;cmx&quot;
)paren
suffix:semicolon
id|comx_unregister_hardware
c_func
(paren
l_string|&quot;hicomx&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
