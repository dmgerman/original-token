multiline_comment|/*&n; * Frame-relay protocol module for the COMX driver &n; * for Linux 2.2.X&n; *&n; * Original author: Tivadar Szemethy &lt;tiv@itc.hu&gt;&n; * Maintainer: Gergely Madarasz &lt;gorgo@itc.hu&gt;&n; *&n; * Copyright (C) 1998-1999 ITConsult-Pro Co. &lt;info@itc.hu&gt;&n; * &n; * Contributors:&n; * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; (0.73)&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; *&n; * Version 0.70 (99/06/14):&n; *&t;&t;- cleaned up the source code a bit&n; *&t;&t;- ported back to kernel, now works as builtin code &n; *&n; * Version 0.71 (99/06/25):&n; *&t;&t;- use skb priorities and queues for sending keepalive&n; * &t;&t;- use device queues for slave-&gt;master data transmit&n; *&t;&t;- set IFF_RUNNING only line protocol up&n; *&t;&t;- fixes on slave device flags&n; * &n; * Version 0.72 (99/07/09):&n; *&t;&t;- handle slave tbusy with master tbusy (should be fixed)&n; *&t;&t;- fix the keepalive timer addition/deletion&n; *&n; * Version 0.73 (00/08/15)&n; * &t;&t;- resource release on failure at fr_master_init and&n; *&t;&t;  fr_slave_init &t;&t;  &n; */
DECL|macro|VERSION
mdefine_line|#define VERSION &quot;0.73&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/pkt_sched.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;comx.h&quot;
macro_line|#include &quot;comxhw.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Author: Tivadar Szemethy &lt;tiv@itc.hu&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Frame Relay protocol implementation for the COMX drivers&quot;
l_string|&quot;for Linux kernel 2.2.X&quot;
)paren
suffix:semicolon
DECL|macro|FRAD_UI
mdefine_line|#define&t;FRAD_UI&t;&t;0x03
DECL|macro|NLPID_IP
mdefine_line|#define&t;NLPID_IP&t;0xcc
DECL|macro|NLPID_Q933_LMI
mdefine_line|#define&t;NLPID_Q933_LMI&t;0x08
DECL|macro|NLPID_CISCO_LMI
mdefine_line|#define&t;NLPID_CISCO_LMI&t;0x09&t;
DECL|macro|Q933_ENQ
mdefine_line|#define Q933_ENQ&t;0x75
DECL|macro|Q933_LINESTAT
mdefine_line|#define&t;Q933_LINESTAT&t;0x51
DECL|macro|Q933_COUNTERS
mdefine_line|#define&t;Q933_COUNTERS&t;0x53
DECL|macro|MAXALIVECNT
mdefine_line|#define&t;MAXALIVECNT&t;3&t;&t;/* No. of failures */
DECL|struct|fr_data
r_struct
id|fr_data
(brace
DECL|member|dlci
id|u16
id|dlci
suffix:semicolon
DECL|member|master
r_struct
id|net_device
op_star
id|master
suffix:semicolon
DECL|member|keepa_pend
r_char
id|keepa_pend
suffix:semicolon
DECL|member|keepa_freq
r_char
id|keepa_freq
suffix:semicolon
DECL|member|keepalivecnt
DECL|member|keeploopcnt
r_char
id|keepalivecnt
comma
id|keeploopcnt
suffix:semicolon
DECL|member|keepa_timer
r_struct
id|timer_list
id|keepa_timer
suffix:semicolon
DECL|member|local_cnt
DECL|member|remote_cnt
id|u8
id|local_cnt
comma
id|remote_cnt
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|fr_master_protocol
r_static
r_struct
id|comx_protocol
id|fr_master_protocol
suffix:semicolon
DECL|variable|fr_slave_protocol
r_static
r_struct
id|comx_protocol
id|fr_slave_protocol
suffix:semicolon
DECL|variable|fr_dlci
r_static
r_struct
id|comx_hardware
id|fr_dlci
suffix:semicolon
DECL|function|fr_keepalive_send
r_static
r_void
id|fr_keepalive_send
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u8
op_star
id|fr_packet
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|dev-&gt;hard_header_len
op_plus
l_int|13
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
id|dev-&gt;hard_header_len
)paren
suffix:semicolon
id|fr_packet
op_assign
(paren
id|u8
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|13
)paren
suffix:semicolon
id|fr_packet
(braket
l_int|0
)braket
op_assign
(paren
id|fr-&gt;dlci
op_amp
(paren
l_int|1024
op_minus
l_int|15
)paren
)paren
op_rshift
l_int|2
suffix:semicolon
id|fr_packet
(braket
l_int|1
)braket
op_assign
(paren
id|fr-&gt;dlci
op_amp
l_int|15
)paren
op_lshift
l_int|4
op_or
l_int|1
suffix:semicolon
singleline_comment|// EA bit 1
id|fr_packet
(braket
l_int|2
)braket
op_assign
id|FRAD_UI
suffix:semicolon
id|fr_packet
(braket
l_int|3
)braket
op_assign
id|NLPID_Q933_LMI
suffix:semicolon
id|fr_packet
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|fr_packet
(braket
l_int|5
)braket
op_assign
id|Q933_ENQ
suffix:semicolon
id|fr_packet
(braket
l_int|6
)braket
op_assign
id|Q933_LINESTAT
suffix:semicolon
id|fr_packet
(braket
l_int|7
)braket
op_assign
l_int|0x01
suffix:semicolon
id|fr_packet
(braket
l_int|8
)braket
op_assign
l_int|0x01
suffix:semicolon
id|fr_packet
(braket
l_int|9
)braket
op_assign
id|Q933_COUNTERS
suffix:semicolon
id|fr_packet
(braket
l_int|10
)braket
op_assign
l_int|0x02
suffix:semicolon
id|fr_packet
(braket
l_int|11
)braket
op_assign
op_increment
id|fr-&gt;local_cnt
suffix:semicolon
id|fr_packet
(braket
l_int|12
)braket
op_assign
id|fr-&gt;remote_cnt
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;priority
op_assign
id|TC_PRIO_CONTROL
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|fr_keepalive_timerfun
r_static
r_void
id|fr_keepalive_timerfun
c_func
(paren
r_int
r_int
id|d
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|d
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dir
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
r_struct
id|comx_channel
op_star
id|sch
suffix:semicolon
r_struct
id|fr_data
op_star
id|sfr
suffix:semicolon
r_struct
id|net_device
op_star
id|sdev
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;init_status
op_amp
id|LINE_OPEN
)paren
(brace
r_if
c_cond
(paren
id|fr-&gt;keepalivecnt
op_eq
id|MAXALIVECNT
)paren
(brace
id|comx_status
c_func
(paren
id|dev
comma
id|ch-&gt;line_status
op_amp
op_complement
id|PROTO_UP
)paren
suffix:semicolon
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|dir
suffix:semicolon
id|dir
op_assign
id|dir-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|dir-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sdev
op_assign
id|dir-&gt;data
)paren
op_logical_and
(paren
id|sch
op_assign
id|sdev-&gt;priv
)paren
op_logical_and
(paren
id|sdev-&gt;type
op_eq
id|ARPHRD_DLCI
)paren
op_logical_and
(paren
id|sfr
op_assign
id|sch-&gt;LINE_privdata
)paren
op_logical_and
(paren
id|sfr-&gt;master
op_eq
id|dev
)paren
op_logical_and
(paren
id|sdev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
(brace
id|sdev-&gt;flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
id|comx_status
c_func
(paren
id|sdev
comma
id|sch-&gt;line_status
op_amp
op_complement
id|PROTO_UP
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|fr-&gt;keepalivecnt
op_le
id|MAXALIVECNT
)paren
(brace
op_increment
id|fr-&gt;keepalivecnt
suffix:semicolon
)brace
id|fr_keepalive_send
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|mod_timer
c_func
(paren
op_amp
id|fr-&gt;keepa_timer
comma
id|jiffies
op_plus
id|HZ
op_star
id|fr-&gt;keepa_freq
)paren
suffix:semicolon
)brace
DECL|function|fr_rx_lmi
r_static
r_void
id|fr_rx_lmi
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|dlci
comma
id|u8
id|nlpid
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dir
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
r_struct
id|comx_channel
op_star
id|sch
suffix:semicolon
r_struct
id|fr_data
op_star
id|sfr
suffix:semicolon
r_struct
id|net_device
op_star
id|sdev
suffix:semicolon
r_if
c_cond
(paren
id|dlci
op_ne
id|fr-&gt;dlci
op_logical_or
id|nlpid
op_ne
id|NLPID_Q933_LMI
op_logical_or
op_logical_neg
id|fr-&gt;keepa_freq
)paren
(brace
r_return
suffix:semicolon
)brace
id|fr-&gt;remote_cnt
op_assign
id|skb-&gt;data
(braket
l_int|7
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|8
)braket
op_eq
id|fr-&gt;local_cnt
)paren
(brace
singleline_comment|// keepalive UP!
id|fr-&gt;keepalivecnt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
op_logical_and
op_logical_neg
(paren
id|ch-&gt;line_status
op_amp
id|PROTO_UP
)paren
)paren
(brace
id|comx_status
c_func
(paren
id|dev
comma
id|ch-&gt;line_status
op_or_assign
id|PROTO_UP
)paren
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|IFF_RUNNING
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|dir
suffix:semicolon
id|dir
op_assign
id|dir-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|dir-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sdev
op_assign
id|dir-&gt;data
)paren
op_logical_and
(paren
id|sch
op_assign
id|sdev-&gt;priv
)paren
op_logical_and
(paren
id|sdev-&gt;type
op_eq
id|ARPHRD_DLCI
)paren
op_logical_and
(paren
id|sfr
op_assign
id|sch-&gt;LINE_privdata
)paren
op_logical_and
(paren
id|sfr-&gt;master
op_eq
id|dev
)paren
op_logical_and
(paren
id|sdev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
(brace
id|sdev-&gt;flags
op_or_assign
id|IFF_RUNNING
suffix:semicolon
id|comx_status
c_func
(paren
id|sdev
comma
id|sch-&gt;line_status
op_or
id|PROTO_UP
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|function|fr_set_keepalive
r_static
r_void
id|fr_set_keepalive
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|keepa
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|keepa
op_logical_and
id|fr-&gt;keepa_freq
)paren
(brace
singleline_comment|// switch off
id|fr-&gt;keepa_freq
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
(brace
id|comx_status
c_func
(paren
id|dev
comma
id|ch-&gt;line_status
op_or
id|PROTO_UP
)paren
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|IFF_RUNNING
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|fr-&gt;keepa_timer
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|keepa
)paren
(brace
singleline_comment|// bekapcs
r_if
c_cond
(paren
id|fr-&gt;keepa_freq
op_logical_and
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|fr-&gt;keepa_timer
)paren
suffix:semicolon
)brace
id|fr-&gt;keepa_freq
op_assign
id|keepa
suffix:semicolon
id|fr-&gt;local_cnt
op_assign
id|fr-&gt;remote_cnt
op_assign
l_int|0
suffix:semicolon
id|fr-&gt;keepa_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|fr-&gt;keepa_timer.function
op_assign
id|fr_keepalive_timerfun
suffix:semicolon
id|fr-&gt;keepa_timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|ch-&gt;line_status
op_and_assign
op_complement
(paren
id|PROTO_UP
op_or
id|PROTO_LOOP
)paren
suffix:semicolon
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
id|comx_status
c_func
(paren
id|dev
comma
id|ch-&gt;line_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
(brace
id|add_timer
c_func
(paren
op_amp
id|fr-&gt;keepa_timer
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|fr_rx
r_static
r_void
id|fr_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dir
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
r_struct
id|net_device
op_star
id|sdev
op_assign
id|dev
suffix:semicolon
r_struct
id|comx_channel
op_star
id|sch
suffix:semicolon
r_struct
id|fr_data
op_star
id|sfr
suffix:semicolon
id|u16
id|dlci
suffix:semicolon
id|u8
id|nlpid
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
op_le
l_int|4
op_logical_or
id|skb-&gt;data
(braket
l_int|2
)braket
op_ne
id|FRAD_UI
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Itt majd ki kell talalni, melyik slave kapja a csomagot */
id|dlci
op_assign
(paren
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_amp
l_int|0xfc
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|skb-&gt;data
(braket
l_int|1
)braket
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|nlpid
op_assign
id|skb-&gt;data
(braket
l_int|3
)braket
)paren
op_eq
l_int|0
)paren
(brace
singleline_comment|// Optional padding 
id|nlpid
op_assign
id|skb-&gt;data
(braket
l_int|4
)braket
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
)brace
id|skb_pull
c_func
(paren
id|skb
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* DLCI and header throw away */
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|DEBUG_COMX_DLCI
)paren
(brace
id|comx_debug
c_func
(paren
id|dev
comma
l_string|&quot;Frame received, DLCI: %d, NLPID: 0x%02x&bslash;n&quot;
comma
id|dlci
comma
id|nlpid
)paren
suffix:semicolon
id|comx_debug_skb
c_func
(paren
id|dev
comma
id|skb
comma
l_string|&quot;Contents&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Megkeressuk, kihez tartozik */
r_for
c_loop
(paren
suffix:semicolon
id|dir
suffix:semicolon
id|dir
op_assign
id|dir-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|dir-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sdev
op_assign
id|dir-&gt;data
)paren
op_logical_and
(paren
id|sch
op_assign
id|sdev-&gt;priv
)paren
op_logical_and
(paren
id|sdev-&gt;type
op_eq
id|ARPHRD_DLCI
)paren
op_logical_and
(paren
id|sfr
op_assign
id|sch-&gt;LINE_privdata
)paren
op_logical_and
(paren
id|sfr-&gt;master
op_eq
id|dev
)paren
op_logical_and
(paren
id|sfr-&gt;dlci
op_eq
id|dlci
)paren
)paren
(brace
id|skb-&gt;dev
op_assign
id|sdev
suffix:semicolon
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|DEBUG_COMX_DLCI
)paren
(brace
id|comx_debug
c_func
(paren
id|dev
comma
l_string|&quot;Passing it to %s&bslash;n&quot;
comma
id|sdev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
op_ne
id|sdev
)paren
(brace
id|sch-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|sch-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_switch
c_cond
(paren
id|nlpid
)paren
(brace
r_case
id|NLPID_IP
suffix:colon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|comx_rx
c_func
(paren
id|sdev
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NLPID_Q933_LMI
suffix:colon
id|fr_rx_lmi
c_func
(paren
id|dev
comma
id|skb
comma
id|dlci
comma
id|nlpid
)paren
suffix:semicolon
r_default
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|fr_tx
r_static
r_int
id|fr_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dir
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
r_struct
id|net_device
op_star
id|sdev
suffix:semicolon
r_struct
id|comx_channel
op_star
id|sch
suffix:semicolon
r_struct
id|fr_data
op_star
id|sfr
suffix:semicolon
r_int
id|cnt
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Ha minden igaz, 2 helyen fog allni a tbusy: a masternel, &n;&t;   es annal a slave-nel aki eppen kuldott.&n;&t;   Egy helyen akkor all, ha a master kuldott.&n;&t;   Ez megint jo lesz majd, ha utemezni akarunk */
multiline_comment|/* This should be fixed, the slave tbusy should be set when &n;&t;   the masters queue is full and reset when not */
r_for
c_loop
(paren
suffix:semicolon
id|dir
suffix:semicolon
id|dir
op_assign
id|dir-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|dir-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sdev
op_assign
id|dir-&gt;data
)paren
op_logical_and
(paren
id|sch
op_assign
id|sdev-&gt;priv
)paren
op_logical_and
(paren
id|sdev-&gt;type
op_eq
id|ARPHRD_DLCI
)paren
op_logical_and
(paren
id|sfr
op_assign
id|sch-&gt;LINE_privdata
)paren
op_logical_and
(paren
id|sfr-&gt;master
op_eq
id|dev
)paren
op_logical_and
(paren
id|netif_queue_stopped
c_func
(paren
id|sdev
)paren
)paren
)paren
(brace
id|netif_wake_queue
c_func
(paren
id|sdev
)paren
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
)brace
)brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fr_status
r_static
r_void
id|fr_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|status
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dir
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
r_struct
id|net_device
op_star
id|sdev
suffix:semicolon
r_struct
id|comx_channel
op_star
id|sch
suffix:semicolon
r_struct
id|fr_data
op_star
id|sfr
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|LINE_UP
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|fr-&gt;keepa_freq
)paren
(brace
id|status
op_or_assign
id|PROTO_UP
suffix:semicolon
)brace
)brace
r_else
(brace
id|status
op_and_assign
op_complement
(paren
id|PROTO_UP
op_or
id|PROTO_LOOP
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
op_eq
id|fr-&gt;master
op_logical_and
id|fr-&gt;keepa_freq
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|LINE_UP
)paren
(brace
id|fr-&gt;keepa_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|fr-&gt;keepa_timer
)paren
suffix:semicolon
id|fr-&gt;keepalivecnt
op_assign
id|MAXALIVECNT
op_plus
l_int|1
suffix:semicolon
id|fr-&gt;keeploopcnt
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|del_timer
c_func
(paren
op_amp
id|fr-&gt;keepa_timer
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Itt a status valtozast vegig kell vinni az osszes slave-n */
r_for
c_loop
(paren
suffix:semicolon
id|dir
suffix:semicolon
id|dir
op_assign
id|dir-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|dir-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sdev
op_assign
id|dir-&gt;data
)paren
op_logical_and
(paren
id|sch
op_assign
id|sdev-&gt;priv
)paren
op_logical_and
(paren
id|sdev-&gt;type
op_eq
id|ARPHRD_FRAD
op_logical_or
id|sdev-&gt;type
op_eq
id|ARPHRD_DLCI
)paren
op_logical_and
(paren
id|sfr
op_assign
id|sch-&gt;LINE_privdata
)paren
op_logical_and
(paren
id|sfr-&gt;master
op_eq
id|dev
)paren
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|LINE_UP
)paren
(brace
id|netif_wake_queue
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
id|comx_status
c_func
(paren
id|sdev
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|PROTO_UP
op_or
id|PROTO_LOOP
)paren
)paren
(brace
id|dev-&gt;flags
op_or_assign
id|IFF_RUNNING
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|fr_open
r_static
r_int
id|fr_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|comxdir
op_assign
id|ch-&gt;procdir
suffix:semicolon
r_struct
id|comx_channel
op_star
id|mch
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;init_status
op_amp
id|HW_OPEN
)paren
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ch-&gt;hardware
op_eq
op_amp
id|fr_dlci
op_logical_and
id|ch-&gt;protocol
op_ne
op_amp
id|fr_slave_protocol
)paren
op_logical_or
(paren
id|ch-&gt;protocol
op_eq
op_amp
id|fr_slave_protocol
op_logical_and
id|ch-&gt;hardware
op_ne
op_amp
id|fr_dlci
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Trying to open an improperly set FR interface, giving up&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|fr-&gt;master
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|mch
op_assign
id|fr-&gt;master-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|fr-&gt;master
op_ne
id|dev
op_logical_and
(paren
op_logical_neg
(paren
id|mch-&gt;init_status
op_amp
id|LINE_OPEN
)paren
op_logical_or
(paren
id|mch-&gt;protocol
op_ne
op_amp
id|fr_master_protocol
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Master %s is inactive, or incorrectly set up, &quot;
l_string|&quot;unable to open %s&bslash;n&quot;
comma
id|fr-&gt;master-&gt;name
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ch-&gt;init_status
op_or_assign
id|LINE_OPEN
suffix:semicolon
id|ch-&gt;line_status
op_and_assign
op_complement
(paren
id|PROTO_UP
op_or
id|PROTO_LOOP
)paren
suffix:semicolon
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
r_if
c_cond
(paren
id|fr-&gt;master
op_eq
id|dev
)paren
(brace
r_if
c_cond
(paren
id|fr-&gt;keepa_freq
)paren
(brace
id|fr-&gt;keepa_timer.function
op_assign
id|fr_keepalive_timerfun
suffix:semicolon
id|fr-&gt;keepa_timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|fr-&gt;keepa_timer
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ch-&gt;line_status
op_amp
id|LINE_UP
)paren
(brace
id|ch-&gt;line_status
op_or_assign
id|PROTO_UP
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|IFF_RUNNING
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|ch-&gt;line_status
op_assign
id|mch-&gt;line_status
suffix:semicolon
r_if
c_cond
(paren
id|fr-&gt;master-&gt;flags
op_amp
id|IFF_RUNNING
)paren
(brace
id|dev-&gt;flags
op_or_assign
id|IFF_RUNNING
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
suffix:semicolon
id|comxdir
suffix:semicolon
id|comxdir
op_assign
id|comxdir-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|comxdir-&gt;name
comma
id|FILENAME_DLCI
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|comxdir-&gt;name
comma
id|FILENAME_MASTER
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|comxdir-&gt;name
comma
id|FILENAME_KEEPALIVE
)paren
op_eq
l_int|0
)paren
(brace
id|comxdir-&gt;mode
op_assign
id|S_IFREG
op_or
l_int|0444
suffix:semicolon
)brace
)brace
singleline_comment|//&t;comx_status(dev, ch-&gt;line_status);
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fr_close
r_static
r_int
id|fr_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|comxdir
op_assign
id|ch-&gt;procdir
suffix:semicolon
r_if
c_cond
(paren
id|fr-&gt;master
op_eq
id|dev
)paren
(brace
singleline_comment|// Ha master 
r_struct
id|proc_dir_entry
op_star
id|dir
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
r_struct
id|net_device
op_star
id|sdev
op_assign
id|dev
suffix:semicolon
r_struct
id|comx_channel
op_star
id|sch
suffix:semicolon
r_struct
id|fr_data
op_star
id|sfr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ch-&gt;init_status
op_amp
id|HW_OPEN
)paren
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fr-&gt;keepa_freq
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|fr-&gt;keepa_timer
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
id|dir
suffix:semicolon
id|dir
op_assign
id|dir-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|dir-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sdev
op_assign
id|dir-&gt;data
)paren
op_logical_and
(paren
id|sch
op_assign
id|sdev-&gt;priv
)paren
op_logical_and
(paren
id|sdev-&gt;type
op_eq
id|ARPHRD_DLCI
)paren
op_logical_and
(paren
id|sfr
op_assign
id|sch-&gt;LINE_privdata
)paren
op_logical_and
(paren
id|sfr-&gt;master
op_eq
id|dev
)paren
op_logical_and
(paren
id|sch-&gt;init_status
op_amp
id|LINE_OPEN
)paren
)paren
(brace
id|dev_close
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
)brace
)brace
id|ch-&gt;init_status
op_and_assign
op_complement
id|LINE_OPEN
suffix:semicolon
id|ch-&gt;line_status
op_and_assign
op_complement
(paren
id|PROTO_UP
op_or
id|PROTO_LOOP
)paren
suffix:semicolon
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|comxdir
suffix:semicolon
id|comxdir
op_assign
id|comxdir-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|comxdir-&gt;name
comma
id|FILENAME_DLCI
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|comxdir-&gt;name
comma
id|FILENAME_MASTER
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
c_func
(paren
id|comxdir-&gt;name
comma
id|FILENAME_KEEPALIVE
)paren
op_eq
l_int|0
)paren
(brace
id|comxdir-&gt;mode
op_assign
id|S_IFREG
op_or
l_int|0444
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fr_xmit
r_static
r_int
id|fr_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|comx_channel
op_star
id|sch
comma
op_star
id|mch
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_struct
id|fr_data
op_star
id|sfr
suffix:semicolon
r_struct
id|net_device
op_star
id|sdev
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dir
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fr-&gt;master
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;BUG: fr_xmit without a master!!! dev: %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mch
op_assign
id|fr-&gt;master-&gt;priv
suffix:semicolon
multiline_comment|/* Ennek majd a slave utemezeskor lesz igazan jelentosege */
r_if
c_cond
(paren
id|ch-&gt;debug_flags
op_amp
id|DEBUG_COMX_DLCI
)paren
(brace
id|comx_debug_skb
c_func
(paren
id|dev
comma
id|skb
comma
l_string|&quot;Sending frame&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
op_ne
id|fr-&gt;master
)paren
(brace
r_struct
id|sk_buff
op_star
id|newskb
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|newskb-&gt;dev
op_assign
id|fr-&gt;master
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|newskb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|ch-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|ch-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
)brace
r_else
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|dir
suffix:semicolon
id|dir
op_assign
id|dir-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|dir-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sdev
op_assign
id|dir-&gt;data
)paren
op_logical_and
(paren
id|sch
op_assign
id|sdev-&gt;priv
)paren
op_logical_and
(paren
id|sdev-&gt;type
op_eq
id|ARPHRD_DLCI
)paren
op_logical_and
(paren
id|sfr
op_assign
id|sch-&gt;LINE_privdata
)paren
op_logical_and
(paren
id|sfr-&gt;master
op_eq
id|dev
)paren
op_logical_and
(paren
id|netif_queue_stopped
c_func
(paren
id|sdev
)paren
)paren
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|sdev
)paren
suffix:semicolon
)brace
)brace
r_switch
c_cond
(paren
id|mch
op_member_access_from_pointer
id|HW_send_packet
c_func
(paren
id|dev
comma
id|skb
)paren
)paren
(brace
r_case
id|FRAME_QUEUED
suffix:colon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FRAME_ACCEPTED
suffix:colon
r_case
id|FRAME_DROPPED
suffix:colon
r_break
suffix:semicolon
r_case
id|FRAME_ERROR
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Transmit frame error (len %d)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fr_header
r_static
r_int
id|fr_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|len
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
id|skb_push
c_func
(paren
id|skb
comma
id|dev-&gt;hard_header_len
)paren
suffix:semicolon
multiline_comment|/* Put in DLCI */
id|skb-&gt;data
(braket
l_int|0
)braket
op_assign
(paren
id|fr-&gt;dlci
op_amp
(paren
l_int|1024
op_minus
l_int|15
)paren
)paren
op_rshift
l_int|2
suffix:semicolon
id|skb-&gt;data
(braket
l_int|1
)braket
op_assign
(paren
id|fr-&gt;dlci
op_amp
l_int|15
)paren
op_lshift
l_int|4
op_or
l_int|1
suffix:semicolon
singleline_comment|// EA bit 1
id|skb-&gt;data
(braket
l_int|2
)braket
op_assign
id|FRAD_UI
suffix:semicolon
id|skb-&gt;data
(braket
l_int|3
)braket
op_assign
id|NLPID_IP
suffix:semicolon
r_return
id|dev-&gt;hard_header_len
suffix:semicolon
)brace
DECL|function|fr_statistics
r_static
r_int
id|fr_statistics
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|page
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fr-&gt;master
op_eq
id|dev
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|dir
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
r_struct
id|net_device
op_star
id|sdev
suffix:semicolon
r_struct
id|comx_channel
op_star
id|sch
suffix:semicolon
r_struct
id|fr_data
op_star
id|sfr
suffix:semicolon
r_int
id|slaves
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;This is a Frame Relay master device&bslash;nSlaves: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|dir
suffix:semicolon
id|dir
op_assign
id|dir-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|dir-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sdev
op_assign
id|dir-&gt;data
)paren
op_logical_and
(paren
id|sch
op_assign
id|sdev-&gt;priv
)paren
op_logical_and
(paren
id|sdev-&gt;type
op_eq
id|ARPHRD_DLCI
)paren
op_logical_and
(paren
id|sfr
op_assign
id|sch-&gt;LINE_privdata
)paren
op_logical_and
(paren
id|sfr-&gt;master
op_eq
id|dev
)paren
op_logical_and
(paren
id|sdev
op_ne
id|dev
)paren
)paren
(brace
id|slaves
op_increment
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s &quot;
comma
id|sdev-&gt;name
)paren
suffix:semicolon
)brace
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|slaves
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;(none)&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fr-&gt;keepa_freq
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Line keepalive (value %d) &quot;
l_string|&quot;status %s [%d]&bslash;n&quot;
comma
id|fr-&gt;keepa_freq
comma
id|ch-&gt;line_status
op_amp
id|PROTO_LOOP
ques
c_cond
l_string|&quot;LOOP&quot;
suffix:colon
id|ch-&gt;line_status
op_amp
id|PROTO_UP
ques
c_cond
l_string|&quot;UP&quot;
suffix:colon
l_string|&quot;DOWN&quot;
comma
id|fr-&gt;keepalivecnt
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Line keepalive protocol &quot;
l_string|&quot;is not set&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
singleline_comment|// if slave
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;This is a Frame Relay slave device, master: %s&bslash;n&quot;
comma
id|fr-&gt;master
ques
c_cond
id|fr-&gt;master-&gt;name
suffix:colon
l_string|&quot;(not set)&quot;
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|fr_read_proc
r_static
r_int
id|fr_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|file
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|file-&gt;parent-&gt;data
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_DLCI
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%04d&bslash;n&quot;
comma
id|fr-&gt;dlci
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_MASTER
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%-9s&bslash;n&quot;
comma
id|fr-&gt;master
ques
c_cond
id|fr-&gt;master-&gt;name
suffix:colon
l_string|&quot;(none)&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|file-&gt;name
comma
id|FILENAME_KEEPALIVE
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_assign
id|fr-&gt;keepa_freq
ques
c_cond
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;% 3d&bslash;n&quot;
comma
id|fr-&gt;keepa_freq
)paren
suffix:colon
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;off&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;comxfr: internal error, filename %s&bslash;n&quot;
comma
id|file-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EBADF
suffix:semicolon
)brace
r_if
c_cond
(paren
id|off
op_ge
id|len
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
id|len
op_minus
id|off
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
(paren
id|min
c_func
(paren
id|count
comma
id|len
op_minus
id|off
)paren
)paren
suffix:semicolon
)brace
DECL|function|fr_write_proc
r_static
r_int
id|fr_write_proc
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
id|u_long
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|entry-&gt;parent-&gt;data
suffix:semicolon
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
l_int|NULL
suffix:semicolon
r_char
op_star
id|page
suffix:semicolon
r_if
c_cond
(paren
id|ch
)paren
(brace
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|page
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|copy_from_user
c_func
(paren
id|page
comma
id|buffer
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
id|page
op_plus
id|count
op_minus
l_int|1
)paren
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
op_star
(paren
id|page
op_plus
id|count
op_minus
l_int|1
)paren
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_DLCI
)paren
op_eq
l_int|0
)paren
(brace
id|u16
id|dlci_new
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dlci_new
OG
l_int|1023
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Invalid DLCI value&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|fr-&gt;dlci
op_assign
id|dlci_new
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_MASTER
)paren
op_eq
l_int|0
)paren
(brace
r_struct
id|net_device
op_star
id|new_master
op_assign
id|dev_get_by_name
c_func
(paren
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_master
op_logical_and
id|new_master-&gt;type
op_eq
id|ARPHRD_FRAD
)paren
(brace
r_struct
id|comx_channel
op_star
id|sch
op_assign
id|new_master-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|sfr
op_assign
id|sch-&gt;LINE_privdata
suffix:semicolon
r_if
c_cond
(paren
id|sfr
op_logical_and
id|sfr-&gt;master
op_eq
id|new_master
)paren
(brace
r_if
c_cond
(paren
id|fr-&gt;master
)paren
(brace
id|dev_put
c_func
(paren
id|fr-&gt;master
)paren
suffix:semicolon
)brace
id|fr-&gt;master
op_assign
id|new_master
suffix:semicolon
multiline_comment|/* Megorokli a master statuszat */
id|ch-&gt;line_status
op_assign
id|sch-&gt;line_status
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|entry-&gt;name
comma
id|FILENAME_KEEPALIVE
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|keepa_new
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|page
comma
id|KEEPALIVE_OFF
)paren
op_eq
l_int|0
)paren
(brace
id|keepa_new
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|keepa_new
op_assign
id|simple_strtoul
c_func
(paren
id|page
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|keepa_new
template_param
l_int|100
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;invalid keepalive&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|fr-&gt;keepa_freq
op_logical_and
id|keepa_new
op_ne
id|fr-&gt;keepa_freq
)paren
(brace
id|fr_set_keepalive
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|keepa_new
)paren
(brace
id|fr_set_keepalive
c_func
(paren
id|dev
comma
id|keepa_new
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;comxfr_write_proc: internal error, filename %s&bslash;n&quot;
comma
id|entry-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EBADF
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|fr_exit
r_static
r_int
id|fr_exit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_struct
id|net_device
op_star
id|sdev
op_assign
id|dev
suffix:semicolon
r_struct
id|comx_channel
op_star
id|sch
suffix:semicolon
r_struct
id|fr_data
op_star
id|sfr
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dir
op_assign
id|ch-&gt;procdir-&gt;parent-&gt;subdir
suffix:semicolon
multiline_comment|/* Ha lezarunk egy master-t, le kell kattintani a slave-eket is */
r_if
c_cond
(paren
id|fr-&gt;master
op_logical_and
id|fr-&gt;master
op_eq
id|dev
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|dir
suffix:semicolon
id|dir
op_assign
id|dir-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|dir-&gt;mode
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sdev
op_assign
id|dir-&gt;data
)paren
op_logical_and
(paren
id|sch
op_assign
id|sdev-&gt;priv
)paren
op_logical_and
(paren
id|sdev-&gt;type
op_eq
id|ARPHRD_DLCI
)paren
op_logical_and
(paren
id|sfr
op_assign
id|sch-&gt;LINE_privdata
)paren
op_logical_and
(paren
id|sfr-&gt;master
op_eq
id|dev
)paren
)paren
(brace
id|dev_close
c_func
(paren
id|sdev
)paren
suffix:semicolon
id|sfr-&gt;master
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
id|dev-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;type
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;mtu
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;LINE_rx
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_tx
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_status
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_open
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_close
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_xmit
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_header
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_rebuild_header
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_statistics
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fr-&gt;master
op_ne
id|dev
)paren
(brace
singleline_comment|// if not master, remove dlci
r_if
c_cond
(paren
id|fr-&gt;master
)paren
(brace
id|dev_put
c_func
(paren
id|fr-&gt;master
)paren
suffix:semicolon
)brace
id|remove_proc_entry
c_func
(paren
id|FILENAME_DLCI
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_MASTER
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|fr-&gt;keepa_freq
)paren
(brace
id|fr_set_keepalive
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
)brace
id|remove_proc_entry
c_func
(paren
id|FILENAME_KEEPALIVE
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|FILENAME_DLCI
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|fr
)paren
suffix:semicolon
id|ch-&gt;LINE_privdata
op_assign
l_int|NULL
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fr_master_init
r_static
r_int
id|fr_master_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|new_file
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fr
op_assign
id|ch-&gt;LINE_privdata
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fr_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|fr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fr_data
)paren
)paren
suffix:semicolon
id|fr-&gt;master
op_assign
id|dev
suffix:semicolon
singleline_comment|// this means master
id|fr-&gt;dlci
op_assign
l_int|0
suffix:semicolon
singleline_comment|// let&squot;s say default
id|dev-&gt;flags
op_assign
id|IFF_POINTOPOINT
op_or
id|IFF_NOARP
op_or
id|IFF_MULTICAST
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_FRAD
suffix:semicolon
id|dev-&gt;mtu
op_assign
l_int|1500
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
l_int|4
suffix:semicolon
id|dev-&gt;addr_len
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;LINE_rx
op_assign
id|fr_rx
suffix:semicolon
id|ch-&gt;LINE_tx
op_assign
id|fr_tx
suffix:semicolon
id|ch-&gt;LINE_status
op_assign
id|fr_status
suffix:semicolon
id|ch-&gt;LINE_open
op_assign
id|fr_open
suffix:semicolon
id|ch-&gt;LINE_close
op_assign
id|fr_close
suffix:semicolon
id|ch-&gt;LINE_xmit
op_assign
id|fr_xmit
suffix:semicolon
id|ch-&gt;LINE_header
op_assign
id|fr_header
suffix:semicolon
id|ch-&gt;LINE_rebuild_header
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_statistics
op_assign
id|fr_statistics
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_DLCI
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_LINE_privdata
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|fr_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|fr_write_proc
suffix:semicolon
id|new_file-&gt;size
op_assign
l_int|5
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_KEEPALIVE
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_dlci
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|fr_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|fr_write_proc
suffix:semicolon
id|new_file-&gt;size
op_assign
l_int|4
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|fr_set_keepalive
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|cleanup_filename_dlci
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_DLCI
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_LINE_privdata
suffix:colon
id|kfree
c_func
(paren
id|fr
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|fr_slave_init
r_static
r_int
id|fr_slave_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|new_file
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fr
op_assign
id|ch-&gt;LINE_privdata
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fr_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|fr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fr_data
)paren
)paren
suffix:semicolon
id|dev-&gt;flags
op_assign
id|IFF_POINTOPOINT
op_or
id|IFF_NOARP
op_or
id|IFF_MULTICAST
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_DLCI
suffix:semicolon
id|dev-&gt;mtu
op_assign
l_int|1500
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
l_int|4
suffix:semicolon
id|dev-&gt;addr_len
op_assign
l_int|0
suffix:semicolon
id|ch-&gt;LINE_rx
op_assign
id|fr_rx
suffix:semicolon
id|ch-&gt;LINE_tx
op_assign
id|fr_tx
suffix:semicolon
id|ch-&gt;LINE_status
op_assign
id|fr_status
suffix:semicolon
id|ch-&gt;LINE_open
op_assign
id|fr_open
suffix:semicolon
id|ch-&gt;LINE_close
op_assign
id|fr_close
suffix:semicolon
id|ch-&gt;LINE_xmit
op_assign
id|fr_xmit
suffix:semicolon
id|ch-&gt;LINE_header
op_assign
id|fr_header
suffix:semicolon
id|ch-&gt;LINE_rebuild_header
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;LINE_statistics
op_assign
id|fr_statistics
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_DLCI
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_LINE_privdata
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|fr_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|fr_write_proc
suffix:semicolon
id|new_file-&gt;size
op_assign
l_int|5
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_file
op_assign
id|create_proc_entry
c_func
(paren
id|FILENAME_MASTER
comma
id|S_IFREG
op_or
l_int|0644
comma
id|ch-&gt;procdir
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|cleanup_filename_dlci
suffix:semicolon
)brace
id|new_file-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|new_file
suffix:semicolon
id|new_file-&gt;read_proc
op_assign
op_amp
id|fr_read_proc
suffix:semicolon
id|new_file-&gt;write_proc
op_assign
op_amp
id|fr_write_proc
suffix:semicolon
id|new_file-&gt;size
op_assign
l_int|10
suffix:semicolon
id|new_file-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|cleanup_filename_dlci
suffix:colon
id|remove_proc_entry
c_func
(paren
id|FILENAME_DLCI
comma
id|ch-&gt;procdir
)paren
suffix:semicolon
id|cleanup_LINE_privdata
suffix:colon
id|kfree
c_func
(paren
id|fr
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|dlci_open
r_static
r_int
id|dlci_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|ch-&gt;init_status
op_or_assign
id|HW_OPEN
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dlci_close
r_static
r_int
id|dlci_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|ch-&gt;init_status
op_and_assign
op_complement
id|HW_OPEN
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dlci_txe
r_static
r_int
id|dlci_txe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|fr_data
op_star
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fr-&gt;master
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|ch
op_assign
id|fr-&gt;master-&gt;priv
suffix:semicolon
id|fr
op_assign
id|ch-&gt;LINE_privdata
suffix:semicolon
r_return
id|ch
op_member_access_from_pointer
id|HW_txe
c_func
(paren
id|fr-&gt;master
)paren
suffix:semicolon
)brace
DECL|function|dlci_statistics
r_static
r_int
id|dlci_statistics
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|page
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dlci_init
r_static
r_int
id|dlci_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|ch-&gt;HW_open
op_assign
id|dlci_open
suffix:semicolon
id|ch-&gt;HW_close
op_assign
id|dlci_close
suffix:semicolon
id|ch-&gt;HW_txe
op_assign
id|dlci_txe
suffix:semicolon
id|ch-&gt;HW_statistics
op_assign
id|dlci_statistics
suffix:semicolon
multiline_comment|/* Nincs egyeb hw info, mert ugyis a fr-&gt;master-bol fog minden kiderulni */
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dlci_exit
r_static
r_int
id|dlci_exit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|comx_channel
op_star
id|ch
op_assign
id|dev-&gt;priv
suffix:semicolon
id|ch-&gt;HW_open
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;HW_close
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;HW_txe
op_assign
l_int|NULL
suffix:semicolon
id|ch-&gt;HW_statistics
op_assign
l_int|NULL
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dlci_dump
r_static
r_int
id|dlci_dump
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;dlci_dump %s, HOGY MI ???&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|variable|fr_master_protocol
r_static
r_struct
id|comx_protocol
id|fr_master_protocol
op_assign
(brace
l_string|&quot;frad&quot;
comma
id|VERSION
comma
id|ARPHRD_FRAD
comma
id|fr_master_init
comma
id|fr_exit
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|fr_slave_protocol
r_static
r_struct
id|comx_protocol
id|fr_slave_protocol
op_assign
(brace
l_string|&quot;ietf-ip&quot;
comma
id|VERSION
comma
id|ARPHRD_DLCI
comma
id|fr_slave_init
comma
id|fr_exit
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|fr_dlci
r_static
r_struct
id|comx_hardware
id|fr_dlci
op_assign
(brace
l_string|&quot;dlci&quot;
comma
id|VERSION
comma
id|dlci_init
comma
id|dlci_exit
comma
id|dlci_dump
comma
l_int|NULL
)brace
suffix:semicolon
macro_line|#ifdef MODULE
DECL|macro|comx_proto_fr_init
mdefine_line|#define comx_proto_fr_init init_module
macro_line|#endif
DECL|function|comx_proto_fr_init
r_int
id|__init
id|comx_proto_fr_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|comx_register_hardware
c_func
(paren
op_amp
id|fr_dlci
)paren
)paren
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|comx_register_protocol
c_func
(paren
op_amp
id|fr_master_protocol
)paren
)paren
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
r_return
id|comx_register_protocol
c_func
(paren
op_amp
id|fr_slave_protocol
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|comx_unregister_hardware
c_func
(paren
id|fr_dlci.name
)paren
suffix:semicolon
id|comx_unregister_protocol
c_func
(paren
id|fr_master_protocol.name
)paren
suffix:semicolon
id|comx_unregister_protocol
c_func
(paren
id|fr_slave_protocol.name
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
eof
