multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&t;hdlcdrv.c  -- HDLC packet radio network driver.&n; *&n; *&t;Copyright (C) 1996-2000  Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;This program is distributed in the hope that it will be useful,&n; *&t;but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *&t;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *&t;GNU General Public License for more details.&n; *&n; *&t;You should have received a copy of the GNU General Public License&n; *&t;along with this program; if not, write to the Free Software&n; *&t;Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *  Please note that the GPL allows you to use the driver, NOT the radio.&n; *  In order to use the radio, you need a license from the communications&n; *  authority of your country.&n; *&n; *  The driver was derived from Donald Beckers skeleton.c&n; *&t;Written 1993-94 by Donald Becker.&n; *&n; *  History:&n; *   0.1  21.09.1996  Started&n; *        18.10.1996  Changed to new user space access routines &n; *                    (copy_{to,from}_user)&n; *   0.2  21.11.1996  various small changes&n; *   0.3  03.03.1997  fixed (hopefully) IP not working with ax.25 as a module&n; *   0.4  16.04.1997  init code/data tagged&n; *   0.5  30.07.1997  made HDLC buffers bigger (solves a problem with the&n; *                    soundmodem driver)&n; *   0.6  05.04.1998  add spinlocks&n; *   0.7  03.08.1999  removed some old compatibility cruft&n; *   0.8  12.02.2000  adapted to softnet driver interface&n; */
multiline_comment|/*****************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/if.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/hdlcdrv.h&gt;
multiline_comment|/* prototypes for ax25_encapsulate and ax25_rebuild_header */
macro_line|#include &lt;net/ax25.h&gt; 
multiline_comment|/* make genksyms happy */
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/udp.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * The name of the card. Is used for messages and in the requests for&n; * io regions, irqs and dma channels&n; */
DECL|variable|ax25_bcast
r_static
r_char
id|ax25_bcast
(braket
id|AX25_ADDR_LEN
)braket
op_assign
(brace
l_char|&squot;Q&squot;
op_lshift
l_int|1
comma
l_char|&squot;S&squot;
op_lshift
l_int|1
comma
l_char|&squot;T&squot;
op_lshift
l_int|1
comma
l_char|&squot; &squot;
op_lshift
l_int|1
comma
l_char|&squot; &squot;
op_lshift
l_int|1
comma
l_char|&squot; &squot;
op_lshift
l_int|1
comma
l_char|&squot;0&squot;
op_lshift
l_int|1
)brace
suffix:semicolon
DECL|variable|ax25_nocall
r_static
r_char
id|ax25_nocall
(braket
id|AX25_ADDR_LEN
)braket
op_assign
(brace
l_char|&squot;L&squot;
op_lshift
l_int|1
comma
l_char|&squot;I&squot;
op_lshift
l_int|1
comma
l_char|&squot;N&squot;
op_lshift
l_int|1
comma
l_char|&squot;U&squot;
op_lshift
l_int|1
comma
l_char|&squot;X&squot;
op_lshift
l_int|1
comma
l_char|&squot; &squot;
op_lshift
l_int|1
comma
l_char|&squot;1&squot;
op_lshift
l_int|1
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|KISS_VERBOSE
mdefine_line|#define KISS_VERBOSE
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|PARAM_TXDELAY
mdefine_line|#define PARAM_TXDELAY   1
DECL|macro|PARAM_PERSIST
mdefine_line|#define PARAM_PERSIST   2
DECL|macro|PARAM_SLOTTIME
mdefine_line|#define PARAM_SLOTTIME  3
DECL|macro|PARAM_TXTAIL
mdefine_line|#define PARAM_TXTAIL    4
DECL|macro|PARAM_FULLDUP
mdefine_line|#define PARAM_FULLDUP   5
DECL|macro|PARAM_HARDWARE
mdefine_line|#define PARAM_HARDWARE  6
DECL|macro|PARAM_RETURN
mdefine_line|#define PARAM_RETURN    255
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|min
mdefine_line|#define min(a, b) (((a) &lt; (b)) ? (a) : (b))
DECL|macro|max
mdefine_line|#define max(a, b) (((a) &gt; (b)) ? (a) : (b))
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * the CRC routines are stolen from WAMPES&n; * by Dieter Deyke&n; */
DECL|variable|crc_ccitt_table
r_static
r_const
r_int
r_int
id|crc_ccitt_table
(braket
)braket
op_assign
(brace
l_int|0x0000
comma
l_int|0x1189
comma
l_int|0x2312
comma
l_int|0x329b
comma
l_int|0x4624
comma
l_int|0x57ad
comma
l_int|0x6536
comma
l_int|0x74bf
comma
l_int|0x8c48
comma
l_int|0x9dc1
comma
l_int|0xaf5a
comma
l_int|0xbed3
comma
l_int|0xca6c
comma
l_int|0xdbe5
comma
l_int|0xe97e
comma
l_int|0xf8f7
comma
l_int|0x1081
comma
l_int|0x0108
comma
l_int|0x3393
comma
l_int|0x221a
comma
l_int|0x56a5
comma
l_int|0x472c
comma
l_int|0x75b7
comma
l_int|0x643e
comma
l_int|0x9cc9
comma
l_int|0x8d40
comma
l_int|0xbfdb
comma
l_int|0xae52
comma
l_int|0xdaed
comma
l_int|0xcb64
comma
l_int|0xf9ff
comma
l_int|0xe876
comma
l_int|0x2102
comma
l_int|0x308b
comma
l_int|0x0210
comma
l_int|0x1399
comma
l_int|0x6726
comma
l_int|0x76af
comma
l_int|0x4434
comma
l_int|0x55bd
comma
l_int|0xad4a
comma
l_int|0xbcc3
comma
l_int|0x8e58
comma
l_int|0x9fd1
comma
l_int|0xeb6e
comma
l_int|0xfae7
comma
l_int|0xc87c
comma
l_int|0xd9f5
comma
l_int|0x3183
comma
l_int|0x200a
comma
l_int|0x1291
comma
l_int|0x0318
comma
l_int|0x77a7
comma
l_int|0x662e
comma
l_int|0x54b5
comma
l_int|0x453c
comma
l_int|0xbdcb
comma
l_int|0xac42
comma
l_int|0x9ed9
comma
l_int|0x8f50
comma
l_int|0xfbef
comma
l_int|0xea66
comma
l_int|0xd8fd
comma
l_int|0xc974
comma
l_int|0x4204
comma
l_int|0x538d
comma
l_int|0x6116
comma
l_int|0x709f
comma
l_int|0x0420
comma
l_int|0x15a9
comma
l_int|0x2732
comma
l_int|0x36bb
comma
l_int|0xce4c
comma
l_int|0xdfc5
comma
l_int|0xed5e
comma
l_int|0xfcd7
comma
l_int|0x8868
comma
l_int|0x99e1
comma
l_int|0xab7a
comma
l_int|0xbaf3
comma
l_int|0x5285
comma
l_int|0x430c
comma
l_int|0x7197
comma
l_int|0x601e
comma
l_int|0x14a1
comma
l_int|0x0528
comma
l_int|0x37b3
comma
l_int|0x263a
comma
l_int|0xdecd
comma
l_int|0xcf44
comma
l_int|0xfddf
comma
l_int|0xec56
comma
l_int|0x98e9
comma
l_int|0x8960
comma
l_int|0xbbfb
comma
l_int|0xaa72
comma
l_int|0x6306
comma
l_int|0x728f
comma
l_int|0x4014
comma
l_int|0x519d
comma
l_int|0x2522
comma
l_int|0x34ab
comma
l_int|0x0630
comma
l_int|0x17b9
comma
l_int|0xef4e
comma
l_int|0xfec7
comma
l_int|0xcc5c
comma
l_int|0xddd5
comma
l_int|0xa96a
comma
l_int|0xb8e3
comma
l_int|0x8a78
comma
l_int|0x9bf1
comma
l_int|0x7387
comma
l_int|0x620e
comma
l_int|0x5095
comma
l_int|0x411c
comma
l_int|0x35a3
comma
l_int|0x242a
comma
l_int|0x16b1
comma
l_int|0x0738
comma
l_int|0xffcf
comma
l_int|0xee46
comma
l_int|0xdcdd
comma
l_int|0xcd54
comma
l_int|0xb9eb
comma
l_int|0xa862
comma
l_int|0x9af9
comma
l_int|0x8b70
comma
l_int|0x8408
comma
l_int|0x9581
comma
l_int|0xa71a
comma
l_int|0xb693
comma
l_int|0xc22c
comma
l_int|0xd3a5
comma
l_int|0xe13e
comma
l_int|0xf0b7
comma
l_int|0x0840
comma
l_int|0x19c9
comma
l_int|0x2b52
comma
l_int|0x3adb
comma
l_int|0x4e64
comma
l_int|0x5fed
comma
l_int|0x6d76
comma
l_int|0x7cff
comma
l_int|0x9489
comma
l_int|0x8500
comma
l_int|0xb79b
comma
l_int|0xa612
comma
l_int|0xd2ad
comma
l_int|0xc324
comma
l_int|0xf1bf
comma
l_int|0xe036
comma
l_int|0x18c1
comma
l_int|0x0948
comma
l_int|0x3bd3
comma
l_int|0x2a5a
comma
l_int|0x5ee5
comma
l_int|0x4f6c
comma
l_int|0x7df7
comma
l_int|0x6c7e
comma
l_int|0xa50a
comma
l_int|0xb483
comma
l_int|0x8618
comma
l_int|0x9791
comma
l_int|0xe32e
comma
l_int|0xf2a7
comma
l_int|0xc03c
comma
l_int|0xd1b5
comma
l_int|0x2942
comma
l_int|0x38cb
comma
l_int|0x0a50
comma
l_int|0x1bd9
comma
l_int|0x6f66
comma
l_int|0x7eef
comma
l_int|0x4c74
comma
l_int|0x5dfd
comma
l_int|0xb58b
comma
l_int|0xa402
comma
l_int|0x9699
comma
l_int|0x8710
comma
l_int|0xf3af
comma
l_int|0xe226
comma
l_int|0xd0bd
comma
l_int|0xc134
comma
l_int|0x39c3
comma
l_int|0x284a
comma
l_int|0x1ad1
comma
l_int|0x0b58
comma
l_int|0x7fe7
comma
l_int|0x6e6e
comma
l_int|0x5cf5
comma
l_int|0x4d7c
comma
l_int|0xc60c
comma
l_int|0xd785
comma
l_int|0xe51e
comma
l_int|0xf497
comma
l_int|0x8028
comma
l_int|0x91a1
comma
l_int|0xa33a
comma
l_int|0xb2b3
comma
l_int|0x4a44
comma
l_int|0x5bcd
comma
l_int|0x6956
comma
l_int|0x78df
comma
l_int|0x0c60
comma
l_int|0x1de9
comma
l_int|0x2f72
comma
l_int|0x3efb
comma
l_int|0xd68d
comma
l_int|0xc704
comma
l_int|0xf59f
comma
l_int|0xe416
comma
l_int|0x90a9
comma
l_int|0x8120
comma
l_int|0xb3bb
comma
l_int|0xa232
comma
l_int|0x5ac5
comma
l_int|0x4b4c
comma
l_int|0x79d7
comma
l_int|0x685e
comma
l_int|0x1ce1
comma
l_int|0x0d68
comma
l_int|0x3ff3
comma
l_int|0x2e7a
comma
l_int|0xe70e
comma
l_int|0xf687
comma
l_int|0xc41c
comma
l_int|0xd595
comma
l_int|0xa12a
comma
l_int|0xb0a3
comma
l_int|0x8238
comma
l_int|0x93b1
comma
l_int|0x6b46
comma
l_int|0x7acf
comma
l_int|0x4854
comma
l_int|0x59dd
comma
l_int|0x2d62
comma
l_int|0x3ceb
comma
l_int|0x0e70
comma
l_int|0x1ff9
comma
l_int|0xf78f
comma
l_int|0xe606
comma
l_int|0xd49d
comma
l_int|0xc514
comma
l_int|0xb1ab
comma
l_int|0xa022
comma
l_int|0x92b9
comma
l_int|0x8330
comma
l_int|0x7bc7
comma
l_int|0x6a4e
comma
l_int|0x58d5
comma
l_int|0x495c
comma
l_int|0x3de3
comma
l_int|0x2c6a
comma
l_int|0x1ef1
comma
l_int|0x0f78
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------*/
DECL|function|append_crc_ccitt
r_static
r_inline
r_void
id|append_crc_ccitt
c_func
(paren
r_int
r_char
op_star
id|buffer
comma
r_int
id|len
)paren
(brace
r_int
r_int
id|crc
op_assign
l_int|0xffff
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|len
OG
l_int|0
suffix:semicolon
id|len
op_decrement
)paren
id|crc
op_assign
(paren
id|crc
op_rshift
l_int|8
)paren
op_xor
id|crc_ccitt_table
(braket
(paren
id|crc
op_xor
op_star
id|buffer
op_increment
)paren
op_amp
l_int|0xff
)braket
suffix:semicolon
id|crc
op_xor_assign
l_int|0xffff
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
id|crc
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
id|crc
op_rshift
l_int|8
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------*/
DECL|function|check_crc_ccitt
r_static
r_inline
r_int
id|check_crc_ccitt
c_func
(paren
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|cnt
)paren
(brace
r_int
r_int
id|crc
op_assign
l_int|0xffff
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|cnt
OG
l_int|0
suffix:semicolon
id|cnt
op_decrement
)paren
id|crc
op_assign
(paren
id|crc
op_rshift
l_int|8
)paren
op_xor
id|crc_ccitt_table
(braket
(paren
id|crc
op_xor
op_star
id|buf
op_increment
)paren
op_amp
l_int|0xff
)braket
suffix:semicolon
r_return
(paren
id|crc
op_amp
l_int|0xffff
)paren
op_eq
l_int|0xf0b8
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------*/
macro_line|#if 0
r_static
r_int
id|calc_crc_ccitt
c_func
(paren
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|cnt
)paren
(brace
r_int
r_int
id|crc
op_assign
l_int|0xffff
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|cnt
OG
l_int|0
suffix:semicolon
id|cnt
op_decrement
)paren
id|crc
op_assign
(paren
id|crc
op_rshift
l_int|8
)paren
op_xor
id|crc_ccitt_table
(braket
(paren
id|crc
op_xor
op_star
id|buf
op_increment
)paren
op_amp
l_int|0xff
)braket
suffix:semicolon
id|crc
op_xor_assign
l_int|0xffff
suffix:semicolon
r_return
(paren
id|crc
op_amp
l_int|0xffff
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|macro|tenms_to_2flags
mdefine_line|#define tenms_to_2flags(s,tenms) ((tenms * s-&gt;par.bitrate) / 100 / 16)
multiline_comment|/* ---------------------------------------------------------------------- */
multiline_comment|/*&n; * The HDLC routines&n; */
DECL|function|hdlc_rx_add_bytes
r_static
r_int
id|hdlc_rx_add_bytes
c_func
(paren
r_struct
id|hdlcdrv_state
op_star
id|s
comma
r_int
r_int
id|bits
comma
r_int
id|num
)paren
(brace
r_int
id|added
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;hdlcrx.rx_state
op_logical_and
id|num
op_ge
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;hdlcrx.len
op_ge
r_sizeof
(paren
id|s-&gt;hdlcrx.buffer
)paren
)paren
(brace
id|s-&gt;hdlcrx.rx_state
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|s-&gt;hdlcrx.bp
op_increment
op_assign
id|bits
op_rshift
(paren
l_int|32
op_minus
id|num
)paren
suffix:semicolon
id|s-&gt;hdlcrx.len
op_increment
suffix:semicolon
id|num
op_sub_assign
l_int|8
suffix:semicolon
id|added
op_add_assign
l_int|8
suffix:semicolon
)brace
r_return
id|added
suffix:semicolon
)brace
DECL|function|hdlc_rx_flag
r_static
r_void
id|hdlc_rx_flag
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|hdlcdrv_state
op_star
id|s
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|pkt_len
suffix:semicolon
r_int
r_char
op_star
id|cp
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;hdlcrx.len
OL
l_int|4
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|check_crc_ccitt
c_func
(paren
id|s-&gt;hdlcrx.buffer
comma
id|s-&gt;hdlcrx.len
)paren
)paren
r_return
suffix:semicolon
id|pkt_len
op_assign
id|s-&gt;hdlcrx.len
op_minus
l_int|2
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* KISS kludge */
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: memory squeeze, dropping packet&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|s-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|cp
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
op_star
id|cp
op_increment
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* KISS kludge */
id|memcpy
c_func
(paren
id|cp
comma
id|s-&gt;hdlcrx.buffer
comma
id|pkt_len
op_minus
l_int|1
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_AX25
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|s-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
DECL|function|hdlcdrv_receiver
r_void
id|hdlcdrv_receiver
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|hdlcdrv_state
op_star
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|mask1
comma
id|mask2
comma
id|mask3
comma
id|mask4
comma
id|mask5
comma
id|mask6
comma
id|word
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
op_logical_or
id|s-&gt;magic
op_ne
id|HDLCDRV_MAGIC
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|s-&gt;hdlcrx.in_hdlc_rx
)paren
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|hdlcdrv_hbuf_empty
c_func
(paren
op_amp
id|s-&gt;hdlcrx.hbuf
)paren
)paren
(brace
id|word
op_assign
id|hdlcdrv_hbuf_get
c_func
(paren
op_amp
id|s-&gt;hdlcrx.hbuf
)paren
suffix:semicolon
macro_line|#ifdef HDLCDRV_DEBUG
id|hdlcdrv_add_bitbuffer_word
c_func
(paren
op_amp
id|s-&gt;bitbuf_hdlc
comma
id|word
)paren
suffix:semicolon
macro_line|#endif /* HDLCDRV_DEBUG */
id|s-&gt;hdlcrx.bitstream
op_rshift_assign
l_int|16
suffix:semicolon
id|s-&gt;hdlcrx.bitstream
op_or_assign
id|word
op_lshift
l_int|16
suffix:semicolon
id|s-&gt;hdlcrx.bitbuf
op_rshift_assign
l_int|16
suffix:semicolon
id|s-&gt;hdlcrx.bitbuf
op_or_assign
id|word
op_lshift
l_int|16
suffix:semicolon
id|s-&gt;hdlcrx.numbits
op_add_assign
l_int|16
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|15
comma
id|mask1
op_assign
l_int|0x1fc00
comma
id|mask2
op_assign
l_int|0x1fe00
comma
id|mask3
op_assign
l_int|0x0fc00
comma
id|mask4
op_assign
l_int|0x1f800
comma
id|mask5
op_assign
l_int|0xf800
comma
id|mask6
op_assign
l_int|0xffff
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
comma
id|mask1
op_lshift_assign
l_int|1
comma
id|mask2
op_lshift_assign
l_int|1
comma
id|mask3
op_lshift_assign
l_int|1
comma
id|mask4
op_lshift_assign
l_int|1
comma
id|mask5
op_lshift_assign
l_int|1
comma
id|mask6
op_assign
(paren
id|mask6
op_lshift
l_int|1
)paren
op_or
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|s-&gt;hdlcrx.bitstream
op_amp
id|mask1
)paren
op_eq
id|mask1
)paren
id|s-&gt;hdlcrx.rx_state
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* abort received */
r_else
r_if
c_cond
(paren
(paren
id|s-&gt;hdlcrx.bitstream
op_amp
id|mask2
)paren
op_eq
id|mask3
)paren
(brace
multiline_comment|/* flag received */
r_if
c_cond
(paren
id|s-&gt;hdlcrx.rx_state
)paren
(brace
id|hdlc_rx_add_bytes
c_func
(paren
id|s
comma
id|s-&gt;hdlcrx.bitbuf
op_lshift
(paren
l_int|8
op_plus
id|i
)paren
comma
id|s-&gt;hdlcrx.numbits
op_minus
l_int|8
op_minus
id|i
)paren
suffix:semicolon
id|hdlc_rx_flag
c_func
(paren
id|dev
comma
id|s
)paren
suffix:semicolon
)brace
id|s-&gt;hdlcrx.len
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlcrx.bp
op_assign
id|s-&gt;hdlcrx.buffer
suffix:semicolon
id|s-&gt;hdlcrx.rx_state
op_assign
l_int|1
suffix:semicolon
id|s-&gt;hdlcrx.numbits
op_assign
id|i
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|s-&gt;hdlcrx.bitstream
op_amp
id|mask4
)paren
op_eq
id|mask5
)paren
(brace
multiline_comment|/* stuffed bit */
id|s-&gt;hdlcrx.numbits
op_decrement
suffix:semicolon
id|s-&gt;hdlcrx.bitbuf
op_assign
(paren
id|s-&gt;hdlcrx.bitbuf
op_amp
(paren
op_complement
id|mask6
)paren
)paren
op_or
(paren
(paren
id|s-&gt;hdlcrx.bitbuf
op_amp
id|mask6
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
)brace
id|s-&gt;hdlcrx.numbits
op_sub_assign
id|hdlc_rx_add_bytes
c_func
(paren
id|s
comma
id|s-&gt;hdlcrx.bitbuf
comma
id|s-&gt;hdlcrx.numbits
)paren
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|s-&gt;hdlcrx.in_hdlc_rx
)paren
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|do_kiss_params
r_static
r_inline
r_void
id|do_kiss_params
c_func
(paren
r_struct
id|hdlcdrv_state
op_star
id|s
comma
r_int
r_char
op_star
id|data
comma
r_int
r_int
id|len
)paren
(brace
macro_line|#ifdef KISS_VERBOSE
DECL|macro|PKP
mdefine_line|#define PKP(a,b) printk(KERN_INFO &quot;hdlcdrv.c: channel params: &quot; a &quot;&bslash;n&quot;, b)
macro_line|#else /* KISS_VERBOSE */&t;      
mdefine_line|#define PKP(a,b) 
macro_line|#endif /* KISS_VERBOSE */&t;      
r_if
c_cond
(paren
id|len
OL
l_int|2
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|data
(braket
l_int|0
)braket
)paren
(brace
r_case
id|PARAM_TXDELAY
suffix:colon
id|s-&gt;ch_params.tx_delay
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|PKP
c_func
(paren
l_string|&quot;TX delay = %ums&quot;
comma
l_int|10
op_star
id|s-&gt;ch_params.tx_delay
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PARAM_PERSIST
suffix:colon
id|s-&gt;ch_params.ppersist
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|PKP
c_func
(paren
l_string|&quot;p persistence = %u&quot;
comma
id|s-&gt;ch_params.ppersist
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PARAM_SLOTTIME
suffix:colon
id|s-&gt;ch_params.slottime
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|PKP
c_func
(paren
l_string|&quot;slot time = %ums&quot;
comma
id|s-&gt;ch_params.slottime
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PARAM_TXTAIL
suffix:colon
id|s-&gt;ch_params.tx_tail
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|PKP
c_func
(paren
l_string|&quot;TX tail = %ums&quot;
comma
id|s-&gt;ch_params.tx_tail
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PARAM_FULLDUP
suffix:colon
id|s-&gt;ch_params.fulldup
op_assign
op_logical_neg
op_logical_neg
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|PKP
c_func
(paren
l_string|&quot;%s duplex&quot;
comma
id|s-&gt;ch_params.fulldup
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
DECL|macro|PKP
macro_line|#undef PKP
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|hdlcdrv_transmitter
r_void
id|hdlcdrv_transmitter
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|hdlcdrv_state
op_star
id|s
)paren
(brace
r_int
r_int
id|mask1
comma
id|mask2
comma
id|mask3
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|pkt_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
op_logical_or
id|s-&gt;magic
op_ne
id|HDLCDRV_MAGIC
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|s-&gt;hdlctx.in_hdlc_tx
)paren
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;hdlctx.numbits
op_ge
l_int|16
)paren
(brace
r_if
c_cond
(paren
id|hdlcdrv_hbuf_full
c_func
(paren
op_amp
id|s-&gt;hdlctx.hbuf
)paren
)paren
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|s-&gt;hdlctx.in_hdlc_tx
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|hdlcdrv_hbuf_put
c_func
(paren
op_amp
id|s-&gt;hdlctx.hbuf
comma
id|s-&gt;hdlctx.bitbuf
)paren
suffix:semicolon
id|s-&gt;hdlctx.bitbuf
op_rshift_assign
l_int|16
suffix:semicolon
id|s-&gt;hdlctx.numbits
op_sub_assign
l_int|16
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|s-&gt;hdlctx.tx_state
)paren
(brace
r_default
suffix:colon
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|s-&gt;hdlctx.in_hdlc_tx
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0
suffix:colon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|s-&gt;hdlctx.numflags
)paren
(brace
id|s-&gt;hdlctx.numflags
op_decrement
suffix:semicolon
id|s-&gt;hdlctx.bitbuf
op_or_assign
l_int|0x7e7e
op_lshift
id|s-&gt;hdlctx.numbits
suffix:semicolon
id|s-&gt;hdlctx.numbits
op_add_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;hdlctx.tx_state
op_eq
l_int|1
)paren
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|s-&gt;hdlctx.in_hdlc_tx
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|s-&gt;skb
)paren
)paren
(brace
r_int
id|flgs
op_assign
id|tenms_to_2flags
c_func
(paren
id|s
comma
id|s-&gt;ch_params.tx_tail
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flgs
OL
l_int|2
)paren
id|flgs
op_assign
l_int|2
suffix:semicolon
id|s-&gt;hdlctx.tx_state
op_assign
l_int|1
suffix:semicolon
id|s-&gt;hdlctx.numflags
op_assign
id|flgs
suffix:semicolon
r_break
suffix:semicolon
)brace
id|s-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pkt_len
op_assign
id|skb-&gt;len
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* strip KISS byte */
r_if
c_cond
(paren
id|pkt_len
op_ge
id|HDLCDRV_MAXFLEN
op_logical_or
id|pkt_len
OL
l_int|2
)paren
(brace
id|s-&gt;hdlctx.tx_state
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.numflags
op_assign
l_int|1
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|s-&gt;hdlctx.buffer
comma
id|skb-&gt;data
op_plus
l_int|1
comma
id|pkt_len
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
id|s-&gt;hdlctx.bp
op_assign
id|s-&gt;hdlctx.buffer
suffix:semicolon
id|append_crc_ccitt
c_func
(paren
id|s-&gt;hdlctx.buffer
comma
id|pkt_len
)paren
suffix:semicolon
id|s-&gt;hdlctx.len
op_assign
id|pkt_len
op_plus
l_int|2
suffix:semicolon
multiline_comment|/* the appended CRC */
id|s-&gt;hdlctx.tx_state
op_assign
l_int|2
suffix:semicolon
id|s-&gt;hdlctx.bitstream
op_assign
l_int|0
suffix:semicolon
id|s-&gt;stats.tx_packets
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;hdlctx.len
)paren
(brace
id|s-&gt;hdlctx.tx_state
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.numflags
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|s-&gt;hdlctx.len
op_decrement
suffix:semicolon
id|s-&gt;hdlctx.bitbuf
op_or_assign
op_star
id|s-&gt;hdlctx.bp
op_lshift
id|s-&gt;hdlctx.numbits
suffix:semicolon
id|s-&gt;hdlctx.bitstream
op_rshift_assign
l_int|8
suffix:semicolon
id|s-&gt;hdlctx.bitstream
op_or_assign
(paren
op_star
id|s-&gt;hdlctx.bp
op_increment
)paren
op_lshift
l_int|16
suffix:semicolon
id|mask1
op_assign
l_int|0x1f000
suffix:semicolon
id|mask2
op_assign
l_int|0x10000
suffix:semicolon
id|mask3
op_assign
l_int|0xffffffff
op_rshift
(paren
l_int|31
op_minus
id|s-&gt;hdlctx.numbits
)paren
suffix:semicolon
id|s-&gt;hdlctx.numbits
op_add_assign
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
comma
id|mask1
op_lshift_assign
l_int|1
comma
id|mask2
op_lshift_assign
l_int|1
comma
id|mask3
op_assign
(paren
id|mask3
op_lshift
l_int|1
)paren
op_or
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|s-&gt;hdlctx.bitstream
op_amp
id|mask1
)paren
op_ne
id|mask1
)paren
r_continue
suffix:semicolon
id|s-&gt;hdlctx.bitstream
op_and_assign
op_complement
id|mask2
suffix:semicolon
id|s-&gt;hdlctx.bitbuf
op_assign
(paren
id|s-&gt;hdlctx.bitbuf
op_amp
id|mask3
)paren
op_or
(paren
(paren
id|s-&gt;hdlctx.bitbuf
op_amp
(paren
op_complement
id|mask3
)paren
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|s-&gt;hdlctx.numbits
op_increment
suffix:semicolon
id|mask3
op_assign
(paren
id|mask3
op_lshift
l_int|1
)paren
op_or
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|start_tx
r_static
r_void
id|start_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|hdlcdrv_state
op_star
id|s
)paren
(brace
id|s-&gt;hdlctx.tx_state
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.numflags
op_assign
id|tenms_to_2flags
c_func
(paren
id|s
comma
id|s-&gt;ch_params.tx_delay
)paren
suffix:semicolon
id|s-&gt;hdlctx.bitbuf
op_assign
id|s-&gt;hdlctx.bitstream
op_assign
id|s-&gt;hdlctx.numbits
op_assign
l_int|0
suffix:semicolon
id|hdlcdrv_transmitter
c_func
(paren
id|dev
comma
id|s
)paren
suffix:semicolon
id|s-&gt;hdlctx.ptt
op_assign
l_int|1
suffix:semicolon
id|s-&gt;ptt_keyed
op_increment
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|variable|random_seed
r_static
r_int
r_int
id|random_seed
suffix:semicolon
DECL|function|random_num
r_static
r_inline
r_int
r_int
id|random_num
c_func
(paren
r_void
)paren
(brace
id|random_seed
op_assign
l_int|28629
op_star
id|random_seed
op_plus
l_int|157
suffix:semicolon
r_return
id|random_seed
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|hdlcdrv_arbitrate
r_void
id|hdlcdrv_arbitrate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|hdlcdrv_state
op_star
id|s
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s
op_logical_or
id|s-&gt;magic
op_ne
id|HDLCDRV_MAGIC
op_logical_or
id|s-&gt;hdlctx.ptt
op_logical_or
op_logical_neg
id|s-&gt;skb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;ch_params.fulldup
)paren
(brace
id|start_tx
c_func
(paren
id|dev
comma
id|s
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;hdlcrx.dcd
)paren
(brace
id|s-&gt;hdlctx.slotcnt
op_assign
id|s-&gt;ch_params.slottime
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_decrement
id|s-&gt;hdlctx.slotcnt
)paren
OG
l_int|0
)paren
r_return
suffix:semicolon
id|s-&gt;hdlctx.slotcnt
op_assign
id|s-&gt;ch_params.slottime
suffix:semicolon
r_if
c_cond
(paren
(paren
id|random_num
c_func
(paren
)paren
op_mod
l_int|256
)paren
OG
id|s-&gt;ch_params.ppersist
)paren
r_return
suffix:semicolon
id|start_tx
c_func
(paren
id|dev
comma
id|s
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * ===================== network driver interface =========================&n; */
DECL|function|hdlcdrv_paranoia_check
r_static
r_inline
r_int
id|hdlcdrv_paranoia_check
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_const
r_char
op_star
id|routine
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|dev-&gt;priv
op_logical_or
(paren
(paren
r_struct
id|hdlcdrv_state
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|magic
op_ne
id|HDLCDRV_MAGIC
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;hdlcdrv: bad magic number for hdlcdrv_state &quot;
l_string|&quot;struct in routine %s&bslash;n&quot;
comma
id|routine
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hdlcdrv_send_packet
r_static
r_int
id|hdlcdrv_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|hdlcdrv_state
op_star
id|sm
suffix:semicolon
r_if
c_cond
(paren
id|hdlcdrv_paranoia_check
c_func
(paren
id|dev
comma
l_string|&quot;hdlcdrv_send_packet&quot;
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|sm
op_assign
(paren
r_struct
id|hdlcdrv_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
(brace
id|do_kiss_params
c_func
(paren
id|sm
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sm-&gt;skb
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|sm-&gt;skb
op_assign
id|skb
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hdlcdrv_set_mac_address
r_static
r_int
id|hdlcdrv_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|addr
)paren
(brace
r_struct
id|sockaddr
op_star
id|sa
op_assign
(paren
r_struct
id|sockaddr
op_star
)paren
id|addr
suffix:semicolon
multiline_comment|/* addr is an AX.25 shifted ASCII mac address */
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|sa-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hdlcdrv_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|hdlcdrv_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|hdlcdrv_state
op_star
id|sm
suffix:semicolon
r_if
c_cond
(paren
id|hdlcdrv_paranoia_check
c_func
(paren
id|dev
comma
l_string|&quot;hdlcdrv_get_stats&quot;
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|sm
op_assign
(paren
r_struct
id|hdlcdrv_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* &n;&t; * Get the current statistics.  This may be called with the&n;&t; * card open or closed. &n;&t; */
r_return
op_amp
id|sm-&gt;stats
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * Open/initialize the board. This is called (in the current kernel)&n; * sometime after booting when the &squot;ifconfig&squot; program is run.&n; *&n; * This routine should set everything up anew at each open, even&n; * registers that &quot;should&quot; only need to be set once at boot, so that&n; * there is non-reboot way to recover if something goes wrong.&n; */
DECL|function|hdlcdrv_open
r_static
r_int
id|hdlcdrv_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|hdlcdrv_state
op_star
id|s
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|hdlcdrv_paranoia_check
c_func
(paren
id|dev
comma
l_string|&quot;hdlcdrv_open&quot;
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s
op_assign
(paren
r_struct
id|hdlcdrv_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;ops
op_logical_or
op_logical_neg
id|s-&gt;ops-&gt;open
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/*&n;&t; * initialise some variables&n;&t; */
id|s-&gt;hdlcrx.hbuf.rd
op_assign
id|s-&gt;hdlcrx.hbuf.wr
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlcrx.in_hdlc_rx
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlcrx.rx_state
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.hbuf.rd
op_assign
id|s-&gt;hdlctx.hbuf.wr
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.in_hdlc_tx
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.tx_state
op_assign
l_int|1
suffix:semicolon
id|s-&gt;hdlctx.numflags
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.bitstream
op_assign
id|s-&gt;hdlctx.bitbuf
op_assign
id|s-&gt;hdlctx.numbits
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.ptt
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.slotcnt
op_assign
id|s-&gt;ch_params.slottime
suffix:semicolon
id|s-&gt;hdlctx.calibrate
op_assign
l_int|0
suffix:semicolon
id|i
op_assign
id|s-&gt;ops
op_member_access_from_pointer
id|open
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/* &n; * The inverse routine to hdlcdrv_open(). &n; */
DECL|function|hdlcdrv_close
r_static
r_int
id|hdlcdrv_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|hdlcdrv_state
op_star
id|s
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hdlcdrv_paranoia_check
c_func
(paren
id|dev
comma
l_string|&quot;hdlcdrv_close&quot;
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s
op_assign
(paren
r_struct
id|hdlcdrv_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;ops
op_logical_and
id|s-&gt;ops-&gt;close
)paren
id|i
op_assign
id|s-&gt;ops
op_member_access_from_pointer
id|close
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;skb
)paren
id|dev_kfree_skb
c_func
(paren
id|s-&gt;skb
)paren
suffix:semicolon
id|s-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hdlcdrv_ioctl
r_static
r_int
id|hdlcdrv_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_struct
id|hdlcdrv_state
op_star
id|s
suffix:semicolon
r_struct
id|hdlcdrv_ioctl
id|bi
suffix:semicolon
r_if
c_cond
(paren
id|hdlcdrv_paranoia_check
c_func
(paren
id|dev
comma
l_string|&quot;hdlcdrv_ioctl&quot;
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s
op_assign
(paren
r_struct
id|hdlcdrv_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_ne
id|SIOCDEVPRIVATE
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;ops
op_logical_and
id|s-&gt;ops-&gt;ioctl
)paren
r_return
id|s-&gt;ops
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|dev
comma
id|ifr
comma
op_amp
id|bi
comma
id|cmd
)paren
suffix:semicolon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|bi
comma
id|ifr-&gt;ifr_data
comma
r_sizeof
(paren
id|bi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|bi.cmd
)paren
(brace
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|s-&gt;ops
op_logical_and
id|s-&gt;ops-&gt;ioctl
)paren
r_return
id|s-&gt;ops
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|dev
comma
id|ifr
comma
op_amp
id|bi
comma
id|cmd
)paren
suffix:semicolon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
r_case
id|HDLCDRVCTL_GETCHANNELPAR
suffix:colon
id|bi.data.cp.tx_delay
op_assign
id|s-&gt;ch_params.tx_delay
suffix:semicolon
id|bi.data.cp.tx_tail
op_assign
id|s-&gt;ch_params.tx_tail
suffix:semicolon
id|bi.data.cp.slottime
op_assign
id|s-&gt;ch_params.slottime
suffix:semicolon
id|bi.data.cp.ppersist
op_assign
id|s-&gt;ch_params.ppersist
suffix:semicolon
id|bi.data.cp.fulldup
op_assign
id|s-&gt;ch_params.fulldup
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HDLCDRVCTL_SETCHANNELPAR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
id|s-&gt;ch_params.tx_delay
op_assign
id|bi.data.cp.tx_delay
suffix:semicolon
id|s-&gt;ch_params.tx_tail
op_assign
id|bi.data.cp.tx_tail
suffix:semicolon
id|s-&gt;ch_params.slottime
op_assign
id|bi.data.cp.slottime
suffix:semicolon
id|s-&gt;ch_params.ppersist
op_assign
id|bi.data.cp.ppersist
suffix:semicolon
id|s-&gt;ch_params.fulldup
op_assign
id|bi.data.cp.fulldup
suffix:semicolon
id|s-&gt;hdlctx.slotcnt
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HDLCDRVCTL_GETMODEMPAR
suffix:colon
id|bi.data.mp.iobase
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|bi.data.mp.irq
op_assign
id|dev-&gt;irq
suffix:semicolon
id|bi.data.mp.dma
op_assign
id|dev-&gt;dma
suffix:semicolon
id|bi.data.mp.dma2
op_assign
id|s-&gt;ptt_out.dma2
suffix:semicolon
id|bi.data.mp.seriobase
op_assign
id|s-&gt;ptt_out.seriobase
suffix:semicolon
id|bi.data.mp.pariobase
op_assign
id|s-&gt;ptt_out.pariobase
suffix:semicolon
id|bi.data.mp.midiiobase
op_assign
id|s-&gt;ptt_out.midiiobase
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HDLCDRVCTL_SETMODEMPAR
suffix:colon
r_if
c_cond
(paren
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
op_logical_or
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|bi.data.mp.iobase
suffix:semicolon
id|dev-&gt;irq
op_assign
id|bi.data.mp.irq
suffix:semicolon
id|dev-&gt;dma
op_assign
id|bi.data.mp.dma
suffix:semicolon
id|s-&gt;ptt_out.dma2
op_assign
id|bi.data.mp.dma2
suffix:semicolon
id|s-&gt;ptt_out.seriobase
op_assign
id|bi.data.mp.seriobase
suffix:semicolon
id|s-&gt;ptt_out.pariobase
op_assign
id|bi.data.mp.pariobase
suffix:semicolon
id|s-&gt;ptt_out.midiiobase
op_assign
id|bi.data.mp.midiiobase
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HDLCDRVCTL_GETSTAT
suffix:colon
id|bi.data.cs.ptt
op_assign
id|hdlcdrv_ptt
c_func
(paren
id|s
)paren
suffix:semicolon
id|bi.data.cs.dcd
op_assign
id|s-&gt;hdlcrx.dcd
suffix:semicolon
id|bi.data.cs.ptt_keyed
op_assign
id|s-&gt;ptt_keyed
suffix:semicolon
id|bi.data.cs.tx_packets
op_assign
id|s-&gt;stats.tx_packets
suffix:semicolon
id|bi.data.cs.tx_errors
op_assign
id|s-&gt;stats.tx_errors
suffix:semicolon
id|bi.data.cs.rx_packets
op_assign
id|s-&gt;stats.rx_packets
suffix:semicolon
id|bi.data.cs.rx_errors
op_assign
id|s-&gt;stats.rx_errors
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HDLCDRVCTL_OLDGETSTAT
suffix:colon
id|bi.data.ocs.ptt
op_assign
id|hdlcdrv_ptt
c_func
(paren
id|s
)paren
suffix:semicolon
id|bi.data.ocs.dcd
op_assign
id|s-&gt;hdlcrx.dcd
suffix:semicolon
id|bi.data.ocs.ptt_keyed
op_assign
id|s-&gt;ptt_keyed
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HDLCDRVCTL_CALIBRATE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|s-&gt;hdlctx.calibrate
op_assign
id|bi.data.calibrate
op_star
id|s-&gt;par.bitrate
op_div
l_int|16
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HDLCDRVCTL_GETSAMPLES
suffix:colon
macro_line|#ifndef HDLCDRV_DEBUG
r_return
op_minus
id|EPERM
suffix:semicolon
macro_line|#else /* HDLCDRV_DEBUG */
r_if
c_cond
(paren
id|s-&gt;bitbuf_channel.rd
op_eq
id|s-&gt;bitbuf_channel.wr
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|bi.data.bits
op_assign
id|s-&gt;bitbuf_channel.buffer
(braket
id|s-&gt;bitbuf_channel.rd
)braket
suffix:semicolon
id|s-&gt;bitbuf_channel.rd
op_assign
(paren
id|s-&gt;bitbuf_channel.rd
op_plus
l_int|1
)paren
op_mod
r_sizeof
(paren
id|s-&gt;bitbuf_channel.buffer
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* HDLCDRV_DEBUG */
r_case
id|HDLCDRVCTL_GETBITS
suffix:colon
macro_line|#ifndef HDLCDRV_DEBUG
r_return
op_minus
id|EPERM
suffix:semicolon
macro_line|#else /* HDLCDRV_DEBUG */
r_if
c_cond
(paren
id|s-&gt;bitbuf_hdlc.rd
op_eq
id|s-&gt;bitbuf_hdlc.wr
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|bi.data.bits
op_assign
id|s-&gt;bitbuf_hdlc.buffer
(braket
id|s-&gt;bitbuf_hdlc.rd
)braket
suffix:semicolon
id|s-&gt;bitbuf_hdlc.rd
op_assign
(paren
id|s-&gt;bitbuf_hdlc.rd
op_plus
l_int|1
)paren
op_mod
r_sizeof
(paren
id|s-&gt;bitbuf_hdlc.buffer
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* HDLCDRV_DEBUG */
r_case
id|HDLCDRVCTL_DRIVERNAME
suffix:colon
r_if
c_cond
(paren
id|s-&gt;ops
op_logical_and
id|s-&gt;ops-&gt;drvname
)paren
(brace
id|strncpy
c_func
(paren
id|bi.data.drivername
comma
id|s-&gt;ops-&gt;drvname
comma
r_sizeof
(paren
id|bi.data.drivername
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|bi.data.drivername
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_data
comma
op_amp
id|bi
comma
r_sizeof
(paren
id|bi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * Check for a network adaptor of this type, and return &squot;0&squot; if one exists.&n; * If dev-&gt;base_addr == 0, probe all likely locations.&n; * If dev-&gt;base_addr == 1, always return failure.&n; * If dev-&gt;base_addr == 2, allocate space for the device and return success&n; * (detachable devices only).&n; */
DECL|function|hdlcdrv_probe
r_static
r_int
id|hdlcdrv_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_const
r_struct
id|hdlcdrv_channel_params
id|dflt_ch_params
op_assign
(brace
l_int|20
comma
l_int|2
comma
l_int|10
comma
l_int|40
comma
l_int|0
)brace
suffix:semicolon
r_struct
id|hdlcdrv_state
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
multiline_comment|/*&n;&t; * not a real probe! only initialize data structures&n;&t; */
id|s
op_assign
(paren
r_struct
id|hdlcdrv_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/*&n;&t; * initialize the hdlcdrv_state struct&n;&t; */
id|s-&gt;ch_params
op_assign
id|dflt_ch_params
suffix:semicolon
id|s-&gt;ptt_keyed
op_assign
l_int|0
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|s-&gt;hdlcrx.hbuf.lock
)paren
suffix:semicolon
id|s-&gt;hdlcrx.hbuf.rd
op_assign
id|s-&gt;hdlcrx.hbuf.wr
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlcrx.in_hdlc_rx
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlcrx.rx_state
op_assign
l_int|0
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|s-&gt;hdlctx.hbuf.lock
)paren
suffix:semicolon
id|s-&gt;hdlctx.hbuf.rd
op_assign
id|s-&gt;hdlctx.hbuf.wr
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.in_hdlc_tx
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.tx_state
op_assign
l_int|1
suffix:semicolon
id|s-&gt;hdlctx.numflags
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.bitstream
op_assign
id|s-&gt;hdlctx.bitbuf
op_assign
id|s-&gt;hdlctx.numbits
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.ptt
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hdlctx.slotcnt
op_assign
id|s-&gt;ch_params.slottime
suffix:semicolon
id|s-&gt;hdlctx.calibrate
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef HDLCDRV_DEBUG
id|s-&gt;bitbuf_channel.rd
op_assign
id|s-&gt;bitbuf_channel.wr
op_assign
l_int|0
suffix:semicolon
id|s-&gt;bitbuf_channel.shreg
op_assign
l_int|0x80
suffix:semicolon
id|s-&gt;bitbuf_hdlc.rd
op_assign
id|s-&gt;bitbuf_hdlc.wr
op_assign
l_int|0
suffix:semicolon
id|s-&gt;bitbuf_hdlc.shreg
op_assign
l_int|0x80
suffix:semicolon
macro_line|#endif /* HDLCDRV_DEBUG */
multiline_comment|/*&n;&t; * initialize the device struct&n;&t; */
id|dev-&gt;open
op_assign
id|hdlcdrv_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|hdlcdrv_close
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|hdlcdrv_ioctl
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|hdlcdrv_send_packet
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|hdlcdrv_get_stats
suffix:semicolon
multiline_comment|/* Fill in the fields of the device structure */
id|dev_init_buffers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|s-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
macro_line|#if defined(CONFIG_AX25) || defined(CONFIG_AX25_MODULE)
id|dev-&gt;hard_header
op_assign
id|ax25_encapsulate
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
id|ax25_rebuild_header
suffix:semicolon
macro_line|#else /* CONFIG_AX25 || CONFIG_AX25_MODULE */
id|dev-&gt;hard_header
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_AX25 || CONFIG_AX25_MODULE */
id|dev-&gt;set_mac_address
op_assign
id|hdlcdrv_set_mac_address
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_AX25
suffix:semicolon
multiline_comment|/* AF_AX25 device */
id|dev-&gt;hard_header_len
op_assign
id|AX25_MAX_HEADER_LEN
op_plus
id|AX25_BPQ_HEADER_LEN
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|AX25_DEF_PACLEN
suffix:semicolon
multiline_comment|/* eth_mtu is the default */
id|dev-&gt;addr_len
op_assign
id|AX25_ADDR_LEN
suffix:semicolon
multiline_comment|/* sizeof an ax.25 address */
id|memcpy
c_func
(paren
id|dev-&gt;broadcast
comma
id|ax25_bcast
comma
id|AX25_ADDR_LEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|ax25_nocall
comma
id|AX25_ADDR_LEN
)paren
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
l_int|16
suffix:semicolon
multiline_comment|/* New style flags */
id|dev-&gt;flags
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hdlcdrv_register_hdlcdrv
r_int
id|hdlcdrv_register_hdlcdrv
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_const
r_struct
id|hdlcdrv_ops
op_star
id|ops
comma
r_int
r_int
id|privsize
comma
r_char
op_star
id|ifname
comma
r_int
r_int
id|baseaddr
comma
r_int
r_int
id|irq
comma
r_int
r_int
id|dma
)paren
(brace
r_struct
id|hdlcdrv_state
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|ops
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|privsize
OL
r_sizeof
(paren
r_struct
id|hdlcdrv_state
)paren
)paren
id|privsize
op_assign
r_sizeof
(paren
r_struct
id|hdlcdrv_state
)paren
suffix:semicolon
id|memset
c_func
(paren
id|dev
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_device
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s
op_assign
id|dev-&gt;priv
op_assign
id|kmalloc
c_func
(paren
id|privsize
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/*&n;&t; * initialize part of the hdlcdrv_state struct&n;&t; */
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
id|privsize
)paren
suffix:semicolon
id|s-&gt;magic
op_assign
id|HDLCDRV_MAGIC
suffix:semicolon
id|strncpy
c_func
(paren
id|dev-&gt;name
comma
id|ifname
comma
r_sizeof
(paren
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|s-&gt;ops
op_assign
id|ops
suffix:semicolon
multiline_comment|/*&n;&t; * initialize part of the device struct&n;&t; */
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;init
op_assign
id|hdlcdrv_probe
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|baseaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;dma
op_assign
id|dma
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;hdlcdrv: cannot register net &quot;
l_string|&quot;device %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hdlcdrv_unregister_hdlcdrv
r_int
id|hdlcdrv_unregister_hdlcdrv
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|hdlcdrv_state
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s
op_assign
(paren
r_struct
id|hdlcdrv_state
op_star
)paren
id|dev-&gt;priv
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;magic
op_ne
id|HDLCDRV_MAGIC
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;ops-&gt;close
)paren
id|s-&gt;ops
op_member_access_from_pointer
id|close
c_func
(paren
id|dev
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|hdlcdrv_receiver
id|EXPORT_SYMBOL
c_func
(paren
id|hdlcdrv_receiver
)paren
suffix:semicolon
DECL|variable|hdlcdrv_transmitter
id|EXPORT_SYMBOL
c_func
(paren
id|hdlcdrv_transmitter
)paren
suffix:semicolon
DECL|variable|hdlcdrv_arbitrate
id|EXPORT_SYMBOL
c_func
(paren
id|hdlcdrv_arbitrate
)paren
suffix:semicolon
DECL|variable|hdlcdrv_register_hdlcdrv
id|EXPORT_SYMBOL
c_func
(paren
id|hdlcdrv_register_hdlcdrv
)paren
suffix:semicolon
DECL|variable|hdlcdrv_unregister_hdlcdrv
id|EXPORT_SYMBOL
c_func
(paren
id|hdlcdrv_unregister_hdlcdrv
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hdlcdrv_init_driver
r_static
r_int
id|__init
id|hdlcdrv_init_driver
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;hdlcdrv: (C) 1996-2000 Thomas Sailer HB9JNX/AE4WA&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;hdlcdrv: version 0.8 compiled &quot;
id|__TIME__
l_string|&quot; &quot;
id|__DATE__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|hdlcdrv_cleanup_driver
r_static
r_void
id|__exit
id|hdlcdrv_cleanup_driver
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;hdlcdrv: cleanup&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Thomas M. Sailer, sailer@ife.ee.ethz.ch, hb9jnx@hb9w.che.eu&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Packet Radio network interface HDLC encoder/decoder&quot;
)paren
suffix:semicolon
DECL|variable|hdlcdrv_init_driver
id|module_init
c_func
(paren
id|hdlcdrv_init_driver
)paren
suffix:semicolon
DECL|variable|hdlcdrv_cleanup_driver
id|module_exit
c_func
(paren
id|hdlcdrv_cleanup_driver
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
eof
