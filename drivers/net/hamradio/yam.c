multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *    yam.c  -- YAM radio modem driver.&n; *&n; *      Copyright (C) 1998 Frederic Rible F1OAT (frible@teaser.fr)&n; *      Adapted from baycom.c driver written by Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *&n; *      This program is free software; you can redistribute it and/or modify&n; *      it under the terms of the GNU General Public License as published by&n; *      the Free Software Foundation; either version 2 of the License, or&n; *      (at your option) any later version.&n; *&n; *      This program is distributed in the hope that it will be useful,&n; *      but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *      GNU General Public License for more details.&n; *&n; *      You should have received a copy of the GNU General Public License&n; *      along with this program; if not, write to the Free Software&n; *      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *  Please note that the GPL allows you to use the driver, NOT the radio.&n; *  In order to use the radio, you need a license from the communications&n; *  authority of your country.&n; *&n; *&n; *  History:&n; *   0.0 F1OAT 06.06.98  Begin of work with baycom.c source code V 0.3&n; *   0.1 F1OAT 07.06.98  Add timer polling routine for channel arbitration&n; *   0.2 F6FBB 08.06.98  Added delay after FPGA programming&n; *   0.3 F6FBB 29.07.98  Delayed PTT implementation for dupmode=2&n; *   0.4 F6FBB 30.07.98  Added TxTail, Slottime and Persistance&n; *   0.5 F6FBB 01.08.98  Shared IRQs, /proc/net and network statistics&n; *   0.6 F6FBB 25.08.98  Added 1200Bds format&n; *   0.7 F6FBB 12.09.98  Added to the kernel configuration&n; *   0.8 F6FBB 14.10.98  Fixed slottime/persistance timing bug&n; */
multiline_comment|/*****************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/if.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#if defined(CONFIG_AX25) || defined(CONFIG_AX25_MODULE)
multiline_comment|/* prototypes for ax25_encapsulate and ax25_rebuild_header */
macro_line|#include &lt;net/ax25.h&gt;
macro_line|#endif&t;/* CONFIG_AX25 || CONFIG_AX25_MODULE */
multiline_comment|/* make genksyms happy */
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/udp.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/yam.h&gt;
macro_line|#include &quot;yam9600.h&quot;
macro_line|#include &quot;yam1200.h&quot;
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|yam_drvname
r_static
r_const
r_char
id|yam_drvname
(braket
)braket
op_assign
l_string|&quot;yam&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|yam_drvinfo
(braket
)braket
id|__initdata
op_assign
id|KERN_INFO
l_string|&quot;YAM driver version 0.8 by F1OAT/F6FBB&bslash;n&quot;
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|YAM_9600
mdefine_line|#define YAM_9600&t;1
DECL|macro|YAM_1200
mdefine_line|#define YAM_1200&t;2
DECL|macro|NR_PORTS
mdefine_line|#define NR_PORTS&t;4
DECL|macro|YAM_MAGIC
mdefine_line|#define YAM_MAGIC&t;0xF10A7654
multiline_comment|/* Transmitter states */
DECL|macro|TX_OFF
mdefine_line|#define TX_OFF&t;&t;0
DECL|macro|TX_HEAD
mdefine_line|#define TX_HEAD&t;&t;1
DECL|macro|TX_DATA
mdefine_line|#define TX_DATA&t;&t;2
DECL|macro|TX_CRC1
mdefine_line|#define TX_CRC1&t;&t;3
DECL|macro|TX_CRC2
mdefine_line|#define TX_CRC2&t;&t;4
DECL|macro|TX_TAIL
mdefine_line|#define TX_TAIL&t;&t;5
DECL|macro|YAM_MAX_FRAME
mdefine_line|#define YAM_MAX_FRAME&t;1024
DECL|macro|DEFAULT_BITRATE
mdefine_line|#define DEFAULT_BITRATE&t;9600&t;&t;&t;/* bps */
DECL|macro|DEFAULT_HOLDD
mdefine_line|#define DEFAULT_HOLDD&t;10&t;&t;&t;/* sec */
DECL|macro|DEFAULT_TXD
mdefine_line|#define DEFAULT_TXD&t;300&t;&t;&t;/* ms */
DECL|macro|DEFAULT_TXTAIL
mdefine_line|#define DEFAULT_TXTAIL&t;10&t;&t;&t;/* ms */
DECL|macro|DEFAULT_SLOT
mdefine_line|#define DEFAULT_SLOT&t;100&t;&t;&t;/* ms */
DECL|macro|DEFAULT_PERS
mdefine_line|#define DEFAULT_PERS&t;64&t;&t;&t;/* 0-&gt;255 */
DECL|struct|yam_port
r_struct
id|yam_port
(brace
DECL|member|magic
r_int
id|magic
suffix:semicolon
DECL|member|bitrate
r_int
id|bitrate
suffix:semicolon
DECL|member|baudrate
r_int
id|baudrate
suffix:semicolon
DECL|member|iobase
r_int
id|iobase
suffix:semicolon
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|dupmode
r_int
id|dupmode
suffix:semicolon
DECL|member|dev
r_struct
id|net_device
id|dev
suffix:semicolon
multiline_comment|/* Stats section */
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|nb_rxint
r_int
id|nb_rxint
suffix:semicolon
DECL|member|nb_mdint
r_int
id|nb_mdint
suffix:semicolon
multiline_comment|/* Parameters section */
DECL|member|txd
r_int
id|txd
suffix:semicolon
multiline_comment|/* tx delay */
DECL|member|holdd
r_int
id|holdd
suffix:semicolon
multiline_comment|/* duplex ptt delay */
DECL|member|txtail
r_int
id|txtail
suffix:semicolon
multiline_comment|/* txtail delay */
DECL|member|slot
r_int
id|slot
suffix:semicolon
multiline_comment|/* slottime */
DECL|member|pers
r_int
id|pers
suffix:semicolon
multiline_comment|/* persistence */
multiline_comment|/* Tx section */
DECL|member|tx_state
r_int
id|tx_state
suffix:semicolon
DECL|member|tx_count
r_int
id|tx_count
suffix:semicolon
DECL|member|slotcnt
r_int
id|slotcnt
suffix:semicolon
DECL|member|tx_buf
r_int
r_char
id|tx_buf
(braket
id|YAM_MAX_FRAME
)braket
suffix:semicolon
DECL|member|tx_len
r_int
id|tx_len
suffix:semicolon
DECL|member|tx_crcl
DECL|member|tx_crch
r_int
id|tx_crcl
comma
id|tx_crch
suffix:semicolon
DECL|member|send_queue
r_struct
id|sk_buff_head
id|send_queue
suffix:semicolon
multiline_comment|/* Packets awaiting transmission */
multiline_comment|/* Rx section */
DECL|member|dcd
r_int
id|dcd
suffix:semicolon
DECL|member|rx_buf
r_int
r_char
id|rx_buf
(braket
id|YAM_MAX_FRAME
)braket
suffix:semicolon
DECL|member|rx_len
r_int
id|rx_len
suffix:semicolon
DECL|member|rx_crcl
DECL|member|rx_crch
r_int
id|rx_crcl
comma
id|rx_crch
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|yam_mcs
r_struct
id|yam_mcs
(brace
DECL|member|bits
r_int
r_char
id|bits
(braket
id|YAM_FPGA_SIZE
)braket
suffix:semicolon
DECL|member|bitrate
r_int
id|bitrate
suffix:semicolon
DECL|member|next
r_struct
id|yam_mcs
op_star
id|next
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|yam_ports
r_static
r_struct
id|yam_port
id|yam_ports
(braket
id|NR_PORTS
)braket
suffix:semicolon
DECL|variable|yam_data
r_static
r_struct
id|yam_mcs
op_star
id|yam_data
suffix:semicolon
DECL|variable|ax25_bcast
r_static
r_char
id|ax25_bcast
(braket
l_int|7
)braket
op_assign
(brace
l_char|&squot;Q&squot;
op_lshift
l_int|1
comma
l_char|&squot;S&squot;
op_lshift
l_int|1
comma
l_char|&squot;T&squot;
op_lshift
l_int|1
comma
l_char|&squot; &squot;
op_lshift
l_int|1
comma
l_char|&squot; &squot;
op_lshift
l_int|1
comma
l_char|&squot; &squot;
op_lshift
l_int|1
comma
l_char|&squot;0&squot;
op_lshift
l_int|1
)brace
suffix:semicolon
DECL|variable|ax25_test
r_static
r_char
id|ax25_test
(braket
l_int|7
)braket
op_assign
(brace
l_char|&squot;L&squot;
op_lshift
l_int|1
comma
l_char|&squot;I&squot;
op_lshift
l_int|1
comma
l_char|&squot;N&squot;
op_lshift
l_int|1
comma
l_char|&squot;U&squot;
op_lshift
l_int|1
comma
l_char|&squot;X&squot;
op_lshift
l_int|1
comma
l_char|&squot; &squot;
op_lshift
l_int|1
comma
l_char|&squot;1&squot;
op_lshift
l_int|1
)brace
suffix:semicolon
DECL|variable|yam_timer
r_static
r_struct
id|timer_list
id|yam_timer
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|RBR
mdefine_line|#define RBR(iobase)&t;(iobase+0)
DECL|macro|THR
mdefine_line|#define THR(iobase)&t;(iobase+0)
DECL|macro|IER
mdefine_line|#define IER(iobase)&t;(iobase+1)
DECL|macro|IIR
mdefine_line|#define IIR(iobase)&t;(iobase+2)
DECL|macro|FCR
mdefine_line|#define FCR(iobase)&t;(iobase+2)
DECL|macro|LCR
mdefine_line|#define LCR(iobase)&t;(iobase+3)
DECL|macro|MCR
mdefine_line|#define MCR(iobase)&t;(iobase+4)
DECL|macro|LSR
mdefine_line|#define LSR(iobase)&t;(iobase+5)
DECL|macro|MSR
mdefine_line|#define MSR(iobase)&t;(iobase+6)
DECL|macro|SCR
mdefine_line|#define SCR(iobase)&t;(iobase+7)
DECL|macro|DLL
mdefine_line|#define DLL(iobase)&t;(iobase+0)
DECL|macro|DLM
mdefine_line|#define DLM(iobase)&t;(iobase+1)
DECL|macro|YAM_EXTENT
mdefine_line|#define YAM_EXTENT&t;8
multiline_comment|/* Interrupt Identification Register Bit Masks */
DECL|macro|IIR_NOPEND
mdefine_line|#define IIR_NOPEND&t;1
DECL|macro|IIR_MSR
mdefine_line|#define IIR_MSR&t;&t;0
DECL|macro|IIR_TX
mdefine_line|#define IIR_TX&t;&t;2
DECL|macro|IIR_RX
mdefine_line|#define IIR_RX&t;&t;4
DECL|macro|IIR_LSR
mdefine_line|#define IIR_LSR&t;&t;6
DECL|macro|IIR_TIMEOUT
mdefine_line|#define IIR_TIMEOUT&t;12&t;&t;&t;/* Fifo mode only */
DECL|macro|IIR_MASK
mdefine_line|#define IIR_MASK&t;0x0F
multiline_comment|/* Interrupt Enable Register Bit Masks */
DECL|macro|IER_RX
mdefine_line|#define IER_RX&t;&t;1&t;&t;&t;/* enable rx interrupt */
DECL|macro|IER_TX
mdefine_line|#define IER_TX&t;&t;2&t;&t;&t;/* enable tx interrupt */
DECL|macro|IER_LSR
mdefine_line|#define IER_LSR&t;&t;4&t;&t;&t;/* enable line status interrupts */
DECL|macro|IER_MSR
mdefine_line|#define IER_MSR&t;&t;8&t;&t;&t;/* enable modem status interrupts */
multiline_comment|/* Modem Control Register Bit Masks */
DECL|macro|MCR_DTR
mdefine_line|#define MCR_DTR&t;&t;0x01&t;&t;&t;/* DTR output */
DECL|macro|MCR_RTS
mdefine_line|#define MCR_RTS&t;&t;0x02&t;&t;&t;/* RTS output */
DECL|macro|MCR_OUT1
mdefine_line|#define MCR_OUT1&t;0x04&t;&t;&t;/* OUT1 output (not accessible in RS232) */
DECL|macro|MCR_OUT2
mdefine_line|#define MCR_OUT2&t;0x08&t;&t;&t;/* Master Interrupt enable (must be set on PCs) */
DECL|macro|MCR_LOOP
mdefine_line|#define MCR_LOOP&t;0x10&t;&t;&t;/* Loopback enable */
multiline_comment|/* Modem Status Register Bit Masks */
DECL|macro|MSR_DCTS
mdefine_line|#define MSR_DCTS&t;0x01&t;&t;&t;/* Delta CTS input */
DECL|macro|MSR_DDSR
mdefine_line|#define MSR_DDSR&t;0x02&t;&t;&t;/* Delta DSR */
DECL|macro|MSR_DRIN
mdefine_line|#define MSR_DRIN&t;0x04&t;&t;&t;/* Delta RI */
DECL|macro|MSR_DDCD
mdefine_line|#define MSR_DDCD&t;0x08&t;&t;&t;/* Delta DCD */
DECL|macro|MSR_CTS
mdefine_line|#define MSR_CTS&t;&t;0x10&t;&t;&t;/* CTS input */
DECL|macro|MSR_DSR
mdefine_line|#define MSR_DSR&t;&t;0x20&t;&t;&t;/* DSR input */
DECL|macro|MSR_RING
mdefine_line|#define MSR_RING&t;0x40&t;&t;&t;/* RI  input */
DECL|macro|MSR_DCD
mdefine_line|#define MSR_DCD&t;&t;0x80&t;&t;&t;/* DCD input */
multiline_comment|/* line status register bit mask */
DECL|macro|LSR_RXC
mdefine_line|#define LSR_RXC&t;&t;0x01
DECL|macro|LSR_OE
mdefine_line|#define LSR_OE&t;&t;0x02
DECL|macro|LSR_PE
mdefine_line|#define LSR_PE&t;&t;0x04
DECL|macro|LSR_FE
mdefine_line|#define LSR_FE&t;&t;0x08
DECL|macro|LSR_BREAK
mdefine_line|#define LSR_BREAK&t;0x10
DECL|macro|LSR_THRE
mdefine_line|#define LSR_THRE&t;0x20
DECL|macro|LSR_TSRE
mdefine_line|#define LSR_TSRE&t;0x40
multiline_comment|/* Line Control Register Bit Masks */
DECL|macro|LCR_DLAB
mdefine_line|#define LCR_DLAB&t;0x80
DECL|macro|LCR_BREAK
mdefine_line|#define LCR_BREAK&t;0x40
DECL|macro|LCR_PZERO
mdefine_line|#define LCR_PZERO&t;0x28
DECL|macro|LCR_PEVEN
mdefine_line|#define LCR_PEVEN&t;0x18
DECL|macro|LCR_PODD
mdefine_line|#define LCR_PODD&t;0x08
DECL|macro|LCR_STOP1
mdefine_line|#define LCR_STOP1&t;0x00
DECL|macro|LCR_STOP2
mdefine_line|#define LCR_STOP2&t;0x04
DECL|macro|LCR_BIT5
mdefine_line|#define LCR_BIT5&t;0x00
DECL|macro|LCR_BIT6
mdefine_line|#define LCR_BIT6&t;0x02
DECL|macro|LCR_BIT7
mdefine_line|#define LCR_BIT7&t;0x01
DECL|macro|LCR_BIT8
mdefine_line|#define LCR_BIT8&t;0x03
multiline_comment|/* YAM Modem &lt;-&gt; UART Port mapping */
DECL|macro|TX_RDY
mdefine_line|#define TX_RDY&t;&t;MSR_DCTS&t;&t;/* transmitter ready to send */
DECL|macro|RX_DCD
mdefine_line|#define RX_DCD&t;&t;MSR_DCD&t;&t;&t;/* carrier detect */
DECL|macro|RX_FLAG
mdefine_line|#define RX_FLAG&t;&t;MSR_RING&t;&t;/* hdlc flag received */
DECL|macro|FPGA_DONE
mdefine_line|#define FPGA_DONE&t;MSR_DSR&t;&t;&t;/* FPGA is configured */
DECL|macro|PTT_ON
mdefine_line|#define PTT_ON&t;&t;(MCR_RTS|MCR_OUT2)&t;/* activate PTT */
DECL|macro|PTT_OFF
mdefine_line|#define PTT_OFF&t;&t;(MCR_DTR|MCR_OUT2)&t;/* release PTT */
DECL|macro|ENABLE_RXINT
mdefine_line|#define ENABLE_RXINT&t;IER_RX&t;&t;&t;/* enable uart rx interrupt during rx */
DECL|macro|ENABLE_TXINT
mdefine_line|#define ENABLE_TXINT&t;IER_MSR&t;&t;&t;/* enable uart ms interrupt during tx */
DECL|macro|ENABLE_RTXINT
mdefine_line|#define ENABLE_RTXINT&t;(IER_RX|IER_MSR)&t;/* full duplex operations */
multiline_comment|/*************************************************************************&n;* CRC Tables&n;************************************************************************/
DECL|variable|chktabl
r_static
r_const
r_int
r_char
id|chktabl
(braket
l_int|256
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x89
comma
l_int|0x12
comma
l_int|0x9b
comma
l_int|0x24
comma
l_int|0xad
comma
l_int|0x36
comma
l_int|0xbf
comma
l_int|0x48
comma
l_int|0xc1
comma
l_int|0x5a
comma
l_int|0xd3
comma
l_int|0x6c
comma
l_int|0xe5
comma
l_int|0x7e
comma
l_int|0xf7
comma
l_int|0x81
comma
l_int|0x08
comma
l_int|0x93
comma
l_int|0x1a
comma
l_int|0xa5
comma
l_int|0x2c
comma
l_int|0xb7
comma
l_int|0x3e
comma
l_int|0xc9
comma
l_int|0x40
comma
l_int|0xdb
comma
l_int|0x52
comma
l_int|0xed
comma
l_int|0x64
comma
l_int|0xff
comma
l_int|0x76
comma
l_int|0x02
comma
l_int|0x8b
comma
l_int|0x10
comma
l_int|0x99
comma
l_int|0x26
comma
l_int|0xaf
comma
l_int|0x34
comma
l_int|0xbd
comma
l_int|0x4a
comma
l_int|0xc3
comma
l_int|0x58
comma
l_int|0xd1
comma
l_int|0x6e
comma
l_int|0xe7
comma
l_int|0x7c
comma
l_int|0xf5
comma
l_int|0x83
comma
l_int|0x0a
comma
l_int|0x91
comma
l_int|0x18
comma
l_int|0xa7
comma
l_int|0x2e
comma
l_int|0xb5
comma
l_int|0x3c
comma
l_int|0xcb
comma
l_int|0x42
comma
l_int|0xd9
comma
l_int|0x50
comma
l_int|0xef
comma
l_int|0x66
comma
l_int|0xfd
comma
l_int|0x74
comma
l_int|0x04
comma
l_int|0x8d
comma
l_int|0x16
comma
l_int|0x9f
comma
l_int|0x20
comma
l_int|0xa9
comma
l_int|0x32
comma
l_int|0xbb
comma
l_int|0x4c
comma
l_int|0xc5
comma
l_int|0x5e
comma
l_int|0xd7
comma
l_int|0x68
comma
l_int|0xe1
comma
l_int|0x7a
comma
l_int|0xf3
comma
l_int|0x85
comma
l_int|0x0c
comma
l_int|0x97
comma
l_int|0x1e
comma
l_int|0xa1
comma
l_int|0x28
comma
l_int|0xb3
comma
l_int|0x3a
comma
l_int|0xcd
comma
l_int|0x44
comma
l_int|0xdf
comma
l_int|0x56
comma
l_int|0xe9
comma
l_int|0x60
comma
l_int|0xfb
comma
l_int|0x72
comma
l_int|0x06
comma
l_int|0x8f
comma
l_int|0x14
comma
l_int|0x9d
comma
l_int|0x22
comma
l_int|0xab
comma
l_int|0x30
comma
l_int|0xb9
comma
l_int|0x4e
comma
l_int|0xc7
comma
l_int|0x5c
comma
l_int|0xd5
comma
l_int|0x6a
comma
l_int|0xe3
comma
l_int|0x78
comma
l_int|0xf1
comma
l_int|0x87
comma
l_int|0x0e
comma
l_int|0x95
comma
l_int|0x1c
comma
l_int|0xa3
comma
l_int|0x2a
comma
l_int|0xb1
comma
l_int|0x38
comma
l_int|0xcf
comma
l_int|0x46
comma
l_int|0xdd
comma
l_int|0x54
comma
l_int|0xeb
comma
l_int|0x62
comma
l_int|0xf9
comma
l_int|0x70
comma
l_int|0x08
comma
l_int|0x81
comma
l_int|0x1a
comma
l_int|0x93
comma
l_int|0x2c
comma
l_int|0xa5
comma
l_int|0x3e
comma
l_int|0xb7
comma
l_int|0x40
comma
l_int|0xc9
comma
l_int|0x52
comma
l_int|0xdb
comma
l_int|0x64
comma
l_int|0xed
comma
l_int|0x76
comma
l_int|0xff
comma
l_int|0x89
comma
l_int|0x00
comma
l_int|0x9b
comma
l_int|0x12
comma
l_int|0xad
comma
l_int|0x24
comma
l_int|0xbf
comma
l_int|0x36
comma
l_int|0xc1
comma
l_int|0x48
comma
l_int|0xd3
comma
l_int|0x5a
comma
l_int|0xe5
comma
l_int|0x6c
comma
l_int|0xf7
comma
l_int|0x7e
comma
l_int|0x0a
comma
l_int|0x83
comma
l_int|0x18
comma
l_int|0x91
comma
l_int|0x2e
comma
l_int|0xa7
comma
l_int|0x3c
comma
l_int|0xb5
comma
l_int|0x42
comma
l_int|0xcb
comma
l_int|0x50
comma
l_int|0xd9
comma
l_int|0x66
comma
l_int|0xef
comma
l_int|0x74
comma
l_int|0xfd
comma
l_int|0x8b
comma
l_int|0x02
comma
l_int|0x99
comma
l_int|0x10
comma
l_int|0xaf
comma
l_int|0x26
comma
l_int|0xbd
comma
l_int|0x34
comma
l_int|0xc3
comma
l_int|0x4a
comma
l_int|0xd1
comma
l_int|0x58
comma
l_int|0xe7
comma
l_int|0x6e
comma
l_int|0xf5
comma
l_int|0x7c
comma
l_int|0x0c
comma
l_int|0x85
comma
l_int|0x1e
comma
l_int|0x97
comma
l_int|0x28
comma
l_int|0xa1
comma
l_int|0x3a
comma
l_int|0xb3
comma
l_int|0x44
comma
l_int|0xcd
comma
l_int|0x56
comma
l_int|0xdf
comma
l_int|0x60
comma
l_int|0xe9
comma
l_int|0x72
comma
l_int|0xfb
comma
l_int|0x8d
comma
l_int|0x04
comma
l_int|0x9f
comma
l_int|0x16
comma
l_int|0xa9
comma
l_int|0x20
comma
l_int|0xbb
comma
l_int|0x32
comma
l_int|0xc5
comma
l_int|0x4c
comma
l_int|0xd7
comma
l_int|0x5e
comma
l_int|0xe1
comma
l_int|0x68
comma
l_int|0xf3
comma
l_int|0x7a
comma
l_int|0x0e
comma
l_int|0x87
comma
l_int|0x1c
comma
l_int|0x95
comma
l_int|0x2a
comma
l_int|0xa3
comma
l_int|0x38
comma
l_int|0xb1
comma
l_int|0x46
comma
l_int|0xcf
comma
l_int|0x54
comma
l_int|0xdd
comma
l_int|0x62
comma
l_int|0xeb
comma
l_int|0x70
comma
l_int|0xf9
comma
l_int|0x8f
comma
l_int|0x06
comma
l_int|0x9d
comma
l_int|0x14
comma
l_int|0xab
comma
l_int|0x22
comma
l_int|0xb9
comma
l_int|0x30
comma
l_int|0xc7
comma
l_int|0x4e
comma
l_int|0xd5
comma
l_int|0x5c
comma
l_int|0xe3
comma
l_int|0x6a
comma
l_int|0xf1
comma
l_int|0x78
)brace
suffix:semicolon
DECL|variable|chktabh
r_static
r_const
r_int
r_char
id|chktabh
(braket
l_int|256
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x11
comma
l_int|0x23
comma
l_int|0x32
comma
l_int|0x46
comma
l_int|0x57
comma
l_int|0x65
comma
l_int|0x74
comma
l_int|0x8c
comma
l_int|0x9d
comma
l_int|0xaf
comma
l_int|0xbe
comma
l_int|0xca
comma
l_int|0xdb
comma
l_int|0xe9
comma
l_int|0xf8
comma
l_int|0x10
comma
l_int|0x01
comma
l_int|0x33
comma
l_int|0x22
comma
l_int|0x56
comma
l_int|0x47
comma
l_int|0x75
comma
l_int|0x64
comma
l_int|0x9c
comma
l_int|0x8d
comma
l_int|0xbf
comma
l_int|0xae
comma
l_int|0xda
comma
l_int|0xcb
comma
l_int|0xf9
comma
l_int|0xe8
comma
l_int|0x21
comma
l_int|0x30
comma
l_int|0x02
comma
l_int|0x13
comma
l_int|0x67
comma
l_int|0x76
comma
l_int|0x44
comma
l_int|0x55
comma
l_int|0xad
comma
l_int|0xbc
comma
l_int|0x8e
comma
l_int|0x9f
comma
l_int|0xeb
comma
l_int|0xfa
comma
l_int|0xc8
comma
l_int|0xd9
comma
l_int|0x31
comma
l_int|0x20
comma
l_int|0x12
comma
l_int|0x03
comma
l_int|0x77
comma
l_int|0x66
comma
l_int|0x54
comma
l_int|0x45
comma
l_int|0xbd
comma
l_int|0xac
comma
l_int|0x9e
comma
l_int|0x8f
comma
l_int|0xfb
comma
l_int|0xea
comma
l_int|0xd8
comma
l_int|0xc9
comma
l_int|0x42
comma
l_int|0x53
comma
l_int|0x61
comma
l_int|0x70
comma
l_int|0x04
comma
l_int|0x15
comma
l_int|0x27
comma
l_int|0x36
comma
l_int|0xce
comma
l_int|0xdf
comma
l_int|0xed
comma
l_int|0xfc
comma
l_int|0x88
comma
l_int|0x99
comma
l_int|0xab
comma
l_int|0xba
comma
l_int|0x52
comma
l_int|0x43
comma
l_int|0x71
comma
l_int|0x60
comma
l_int|0x14
comma
l_int|0x05
comma
l_int|0x37
comma
l_int|0x26
comma
l_int|0xde
comma
l_int|0xcf
comma
l_int|0xfd
comma
l_int|0xec
comma
l_int|0x98
comma
l_int|0x89
comma
l_int|0xbb
comma
l_int|0xaa
comma
l_int|0x63
comma
l_int|0x72
comma
l_int|0x40
comma
l_int|0x51
comma
l_int|0x25
comma
l_int|0x34
comma
l_int|0x06
comma
l_int|0x17
comma
l_int|0xef
comma
l_int|0xfe
comma
l_int|0xcc
comma
l_int|0xdd
comma
l_int|0xa9
comma
l_int|0xb8
comma
l_int|0x8a
comma
l_int|0x9b
comma
l_int|0x73
comma
l_int|0x62
comma
l_int|0x50
comma
l_int|0x41
comma
l_int|0x35
comma
l_int|0x24
comma
l_int|0x16
comma
l_int|0x07
comma
l_int|0xff
comma
l_int|0xee
comma
l_int|0xdc
comma
l_int|0xcd
comma
l_int|0xb9
comma
l_int|0xa8
comma
l_int|0x9a
comma
l_int|0x8b
comma
l_int|0x84
comma
l_int|0x95
comma
l_int|0xa7
comma
l_int|0xb6
comma
l_int|0xc2
comma
l_int|0xd3
comma
l_int|0xe1
comma
l_int|0xf0
comma
l_int|0x08
comma
l_int|0x19
comma
l_int|0x2b
comma
l_int|0x3a
comma
l_int|0x4e
comma
l_int|0x5f
comma
l_int|0x6d
comma
l_int|0x7c
comma
l_int|0x94
comma
l_int|0x85
comma
l_int|0xb7
comma
l_int|0xa6
comma
l_int|0xd2
comma
l_int|0xc3
comma
l_int|0xf1
comma
l_int|0xe0
comma
l_int|0x18
comma
l_int|0x09
comma
l_int|0x3b
comma
l_int|0x2a
comma
l_int|0x5e
comma
l_int|0x4f
comma
l_int|0x7d
comma
l_int|0x6c
comma
l_int|0xa5
comma
l_int|0xb4
comma
l_int|0x86
comma
l_int|0x97
comma
l_int|0xe3
comma
l_int|0xf2
comma
l_int|0xc0
comma
l_int|0xd1
comma
l_int|0x29
comma
l_int|0x38
comma
l_int|0x0a
comma
l_int|0x1b
comma
l_int|0x6f
comma
l_int|0x7e
comma
l_int|0x4c
comma
l_int|0x5d
comma
l_int|0xb5
comma
l_int|0xa4
comma
l_int|0x96
comma
l_int|0x87
comma
l_int|0xf3
comma
l_int|0xe2
comma
l_int|0xd0
comma
l_int|0xc1
comma
l_int|0x39
comma
l_int|0x28
comma
l_int|0x1a
comma
l_int|0x0b
comma
l_int|0x7f
comma
l_int|0x6e
comma
l_int|0x5c
comma
l_int|0x4d
comma
l_int|0xc6
comma
l_int|0xd7
comma
l_int|0xe5
comma
l_int|0xf4
comma
l_int|0x80
comma
l_int|0x91
comma
l_int|0xa3
comma
l_int|0xb2
comma
l_int|0x4a
comma
l_int|0x5b
comma
l_int|0x69
comma
l_int|0x78
comma
l_int|0x0c
comma
l_int|0x1d
comma
l_int|0x2f
comma
l_int|0x3e
comma
l_int|0xd6
comma
l_int|0xc7
comma
l_int|0xf5
comma
l_int|0xe4
comma
l_int|0x90
comma
l_int|0x81
comma
l_int|0xb3
comma
l_int|0xa2
comma
l_int|0x5a
comma
l_int|0x4b
comma
l_int|0x79
comma
l_int|0x68
comma
l_int|0x1c
comma
l_int|0x0d
comma
l_int|0x3f
comma
l_int|0x2e
comma
l_int|0xe7
comma
l_int|0xf6
comma
l_int|0xc4
comma
l_int|0xd5
comma
l_int|0xa1
comma
l_int|0xb0
comma
l_int|0x82
comma
l_int|0x93
comma
l_int|0x6b
comma
l_int|0x7a
comma
l_int|0x48
comma
l_int|0x59
comma
l_int|0x2d
comma
l_int|0x3c
comma
l_int|0x0e
comma
l_int|0x1f
comma
l_int|0xf7
comma
l_int|0xe6
comma
l_int|0xd4
comma
l_int|0xc5
comma
l_int|0xb1
comma
l_int|0xa0
comma
l_int|0x92
comma
l_int|0x83
comma
l_int|0x7b
comma
l_int|0x6a
comma
l_int|0x58
comma
l_int|0x49
comma
l_int|0x3d
comma
l_int|0x2c
comma
l_int|0x1e
comma
l_int|0x0f
)brace
suffix:semicolon
multiline_comment|/*************************************************************************&n;* FPGA functions&n;************************************************************************/
DECL|function|delay
r_static
r_void
id|delay
c_func
(paren
r_int
id|ms
)paren
(brace
r_int
r_int
id|timeout
op_assign
id|jiffies
op_plus
(paren
(paren
id|ms
op_star
id|HZ
)paren
op_div
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|jiffies
OL
id|timeout
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * reset FPGA&n; */
DECL|function|fpga_reset
r_static
r_void
id|fpga_reset
c_func
(paren
r_int
id|iobase
)paren
(brace
id|outb
c_func
(paren
l_int|0
comma
id|IER
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|LCR_DLAB
op_or
id|LCR_BIT5
comma
id|LCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
id|DLL
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|DLM
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|LCR_BIT5
comma
id|LCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|inb
c_func
(paren
id|LSR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|inb
c_func
(paren
id|MSR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
multiline_comment|/* turn off FPGA supply voltage */
id|outb
c_func
(paren
id|MCR_OUT1
op_or
id|MCR_OUT2
comma
id|MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|delay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* turn on FPGA supply voltage again */
id|outb
c_func
(paren
id|MCR_DTR
op_or
id|MCR_RTS
op_or
id|MCR_OUT1
op_or
id|MCR_OUT2
comma
id|MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|delay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * send one byte to FPGA&n; */
DECL|function|fpga_write
r_static
r_int
id|fpga_write
c_func
(paren
r_int
id|iobase
comma
r_int
r_char
id|wrd
)paren
(brace
r_int
r_char
id|bit
suffix:semicolon
r_int
id|k
suffix:semicolon
r_int
r_int
id|timeout
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|10
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|8
suffix:semicolon
id|k
op_increment
)paren
(brace
id|bit
op_assign
(paren
id|wrd
op_amp
l_int|0x80
)paren
ques
c_cond
(paren
id|MCR_RTS
op_or
id|MCR_DTR
)paren
suffix:colon
id|MCR_DTR
suffix:semicolon
id|outb
c_func
(paren
id|bit
op_or
id|MCR_OUT1
op_or
id|MCR_OUT2
comma
id|MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|wrd
op_lshift_assign
l_int|1
suffix:semicolon
id|outb
c_func
(paren
l_int|0xfc
comma
id|THR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|LSR
c_func
(paren
id|iobase
)paren
)paren
op_amp
id|LSR_TSRE
)paren
op_eq
l_int|0
)paren
r_if
c_cond
(paren
id|jiffies
OG
id|timeout
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|add_mcs
r_static
r_int
r_char
op_star
id|add_mcs
c_func
(paren
r_int
r_char
op_star
id|bits
comma
r_int
id|bitrate
)paren
(brace
r_struct
id|yam_mcs
op_star
id|p
suffix:semicolon
multiline_comment|/* If it already exists, replace the bit data */
id|p
op_assign
id|yam_data
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;bitrate
op_eq
id|bitrate
)paren
(brace
id|memcpy
c_func
(paren
id|p-&gt;bits
comma
id|bits
comma
id|YAM_FPGA_SIZE
)paren
suffix:semicolon
r_return
id|p-&gt;bits
suffix:semicolon
)brace
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
multiline_comment|/* Allocate a new mcs */
r_if
c_cond
(paren
(paren
id|p
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|yam_mcs
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;YAM: no memory to allocate mcs&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|p-&gt;bits
comma
id|bits
comma
id|YAM_FPGA_SIZE
)paren
suffix:semicolon
id|p-&gt;bitrate
op_assign
id|bitrate
suffix:semicolon
id|p-&gt;next
op_assign
id|yam_data
suffix:semicolon
id|yam_data
op_assign
id|p
suffix:semicolon
r_return
id|p-&gt;bits
suffix:semicolon
)brace
DECL|function|get_mcs
r_static
r_int
r_char
op_star
id|get_mcs
c_func
(paren
r_int
id|bitrate
)paren
(brace
r_struct
id|yam_mcs
op_star
id|p
suffix:semicolon
id|p
op_assign
id|yam_data
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;bitrate
op_eq
id|bitrate
)paren
r_return
id|p-&gt;bits
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
multiline_comment|/* Load predefined mcs data */
r_switch
c_cond
(paren
id|bitrate
)paren
(brace
r_case
l_int|1200
suffix:colon
r_return
id|add_mcs
c_func
(paren
id|bits_1200
comma
id|bitrate
)paren
suffix:semicolon
r_default
suffix:colon
r_return
id|add_mcs
c_func
(paren
id|bits_9600
comma
id|bitrate
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * download bitstream to FPGA&n; * data is contained in bits[] array in yam1200.h resp. yam9600.h&n; */
DECL|function|fpga_download
r_static
r_int
id|fpga_download
c_func
(paren
r_int
id|iobase
comma
r_int
id|bitrate
)paren
(brace
r_int
id|i
comma
id|rc
suffix:semicolon
r_int
r_char
op_star
id|pbits
suffix:semicolon
id|pbits
op_assign
id|get_mcs
c_func
(paren
id|bitrate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbits
op_eq
l_int|NULL
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|fpga_reset
c_func
(paren
id|iobase
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|YAM_FPGA_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fpga_write
c_func
(paren
id|iobase
comma
id|pbits
(braket
id|i
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;yam: error in write cycle&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* write... */
)brace
)brace
id|fpga_write
c_func
(paren
id|iobase
comma
l_int|0xFF
)paren
suffix:semicolon
id|rc
op_assign
id|inb
c_func
(paren
id|MSR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
multiline_comment|/* check DONE signal */
multiline_comment|/* Needed for some hardwares */
id|delay
c_func
(paren
l_int|50
)paren
suffix:semicolon
r_return
(paren
id|rc
op_amp
id|MSR_DSR
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/************************************************************************&n;* Serial port init &n;************************************************************************/
DECL|function|yam_set_uart
r_static
r_void
id|yam_set_uart
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|yam_port
op_star
id|yp
op_assign
(paren
r_struct
id|yam_port
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|divisor
op_assign
l_int|115200
op_div
id|yp-&gt;baudrate
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|IER
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|LCR_DLAB
op_or
id|LCR_BIT8
comma
id|LCR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|divisor
comma
id|DLL
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|DLM
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|LCR_BIT8
comma
id|LCR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|PTT_OFF
comma
id|MCR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|FCR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
multiline_comment|/* Flush pending irq */
id|inb
c_func
(paren
id|RBR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|inb
c_func
(paren
id|MSR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable rx irq */
id|outb
c_func
(paren
id|ENABLE_RTXINT
comma
id|IER
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|enum|uart
r_enum
id|uart
(brace
DECL|enumerator|c_uart_unknown
DECL|enumerator|c_uart_8250
id|c_uart_unknown
comma
id|c_uart_8250
comma
DECL|enumerator|c_uart_16450
DECL|enumerator|c_uart_16550
DECL|enumerator|c_uart_16550A
id|c_uart_16450
comma
id|c_uart_16550
comma
id|c_uart_16550A
)brace
suffix:semicolon
DECL|variable|uart_str
r_static
r_const
r_char
op_star
id|uart_str
(braket
)braket
op_assign
(brace
l_string|&quot;unknown&quot;
comma
l_string|&quot;8250&quot;
comma
l_string|&quot;16450&quot;
comma
l_string|&quot;16550&quot;
comma
l_string|&quot;16550A&quot;
)brace
suffix:semicolon
DECL|function|yam_check_uart
r_static
r_enum
id|uart
id|yam_check_uart
c_func
(paren
r_int
r_int
id|iobase
)paren
(brace
r_int
r_char
id|b1
comma
id|b2
comma
id|b3
suffix:semicolon
r_enum
id|uart
id|u
suffix:semicolon
r_enum
id|uart
id|uart_tab
(braket
)braket
op_assign
(brace
id|c_uart_16450
comma
id|c_uart_unknown
comma
id|c_uart_16550
comma
id|c_uart_16550A
)brace
suffix:semicolon
id|b1
op_assign
id|inb
c_func
(paren
id|MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|b1
op_or
l_int|0x10
comma
id|MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
multiline_comment|/* loopback mode */
id|b2
op_assign
id|inb
c_func
(paren
id|MSR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x1a
comma
id|MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|b3
op_assign
id|inb
c_func
(paren
id|MSR
c_func
(paren
id|iobase
)paren
)paren
op_amp
l_int|0xf0
suffix:semicolon
id|outb
c_func
(paren
id|b1
comma
id|MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
multiline_comment|/* restore old values */
id|outb
c_func
(paren
id|b2
comma
id|MSR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b3
op_ne
l_int|0x90
)paren
r_return
id|c_uart_unknown
suffix:semicolon
id|inb
c_func
(paren
id|RBR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|inb
c_func
(paren
id|RBR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|FCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
multiline_comment|/* enable FIFOs */
id|u
op_assign
id|uart_tab
(braket
(paren
id|inb
c_func
(paren
id|IIR
c_func
(paren
id|iobase
)paren
)paren
op_rshift
l_int|6
)paren
op_amp
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
id|u
op_eq
id|c_uart_16450
)paren
(brace
id|outb
c_func
(paren
l_int|0x5a
comma
id|SCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|b1
op_assign
id|inb
c_func
(paren
id|SCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xa5
comma
id|SCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|b2
op_assign
id|inb
c_func
(paren
id|SCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b1
op_ne
l_int|0x5a
)paren
op_logical_or
(paren
id|b2
op_ne
l_int|0xa5
)paren
)paren
id|u
op_assign
id|c_uart_8250
suffix:semicolon
)brace
r_return
id|u
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n;* Rx Section&n;******************************************************************************/
DECL|function|yam_rx_flag
r_static
r_inline
r_void
id|yam_rx_flag
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|yam_port
op_star
id|yp
)paren
(brace
r_if
c_cond
(paren
id|yp-&gt;dcd
op_logical_and
id|yp-&gt;rx_len
op_ge
l_int|3
op_logical_and
id|yp-&gt;rx_len
OL
id|YAM_MAX_FRAME
)paren
(brace
r_int
id|pkt_len
op_assign
id|yp-&gt;rx_len
op_minus
l_int|2
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* -CRC + kiss */
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|yp-&gt;rx_crch
op_amp
id|yp-&gt;rx_crcl
)paren
op_ne
l_int|0xFF
)paren
(brace
multiline_comment|/* Bad crc */
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: memory squeeze, dropping packet&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
op_increment
id|yp-&gt;stats.rx_dropped
suffix:semicolon
)brace
r_else
(brace
r_int
r_char
op_star
id|cp
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|cp
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
op_star
id|cp
op_increment
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* KISS kludge */
id|memcpy
c_func
(paren
id|cp
comma
id|yp-&gt;rx_buf
comma
id|pkt_len
op_minus
l_int|1
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_AX25
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
op_increment
id|yp-&gt;stats.rx_packets
suffix:semicolon
)brace
)brace
)brace
id|yp-&gt;rx_len
op_assign
l_int|0
suffix:semicolon
id|yp-&gt;rx_crcl
op_assign
l_int|0x21
suffix:semicolon
id|yp-&gt;rx_crch
op_assign
l_int|0xf3
suffix:semicolon
)brace
DECL|function|yam_rx_byte
r_static
r_inline
r_void
id|yam_rx_byte
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|yam_port
op_star
id|yp
comma
r_int
r_char
id|rxb
)paren
(brace
r_if
c_cond
(paren
id|yp-&gt;rx_len
OL
id|YAM_MAX_FRAME
)paren
(brace
r_int
r_char
id|c
op_assign
id|yp-&gt;rx_crcl
suffix:semicolon
id|yp-&gt;rx_crcl
op_assign
(paren
id|chktabl
(braket
id|c
)braket
op_xor
id|yp-&gt;rx_crch
)paren
suffix:semicolon
id|yp-&gt;rx_crch
op_assign
(paren
id|chktabh
(braket
id|c
)braket
op_xor
id|rxb
)paren
suffix:semicolon
id|yp-&gt;rx_buf
(braket
id|yp-&gt;rx_len
op_increment
)braket
op_assign
id|rxb
suffix:semicolon
)brace
)brace
multiline_comment|/********************************************************************************&n;* TX Section&n;********************************************************************************/
DECL|function|ptt_on
r_static
r_void
id|ptt_on
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|outb
c_func
(paren
id|PTT_ON
comma
id|MCR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
)brace
DECL|function|ptt_off
r_static
r_void
id|ptt_off
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|outb
c_func
(paren
id|PTT_OFF
comma
id|MCR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
)brace
DECL|function|yam_send_packet
r_static
r_int
id|yam_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|yam_port
op_star
id|yp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|yp-&gt;send_queue
comma
id|skb
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|yam_start_tx
r_static
r_void
id|yam_start_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|yam_port
op_star
id|yp
)paren
(brace
r_if
c_cond
(paren
(paren
id|yp-&gt;tx_state
op_eq
id|TX_TAIL
)paren
op_logical_or
(paren
id|yp-&gt;txd
op_eq
l_int|0
)paren
)paren
id|yp-&gt;tx_count
op_assign
l_int|1
suffix:semicolon
r_else
id|yp-&gt;tx_count
op_assign
(paren
id|yp-&gt;bitrate
op_star
id|yp-&gt;txd
)paren
op_div
l_int|8000
suffix:semicolon
id|yp-&gt;tx_state
op_assign
id|TX_HEAD
suffix:semicolon
id|ptt_on
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|random_seed
r_static
r_int
r_int
id|random_seed
suffix:semicolon
DECL|function|random_num
r_static
r_inline
r_int
r_int
id|random_num
c_func
(paren
r_void
)paren
(brace
id|random_seed
op_assign
l_int|28629
op_star
id|random_seed
op_plus
l_int|157
suffix:semicolon
r_return
id|random_seed
suffix:semicolon
)brace
DECL|function|yam_arbitrate
r_static
r_void
id|yam_arbitrate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|yam_port
op_star
id|yp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|yp
op_logical_or
id|yp-&gt;magic
op_ne
id|YAM_MAGIC
op_logical_or
id|yp-&gt;tx_state
op_ne
id|TX_OFF
op_logical_or
id|skb_queue_empty
c_func
(paren
op_amp
id|yp-&gt;send_queue
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/* tx_state is TX_OFF and there is data to send */
r_if
c_cond
(paren
id|yp-&gt;dupmode
)paren
(brace
multiline_comment|/* Full duplex mode, don&squot;t wait */
id|yam_start_tx
c_func
(paren
id|dev
comma
id|yp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|yp-&gt;dcd
)paren
(brace
multiline_comment|/* DCD on, wait slotime ... */
id|yp-&gt;slotcnt
op_assign
id|yp-&gt;slot
op_div
l_int|10
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Is slottime passed ? */
r_if
c_cond
(paren
(paren
op_decrement
id|yp-&gt;slotcnt
)paren
OG
l_int|0
)paren
r_return
suffix:semicolon
id|yp-&gt;slotcnt
op_assign
id|yp-&gt;slot
op_div
l_int|10
suffix:semicolon
multiline_comment|/* is random &gt; persist ? */
r_if
c_cond
(paren
(paren
id|random_num
c_func
(paren
)paren
op_mod
l_int|256
)paren
OG
id|yp-&gt;pers
)paren
r_return
suffix:semicolon
id|yam_start_tx
c_func
(paren
id|dev
comma
id|yp
)paren
suffix:semicolon
)brace
DECL|function|yam_dotimer
r_static
r_void
id|yam_dotimer
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|yam_ports
(braket
id|i
)braket
dot
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
id|yam_arbitrate
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|yam_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|100
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|yam_timer
)paren
suffix:semicolon
)brace
DECL|function|yam_tx_byte
r_static
r_void
id|yam_tx_byte
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|yam_port
op_star
id|yp
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
id|b
comma
id|temp
suffix:semicolon
r_switch
c_cond
(paren
id|yp-&gt;tx_state
)paren
(brace
r_case
id|TX_OFF
suffix:colon
r_break
suffix:semicolon
r_case
id|TX_HEAD
suffix:colon
r_if
c_cond
(paren
op_decrement
id|yp-&gt;tx_count
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|yp-&gt;send_queue
)paren
)paren
)paren
(brace
id|ptt_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|yp-&gt;tx_state
op_assign
id|TX_OFF
suffix:semicolon
r_break
suffix:semicolon
)brace
id|yp-&gt;tx_state
op_assign
id|TX_DATA
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
(brace
multiline_comment|/*                              do_kiss_params(s, skb-&gt;data, skb-&gt;len); */
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|yp-&gt;tx_len
op_assign
id|skb-&gt;len
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* strip KISS byte */
r_if
c_cond
(paren
id|yp-&gt;tx_len
op_ge
id|YAM_MAX_FRAME
op_logical_or
id|yp-&gt;tx_len
OL
l_int|2
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|yp-&gt;tx_buf
comma
id|skb-&gt;data
op_plus
l_int|1
comma
id|yp-&gt;tx_len
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|yp-&gt;tx_count
op_assign
l_int|0
suffix:semicolon
id|yp-&gt;tx_crcl
op_assign
l_int|0x21
suffix:semicolon
id|yp-&gt;tx_crch
op_assign
l_int|0xf3
suffix:semicolon
id|yp-&gt;tx_state
op_assign
id|TX_DATA
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TX_DATA
suffix:colon
id|b
op_assign
id|yp-&gt;tx_buf
(braket
id|yp-&gt;tx_count
op_increment
)braket
suffix:semicolon
id|outb
c_func
(paren
id|b
comma
id|THR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|temp
op_assign
id|yp-&gt;tx_crcl
suffix:semicolon
id|yp-&gt;tx_crcl
op_assign
id|chktabl
(braket
id|temp
)braket
op_xor
id|yp-&gt;tx_crch
suffix:semicolon
id|yp-&gt;tx_crch
op_assign
id|chktabh
(braket
id|temp
)braket
op_xor
id|b
suffix:semicolon
r_if
c_cond
(paren
id|yp-&gt;tx_count
op_ge
id|yp-&gt;tx_len
)paren
(brace
id|yp-&gt;tx_state
op_assign
id|TX_CRC1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TX_CRC1
suffix:colon
id|yp-&gt;tx_crch
op_assign
id|chktabl
(braket
id|yp-&gt;tx_crcl
)braket
op_xor
id|yp-&gt;tx_crch
suffix:semicolon
id|yp-&gt;tx_crcl
op_assign
id|chktabh
(braket
id|yp-&gt;tx_crcl
)braket
op_xor
id|chktabl
(braket
id|yp-&gt;tx_crch
)braket
op_xor
l_int|0xff
suffix:semicolon
id|outb
c_func
(paren
id|yp-&gt;tx_crcl
comma
id|THR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|yp-&gt;tx_state
op_assign
id|TX_CRC2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TX_CRC2
suffix:colon
id|outb
c_func
(paren
id|chktabh
(braket
id|yp-&gt;tx_crch
)braket
op_xor
l_int|0xFF
comma
id|THR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_empty
c_func
(paren
op_amp
id|yp-&gt;send_queue
)paren
)paren
(brace
id|yp-&gt;tx_count
op_assign
(paren
id|yp-&gt;bitrate
op_star
id|yp-&gt;txtail
)paren
op_div
l_int|8000
suffix:semicolon
r_if
c_cond
(paren
id|yp-&gt;dupmode
op_eq
l_int|2
)paren
id|yp-&gt;tx_count
op_add_assign
(paren
id|yp-&gt;bitrate
op_star
id|yp-&gt;holdd
)paren
op_div
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|yp-&gt;tx_count
op_eq
l_int|0
)paren
id|yp-&gt;tx_count
op_assign
l_int|1
suffix:semicolon
id|yp-&gt;tx_state
op_assign
id|TX_TAIL
suffix:semicolon
)brace
r_else
(brace
id|yp-&gt;tx_count
op_assign
l_int|1
suffix:semicolon
id|yp-&gt;tx_state
op_assign
id|TX_HEAD
suffix:semicolon
)brace
op_increment
id|yp-&gt;stats.tx_packets
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TX_TAIL
suffix:colon
r_if
c_cond
(paren
op_decrement
id|yp-&gt;tx_count
op_le
l_int|0
)paren
(brace
id|yp-&gt;tx_state
op_assign
id|TX_OFF
suffix:semicolon
id|ptt_off
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/***********************************************************************************&n;* ISR routine&n;************************************************************************************/
DECL|function|yam_interrupt
r_static
r_void
id|yam_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|yam_port
op_star
id|yp
suffix:semicolon
r_int
r_char
id|iir
suffix:semicolon
r_int
id|counter
op_assign
l_int|100
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|yp
op_assign
op_amp
id|yam_ports
(braket
id|i
)braket
suffix:semicolon
id|dev
op_assign
op_amp
id|yp-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_continue
suffix:semicolon
r_while
c_loop
(paren
(paren
id|iir
op_assign
id|IIR_MASK
op_amp
id|inb
c_func
(paren
id|IIR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
)paren
op_ne
id|IIR_NOPEND
)paren
(brace
r_int
r_char
id|msr
op_assign
id|inb
c_func
(paren
id|MSR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
r_int
r_char
id|lsr
op_assign
id|inb
c_func
(paren
id|LSR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
r_int
r_char
id|rxb
suffix:semicolon
r_if
c_cond
(paren
id|lsr
op_amp
id|LSR_OE
)paren
op_increment
id|yp-&gt;stats.rx_fifo_errors
suffix:semicolon
id|yp-&gt;dcd
op_assign
(paren
id|msr
op_amp
id|RX_DCD
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|counter
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: too many irq iir=%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|iir
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msr
op_amp
id|TX_RDY
)paren
(brace
op_increment
id|yp-&gt;nb_mdint
suffix:semicolon
id|yam_tx_byte
c_func
(paren
id|dev
comma
id|yp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lsr
op_amp
id|LSR_RXC
)paren
(brace
op_increment
id|yp-&gt;nb_rxint
suffix:semicolon
id|rxb
op_assign
id|inb
c_func
(paren
id|RBR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msr
op_amp
id|RX_FLAG
)paren
id|yam_rx_flag
c_func
(paren
id|dev
comma
id|yp
)paren
suffix:semicolon
r_else
id|yam_rx_byte
c_func
(paren
id|dev
comma
id|yp
comma
id|rxb
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|yam_net_get_info
r_static
r_int
id|yam_net_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|yam_ports
(braket
id|i
)braket
dot
id|iobase
op_eq
l_int|0
op_logical_or
id|yam_ports
(braket
id|i
)braket
dot
id|irq
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Device yam%d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  Up       %d&bslash;n&quot;
comma
id|netif_running
c_func
(paren
op_amp
id|yam_ports
(braket
id|i
)braket
dot
id|dev
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  Speed    %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|bitrate
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  IoBase   0x%x&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|iobase
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  BaudRate %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|baudrate
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  IRQ      %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|irq
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  TxState  %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|tx_state
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  Duplex   %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|dupmode
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  HoldDly  %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|holdd
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  TxDelay  %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|txd
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  TxTail   %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|txtail
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  SlotTime %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|slot
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  Persist  %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|pers
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  TxFrames %lu&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|stats.tx_packets
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  RxFrames %lu&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|stats.rx_packets
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  TxInt    %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|nb_mdint
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  RxInt    %u&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|nb_rxint
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;  RxOver   %lu&bslash;n&quot;
comma
id|yam_ports
(braket
id|i
)braket
dot
id|stats.rx_fifo_errors
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_break
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|yam_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|yam_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|yam_port
op_star
id|yp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|dev-&gt;priv
)paren
r_return
l_int|NULL
suffix:semicolon
id|yp
op_assign
(paren
r_struct
id|yam_port
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|yp-&gt;magic
op_ne
id|YAM_MAGIC
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* &n;&t; * Get the current statistics.  This may be called with the&n;&t; * card open or closed. &n;&t; */
r_return
op_amp
id|yp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|yam_open
r_static
r_int
id|yam_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|yam_port
op_star
id|yp
op_assign
(paren
r_struct
id|yam_port
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_enum
id|uart
id|u
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Trying %s at iobase 0x%lx irq %u&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|yp
op_logical_or
op_logical_neg
id|yp-&gt;bitrate
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;base_addr
op_logical_or
id|dev-&gt;base_addr
OG
l_int|0x1000
op_minus
id|YAM_EXTENT
op_logical_or
id|dev-&gt;irq
template_param
l_int|15
)paren
(brace
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|YAM_EXTENT
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: cannot 0x%lx busy&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_return
op_minus
id|EACCES
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|u
op_assign
id|yam_check_uart
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
op_eq
id|c_uart_unknown
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: cannot find uart type&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fpga_download
c_func
(paren
id|dev-&gt;base_addr
comma
id|yp-&gt;bitrate
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: cannot init FPGA&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0
comma
id|IER
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|yam_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
l_int|NULL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: irq %d busy&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|request_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|YAM_EXTENT
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|yam_set_uart
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|yp-&gt;slotcnt
op_assign
id|yp-&gt;slot
op_div
l_int|10
suffix:semicolon
multiline_comment|/* Reset overruns for all ports - FPGA programming makes overruns */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|inb
c_func
(paren
id|LSR
c_func
(paren
id|yam_ports
(braket
id|i
)braket
dot
id|dev.base_addr
)paren
)paren
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|stats.rx_fifo_errors
op_assign
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s at iobase 0x%lx irq %u uart %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;irq
comma
id|uart_str
(braket
id|u
)braket
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|yam_close
r_static
r_int
id|yam_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|yam_port
op_star
id|yp
op_assign
(paren
r_struct
id|yam_port
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|yp
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t; * disable interrupts&n;&t; */
id|outb
c_func
(paren
l_int|0
comma
id|IER
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
id|MCR
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
multiline_comment|/* Remove IRQ handler if last */
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
l_int|NULL
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|YAM_EXTENT
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|yp-&gt;send_queue
)paren
)paren
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: close yam at iobase 0x%lx irq %u&bslash;n&quot;
comma
id|yam_drvname
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|yam_ioctl
r_static
r_int
id|yam_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_struct
id|yam_port
op_star
id|yp
op_assign
(paren
r_struct
id|yam_port
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|yamdrv_ioctl_cfg
id|yi
suffix:semicolon
r_struct
id|yamdrv_ioctl_mcs
op_star
id|ym
suffix:semicolon
r_int
id|ioctl_cmd
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ioctl_cmd
comma
id|ifr-&gt;ifr_data
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|yp
op_eq
l_int|NULL
op_logical_or
id|yp-&gt;magic
op_ne
id|YAM_MAGIC
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_ne
id|SIOCDEVPRIVATE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|ioctl_cmd
)paren
(brace
r_case
id|SIOCYAMRESERVED
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* unused */
r_case
id|SIOCYAMSMCS
suffix:colon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Cannot change this parameter when up */
id|ym
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|yamdrv_ioctl_mcs
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ym
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
id|ym-&gt;bitrate
op_assign
l_int|9600
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|ym
comma
id|ifr-&gt;ifr_data
comma
r_sizeof
(paren
r_struct
id|yamdrv_ioctl_mcs
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|ym-&gt;bitrate
OG
id|YAM_MAXBITRATE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|add_mcs
c_func
(paren
id|ym-&gt;bits
comma
id|ym-&gt;bitrate
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ym
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCYAMSCFG
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|yi
comma
id|ifr-&gt;ifr_data
comma
r_sizeof
(paren
r_struct
id|yamdrv_ioctl_cfg
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|yi.cfg.mask
op_amp
id|YAM_IOBASE
)paren
op_logical_and
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Cannot change this parameter when up */
r_if
c_cond
(paren
(paren
id|yi.cfg.mask
op_amp
id|YAM_IRQ
)paren
op_logical_and
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Cannot change this parameter when up */
r_if
c_cond
(paren
(paren
id|yi.cfg.mask
op_amp
id|YAM_BITRATE
)paren
op_logical_and
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Cannot change this parameter when up */
r_if
c_cond
(paren
(paren
id|yi.cfg.mask
op_amp
id|YAM_BAUDRATE
)paren
op_logical_and
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Cannot change this parameter when up */
r_if
c_cond
(paren
id|yi.cfg.mask
op_amp
id|YAM_IOBASE
)paren
(brace
id|yp-&gt;iobase
op_assign
id|yi.cfg.iobase
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|yi.cfg.iobase
suffix:semicolon
)brace
r_if
c_cond
(paren
id|yi.cfg.mask
op_amp
id|YAM_IRQ
)paren
(brace
r_if
c_cond
(paren
id|yi.cfg.irq
OG
l_int|15
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|yp-&gt;irq
op_assign
id|yi.cfg.irq
suffix:semicolon
id|dev-&gt;irq
op_assign
id|yi.cfg.irq
suffix:semicolon
)brace
r_if
c_cond
(paren
id|yi.cfg.mask
op_amp
id|YAM_BITRATE
)paren
(brace
r_if
c_cond
(paren
id|yi.cfg.bitrate
OG
id|YAM_MAXBITRATE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|yp-&gt;bitrate
op_assign
id|yi.cfg.bitrate
suffix:semicolon
)brace
r_if
c_cond
(paren
id|yi.cfg.mask
op_amp
id|YAM_BAUDRATE
)paren
(brace
r_if
c_cond
(paren
id|yi.cfg.baudrate
OG
id|YAM_MAXBAUDRATE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|yp-&gt;baudrate
op_assign
id|yi.cfg.baudrate
suffix:semicolon
)brace
r_if
c_cond
(paren
id|yi.cfg.mask
op_amp
id|YAM_MODE
)paren
(brace
r_if
c_cond
(paren
id|yi.cfg.mode
OG
id|YAM_MAXMODE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|yp-&gt;dupmode
op_assign
id|yi.cfg.mode
suffix:semicolon
)brace
r_if
c_cond
(paren
id|yi.cfg.mask
op_amp
id|YAM_HOLDDLY
)paren
(brace
r_if
c_cond
(paren
id|yi.cfg.holddly
OG
id|YAM_MAXHOLDDLY
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|yp-&gt;holdd
op_assign
id|yi.cfg.holddly
suffix:semicolon
)brace
r_if
c_cond
(paren
id|yi.cfg.mask
op_amp
id|YAM_TXDELAY
)paren
(brace
r_if
c_cond
(paren
id|yi.cfg.txdelay
OG
id|YAM_MAXTXDELAY
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|yp-&gt;txd
op_assign
id|yi.cfg.txdelay
suffix:semicolon
)brace
r_if
c_cond
(paren
id|yi.cfg.mask
op_amp
id|YAM_TXTAIL
)paren
(brace
r_if
c_cond
(paren
id|yi.cfg.txtail
OG
id|YAM_MAXTXTAIL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|yp-&gt;txtail
op_assign
id|yi.cfg.txtail
suffix:semicolon
)brace
r_if
c_cond
(paren
id|yi.cfg.mask
op_amp
id|YAM_PERSIST
)paren
(brace
r_if
c_cond
(paren
id|yi.cfg.persist
OG
id|YAM_MAXPERSIST
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|yp-&gt;pers
op_assign
id|yi.cfg.persist
suffix:semicolon
)brace
r_if
c_cond
(paren
id|yi.cfg.mask
op_amp
id|YAM_SLOTTIME
)paren
(brace
r_if
c_cond
(paren
id|yi.cfg.slottime
OG
id|YAM_MAXSLOTTIME
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|yp-&gt;slot
op_assign
id|yi.cfg.slottime
suffix:semicolon
id|yp-&gt;slotcnt
op_assign
id|yp-&gt;slot
op_div
l_int|10
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCYAMGCFG
suffix:colon
id|yi.cfg.mask
op_assign
l_int|0xffffffff
suffix:semicolon
id|yi.cfg.iobase
op_assign
id|yp-&gt;iobase
suffix:semicolon
id|yi.cfg.irq
op_assign
id|yp-&gt;irq
suffix:semicolon
id|yi.cfg.bitrate
op_assign
id|yp-&gt;bitrate
suffix:semicolon
id|yi.cfg.baudrate
op_assign
id|yp-&gt;baudrate
suffix:semicolon
id|yi.cfg.mode
op_assign
id|yp-&gt;dupmode
suffix:semicolon
id|yi.cfg.txdelay
op_assign
id|yp-&gt;txd
suffix:semicolon
id|yi.cfg.holddly
op_assign
id|yp-&gt;holdd
suffix:semicolon
id|yi.cfg.txtail
op_assign
id|yp-&gt;txtail
suffix:semicolon
id|yi.cfg.persist
op_assign
id|yp-&gt;pers
suffix:semicolon
id|yi.cfg.slottime
op_assign
id|yp-&gt;slot
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_data
comma
op_amp
id|yi
comma
r_sizeof
(paren
r_struct
id|yamdrv_ioctl_cfg
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|yam_set_mac_address
r_static
r_int
id|yam_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|addr
)paren
(brace
r_struct
id|sockaddr
op_star
id|sa
op_assign
(paren
r_struct
id|sockaddr
op_star
)paren
id|addr
suffix:semicolon
multiline_comment|/* addr is an AX.25 shifted ASCII mac address */
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|sa-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|yam_probe
r_static
r_int
id|yam_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|yam_port
op_star
id|yp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|yp
op_assign
(paren
r_struct
id|yam_port
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;open
op_assign
id|yam_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|yam_close
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|yam_ioctl
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|yam_send_packet
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|yam_get_stats
suffix:semicolon
id|dev_init_buffers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|yp-&gt;send_queue
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_AX25) || defined(CONFIG_AX25_MODULE)
id|dev-&gt;hard_header
op_assign
id|ax25_encapsulate
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
id|ax25_rebuild_header
suffix:semicolon
macro_line|#else&t;&t;&t;&t;&t;&t;&t;/* CONFIG_AX25 || CONFIG_AX25_MODULE */
id|dev-&gt;hard_header
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;&t;&t;&t;/* CONFIG_AX25 || CONFIG_AX25_MODULE */
id|dev-&gt;set_mac_address
op_assign
id|yam_set_mac_address
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_AX25
suffix:semicolon
multiline_comment|/* AF_AX25 device */
id|dev-&gt;hard_header_len
op_assign
l_int|73
suffix:semicolon
multiline_comment|/* We do digipeaters now */
id|dev-&gt;mtu
op_assign
l_int|256
suffix:semicolon
multiline_comment|/* AX25 is the default */
id|dev-&gt;addr_len
op_assign
l_int|7
suffix:semicolon
multiline_comment|/* sizeof an ax.25 address */
id|memcpy
c_func
(paren
id|dev-&gt;broadcast
comma
id|ax25_bcast
comma
l_int|7
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|ax25_test
comma
l_int|7
)paren
suffix:semicolon
multiline_comment|/* New style flags */
id|dev-&gt;flags
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|yam_init_driver
r_static
r_int
id|__init
id|yam_init_driver
c_func
(paren
r_void
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|yam_drvinfo
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|yam_ports
(braket
id|i
)braket
dot
id|dev.name
comma
l_string|&quot;yam%d&quot;
comma
id|i
)paren
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|magic
op_assign
id|YAM_MAGIC
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|bitrate
op_assign
id|DEFAULT_BITRATE
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|baudrate
op_assign
id|DEFAULT_BITRATE
op_star
l_int|2
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|iobase
op_assign
l_int|0
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|irq
op_assign
l_int|0
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|dupmode
op_assign
l_int|0
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|holdd
op_assign
id|DEFAULT_HOLDD
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|txd
op_assign
id|DEFAULT_TXD
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|txtail
op_assign
id|DEFAULT_TXTAIL
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|slot
op_assign
id|DEFAULT_SLOT
suffix:semicolon
id|yam_ports
(braket
id|i
)braket
dot
id|pers
op_assign
id|DEFAULT_PERS
suffix:semicolon
id|dev
op_assign
op_amp
id|yam_ports
(braket
id|i
)braket
dot
id|dev
suffix:semicolon
id|dev-&gt;priv
op_assign
op_amp
id|yam_ports
(braket
id|i
)braket
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|yam_ports
(braket
id|i
)braket
dot
id|iobase
suffix:semicolon
id|dev-&gt;irq
op_assign
id|yam_ports
(braket
id|i
)braket
dot
id|irq
suffix:semicolon
id|dev-&gt;init
op_assign
id|yam_probe
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;yam: cannot register net device %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
)brace
id|yam_timer.function
op_assign
id|yam_dotimer
suffix:semicolon
id|yam_timer.expires
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|100
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|yam_timer
)paren
suffix:semicolon
id|proc_net_create
c_func
(paren
l_string|&quot;yam&quot;
comma
l_int|0
comma
id|yam_net_get_info
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|yam_cleanup_driver
r_static
r_void
id|__exit
id|yam_cleanup_driver
c_func
(paren
r_void
)paren
(brace
r_struct
id|yam_mcs
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|yam_timer
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|yam_ports
(braket
id|i
)braket
dot
id|dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;priv
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
id|yam_close
c_func
(paren
id|dev
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|yam_data
)paren
(brace
id|p
op_assign
id|yam_data
suffix:semicolon
id|yam_data
op_assign
id|yam_data-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|proc_net_remove
c_func
(paren
l_string|&quot;yam&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Frederic Rible F1OAT frible@teaser.fr&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Yam amateur radio modem driver&quot;
)paren
suffix:semicolon
DECL|variable|yam_init_driver
id|module_init
c_func
(paren
id|yam_init_driver
)paren
suffix:semicolon
DECL|variable|yam_cleanup_driver
id|module_exit
c_func
(paren
id|yam_cleanup_driver
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
eof
