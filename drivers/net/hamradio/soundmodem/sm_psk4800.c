multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&t;sm_psk4800.c  -- soundcard radio modem driver, 4800 baud 8PSK modem&n; *&n; *&t;Copyright (C) 1997  Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;This program is distributed in the hope that it will be useful,&n; *&t;but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *&t;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *&t;GNU General Public License for more details.&n; *&n; *&t;You should have received a copy of the GNU General Public License&n; *&t;along with this program; if not, write to the Free Software&n; *&t;Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *  Please note that the GPL allows you to use the driver, NOT the radio.&n; *  In order to use the radio, you need a license from the communications&n; *  authority of your country.&n; *&n; */
macro_line|#include &quot;sm.h&quot;
macro_line|#include &quot;sm_tbl_psk4800.h&quot;
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|DESCRAM_TAP1
mdefine_line|#define DESCRAM_TAP1 0x20000
DECL|macro|DESCRAM_TAP2
mdefine_line|#define DESCRAM_TAP2 0x01000
DECL|macro|DESCRAM_TAP3
mdefine_line|#define DESCRAM_TAP3 0x00001
DECL|macro|DESCRAM_TAPSH1
mdefine_line|#define DESCRAM_TAPSH1 17
DECL|macro|DESCRAM_TAPSH2
mdefine_line|#define DESCRAM_TAPSH2 12
DECL|macro|DESCRAM_TAPSH3
mdefine_line|#define DESCRAM_TAPSH3 0
DECL|macro|SCRAM_TAP1
mdefine_line|#define SCRAM_TAP1 0x20000 /* X^17 */
DECL|macro|SCRAM_TAPN
mdefine_line|#define SCRAM_TAPN 0x00021 /* X^0+X^5 */
DECL|macro|SCRAM_SHIFT
mdefine_line|#define SCRAM_SHIFT 17
multiline_comment|/* --------------------------------------------------------------------- */
DECL|struct|demod_state_psk48
r_struct
id|demod_state_psk48
(brace
multiline_comment|/*&n;&t; * input mixer and lowpass&n;&t; */
DECL|member|infi
DECL|member|infq
r_int
id|infi
(braket
id|PSK48_RXF_LEN
op_div
l_int|2
)braket
comma
id|infq
(braket
id|PSK48_RXF_LEN
op_div
l_int|2
)braket
suffix:semicolon
DECL|member|downmixer
r_int
r_int
id|downmixer
suffix:semicolon
DECL|member|ovrphase
r_int
id|ovrphase
suffix:semicolon
DECL|member|magi
DECL|member|magq
r_int
id|magi
comma
id|magq
suffix:semicolon
multiline_comment|/*&n;&t; * sampling instant recovery&n;&t; */
DECL|member|pwrhist
r_int
id|pwrhist
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|s_phase
r_int
r_int
id|s_phase
suffix:semicolon
DECL|member|cur_sync
r_int
id|cur_sync
suffix:semicolon
multiline_comment|/*&n;&t; * phase recovery&n;&t; */
DECL|member|cur_phase_dev
r_int
id|cur_phase_dev
suffix:semicolon
DECL|member|last_ph_err
r_int
id|last_ph_err
suffix:semicolon
DECL|member|pskph
r_int
r_int
id|pskph
suffix:semicolon
DECL|member|phase
r_int
r_int
id|phase
suffix:semicolon
DECL|member|last_pskph
r_int
r_int
id|last_pskph
suffix:semicolon
DECL|member|cur_raw
DECL|member|last_raw
DECL|member|rawbits
r_int
r_char
id|cur_raw
comma
id|last_raw
comma
id|rawbits
suffix:semicolon
multiline_comment|/*&n;&t; * decoding&n;&t; */
DECL|member|shreg
r_int
r_int
id|shreg
suffix:semicolon
DECL|member|descram
r_int
r_int
id|descram
suffix:semicolon
DECL|member|bit_pll
r_int
r_int
id|bit_pll
suffix:semicolon
DECL|member|last_sample
r_int
r_char
id|last_sample
suffix:semicolon
DECL|member|dcd_shreg
r_int
r_int
id|dcd_shreg
suffix:semicolon
DECL|member|dcd_sum0
DECL|member|dcd_sum1
DECL|member|dcd_sum2
r_int
id|dcd_sum0
comma
id|dcd_sum1
comma
id|dcd_sum2
suffix:semicolon
DECL|member|dcd_time
r_int
r_int
id|dcd_time
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|mod_state_psk48
r_struct
id|mod_state_psk48
(brace
DECL|member|txbits
r_int
r_char
id|txbits
(braket
id|PSK48_TXF_NUMSAMPLES
)braket
suffix:semicolon
DECL|member|txphase
r_int
r_int
id|txphase
suffix:semicolon
DECL|member|shreg
r_int
r_int
id|shreg
suffix:semicolon
DECL|member|scram
r_int
r_int
id|scram
suffix:semicolon
DECL|member|tbl
r_const
r_int
op_star
id|tbl
suffix:semicolon
DECL|member|txseq
r_int
r_int
id|txseq
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|modulator_4800_u8
r_static
r_void
id|modulator_4800_u8
c_func
(paren
r_struct
id|sm_state
op_star
id|sm
comma
r_int
r_char
op_star
id|buf
comma
r_int
r_int
id|buflen
)paren
(brace
r_struct
id|mod_state_psk48
op_star
id|st
op_assign
(paren
r_struct
id|mod_state_psk48
op_star
)paren
(paren
op_amp
id|sm-&gt;m
)paren
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_int
id|si
comma
id|sq
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|buflen
OG
l_int|0
suffix:semicolon
id|buflen
op_decrement
comma
id|buf
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|st-&gt;txseq
op_increment
)paren
(brace
id|memmove
c_func
(paren
id|st-&gt;txbits
op_plus
l_int|1
comma
id|st-&gt;txbits
comma
r_sizeof
(paren
id|st-&gt;txbits
)paren
op_minus
r_sizeof
(paren
id|st-&gt;txbits
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|st-&gt;shreg
op_le
l_int|1
)paren
id|st-&gt;shreg
op_assign
id|hdlcdrv_getbits
c_func
(paren
op_amp
id|sm-&gt;hdrv
)paren
op_or
l_int|0x10000
suffix:semicolon
id|st-&gt;scram
op_assign
(paren
id|st-&gt;scram
op_lshift
l_int|1
)paren
op_or
(paren
id|st-&gt;shreg
op_amp
l_int|1
)paren
suffix:semicolon
id|st-&gt;shreg
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;scram
op_amp
id|SCRAM_TAP1
)paren
id|st-&gt;scram
op_xor_assign
id|SCRAM_TAPN
suffix:semicolon
)brace
id|j
op_assign
(paren
id|st-&gt;scram
op_rshift
(paren
id|SCRAM_SHIFT
op_plus
l_int|3
)paren
)paren
op_amp
l_int|7
suffix:semicolon
id|st-&gt;txbits
(braket
l_int|0
)braket
op_sub_assign
(paren
id|j
op_xor
(paren
id|j
op_rshift
l_int|1
)paren
)paren
suffix:semicolon
id|st-&gt;txbits
(braket
l_int|0
)braket
op_and_assign
l_int|7
suffix:semicolon
id|st-&gt;tbl
op_assign
id|psk48_tx_table
suffix:semicolon
)brace
r_if
c_cond
(paren
id|st-&gt;txseq
op_ge
id|PSK48_TXF_OVERSAMPLING
)paren
id|st-&gt;txseq
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|si
op_assign
id|sq
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|PSK48_TXF_NUMSAMPLES
suffix:semicolon
id|j
op_increment
comma
id|st-&gt;tbl
op_add_assign
l_int|16
)paren
(brace
id|si
op_add_assign
id|st-&gt;tbl
(braket
id|st-&gt;txbits
(braket
id|j
)braket
)braket
suffix:semicolon
id|sq
op_add_assign
id|st-&gt;tbl
(braket
id|st-&gt;txbits
(braket
id|j
)braket
op_plus
l_int|8
)braket
suffix:semicolon
)brace
op_star
id|buf
op_assign
(paren
(paren
id|si
op_star
id|COS
c_func
(paren
id|st-&gt;txphase
)paren
op_plus
id|sq
op_star
id|SIN
c_func
(paren
id|st-&gt;txphase
)paren
)paren
op_rshift
l_int|23
)paren
op_plus
l_int|0x80
suffix:semicolon
id|st-&gt;txphase
op_assign
(paren
id|st-&gt;txphase
op_plus
id|PSK48_PHASEINC
)paren
op_amp
l_int|0xffffu
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|modulator_4800_s16
r_static
r_void
id|modulator_4800_s16
c_func
(paren
r_struct
id|sm_state
op_star
id|sm
comma
r_int
op_star
id|buf
comma
r_int
r_int
id|buflen
)paren
(brace
r_struct
id|mod_state_psk48
op_star
id|st
op_assign
(paren
r_struct
id|mod_state_psk48
op_star
)paren
(paren
op_amp
id|sm-&gt;m
)paren
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_int
id|si
comma
id|sq
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|buflen
OG
l_int|0
suffix:semicolon
id|buflen
op_decrement
comma
id|buf
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|st-&gt;txseq
op_increment
)paren
(brace
id|memmove
c_func
(paren
id|st-&gt;txbits
op_plus
l_int|1
comma
id|st-&gt;txbits
comma
r_sizeof
(paren
id|st-&gt;txbits
)paren
op_minus
r_sizeof
(paren
id|st-&gt;txbits
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|st-&gt;shreg
op_le
l_int|1
)paren
id|st-&gt;shreg
op_assign
id|hdlcdrv_getbits
c_func
(paren
op_amp
id|sm-&gt;hdrv
)paren
op_or
l_int|0x10000
suffix:semicolon
id|st-&gt;scram
op_assign
(paren
id|st-&gt;scram
op_lshift
l_int|1
)paren
op_or
(paren
id|st-&gt;shreg
op_amp
l_int|1
)paren
suffix:semicolon
id|st-&gt;shreg
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;scram
op_amp
id|SCRAM_TAP1
)paren
id|st-&gt;scram
op_xor_assign
id|SCRAM_TAPN
suffix:semicolon
)brace
id|j
op_assign
(paren
id|st-&gt;scram
op_rshift
(paren
id|SCRAM_SHIFT
op_plus
l_int|3
)paren
)paren
op_amp
l_int|7
suffix:semicolon
id|st-&gt;txbits
(braket
l_int|0
)braket
op_sub_assign
(paren
id|j
op_xor
(paren
id|j
op_rshift
l_int|1
)paren
)paren
suffix:semicolon
id|st-&gt;txbits
(braket
l_int|0
)braket
op_and_assign
l_int|7
suffix:semicolon
id|st-&gt;tbl
op_assign
id|psk48_tx_table
suffix:semicolon
)brace
r_if
c_cond
(paren
id|st-&gt;txseq
op_ge
id|PSK48_TXF_OVERSAMPLING
)paren
id|st-&gt;txseq
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|si
op_assign
id|sq
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|PSK48_TXF_NUMSAMPLES
suffix:semicolon
id|j
op_increment
comma
id|st-&gt;tbl
op_add_assign
l_int|16
)paren
(brace
id|si
op_add_assign
id|st-&gt;tbl
(braket
id|st-&gt;txbits
(braket
id|j
)braket
)braket
suffix:semicolon
id|sq
op_add_assign
id|st-&gt;tbl
(braket
id|st-&gt;txbits
(braket
id|j
)braket
op_plus
l_int|8
)braket
suffix:semicolon
)brace
op_star
id|buf
op_assign
(paren
id|si
op_star
id|COS
c_func
(paren
id|st-&gt;txphase
)paren
op_plus
id|sq
op_star
id|SIN
c_func
(paren
id|st-&gt;txphase
)paren
)paren
op_rshift
l_int|15
suffix:semicolon
id|st-&gt;txphase
op_assign
(paren
id|st-&gt;txphase
op_plus
id|PSK48_PHASEINC
)paren
op_amp
l_int|0xffffu
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|tbl_atan
r_static
id|__inline__
r_int
r_int
id|tbl_atan
c_func
(paren
r_int
id|q
comma
r_int
id|i
)paren
(brace
r_int
id|tmp
suffix:semicolon
r_int
r_int
id|argoffs
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
op_logical_and
id|q
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
(paren
(paren
id|q
OL
l_int|0
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|i
OL
l_int|0
)paren
)paren
(brace
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|tmp
op_assign
id|q
suffix:semicolon
id|q
op_assign
op_minus
id|i
suffix:semicolon
id|i
op_assign
id|tmp
suffix:semicolon
id|argoffs
op_assign
l_int|0x4000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|q
op_assign
op_minus
id|q
suffix:semicolon
id|i
op_assign
op_minus
id|i
suffix:semicolon
id|argoffs
op_assign
l_int|0x8000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|tmp
op_assign
op_minus
id|q
suffix:semicolon
id|q
op_assign
id|i
suffix:semicolon
id|i
op_assign
id|tmp
suffix:semicolon
id|argoffs
op_assign
l_int|0xc000
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q
OG
id|i
)paren
(brace
id|tmp
op_assign
id|i
op_div
id|q
op_star
id|ATAN_TABLEN
suffix:semicolon
r_return
(paren
id|argoffs
op_plus
l_int|0x4000
op_minus
id|atan_tab
(braket
(paren
(paren
id|i
op_lshift
l_int|15
)paren
op_div
id|q
op_star
id|ATAN_TABLEN
op_rshift
l_int|15
)paren
)braket
)paren
op_amp
l_int|0xffffu
suffix:semicolon
)brace
r_return
(paren
id|argoffs
op_plus
id|atan_tab
(braket
(paren
(paren
id|q
op_lshift
l_int|15
)paren
op_div
id|i
op_star
id|ATAN_TABLEN
)paren
op_rshift
l_int|15
)braket
)paren
op_amp
l_int|0xffffu
suffix:semicolon
)brace
DECL|macro|ATAN
mdefine_line|#define ATAN(q,i) tbl_atan(q, i)
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|demod_psk48_baseband
r_static
r_void
id|demod_psk48_baseband
c_func
(paren
r_struct
id|sm_state
op_star
id|sm
comma
r_struct
id|demod_state_psk48
op_star
id|st
comma
r_int
id|vali
comma
r_int
id|valq
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|st-&gt;magi
op_assign
id|vali
suffix:semicolon
id|st-&gt;magq
op_assign
id|valq
suffix:semicolon
id|memmove
c_func
(paren
id|st-&gt;pwrhist
op_plus
l_int|1
comma
id|st-&gt;pwrhist
comma
r_sizeof
(paren
id|st-&gt;pwrhist
)paren
op_minus
r_sizeof
(paren
id|st-&gt;pwrhist
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|st-&gt;pwrhist
(braket
l_int|0
)braket
op_assign
id|st-&gt;magi
op_star
id|st-&gt;magi
op_plus
id|st-&gt;magq
op_star
id|st-&gt;magq
suffix:semicolon
id|st-&gt;cur_sync
op_assign
(paren
(paren
id|st-&gt;pwrhist
(braket
l_int|4
)braket
op_rshift
l_int|2
)paren
OG
id|st-&gt;pwrhist
(braket
l_int|2
)braket
op_logical_and
(paren
id|st-&gt;pwrhist
(braket
l_int|0
)braket
op_rshift
l_int|2
)paren
OG
id|st-&gt;pwrhist
(braket
l_int|2
)braket
op_logical_and
id|st
op_member_access_from_pointer
id|pwrhist
(braket
l_int|3
)braket
OG
id|st-&gt;pwrhist
(braket
l_int|2
)braket
op_logical_and
id|st-&gt;pwrhist
(braket
l_int|1
)braket
OG
id|st-&gt;pwrhist
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|st-&gt;s_phase
op_and_assign
l_int|0xffff
suffix:semicolon
id|st-&gt;s_phase
op_add_assign
id|PSK48_SPHASEINC
suffix:semicolon
id|st-&gt;dcd_shreg
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;cur_sync
)paren
(brace
r_if
c_cond
(paren
id|st-&gt;s_phase
op_ge
(paren
l_int|0x8000
op_plus
l_int|5
op_star
id|PSK48_SPHASEINC
op_div
l_int|2
)paren
)paren
id|st-&gt;s_phase
op_sub_assign
id|PSK48_SPHASEINC
op_div
l_int|6
suffix:semicolon
r_else
id|st-&gt;s_phase
op_add_assign
id|PSK48_SPHASEINC
op_div
l_int|6
suffix:semicolon
id|st-&gt;dcd_sum0
op_assign
l_int|4
op_star
id|hweight8
c_func
(paren
id|st-&gt;dcd_shreg
op_amp
l_int|0xf8
)paren
op_minus
id|hweight16
c_func
(paren
id|st-&gt;dcd_shreg
op_amp
l_int|0x1f00
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_decrement
id|st-&gt;dcd_time
)paren
op_le
l_int|0
)paren
(brace
id|hdlcdrv_setdcd
c_func
(paren
op_amp
id|sm-&gt;hdrv
comma
(paren
id|st-&gt;dcd_sum0
op_plus
id|st-&gt;dcd_sum1
op_plus
id|st-&gt;dcd_sum2
)paren
OL
l_int|0
)paren
suffix:semicolon
id|st-&gt;dcd_sum2
op_assign
id|st-&gt;dcd_sum1
suffix:semicolon
id|st-&gt;dcd_sum1
op_assign
id|st-&gt;dcd_sum0
suffix:semicolon
id|st-&gt;dcd_sum0
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* slight bias */
id|st-&gt;dcd_time
op_assign
l_int|240
suffix:semicolon
)brace
r_if
c_cond
(paren
id|st-&gt;s_phase
OL
l_int|0x10000
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t; * sample one constellation&n;&t; */
id|st-&gt;last_pskph
op_assign
id|st-&gt;pskph
suffix:semicolon
id|st-&gt;pskph
op_assign
(paren
id|ATAN
c_func
(paren
id|st-&gt;magq
comma
id|st-&gt;magi
)paren
op_minus
id|st-&gt;phase
)paren
op_amp
l_int|0xffffu
suffix:semicolon
id|st-&gt;last_ph_err
op_assign
(paren
id|st-&gt;pskph
op_amp
l_int|0x1fffu
)paren
op_minus
l_int|0x1000
suffix:semicolon
id|st-&gt;phase
op_add_assign
id|st-&gt;last_ph_err
op_div
l_int|16
suffix:semicolon
id|st-&gt;last_raw
op_assign
id|st-&gt;cur_raw
suffix:semicolon
id|st-&gt;cur_raw
op_assign
(paren
(paren
id|st-&gt;pskph
op_rshift
l_int|13
)paren
op_amp
l_int|7
)paren
suffix:semicolon
id|i
op_assign
(paren
id|st-&gt;cur_raw
op_minus
id|st-&gt;last_raw
)paren
op_amp
l_int|7
suffix:semicolon
id|st-&gt;rawbits
op_assign
id|i
op_xor
(paren
id|i
op_rshift
l_int|1
)paren
op_xor
(paren
id|i
op_rshift
l_int|2
)paren
suffix:semicolon
id|st-&gt;descram
op_assign
(paren
id|st-&gt;descram
op_lshift
l_int|3
)paren
op_or
(paren
id|st-&gt;rawbits
)paren
suffix:semicolon
id|hdlcdrv_channelbit
c_func
(paren
op_amp
id|sm-&gt;hdrv
comma
id|st-&gt;descram
op_amp
l_int|4
)paren
suffix:semicolon
id|hdlcdrv_channelbit
c_func
(paren
op_amp
id|sm-&gt;hdrv
comma
id|st-&gt;descram
op_amp
l_int|2
)paren
suffix:semicolon
id|hdlcdrv_channelbit
c_func
(paren
op_amp
id|sm-&gt;hdrv
comma
id|st-&gt;descram
op_amp
l_int|1
)paren
suffix:semicolon
id|i
op_assign
(paren
(paren
(paren
id|st-&gt;descram
op_rshift
id|DESCRAM_TAPSH1
)paren
op_amp
l_int|7
)paren
op_xor
(paren
(paren
id|st-&gt;descram
op_rshift
id|DESCRAM_TAPSH2
)paren
op_amp
l_int|7
)paren
op_xor
(paren
(paren
id|st-&gt;descram
op_rshift
id|DESCRAM_TAPSH3
)paren
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|4
suffix:semicolon
id|j
suffix:semicolon
id|j
op_rshift_assign
l_int|1
)paren
(brace
id|st-&gt;shreg
op_rshift_assign
l_int|1
suffix:semicolon
id|st-&gt;shreg
op_or_assign
(paren
op_logical_neg
op_logical_neg
(paren
id|i
op_amp
id|j
)paren
)paren
op_lshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;shreg
op_amp
l_int|1
)paren
(brace
id|hdlcdrv_putbits
c_func
(paren
op_amp
id|sm-&gt;hdrv
comma
id|st-&gt;shreg
op_rshift
l_int|1
)paren
suffix:semicolon
id|st-&gt;shreg
op_assign
l_int|0x10000
suffix:semicolon
)brace
)brace
macro_line|#if 0
id|st-&gt;dcd_shreg
op_lshift_assign
l_int|1
suffix:semicolon
id|st-&gt;bit_pll
op_add_assign
l_int|0x4000
suffix:semicolon
id|curbit
op_assign
(paren
op_star
id|buf
op_ge
l_int|0x80
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;last_sample
op_xor
id|curbit
)paren
(brace
id|st-&gt;dcd_shreg
op_or_assign
l_int|1
suffix:semicolon
id|st-&gt;bit_pll
op_add_assign
id|pll_corr
(braket
id|st-&gt;bit_pll
OL
l_int|0xa000
)braket
suffix:semicolon
id|st-&gt;dcd_sum0
op_add_assign
l_int|8
op_star
id|hweight8
c_func
(paren
id|st-&gt;dcd_shreg
op_amp
l_int|0x0c
)paren
op_minus
op_logical_neg
op_logical_neg
(paren
id|st-&gt;dcd_shreg
op_amp
l_int|0x10
)paren
suffix:semicolon
)brace
id|st-&gt;last_sample
op_assign
id|curbit
suffix:semicolon
id|hdlcdrv_channelbit
c_func
(paren
op_amp
id|sm-&gt;hdrv
comma
id|st-&gt;last_sample
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_decrement
id|st-&gt;dcd_time
)paren
op_le
l_int|0
)paren
(brace
id|hdlcdrv_setdcd
c_func
(paren
op_amp
id|sm-&gt;hdrv
comma
(paren
id|st-&gt;dcd_sum0
op_plus
id|st-&gt;dcd_sum1
op_plus
id|st-&gt;dcd_sum2
)paren
OL
l_int|0
)paren
suffix:semicolon
id|st-&gt;dcd_sum2
op_assign
id|st-&gt;dcd_sum1
suffix:semicolon
id|st-&gt;dcd_sum1
op_assign
id|st-&gt;dcd_sum0
suffix:semicolon
id|st-&gt;dcd_sum0
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* slight bias */
id|st-&gt;dcd_time
op_assign
l_int|240
suffix:semicolon
)brace
r_if
c_cond
(paren
id|st-&gt;bit_pll
op_ge
l_int|0x10000
)paren
(brace
id|st-&gt;bit_pll
op_and_assign
l_int|0xffffu
suffix:semicolon
id|st-&gt;descram
op_assign
(paren
id|st-&gt;descram
op_lshift
l_int|1
)paren
op_or
id|curbit
suffix:semicolon
id|descx
op_assign
id|st-&gt;descram
op_xor
(paren
id|st-&gt;descram
op_rshift
l_int|1
)paren
suffix:semicolon
id|descx
op_xor_assign
(paren
(paren
id|descx
op_rshift
id|DESCRAM_TAPSH1
)paren
op_xor
(paren
id|descx
op_rshift
id|DESCRAM_TAPSH2
)paren
)paren
suffix:semicolon
id|st-&gt;shreg
op_rshift_assign
l_int|1
suffix:semicolon
id|st-&gt;shreg
op_or_assign
(paren
op_logical_neg
(paren
id|descx
op_amp
l_int|1
)paren
)paren
op_lshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;shreg
op_amp
l_int|1
)paren
(brace
id|hdlcdrv_putbits
c_func
(paren
op_amp
id|sm-&gt;hdrv
comma
id|st-&gt;shreg
op_rshift
l_int|1
)paren
suffix:semicolon
id|st-&gt;shreg
op_assign
l_int|0x10000
suffix:semicolon
)brace
id|diag_trigger
c_func
(paren
id|sm
)paren
suffix:semicolon
)brace
id|diag_add_one
c_func
(paren
id|sm
comma
(paren
(paren
r_int
)paren
(paren
op_star
id|buf
op_minus
l_int|0x80
)paren
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
macro_line|#endif
id|diag_trigger
c_func
(paren
id|sm
)paren
suffix:semicolon
id|diag_add_constellation
c_func
(paren
id|sm
comma
(paren
id|vali
op_star
id|COS
c_func
(paren
id|st-&gt;phase
)paren
op_plus
id|valq
op_star
id|SIN
c_func
(paren
id|st-&gt;phase
)paren
)paren
op_rshift
l_int|13
comma
(paren
id|valq
op_star
id|COS
c_func
(paren
id|st-&gt;phase
)paren
op_minus
id|vali
op_star
id|SIN
c_func
(paren
id|st-&gt;phase
)paren
)paren
op_rshift
l_int|13
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|demodulator_4800_u8
r_static
r_void
id|demodulator_4800_u8
c_func
(paren
r_struct
id|sm_state
op_star
id|sm
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
r_int
id|buflen
)paren
(brace
r_struct
id|demod_state_psk48
op_star
id|st
op_assign
(paren
r_struct
id|demod_state_psk48
op_star
)paren
(paren
op_amp
id|sm-&gt;d
)paren
suffix:semicolon
r_int
id|i
comma
id|si
comma
id|sq
suffix:semicolon
r_const
r_int
op_star
id|coeff
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|buflen
OG
l_int|0
suffix:semicolon
id|buflen
op_decrement
comma
id|buf
op_increment
)paren
(brace
id|memmove
c_func
(paren
id|st-&gt;infi
op_plus
l_int|1
comma
id|st-&gt;infi
comma
r_sizeof
(paren
id|st-&gt;infi
)paren
op_minus
r_sizeof
(paren
id|st-&gt;infi
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|memmove
c_func
(paren
id|st-&gt;infq
op_plus
l_int|1
comma
id|st-&gt;infq
comma
r_sizeof
(paren
id|st-&gt;infq
)paren
op_minus
r_sizeof
(paren
id|st-&gt;infq
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|si
op_assign
op_star
id|buf
suffix:semicolon
id|si
op_and_assign
l_int|0xff
suffix:semicolon
id|si
op_sub_assign
l_int|128
suffix:semicolon
id|diag_add_one
c_func
(paren
id|sm
comma
id|si
op_lshift
l_int|8
)paren
suffix:semicolon
id|st-&gt;infi
(braket
l_int|0
)braket
op_assign
(paren
id|si
op_star
id|COS
c_func
(paren
id|st-&gt;downmixer
)paren
)paren
op_rshift
l_int|7
suffix:semicolon
id|st-&gt;infq
(braket
l_int|0
)braket
op_assign
(paren
id|si
op_star
id|SIN
c_func
(paren
id|st-&gt;downmixer
)paren
)paren
op_rshift
l_int|7
suffix:semicolon
id|st-&gt;downmixer
op_assign
(paren
id|st-&gt;downmixer
op_minus
id|PSK48_PHASEINC
)paren
op_amp
l_int|0xffffu
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|si
op_assign
id|sq
op_assign
l_int|0
comma
id|coeff
op_assign
id|psk48_rx_coeff
suffix:semicolon
id|i
OL
(paren
id|PSK48_RXF_LEN
op_div
l_int|2
)paren
suffix:semicolon
id|i
op_increment
comma
id|coeff
op_add_assign
l_int|2
)paren
(brace
id|si
op_add_assign
id|st-&gt;infi
(braket
id|i
)braket
op_star
(paren
op_star
id|coeff
)paren
suffix:semicolon
id|sq
op_add_assign
id|st-&gt;infq
(braket
id|i
)braket
op_star
(paren
op_star
id|coeff
)paren
suffix:semicolon
)brace
id|demod_psk48_baseband
c_func
(paren
id|sm
comma
id|st
comma
id|si
op_rshift
l_int|15
comma
id|sq
op_rshift
l_int|15
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|si
op_assign
id|sq
op_assign
l_int|0
comma
id|coeff
op_assign
id|psk48_rx_coeff
op_plus
l_int|1
suffix:semicolon
id|i
OL
(paren
id|PSK48_RXF_LEN
op_div
l_int|2
)paren
suffix:semicolon
id|i
op_increment
comma
id|coeff
op_add_assign
l_int|2
)paren
(brace
id|si
op_add_assign
id|st-&gt;infi
(braket
id|i
)braket
op_star
(paren
op_star
id|coeff
)paren
suffix:semicolon
id|sq
op_add_assign
id|st-&gt;infq
(braket
id|i
)braket
op_star
(paren
op_star
id|coeff
)paren
suffix:semicolon
)brace
id|demod_psk48_baseband
c_func
(paren
id|sm
comma
id|st
comma
id|si
op_rshift
l_int|15
comma
id|sq
op_rshift
l_int|15
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|demodulator_4800_s16
r_static
r_void
id|demodulator_4800_s16
c_func
(paren
r_struct
id|sm_state
op_star
id|sm
comma
r_const
r_int
op_star
id|buf
comma
r_int
r_int
id|buflen
)paren
(brace
r_struct
id|demod_state_psk48
op_star
id|st
op_assign
(paren
r_struct
id|demod_state_psk48
op_star
)paren
(paren
op_amp
id|sm-&gt;d
)paren
suffix:semicolon
r_int
id|i
comma
id|si
comma
id|sq
suffix:semicolon
r_const
r_int
op_star
id|coeff
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|buflen
OG
l_int|0
suffix:semicolon
id|buflen
op_decrement
comma
id|buf
op_increment
)paren
(brace
id|memmove
c_func
(paren
id|st-&gt;infi
op_plus
l_int|1
comma
id|st-&gt;infi
comma
r_sizeof
(paren
id|st-&gt;infi
)paren
op_minus
r_sizeof
(paren
id|st-&gt;infi
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|memmove
c_func
(paren
id|st-&gt;infq
op_plus
l_int|1
comma
id|st-&gt;infq
comma
r_sizeof
(paren
id|st-&gt;infq
)paren
op_minus
r_sizeof
(paren
id|st-&gt;infq
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|si
op_assign
op_star
id|buf
suffix:semicolon
id|diag_add_one
c_func
(paren
id|sm
comma
id|si
)paren
suffix:semicolon
id|st-&gt;infi
(braket
l_int|0
)braket
op_assign
(paren
id|si
op_star
id|COS
c_func
(paren
id|st-&gt;downmixer
)paren
)paren
op_rshift
l_int|15
suffix:semicolon
id|st-&gt;infq
(braket
l_int|0
)braket
op_assign
(paren
id|si
op_star
id|SIN
c_func
(paren
id|st-&gt;downmixer
)paren
)paren
op_rshift
l_int|15
suffix:semicolon
id|st-&gt;downmixer
op_assign
(paren
id|st-&gt;downmixer
op_minus
id|PSK48_PHASEINC
)paren
op_amp
l_int|0xffffu
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|si
op_assign
id|sq
op_assign
l_int|0
comma
id|coeff
op_assign
id|psk48_rx_coeff
suffix:semicolon
id|i
OL
(paren
id|PSK48_RXF_LEN
op_div
l_int|2
)paren
suffix:semicolon
id|i
op_increment
comma
id|coeff
op_add_assign
l_int|2
)paren
(brace
id|si
op_add_assign
id|st-&gt;infi
(braket
id|i
)braket
op_star
(paren
op_star
id|coeff
)paren
suffix:semicolon
id|sq
op_add_assign
id|st-&gt;infq
(braket
id|i
)braket
op_star
(paren
op_star
id|coeff
)paren
suffix:semicolon
)brace
id|demod_psk48_baseband
c_func
(paren
id|sm
comma
id|st
comma
id|si
op_rshift
l_int|15
comma
id|sq
op_rshift
l_int|15
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|si
op_assign
id|sq
op_assign
l_int|0
comma
id|coeff
op_assign
id|psk48_rx_coeff
op_plus
l_int|1
suffix:semicolon
id|i
OL
(paren
id|PSK48_RXF_LEN
op_div
l_int|2
)paren
suffix:semicolon
id|i
op_increment
comma
id|coeff
op_add_assign
l_int|2
)paren
(brace
id|si
op_add_assign
id|st-&gt;infi
(braket
id|i
)braket
op_star
(paren
op_star
id|coeff
)paren
suffix:semicolon
id|sq
op_add_assign
id|st-&gt;infq
(braket
id|i
)braket
op_star
(paren
op_star
id|coeff
)paren
suffix:semicolon
)brace
id|demod_psk48_baseband
c_func
(paren
id|sm
comma
id|st
comma
id|si
op_rshift
l_int|15
comma
id|sq
op_rshift
l_int|15
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|mod_init_4800
r_static
r_void
id|mod_init_4800
c_func
(paren
r_struct
id|sm_state
op_star
id|sm
)paren
(brace
r_struct
id|mod_state_psk48
op_star
id|st
op_assign
(paren
r_struct
id|mod_state_psk48
op_star
)paren
(paren
op_amp
id|sm-&gt;m
)paren
suffix:semicolon
id|st-&gt;scram
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|demod_init_4800
r_static
r_void
id|demod_init_4800
c_func
(paren
r_struct
id|sm_state
op_star
id|sm
)paren
(brace
r_struct
id|demod_state_psk48
op_star
id|st
op_assign
(paren
r_struct
id|demod_state_psk48
op_star
)paren
(paren
op_amp
id|sm-&gt;d
)paren
suffix:semicolon
id|st-&gt;dcd_time
op_assign
l_int|120
suffix:semicolon
id|st-&gt;dcd_sum0
op_assign
l_int|2
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|sm_psk4800_tx
r_const
r_struct
id|modem_tx_info
id|sm_psk4800_tx
op_assign
(brace
l_string|&quot;psk4800&quot;
comma
r_sizeof
(paren
r_struct
id|mod_state_psk48
)paren
comma
id|PSK48_SAMPLERATE
comma
l_int|4800
comma
id|modulator_4800_u8
comma
id|modulator_4800_s16
comma
id|mod_init_4800
)brace
suffix:semicolon
DECL|variable|sm_psk4800_rx
r_const
r_struct
id|modem_rx_info
id|sm_psk4800_rx
op_assign
(brace
l_string|&quot;psk4800&quot;
comma
r_sizeof
(paren
r_struct
id|demod_state_psk48
)paren
comma
id|PSK48_SAMPLERATE
comma
l_int|4800
comma
l_int|1
comma
id|PSK48_TXF_OVERSAMPLING
comma
id|demodulator_4800_u8
comma
id|demodulator_4800_s16
comma
id|demod_init_4800
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
eof
