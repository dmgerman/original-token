multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&t;sm.c  -- soundcard radio modem driver.&n; *&n; *&t;Copyright (C) 1996-2000  Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;This program is distributed in the hope that it will be useful,&n; *&t;but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *&t;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *&t;GNU General Public License for more details.&n; *&n; *&t;You should have received a copy of the GNU General Public License&n; *&t;along with this program; if not, write to the Free Software&n; *&t;Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *  Please note that the GPL allows you to use the driver, NOT the radio.&n; *  In order to use the radio, you need a license from the communications&n; *  authority of your country.&n; *&n; *&n; *  Command line options (insmod command line)&n; *&n; *  mode     mode string; eg. &quot;wss:afsk1200&quot;&n; *  iobase   base address of the soundcard; common values are 0x220 for sbc,&n; *           0x530 for wss&n; *  irq      interrupt number; common values are 7 or 5 for sbc, 11 for wss&n; *  dma      dma number; common values are 0 or 1&n; *&n; *&n; *  History:&n; *   0.1  21.09.1996  Started&n; *        18.10.1996  Changed to new user space access routines (copy_{to,from}_user)&n; *   0.4  21.01.1997  Separately compileable soundcard/modem modules&n; *   0.5  03.03.1997  fixed LPT probing (check_lpt result was interpreted the wrong way round)&n; *   0.6  16.04.1997  init code/data tagged&n; *   0.7  30.07.1997  fixed halfduplex interrupt handlers/hotfix for CS423X&n; *   0.8  14.04.1998  cleanups&n; *   0.9  03.08.1999  adapt to Linus&squot; new __setup/__initcall&n; *                    use parport lowlevel drivers instead of directly writing to a parallel port&n; *                    removed some pre-2.2 kernel compatibility cruft&n; *   0.10 10.08.1999  Check if parport can do SPP and is safe to access during interrupt contexts&n; *   0.11 12.02.2000  adapted to softnet driver interface&n; *   0.12 03.07.2000  fix interface name handling&n; */
multiline_comment|/*****************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/parport.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;sm.h&quot;
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|sm_drvname
multiline_comment|/*static*/
r_const
r_char
id|sm_drvname
(braket
)braket
op_assign
l_string|&quot;soundmodem&quot;
suffix:semicolon
DECL|variable|sm_drvinfo
r_static
r_const
r_char
id|sm_drvinfo
(braket
)braket
op_assign
id|KERN_INFO
l_string|&quot;soundmodem: (C) 1996-2000 Thomas Sailer, HB9JNX/AE4WA&bslash;n&quot;
id|KERN_INFO
l_string|&quot;soundmodem: version 0.12 compiled &quot;
id|__TIME__
l_string|&quot; &quot;
id|__DATE__
l_string|&quot;&bslash;n&quot;
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|sm_modem_tx_table
multiline_comment|/*static*/
r_const
r_struct
id|modem_tx_info
op_star
id|sm_modem_tx_table
(braket
)braket
op_assign
(brace
macro_line|#ifdef CONFIG_SOUNDMODEM_AFSK1200
op_amp
id|sm_afsk1200_tx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_AFSK1200 */
macro_line|#ifdef CONFIG_SOUNDMODEM_AFSK2400_7
op_amp
id|sm_afsk2400_7_tx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_AFSK2400_7 */
macro_line|#ifdef CONFIG_SOUNDMODEM_AFSK2400_8
op_amp
id|sm_afsk2400_8_tx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_AFSK2400_8 */
macro_line|#ifdef CONFIG_SOUNDMODEM_AFSK2666
op_amp
id|sm_afsk2666_tx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_AFSK2666 */
macro_line|#ifdef CONFIG_SOUNDMODEM_PSK4800
op_amp
id|sm_psk4800_tx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_PSK4800 */
macro_line|#ifdef CONFIG_SOUNDMODEM_HAPN4800
op_amp
id|sm_hapn4800_8_tx
comma
op_amp
id|sm_hapn4800_10_tx
comma
op_amp
id|sm_hapn4800_pm8_tx
comma
op_amp
id|sm_hapn4800_pm10_tx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_HAPN4800 */
macro_line|#ifdef CONFIG_SOUNDMODEM_FSK9600
op_amp
id|sm_fsk9600_4_tx
comma
op_amp
id|sm_fsk9600_5_tx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_FSK9600 */
l_int|NULL
)brace
suffix:semicolon
DECL|variable|sm_modem_rx_table
multiline_comment|/*static*/
r_const
r_struct
id|modem_rx_info
op_star
id|sm_modem_rx_table
(braket
)braket
op_assign
(brace
macro_line|#ifdef CONFIG_SOUNDMODEM_AFSK1200
op_amp
id|sm_afsk1200_rx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_AFSK1200 */
macro_line|#ifdef CONFIG_SOUNDMODEM_AFSK2400_7
op_amp
id|sm_afsk2400_7_rx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_AFSK2400_7 */
macro_line|#ifdef CONFIG_SOUNDMODEM_AFSK2400_8
op_amp
id|sm_afsk2400_8_rx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_AFSK2400_8 */
macro_line|#ifdef CONFIG_SOUNDMODEM_AFSK2666
op_amp
id|sm_afsk2666_rx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_AFSK2666 */
macro_line|#ifdef CONFIG_SOUNDMODEM_PSK4800
op_amp
id|sm_psk4800_rx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_PSK4800 */
macro_line|#ifdef CONFIG_SOUNDMODEM_HAPN4800
op_amp
id|sm_hapn4800_8_rx
comma
op_amp
id|sm_hapn4800_10_rx
comma
op_amp
id|sm_hapn4800_pm8_rx
comma
op_amp
id|sm_hapn4800_pm10_rx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_HAPN4800 */
macro_line|#ifdef CONFIG_SOUNDMODEM_FSK9600
op_amp
id|sm_fsk9600_4_rx
comma
op_amp
id|sm_fsk9600_5_rx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_FSK9600 */
l_int|NULL
)brace
suffix:semicolon
DECL|variable|sm_hardware_table
r_static
r_const
r_struct
id|hardware_info
op_star
id|sm_hardware_table
(braket
)braket
op_assign
(brace
macro_line|#ifdef CONFIG_SOUNDMODEM_SBC
op_amp
id|sm_hw_sbc
comma
op_amp
id|sm_hw_sbcfdx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_SBC */
macro_line|#ifdef CONFIG_SOUNDMODEM_WSS
op_amp
id|sm_hw_wss
comma
op_amp
id|sm_hw_wssfdx
comma
macro_line|#endif /* CONFIG_SOUNDMODEM_WSS */
l_int|NULL
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|NR_PORTS
mdefine_line|#define NR_PORTS 4
DECL|variable|sm_device
r_static
r_struct
id|net_device
id|sm_device
(braket
id|NR_PORTS
)braket
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|UART_RBR
mdefine_line|#define UART_RBR(iobase) (iobase+0)
DECL|macro|UART_THR
mdefine_line|#define UART_THR(iobase) (iobase+0)
DECL|macro|UART_IER
mdefine_line|#define UART_IER(iobase) (iobase+1)
DECL|macro|UART_IIR
mdefine_line|#define UART_IIR(iobase) (iobase+2)
DECL|macro|UART_FCR
mdefine_line|#define UART_FCR(iobase) (iobase+2)
DECL|macro|UART_LCR
mdefine_line|#define UART_LCR(iobase) (iobase+3)
DECL|macro|UART_MCR
mdefine_line|#define UART_MCR(iobase) (iobase+4)
DECL|macro|UART_LSR
mdefine_line|#define UART_LSR(iobase) (iobase+5)
DECL|macro|UART_MSR
mdefine_line|#define UART_MSR(iobase) (iobase+6)
DECL|macro|UART_SCR
mdefine_line|#define UART_SCR(iobase) (iobase+7)
DECL|macro|UART_DLL
mdefine_line|#define UART_DLL(iobase) (iobase+0)
DECL|macro|UART_DLM
mdefine_line|#define UART_DLM(iobase) (iobase+1)
DECL|macro|SER_EXTENT
mdefine_line|#define SER_EXTENT 8
DECL|macro|MIDI_DATA
mdefine_line|#define MIDI_DATA(iobase)     (iobase)
DECL|macro|MIDI_STATUS
mdefine_line|#define MIDI_STATUS(iobase)   (iobase+1)
DECL|macro|MIDI_READ_FULL
mdefine_line|#define MIDI_READ_FULL 0x80   /* attention: negative logic!! */
DECL|macro|MIDI_WRITE_EMPTY
mdefine_line|#define MIDI_WRITE_EMPTY 0x40 /* attention: negative logic!! */
DECL|macro|MIDI_EXTENT
mdefine_line|#define MIDI_EXTENT 2
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|macro|PARAM_TXDELAY
mdefine_line|#define PARAM_TXDELAY   1
DECL|macro|PARAM_PERSIST
mdefine_line|#define PARAM_PERSIST   2
DECL|macro|PARAM_SLOTTIME
mdefine_line|#define PARAM_SLOTTIME  3
DECL|macro|PARAM_TXTAIL
mdefine_line|#define PARAM_TXTAIL    4
DECL|macro|PARAM_FULLDUP
mdefine_line|#define PARAM_FULLDUP   5
DECL|macro|PARAM_HARDWARE
mdefine_line|#define PARAM_HARDWARE  6
DECL|macro|PARAM_RETURN
mdefine_line|#define PARAM_RETURN    255
DECL|macro|SP_SER
mdefine_line|#define SP_SER  1
DECL|macro|SP_PAR
mdefine_line|#define SP_PAR  2
DECL|macro|SP_MIDI
mdefine_line|#define SP_MIDI 4
multiline_comment|/*&n; * ===================== port checking routines ========================&n; */
DECL|enum|uart
DECL|enumerator|c_uart_unknown
DECL|enumerator|c_uart_8250
r_enum
id|uart
(brace
id|c_uart_unknown
comma
id|c_uart_8250
comma
DECL|enumerator|c_uart_16450
DECL|enumerator|c_uart_16550
DECL|enumerator|c_uart_16550A
id|c_uart_16450
comma
id|c_uart_16550
comma
id|c_uart_16550A
)brace
suffix:semicolon
DECL|variable|uart_str
r_static
r_const
r_char
op_star
id|uart_str
(braket
)braket
op_assign
(brace
l_string|&quot;unknown&quot;
comma
l_string|&quot;8250&quot;
comma
l_string|&quot;16450&quot;
comma
l_string|&quot;16550&quot;
comma
l_string|&quot;16550A&quot;
)brace
suffix:semicolon
DECL|function|check_uart
r_static
r_enum
id|uart
id|check_uart
c_func
(paren
r_int
r_int
id|iobase
)paren
(brace
r_int
r_char
id|b1
comma
id|b2
comma
id|b3
suffix:semicolon
r_enum
id|uart
id|u
suffix:semicolon
r_enum
id|uart
id|uart_tab
(braket
)braket
op_assign
(brace
id|c_uart_16450
comma
id|c_uart_unknown
comma
id|c_uart_16550
comma
id|c_uart_16550A
)brace
suffix:semicolon
r_if
c_cond
(paren
id|iobase
op_le
l_int|0
op_logical_or
id|iobase
OG
l_int|0x1000
op_minus
id|SER_EXTENT
)paren
r_return
id|c_uart_unknown
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|iobase
comma
id|SER_EXTENT
)paren
)paren
r_return
id|c_uart_unknown
suffix:semicolon
id|b1
op_assign
id|inb
c_func
(paren
id|UART_MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|b1
op_or
l_int|0x10
comma
id|UART_MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
multiline_comment|/* loopback mode */
id|b2
op_assign
id|inb
c_func
(paren
id|UART_MSR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x1a
comma
id|UART_MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|b3
op_assign
id|inb
c_func
(paren
id|UART_MSR
c_func
(paren
id|iobase
)paren
)paren
op_amp
l_int|0xf0
suffix:semicolon
id|outb
c_func
(paren
id|b1
comma
id|UART_MCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
multiline_comment|/* restore old values */
id|outb
c_func
(paren
id|b2
comma
id|UART_MSR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b3
op_ne
l_int|0x90
)paren
r_return
id|c_uart_unknown
suffix:semicolon
id|inb
c_func
(paren
id|UART_RBR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|inb
c_func
(paren
id|UART_RBR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|UART_FCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
multiline_comment|/* enable FIFOs */
id|u
op_assign
id|uart_tab
(braket
(paren
id|inb
c_func
(paren
id|UART_IIR
c_func
(paren
id|iobase
)paren
)paren
op_rshift
l_int|6
)paren
op_amp
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
id|u
op_eq
id|c_uart_16450
)paren
(brace
id|outb
c_func
(paren
l_int|0x5a
comma
id|UART_SCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|b1
op_assign
id|inb
c_func
(paren
id|UART_SCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xa5
comma
id|UART_SCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|b2
op_assign
id|inb
c_func
(paren
id|UART_SCR
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b1
op_ne
l_int|0x5a
)paren
op_logical_or
(paren
id|b2
op_ne
l_int|0xa5
)paren
)paren
id|u
op_assign
id|c_uart_8250
suffix:semicolon
)brace
r_return
id|u
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|check_midi
r_static
r_int
id|check_midi
c_func
(paren
r_int
r_int
id|iobase
)paren
(brace
r_int
r_int
id|timeout
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|b
suffix:semicolon
r_if
c_cond
(paren
id|iobase
op_le
l_int|0
op_logical_or
id|iobase
OG
l_int|0x1000
op_minus
id|MIDI_EXTENT
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|iobase
comma
id|MIDI_EXTENT
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|timeout
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|100
)paren
suffix:semicolon
r_while
c_loop
(paren
id|inb
c_func
(paren
id|MIDI_STATUS
c_func
(paren
id|iobase
)paren
)paren
op_amp
id|MIDI_WRITE_EMPTY
)paren
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|jiffies
op_minus
id|timeout
)paren
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|MIDI_DATA
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|b
op_assign
id|inb
c_func
(paren
id|MIDI_STATUS
c_func
(paren
id|iobase
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|b
op_amp
id|MIDI_WRITE_EMPTY
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|inb
c_func
(paren
id|MIDI_STATUS
c_func
(paren
id|iobase
)paren
)paren
op_amp
id|MIDI_WRITE_EMPTY
)paren
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|jiffies
op_minus
id|timeout
)paren
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sm_output_status
r_void
id|sm_output_status
c_func
(paren
r_struct
id|sm_state
op_star
id|sm
)paren
(brace
r_int
id|invert_dcd
op_assign
l_int|0
suffix:semicolon
r_int
id|invert_ptt
op_assign
l_int|0
suffix:semicolon
r_int
id|ptt
op_assign
multiline_comment|/*hdlcdrv_ptt(&amp;sm-&gt;hdrv)*/
(paren
id|sm-&gt;dma.ptt_cnt
OG
l_int|0
)paren
op_xor
id|invert_ptt
suffix:semicolon
r_int
id|dcd
op_assign
(paren
op_logical_neg
op_logical_neg
id|sm-&gt;hdrv.hdlcrx.dcd
)paren
op_xor
id|invert_dcd
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.flags
op_amp
id|SP_SER
)paren
(brace
id|outb
c_func
(paren
id|dcd
op_or
(paren
id|ptt
op_lshift
l_int|1
)paren
comma
id|UART_MCR
c_func
(paren
id|sm-&gt;hdrv.ptt_out.seriobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x40
op_amp
(paren
op_minus
id|ptt
)paren
comma
id|UART_LCR
c_func
(paren
id|sm-&gt;hdrv.ptt_out.seriobase
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.flags
op_amp
id|SP_PAR
op_logical_and
id|sm-&gt;pardev
op_logical_and
id|sm-&gt;pardev-&gt;port
)paren
id|parport_write_data
c_func
(paren
id|sm-&gt;pardev-&gt;port
comma
id|ptt
op_or
(paren
id|dcd
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.flags
op_amp
id|SP_MIDI
op_logical_and
id|hdlcdrv_ptt
c_func
(paren
op_amp
id|sm-&gt;hdrv
)paren
)paren
id|outb
c_func
(paren
l_int|0
comma
id|MIDI_DATA
c_func
(paren
id|sm-&gt;hdrv.ptt_out.midiiobase
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sm_output_open
r_static
r_void
id|sm_output_open
c_func
(paren
r_struct
id|sm_state
op_star
id|sm
comma
r_const
r_char
op_star
id|ifname
)paren
(brace
r_enum
id|uart
id|u
op_assign
id|c_uart_unknown
suffix:semicolon
r_struct
id|parport
op_star
id|pp
op_assign
l_int|NULL
suffix:semicolon
id|sm-&gt;hdrv.ptt_out.flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.seriobase
OG
l_int|0
op_logical_and
id|sm-&gt;hdrv.ptt_out.seriobase
op_le
l_int|0x1000
op_minus
id|SER_EXTENT
op_logical_and
(paren
(paren
id|u
op_assign
id|check_uart
c_func
(paren
id|sm-&gt;hdrv.ptt_out.seriobase
)paren
)paren
)paren
op_ne
id|c_uart_unknown
)paren
(brace
id|sm-&gt;hdrv.ptt_out.flags
op_or_assign
id|SP_SER
suffix:semicolon
id|request_region
c_func
(paren
id|sm-&gt;hdrv.ptt_out.seriobase
comma
id|SER_EXTENT
comma
l_string|&quot;sm ser ptt&quot;
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|UART_IER
c_func
(paren
id|sm-&gt;hdrv.ptt_out.seriobase
)paren
)paren
suffix:semicolon
multiline_comment|/* 5 bits, 1 stop, no parity, no break, Div latch access */
id|outb
c_func
(paren
l_int|0x80
comma
id|UART_LCR
c_func
(paren
id|sm-&gt;hdrv.ptt_out.seriobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|UART_DLM
c_func
(paren
id|sm-&gt;hdrv.ptt_out.seriobase
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
id|UART_DLL
c_func
(paren
id|sm-&gt;hdrv.ptt_out.seriobase
)paren
)paren
suffix:semicolon
multiline_comment|/* as fast as possible */
multiline_comment|/* LCR and MCR set by output_status */
)brace
id|sm-&gt;pardev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.pariobase
OG
l_int|0
)paren
(brace
id|pp
op_assign
id|parport_enumerate
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|pp
op_logical_and
id|pp-&gt;base
op_ne
id|sm-&gt;hdrv.ptt_out.pariobase
)paren
id|pp
op_assign
id|pp-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pp
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: parport at address 0x%x not found&bslash;n&quot;
comma
id|sm_drvname
comma
id|sm-&gt;hdrv.ptt_out.pariobase
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
op_complement
id|pp-&gt;modes
)paren
op_amp
(paren
id|PARPORT_MODE_PCSPP
op_or
id|PARPORT_MODE_SAFEININT
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: parport at address 0x%x cannot be used&bslash;n&quot;
comma
id|sm_drvname
comma
id|sm-&gt;hdrv.ptt_out.pariobase
)paren
suffix:semicolon
r_else
(brace
id|sm-&gt;pardev
op_assign
id|parport_register_device
c_func
(paren
id|pp
comma
id|ifname
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
id|PARPORT_DEV_EXCL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sm-&gt;pardev
)paren
(brace
id|pp
op_assign
l_int|NULL
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: cannot register parport device (address 0x%x)&bslash;n&quot;
comma
id|sm_drvname
comma
id|sm-&gt;hdrv.ptt_out.pariobase
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|parport_claim
c_func
(paren
id|sm-&gt;pardev
)paren
)paren
(brace
id|parport_unregister_device
c_func
(paren
id|sm-&gt;pardev
)paren
suffix:semicolon
id|sm-&gt;pardev
op_assign
l_int|NULL
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: cannot claim parport at address 0x%x&bslash;n&quot;
comma
id|sm_drvname
comma
id|sm-&gt;hdrv.ptt_out.pariobase
)paren
suffix:semicolon
)brace
r_else
id|sm-&gt;hdrv.ptt_out.flags
op_or_assign
id|SP_PAR
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.midiiobase
OG
l_int|0
op_logical_and
id|sm-&gt;hdrv.ptt_out.midiiobase
op_le
l_int|0x1000
op_minus
id|MIDI_EXTENT
op_logical_and
id|check_midi
c_func
(paren
id|sm-&gt;hdrv.ptt_out.midiiobase
)paren
)paren
(brace
id|sm-&gt;hdrv.ptt_out.flags
op_or_assign
id|SP_MIDI
suffix:semicolon
id|request_region
c_func
(paren
id|sm-&gt;hdrv.ptt_out.midiiobase
comma
id|MIDI_EXTENT
comma
l_string|&quot;sm midi ptt&quot;
)paren
suffix:semicolon
)brace
id|sm_output_status
c_func
(paren
id|sm
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: ptt output:&quot;
comma
id|sm_drvname
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.flags
op_amp
id|SP_SER
)paren
id|printk
c_func
(paren
l_string|&quot; serial interface at 0x%x, uart %s&quot;
comma
id|sm-&gt;hdrv.ptt_out.seriobase
comma
id|uart_str
(braket
id|u
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.flags
op_amp
id|SP_PAR
)paren
id|printk
c_func
(paren
l_string|&quot; parallel interface at 0x%x&quot;
comma
id|sm-&gt;hdrv.ptt_out.pariobase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.flags
op_amp
id|SP_MIDI
)paren
id|printk
c_func
(paren
l_string|&quot; mpu401 (midi) interface at 0x%x&quot;
comma
id|sm-&gt;hdrv.ptt_out.midiiobase
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sm-&gt;hdrv.ptt_out.flags
)paren
id|printk
c_func
(paren
l_string|&quot; none&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sm_output_close
r_static
r_void
id|sm_output_close
c_func
(paren
r_struct
id|sm_state
op_star
id|sm
)paren
(brace
multiline_comment|/* release regions used for PTT output */
id|sm-&gt;hdrv.hdlctx.ptt
op_assign
id|sm-&gt;hdrv.hdlctx.calibrate
op_assign
l_int|0
suffix:semicolon
id|sm_output_status
c_func
(paren
id|sm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.flags
op_amp
id|SP_SER
)paren
id|release_region
c_func
(paren
id|sm-&gt;hdrv.ptt_out.seriobase
comma
id|SER_EXTENT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.flags
op_amp
id|SP_PAR
op_logical_and
id|sm-&gt;pardev
)paren
(brace
id|parport_release
c_func
(paren
id|sm-&gt;pardev
)paren
suffix:semicolon
id|parport_unregister_device
c_func
(paren
id|sm-&gt;pardev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sm-&gt;hdrv.ptt_out.flags
op_amp
id|SP_MIDI
)paren
id|release_region
c_func
(paren
id|sm-&gt;hdrv.ptt_out.midiiobase
comma
id|MIDI_EXTENT
)paren
suffix:semicolon
id|sm-&gt;hdrv.ptt_out.flags
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
r_static
r_int
id|sm_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sm_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sm_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_struct
id|hdlcdrv_ioctl
op_star
id|hi
comma
r_int
id|cmd
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|sm_ops
r_static
r_const
r_struct
id|hdlcdrv_ops
id|sm_ops
op_assign
(brace
id|sm_drvname
comma
id|sm_drvinfo
comma
id|sm_open
comma
id|sm_close
comma
id|sm_ioctl
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sm_open
r_static
r_int
id|sm_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sm_state
op_star
id|sm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|dev-&gt;priv
op_logical_or
(paren
(paren
r_struct
id|sm_state
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|hdrv.magic
op_ne
id|HDLCDRV_MAGIC
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sm_open: invalid device struct&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sm
op_assign
(paren
r_struct
id|sm_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sm-&gt;mode_tx
op_logical_or
op_logical_neg
id|sm-&gt;mode_rx
op_logical_or
op_logical_neg
id|sm-&gt;hwdrv
op_logical_or
op_logical_neg
id|sm-&gt;hwdrv-&gt;open
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|sm-&gt;hdrv.par.bitrate
op_assign
id|sm-&gt;mode_rx-&gt;bitrate
suffix:semicolon
id|err
op_assign
id|sm-&gt;hwdrv
op_member_access_from_pointer
id|open
c_func
(paren
id|dev
comma
id|sm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|sm_output_open
c_func
(paren
id|sm
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s mode %s.%s at iobase 0x%lx irq %u dma %u dma2 %u&bslash;n&quot;
comma
id|sm_drvname
comma
id|sm-&gt;hwdrv-&gt;hw_name
comma
id|sm-&gt;mode_tx-&gt;name
comma
id|sm-&gt;mode_rx-&gt;name
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;irq
comma
id|dev-&gt;dma
comma
id|sm-&gt;hdrv.ptt_out.dma2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sm_close
r_static
r_int
id|sm_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sm_state
op_star
id|sm
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|dev-&gt;priv
op_logical_or
(paren
(paren
r_struct
id|sm_state
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|hdrv.magic
op_ne
id|HDLCDRV_MAGIC
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sm_close: invalid device struct&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sm
op_assign
(paren
r_struct
id|sm_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hwdrv
op_logical_and
id|sm-&gt;hwdrv-&gt;close
)paren
id|err
op_assign
id|sm-&gt;hwdrv
op_logical_and
id|sm-&gt;hwdrv
op_member_access_from_pointer
id|close
c_func
(paren
id|dev
comma
id|sm
)paren
suffix:semicolon
id|sm_output_close
c_func
(paren
id|sm
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: close %s at iobase 0x%lx irq %u dma %u&bslash;n&quot;
comma
id|sm_drvname
comma
id|sm-&gt;hwdrv-&gt;hw_name
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;irq
comma
id|dev-&gt;dma
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sethw
r_static
r_int
id|sethw
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sm_state
op_star
id|sm
comma
r_char
op_star
id|mode
)paren
(brace
r_char
op_star
id|cp
op_assign
id|strchr
c_func
(paren
id|mode
comma
l_char|&squot;:&squot;
)paren
suffix:semicolon
r_const
r_struct
id|hardware_info
op_star
op_star
id|hwp
op_assign
id|sm_hardware_table
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cp
)paren
id|cp
op_assign
id|mode
suffix:semicolon
r_else
(brace
op_star
id|cp
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_while
c_loop
(paren
id|hwp
op_logical_and
(paren
op_star
id|hwp
)paren
op_logical_and
(paren
op_star
id|hwp
)paren
op_member_access_from_pointer
id|hw_name
op_logical_and
id|strcmp
c_func
(paren
(paren
op_star
id|hwp
)paren
op_member_access_from_pointer
id|hw_name
comma
id|mode
)paren
)paren
id|hwp
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwp
op_logical_or
op_logical_neg
op_star
id|hwp
op_logical_or
op_logical_neg
(paren
op_star
id|hwp
)paren
op_member_access_from_pointer
id|hw_name
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|hwp
)paren
op_member_access_from_pointer
id|loc_storage
OG
r_sizeof
(paren
id|sm-&gt;hw
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: insufficient storage for hw driver %s (%d)&bslash;n&quot;
comma
id|sm_drvname
comma
(paren
op_star
id|hwp
)paren
op_member_access_from_pointer
id|hw_name
comma
(paren
op_star
id|hwp
)paren
op_member_access_from_pointer
id|loc_storage
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sm-&gt;hwdrv
op_assign
op_star
id|hwp
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|cp
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hwdrv
op_logical_and
id|sm-&gt;hwdrv-&gt;sethw
)paren
r_return
id|sm-&gt;hwdrv
op_member_access_from_pointer
id|sethw
c_func
(paren
id|dev
comma
id|sm
comma
id|cp
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sm_ioctl
r_static
r_int
id|sm_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_struct
id|hdlcdrv_ioctl
op_star
id|hi
comma
r_int
id|cmd
)paren
(brace
r_struct
id|sm_state
op_star
id|sm
suffix:semicolon
r_struct
id|sm_ioctl
id|bi
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|newdiagmode
suffix:semicolon
r_int
r_int
id|newdiagflags
suffix:semicolon
r_char
op_star
id|cp
suffix:semicolon
r_const
r_struct
id|modem_tx_info
op_star
op_star
id|mtp
op_assign
id|sm_modem_tx_table
suffix:semicolon
r_const
r_struct
id|modem_rx_info
op_star
op_star
id|mrp
op_assign
id|sm_modem_rx_table
suffix:semicolon
r_const
r_struct
id|hardware_info
op_star
op_star
id|hwp
op_assign
id|sm_hardware_table
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|dev-&gt;priv
op_logical_or
(paren
(paren
r_struct
id|sm_state
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|hdrv.magic
op_ne
id|HDLCDRV_MAGIC
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sm_ioctl: invalid device struct&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sm
op_assign
(paren
r_struct
id|sm_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_ne
id|SIOCDEVPRIVATE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sm-&gt;hwdrv
op_logical_or
op_logical_neg
id|sm-&gt;hwdrv-&gt;ioctl
)paren
r_return
id|sm-&gt;hwdrv
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|dev
comma
id|sm
comma
id|ifr
comma
id|hi
comma
id|cmd
)paren
suffix:semicolon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|hi-&gt;cmd
)paren
(brace
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|sm-&gt;hwdrv
op_logical_and
id|sm-&gt;hwdrv-&gt;ioctl
)paren
r_return
id|sm-&gt;hwdrv
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|dev
comma
id|sm
comma
id|ifr
comma
id|hi
comma
id|cmd
)paren
suffix:semicolon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
r_case
id|HDLCDRVCTL_GETMODE
suffix:colon
id|cp
op_assign
id|hi-&gt;data.modename
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;hwdrv
op_logical_and
id|sm-&gt;hwdrv-&gt;hw_name
)paren
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;%s:&quot;
comma
id|sm-&gt;hwdrv-&gt;hw_name
)paren
suffix:semicolon
r_else
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;&lt;unspec&gt;:&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;mode_tx
op_logical_and
id|sm-&gt;mode_tx-&gt;name
)paren
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;%s&quot;
comma
id|sm-&gt;mode_tx-&gt;name
)paren
suffix:semicolon
r_else
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;&lt;unspec&gt;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sm-&gt;mode_rx
op_logical_or
op_logical_neg
id|sm-&gt;mode_rx
op_logical_or
id|strcmp
c_func
(paren
id|sm-&gt;mode_rx-&gt;name
comma
id|sm-&gt;mode_tx-&gt;name
)paren
)paren
(brace
r_if
c_cond
(paren
id|sm-&gt;mode_rx
op_logical_and
id|sm-&gt;mode_rx-&gt;name
)paren
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;,%s&quot;
comma
id|sm-&gt;mode_rx-&gt;name
)paren
suffix:semicolon
r_else
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;,&lt;unspec&gt;&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_data
comma
id|hi
comma
r_sizeof
(paren
op_star
id|hi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HDLCDRVCTL_SETMODE
suffix:colon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
op_logical_or
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
id|hi-&gt;data.modename
(braket
r_sizeof
(paren
id|hi-&gt;data.modename
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
id|sethw
c_func
(paren
id|dev
comma
id|sm
comma
id|hi-&gt;data.modename
)paren
suffix:semicolon
r_case
id|HDLCDRVCTL_MODELIST
suffix:colon
id|cp
op_assign
id|hi-&gt;data.modename
suffix:semicolon
r_while
c_loop
(paren
op_star
id|hwp
)paren
(brace
r_if
c_cond
(paren
(paren
op_star
id|hwp
)paren
op_member_access_from_pointer
id|hw_name
)paren
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;%s:,&quot;
comma
(paren
op_star
id|hwp
)paren
op_member_access_from_pointer
id|hw_name
)paren
suffix:semicolon
id|hwp
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
op_star
id|mtp
)paren
(brace
r_if
c_cond
(paren
(paren
op_star
id|mtp
)paren
op_member_access_from_pointer
id|name
)paren
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;&gt;%s,&quot;
comma
(paren
op_star
id|mtp
)paren
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|mtp
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
op_star
id|mrp
)paren
(brace
r_if
c_cond
(paren
(paren
op_star
id|mrp
)paren
op_member_access_from_pointer
id|name
)paren
id|cp
op_add_assign
id|sprintf
c_func
(paren
id|cp
comma
l_string|&quot;&lt;%s,&quot;
comma
(paren
op_star
id|mrp
)paren
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|mrp
op_increment
suffix:semicolon
)brace
id|cp
(braket
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_data
comma
id|hi
comma
r_sizeof
(paren
op_star
id|hi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#ifdef SM_DEBUG
r_case
id|SMCTL_GETDEBUG
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|bi
comma
id|ifr-&gt;ifr_data
comma
r_sizeof
(paren
id|bi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|bi.data.dbg.int_rate
op_assign
id|sm-&gt;debug_vals.last_intcnt
suffix:semicolon
id|bi.data.dbg.mod_cycles
op_assign
id|sm-&gt;debug_vals.mod_cyc
suffix:semicolon
id|bi.data.dbg.demod_cycles
op_assign
id|sm-&gt;debug_vals.demod_cyc
suffix:semicolon
id|bi.data.dbg.dma_residue
op_assign
id|sm-&gt;debug_vals.dma_residue
suffix:semicolon
id|sm-&gt;debug_vals.mod_cyc
op_assign
id|sm-&gt;debug_vals.demod_cyc
op_assign
id|sm-&gt;debug_vals.dma_residue
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_data
comma
op_amp
id|bi
comma
r_sizeof
(paren
id|bi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#endif /* SM_DEBUG */
r_case
id|SMCTL_DIAGNOSE
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|bi
comma
id|ifr-&gt;ifr_data
comma
r_sizeof
(paren
id|bi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|newdiagmode
op_assign
id|bi.data.diag.mode
suffix:semicolon
id|newdiagflags
op_assign
id|bi.data.diag.flags
suffix:semicolon
r_if
c_cond
(paren
id|newdiagmode
OG
id|SM_DIAGMODE_CONSTELLATION
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|bi.data.diag.mode
op_assign
id|sm-&gt;diag.mode
suffix:semicolon
id|bi.data.diag.flags
op_assign
id|sm-&gt;diag.flags
suffix:semicolon
id|bi.data.diag.samplesperbit
op_assign
id|sm-&gt;mode_rx-&gt;sperbit
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;diag.mode
op_ne
id|newdiagmode
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sm-&gt;diag.ptr
op_assign
op_minus
l_int|1
suffix:semicolon
id|sm-&gt;diag.flags
op_assign
id|newdiagflags
op_amp
op_complement
id|SM_DIAGFLAG_VALID
suffix:semicolon
id|sm-&gt;diag.mode
op_assign
id|newdiagmode
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_data
comma
op_amp
id|bi
comma
r_sizeof
(paren
id|bi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sm-&gt;diag.ptr
OL
l_int|0
op_logical_or
id|sm-&gt;diag.mode
op_eq
id|SM_DIAGMODE_OFF
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_data
comma
op_amp
id|bi
comma
r_sizeof
(paren
id|bi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bi.data.diag.datalen
OG
id|DIAGDATALEN
)paren
id|bi.data.diag.datalen
op_assign
id|DIAGDATALEN
suffix:semicolon
r_if
c_cond
(paren
id|sm-&gt;diag.ptr
OL
id|bi.data.diag.datalen
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_data
comma
op_amp
id|bi
comma
r_sizeof
(paren
id|bi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|bi.data.diag.data
comma
id|sm-&gt;diag.data
comma
id|bi.data.diag.datalen
op_star
r_sizeof
(paren
r_int
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|bi.data.diag.flags
op_or_assign
id|SM_DIAGFLAG_VALID
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sm-&gt;diag.ptr
op_assign
op_minus
l_int|1
suffix:semicolon
id|sm-&gt;diag.flags
op_assign
id|newdiagflags
op_amp
op_complement
id|SM_DIAGFLAG_VALID
suffix:semicolon
id|sm-&gt;diag.mode
op_assign
id|newdiagmode
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_data
comma
op_amp
id|bi
comma
r_sizeof
(paren
id|bi
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * command line settable parameters&n; */
DECL|variable|mode
r_static
r_char
op_star
id|mode
(braket
id|NR_PORTS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_PORTS
op_minus
l_int|1
)braket
op_assign
l_int|NULL
)brace
suffix:semicolon
DECL|variable|iobase
r_static
r_int
id|iobase
(braket
id|NR_PORTS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_PORTS
op_minus
l_int|1
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
(braket
id|NR_PORTS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_PORTS
op_minus
l_int|1
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|dma
r_static
r_int
id|dma
(braket
id|NR_PORTS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_PORTS
op_minus
l_int|1
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|dma2
r_static
r_int
id|dma2
(braket
id|NR_PORTS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_PORTS
op_minus
l_int|1
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|serio
r_static
r_int
id|serio
(braket
id|NR_PORTS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_PORTS
op_minus
l_int|1
)braket
op_assign
l_int|0
)brace
suffix:semicolon
DECL|variable|pario
r_static
r_int
id|pario
(braket
id|NR_PORTS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_PORTS
op_minus
l_int|1
)braket
op_assign
l_int|0
)brace
suffix:semicolon
DECL|variable|midiio
r_static
r_int
id|midiio
(braket
id|NR_PORTS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_PORTS
op_minus
l_int|1
)braket
op_assign
l_int|0
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mode
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_PORTS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mode
comma
l_string|&quot;soundmodem operating mode; eg. sbc:afsk1200 or wss:fsk9600&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|iobase
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_PORTS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|iobase
comma
l_string|&quot;soundmodem base address&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_PORTS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq
comma
l_string|&quot;soundmodem interrupt&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dma
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_PORTS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dma
comma
l_string|&quot;soundmodem dma channel&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dma2
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_PORTS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dma2
comma
l_string|&quot;soundmodem 2nd dma channel; full duplex only&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|serio
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_PORTS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|serio
comma
l_string|&quot;soundmodem PTT output on serial port&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pario
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_PORTS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|pario
comma
l_string|&quot;soundmodem PTT output on parallel port&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|midiio
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_PORTS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|midiio
comma
l_string|&quot;soundmodem PTT output on midi port&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Thomas M. Sailer, sailer@ife.ee.ethz.ch, hb9jnx@hb9w.che.eu&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Soundcard amateur radio modem driver&quot;
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|init_soundmodem
r_static
r_int
id|__init
id|init_soundmodem
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|j
comma
id|found
op_assign
l_int|0
suffix:semicolon
r_char
id|set_hw
op_assign
l_int|1
suffix:semicolon
r_struct
id|sm_state
op_star
id|sm
suffix:semicolon
id|printk
c_func
(paren
id|sm_drvinfo
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * register net devices&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|sm_device
op_plus
id|i
suffix:semicolon
r_char
id|ifname
(braket
id|IFNAMSIZ
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|ifname
comma
l_string|&quot;sm%d&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mode
(braket
id|i
)braket
)paren
id|set_hw
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|mode
(braket
id|i
)braket
comma
l_string|&quot;sbc&quot;
comma
l_int|3
)paren
)paren
(brace
r_if
c_cond
(paren
id|iobase
(braket
id|i
)braket
op_eq
op_minus
l_int|1
)paren
id|iobase
(braket
id|i
)braket
op_assign
l_int|0x220
suffix:semicolon
r_if
c_cond
(paren
id|irq
(braket
id|i
)braket
op_eq
op_minus
l_int|1
)paren
id|irq
(braket
id|i
)braket
op_assign
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|dma
(braket
id|i
)braket
op_eq
op_minus
l_int|1
)paren
id|dma
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|iobase
(braket
id|i
)braket
op_eq
op_minus
l_int|1
)paren
id|iobase
(braket
id|i
)braket
op_assign
l_int|0x530
suffix:semicolon
r_if
c_cond
(paren
id|irq
(braket
id|i
)braket
op_eq
op_minus
l_int|1
)paren
id|irq
(braket
id|i
)braket
op_assign
l_int|11
suffix:semicolon
r_if
c_cond
(paren
id|dma
(braket
id|i
)braket
op_eq
op_minus
l_int|1
)paren
id|dma
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|set_hw
)paren
id|iobase
(braket
id|i
)braket
op_assign
id|irq
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|j
op_assign
id|hdlcdrv_register_hdlcdrv
c_func
(paren
id|dev
comma
op_amp
id|sm_ops
comma
r_sizeof
(paren
r_struct
id|sm_state
)paren
comma
id|ifname
comma
id|iobase
(braket
id|i
)braket
comma
id|irq
(braket
id|i
)braket
comma
id|dma
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|j
)paren
(brace
id|sm
op_assign
(paren
r_struct
id|sm_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|sm-&gt;hdrv.ptt_out.dma2
op_assign
id|dma2
(braket
id|i
)braket
suffix:semicolon
id|sm-&gt;hdrv.ptt_out.seriobase
op_assign
id|serio
(braket
id|i
)braket
suffix:semicolon
id|sm-&gt;hdrv.ptt_out.pariobase
op_assign
id|pario
(braket
id|i
)braket
suffix:semicolon
id|sm-&gt;hdrv.ptt_out.midiiobase
op_assign
id|midiio
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|set_hw
op_logical_and
id|sethw
c_func
(paren
id|dev
comma
id|sm
comma
id|mode
(braket
id|i
)braket
)paren
)paren
id|set_hw
op_assign
l_int|0
suffix:semicolon
id|found
op_increment
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: cannot register net device&bslash;n&quot;
comma
id|sm_drvname
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_soundmodem
r_static
r_void
id|__exit
id|cleanup_soundmodem
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sm: cleanup_module called&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|sm_device
op_plus
id|i
suffix:semicolon
r_struct
id|sm_state
op_star
id|sm
op_assign
(paren
r_struct
id|sm_state
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|sm
)paren
(brace
r_if
c_cond
(paren
id|sm-&gt;hdrv.magic
op_ne
id|HDLCDRV_MAGIC
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sm: invalid magic in &quot;
l_string|&quot;cleanup_module&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|hdlcdrv_unregister_hdlcdrv
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|variable|init_soundmodem
id|module_init
c_func
(paren
id|init_soundmodem
)paren
suffix:semicolon
DECL|variable|cleanup_soundmodem
id|module_exit
c_func
(paren
id|cleanup_soundmodem
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
macro_line|#ifndef MODULE
multiline_comment|/*&n; * format: soundmodem=io,irq,dma[,dma2[,serio[,pario]]],mode&n; * mode: hw:modem&n; * hw: sbc, wss, wssfdx&n; * modem: afsk1200, fsk9600&n; */
DECL|function|sm_setup
r_static
r_int
id|__init
id|sm_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_int
id|ints
(braket
l_int|8
)braket
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|NR_PORTS
)paren
r_return
l_int|0
suffix:semicolon
id|str
op_assign
id|get_options
c_func
(paren
id|str
comma
l_int|8
comma
id|ints
)paren
suffix:semicolon
id|mode
(braket
id|nr_dev
)braket
op_assign
id|str
suffix:semicolon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ge
l_int|1
)paren
id|iobase
(braket
id|nr_dev
)braket
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ge
l_int|2
)paren
id|irq
(braket
id|nr_dev
)braket
op_assign
id|ints
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ge
l_int|3
)paren
id|dma
(braket
id|nr_dev
)braket
op_assign
id|ints
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ge
l_int|4
)paren
id|dma2
(braket
id|nr_dev
)braket
op_assign
id|ints
(braket
l_int|4
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ge
l_int|5
)paren
id|serio
(braket
id|nr_dev
)braket
op_assign
id|ints
(braket
l_int|5
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ge
l_int|6
)paren
id|pario
(braket
id|nr_dev
)braket
op_assign
id|ints
(braket
l_int|6
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ge
l_int|7
)paren
id|midiio
(braket
id|nr_dev
)braket
op_assign
id|ints
(braket
l_int|7
)braket
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;soundmodem=&quot;
comma
id|sm_setup
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
multiline_comment|/* --------------------------------------------------------------------- */
eof
