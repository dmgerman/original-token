multiline_comment|/*&n; *   olympic.c (c) 1999 Peter De Schrijver All Rights Reserved&n; *&t;&t;   1999 Mike Phillips (phillim@amtrak.com)&n; *&n; *  Linux driver for IBM PCI tokenring cards based on the Pit/Pit-Phy/Olympic&n; *  chipset. &n; *&n; *  Base Driver Skeleton:&n; *      Written 1993-94 by Donald Becker.&n; *&n; *      Copyright 1993 United States Government as represented by the&n; *      Director, National Security Agency.&n; *&n; *  Thanks to Erik De Cock, Adrian Bridgett and Frank Fiene for their &n; *  assistance and perserverance with the testing of this driver.&n; *&n; *  This software may be used and distributed according to the terms&n; *  of the GNU Public License, incorporated herein by reference.&n; * &n; *  4/27/99 - Alpha Release 0.1.0&n; *            First release to the public&n; *&n; *  6/8/99  - Official Release 0.2.0   &n; *            Merged into the kernel code &n; *  8/18/99 - Updated driver for 2.3.13 kernel to use new pci&n; *&t;      resource. Driver also reports the card name returned by&n; *            the pci resource.&n; *  1/11/00 - Added spinlocks for smp&n; *  2/23/00 - Updated to dev_kfree_irq &n; *  3/10/00 - Fixed FDX enable which triggered other bugs also &n; *            squashed.&n; *  5/20/00 - Changes to handle Olympic on LinuxPPC. Endian changes.&n; *            The odd thing about the changes is that the fix for&n; *            endian issues with the big-endian data in the arb, asb...&n; *            was to always swab() the bytes, no matter what CPU.&n; *            That&squot;s because the read[wl]() functions always swap the&n; *            bytes on the way in on PPC.&n; *            Fixing the hardware descriptors was another matter,&n; *            because they weren&squot;t going through read[wl](), there all&n; *            the results had to be in memory in le32 values. kdaaker&n; *&n; *&n; *  To Do:&n; *&n; *  If Problems do Occur&n; *  Most problems can be rectified by either closing and opening the interface&n; *  (ifconfig down and up) or rmmod and insmod&squot;ing the driver (a bit difficult&n; *  if compiled into the kernel).&n; */
multiline_comment|/* Change OLYMPIC_DEBUG to 1 to get verbose, and I mean really verbose, messages */
DECL|macro|OLYMPIC_DEBUG
mdefine_line|#define OLYMPIC_DEBUG 0
multiline_comment|/* Change OLYMPIC_NETWORK_MONITOR to receive mac frames through the arb channel.&n; * Will also create a /proc/net/olympic_tr entry if proc_fs is compiled into the&n; * kernel.&n; * Intended to be used to create a ring-error reporting network module &n; * i.e. it will give you the source address of beaconers on the ring &n; */
DECL|macro|OLYMPIC_NETWORK_MONITOR
mdefine_line|#define OLYMPIC_NETWORK_MONITOR 0
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/trdevice.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;net/checksum.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &quot;olympic.h&quot;
multiline_comment|/* I&squot;ve got to put some intelligence into the version number so that Peter and I know&n; * which version of the code somebody has got. &n; * Version Number = a.b.c.d  where a.b.c is the level of code and d is the latest author.&n; * So 0.0.1.pds = Peter, 0.0.1.mlp = Mike&n; * &n; * Official releases will only have an a.b.c version number format. &n; */
DECL|variable|version
r_static
r_char
op_star
id|version
op_assign
l_string|&quot;Olympic.c v0.5.0 3/10/00 - Peter De Schrijver &amp; Mike Phillips&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|pci_device_id
id|olympic_pci_tbl
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_IBM
comma
id|PCI_DEVICE_ID_IBM_TR_WAKE
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
)brace
comma
(brace
)brace
multiline_comment|/* Terminating entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|olympic_pci_tbl
)paren
suffix:semicolon
DECL|variable|open_maj_error
r_static
r_char
op_star
id|open_maj_error
(braket
)braket
op_assign
(brace
l_string|&quot;No error&quot;
comma
l_string|&quot;Lobe Media Test&quot;
comma
l_string|&quot;Physical Insertion&quot;
comma
l_string|&quot;Address Verification&quot;
comma
l_string|&quot;Neighbor Notification (Ring Poll)&quot;
comma
l_string|&quot;Request Parameters&quot;
comma
l_string|&quot;FDX Registration Request&quot;
comma
l_string|&quot;FDX Duplicate Address Check&quot;
comma
l_string|&quot;Station registration Query Wait&quot;
comma
l_string|&quot;Unknown stage&quot;
)brace
suffix:semicolon
DECL|variable|open_min_error
r_static
r_char
op_star
id|open_min_error
(braket
)braket
op_assign
(brace
l_string|&quot;No error&quot;
comma
l_string|&quot;Function Failure&quot;
comma
l_string|&quot;Signal Lost&quot;
comma
l_string|&quot;Wire Fault&quot;
comma
l_string|&quot;Ring Speed Mismatch&quot;
comma
l_string|&quot;Timeout&quot;
comma
l_string|&quot;Ring Failure&quot;
comma
l_string|&quot;Ring Beaconing&quot;
comma
l_string|&quot;Duplicate Node Address&quot;
comma
l_string|&quot;Request Parameters&quot;
comma
l_string|&quot;Remove Received&quot;
comma
l_string|&quot;Reserved&quot;
comma
l_string|&quot;Reserved&quot;
comma
l_string|&quot;No Monitor Detected for RPL&quot;
comma
l_string|&quot;Monitor Contention failer for RPL&quot;
comma
l_string|&quot;FDX Protocol Error&quot;
)brace
suffix:semicolon
multiline_comment|/* Module paramters */
multiline_comment|/* Ring Speed 0,4,16,100 &n; * 0 = Autosense         &n; * 4,16 = Selected speed only, no autosense&n; * This allows the card to be the first on the ring&n; * and become the active monitor.&n; * 100 = Nothing at present, 100mbps is autodetected&n; * if FDX is turned on. May be implemented in the future to &n; * fail if 100mpbs is not detected.&n; *&n; * WARNING: Some hubs will allow you to insert&n; * at the wrong speed&n; */
DECL|variable|ringspeed
r_static
r_int
id|ringspeed
(braket
id|OLYMPIC_MAX_ADAPTERS
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ringspeed
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|OLYMPIC_MAX_ADAPTERS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* Packet buffer size */
DECL|variable|pkt_buf_sz
r_static
r_int
id|pkt_buf_sz
(braket
id|OLYMPIC_MAX_ADAPTERS
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pkt_buf_sz
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|OLYMPIC_MAX_ADAPTERS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* Message Level */
DECL|variable|message_level
r_static
r_int
id|message_level
(braket
id|OLYMPIC_MAX_ADAPTERS
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|message_level
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|OLYMPIC_MAX_ADAPTERS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
r_static
r_int
id|olympic_scan
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|olympic_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|olympic_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|olympic_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|olympic_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|olympic_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|olympic_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|olympic_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|olympic_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|addr
)paren
suffix:semicolon
r_static
r_void
id|olympic_arb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|olympic_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|mtu
)paren
suffix:semicolon
r_static
r_void
id|olympic_srb_bh
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|olympic_asb_bh
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#if OLYMPIC_NETWORK_MONITOR
macro_line|#ifdef CONFIG_PROC_FS
r_static
r_int
id|sprintf_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
DECL|function|olympic_probe
r_int
id|__init
id|olympic_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|cards_found
suffix:semicolon
id|cards_found
op_assign
id|olympic_scan
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|cards_found
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|olympic_scan
r_static
r_int
id|__init
id|olympic_scan
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_device
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|olympic_private
op_star
id|olympic_priv
suffix:semicolon
r_int
id|card_no
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pci_present
c_func
(paren
)paren
)paren
(brace
r_while
c_loop
(paren
(paren
id|pci_device
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_IBM
comma
id|PCI_DEVICE_ID_IBM_TR_WAKE
comma
id|pci_device
)paren
)paren
)paren
(brace
id|__u16
id|pci_command
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pci_device
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* These lines are needed by the PowerPC, it appears&n;that these flags&n;&t;&t;&t; * are not being set properly for the PPC, this may&n;well be fixed with&n;&t;&t;&t; * the new PCI code */
id|pci_read_config_word
c_func
(paren
id|pci_device
comma
id|PCI_COMMAND
comma
op_amp
id|pci_command
)paren
suffix:semicolon
id|pci_command
op_or_assign
id|PCI_COMMAND_IO
op_or
id|PCI_COMMAND_MEMORY
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pci_device
comma
id|PCI_COMMAND
comma
id|pci_command
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci_device
)paren
suffix:semicolon
multiline_comment|/* Check to see if io has been allocated, if so, we&squot;ve already done this card,&n;&t;&t;&t;   so continue on the card discovery loop  */
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci_device
comma
l_int|0
)paren
comma
id|OLYMPIC_IO_SPACE
)paren
)paren
(brace
id|card_no
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|olympic_priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|olympic_private
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|memset
c_func
(paren
id|olympic_priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|olympic_private
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|olympic_priv-&gt;srb_wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|olympic_priv-&gt;trb_wait
)paren
suffix:semicolon
macro_line|#ifndef MODULE
id|dev
op_assign
id|init_trdev
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|dev-&gt;priv
op_assign
(paren
r_void
op_star
)paren
id|olympic_priv
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG  
id|printk
c_func
(paren
l_string|&quot;pci_device: %p, dev:%p, dev-&gt;priv: %p&bslash;n&quot;
comma
id|pci_device
comma
id|dev
comma
id|dev-&gt;priv
)paren
suffix:semicolon
macro_line|#endif
id|dev-&gt;irq
op_assign
id|pci_device-&gt;irq
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci_device
comma
l_int|0
)paren
suffix:semicolon
id|dev-&gt;init
op_assign
op_amp
id|olympic_init
suffix:semicolon
id|olympic_priv-&gt;olympic_card_name
op_assign
(paren
r_char
op_star
)paren
id|pci_device-&gt;resource
(braket
l_int|0
)braket
dot
id|name
suffix:semicolon
id|olympic_priv-&gt;olympic_mmio
op_assign
id|ioremap
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci_device
comma
l_int|1
)paren
comma
l_int|256
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_lap
op_assign
id|ioremap
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci_device
comma
l_int|2
)paren
comma
l_int|2048
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pkt_buf_sz
(braket
id|card_no
)braket
OL
l_int|100
)paren
op_logical_or
(paren
id|pkt_buf_sz
(braket
id|card_no
)braket
OG
l_int|18000
)paren
)paren
id|olympic_priv-&gt;pkt_buf_sz
op_assign
id|PKT_BUF_SZ
suffix:semicolon
r_else
id|olympic_priv-&gt;pkt_buf_sz
op_assign
id|pkt_buf_sz
(braket
id|card_no
)braket
suffix:semicolon
id|olympic_priv-&gt;olympic_ring_speed
op_assign
id|ringspeed
(braket
id|card_no
)braket
suffix:semicolon
id|olympic_priv-&gt;olympic_message_level
op_assign
id|message_level
(braket
id|card_no
)braket
suffix:semicolon
r_if
c_cond
(paren
id|olympic_init
c_func
(paren
id|dev
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|unregister_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dev-&gt;open
op_assign
op_amp
id|olympic_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|olympic_xmit
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
op_amp
id|olympic_change_mtu
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|olympic_close
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|olympic_set_rx_mode
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|olympic_get_stats
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
op_amp
id|olympic_set_mac_address
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|olympic_init
r_static
r_int
id|__init
id|olympic_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
suffix:semicolon
id|__u8
op_star
id|olympic_mmio
comma
op_star
id|init_srb
comma
op_star
id|adapter_addr
suffix:semicolon
r_int
r_int
id|t
suffix:semicolon
r_int
r_int
id|uaa_addr
suffix:semicolon
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|olympic_mmio
op_assign
id|olympic_priv-&gt;olympic_mmio
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s &bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %s. I/O at %hx, MMIO at %p, LAP at %p, using irq %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|olympic_priv-&gt;olympic_card_name
comma
(paren
r_int
r_int
)paren
id|dev-&gt;base_addr
comma
id|olympic_priv-&gt;olympic_mmio
comma
id|olympic_priv-&gt;olympic_lap
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|request_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|OLYMPIC_IO_SPACE
comma
l_string|&quot;olympic&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|BCTL
)paren
op_or
id|BCTL_SOFTRESET
comma
id|olympic_mmio
op_plus
id|BCTL
)paren
suffix:semicolon
id|t
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
(paren
id|readl
c_func
(paren
id|olympic_priv-&gt;olympic_mmio
op_plus
id|BCTL
)paren
)paren
op_amp
id|BCTL_SOFTRESET
)paren
(brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_minus
id|t
OG
l_int|40
op_star
id|HZ
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IBM PCI tokenring card not responding.&bslash;n&quot;
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|OLYMPIC_IO_SPACE
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_lock
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG
id|printk
c_func
(paren
l_string|&quot;BCTL: %x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|BCTL
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GPR: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|olympic_mmio
op_plus
id|GPR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SISRMASK: %x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|SISR_MASK
)paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Aaaahhh, You have got to be real careful setting GPR, the card&n;&t;   holds the previous values from flash memory, including autosense &n;           and ring speed */
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|BCTL
)paren
op_or
id|BCTL_MIMREB
comma
id|olympic_mmio
op_plus
id|BCTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_ring_speed
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Autosense */
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|GPR
)paren
op_or
id|GPR_AUTOSENSE
comma
id|olympic_mmio
op_plus
id|GPR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Ringspeed autosense mode on&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_ring_speed
op_eq
l_int|16
)paren
(brace
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Trying to open at 16 Mbps as requested&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|GPR_16MBPS
comma
id|olympic_mmio
op_plus
id|GPR
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_ring_speed
op_eq
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Trying to open at 4 Mbps as requested&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|olympic_mmio
op_plus
id|GPR
)paren
suffix:semicolon
)brace
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|GPR
)paren
op_or
id|GPR_NEPTUNE_BF
comma
id|olympic_mmio
op_plus
id|GPR
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG
id|printk
c_func
(paren
l_string|&quot;GPR = %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|olympic_mmio
op_plus
id|GPR
)paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* start solo init */
id|writel
c_func
(paren
(paren
l_int|1
op_lshift
l_int|15
)paren
comma
id|olympic_mmio
op_plus
id|SISR_MASK_SUM
)paren
suffix:semicolon
id|t
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|SISR_RR
)paren
)paren
op_amp
id|SISR_SRB_REPLY
)paren
)paren
(brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_minus
id|t
OG
l_int|40
op_star
id|HZ
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IBM PCI tokenring card not responding.&bslash;n&quot;
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|OLYMPIC_IO_SPACE
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LAPWWO
)paren
comma
id|olympic_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG
id|printk
c_func
(paren
l_string|&quot;LAPWWO: %x, LAPA: %x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LAPWWO
)paren
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LAPA
)paren
)paren
suffix:semicolon
macro_line|#endif
id|init_srb
op_assign
id|olympic_priv-&gt;olympic_lap
op_plus
(paren
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LAPWWO
)paren
)paren
op_amp
(paren
op_complement
l_int|0xf800
)paren
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG&t;&t;
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;init_srb(%p): &quot;
comma
id|init_srb
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|20
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x &quot;
comma
id|readb
c_func
(paren
id|init_srb
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif&t;
r_if
c_cond
(paren
id|readw
c_func
(paren
id|init_srb
op_plus
l_int|6
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;tokenring card intialization failed. errorcode : %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|init_srb
op_plus
l_int|6
)paren
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|OLYMPIC_IO_SPACE
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
(brace
r_if
c_cond
(paren
id|readb
c_func
(paren
id|init_srb
op_plus
l_int|2
)paren
op_amp
l_int|0x40
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Olympic: Adapter is FDX capable.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Olympic: Adapter cannot do FDX.&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|uaa_addr
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|init_srb
op_plus
l_int|8
)paren
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG
id|printk
c_func
(paren
l_string|&quot;UAA resides at %x&bslash;n&quot;
comma
id|uaa_addr
)paren
suffix:semicolon
macro_line|#endif
id|writel
c_func
(paren
id|uaa_addr
comma
id|olympic_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|adapter_addr
op_assign
id|olympic_priv-&gt;olympic_lap
op_plus
(paren
id|uaa_addr
op_amp
(paren
op_complement
l_int|0xf800
)paren
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG
id|printk
c_func
(paren
l_string|&quot;adapter address: %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|readb
c_func
(paren
id|adapter_addr
)paren
comma
id|readb
c_func
(paren
id|adapter_addr
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|adapter_addr
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|adapter_addr
op_plus
l_int|3
)paren
comma
id|readb
c_func
(paren
id|adapter_addr
op_plus
l_int|4
)paren
comma
id|readb
c_func
(paren
id|adapter_addr
op_plus
l_int|5
)paren
)paren
suffix:semicolon
macro_line|#endif
id|memcpy_fromio
c_func
(paren
op_amp
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|adapter_addr
comma
l_int|6
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_addr_table_addr
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|init_srb
op_plus
l_int|12
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_parms_addr
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|init_srb
op_plus
l_int|14
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|olympic_open
r_static
r_int
id|olympic_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|olympic_mmio
op_assign
id|olympic_priv-&gt;olympic_mmio
comma
op_star
id|init_srb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_char
id|open_error
(braket
l_int|255
)braket
suffix:semicolon
r_int
id|i
comma
id|open_finished
op_assign
l_int|1
suffix:semicolon
macro_line|#if OLYMPIC_NETWORK_MONITOR
id|__u8
op_star
id|oat
suffix:semicolon
id|__u8
op_star
id|opt
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|olympic_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;olympic&quot;
comma
id|dev
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
macro_line|#if OLYMPIC_DEBUG
id|printk
c_func
(paren
l_string|&quot;BMCTL: %x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|BMCTL_SUM
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pending ints: %x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|SISR_RR
)paren
)paren
suffix:semicolon
macro_line|#endif
id|writel
c_func
(paren
id|SISR_MI
comma
id|olympic_mmio
op_plus
id|SISR_MASK_SUM
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SISR_MI
op_or
id|SISR_SRB_REPLY
comma
id|olympic_mmio
op_plus
id|SISR_MASK
)paren
suffix:semicolon
multiline_comment|/* more ints later, doesn&squot;t stop arb cmd interrupt */
id|writel
c_func
(paren
id|LISR_LIE
comma
id|olympic_mmio
op_plus
id|LISR
)paren
suffix:semicolon
multiline_comment|/* more ints later */
multiline_comment|/* adapter is closed, so SRB is pointed to by LAPWWO */
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LAPWWO
)paren
comma
id|olympic_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|init_srb
op_assign
id|olympic_priv-&gt;olympic_lap
op_plus
(paren
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LAPWWO
)paren
)paren
op_amp
(paren
op_complement
l_int|0xf800
)paren
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG
id|printk
c_func
(paren
l_string|&quot;LAPWWO: %x, LAPA: %x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LAPWWO
)paren
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LAPA
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SISR Mask = %04x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|SISR_MASK
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Before the open command &bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
r_do
(brace
r_int
id|i
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SRB_COMMAND_SIZE
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|writel
c_func
(paren
l_int|0
comma
id|init_srb
op_plus
id|i
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SRB_COMMAND_SIZE
op_amp
l_int|2
)paren
(brace
id|writew
c_func
(paren
l_int|0
comma
id|init_srb
op_plus
(paren
id|SRB_COMMAND_SIZE
op_amp
op_complement
l_int|3
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SRB_COMMAND_SIZE
op_amp
l_int|1
)paren
(brace
id|writeb
c_func
(paren
l_int|0
comma
id|init_srb
op_plus
(paren
id|SRB_COMMAND_SIZE
op_amp
op_complement
l_int|1
)paren
)paren
suffix:semicolon
)brace
id|writeb
c_func
(paren
id|SRB_OPEN_ADAPTER
comma
id|init_srb
)paren
suffix:semicolon
multiline_comment|/* open */
id|writeb
c_func
(paren
id|OLYMPIC_CLEAR_RET_CODE
comma
id|init_srb
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* If Network Monitor, instruct card to copy MAC frames through the ARB */
macro_line|#if OLYMPIC_NETWORK_MONITOR
id|writew
c_func
(paren
id|swab16
c_func
(paren
id|OPEN_ADAPTER_ENABLE_FDX
op_or
id|OPEN_ADAPTER_PASS_ADC_MAC
op_or
id|OPEN_ADAPTER_PASS_ATT_MAC
op_or
id|OPEN_ADAPTER_PASS_BEACON
)paren
comma
id|init_srb
op_plus
l_int|8
)paren
suffix:semicolon
macro_line|#else
id|writew
c_func
(paren
id|swab16
c_func
(paren
id|OPEN_ADAPTER_ENABLE_FDX
)paren
comma
id|init_srb
op_plus
l_int|8
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_laa
(braket
l_int|0
)braket
)paren
(brace
id|writeb
c_func
(paren
id|olympic_priv-&gt;olympic_laa
(braket
l_int|0
)braket
comma
id|init_srb
op_plus
l_int|12
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|olympic_priv-&gt;olympic_laa
(braket
l_int|1
)braket
comma
id|init_srb
op_plus
l_int|13
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|olympic_priv-&gt;olympic_laa
(braket
l_int|2
)braket
comma
id|init_srb
op_plus
l_int|14
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|olympic_priv-&gt;olympic_laa
(braket
l_int|3
)braket
comma
id|init_srb
op_plus
l_int|15
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|olympic_priv-&gt;olympic_laa
(braket
l_int|4
)braket
comma
id|init_srb
op_plus
l_int|16
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|olympic_priv-&gt;olympic_laa
(braket
l_int|5
)braket
comma
id|init_srb
op_plus
l_int|17
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|olympic_priv-&gt;olympic_laa
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
)brace
id|writeb
c_func
(paren
l_int|1
comma
id|init_srb
op_plus
l_int|30
)paren
suffix:semicolon
id|olympic_priv-&gt;srb_queued
op_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
id|LISR_SRB_CMD
comma
id|olympic_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
r_while
c_loop
(paren
id|olympic_priv-&gt;srb_queued
)paren
(brace
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|olympic_priv-&gt;srb_wait
comma
l_int|60
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: SRB timed out.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;SISR=%x MISR=%x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|SISR
)paren
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LISR
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;srb_queued
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG
id|printk
c_func
(paren
l_string|&quot;init_srb(%p): &quot;
comma
id|init_srb
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|20
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%02x &quot;
comma
id|readb
c_func
(paren
id|init_srb
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* If we get the same return response as we set, the interrupt wasn&squot;t raised and the open&n;                 * timed out.&n;&t;&t; */
r_if
c_cond
(paren
id|readb
c_func
(paren
id|init_srb
op_plus
l_int|2
)paren
op_eq
id|OLYMPIC_CLEAR_RET_CODE
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter Open time out or error.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|readb
c_func
(paren
id|init_srb
op_plus
l_int|2
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|readb
c_func
(paren
id|init_srb
op_plus
l_int|2
)paren
op_eq
l_int|0x07
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|olympic_priv-&gt;olympic_ring_speed
op_logical_and
id|open_finished
)paren
(brace
multiline_comment|/* Autosense , first time around */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Retrying at different ring speed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|open_finished
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|strcpy
c_func
(paren
id|open_error
comma
id|open_maj_error
(braket
(paren
id|readb
c_func
(paren
id|init_srb
op_plus
l_int|7
)paren
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)braket
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|open_error
comma
l_string|&quot; - &quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|open_error
comma
id|open_min_error
(braket
(paren
id|readb
c_func
(paren
id|init_srb
op_plus
l_int|7
)paren
op_amp
l_int|0x0f
)paren
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|olympic_priv-&gt;olympic_ring_speed
op_logical_and
(paren
(paren
id|readb
c_func
(paren
id|init_srb
op_plus
l_int|7
)paren
op_amp
l_int|0x0f
)paren
op_eq
l_int|0x0d
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Tried to autosense ring speed with no monitors present&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Please try again with a specified ring speed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|open_error
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* if autosense &amp;&amp; open_finished */
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Bad OPEN response: %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|init_srb
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_else
id|open_finished
op_assign
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|open_finished
)paren
)paren
suffix:semicolon
multiline_comment|/* Will only loop if ring speed mismatch re-open attempted &amp;&amp; autosense is on */
r_if
c_cond
(paren
id|readb
c_func
(paren
id|init_srb
op_plus
l_int|18
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|3
)paren
)paren
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Opened in FDX Mode&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readb
c_func
(paren
id|init_srb
op_plus
l_int|18
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|1
)paren
)paren
id|olympic_priv-&gt;olympic_ring_speed
op_assign
l_int|100
suffix:semicolon
r_else
r_if
c_cond
(paren
id|readb
c_func
(paren
id|init_srb
op_plus
l_int|18
)paren
op_amp
l_int|1
)paren
id|olympic_priv-&gt;olympic_ring_speed
op_assign
l_int|16
suffix:semicolon
r_else
id|olympic_priv-&gt;olympic_ring_speed
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Opened in %d Mbps mode&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|olympic_priv-&gt;olympic_ring_speed
)paren
suffix:semicolon
id|olympic_priv-&gt;asb
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|init_srb
op_plus
l_int|8
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;srb
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|init_srb
op_plus
l_int|10
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;arb
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|init_srb
op_plus
l_int|12
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;trb
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|init_srb
op_plus
l_int|16
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_receive_options
op_assign
l_int|0x01
suffix:semicolon
id|olympic_priv-&gt;olympic_copy_all_options
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* setup rx ring */
id|writel
c_func
(paren
(paren
l_int|3
op_lshift
l_int|16
)paren
comma
id|olympic_mmio
op_plus
id|BMCTL_RWM
)paren
suffix:semicolon
multiline_comment|/* Ensure end of frame generated interrupts */
id|writel
c_func
(paren
id|BMCTL_RX_DIS
op_or
l_int|3
comma
id|olympic_mmio
op_plus
id|BMCTL_RWM
)paren
suffix:semicolon
multiline_comment|/* Yes, this the enables RX channel */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|OLYMPIC_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|olympic_priv-&gt;pkt_buf_sz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_break
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|olympic_priv-&gt;olympic_rx_ring
(braket
id|i
)braket
dot
id|buffer
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_rx_ring
(braket
id|i
)braket
dot
id|res_length
op_assign
id|cpu_to_le32
c_func
(paren
id|olympic_priv-&gt;pkt_buf_sz
)paren
suffix:semicolon
id|olympic_priv-&gt;rx_ring_skb
(braket
id|i
)braket
op_assign
id|skb
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Not enough memory to allocate rx buffers. Adapter disabled&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_rx_ring
(braket
l_int|0
)braket
)paren
comma
id|olympic_mmio
op_plus
id|RXDESCQ
)paren
suffix:semicolon
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_rx_ring
(braket
l_int|0
)braket
)paren
comma
id|olympic_mmio
op_plus
id|RXCDA
)paren
suffix:semicolon
id|writew
c_func
(paren
id|i
comma
id|olympic_mmio
op_plus
id|RXDESCQCNT
)paren
suffix:semicolon
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|0
)braket
)paren
comma
id|olympic_mmio
op_plus
id|RXSTATQ
)paren
suffix:semicolon
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|0
)braket
)paren
comma
id|olympic_mmio
op_plus
id|RXCSA
)paren
suffix:semicolon
id|olympic_priv-&gt;rx_ring_last_received
op_assign
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* last processed rx status */
id|olympic_priv-&gt;rx_status_last_received
op_assign
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
id|writew
c_func
(paren
id|i
comma
id|olympic_mmio
op_plus
id|RXSTATQCNT
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG 
id|printk
c_func
(paren
l_string|&quot;# of rx buffers: %d, RXENQ: %x&bslash;n&quot;
comma
id|i
comma
id|readw
c_func
(paren
id|olympic_mmio
op_plus
id|RXENQ
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;RXCSA: %x, rx_status_ring[0]: %p&bslash;n&quot;
comma
id|bus_to_virt
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|RXCSA
)paren
)paren
comma
op_amp
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; stat_ring[1]: %p, stat_ring[2]: %p, stat_ring[3]: %p&bslash;n&quot;
comma
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|1
)braket
)paren
comma
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|2
)braket
)paren
comma
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|3
)braket
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; stat_ring[4]: %p, stat_ring[5]: %p, stat_ring[6]: %p&bslash;n&quot;
comma
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|4
)braket
)paren
comma
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|5
)braket
)paren
comma
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|6
)braket
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; stat_ring[7]: %p&bslash;n&quot;
comma
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|7
)braket
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;RXCDA: %x, rx_ring[0]: %p&bslash;n&quot;
comma
id|bus_to_virt
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|RXCDA
)paren
)paren
comma
op_amp
id|olympic_priv-&gt;olympic_rx_ring
(braket
l_int|0
)braket
)paren
suffix:semicolon
macro_line|#endif
id|writew
c_func
(paren
(paren
(paren
(paren
id|readw
c_func
(paren
id|olympic_mmio
op_plus
id|RXENQ
)paren
)paren
op_amp
l_int|0x8000
)paren
op_xor
l_int|0x8000
)paren
op_or
id|i
comma
id|olympic_mmio
op_plus
id|RXENQ
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG 
id|printk
c_func
(paren
l_string|&quot;# of rx buffers: %d, RXENQ: %x&bslash;n&quot;
comma
id|i
comma
id|readw
c_func
(paren
id|olympic_mmio
op_plus
id|RXENQ
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;RXCSA: %x, rx_ring[0]: %p&bslash;n&quot;
comma
id|bus_to_virt
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|RXCSA
)paren
)paren
comma
op_amp
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;RXCDA: %x, rx_ring[0]: %p&bslash;n&quot;
comma
id|bus_to_virt
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|RXCDA
)paren
)paren
comma
op_amp
id|olympic_priv-&gt;olympic_rx_ring
(braket
l_int|0
)braket
)paren
suffix:semicolon
macro_line|#endif 
id|writel
c_func
(paren
id|SISR_RX_STATUS
op_or
id|SISR_RX_NOBUF
comma
id|olympic_mmio
op_plus
id|SISR_MASK_SUM
)paren
suffix:semicolon
multiline_comment|/* setup tx ring */
id|writel
c_func
(paren
id|BMCTL_TX1_DIS
comma
id|olympic_mmio
op_plus
id|BMCTL_RWM
)paren
suffix:semicolon
multiline_comment|/* Yes, this enables TX channel 1 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|OLYMPIC_TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|olympic_priv-&gt;olympic_tx_ring
(braket
id|i
)braket
dot
id|buffer
op_assign
l_int|0xdeadbeef
suffix:semicolon
)brace
id|olympic_priv-&gt;free_tx_ring_entries
op_assign
id|OLYMPIC_TX_RING_SIZE
suffix:semicolon
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_tx_ring
(braket
l_int|0
)braket
)paren
comma
id|olympic_mmio
op_plus
id|TXDESCQ_1
)paren
suffix:semicolon
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_tx_ring
(braket
l_int|0
)braket
)paren
comma
id|olympic_mmio
op_plus
id|TXCDA_1
)paren
suffix:semicolon
id|writew
c_func
(paren
id|OLYMPIC_TX_RING_SIZE
comma
id|olympic_mmio
op_plus
id|TXDESCQCNT_1
)paren
suffix:semicolon
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_tx_status_ring
(braket
l_int|0
)braket
)paren
comma
id|olympic_mmio
op_plus
id|TXSTATQ_1
)paren
suffix:semicolon
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_tx_status_ring
(braket
l_int|0
)braket
)paren
comma
id|olympic_mmio
op_plus
id|TXCSA_1
)paren
suffix:semicolon
id|writew
c_func
(paren
id|OLYMPIC_TX_RING_SIZE
comma
id|olympic_mmio
op_plus
id|TXSTATQCNT_1
)paren
suffix:semicolon
id|olympic_priv-&gt;tx_ring_free
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* next entry in tx ring to use */
id|olympic_priv-&gt;tx_ring_last_status
op_assign
id|OLYMPIC_TX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* last processed tx status */
id|writel
c_func
(paren
id|SISR_TX1_EOF
op_or
id|SISR_ADAPTER_CHECK
op_or
id|SISR_ARB_CMD
op_or
id|SISR_TRB_REPLY
op_or
id|SISR_ASB_FREE
comma
id|olympic_mmio
op_plus
id|SISR_MASK_SUM
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG 
id|printk
c_func
(paren
l_string|&quot;BMCTL: %x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|BMCTL_SUM
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SISR MASK: %x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|SISR_MASK
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if OLYMPIC_NETWORK_MONITOR
id|oat
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|olympic_priv-&gt;olympic_lap
op_plus
id|olympic_priv-&gt;olympic_addr_table_addr
)paren
suffix:semicolon
id|opt
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|olympic_priv-&gt;olympic_lap
op_plus
id|olympic_priv-&gt;olympic_parms_addr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Node Address: %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
op_plus
l_int|3
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
op_plus
l_int|4
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
op_plus
l_int|5
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Functional Address: %02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|func_addr
)paren
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|func_addr
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|func_addr
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|func_addr
)paren
op_plus
l_int|3
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: NAUN Address: %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
op_plus
l_int|3
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
op_plus
l_int|4
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
op_plus
l_int|5
)paren
)paren
suffix:semicolon
macro_line|#endif &t;
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;When we enter the rx routine we do not know how many frames have been &n; *&t;queued on the rx channel.  Therefore we start at the next rx status&n; *&t;position and travel around the receive ring until we have completed&n; *&t;all the frames.&n; *&n; *&t;This means that we may process the frame before we receive the end&n; *&t;of frame interrupt. This is why we always test the status instead&n; *&t;of blindly processing the next frame.&n; *&t;&n; */
DECL|function|olympic_rx
r_static
r_void
id|olympic_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|olympic_mmio
op_assign
id|olympic_priv-&gt;olympic_mmio
suffix:semicolon
r_struct
id|olympic_rx_status
op_star
id|rx_status
suffix:semicolon
r_struct
id|olympic_rx_desc
op_star
id|rx_desc
suffix:semicolon
r_int
id|rx_ring_last_received
comma
id|length
comma
id|buffer_cnt
comma
id|cpy_length
comma
id|frag_len
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|skb2
suffix:semicolon
r_int
id|i
suffix:semicolon
id|rx_status
op_assign
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
(paren
id|olympic_priv-&gt;rx_status_last_received
op_plus
l_int|1
)paren
op_amp
(paren
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
)paren
)braket
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rx_status-&gt;status_buffercnt
)paren
(brace
id|__u32
id|l_status_buffercnt
suffix:semicolon
id|olympic_priv-&gt;rx_status_last_received
op_increment
suffix:semicolon
id|olympic_priv-&gt;rx_status_last_received
op_and_assign
(paren
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG
id|printk
c_func
(paren
l_string|&quot; stat_ring addr: %x &bslash;n&quot;
comma
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
id|olympic_priv-&gt;rx_status_last_received
)braket
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;rx status: %x rx len: %x &bslash;n&quot;
comma
id|le32_to_cpu
c_func
(paren
id|rx_status-&gt;status_buffercnt
)paren
comma
id|le32_to_cpu
c_func
(paren
id|rx_status-&gt;fragmentcnt_framelen
)paren
)paren
suffix:semicolon
macro_line|#endif
id|length
op_assign
id|le32_to_cpu
c_func
(paren
id|rx_status-&gt;fragmentcnt_framelen
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|buffer_cnt
op_assign
id|le32_to_cpu
c_func
(paren
id|rx_status-&gt;status_buffercnt
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|i
op_assign
id|buffer_cnt
suffix:semicolon
multiline_comment|/* Need buffer_cnt later for rxenq update */
id|frag_len
op_assign
id|le32_to_cpu
c_func
(paren
id|rx_status-&gt;fragmentcnt_framelen
)paren
op_rshift
l_int|16
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG 
id|printk
c_func
(paren
l_string|&quot;length: %x, frag_len: %x, buffer_cnt: %x&bslash;n&quot;
comma
id|length
comma
id|frag_len
comma
id|buffer_cnt
)paren
suffix:semicolon
macro_line|#endif
id|l_status_buffercnt
op_assign
id|le32_to_cpu
c_func
(paren
id|rx_status-&gt;status_buffercnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_status_buffercnt
op_amp
l_int|0xC0000000
)paren
(brace
r_if
c_cond
(paren
id|l_status_buffercnt
op_amp
l_int|0x3B000000
)paren
(brace
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
(brace
r_if
c_cond
(paren
id|l_status_buffercnt
op_amp
(paren
l_int|1
op_lshift
l_int|29
)paren
)paren
multiline_comment|/* Rx Frame Truncated */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Rx Frame Truncated &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_status_buffercnt
op_amp
(paren
l_int|1
op_lshift
l_int|28
)paren
)paren
multiline_comment|/*Rx receive overrun */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Rx Frame Receive overrun &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_status_buffercnt
op_amp
(paren
l_int|1
op_lshift
l_int|27
)paren
)paren
multiline_comment|/* No receive buffers */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: No receive buffers &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_status_buffercnt
op_amp
(paren
l_int|1
op_lshift
l_int|25
)paren
)paren
multiline_comment|/* Receive frame error detect */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Receive frame error detect &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l_status_buffercnt
op_amp
(paren
l_int|1
op_lshift
l_int|24
)paren
)paren
multiline_comment|/* Received Error Detect */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Received Error Detect &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|olympic_priv-&gt;rx_ring_last_received
op_add_assign
id|i
suffix:semicolon
id|olympic_priv-&gt;rx_ring_last_received
op_and_assign
(paren
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_stats.rx_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|buffer_cnt
op_eq
l_int|1
)paren
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|olympic_priv-&gt;pkt_buf_sz
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|length
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Not enough memory to copy packet to upper layers. &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_stats.rx_dropped
op_increment
suffix:semicolon
multiline_comment|/* Update counters even though we don&squot;t transfer the frame */
id|olympic_priv-&gt;rx_ring_last_received
op_add_assign
id|i
suffix:semicolon
id|olympic_priv-&gt;rx_ring_last_received
op_and_assign
(paren
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Optimise based upon number of buffers used. &n;&t;&t;&t;   &t;   &t;   If only one buffer is used we can simply swap the buffers around.&n;&t;&t;&t;   &t;   &t;   If more than one then we must use the new buffer and copy the information&n;&t;&t;&t;   &t;   &t;   first. Ideally all frames would be in a single buffer, this can be tuned by&n;                               &t;   &t;   altering the buffer size. */
r_if
c_cond
(paren
id|buffer_cnt
op_eq
l_int|1
)paren
(brace
id|olympic_priv-&gt;rx_ring_last_received
op_increment
suffix:semicolon
id|olympic_priv-&gt;rx_ring_last_received
op_and_assign
(paren
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|rx_ring_last_received
op_assign
id|olympic_priv-&gt;rx_ring_last_received
suffix:semicolon
id|skb2
op_assign
id|olympic_priv-&gt;rx_ring_skb
(braket
id|rx_ring_last_received
)braket
suffix:semicolon
id|skb_put
c_func
(paren
id|skb2
comma
id|length
)paren
suffix:semicolon
id|skb2-&gt;protocol
op_assign
id|tr_type_trans
c_func
(paren
id|skb2
comma
id|dev
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_rx_ring
(braket
id|rx_ring_last_received
)braket
dot
id|buffer
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_rx_ring
(braket
id|rx_ring_last_received
)braket
dot
id|res_length
op_assign
id|cpu_to_le32
c_func
(paren
id|olympic_priv-&gt;pkt_buf_sz
)paren
suffix:semicolon
id|olympic_priv-&gt;rx_ring_skb
(braket
id|rx_ring_last_received
)braket
op_assign
id|skb
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb2
)paren
suffix:semicolon
)brace
r_else
(brace
r_do
(brace
multiline_comment|/* Walk the buffers */
id|olympic_priv-&gt;rx_ring_last_received
op_increment
suffix:semicolon
id|olympic_priv-&gt;rx_ring_last_received
op_and_assign
(paren
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|rx_ring_last_received
op_assign
id|olympic_priv-&gt;rx_ring_last_received
suffix:semicolon
id|rx_desc
op_assign
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_ring
(braket
id|rx_ring_last_received
)braket
)paren
suffix:semicolon
id|cpy_length
op_assign
(paren
id|i
op_eq
l_int|1
ques
c_cond
id|frag_len
suffix:colon
id|le32_to_cpu
c_func
(paren
id|rx_desc-&gt;res_length
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|cpy_length
)paren
comma
id|bus_to_virt
c_func
(paren
id|le32_to_cpu
c_func
(paren
id|rx_desc-&gt;buffer
)paren
)paren
comma
id|cpy_length
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|i
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|tr_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|olympic_priv-&gt;olympic_stats.rx_packets
op_increment
suffix:semicolon
id|olympic_priv-&gt;olympic_stats.rx_bytes
op_add_assign
id|length
suffix:semicolon
)brace
multiline_comment|/* if skb == null */
)brace
multiline_comment|/* If status &amp; 0x3b */
)brace
r_else
(brace
multiline_comment|/*if buffercnt &amp; 0xC */
id|olympic_priv-&gt;rx_ring_last_received
op_add_assign
id|i
suffix:semicolon
id|olympic_priv-&gt;rx_ring_last_received
op_and_assign
(paren
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|rx_status-&gt;fragmentcnt_framelen
op_assign
l_int|0
suffix:semicolon
id|rx_status-&gt;status_buffercnt
op_assign
l_int|0
suffix:semicolon
id|rx_status
op_assign
op_amp
(paren
id|olympic_priv-&gt;olympic_rx_status_ring
(braket
(paren
id|olympic_priv-&gt;rx_status_last_received
op_plus
l_int|1
)paren
op_amp
(paren
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
)paren
)braket
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
(paren
(paren
id|readw
c_func
(paren
id|olympic_mmio
op_plus
id|RXENQ
)paren
)paren
op_amp
l_int|0x8000
)paren
op_xor
l_int|0x8000
)paren
op_or
id|buffer_cnt
comma
id|olympic_mmio
op_plus
id|RXENQ
)paren
suffix:semicolon
)brace
multiline_comment|/* while */
)brace
DECL|function|olympic_interrupt
r_static
r_void
id|olympic_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|olympic_mmio
op_assign
id|olympic_priv-&gt;olympic_mmio
suffix:semicolon
id|__u32
id|sisr
suffix:semicolon
id|__u8
op_star
id|adapter_check_area
suffix:semicolon
id|sisr
op_assign
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|SISR_RR
)paren
suffix:semicolon
multiline_comment|/* Reset sisr */
r_if
c_cond
(paren
op_logical_neg
(paren
id|sisr
op_amp
id|SISR_MI
)paren
)paren
multiline_comment|/* Interrupt isn&squot;t for us */
r_return
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sisr
op_amp
(paren
id|SISR_SRB_REPLY
op_or
id|SISR_TX1_EOF
op_or
id|SISR_RX_STATUS
op_or
id|SISR_ADAPTER_CHECK
op_or
id|SISR_ASB_FREE
op_or
id|SISR_ARB_CMD
op_or
id|SISR_TRB_REPLY
op_or
id|SISR_RX_NOBUF
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_SRB_REPLY
)paren
(brace
r_if
c_cond
(paren
id|olympic_priv-&gt;srb_queued
op_eq
l_int|1
)paren
(brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|olympic_priv-&gt;srb_wait
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|olympic_priv-&gt;srb_queued
op_eq
l_int|2
)paren
(brace
id|olympic_srb_bh
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|olympic_priv-&gt;srb_queued
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SISR_SRB_REPLY */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_TX1_EOF
)paren
(brace
id|olympic_priv-&gt;tx_ring_last_status
op_increment
suffix:semicolon
id|olympic_priv-&gt;tx_ring_last_status
op_and_assign
(paren
id|OLYMPIC_TX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|olympic_priv-&gt;free_tx_ring_entries
op_increment
suffix:semicolon
id|olympic_priv-&gt;olympic_stats.tx_bytes
op_add_assign
id|olympic_priv-&gt;tx_ring_skb
(braket
id|olympic_priv-&gt;tx_ring_last_status
)braket
op_member_access_from_pointer
id|len
suffix:semicolon
id|olympic_priv-&gt;olympic_stats.tx_packets
op_increment
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|olympic_priv-&gt;tx_ring_skb
(braket
id|olympic_priv-&gt;tx_ring_last_status
)braket
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_tx_ring
(braket
id|olympic_priv-&gt;tx_ring_last_status
)braket
dot
id|buffer
op_assign
l_int|0xdeadbeef
suffix:semicolon
id|olympic_priv-&gt;olympic_tx_status_ring
(braket
id|olympic_priv-&gt;tx_ring_last_status
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* SISR_TX1_EOF */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_RX_STATUS
)paren
(brace
id|olympic_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* SISR_RX_STATUS */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_ADAPTER_CHECK
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter Check Interrupt Raised, 8 bytes of information follow:&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LAPWWO
)paren
comma
id|olympic_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|adapter_check_area
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|olympic_mmio
op_plus
id|LAPWWO
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Bytes %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readb
c_func
(paren
id|adapter_check_area
op_plus
l_int|0
)paren
comma
id|readb
c_func
(paren
id|adapter_check_area
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|adapter_check_area
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|adapter_check_area
op_plus
l_int|3
)paren
comma
id|readb
c_func
(paren
id|adapter_check_area
op_plus
l_int|4
)paren
comma
id|readb
c_func
(paren
id|adapter_check_area
op_plus
l_int|5
)paren
comma
id|readb
c_func
(paren
id|adapter_check_area
op_plus
l_int|6
)paren
comma
id|readb
c_func
(paren
id|adapter_check_area
op_plus
l_int|7
)paren
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* SISR_ADAPTER_CHECK */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_ASB_FREE
)paren
(brace
multiline_comment|/* Wake up anything that is waiting for the asb response */
r_if
c_cond
(paren
id|olympic_priv-&gt;asb_queued
)paren
(brace
id|olympic_asb_bh
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* SISR_ASB_FREE */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_ARB_CMD
)paren
(brace
id|olympic_arb_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* SISR_ARB_CMD */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_TRB_REPLY
)paren
(brace
multiline_comment|/* Wake up anything that is waiting for the trb response */
r_if
c_cond
(paren
id|olympic_priv-&gt;trb_queued
)paren
(brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|olympic_priv-&gt;trb_wait
)paren
suffix:semicolon
)brace
id|olympic_priv-&gt;trb_queued
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SISR_TRB_REPLY */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_RX_NOBUF
)paren
(brace
multiline_comment|/* According to the documentation, we don&squot;t have to do anything, but trapping it keeps it out of&n;                  &t;   &t;   /var/log/messages.  */
)brace
multiline_comment|/* SISR_RX_NOBUF */
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unexpected interrupt: %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|sisr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: SISR_MASK: %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|SISR_MASK
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* One if the interrupts we want */
id|writel
c_func
(paren
id|SISR_MI
comma
id|olympic_mmio
op_plus
id|SISR_MASK_SUM
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_lock
)paren
suffix:semicolon
)brace
DECL|function|olympic_xmit
r_static
r_int
id|olympic_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|olympic_mmio
op_assign
id|olympic_priv-&gt;olympic_mmio
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_lock
comma
id|flags
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|olympic_priv-&gt;free_tx_ring_entries
)paren
(brace
id|olympic_priv-&gt;olympic_tx_ring
(braket
id|olympic_priv-&gt;tx_ring_free
)braket
dot
id|buffer
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_tx_ring
(braket
id|olympic_priv-&gt;tx_ring_free
)braket
dot
id|status_length
op_assign
id|cpu_to_le32
c_func
(paren
id|skb-&gt;len
op_or
(paren
l_int|0x80000000
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;tx_ring_skb
(braket
id|olympic_priv-&gt;tx_ring_free
)braket
op_assign
id|skb
suffix:semicolon
id|olympic_priv-&gt;free_tx_ring_entries
op_decrement
suffix:semicolon
id|olympic_priv-&gt;tx_ring_free
op_increment
suffix:semicolon
id|olympic_priv-&gt;tx_ring_free
op_and_assign
(paren
id|OLYMPIC_TX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
(paren
(paren
id|readw
c_func
(paren
id|olympic_mmio
op_plus
id|TXENQ_1
)paren
)paren
op_amp
l_int|0x8000
)paren
op_xor
l_int|0x8000
)paren
op_or
l_int|1
comma
id|olympic_mmio
op_plus
id|TXENQ_1
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|olympic_priv-&gt;olympic_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|olympic_close
r_static
r_int
id|olympic_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|olympic_mmio
op_assign
id|olympic_priv-&gt;olympic_mmio
comma
op_star
id|srb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
id|olympic_priv-&gt;srb
comma
id|olympic_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|srb
op_assign
id|olympic_priv-&gt;olympic_lap
op_plus
(paren
id|olympic_priv-&gt;srb
op_amp
(paren
op_complement
l_int|0xf800
)paren
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|SRB_CLOSE_ADAPTER
comma
id|srb
op_plus
l_int|0
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|1
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|OLYMPIC_CLEAR_RET_CODE
comma
id|srb
op_plus
l_int|2
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|olympic_priv-&gt;srb_queued
op_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
id|LISR_SRB_CMD
comma
id|olympic_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
r_while
c_loop
(paren
id|olympic_priv-&gt;srb_queued
)paren
(brace
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|olympic_priv-&gt;srb_wait
comma
id|jiffies
op_plus
l_int|60
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: SRB timed out.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;SISR=%x MISR=%x&bslash;n&quot;
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|SISR
)paren
comma
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LISR
)paren
)paren
suffix:semicolon
id|olympic_priv-&gt;srb_queued
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|olympic_priv-&gt;rx_status_last_received
op_increment
suffix:semicolon
id|olympic_priv-&gt;rx_status_last_received
op_and_assign
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|OLYMPIC_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|olympic_priv-&gt;rx_ring_skb
(braket
id|olympic_priv-&gt;rx_status_last_received
)braket
)paren
suffix:semicolon
id|olympic_priv-&gt;rx_status_last_received
op_increment
suffix:semicolon
id|olympic_priv-&gt;rx_status_last_received
op_and_assign
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* reset tx/rx fifo&squot;s and busmaster logic */
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|BCTL
)paren
op_or
(paren
l_int|3
op_lshift
l_int|13
)paren
comma
id|olympic_mmio
op_plus
id|BCTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|BCTL
)paren
op_amp
op_complement
(paren
l_int|3
op_lshift
l_int|13
)paren
comma
id|olympic_mmio
op_plus
id|BCTL
)paren
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG
id|printk
c_func
(paren
l_string|&quot;srb(%p): &quot;
comma
id|srb
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x &quot;
comma
id|readb
c_func
(paren
id|srb
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|olympic_set_rx_mode
r_static
r_void
id|olympic_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|olympic_mmio
op_assign
id|olympic_priv-&gt;olympic_mmio
suffix:semicolon
id|__u8
id|options
op_assign
l_int|0
suffix:semicolon
id|__u8
op_star
id|srb
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|dmi
suffix:semicolon
r_int
r_char
id|dev_mc_address
(braket
l_int|4
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
id|writel
c_func
(paren
id|olympic_priv-&gt;srb
comma
id|olympic_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|srb
op_assign
id|olympic_priv-&gt;olympic_lap
op_plus
(paren
id|olympic_priv-&gt;srb
op_amp
(paren
op_complement
l_int|0xf800
)paren
)paren
suffix:semicolon
id|options
op_assign
id|olympic_priv-&gt;olympic_copy_all_options
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
id|options
op_or_assign
l_int|0x61
suffix:semicolon
r_else
id|options
op_and_assign
op_complement
l_int|0x61
suffix:semicolon
multiline_comment|/* Only issue the srb if there is a change in options */
r_if
c_cond
(paren
(paren
id|options
op_xor
id|olympic_priv-&gt;olympic_copy_all_options
)paren
)paren
(brace
multiline_comment|/* Now to issue the srb command to alter the copy.all.options */
id|writeb
c_func
(paren
id|SRB_MODIFY_RECEIVE_OPTIONS
comma
id|srb
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|1
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|OLYMPIC_CLEAR_RET_CODE
comma
id|srb
op_plus
l_int|2
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|3
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|olympic_priv-&gt;olympic_receive_options
comma
id|srb
op_plus
l_int|4
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|options
comma
id|srb
op_plus
l_int|5
)paren
suffix:semicolon
id|olympic_priv-&gt;srb_queued
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Can&squot;t sleep, use srb_bh */
id|writel
c_func
(paren
id|LISR_SRB_CMD
comma
id|olympic_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
id|olympic_priv-&gt;olympic_copy_all_options
op_assign
id|options
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Set the functional addresses we need for multicast */
id|dev_mc_address
(braket
l_int|0
)braket
op_assign
id|dev_mc_address
(braket
l_int|1
)braket
op_assign
id|dev_mc_address
(braket
l_int|2
)braket
op_assign
id|dev_mc_address
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|dmi
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|dmi
op_assign
id|dmi-&gt;next
)paren
(brace
id|dev_mc_address
(braket
l_int|0
)braket
op_or_assign
id|dmi-&gt;dmi_addr
(braket
l_int|2
)braket
suffix:semicolon
id|dev_mc_address
(braket
l_int|1
)braket
op_or_assign
id|dmi-&gt;dmi_addr
(braket
l_int|3
)braket
suffix:semicolon
id|dev_mc_address
(braket
l_int|2
)braket
op_or_assign
id|dmi-&gt;dmi_addr
(braket
l_int|4
)braket
suffix:semicolon
id|dev_mc_address
(braket
l_int|3
)braket
op_or_assign
id|dmi-&gt;dmi_addr
(braket
l_int|5
)braket
suffix:semicolon
)brace
id|writeb
c_func
(paren
id|SRB_SET_FUNC_ADDRESS
comma
id|srb
op_plus
l_int|0
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|1
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|OLYMPIC_CLEAR_RET_CODE
comma
id|srb
op_plus
l_int|2
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|3
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|4
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|5
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|dev_mc_address
(braket
l_int|0
)braket
comma
id|srb
op_plus
l_int|6
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|dev_mc_address
(braket
l_int|1
)braket
comma
id|srb
op_plus
l_int|7
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|dev_mc_address
(braket
l_int|2
)braket
comma
id|srb
op_plus
l_int|8
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|dev_mc_address
(braket
l_int|3
)braket
comma
id|srb
op_plus
l_int|9
)paren
suffix:semicolon
id|olympic_priv-&gt;srb_queued
op_assign
l_int|2
suffix:semicolon
id|writel
c_func
(paren
id|LISR_SRB_CMD
comma
id|olympic_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
)brace
DECL|function|olympic_srb_bh
r_static
r_void
id|olympic_srb_bh
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|olympic_mmio
op_assign
id|olympic_priv-&gt;olympic_mmio
suffix:semicolon
id|__u8
op_star
id|srb
suffix:semicolon
id|writel
c_func
(paren
id|olympic_priv-&gt;srb
comma
id|olympic_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|srb
op_assign
id|olympic_priv-&gt;olympic_lap
op_plus
(paren
id|olympic_priv-&gt;srb
op_amp
(paren
op_complement
l_int|0xf800
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|readb
c_func
(paren
id|srb
)paren
)paren
(brace
multiline_comment|/* SRB_MODIFY_RECEIVE_OPTIONS i.e. set_multicast_list options (promiscuous) &n;                 * At some point we should do something if we get an error, such as&n;                 * resetting the IFF_PROMISC flag in dev&n;&t;&t; */
r_case
id|SRB_MODIFY_RECEIVE_OPTIONS
suffix:colon
r_switch
c_cond
(paren
id|readb
c_func
(paren
id|srb
op_plus
l_int|2
)paren
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Receive Options Modified to %x,%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|olympic_priv-&gt;olympic_copy_all_options
comma
id|olympic_priv-&gt;olympic_receive_options
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
multiline_comment|/* SRB_SET_GROUP_ADDRESS - Multicast group setting &n;                 */
r_case
id|SRB_SET_GROUP_ADDRESS
suffix:colon
r_switch
c_cond
(paren
id|readb
c_func
(paren
id|srb
op_plus
l_int|2
)paren
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3c
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Group/Functional address indicator bits not set correctly&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3e
suffix:colon
multiline_comment|/* If we ever implement individual multicast addresses, will need to deal with this */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Group address registers full&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x55
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Group Address already set.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
multiline_comment|/* SRB_RESET_GROUP_ADDRESS - Remove a multicast address from group list&n; &t;&t; */
r_case
id|SRB_RESET_GROUP_ADDRESS
suffix:colon
r_switch
c_cond
(paren
id|readb
c_func
(paren
id|srb
op_plus
l_int|2
)paren
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x39
suffix:colon
multiline_comment|/* Must deal with this if individual multicast addresses used */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Group address not found &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
multiline_comment|/* SRB_SET_FUNC_ADDRESS - Called by the set_rx_mode &n;&t;&t; */
r_case
id|SRB_SET_FUNC_ADDRESS
suffix:colon
r_switch
c_cond
(paren
id|readb
c_func
(paren
id|srb
op_plus
l_int|2
)paren
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Functional Address Mask Set &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
multiline_comment|/* SRB_READ_LOG - Read and reset the adapter error counters&n; &t;&t; */
r_case
id|SRB_READ_LOG
suffix:colon
r_switch
c_cond
(paren
id|readb
c_func
(paren
id|srb
op_plus
l_int|2
)paren
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Read Log issued&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
multiline_comment|/* SRB_READ_SR_COUNTERS - Read and reset the source routing bridge related counters */
r_case
id|SRB_READ_SR_COUNTERS
suffix:colon
r_switch
c_cond
(paren
id|readb
c_func
(paren
id|srb
op_plus
l_int|2
)paren
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Read Source Routing Counters issued&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb bh return value.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[0] */
)brace
DECL|function|olympic_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|olympic_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
suffix:semicolon
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
(paren
r_struct
id|net_device_stats
op_star
)paren
op_amp
id|olympic_priv-&gt;olympic_stats
suffix:semicolon
)brace
DECL|function|olympic_set_mac_address
r_static
r_int
id|olympic_set_mac_address
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|addr
)paren
(brace
r_struct
id|sockaddr
op_star
id|saddr
op_assign
id|addr
suffix:semicolon
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Cannot set mac/laa address while card is open&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|olympic_priv-&gt;olympic_laa
comma
id|saddr-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MAC/LAA Set to  = %x.%x.%x.%x.%x.%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|olympic_priv-&gt;olympic_laa
(braket
l_int|0
)braket
comma
id|olympic_priv-&gt;olympic_laa
(braket
l_int|1
)braket
comma
id|olympic_priv-&gt;olympic_laa
(braket
l_int|2
)braket
comma
id|olympic_priv-&gt;olympic_laa
(braket
l_int|3
)braket
comma
id|olympic_priv-&gt;olympic_laa
(braket
l_int|4
)braket
comma
id|olympic_priv-&gt;olympic_laa
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|olympic_arb_cmd
r_static
r_void
id|olympic_arb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|olympic_mmio
op_assign
id|olympic_priv-&gt;olympic_mmio
suffix:semicolon
id|__u8
op_star
id|arb_block
comma
op_star
id|asb_block
comma
op_star
id|srb
suffix:semicolon
id|__u8
id|header_len
suffix:semicolon
id|__u16
id|frame_len
comma
id|buffer_len
suffix:semicolon
r_struct
id|sk_buff
op_star
id|mac_frame
suffix:semicolon
id|__u8
op_star
id|buf_ptr
suffix:semicolon
id|__u8
op_star
id|frame_data
suffix:semicolon
id|__u16
id|buff_off
suffix:semicolon
id|__u16
id|lan_status
op_assign
l_int|0
comma
id|lan_status_diff
suffix:semicolon
multiline_comment|/* Initialize to stop compiler warning */
id|__u8
id|fdx_prot_error
suffix:semicolon
id|__u16
id|next_ptr
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#if OLYMPIC_NETWORK_MONITOR
r_struct
id|trh_hdr
op_star
id|mac_hdr
suffix:semicolon
macro_line|#endif
id|arb_block
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|olympic_priv-&gt;olympic_lap
op_plus
id|olympic_priv-&gt;arb
)paren
suffix:semicolon
id|asb_block
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|olympic_priv-&gt;olympic_lap
op_plus
id|olympic_priv-&gt;asb
)paren
suffix:semicolon
id|srb
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|olympic_priv-&gt;olympic_lap
op_plus
id|olympic_priv-&gt;srb
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|LAPA
)paren
comma
id|olympic_mmio
op_plus
id|LAPWWO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readb
c_func
(paren
id|arb_block
op_plus
l_int|0
)paren
op_eq
id|ARB_RECEIVE_DATA
)paren
(brace
multiline_comment|/* Receive.data, MAC frames */
id|header_len
op_assign
id|readb
c_func
(paren
id|arb_block
op_plus
l_int|8
)paren
suffix:semicolon
multiline_comment|/* 802.5 Token-Ring Header Length */
id|frame_len
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|arb_block
op_plus
l_int|10
)paren
)paren
suffix:semicolon
id|buff_off
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|arb_block
op_plus
l_int|6
)paren
)paren
suffix:semicolon
id|buf_ptr
op_assign
id|olympic_priv-&gt;olympic_lap
op_plus
id|buff_off
suffix:semicolon
macro_line|#if OLYMPIC_DEBUG
(brace
r_int
id|i
suffix:semicolon
id|frame_data
op_assign
id|buf_ptr
op_plus
m_offsetof
(paren
r_struct
id|mac_receive_buffer
comma
id|frame_data
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|14
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Loc %d = %02x&bslash;n&quot;
comma
id|i
comma
id|readb
c_func
(paren
id|frame_data
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;next %04x, fs %02x, len %04x &bslash;n&quot;
comma
id|readw
c_func
(paren
id|buf_ptr
op_plus
m_offsetof
(paren
r_struct
id|mac_receive_buffer
comma
id|next
)paren
)paren
comma
id|readb
c_func
(paren
id|buf_ptr
op_plus
m_offsetof
(paren
r_struct
id|mac_receive_buffer
comma
id|frame_status
)paren
)paren
comma
id|readw
c_func
(paren
id|buf_ptr
op_plus
m_offsetof
(paren
r_struct
id|mac_receive_buffer
comma
id|buffer_length
)paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif 
id|mac_frame
op_assign
id|dev_alloc_skb
c_func
(paren
id|frame_len
)paren
suffix:semicolon
multiline_comment|/* Walk the buffer chain, creating the frame */
r_do
(brace
id|frame_data
op_assign
id|buf_ptr
op_plus
m_offsetof
(paren
r_struct
id|mac_receive_buffer
comma
id|frame_data
)paren
suffix:semicolon
id|buffer_len
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|buf_ptr
op_plus
m_offsetof
(paren
r_struct
id|mac_receive_buffer
comma
id|buffer_length
)paren
)paren
)paren
suffix:semicolon
id|memcpy_fromio
c_func
(paren
id|skb_put
c_func
(paren
id|mac_frame
comma
id|buffer_len
)paren
comma
id|frame_data
comma
id|buffer_len
)paren
suffix:semicolon
id|next_ptr
op_assign
id|readw
c_func
(paren
id|buf_ptr
op_plus
m_offsetof
(paren
r_struct
id|mac_receive_buffer
comma
id|next
)paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|next_ptr
op_logical_and
(paren
id|buf_ptr
op_assign
id|olympic_priv-&gt;olympic_lap
op_plus
id|ntohs
c_func
(paren
id|next_ptr
)paren
)paren
)paren
suffix:semicolon
macro_line|#if OLYMPIC_NETWORK_MONITOR
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Received MAC Frame, details: &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|mac_hdr
op_assign
(paren
r_struct
id|trh_hdr
op_star
)paren
id|mac_frame-&gt;data
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: MAC Frame Dest. Addr: %02x:%02x:%02x:%02x:%02x:%02x &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mac_hdr-&gt;daddr
(braket
l_int|0
)braket
comma
id|mac_hdr-&gt;daddr
(braket
l_int|1
)braket
comma
id|mac_hdr-&gt;daddr
(braket
l_int|2
)braket
comma
id|mac_hdr-&gt;daddr
(braket
l_int|3
)braket
comma
id|mac_hdr-&gt;daddr
(braket
l_int|4
)braket
comma
id|mac_hdr-&gt;daddr
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: MAC Frame Srce. Addr: %02x:%02x:%02x:%02x:%02x:%02x &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mac_hdr-&gt;saddr
(braket
l_int|0
)braket
comma
id|mac_hdr-&gt;saddr
(braket
l_int|1
)braket
comma
id|mac_hdr-&gt;saddr
(braket
l_int|2
)braket
comma
id|mac_hdr-&gt;saddr
(braket
l_int|3
)braket
comma
id|mac_hdr-&gt;saddr
(braket
l_int|4
)braket
comma
id|mac_hdr-&gt;saddr
(braket
l_int|5
)braket
)paren
suffix:semicolon
macro_line|#endif
id|mac_frame-&gt;dev
op_assign
id|dev
suffix:semicolon
id|mac_frame-&gt;protocol
op_assign
id|tr_type_trans
c_func
(paren
id|mac_frame
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|mac_frame
)paren
suffix:semicolon
multiline_comment|/* Now tell the card we have dealt with the received frame */
multiline_comment|/* Set LISR Bit 1 */
id|writel
c_func
(paren
id|LISR_ARB_FREE
comma
id|olympic_priv-&gt;olympic_lap
op_plus
id|LISR_SUM
)paren
suffix:semicolon
multiline_comment|/* Is the ASB free ? */
r_if
c_cond
(paren
id|readb
c_func
(paren
id|asb_block
op_plus
l_int|2
)paren
op_ne
l_int|0xff
)paren
(brace
id|olympic_priv-&gt;asb_queued
op_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
id|LISR_ASB_FREE_REQ
comma
id|olympic_priv-&gt;olympic_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* Drop out and wait for the bottom half to be run */
)brace
id|writeb
c_func
(paren
id|ASB_RECEIVE_DATA
comma
id|asb_block
)paren
suffix:semicolon
multiline_comment|/* Receive data */
id|writeb
c_func
(paren
id|OLYMPIC_CLEAR_RET_CODE
comma
id|asb_block
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Necessary ?? */
id|writeb
c_func
(paren
id|readb
c_func
(paren
id|arb_block
op_plus
l_int|6
)paren
comma
id|asb_block
op_plus
l_int|6
)paren
suffix:semicolon
multiline_comment|/* Must send the address back to the adapter */
id|writeb
c_func
(paren
id|readb
c_func
(paren
id|arb_block
op_plus
l_int|7
)paren
comma
id|asb_block
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* To let it know we have dealt with the data */
id|writel
c_func
(paren
id|LISR_ASB_REPLY
op_or
id|LISR_ASB_FREE_REQ
comma
id|olympic_priv-&gt;olympic_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
id|olympic_priv-&gt;asb_queued
op_assign
l_int|2
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|readb
c_func
(paren
id|arb_block
)paren
op_eq
id|ARB_LAN_CHANGE_STATUS
)paren
(brace
multiline_comment|/* Lan.change.status */
id|lan_status
op_assign
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|arb_block
op_plus
l_int|6
)paren
)paren
suffix:semicolon
id|fdx_prot_error
op_assign
id|readb
c_func
(paren
id|arb_block
op_plus
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Issue ARB Free */
id|writel
c_func
(paren
id|LISR_ARB_FREE
comma
id|olympic_priv-&gt;olympic_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
id|lan_status_diff
op_assign
id|olympic_priv-&gt;olympic_lan_status
op_xor
id|lan_status
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
(paren
id|LSC_LWF
op_or
id|LSC_ARW
op_or
id|LSC_FPE
op_or
id|LSC_RR
)paren
)paren
(brace
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_LWF
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Short circuit detected on the lobe&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_ARW
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Auto removal error&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_FPE
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: FDX Protocol Error&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_RR
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Force remove MAC frame received&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Adapter has been closed by the hardware */
multiline_comment|/* reset tx/rx fifo&squot;s and busmaster logic */
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|BCTL
)paren
op_or
(paren
l_int|3
op_lshift
l_int|13
)paren
comma
id|olympic_mmio
op_plus
id|BCTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|olympic_mmio
op_plus
id|BCTL
)paren
op_amp
op_complement
(paren
l_int|3
op_lshift
l_int|13
)paren
comma
id|olympic_mmio
op_plus
id|BCTL
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|olympic_priv-&gt;srb
op_assign
id|readw
c_func
(paren
id|olympic_priv-&gt;olympic_lap
op_plus
id|LAPWWO
)paren
suffix:semicolon
id|olympic_priv-&gt;rx_status_last_received
op_increment
suffix:semicolon
id|olympic_priv-&gt;rx_status_last_received
op_and_assign
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|OLYMPIC_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|olympic_priv-&gt;rx_ring_skb
(braket
id|olympic_priv-&gt;rx_status_last_received
)braket
)paren
suffix:semicolon
id|olympic_priv-&gt;rx_status_last_received
op_increment
suffix:semicolon
id|olympic_priv-&gt;rx_status_last_received
op_and_assign
id|OLYMPIC_RX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
)brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter has been closed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
multiline_comment|/* If serious error */
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
(brace
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_SIG_LOSS
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: No receive signal detected &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_HARD_ERR
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Beaconing &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_SOFT_ERR
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter transmitted Soft Error Report Mac Frame &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_TRAN_BCN
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: We are tranmitting the beacon, aaah&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_SS
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Single Station on the ring &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_RING_REC
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Ring recovery ongoing&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_FDX_MODE
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Operating in FDX mode&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_CO
)paren
(brace
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Counter Overflow &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Issue READ.LOG command */
id|writeb
c_func
(paren
id|SRB_READ_LOG
comma
id|srb
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|1
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|OLYMPIC_CLEAR_RET_CODE
comma
id|srb
op_plus
l_int|2
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|3
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|4
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|5
)paren
suffix:semicolon
id|olympic_priv-&gt;srb_queued
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Can&squot;t sleep, use srb_bh */
id|writel
c_func
(paren
id|LISR_SRB_CMD
comma
id|olympic_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_SR_CO
)paren
(brace
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Source routing counters overflow&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Issue a READ.SR.COUNTERS */
id|writeb
c_func
(paren
id|SRB_READ_SR_COUNTERS
comma
id|srb
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|1
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|OLYMPIC_CLEAR_RET_CODE
comma
id|srb
op_plus
l_int|2
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|srb
op_plus
l_int|3
)paren
suffix:semicolon
id|olympic_priv-&gt;srb_queued
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Can&squot;t sleep, use srb_bh */
id|writel
c_func
(paren
id|LISR_SRB_CMD
comma
id|olympic_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
)brace
id|olympic_priv-&gt;olympic_lan_status
op_assign
id|lan_status
suffix:semicolon
)brace
multiline_comment|/* Lan.change.status */
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unknown arb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
DECL|function|olympic_asb_bh
r_static
r_void
id|olympic_asb_bh
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|arb_block
comma
op_star
id|asb_block
suffix:semicolon
id|arb_block
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|olympic_priv-&gt;olympic_lap
op_plus
id|olympic_priv-&gt;arb
)paren
suffix:semicolon
id|asb_block
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|olympic_priv-&gt;olympic_lap
op_plus
id|olympic_priv-&gt;asb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|olympic_priv-&gt;asb_queued
op_eq
l_int|1
)paren
(brace
multiline_comment|/* Dropped through the first time */
id|writeb
c_func
(paren
id|ASB_RECEIVE_DATA
comma
id|asb_block
)paren
suffix:semicolon
multiline_comment|/* Receive data */
id|writeb
c_func
(paren
id|OLYMPIC_CLEAR_RET_CODE
comma
id|asb_block
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Necessary ?? */
id|writeb
c_func
(paren
id|readb
c_func
(paren
id|arb_block
op_plus
l_int|6
)paren
comma
id|asb_block
op_plus
l_int|6
)paren
suffix:semicolon
multiline_comment|/* Must send the address back to the adapter */
id|writeb
c_func
(paren
id|readb
c_func
(paren
id|arb_block
op_plus
l_int|7
)paren
comma
id|asb_block
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* To let it know we have dealt with the data */
id|writel
c_func
(paren
id|LISR_ASB_REPLY
op_or
id|LISR_ASB_FREE_REQ
comma
id|olympic_priv-&gt;olympic_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
id|olympic_priv-&gt;asb_queued
op_assign
l_int|2
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|olympic_priv-&gt;asb_queued
op_eq
l_int|2
)paren
(brace
r_switch
c_cond
(paren
id|readb
c_func
(paren
id|asb_block
op_plus
l_int|2
)paren
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized command code &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x26
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized buffer address &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xFF
suffix:colon
multiline_comment|/* Valid response, everything should be ok again */
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Invalid return code in asb&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|olympic_priv-&gt;asb_queued
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|olympic_change_mtu
r_static
r_int
id|olympic_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|mtu
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u16
id|max_mtu
suffix:semicolon
r_if
c_cond
(paren
id|olympic_priv-&gt;olympic_ring_speed
op_eq
l_int|4
)paren
id|max_mtu
op_assign
l_int|4500
suffix:semicolon
r_else
id|max_mtu
op_assign
l_int|18000
suffix:semicolon
r_if
c_cond
(paren
id|mtu
OG
id|max_mtu
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|mtu
OL
l_int|100
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|mtu
suffix:semicolon
id|olympic_priv-&gt;pkt_buf_sz
op_assign
id|mtu
op_plus
id|TR_HLEN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if OLYMPIC_NETWORK_MONITOR
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|olympic_proc_info
r_static
r_int
id|olympic_proc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_device
op_assign
l_int|NULL
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
r_int
id|size
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;IBM Pit/Pit-Phy/Olympic Chipset Token Ring Adapters&bslash;n&quot;
)paren
suffix:semicolon
id|pos
op_add_assign
id|size
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pci_device
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_IBM
comma
id|PCI_DEVICE_ID_IBM_TR_WAKE
comma
id|pci_device
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
op_ne
l_int|NULL
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;base_addr
op_eq
id|pci_device-&gt;resource
(braket
l_int|0
)braket
dot
id|start
)paren
(brace
multiline_comment|/* Yep, an Olympic device */
id|size
op_assign
id|sprintf_info
c_func
(paren
id|buffer
op_plus
id|len
comma
id|dev
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* if */
)brace
multiline_comment|/* for */
)brace
multiline_comment|/* While */
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start of wanted data */
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start slop */
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
)brace
multiline_comment|/* Ending slop */
r_return
id|len
suffix:semicolon
)brace
DECL|function|sprintf_info
r_static
r_int
id|sprintf_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|olympic_private
op_star
id|olympic_priv
op_assign
(paren
r_struct
id|olympic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|oat
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|olympic_priv-&gt;olympic_lap
op_plus
id|olympic_priv-&gt;olympic_addr_table_addr
)paren
suffix:semicolon
id|__u8
op_star
id|opt
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|olympic_priv-&gt;olympic_lap
op_plus
id|olympic_priv-&gt;olympic_parms_addr
)paren
suffix:semicolon
r_int
id|size
op_assign
l_int|0
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n%6s: Adapter Address   : Node Address      : Functional Addr&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: %02x:%02x:%02x:%02x:%02x:%02x : %02x:%02x:%02x:%02x:%02x:%02x : %02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
op_plus
l_int|3
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
op_plus
l_int|4
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|node_addr
)paren
op_plus
l_int|5
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|func_addr
)paren
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|func_addr
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|func_addr
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|oat
op_plus
m_offsetof
(paren
r_struct
id|olympic_adapter_addr_table
comma
id|func_addr
)paren
op_plus
l_int|3
)paren
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;&bslash;n%6s: Token Ring Parameters Table:&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: Physical Addr : Up Node Address   : Poll Address      : AccPri : Auth Src : Att Code :&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: %02x:%02x:%02x:%02x   : %02x:%02x:%02x:%02x:%02x:%02x : %02x:%02x:%02x:%02x:%02x:%02x : %04x   : %04x     :  %04x    :&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|phys_addr
)paren
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|phys_addr
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|phys_addr
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|phys_addr
)paren
op_plus
l_int|3
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
op_plus
l_int|3
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
op_plus
l_int|4
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|up_node_addr
)paren
op_plus
l_int|5
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|poll_addr
)paren
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|poll_addr
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|poll_addr
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|poll_addr
)paren
op_plus
l_int|3
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|poll_addr
)paren
op_plus
l_int|4
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|poll_addr
)paren
op_plus
l_int|5
)paren
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|acc_priority
)paren
)paren
)paren
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|auth_source_class
)paren
)paren
)paren
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|att_code
)paren
)paren
)paren
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: Source Address    : Bcn T : Maj. V : Lan St : Lcl Rg : Mon Err : Frame Correl : &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: %02x:%02x:%02x:%02x:%02x:%02x : %04x  : %04x   : %04x   : %04x   : %04x    :     %04x     : &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|source_addr
)paren
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|source_addr
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|source_addr
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|source_addr
)paren
op_plus
l_int|3
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|source_addr
)paren
op_plus
l_int|4
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|source_addr
)paren
op_plus
l_int|5
)paren
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_type
)paren
)paren
)paren
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|major_vector
)paren
)paren
)paren
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|lan_status
)paren
)paren
)paren
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|local_ring
)paren
)paren
)paren
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|mon_error
)paren
)paren
)paren
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|frame_correl
)paren
)paren
)paren
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: Beacon Details :  Tx  :  Rx  : NAUN Node Address : NAUN Node Phys : &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s:                :  %02x  :  %02x  : %02x:%02x:%02x:%02x:%02x:%02x : %02x:%02x:%02x:%02x    : &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_transmit
)paren
)paren
)paren
comma
id|swab16
c_func
(paren
id|readw
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_receive
)paren
)paren
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_naun
)paren
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_naun
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_naun
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_naun
)paren
op_plus
l_int|3
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_naun
)paren
op_plus
l_int|4
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_naun
)paren
op_plus
l_int|5
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_phys
)paren
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_phys
)paren
op_plus
l_int|1
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_phys
)paren
op_plus
l_int|2
)paren
comma
id|readb
c_func
(paren
id|opt
op_plus
m_offsetof
(paren
r_struct
id|olympic_parameters_table
comma
id|beacon_phys
)paren
op_plus
l_int|3
)paren
)paren
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif 
macro_line|#ifdef MODULE
DECL|variable|dev_olympic
r_static
r_struct
id|net_device
op_star
id|dev_olympic
(braket
id|OLYMPIC_MAX_ADAPTERS
)braket
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#if OLYMPIC_NETWORK_MONITOR
macro_line|#ifdef CONFIG_PROC_FS
id|create_proc_read_entry
c_func
(paren
l_string|&quot;net/olympic_tr&quot;
comma
l_int|0
comma
l_int|0
comma
id|olympic_proc_info
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
id|OLYMPIC_MAX_ADAPTERS
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev_olympic
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev_olympic
(braket
id|i
)braket
op_assign
id|init_trdev
c_func
(paren
id|dev_olympic
(braket
id|i
)braket
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_olympic
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|dev_olympic
(braket
id|i
)braket
op_member_access_from_pointer
id|init
op_assign
op_amp
id|olympic_probe
suffix:semicolon
r_if
c_cond
(paren
id|register_trdev
c_func
(paren
id|dev_olympic
(braket
id|i
)braket
)paren
op_ne
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|dev_olympic
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev_olympic
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Olympic: No IBM PCI Token Ring cards found in system.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Olympic: %d IBM PCI Token Ring card(s) found in system.&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|OLYMPIC_MAX_ADAPTERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev_olympic
(braket
id|i
)braket
)paren
(brace
id|unregister_trdev
c_func
(paren
id|dev_olympic
(braket
id|i
)braket
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev_olympic
(braket
id|i
)braket
op_member_access_from_pointer
id|base_addr
comma
id|OLYMPIC_IO_SPACE
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev_olympic
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev_olympic
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev_olympic
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#if OLYMPIC_NETWORK_MONITOR
macro_line|#ifdef CONFIG_PROC_FS
id|remove_proc_entry
c_func
(paren
l_string|&quot;net/olympic_tr&quot;
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif 
macro_line|#endif
)brace
macro_line|#endif /* MODULE */
eof
