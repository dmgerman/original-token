multiline_comment|/*&n; *  smctr.c: A network driver for the SMC Token Ring Adapters.&n; *&n; *  Written by Jay Schulist &lt;jschlst@turbolinux.com&gt;&n; *&n; *  This software may be used and distributed according to the terms&n; *  of the GNU Public License, incorporated herein by reference.&n; *&n; *  This device driver works with the following SMC adapters:&n; *      - SMC TokenCard Elite   (8115T)&n; *      - SMC TokenCard Elite/A MCA (8115T/A)&n; *&n; *  Source(s):&n; *  &t;- SMC TokenCard SDK.&n; *&n; *  Maintainer(s):&n; *    JS        Jay Schulist &lt;jschlst@turbolinux.com&gt;&n; *&n; *  To do:&n; *    1. Multicast support.&n; */
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;smctr.c: v1.1 1/1/00 by jschlst@turbolinux.com&bslash;n&quot;
suffix:semicolon
DECL|variable|cardname
r_static
r_const
r_char
op_star
id|cardname
op_assign
l_string|&quot;smctr&quot;
suffix:semicolon
macro_line|#ifdef MODULE
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/mca.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/trdevice.h&gt;
macro_line|#include &quot;smctr.h&quot;               /* Our Stuff */
macro_line|#include &quot;smctr_firmware.h&quot;      /* SMC adapter firmware */
DECL|macro|SMCTR_IO_EXTENT
mdefine_line|#define SMCTR_IO_EXTENT   20
multiline_comment|/* A zero-terminated list of I/O addresses to be probed. */
DECL|variable|__initdata
r_static
r_int
r_int
id|smctr_portlist
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x200
comma
l_int|0x220
comma
l_int|0x240
comma
l_int|0x260
comma
l_int|0x280
comma
l_int|0x2A0
comma
l_int|0x2C0
comma
l_int|0x2E0
comma
l_int|0x300
comma
l_int|0x320
comma
l_int|0x340
comma
l_int|0x360
comma
l_int|0x380
comma
l_int|0
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_MCA
DECL|variable|smctr_posid
r_static
r_int
r_int
id|smctr_posid
op_assign
l_int|0x6ec6
suffix:semicolon
macro_line|#endif
DECL|variable|ringspeed
r_static
r_int
id|ringspeed
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* SMC Name of the Adapter. */
DECL|variable|smctr_name
r_static
r_char
op_star
id|smctr_name
op_assign
l_string|&quot;SMC TokenCard&quot;
suffix:semicolon
DECL|variable|smctr_model
r_char
op_star
id|smctr_model
op_assign
l_string|&quot;Unknown&quot;
suffix:semicolon
multiline_comment|/* Use 0 for production, 1 for verification, 2 for debug, and&n; * 3 for very verbose debug.&n; */
macro_line|#ifndef SMCTR_DEBUG
DECL|macro|SMCTR_DEBUG
mdefine_line|#define SMCTR_DEBUG 1
macro_line|#endif
DECL|variable|smctr_debug
r_static
r_int
r_int
id|smctr_debug
op_assign
id|SMCTR_DEBUG
suffix:semicolon
multiline_comment|/* smctr.c prototypes and functions are arranged alphabeticly &n; * for clearity, maintainability and pure old fashion fun. &n; */
multiline_comment|/* A */
r_static
r_int
id|smctr_alloc_shared_memory
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* B */
r_static
r_int
id|smctr_bypass_state
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* C */
r_static
r_int
id|smctr_checksum_firmware
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|__init
id|smctr_chk_isa
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_chg_rx_mask
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_clear_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_clear_trc_reset
c_func
(paren
r_int
id|ioaddr
)paren
suffix:semicolon
r_static
r_int
id|smctr_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* D */
r_static
r_int
id|smctr_decode_firmware
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_disable_16bit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_disable_adapter_ctrl_store
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_disable_adapter_ram
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_disable_bic_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* E */
r_static
r_int
id|smctr_enable_16bit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_enable_adapter_ctrl_store
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_enable_adapter_ram
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_enable_bic_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* G */
r_static
r_int
id|__init
id|smctr_get_boardid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|mca
)paren
suffix:semicolon
r_static
r_int
id|smctr_get_group_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_get_functional_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
r_int
id|smctr_get_num_rx_bdbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_get_physical_drop_number
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
id|__u8
op_star
id|smctr_get_rx_pointer
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|queue
)paren
suffix:semicolon
r_static
r_int
id|smctr_get_station_id
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|smctr_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
id|FCBlock
op_star
id|smctr_get_tx_fcb
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
comma
id|__u16
id|bytes_count
)paren
suffix:semicolon
r_static
r_int
id|smctr_get_upstream_neighbor_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* H */
r_static
r_int
id|smctr_hardware_send_packet
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|net_local
op_star
id|tp
)paren
suffix:semicolon
multiline_comment|/* I */
r_static
r_int
id|smctr_init_acbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_init_adapter
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|__init
id|smctr_init_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_init_card_real
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_init_rx_bdbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_init_rx_fcbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_init_shared_memory
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_init_tx_bdbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_init_tx_fcbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_internal_self_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|smctr_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_enable_int_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|interrupt_enable_mask
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_int_ack
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|iack_code
comma
id|__u16
id|ibits
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_init_timers_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_init_txrx_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_insert_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_read_ring_status_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_read_word_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|aword_cnt
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_remove_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_resume_acb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_resume_rx_bdb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_resume_rx_fcb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_resume_tx_fcb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_test_internal_rom_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_test_hic_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_test_mac_reg_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_trc_loopback_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_tri_loopback_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_write_byte_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|aword_cnt
comma
r_void
op_star
id|byte
)paren
suffix:semicolon
r_static
r_int
id|smctr_issue_write_word_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|aword_cnt
comma
r_void
op_star
id|word
)paren
suffix:semicolon
multiline_comment|/* J */
r_static
r_int
id|smctr_join_complete_state
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* L */
r_static
r_int
id|smctr_link_tx_fcbs_to_bdbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_load_firmware
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_load_node_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_lobe_media_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_lobe_media_test_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_lobe_media_test_state
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* M */
r_static
r_int
id|smctr_make_8025_hdr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|MAC_HEADER
op_star
id|tmf
comma
id|__u16
id|ac_fc
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_access_pri
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_addr_mod
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_auth_funct_class
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_corr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
comma
id|__u16
id|correlator
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_funct_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_group_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_phy_drop_num
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_product_id
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_station_id
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_ring_station_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_ring_station_version
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_tx_status_code
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
comma
id|__u16
id|tx_fstatus
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_upstream_neighbor_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_make_wrap_data
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
suffix:semicolon
multiline_comment|/* O */
r_static
r_int
id|smctr_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_open_tr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* P */
r_int
id|__init
id|smctr_probe
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|__init
id|smctr_probe1
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
)paren
suffix:semicolon
r_static
r_int
id|smctr_process_rx_packet
c_func
(paren
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|size
comma
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|rx_status
)paren
suffix:semicolon
multiline_comment|/* R */
r_static
r_int
id|smctr_ram_conflict_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_ram_memory_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
r_int
id|__init
id|smctr_read_584_chksum
c_func
(paren
r_int
id|ioaddr
)paren
suffix:semicolon
r_static
r_int
id|smctr_rcv_chg_param
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
op_star
id|correlator
)paren
suffix:semicolon
r_static
r_int
id|smctr_rcv_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
op_star
id|correlator
)paren
suffix:semicolon
r_static
r_int
id|smctr_rcv_tx_forward
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
)paren
suffix:semicolon
r_static
r_int
id|smctr_rcv_rq_addr_state_attch
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
op_star
id|correlator
)paren
suffix:semicolon
r_static
r_int
id|smctr_rcv_unknown
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
op_star
id|correlator
)paren
suffix:semicolon
r_static
r_int
id|smctr_reset_adapter
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_restart_tx_chain
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|queue
)paren
suffix:semicolon
r_static
r_int
id|smctr_ring_status_chg
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_rom_conflict_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_rx_frame
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* S */
r_static
r_int
id|smctr_send_dat
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_send_lobe_media_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_send_rpt_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|correlator
)paren
suffix:semicolon
r_static
r_int
id|smctr_send_rpt_attch
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|correlator
)paren
suffix:semicolon
r_static
r_int
id|smctr_send_rpt_state
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|correlator
)paren
suffix:semicolon
r_static
r_int
id|smctr_send_rpt_tx_forward
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|tx_fstatus
)paren
suffix:semicolon
r_static
r_int
id|smctr_send_rsp
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|rcode
comma
id|__u16
id|correlator
)paren
suffix:semicolon
r_static
r_int
id|smctr_send_rq_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_send_tx_forward
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
op_star
id|tx_fstatus
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_auth_access_pri
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_auth_funct_class
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_corr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
comma
id|__u16
op_star
id|correlator
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_error_timer_value
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_frame_forward
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
comma
id|__u8
id|dc_sc
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_local_ring_num
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
)paren
suffix:semicolon
r_static
r_int
r_int
id|smctr_set_ctrl_attention
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|smctr_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_page
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u8
op_star
id|buf
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_phy_drop
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_ring_speed
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_rx_look_ahead
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_set_trc_reset
c_func
(paren
r_int
id|ioaddr
)paren
suffix:semicolon
r_static
r_int
id|smctr_setup_single_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|command
comma
id|__u16
id|subcommand
)paren
suffix:semicolon
r_static
r_int
id|smctr_setup_single_cmd_w_data
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|command
comma
id|__u16
id|subcommand
)paren
suffix:semicolon
r_static
r_char
op_star
id|smctr_malloc
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|size
)paren
suffix:semicolon
r_static
r_int
id|smctr_status_chg
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* T */
r_static
r_void
id|smctr_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_trc_send_packet
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|FCBlock
op_star
id|fcb
comma
id|__u16
id|queue
)paren
suffix:semicolon
r_static
id|__u16
id|smctr_tx_complete
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
)paren
suffix:semicolon
r_static
r_int
r_int
id|smctr_tx_move_frame
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|__u8
op_star
id|pbuff
comma
r_int
r_int
id|bytes
)paren
suffix:semicolon
multiline_comment|/* U */
r_static
r_int
id|smctr_update_err_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_update_rx_chain
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
)paren
suffix:semicolon
r_static
r_int
id|smctr_update_tx_chain
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|FCBlock
op_star
id|fcb
comma
id|__u16
id|queue
)paren
suffix:semicolon
multiline_comment|/* W */
r_static
r_int
id|smctr_wait_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|smctr_wait_while_cbusy
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|macro|TO_256_BYTE_BOUNDRY
mdefine_line|#define TO_256_BYTE_BOUNDRY(X)  (((X + 0xff) &amp; 0xff00) - X)
DECL|macro|TO_PARAGRAPH_BOUNDRY
mdefine_line|#define TO_PARAGRAPH_BOUNDRY(X) (((X + 0x0f) &amp; 0xfff0) - X)
DECL|macro|PARAGRAPH_BOUNDRY
mdefine_line|#define PARAGRAPH_BOUNDRY(X)    smctr_malloc(dev, TO_PARAGRAPH_BOUNDRY(X))
multiline_comment|/* Allocate Adapter Shared Memory.&n; * IMPORTANT NOTE: Any changes to this function MUST be mirrored in the&n; * function &quot;get_num_rx_bdbs&quot; below!!!&n; *&n; * Order of memory allocation:&n; *&n; *       0. Initial System Configuration Block Pointer&n; *       1. System Configuration Block&n; *       2. System Control Block&n; *       3. Action Command Block&n; *       4. Interrupt Status Block&n; *&n; *       5. MAC TX FCB&squot;S&n; *       6. NON-MAC TX FCB&squot;S&n; *       7. MAC TX BDB&squot;S&n; *       8. NON-MAC TX BDB&squot;S&n; *       9. MAC RX FCB&squot;S&n; *      10. NON-MAC RX FCB&squot;S&n; *      11. MAC RX BDB&squot;S&n; *      12. NON-MAC RX BDB&squot;S&n; *      13. MAC TX Data Buffer( 1, 256 byte buffer)&n; *      14. MAC RX Data Buffer( 1, 256 byte buffer)&n; *&n; *      15. NON-MAC TX Data Buffer&n; *      16. NON-MAC RX Data Buffer&n; */
DECL|function|smctr_alloc_shared_memory
r_static
r_int
id|smctr_alloc_shared_memory
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_alloc_shared_memory&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/* Allocate initial System Control Block pointer.&n;         * This pointer is located in the last page, last offset - 4.&n;         */
id|tp-&gt;iscpb_ptr
op_assign
(paren
id|ISCPBlock
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
(paren
(paren
id|__u32
)paren
l_int|64
op_star
l_int|0x400
)paren
op_minus
(paren
r_int
)paren
id|ISCP_BLOCK_SIZE
)paren
suffix:semicolon
multiline_comment|/* Allocate System Control Blocks. */
id|tp-&gt;scgb_ptr
op_assign
(paren
id|SCGBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|SCGBlock
)paren
)paren
suffix:semicolon
id|PARAGRAPH_BOUNDRY
c_func
(paren
id|tp-&gt;sh_mem_used
)paren
suffix:semicolon
id|tp-&gt;sclb_ptr
op_assign
(paren
id|SCLBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|SCLBlock
)paren
)paren
suffix:semicolon
id|PARAGRAPH_BOUNDRY
c_func
(paren
id|tp-&gt;sh_mem_used
)paren
suffix:semicolon
id|tp-&gt;acb_head
op_assign
(paren
id|ACBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|ACBlock
)paren
op_star
id|tp-&gt;num_acbs
)paren
suffix:semicolon
id|PARAGRAPH_BOUNDRY
c_func
(paren
id|tp-&gt;sh_mem_used
)paren
suffix:semicolon
id|tp-&gt;isb_ptr
op_assign
(paren
id|ISBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|ISBlock
)paren
)paren
suffix:semicolon
id|PARAGRAPH_BOUNDRY
c_func
(paren
id|tp-&gt;sh_mem_used
)paren
suffix:semicolon
id|tp-&gt;misc_command_data
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
id|MISC_DATA_SIZE
)paren
suffix:semicolon
id|PARAGRAPH_BOUNDRY
c_func
(paren
id|tp-&gt;sh_mem_used
)paren
suffix:semicolon
multiline_comment|/* Allocate transmit FCBs. */
id|tp-&gt;tx_fcb_head
(braket
id|MAC_QUEUE
)braket
op_assign
(paren
id|FCBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|FCBlock
)paren
op_star
id|tp-&gt;num_tx_fcbs
(braket
id|MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_fcb_head
(braket
id|NON_MAC_QUEUE
)braket
op_assign
(paren
id|FCBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|FCBlock
)paren
op_star
id|tp-&gt;num_tx_fcbs
(braket
id|NON_MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_fcb_head
(braket
id|BUG_QUEUE
)braket
op_assign
(paren
id|FCBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|FCBlock
)paren
op_star
id|tp-&gt;num_tx_fcbs
(braket
id|BUG_QUEUE
)braket
)paren
suffix:semicolon
multiline_comment|/* Allocate transmit BDBs. */
id|tp-&gt;tx_bdb_head
(braket
id|MAC_QUEUE
)braket
op_assign
(paren
id|BDBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|BDBlock
)paren
op_star
id|tp-&gt;num_tx_bdbs
(braket
id|MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_bdb_head
(braket
id|NON_MAC_QUEUE
)braket
op_assign
(paren
id|BDBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|BDBlock
)paren
op_star
id|tp-&gt;num_tx_bdbs
(braket
id|NON_MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_bdb_head
(braket
id|BUG_QUEUE
)braket
op_assign
(paren
id|BDBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|BDBlock
)paren
op_star
id|tp-&gt;num_tx_bdbs
(braket
id|BUG_QUEUE
)braket
)paren
suffix:semicolon
multiline_comment|/* Allocate receive FCBs. */
id|tp-&gt;rx_fcb_head
(braket
id|MAC_QUEUE
)braket
op_assign
(paren
id|FCBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|FCBlock
)paren
op_star
id|tp-&gt;num_rx_fcbs
(braket
id|MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;rx_fcb_head
(braket
id|NON_MAC_QUEUE
)braket
op_assign
(paren
id|FCBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|FCBlock
)paren
op_star
id|tp-&gt;num_rx_fcbs
(braket
id|NON_MAC_QUEUE
)braket
)paren
suffix:semicolon
multiline_comment|/* Allocate receive BDBs. */
id|tp-&gt;rx_bdb_head
(braket
id|MAC_QUEUE
)braket
op_assign
(paren
id|BDBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|BDBlock
)paren
op_star
id|tp-&gt;num_rx_bdbs
(braket
id|MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;rx_bdb_end
(braket
id|MAC_QUEUE
)braket
op_assign
(paren
id|BDBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|tp-&gt;rx_bdb_head
(braket
id|NON_MAC_QUEUE
)braket
op_assign
(paren
id|BDBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
r_sizeof
(paren
id|BDBlock
)paren
op_star
id|tp-&gt;num_rx_bdbs
(braket
id|NON_MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;rx_bdb_end
(braket
id|NON_MAC_QUEUE
)braket
op_assign
(paren
id|BDBlock
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Allocate MAC transmit buffers.&n;         * MAC Tx Buffers doen&squot;t have to be on an ODD Boundry.&n;         */
id|tp-&gt;tx_buff_head
(braket
id|MAC_QUEUE
)braket
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
id|tp-&gt;tx_buff_size
(braket
id|MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_buff_curr
(braket
id|MAC_QUEUE
)braket
op_assign
id|tp-&gt;tx_buff_head
(braket
id|MAC_QUEUE
)braket
suffix:semicolon
id|tp-&gt;tx_buff_end
(braket
id|MAC_QUEUE
)braket
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Allocate BUG transmit buffers. */
id|tp-&gt;tx_buff_head
(braket
id|BUG_QUEUE
)braket
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
id|tp-&gt;tx_buff_size
(braket
id|BUG_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_buff_curr
(braket
id|BUG_QUEUE
)braket
op_assign
id|tp-&gt;tx_buff_head
(braket
id|BUG_QUEUE
)braket
suffix:semicolon
id|tp-&gt;tx_buff_end
(braket
id|BUG_QUEUE
)braket
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Allocate MAC receive data buffers.&n;         * MAC Rx buffer doesn&squot;t have to be on a 256 byte boundry.&n;         */
id|tp-&gt;rx_buff_head
(braket
id|MAC_QUEUE
)braket
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
id|RX_DATA_BUFFER_SIZE
op_star
id|tp-&gt;num_rx_bdbs
(braket
id|MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;rx_buff_end
(braket
id|MAC_QUEUE
)braket
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Allocate Non-MAC transmit buffers.&n;         * ?? For maximum Netware performance, put Tx Buffers on&n;         * ODD Boundry and then restore malloc to Even Boundrys.&n;         */
id|smctr_malloc
c_func
(paren
id|dev
comma
l_int|1L
)paren
suffix:semicolon
id|tp-&gt;tx_buff_head
(braket
id|NON_MAC_QUEUE
)braket
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
id|tp-&gt;tx_buff_size
(braket
id|NON_MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_buff_curr
(braket
id|NON_MAC_QUEUE
)braket
op_assign
id|tp-&gt;tx_buff_head
(braket
id|NON_MAC_QUEUE
)braket
suffix:semicolon
id|tp-&gt;tx_buff_end
(braket
id|NON_MAC_QUEUE
)braket
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|smctr_malloc
c_func
(paren
id|dev
comma
l_int|1L
)paren
suffix:semicolon
multiline_comment|/* Allocate Non-MAC receive data buffers.&n;         * To guarantee a minimum of 256 contigous memory to&n;         * UM_Receive_Packet&squot;s lookahead pointer, before a page&n;         * change or ring end is encountered, place each rx buffer on&n;         * a 256 byte boundry.&n;         */
id|smctr_malloc
c_func
(paren
id|dev
comma
id|TO_256_BYTE_BOUNDRY
c_func
(paren
id|tp-&gt;sh_mem_used
)paren
)paren
suffix:semicolon
id|tp-&gt;rx_buff_head
(braket
id|NON_MAC_QUEUE
)braket
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
id|RX_DATA_BUFFER_SIZE
op_star
id|tp-&gt;num_rx_bdbs
(braket
id|NON_MAC_QUEUE
)braket
)paren
suffix:semicolon
id|tp-&gt;rx_buff_end
(braket
id|NON_MAC_QUEUE
)braket
op_assign
(paren
id|__u16
op_star
)paren
id|smctr_malloc
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Enter Bypass state. */
DECL|function|smctr_bypass_state
r_static
r_int
id|smctr_bypass_state
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_bypass_state&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|err
op_assign
id|smctr_setup_single_cmd
c_func
(paren
id|dev
comma
id|ACB_CMD_CHANGE_JOIN_STATE
comma
id|JS_BYPASS_STATE
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_checksum_firmware
r_static
r_int
id|smctr_checksum_firmware
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u16
id|i
comma
id|checksum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_checksum_firmware&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|smctr_enable_adapter_ctrl_store
c_func
(paren
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CS_RAM_SIZE
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|checksum
op_add_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|tp-&gt;microcode_version
op_assign
op_star
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|CS_RAM_VERSION_OFFSET
)paren
suffix:semicolon
id|tp-&gt;microcode_version
op_rshift_assign
l_int|8
suffix:semicolon
id|smctr_disable_adapter_ctrl_store
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|checksum
)paren
(brace
r_return
(paren
id|checksum
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_chk_mca
r_static
r_int
id|smctr_chk_mca
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
macro_line|#ifdef CONFIG_MCA
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|current_slot
suffix:semicolon
id|__u8
id|r1
comma
id|r2
comma
id|r3
comma
id|r4
comma
id|r5
suffix:semicolon
id|current_slot
op_assign
id|mca_find_unused_adapter
c_func
(paren
id|smctr_posid
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current_slot
op_eq
id|MCA_NOTFOUND
)paren
(brace
r_return
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
id|mca_set_adapter_name
c_func
(paren
id|current_slot
comma
id|smctr_name
)paren
suffix:semicolon
id|mca_mark_as_used
c_func
(paren
id|current_slot
)paren
suffix:semicolon
id|tp-&gt;slot_num
op_assign
id|current_slot
suffix:semicolon
id|r1
op_assign
id|mca_read_stored_pos
c_func
(paren
id|tp-&gt;slot_num
comma
l_int|2
)paren
suffix:semicolon
id|r2
op_assign
id|mca_read_stored_pos
c_func
(paren
id|tp-&gt;slot_num
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;slot_num
)paren
(brace
id|outb
c_func
(paren
id|CNFG_POS_CONTROL_REG
comma
(paren
id|__u8
)paren
(paren
(paren
id|tp-&gt;slot_num
op_minus
l_int|1
)paren
op_or
id|CNFG_SLOT_ENABLE_BIT
)paren
)paren
suffix:semicolon
)brace
r_else
id|outb
c_func
(paren
id|CNFG_POS_CONTROL_REG
comma
(paren
id|__u8
)paren
(paren
(paren
id|tp-&gt;slot_num
)paren
op_or
id|CNFG_SLOT_ENABLE_BIT
)paren
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|CNFG_POS_REG1
)paren
suffix:semicolon
id|r2
op_assign
id|inb
c_func
(paren
id|CNFG_POS_REG0
)paren
suffix:semicolon
id|tp-&gt;bic_type
op_assign
id|BIC_594_CHIP
suffix:semicolon
multiline_comment|/* IO */
id|r2
op_assign
id|mca_read_stored_pos
c_func
(paren
id|tp-&gt;slot_num
comma
l_int|2
)paren
suffix:semicolon
id|r2
op_and_assign
l_int|0xF0
suffix:semicolon
id|dev-&gt;base_addr
op_assign
(paren
(paren
id|__u16
)paren
id|r2
op_lshift
l_int|8
)paren
op_plus
(paren
id|__u16
)paren
l_int|0x800
suffix:semicolon
id|request_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|SMCTR_IO_EXTENT
comma
id|smctr_name
)paren
suffix:semicolon
multiline_comment|/* IRQ */
id|r5
op_assign
id|mca_read_stored_pos
c_func
(paren
id|tp-&gt;slot_num
comma
l_int|5
)paren
suffix:semicolon
id|r5
op_and_assign
l_int|0xC
suffix:semicolon
r_switch
c_cond
(paren
id|r5
)paren
(brace
r_case
l_int|0
suffix:colon
id|dev-&gt;irq
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x4
suffix:colon
id|dev-&gt;irq
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x8
suffix:colon
id|dev-&gt;irq
op_assign
l_int|10
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev-&gt;irq
op_assign
l_int|15
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|smctr_interrupt
comma
id|SA_SHIRQ
comma
id|smctr_name
comma
id|dev
)paren
)paren
(brace
r_return
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
multiline_comment|/* Get RAM base */
id|r3
op_assign
id|mca_read_stored_pos
c_func
(paren
id|tp-&gt;slot_num
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r3
op_amp
l_int|0x8
)paren
(brace
r_if
c_cond
(paren
id|r3
op_amp
l_int|0x80
)paren
(brace
id|tp-&gt;ram_base
op_assign
(paren
(paren
id|__u32
)paren
(paren
id|r3
op_amp
l_int|0x7
)paren
op_lshift
l_int|13
)paren
op_plus
l_int|0xFD0000
suffix:semicolon
)brace
r_else
id|tp-&gt;ram_base
op_assign
(paren
(paren
id|__u32
)paren
(paren
id|r3
op_amp
l_int|0x7
)paren
op_lshift
l_int|13
)paren
op_plus
l_int|0x0D0000
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|r3
op_amp
l_int|0x80
)paren
(brace
id|tp-&gt;ram_base
op_assign
(paren
(paren
id|__u32
)paren
(paren
id|r3
op_amp
l_int|0x7
)paren
op_lshift
l_int|13
)paren
op_plus
l_int|0xFC0000
suffix:semicolon
)brace
r_else
id|tp-&gt;ram_base
op_assign
(paren
(paren
id|__u32
)paren
(paren
id|r3
op_amp
l_int|0x7
)paren
op_lshift
l_int|13
)paren
op_plus
l_int|0x0C0000
suffix:semicolon
)brace
multiline_comment|/* Get Ram Size */
id|r3
op_and_assign
l_int|0x30
suffix:semicolon
id|r3
op_rshift_assign
l_int|4
suffix:semicolon
id|tp-&gt;ram_usable
op_assign
(paren
id|__u16
)paren
id|CNFG_SIZE_8KB
op_lshift
id|r3
suffix:semicolon
id|tp-&gt;ram_size
op_assign
(paren
id|__u16
)paren
id|CNFG_SIZE_64KB
suffix:semicolon
id|tp-&gt;board_id
op_or_assign
id|TOKEN_MEDIA
suffix:semicolon
id|r4
op_assign
id|mca_read_stored_pos
c_func
(paren
id|tp-&gt;slot_num
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r4
op_amp
l_int|0x8
)paren
(brace
id|tp-&gt;rom_base
op_assign
(paren
(paren
id|__u32
)paren
(paren
id|r4
op_amp
l_int|0x7
)paren
op_lshift
l_int|13
)paren
op_plus
l_int|0xD0000
suffix:semicolon
)brace
r_else
id|tp-&gt;rom_base
op_assign
(paren
(paren
id|__u32
)paren
(paren
id|r4
op_amp
l_int|0x7
)paren
op_lshift
l_int|13
)paren
op_plus
l_int|0xC0000
suffix:semicolon
multiline_comment|/* Get ROM size. */
id|r4
op_rshift_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|r4
op_eq
l_int|0
)paren
(brace
id|tp-&gt;rom_size
op_assign
id|CNFG_SIZE_8KB
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|r4
op_eq
l_int|1
)paren
(brace
id|tp-&gt;rom_size
op_assign
id|CNFG_SIZE_16KB
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|r4
op_eq
l_int|2
)paren
(brace
id|tp-&gt;rom_size
op_assign
id|CNFG_SIZE_32KB
suffix:semicolon
)brace
r_else
id|tp-&gt;rom_size
op_assign
id|ROM_DISABLE
suffix:semicolon
)brace
)brace
multiline_comment|/* Get Media Type. */
id|r5
op_assign
id|mca_read_stored_pos
c_func
(paren
id|tp-&gt;slot_num
comma
l_int|5
)paren
suffix:semicolon
id|r5
op_and_assign
id|CNFG_MEDIA_TYPE_MASK
suffix:semicolon
r_switch
c_cond
(paren
id|r5
)paren
(brace
r_case
(paren
l_int|0
)paren
suffix:colon
id|tp-&gt;media_type
op_assign
id|MEDIA_STP_4
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|1
)paren
suffix:colon
id|tp-&gt;media_type
op_assign
id|MEDIA_STP_16
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|3
)paren
suffix:colon
id|tp-&gt;media_type
op_assign
id|MEDIA_UTP_16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|tp-&gt;media_type
op_assign
id|MEDIA_UTP_4
suffix:semicolon
r_break
suffix:semicolon
)brace
id|tp-&gt;media_menu
op_assign
l_int|14
suffix:semicolon
id|r2
op_assign
id|mca_read_stored_pos
c_func
(paren
id|tp-&gt;slot_num
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|r2
op_amp
l_int|0x02
)paren
)paren
(brace
id|tp-&gt;mode_bits
op_or_assign
id|EARLY_TOKEN_REL
suffix:semicolon
)brace
multiline_comment|/* Disable slot */
id|outb
c_func
(paren
id|CNFG_POS_CONTROL_REG
comma
l_int|0
)paren
suffix:semicolon
id|tp-&gt;board_id
op_assign
id|smctr_get_boardid
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|tp-&gt;board_id
op_amp
l_int|0xffff
)paren
(brace
r_case
id|WD8115TA
suffix:colon
id|smctr_model
op_assign
l_string|&quot;8115T/A&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WD8115T
suffix:colon
id|smctr_model
op_assign
l_string|&quot;8115T&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|smctr_model
op_assign
l_string|&quot;Unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#else
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_MCA */
)brace
DECL|function|smctr_chg_rx_mask
r_static
r_int
id|smctr_chg_rx_mask
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_chg_rx_mask&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
id|tp-&gt;ram_access
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mode_bits
op_amp
id|LOOPING_MODE_MASK
)paren
(brace
id|tp-&gt;config_word0
op_or_assign
id|RX_OWN_BIT
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word0
op_and_assign
op_complement
id|RX_OWN_BIT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|PROMISCUOUS_MODE
)paren
(brace
id|tp-&gt;config_word0
op_or_assign
id|PROMISCUOUS_BIT
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word0
op_and_assign
op_complement
id|PROMISCUOUS_BIT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_ERR_PACKETS
)paren
(brace
id|tp-&gt;config_word0
op_or_assign
id|SAVBAD_BIT
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word0
op_and_assign
op_complement
id|SAVBAD_BIT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_ATT_MAC_FRAMES
)paren
(brace
id|tp-&gt;config_word0
op_or_assign
id|RXATMAC
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word0
op_and_assign
op_complement
id|RXATMAC
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_MULTI_PROM
)paren
(brace
id|tp-&gt;config_word1
op_or_assign
id|MULTICAST_ADDRESS_BIT
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word1
op_and_assign
op_complement
id|MULTICAST_ADDRESS_BIT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_SOURCE_ROUTING_SPANNING
)paren
(brace
id|tp-&gt;config_word1
op_or_assign
id|SOURCE_ROUTING_SPANNING_BITS
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_SOURCE_ROUTING
)paren
(brace
id|tp-&gt;config_word1
op_or_assign
id|SOURCE_ROUTING_EXPLORER_BIT
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word1
op_and_assign
op_complement
id|SOURCE_ROUTING_SPANNING_BITS
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_write_word_cmd
c_func
(paren
id|dev
comma
id|RW_CONFIG_REGISTER_0
comma
op_amp
id|tp-&gt;config_word0
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_write_word_cmd
c_func
(paren
id|dev
comma
id|RW_CONFIG_REGISTER_1
comma
op_amp
id|tp-&gt;config_word1
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_clear_int
r_static
r_int
id|smctr_clear_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|outb
c_func
(paren
(paren
id|tp-&gt;trc_mask
op_or
id|CSR_CLRTINT
)paren
comma
id|dev-&gt;base_addr
op_plus
id|CSR
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_clear_trc_reset
r_static
r_int
id|smctr_clear_trc_reset
c_func
(paren
r_int
id|ioaddr
)paren
(brace
id|__u8
id|r
suffix:semicolon
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|MSR
)paren
suffix:semicolon
id|outb
c_func
(paren
op_complement
id|MSR_RST
op_amp
id|r
comma
id|ioaddr
op_plus
id|MSR
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * The inverse routine to smctr_open().&n; */
DECL|function|smctr_close
r_static
r_int
id|smctr_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|err
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef MODULE
id|MOD_DEC_USE_COUNT
suffix:semicolon
macro_line|#endif
id|tp-&gt;cleanup
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Check to see if adapter is already in a closed state. */
r_if
c_cond
(paren
id|tp-&gt;status
op_ne
id|OPEN
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
id|tp-&gt;ram_access
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_remove_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|tp-&gt;SendSkbQueue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_break
suffix:semicolon
)brace
id|tp-&gt;QueueSkb
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_decode_firmware
r_static
r_int
id|smctr_decode_firmware
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|bit
op_assign
l_int|0x80
comma
id|shift
op_assign
l_int|12
suffix:semicolon
id|DECODE_TREE_NODE
op_star
id|tree
suffix:semicolon
r_int
id|branch
comma
id|tsize
suffix:semicolon
id|__u16
id|buff
op_assign
l_int|0
suffix:semicolon
r_int
id|weight
suffix:semicolon
id|__u8
op_star
id|ucode
suffix:semicolon
id|__u16
op_star
id|mem
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_decode_firmware&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|weight
op_assign
op_star
(paren
r_int
op_star
)paren
(paren
id|tp-&gt;ptr_ucode
op_plus
id|WEIGHT_OFFSET
)paren
suffix:semicolon
id|tsize
op_assign
op_star
(paren
id|__u8
op_star
)paren
(paren
id|tp-&gt;ptr_ucode
op_plus
id|TREE_SIZE_OFFSET
)paren
suffix:semicolon
id|tree
op_assign
(paren
id|DECODE_TREE_NODE
op_star
)paren
(paren
id|tp-&gt;ptr_ucode
op_plus
id|TREE_OFFSET
)paren
suffix:semicolon
id|ucode
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|tp-&gt;ptr_ucode
op_plus
id|TREE_OFFSET
op_plus
(paren
id|tsize
op_star
r_sizeof
(paren
id|DECODE_TREE_NODE
)paren
)paren
)paren
suffix:semicolon
id|mem
op_assign
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
)paren
suffix:semicolon
r_while
c_loop
(paren
id|weight
)paren
(brace
id|branch
op_assign
id|ROOT
suffix:semicolon
r_while
c_loop
(paren
(paren
id|tree
op_plus
id|branch
)paren
op_member_access_from_pointer
id|tag
op_ne
id|LEAF
op_logical_and
id|weight
)paren
(brace
id|branch
op_assign
op_star
id|ucode
op_amp
id|bit
ques
c_cond
(paren
id|tree
op_plus
id|branch
)paren
op_member_access_from_pointer
id|llink
suffix:colon
(paren
id|tree
op_plus
id|branch
)paren
op_member_access_from_pointer
id|rlink
suffix:semicolon
id|bit
op_rshift_assign
l_int|1
suffix:semicolon
id|weight
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|bit
op_eq
l_int|0
)paren
(brace
id|bit
op_assign
l_int|0x80
suffix:semicolon
id|ucode
op_increment
suffix:semicolon
)brace
)brace
id|buff
op_or_assign
(paren
id|tree
op_plus
id|branch
)paren
op_member_access_from_pointer
id|info
op_lshift
id|shift
suffix:semicolon
id|shift
op_sub_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|shift
OL
l_int|0
)paren
(brace
op_star
(paren
id|mem
op_increment
)paren
op_assign
id|SWAP_BYTES
c_func
(paren
id|buff
)paren
suffix:semicolon
id|buff
op_assign
l_int|0
suffix:semicolon
id|shift
op_assign
l_int|12
suffix:semicolon
)brace
)brace
multiline_comment|/* The following assumes the Control Store Memory has&n;         * been initialized to zero. If the last partial word&n;         * is zero, it will not be written.&n;         */
r_if
c_cond
(paren
id|buff
)paren
(brace
op_star
(paren
id|mem
op_increment
)paren
op_assign
id|SWAP_BYTES
c_func
(paren
id|buff
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_disable_16bit
r_static
r_int
id|smctr_disable_16bit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
id|r
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;adapter_bus
op_eq
id|BUS_ISA16_TYPE
op_logical_and
(paren
(paren
id|tp-&gt;adapter_flags
op_amp
id|FORCED_16BIT_MODE
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|r
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|LAAR
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|r
op_amp
op_complement
id|LAAR_MEM16ENB
)paren
comma
id|dev-&gt;base_addr
op_plus
id|LAAR
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * On Exit, Adapter is:&n; * 1. TRC is in a reset state and un-initialized.&n; * 2. Adapter memory is enabled.&n; * 3. Control Store memory is out of context (-WCSS is 1).&n; */
DECL|function|smctr_disable_adapter_ctrl_store
r_static
r_int
id|smctr_disable_adapter_ctrl_store
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_disable_adapter_ctrl_store&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|tp-&gt;trc_mask
op_or_assign
id|CSR_WCSS
suffix:semicolon
id|outb
c_func
(paren
id|tp-&gt;trc_mask
comma
id|ioaddr
op_plus
id|CSR
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_disable_adapter_ram
r_static
r_int
id|smctr_disable_adapter_ram
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|__u8
id|r
suffix:semicolon
multiline_comment|/* First disable memory enable bit. */
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|MSR
)paren
suffix:semicolon
id|outb
c_func
(paren
op_complement
id|MSR_MEMB
op_amp
id|r
comma
id|ioaddr
op_plus
id|MSR
)paren
suffix:semicolon
multiline_comment|/* Now disable 16 bit memory enable bit. */
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|LAAR
)paren
suffix:semicolon
id|outb
c_func
(paren
op_complement
id|LAAR_MEM16ENB
op_amp
id|r
comma
id|ioaddr
op_plus
id|LAAR
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_disable_bic_int
r_static
r_int
id|smctr_disable_bic_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|tp-&gt;trc_mask
op_assign
id|CSR_MSK_ALL
op_or
id|CSR_MSKCBUSY
op_or
id|CSR_MSKTINT
op_or
id|CSR_WCSS
suffix:semicolon
id|outb
c_func
(paren
id|tp-&gt;trc_mask
comma
id|ioaddr
op_plus
id|CSR
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_enable_16bit
r_static
r_int
id|smctr_enable_16bit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
id|r
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;adapter_bus
op_eq
id|BUS_ISA16_TYPE
)paren
(brace
id|r
op_assign
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|LAAR
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|r
op_or
id|LAAR_MEM16ENB
)paren
comma
id|dev-&gt;base_addr
op_plus
id|LAAR
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * To enable the adapter control store memory:&n; * 1. Adapter must be in a RESET state.&n; * 2. Adapter memory must be enabled.&n; * 3. Control Store Memory is in context (-WCSS is 0).&n; */
DECL|function|smctr_enable_adapter_ctrl_store
r_static
r_int
id|smctr_enable_adapter_ctrl_store
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_enable_adapter_ctrl_store&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|smctr_set_trc_reset
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|smctr_enable_adapter_ram
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;trc_mask
op_and_assign
op_complement
id|CSR_WCSS
suffix:semicolon
id|outb
c_func
(paren
id|tp-&gt;trc_mask
comma
id|ioaddr
op_plus
id|CSR
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_enable_adapter_ram
r_static
r_int
id|smctr_enable_adapter_ram
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|__u8
id|r
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_enable_adapter_ram&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|MSR
)paren
suffix:semicolon
id|outb
c_func
(paren
id|MSR_MEMB
op_or
id|r
comma
id|ioaddr
op_plus
id|MSR
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_enable_bic_int
r_static
r_int
id|smctr_enable_bic_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|__u8
id|r
suffix:semicolon
r_switch
c_cond
(paren
id|tp-&gt;bic_type
)paren
(brace
r_case
(paren
id|BIC_584_CHIP
)paren
suffix:colon
id|tp-&gt;trc_mask
op_assign
id|CSR_MSKCBUSY
op_or
id|CSR_WCSS
suffix:semicolon
id|outb
c_func
(paren
id|tp-&gt;trc_mask
comma
id|ioaddr
op_plus
id|CSR
)paren
suffix:semicolon
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|IRR
)paren
suffix:semicolon
id|outb
c_func
(paren
id|r
op_or
id|IRR_IEN
comma
id|ioaddr
op_plus
id|IRR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|BIC_594_CHIP
)paren
suffix:colon
id|tp-&gt;trc_mask
op_assign
id|CSR_MSKCBUSY
op_or
id|CSR_WCSS
suffix:semicolon
id|outb
c_func
(paren
id|tp-&gt;trc_mask
comma
id|ioaddr
op_plus
id|CSR
)paren
suffix:semicolon
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|IMCCR
)paren
suffix:semicolon
id|outb
c_func
(paren
id|r
op_or
id|IMCCR_EIL
comma
id|ioaddr
op_plus
id|IMCCR
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_chk_isa
r_static
r_int
id|__init
id|smctr_chk_isa
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|__u8
id|r1
comma
id|r2
comma
id|b
comma
id|chksum
op_assign
l_int|0
suffix:semicolon
id|__u16
id|r
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_chk_isa %#4x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ioaddr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ioaddr
op_amp
l_int|0x1F
)paren
op_ne
l_int|0
)paren
(brace
r_return
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
multiline_comment|/* Checksum SMC node address */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|b
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|LAR0
op_plus
id|i
)paren
suffix:semicolon
id|chksum
op_add_assign
id|b
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chksum
op_ne
id|NODE_ADDR_CKSUM
)paren
(brace
r_return
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
multiline_comment|/* Adapter Not Found */
multiline_comment|/* Grab the region so that no one else tries to probe our ioports. */
id|request_region
c_func
(paren
id|ioaddr
comma
id|SMCTR_IO_EXTENT
comma
id|smctr_name
)paren
suffix:semicolon
id|b
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BDID
)paren
suffix:semicolon
multiline_comment|/* Check for 8115T Board ID */
id|r2
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|r
op_assign
l_int|0
suffix:semicolon
id|r
OL
l_int|8
suffix:semicolon
id|r
op_increment
)paren
(brace
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0x8
op_plus
id|r
)paren
suffix:semicolon
id|r2
op_add_assign
id|r1
suffix:semicolon
)brace
multiline_comment|/* value of RegF adds up the sum to 0xFF */
r_if
c_cond
(paren
(paren
id|r2
op_ne
l_int|0xFF
)paren
op_logical_and
(paren
id|r2
op_ne
l_int|0xEE
)paren
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* Get adapter ID */
id|tp-&gt;board_id
op_assign
id|smctr_get_boardid
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|tp-&gt;board_id
op_amp
l_int|0xffff
)paren
(brace
r_case
id|WD8115TA
suffix:colon
id|smctr_model
op_assign
l_string|&quot;8115T/A&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WD8115T
suffix:colon
id|smctr_model
op_assign
l_string|&quot;8115T&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|smctr_model
op_assign
l_string|&quot;Unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Store BIC type. */
id|tp-&gt;bic_type
op_assign
id|BIC_584_CHIP
suffix:semicolon
id|tp-&gt;nic_type
op_assign
id|NIC_825_CHIP
suffix:semicolon
multiline_comment|/* Copy Ram Size */
id|tp-&gt;ram_usable
op_assign
id|CNFG_SIZE_16KB
suffix:semicolon
id|tp-&gt;ram_size
op_assign
id|CNFG_SIZE_64KB
suffix:semicolon
multiline_comment|/* Get 58x Ram Base */
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|r1
op_and_assign
l_int|0x3F
suffix:semicolon
id|r2
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CNFG_LAAR_584
)paren
suffix:semicolon
id|r2
op_and_assign
id|CNFG_LAAR_MASK
suffix:semicolon
id|r2
op_lshift_assign
l_int|3
suffix:semicolon
id|r2
op_or_assign
(paren
(paren
id|r1
op_amp
l_int|0x38
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
id|tp-&gt;ram_base
op_assign
(paren
(paren
id|__u32
)paren
id|r2
op_lshift
l_int|16
)paren
op_plus
(paren
(paren
(paren
id|__u32
)paren
(paren
id|r1
op_amp
l_int|0x7
)paren
)paren
op_lshift
l_int|13
)paren
suffix:semicolon
multiline_comment|/* Get 584 Irq */
id|r1
op_assign
l_int|0
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CNFG_ICR_583
)paren
suffix:semicolon
id|r1
op_and_assign
id|CNFG_ICR_IR2_584
suffix:semicolon
id|r2
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CNFG_IRR_583
)paren
suffix:semicolon
id|r2
op_and_assign
id|CNFG_IRR_IRQS
suffix:semicolon
multiline_comment|/* 0x60 */
id|r2
op_rshift_assign
l_int|5
suffix:semicolon
r_switch
c_cond
(paren
id|r2
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|r1
op_eq
l_int|0
)paren
(brace
id|dev-&gt;irq
op_assign
l_int|2
suffix:semicolon
)brace
r_else
id|dev-&gt;irq
op_assign
l_int|10
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|r1
op_eq
l_int|0
)paren
(brace
id|dev-&gt;irq
op_assign
l_int|3
suffix:semicolon
)brace
r_else
id|dev-&gt;irq
op_assign
l_int|11
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|r1
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;extra_info
op_amp
id|ALTERNATE_IRQ_BIT
)paren
(brace
id|dev-&gt;irq
op_assign
l_int|5
suffix:semicolon
)brace
r_else
id|dev-&gt;irq
op_assign
l_int|4
suffix:semicolon
)brace
r_else
id|dev-&gt;irq
op_assign
l_int|15
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
r_if
c_cond
(paren
id|r1
op_eq
l_int|0
)paren
(brace
id|dev-&gt;irq
op_assign
l_int|7
suffix:semicolon
)brace
r_else
id|dev-&gt;irq
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: No IRQ found aborting&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|smctr_interrupt
comma
id|SA_SHIRQ
comma
id|smctr_name
comma
id|dev
)paren
)paren
(brace
r_return
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
multiline_comment|/* Get 58x Rom Base */
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CNFG_BIO_583
)paren
suffix:semicolon
id|r1
op_and_assign
l_int|0x3E
suffix:semicolon
id|r1
op_or_assign
l_int|0x40
suffix:semicolon
id|tp-&gt;rom_base
op_assign
(paren
id|__u32
)paren
id|r1
op_lshift
l_int|13
suffix:semicolon
multiline_comment|/* Get 58x Rom Size */
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CNFG_BIO_583
)paren
suffix:semicolon
id|r1
op_and_assign
l_int|0xC0
suffix:semicolon
r_if
c_cond
(paren
id|r1
op_eq
l_int|0
)paren
(brace
id|tp-&gt;rom_size
op_assign
id|ROM_DISABLE
suffix:semicolon
)brace
r_else
(brace
id|r1
op_rshift_assign
l_int|6
suffix:semicolon
id|tp-&gt;rom_size
op_assign
(paren
id|__u16
)paren
id|CNFG_SIZE_8KB
op_lshift
id|r1
suffix:semicolon
)brace
multiline_comment|/* Get 58x Boot Status */
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CNFG_GP2
)paren
suffix:semicolon
id|tp-&gt;mode_bits
op_and_assign
(paren
op_complement
id|BOOT_STATUS_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r1
op_amp
id|CNFG_GP2_BOOT_NIBBLE
)paren
(brace
id|tp-&gt;mode_bits
op_or_assign
id|BOOT_TYPE_1
suffix:semicolon
)brace
multiline_comment|/* Get 58x Zero Wait State */
id|tp-&gt;mode_bits
op_and_assign
(paren
op_complement
id|ZERO_WAIT_STATE_MASK
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CNFG_IRR_583
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r1
op_amp
id|CNFG_IRR_ZWS
)paren
(brace
id|tp-&gt;mode_bits
op_or_assign
id|ZERO_WAIT_STATE_8_BIT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;board_id
op_amp
id|BOARD_16BIT
)paren
(brace
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CNFG_LAAR_584
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r1
op_amp
id|CNFG_LAAR_ZWS
)paren
(brace
id|tp-&gt;mode_bits
op_or_assign
id|ZERO_WAIT_STATE_16_BIT
suffix:semicolon
)brace
)brace
multiline_comment|/* Get 584 Media Menu */
id|tp-&gt;media_menu
op_assign
l_int|14
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CNFG_IRR_583
)paren
suffix:semicolon
id|tp-&gt;mode_bits
op_and_assign
l_int|0xf8ff
suffix:semicolon
multiline_comment|/* (~CNFG_INTERFACE_TYPE_MASK) */
r_if
c_cond
(paren
(paren
id|tp-&gt;board_id
op_amp
id|TOKEN_MEDIA
)paren
op_eq
id|TOKEN_MEDIA
)paren
(brace
multiline_comment|/* Get Advanced Features */
r_if
c_cond
(paren
(paren
(paren
id|r1
op_amp
l_int|0x6
)paren
op_rshift
l_int|1
)paren
op_eq
l_int|0x3
)paren
(brace
id|tp-&gt;media_type
op_or_assign
id|MEDIA_UTP_16
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
(paren
id|r1
op_amp
l_int|0x6
)paren
op_rshift
l_int|1
)paren
op_eq
l_int|0x2
)paren
(brace
id|tp-&gt;media_type
op_or_assign
id|MEDIA_STP_16
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
(paren
id|r1
op_amp
l_int|0x6
)paren
op_rshift
l_int|1
)paren
op_eq
l_int|0x1
)paren
(brace
id|tp-&gt;media_type
op_or_assign
id|MEDIA_UTP_4
suffix:semicolon
)brace
r_else
id|tp-&gt;media_type
op_or_assign
id|MEDIA_STP_4
suffix:semicolon
)brace
)brace
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CNFG_GP2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|r1
op_amp
l_int|0x2
)paren
)paren
(brace
multiline_comment|/* GP2_ETRD */
id|tp-&gt;mode_bits
op_or_assign
id|EARLY_TOKEN_REL
suffix:semicolon
)brace
multiline_comment|/* see if the chip is corrupted */
r_if
c_cond
(paren
id|smctr_read_584_chksum
c_func
(paren
id|ioaddr
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: EEPROM Checksum Failure&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_get_boardid
r_static
r_int
id|__init
id|smctr_get_boardid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|mca
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|__u8
id|r
comma
id|r1
comma
id|IdByte
suffix:semicolon
id|__u16
id|BoardIdMask
suffix:semicolon
id|tp-&gt;board_id
op_assign
id|BoardIdMask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mca
)paren
(brace
id|BoardIdMask
op_or_assign
(paren
id|MICROCHANNEL
op_plus
id|INTERFACE_CHIP
op_plus
id|TOKEN_MEDIA
op_plus
id|PAGED_RAM
op_plus
id|BOARD_16BIT
)paren
suffix:semicolon
id|tp-&gt;extra_info
op_or_assign
(paren
id|INTERFACE_594_CHIP
op_plus
id|RAM_SIZE_64K
op_plus
id|NIC_825_BIT
op_plus
id|ALTERNATE_IRQ_BIT
op_plus
id|SLOT_16BIT
)paren
suffix:semicolon
)brace
r_else
(brace
id|BoardIdMask
op_or_assign
(paren
id|INTERFACE_CHIP
op_plus
id|TOKEN_MEDIA
op_plus
id|PAGED_RAM
op_plus
id|BOARD_16BIT
)paren
suffix:semicolon
id|tp-&gt;extra_info
op_or_assign
(paren
id|INTERFACE_584_CHIP
op_plus
id|RAM_SIZE_64K
op_plus
id|NIC_825_BIT
op_plus
id|ALTERNATE_IRQ_BIT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mca
)paren
(brace
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
id|r
op_and_assign
l_int|0x0c
suffix:semicolon
id|outb
c_func
(paren
id|r
comma
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_amp
id|BID_SIXTEEN_BIT_BIT
)paren
(brace
id|tp-&gt;extra_info
op_or_assign
id|SLOT_16BIT
suffix:semicolon
id|tp-&gt;adapter_bus
op_assign
id|BUS_ISA16_TYPE
suffix:semicolon
)brace
r_else
id|tp-&gt;adapter_bus
op_assign
id|BUS_ISA8_TYPE
suffix:semicolon
)brace
r_else
id|tp-&gt;adapter_bus
op_assign
id|BUS_MCA_TYPE
suffix:semicolon
multiline_comment|/* Get Board Id Byte */
id|IdByte
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_BOARD_ID_BYTE
)paren
suffix:semicolon
multiline_comment|/* if Major version &gt; 1.0 then&n;         *      return;&n;         */
r_if
c_cond
(paren
id|IdByte
op_amp
l_int|0xF8
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
id|r1
op_and_assign
id|BID_ICR_MASK
suffix:semicolon
id|r1
op_or_assign
id|BID_OTHER_BIT
suffix:semicolon
id|outb
c_func
(paren
id|r1
comma
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_3
)paren
suffix:semicolon
id|r1
op_and_assign
id|BID_EAR_MASK
suffix:semicolon
id|r1
op_or_assign
id|BID_ENGR_PAGE
suffix:semicolon
id|outb
c_func
(paren
id|r1
comma
id|ioaddr
op_plus
id|BID_REG_3
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
id|r1
op_and_assign
id|BID_ICR_MASK
suffix:semicolon
id|r1
op_or_assign
(paren
id|BID_RLA
op_or
id|BID_OTHER_BIT
)paren
suffix:semicolon
id|outb
c_func
(paren
id|r1
comma
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|r1
op_amp
id|BID_RECALL_DONE_MASK
)paren
(brace
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
)brace
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_LAR_0
op_plus
id|BID_REG_6
)paren
suffix:semicolon
multiline_comment|/* clear chip rev bits */
id|tp-&gt;extra_info
op_and_assign
op_complement
id|CHIP_REV_MASK
suffix:semicolon
id|tp-&gt;extra_info
op_or_assign
(paren
(paren
id|r
op_amp
id|BID_EEPROM_CHIP_REV_MASK
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
id|r1
op_and_assign
id|BID_ICR_MASK
suffix:semicolon
id|r1
op_or_assign
id|BID_OTHER_BIT
suffix:semicolon
id|outb
c_func
(paren
id|r1
comma
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_3
)paren
suffix:semicolon
id|r1
op_and_assign
id|BID_EAR_MASK
suffix:semicolon
id|r1
op_or_assign
id|BID_EA6
suffix:semicolon
id|outb
c_func
(paren
id|r1
comma
id|ioaddr
op_plus
id|BID_REG_3
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
id|r1
op_and_assign
id|BID_ICR_MASK
suffix:semicolon
id|r1
op_or_assign
id|BID_RLA
suffix:semicolon
id|outb
c_func
(paren
id|r1
comma
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|r1
op_amp
id|BID_RECALL_DONE_MASK
)paren
(brace
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|BID_REG_1
)paren
suffix:semicolon
)brace
r_return
(paren
id|BoardIdMask
)paren
suffix:semicolon
)brace
DECL|function|smctr_get_group_address
r_static
r_int
id|smctr_get_group_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|smctr_issue_read_word_cmd
c_func
(paren
id|dev
comma
id|RW_INDIVIDUAL_GROUP_ADDR
)paren
suffix:semicolon
r_return
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|smctr_get_functional_address
r_static
r_int
id|smctr_get_functional_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|smctr_issue_read_word_cmd
c_func
(paren
id|dev
comma
id|RW_FUNCTIONAL_ADDR
)paren
suffix:semicolon
r_return
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Calculate number of Non-MAC receive BDB&squot;s and data buffers.&n; * This function must simulate allocateing shared memory exactly&n; * as the allocate_shared_memory function above.&n; */
DECL|function|smctr_get_num_rx_bdbs
r_static
r_int
r_int
id|smctr_get_num_rx_bdbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|mem_used
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Allocate System Control Blocks. */
id|mem_used
op_add_assign
r_sizeof
(paren
id|SCGBlock
)paren
suffix:semicolon
id|mem_used
op_add_assign
id|TO_PARAGRAPH_BOUNDRY
c_func
(paren
id|mem_used
)paren
suffix:semicolon
id|mem_used
op_add_assign
r_sizeof
(paren
id|SCLBlock
)paren
suffix:semicolon
id|mem_used
op_add_assign
id|TO_PARAGRAPH_BOUNDRY
c_func
(paren
id|mem_used
)paren
suffix:semicolon
id|mem_used
op_add_assign
r_sizeof
(paren
id|ACBlock
)paren
op_star
id|tp-&gt;num_acbs
suffix:semicolon
id|mem_used
op_add_assign
id|TO_PARAGRAPH_BOUNDRY
c_func
(paren
id|mem_used
)paren
suffix:semicolon
id|mem_used
op_add_assign
r_sizeof
(paren
id|ISBlock
)paren
suffix:semicolon
id|mem_used
op_add_assign
id|TO_PARAGRAPH_BOUNDRY
c_func
(paren
id|mem_used
)paren
suffix:semicolon
id|mem_used
op_add_assign
id|MISC_DATA_SIZE
suffix:semicolon
multiline_comment|/* Allocate transmit FCB&squot;s. */
id|mem_used
op_add_assign
id|TO_PARAGRAPH_BOUNDRY
c_func
(paren
id|mem_used
)paren
suffix:semicolon
id|mem_used
op_add_assign
r_sizeof
(paren
id|FCBlock
)paren
op_star
id|tp-&gt;num_tx_fcbs
(braket
id|MAC_QUEUE
)braket
suffix:semicolon
id|mem_used
op_add_assign
r_sizeof
(paren
id|FCBlock
)paren
op_star
id|tp-&gt;num_tx_fcbs
(braket
id|NON_MAC_QUEUE
)braket
suffix:semicolon
id|mem_used
op_add_assign
r_sizeof
(paren
id|FCBlock
)paren
op_star
id|tp-&gt;num_tx_fcbs
(braket
id|BUG_QUEUE
)braket
suffix:semicolon
multiline_comment|/* Allocate transmit BDBs. */
id|mem_used
op_add_assign
r_sizeof
(paren
id|BDBlock
)paren
op_star
id|tp-&gt;num_tx_bdbs
(braket
id|MAC_QUEUE
)braket
suffix:semicolon
id|mem_used
op_add_assign
r_sizeof
(paren
id|BDBlock
)paren
op_star
id|tp-&gt;num_tx_bdbs
(braket
id|NON_MAC_QUEUE
)braket
suffix:semicolon
id|mem_used
op_add_assign
r_sizeof
(paren
id|BDBlock
)paren
op_star
id|tp-&gt;num_tx_bdbs
(braket
id|BUG_QUEUE
)braket
suffix:semicolon
multiline_comment|/* Allocate receive FCBs. */
id|mem_used
op_add_assign
r_sizeof
(paren
id|FCBlock
)paren
op_star
id|tp-&gt;num_rx_fcbs
(braket
id|MAC_QUEUE
)braket
suffix:semicolon
id|mem_used
op_add_assign
r_sizeof
(paren
id|FCBlock
)paren
op_star
id|tp-&gt;num_rx_fcbs
(braket
id|NON_MAC_QUEUE
)braket
suffix:semicolon
multiline_comment|/* Allocate receive BDBs. */
id|mem_used
op_add_assign
r_sizeof
(paren
id|BDBlock
)paren
op_star
id|tp-&gt;num_rx_bdbs
(braket
id|MAC_QUEUE
)braket
suffix:semicolon
multiline_comment|/* Allocate MAC transmit buffers.&n;         * MAC transmit buffers don&squot;t have to be on an ODD Boundry.&n;         */
id|mem_used
op_add_assign
id|tp-&gt;tx_buff_size
(braket
id|MAC_QUEUE
)braket
suffix:semicolon
multiline_comment|/* Allocate BUG transmit buffers. */
id|mem_used
op_add_assign
id|tp-&gt;tx_buff_size
(braket
id|BUG_QUEUE
)braket
suffix:semicolon
multiline_comment|/* Allocate MAC receive data buffers.&n;         * MAC receive buffers don&squot;t have to be on a 256 byte boundry.&n;         */
id|mem_used
op_add_assign
id|RX_DATA_BUFFER_SIZE
op_star
id|tp-&gt;num_rx_bdbs
(braket
id|MAC_QUEUE
)braket
suffix:semicolon
multiline_comment|/* Allocate Non-MAC transmit buffers.&n;         * For maximum Netware performance, put Tx Buffers on&n;         * ODD Boundry,and then restore malloc to Even Boundrys.&n;         */
id|mem_used
op_add_assign
l_int|1L
suffix:semicolon
id|mem_used
op_add_assign
id|tp-&gt;tx_buff_size
(braket
id|NON_MAC_QUEUE
)braket
suffix:semicolon
id|mem_used
op_add_assign
l_int|1L
suffix:semicolon
multiline_comment|/* CALCULATE NUMBER OF NON-MAC RX BDB&squot;S&n;         * AND NON-MAC RX DATA BUFFERS&n;         *&n;         * Make sure the mem_used offset at this point is the&n;         * same as in allocate_shared memory or the following&n;         * boundry adjustment will be incorrect (i.e. not allocating&n;         * the non-mac recieve buffers above cannot change the 256&n;         * byte offset).&n;         *&n;         * Since this cannot be guaranteed, adding the full 256 bytes&n;         * to the amount of shared memory used at this point will guaranteed&n;         * that the rx data buffers do not overflow shared memory.&n;         */
id|mem_used
op_add_assign
l_int|0x100
suffix:semicolon
r_return
(paren
l_int|0xffff
op_minus
id|mem_used
)paren
op_div
(paren
id|RX_DATA_BUFFER_SIZE
op_plus
r_sizeof
(paren
id|BDBlock
)paren
)paren
suffix:semicolon
)brace
DECL|function|smctr_get_physical_drop_number
r_static
r_int
id|smctr_get_physical_drop_number
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|smctr_issue_read_word_cmd
c_func
(paren
id|dev
comma
id|RW_PHYSICAL_DROP_NUMBER
)paren
suffix:semicolon
r_return
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|smctr_get_rx_pointer
r_static
id|__u8
op_star
id|smctr_get_rx_pointer
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|queue
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|BDBlock
op_star
id|bdb
suffix:semicolon
id|bdb
op_assign
(paren
id|BDBlock
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tp-&gt;ram_access
op_plus
(paren
id|__u32
)paren
(paren
id|tp-&gt;rx_fcb_curr
(braket
id|queue
)braket
op_member_access_from_pointer
id|trc_bdb_ptr
)paren
)paren
suffix:semicolon
id|tp-&gt;rx_fcb_curr
(braket
id|queue
)braket
op_member_access_from_pointer
id|bdb_ptr
op_assign
id|bdb
suffix:semicolon
r_return
(paren
(paren
id|__u8
op_star
)paren
id|bdb-&gt;data_block_ptr
)paren
suffix:semicolon
)brace
DECL|function|smctr_get_station_id
r_static
r_int
id|smctr_get_station_id
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|smctr_issue_read_word_cmd
c_func
(paren
id|dev
comma
id|RW_INDIVIDUAL_MAC_ADDRESS
)paren
suffix:semicolon
r_return
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the current statistics. This may be called with the card open&n; * or closed.&n; */
DECL|function|smctr_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|smctr_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
(paren
(paren
r_struct
id|net_device_stats
op_star
)paren
op_amp
id|tp-&gt;MacStat
)paren
suffix:semicolon
)brace
DECL|function|smctr_get_tx_fcb
r_static
id|FCBlock
op_star
id|smctr_get_tx_fcb
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
comma
id|__u16
id|bytes_count
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|FCBlock
op_star
id|pFCB
suffix:semicolon
id|BDBlock
op_star
id|pbdb
suffix:semicolon
r_int
r_int
id|alloc_size
suffix:semicolon
r_int
r_int
op_star
id|temp
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|20
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;smctr_get_tx_fcb&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* check if there is enough FCB blocks */
r_if
c_cond
(paren
id|tp-&gt;num_tx_fcbs_used
(braket
id|queue
)braket
op_ge
id|tp-&gt;num_tx_fcbs
(braket
id|queue
)braket
)paren
(brace
r_return
(paren
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* round off the input pkt size to the nearest even number */
id|alloc_size
op_assign
(paren
id|bytes_count
op_plus
l_int|1
)paren
op_amp
l_int|0xfffe
suffix:semicolon
multiline_comment|/* check if enough mem */
r_if
c_cond
(paren
(paren
id|tp-&gt;tx_buff_used
(braket
id|queue
)braket
op_plus
id|alloc_size
)paren
OG
id|tp-&gt;tx_buff_size
(braket
id|queue
)braket
)paren
(brace
r_return
(paren
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* check if past the end ;&n;         * if exactly enough mem to end of ring, alloc from front.&n;         * this avoids update of curr when curr = end&n;         */
r_if
c_cond
(paren
(paren
(paren
r_int
r_int
)paren
(paren
id|tp-&gt;tx_buff_curr
(braket
id|queue
)braket
)paren
op_plus
id|alloc_size
)paren
op_ge
(paren
r_int
r_int
)paren
(paren
id|tp-&gt;tx_buff_end
(braket
id|queue
)braket
)paren
)paren
(brace
multiline_comment|/* check if enough memory from ring head */
id|alloc_size
op_assign
id|alloc_size
op_plus
(paren
id|__u16
)paren
(paren
(paren
id|__u32
)paren
id|tp-&gt;tx_buff_end
(braket
id|queue
)braket
op_minus
(paren
id|__u32
)paren
id|tp-&gt;tx_buff_curr
(braket
id|queue
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;tx_buff_used
(braket
id|queue
)braket
op_plus
id|alloc_size
)paren
OG
id|tp-&gt;tx_buff_size
(braket
id|queue
)braket
)paren
(brace
r_return
(paren
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ring wrap */
id|tp-&gt;tx_buff_curr
(braket
id|queue
)braket
op_assign
id|tp-&gt;tx_buff_head
(braket
id|queue
)braket
suffix:semicolon
)brace
id|tp-&gt;tx_buff_used
(braket
id|queue
)braket
op_add_assign
id|alloc_size
suffix:semicolon
id|tp-&gt;num_tx_fcbs_used
(braket
id|queue
)braket
op_increment
suffix:semicolon
id|tp-&gt;tx_fcb_curr
(braket
id|queue
)braket
op_member_access_from_pointer
id|frame_length
op_assign
id|bytes_count
suffix:semicolon
id|tp-&gt;tx_fcb_curr
(braket
id|queue
)braket
op_member_access_from_pointer
id|memory_alloc
op_assign
id|alloc_size
suffix:semicolon
id|temp
op_assign
id|tp-&gt;tx_buff_curr
(braket
id|queue
)braket
suffix:semicolon
id|tp-&gt;tx_buff_curr
(braket
id|queue
)braket
op_assign
(paren
id|__u16
op_star
)paren
(paren
(paren
id|__u32
)paren
id|temp
op_plus
(paren
id|__u32
)paren
(paren
(paren
id|bytes_count
op_plus
l_int|1
)paren
op_amp
l_int|0xfffe
)paren
)paren
suffix:semicolon
id|pbdb
op_assign
id|tp-&gt;tx_fcb_curr
(braket
id|queue
)braket
op_member_access_from_pointer
id|bdb_ptr
suffix:semicolon
id|pbdb-&gt;buffer_length
op_assign
id|bytes_count
suffix:semicolon
id|pbdb-&gt;data_block_ptr
op_assign
id|temp
suffix:semicolon
id|pbdb-&gt;trc_data_block_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|temp
)paren
suffix:semicolon
id|pFCB
op_assign
id|tp-&gt;tx_fcb_curr
(braket
id|queue
)braket
suffix:semicolon
id|tp-&gt;tx_fcb_curr
(braket
id|queue
)braket
op_assign
id|tp-&gt;tx_fcb_curr
(braket
id|queue
)braket
op_member_access_from_pointer
id|next_ptr
suffix:semicolon
r_return
(paren
id|pFCB
)paren
suffix:semicolon
)brace
DECL|function|smctr_get_upstream_neighbor_addr
r_static
r_int
id|smctr_get_upstream_neighbor_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|smctr_issue_read_word_cmd
c_func
(paren
id|dev
comma
id|RW_UPSTREAM_NEIGHBOR_ADDRESS
)paren
suffix:semicolon
r_return
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|smctr_hardware_send_packet
r_static
r_int
id|smctr_hardware_send_packet
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|net_local
op_star
id|tp
)paren
(brace
r_struct
id|tr_statistics
op_star
id|tstat
op_assign
op_amp
id|tp-&gt;MacStat
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_hardware_send_packet&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;status
op_ne
id|OPEN
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;monitor_state_ready
op_ne
l_int|1
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
multiline_comment|/* Send first buffer from queue */
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|tp-&gt;SendSkbQueue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|tp-&gt;QueueSkb
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
template_param
id|tp-&gt;max_packet_size
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
id|tp-&gt;ram_access
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fcb
op_assign
id|smctr_get_tx_fcb
c_func
(paren
id|dev
comma
id|NON_MAC_QUEUE
comma
id|skb-&gt;len
)paren
)paren
op_eq
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
(brace
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|smctr_tx_move_frame
c_func
(paren
id|dev
comma
id|skb
comma
(paren
id|__u8
op_star
)paren
id|fcb-&gt;bdb_ptr-&gt;data_block_ptr
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
id|fcb
)paren
suffix:semicolon
id|smctr_trc_send_packet
c_func
(paren
id|dev
comma
id|fcb
comma
id|NON_MAC_QUEUE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tstat-&gt;tx_packets
op_increment
suffix:semicolon
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_init_acbs
r_static
r_int
id|smctr_init_acbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|ACBlock
op_star
id|acb
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_init_acbs&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|acb
op_assign
id|tp-&gt;acb_head
suffix:semicolon
id|acb-&gt;cmd_done_status
op_assign
(paren
id|ACB_COMMAND_DONE
op_or
id|ACB_COMMAND_SUCCESSFUL
)paren
suffix:semicolon
id|acb-&gt;cmd_info
op_assign
id|ACB_CHAIN_END
suffix:semicolon
id|acb-&gt;cmd
op_assign
l_int|0
suffix:semicolon
id|acb-&gt;subcmd
op_assign
l_int|0
suffix:semicolon
id|acb-&gt;data_offset_lo
op_assign
l_int|0
suffix:semicolon
id|acb-&gt;data_offset_hi
op_assign
l_int|0
suffix:semicolon
id|acb-&gt;next_ptr
op_assign
(paren
id|ACBlock
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|acb
)paren
op_plus
r_sizeof
(paren
id|ACBlock
)paren
)paren
suffix:semicolon
id|acb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|acb-&gt;next_ptr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|tp-&gt;num_acbs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|acb
op_assign
id|acb-&gt;next_ptr
suffix:semicolon
id|acb-&gt;cmd_done_status
op_assign
(paren
id|ACB_COMMAND_DONE
op_or
id|ACB_COMMAND_SUCCESSFUL
)paren
suffix:semicolon
id|acb-&gt;cmd_info
op_assign
id|ACB_CHAIN_END
suffix:semicolon
id|acb-&gt;cmd
op_assign
l_int|0
suffix:semicolon
id|acb-&gt;subcmd
op_assign
l_int|0
suffix:semicolon
id|acb-&gt;data_offset_lo
op_assign
l_int|0
suffix:semicolon
id|acb-&gt;data_offset_hi
op_assign
l_int|0
suffix:semicolon
id|acb-&gt;next_ptr
op_assign
(paren
id|ACBlock
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|acb
)paren
op_plus
r_sizeof
(paren
id|ACBlock
)paren
)paren
suffix:semicolon
id|acb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|acb-&gt;next_ptr
)paren
suffix:semicolon
)brace
id|acb-&gt;next_ptr
op_assign
id|tp-&gt;acb_head
suffix:semicolon
id|acb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|tp-&gt;acb_head
)paren
suffix:semicolon
id|tp-&gt;acb_next
op_assign
id|tp-&gt;acb_head-&gt;next_ptr
suffix:semicolon
id|tp-&gt;acb_curr
op_assign
id|tp-&gt;acb_head-&gt;next_ptr
suffix:semicolon
id|tp-&gt;num_acbs_used
op_assign
l_int|0
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_init_adapter
r_static
r_int
id|smctr_init_adapter
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_init_adapter&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|tp-&gt;status
op_assign
id|CLOSED
suffix:semicolon
id|tp-&gt;page_offset_mask
op_assign
(paren
id|tp-&gt;ram_usable
op_star
l_int|1024
)paren
op_minus
l_int|1
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|tp-&gt;SendSkbQueue
)paren
suffix:semicolon
id|tp-&gt;QueueSkb
op_assign
id|MAX_TX_QUEUE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;group_address_0
op_amp
l_int|0x0080
)paren
)paren
(brace
id|tp-&gt;group_address_0
op_or_assign
l_int|0x00C0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;functional_address_0
op_amp
l_int|0x00C0
)paren
)paren
(brace
id|tp-&gt;functional_address_0
op_or_assign
l_int|0x00C0
suffix:semicolon
)brace
id|tp-&gt;functional_address
(braket
l_int|0
)braket
op_and_assign
l_int|0xFF7F
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;authorized_function_classes
op_eq
l_int|0
)paren
(brace
id|tp-&gt;authorized_function_classes
op_assign
l_int|0x7FFF
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;authorized_access_priority
op_eq
l_int|0
)paren
(brace
id|tp-&gt;authorized_access_priority
op_assign
l_int|0x06
suffix:semicolon
)brace
id|smctr_disable_bic_int
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_set_trc_reset
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
multiline_comment|/* By default the adapter will operate in 16-bit mode only. If&n;         * there are two or more adapters in a box, switching between&n;         * 16-bit and 8-bit mode may cause problems. In short the adapters&n;         * will interfere with each other. XXX - smc.&n;         */
id|smctr_disable_adapter_ram
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_rom_conflict_test
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_ram_conflict_test
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|smctr_enable_adapter_ram
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
id|tp-&gt;ram_access
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smctr_checksum_firmware
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
(paren
id|UCODE_NOT_PRESENT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_ram_memory_test
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smctr_checksum_firmware
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_ram_memory_test
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|smctr_set_rx_look_ahead
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_load_node_addr
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Initialize adapter for Internal Self Test. */
id|smctr_reset_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_init_card_real
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* This routine clobbers the TRC&squot;s internal registers. */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_internal_self_test
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* Re-Initialize adapter&squot;s internal registers */
id|smctr_reset_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_init_card_real
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|smctr_enable_bic_int
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_enable_int_cmd
c_func
(paren
id|dev
comma
id|TRC_INTERRUPT_ENABLE_MASK
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Dummy function */
DECL|function|smctr_init_card
r_static
r_int
id|__init
id|smctr_init_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_init_card&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_init_card_real
r_static
r_int
id|smctr_init_card_real
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_init_card_real&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|tp-&gt;sh_mem_used
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;num_acbs
op_assign
id|NUM_OF_ACBS
suffix:semicolon
multiline_comment|/* Range Check Max Packet Size */
r_if
c_cond
(paren
id|tp-&gt;max_packet_size
OL
l_int|256
)paren
(brace
id|tp-&gt;max_packet_size
op_assign
l_int|256
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tp-&gt;max_packet_size
OG
id|NON_MAC_TX_BUFFER_MEMORY
)paren
(brace
id|tp-&gt;max_packet_size
op_assign
id|NON_MAC_TX_BUFFER_MEMORY
suffix:semicolon
)brace
)brace
id|tp-&gt;num_of_tx_buffs
op_assign
(paren
id|NON_MAC_TX_BUFFER_MEMORY
op_div
id|tp-&gt;max_packet_size
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;num_of_tx_buffs
OG
id|NUM_NON_MAC_TX_FCBS
)paren
(brace
id|tp-&gt;num_of_tx_buffs
op_assign
id|NUM_NON_MAC_TX_FCBS
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tp-&gt;num_of_tx_buffs
op_eq
l_int|0
)paren
(brace
id|tp-&gt;num_of_tx_buffs
op_assign
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* Tx queue constants */
id|tp-&gt;num_tx_fcbs
(braket
id|BUG_QUEUE
)braket
op_assign
id|NUM_BUG_TX_FCBS
suffix:semicolon
id|tp-&gt;num_tx_bdbs
(braket
id|BUG_QUEUE
)braket
op_assign
id|NUM_BUG_TX_BDBS
suffix:semicolon
id|tp-&gt;tx_buff_size
(braket
id|BUG_QUEUE
)braket
op_assign
id|BUG_TX_BUFFER_MEMORY
suffix:semicolon
id|tp-&gt;tx_buff_used
(braket
id|BUG_QUEUE
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_queue_status
(braket
id|BUG_QUEUE
)braket
op_assign
id|NOT_TRANSMITING
suffix:semicolon
id|tp-&gt;num_tx_fcbs
(braket
id|MAC_QUEUE
)braket
op_assign
id|NUM_MAC_TX_FCBS
suffix:semicolon
id|tp-&gt;num_tx_bdbs
(braket
id|MAC_QUEUE
)braket
op_assign
id|NUM_MAC_TX_BDBS
suffix:semicolon
id|tp-&gt;tx_buff_size
(braket
id|MAC_QUEUE
)braket
op_assign
id|MAC_TX_BUFFER_MEMORY
suffix:semicolon
id|tp-&gt;tx_buff_used
(braket
id|MAC_QUEUE
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_queue_status
(braket
id|MAC_QUEUE
)braket
op_assign
id|NOT_TRANSMITING
suffix:semicolon
id|tp-&gt;num_tx_fcbs
(braket
id|NON_MAC_QUEUE
)braket
op_assign
id|NUM_NON_MAC_TX_FCBS
suffix:semicolon
id|tp-&gt;num_tx_bdbs
(braket
id|NON_MAC_QUEUE
)braket
op_assign
id|NUM_NON_MAC_TX_BDBS
suffix:semicolon
id|tp-&gt;tx_buff_size
(braket
id|NON_MAC_QUEUE
)braket
op_assign
id|NON_MAC_TX_BUFFER_MEMORY
suffix:semicolon
id|tp-&gt;tx_buff_used
(braket
id|NON_MAC_QUEUE
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_queue_status
(braket
id|NON_MAC_QUEUE
)braket
op_assign
id|NOT_TRANSMITING
suffix:semicolon
multiline_comment|/* Receive Queue Constants */
id|tp-&gt;num_rx_fcbs
(braket
id|MAC_QUEUE
)braket
op_assign
id|NUM_MAC_RX_FCBS
suffix:semicolon
id|tp-&gt;num_rx_bdbs
(braket
id|MAC_QUEUE
)braket
op_assign
id|NUM_MAC_RX_BDBS
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;extra_info
op_amp
id|CHIP_REV_MASK
)paren
(brace
id|tp-&gt;num_rx_fcbs
(braket
id|NON_MAC_QUEUE
)braket
op_assign
l_int|78
suffix:semicolon
)brace
multiline_comment|/* 825 Rev. XE */
r_else
id|tp-&gt;num_rx_fcbs
(braket
id|NON_MAC_QUEUE
)braket
op_assign
l_int|7
suffix:semicolon
multiline_comment|/* 825 Rev. XD */
id|tp-&gt;num_rx_bdbs
(braket
id|NON_MAC_QUEUE
)braket
op_assign
id|smctr_get_num_rx_bdbs
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_alloc_shared_memory
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_init_shared_memory
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_init_timers_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_init_txrx_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_init_rx_bdbs
r_static
r_int
id|smctr_init_rx_bdbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
comma
id|j
suffix:semicolon
id|BDBlock
op_star
id|bdb
suffix:semicolon
id|__u16
op_star
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_init_rx_bdbs&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_QS_USED
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bdb
op_assign
id|tp-&gt;rx_bdb_head
(braket
id|i
)braket
suffix:semicolon
id|buf
op_assign
id|tp-&gt;rx_buff_head
(braket
id|i
)braket
suffix:semicolon
id|bdb-&gt;info
op_assign
(paren
id|BDB_CHAIN_END
op_or
id|BDB_NO_WARNING
)paren
suffix:semicolon
id|bdb-&gt;buffer_length
op_assign
id|RX_DATA_BUFFER_SIZE
suffix:semicolon
id|bdb-&gt;next_ptr
op_assign
(paren
id|BDBlock
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|bdb
)paren
op_plus
r_sizeof
(paren
id|BDBlock
)paren
)paren
suffix:semicolon
id|bdb-&gt;data_block_ptr
op_assign
id|buf
suffix:semicolon
id|bdb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|bdb-&gt;next_ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|NON_MAC_QUEUE
)paren
(brace
id|bdb-&gt;trc_data_block_ptr
op_assign
id|RX_BUFF_TRC_POINTER
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
r_else
id|bdb-&gt;trc_data_block_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|buf
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
id|tp-&gt;num_rx_bdbs
(braket
id|i
)braket
suffix:semicolon
id|j
op_increment
)paren
(brace
id|bdb-&gt;next_ptr-&gt;back_ptr
op_assign
id|bdb
suffix:semicolon
id|bdb
op_assign
id|bdb-&gt;next_ptr
suffix:semicolon
id|buf
op_assign
(paren
id|__u16
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|buf
op_plus
id|RX_DATA_BUFFER_SIZE
)paren
suffix:semicolon
id|bdb-&gt;info
op_assign
(paren
id|BDB_NOT_CHAIN_END
op_or
id|BDB_NO_WARNING
)paren
suffix:semicolon
id|bdb-&gt;buffer_length
op_assign
id|RX_DATA_BUFFER_SIZE
suffix:semicolon
id|bdb-&gt;next_ptr
op_assign
(paren
id|BDBlock
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|bdb
)paren
op_plus
r_sizeof
(paren
id|BDBlock
)paren
)paren
suffix:semicolon
id|bdb-&gt;data_block_ptr
op_assign
id|buf
suffix:semicolon
id|bdb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|bdb-&gt;next_ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|NON_MAC_QUEUE
)paren
(brace
id|bdb-&gt;trc_data_block_ptr
op_assign
id|RX_BUFF_TRC_POINTER
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
r_else
id|bdb-&gt;trc_data_block_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
id|bdb-&gt;next_ptr
op_assign
id|tp-&gt;rx_bdb_head
(braket
id|i
)braket
suffix:semicolon
id|bdb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|tp-&gt;rx_bdb_head
(braket
id|i
)braket
)paren
suffix:semicolon
id|tp-&gt;rx_bdb_head
(braket
id|i
)braket
op_member_access_from_pointer
id|back_ptr
op_assign
id|bdb
suffix:semicolon
id|tp-&gt;rx_bdb_curr
(braket
id|i
)braket
op_assign
id|tp-&gt;rx_bdb_head
(braket
id|i
)braket
op_member_access_from_pointer
id|next_ptr
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_init_rx_fcbs
r_static
r_int
id|smctr_init_rx_fcbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
comma
id|j
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_QS_USED
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fcb
op_assign
id|tp-&gt;rx_fcb_head
(braket
id|i
)braket
suffix:semicolon
id|fcb-&gt;frame_status
op_assign
l_int|0
suffix:semicolon
id|fcb-&gt;frame_length
op_assign
l_int|0
suffix:semicolon
id|fcb-&gt;info
op_assign
id|FCB_CHAIN_END
suffix:semicolon
id|fcb-&gt;next_ptr
op_assign
(paren
id|FCBlock
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|fcb
)paren
op_plus
r_sizeof
(paren
id|FCBlock
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|NON_MAC_QUEUE
)paren
(brace
id|fcb-&gt;trc_next_ptr
op_assign
id|RX_FCB_TRC_POINTER
c_func
(paren
id|fcb-&gt;next_ptr
)paren
suffix:semicolon
)brace
r_else
id|fcb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|fcb-&gt;next_ptr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
id|tp-&gt;num_rx_fcbs
(braket
id|i
)braket
suffix:semicolon
id|j
op_increment
)paren
(brace
id|fcb-&gt;next_ptr-&gt;back_ptr
op_assign
id|fcb
suffix:semicolon
id|fcb
op_assign
id|fcb-&gt;next_ptr
suffix:semicolon
id|fcb-&gt;frame_status
op_assign
l_int|0
suffix:semicolon
id|fcb-&gt;frame_length
op_assign
l_int|0
suffix:semicolon
id|fcb-&gt;info
op_assign
id|FCB_WARNING
suffix:semicolon
id|fcb-&gt;next_ptr
op_assign
(paren
id|FCBlock
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|fcb
)paren
op_plus
r_sizeof
(paren
id|FCBlock
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|NON_MAC_QUEUE
)paren
(brace
id|fcb-&gt;trc_next_ptr
op_assign
id|RX_FCB_TRC_POINTER
c_func
(paren
id|fcb-&gt;next_ptr
)paren
suffix:semicolon
)brace
r_else
id|fcb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|fcb-&gt;next_ptr
)paren
suffix:semicolon
)brace
id|fcb-&gt;next_ptr
op_assign
id|tp-&gt;rx_fcb_head
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|NON_MAC_QUEUE
)paren
(brace
id|fcb-&gt;trc_next_ptr
op_assign
id|RX_FCB_TRC_POINTER
c_func
(paren
id|fcb-&gt;next_ptr
)paren
suffix:semicolon
)brace
r_else
id|fcb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|fcb-&gt;next_ptr
)paren
suffix:semicolon
id|tp-&gt;rx_fcb_head
(braket
id|i
)braket
op_member_access_from_pointer
id|back_ptr
op_assign
id|fcb
suffix:semicolon
id|tp-&gt;rx_fcb_curr
(braket
id|i
)braket
op_assign
id|tp-&gt;rx_fcb_head
(braket
id|i
)braket
op_member_access_from_pointer
id|next_ptr
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|smctr_init_shared_memory
r_static
r_int
id|smctr_init_shared_memory
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|__u32
op_star
id|iscpb
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_init_shared_memory&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
(paren
r_int
r_int
)paren
id|tp-&gt;iscpb_ptr
)paren
suffix:semicolon
multiline_comment|/* Initialize Initial System Configuration Point. (ISCP) */
id|iscpb
op_assign
(paren
id|__u32
op_star
)paren
id|PAGE_POINTER
c_func
(paren
op_amp
id|tp-&gt;iscpb_ptr-&gt;trc_scgb_ptr
)paren
suffix:semicolon
op_star
id|iscpb
op_assign
(paren
id|__u32
)paren
(paren
id|SWAP_WORDS
c_func
(paren
id|TRC_POINTER
c_func
(paren
id|tp-&gt;scgb_ptr
)paren
)paren
)paren
suffix:semicolon
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
id|tp-&gt;ram_access
)paren
suffix:semicolon
multiline_comment|/* Initialize System Configuration Pointers. (SCP) */
id|tp-&gt;scgb_ptr-&gt;config
op_assign
(paren
id|SCGB_ADDRESS_POINTER_FORMAT
op_or
id|SCGB_MULTI_WORD_CONTROL
op_or
id|SCGB_DATA_FORMAT
op_or
id|SCGB_BURST_LENGTH
)paren
suffix:semicolon
id|tp-&gt;scgb_ptr-&gt;trc_sclb_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|tp-&gt;sclb_ptr
)paren
suffix:semicolon
id|tp-&gt;scgb_ptr-&gt;trc_acb_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|tp-&gt;acb_head
)paren
suffix:semicolon
id|tp-&gt;scgb_ptr-&gt;trc_isb_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|tp-&gt;isb_ptr
)paren
suffix:semicolon
id|tp-&gt;scgb_ptr-&gt;isbsiz
op_assign
(paren
r_sizeof
(paren
id|ISBlock
)paren
)paren
op_minus
l_int|2
suffix:semicolon
multiline_comment|/* Initialize System Control Block. (SCB) */
id|tp-&gt;sclb_ptr-&gt;valid_command
op_assign
id|SCLB_VALID
op_or
id|SCLB_CMD_NOP
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;iack_code
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;resume_control
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;int_mask_control
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;int_mask_state
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Initialize Interrupt Status Block. (ISB) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_OF_INTERRUPTS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;isb_ptr-&gt;IStatus
(braket
id|i
)braket
dot
id|IType
op_assign
l_int|0xf0
suffix:semicolon
id|tp-&gt;isb_ptr-&gt;IStatus
(braket
id|i
)braket
dot
id|ISubtype
op_assign
l_int|0
suffix:semicolon
)brace
id|tp-&gt;current_isb_index
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Initialize Action Command Block. (ACB) */
id|smctr_init_acbs
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Initialize transmit FCB&squot;s and BDB&squot;s. */
id|smctr_link_tx_fcbs_to_bdbs
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_init_tx_bdbs
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_init_tx_fcbs
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Initialize receive FCB&squot;s and BDB&squot;s. */
id|smctr_init_rx_bdbs
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_init_rx_fcbs
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_init_tx_bdbs
r_static
r_int
id|smctr_init_tx_bdbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
comma
id|j
suffix:semicolon
id|BDBlock
op_star
id|bdb
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_QS_USED
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bdb
op_assign
id|tp-&gt;tx_bdb_head
(braket
id|i
)braket
suffix:semicolon
id|bdb-&gt;info
op_assign
(paren
id|BDB_NOT_CHAIN_END
op_or
id|BDB_NO_WARNING
)paren
suffix:semicolon
id|bdb-&gt;next_ptr
op_assign
(paren
id|BDBlock
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|bdb
)paren
op_plus
r_sizeof
(paren
id|BDBlock
)paren
)paren
suffix:semicolon
id|bdb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|bdb-&gt;next_ptr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
id|tp-&gt;num_tx_bdbs
(braket
id|i
)braket
suffix:semicolon
id|j
op_increment
)paren
(brace
id|bdb-&gt;next_ptr-&gt;back_ptr
op_assign
id|bdb
suffix:semicolon
id|bdb
op_assign
id|bdb-&gt;next_ptr
suffix:semicolon
id|bdb-&gt;info
op_assign
(paren
id|BDB_NOT_CHAIN_END
op_or
id|BDB_NO_WARNING
)paren
suffix:semicolon
id|bdb-&gt;next_ptr
op_assign
(paren
id|BDBlock
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|bdb
)paren
op_plus
r_sizeof
(paren
id|BDBlock
)paren
)paren
suffix:semicolon
id|bdb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|bdb-&gt;next_ptr
)paren
suffix:semicolon
)brace
id|bdb-&gt;next_ptr
op_assign
id|tp-&gt;tx_bdb_head
(braket
id|i
)braket
suffix:semicolon
id|bdb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|tp-&gt;tx_bdb_head
(braket
id|i
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_bdb_head
(braket
id|i
)braket
op_member_access_from_pointer
id|back_ptr
op_assign
id|bdb
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_init_tx_fcbs
r_static
r_int
id|smctr_init_tx_fcbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
comma
id|j
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_QS_USED
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fcb
op_assign
id|tp-&gt;tx_fcb_head
(braket
id|i
)braket
suffix:semicolon
id|fcb-&gt;frame_status
op_assign
l_int|0
suffix:semicolon
id|fcb-&gt;frame_length
op_assign
l_int|0
suffix:semicolon
id|fcb-&gt;info
op_assign
id|FCB_CHAIN_END
suffix:semicolon
id|fcb-&gt;next_ptr
op_assign
(paren
id|FCBlock
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|fcb
)paren
op_plus
r_sizeof
(paren
id|FCBlock
)paren
)paren
suffix:semicolon
id|fcb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|fcb-&gt;next_ptr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
id|tp-&gt;num_tx_fcbs
(braket
id|i
)braket
suffix:semicolon
id|j
op_increment
)paren
(brace
id|fcb-&gt;next_ptr-&gt;back_ptr
op_assign
id|fcb
suffix:semicolon
id|fcb
op_assign
id|fcb-&gt;next_ptr
suffix:semicolon
id|fcb-&gt;frame_status
op_assign
l_int|0
suffix:semicolon
id|fcb-&gt;frame_length
op_assign
l_int|0
suffix:semicolon
id|fcb-&gt;info
op_assign
id|FCB_CHAIN_END
suffix:semicolon
id|fcb-&gt;next_ptr
op_assign
(paren
id|FCBlock
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|fcb
)paren
op_plus
r_sizeof
(paren
id|FCBlock
)paren
)paren
suffix:semicolon
id|fcb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|fcb-&gt;next_ptr
)paren
suffix:semicolon
)brace
id|fcb-&gt;next_ptr
op_assign
id|tp-&gt;tx_fcb_head
(braket
id|i
)braket
suffix:semicolon
id|fcb-&gt;trc_next_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|tp-&gt;tx_fcb_head
(braket
id|i
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_fcb_head
(braket
id|i
)braket
op_member_access_from_pointer
id|back_ptr
op_assign
id|fcb
suffix:semicolon
id|tp-&gt;tx_fcb_end
(braket
id|i
)braket
op_assign
id|tp-&gt;tx_fcb_head
(braket
id|i
)braket
op_member_access_from_pointer
id|next_ptr
suffix:semicolon
id|tp-&gt;tx_fcb_curr
(braket
id|i
)braket
op_assign
id|tp-&gt;tx_fcb_head
(braket
id|i
)braket
op_member_access_from_pointer
id|next_ptr
suffix:semicolon
id|tp-&gt;num_tx_fcbs_used
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_internal_self_test
r_static
r_int
id|smctr_internal_self_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_test_internal_rom_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;acb_head-&gt;cmd_done_status
op_amp
l_int|0xff
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_test_hic_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;acb_head-&gt;cmd_done_status
op_amp
l_int|0xff
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_test_mac_reg_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;acb_head-&gt;cmd_done_status
op_amp
l_int|0xff
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * The typical workload of the driver: Handle the network interface interrupts.&n; */
DECL|function|smctr_interrupt
r_static
r_void
id|smctr_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|net_local
op_star
id|tp
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
id|__u16
id|interrupt_unmask_bits
op_assign
l_int|0
comma
id|interrupt_ack_code
op_assign
l_int|0xff00
suffix:semicolon
id|__u16
id|err1
comma
id|err
op_assign
id|NOT_MY_INTERRUPT
suffix:semicolon
id|__u8
id|isb_type
comma
id|isb_subtype
suffix:semicolon
id|__u16
id|isb_index
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: irq %d for unknown device.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;status
op_eq
id|NOT_INITIALIZED
)paren
(brace
r_return
suffix:semicolon
)brace
id|smctr_disable_bic_int
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_clear_int
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* First read the LSB */
r_while
c_loop
(paren
(paren
id|tp-&gt;isb_ptr-&gt;IStatus
(braket
id|tp-&gt;current_isb_index
)braket
dot
id|IType
op_amp
l_int|0xf0
)paren
op_eq
l_int|0
)paren
(brace
id|isb_index
op_assign
id|tp-&gt;current_isb_index
suffix:semicolon
id|isb_type
op_assign
id|tp-&gt;isb_ptr-&gt;IStatus
(braket
id|isb_index
)braket
dot
id|IType
suffix:semicolon
id|isb_subtype
op_assign
id|tp-&gt;isb_ptr-&gt;IStatus
(braket
id|isb_index
)braket
dot
id|ISubtype
suffix:semicolon
(paren
id|tp-&gt;current_isb_index
)paren
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;current_isb_index
op_eq
id|NUM_OF_INTERRUPTS
)paren
(brace
id|tp-&gt;current_isb_index
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isb_type
op_ge
l_int|0x10
)paren
(brace
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|err
op_assign
id|HARDWARE_FAILED
suffix:semicolon
id|interrupt_ack_code
op_assign
id|isb_index
suffix:semicolon
id|tp-&gt;isb_ptr-&gt;IStatus
(braket
id|isb_index
)braket
dot
id|IType
op_or_assign
l_int|0xf0
suffix:semicolon
id|interrupt_unmask_bits
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|__u16
)paren
id|isb_type
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|isb_type
)paren
(brace
r_case
id|ISB_IMC_MAC_TYPE_3
suffix:colon
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|isb_subtype
)paren
(brace
r_case
l_int|0
suffix:colon
id|tp-&gt;monitor_state
op_assign
id|MS_MONITOR_FSM_INACTIVE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|tp-&gt;monitor_state
op_assign
id|MS_REPEAT_BEACON_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|tp-&gt;monitor_state
op_assign
id|MS_REPEAT_CLAIM_TOKEN_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|tp-&gt;monitor_state
op_assign
id|MS_TRANSMIT_CLAIM_TOKEN_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|tp-&gt;monitor_state
op_assign
id|MS_STANDBY_MONITOR_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|tp-&gt;monitor_state
op_assign
id|MS_TRANSMIT_BEACON_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|tp-&gt;monitor_state
op_assign
id|MS_ACTIVE_MONITOR_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|tp-&gt;monitor_state
op_assign
id|MS_TRANSMIT_RING_PURGE_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
multiline_comment|/* diagnostic state */
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|tp-&gt;monitor_state
op_assign
id|MS_BEACON_TEST_STATE
suffix:semicolon
r_if
c_cond
(paren
id|smctr_lobe_media_test
c_func
(paren
id|dev
)paren
)paren
(brace
id|tp-&gt;ring_status_flags
op_assign
id|RING_STATUS_CHANGED
suffix:semicolon
id|tp-&gt;ring_status
op_assign
id|AUTO_REMOVAL_ERROR
suffix:semicolon
id|smctr_ring_status_chg
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_bypass_state
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
id|smctr_issue_insert_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* case 0x0a-0xff, illegal states */
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|tp-&gt;ring_status_flags
op_assign
id|MONITOR_STATE_CHANGED
suffix:semicolon
id|err
op_assign
id|smctr_ring_status_chg
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Type 0x02 - MAC Error Counters Interrupt&n;                         * One or more MAC Error Counter is half full&n;                         *      MAC Error Counters&n;                         *      Lost_FR_Error_Counter&n;                         *      RCV_Congestion_Counter&n;                         *      FR_copied_Error_Counter&n;                         *      FREQ_Error_Counter&n;                         *      Token_Error_Counter&n;                         *      Line_Error_Counter&n;                         *      Internal_Error_Count&n;                         */
r_case
id|ISB_IMC_MAC_ERROR_COUNTERS
suffix:colon
multiline_comment|/* Read 802.5 Error Counters */
id|err
op_assign
id|smctr_issue_read_ring_status_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Type 0x04 - MAC Type 2 Interrupt&n;                         * HOST needs to enqueue MAC Frame for transmission&n;                         * SubType Bit 15 - RQ_INIT_PDU( Request Initialization)                         * Changed from RQ_INIT_PDU to&n;                         * TRC_Status_Changed_Indicate&n;                         */
r_case
id|ISB_IMC_MAC_TYPE_2
suffix:colon
id|err
op_assign
id|smctr_issue_read_ring_status_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Type 0x05 - TX Frame Interrupt (FI). */
r_case
id|ISB_IMC_TX_FRAME
suffix:colon
multiline_comment|/* BUG QUEUE for TRC stuck receive BUG */
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|TX_PENDING_PRIORITY_2
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_tx_complete
c_func
(paren
id|dev
comma
id|BUG_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* NON-MAC frames only */
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|TX_PENDING_PRIORITY_1
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_tx_complete
c_func
(paren
id|dev
comma
id|NON_MAC_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* MAC frames only */
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|TX_PENDING_PRIORITY_0
)paren
(brace
id|err
op_assign
id|smctr_tx_complete
c_func
(paren
id|dev
comma
id|MAC_QUEUE
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* Type 0x06 - TX END OF QUEUE (FE) */
r_case
id|ISB_IMC_END_OF_TX_QUEUE
suffix:colon
multiline_comment|/* BUG queue */
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|TX_PENDING_PRIORITY_2
)paren
(brace
multiline_comment|/* ok to clear Receive FIFO overrun&n;                                         * imask send_BUG now completes.&n;                                         */
id|interrupt_unmask_bits
op_or_assign
l_int|0x800
suffix:semicolon
id|tp-&gt;tx_queue_status
(braket
id|BUG_QUEUE
)braket
op_assign
id|NOT_TRANSMITING
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_tx_complete
c_func
(paren
id|dev
comma
id|BUG_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_restart_tx_chain
c_func
(paren
id|dev
comma
id|BUG_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* NON-MAC queue only */
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|TX_PENDING_PRIORITY_1
)paren
(brace
id|tp-&gt;tx_queue_status
(braket
id|NON_MAC_QUEUE
)braket
op_assign
id|NOT_TRANSMITING
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_tx_complete
c_func
(paren
id|dev
comma
id|NON_MAC_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_restart_tx_chain
c_func
(paren
id|dev
comma
id|NON_MAC_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* MAC queue only */
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|TX_PENDING_PRIORITY_0
)paren
(brace
id|tp-&gt;tx_queue_status
(braket
id|MAC_QUEUE
)braket
op_assign
id|NOT_TRANSMITING
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_tx_complete
c_func
(paren
id|dev
comma
id|MAC_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
id|err
op_assign
id|smctr_restart_tx_chain
c_func
(paren
id|dev
comma
id|MAC_QUEUE
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* Type 0x07 - NON-MAC RX Resource Interrupt&n;                         *   Subtype bit 12 - (BW) BDB warning&n;                         *   Subtype bit 13 - (FW) FCB warning&n;                         *   Subtype bit 14 - (BE) BDB End of chain&n;                         *   Subtype bit 15 - (FE) FCB End of chain&n;                         */
r_case
id|ISB_IMC_NON_MAC_RX_RESOURCE
suffix:colon
id|tp-&gt;rx_fifo_overrun_count
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;receive_queue_number
op_assign
id|NON_MAC_QUEUE
suffix:semicolon
id|err1
op_assign
id|smctr_rx_frame
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|NON_MAC_RX_RESOURCE_FE
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_resume_rx_fcb_cmd
c_func
(paren
id|dev
comma
id|NON_MAC_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;ptr_rx_fcb_overruns
)paren
(brace
(paren
op_star
id|tp-&gt;ptr_rx_fcb_overruns
)paren
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|NON_MAC_RX_RESOURCE_BE
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_resume_rx_bdb_cmd
c_func
(paren
id|dev
comma
id|NON_MAC_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;ptr_rx_bdb_overruns
)paren
(brace
(paren
op_star
id|tp-&gt;ptr_rx_bdb_overruns
)paren
op_increment
suffix:semicolon
)brace
)brace
id|err
op_assign
id|err1
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Type 0x08 - MAC RX Resource Interrupt&n;                         *   Subtype bit 12 - (BW) BDB warning&n;                         *   Subtype bit 13 - (FW) FCB warning&n;                         *   Subtype bit 14 - (BE) BDB End of chain&n;                         *   Subtype bit 15 - (FE) FCB End of chain&n;                         */
r_case
id|ISB_IMC_MAC_RX_RESOURCE
suffix:colon
id|tp-&gt;receive_queue_number
op_assign
id|MAC_QUEUE
suffix:semicolon
id|err1
op_assign
id|smctr_rx_frame
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|MAC_RX_RESOURCE_FE
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_resume_rx_fcb_cmd
c_func
(paren
id|dev
comma
id|MAC_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;ptr_rx_fcb_overruns
)paren
(brace
(paren
op_star
id|tp-&gt;ptr_rx_fcb_overruns
)paren
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|MAC_RX_RESOURCE_BE
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_resume_rx_bdb_cmd
c_func
(paren
id|dev
comma
id|MAC_QUEUE
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;ptr_rx_bdb_overruns
)paren
(brace
(paren
op_star
id|tp-&gt;ptr_rx_bdb_overruns
)paren
op_increment
suffix:semicolon
)brace
)brace
id|err
op_assign
id|err1
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Type 0x09 - NON_MAC RX Frame Interrupt */
r_case
id|ISB_IMC_NON_MAC_RX_FRAME
suffix:colon
id|tp-&gt;rx_fifo_overrun_count
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;receive_queue_number
op_assign
id|NON_MAC_QUEUE
suffix:semicolon
id|err
op_assign
id|smctr_rx_frame
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Type 0x0A - MAC RX Frame Interrupt */
r_case
id|ISB_IMC_MAC_RX_FRAME
suffix:colon
id|tp-&gt;receive_queue_number
op_assign
id|MAC_QUEUE
suffix:semicolon
id|err
op_assign
id|smctr_rx_frame
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Type 0x0B - TRC status&n;                         * TRC has encountered an error condition&n;                         * subtype bit 14 - transmit FIFO underrun&n;                         * subtype bit 15 - receive FIFO overrun&n;                         */
r_case
id|ISB_IMC_TRC_FIFO_STATUS
suffix:colon
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|TRC_FIFO_STATUS_TX_UNDERRUN
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;ptr_tx_fifo_underruns
)paren
(brace
(paren
op_star
id|tp-&gt;ptr_tx_fifo_underruns
)paren
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|isb_subtype
op_amp
id|TRC_FIFO_STATUS_RX_OVERRUN
)paren
(brace
multiline_comment|/* update overrun stuck receive counter&n;                                         * if &gt;= 3, has to clear it by sending&n;                                         * back to back frames. We pick&n;                                         * DAT(duplicate address MAC frame)&n;                                         */
id|tp-&gt;rx_fifo_overrun_count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;rx_fifo_overrun_count
op_ge
l_int|3
)paren
(brace
id|tp-&gt;rx_fifo_overrun_count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* delay clearing fifo overrun&n;                                                 * imask till send_BUG tx&n;                                                 * complete posted&n;                                                 */
id|interrupt_unmask_bits
op_and_assign
(paren
op_complement
l_int|0x800
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Jay please send bug&bslash;n&quot;
)paren
suffix:semicolon
singleline_comment|//                                              smctr_send_bug(dev);
)brace
r_if
c_cond
(paren
id|tp-&gt;ptr_rx_fifo_overruns
)paren
(brace
(paren
op_star
id|tp-&gt;ptr_rx_fifo_overruns
)paren
op_increment
suffix:semicolon
)brace
)brace
id|err
op_assign
id|SUCCESS
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Type 0x0C - Action Command Status Interrupt&n;                         * Subtype bit 14 - CB end of command chain (CE)&n;                         * Subtype bit 15 - CB command interrupt (CI)&n;                         */
r_case
id|ISB_IMC_COMMAND_STATUS
suffix:colon
id|err
op_assign
id|SUCCESS
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;acb_head-&gt;cmd
op_eq
id|ACB_CMD_HIC_NOP
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i1&bslash;n&quot;
)paren
suffix:semicolon
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* XXXXXXXXXXXXXXXXX */
multiline_comment|/*      err = UM_Interrupt(dev); */
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|tp-&gt;acb_head-&gt;cmd
op_eq
id|ACB_CMD_READ_TRC_STATUS
)paren
op_logical_and
(paren
id|tp-&gt;acb_head-&gt;subcmd
op_eq
id|RW_TRC_STATUS_BLOCK
)paren
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;ptr_bcn_type
op_ne
l_int|0
)paren
(brace
op_star
(paren
id|tp-&gt;ptr_bcn_type
)paren
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|SBlock
op_star
)paren
id|tp-&gt;misc_command_data
)paren
op_member_access_from_pointer
id|BCN_Type
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|SBlock
op_star
)paren
id|tp-&gt;misc_command_data
)paren
op_member_access_from_pointer
id|Status_CHG_Indicate
op_amp
id|ERROR_COUNTERS_CHANGED
)paren
(brace
id|smctr_update_err_stats
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|SBlock
op_star
)paren
id|tp-&gt;misc_command_data
)paren
op_member_access_from_pointer
id|Status_CHG_Indicate
op_amp
id|TI_NDIS_RING_STATUS_CHANGED
)paren
(brace
id|tp-&gt;ring_status
op_assign
(paren
(paren
id|SBlock
op_star
)paren
id|tp-&gt;misc_command_data
)paren
op_member_access_from_pointer
id|TI_NDIS_Ring_Status
suffix:semicolon
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err
op_assign
id|smctr_ring_status_chg
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;ring_status
op_amp
id|REMOVE_RECEIVED
)paren
op_logical_and
(paren
id|tp-&gt;config_word0
op_amp
id|NO_AUTOREMOVE
)paren
)paren
(brace
id|smctr_issue_remove_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
op_ne
id|SUCCESS
)paren
(brace
id|tp-&gt;acb_pending
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|SBlock
op_star
)paren
id|tp-&gt;misc_command_data
)paren
op_member_access_from_pointer
id|Status_CHG_Indicate
op_amp
id|UNA_CHANGED
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;ptr_una
)paren
(brace
id|tp-&gt;ptr_una
(braket
l_int|0
)braket
op_assign
id|SWAP_BYTES
c_func
(paren
(paren
(paren
id|SBlock
op_star
)paren
id|tp-&gt;misc_command_data
)paren
op_member_access_from_pointer
id|UNA
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tp-&gt;ptr_una
(braket
l_int|1
)braket
op_assign
id|SWAP_BYTES
c_func
(paren
(paren
(paren
id|SBlock
op_star
)paren
id|tp-&gt;misc_command_data
)paren
op_member_access_from_pointer
id|UNA
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|tp-&gt;ptr_una
(braket
l_int|2
)braket
op_assign
id|SWAP_BYTES
c_func
(paren
(paren
(paren
id|SBlock
op_star
)paren
id|tp-&gt;misc_command_data
)paren
op_member_access_from_pointer
id|UNA
(braket
l_int|2
)braket
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|SBlock
op_star
)paren
id|tp-&gt;misc_command_data
)paren
op_member_access_from_pointer
id|Status_CHG_Indicate
op_amp
id|READY_TO_SEND_RQ_INIT
)paren
(brace
id|err
op_assign
id|smctr_send_rq_init
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
id|tp-&gt;acb_pending
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Type 0x0D - MAC Type 1 interrupt&n;                         * Subtype -- 00 FR_BCN received at S12&n;                         *            01 FR_BCN received at S21&n;                         *            02 FR_DAT(DA=MA, A&lt;&gt;0) received at S21&n;                         *            03 TSM_EXP at S21&n;                         *            04 FR_REMOVE received at S42&n;                         *            05 TBR_EXP, BR_FLAG_SET at S42&n;                         *            06 TBT_EXP at S53&n;                         */
r_case
id|ISB_IMC_MAC_TYPE_1
suffix:colon
r_if
c_cond
(paren
id|isb_subtype
OG
l_int|8
)paren
(brace
id|err
op_assign
id|HARDWARE_FAILED
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|SUCCESS
suffix:semicolon
r_switch
c_cond
(paren
id|isb_subtype
)paren
(brace
r_case
l_int|0
suffix:colon
id|tp-&gt;join_state
op_assign
id|JS_BYPASS_STATE
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;status
op_ne
id|CLOSED
)paren
(brace
id|tp-&gt;status
op_assign
id|CLOSED
suffix:semicolon
id|err
op_assign
id|smctr_status_chg
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|tp-&gt;join_state
op_assign
id|JS_LOBE_TEST_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|tp-&gt;join_state
op_assign
id|JS_DETECT_MONITOR_PRESENT_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|tp-&gt;join_state
op_assign
id|JS_AWAIT_NEW_MONITOR_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|tp-&gt;join_state
op_assign
id|JS_DUPLICATE_ADDRESS_TEST_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|tp-&gt;join_state
op_assign
id|JS_NEIGHBOR_NOTIFICATION_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|tp-&gt;join_state
op_assign
id|JS_REQUEST_INITIALIZATION_STATE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|tp-&gt;join_state
op_assign
id|JS_JOIN_COMPLETE_STATE
suffix:semicolon
id|tp-&gt;status
op_assign
id|OPEN
suffix:semicolon
id|err
op_assign
id|smctr_status_chg
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|tp-&gt;join_state
op_assign
id|JS_BYPASS_WAIT_STATE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* Type 0x0E - TRC Initialization Sequence Interrupt&n;                         * Subtype -- 00-FF Initializatin sequence complete&n;                         */
r_case
id|ISB_IMC_TRC_INTRNL_TST_STATUS
suffix:colon
id|tp-&gt;status
op_assign
id|INITIALIZED
suffix:semicolon
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err
op_assign
id|smctr_status_chg
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* other interrupt types, illegal */
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Checking the ack code instead of the unmask bits here is because :&n;         * while fixing the stuck receive, DAT frame are sent and mask off&n;         * FIFO overrun interrupt temporarily (interrupt_unmask_bits = 0)&n;         * but we still want to issue ack to ISB&n;         */
r_if
c_cond
(paren
op_logical_neg
(paren
id|interrupt_ack_code
op_amp
l_int|0xff00
)paren
)paren
(brace
id|smctr_issue_int_ack
c_func
(paren
id|dev
comma
id|interrupt_ack_code
comma
id|interrupt_unmask_bits
)paren
suffix:semicolon
)brace
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_enable_bic_int
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|smctr_issue_enable_int_cmd
r_static
r_int
id|smctr_issue_enable_int_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|interrupt_enable_mask
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|tp-&gt;sclb_ptr-&gt;int_mask_control
op_assign
id|interrupt_enable_mask
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;valid_command
op_assign
id|SCLB_VALID
op_or
id|SCLB_CMD_CLEAR_INTERRUPT_MASK
suffix:semicolon
id|smctr_set_ctrl_attention
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_int_ack
r_static
r_int
id|smctr_issue_int_ack
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|iack_code
comma
id|__u16
id|ibits
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|tp-&gt;sclb_ptr-&gt;int_mask_control
op_assign
id|ibits
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;iack_code
op_assign
id|iack_code
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* use the offset from base */
id|tp-&gt;sclb_ptr-&gt;resume_control
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;valid_command
op_assign
id|SCLB_VALID
op_or
id|SCLB_IACK_CODE_VALID
op_or
id|SCLB_CMD_CLEAR_INTERRUPT_MASK
suffix:semicolon
id|smctr_set_ctrl_attention
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_init_timers_cmd
r_static
r_int
id|smctr_issue_init_timers_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
id|__u16
op_star
id|pTimer_Struc
op_assign
(paren
id|__u16
op_star
)paren
id|tp-&gt;misc_command_data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|tp-&gt;config_word0
op_assign
id|THDREN
op_or
id|DMA_TRIGGER
op_or
id|USETPT
op_or
id|NO_AUTOREMOVE
suffix:semicolon
id|tp-&gt;config_word1
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;media_type
op_eq
id|MEDIA_STP_16
)paren
op_logical_or
(paren
id|tp-&gt;media_type
op_eq
id|MEDIA_UTP_16
)paren
op_logical_or
(paren
id|tp-&gt;media_type
op_eq
id|MEDIA_STP_16_UTP_16
)paren
)paren
(brace
id|tp-&gt;config_word0
op_or_assign
id|FREQ_16MB_BIT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;mode_bits
op_amp
id|EARLY_TOKEN_REL
)paren
(brace
id|tp-&gt;config_word0
op_or_assign
id|ETREN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;mode_bits
op_amp
id|LOOPING_MODE_MASK
)paren
(brace
id|tp-&gt;config_word0
op_or_assign
id|RX_OWN_BIT
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word0
op_and_assign
op_complement
id|RX_OWN_BIT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|PROMISCUOUS_MODE
)paren
(brace
id|tp-&gt;config_word0
op_or_assign
id|PROMISCUOUS_BIT
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word0
op_and_assign
op_complement
id|PROMISCUOUS_BIT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_ERR_PACKETS
)paren
(brace
id|tp-&gt;config_word0
op_or_assign
id|SAVBAD_BIT
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word0
op_and_assign
op_complement
id|SAVBAD_BIT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_ATT_MAC_FRAMES
)paren
(brace
id|tp-&gt;config_word0
op_or_assign
id|RXATMAC
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word0
op_and_assign
op_complement
id|RXATMAC
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_MULTI_PROM
)paren
(brace
id|tp-&gt;config_word1
op_or_assign
id|MULTICAST_ADDRESS_BIT
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word1
op_and_assign
op_complement
id|MULTICAST_ADDRESS_BIT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_SOURCE_ROUTING_SPANNING
)paren
(brace
id|tp-&gt;config_word1
op_or_assign
id|SOURCE_ROUTING_SPANNING_BITS
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_SOURCE_ROUTING
)paren
(brace
id|tp-&gt;config_word1
op_or_assign
id|SOURCE_ROUTING_EXPLORER_BIT
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word1
op_and_assign
op_complement
id|SOURCE_ROUTING_SPANNING_BITS
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tp-&gt;media_type
op_eq
id|MEDIA_STP_16
)paren
op_logical_or
(paren
id|tp-&gt;media_type
op_eq
id|MEDIA_UTP_16
)paren
op_logical_or
(paren
id|tp-&gt;media_type
op_eq
id|MEDIA_STP_16_UTP_16
)paren
)paren
(brace
id|tp-&gt;config_word1
op_or_assign
id|INTERFRAME_SPACING_16
suffix:semicolon
)brace
r_else
id|tp-&gt;config_word1
op_or_assign
id|INTERFRAME_SPACING_4
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;config_word0
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;config_word1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;media_type
op_eq
id|MEDIA_STP_4
)paren
op_logical_or
(paren
id|tp-&gt;media_type
op_eq
id|MEDIA_UTP_4
)paren
op_logical_or
(paren
id|tp-&gt;media_type
op_eq
id|MEDIA_STP_4_UTP_4
)paren
)paren
(brace
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x00FA
suffix:semicolon
multiline_comment|/* prescale */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x2710
suffix:semicolon
multiline_comment|/* TPT_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x2710
suffix:semicolon
multiline_comment|/* TQP_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x0A28
suffix:semicolon
multiline_comment|/* TNT_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x3E80
suffix:semicolon
multiline_comment|/* TBT_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x3A98
suffix:semicolon
multiline_comment|/* TSM_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x1B58
suffix:semicolon
multiline_comment|/* TAM_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x00C8
suffix:semicolon
multiline_comment|/* TBR_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x07D0
suffix:semicolon
multiline_comment|/* TER_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x000A
suffix:semicolon
multiline_comment|/* TGT_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x1162
suffix:semicolon
multiline_comment|/* THT_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x07D0
suffix:semicolon
multiline_comment|/* TRR_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x1388
suffix:semicolon
multiline_comment|/* TVX_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x0000
suffix:semicolon
multiline_comment|/* reserved */
)brace
r_else
(brace
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x03E8
suffix:semicolon
multiline_comment|/* prescale */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x9C40
suffix:semicolon
multiline_comment|/* TPT_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x9C40
suffix:semicolon
multiline_comment|/* TQP_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x0A28
suffix:semicolon
multiline_comment|/* TNT_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x3E80
suffix:semicolon
multiline_comment|/* TBT_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x3A98
suffix:semicolon
multiline_comment|/* TSM_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x1B58
suffix:semicolon
multiline_comment|/* TAM_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x00C8
suffix:semicolon
multiline_comment|/* TBR_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x07D0
suffix:semicolon
multiline_comment|/* TER_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x000A
suffix:semicolon
multiline_comment|/* TGT_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x4588
suffix:semicolon
multiline_comment|/* THT_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x1F40
suffix:semicolon
multiline_comment|/* TRR_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x4E20
suffix:semicolon
multiline_comment|/* TVX_limit */
op_star
id|pTimer_Struc
op_increment
op_assign
l_int|0x0000
suffix:semicolon
multiline_comment|/* reserved */
)brace
multiline_comment|/* Set node address. */
op_star
id|pTimer_Struc
op_increment
op_assign
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
(paren
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_amp
l_int|0xFF
)paren
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_lshift
l_int|8
op_or
(paren
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_amp
l_int|0xFF
)paren
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_lshift
l_int|8
op_or
(paren
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
op_amp
l_int|0xFF
)paren
suffix:semicolon
multiline_comment|/* Set group address. */
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;group_address_0
op_lshift
l_int|8
op_or
id|tp-&gt;group_address_0
op_rshift
l_int|8
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;group_address
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|tp-&gt;group_address
(braket
l_int|0
)braket
op_rshift
l_int|8
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;group_address
(braket
l_int|1
)braket
op_lshift
l_int|8
op_or
id|tp-&gt;group_address
(braket
l_int|1
)braket
op_rshift
l_int|8
suffix:semicolon
multiline_comment|/* Set functional address. */
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;functional_address_0
op_lshift
l_int|8
op_or
id|tp-&gt;functional_address_0
op_rshift
l_int|8
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;functional_address
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|tp-&gt;functional_address
(braket
l_int|0
)braket
op_rshift
l_int|8
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;functional_address
(braket
l_int|1
)braket
op_lshift
l_int|8
op_or
id|tp-&gt;functional_address
(braket
l_int|1
)braket
op_rshift
l_int|8
suffix:semicolon
multiline_comment|/* Set Bit-Wise group address. */
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;bitwise_group_address
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|tp-&gt;bitwise_group_address
(braket
l_int|0
)braket
op_rshift
l_int|8
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;bitwise_group_address
(braket
l_int|1
)braket
op_lshift
l_int|8
op_or
id|tp-&gt;bitwise_group_address
(braket
l_int|1
)braket
op_rshift
l_int|8
suffix:semicolon
multiline_comment|/* Set ring number address. */
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;source_ring_number
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
id|tp-&gt;target_ring_number
suffix:semicolon
multiline_comment|/* Physical drop number. */
op_star
id|pTimer_Struc
op_increment
op_assign
(paren
r_int
r_int
)paren
l_int|0
suffix:semicolon
op_star
id|pTimer_Struc
op_increment
op_assign
(paren
r_int
r_int
)paren
l_int|0
suffix:semicolon
multiline_comment|/* Product instance ID. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|pTimer_Struc
op_increment
op_assign
(paren
r_int
r_int
)paren
l_int|0
suffix:semicolon
)brace
id|err
op_assign
id|smctr_setup_single_cmd_w_data
c_func
(paren
id|dev
comma
id|ACB_CMD_INIT_TRC_TIMERS
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_init_txrx_cmd
r_static
r_int
id|smctr_issue_init_txrx_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
r_void
op_star
op_star
id|txrx_ptrs
op_assign
(paren
r_void
op_star
)paren
id|tp-&gt;misc_command_data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize Transmit Queue Pointers that are used, to point to&n;         * a single FCB.&n;         */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_QS_USED
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|txrx_ptrs
op_increment
op_assign
(paren
r_void
op_star
)paren
id|TRC_POINTER
c_func
(paren
id|tp-&gt;tx_fcb_head
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize Transmit Queue Pointers that are NOT used to ZERO. */
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|MAX_TX_QS
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|txrx_ptrs
op_increment
op_assign
(paren
r_void
op_star
)paren
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Initialize Receive Queue Pointers (MAC and Non-MAC) that are&n;         * used, to point to a single FCB and a BDB chain of buffers.&n;         */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_QS_USED
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|txrx_ptrs
op_increment
op_assign
(paren
r_void
op_star
)paren
id|TRC_POINTER
c_func
(paren
id|tp-&gt;rx_fcb_head
(braket
id|i
)braket
)paren
suffix:semicolon
op_star
id|txrx_ptrs
op_increment
op_assign
(paren
r_void
op_star
)paren
id|TRC_POINTER
c_func
(paren
id|tp-&gt;rx_bdb_head
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize Receive Queue Pointers that are NOT used to ZERO. */
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|MAX_RX_QS
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|txrx_ptrs
op_increment
op_assign
(paren
r_void
op_star
)paren
l_int|0
suffix:semicolon
op_star
id|txrx_ptrs
op_increment
op_assign
(paren
r_void
op_star
)paren
l_int|0
suffix:semicolon
)brace
id|err
op_assign
id|smctr_setup_single_cmd_w_data
c_func
(paren
id|dev
comma
id|ACB_CMD_INIT_TX_RX
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_insert_cmd
r_static
r_int
id|smctr_issue_insert_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|smctr_setup_single_cmd
c_func
(paren
id|dev
comma
id|ACB_CMD_INSERT
comma
id|ACB_SUB_CMD_NOP
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_read_ring_status_cmd
r_static
r_int
id|smctr_issue_read_ring_status_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|err
op_assign
id|smctr_setup_single_cmd_w_data
c_func
(paren
id|dev
comma
id|ACB_CMD_READ_TRC_STATUS
comma
id|RW_TRC_STATUS_BLOCK
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_read_word_cmd
r_static
r_int
id|smctr_issue_read_word_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|aword_cnt
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|err
op_assign
id|smctr_setup_single_cmd_w_data
c_func
(paren
id|dev
comma
id|ACB_CMD_MCT_READ_VALUE
comma
id|aword_cnt
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_remove_cmd
r_static
r_int
id|smctr_issue_remove_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|tp-&gt;sclb_ptr-&gt;resume_control
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;valid_command
op_assign
id|SCLB_VALID
op_or
id|SCLB_CMD_REMOVE
suffix:semicolon
id|smctr_set_ctrl_attention
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_resume_acb_cmd
r_static
r_int
id|smctr_issue_resume_acb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|tp-&gt;sclb_ptr-&gt;resume_control
op_assign
id|SCLB_RC_ACB
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;valid_command
op_assign
id|SCLB_VALID
op_or
id|SCLB_RESUME_CONTROL_VALID
suffix:semicolon
id|tp-&gt;acb_pending
op_assign
l_int|1
suffix:semicolon
id|smctr_set_ctrl_attention
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_resume_rx_bdb_cmd
r_static
r_int
id|smctr_issue_resume_rx_bdb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|queue
op_eq
id|MAC_QUEUE
)paren
(brace
id|tp-&gt;sclb_ptr-&gt;resume_control
op_assign
id|SCLB_RC_RX_MAC_BDB
suffix:semicolon
)brace
r_else
id|tp-&gt;sclb_ptr-&gt;resume_control
op_assign
id|SCLB_RC_RX_NON_MAC_BDB
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;valid_command
op_assign
id|SCLB_VALID
op_or
id|SCLB_RESUME_CONTROL_VALID
suffix:semicolon
id|smctr_set_ctrl_attention
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_resume_rx_fcb_cmd
r_static
r_int
id|smctr_issue_resume_rx_fcb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_issue_resume_rx_fcb_cmd&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|queue
op_eq
id|MAC_QUEUE
)paren
(brace
id|tp-&gt;sclb_ptr-&gt;resume_control
op_assign
id|SCLB_RC_RX_MAC_FCB
suffix:semicolon
)brace
r_else
id|tp-&gt;sclb_ptr-&gt;resume_control
op_assign
id|SCLB_RC_RX_NON_MAC_FCB
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;valid_command
op_assign
id|SCLB_VALID
op_or
id|SCLB_RESUME_CONTROL_VALID
suffix:semicolon
id|smctr_set_ctrl_attention
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_resume_tx_fcb_cmd
r_static
r_int
id|smctr_issue_resume_tx_fcb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_issue_resume_tx_fcb_cmd&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|tp-&gt;sclb_ptr-&gt;resume_control
op_assign
(paren
id|SCLB_RC_TFCB0
op_lshift
id|queue
)paren
suffix:semicolon
id|tp-&gt;sclb_ptr-&gt;valid_command
op_assign
id|SCLB_RESUME_CONTROL_VALID
op_or
id|SCLB_VALID
suffix:semicolon
id|smctr_set_ctrl_attention
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_test_internal_rom_cmd
r_static
r_int
id|smctr_issue_test_internal_rom_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|smctr_setup_single_cmd
c_func
(paren
id|dev
comma
id|ACB_CMD_MCT_TEST
comma
id|TRC_INTERNAL_ROM_TEST
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_test_hic_cmd
r_static
r_int
id|smctr_issue_test_hic_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|smctr_setup_single_cmd
c_func
(paren
id|dev
comma
id|ACB_CMD_HIC_TEST
comma
id|TRC_HOST_INTERFACE_REG_TEST
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_test_mac_reg_cmd
r_static
r_int
id|smctr_issue_test_mac_reg_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|smctr_setup_single_cmd
c_func
(paren
id|dev
comma
id|ACB_CMD_MCT_TEST
comma
id|TRC_MAC_REGISTERS_TEST
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_trc_loopback_cmd
r_static
r_int
id|smctr_issue_trc_loopback_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|smctr_setup_single_cmd
c_func
(paren
id|dev
comma
id|ACB_CMD_MCT_TEST
comma
id|TRC_INTERNAL_LOOPBACK
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_tri_loopback_cmd
r_static
r_int
id|smctr_issue_tri_loopback_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|smctr_setup_single_cmd
c_func
(paren
id|dev
comma
id|ACB_CMD_MCT_TEST
comma
id|TRC_TRI_LOOPBACK
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_write_byte_cmd
r_static
r_int
id|smctr_issue_write_byte_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|aword_cnt
comma
r_void
op_star
id|byte
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|iword
comma
id|ibyte
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|iword
op_assign
l_int|0
comma
id|ibyte
op_assign
l_int|0
suffix:semicolon
id|iword
OL
(paren
r_int
r_int
)paren
(paren
id|aword_cnt
op_amp
l_int|0xff
)paren
suffix:semicolon
id|iword
op_increment
comma
id|ibyte
op_add_assign
l_int|2
)paren
(brace
id|tp-&gt;misc_command_data
(braket
id|iword
)braket
op_assign
(paren
op_star
(paren
(paren
id|__u8
op_star
)paren
id|byte
op_plus
id|ibyte
)paren
op_lshift
l_int|8
)paren
op_or
(paren
op_star
(paren
(paren
id|__u8
op_star
)paren
id|byte
op_plus
id|ibyte
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_return
(paren
id|smctr_setup_single_cmd_w_data
c_func
(paren
id|dev
comma
id|ACB_CMD_MCT_WRITE_VALUE
comma
id|aword_cnt
)paren
)paren
suffix:semicolon
)brace
DECL|function|smctr_issue_write_word_cmd
r_static
r_int
id|smctr_issue_write_word_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|aword_cnt
comma
r_void
op_star
id|word
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_int
r_int
)paren
(paren
id|aword_cnt
op_amp
l_int|0xff
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;misc_command_data
(braket
id|i
)braket
op_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
id|word
op_plus
id|i
)paren
suffix:semicolon
)brace
id|err
op_assign
id|smctr_setup_single_cmd_w_data
c_func
(paren
id|dev
comma
id|ACB_CMD_MCT_WRITE_VALUE
comma
id|aword_cnt
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_join_complete_state
r_static
r_int
id|smctr_join_complete_state
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|smctr_setup_single_cmd
c_func
(paren
id|dev
comma
id|ACB_CMD_CHANGE_JOIN_STATE
comma
id|JS_JOIN_COMPLETE_STATE
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_link_tx_fcbs_to_bdbs
r_static
r_int
id|smctr_link_tx_fcbs_to_bdbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
comma
id|j
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
id|BDBlock
op_star
id|bdb
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_QS_USED
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fcb
op_assign
id|tp-&gt;tx_fcb_head
(braket
id|i
)braket
suffix:semicolon
id|bdb
op_assign
id|tp-&gt;tx_bdb_head
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|tp-&gt;num_tx_fcbs
(braket
id|i
)braket
suffix:semicolon
id|j
op_increment
)paren
(brace
id|fcb-&gt;bdb_ptr
op_assign
id|bdb
suffix:semicolon
id|fcb-&gt;trc_bdb_ptr
op_assign
id|TRC_POINTER
c_func
(paren
id|bdb
)paren
suffix:semicolon
id|fcb
op_assign
(paren
id|FCBlock
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|fcb
op_plus
r_sizeof
(paren
id|FCBlock
)paren
)paren
suffix:semicolon
id|bdb
op_assign
(paren
id|BDBlock
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|bdb
op_plus
r_sizeof
(paren
id|BDBlock
)paren
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_load_firmware
r_static
r_int
id|smctr_load_firmware
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u16
id|i
comma
id|checksum
op_assign
l_int|0
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_load_firmware&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|tp-&gt;ptr_ucode
op_assign
id|smctr_code
suffix:semicolon
id|tp-&gt;num_of_tx_buffs
op_assign
l_int|4
suffix:semicolon
id|tp-&gt;mode_bits
op_or_assign
id|UMAC
suffix:semicolon
id|tp-&gt;receive_mask
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;max_packet_size
op_assign
l_int|4177
suffix:semicolon
multiline_comment|/* Can only upload the firmware once per adapter reset. */
r_if
c_cond
(paren
id|tp-&gt;microcode_version
op_ne
l_int|0
)paren
(brace
r_return
(paren
id|UCODE_PRESENT
)paren
suffix:semicolon
)brace
multiline_comment|/* Verify the firmware exists and is there in the right amount. */
r_if
c_cond
(paren
(paren
id|tp-&gt;ptr_ucode
op_eq
l_int|0L
)paren
op_logical_or
(paren
op_star
(paren
id|tp-&gt;ptr_ucode
op_plus
id|UCODE_VERSION_OFFSET
)paren
OL
id|UCODE_VERSION
)paren
)paren
(brace
r_return
(paren
id|UCODE_NOT_PRESENT
)paren
suffix:semicolon
)brace
multiline_comment|/* UCODE_SIZE is not included in Checksum. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ptr_ucode
op_plus
id|UCODE_SIZE_OFFSET
)paren
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|checksum
op_add_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ptr_ucode
op_plus
l_int|2
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|checksum
)paren
(brace
r_return
(paren
id|UCODE_NOT_PRESENT
)paren
suffix:semicolon
)brace
multiline_comment|/* At this point we have a valid firmware image, lets kick it on up. */
id|smctr_enable_adapter_ram
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
id|tp-&gt;ram_access
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|smctr_checksum_firmware
c_func
(paren
id|dev
)paren
)paren
op_logical_or
(paren
op_star
(paren
id|tp-&gt;ptr_ucode
op_plus
id|UCODE_VERSION_OFFSET
)paren
OG
id|tp-&gt;microcode_version
)paren
)paren
(brace
id|smctr_enable_adapter_ctrl_store
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Zero out ram space for firmware. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CS_RAM_SIZE
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|i
)paren
)paren
op_assign
l_int|0
suffix:semicolon
)brace
id|smctr_decode_firmware
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;microcode_version
op_assign
op_star
(paren
id|tp-&gt;ptr_ucode
op_plus
id|UCODE_VERSION_OFFSET
)paren
suffix:semicolon
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|CS_RAM_VERSION_OFFSET
)paren
)paren
op_assign
(paren
id|tp-&gt;microcode_version
op_lshift
l_int|8
)paren
suffix:semicolon
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|CS_RAM_CHECKSUM_OFFSET
)paren
)paren
op_assign
op_complement
(paren
id|tp-&gt;microcode_version
op_lshift
l_int|8
)paren
op_plus
l_int|1
suffix:semicolon
id|smctr_disable_adapter_ctrl_store
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smctr_checksum_firmware
c_func
(paren
id|dev
)paren
)paren
(brace
id|err
op_assign
id|HARDWARE_FAILED
suffix:semicolon
)brace
)brace
r_else
id|err
op_assign
id|UCODE_PRESENT
suffix:semicolon
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_load_node_addr
r_static
r_int
id|smctr_load_node_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|__u8
id|r
suffix:semicolon
multiline_comment|/* Check if node address has been specified by user. (non-0) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
(paren
id|i
OL
l_int|6
)paren
op_logical_and
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_eq
l_int|0
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
suffix:semicolon
)brace
(brace
r_if
c_cond
(paren
id|i
op_ne
l_int|6
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|LAR0
op_plus
id|i
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
(paren
r_char
)paren
id|r
suffix:semicolon
)brace
id|dev-&gt;addr_len
op_assign
l_int|6
suffix:semicolon
)brace
r_else
multiline_comment|/* Node addr. not given by user, read it from board. */
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|LAR0
op_plus
id|i
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
(paren
r_char
)paren
id|r
suffix:semicolon
)brace
id|dev-&gt;addr_len
op_assign
l_int|6
suffix:semicolon
)brace
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Lobe Media Test.&n; * During the transmission of the initial 1500 lobe media MAC frames,&n; * the phase lock loop in the 805 chip may lock, and then un-lock, causing&n; * the 825 to go into a PURGE state. When performing a PURGE, the MCT&n; * microcode will not transmit any frames given to it by the host, and&n; * will consequently cause a timeout.&n; *&n; * NOTE 1: If the monitor_state is MS_BEACON_TEST_STATE, all transmit&n; * queues other then the one used for the lobe_media_test should be&n; * disabled.!?&n; *&n; * NOTE 2: If the monitor_state is MS_BEACON_TEST_STATE and the receive_mask&n; * has any multi-cast or promiscous bits set, the receive_mask needs to&n; * be changed to clear the multi-cast or promiscous mode bits, the lobe_test&n; * run, and then the receive mask set back to its original value if the test&n; * is successful.&n; */
DECL|function|smctr_lobe_media_test
r_static
r_int
id|smctr_lobe_media_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
comma
id|perror
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|saved_rcv_mask
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_lobe_media_test&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear receive mask for lobe test. */
id|saved_rcv_mask
op_assign
id|tp-&gt;receive_mask
suffix:semicolon
id|tp-&gt;receive_mask
op_assign
l_int|0
suffix:semicolon
id|smctr_chg_rx_mask
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Setup the lobe media test. */
id|smctr_lobe_media_test_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
(brace
id|smctr_reset_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;status
op_assign
id|CLOSED
suffix:semicolon
r_return
(paren
id|LOBE_MEDIA_TEST_FAILED
)paren
suffix:semicolon
)brace
multiline_comment|/* Tx lobe media test frames. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1500
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|smctr_send_lobe_media_test
c_func
(paren
id|dev
)paren
)paren
(brace
r_if
c_cond
(paren
id|perror
)paren
(brace
id|smctr_reset_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;state
op_assign
id|CLOSED
suffix:semicolon
r_return
(paren
id|LOBE_MEDIA_TEST_FAILED
)paren
suffix:semicolon
)brace
r_else
(brace
id|perror
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|smctr_lobe_media_test_cmd
c_func
(paren
id|dev
)paren
)paren
(brace
id|smctr_reset_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;state
op_assign
id|CLOSED
suffix:semicolon
r_return
(paren
id|LOBE_MEDIA_TEST_FAILED
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|smctr_send_dat
c_func
(paren
id|dev
)paren
)paren
(brace
r_if
c_cond
(paren
id|smctr_send_dat
c_func
(paren
id|dev
)paren
)paren
(brace
id|smctr_reset_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;state
op_assign
id|CLOSED
suffix:semicolon
r_return
(paren
id|LOBE_MEDIA_TEST_FAILED
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Check if any frames received during test. */
r_if
c_cond
(paren
(paren
id|tp-&gt;rx_fcb_curr
(braket
id|MAC_QUEUE
)braket
op_member_access_from_pointer
id|frame_status
)paren
op_logical_or
(paren
id|tp-&gt;rx_fcb_curr
(braket
id|NON_MAC_QUEUE
)braket
op_member_access_from_pointer
id|frame_status
)paren
)paren
(brace
id|smctr_reset_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;state
op_assign
id|CLOSED
suffix:semicolon
r_return
(paren
id|LOBE_MEDIA_TEST_FAILED
)paren
suffix:semicolon
)brace
multiline_comment|/* Set receive mask to &quot;Promisc&quot; mode. */
id|tp-&gt;receive_mask
op_assign
id|saved_rcv_mask
suffix:semicolon
id|smctr_chg_rx_mask
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_lobe_media_test_cmd
r_static
r_int
id|smctr_lobe_media_test_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_lobe_media_test_cmd&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/* Change to lobe media test state. */
r_if
c_cond
(paren
id|tp-&gt;monitor_state
op_ne
id|MS_BEACON_TEST_STATE
)paren
(brace
id|smctr_lobe_media_test_state
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Lobe Failed test state&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
id|LOBE_MEDIA_TEST_FAILED
)paren
suffix:semicolon
)brace
)brace
id|err
op_assign
id|smctr_setup_single_cmd
c_func
(paren
id|dev
comma
id|ACB_CMD_MCT_TEST
comma
id|TRC_LOBE_MEDIA_TEST
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_lobe_media_test_state
r_static
r_int
id|smctr_lobe_media_test_state
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|smctr_setup_single_cmd
c_func
(paren
id|dev
comma
id|ACB_CMD_CHANGE_JOIN_STATE
comma
id|JS_LOBE_TEST_STATE
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_8025_hdr
r_static
r_int
id|smctr_make_8025_hdr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|MAC_HEADER
op_star
id|tmf
comma
id|__u16
id|ac_fc
)paren
(brace
id|tmf-&gt;ac
op_assign
id|MSB
c_func
(paren
id|ac_fc
)paren
suffix:semicolon
multiline_comment|/* msb is access control */
id|tmf-&gt;fc
op_assign
id|LSB
c_func
(paren
id|ac_fc
)paren
suffix:semicolon
multiline_comment|/* lsb is frame control */
id|tmf-&gt;sa
(braket
l_int|0
)braket
op_assign
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
suffix:semicolon
id|tmf-&gt;sa
(braket
l_int|1
)braket
op_assign
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
suffix:semicolon
id|tmf-&gt;sa
(braket
l_int|2
)braket
op_assign
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
suffix:semicolon
id|tmf-&gt;sa
(braket
l_int|3
)braket
op_assign
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
suffix:semicolon
id|tmf-&gt;sa
(braket
l_int|4
)braket
op_assign
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
suffix:semicolon
id|tmf-&gt;sa
(braket
l_int|5
)braket
op_assign
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|tmf-&gt;vc
)paren
(brace
multiline_comment|/* Send RQ_INIT to RPS */
r_case
id|RQ_INIT
suffix:colon
id|tmf-&gt;da
(braket
l_int|0
)braket
op_assign
l_int|0xc0
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|2
)braket
op_assign
l_int|0x00
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|3
)braket
op_assign
l_int|0x00
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|4
)braket
op_assign
l_int|0x00
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|5
)braket
op_assign
l_int|0x02
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Send RPT_TX_FORWARD to CRS */
r_case
id|RPT_TX_FORWARD
suffix:colon
id|tmf-&gt;da
(braket
l_int|0
)braket
op_assign
l_int|0xc0
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|2
)braket
op_assign
l_int|0x00
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|3
)braket
op_assign
l_int|0x00
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|4
)braket
op_assign
l_int|0x00
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|5
)braket
op_assign
l_int|0x10
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Everything else goes to sender */
r_default
suffix:colon
id|tmf-&gt;da
(braket
l_int|0
)braket
op_assign
id|rmf-&gt;sa
(braket
l_int|0
)braket
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|1
)braket
op_assign
id|rmf-&gt;sa
(braket
l_int|1
)braket
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|2
)braket
op_assign
id|rmf-&gt;sa
(braket
l_int|2
)braket
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|3
)braket
op_assign
id|rmf-&gt;sa
(braket
l_int|3
)braket
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|4
)braket
op_assign
id|rmf-&gt;sa
(braket
l_int|4
)braket
suffix:semicolon
id|tmf-&gt;da
(braket
l_int|5
)braket
op_assign
id|rmf-&gt;sa
(braket
l_int|5
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_access_pri
r_static
r_int
id|smctr_make_access_pri
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|tsv-&gt;svi
op_assign
id|AUTHORIZED_ACCESS_PRIORITY
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_AUTHORIZED_ACCESS_PRIORITY
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;authorized_access_priority
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;authorized_access_priority
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_addr_mod
r_static
r_int
id|smctr_make_addr_mod
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
id|tsv-&gt;svi
op_assign
id|ADDRESS_MODIFER
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_ADDRESS_MODIFER
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_auth_funct_class
r_static
r_int
id|smctr_make_auth_funct_class
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|tsv-&gt;svi
op_assign
id|AUTHORIZED_FUNCTION_CLASS
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_AUTHORIZED_FUNCTION_CLASS
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;authorized_function_classes
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;authorized_function_classes
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_corr
r_static
r_int
id|smctr_make_corr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
comma
id|__u16
id|correlator
)paren
(brace
id|tsv-&gt;svi
op_assign
id|CORRELATOR
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_CORRELATOR
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
id|MSB
c_func
(paren
id|correlator
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
id|LSB
c_func
(paren
id|correlator
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_funct_addr
r_static
r_int
id|smctr_make_funct_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|smctr_get_functional_address
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tsv-&gt;svi
op_assign
id|FUNCTIONAL_ADDRESS
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_FUNCTIONAL_ADDRESS
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|2
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|3
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_group_addr
r_static
r_int
id|smctr_make_group_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|smctr_get_group_address
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tsv-&gt;svi
op_assign
id|GROUP_ADDRESS
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_GROUP_ADDRESS
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|2
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|3
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* Set Group Address Sub-vector to all zeros if only the&n;         * Group Address/Functional Address Indicator is set.&n;         */
r_if
c_cond
(paren
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_eq
l_int|0x80
op_logical_and
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_eq
l_int|0x00
op_logical_and
id|tsv-&gt;svv
(braket
l_int|2
)braket
op_eq
l_int|0x00
op_logical_and
id|tsv-&gt;svv
(braket
l_int|3
)braket
op_eq
l_int|0x00
)paren
(brace
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
l_int|0x00
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_phy_drop_num
r_static
r_int
id|smctr_make_phy_drop_num
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|smctr_get_physical_drop_number
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tsv-&gt;svi
op_assign
id|PHYSICAL_DROP
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_PHYSICAL_DROP
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|2
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|3
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_product_id
r_static
r_int
id|smctr_make_product_id
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
r_int
id|i
suffix:semicolon
id|tsv-&gt;svi
op_assign
id|PRODUCT_INSTANCE_ID
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_PRODUCT_INSTANCE_ID
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|18
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tsv-&gt;svv
(braket
id|i
)braket
op_assign
l_int|0xF0
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_station_id
r_static
r_int
id|smctr_make_station_id
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|smctr_get_station_id
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tsv-&gt;svi
op_assign
id|STATION_IDENTIFER
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_STATION_IDENTIFER
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|2
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|3
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|4
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|5
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_ring_station_status
r_static
r_int
id|smctr_make_ring_station_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
id|tsv-&gt;svi
op_assign
id|RING_STATION_STATUS
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_RING_STATION_STATUS
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_ring_station_version
r_static
r_int
id|smctr_make_ring_station_version
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|tsv-&gt;svi
op_assign
id|RING_STATION_VERSION_NUMBER
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_RING_STATION_VERSION_NUMBER
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
l_int|0xe2
suffix:semicolon
multiline_comment|/* EBCDIC - S */
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
l_int|0xd4
suffix:semicolon
multiline_comment|/* EBCDIC - M */
id|tsv-&gt;svv
(braket
l_int|2
)braket
op_assign
l_int|0xc3
suffix:semicolon
multiline_comment|/* EBCDIC - C */
id|tsv-&gt;svv
(braket
l_int|3
)braket
op_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* EBCDIC -   */
id|tsv-&gt;svv
(braket
l_int|4
)braket
op_assign
l_int|0xe5
suffix:semicolon
multiline_comment|/* EBCDIC - V */
id|tsv-&gt;svv
(braket
l_int|5
)braket
op_assign
l_int|0xF0
op_plus
(paren
id|tp-&gt;microcode_version
op_rshift
l_int|4
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|6
)braket
op_assign
l_int|0xF0
op_plus
(paren
id|tp-&gt;microcode_version
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|7
)braket
op_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* EBCDIC -   */
id|tsv-&gt;svv
(braket
l_int|8
)braket
op_assign
l_int|0xe7
suffix:semicolon
multiline_comment|/* EBCDIC - X */
r_if
c_cond
(paren
id|tp-&gt;extra_info
op_amp
id|CHIP_REV_MASK
)paren
(brace
id|tsv-&gt;svv
(braket
l_int|9
)braket
op_assign
l_int|0xc5
suffix:semicolon
)brace
multiline_comment|/* EBCDIC - E */
r_else
id|tsv-&gt;svv
(braket
l_int|9
)braket
op_assign
l_int|0xc4
suffix:semicolon
multiline_comment|/* EBCDIC - D */
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_tx_status_code
r_static
r_int
id|smctr_make_tx_status_code
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
comma
id|__u16
id|tx_fstatus
)paren
(brace
id|tsv-&gt;svi
op_assign
id|TRANSMIT_STATUS_CODE
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_TRANSMIT_STATUS_CODE
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|tx_fstatus
op_amp
l_int|0x0100
op_rshift
l_int|6
)paren
op_logical_or
id|IBM_PASS_SOURCE_ADDR
)paren
suffix:semicolon
multiline_comment|/* Stripped frame status of Transmitted Frame */
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
id|tx_fstatus
op_amp
l_int|0xff
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_upstream_neighbor_addr
r_static
r_int
id|smctr_make_upstream_neighbor_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|smctr_get_upstream_neighbor_addr
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tsv-&gt;svi
op_assign
id|UPSTREAM_NEIGHBOR_ADDRESS
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_UPSTREAM_NEIGHBOR_ADDRESS
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|0
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|1
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|2
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|3
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|4
)braket
op_assign
id|MSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|tsv-&gt;svv
(braket
l_int|5
)braket
op_assign
id|LSB
c_func
(paren
id|tp-&gt;misc_command_data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_make_wrap_data
r_static
r_int
id|smctr_make_wrap_data
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|tsv
)paren
(brace
id|tsv-&gt;svi
op_assign
id|WRAP_DATA
suffix:semicolon
id|tsv-&gt;svl
op_assign
id|S_WRAP_DATA
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Open/initialize the board. This is called sometime after&n; * booting when the &squot;ifconfig&squot; program is run.&n; *&n; * This routine should set everything up anew at each open, even&n; * registers that &quot;should&quot; only need to be set once at boot, so that&n; * there is non-reboot way to recover if something goes wrong.&n; */
DECL|function|smctr_open
r_static
r_int
id|smctr_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_open&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|tp-&gt;status
op_assign
id|NOT_INITIALIZED
suffix:semicolon
id|err
op_assign
id|smctr_load_firmware
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|err
op_assign
id|smctr_init_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|MOD_INC_USE_COUNT
suffix:semicolon
macro_line|#endif
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* Interrupt driven open of Token card. */
DECL|function|smctr_open_tr
r_static
r_int
id|smctr_open_tr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_open_tr&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/* Now we can actually open the adapter. */
r_if
c_cond
(paren
id|tp-&gt;status
op_eq
id|OPEN
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;status
op_ne
id|INITIALIZED
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
id|tp-&gt;ram_access
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_resume_rx_fcb_cmd
c_func
(paren
id|dev
comma
(paren
r_int
)paren
id|MAC_QUEUE
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_resume_rx_bdb_cmd
c_func
(paren
id|dev
comma
(paren
r_int
)paren
id|MAC_QUEUE
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_resume_rx_fcb_cmd
c_func
(paren
id|dev
comma
(paren
r_int
)paren
id|NON_MAC_QUEUE
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_resume_rx_bdb_cmd
c_func
(paren
id|dev
comma
(paren
r_int
)paren
id|NON_MAC_QUEUE
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|tp-&gt;status
op_assign
id|CLOSED
suffix:semicolon
multiline_comment|/* Insert into the Ring or Enter Loopback Mode. */
r_if
c_cond
(paren
(paren
id|tp-&gt;mode_bits
op_amp
id|LOOPING_MODE_MASK
)paren
op_eq
id|LOOPBACK_MODE_1
)paren
(brace
id|tp-&gt;status
op_assign
id|CLOSED
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|err
op_assign
id|smctr_issue_trc_loopback_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|tp-&gt;status
op_assign
id|OPEN
suffix:semicolon
)brace
)brace
id|smctr_status_chg
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|tp-&gt;mode_bits
op_amp
id|LOOPING_MODE_MASK
)paren
op_eq
id|LOOPBACK_MODE_2
)paren
(brace
id|tp-&gt;status
op_assign
id|CLOSED
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|err
op_assign
id|smctr_issue_tri_loopback_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|tp-&gt;status
op_assign
id|OPEN
suffix:semicolon
)brace
)brace
id|smctr_status_chg
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|tp-&gt;mode_bits
op_amp
id|LOOPING_MODE_MASK
)paren
op_eq
id|LOOPBACK_MODE_3
)paren
(brace
id|tp-&gt;status
op_assign
id|CLOSED
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|err
op_assign
id|smctr_lobe_media_test_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|tp-&gt;status
op_assign
id|OPEN
suffix:semicolon
)brace
)brace
id|smctr_status_chg
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|err
op_assign
id|smctr_lobe_media_test
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|err
op_assign
id|smctr_issue_insert_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* Check for a network adapter of this type, and return &squot;0 if one exists.&n; * If dev-&gt;base_addr == 0, probe all likely locations.&n; * If dev-&gt;base_addr == 1, always return failure.&n; */
DECL|function|smctr_probe
r_int
id|__init
id|smctr_probe
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|base_addr
op_assign
id|dev
ques
c_cond
id|dev-&gt;base_addr
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|base_addr
OG
l_int|0x1ff
)paren
(brace
multiline_comment|/* Check a single specified location. */
r_return
(paren
id|smctr_probe1
c_func
(paren
id|dev
comma
id|base_addr
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|base_addr
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Don&squot;t probe at all. */
r_return
(paren
op_minus
id|ENXIO
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|smctr_portlist
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|ioaddr
op_assign
id|smctr_portlist
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|ioaddr
comma
id|SMCTR_IO_EXTENT
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|smctr_probe1
c_func
(paren
id|dev
comma
id|ioaddr
)paren
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_return
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
DECL|function|smctr_probe1
r_static
r_int
id|__init
id|smctr_probe1
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
)paren
(brace
r_static
r_int
id|version_printed
op_assign
l_int|0
suffix:semicolon
r_struct
id|net_local
op_star
id|tp
suffix:semicolon
r_int
id|err
suffix:semicolon
id|__u32
op_star
id|ram
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
op_logical_and
id|version_printed
op_increment
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
)brace
macro_line|#ifndef MODULE
id|dev
op_assign
id|init_trdev
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Setup this devices private information structure */
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|net_local
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|tp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_local
)paren
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
id|tp
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
multiline_comment|/* Actually detect an adapter now. */
id|err
op_assign
id|smctr_chk_isa
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|err
op_assign
id|smctr_chk_mca
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|tp
)paren
suffix:semicolon
r_return
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
)brace
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;rmem_start
op_assign
id|dev-&gt;mem_start
op_assign
id|tp-&gt;ram_base
suffix:semicolon
id|dev-&gt;rmem_end
op_assign
id|dev-&gt;mem_end
op_assign
id|dev-&gt;mem_start
op_plus
l_int|0x10000
suffix:semicolon
id|ram
op_assign
(paren
id|__u32
op_star
)paren
id|phys_to_virt
c_func
(paren
id|dev-&gt;mem_start
)paren
suffix:semicolon
id|tp-&gt;ram_access
op_assign
op_star
(paren
id|__u32
op_star
)paren
op_amp
id|ram
suffix:semicolon
multiline_comment|/* Allow user to specify ring speed on module insert. */
r_if
c_cond
(paren
id|ringspeed
op_eq
l_int|4
)paren
(brace
id|tp-&gt;media_type
op_assign
id|MEDIA_UTP_4
suffix:semicolon
)brace
r_else
id|tp-&gt;media_type
op_assign
id|MEDIA_UTP_16
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %s %s at Io %#4x, Irq %d, Rom %#4x, Ram %#4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|smctr_name
comma
id|smctr_model
comma
(paren
r_int
r_int
)paren
id|dev-&gt;base_addr
comma
id|dev-&gt;irq
comma
id|tp-&gt;rom_base
comma
id|tp-&gt;ram_base
)paren
suffix:semicolon
id|dev-&gt;init
op_assign
id|smctr_init_card
suffix:semicolon
id|dev-&gt;open
op_assign
id|smctr_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|smctr_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|smctr_send_packet
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|smctr_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|HZ
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|smctr_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|smctr_set_multicast_list
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_process_rx_packet
r_static
r_int
id|smctr_process_rx_packet
c_func
(paren
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|size
comma
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|rx_status
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u16
id|rcode
comma
id|correlator
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|__u8
id|xframe
op_assign
l_int|1
suffix:semicolon
id|__u16
id|tx_fstatus
suffix:semicolon
id|rmf-&gt;vl
op_assign
id|SWAP_BYTES
c_func
(paren
id|rmf-&gt;vl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
id|FCB_RX_STATUS_DA_MATCHED
)paren
(brace
r_switch
c_cond
(paren
id|rmf-&gt;vc
)paren
(brace
multiline_comment|/* Received MAC Frames Processed by RS. */
r_case
id|INIT
suffix:colon
r_if
c_cond
(paren
(paren
id|rcode
op_assign
id|smctr_rcv_init
c_func
(paren
id|dev
comma
id|rmf
comma
op_amp
id|correlator
)paren
)paren
op_eq
id|HARDWARE_FAILED
)paren
(brace
r_return
(paren
id|rcode
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_send_rsp
c_func
(paren
id|dev
comma
id|rmf
comma
id|rcode
comma
id|correlator
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CHG_PARM
suffix:colon
r_if
c_cond
(paren
(paren
id|rcode
op_assign
id|smctr_rcv_chg_param
c_func
(paren
id|dev
comma
id|rmf
comma
op_amp
id|correlator
)paren
)paren
op_eq
id|HARDWARE_FAILED
)paren
(brace
r_return
(paren
id|rcode
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_send_rsp
c_func
(paren
id|dev
comma
id|rmf
comma
id|rcode
comma
id|correlator
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RQ_ADDR
suffix:colon
r_if
c_cond
(paren
(paren
id|rcode
op_assign
id|smctr_rcv_rq_addr_state_attch
c_func
(paren
id|dev
comma
id|rmf
comma
op_amp
id|correlator
)paren
)paren
op_ne
id|POSITIVE_ACK
)paren
(brace
r_if
c_cond
(paren
id|rcode
op_eq
id|HARDWARE_FAILED
)paren
(brace
r_return
(paren
id|rcode
)paren
suffix:semicolon
)brace
r_else
r_return
(paren
id|smctr_send_rsp
c_func
(paren
id|dev
comma
id|rmf
comma
id|rcode
comma
id|correlator
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_send_rpt_addr
c_func
(paren
id|dev
comma
id|rmf
comma
id|correlator
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RQ_ATTCH
suffix:colon
r_if
c_cond
(paren
(paren
id|rcode
op_assign
id|smctr_rcv_rq_addr_state_attch
c_func
(paren
id|dev
comma
id|rmf
comma
op_amp
id|correlator
)paren
)paren
op_ne
id|POSITIVE_ACK
)paren
(brace
r_if
c_cond
(paren
id|rcode
op_eq
id|HARDWARE_FAILED
)paren
(brace
r_return
(paren
id|rcode
)paren
suffix:semicolon
)brace
r_else
r_return
(paren
id|smctr_send_rsp
c_func
(paren
id|dev
comma
id|rmf
comma
id|rcode
comma
id|correlator
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_send_rpt_attch
c_func
(paren
id|dev
comma
id|rmf
comma
id|correlator
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RQ_STATE
suffix:colon
r_if
c_cond
(paren
(paren
id|rcode
op_assign
id|smctr_rcv_rq_addr_state_attch
c_func
(paren
id|dev
comma
id|rmf
comma
op_amp
id|correlator
)paren
)paren
op_ne
id|POSITIVE_ACK
)paren
(brace
r_if
c_cond
(paren
id|rcode
op_eq
id|HARDWARE_FAILED
)paren
(brace
r_return
(paren
id|rcode
)paren
suffix:semicolon
)brace
r_else
r_return
(paren
id|smctr_send_rsp
c_func
(paren
id|dev
comma
id|rmf
comma
id|rcode
comma
id|correlator
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_send_rpt_state
c_func
(paren
id|dev
comma
id|rmf
comma
id|correlator
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TX_FORWARD
suffix:colon
r_if
c_cond
(paren
(paren
id|rcode
op_assign
id|smctr_rcv_tx_forward
c_func
(paren
id|dev
comma
id|rmf
)paren
)paren
op_ne
id|POSITIVE_ACK
)paren
(brace
r_if
c_cond
(paren
id|rcode
op_eq
id|HARDWARE_FAILED
)paren
(brace
r_return
(paren
id|rcode
)paren
suffix:semicolon
)brace
r_else
r_return
(paren
id|smctr_send_rsp
c_func
(paren
id|dev
comma
id|rmf
comma
id|rcode
comma
id|correlator
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_send_tx_forward
c_func
(paren
id|dev
comma
id|rmf
comma
op_amp
id|tx_fstatus
)paren
)paren
op_eq
id|HARDWARE_FAILED
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
op_eq
id|A_FRAME_WAS_FORWARDED
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_send_rpt_tx_forward
c_func
(paren
id|dev
comma
id|rmf
comma
id|tx_fstatus
)paren
)paren
op_eq
id|HARDWARE_FAILED
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
multiline_comment|/* Received MAC Frames Processed by CRS/REM/RPS. */
r_case
id|RSP
suffix:colon
r_case
id|RQ_INIT
suffix:colon
r_case
id|RPT_NEW_MON
suffix:colon
r_case
id|RPT_SUA_CHG
suffix:colon
r_case
id|RPT_ACTIVE_ERR
suffix:colon
r_case
id|RPT_NN_INCMP
suffix:colon
r_case
id|RPT_ERROR
suffix:colon
r_case
id|RPT_ATTCH
suffix:colon
r_case
id|RPT_STATE
suffix:colon
r_case
id|RPT_ADDR
suffix:colon
r_break
suffix:semicolon
multiline_comment|/* Rcvd Att. MAC Frame (if RXATMAC set) or UNKNOWN */
r_default
suffix:colon
id|xframe
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_ATT_MAC_FRAMES
)paren
)paren
(brace
id|rcode
op_assign
id|smctr_rcv_unknown
c_func
(paren
id|dev
comma
id|rmf
comma
op_amp
id|correlator
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_send_rsp
c_func
(paren
id|dev
comma
id|rmf
comma
id|rcode
comma
id|correlator
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* 1. DA doesn&squot;t match (Promiscuous Mode).&n;                 * 2. Parse for Extended MAC Frame Type.&n;                 */
r_switch
c_cond
(paren
id|rmf-&gt;vc
)paren
(brace
r_case
id|RSP
suffix:colon
r_case
id|INIT
suffix:colon
r_case
id|RQ_INIT
suffix:colon
r_case
id|RQ_ADDR
suffix:colon
r_case
id|RQ_ATTCH
suffix:colon
r_case
id|RQ_STATE
suffix:colon
r_case
id|CHG_PARM
suffix:colon
r_case
id|RPT_ADDR
suffix:colon
r_case
id|RPT_ERROR
suffix:colon
r_case
id|RPT_ATTCH
suffix:colon
r_case
id|RPT_STATE
suffix:colon
r_case
id|RPT_NEW_MON
suffix:colon
r_case
id|RPT_SUA_CHG
suffix:colon
r_case
id|RPT_NN_INCMP
suffix:colon
r_case
id|RPT_ACTIVE_ERR
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|xframe
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* NOTE: UNKNOWN MAC frames will NOT be passed up unless&n;         * ACCEPT_ATT_MAC_FRAMES is set.&n;         */
r_if
c_cond
(paren
(paren
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_ATT_MAC_FRAMES
)paren
op_logical_and
(paren
id|xframe
op_eq
(paren
id|__u8
)paren
l_int|0
)paren
)paren
op_logical_or
(paren
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_EXT_MAC_FRAMES
)paren
op_logical_and
(paren
id|xframe
op_eq
(paren
id|__u8
)paren
l_int|1
)paren
)paren
)paren
(brace
id|rmf-&gt;vl
op_assign
id|SWAP_BYTES
c_func
(paren
id|rmf-&gt;vl
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|size
)paren
suffix:semicolon
id|skb-&gt;len
op_assign
id|size
suffix:semicolon
multiline_comment|/* Slide data into a sleek skb. */
id|skb_put
c_func
(paren
id|skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|rmf
comma
id|skb-&gt;len
)paren
suffix:semicolon
multiline_comment|/* Update Counters */
id|tp-&gt;MacStat.rx_packets
op_increment
suffix:semicolon
id|tp-&gt;MacStat.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* Kick the packet on up. */
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|tr_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
)brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* Test for RAM in adapter RAM space. */
DECL|function|smctr_ram_conflict_test
r_static
r_int
id|smctr_ram_conflict_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|__u16
id|sword
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_int
r_int
)paren
(paren
id|tp-&gt;ram_usable
op_star
l_int|1024
)paren
suffix:semicolon
id|i
op_add_assign
l_int|1024
)paren
(brace
id|sword
op_assign
op_star
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|i
)paren
suffix:semicolon
op_star
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|i
)paren
op_assign
l_int|0x1234
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|i
)paren
op_eq
l_int|0x1234
)paren
(brace
op_star
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|i
)paren
op_assign
id|sword
suffix:semicolon
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Adapter RAM test. Incremental word ODD boundry data test. */
DECL|function|smctr_ram_memory_test
r_static
r_int
id|smctr_ram_memory_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u16
id|page
comma
id|pages_of_ram
comma
id|start_pattern
op_assign
l_int|0
comma
id|word_pattern
op_assign
l_int|0
comma
id|word_read
op_assign
l_int|0
comma
id|err_word
op_assign
l_int|0
comma
id|err_pattern
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|err_offset
suffix:semicolon
id|__u32
id|j
comma
id|pword
suffix:semicolon
id|__u8
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_ram_memory_test&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|start_pattern
op_assign
l_int|0x0001
suffix:semicolon
id|pages_of_ram
op_assign
id|tp-&gt;ram_size
op_div
id|tp-&gt;ram_usable
suffix:semicolon
id|pword
op_assign
id|tp-&gt;ram_access
suffix:semicolon
multiline_comment|/* Incremental word ODD boundry test. */
r_for
c_loop
(paren
id|page
op_assign
l_int|0
suffix:semicolon
(paren
id|page
OL
id|pages_of_ram
)paren
op_logical_and
(paren
op_complement
id|err
)paren
suffix:semicolon
id|page
op_increment
comma
id|start_pattern
op_add_assign
l_int|0x8000
)paren
(brace
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
(paren
id|page
op_star
id|tp-&gt;ram_usable
op_star
l_int|1024
)paren
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|word_pattern
op_assign
id|start_pattern
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
(paren
id|__u32
)paren
(paren
id|tp-&gt;ram_usable
op_star
l_int|1024
)paren
op_minus
l_int|1
suffix:semicolon
id|j
op_add_assign
l_int|2
)paren
(brace
op_star
(paren
id|__u16
op_star
)paren
(paren
id|pword
op_plus
id|j
)paren
op_assign
id|word_pattern
op_increment
suffix:semicolon
)brace
id|word_pattern
op_assign
id|start_pattern
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
(paren
id|__u32
)paren
(paren
id|tp-&gt;ram_usable
op_star
l_int|1024
)paren
op_minus
l_int|1
op_logical_and
(paren
op_complement
id|err
)paren
suffix:semicolon
id|j
op_add_assign
l_int|2
comma
id|word_pattern
op_increment
)paren
(brace
id|word_read
op_assign
op_star
(paren
id|__u16
op_star
)paren
(paren
id|pword
op_plus
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
id|word_read
op_ne
id|word_pattern
)paren
(brace
id|err
op_assign
(paren
id|__u8
)paren
l_int|1
suffix:semicolon
id|err_offset
op_assign
id|j
suffix:semicolon
id|err_word
op_assign
id|word_read
suffix:semicolon
id|err_pattern
op_assign
id|word_pattern
suffix:semicolon
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Zero out memory. */
r_for
c_loop
(paren
id|page
op_assign
l_int|0
suffix:semicolon
id|page
OL
id|pages_of_ram
op_logical_and
(paren
op_complement
id|err
)paren
suffix:semicolon
id|page
op_increment
)paren
(brace
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
(paren
id|page
op_star
id|tp-&gt;ram_usable
op_star
l_int|1024
)paren
)paren
)paren
suffix:semicolon
id|word_pattern
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|__u32
)paren
id|tp-&gt;ram_usable
op_star
l_int|1024
suffix:semicolon
id|j
op_add_assign
l_int|2
)paren
(brace
op_star
(paren
id|__u16
op_star
)paren
(paren
id|pword
op_plus
id|j
)paren
op_assign
id|word_pattern
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|__u32
)paren
id|tp-&gt;ram_usable
op_star
l_int|1024
op_logical_and
(paren
op_complement
id|err
)paren
suffix:semicolon
id|j
op_add_assign
l_int|2
)paren
(brace
id|word_read
op_assign
op_star
(paren
id|__u16
op_star
)paren
(paren
id|pword
op_plus
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
id|word_read
op_ne
id|word_pattern
)paren
(brace
id|err
op_assign
(paren
id|__u8
)paren
l_int|1
suffix:semicolon
id|err_offset
op_assign
id|j
suffix:semicolon
id|err_word
op_assign
id|word_read
suffix:semicolon
id|err_pattern
op_assign
id|word_pattern
suffix:semicolon
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
id|tp-&gt;ram_access
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_read_584_chksum
r_static
r_int
r_int
id|__init
id|smctr_read_584_chksum
c_func
(paren
r_int
id|ioaddr
)paren
(brace
id|__u8
id|pg_no
comma
id|r1
comma
id|r2
suffix:semicolon
id|__u16
id|byte_no
comma
id|csum_val
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|pg_no
op_assign
l_int|0
suffix:semicolon
id|pg_no
OL
l_int|16
suffix:semicolon
id|pg_no
op_increment
)paren
(brace
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0x01
)paren
suffix:semicolon
id|r1
op_and_assign
l_int|0x04
suffix:semicolon
id|r1
op_or_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
id|r1
comma
id|ioaddr
op_plus
l_int|0x01
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0x03
)paren
suffix:semicolon
id|r1
op_and_assign
l_int|0x0f
suffix:semicolon
id|r1
op_or_assign
(paren
id|pg_no
op_lshift
l_int|4
)paren
suffix:semicolon
id|outb
c_func
(paren
id|r1
comma
id|ioaddr
op_plus
l_int|0x03
)paren
suffix:semicolon
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0x01
)paren
suffix:semicolon
id|r1
op_and_assign
l_int|0x04
suffix:semicolon
id|r1
op_or_assign
l_int|0x12
suffix:semicolon
id|outb
c_func
(paren
id|r1
comma
id|ioaddr
op_plus
l_int|0x01
)paren
suffix:semicolon
r_do
(brace
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0x01
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|r1
op_amp
l_int|0x10
)paren
(brace
suffix:semicolon
)brace
id|r2
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|byte_no
op_assign
l_int|0x08
suffix:semicolon
id|byte_no
OL
l_int|0x10
suffix:semicolon
id|byte_no
op_increment
)paren
(brace
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|byte_no
)paren
suffix:semicolon
id|r2
op_add_assign
id|r1
suffix:semicolon
)brace
id|csum_val
op_add_assign
id|r2
suffix:semicolon
)brace
id|r1
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0x01
)paren
suffix:semicolon
id|r1
op_and_assign
l_int|0x04
suffix:semicolon
id|r1
op_or_assign
l_int|0x10
suffix:semicolon
id|outb
c_func
(paren
id|r1
comma
id|ioaddr
op_plus
l_int|0x01
)paren
suffix:semicolon
id|csum_val
op_and_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|csum_val
op_eq
l_int|0xff
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|smctr_rcv_chg_param
r_static
r_int
id|smctr_rcv_chg_param
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
op_star
id|correlator
)paren
(brace
id|MAC_SUB_VECTOR
op_star
id|rsv
suffix:semicolon
r_int
r_int
id|vlen
suffix:semicolon
id|__u16
id|rcode
op_assign
id|POSITIVE_ACK
suffix:semicolon
r_int
r_int
id|svectors
op_assign
id|F_NO_SUB_VECTORS_FOUND
suffix:semicolon
multiline_comment|/* This Frame can only come from a CRS */
r_if
c_cond
(paren
(paren
id|rmf-&gt;dc_sc
op_amp
id|SC_MASK
)paren
op_ne
id|SC_CRS
)paren
(brace
r_return
id|E_INAPPROPRIATE_SOURCE_CLASS
suffix:semicolon
)brace
multiline_comment|/* Remove MVID Length from total length. */
id|vlen
op_assign
(paren
r_int
r_int
)paren
id|rmf-&gt;vl
op_minus
l_int|4
suffix:semicolon
multiline_comment|/* Point to First SVID */
id|rsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
multiline_comment|/* Search for Appropriate SVID&squot;s. */
r_while
c_loop
(paren
(paren
id|vlen
OG
l_int|0
)paren
op_logical_and
(paren
id|rcode
op_eq
id|POSITIVE_ACK
)paren
)paren
(brace
r_switch
c_cond
(paren
id|rsv-&gt;svi
)paren
(brace
r_case
id|CORRELATOR
suffix:colon
id|svectors
op_or_assign
id|F_CORRELATOR
suffix:semicolon
id|rcode
op_assign
id|smctr_set_corr
c_func
(paren
id|dev
comma
id|rsv
comma
id|correlator
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LOCAL_RING_NUMBER
suffix:colon
id|svectors
op_or_assign
id|F_LOCAL_RING_NUMBER
suffix:semicolon
id|rcode
op_assign
id|smctr_set_local_ring_num
c_func
(paren
id|dev
comma
id|rsv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ASSIGN_PHYSICAL_DROP
suffix:colon
id|svectors
op_or_assign
id|F_ASSIGN_PHYSICAL_DROP
suffix:semicolon
id|rcode
op_assign
id|smctr_set_phy_drop
c_func
(paren
id|dev
comma
id|rsv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ERROR_TIMER_VALUE
suffix:colon
id|svectors
op_or_assign
id|F_ERROR_TIMER_VALUE
suffix:semicolon
id|rcode
op_assign
id|smctr_set_error_timer_value
c_func
(paren
id|dev
comma
id|rsv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUTHORIZED_FUNCTION_CLASS
suffix:colon
id|svectors
op_or_assign
id|F_AUTHORIZED_FUNCTION_CLASS
suffix:semicolon
id|rcode
op_assign
id|smctr_set_auth_funct_class
c_func
(paren
id|dev
comma
id|rsv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUTHORIZED_ACCESS_PRIORITY
suffix:colon
id|svectors
op_or_assign
id|F_AUTHORIZED_ACCESS_PRIORITY
suffix:semicolon
id|rcode
op_assign
id|smctr_set_auth_access_pri
c_func
(paren
id|dev
comma
id|rsv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rcode
op_assign
id|E_SUB_VECTOR_UNKNOWN
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Let Sender Know if SUM of SV length&squot;s is&n;                 * larger then length in MVID length field&n;                 */
r_if
c_cond
(paren
(paren
id|vlen
op_sub_assign
id|rsv-&gt;svl
)paren
OL
l_int|0
)paren
(brace
id|rcode
op_assign
id|E_VECTOR_LENGTH_ERROR
suffix:semicolon
)brace
id|rsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rsv
op_plus
id|rsv-&gt;svl
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rcode
op_eq
id|POSITIVE_ACK
)paren
(brace
multiline_comment|/* Let Sender Know if MVID length field&n;                 * is larger then SUM of SV length&squot;s&n;                 */
r_if
c_cond
(paren
id|vlen
op_ne
l_int|0
)paren
(brace
id|rcode
op_assign
id|E_VECTOR_LENGTH_ERROR
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Let Sender Know if Expected SVID Missing */
r_if
c_cond
(paren
(paren
id|svectors
op_amp
id|R_CHG_PARM
)paren
op_xor
id|R_CHG_PARM
)paren
(brace
id|rcode
op_assign
id|E_MISSING_SUB_VECTOR
suffix:semicolon
)brace
)brace
)brace
r_return
(paren
id|rcode
)paren
suffix:semicolon
)brace
DECL|function|smctr_rcv_init
r_static
r_int
id|smctr_rcv_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
op_star
id|correlator
)paren
(brace
id|MAC_SUB_VECTOR
op_star
id|rsv
suffix:semicolon
r_int
r_int
id|vlen
suffix:semicolon
id|__u16
id|rcode
op_assign
id|POSITIVE_ACK
suffix:semicolon
r_int
r_int
id|svectors
op_assign
id|F_NO_SUB_VECTORS_FOUND
suffix:semicolon
multiline_comment|/* This Frame can only come from a RPS */
r_if
c_cond
(paren
(paren
id|rmf-&gt;dc_sc
op_amp
id|SC_MASK
)paren
op_ne
id|SC_RPS
)paren
(brace
r_return
(paren
id|E_INAPPROPRIATE_SOURCE_CLASS
)paren
suffix:semicolon
)brace
multiline_comment|/* Remove MVID Length from total length. */
id|vlen
op_assign
(paren
r_int
r_int
)paren
id|rmf-&gt;vl
op_minus
l_int|4
suffix:semicolon
multiline_comment|/* Point to First SVID */
id|rsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
multiline_comment|/* Search for Appropriate SVID&squot;s */
r_while
c_loop
(paren
(paren
id|vlen
OG
l_int|0
)paren
op_logical_and
(paren
id|rcode
op_eq
id|POSITIVE_ACK
)paren
)paren
(brace
r_switch
c_cond
(paren
id|rsv-&gt;svi
)paren
(brace
r_case
id|CORRELATOR
suffix:colon
id|svectors
op_or_assign
id|F_CORRELATOR
suffix:semicolon
id|rcode
op_assign
id|smctr_set_corr
c_func
(paren
id|dev
comma
id|rsv
comma
id|correlator
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LOCAL_RING_NUMBER
suffix:colon
id|svectors
op_or_assign
id|F_LOCAL_RING_NUMBER
suffix:semicolon
id|rcode
op_assign
id|smctr_set_local_ring_num
c_func
(paren
id|dev
comma
id|rsv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ASSIGN_PHYSICAL_DROP
suffix:colon
id|svectors
op_or_assign
id|F_ASSIGN_PHYSICAL_DROP
suffix:semicolon
id|rcode
op_assign
id|smctr_set_phy_drop
c_func
(paren
id|dev
comma
id|rsv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ERROR_TIMER_VALUE
suffix:colon
id|svectors
op_or_assign
id|F_ERROR_TIMER_VALUE
suffix:semicolon
id|rcode
op_assign
id|smctr_set_error_timer_value
c_func
(paren
id|dev
comma
id|rsv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rcode
op_assign
id|E_SUB_VECTOR_UNKNOWN
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Let Sender Know if SUM of SV length&squot;s is&n;                 * larger then length in MVID length field&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|vlen
op_sub_assign
id|rsv-&gt;svl
)paren
OL
l_int|0
)paren
(brace
id|rcode
op_assign
id|E_VECTOR_LENGTH_ERROR
suffix:semicolon
)brace
id|rsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rsv
op_plus
id|rsv-&gt;svl
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rcode
op_eq
id|POSITIVE_ACK
)paren
(brace
multiline_comment|/* Let Sender Know if MVID length field&n;                 * is larger then SUM of SV length&squot;s&n;                 */
r_if
c_cond
(paren
id|vlen
op_ne
l_int|0
)paren
(brace
id|rcode
op_assign
id|E_VECTOR_LENGTH_ERROR
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Let Sender Know if Expected SV Missing */
r_if
c_cond
(paren
(paren
id|svectors
op_amp
id|R_INIT
)paren
op_xor
id|R_INIT
)paren
(brace
id|rcode
op_assign
id|E_MISSING_SUB_VECTOR
suffix:semicolon
)brace
)brace
)brace
r_return
(paren
id|rcode
)paren
suffix:semicolon
)brace
DECL|function|smctr_rcv_tx_forward
r_static
r_int
id|smctr_rcv_tx_forward
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
)paren
(brace
id|MAC_SUB_VECTOR
op_star
id|rsv
suffix:semicolon
r_int
r_int
id|vlen
suffix:semicolon
id|__u16
id|rcode
op_assign
id|POSITIVE_ACK
suffix:semicolon
r_int
r_int
id|svectors
op_assign
id|F_NO_SUB_VECTORS_FOUND
suffix:semicolon
multiline_comment|/* This Frame can only come from a CRS */
r_if
c_cond
(paren
(paren
id|rmf-&gt;dc_sc
op_amp
id|SC_MASK
)paren
op_ne
id|SC_CRS
)paren
(brace
r_return
(paren
id|E_INAPPROPRIATE_SOURCE_CLASS
)paren
suffix:semicolon
)brace
multiline_comment|/* Remove MVID Length from total length */
id|vlen
op_assign
(paren
r_int
r_int
)paren
id|rmf-&gt;vl
op_minus
l_int|4
suffix:semicolon
multiline_comment|/* Point to First SVID */
id|rsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
multiline_comment|/* Search for Appropriate SVID&squot;s */
r_while
c_loop
(paren
(paren
id|vlen
OG
l_int|0
)paren
op_logical_and
(paren
id|rcode
op_eq
id|POSITIVE_ACK
)paren
)paren
(brace
r_switch
c_cond
(paren
id|rsv-&gt;svi
)paren
(brace
r_case
id|FRAME_FORWARD
suffix:colon
id|svectors
op_or_assign
id|F_FRAME_FORWARD
suffix:semicolon
id|rcode
op_assign
id|smctr_set_frame_forward
c_func
(paren
id|dev
comma
id|rsv
comma
id|rmf-&gt;dc_sc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rcode
op_assign
id|E_SUB_VECTOR_UNKNOWN
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Let Sender Know if SUM of SV length&squot;s is&n;                 * larger then length in MVID length field&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|vlen
op_sub_assign
id|rsv-&gt;svl
)paren
OL
l_int|0
)paren
(brace
id|rcode
op_assign
id|E_VECTOR_LENGTH_ERROR
suffix:semicolon
)brace
id|rsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rsv
op_plus
id|rsv-&gt;svl
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rcode
op_eq
id|POSITIVE_ACK
)paren
(brace
multiline_comment|/* Let Sender Know if MVID length field&n;                 * is larger then SUM of SV length&squot;s&n;                 */
r_if
c_cond
(paren
id|vlen
op_ne
l_int|0
)paren
(brace
id|rcode
op_assign
id|E_VECTOR_LENGTH_ERROR
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Let Sender Know if Expected SV Missing */
r_if
c_cond
(paren
(paren
id|svectors
op_amp
id|R_TX_FORWARD
)paren
op_xor
id|R_TX_FORWARD
)paren
(brace
id|rcode
op_assign
id|E_MISSING_SUB_VECTOR
suffix:semicolon
)brace
)brace
)brace
r_return
(paren
id|rcode
)paren
suffix:semicolon
)brace
DECL|function|smctr_rcv_rq_addr_state_attch
r_static
r_int
id|smctr_rcv_rq_addr_state_attch
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
op_star
id|correlator
)paren
(brace
id|MAC_SUB_VECTOR
op_star
id|rsv
suffix:semicolon
r_int
r_int
id|vlen
suffix:semicolon
id|__u16
id|rcode
op_assign
id|POSITIVE_ACK
suffix:semicolon
r_int
r_int
id|svectors
op_assign
id|F_NO_SUB_VECTORS_FOUND
suffix:semicolon
multiline_comment|/* Remove MVID Length from total length */
id|vlen
op_assign
(paren
r_int
r_int
)paren
id|rmf-&gt;vl
op_minus
l_int|4
suffix:semicolon
multiline_comment|/* Point to First SVID */
id|rsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
multiline_comment|/* Search for Appropriate SVID&squot;s */
r_while
c_loop
(paren
(paren
id|vlen
OG
l_int|0
)paren
op_logical_and
(paren
id|rcode
op_eq
id|POSITIVE_ACK
)paren
)paren
(brace
r_switch
c_cond
(paren
id|rsv-&gt;svi
)paren
(brace
r_case
id|CORRELATOR
suffix:colon
id|svectors
op_or_assign
id|F_CORRELATOR
suffix:semicolon
id|rcode
op_assign
id|smctr_set_corr
c_func
(paren
id|dev
comma
id|rsv
comma
id|correlator
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rcode
op_assign
id|E_SUB_VECTOR_UNKNOWN
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Let Sender Know if SUM of SV length&squot;s is&n;                 * larger then length in MVID length field&n;                 */
r_if
c_cond
(paren
(paren
id|vlen
op_sub_assign
id|rsv-&gt;svl
)paren
OL
l_int|0
)paren
(brace
id|rcode
op_assign
id|E_VECTOR_LENGTH_ERROR
suffix:semicolon
)brace
id|rsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rsv
op_plus
id|rsv-&gt;svl
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rcode
op_eq
id|POSITIVE_ACK
)paren
(brace
multiline_comment|/* Let Sender Know if MVID length field&n;                 * is larger then SUM of SV length&squot;s&n;                 */
r_if
c_cond
(paren
id|vlen
op_ne
l_int|0
)paren
(brace
id|rcode
op_assign
id|E_VECTOR_LENGTH_ERROR
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Let Sender Know if Expected SVID Missing */
r_if
c_cond
(paren
(paren
id|svectors
op_amp
id|R_RQ_ATTCH_STATE_ADDR
)paren
op_xor
id|R_RQ_ATTCH_STATE_ADDR
)paren
(brace
id|rcode
op_assign
id|E_MISSING_SUB_VECTOR
suffix:semicolon
)brace
)brace
)brace
r_return
(paren
id|rcode
)paren
suffix:semicolon
)brace
DECL|function|smctr_rcv_unknown
r_static
r_int
id|smctr_rcv_unknown
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
op_star
id|correlator
)paren
(brace
id|MAC_SUB_VECTOR
op_star
id|rsv
suffix:semicolon
r_int
r_int
id|vlen
suffix:semicolon
op_star
id|correlator
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Remove MVID Length from total length */
id|vlen
op_assign
(paren
r_int
r_int
)paren
id|rmf-&gt;vl
op_minus
l_int|4
suffix:semicolon
multiline_comment|/* Point to First SVID */
id|rsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
multiline_comment|/* Search for CORRELATOR for RSP to UNKNOWN */
r_while
c_loop
(paren
(paren
id|vlen
OG
l_int|0
)paren
op_logical_and
(paren
op_star
id|correlator
op_eq
l_int|0
)paren
)paren
(brace
r_switch
c_cond
(paren
id|rsv-&gt;svi
)paren
(brace
r_case
id|CORRELATOR
suffix:colon
id|smctr_set_corr
c_func
(paren
id|dev
comma
id|rsv
comma
id|correlator
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|vlen
op_sub_assign
id|rsv-&gt;svl
suffix:semicolon
id|rsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rsv
op_plus
id|rsv-&gt;svl
)paren
suffix:semicolon
)brace
r_return
(paren
id|E_UNRECOGNIZED_VECTOR_ID
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Reset the 825 NIC and exit w:&n; * 1. The NIC reset cleared (non-reset state), halted and un-initialized.&n; * 2. TINT masked.&n; * 3. CBUSY masked.&n; * 4. TINT clear.&n; * 5. CBUSY clear.&n; */
DECL|function|smctr_reset_adapter
r_static
r_int
id|smctr_reset_adapter
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/* Reseting the NIC will put it in a halted and un-initialized state. */
id|smctr_set_trc_reset
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|200000
)paren
suffix:semicolon
multiline_comment|/* ~2 ms */
id|smctr_clear_trc_reset
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|200000
)paren
suffix:semicolon
multiline_comment|/* ~2 ms */
multiline_comment|/* Remove any latched interrupts that occured prior to reseting the&n;         * adapter or possibily caused by line glitches due to the reset.&n;         */
id|outb
c_func
(paren
id|tp-&gt;trc_mask
op_or
id|CSR_CLRTINT
op_or
id|CSR_CLRCBUSY
comma
id|ioaddr
op_plus
id|CSR
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_restart_tx_chain
r_static
r_int
id|smctr_restart_tx_chain
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|queue
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_restart_tx_chain&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;num_tx_fcbs_used
(braket
id|queue
)braket
op_ne
l_int|0
op_logical_and
id|tp-&gt;tx_queue_status
(braket
id|queue
)braket
op_eq
id|NOT_TRANSMITING
)paren
(brace
id|tp-&gt;tx_queue_status
(braket
id|queue
)braket
op_assign
id|TRANSMITING
suffix:semicolon
id|err
op_assign
id|smctr_issue_resume_tx_fcb_cmd
c_func
(paren
id|dev
comma
id|queue
)paren
suffix:semicolon
)brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_ring_status_chg
r_static
r_int
id|smctr_ring_status_chg
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_ring_status_chg&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/* Check for ring_status_flag: whenever MONITOR_STATE_BIT&n;         * Bit is set, check value of monitor_state, only then we&n;         * enable and start transmit/receive timeout (if and only&n;         * if it is MS_ACTIVE_MONITOR_STATE or MS_STANDBY_MONITOR_STATE)&n;         */
r_if
c_cond
(paren
id|tp-&gt;ring_status_flags
op_eq
id|MONITOR_STATE_CHANGED
)paren
(brace
r_if
c_cond
(paren
(paren
id|tp-&gt;monitor_state
op_eq
id|MS_ACTIVE_MONITOR_STATE
)paren
op_logical_or
(paren
id|tp-&gt;monitor_state
op_eq
id|MS_STANDBY_MONITOR_STATE
)paren
)paren
(brace
id|tp-&gt;monitor_state_ready
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* if adapter is NOT in either active monitor&n;                         * or standby monitor state =&gt; Disable&n;                         * transmit/receive timeout.&n;                         */
id|tp-&gt;monitor_state_ready
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Ring speed problem, switching to auto mode. */
r_if
c_cond
(paren
id|tp-&gt;monitor_state
op_eq
id|MS_MONITOR_FSM_INACTIVE
op_logical_and
op_logical_neg
id|tp-&gt;cleanup
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Incorrect ring speed switching.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|smctr_set_ring_speed
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;ring_status_flags
op_amp
id|RING_STATUS_CHANGED
)paren
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|tp-&gt;ring_status
)paren
(brace
r_case
id|RING_RECOVERY
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Ring Recovery&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;current_ring_status
op_or_assign
id|RING_RECOVERY
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SINGLE_STATION
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Single Statinon&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;current_ring_status
op_or_assign
id|SINGLE_STATION
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COUNTER_OVERFLOW
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Counter Overflow&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;current_ring_status
op_or_assign
id|COUNTER_OVERFLOW
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REMOVE_RECEIVED
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Remove Received&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;current_ring_status
op_or_assign
id|REMOVE_RECEIVED
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUTO_REMOVAL_ERROR
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Auto Remove Error&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;current_ring_status
op_or_assign
id|AUTO_REMOVAL_ERROR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LOBE_WIRE_FAULT
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Lobe Wire Fault&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;current_ring_status
op_or_assign
id|LOBE_WIRE_FAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRANSMIT_BEACON
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Transmit Beacon&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;current_ring_status
op_or_assign
id|TRANSMIT_BEACON
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOFT_ERROR
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Soft Error&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;current_ring_status
op_or_assign
id|SOFT_ERROR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HARD_ERROR
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Hard Error&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;current_ring_status
op_or_assign
id|HARD_ERROR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIGNAL_LOSS
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Singal Loss&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;current_ring_status
op_or_assign
id|SIGNAL_LOSS
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Unknown ring status change&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Test for ROM signature within adapter RAM space. */
DECL|function|smctr_rom_conflict_test
r_static
r_int
id|smctr_rom_conflict_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_int
r_int
)paren
id|tp-&gt;ram_usable
op_star
l_int|1024
suffix:semicolon
id|i
op_add_assign
l_int|4096
)paren
(brace
r_if
c_cond
(paren
op_star
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|i
)paren
op_eq
l_int|0xaa55
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_rx_frame
r_static
r_int
id|smctr_rx_frame
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u16
id|queue
comma
id|status
comma
id|rx_size
comma
id|err
op_assign
l_int|0
suffix:semicolon
id|__u8
op_star
id|pbuff
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_rx_frame&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|queue
op_assign
id|tp-&gt;receive_queue_number
suffix:semicolon
r_while
c_loop
(paren
(paren
id|status
op_assign
id|tp-&gt;rx_fcb_curr
(braket
id|queue
)braket
op_member_access_from_pointer
id|frame_status
)paren
op_ne
id|SUCCESS
)paren
(brace
id|err
op_assign
id|HARDWARE_FAILED
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|status
op_amp
l_int|0x007f
)paren
op_eq
l_int|0
)paren
op_logical_or
(paren
(paren
id|tp-&gt;receive_mask
op_amp
id|ACCEPT_ERR_PACKETS
)paren
op_ne
l_int|0
)paren
)paren
(brace
multiline_comment|/* frame length less the CRC (4 bytes) + FS (1 byte) */
id|rx_size
op_assign
id|tp-&gt;rx_fcb_curr
(braket
id|queue
)braket
op_member_access_from_pointer
id|frame_length
op_minus
l_int|5
suffix:semicolon
id|pbuff
op_assign
id|smctr_get_rx_pointer
c_func
(paren
id|dev
comma
id|queue
)paren
suffix:semicolon
id|smctr_set_page
c_func
(paren
id|dev
comma
id|pbuff
)paren
suffix:semicolon
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* pbuff points to addr within one page */
id|pbuff
op_assign
(paren
id|__u8
op_star
)paren
id|PAGE_POINTER
c_func
(paren
id|pbuff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|queue
op_eq
id|NON_MAC_QUEUE
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|rx_size
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|rx_size
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|pbuff
comma
id|rx_size
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Update Counters */
id|tp-&gt;MacStat.rx_packets
op_increment
suffix:semicolon
id|tp-&gt;MacStat.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* Kick the packet on up. */
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|tr_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
id|smctr_process_rx_packet
c_func
(paren
(paren
id|MAC_HEADER
op_star
)paren
id|pbuff
comma
id|rx_size
comma
id|dev
comma
id|status
)paren
suffix:semicolon
)brace
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|smctr_set_page
c_func
(paren
id|dev
comma
(paren
id|__u8
op_star
)paren
id|tp-&gt;ram_access
)paren
suffix:semicolon
id|smctr_update_rx_chain
c_func
(paren
id|dev
comma
id|queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_send_dat
r_static
r_int
id|smctr_send_dat
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
comma
id|err
suffix:semicolon
id|MAC_HEADER
op_star
id|tmf
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_send_dat&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fcb
op_assign
id|smctr_get_tx_fcb
c_func
(paren
id|dev
comma
id|MAC_QUEUE
comma
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
)paren
op_eq
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
(brace
r_return
(paren
id|OUT_OF_RESOURCES
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize DAT Data Fields. */
id|tmf
op_assign
(paren
id|MAC_HEADER
op_star
)paren
id|fcb-&gt;bdb_ptr-&gt;data_block_ptr
suffix:semicolon
id|tmf-&gt;ac
op_assign
id|MSB
c_func
(paren
id|AC_FC_DAT
)paren
suffix:semicolon
id|tmf-&gt;fc
op_assign
id|LSB
c_func
(paren
id|AC_FC_DAT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmf-&gt;sa
(braket
id|i
)braket
op_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
suffix:semicolon
id|tmf-&gt;da
(braket
id|i
)braket
op_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
suffix:semicolon
)brace
id|tmf-&gt;vc
op_assign
id|DAT
suffix:semicolon
id|tmf-&gt;dc_sc
op_assign
id|DC_RS
op_or
id|SC_RS
suffix:semicolon
id|tmf-&gt;vl
op_assign
l_int|4
suffix:semicolon
id|tmf-&gt;vl
op_assign
id|SWAP_BYTES
c_func
(paren
id|tmf-&gt;vl
)paren
suffix:semicolon
multiline_comment|/* Start Transmit. */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_trc_send_packet
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* Wait for Transmit to Complete */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fcb-&gt;frame_status
op_amp
id|FCB_COMMAND_DONE
)paren
(brace
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
multiline_comment|/* Check if GOOD frame Tx&squot;ed. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|fcb-&gt;frame_status
op_amp
id|FCB_COMMAND_DONE
)paren
op_logical_or
id|fcb-&gt;frame_status
op_amp
(paren
id|FCB_TX_STATUS_E
op_or
id|FCB_TX_AC_BITS
)paren
)paren
(brace
r_return
(paren
id|INITIALIZE_FAILED
)paren
suffix:semicolon
)brace
multiline_comment|/* De-allocated Tx FCB and Frame Buffer&n;         * The FCB must be de-allocated manually if executing with&n;         * interrupts disabled, other wise the ISR (LM_Service_Events)&n;         * will de-allocate it when the interrupt occurs.&n;         */
id|tp-&gt;tx_queue_status
(braket
id|MAC_QUEUE
)braket
op_assign
id|NOT_TRANSMITING
suffix:semicolon
id|smctr_update_tx_chain
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_timeout
r_static
r_void
id|smctr_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
multiline_comment|/*&n;         * If we get here, some higher level has decided we are broken.&n;         * There should really be a &quot;kick me&quot; function call instead.&n;         *&n;         * Resetting the token ring adapter takes a long time so just&n;         * fake transmission time and go on trying. Our own timeout&n;         * routine is in sktr_timer_chk()&n;         */
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Gets skb from system, queues it and checks if it can be sent&n; */
DECL|function|smctr_send_packet
r_static
r_int
id|smctr_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_send_packet&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;         * Block a transmit overlap&n;         */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;QueueSkb
op_eq
l_int|0
)paren
(brace
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* Return with tbusy set: queue full */
id|tp-&gt;QueueSkb
op_decrement
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|tp-&gt;SendSkbQueue
comma
id|skb
)paren
suffix:semicolon
id|smctr_hardware_send_packet
c_func
(paren
id|dev
comma
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;QueueSkb
OG
l_int|0
)paren
(brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_send_lobe_media_test
r_static
r_int
id|smctr_send_lobe_media_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|MAC_SUB_VECTOR
op_star
id|tsv
suffix:semicolon
id|MAC_HEADER
op_star
id|tmf
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
id|__u32
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|15
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_send_lobe_media_test&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fcb
op_assign
id|smctr_get_tx_fcb
c_func
(paren
id|dev
comma
id|MAC_QUEUE
comma
r_sizeof
(paren
r_struct
id|trh_hdr
)paren
op_plus
id|S_WRAP_DATA
op_plus
id|S_WRAP_DATA
)paren
)paren
op_eq
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
(brace
r_return
(paren
id|OUT_OF_RESOURCES
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize DAT Data Fields. */
id|tmf
op_assign
(paren
id|MAC_HEADER
op_star
)paren
id|fcb-&gt;bdb_ptr-&gt;data_block_ptr
suffix:semicolon
id|tmf-&gt;ac
op_assign
id|MSB
c_func
(paren
id|AC_FC_LOBE_MEDIA_TEST
)paren
suffix:semicolon
id|tmf-&gt;fc
op_assign
id|LSB
c_func
(paren
id|AC_FC_LOBE_MEDIA_TEST
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmf-&gt;da
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|tmf-&gt;sa
(braket
id|i
)braket
op_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
suffix:semicolon
)brace
id|tmf-&gt;vc
op_assign
id|LOBE_MEDIA_TEST
suffix:semicolon
id|tmf-&gt;dc_sc
op_assign
id|DC_RS
op_or
id|SC_RS
suffix:semicolon
id|tmf-&gt;vl
op_assign
l_int|4
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
id|smctr_make_wrap_data
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_wrap_data
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
multiline_comment|/* Start Transmit. */
id|tmf-&gt;vl
op_assign
id|SWAP_BYTES
c_func
(paren
id|tmf-&gt;vl
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_trc_send_packet
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* Wait for Transmit to Complete. (10 ms). */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fcb-&gt;frame_status
op_amp
id|FCB_COMMAND_DONE
)paren
(brace
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
multiline_comment|/* Check if GOOD frame Tx&squot;ed */
r_if
c_cond
(paren
op_logical_neg
(paren
id|fcb-&gt;frame_status
op_amp
id|FCB_COMMAND_DONE
)paren
op_logical_or
id|fcb-&gt;frame_status
op_amp
(paren
id|FCB_TX_STATUS_E
op_or
id|FCB_TX_AC_BITS
)paren
)paren
(brace
r_return
(paren
id|LOBE_MEDIA_TEST_FAILED
)paren
suffix:semicolon
)brace
multiline_comment|/* De-allocated Tx FCB and Frame Buffer&n;         * The FCB must be de-allocated manually if executing with&n;         * interrupts disabled, other wise the ISR (LM_Service_Events)&n;         * will de-allocate it when the interrupt occurs.&n;         */
id|tp-&gt;tx_queue_status
(braket
id|MAC_QUEUE
)braket
op_assign
id|NOT_TRANSMITING
suffix:semicolon
id|smctr_update_tx_chain
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_send_rpt_addr
r_static
r_int
id|smctr_send_rpt_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|correlator
)paren
(brace
id|MAC_HEADER
op_star
id|tmf
suffix:semicolon
id|MAC_SUB_VECTOR
op_star
id|tsv
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fcb
op_assign
id|smctr_get_tx_fcb
c_func
(paren
id|dev
comma
id|MAC_QUEUE
comma
r_sizeof
(paren
id|MAC_HEADER
)paren
op_plus
id|S_CORRELATOR
op_plus
id|S_PHYSICAL_DROP
op_plus
id|S_UPSTREAM_NEIGHBOR_ADDRESS
op_plus
id|S_ADDRESS_MODIFER
op_plus
id|S_GROUP_ADDRESS
op_plus
id|S_FUNCTIONAL_ADDRESS
)paren
)paren
op_eq
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|tmf
op_assign
(paren
id|MAC_HEADER
op_star
)paren
id|fcb-&gt;bdb_ptr-&gt;data_block_ptr
suffix:semicolon
id|tmf-&gt;vc
op_assign
id|RPT_ADDR
suffix:semicolon
id|tmf-&gt;dc_sc
op_assign
(paren
id|rmf-&gt;dc_sc
op_amp
id|SC_MASK
)paren
op_lshift
l_int|4
suffix:semicolon
id|tmf-&gt;vl
op_assign
l_int|4
suffix:semicolon
id|smctr_make_8025_hdr
c_func
(paren
id|dev
comma
id|rmf
comma
id|tmf
comma
id|AC_FC_RPT_ADDR
)paren
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
id|smctr_make_corr
c_func
(paren
id|dev
comma
id|tsv
comma
id|correlator
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_phy_drop_num
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_upstream_neighbor_addr
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_addr_mod
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_group_addr
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_funct_addr
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
multiline_comment|/* Subtract out MVID and MVL which is&n;         * include in both vl and MAC_HEADER&n;         */
multiline_comment|/*      fcb-&gt;frame_length           = tmf-&gt;vl + sizeof(MAC_HEADER) - 4;&n;        fcb-&gt;bdb_ptr-&gt;buffer_length = tmf-&gt;vl + sizeof(MAC_HEADER) - 4;&n;*/
id|tmf-&gt;vl
op_assign
id|SWAP_BYTES
c_func
(paren
id|tmf-&gt;vl
)paren
suffix:semicolon
r_return
(paren
id|smctr_trc_send_packet
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
)paren
suffix:semicolon
)brace
DECL|function|smctr_send_rpt_attch
r_static
r_int
id|smctr_send_rpt_attch
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|correlator
)paren
(brace
id|MAC_HEADER
op_star
id|tmf
suffix:semicolon
id|MAC_SUB_VECTOR
op_star
id|tsv
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fcb
op_assign
id|smctr_get_tx_fcb
c_func
(paren
id|dev
comma
id|MAC_QUEUE
comma
r_sizeof
(paren
id|MAC_HEADER
)paren
op_plus
id|S_CORRELATOR
op_plus
id|S_PRODUCT_INSTANCE_ID
op_plus
id|S_FUNCTIONAL_ADDRESS
op_plus
id|S_AUTHORIZED_FUNCTION_CLASS
op_plus
id|S_AUTHORIZED_ACCESS_PRIORITY
)paren
)paren
op_eq
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|tmf
op_assign
(paren
id|MAC_HEADER
op_star
)paren
id|fcb-&gt;bdb_ptr-&gt;data_block_ptr
suffix:semicolon
id|tmf-&gt;vc
op_assign
id|RPT_ATTCH
suffix:semicolon
id|tmf-&gt;dc_sc
op_assign
(paren
id|rmf-&gt;dc_sc
op_amp
id|SC_MASK
)paren
op_lshift
l_int|4
suffix:semicolon
id|tmf-&gt;vl
op_assign
l_int|4
suffix:semicolon
id|smctr_make_8025_hdr
c_func
(paren
id|dev
comma
id|rmf
comma
id|tmf
comma
id|AC_FC_RPT_ATTCH
)paren
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
id|smctr_make_corr
c_func
(paren
id|dev
comma
id|tsv
comma
id|correlator
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_product_id
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_funct_addr
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_auth_funct_class
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_access_pri
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
multiline_comment|/* Subtract out MVID and MVL which is&n;         * include in both vl and MAC_HEADER&n;         */
multiline_comment|/*      fcb-&gt;frame_length           = tmf-&gt;vl + sizeof(MAC_HEADER) - 4;&n;        fcb-&gt;bdb_ptr-&gt;buffer_length = tmf-&gt;vl + sizeof(MAC_HEADER) - 4;&n;*/
id|tmf-&gt;vl
op_assign
id|SWAP_BYTES
c_func
(paren
id|tmf-&gt;vl
)paren
suffix:semicolon
r_return
(paren
id|smctr_trc_send_packet
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
)paren
suffix:semicolon
)brace
DECL|function|smctr_send_rpt_state
r_static
r_int
id|smctr_send_rpt_state
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|correlator
)paren
(brace
id|MAC_HEADER
op_star
id|tmf
suffix:semicolon
id|MAC_SUB_VECTOR
op_star
id|tsv
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fcb
op_assign
id|smctr_get_tx_fcb
c_func
(paren
id|dev
comma
id|MAC_QUEUE
comma
r_sizeof
(paren
id|MAC_HEADER
)paren
op_plus
id|S_CORRELATOR
op_plus
id|S_RING_STATION_VERSION_NUMBER
op_plus
id|S_RING_STATION_STATUS
op_plus
id|S_STATION_IDENTIFER
)paren
)paren
op_eq
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|tmf
op_assign
(paren
id|MAC_HEADER
op_star
)paren
id|fcb-&gt;bdb_ptr-&gt;data_block_ptr
suffix:semicolon
id|tmf-&gt;vc
op_assign
id|RPT_STATE
suffix:semicolon
id|tmf-&gt;dc_sc
op_assign
(paren
id|rmf-&gt;dc_sc
op_amp
id|SC_MASK
)paren
op_lshift
l_int|4
suffix:semicolon
id|tmf-&gt;vl
op_assign
l_int|4
suffix:semicolon
id|smctr_make_8025_hdr
c_func
(paren
id|dev
comma
id|rmf
comma
id|tmf
comma
id|AC_FC_RPT_STATE
)paren
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
id|smctr_make_corr
c_func
(paren
id|dev
comma
id|tsv
comma
id|correlator
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_ring_station_version
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_ring_station_status
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_station_id
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
multiline_comment|/* Subtract out MVID and MVL which is&n;         * include in both vl and MAC_HEADER&n;         */
multiline_comment|/*      fcb-&gt;frame_length           = tmf-&gt;vl + sizeof(MAC_HEADER) - 4;&n;        fcb-&gt;bdb_ptr-&gt;buffer_length = tmf-&gt;vl + sizeof(MAC_HEADER) - 4;&n;*/
id|tmf-&gt;vl
op_assign
id|SWAP_BYTES
c_func
(paren
id|tmf-&gt;vl
)paren
suffix:semicolon
r_return
(paren
id|smctr_trc_send_packet
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
)paren
suffix:semicolon
)brace
DECL|function|smctr_send_rpt_tx_forward
r_static
r_int
id|smctr_send_rpt_tx_forward
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|tx_fstatus
)paren
(brace
id|MAC_HEADER
op_star
id|tmf
suffix:semicolon
id|MAC_SUB_VECTOR
op_star
id|tsv
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fcb
op_assign
id|smctr_get_tx_fcb
c_func
(paren
id|dev
comma
id|MAC_QUEUE
comma
r_sizeof
(paren
id|MAC_HEADER
)paren
op_plus
id|S_TRANSMIT_STATUS_CODE
)paren
)paren
op_eq
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|tmf
op_assign
(paren
id|MAC_HEADER
op_star
)paren
id|fcb-&gt;bdb_ptr-&gt;data_block_ptr
suffix:semicolon
id|tmf-&gt;vc
op_assign
id|RPT_TX_FORWARD
suffix:semicolon
id|tmf-&gt;dc_sc
op_assign
(paren
id|rmf-&gt;dc_sc
op_amp
id|SC_MASK
)paren
op_lshift
l_int|4
suffix:semicolon
id|tmf-&gt;vl
op_assign
l_int|4
suffix:semicolon
id|smctr_make_8025_hdr
c_func
(paren
id|dev
comma
id|rmf
comma
id|tmf
comma
id|AC_FC_RPT_TX_FORWARD
)paren
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
id|smctr_make_tx_status_code
c_func
(paren
id|dev
comma
id|tsv
comma
id|tx_fstatus
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
multiline_comment|/* Subtract out MVID and MVL which is&n;         * include in both vl and MAC_HEADER&n;         */
multiline_comment|/*      fcb-&gt;frame_length           = tmf-&gt;vl + sizeof(MAC_HEADER) - 4;&n;        fcb-&gt;bdb_ptr-&gt;buffer_length = tmf-&gt;vl + sizeof(MAC_HEADER) - 4;&n;*/
id|tmf-&gt;vl
op_assign
id|SWAP_BYTES
c_func
(paren
id|tmf-&gt;vl
)paren
suffix:semicolon
r_return
id|smctr_trc_send_packet
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
suffix:semicolon
)brace
DECL|function|smctr_send_rsp
r_static
r_int
id|smctr_send_rsp
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
id|rcode
comma
id|__u16
id|correlator
)paren
(brace
id|MAC_HEADER
op_star
id|tmf
suffix:semicolon
id|MAC_SUB_VECTOR
op_star
id|tsv
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fcb
op_assign
id|smctr_get_tx_fcb
c_func
(paren
id|dev
comma
id|MAC_QUEUE
comma
r_sizeof
(paren
id|MAC_HEADER
)paren
op_plus
id|S_CORRELATOR
op_plus
id|S_RESPONSE_CODE
)paren
)paren
op_eq
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|tmf
op_assign
(paren
id|MAC_HEADER
op_star
)paren
id|fcb-&gt;bdb_ptr-&gt;data_block_ptr
suffix:semicolon
id|tmf-&gt;vc
op_assign
id|RSP
suffix:semicolon
id|tmf-&gt;dc_sc
op_assign
(paren
id|rmf-&gt;dc_sc
op_amp
id|SC_MASK
)paren
op_lshift
l_int|4
suffix:semicolon
id|tmf-&gt;vl
op_assign
l_int|4
suffix:semicolon
id|smctr_make_8025_hdr
c_func
(paren
id|dev
comma
id|rmf
comma
id|tmf
comma
id|AC_FC_RSP
)paren
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
id|smctr_make_corr
c_func
(paren
id|dev
comma
id|tsv
comma
id|correlator
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_send_rq_init
r_static
r_int
id|smctr_send_rq_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|MAC_HEADER
op_star
id|tmf
suffix:semicolon
id|MAC_SUB_VECTOR
op_star
id|tsv
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_int
r_int
id|i
comma
id|count
op_assign
l_int|0
suffix:semicolon
id|__u16
id|fstatus
suffix:semicolon
r_int
id|err
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
(paren
id|fcb
op_assign
id|smctr_get_tx_fcb
c_func
(paren
id|dev
comma
id|MAC_QUEUE
comma
r_sizeof
(paren
id|MAC_HEADER
)paren
op_plus
id|S_PRODUCT_INSTANCE_ID
op_plus
id|S_UPSTREAM_NEIGHBOR_ADDRESS
op_plus
id|S_RING_STATION_VERSION_NUMBER
op_plus
id|S_ADDRESS_MODIFER
)paren
)paren
op_eq
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|tmf
op_assign
(paren
id|MAC_HEADER
op_star
)paren
id|fcb-&gt;bdb_ptr-&gt;data_block_ptr
suffix:semicolon
id|tmf-&gt;vc
op_assign
id|RQ_INIT
suffix:semicolon
id|tmf-&gt;dc_sc
op_assign
id|DC_RPS
op_or
id|SC_RS
suffix:semicolon
id|tmf-&gt;vl
op_assign
l_int|4
suffix:semicolon
id|smctr_make_8025_hdr
c_func
(paren
id|dev
comma
l_int|0L
comma
id|tmf
comma
id|AC_FC_RQ_INIT
)paren
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
)paren
suffix:semicolon
id|smctr_make_product_id
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_upstream_neighbor_addr
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_ring_station_version
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
id|tsv
op_assign
(paren
id|MAC_SUB_VECTOR
op_star
)paren
(paren
(paren
id|__u32
)paren
id|tsv
op_plus
id|tsv-&gt;svl
)paren
suffix:semicolon
id|smctr_make_addr_mod
c_func
(paren
id|dev
comma
id|tsv
)paren
suffix:semicolon
id|tmf-&gt;vl
op_add_assign
id|tsv-&gt;svl
suffix:semicolon
multiline_comment|/* Subtract out MVID and MVL which is&n;                 * include in both vl and MAC_HEADER&n;                 */
multiline_comment|/*              fcb-&gt;frame_length           = tmf-&gt;vl + sizeof(MAC_HEADER) - 4;&n;                fcb-&gt;bdb_ptr-&gt;buffer_length = tmf-&gt;vl + sizeof(MAC_HEADER) - 4;&n;*/
id|tmf-&gt;vl
op_assign
id|SWAP_BYTES
c_func
(paren
id|tmf-&gt;vl
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_trc_send_packet
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* Wait for Transmit to Complete */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fcb-&gt;frame_status
op_amp
id|FCB_COMMAND_DONE
)paren
(brace
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
multiline_comment|/* Check if GOOD frame Tx&squot;ed */
id|fstatus
op_assign
id|fcb-&gt;frame_status
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fstatus
op_amp
id|FCB_COMMAND_DONE
)paren
)paren
(brace
r_return
(paren
id|HARDWARE_FAILED
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fstatus
op_amp
id|FCB_TX_STATUS_E
)paren
)paren
(brace
id|count
op_increment
suffix:semicolon
)brace
multiline_comment|/* De-allocated Tx FCB and Frame Buffer&n;                 * The FCB must be de-allocated manually if executing with&n;                 * interrupts disabled, other wise the ISR (LM_Service_Events)&n;                 * will de-allocate it when the interrupt occurs.&n;                 */
id|tp-&gt;tx_queue_status
(braket
id|MAC_QUEUE
)braket
op_assign
id|NOT_TRANSMITING
suffix:semicolon
id|smctr_update_tx_chain
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|count
OL
l_int|4
op_logical_and
(paren
(paren
id|fstatus
op_amp
id|FCB_TX_AC_BITS
)paren
op_xor
id|FCB_TX_AC_BITS
)paren
)paren
(brace
suffix:semicolon
)brace
r_return
(paren
id|smctr_join_complete_state
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
)brace
DECL|function|smctr_send_tx_forward
r_static
r_int
id|smctr_send_tx_forward
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_HEADER
op_star
id|rmf
comma
id|__u16
op_star
id|tx_fstatus
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* Check if this is the END POINT of the Transmit Forward Chain. */
r_if
c_cond
(paren
id|rmf-&gt;vl
op_le
l_int|18
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Allocate Transmit FCB only by requesting 0 bytes&n;         * of data buffer.&n;         */
r_if
c_cond
(paren
(paren
id|fcb
op_assign
id|smctr_get_tx_fcb
c_func
(paren
id|dev
comma
id|MAC_QUEUE
comma
l_int|0
)paren
)paren
op_eq
(paren
id|FCBlock
op_star
)paren
(paren
op_minus
l_int|1L
)paren
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Set pointer to Transmit Frame Buffer to the data&n;         * portion of the received TX Forward frame, making&n;         * sure to skip over the Vector Code (vc) and Vector&n;         * length (vl).&n;         */
id|fcb-&gt;bdb_ptr-&gt;trc_data_block_ptr
op_assign
id|TRC_POINTER
c_func
(paren
(paren
id|__u32
)paren
id|rmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
op_plus
l_int|2
)paren
suffix:semicolon
id|fcb-&gt;bdb_ptr-&gt;data_block_ptr
op_assign
(paren
id|__u16
op_star
)paren
(paren
(paren
id|__u32
)paren
id|rmf
op_plus
r_sizeof
(paren
id|MAC_HEADER
)paren
op_plus
l_int|2
)paren
suffix:semicolon
id|fcb-&gt;frame_length
op_assign
id|rmf-&gt;vl
op_minus
l_int|4
op_minus
l_int|2
suffix:semicolon
id|fcb-&gt;bdb_ptr-&gt;buffer_length
op_assign
id|rmf-&gt;vl
op_minus
l_int|4
op_minus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_trc_send_packet
c_func
(paren
id|dev
comma
id|fcb
comma
id|MAC_QUEUE
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* Wait for Transmit to Complete */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fcb-&gt;frame_status
op_amp
id|FCB_COMMAND_DONE
)paren
(brace
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
multiline_comment|/* Check if GOOD frame Tx&squot;ed */
r_if
c_cond
(paren
op_logical_neg
(paren
id|fcb-&gt;frame_status
op_amp
id|FCB_COMMAND_DONE
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_resume_tx_fcb_cmd
c_func
(paren
id|dev
comma
id|MAC_QUEUE
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fcb-&gt;frame_status
op_amp
id|FCB_COMMAND_DONE
)paren
(brace
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fcb-&gt;frame_status
op_amp
id|FCB_COMMAND_DONE
)paren
)paren
(brace
r_return
(paren
id|HARDWARE_FAILED
)paren
suffix:semicolon
)brace
)brace
op_star
id|tx_fstatus
op_assign
id|fcb-&gt;frame_status
suffix:semicolon
r_return
(paren
id|A_FRAME_WAS_FORWARDED
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_auth_access_pri
r_static
r_int
id|smctr_set_auth_access_pri
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|rsv-&gt;svl
op_ne
id|S_AUTHORIZED_ACCESS_PRIORITY
)paren
(brace
r_return
(paren
id|E_SUB_VECTOR_LENGTH_ERROR
)paren
suffix:semicolon
)brace
id|tp-&gt;authorized_access_priority
op_assign
(paren
id|rsv-&gt;svv
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|rsv-&gt;svv
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
(paren
id|POSITIVE_ACK
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_auth_funct_class
r_static
r_int
id|smctr_set_auth_funct_class
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|rsv-&gt;svl
op_ne
id|S_AUTHORIZED_FUNCTION_CLASS
)paren
(brace
r_return
(paren
id|E_SUB_VECTOR_LENGTH_ERROR
)paren
suffix:semicolon
)brace
id|tp-&gt;authorized_function_classes
op_assign
(paren
id|rsv-&gt;svv
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|rsv-&gt;svv
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
(paren
id|POSITIVE_ACK
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_corr
r_static
r_int
id|smctr_set_corr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
comma
id|__u16
op_star
id|correlator
)paren
(brace
r_if
c_cond
(paren
id|rsv-&gt;svl
op_ne
id|S_CORRELATOR
)paren
(brace
r_return
(paren
id|E_SUB_VECTOR_LENGTH_ERROR
)paren
suffix:semicolon
)brace
op_star
id|correlator
op_assign
(paren
id|rsv-&gt;svv
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|rsv-&gt;svv
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
(paren
id|POSITIVE_ACK
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_error_timer_value
r_static
r_int
id|smctr_set_error_timer_value
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
)paren
(brace
id|__u16
id|err_tval
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rsv-&gt;svl
op_ne
id|S_ERROR_TIMER_VALUE
)paren
(brace
r_return
(paren
id|E_SUB_VECTOR_LENGTH_ERROR
)paren
suffix:semicolon
)brace
id|err_tval
op_assign
(paren
id|rsv-&gt;svv
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|rsv-&gt;svv
(braket
l_int|1
)braket
)paren
op_star
l_int|10
suffix:semicolon
id|smctr_issue_write_word_cmd
c_func
(paren
id|dev
comma
id|RW_TER_THRESHOLD
comma
op_amp
id|err_tval
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_return
(paren
id|POSITIVE_ACK
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_frame_forward
r_static
r_int
id|smctr_set_frame_forward
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
comma
id|__u8
id|dc_sc
)paren
(brace
r_if
c_cond
(paren
(paren
id|rsv-&gt;svl
OL
l_int|2
)paren
op_logical_or
(paren
id|rsv-&gt;svl
OG
id|S_FRAME_FORWARD
)paren
)paren
(brace
r_return
(paren
id|E_SUB_VECTOR_LENGTH_ERROR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dc_sc
op_amp
id|DC_MASK
)paren
op_ne
id|DC_CRS
)paren
(brace
r_if
c_cond
(paren
id|rsv-&gt;svl
op_ge
l_int|2
op_logical_and
id|rsv-&gt;svl
OL
l_int|20
)paren
(brace
r_return
(paren
id|E_TRANSMIT_FORWARD_INVALID
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rsv-&gt;svv
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
op_logical_or
(paren
id|rsv-&gt;svv
(braket
l_int|1
)braket
op_ne
l_int|0
)paren
)paren
(brace
r_return
(paren
id|E_TRANSMIT_FORWARD_INVALID
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
id|POSITIVE_ACK
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_local_ring_num
r_static
r_int
id|smctr_set_local_ring_num
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|rsv-&gt;svl
op_ne
id|S_LOCAL_RING_NUMBER
)paren
(brace
r_return
(paren
id|E_SUB_VECTOR_LENGTH_ERROR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;ptr_local_ring_num
)paren
(brace
op_star
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ptr_local_ring_num
)paren
op_assign
(paren
id|rsv-&gt;svv
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|rsv-&gt;svv
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_return
(paren
id|POSITIVE_ACK
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_ctrl_attention
r_static
r_int
r_int
id|smctr_set_ctrl_attention
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;bic_type
op_eq
id|BIC_585_CHIP
)paren
(brace
id|outb
c_func
(paren
(paren
id|tp-&gt;trc_mask
op_or
id|HWR_CA
)paren
comma
id|ioaddr
op_plus
id|HWR
)paren
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
(paren
id|tp-&gt;trc_mask
op_or
id|CSR_CA
)paren
comma
id|ioaddr
op_plus
id|CSR
)paren
suffix:semicolon
id|outb
c_func
(paren
id|tp-&gt;trc_mask
comma
id|ioaddr
op_plus
id|CSR
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_multicast_list
r_static
r_void
id|smctr_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_set_multicast_list&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|smctr_set_page
r_static
r_int
id|smctr_set_page
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u8
op_star
id|buf
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
id|amask
suffix:semicolon
id|__u32
id|tptr
suffix:semicolon
id|tptr
op_assign
(paren
id|__u32
)paren
id|buf
op_minus
(paren
id|__u32
)paren
id|tp-&gt;ram_access
suffix:semicolon
id|amask
op_assign
(paren
id|__u8
)paren
(paren
(paren
id|tptr
op_amp
id|PR_PAGE_MASK
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|outb
c_func
(paren
id|amask
comma
id|dev-&gt;base_addr
op_plus
id|PR
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_phy_drop
r_static
r_int
id|smctr_set_phy_drop
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|MAC_SUB_VECTOR
op_star
id|rsv
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rsv-&gt;svl
op_ne
id|S_PHYSICAL_DROP
)paren
(brace
r_return
(paren
id|E_SUB_VECTOR_LENGTH_ERROR
)paren
suffix:semicolon
)brace
id|smctr_issue_write_byte_cmd
c_func
(paren
id|dev
comma
id|RW_PHYSICAL_DROP_NUMBER
comma
op_amp
id|rsv-&gt;svv
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_return
(paren
id|POSITIVE_ACK
)paren
suffix:semicolon
)brace
multiline_comment|/* Reset the ring speed to the oposite of what it was. This auto-pilot&n; * mode requires a complete reset and re-init of the adapter.&n; */
DECL|function|smctr_set_ring_speed
r_static
r_int
id|smctr_set_ring_speed
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;media_type
op_eq
id|MEDIA_UTP_16
)paren
(brace
id|tp-&gt;media_type
op_assign
id|MEDIA_UTP_4
suffix:semicolon
)brace
r_else
id|tp-&gt;media_type
op_assign
id|MEDIA_UTP_16
suffix:semicolon
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Re-Initialize adapter&squot;s internal registers */
id|smctr_reset_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_init_card_real
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|smctr_enable_bic_int
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_issue_enable_int_cmd
c_func
(paren
id|dev
comma
id|TRC_INTERRUPT_ENABLE_MASK
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_rx_look_ahead
r_static
r_int
id|smctr_set_rx_look_ahead
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u16
id|sword
comma
id|rword
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_set_rx_look_ahead_flag&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|tp-&gt;adapter_flags
op_and_assign
op_complement
(paren
id|FORCED_16BIT_MODE
)paren
suffix:semicolon
id|tp-&gt;adapter_flags
op_or_assign
id|RX_VALID_LOOKAHEAD
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;adapter_bus
op_eq
id|BUS_ISA16_TYPE
)paren
(brace
id|sword
op_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
)paren
)paren
suffix:semicolon
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
)paren
)paren
op_assign
l_int|0x1234
suffix:semicolon
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rword
op_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
)paren
)paren
suffix:semicolon
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rword
op_ne
l_int|0x1234
)paren
(brace
id|tp-&gt;adapter_flags
op_or_assign
id|FORCED_16BIT_MODE
suffix:semicolon
)brace
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|tp-&gt;ram_access
)paren
)paren
op_assign
id|sword
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_set_trc_reset
r_static
r_int
id|smctr_set_trc_reset
c_func
(paren
r_int
id|ioaddr
)paren
(brace
id|__u8
id|r
suffix:semicolon
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|MSR
)paren
suffix:semicolon
id|outb
c_func
(paren
id|MSR_RST
op_or
id|r
comma
id|ioaddr
op_plus
id|MSR
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This function can be called if the adapter is busy or not.&n; */
DECL|function|smctr_setup_single_cmd
r_static
r_int
id|smctr_setup_single_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|command
comma
id|__u16
id|subcommand
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_setup_single_cmd&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_wait_while_cbusy
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
(paren
r_int
r_int
)paren
id|smctr_wait_cmd
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
id|tp-&gt;acb_head-&gt;cmd_done_status
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;acb_head-&gt;cmd
op_assign
id|command
suffix:semicolon
id|tp-&gt;acb_head-&gt;subcmd
op_assign
id|subcommand
suffix:semicolon
id|err
op_assign
id|smctr_issue_resume_acb_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This function can not be called with the adapter busy.&n; */
DECL|function|smctr_setup_single_cmd_w_data
r_static
r_int
id|smctr_setup_single_cmd_w_data
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|command
comma
id|__u16
id|subcommand
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|tp-&gt;acb_head-&gt;cmd_done_status
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;acb_head-&gt;cmd
op_assign
id|command
suffix:semicolon
id|tp-&gt;acb_head-&gt;subcmd
op_assign
id|subcommand
suffix:semicolon
id|tp-&gt;acb_head-&gt;data_offset_lo
op_assign
(paren
id|__u16
)paren
id|TRC_POINTER
c_func
(paren
id|tp-&gt;misc_command_data
)paren
suffix:semicolon
r_return
id|smctr_issue_resume_acb_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|smctr_malloc
r_static
r_char
op_star
id|smctr_malloc
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|size
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_char
op_star
id|m
suffix:semicolon
id|m
op_assign
(paren
r_char
op_star
)paren
(paren
id|tp-&gt;ram_access
op_plus
id|tp-&gt;sh_mem_used
)paren
suffix:semicolon
id|tp-&gt;sh_mem_used
op_add_assign
(paren
id|__u32
)paren
id|size
suffix:semicolon
r_return
(paren
id|m
)paren
suffix:semicolon
)brace
DECL|function|smctr_status_chg
r_static
r_int
id|smctr_status_chg
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_status_chg&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|tp-&gt;status
)paren
(brace
r_case
id|OPEN
suffix:colon
r_break
suffix:semicolon
r_case
id|CLOSED
suffix:colon
r_break
suffix:semicolon
multiline_comment|/* Interrupt driven open() completion. XXX */
r_case
id|INITIALIZED
suffix:colon
id|tp-&gt;group_address_0
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;group_address
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;group_address
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;functional_address_0
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;functional_address
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;functional_address
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|smctr_open_tr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: status change unknown %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_trc_send_packet
r_static
r_int
id|smctr_trc_send_packet
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|FCBlock
op_star
id|fcb
comma
id|__u16
id|queue
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_trc_send_packet&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|fcb-&gt;info
op_assign
id|FCB_CHAIN_END
op_or
id|FCB_ENABLE_TFS
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;num_tx_fcbs
(braket
id|queue
)braket
op_ne
l_int|1
)paren
(brace
id|fcb-&gt;back_ptr-&gt;info
op_assign
id|FCB_INTERRUPT_ENABLE
op_or
id|FCB_ENABLE_TFS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;tx_queue_status
(braket
id|queue
)braket
op_eq
id|NOT_TRANSMITING
)paren
(brace
id|tp-&gt;tx_queue_status
(braket
id|queue
)braket
op_assign
id|TRANSMITING
suffix:semicolon
id|err
op_assign
id|smctr_issue_resume_tx_fcb_cmd
c_func
(paren
id|dev
comma
id|queue
)paren
suffix:semicolon
)brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_tx_complete
r_static
id|__u16
id|smctr_tx_complete
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u16
id|status
comma
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|cstatus
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_tx_complete&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|status
op_assign
id|tp-&gt;tx_fcb_end
(braket
id|queue
)braket
op_member_access_from_pointer
id|frame_status
)paren
op_ne
id|SUCCESS
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x7e00
)paren
(brace
id|err
op_assign
id|HARDWARE_FAILED
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|smctr_update_tx_chain
c_func
(paren
id|dev
comma
id|tp-&gt;tx_fcb_end
(braket
id|queue
)braket
comma
id|queue
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
id|smctr_disable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mode_bits
op_amp
id|UMAC
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
(paren
id|FCB_TX_STATUS_AR1
op_or
id|FCB_TX_STATUS_AR2
)paren
)paren
)paren
(brace
id|cstatus
op_assign
id|NO_SUCH_DESTINATION
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
(paren
id|FCB_TX_STATUS_CR1
op_or
id|FCB_TX_STATUS_CR2
)paren
)paren
)paren
(brace
id|cstatus
op_assign
id|DEST_OUT_OF_RESOURCES
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|status
op_amp
id|FCB_TX_STATUS_E
)paren
(brace
id|cstatus
op_assign
id|MAX_COLLISIONS
suffix:semicolon
)brace
r_else
id|cstatus
op_assign
id|SUCCESS
suffix:semicolon
)brace
)brace
)brace
r_else
id|cstatus
op_assign
id|SUCCESS
suffix:semicolon
r_if
c_cond
(paren
id|queue
op_eq
id|BUG_QUEUE
)paren
(brace
id|err
op_assign
id|SUCCESS
suffix:semicolon
)brace
id|smctr_enable_16bit
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
id|SUCCESS
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|function|smctr_tx_move_frame
r_static
r_int
r_int
id|smctr_tx_move_frame
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|__u8
op_star
id|pbuff
comma
r_int
r_int
id|bytes
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|ram_usable
suffix:semicolon
id|__u32
id|flen
comma
id|len
comma
id|offset
op_assign
l_int|0
suffix:semicolon
id|__u8
op_star
id|frag
comma
op_star
id|page
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_tx_move_frame&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|ram_usable
op_assign
(paren
(paren
r_int
r_int
)paren
id|tp-&gt;ram_usable
)paren
op_lshift
l_int|10
suffix:semicolon
id|frag
op_assign
id|skb-&gt;data
suffix:semicolon
id|flen
op_assign
id|skb-&gt;len
suffix:semicolon
r_while
c_loop
(paren
id|flen
OG
l_int|0
op_logical_and
id|bytes
OG
l_int|0
)paren
(brace
id|smctr_set_page
c_func
(paren
id|dev
comma
id|pbuff
)paren
suffix:semicolon
id|offset
op_assign
id|SMC_PAGE_OFFSET
c_func
(paren
id|pbuff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_plus
id|flen
OG
id|ram_usable
)paren
(brace
id|len
op_assign
id|ram_usable
op_minus
id|offset
suffix:semicolon
)brace
r_else
id|len
op_assign
id|flen
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|bytes
)paren
(brace
id|len
op_assign
id|bytes
suffix:semicolon
)brace
id|page
op_assign
(paren
r_char
op_star
)paren
(paren
id|offset
op_plus
id|tp-&gt;ram_access
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|page
comma
id|frag
comma
id|len
)paren
suffix:semicolon
id|flen
op_sub_assign
id|len
suffix:semicolon
id|bytes
op_sub_assign
id|len
suffix:semicolon
id|frag
op_add_assign
id|len
suffix:semicolon
id|pbuff
op_add_assign
id|len
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Update the error statistic counters for this adapter. */
DECL|function|smctr_update_err_stats
r_static
r_int
id|smctr_update_err_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tr_statistics
op_star
id|tstat
op_assign
op_amp
id|tp-&gt;MacStat
suffix:semicolon
r_if
c_cond
(paren
id|tstat-&gt;internal_errors
)paren
(brace
id|tstat-&gt;internal_errors
op_add_assign
op_star
(paren
id|tp-&gt;misc_command_data
op_plus
l_int|0
)paren
op_amp
l_int|0x00ff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tstat-&gt;line_errors
)paren
(brace
id|tstat-&gt;line_errors
op_add_assign
op_star
(paren
id|tp-&gt;misc_command_data
op_plus
l_int|0
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tstat-&gt;A_C_errors
)paren
(brace
id|tstat-&gt;A_C_errors
op_add_assign
op_star
(paren
id|tp-&gt;misc_command_data
op_plus
l_int|1
)paren
op_amp
l_int|0x00ff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tstat-&gt;burst_errors
)paren
(brace
id|tstat-&gt;burst_errors
op_add_assign
op_star
(paren
id|tp-&gt;misc_command_data
op_plus
l_int|1
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tstat-&gt;abort_delimiters
)paren
(brace
id|tstat-&gt;abort_delimiters
op_add_assign
op_star
(paren
id|tp-&gt;misc_command_data
op_plus
l_int|2
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tstat-&gt;recv_congest_count
)paren
(brace
id|tstat-&gt;recv_congest_count
op_add_assign
op_star
(paren
id|tp-&gt;misc_command_data
op_plus
l_int|3
)paren
op_amp
l_int|0x00ff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tstat-&gt;lost_frames
)paren
(brace
id|tstat-&gt;lost_frames
op_add_assign
op_star
(paren
id|tp-&gt;misc_command_data
op_plus
l_int|3
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tstat-&gt;frequency_errors
)paren
(brace
id|tstat-&gt;frequency_errors
op_add_assign
op_star
(paren
id|tp-&gt;misc_command_data
op_plus
l_int|4
)paren
op_amp
l_int|0x00ff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tstat-&gt;frame_copied_errors
)paren
(brace
id|tstat-&gt;frame_copied_errors
op_add_assign
op_star
(paren
id|tp-&gt;misc_command_data
op_plus
l_int|4
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tstat-&gt;token_errors
)paren
(brace
id|tstat-&gt;token_errors
op_add_assign
op_star
(paren
id|tp-&gt;misc_command_data
op_plus
l_int|5
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_update_rx_chain
r_static
r_int
id|smctr_update_rx_chain
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|__u16
id|queue
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|FCBlock
op_star
id|fcb
suffix:semicolon
id|BDBlock
op_star
id|bdb
suffix:semicolon
id|__u16
id|size
comma
id|len
suffix:semicolon
id|fcb
op_assign
id|tp-&gt;rx_fcb_curr
(braket
id|queue
)braket
suffix:semicolon
id|len
op_assign
id|fcb-&gt;frame_length
suffix:semicolon
id|fcb-&gt;frame_status
op_assign
l_int|0
suffix:semicolon
id|fcb-&gt;info
op_assign
id|FCB_CHAIN_END
suffix:semicolon
id|fcb-&gt;back_ptr-&gt;info
op_assign
id|FCB_WARNING
suffix:semicolon
id|tp-&gt;rx_fcb_curr
(braket
id|queue
)braket
op_assign
id|tp-&gt;rx_fcb_curr
(braket
id|queue
)braket
op_member_access_from_pointer
id|next_ptr
suffix:semicolon
multiline_comment|/* update RX BDBs */
id|size
op_assign
(paren
id|len
op_rshift
id|RX_BDB_SIZE_SHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_amp
id|RX_DATA_BUFFER_SIZE_MASK
)paren
(brace
id|size
op_add_assign
r_sizeof
(paren
id|BDBlock
)paren
suffix:semicolon
)brace
id|size
op_and_assign
(paren
op_complement
id|RX_BDB_SIZE_MASK
)paren
suffix:semicolon
multiline_comment|/* check if wrap around */
id|bdb
op_assign
(paren
id|BDBlock
op_star
)paren
(paren
(paren
id|__u32
)paren
(paren
id|tp-&gt;rx_bdb_curr
(braket
id|queue
)braket
)paren
op_plus
(paren
id|__u32
)paren
(paren
id|size
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|__u32
)paren
id|bdb
op_ge
(paren
id|__u32
)paren
id|tp-&gt;rx_bdb_end
(braket
id|queue
)braket
)paren
(brace
id|bdb
op_assign
(paren
id|BDBlock
op_star
)paren
(paren
(paren
id|__u32
)paren
(paren
id|tp-&gt;rx_bdb_head
(braket
id|queue
)braket
)paren
op_plus
(paren
id|__u32
)paren
(paren
id|bdb
)paren
op_minus
(paren
id|__u32
)paren
(paren
id|tp-&gt;rx_bdb_end
(braket
id|queue
)braket
)paren
)paren
suffix:semicolon
)brace
id|bdb-&gt;back_ptr-&gt;info
op_assign
id|BDB_CHAIN_END
suffix:semicolon
id|tp-&gt;rx_bdb_curr
(braket
id|queue
)braket
op_member_access_from_pointer
id|back_ptr-&gt;info
op_assign
id|BDB_NOT_CHAIN_END
suffix:semicolon
id|tp-&gt;rx_bdb_curr
(braket
id|queue
)braket
op_assign
id|bdb
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_update_tx_chain
r_static
r_int
id|smctr_update_tx_chain
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|FCBlock
op_star
id|fcb
comma
id|__u16
id|queue
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|20
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;smctr_update_tx_chain&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;num_tx_fcbs_used
(braket
id|queue
)braket
op_le
l_int|0
)paren
(brace
r_return
(paren
id|HARDWARE_FAILED
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tp-&gt;tx_buff_used
(braket
id|queue
)braket
OL
id|fcb-&gt;memory_alloc
)paren
(brace
id|tp-&gt;tx_buff_used
(braket
id|queue
)braket
op_assign
l_int|0
suffix:semicolon
r_return
(paren
id|HARDWARE_FAILED
)paren
suffix:semicolon
)brace
id|tp-&gt;tx_buff_used
(braket
id|queue
)braket
op_sub_assign
id|fcb-&gt;memory_alloc
suffix:semicolon
multiline_comment|/* if all transmit buffer are cleared&n;                 * need to set the tx_buff_curr[] to tx_buff_head[]&n;                 * otherwise, tx buffer will be segregate and cannot&n;                 * accomodate and buffer greater than (curr - head) and&n;                 * (end - curr) since we do not allow wrap around allocation.&n;                 */
r_if
c_cond
(paren
id|tp-&gt;tx_buff_used
(braket
id|queue
)braket
op_eq
l_int|0
)paren
(brace
id|tp-&gt;tx_buff_curr
(braket
id|queue
)braket
op_assign
id|tp-&gt;tx_buff_head
(braket
id|queue
)braket
suffix:semicolon
)brace
id|tp-&gt;num_tx_fcbs_used
(braket
id|queue
)braket
op_decrement
suffix:semicolon
id|fcb-&gt;frame_status
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_fcb_end
(braket
id|queue
)braket
op_assign
id|fcb-&gt;next_ptr
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|smctr_wait_cmd
r_static
r_int
id|smctr_wait_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|loop_count
op_assign
l_int|0x20000
suffix:semicolon
r_if
c_cond
(paren
id|smctr_debug
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: smctr_wait_cmd&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|loop_count
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;acb_head-&gt;cmd_done_status
op_amp
id|ACB_COMMAND_DONE
)paren
(brace
r_break
suffix:semicolon
)brace
id|loop_count
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|loop_count
op_eq
l_int|0
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;acb_head-&gt;cmd_done_status
op_amp
l_int|0xff
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smctr_wait_while_cbusy
r_static
r_int
id|smctr_wait_while_cbusy
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|timeout
op_assign
l_int|0x20000
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|__u8
id|r
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;bic_type
op_eq
id|BIC_585_CHIP
)paren
(brace
r_while
c_loop
(paren
id|timeout
)paren
(brace
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|HWR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_amp
id|HWR_CBUSY
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
id|timeout
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
id|timeout
)paren
(brace
id|r
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CSR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_amp
id|CSR_CBUSY
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
id|timeout
op_decrement
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|timeout
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|variable|dev_smctr
r_static
r_struct
id|net_device
op_star
id|dev_smctr
(braket
id|SMCTR_MAX_ADAPTERS
)braket
suffix:semicolon
DECL|variable|io
r_static
r_int
id|io
(braket
id|SMCTR_MAX_ADAPTERS
)braket
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
(braket
id|SMCTR_MAX_ADAPTERS
)braket
suffix:semicolon
DECL|variable|mem
r_static
r_int
id|mem
(braket
id|SMCTR_MAX_ADAPTERS
)braket
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SMCTR_MAX_ADAPTERS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SMCTR_MAX_ADAPTERS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mem
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SMCTR_MAX_ADAPTERS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ringspeed
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SMCTR_MAX_ADAPTERS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SMCTR_MAX_ADAPTERS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|mem
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|dev_smctr
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev_smctr
(braket
id|i
)braket
op_assign
id|init_trdev
c_func
(paren
id|dev_smctr
(braket
id|i
)braket
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_smctr
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
)brace
id|dev_smctr
(braket
id|i
)braket
op_member_access_from_pointer
id|base_addr
op_assign
id|io
(braket
id|i
)braket
suffix:semicolon
id|dev_smctr
(braket
id|i
)braket
op_member_access_from_pointer
id|irq
op_assign
id|irq
(braket
id|i
)braket
suffix:semicolon
id|dev_smctr
(braket
id|i
)braket
op_member_access_from_pointer
id|mem_start
op_assign
id|mem
(braket
id|i
)braket
suffix:semicolon
id|dev_smctr
(braket
id|i
)braket
op_member_access_from_pointer
id|init
op_assign
op_amp
id|smctr_probe
suffix:semicolon
r_if
c_cond
(paren
id|register_trdev
c_func
(paren
id|dev_smctr
(braket
id|i
)braket
)paren
op_ne
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|dev_smctr
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev_smctr
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: register_trdev() returned (&lt;0).&bslash;n&quot;
comma
id|cardname
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EIO
)paren
suffix:semicolon
)brace
r_else
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SMCTR_MAX_ADAPTERS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev_smctr
(braket
id|i
)braket
)paren
(brace
macro_line|#ifdef CONFIG_MCA
r_struct
id|net_local
op_star
id|tp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev_smctr
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;slot_num
)paren
(brace
id|mca_mark_as_unused
c_func
(paren
id|tp-&gt;slot_num
)paren
suffix:semicolon
)brace
macro_line|#endif
id|unregister_trdev
c_func
(paren
id|dev_smctr
(braket
id|i
)braket
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev_smctr
(braket
id|i
)braket
op_member_access_from_pointer
id|base_addr
comma
id|SMCTR_IO_EXTENT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_smctr
(braket
id|i
)braket
op_member_access_from_pointer
id|irq
)paren
(brace
id|free_irq
c_func
(paren
id|dev_smctr
(braket
id|i
)braket
op_member_access_from_pointer
id|irq
comma
id|dev_smctr
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_smctr
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
)paren
(brace
id|kfree
c_func
(paren
id|dev_smctr
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|dev_smctr
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev_smctr
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* MODULE */
eof
