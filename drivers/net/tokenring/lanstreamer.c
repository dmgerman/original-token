multiline_comment|/*&n; *   lanstreamer.c -- driver for the IBM Auto LANStreamer PCI Adapter&n; *&n; *  Written By: Mike Sullivan, IBM Corporation&n; *&n; *  Copyright (C) 1999 IBM Corporation&n; *&n; *  Linux driver for IBM PCI tokenring cards based on the LanStreamer MPC&n; *  chipset. &n; *&n; *  This driver is based on the olympic driver for IBM PCI TokenRing cards (Pit/Pit-Phy/Olympic&n; *  chipsets) written  by:&n; *      1999 Peter De Schrijver All Rights Reserved&n; *&t;1999 Mike Phillips (phillim@amtrak.com)&n; *&n; *  Base Driver Skeleton:&n; *      Written 1993-94 by Donald Becker.&n; *&n; *      Copyright 1993 United States Government as represented by the&n; *      Director, National Security Agency.&n; *&n; * This program is free software; you can redistribute it and/or modify      &n; * it under the terms of the GNU General Public License as published by      &n; * the Free Software Foundation; either version 2 of the License, or         &n; * (at your option) any later version.                                       &n; *                                                                           &n; * This program is distributed in the hope that it will be useful,           &n; * but WITHOUT ANY WARRANTY; without even the implied warranty of            &n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             &n; * GNU General Public License for more details.                              &n; *                                                                           &n; * NO WARRANTY                                                               &n; * THE PROGRAM IS PROVIDED ON AN &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR        &n; * CONDITIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED INCLUDING, WITHOUT      &n; * LIMITATION, ANY WARRANTIES OR CONDITIONS OF TITLE, NON-INFRINGEMENT,      &n; * MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. Each Recipient is    &n; * solely responsible for determining the appropriateness of using and       &n; * distributing the Program and assumes all risks associated with its        &n; * exercise of rights under this Agreement, including but not limited to     &n; * the risks and costs of program errors, damage to or loss of data,         &n; * programs or equipment, and unavailability or interruption of operations.  &n; *                                                                           &n; * DISCLAIMER OF LIABILITY                                                   &n; * NEITHER RECIPIENT NOR ANY CONTRIBUTORS SHALL HAVE ANY LIABILITY FOR ANY   &n; * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL        &n; * DAMAGES (INCLUDING WITHOUT LIMITATION LOST PROFITS), HOWEVER CAUSED AND   &n; * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR     &n; * TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE    &n; * USE OR DISTRIBUTION OF THE PROGRAM OR THE EXERCISE OF ANY RIGHTS GRANTED  &n; * HEREUNDER, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGES             &n; *                                                                           &n; * You should have received a copy of the GNU General Public License         &n; * along with this program; if not, write to the Free Software               &n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA &n; *                                                                           &n; * &n; *  12/10/99 - Alpha Release 0.1.0&n; *            First release to the public&n; *  03/03/00 - Merged to kernel, indented -kr -i8 -bri0, fixed some missing&n; *&t;&t;malloc free checks, reviewed code. &lt;alan@redhat.com&gt;&n; *  03/13/00 - Added spinlocks for smp&n; *  &n; *  To Do:&n; *&n; *  1) Test Network Monitor Mode&n; *  2) Add auto reset logic on adapter errors&n; *  3) Test with varying options&n; *&n; *  If Problems do Occur&n; *  Most problems can be rectified by either closing and opening the interface&n; *  (ifconfig down and up) or rmmod and insmod&squot;ing the driver (a bit difficult&n; *  if compiled into the kernel).&n; */
multiline_comment|/* Change STREAMER_DEBUG to 1 to get verbose, and I mean really verbose, messages */
DECL|macro|STREAMER_DEBUG
mdefine_line|#define STREAMER_DEBUG 0
DECL|macro|STREAMER_DEBUG_PACKETS
mdefine_line|#define STREAMER_DEBUG_PACKETS 0
multiline_comment|/* Change STREAMER_NETWORK_MONITOR to receive mac frames through the arb channel.&n; * Will also create a /proc/net/streamer_tr entry if proc_fs is compiled into the&n; * kernel.&n; * Intended to be used to create a ring-error reporting network module &n; * i.e. it will give you the source address of beaconers on the ring &n; */
DECL|macro|STREAMER_NETWORK_MONITOR
mdefine_line|#define STREAMER_NETWORK_MONITOR 0
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/trdevice.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;net/checksum.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &quot;lanstreamer.h&quot;
multiline_comment|/* I&squot;ve got to put some intelligence into the version number so that Peter and I know&n; * which version of the code somebody has got. &n; * Version Number = a.b.c.d  where a.b.c is the level of code and d is the latest author.&n; * So 0.0.1.pds = Peter, 0.0.1.mlp = Mike&n; * &n; * Official releases will only have an a.b.c version number format.&n; */
DECL|variable|version
r_static
r_char
op_star
id|version
op_assign
l_string|&quot;LanStreamer.c v0.3.1 03/13/99 - Mike Sullivan&quot;
suffix:semicolon
DECL|variable|open_maj_error
r_static
r_char
op_star
id|open_maj_error
(braket
)braket
op_assign
(brace
l_string|&quot;No error&quot;
comma
l_string|&quot;Lobe Media Test&quot;
comma
l_string|&quot;Physical Insertion&quot;
comma
l_string|&quot;Address Verification&quot;
comma
l_string|&quot;Neighbor Notification (Ring Poll)&quot;
comma
l_string|&quot;Request Parameters&quot;
comma
l_string|&quot;FDX Registration Request&quot;
comma
l_string|&quot;FDX Lobe Media Test&quot;
comma
l_string|&quot;FDX Duplicate Address Check&quot;
comma
l_string|&quot;Unknown stage&quot;
)brace
suffix:semicolon
DECL|variable|open_min_error
r_static
r_char
op_star
id|open_min_error
(braket
)braket
op_assign
(brace
l_string|&quot;No error&quot;
comma
l_string|&quot;Function Failure&quot;
comma
l_string|&quot;Signal Lost&quot;
comma
l_string|&quot;Wire Fault&quot;
comma
l_string|&quot;Ring Speed Mismatch&quot;
comma
l_string|&quot;Timeout&quot;
comma
l_string|&quot;Ring Failure&quot;
comma
l_string|&quot;Ring Beaconing&quot;
comma
l_string|&quot;Duplicate Node Address&quot;
comma
l_string|&quot;Request Parameters&quot;
comma
l_string|&quot;Remove Received&quot;
comma
l_string|&quot;Reserved&quot;
comma
l_string|&quot;Reserved&quot;
comma
l_string|&quot;No Monitor Detected for RPL&quot;
comma
l_string|&quot;Monitor Contention failer for RPL&quot;
comma
l_string|&quot;FDX Protocol Error&quot;
)brace
suffix:semicolon
multiline_comment|/* Module paramters */
multiline_comment|/* Ring Speed 0,4,16&n; * 0 = Autosense         &n; * 4,16 = Selected speed only, no autosense&n; * This allows the card to be the first on the ring&n; * and become the active monitor.&n; *&n; * WARNING: Some hubs will allow you to insert&n; * at the wrong speed&n; */
DECL|variable|ringspeed
r_static
r_int
id|ringspeed
(braket
id|STREAMER_MAX_ADAPTERS
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ringspeed
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|STREAMER_MAX_ADAPTERS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* Packet buffer size */
DECL|variable|pkt_buf_sz
r_static
r_int
id|pkt_buf_sz
(braket
id|STREAMER_MAX_ADAPTERS
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pkt_buf_sz
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|STREAMER_MAX_ADAPTERS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* Message Level */
DECL|variable|message_level
r_static
r_int
id|message_level
(braket
id|STREAMER_MAX_ADAPTERS
)braket
op_assign
(brace
l_int|1
comma
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|message_level
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|STREAMER_MAX_ADAPTERS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
r_static
r_int
id|streamer_scan
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|streamer_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|streamer_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|streamer_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|streamer_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|streamer_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|streamer_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|streamer_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|streamer_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|addr
)paren
suffix:semicolon
r_static
r_void
id|streamer_arb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|streamer_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|mtu
)paren
suffix:semicolon
r_static
r_void
id|streamer_srb_bh
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|streamer_asb_bh
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#if STREAMER_NETWORK_MONITOR
macro_line|#ifdef CONFIG_PROC_FS
r_static
r_int
id|sprintf_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
DECL|function|streamer_probe
r_int
id|__init
id|streamer_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|cards_found
suffix:semicolon
id|cards_found
op_assign
id|streamer_scan
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|cards_found
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|streamer_scan
r_static
r_int
id|__init
id|streamer_scan
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_device
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|streamer_private
op_star
id|streamer_priv
suffix:semicolon
r_int
id|card_no
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pci_present
c_func
(paren
)paren
)paren
(brace
r_while
c_loop
(paren
(paren
id|pci_device
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_IBM
comma
id|PCI_DEVICE_ID_IBM_TR
comma
id|pci_device
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pci_device
)paren
)paren
r_continue
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci_device
)paren
suffix:semicolon
multiline_comment|/* Check to see if io has been allocated, if so, we&squot;ve already done this card,&n;&t;&t;&t;   so continue on the card discovery loop  */
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci_device
comma
l_int|0
)paren
comma
id|STREAMER_IO_SPACE
)paren
)paren
(brace
id|card_no
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|streamer_priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|streamer_private
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|streamer_priv
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;lanstreamer: out of memory.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memset
c_func
(paren
id|streamer_priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|streamer_private
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|streamer_priv-&gt;srb_wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|streamer_priv-&gt;trb_wait
)paren
suffix:semicolon
macro_line|#ifndef MODULE
id|dev
op_assign
id|init_trdev
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|streamer_priv
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;lanstreamer: out of memory.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
id|dev-&gt;priv
op_assign
(paren
r_void
op_star
)paren
id|streamer_priv
suffix:semicolon
macro_line|#if STREAMER_DEBUG
id|printk
c_func
(paren
l_string|&quot;pci_device: %p, dev:%p, dev-&gt;priv: %p&bslash;n&quot;
comma
id|pci_device
comma
id|dev
comma
id|dev-&gt;priv
)paren
suffix:semicolon
macro_line|#endif
id|dev-&gt;irq
op_assign
id|pci_device-&gt;irq
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci_device
comma
l_int|0
)paren
suffix:semicolon
id|dev-&gt;init
op_assign
op_amp
id|streamer_init
suffix:semicolon
id|streamer_priv-&gt;streamer_card_name
op_assign
(paren
r_char
op_star
)paren
id|pci_device-&gt;resource
(braket
l_int|0
)braket
dot
id|name
suffix:semicolon
id|streamer_priv-&gt;streamer_mmio
op_assign
id|ioremap
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci_device
comma
l_int|1
)paren
comma
l_int|256
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pkt_buf_sz
(braket
id|card_no
)braket
OL
l_int|100
)paren
op_logical_or
(paren
id|pkt_buf_sz
(braket
id|card_no
)braket
OG
l_int|18000
)paren
)paren
id|streamer_priv-&gt;pkt_buf_sz
op_assign
id|PKT_BUF_SZ
suffix:semicolon
r_else
id|streamer_priv-&gt;pkt_buf_sz
op_assign
id|pkt_buf_sz
(braket
id|card_no
)braket
suffix:semicolon
id|streamer_priv-&gt;streamer_ring_speed
op_assign
id|ringspeed
(braket
id|card_no
)braket
suffix:semicolon
id|streamer_priv-&gt;streamer_message_level
op_assign
id|message_level
(braket
id|card_no
)braket
suffix:semicolon
r_if
c_cond
(paren
id|streamer_init
c_func
(paren
id|dev
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|unregister_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dev-&gt;open
op_assign
op_amp
id|streamer_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|streamer_xmit
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
op_amp
id|streamer_change_mtu
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|streamer_close
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|streamer_set_rx_mode
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|streamer_get_stats
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
op_amp
id|streamer_set_mac_address
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|streamer_reset
r_static
r_int
id|streamer_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
suffix:semicolon
r_int
r_int
id|t
suffix:semicolon
r_int
r_int
id|uaa_addr
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|0
suffix:semicolon
id|__u16
id|misr
suffix:semicolon
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|BCTL
)paren
op_or
id|BCTL_SOFTRESET
comma
id|streamer_mmio
op_plus
id|BCTL
)paren
suffix:semicolon
id|t
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* Hold soft reset bit for a while */
id|current-&gt;state
op_assign
id|TASK_UNINTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
)paren
suffix:semicolon
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|BCTL
)paren
op_amp
op_complement
id|BCTL_SOFTRESET
comma
id|streamer_mmio
op_plus
id|BCTL
)paren
suffix:semicolon
macro_line|#if STREAMER_DEBUG
id|printk
c_func
(paren
l_string|&quot;BCTL: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|BCTL
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GPR: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|GPR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SISRMASK: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|SISR_MASK
)paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_ring_speed
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Autosense */
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|GPR
)paren
op_or
id|GPR_AUTOSENSE
comma
id|streamer_mmio
op_plus
id|GPR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Ringspeed autosense mode on&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_ring_speed
op_eq
l_int|16
)paren
(brace
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Trying to open at 16 Mbps as requested&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writew
c_func
(paren
id|GPR_16MBPS
comma
id|streamer_mmio
op_plus
id|GPR
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_ring_speed
op_eq
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Trying to open at 4 Mbps as requested&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
id|streamer_mmio
op_plus
id|GPR
)paren
suffix:semicolon
)brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|streamer_priv-&gt;pkt_buf_sz
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: skb allocation for diagnostics failed...proceeding&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|streamer_rx_desc
op_star
id|rx_ring
suffix:semicolon
id|u8
op_star
id|data
suffix:semicolon
id|rx_ring
op_assign
(paren
r_struct
id|streamer_rx_desc
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|data
op_assign
(paren
(paren
id|u8
op_star
)paren
id|skb-&gt;data
)paren
op_plus
r_sizeof
(paren
r_struct
id|streamer_rx_desc
)paren
suffix:semicolon
id|rx_ring-&gt;forward
op_assign
l_int|0
suffix:semicolon
id|rx_ring-&gt;status
op_assign
l_int|0
suffix:semicolon
id|rx_ring-&gt;buffer
op_assign
id|virt_to_bus
c_func
(paren
id|data
)paren
suffix:semicolon
id|rx_ring-&gt;framelen_buflen
op_assign
l_int|512
suffix:semicolon
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
id|rx_ring
)paren
comma
id|streamer_mmio
op_plus
id|RXBDA
)paren
suffix:semicolon
)brace
macro_line|#if STREAMER_DEBUG
id|printk
c_func
(paren
l_string|&quot;GPR = %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|GPR
)paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* start solo init */
id|writew
c_func
(paren
id|SISR_MI
comma
id|streamer_mmio
op_plus
id|SISR_MASK_SUM
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|SISR
)paren
)paren
op_amp
id|SISR_SRB_REPLY
)paren
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_minus
id|t
OG
l_int|40
op_star
id|HZ
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IBM PCI tokenring card not responding&bslash;n&quot;
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|STREAMER_IO_SPACE
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|writew
c_func
(paren
op_complement
id|SISR_SRB_REPLY
comma
id|streamer_mmio
op_plus
id|SISR_RUM
)paren
suffix:semicolon
id|misr
op_assign
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|MISR_RUM
)paren
suffix:semicolon
id|writew
c_func
(paren
op_complement
id|misr
comma
id|streamer_mmio
op_plus
id|MISR_RUM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* release skb used for diagnostics */
macro_line|#if STREAMER_DEBUG
id|printk
c_func
(paren
l_string|&quot;LAPWWO: %x, LAPA: %x LAPE:  %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPA
)paren
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPE
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if STREAMER_DEBUG
(brace
r_int
id|i
suffix:semicolon
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;initialization response srb dump: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%x:&quot;
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
op_plus
l_int|6
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPD
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;tokenring card intialization failed. errorcode : %x&bslash;n&quot;
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPD
)paren
)paren
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|STREAMER_IO_SPACE
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
op_plus
l_int|8
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|uaa_addr
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
multiline_comment|/* skip over Level.Addr field */
id|streamer_priv-&gt;streamer_addr_table_addr
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|streamer_priv-&gt;streamer_parms_addr
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
macro_line|#if STREAMER_DEBUG
id|printk
c_func
(paren
l_string|&quot;UAA resides at %x&bslash;n&quot;
comma
id|uaa_addr
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* setup uaa area for access with LAPD */
(brace
r_int
id|i
suffix:semicolon
id|__u16
id|addr
suffix:semicolon
id|writew
c_func
(paren
id|uaa_addr
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|addr
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
(paren
id|addr
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|addr
op_amp
l_int|0xff
suffix:semicolon
)brace
macro_line|#if STREAMER_DEBUG
id|printk
c_func
(paren
l_string|&quot;Adapter address: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%02x:&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|streamer_init
r_static
r_int
id|__init
id|streamer_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_lock
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s &bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %s. I/O at %hx, MMIO at %p, using irq %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|streamer_priv-&gt;streamer_card_name
comma
(paren
r_int
r_int
)paren
id|dev-&gt;base_addr
comma
id|streamer_priv-&gt;streamer_mmio
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|request_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|STREAMER_IO_SPACE
comma
l_string|&quot;streamer&quot;
)paren
suffix:semicolon
id|rc
op_assign
id|streamer_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|streamer_open
r_static
r_int
id|streamer_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_char
id|open_error
(braket
l_int|255
)braket
suffix:semicolon
r_int
id|i
comma
id|open_finished
op_assign
l_int|1
suffix:semicolon
id|__u16
id|srb_word
suffix:semicolon
id|__u16
id|srb_open
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|BMCTL_SUM
)paren
op_amp
id|BMCTL_RX_ENABLED
)paren
(brace
id|rc
op_assign
id|streamer_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|streamer_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;streamer&quot;
comma
id|dev
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
macro_line|#if STREAMER_DEBUG
id|printk
c_func
(paren
l_string|&quot;BMCTL: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|BMCTL_SUM
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pending ints: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|SISR
)paren
)paren
suffix:semicolon
macro_line|#endif
id|writew
c_func
(paren
id|SISR_MI
op_or
id|SISR_SRB_REPLY
comma
id|streamer_mmio
op_plus
id|SISR_MASK
)paren
suffix:semicolon
multiline_comment|/* more ints later, doesn&squot;t stop arb cmd interrupt */
id|writew
c_func
(paren
id|LISR_LIE
comma
id|streamer_mmio
op_plus
id|LISR
)paren
suffix:semicolon
multiline_comment|/* more ints later */
multiline_comment|/* adapter is closed, so SRB is pointed to by LAPWWO */
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
macro_line|#if STREAMER_DEBUG
id|printk
c_func
(paren
l_string|&quot;LAPWWO: %x, LAPA: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPA
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;LAPE: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPE
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SISR Mask = %04x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|SISR_MASK
)paren
)paren
suffix:semicolon
macro_line|#endif
r_do
(brace
r_int
id|i
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SRB_COMMAND_SIZE
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|writew
c_func
(paren
l_int|0
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
)brace
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|SRB_OPEN_ADAPTER
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
multiline_comment|/* open */
id|writew
c_func
(paren
id|htons
c_func
(paren
id|STREAMER_CLEAR_RET_CODE
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|STREAMER_CLEAR_RET_CODE
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
op_plus
l_int|8
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
macro_line|#if STREAMER_NETWORK_MONITOR
multiline_comment|/* If Network Monitor, instruct card to copy MAC frames through the ARB */
id|writew
c_func
(paren
id|htons
c_func
(paren
id|OPEN_ADAPTER_ENABLE_FDX
op_or
id|OPEN_ADAPTER_PASS_ADC_MAC
op_or
id|OPEN_ADAPTER_PASS_ATT_MAC
op_or
id|OPEN_ADAPTER_PASS_BEACON
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
multiline_comment|/* offset 8 word contains open options */
macro_line|#else
id|writew
c_func
(paren
id|htons
c_func
(paren
id|OPEN_ADAPTER_ENABLE_FDX
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
multiline_comment|/* Offset 8 word contains Open.Options */
macro_line|#endif
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_laa
(braket
l_int|0
)braket
)paren
(brace
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
op_plus
l_int|12
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
(paren
id|streamer_priv-&gt;streamer_laa
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|streamer_priv-&gt;streamer_laa
(braket
l_int|1
)braket
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
(paren
id|streamer_priv-&gt;streamer_laa
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|streamer_priv-&gt;streamer_laa
(braket
l_int|3
)braket
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
(paren
id|streamer_priv-&gt;streamer_laa
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_or
id|streamer_priv-&gt;streamer_laa
(braket
l_int|5
)braket
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|streamer_priv-&gt;streamer_laa
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
)brace
multiline_comment|/* save off srb open offset */
id|srb_open
op_assign
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
suffix:semicolon
macro_line|#if STREAMER_DEBUG
id|writew
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;srb open request: &bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x:&quot;
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|streamer_priv-&gt;srb_queued
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* signal solo that SRB command has been issued */
id|writew
c_func
(paren
id|LISR_SRB_CMD
comma
id|streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
r_while
c_loop
(paren
id|streamer_priv-&gt;srb_queued
)paren
(brace
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|streamer_priv-&gt;srb_wait
comma
l_int|5
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: SRB timed out.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;SISR=%x MISR=%x, LISR=%x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|SISR
)paren
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|MISR_RUM
)paren
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LISR
)paren
)paren
suffix:semicolon
id|streamer_priv-&gt;srb_queued
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#if STREAMER_DEBUG
id|printk
c_func
(paren
l_string|&quot;SISR_MASK: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|SISR_MASK
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;srb open response:&bslash;n&quot;
)paren
suffix:semicolon
id|writew
c_func
(paren
id|srb_open
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x:&quot;
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* If we get the same return response as we set, the interrupt wasn&squot;t raised and the open&n;&t;&t; * timed out.&n;&t;&t; */
id|writew
c_func
(paren
id|srb_open
op_plus
l_int|2
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|srb_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPD
)paren
)paren
op_amp
l_int|0xFF
suffix:semicolon
r_if
c_cond
(paren
id|srb_word
op_eq
id|STREAMER_CLEAR_RET_CODE
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter Open time out or error.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srb_word
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|srb_word
op_eq
l_int|0x07
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|streamer_priv-&gt;streamer_ring_speed
op_logical_and
id|open_finished
)paren
(brace
multiline_comment|/* Autosense , first time around */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Retrying at different ring speed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|open_finished
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|__u16
id|error_code
suffix:semicolon
id|writew
c_func
(paren
id|srb_open
op_plus
l_int|6
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|error_code
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPD
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|open_error
comma
id|open_maj_error
(braket
(paren
id|error_code
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)braket
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|open_error
comma
l_string|&quot; - &quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|open_error
comma
id|open_min_error
(braket
(paren
id|error_code
op_amp
l_int|0x0f
)paren
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|streamer_priv-&gt;streamer_ring_speed
op_logical_and
(paren
(paren
id|error_code
op_amp
l_int|0x0f
)paren
op_eq
l_int|0x0d
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Tried to autosense ring speed with no monitors present&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Please try again with a specified ring speed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|open_error
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* if autosense &amp;&amp; open_finished */
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Bad OPEN response: %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|srb_word
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_else
id|open_finished
op_assign
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|open_finished
)paren
)paren
suffix:semicolon
multiline_comment|/* Will only loop if ring speed mismatch re-open attempted &amp;&amp; autosense is on */
id|writew
c_func
(paren
id|srb_open
op_plus
l_int|18
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|srb_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPD
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|srb_word
op_amp
(paren
l_int|1
op_lshift
l_int|3
)paren
)paren
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Opened in FDX Mode&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srb_word
op_amp
l_int|1
)paren
id|streamer_priv-&gt;streamer_ring_speed
op_assign
l_int|16
suffix:semicolon
r_else
id|streamer_priv-&gt;streamer_ring_speed
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Opened in %d Mbps mode&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|streamer_priv-&gt;streamer_ring_speed
)paren
suffix:semicolon
id|writew
c_func
(paren
id|srb_open
op_plus
l_int|8
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|streamer_priv-&gt;asb
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|streamer_priv-&gt;srb
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|streamer_priv-&gt;arb
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
multiline_comment|/* offset 14 word is rsvd */
id|streamer_priv-&gt;trb
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|streamer_priv-&gt;streamer_receive_options
op_assign
l_int|0x00
suffix:semicolon
id|streamer_priv-&gt;streamer_copy_all_options
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* setup rx ring */
multiline_comment|/* enable rx channel */
id|writew
c_func
(paren
op_complement
id|BMCTL_RX_DIS
comma
id|streamer_mmio
op_plus
id|BMCTL_RUM
)paren
suffix:semicolon
multiline_comment|/* setup rx descriptors */
id|streamer_priv-&gt;streamer_rx_ring
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|streamer_rx_desc
)paren
op_star
id|STREAMER_RX_RING_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|streamer_priv-&gt;streamer_rx_ring
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s ALLOC of streamer rx ring FAILED!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|STREAMER_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|streamer_priv-&gt;pkt_buf_sz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|i
)braket
dot
id|forward
op_assign
id|virt_to_bus
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|i
)braket
dot
id|buffer
op_assign
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|i
)braket
dot
id|framelen_buflen
op_assign
id|streamer_priv-&gt;pkt_buf_sz
suffix:semicolon
id|streamer_priv-&gt;rx_ring_skb
(braket
id|i
)braket
op_assign
id|skb
suffix:semicolon
)brace
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|STREAMER_RX_RING_SIZE
op_minus
l_int|1
)braket
dot
id|forward
op_assign
id|virt_to_bus
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_rx_ring
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Not enough memory to allocate rx buffers. Adapter disabled&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|streamer_priv-&gt;rx_ring_last_received
op_assign
id|STREAMER_RX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* last processed rx status */
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_rx_ring
(braket
l_int|0
)braket
)paren
comma
id|streamer_mmio
op_plus
id|RXBDA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|STREAMER_RX_RING_SIZE
op_minus
l_int|1
)braket
)paren
comma
id|streamer_mmio
op_plus
id|RXLBDA
)paren
suffix:semicolon
multiline_comment|/* set bus master interrupt event mask */
id|writew
c_func
(paren
id|MISR_RX_NOBUF
op_or
id|MISR_RX_EOF
comma
id|streamer_mmio
op_plus
id|MISR_MASK
)paren
suffix:semicolon
multiline_comment|/* setup tx ring */
id|streamer_priv-&gt;streamer_tx_ring
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|streamer_tx_desc
)paren
op_star
id|STREAMER_TX_RING_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|streamer_priv-&gt;streamer_tx_ring
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s ALLOC of streamer_tx_ring FAILED&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|writew
c_func
(paren
op_complement
id|BMCTL_TX2_DIS
comma
id|streamer_mmio
op_plus
id|BMCTL_RUM
)paren
suffix:semicolon
multiline_comment|/* Enables TX channel 2 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|STREAMER_TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|i
)braket
dot
id|forward
op_assign
id|virt_to_bus
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|i
)braket
dot
id|bufcnt_framelen
op_assign
l_int|0
suffix:semicolon
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|i
)braket
dot
id|buffer
op_assign
l_int|0
suffix:semicolon
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|i
)braket
dot
id|buflen
op_assign
l_int|0
suffix:semicolon
)brace
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|STREAMER_TX_RING_SIZE
op_minus
l_int|1
)braket
dot
id|forward
op_assign
id|virt_to_bus
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_tx_ring
(braket
l_int|0
)braket
)paren
suffix:semicolon
suffix:semicolon
id|streamer_priv-&gt;free_tx_ring_entries
op_assign
id|STREAMER_TX_RING_SIZE
suffix:semicolon
id|streamer_priv-&gt;tx_ring_free
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* next entry in tx ring to use */
id|streamer_priv-&gt;tx_ring_last_status
op_assign
id|STREAMER_TX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* set Busmaster interrupt event mask (handle receives on interrupt only */
id|writew
c_func
(paren
id|MISR_TX2_EOF
op_or
id|MISR_RX_NOBUF
op_or
id|MISR_RX_EOF
comma
id|streamer_mmio
op_plus
id|MISR_MASK
)paren
suffix:semicolon
multiline_comment|/* set system event interrupt mask */
id|writew
c_func
(paren
id|SISR_ADAPTER_CHECK
op_or
id|SISR_ARB_CMD
op_or
id|SISR_TRB_REPLY
op_or
id|SISR_ASB_FREE
comma
id|streamer_mmio
op_plus
id|SISR_MASK_SUM
)paren
suffix:semicolon
macro_line|#if STREAMER_DEBUG
id|printk
c_func
(paren
l_string|&quot;BMCTL: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|BMCTL_SUM
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SISR MASK: %x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|SISR_MASK
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if STREAMER_NETWORK_MONITOR
id|writew
c_func
(paren
id|streamer_priv-&gt;streamer_addr_table_addr
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Node Address: %04x:%04x:%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
)paren
suffix:semicolon
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Functional Address: %04x:%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
)paren
suffix:semicolon
id|writew
c_func
(paren
id|streamer_priv-&gt;streamer_parms_addr
op_plus
l_int|4
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: NAUN Address: %04x:%04x:%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;When we enter the rx routine we do not know how many frames have been &n; *&t;queued on the rx channel.  Therefore we start at the next rx status&n; *&t;position and travel around the receive ring until we have completed&n; *&t;all the frames.&n; *&n; *&t;This means that we may process the frame before we receive the end&n; *&t;of frame interrupt. This is why we always test the status instead&n; *&t;of blindly processing the next frame.&n; *&t;&n; */
DECL|function|streamer_rx
r_static
r_void
id|streamer_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
r_struct
id|streamer_rx_desc
op_star
id|rx_desc
suffix:semicolon
r_int
id|rx_ring_last_received
comma
id|length
comma
id|frame_length
comma
id|buffer_cnt
op_assign
l_int|0
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|skb2
suffix:semicolon
multiline_comment|/* setup the next rx descriptor to be received */
id|rx_desc
op_assign
op_amp
id|streamer_priv-&gt;streamer_rx_ring
(braket
(paren
id|streamer_priv-&gt;rx_ring_last_received
op_plus
l_int|1
)paren
op_amp
(paren
id|STREAMER_RX_RING_SIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
id|rx_ring_last_received
op_assign
id|streamer_priv-&gt;rx_ring_last_received
suffix:semicolon
r_while
c_loop
(paren
id|rx_desc-&gt;status
op_amp
l_int|0x01000000
)paren
(brace
multiline_comment|/* While processed descriptors are available */
r_if
c_cond
(paren
id|rx_ring_last_received
op_ne
id|streamer_priv-&gt;rx_ring_last_received
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;RX Error 1 rx_ring_last_received not the same %x %x&bslash;n&quot;
comma
id|rx_ring_last_received
comma
id|streamer_priv-&gt;rx_ring_last_received
)paren
suffix:semicolon
)brace
id|streamer_priv-&gt;rx_ring_last_received
op_assign
(paren
id|streamer_priv-&gt;rx_ring_last_received
op_plus
l_int|1
)paren
op_amp
(paren
id|STREAMER_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|rx_ring_last_received
op_assign
id|streamer_priv-&gt;rx_ring_last_received
suffix:semicolon
id|length
op_assign
id|rx_desc-&gt;framelen_buflen
op_amp
l_int|0xffff
suffix:semicolon
multiline_comment|/* buffer length */
id|frame_length
op_assign
(paren
id|rx_desc-&gt;framelen_buflen
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|rx_desc-&gt;status
op_amp
l_int|0x7E830000
)paren
(brace
multiline_comment|/* errors */
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Rx Error %x &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rx_desc-&gt;status
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* received without errors */
r_if
c_cond
(paren
id|rx_desc-&gt;status
op_amp
l_int|0x80000000
)paren
(brace
multiline_comment|/* frame complete */
id|buffer_cnt
op_assign
l_int|1
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|streamer_priv-&gt;pkt_buf_sz
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|frame_length
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Not enough memory to copy packet to upper layers. &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|streamer_priv-&gt;streamer_stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* we allocated an skb OK */
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|buffer_cnt
op_eq
l_int|1
)paren
(brace
id|skb2
op_assign
id|streamer_priv-&gt;rx_ring_skb
(braket
id|rx_ring_last_received
)braket
suffix:semicolon
macro_line|#if STREAMER_DEBUG_PACKETS
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;streamer_rx packet print: skb-&gt;data2 %p  skb-&gt;head %p&bslash;n&quot;
comma
id|skb2-&gt;data
comma
id|skb2-&gt;head
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|frame_length
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x:&quot;
comma
id|skb2-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|16
)paren
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|skb_put
c_func
(paren
id|skb2
comma
id|length
)paren
suffix:semicolon
id|skb2-&gt;protocol
op_assign
id|tr_type_trans
c_func
(paren
id|skb2
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* recycle this descriptor */
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|rx_ring_last_received
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|rx_ring_last_received
)braket
dot
id|framelen_buflen
op_assign
id|streamer_priv-&gt;pkt_buf_sz
suffix:semicolon
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|rx_ring_last_received
)braket
dot
id|buffer
op_assign
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|streamer_priv
op_member_access_from_pointer
id|rx_ring_skb
(braket
id|rx_ring_last_received
)braket
op_assign
id|skb
suffix:semicolon
multiline_comment|/* place recycled descriptor back on the adapter */
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|rx_ring_last_received
)braket
)paren
comma
id|streamer_mmio
op_plus
id|RXLBDA
)paren
suffix:semicolon
multiline_comment|/* pass the received skb up to the protocol */
id|netif_rx
c_func
(paren
id|skb2
)paren
suffix:semicolon
)brace
r_else
(brace
r_do
(brace
multiline_comment|/* Walk the buffers */
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|length
)paren
comma
id|bus_to_virt
c_func
(paren
id|rx_desc-&gt;buffer
)paren
comma
id|length
)paren
suffix:semicolon
multiline_comment|/* copy this fragment */
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|rx_ring_last_received
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|rx_ring_last_received
)braket
dot
id|framelen_buflen
op_assign
id|streamer_priv-&gt;pkt_buf_sz
suffix:semicolon
multiline_comment|/* give descriptor back to the adapter */
id|writel
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_rx_ring
(braket
id|rx_ring_last_received
)braket
)paren
comma
id|streamer_mmio
op_plus
id|RXLBDA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_desc-&gt;status
op_amp
l_int|0x80000000
)paren
r_break
suffix:semicolon
multiline_comment|/* this descriptor completes the frame */
multiline_comment|/* else get the next pending descriptor */
r_if
c_cond
(paren
id|rx_ring_last_received
op_ne
id|streamer_priv-&gt;rx_ring_last_received
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;RX Error rx_ring_last_received not the same %x %x&bslash;n&quot;
comma
id|rx_ring_last_received
comma
id|streamer_priv-&gt;rx_ring_last_received
)paren
suffix:semicolon
)brace
id|rx_desc
op_assign
op_amp
id|streamer_priv-&gt;streamer_rx_ring
(braket
(paren
id|streamer_priv-&gt;rx_ring_last_received
op_plus
l_int|1
)paren
op_amp
(paren
id|STREAMER_RX_RING_SIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
id|length
op_assign
id|rx_desc-&gt;framelen_buflen
op_amp
l_int|0xffff
suffix:semicolon
multiline_comment|/* buffer length */
id|streamer_priv-&gt;rx_ring_last_received
op_assign
(paren
id|streamer_priv-&gt;rx_ring_last_received
op_plus
l_int|1
)paren
op_amp
(paren
id|STREAMER_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|rx_ring_last_received
op_assign
id|streamer_priv-&gt;rx_ring_last_received
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|tr_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* send up to the protocol */
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|streamer_priv-&gt;streamer_stats.rx_packets
op_increment
suffix:semicolon
id|streamer_priv-&gt;streamer_stats.rx_bytes
op_add_assign
id|length
suffix:semicolon
)brace
multiline_comment|/* if skb == null */
)brace
multiline_comment|/* end received without errors */
multiline_comment|/* try the next one */
id|rx_desc
op_assign
op_amp
id|streamer_priv-&gt;streamer_rx_ring
(braket
(paren
id|rx_ring_last_received
op_plus
l_int|1
)paren
op_amp
(paren
id|STREAMER_RX_RING_SIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
)brace
multiline_comment|/* end for all completed rx descriptors */
)brace
DECL|function|streamer_interrupt
r_static
r_void
id|streamer_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
id|__u16
id|sisr
suffix:semicolon
id|__u16
id|misr
suffix:semicolon
id|__u16
id|sisrmask
suffix:semicolon
id|sisrmask
op_assign
id|SISR_MI
suffix:semicolon
id|writew
c_func
(paren
op_complement
id|sisrmask
comma
id|streamer_mmio
op_plus
id|SISR_MASK_RUM
)paren
suffix:semicolon
id|sisr
op_assign
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|SISR
)paren
suffix:semicolon
id|writew
c_func
(paren
op_complement
id|sisr
comma
id|streamer_mmio
op_plus
id|SISR_RUM
)paren
suffix:semicolon
id|misr
op_assign
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|MISR_RUM
)paren
suffix:semicolon
id|writew
c_func
(paren
op_complement
id|misr
comma
id|streamer_mmio
op_plus
id|MISR_RUM
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sisr
)paren
(brace
multiline_comment|/* Interrupt isn&squot;t for us */
id|writew
c_func
(paren
op_complement
id|misr
comma
id|streamer_mmio
op_plus
id|MISR_RUM
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sisr
op_amp
(paren
id|SISR_SRB_REPLY
op_or
id|SISR_ADAPTER_CHECK
op_or
id|SISR_ASB_FREE
op_or
id|SISR_ARB_CMD
op_or
id|SISR_TRB_REPLY
)paren
)paren
op_logical_or
(paren
id|misr
op_amp
(paren
id|MISR_TX2_EOF
op_or
id|MISR_RX_NOBUF
op_or
id|MISR_RX_EOF
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_SRB_REPLY
)paren
(brace
r_if
c_cond
(paren
id|streamer_priv-&gt;srb_queued
op_eq
l_int|1
)paren
(brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|streamer_priv-&gt;srb_wait
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|streamer_priv-&gt;srb_queued
op_eq
l_int|2
)paren
(brace
id|streamer_srb_bh
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|streamer_priv-&gt;srb_queued
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SISR_SRB_REPLY */
r_if
c_cond
(paren
id|misr
op_amp
id|MISR_TX2_EOF
)paren
(brace
r_while
c_loop
(paren
id|streamer_priv-&gt;streamer_tx_ring
(braket
(paren
id|streamer_priv-&gt;tx_ring_last_status
op_plus
l_int|1
)paren
op_amp
(paren
id|STREAMER_TX_RING_SIZE
op_minus
l_int|1
)paren
)braket
dot
id|status
)paren
(brace
id|streamer_priv-&gt;tx_ring_last_status
op_assign
(paren
id|streamer_priv-&gt;tx_ring_last_status
op_plus
l_int|1
)paren
op_amp
(paren
id|STREAMER_TX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|streamer_priv-&gt;free_tx_ring_entries
op_increment
suffix:semicolon
id|streamer_priv-&gt;streamer_stats.tx_bytes
op_add_assign
id|streamer_priv-&gt;tx_ring_skb
(braket
id|streamer_priv-&gt;tx_ring_last_status
)braket
op_member_access_from_pointer
id|len
suffix:semicolon
id|streamer_priv-&gt;streamer_stats.tx_packets
op_increment
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|streamer_priv-&gt;tx_ring_skb
(braket
id|streamer_priv-&gt;tx_ring_last_status
)braket
)paren
suffix:semicolon
id|streamer_priv
op_member_access_from_pointer
id|streamer_tx_ring
(braket
id|streamer_priv-&gt;tx_ring_last_status
)braket
dot
id|buffer
op_assign
l_int|0xdeadbeef
suffix:semicolon
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|streamer_priv-&gt;tx_ring_last_status
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|streamer_priv-&gt;tx_ring_last_status
)braket
dot
id|bufcnt_framelen
op_assign
l_int|0
suffix:semicolon
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|streamer_priv-&gt;tx_ring_last_status
)braket
dot
id|buflen
op_assign
l_int|0
suffix:semicolon
)brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|misr
op_amp
id|MISR_RX_EOF
)paren
(brace
id|streamer_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* MISR_RX_EOF */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_ADAPTER_CHECK
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter Check Interrupt Raised, 8 bytes of information follow:&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|streamer_mmio
op_plus
id|LAPWWO
)paren
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Words %x:%x:%x:%x:&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* SISR_ADAPTER_CHECK */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_ASB_FREE
)paren
(brace
multiline_comment|/* Wake up anything that is waiting for the asb response */
r_if
c_cond
(paren
id|streamer_priv-&gt;asb_queued
)paren
(brace
id|streamer_asb_bh
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* SISR_ASB_FREE */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_ARB_CMD
)paren
(brace
id|streamer_arb_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* SISR_ARB_CMD */
r_if
c_cond
(paren
id|sisr
op_amp
id|SISR_TRB_REPLY
)paren
(brace
multiline_comment|/* Wake up anything that is waiting for the trb response */
r_if
c_cond
(paren
id|streamer_priv-&gt;trb_queued
)paren
(brace
id|wake_up_interruptible
c_func
(paren
op_amp
id|streamer_priv
op_member_access_from_pointer
id|trb_wait
)paren
suffix:semicolon
)brace
id|streamer_priv-&gt;trb_queued
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SISR_TRB_REPLY */
r_if
c_cond
(paren
id|misr
op_amp
id|MISR_RX_NOBUF
)paren
(brace
multiline_comment|/* According to the documentation, we don&squot;t have to do anything, but trapping it keeps it out of&n;&t;&t;&t;   /var/log/messages.  */
)brace
multiline_comment|/* SISR_RX_NOBUF */
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unexpected interrupt: %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|sisr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: SISR_MASK: %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|SISR_MASK
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* One if the interrupts we want */
id|writew
c_func
(paren
id|SISR_MI
comma
id|streamer_mmio
op_plus
id|SISR_MASK_SUM
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_lock
)paren
suffix:semicolon
)brace
DECL|function|streamer_xmit
r_static
r_int
id|streamer_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_lock
comma
id|flags
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|streamer_priv-&gt;free_tx_ring_entries
)paren
(brace
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|streamer_priv-&gt;tx_ring_free
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|streamer_priv-&gt;tx_ring_free
)braket
dot
id|bufcnt_framelen
op_assign
l_int|0x00010000
op_or
id|skb-&gt;len
suffix:semicolon
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|streamer_priv-&gt;tx_ring_free
)braket
dot
id|buffer
op_assign
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|streamer_priv-&gt;tx_ring_free
)braket
dot
id|buflen
op_assign
id|skb-&gt;len
suffix:semicolon
id|streamer_priv-&gt;tx_ring_skb
(braket
id|streamer_priv-&gt;tx_ring_free
)braket
op_assign
id|skb
suffix:semicolon
id|streamer_priv-&gt;free_tx_ring_entries
op_decrement
suffix:semicolon
macro_line|#if STREAMER_DEBUG_PACKETS
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;streamer_xmit packet print:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb-&gt;len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x:&quot;
comma
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|16
)paren
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|writel
c_func
(paren
id|virt_to_bus
(paren
op_amp
id|streamer_priv-&gt;streamer_tx_ring
(braket
id|streamer_priv-&gt;tx_ring_free
)braket
)paren
comma
id|streamer_mmio
op_plus
id|TX2LFDA
)paren
suffix:semicolon
id|streamer_priv-&gt;tx_ring_free
op_assign
(paren
id|streamer_priv-&gt;tx_ring_free
op_plus
l_int|1
)paren
op_amp
(paren
id|STREAMER_TX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|streamer_priv-&gt;streamer_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|streamer_close
r_static
r_int
id|streamer_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writew
c_func
(paren
id|streamer_priv-&gt;srb
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|SRB_CLOSE_ADAPTER
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|STREAMER_CLEAR_RET_CODE
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|streamer_priv-&gt;srb_queued
op_assign
l_int|1
suffix:semicolon
id|writew
c_func
(paren
id|LISR_SRB_CMD
comma
id|streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
r_while
c_loop
(paren
id|streamer_priv-&gt;srb_queued
)paren
(brace
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|streamer_priv-&gt;srb_wait
comma
id|jiffies
op_plus
l_int|60
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: SRB timed out.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;SISR=%x MISR=%x LISR=%x&bslash;n&quot;
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|SISR
)paren
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|MISR_RUM
)paren
comma
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LISR
)paren
)paren
suffix:semicolon
id|streamer_priv-&gt;srb_queued
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|streamer_priv-&gt;rx_ring_last_received
op_assign
(paren
id|streamer_priv-&gt;rx_ring_last_received
op_plus
l_int|1
)paren
op_amp
(paren
id|STREAMER_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|STREAMER_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|streamer_priv-&gt;rx_ring_skb
(braket
id|streamer_priv-&gt;rx_ring_last_received
)braket
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|streamer_priv-&gt;rx_ring_skb
(braket
id|streamer_priv-&gt;rx_ring_last_received
)braket
)paren
suffix:semicolon
)brace
id|streamer_priv-&gt;rx_ring_last_received
op_assign
(paren
id|streamer_priv-&gt;rx_ring_last_received
op_plus
l_int|1
)paren
op_amp
(paren
id|STREAMER_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* reset tx/rx fifo&squot;s and busmaster logic */
multiline_comment|/* TBD. Add graceful way to reset the LLC channel without doing a soft reset. &n;&t;   writel(readl(streamer_mmio+BCTL)|(3&lt;&lt;13),streamer_mmio+BCTL);&n;&t;   udelay(1);&n;&t;   writel(readl(streamer_mmio+BCTL)&amp;~(3&lt;&lt;13),streamer_mmio+BCTL);&n;&t; */
macro_line|#if STREAMER_DEBUG
id|writew
c_func
(paren
id|streamer_priv-&gt;srb
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;srb): &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x &quot;
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|streamer_set_rx_mode
r_static
r_void
id|streamer_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
id|__u8
id|options
op_assign
l_int|0
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|dmi
suffix:semicolon
r_int
r_char
id|dev_mc_address
(braket
l_int|5
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
id|writel
c_func
(paren
id|streamer_priv-&gt;srb
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|options
op_assign
id|streamer_priv-&gt;streamer_copy_all_options
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
id|options
op_or_assign
(paren
l_int|3
op_lshift
l_int|5
)paren
suffix:semicolon
multiline_comment|/* All LLC and MAC frames, all through the main rx channel */
r_else
id|options
op_and_assign
op_complement
(paren
l_int|3
op_lshift
l_int|5
)paren
suffix:semicolon
multiline_comment|/* Only issue the srb if there is a change in options */
r_if
c_cond
(paren
(paren
id|options
op_xor
id|streamer_priv-&gt;streamer_copy_all_options
)paren
)paren
(brace
multiline_comment|/* Now to issue the srb command to alter the copy.all.options */
id|writew
c_func
(paren
id|htons
c_func
(paren
id|SRB_MODIFY_RECEIVE_OPTIONS
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|STREAMER_CLEAR_RET_CODE
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
(paren
id|streamer_priv-&gt;streamer_receive_options
op_lshift
l_int|8
)paren
op_or
id|options
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
l_int|0x4a41
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
l_int|0x4d45
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
l_int|0x5320
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0x2020
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|streamer_priv-&gt;srb_queued
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Can&squot;t sleep, use srb_bh */
id|writel
c_func
(paren
id|LISR_SRB_CMD
comma
id|streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
id|streamer_priv-&gt;streamer_copy_all_options
op_assign
id|options
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Set the functional addresses we need for multicast */
id|writel
c_func
(paren
id|streamer_priv-&gt;srb
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|dev_mc_address
(braket
l_int|0
)braket
op_assign
id|dev_mc_address
(braket
l_int|1
)braket
op_assign
id|dev_mc_address
(braket
l_int|2
)braket
op_assign
id|dev_mc_address
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|dmi
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|dmi
op_assign
id|dmi-&gt;next
)paren
(brace
id|dev_mc_address
(braket
l_int|0
)braket
op_or_assign
id|dmi-&gt;dmi_addr
(braket
l_int|2
)braket
suffix:semicolon
id|dev_mc_address
(braket
l_int|1
)braket
op_or_assign
id|dmi-&gt;dmi_addr
(braket
l_int|3
)braket
suffix:semicolon
id|dev_mc_address
(braket
l_int|2
)braket
op_or_assign
id|dmi-&gt;dmi_addr
(braket
l_int|4
)braket
suffix:semicolon
id|dev_mc_address
(braket
l_int|3
)braket
op_or_assign
id|dmi-&gt;dmi_addr
(braket
l_int|5
)braket
suffix:semicolon
)brace
id|writew
c_func
(paren
id|htons
c_func
(paren
id|SRB_SET_FUNC_ADDRESS
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|STREAMER_CLEAR_RET_CODE
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
(paren
id|dev_mc_address
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|dev_mc_address
(braket
l_int|1
)braket
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
(paren
id|dev_mc_address
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|dev_mc_address
(braket
l_int|3
)braket
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|streamer_priv-&gt;srb_queued
op_assign
l_int|2
suffix:semicolon
id|writel
c_func
(paren
id|LISR_SRB_CMD
comma
id|streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
)brace
DECL|function|streamer_srb_bh
r_static
r_void
id|streamer_srb_bh
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
id|__u16
id|srb_word
suffix:semicolon
id|writew
c_func
(paren
id|streamer_priv-&gt;srb
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|srb_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|srb_word
)paren
(brace
multiline_comment|/* SRB_MODIFY_RECEIVE_OPTIONS i.e. set_multicast_list options (promiscuous) &n;&t;&t; * At some point we should do something if we get an error, such as&n;&t;&t; * resetting the IFF_PROMISC flag in dev&n;&t;&t; */
r_case
id|SRB_MODIFY_RECEIVE_OPTIONS
suffix:colon
id|srb_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|srb_word
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Receive Options Modified to %x,%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|streamer_priv-&gt;streamer_copy_all_options
comma
id|streamer_priv-&gt;streamer_receive_options
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
multiline_comment|/* SRB_SET_GROUP_ADDRESS - Multicast group setting &n;&t;&t; */
r_case
id|SRB_SET_GROUP_ADDRESS
suffix:colon
id|srb_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|srb_word
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3c
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Group/Functional address indicator bits not set correctly&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3e
suffix:colon
multiline_comment|/* If we ever implement individual multicast addresses, will need to deal with this */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Group address registers full&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x55
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Group Address already set.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
multiline_comment|/* SRB_RESET_GROUP_ADDRESS - Remove a multicast address from group list&n;&t;&t; */
r_case
id|SRB_RESET_GROUP_ADDRESS
suffix:colon
id|srb_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|srb_word
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x39
suffix:colon
multiline_comment|/* Must deal with this if individual multicast addresses used */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Group address not found &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
multiline_comment|/* SRB_SET_FUNC_ADDRESS - Called by the set_rx_mode &n;&t;&t; */
r_case
id|SRB_SET_FUNC_ADDRESS
suffix:colon
id|srb_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|srb_word
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Functional Address Mask Set &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
multiline_comment|/* SRB_READ_LOG - Read and reset the adapter error counters&n;&t;&t; */
r_case
id|SRB_READ_LOG
suffix:colon
id|srb_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|srb_word
)paren
(brace
r_case
l_int|0x00
suffix:colon
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Read Log command complete&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Read Log statistics: &quot;
)paren
suffix:semicolon
id|writew
c_func
(paren
id|streamer_priv-&gt;srb
op_plus
l_int|6
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x:&quot;
comma
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
multiline_comment|/* SRB_READ_SR_COUNTERS - Read and reset the source routing bridge related counters */
r_case
id|SRB_READ_SR_COUNTERS
suffix:colon
id|srb_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|srb_word
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Read Source Routing Counters issued&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter must be open for this operation, doh!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[2] */
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized srb bh return value.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch srb[0] */
)brace
DECL|function|streamer_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|streamer_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
suffix:semicolon
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
(paren
r_struct
id|net_device_stats
op_star
)paren
op_amp
id|streamer_priv-&gt;streamer_stats
suffix:semicolon
)brace
DECL|function|streamer_set_mac_address
r_static
r_int
id|streamer_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|addr
)paren
(brace
r_struct
id|sockaddr
op_star
id|saddr
op_assign
id|addr
suffix:semicolon
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Cannot set mac/laa address while card is open&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|streamer_priv-&gt;streamer_laa
comma
id|saddr-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MAC/LAA Set to  = %x.%x.%x.%x.%x.%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|streamer_priv-&gt;streamer_laa
(braket
l_int|0
)braket
comma
id|streamer_priv-&gt;streamer_laa
(braket
l_int|1
)braket
comma
id|streamer_priv-&gt;streamer_laa
(braket
l_int|2
)braket
comma
id|streamer_priv-&gt;streamer_laa
(braket
l_int|3
)braket
comma
id|streamer_priv-&gt;streamer_laa
(braket
l_int|4
)braket
comma
id|streamer_priv-&gt;streamer_laa
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|streamer_arb_cmd
r_static
r_void
id|streamer_arb_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
id|__u8
id|header_len
suffix:semicolon
id|__u16
id|frame_len
comma
id|buffer_len
suffix:semicolon
r_struct
id|sk_buff
op_star
id|mac_frame
suffix:semicolon
id|__u8
id|frame_data
(braket
l_int|256
)braket
suffix:semicolon
id|__u16
id|buff_off
suffix:semicolon
id|__u16
id|lan_status
op_assign
l_int|0
comma
id|lan_status_diff
suffix:semicolon
multiline_comment|/* Initialize to stop compiler warning */
id|__u8
id|fdx_prot_error
suffix:semicolon
id|__u16
id|next_ptr
suffix:semicolon
id|__u16
id|arb_word
suffix:semicolon
macro_line|#if STREAMER_NETWORK_MONITOR
r_struct
id|trh_hdr
op_star
id|mac_hdr
suffix:semicolon
macro_line|#endif
id|writew
c_func
(paren
id|streamer_priv-&gt;arb
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|arb_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPD
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|arb_word
op_eq
id|ARB_RECEIVE_DATA
)paren
(brace
multiline_comment|/* Receive.data, MAC frames */
id|writew
c_func
(paren
id|streamer_priv-&gt;arb
op_plus
l_int|6
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|streamer_priv-&gt;mac_rx_buffer
op_assign
id|buff_off
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|header_len
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
multiline_comment|/* 802.5 Token-Ring Header Length */
id|frame_len
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
macro_line|#if STREAMER_DEBUG
(brace
r_int
id|i
suffix:semicolon
id|__u16
id|next
suffix:semicolon
id|__u8
id|status
suffix:semicolon
id|__u16
id|len
suffix:semicolon
id|writew
c_func
(paren
id|ntohs
c_func
(paren
id|buff_off
)paren
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
multiline_comment|/*setup window to frame data */
id|next
op_assign
id|htons
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|status
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
id|len
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
multiline_comment|/* print out 1st 14 bytes of frame data */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|7
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Loc %d = %04x&bslash;n&quot;
comma
id|i
comma
id|ntohs
c_func
(paren
id|readw
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;next %04x, fs %02x, len %04x &bslash;n&quot;
comma
id|next
comma
id|status
comma
id|len
)paren
suffix:semicolon
)brace
macro_line|#endif
id|mac_frame
op_assign
id|dev_alloc_skb
c_func
(paren
id|frame_len
)paren
suffix:semicolon
multiline_comment|/* Walk the buffer chain, creating the frame */
r_do
(brace
r_int
id|i
suffix:semicolon
id|__u16
id|rx_word
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|buff_off
)paren
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
multiline_comment|/* setup window to frame data */
id|next_ptr
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
multiline_comment|/* read thru status word */
id|buffer_len
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buffer_len
OG
l_int|256
)paren
r_break
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|buffer_len
)paren
(brace
id|rx_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|frame_data
(braket
id|i
)braket
op_assign
id|rx_word
op_rshift
l_int|8
suffix:semicolon
id|frame_data
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|rx_word
op_amp
l_int|0xff
suffix:semicolon
id|i
op_add_assign
l_int|2
suffix:semicolon
)brace
id|memcpy_fromio
c_func
(paren
id|skb_put
c_func
(paren
id|mac_frame
comma
id|buffer_len
)paren
comma
id|frame_data
comma
id|buffer_len
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|next_ptr
op_logical_and
(paren
id|buff_off
op_assign
id|next_ptr
)paren
)paren
suffix:semicolon
macro_line|#if STREAMER_NETWORK_MONITOR
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Received MAC Frame, details: &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|mac_hdr
op_assign
(paren
r_struct
id|trh_hdr
op_star
)paren
id|mac_frame-&gt;data
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: MAC Frame Dest. Addr: %02x:%02x:%02x:%02x:%02x:%02x &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mac_hdr-&gt;daddr
(braket
l_int|0
)braket
comma
id|mac_hdr-&gt;daddr
(braket
l_int|1
)braket
comma
id|mac_hdr-&gt;daddr
(braket
l_int|2
)braket
comma
id|mac_hdr-&gt;daddr
(braket
l_int|3
)braket
comma
id|mac_hdr-&gt;daddr
(braket
l_int|4
)braket
comma
id|mac_hdr-&gt;daddr
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: MAC Frame Srce. Addr: %02x:%02x:%02x:%02x:%02x:%02x &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mac_hdr-&gt;saddr
(braket
l_int|0
)braket
comma
id|mac_hdr-&gt;saddr
(braket
l_int|1
)braket
comma
id|mac_hdr-&gt;saddr
(braket
l_int|2
)braket
comma
id|mac_hdr-&gt;saddr
(braket
l_int|3
)braket
comma
id|mac_hdr-&gt;saddr
(braket
l_int|4
)braket
comma
id|mac_hdr-&gt;saddr
(braket
l_int|5
)braket
)paren
suffix:semicolon
macro_line|#endif
id|mac_frame-&gt;dev
op_assign
id|dev
suffix:semicolon
id|mac_frame-&gt;protocol
op_assign
id|tr_type_trans
c_func
(paren
id|mac_frame
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|mac_frame
)paren
suffix:semicolon
multiline_comment|/* Now tell the card we have dealt with the received frame */
multiline_comment|/* Set LISR Bit 1 */
id|writel
c_func
(paren
id|LISR_ARB_FREE
comma
id|streamer_priv-&gt;streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
multiline_comment|/* Is the ASB free ? */
r_if
c_cond
(paren
op_logical_neg
(paren
id|readl
c_func
(paren
id|streamer_priv-&gt;streamer_mmio
op_plus
id|SISR
)paren
op_amp
id|SISR_ASB_FREE
)paren
)paren
(brace
id|streamer_priv-&gt;asb_queued
op_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
id|LISR_ASB_FREE_REQ
comma
id|streamer_priv-&gt;streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* Drop out and wait for the bottom half to be run */
)brace
id|writew
c_func
(paren
id|streamer_priv-&gt;asb
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|ASB_RECEIVE_DATA
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|STREAMER_CLEAR_RET_CODE
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|streamer_priv-&gt;mac_rx_buffer
)paren
comma
id|streamer_mmio
op_plus
id|LAPD
)paren
suffix:semicolon
id|writel
c_func
(paren
id|LISR_ASB_REPLY
op_or
id|LISR_ASB_FREE_REQ
comma
id|streamer_priv-&gt;streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
id|streamer_priv-&gt;asb_queued
op_assign
l_int|2
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|arb_word
op_eq
id|ARB_LAN_CHANGE_STATUS
)paren
(brace
multiline_comment|/* Lan.change.status */
id|writew
c_func
(paren
id|streamer_priv-&gt;arb
op_plus
l_int|6
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|lan_status
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|fdx_prot_error
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPD
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
multiline_comment|/* Issue ARB Free */
id|writew
c_func
(paren
id|LISR_ARB_FREE
comma
id|streamer_priv-&gt;streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
id|lan_status_diff
op_assign
(paren
id|streamer_priv-&gt;streamer_lan_status
op_xor
id|lan_status
)paren
op_amp
id|lan_status
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
(paren
id|LSC_LWF
op_or
id|LSC_ARW
op_or
id|LSC_FPE
op_or
id|LSC_RR
)paren
)paren
(brace
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_LWF
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Short circuit detected on the lobe&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_ARW
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Auto removal error&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_FPE
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: FDX Protocol Error&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_RR
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Force remove MAC frame received&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Adapter has been closed by the hardware */
multiline_comment|/* reset tx/rx fifo&squot;s and busmaster logic */
multiline_comment|/* @TBD. no llc reset on autostreamer writel(readl(streamer_mmio+BCTL)|(3&lt;&lt;13),streamer_mmio+BCTL);&n;&t;&t;&t;   udelay(1);&n;&t;&t;&t;   writel(readl(streamer_mmio+BCTL)&amp;~(3&lt;&lt;13),streamer_mmio+BCTL); */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter has been closed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/* If serious error */
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
(brace
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_SIG_LOSS
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: No receive signal detected &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_HARD_ERR
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Beaconing &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_SOFT_ERR
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Adapter transmitted Soft Error Report Mac Frame &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_TRAN_BCN
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: We are tranmitting the beacon, aaah&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_SS
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Single Station on the ring &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_RING_REC
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Ring recovery ongoing&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_FDX_MODE
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Operating in FDX mode&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_CO
)paren
(brace
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Counter Overflow &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Issue READ.LOG command */
id|writew
c_func
(paren
id|streamer_priv-&gt;srb
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|SRB_READ_LOG
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|STREAMER_CLEAR_RET_CODE
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|streamer_priv-&gt;srb_queued
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Can&squot;t sleep, use srb_bh */
id|writew
c_func
(paren
id|LISR_SRB_CMD
comma
id|streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lan_status_diff
op_amp
id|LSC_SR_CO
)paren
(brace
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_message_level
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Source routing counters overflow&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Issue a READ.SR.COUNTERS */
id|writew
c_func
(paren
id|streamer_priv-&gt;srb
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|SRB_READ_SR_COUNTERS
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|STREAMER_CLEAR_RET_CODE
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|streamer_priv-&gt;srb_queued
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Can&squot;t sleep, use srb_bh */
id|writew
c_func
(paren
id|LISR_SRB_CMD
comma
id|streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
)brace
id|streamer_priv-&gt;streamer_lan_status
op_assign
id|lan_status
suffix:semicolon
)brace
multiline_comment|/* Lan.change.status */
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unknown arb command &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
DECL|function|streamer_asb_bh
r_static
r_void
id|streamer_asb_bh
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
r_if
c_cond
(paren
id|streamer_priv-&gt;asb_queued
op_eq
l_int|1
)paren
(brace
multiline_comment|/* Dropped through the first time */
id|writew
c_func
(paren
id|streamer_priv-&gt;asb
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|ASB_RECEIVE_DATA
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|STREAMER_CLEAR_RET_CODE
op_lshift
l_int|8
)paren
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
id|streamer_mmio
op_plus
id|LAPDINC
)paren
suffix:semicolon
id|writew
c_func
(paren
id|htons
c_func
(paren
id|streamer_priv-&gt;mac_rx_buffer
)paren
comma
id|streamer_mmio
op_plus
id|LAPD
)paren
suffix:semicolon
id|writel
c_func
(paren
id|LISR_ASB_REPLY
op_or
id|LISR_ASB_FREE_REQ
comma
id|streamer_priv-&gt;streamer_mmio
op_plus
id|LISR_SUM
)paren
suffix:semicolon
id|streamer_priv-&gt;asb_queued
op_assign
l_int|2
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|streamer_priv-&gt;asb_queued
op_eq
l_int|2
)paren
(brace
id|__u8
id|rc
suffix:semicolon
id|writew
c_func
(paren
id|streamer_priv-&gt;asb
op_plus
l_int|2
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
id|rc
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPD
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|rc
)paren
(brace
r_case
l_int|0x01
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized command code &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x26
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unrecognized buffer address &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xFF
suffix:colon
multiline_comment|/* Valid response, everything should be ok again */
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Invalid return code in asb&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|streamer_priv-&gt;asb_queued
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|streamer_change_mtu
r_static
r_int
id|streamer_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|mtu
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u16
id|max_mtu
suffix:semicolon
r_if
c_cond
(paren
id|streamer_priv-&gt;streamer_ring_speed
op_eq
l_int|4
)paren
id|max_mtu
op_assign
l_int|4500
suffix:semicolon
r_else
id|max_mtu
op_assign
l_int|18000
suffix:semicolon
r_if
c_cond
(paren
id|mtu
OG
id|max_mtu
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|mtu
OL
l_int|100
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|mtu
suffix:semicolon
id|streamer_priv-&gt;pkt_buf_sz
op_assign
id|mtu
op_plus
id|TR_HLEN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if STREAMER_NETWORK_MONITOR
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|streamer_proc_info
r_static
r_int
id|streamer_proc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_device
op_assign
l_int|NULL
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
r_int
id|size
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;IBM LanStreamer/MPC Chipset Token Ring Adapters&bslash;n&quot;
)paren
suffix:semicolon
id|pos
op_add_assign
id|size
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pci_device
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_IBM
comma
id|PCI_DEVICE_ID_IBM_TR
comma
id|pci_device
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
op_ne
l_int|NULL
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;base_addr
op_eq
id|pci_device-&gt;resource
(braket
l_int|0
)braket
dot
id|start
)paren
(brace
multiline_comment|/* Yep, a Streamer device */
id|size
op_assign
id|sprintf_info
c_func
(paren
id|buffer
op_plus
id|len
comma
id|dev
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/* if */
)brace
multiline_comment|/* for */
)brace
multiline_comment|/* While */
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start of wanted data */
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start slop */
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
multiline_comment|/* Ending slop */
r_return
id|len
suffix:semicolon
)brace
DECL|function|sprintf_info
r_static
r_int
id|sprintf_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|streamer_private
op_star
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u8
op_star
id|streamer_mmio
op_assign
id|streamer_priv-&gt;streamer_mmio
suffix:semicolon
r_struct
id|streamer_adapter_addr_table
id|sat
suffix:semicolon
r_struct
id|streamer_parameters_table
id|spt
suffix:semicolon
r_int
id|size
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|writew
c_func
(paren
id|streamer_priv-&gt;streamer_addr_table_addr
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|14
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|__u16
id|io_word
suffix:semicolon
id|__u8
op_star
id|datap
op_assign
(paren
id|__u8
op_star
)paren
op_amp
id|sat
suffix:semicolon
id|io_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|datap
(braket
id|size
)braket
op_assign
id|io_word
op_rshift
l_int|8
suffix:semicolon
id|datap
(braket
id|size
op_plus
l_int|1
)braket
op_assign
id|io_word
op_amp
l_int|0xff
suffix:semicolon
)brace
id|writew
c_func
(paren
id|streamer_priv-&gt;streamer_parms_addr
comma
id|streamer_mmio
op_plus
id|LAPA
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|68
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|__u16
id|io_word
suffix:semicolon
id|__u8
op_star
id|datap
op_assign
(paren
id|__u8
op_star
)paren
op_amp
id|spt
suffix:semicolon
id|io_word
op_assign
id|ntohs
c_func
(paren
id|readw
c_func
(paren
id|streamer_mmio
op_plus
id|LAPDINC
)paren
)paren
suffix:semicolon
id|datap
(braket
id|size
)braket
op_assign
id|io_word
op_rshift
l_int|8
suffix:semicolon
id|datap
(braket
id|size
op_plus
l_int|1
)braket
op_assign
id|io_word
op_amp
l_int|0xff
suffix:semicolon
)brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n%6s: Adapter Address   : Node Address      : Functional Addr&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: %02x:%02x:%02x:%02x:%02x:%02x : %02x:%02x:%02x:%02x:%02x:%02x : %02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
comma
id|sat.node_addr
(braket
l_int|0
)braket
comma
id|sat.node_addr
(braket
l_int|1
)braket
comma
id|sat.node_addr
(braket
l_int|2
)braket
comma
id|sat.node_addr
(braket
l_int|3
)braket
comma
id|sat.node_addr
(braket
l_int|4
)braket
comma
id|sat.node_addr
(braket
l_int|5
)braket
comma
id|sat.func_addr
(braket
l_int|0
)braket
comma
id|sat.func_addr
(braket
l_int|1
)braket
comma
id|sat.func_addr
(braket
l_int|2
)braket
comma
id|sat.func_addr
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;&bslash;n%6s: Token Ring Parameters Table:&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: Physical Addr : Up Node Address   : Poll Address      : AccPri : Auth Src : Att Code :&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: %02x:%02x:%02x:%02x   : %02x:%02x:%02x:%02x:%02x:%02x : %02x:%02x:%02x:%02x:%02x:%02x : %04x   : %04x     :  %04x    :&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|spt.phys_addr
(braket
l_int|0
)braket
comma
id|spt.phys_addr
(braket
l_int|1
)braket
comma
id|spt.phys_addr
(braket
l_int|2
)braket
comma
id|spt.phys_addr
(braket
l_int|3
)braket
comma
id|spt.up_node_addr
(braket
l_int|0
)braket
comma
id|spt.up_node_addr
(braket
l_int|1
)braket
comma
id|spt.up_node_addr
(braket
l_int|2
)braket
comma
id|spt.up_node_addr
(braket
l_int|3
)braket
comma
id|spt.up_node_addr
(braket
l_int|4
)braket
comma
id|spt.up_node_addr
(braket
l_int|4
)braket
comma
id|spt.poll_addr
(braket
l_int|0
)braket
comma
id|spt.poll_addr
(braket
l_int|1
)braket
comma
id|spt.poll_addr
(braket
l_int|2
)braket
comma
id|spt.poll_addr
(braket
l_int|3
)braket
comma
id|spt.poll_addr
(braket
l_int|4
)braket
comma
id|spt.poll_addr
(braket
l_int|5
)braket
comma
id|ntohs
c_func
(paren
id|spt.acc_priority
)paren
comma
id|ntohs
c_func
(paren
id|spt.auth_source_class
)paren
comma
id|ntohs
c_func
(paren
id|spt.att_code
)paren
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: Source Address    : Bcn T : Maj. V : Lan St : Lcl Rg : Mon Err : Frame Correl : &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: %02x:%02x:%02x:%02x:%02x:%02x : %04x  : %04x   : %04x   : %04x   : %04x    :     %04x     : &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|spt.source_addr
(braket
l_int|0
)braket
comma
id|spt.source_addr
(braket
l_int|1
)braket
comma
id|spt.source_addr
(braket
l_int|2
)braket
comma
id|spt.source_addr
(braket
l_int|3
)braket
comma
id|spt.source_addr
(braket
l_int|4
)braket
comma
id|spt.source_addr
(braket
l_int|5
)braket
comma
id|ntohs
c_func
(paren
id|spt.beacon_type
)paren
comma
id|ntohs
c_func
(paren
id|spt.major_vector
)paren
comma
id|ntohs
c_func
(paren
id|spt.lan_status
)paren
comma
id|ntohs
c_func
(paren
id|spt.local_ring
)paren
comma
id|ntohs
c_func
(paren
id|spt.mon_error
)paren
comma
id|ntohs
c_func
(paren
id|spt.frame_correl
)paren
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s: Beacon Details :  Tx  :  Rx  : NAUN Node Address : NAUN Node Phys : &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|size
comma
l_string|&quot;%6s:                :  %02x  :  %02x  : %02x:%02x:%02x:%02x:%02x:%02x : %02x:%02x:%02x:%02x    : &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ntohs
c_func
(paren
id|spt.beacon_transmit
)paren
comma
id|ntohs
c_func
(paren
id|spt.beacon_receive
)paren
comma
id|spt.beacon_naun
(braket
l_int|0
)braket
comma
id|spt.beacon_naun
(braket
l_int|1
)braket
comma
id|spt.beacon_naun
(braket
l_int|2
)braket
comma
id|spt.beacon_naun
(braket
l_int|3
)braket
comma
id|spt.beacon_naun
(braket
l_int|4
)braket
comma
id|spt.beacon_naun
(braket
l_int|5
)braket
comma
id|spt.beacon_phys
(braket
l_int|0
)braket
comma
id|spt.beacon_phys
(braket
l_int|1
)braket
comma
id|spt.beacon_phys
(braket
l_int|2
)braket
comma
id|spt.beacon_phys
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif
macro_line|#ifdef MODULE
DECL|variable|dev_streamer
r_static
r_struct
id|net_device
op_star
id|dev_streamer
(braket
id|STREAMER_MAX_ADAPTERS
)braket
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#if STREAMER_NETWORK_MONITOR
macro_line|#ifdef CONFIG_PROC_FS
id|create_proc_read_entry
c_func
(paren
l_string|&quot;net/streamer_tr&quot;
comma
l_int|0
comma
l_int|0
comma
id|streamer_proc_info
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
id|STREAMER_MAX_ADAPTERS
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev_streamer
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev_streamer
(braket
id|i
)braket
op_assign
id|init_trdev
c_func
(paren
id|dev_streamer
(braket
id|i
)braket
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_streamer
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|dev_streamer
(braket
id|i
)braket
op_member_access_from_pointer
id|init
op_assign
op_amp
id|streamer_probe
suffix:semicolon
r_if
c_cond
(paren
id|register_trdev
c_func
(paren
id|dev_streamer
(braket
id|i
)braket
)paren
op_ne
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|dev_streamer
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev_streamer
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Streamer: No IBM LanStreamer PCI Token Ring cards found in system.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Streamer: %d IBM LanStreamer PCI Token Ring card(s) found in system.&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|streamer_private
op_star
id|streamer_priv
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|STREAMER_MAX_ADAPTERS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev_streamer
(braket
id|i
)braket
)paren
(brace
id|unregister_trdev
c_func
(paren
id|dev_streamer
(braket
id|i
)braket
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev_streamer
(braket
id|i
)braket
op_member_access_from_pointer
id|base_addr
comma
id|STREAMER_IO_SPACE
)paren
suffix:semicolon
id|streamer_priv
op_assign
(paren
r_struct
id|streamer_private
op_star
)paren
id|dev_streamer
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
suffix:semicolon
id|kfree
c_func
(paren
id|streamer_priv-&gt;streamer_rx_ring
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|streamer_priv-&gt;streamer_tx_ring
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev_streamer
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev_streamer
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev_streamer
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#if STREAMER_NETWORK_MONITOR
macro_line|#ifdef CONFIG_PROC_FS
id|remove_proc_entry
c_func
(paren
l_string|&quot;net/streamer_tr&quot;
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
)brace
macro_line|#endif&t;&t;&t;&t;/* MODULE */
eof
