multiline_comment|/* sunbmac.c: Driver for Sparc BigMAC 100baseT ethernet adapters.&n; *&n; * Copyright (C) 1997, 1998 David S. Miller (davem@caip.rutgers.edu)&n; */
DECL|variable|version
r_static
r_char
op_star
id|version
op_assign
l_string|&quot;sunbmac.c:v1.1 8/Dec/98 David S. Miller (davem@caipfs.rutgers.edu)&bslash;n&quot;
suffix:semicolon
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/idprom.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/auxio.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &quot;sunbmac.h&quot;
DECL|macro|DEBUG_PROBE
macro_line|#undef DEBUG_PROBE
DECL|macro|DEBUG_TX
macro_line|#undef DEBUG_TX
DECL|macro|DEBUG_IRQ
macro_line|#undef DEBUG_IRQ
macro_line|#ifdef DEBUG_PROBE
DECL|macro|DP
mdefine_line|#define DP(x)  printk x
macro_line|#else
DECL|macro|DP
mdefine_line|#define DP(x)
macro_line|#endif
macro_line|#ifdef DEBUG_TX
DECL|macro|DTX
mdefine_line|#define DTX(x)  printk x
macro_line|#else
DECL|macro|DTX
mdefine_line|#define DTX(x)
macro_line|#endif
macro_line|#ifdef DEBUG_IRQ
DECL|macro|DIRQ
mdefine_line|#define DIRQ(x)  printk x
macro_line|#else
DECL|macro|DIRQ
mdefine_line|#define DIRQ(x)
macro_line|#endif
macro_line|#ifdef MODULE
DECL|variable|root_bigmac_dev
r_static
r_struct
id|bigmac
op_star
id|root_bigmac_dev
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
DECL|macro|DEFAULT_JAMSIZE
mdefine_line|#define DEFAULT_JAMSIZE    4 /* Toe jam */
DECL|macro|QEC_RESET_TRIES
mdefine_line|#define QEC_RESET_TRIES 200
DECL|function|qec_global_reset
r_static
r_inline
r_int
id|qec_global_reset
c_func
(paren
r_struct
id|qe_globreg
op_star
id|gregs
)paren
(brace
r_int
id|tries
op_assign
id|QEC_RESET_TRIES
suffix:semicolon
id|gregs-&gt;ctrl
op_assign
id|GLOB_CTRL_RESET
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|tries
)paren
(brace
r_if
c_cond
(paren
id|gregs-&gt;ctrl
op_amp
id|GLOB_CTRL_RESET
)paren
(brace
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tries
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;BigMAC: Cannot reset the QEC.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|qec_init
r_static
r_void
id|qec_init
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
)paren
(brace
r_struct
id|qe_globreg
op_star
id|gregs
op_assign
id|bp-&gt;gregs
suffix:semicolon
r_struct
id|linux_sbus_device
op_star
id|qec_sdev
op_assign
id|bp-&gt;qec_sbus_dev
suffix:semicolon
r_int
r_char
id|bsizes
op_assign
id|bp-&gt;bigmac_bursts
suffix:semicolon
r_int
r_int
id|regval
suffix:semicolon
multiline_comment|/* 64byte bursts do not work at the moment, do&n;&t; * not even try to enable them.  -DaveM&n;&t; */
r_if
c_cond
(paren
id|bsizes
op_amp
id|DMA_BURST32
)paren
(brace
id|regval
op_assign
id|GLOB_CTRL_B32
suffix:semicolon
)brace
r_else
id|regval
op_assign
id|GLOB_CTRL_B16
suffix:semicolon
id|gregs-&gt;ctrl
op_assign
id|regval
op_or
id|GLOB_CTRL_BMODE
suffix:semicolon
id|gregs-&gt;psize
op_assign
id|GLOB_PSIZE_2048
suffix:semicolon
multiline_comment|/* All of memsize is given to bigmac. */
id|gregs-&gt;msize
op_assign
id|qec_sdev-&gt;reg_addrs
(braket
l_int|1
)braket
dot
id|reg_size
suffix:semicolon
multiline_comment|/* Half to the transmitter, half to the receiver. */
id|gregs-&gt;rsize
op_assign
id|gregs-&gt;tsize
op_assign
id|qec_sdev-&gt;reg_addrs
(braket
l_int|1
)braket
dot
id|reg_size
op_rshift
l_int|1
suffix:semicolon
)brace
multiline_comment|/* XXX auto negotiation on these things might not be pleasant... */
DECL|macro|TX_RESET_TRIES
mdefine_line|#define TX_RESET_TRIES     32
DECL|macro|RX_RESET_TRIES
mdefine_line|#define RX_RESET_TRIES     32
DECL|function|bigmac_tx_reset
r_static
r_inline
r_void
id|bigmac_tx_reset
c_func
(paren
r_struct
id|BIG_MAC_regs
op_star
id|bregs
)paren
(brace
r_int
id|tries
op_assign
id|TX_RESET_TRIES
suffix:semicolon
id|bregs-&gt;tx_cfg
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* The fifo threshold bit is read-only and does&n;&t; * not clear.  -DaveM&n;&t; */
r_while
c_loop
(paren
(paren
id|bregs-&gt;tx_cfg
op_amp
op_complement
(paren
id|BIGMAC_TXCFG_FIFO
)paren
)paren
op_ne
l_int|0
op_logical_and
op_decrement
id|tries
op_ne
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|tries
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BIGMAC: Transmitter will not reset.&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;BIGMAC: tx_cfg is %08x&bslash;n&quot;
comma
id|bregs-&gt;tx_cfg
)paren
suffix:semicolon
)brace
)brace
DECL|function|bigmac_rx_reset
r_static
r_inline
r_void
id|bigmac_rx_reset
c_func
(paren
r_struct
id|BIG_MAC_regs
op_star
id|bregs
)paren
(brace
r_int
id|tries
op_assign
id|RX_RESET_TRIES
suffix:semicolon
id|bregs-&gt;rx_cfg
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|bregs-&gt;rx_cfg
)paren
op_logical_and
op_decrement
id|tries
)paren
(brace
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|tries
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BIGMAC: Receiver will not reset.&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;BIGMAC: rx_cfg is %08x&bslash;n&quot;
comma
id|bregs-&gt;rx_cfg
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Reset the transmitter and receiver. */
DECL|function|bigmac_stop
r_static
r_void
id|bigmac_stop
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
)paren
(brace
id|bigmac_tx_reset
c_func
(paren
id|bp-&gt;bregs
)paren
suffix:semicolon
id|bigmac_rx_reset
c_func
(paren
id|bp-&gt;bregs
)paren
suffix:semicolon
)brace
DECL|function|bigmac_get_counters
r_static
r_void
id|bigmac_get_counters
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_struct
id|BIG_MAC_regs
op_star
id|bregs
)paren
(brace
r_struct
id|enet_statistics
op_star
id|stats
op_assign
op_amp
id|bp-&gt;enet_stats
suffix:semicolon
id|stats-&gt;rx_crc_errors
op_add_assign
id|bregs-&gt;rcrce_ctr
suffix:semicolon
id|bregs-&gt;rcrce_ctr
op_assign
l_int|0
suffix:semicolon
id|stats-&gt;rx_frame_errors
op_add_assign
id|bregs-&gt;unale_ctr
suffix:semicolon
id|bregs-&gt;unale_ctr
op_assign
l_int|0
suffix:semicolon
id|stats-&gt;rx_length_errors
op_add_assign
id|bregs-&gt;gle_ctr
suffix:semicolon
id|bregs-&gt;gle_ctr
op_assign
l_int|0
suffix:semicolon
id|stats-&gt;tx_aborted_errors
op_add_assign
id|bregs-&gt;ex_ctr
suffix:semicolon
id|stats-&gt;collisions
op_add_assign
(paren
id|bregs-&gt;ex_ctr
op_plus
id|bregs-&gt;lt_ctr
)paren
suffix:semicolon
id|bregs-&gt;ex_ctr
op_assign
id|bregs-&gt;lt_ctr
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|bigmac_clean_rings
r_static
r_inline
r_void
id|bigmac_clean_rings
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|bp-&gt;rx_skbs
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|bp-&gt;rx_skbs
(braket
id|i
)braket
)paren
suffix:semicolon
id|bp-&gt;rx_skbs
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|bp-&gt;tx_skbs
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|bp-&gt;tx_skbs
(braket
id|i
)braket
)paren
suffix:semicolon
id|bp-&gt;tx_skbs
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
DECL|function|bigmac_init_rings
r_static
r_void
id|bigmac_init_rings
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_int
id|from_irq
)paren
(brace
r_struct
id|bmac_init_block
op_star
id|bb
op_assign
id|bp-&gt;bmac_block
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
id|bp-&gt;dev
suffix:semicolon
r_int
id|i
comma
id|gfp_flags
op_assign
id|GFP_KERNEL
suffix:semicolon
r_if
c_cond
(paren
id|from_irq
op_logical_or
id|in_interrupt
c_func
(paren
)paren
)paren
(brace
id|gfp_flags
op_assign
id|GFP_ATOMIC
suffix:semicolon
)brace
id|bp-&gt;rx_new
op_assign
id|bp-&gt;rx_old
op_assign
id|bp-&gt;tx_new
op_assign
id|bp-&gt;tx_old
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Free any skippy bufs left around in the rings. */
id|bigmac_clean_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
multiline_comment|/* Now get new skippy bufs for the receive ring. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|big_mac_alloc_skb
c_func
(paren
id|RX_BUF_ALLOC_SIZE
comma
id|gfp_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
r_continue
suffix:semicolon
)brace
id|bp-&gt;rx_skbs
(braket
id|i
)braket
op_assign
id|skb
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Because we reserve afterwards. */
id|skb_put
c_func
(paren
id|skb
comma
id|ETH_FRAME_LEN
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|34
)paren
suffix:semicolon
id|bb-&gt;be_rxd
(braket
id|i
)braket
dot
id|rx_addr
op_assign
id|sbus_dvma_addr
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|bb-&gt;be_rxd
(braket
id|i
)braket
dot
id|rx_flags
op_assign
(paren
id|RXD_OWN
op_or
(paren
(paren
id|RX_BUF_ALLOC_SIZE
op_minus
l_int|34
)paren
op_amp
id|RXD_LENGTH
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bb-&gt;be_txd
(braket
id|i
)braket
dot
id|tx_flags
op_assign
id|bb-&gt;be_txd
(braket
id|i
)braket
dot
id|tx_addr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#ifndef __sparc_v9__
DECL|function|sun4c_bigmac_init_rings
r_static
r_void
id|sun4c_bigmac_init_rings
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
)paren
(brace
r_struct
id|bmac_init_block
op_star
id|bb
op_assign
id|bp-&gt;bmac_block
suffix:semicolon
id|__u32
id|bbufs_dvma
op_assign
id|bp-&gt;s4c_buf_dvma
suffix:semicolon
r_int
id|i
suffix:semicolon
id|bp-&gt;rx_new
op_assign
id|bp-&gt;rx_old
op_assign
id|bp-&gt;tx_new
op_assign
id|bp-&gt;tx_old
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bb-&gt;be_rxd
(braket
id|i
)braket
dot
id|rx_addr
op_assign
id|bbufs_dvma
op_plus
id|bbuf_offset
c_func
(paren
id|rx_buf
comma
id|i
)paren
suffix:semicolon
id|bb-&gt;be_rxd
(braket
id|i
)braket
dot
id|rx_flags
op_assign
(paren
id|RXD_OWN
op_or
(paren
id|SUN4C_RX_BUFF_SIZE
op_amp
id|RXD_LENGTH
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bb-&gt;be_txd
(braket
id|i
)braket
dot
id|tx_flags
op_assign
id|bb-&gt;be_txd
(braket
id|i
)braket
dot
id|tx_addr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|macro|MGMT_CLKON
mdefine_line|#define MGMT_CLKON  (MGMT_PAL_INT_MDIO|MGMT_PAL_EXT_MDIO|MGMT_PAL_OENAB|MGMT_PAL_DCLOCK)
DECL|macro|MGMT_CLKOFF
mdefine_line|#define MGMT_CLKOFF (MGMT_PAL_INT_MDIO|MGMT_PAL_EXT_MDIO|MGMT_PAL_OENAB)
DECL|function|idle_transceiver
r_static
r_inline
r_void
id|idle_transceiver
c_func
(paren
r_struct
id|bmac_tcvr
op_star
id|tregs
)paren
(brace
r_volatile
r_int
r_int
id|garbage
suffix:semicolon
r_int
id|i
op_assign
l_int|20
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
)paren
(brace
id|tregs-&gt;mgmt_pal
op_assign
id|MGMT_CLKOFF
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
id|tregs-&gt;mgmt_pal
op_assign
id|MGMT_CLKON
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
)brace
)brace
DECL|function|write_tcvr_bit
r_static
r_void
id|write_tcvr_bit
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_struct
id|bmac_tcvr
op_star
id|tregs
comma
r_int
id|bit
)paren
(brace
r_volatile
r_int
r_int
id|garbage
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;tcvr_type
op_eq
id|internal
)paren
(brace
id|bit
op_assign
(paren
id|bit
op_amp
l_int|1
)paren
op_lshift
l_int|3
suffix:semicolon
id|tregs-&gt;mgmt_pal
op_assign
id|bit
op_or
(paren
id|MGMT_PAL_OENAB
op_or
id|MGMT_PAL_EXT_MDIO
)paren
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
id|tregs-&gt;mgmt_pal
op_assign
id|bit
op_or
(paren
id|MGMT_PAL_OENAB
op_or
id|MGMT_PAL_EXT_MDIO
op_or
id|MGMT_PAL_DCLOCK
)paren
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bp-&gt;tcvr_type
op_eq
id|external
)paren
(brace
id|bit
op_assign
(paren
id|bit
op_amp
l_int|1
)paren
op_lshift
l_int|2
suffix:semicolon
id|tregs-&gt;mgmt_pal
op_assign
id|bit
op_or
(paren
id|MGMT_PAL_INT_MDIO
op_or
id|MGMT_PAL_OENAB
)paren
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
id|tregs-&gt;mgmt_pal
op_assign
id|bit
op_or
(paren
id|MGMT_PAL_INT_MDIO
op_or
id|MGMT_PAL_OENAB
op_or
id|MGMT_PAL_DCLOCK
)paren
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;write_tcvr_bit: No transceiver type known!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|read_tcvr_bit
r_static
r_int
id|read_tcvr_bit
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_struct
id|bmac_tcvr
op_star
id|tregs
)paren
(brace
r_volatile
r_int
r_int
id|garbage
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;tcvr_type
op_eq
id|internal
)paren
(brace
id|tregs-&gt;mgmt_pal
op_assign
id|MGMT_PAL_EXT_MDIO
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
id|tregs-&gt;mgmt_pal
op_assign
id|MGMT_PAL_EXT_MDIO
op_or
id|MGMT_PAL_DCLOCK
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
id|retval
op_assign
(paren
id|tregs-&gt;mgmt_pal
op_amp
id|MGMT_PAL_INT_MDIO
)paren
op_rshift
l_int|3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bp-&gt;tcvr_type
op_eq
id|external
)paren
(brace
id|tregs-&gt;mgmt_pal
op_assign
id|MGMT_PAL_INT_MDIO
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
id|tregs-&gt;mgmt_pal
op_assign
id|MGMT_PAL_INT_MDIO
op_or
id|MGMT_PAL_DCLOCK
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
id|retval
op_assign
(paren
id|tregs-&gt;mgmt_pal
op_amp
id|MGMT_PAL_EXT_MDIO
)paren
op_rshift
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;read_tcvr_bit: No transceiver type known!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|read_tcvr_bit2
r_static
r_int
id|read_tcvr_bit2
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_struct
id|bmac_tcvr
op_star
id|tregs
)paren
(brace
r_volatile
r_int
r_int
id|garbage
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;tcvr_type
op_eq
id|internal
)paren
(brace
id|tregs-&gt;mgmt_pal
op_assign
id|MGMT_PAL_EXT_MDIO
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
id|retval
op_assign
(paren
id|tregs-&gt;mgmt_pal
op_amp
id|MGMT_PAL_INT_MDIO
)paren
op_rshift
l_int|3
suffix:semicolon
id|tregs-&gt;mgmt_pal
op_assign
(paren
id|MGMT_PAL_EXT_MDIO
op_or
id|MGMT_PAL_DCLOCK
)paren
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bp-&gt;tcvr_type
op_eq
id|external
)paren
(brace
id|tregs-&gt;mgmt_pal
op_assign
id|MGMT_PAL_INT_MDIO
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
id|retval
op_assign
(paren
id|tregs-&gt;mgmt_pal
op_amp
id|MGMT_PAL_EXT_MDIO
)paren
op_rshift
l_int|2
suffix:semicolon
id|tregs-&gt;mgmt_pal
op_assign
(paren
id|MGMT_PAL_INT_MDIO
op_or
id|MGMT_PAL_DCLOCK
)paren
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;read_tcvr_bit2: No transceiver type known!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|put_tcvr_byte
r_static
r_inline
r_void
id|put_tcvr_byte
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_struct
id|bmac_tcvr
op_star
id|tregs
comma
r_int
r_int
id|byte
)paren
(brace
r_int
id|shift
op_assign
l_int|4
suffix:semicolon
r_do
(brace
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
(paren
(paren
id|byte
op_rshift
id|shift
)paren
op_amp
l_int|1
)paren
)paren
suffix:semicolon
id|shift
op_sub_assign
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
id|shift
op_ge
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|bigmac_tcvr_write
r_static
r_void
id|bigmac_tcvr_write
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_struct
id|bmac_tcvr
op_star
id|tregs
comma
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
r_int
id|shift
suffix:semicolon
id|reg
op_and_assign
l_int|0xff
suffix:semicolon
id|val
op_and_assign
l_int|0xffff
suffix:semicolon
r_switch
c_cond
(paren
id|bp-&gt;tcvr_type
)paren
(brace
r_case
id|internal
suffix:colon
r_case
id|external
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;bigmac_tcvr_read: Whoops, no known transceiver type.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
suffix:semicolon
id|idle_transceiver
c_func
(paren
id|tregs
)paren
suffix:semicolon
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
l_int|0
)paren
suffix:semicolon
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
l_int|1
)paren
suffix:semicolon
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
l_int|0
)paren
suffix:semicolon
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
l_int|1
)paren
suffix:semicolon
id|put_tcvr_byte
c_func
(paren
id|bp
comma
id|tregs
comma
(paren
(paren
id|bp-&gt;tcvr_type
op_eq
id|internal
)paren
ques
c_cond
id|BIGMAC_PHY_INTERNAL
suffix:colon
id|BIGMAC_PHY_EXTERNAL
)paren
)paren
suffix:semicolon
id|put_tcvr_byte
c_func
(paren
id|bp
comma
id|tregs
comma
id|reg
)paren
suffix:semicolon
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
l_int|1
)paren
suffix:semicolon
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
l_int|0
)paren
suffix:semicolon
id|shift
op_assign
l_int|15
suffix:semicolon
r_do
(brace
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
(paren
id|val
op_rshift
id|shift
)paren
op_amp
l_int|1
)paren
suffix:semicolon
id|shift
op_sub_assign
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
id|shift
op_ge
l_int|0
)paren
(brace
suffix:semicolon
)brace
)brace
DECL|function|bigmac_tcvr_read
r_static
r_int
r_int
id|bigmac_tcvr_read
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_struct
id|bmac_tcvr
op_star
id|tregs
comma
r_int
id|reg
)paren
(brace
r_int
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|reg
op_and_assign
l_int|0xff
suffix:semicolon
r_switch
c_cond
(paren
id|bp-&gt;tcvr_type
)paren
(brace
r_case
id|internal
suffix:colon
r_case
id|external
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;bigmac_tcvr_read: Whoops, no known transceiver type.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0xffff
suffix:semicolon
)brace
suffix:semicolon
id|idle_transceiver
c_func
(paren
id|tregs
)paren
suffix:semicolon
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
l_int|0
)paren
suffix:semicolon
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
l_int|1
)paren
suffix:semicolon
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
l_int|1
)paren
suffix:semicolon
id|write_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
comma
l_int|0
)paren
suffix:semicolon
id|put_tcvr_byte
c_func
(paren
id|bp
comma
id|tregs
comma
(paren
(paren
id|bp-&gt;tcvr_type
op_eq
id|internal
)paren
ques
c_cond
id|BIGMAC_PHY_INTERNAL
suffix:colon
id|BIGMAC_PHY_EXTERNAL
)paren
)paren
suffix:semicolon
id|put_tcvr_byte
c_func
(paren
id|bp
comma
id|tregs
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;tcvr_type
op_eq
id|external
)paren
(brace
r_int
id|shift
op_assign
l_int|15
suffix:semicolon
(paren
r_void
)paren
id|read_tcvr_bit2
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
(paren
r_void
)paren
id|read_tcvr_bit2
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
r_do
(brace
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|read_tcvr_bit2
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
id|retval
op_or_assign
(paren
(paren
id|tmp
op_amp
l_int|1
)paren
op_lshift
id|shift
)paren
suffix:semicolon
id|shift
op_sub_assign
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
id|shift
op_ge
l_int|0
)paren
(brace
suffix:semicolon
)brace
(paren
r_void
)paren
id|read_tcvr_bit2
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
(paren
r_void
)paren
id|read_tcvr_bit2
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
(paren
r_void
)paren
id|read_tcvr_bit2
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|shift
op_assign
l_int|15
suffix:semicolon
(paren
r_void
)paren
id|read_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
(paren
r_void
)paren
id|read_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
r_do
(brace
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|read_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
id|retval
op_or_assign
(paren
(paren
id|tmp
op_amp
l_int|1
)paren
op_lshift
id|shift
)paren
suffix:semicolon
id|shift
op_sub_assign
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
id|shift
op_ge
l_int|0
)paren
(brace
suffix:semicolon
)brace
(paren
r_void
)paren
id|read_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
(paren
r_void
)paren
id|read_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
(paren
r_void
)paren
id|read_tcvr_bit
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|bigmac_tcvr_init
r_static
r_void
id|bigmac_tcvr_init
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
)paren
(brace
r_volatile
r_int
r_int
id|garbage
suffix:semicolon
r_struct
id|bmac_tcvr
op_star
id|tregs
op_assign
id|bp-&gt;tregs
suffix:semicolon
id|idle_transceiver
c_func
(paren
id|tregs
)paren
suffix:semicolon
id|tregs-&gt;mgmt_pal
op_assign
(paren
id|MGMT_PAL_INT_MDIO
op_or
id|MGMT_PAL_EXT_MDIO
op_or
id|MGMT_PAL_DCLOCK
)paren
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
multiline_comment|/* Only the bit for the present transceiver (internal or&n;&t; * external) will stick, set them both and see what stays.&n;&t; */
id|tregs-&gt;mgmt_pal
op_assign
(paren
id|MGMT_PAL_INT_MDIO
op_or
id|MGMT_PAL_EXT_MDIO
)paren
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;mgmt_pal
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tregs-&gt;mgmt_pal
op_amp
id|MGMT_PAL_EXT_MDIO
)paren
(brace
id|bp-&gt;tcvr_type
op_assign
id|external
suffix:semicolon
id|tregs-&gt;tcvr_pal
op_assign
op_complement
(paren
id|TCVR_PAL_EXTLBACK
op_or
id|TCVR_PAL_MSENSE
op_or
id|TCVR_PAL_LTENABLE
)paren
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;tcvr_pal
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tregs-&gt;mgmt_pal
op_amp
id|MGMT_PAL_INT_MDIO
)paren
(brace
id|bp-&gt;tcvr_type
op_assign
id|internal
suffix:semicolon
id|tregs-&gt;tcvr_pal
op_assign
op_complement
(paren
id|TCVR_PAL_SERIAL
op_or
id|TCVR_PAL_EXTLBACK
op_or
id|TCVR_PAL_MSENSE
op_or
id|TCVR_PAL_LTENABLE
)paren
suffix:semicolon
id|garbage
op_assign
id|tregs-&gt;tcvr_pal
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;BIGMAC: AIEEE, neither internal nor &quot;
l_string|&quot;external MDIO available!&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;BIGMAC: mgmt_pal[%08x] tcvr_pal[%08x]&bslash;n&quot;
comma
id|tregs-&gt;mgmt_pal
comma
id|tregs-&gt;tcvr_pal
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
id|bigmac_init
c_func
(paren
r_struct
id|bigmac
op_star
comma
r_int
)paren
suffix:semicolon
DECL|function|try_next_permutation
r_static
r_int
id|try_next_permutation
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_struct
id|bmac_tcvr
op_star
id|tregs
)paren
(brace
r_if
c_cond
(paren
id|bp-&gt;sw_bmcr
op_amp
id|BMCR_SPEED100
)paren
(brace
r_int
id|timeout
suffix:semicolon
multiline_comment|/* Reset the PHY. */
id|bp-&gt;sw_bmcr
op_assign
(paren
id|BMCR_ISOLATE
op_or
id|BMCR_PDOWN
op_or
id|BMCR_LOOPBACK
)paren
suffix:semicolon
id|bigmac_tcvr_write
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
comma
id|bp-&gt;sw_bmcr
)paren
suffix:semicolon
id|bp-&gt;sw_bmcr
op_assign
(paren
id|BMCR_RESET
)paren
suffix:semicolon
id|bigmac_tcvr_write
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
comma
id|bp-&gt;sw_bmcr
)paren
suffix:semicolon
id|timeout
op_assign
l_int|64
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|timeout
)paren
(brace
id|bp-&gt;sw_bmcr
op_assign
id|bigmac_tcvr_read
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bp-&gt;sw_bmcr
op_amp
id|BMCR_RESET
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|timeout
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: PHY reset failed.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
id|bp-&gt;sw_bmcr
op_assign
id|bigmac_tcvr_read
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
)paren
suffix:semicolon
multiline_comment|/* Now we try 10baseT. */
id|bp-&gt;sw_bmcr
op_and_assign
op_complement
(paren
id|BMCR_SPEED100
)paren
suffix:semicolon
id|bigmac_tcvr_write
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
comma
id|bp-&gt;sw_bmcr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* We&squot;ve tried them all. */
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|bigmac_timer
r_static
r_void
id|bigmac_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|bigmac
op_star
id|bp
op_assign
(paren
r_struct
id|bigmac
op_star
)paren
id|data
suffix:semicolon
r_struct
id|bmac_tcvr
op_star
id|tregs
op_assign
id|bp-&gt;tregs
suffix:semicolon
r_int
id|restart_timer
op_assign
l_int|0
suffix:semicolon
id|bp-&gt;timer_ticks
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;timer_state
op_eq
id|ltrywait
)paren
(brace
id|bp-&gt;sw_bmsr
op_assign
id|bigmac_tcvr_read
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMSR
)paren
suffix:semicolon
id|bp-&gt;sw_bmcr
op_assign
id|bigmac_tcvr_read
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;sw_bmsr
op_amp
id|BMSR_LSTATUS
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Link is now up at %s.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
comma
(paren
id|bp-&gt;sw_bmcr
op_amp
id|BMCR_SPEED100
)paren
ques
c_cond
l_string|&quot;100baseT&quot;
suffix:colon
l_string|&quot;10baseT&quot;
)paren
suffix:semicolon
id|bp-&gt;timer_state
op_assign
id|asleep
suffix:semicolon
id|restart_timer
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|bp-&gt;timer_ticks
op_ge
l_int|4
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|try_next_permutation
c_func
(paren
id|bp
comma
id|tregs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Link down, cable problem?&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
id|ret
op_assign
id|bigmac_init
c_func
(paren
id|bp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Error, cannot re-init the &quot;
l_string|&quot;BigMAC.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|bp-&gt;timer_ticks
op_assign
l_int|0
suffix:semicolon
id|restart_timer
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|restart_timer
op_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* Can&squot;t happens.... */
id|printk
c_func
(paren
l_string|&quot;%s: Aieee, link timer is asleep but we got one anyways!&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
id|restart_timer
op_assign
l_int|0
suffix:semicolon
id|bp-&gt;timer_ticks
op_assign
l_int|0
suffix:semicolon
id|bp-&gt;timer_state
op_assign
id|asleep
suffix:semicolon
multiline_comment|/* foo on you */
)brace
r_if
c_cond
(paren
id|restart_timer
op_ne
l_int|0
)paren
(brace
id|bp-&gt;bigmac_timer.expires
op_assign
id|jiffies
op_plus
(paren
(paren
l_int|12
op_star
id|HZ
)paren
op_div
l_int|10
)paren
suffix:semicolon
multiline_comment|/* 1.2 sec. */
id|add_timer
c_func
(paren
op_amp
id|bp-&gt;bigmac_timer
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Well, really we just force the chip into 100baseT then&n; * 10baseT, each time checking for a link status.&n; */
DECL|function|bigmac_begin_auto_negotiation
r_static
r_void
id|bigmac_begin_auto_negotiation
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
)paren
(brace
r_struct
id|bmac_tcvr
op_star
id|tregs
op_assign
id|bp-&gt;tregs
suffix:semicolon
r_int
id|timeout
suffix:semicolon
multiline_comment|/* Grab new software copies of PHY registers. */
id|bp-&gt;sw_bmsr
op_assign
id|bigmac_tcvr_read
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMSR
)paren
suffix:semicolon
id|bp-&gt;sw_bmcr
op_assign
id|bigmac_tcvr_read
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
)paren
suffix:semicolon
multiline_comment|/* Reset the PHY. */
id|bp-&gt;sw_bmcr
op_assign
(paren
id|BMCR_ISOLATE
op_or
id|BMCR_PDOWN
op_or
id|BMCR_LOOPBACK
)paren
suffix:semicolon
id|bigmac_tcvr_write
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
comma
id|bp-&gt;sw_bmcr
)paren
suffix:semicolon
id|bp-&gt;sw_bmcr
op_assign
(paren
id|BMCR_RESET
)paren
suffix:semicolon
id|bigmac_tcvr_write
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
comma
id|bp-&gt;sw_bmcr
)paren
suffix:semicolon
id|timeout
op_assign
l_int|64
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|timeout
)paren
(brace
id|bp-&gt;sw_bmcr
op_assign
id|bigmac_tcvr_read
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bp-&gt;sw_bmcr
op_amp
id|BMCR_RESET
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|timeout
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: PHY reset failed.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
id|bp-&gt;sw_bmcr
op_assign
id|bigmac_tcvr_read
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
)paren
suffix:semicolon
multiline_comment|/* First we try 100baseT. */
id|bp-&gt;sw_bmcr
op_or_assign
id|BMCR_SPEED100
suffix:semicolon
id|bigmac_tcvr_write
c_func
(paren
id|bp
comma
id|tregs
comma
id|BIGMAC_BMCR
comma
id|bp-&gt;sw_bmcr
)paren
suffix:semicolon
id|bp-&gt;timer_state
op_assign
id|ltrywait
suffix:semicolon
id|bp-&gt;timer_ticks
op_assign
l_int|0
suffix:semicolon
id|bp-&gt;bigmac_timer.expires
op_assign
id|jiffies
op_plus
(paren
l_int|12
op_star
id|HZ
)paren
op_div
l_int|10
suffix:semicolon
id|bp-&gt;bigmac_timer.data
op_assign
(paren
r_int
r_int
)paren
id|bp
suffix:semicolon
id|bp-&gt;bigmac_timer.function
op_assign
op_amp
id|bigmac_timer
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|bp-&gt;bigmac_timer
)paren
suffix:semicolon
)brace
DECL|function|bigmac_init
r_static
r_int
id|bigmac_init
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_int
id|from_irq
)paren
(brace
r_struct
id|qe_globreg
op_star
id|gregs
op_assign
id|bp-&gt;gregs
suffix:semicolon
r_struct
id|qe_creg
op_star
id|cregs
op_assign
id|bp-&gt;creg
suffix:semicolon
r_struct
id|BIG_MAC_regs
op_star
id|bregs
op_assign
id|bp-&gt;bregs
suffix:semicolon
r_int
r_char
op_star
id|e
op_assign
op_amp
id|bp-&gt;dev-&gt;dev_addr
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* Latch current counters into statistics. */
id|bigmac_get_counters
c_func
(paren
id|bp
comma
id|bregs
)paren
suffix:semicolon
multiline_comment|/* Reset QEC. */
id|qec_global_reset
c_func
(paren
id|gregs
)paren
suffix:semicolon
multiline_comment|/* Init QEC. */
id|qec_init
c_func
(paren
id|bp
)paren
suffix:semicolon
multiline_comment|/* Alloc and reset the tx/rx descriptor chains. */
macro_line|#ifndef __sparc_v9__
r_if
c_cond
(paren
id|sparc_cpu_model
op_eq
id|sun4c
)paren
(brace
id|sun4c_bigmac_init_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|bigmac_init_rings
c_func
(paren
id|bp
comma
id|from_irq
)paren
suffix:semicolon
multiline_comment|/* Initialize the PHY. */
id|bigmac_tcvr_init
c_func
(paren
id|bp
)paren
suffix:semicolon
multiline_comment|/* Stop transmitter and receiver. */
id|bigmac_stop
c_func
(paren
id|bp
)paren
suffix:semicolon
multiline_comment|/* Set hardware ethernet address. */
id|bregs-&gt;mac_addr2
op_assign
(paren
(paren
id|e
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_or
id|e
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|bregs-&gt;mac_addr1
op_assign
(paren
(paren
id|e
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|e
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|bregs-&gt;mac_addr0
op_assign
(paren
(paren
id|e
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|e
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* Clear the hash table until mc upload occurs. */
id|bregs-&gt;htable3
op_assign
l_int|0
suffix:semicolon
id|bregs-&gt;htable2
op_assign
l_int|0
suffix:semicolon
id|bregs-&gt;htable1
op_assign
l_int|0
suffix:semicolon
id|bregs-&gt;htable0
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Enable Big Mac hash table filter. */
id|bregs-&gt;rx_cfg
op_assign
(paren
id|BIGMAC_RXCFG_HENABLE
op_or
id|BIGMAC_RXCFG_FIFO
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
multiline_comment|/* Ok, configure the Big Mac transmitter. */
id|bregs-&gt;tx_cfg
op_assign
id|BIGMAC_TXCFG_FIFO
suffix:semicolon
multiline_comment|/* The HME docs recommend to use the 10LSB of our MAC here. */
id|bregs-&gt;rand_seed
op_assign
(paren
(paren
id|e
(braket
l_int|5
)braket
op_or
id|e
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_amp
l_int|0x3ff
)paren
suffix:semicolon
multiline_comment|/* Enable the output drivers no matter what. */
id|bregs-&gt;xif_cfg
op_assign
(paren
id|BIGMAC_XCFG_ODENABLE
op_or
id|BIGMAC_XCFG_RESV
)paren
suffix:semicolon
multiline_comment|/* Tell the QEC where the ring descriptors are. */
id|cregs-&gt;rxds
op_assign
id|bp-&gt;bblock_dvma
op_plus
id|bib_offset
c_func
(paren
id|be_rxd
comma
l_int|0
)paren
suffix:semicolon
id|cregs-&gt;txds
op_assign
id|bp-&gt;bblock_dvma
op_plus
id|bib_offset
c_func
(paren
id|be_txd
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Setup the FIFO pointers into QEC local memory. */
id|cregs-&gt;rxwbufptr
op_assign
id|cregs-&gt;rxrbufptr
op_assign
l_int|0
suffix:semicolon
id|cregs-&gt;txwbufptr
op_assign
id|cregs-&gt;txrbufptr
op_assign
id|gregs-&gt;rsize
suffix:semicolon
multiline_comment|/* Tell bigmac what interrupts we don&squot;t want to hear about. */
id|bregs-&gt;imask
op_assign
(paren
id|BIGMAC_IMASK_GOTFRAME
op_or
id|BIGMAC_IMASK_SENTFRAME
)paren
suffix:semicolon
multiline_comment|/* Enable the various other irq&squot;s. */
id|cregs-&gt;rimask
op_assign
l_int|0
suffix:semicolon
id|cregs-&gt;timask
op_assign
l_int|0
suffix:semicolon
id|cregs-&gt;qmask
op_assign
l_int|0
suffix:semicolon
id|cregs-&gt;bmask
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set jam size to a reasonable default. */
id|bregs-&gt;jsize
op_assign
id|DEFAULT_JAMSIZE
suffix:semicolon
multiline_comment|/* Clear collision counter. */
id|cregs-&gt;ccnt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Enable transmitter and receiver. */
id|bregs-&gt;tx_cfg
op_or_assign
id|BIGMAC_TXCFG_ENABLE
suffix:semicolon
id|bregs-&gt;rx_cfg
op_or_assign
id|BIGMAC_RXCFG_ENABLE
suffix:semicolon
multiline_comment|/* Ok, start detecting link speed/duplex. */
id|bigmac_begin_auto_negotiation
c_func
(paren
id|bp
)paren
suffix:semicolon
multiline_comment|/* Success. */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Error interrupts get sent here. */
DECL|function|bigmac_is_medium_rare
r_static
r_void
id|bigmac_is_medium_rare
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
comma
r_int
r_int
id|qec_status
comma
r_int
r_int
id|bmac_status
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;bigmac_is_medium_rare: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qec_status
op_amp
(paren
id|GLOB_STAT_ER
op_or
id|GLOB_STAT_BM
)paren
)paren
(brace
r_if
c_cond
(paren
id|qec_status
op_amp
id|GLOB_STAT_ER
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;QEC_ERROR, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qec_status
op_amp
id|GLOB_STAT_BM
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;QEC_BMAC_ERROR, &quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_ERRORS
)paren
(brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_BERROR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BMAC_ERROR, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_TXDERROR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;TXD_ERROR, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_TXLERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;TX_LATE_ERROR, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_TXPERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;TX_PARITY_ERROR, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_TXSERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;TX_SBUS_ERROR, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_RXDROP
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;RX_DROP_ERROR, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_RXSMALL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;RX_SMALL_ERROR, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_RXLERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;RX_LATE_ERROR, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_RXPERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;RX_PARITY_ERROR, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_RXSERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;RX_SBUS_ERROR, &quot;
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot; RESET&bslash;n&quot;
)paren
suffix:semicolon
id|bigmac_init
c_func
(paren
id|bp
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* BigMAC transmit complete service routines. */
DECL|function|bigmac_tx
r_static
r_inline
r_void
id|bigmac_tx
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
)paren
(brace
r_struct
id|be_txd
op_star
id|txbase
op_assign
op_amp
id|bp-&gt;bmac_block-&gt;be_txd
(braket
l_int|0
)braket
suffix:semicolon
r_struct
id|be_txd
op_star
id|this
suffix:semicolon
r_int
id|elem
op_assign
id|bp-&gt;tx_old
suffix:semicolon
id|DTX
c_func
(paren
(paren
l_string|&quot;bigmac_tx: tx_old[%d] &quot;
comma
id|elem
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|elem
op_ne
id|bp-&gt;tx_new
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|this
op_assign
op_amp
id|txbase
(braket
id|elem
)braket
suffix:semicolon
id|DTX
c_func
(paren
(paren
l_string|&quot;this(%p) [flags(%08x)addr(%08x)]&quot;
comma
id|this
comma
id|this-&gt;tx_flags
comma
id|this-&gt;tx_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;tx_flags
op_amp
id|TXD_OWN
)paren
(brace
r_break
suffix:semicolon
)brace
id|skb
op_assign
id|bp-&gt;tx_skbs
(braket
id|elem
)braket
suffix:semicolon
id|DTX
c_func
(paren
(paren
l_string|&quot;skb(%p) &quot;
comma
id|skb
)paren
)paren
suffix:semicolon
id|bp-&gt;tx_skbs
(braket
id|elem
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|bp-&gt;enet_stats.tx_packets
op_increment
suffix:semicolon
id|elem
op_assign
id|NEXT_TX
c_func
(paren
id|elem
)paren
suffix:semicolon
)brace
id|DTX
c_func
(paren
(paren
l_string|&quot; DONE, tx_old=%d&bslash;n&quot;
comma
id|elem
)paren
)paren
suffix:semicolon
id|bp-&gt;tx_old
op_assign
id|elem
suffix:semicolon
)brace
macro_line|#ifndef __sparc_v9__
DECL|function|sun4c_bigmac_tx
r_static
r_inline
r_void
id|sun4c_bigmac_tx
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
)paren
(brace
r_struct
id|be_txd
op_star
id|txbase
op_assign
op_amp
id|bp-&gt;bmac_block-&gt;be_txd
(braket
l_int|0
)braket
suffix:semicolon
r_struct
id|be_txd
op_star
id|this
suffix:semicolon
r_int
id|elem
op_assign
id|bp-&gt;tx_old
suffix:semicolon
r_while
c_loop
(paren
id|elem
op_ne
id|bp-&gt;tx_new
)paren
(brace
id|this
op_assign
op_amp
id|txbase
(braket
id|elem
)braket
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;tx_flags
op_amp
id|TXD_OWN
)paren
(brace
r_break
suffix:semicolon
)brace
id|bp-&gt;enet_stats.tx_packets
op_increment
suffix:semicolon
id|elem
op_assign
id|NEXT_TX
c_func
(paren
id|elem
)paren
suffix:semicolon
)brace
id|bp-&gt;tx_old
op_assign
id|elem
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* BigMAC receive complete service routines. */
DECL|function|bigmac_rx
r_static
r_inline
r_void
id|bigmac_rx
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
)paren
(brace
r_struct
id|be_rxd
op_star
id|rxbase
op_assign
op_amp
id|bp-&gt;bmac_block-&gt;be_rxd
(braket
l_int|0
)braket
suffix:semicolon
r_struct
id|be_rxd
op_star
id|this
suffix:semicolon
r_int
id|elem
op_assign
id|bp-&gt;rx_new
comma
id|drops
op_assign
l_int|0
suffix:semicolon
id|this
op_assign
op_amp
id|rxbase
(braket
id|elem
)braket
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|this-&gt;rx_flags
op_amp
id|RXD_OWN
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|flags
op_assign
id|this-&gt;rx_flags
suffix:semicolon
r_int
id|len
op_assign
(paren
id|flags
op_amp
id|RXD_LENGTH
)paren
suffix:semicolon
multiline_comment|/* FCS not included */
multiline_comment|/* Check for errors. */
r_if
c_cond
(paren
id|len
OL
id|ETH_ZLEN
)paren
(brace
id|bp-&gt;enet_stats.rx_errors
op_increment
suffix:semicolon
id|bp-&gt;enet_stats.rx_length_errors
op_increment
suffix:semicolon
id|drop_it
suffix:colon
multiline_comment|/* Return it to the BigMAC. */
id|bp-&gt;enet_stats.rx_dropped
op_increment
suffix:semicolon
id|this-&gt;rx_addr
op_assign
id|sbus_dvma_addr
c_func
(paren
id|bp-&gt;rx_skbs
(braket
id|elem
)braket
op_member_access_from_pointer
id|data
)paren
suffix:semicolon
id|this-&gt;rx_flags
op_assign
(paren
id|RXD_OWN
op_or
(paren
id|RX_BUF_ALLOC_SIZE
op_amp
id|RXD_LENGTH
)paren
)paren
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
id|skb
op_assign
id|bp-&gt;rx_skbs
(braket
id|elem
)braket
suffix:semicolon
macro_line|#ifdef NEED_DMA_SYNCHRONIZATION
macro_line|#ifdef __sparc_v9__
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
(paren
id|skb-&gt;data
op_plus
id|skb-&gt;len
)paren
op_ge
id|MAX_DMA_ADDRESS
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sunbmac: Bogus DMA buffer address &quot;
l_string|&quot;[%016lx]&bslash;n&quot;
comma
(paren
(paren
r_int
r_int
)paren
id|skb-&gt;data
)paren
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;DMA address too large, tell DaveM&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|mmu_sync_dma
c_func
(paren
id|sbus_dvma_addr
c_func
(paren
id|skb-&gt;data
)paren
comma
id|skb-&gt;len
comma
id|bp-&gt;bigmac_sbus_dev-&gt;my_bus
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|len
OG
id|RX_COPY_THRESHOLD
)paren
(brace
r_struct
id|sk_buff
op_star
id|new_skb
suffix:semicolon
multiline_comment|/* Now refill the entry, if we can. */
id|new_skb
op_assign
id|big_mac_alloc_skb
c_func
(paren
id|RX_BUF_ALLOC_SIZE
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_skb
)paren
(brace
id|drops
op_increment
suffix:semicolon
r_goto
id|drop_it
suffix:semicolon
)brace
id|bp-&gt;rx_skbs
(braket
id|elem
)braket
op_assign
id|new_skb
suffix:semicolon
id|new_skb-&gt;dev
op_assign
id|bp-&gt;dev
suffix:semicolon
id|skb_put
c_func
(paren
id|new_skb
comma
id|ETH_FRAME_LEN
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|new_skb
comma
l_int|34
)paren
suffix:semicolon
id|rxbase
(braket
id|elem
)braket
dot
id|rx_addr
op_assign
id|sbus_dvma_addr
c_func
(paren
id|new_skb-&gt;data
)paren
suffix:semicolon
id|rxbase
(braket
id|elem
)braket
dot
id|rx_flags
op_assign
(paren
id|RXD_OWN
op_or
(paren
(paren
id|RX_BUF_ALLOC_SIZE
op_minus
l_int|34
)paren
op_amp
id|RXD_LENGTH
)paren
)paren
suffix:semicolon
multiline_comment|/* Trim the original skb for the netif. */
id|skb_trim
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|copy_skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|copy_skb
)paren
(brace
id|drops
op_increment
suffix:semicolon
r_goto
id|drop_it
suffix:semicolon
)brace
id|copy_skb-&gt;dev
op_assign
id|bp-&gt;dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|copy_skb
comma
l_int|2
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|copy_skb
comma
id|len
)paren
suffix:semicolon
id|eth_copy_and_sum
c_func
(paren
id|copy_skb
comma
(paren
r_int
r_char
op_star
)paren
id|skb-&gt;data
comma
id|len
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Reuse otiginal ring buffer. */
id|rxbase
(braket
id|elem
)braket
dot
id|rx_addr
op_assign
id|sbus_dvma_addr
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|rxbase
(braket
id|elem
)braket
dot
id|rx_flags
op_assign
(paren
id|RXD_OWN
op_or
(paren
(paren
id|RX_BUF_ALLOC_SIZE
op_minus
l_int|34
)paren
op_amp
id|RXD_LENGTH
)paren
)paren
suffix:semicolon
id|skb
op_assign
id|copy_skb
suffix:semicolon
)brace
multiline_comment|/* No checksums done by the BigMAC ;-( */
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|bp-&gt;dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|bp-&gt;enet_stats.rx_packets
op_increment
suffix:semicolon
id|next
suffix:colon
id|elem
op_assign
id|NEXT_RX
c_func
(paren
id|elem
)paren
suffix:semicolon
id|this
op_assign
op_amp
id|rxbase
(braket
id|elem
)braket
suffix:semicolon
)brace
id|bp-&gt;rx_new
op_assign
id|elem
suffix:semicolon
r_if
c_cond
(paren
id|drops
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Memory squeeze, deferring packet.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifndef __sparc_v9__
DECL|function|sun4c_bigmac_rx
r_static
r_inline
r_void
id|sun4c_bigmac_rx
c_func
(paren
r_struct
id|bigmac
op_star
id|bp
)paren
(brace
r_struct
id|be_rxd
op_star
id|rxbase
op_assign
op_amp
id|bp-&gt;bmac_block-&gt;be_rxd
(braket
l_int|0
)braket
suffix:semicolon
r_struct
id|be_rxd
op_star
id|this
suffix:semicolon
r_struct
id|bigmac_buffers
op_star
id|bbufs
op_assign
id|bp-&gt;sun4c_buffers
suffix:semicolon
id|__u32
id|bbufs_dvma
op_assign
id|bp-&gt;s4c_buf_dvma
suffix:semicolon
r_int
id|elem
op_assign
id|bp-&gt;rx_new
comma
id|drops
op_assign
l_int|0
suffix:semicolon
id|this
op_assign
op_amp
id|rxbase
(braket
id|elem
)braket
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|this-&gt;rx_flags
op_amp
id|RXD_OWN
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
op_star
id|this_bbuf
op_assign
id|bbufs-&gt;rx_buf
(braket
id|elem
op_amp
(paren
id|SUN4C_RX_RING_SIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
id|__u32
id|this_bbuf_dvma
op_assign
id|bbufs_dvma
op_plus
id|bbuf_offset
c_func
(paren
id|rx_buf
comma
(paren
id|elem
op_amp
(paren
id|SUN4C_RX_RING_SIZE
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_struct
id|be_rxd
op_star
id|end_rxd
op_assign
op_amp
id|rxbase
(braket
(paren
id|elem
op_plus
id|SUN4C_RX_RING_SIZE
)paren
op_amp
(paren
id|RX_RING_SIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
r_int
r_int
id|flags
op_assign
id|this-&gt;rx_flags
suffix:semicolon
r_int
id|len
op_assign
(paren
id|flags
op_amp
id|RXD_LENGTH
)paren
op_minus
l_int|4
suffix:semicolon
multiline_comment|/* FCS not included */
multiline_comment|/* Check for errors. */
r_if
c_cond
(paren
id|len
OL
id|ETH_ZLEN
)paren
(brace
id|bp-&gt;enet_stats.rx_errors
op_increment
suffix:semicolon
id|bp-&gt;enet_stats.rx_length_errors
op_increment
suffix:semicolon
id|bp-&gt;enet_stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|0
)paren
(brace
id|drops
op_increment
suffix:semicolon
id|bp-&gt;enet_stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|skb-&gt;dev
op_assign
id|bp-&gt;dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
(paren
r_int
r_char
op_star
)paren
id|this_bbuf
comma
id|len
comma
l_int|0
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|bp-&gt;dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|bp-&gt;enet_stats.rx_packets
op_increment
suffix:semicolon
)brace
)brace
id|end_rxd-&gt;rx_addr
op_assign
id|this_bbuf_dvma
suffix:semicolon
id|end_rxd-&gt;rx_flags
op_assign
(paren
id|RXD_OWN
op_or
(paren
id|SUN4C_RX_BUFF_SIZE
op_amp
id|RXD_LENGTH
)paren
)paren
suffix:semicolon
id|elem
op_assign
id|NEXT_RX
c_func
(paren
id|elem
)paren
suffix:semicolon
id|this
op_assign
op_amp
id|rxbase
(braket
id|elem
)braket
suffix:semicolon
)brace
id|bp-&gt;rx_new
op_assign
id|elem
suffix:semicolon
r_if
c_cond
(paren
id|drops
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Memory squeeze, deferring packet.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|bigmac_interrupt
r_static
r_void
id|bigmac_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|bigmac
op_star
id|bp
op_assign
(paren
r_struct
id|bigmac
op_star
)paren
id|dev_id
suffix:semicolon
r_int
r_int
id|qec_status
comma
id|bmac_status
suffix:semicolon
id|DIRQ
c_func
(paren
(paren
l_string|&quot;bigmac_interrupt: &quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* Latch status registers now. */
id|bmac_status
op_assign
id|bp-&gt;creg-&gt;stat
suffix:semicolon
id|qec_status
op_assign
id|bp-&gt;gregs-&gt;stat
suffix:semicolon
id|bp-&gt;dev-&gt;interrupt
op_assign
l_int|1
suffix:semicolon
id|DIRQ
c_func
(paren
(paren
l_string|&quot;qec_status=%08x bmac_status=%08x&bslash;n&quot;
comma
id|qec_status
comma
id|bmac_status
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|qec_status
op_amp
(paren
id|GLOB_STAT_ER
op_or
id|GLOB_STAT_BM
)paren
)paren
op_logical_or
(paren
id|bmac_status
op_amp
id|CREG_STAT_ERRORS
)paren
)paren
(brace
id|bigmac_is_medium_rare
c_func
(paren
id|bp
comma
id|qec_status
comma
id|bmac_status
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_TXIRQ
)paren
(brace
id|bigmac_tx
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_RXIRQ
)paren
(brace
id|bigmac_rx
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bp-&gt;dev-&gt;tbusy
op_logical_and
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|bp
)paren
op_ge
l_int|0
)paren
)paren
(brace
id|bp-&gt;dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
)brace
id|bp-&gt;dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifndef __sparc_v9__
DECL|function|sun4c_bigmac_interrupt
r_static
r_void
id|sun4c_bigmac_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|bigmac
op_star
id|bp
op_assign
(paren
r_struct
id|bigmac
op_star
)paren
id|dev_id
suffix:semicolon
r_int
r_int
id|qec_status
comma
id|bmac_status
suffix:semicolon
multiline_comment|/* Latch status registers now. */
id|bmac_status
op_assign
id|bp-&gt;creg-&gt;stat
suffix:semicolon
id|qec_status
op_assign
id|bp-&gt;gregs-&gt;stat
suffix:semicolon
id|bp-&gt;dev-&gt;interrupt
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|qec_status
op_amp
(paren
id|GLOB_STAT_ER
op_or
id|GLOB_STAT_BM
)paren
op_logical_or
(paren
id|bmac_status
op_amp
id|CREG_STAT_ERRORS
)paren
)paren
(brace
id|bigmac_is_medium_rare
c_func
(paren
id|bp
comma
id|qec_status
comma
id|bmac_status
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_TXIRQ
)paren
(brace
id|sun4c_bigmac_tx
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmac_status
op_amp
id|CREG_STAT_RXIRQ
)paren
(brace
id|sun4c_bigmac_rx
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bp-&gt;dev-&gt;tbusy
op_logical_and
(paren
id|SUN4C_TX_BUFFS_AVAIL
c_func
(paren
id|bp
)paren
op_ge
l_int|0
)paren
)paren
(brace
id|bp-&gt;dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
)brace
id|bp-&gt;dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|bigmac_open
r_static
r_int
id|bigmac_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|bigmac
op_star
id|bp
op_assign
(paren
r_struct
id|bigmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|res
suffix:semicolon
macro_line|#ifndef __sparc_v9__
r_if
c_cond
(paren
id|sparc_cpu_model
op_eq
id|sun4c
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|sun4c_bigmac_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;BIG MAC&quot;
comma
(paren
r_void
op_star
)paren
id|bp
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BIGMAC: Can&squot;t order irq %d to go.&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|bigmac_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;BIG MAC&quot;
comma
(paren
r_void
op_star
)paren
id|bp
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BIGMAC: Can&squot;t order irq %d to go.&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|bp-&gt;bigmac_timer
)paren
suffix:semicolon
id|res
op_assign
id|bigmac_init
c_func
(paren
id|bp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
DECL|function|bigmac_close
r_static
r_int
id|bigmac_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|bigmac
op_star
id|bp
op_assign
(paren
r_struct
id|bigmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|bp-&gt;bigmac_timer
)paren
suffix:semicolon
id|bp-&gt;timer_state
op_assign
id|asleep
suffix:semicolon
id|bp-&gt;timer_ticks
op_assign
l_int|0
suffix:semicolon
id|bigmac_stop
c_func
(paren
id|bp
)paren
suffix:semicolon
id|bigmac_clean_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
(paren
r_void
op_star
)paren
id|bp
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Put a packet on the wire. */
DECL|function|bigmac_start_xmit
r_static
r_int
id|bigmac_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|bigmac
op_star
id|bp
op_assign
(paren
r_struct
id|bigmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|len
comma
id|entry
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;tbusy
)paren
(brace
r_int
id|tickssofar
op_assign
id|jiffies
op_minus
id|dev-&gt;trans_start
suffix:semicolon
r_if
c_cond
(paren
id|tickssofar
OL
l_int|40
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|printk
(paren
l_string|&quot;%s: transmit timed out, resetting&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|bp-&gt;enet_stats.tx_errors
op_increment
suffix:semicolon
id|bigmac_init
c_func
(paren
id|bp
comma
l_int|0
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Transmitter access conflict.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|TX_BUFFS_AVAIL
c_func
(paren
id|bp
)paren
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef NEED_DMA_SYNCHRONIZATION
macro_line|#ifdef __sparc_v9__
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
(paren
id|skb-&gt;data
op_plus
id|skb-&gt;len
)paren
op_ge
id|MAX_DMA_ADDRESS
)paren
(brace
r_struct
id|sk_buff
op_star
id|new_skb
op_assign
id|skb_copy
c_func
(paren
id|skb
comma
id|GFP_DMA
op_or
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_skb
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|new_skb
suffix:semicolon
)brace
macro_line|#endif
id|mmu_sync_dma
c_func
(paren
id|sbus_dvma_addr
c_func
(paren
id|skb-&gt;data
)paren
comma
id|skb-&gt;len
comma
id|bp-&gt;bigmac_sbus_dev-&gt;my_bus
)paren
suffix:semicolon
macro_line|#endif
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
id|entry
op_assign
id|bp-&gt;tx_new
suffix:semicolon
id|DTX
c_func
(paren
(paren
l_string|&quot;bigmac_start_xmit: len(%d) entry(%d)&bslash;n&quot;
comma
id|len
comma
id|entry
)paren
)paren
suffix:semicolon
multiline_comment|/* Avoid a race... */
id|bp-&gt;bmac_block-&gt;be_txd
(braket
id|entry
)braket
dot
id|tx_flags
op_assign
id|TXD_UPDATE
suffix:semicolon
id|bp-&gt;tx_skbs
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|bp-&gt;bmac_block-&gt;be_txd
(braket
id|entry
)braket
dot
id|tx_addr
op_assign
id|sbus_dvma_addr
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|bp-&gt;bmac_block-&gt;be_txd
(braket
id|entry
)braket
dot
id|tx_flags
op_assign
(paren
id|TXD_OWN
op_or
id|TXD_SOP
op_or
id|TXD_EOP
op_or
(paren
id|len
op_amp
id|TXD_LENGTH
)paren
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|bp-&gt;tx_new
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
multiline_comment|/* Get it going. */
id|bp-&gt;creg-&gt;ctrl
op_assign
id|CREG_CTRL_TWAKEUP
suffix:semicolon
r_if
c_cond
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|bp
)paren
)paren
(brace
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifndef __sparc_v9__
DECL|function|sun4c_bigmac_start_xmit
r_static
r_int
id|sun4c_bigmac_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|bigmac
op_star
id|bp
op_assign
(paren
r_struct
id|bigmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|bigmac_buffers
op_star
id|bbufs
op_assign
id|bp-&gt;sun4c_buffers
suffix:semicolon
id|__u32
id|txbuf_dvma
comma
id|bbufs_dvma
op_assign
id|bp-&gt;s4c_buf_dvma
suffix:semicolon
r_int
r_char
op_star
id|txbuf
suffix:semicolon
r_int
id|len
comma
id|entry
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;tbusy
)paren
(brace
r_int
id|tickssofar
op_assign
id|jiffies
op_minus
id|dev-&gt;trans_start
suffix:semicolon
r_if
c_cond
(paren
id|tickssofar
OL
l_int|40
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|printk
(paren
l_string|&quot;%s: transmit timed out, resetting&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|bp-&gt;enet_stats.tx_errors
op_increment
suffix:semicolon
id|bigmac_init
c_func
(paren
id|bp
comma
l_int|0
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Transmitter access conflict.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|SUN4C_TX_BUFFS_AVAIL
c_func
(paren
id|bp
)paren
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
id|entry
op_assign
id|bp-&gt;tx_new
suffix:semicolon
id|txbuf
op_assign
op_amp
id|bbufs-&gt;tx_buf
(braket
id|entry
)braket
(braket
l_int|0
)braket
suffix:semicolon
id|txbuf_dvma
op_assign
id|bbufs_dvma
op_plus
id|bbuf_offset
c_func
(paren
id|tx_buf
comma
id|entry
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|txbuf
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
multiline_comment|/* Avoid a race... */
id|bp-&gt;bmac_block-&gt;be_txd
(braket
id|entry
)braket
dot
id|tx_flags
op_assign
id|TXD_UPDATE
suffix:semicolon
id|bp-&gt;bmac_block-&gt;be_txd
(braket
id|entry
)braket
dot
id|tx_addr
op_assign
id|txbuf_dvma
suffix:semicolon
id|bp-&gt;bmac_block-&gt;be_txd
(braket
id|entry
)braket
dot
id|tx_flags
op_assign
(paren
id|TXD_OWN
op_or
id|TXD_SOP
op_or
id|TXD_EOP
op_or
(paren
id|len
op_amp
id|TXD_LENGTH
)paren
)paren
suffix:semicolon
id|bp-&gt;tx_new
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
multiline_comment|/* Get it going. */
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|bp-&gt;creg-&gt;ctrl
op_assign
id|CREG_CTRL_TWAKEUP
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SUN4C_TX_BUFFS_AVAIL
c_func
(paren
id|bp
)paren
)paren
(brace
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|bigmac_get_stats
r_static
r_struct
id|enet_statistics
op_star
id|bigmac_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|bigmac
op_star
id|bp
op_assign
(paren
r_struct
id|bigmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|bigmac_get_counters
c_func
(paren
id|bp
comma
id|bp-&gt;bregs
)paren
suffix:semicolon
r_return
op_amp
id|bp-&gt;enet_stats
suffix:semicolon
)brace
DECL|macro|CRC_POLYNOMIAL_BE
mdefine_line|#define CRC_POLYNOMIAL_BE 0x04c11db7UL  /* Ethernet CRC, big endian */
DECL|macro|CRC_POLYNOMIAL_LE
mdefine_line|#define CRC_POLYNOMIAL_LE 0xedb88320UL  /* Ethernet CRC, little endian */
DECL|function|bigmac_set_multicast
r_static
r_void
id|bigmac_set_multicast
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|bigmac
op_star
id|bp
op_assign
(paren
r_struct
id|bigmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|BIG_MAC_regs
op_star
id|bregs
op_assign
id|bp-&gt;bregs
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|dmi
op_assign
id|dev-&gt;mc_list
suffix:semicolon
r_char
op_star
id|addrs
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|bit
comma
id|byte
suffix:semicolon
id|u32
id|crc
comma
id|poly
op_assign
id|CRC_POLYNOMIAL_LE
suffix:semicolon
multiline_comment|/* Disable the receiver.  The bit self-clears when&n;&t; * the operation is complete.&n;&t; */
id|bregs-&gt;rx_cfg
op_and_assign
op_complement
(paren
id|BIGMAC_RXCFG_ENABLE
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|bregs-&gt;rx_cfg
op_amp
id|BIGMAC_RXCFG_ENABLE
)paren
op_ne
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_or
(paren
id|dev-&gt;mc_count
OG
l_int|64
)paren
)paren
(brace
id|bregs-&gt;htable0
op_assign
l_int|0xffff
suffix:semicolon
id|bregs-&gt;htable1
op_assign
l_int|0xffff
suffix:semicolon
id|bregs-&gt;htable2
op_assign
l_int|0xffff
suffix:semicolon
id|bregs-&gt;htable3
op_assign
l_int|0xffff
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|bregs-&gt;rx_cfg
op_or_assign
id|BIGMAC_RXCFG_PMISC
suffix:semicolon
)brace
r_else
(brace
id|u16
id|hash_table
(braket
l_int|4
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hash_table
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|addrs
op_assign
id|dmi-&gt;dmi_addr
suffix:semicolon
id|dmi
op_assign
id|dmi-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|addrs
op_amp
l_int|1
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
id|crc
op_assign
l_int|0xffffffffU
suffix:semicolon
r_for
c_loop
(paren
id|byte
op_assign
l_int|0
suffix:semicolon
id|byte
OL
l_int|6
suffix:semicolon
id|byte
op_increment
)paren
(brace
r_for
c_loop
(paren
id|bit
op_assign
op_star
id|addrs
op_increment
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
comma
id|bit
op_rshift_assign
l_int|1
)paren
(brace
r_int
id|test
suffix:semicolon
id|test
op_assign
(paren
(paren
id|bit
op_xor
id|crc
)paren
op_amp
l_int|0x01
)paren
suffix:semicolon
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|test
)paren
(brace
id|crc
op_assign
id|crc
op_xor
id|poly
suffix:semicolon
)brace
)brace
)brace
id|crc
op_rshift_assign
l_int|26
suffix:semicolon
id|hash_table
(braket
id|crc
op_rshift
l_int|4
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|crc
op_amp
l_int|0xf
)paren
suffix:semicolon
)brace
id|bregs-&gt;htable0
op_assign
id|hash_table
(braket
l_int|0
)braket
suffix:semicolon
id|bregs-&gt;htable1
op_assign
id|hash_table
(braket
l_int|1
)braket
suffix:semicolon
id|bregs-&gt;htable2
op_assign
id|hash_table
(braket
l_int|2
)braket
suffix:semicolon
id|bregs-&gt;htable3
op_assign
id|hash_table
(braket
l_int|3
)braket
suffix:semicolon
)brace
multiline_comment|/* Re-enable the receiver. */
id|bregs-&gt;rx_cfg
op_or_assign
id|BIGMAC_RXCFG_ENABLE
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|bigmac_ether_init
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|linux_sbus_device
op_star
id|qec_sdev
)paren
)paren
(brace
r_static
r_int
id|version_printed
op_assign
l_int|0
suffix:semicolon
r_struct
id|bigmac
op_star
id|bp
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|bsizes
comma
id|bsizes_more
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|num_qranges
comma
id|res
op_assign
id|ENOMEM
suffix:semicolon
r_struct
id|linux_prom_ranges
id|qranges
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* Get a new device struct for this interface. */
id|dev
op_assign
id|init_etherdev
c_func
(paren
l_int|0
comma
r_sizeof
(paren
r_struct
id|bigmac
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|version_printed
op_increment
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
)brace
multiline_comment|/* Report what we have found to the user. */
id|printk
c_func
(paren
l_string|&quot;%s: BigMAC 100baseT Ethernet &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
(paren
r_int
)paren
id|qec_sdev
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%2.2x%c&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|idprom-&gt;id_ethaddr
(braket
id|i
)braket
comma
id|i
op_eq
l_int|5
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;:&squot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Setup softc, with backpointers to QEC and BigMAC SBUS device structs. */
id|bp
op_assign
(paren
r_struct
id|bigmac
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|bp-&gt;qec_sbus_dev
op_assign
id|qec_sdev
suffix:semicolon
id|bp-&gt;bigmac_sbus_dev
op_assign
id|qec_sdev-&gt;child
suffix:semicolon
multiline_comment|/* All further failures we find return this. */
id|res
op_assign
id|ENODEV
suffix:semicolon
multiline_comment|/* Verify the registers we expect, are actually there. */
r_if
c_cond
(paren
(paren
id|bp-&gt;bigmac_sbus_dev-&gt;num_registers
op_ne
l_int|3
)paren
op_logical_or
(paren
id|bp-&gt;qec_sbus_dev-&gt;num_registers
op_ne
l_int|2
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BIGMAC: Device does not have 2 and 3 regs, it has %d and %d.&bslash;n&quot;
comma
id|bp-&gt;qec_sbus_dev-&gt;num_registers
comma
id|bp-&gt;bigmac_sbus_dev-&gt;num_registers
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;BIGMAC: Would you like that for here or to go?&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|fail_and_cleanup
suffix:semicolon
)brace
multiline_comment|/* Fun with QEC ranges... */
r_if
c_cond
(paren
id|bp-&gt;bigmac_sbus_dev-&gt;ranges_applied
op_eq
l_int|0
)paren
(brace
id|i
op_assign
id|prom_getproperty
c_func
(paren
id|bp-&gt;qec_sbus_dev-&gt;prom_node
comma
l_string|&quot;ranges&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|qranges
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|qranges
)paren
)paren
suffix:semicolon
id|num_qranges
op_assign
(paren
id|i
op_div
r_sizeof
(paren
r_struct
id|linux_prom_ranges
)paren
)paren
suffix:semicolon
multiline_comment|/* Now, apply all the ranges for the BigMAC. */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|bp-&gt;bigmac_sbus_dev-&gt;num_registers
suffix:semicolon
id|j
op_increment
)paren
(brace
r_int
id|k
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|num_qranges
suffix:semicolon
id|k
op_increment
)paren
r_if
c_cond
(paren
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
id|j
)braket
dot
id|which_io
op_eq
id|qranges
(braket
id|k
)braket
dot
id|ot_child_space
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
op_ge
id|num_qranges
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BigMAC: Aieee, bogus QEC range for space %08x&bslash;n&quot;
comma
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
id|j
)braket
dot
id|which_io
)paren
suffix:semicolon
r_goto
id|fail_and_cleanup
suffix:semicolon
)brace
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
id|j
)braket
dot
id|which_io
op_assign
id|qranges
(braket
id|k
)braket
dot
id|ot_parent_space
suffix:semicolon
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
id|j
)braket
dot
id|phys_addr
op_add_assign
id|qranges
(braket
id|k
)braket
dot
id|ot_parent_base
suffix:semicolon
)brace
multiline_comment|/* Next, apply SBUS ranges on top of what we just changed. */
id|prom_apply_sbus_ranges
c_func
(paren
id|bp-&gt;bigmac_sbus_dev-&gt;my_bus
comma
op_amp
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
l_int|0
)braket
comma
id|bp-&gt;bigmac_sbus_dev-&gt;num_registers
comma
id|bp-&gt;bigmac_sbus_dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Apply SBUS ranges for the QEC parent. */
id|prom_apply_sbus_ranges
c_func
(paren
id|bp-&gt;qec_sbus_dev-&gt;my_bus
comma
op_amp
id|bp-&gt;qec_sbus_dev-&gt;reg_addrs
(braket
l_int|0
)braket
comma
id|bp-&gt;qec_sbus_dev-&gt;num_registers
comma
id|bp-&gt;qec_sbus_dev
)paren
suffix:semicolon
multiline_comment|/* Map in QEC global control registers. */
id|bp-&gt;gregs
op_assign
id|sparc_alloc_io
c_func
(paren
id|bp-&gt;qec_sbus_dev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qe_globreg
)paren
comma
l_string|&quot;BigMAC QEC Global Regs&quot;
comma
id|bp-&gt;qec_sbus_dev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|which_io
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp-&gt;gregs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BIGMAC: Cannot map QEC global registers.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|fail_and_cleanup
suffix:semicolon
)brace
multiline_comment|/* Make sure QEC is in BigMAC mode. */
r_if
c_cond
(paren
(paren
id|bp-&gt;gregs-&gt;ctrl
op_amp
l_int|0xf0000000
)paren
op_ne
id|GLOB_CTRL_BMODE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BigMAC: AIEEE, QEC is not in BigMAC mode!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|fail_and_cleanup
suffix:semicolon
)brace
multiline_comment|/* Reset the QEC. */
r_if
c_cond
(paren
id|qec_global_reset
c_func
(paren
id|bp-&gt;gregs
)paren
)paren
(brace
r_goto
id|fail_and_cleanup
suffix:semicolon
)brace
multiline_comment|/* Get supported SBUS burst sizes. */
id|bsizes
op_assign
id|prom_getintdefault
c_func
(paren
id|bp-&gt;qec_sbus_dev-&gt;prom_node
comma
l_string|&quot;burst-sizes&quot;
comma
l_int|0xff
)paren
suffix:semicolon
id|bsizes_more
op_assign
id|prom_getintdefault
c_func
(paren
id|bp-&gt;qec_sbus_dev-&gt;my_bus-&gt;prom_node
comma
l_string|&quot;burst-sizes&quot;
comma
l_int|0xff
)paren
suffix:semicolon
id|bsizes
op_and_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|bsizes_more
op_ne
l_int|0xff
)paren
(brace
id|bsizes
op_and_assign
id|bsizes_more
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bsizes
op_eq
l_int|0xff
op_logical_or
(paren
id|bsizes
op_amp
id|DMA_BURST16
)paren
op_eq
l_int|0
op_logical_or
(paren
id|bsizes
op_amp
id|DMA_BURST32
)paren
op_eq
l_int|0
)paren
(brace
id|bsizes
op_assign
(paren
id|DMA_BURST32
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|bp-&gt;bigmac_bursts
op_assign
id|bsizes
suffix:semicolon
multiline_comment|/* Perform QEC initialization. */
id|qec_init
c_func
(paren
id|bp
)paren
suffix:semicolon
multiline_comment|/* Map in the BigMAC channel registers. */
id|bp-&gt;creg
op_assign
id|sparc_alloc_io
c_func
(paren
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|phys_addr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qe_creg
)paren
comma
l_string|&quot;BigMAC QEC Channel Regs&quot;
comma
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|which_io
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp-&gt;creg
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BIGMAC: Cannot map QEC channel registers.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|fail_and_cleanup
suffix:semicolon
)brace
multiline_comment|/* Map in the BigMAC control registers. */
id|bp-&gt;bregs
op_assign
id|sparc_alloc_io
c_func
(paren
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
l_int|1
)braket
dot
id|phys_addr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|BIG_MAC_regs
)paren
comma
l_string|&quot;BigMAC Primary Regs&quot;
comma
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
l_int|1
)braket
dot
id|which_io
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp-&gt;bregs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BIGMAC: Cannot map BigMAC primary registers.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|fail_and_cleanup
suffix:semicolon
)brace
multiline_comment|/* Map in the BigMAC transceiver registers, this is how you poke at&n;&t; * the BigMAC&squot;s PHY.&n;&t; */
id|bp-&gt;tregs
op_assign
id|sparc_alloc_io
c_func
(paren
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
l_int|2
)braket
dot
id|phys_addr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|bmac_tcvr
)paren
comma
l_string|&quot;BigMAC Transceiver Regs&quot;
comma
id|bp-&gt;bigmac_sbus_dev-&gt;reg_addrs
(braket
l_int|2
)braket
dot
id|which_io
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp-&gt;tregs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;BIGMAC: Cannot map BigMAC transceiver registers.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|fail_and_cleanup
suffix:semicolon
)brace
multiline_comment|/* Stop the BigMAC. */
id|bigmac_stop
c_func
(paren
id|bp
)paren
suffix:semicolon
multiline_comment|/* Allocate transmit/receive descriptor DVMA block. */
id|bp-&gt;bmac_block
op_assign
(paren
r_struct
id|bmac_init_block
op_star
)paren
id|sparc_dvma_malloc
c_func
(paren
id|PAGE_SIZE
comma
l_string|&quot;BigMAC Init Block&quot;
comma
op_amp
id|bp-&gt;bblock_dvma
)paren
suffix:semicolon
multiline_comment|/* Get the board revision of this BigMAC. */
id|bp-&gt;board_rev
op_assign
id|prom_getintdefault
c_func
(paren
id|bp-&gt;bigmac_sbus_dev-&gt;prom_node
comma
l_string|&quot;board-version&quot;
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* If on sun4c, we use a static buffer pool, on sun4m we DMA directly&n;&t; * in and out of sk_buffs instead for speed and one copy to userspace.&n;&t; */
macro_line|#ifndef __sparc_v9__
r_if
c_cond
(paren
id|sparc_cpu_model
op_eq
id|sun4c
)paren
(brace
id|bp-&gt;sun4c_buffers
op_assign
(paren
r_struct
id|bigmac_buffers
op_star
)paren
id|sparc_dvma_malloc
c_func
(paren
r_sizeof
(paren
r_struct
id|bigmac_buffers
)paren
comma
l_string|&quot;BigMAC Bufs&quot;
comma
op_amp
id|bp-&gt;s4c_buf_dvma
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|bp-&gt;sun4c_buffers
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Init auto-negotiation timer state. */
id|init_timer
c_func
(paren
op_amp
id|bp-&gt;bigmac_timer
)paren
suffix:semicolon
id|bp-&gt;timer_state
op_assign
id|asleep
suffix:semicolon
id|bp-&gt;timer_ticks
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Backlink to generic net device struct. */
id|bp-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Set links to our BigMAC open and close routines. */
id|dev-&gt;open
op_assign
op_amp
id|bigmac_open
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|bigmac_close
suffix:semicolon
multiline_comment|/* Choose transmit routine based upon buffering scheme. */
macro_line|#ifndef __sparc_v9__
r_if
c_cond
(paren
id|sparc_cpu_model
op_eq
id|sun4c
)paren
(brace
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|sun4c_bigmac_start_xmit
suffix:semicolon
)brace
r_else
macro_line|#endif
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|bigmac_start_xmit
suffix:semicolon
multiline_comment|/* Set links to BigMAC statistic and multi-cast loading code. */
id|dev-&gt;get_stats
op_assign
op_amp
id|bigmac_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|bigmac_set_multicast
suffix:semicolon
multiline_comment|/* Finish net device registration. */
id|dev-&gt;irq
op_assign
id|bp-&gt;bigmac_sbus_dev-&gt;irqs
(braket
l_int|0
)braket
suffix:semicolon
id|dev-&gt;dma
op_assign
l_int|0
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef MODULE
multiline_comment|/* Put us into the list of instances attached for later module unloading. */
id|bp-&gt;next_module
op_assign
id|root_bigmac_dev
suffix:semicolon
id|root_bigmac_dev
op_assign
id|bp
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
id|fail_and_cleanup
suffix:colon
multiline_comment|/* Something went wrong, undo whatever we did so far. */
r_if
c_cond
(paren
id|bp
)paren
(brace
multiline_comment|/* Free register mappings if any. */
r_if
c_cond
(paren
id|bp-&gt;gregs
)paren
(brace
id|sparc_free_io
c_func
(paren
id|bp-&gt;gregs
comma
r_sizeof
(paren
r_struct
id|qe_globreg
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bp-&gt;creg
)paren
(brace
id|sparc_free_io
c_func
(paren
id|bp-&gt;creg
comma
r_sizeof
(paren
r_struct
id|qe_creg
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bp-&gt;bregs
)paren
(brace
id|sparc_free_io
c_func
(paren
id|bp-&gt;bregs
comma
r_sizeof
(paren
r_struct
id|BIG_MAC_regs
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bp-&gt;tregs
)paren
(brace
id|sparc_free_io
c_func
(paren
id|bp-&gt;tregs
comma
r_sizeof
(paren
r_struct
id|bmac_tcvr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* XXX todo, bmac_block and sun4c_buffers */
multiline_comment|/* Free the BigMAC softc. */
id|kfree
c_func
(paren
id|bp
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
multiline_comment|/* Return error code. */
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|bigmac_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
)paren
(brace
r_struct
id|linux_sbus
op_star
id|bus
suffix:semicolon
r_struct
id|linux_sbus_device
op_star
id|sdev
op_assign
l_int|0
suffix:semicolon
r_static
r_int
id|called
op_assign
l_int|0
suffix:semicolon
r_int
id|cards
op_assign
l_int|0
comma
id|v
suffix:semicolon
r_if
c_cond
(paren
id|called
)paren
(brace
r_return
id|ENODEV
suffix:semicolon
)brace
id|called
op_increment
suffix:semicolon
id|for_each_sbus
c_func
(paren
id|bus
)paren
(brace
id|for_each_sbusdev
c_func
(paren
id|sdev
comma
id|bus
)paren
(brace
r_if
c_cond
(paren
id|cards
)paren
(brace
id|dev
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* QEC can be the parent of either QuadEthernet or&n;&t;&t;&t; * a BigMAC.  We want the latter.&n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;qec&quot;
)paren
op_logical_and
id|sdev-&gt;child
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;child-&gt;prom_name
comma
l_string|&quot;be&quot;
)paren
)paren
(brace
id|cards
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v
op_assign
id|bigmac_ether_init
c_func
(paren
id|dev
comma
id|sdev
)paren
)paren
)paren
(brace
r_return
id|v
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|cards
)paren
(brace
r_return
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
r_int
DECL|function|init_module
id|init_module
c_func
(paren
r_void
)paren
(brace
id|root_bigmac_dev
op_assign
l_int|NULL
suffix:semicolon
r_return
id|bigmac_probe
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* No need to check MOD_IN_USE, as sys_delete_module() checks. */
r_while
c_loop
(paren
id|root_bigmac_dev
)paren
(brace
r_struct
id|bigmac
op_star
id|bp
op_assign
id|root_bigmac_dev
suffix:semicolon
r_struct
id|bigmac
op_star
id|bp_nxt
op_assign
id|root_bigmac_dev-&gt;next_module
suffix:semicolon
id|sparc_free_io
c_func
(paren
id|bp-&gt;gregs
comma
r_sizeof
(paren
r_struct
id|qe_globreg
)paren
)paren
suffix:semicolon
id|sparc_free_io
c_func
(paren
id|bp-&gt;creg
comma
r_sizeof
(paren
r_struct
id|qe_creg
)paren
)paren
suffix:semicolon
id|sparc_free_io
c_func
(paren
id|bp-&gt;bregs
comma
r_sizeof
(paren
r_struct
id|BIG_MAC_regs
)paren
)paren
suffix:semicolon
id|sparc_free_io
c_func
(paren
id|bp-&gt;tregs
comma
r_sizeof
(paren
r_struct
id|bmac_tcvr
)paren
)paren
suffix:semicolon
multiline_comment|/* XXX todo, bmac_block and sun4c_buffers */
id|unregister_netdev
c_func
(paren
id|bp-&gt;dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|bp-&gt;dev
)paren
suffix:semicolon
id|root_bigmac_dev
op_assign
id|bp_nxt
suffix:semicolon
)brace
)brace
macro_line|#endif /* MODULE */
eof
