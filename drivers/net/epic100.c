multiline_comment|/* epic100.c: A SMC 83c170 EPIC/100 Fast Ethernet driver for Linux. */
multiline_comment|/*&n;&t;Written/copyright 1997-2000 by Donald Becker.&n;&n;&t;This software may be used and distributed according to the terms of&n;&t;the GNU General Public License (GPL), incorporated herein by reference.&n;&t;Drivers based on or derived from this code fall under the GPL and must&n;&t;retain the authorship, copyright and license notice.  This file is not&n;&t;a complete program and may only be used when the entire operating&n;&t;system is licensed under the GPL.&n;&n;&t;This driver is for the SMC83c170/175 &quot;EPIC&quot; series, as used on the&n;&t;SMC EtherPower II 9432 PCI adapter, and several CardBus cards.&n;&n;&t;The author may be reached as becker@scyld.com, or C/O&n;&t;Scyld Computing Corporation&n;&t;410 Severn Ave., Suite 210&n;&t;Annapolis MD 21403&n;&n;&t;Information and updates available at&n;&t;http://www.scyld.com/network/epic100.html&n;&n;&t;---------------------------------------------------------------------&n;&t;&n;&t;Linux kernel-specific changes:&n;&t;&n;&t;LK1.1.2 (jgarzik):&n;&t;* Merge becker version 1.09 (4/08/2000)&n;&n;&t;LK1.1.3:&n;&t;* Major bugfix to 1.09 driver (Francis Romieu)&n;&t;&n;&t;LK1.1.4 (jgarzik):&n;&t;* Merge becker test version 1.09 (5/29/2000)&n;&n;&t;LK1.1.5:&n;&t;* Fix locking (jgarzik)&n;&t;* Limit 83c175 probe to ethernet-class PCI devices (rgooch)&n;&n;*/
multiline_comment|/* These identify the driver base version and may not be removed. */
DECL|variable|version
r_static
r_const
r_char
id|version
(braket
)braket
op_assign
l_string|&quot;epic100.c:v1.09 5/29/2000 Written by Donald Becker &lt;becker@scyld.com&gt;&bslash;n&quot;
suffix:semicolon
DECL|variable|version2
r_static
r_const
r_char
id|version2
(braket
)braket
op_assign
l_string|&quot;  http://www.scyld.com/network/epic100.html&bslash;n&quot;
suffix:semicolon
DECL|variable|version3
r_static
r_const
r_char
id|version3
(braket
)braket
op_assign
l_string|&quot; (unofficial 2.4.x kernel port, version 1.1.5, September 7, 2000)&bslash;n&quot;
suffix:semicolon
multiline_comment|/* The user-configurable values.&n;   These may be modified when a driver module is loaded.*/
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* 1 normal messages, 0 quiet .. 7 verbose. */
multiline_comment|/* Maximum events (Rx packets, etc.) to handle at each interrupt. */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* Used to pass the full-duplex flag, etc. */
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8&t;&t;/* More are supported, limit only on options */
DECL|variable|options
r_static
r_int
id|options
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* Set the copy breakpoint for the copy-only-tiny-frames scheme.&n;   Setting to &gt; 1518 effectively disables this feature. */
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Operational parameters that are set at compile time. */
multiline_comment|/* Keep the ring sizes a power of two for operational efficiency.&n;   The compiler will convert &lt;unsigned&gt;&squot;%&squot;&lt;2^N&gt; into a bit mask.&n;   Making the Tx ring too large decreases the effectiveness of channel&n;   bonding and packet priority.&n;   There are no ill effects from too-large receive rings. */
DECL|macro|TX_RING_SIZE
mdefine_line|#define TX_RING_SIZE&t;16
DECL|macro|TX_QUEUE_LEN
mdefine_line|#define TX_QUEUE_LEN&t;10&t;&t;/* Limit ring entries actually used.  */
DECL|macro|RX_RING_SIZE
mdefine_line|#define RX_RING_SIZE&t;32
multiline_comment|/* Operational parameters that usually are not changed. */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT  (2*HZ)
DECL|macro|PKT_BUF_SZ
mdefine_line|#define PKT_BUF_SZ&t;&t;1536&t;&t;&t;/* Size of each temporary Rx buffer.*/
multiline_comment|/* Bytes transferred to chip before transmission starts. */
multiline_comment|/* Initial threshold, increased on underflow, rounded down to 4 byte units. */
DECL|macro|TX_FIFO_THRESH
mdefine_line|#define TX_FIFO_THRESH 256
DECL|macro|RX_FIFO_THRESH
mdefine_line|#define RX_FIFO_THRESH 1&t;&t;/* 0-3, 0==32, 64,96, or 3==128 bytes  */
macro_line|#if !defined(__OPTIMIZE__)
macro_line|#warning  You must compile this file with the correct options!
macro_line|#warning  See the last lines of the source file.
macro_line|#error You must compile this driver with &quot;-O&quot;.
macro_line|#endif
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#if LINUX_VERSION_CODE &lt; 0x20300  &amp;&amp;  defined(MODVERSIONS)
macro_line|#include &lt;linux/modversions.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Donald Becker &lt;becker@scyld.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SMC 83c170 EPIC series Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rx_copybreak
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|options
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;Theory of Operation&n;&n;I. Board Compatibility&n;&n;This device driver is designed for the SMC &quot;EPIC/100&quot;, the SMC&n;single-chip Ethernet controllers for PCI.  This chip is used on&n;the SMC EtherPower II boards.&n;&n;II. Board-specific settings&n;&n;PCI bus devices are configured by the system at boot time, so no jumpers&n;need to be set on the board.  The system BIOS will assign the&n;PCI INTA signal to a (preferably otherwise unused) system IRQ line.&n;Note: Kernel versions earlier than 1.3.73 do not support shared PCI&n;interrupt lines.&n;&n;III. Driver operation&n;&n;IIIa. Ring buffers&n;&n;IVb. References&n;&n;http://www.smsc.com/main/datasheets/83c171.pdf&n;http://www.smsc.com/main/datasheets/83c175.pdf&n;http://scyld.com/expert/NWay.html&n;http://www.national.com/pf/DP/DP83840A.html&n;&n;IVc. Errata&n;&n;*/
DECL|enum|pci_id_flags_bits
r_enum
id|pci_id_flags_bits
(brace
multiline_comment|/* Set PCI command register bits before calling probe1(). */
DECL|enumerator|PCI_USES_IO
DECL|enumerator|PCI_USES_MEM
DECL|enumerator|PCI_USES_MASTER
id|PCI_USES_IO
op_assign
l_int|1
comma
id|PCI_USES_MEM
op_assign
l_int|2
comma
id|PCI_USES_MASTER
op_assign
l_int|4
comma
multiline_comment|/* Read and map the single following PCI BAR. */
DECL|enumerator|PCI_ADDR0
DECL|enumerator|PCI_ADDR1
DECL|enumerator|PCI_ADDR2
DECL|enumerator|PCI_ADDR3
id|PCI_ADDR0
op_assign
l_int|0
op_lshift
l_int|4
comma
id|PCI_ADDR1
op_assign
l_int|1
op_lshift
l_int|4
comma
id|PCI_ADDR2
op_assign
l_int|2
op_lshift
l_int|4
comma
id|PCI_ADDR3
op_assign
l_int|3
op_lshift
l_int|4
comma
DECL|enumerator|PCI_ADDR_64BITS
DECL|enumerator|PCI_NO_ACPI_WAKE
DECL|enumerator|PCI_NO_MIN_LATENCY
id|PCI_ADDR_64BITS
op_assign
l_int|0x100
comma
id|PCI_NO_ACPI_WAKE
op_assign
l_int|0x200
comma
id|PCI_NO_MIN_LATENCY
op_assign
l_int|0x400
comma
)brace
suffix:semicolon
DECL|enum|chip_capability_flags
DECL|enumerator|MII_PWRDWN
DECL|enumerator|TYPE2_INTR
DECL|enumerator|NO_MII
r_enum
id|chip_capability_flags
(brace
id|MII_PWRDWN
op_assign
l_int|1
comma
id|TYPE2_INTR
op_assign
l_int|2
comma
id|NO_MII
op_assign
l_int|4
)brace
suffix:semicolon
DECL|macro|EPIC_TOTAL_SIZE
mdefine_line|#define EPIC_TOTAL_SIZE 0x100
macro_line|#ifdef USE_IO_OPS
DECL|macro|EPIC_IOTYPE
mdefine_line|#define EPIC_IOTYPE PCI_USES_MASTER|PCI_USES_IO|PCI_ADDR0
macro_line|#else
DECL|macro|EPIC_IOTYPE
mdefine_line|#define EPIC_IOTYPE PCI_USES_MASTER|PCI_USES_MEM|PCI_ADDR1
macro_line|#endif
DECL|macro|virt_to_le32desc
mdefine_line|#define virt_to_le32desc(addr)  cpu_to_le32(virt_to_bus(addr))
r_typedef
r_enum
(brace
DECL|enumerator|SMSC_83C170_0
id|SMSC_83C170_0
comma
DECL|enumerator|SMSC_83C170
id|SMSC_83C170
comma
DECL|enumerator|SMSC_83C175
id|SMSC_83C175
comma
DECL|typedef|chip_t
)brace
id|chip_t
suffix:semicolon
DECL|struct|epic_chip_info
r_struct
id|epic_chip_info
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|pci_flags
r_enum
id|pci_id_flags_bits
id|pci_flags
suffix:semicolon
DECL|member|io_size
r_int
id|io_size
suffix:semicolon
multiline_comment|/* Needed for I/O region check or ioremap(). */
DECL|member|drv_flags
r_int
id|drv_flags
suffix:semicolon
multiline_comment|/* Driver use, intended as capability flags. */
)brace
suffix:semicolon
multiline_comment|/* indexed by chip_t */
DECL|variable|__devinitdata
r_static
r_struct
id|epic_chip_info
id|epic_chip_info
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_string|&quot;SMSC EPIC/100 83c170&quot;
comma
id|EPIC_IOTYPE
comma
id|EPIC_TOTAL_SIZE
comma
id|TYPE2_INTR
op_or
id|NO_MII
op_or
id|MII_PWRDWN
)brace
comma
(brace
l_string|&quot;SMSC EPIC/100 83c170&quot;
comma
id|EPIC_IOTYPE
comma
id|EPIC_TOTAL_SIZE
comma
id|TYPE2_INTR
)brace
comma
(brace
l_string|&quot;SMSC EPIC/C 83c175&quot;
comma
id|EPIC_IOTYPE
comma
id|EPIC_TOTAL_SIZE
comma
id|TYPE2_INTR
op_or
id|MII_PWRDWN
)brace
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|epic_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x10B8
comma
l_int|0x0005
comma
l_int|0x1092
comma
l_int|0x0AB4
comma
l_int|0
comma
l_int|0
comma
id|SMSC_83C170_0
)brace
comma
(brace
l_int|0x10B8
comma
l_int|0x0005
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|SMSC_83C170
)brace
comma
(brace
l_int|0x10B8
comma
l_int|0x0006
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
id|PCI_CLASS_NETWORK_ETHERNET
op_lshift
l_int|8
comma
l_int|0xffff00
comma
id|SMSC_83C175
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|pci
comma
id|epic_pci_tbl
)paren
suffix:semicolon
macro_line|#ifndef USE_IO_OPS
DECL|macro|inb
macro_line|#undef inb
DECL|macro|inw
macro_line|#undef inw
DECL|macro|inl
macro_line|#undef inl
DECL|macro|outb
macro_line|#undef outb
DECL|macro|outw
macro_line|#undef outw
DECL|macro|outl
macro_line|#undef outl
DECL|macro|inb
mdefine_line|#define inb readb
DECL|macro|inw
mdefine_line|#define inw readw
DECL|macro|inl
mdefine_line|#define inl readl
DECL|macro|outb
mdefine_line|#define outb writeb
DECL|macro|outw
mdefine_line|#define outw writew
DECL|macro|outl
mdefine_line|#define outl writel
macro_line|#endif
multiline_comment|/* Offsets to registers, using the (ugh) SMC names. */
DECL|enum|epic_registers
r_enum
id|epic_registers
(brace
DECL|enumerator|COMMAND
DECL|enumerator|INTSTAT
DECL|enumerator|INTMASK
DECL|enumerator|GENCTL
DECL|enumerator|NVCTL
DECL|enumerator|EECTL
id|COMMAND
op_assign
l_int|0
comma
id|INTSTAT
op_assign
l_int|4
comma
id|INTMASK
op_assign
l_int|8
comma
id|GENCTL
op_assign
l_int|0x0C
comma
id|NVCTL
op_assign
l_int|0x10
comma
id|EECTL
op_assign
l_int|0x14
comma
DECL|enumerator|PCIBurstCnt
id|PCIBurstCnt
op_assign
l_int|0x18
comma
DECL|enumerator|TEST1
DECL|enumerator|CRCCNT
DECL|enumerator|ALICNT
DECL|enumerator|MPCNT
id|TEST1
op_assign
l_int|0x1C
comma
id|CRCCNT
op_assign
l_int|0x20
comma
id|ALICNT
op_assign
l_int|0x24
comma
id|MPCNT
op_assign
l_int|0x28
comma
multiline_comment|/* Rx error counters. */
DECL|enumerator|MIICtrl
DECL|enumerator|MIIData
DECL|enumerator|MIICfg
id|MIICtrl
op_assign
l_int|0x30
comma
id|MIIData
op_assign
l_int|0x34
comma
id|MIICfg
op_assign
l_int|0x38
comma
DECL|enumerator|LAN0
id|LAN0
op_assign
l_int|64
comma
multiline_comment|/* MAC address. */
DECL|enumerator|MC0
id|MC0
op_assign
l_int|80
comma
multiline_comment|/* Multicast filter table. */
DECL|enumerator|RxCtrl
DECL|enumerator|TxCtrl
DECL|enumerator|TxSTAT
id|RxCtrl
op_assign
l_int|96
comma
id|TxCtrl
op_assign
l_int|112
comma
id|TxSTAT
op_assign
l_int|0x74
comma
DECL|enumerator|PRxCDAR
DECL|enumerator|RxSTAT
DECL|enumerator|EarlyRx
DECL|enumerator|PTxCDAR
DECL|enumerator|TxThresh
id|PRxCDAR
op_assign
l_int|0x84
comma
id|RxSTAT
op_assign
l_int|0xA4
comma
id|EarlyRx
op_assign
l_int|0xB0
comma
id|PTxCDAR
op_assign
l_int|0xC4
comma
id|TxThresh
op_assign
l_int|0xDC
comma
)brace
suffix:semicolon
multiline_comment|/* Interrupt register bits, using my own meaningful names. */
DECL|enum|IntrStatus
r_enum
id|IntrStatus
(brace
DECL|enumerator|TxIdle
DECL|enumerator|RxIdle
DECL|enumerator|IntrSummary
id|TxIdle
op_assign
l_int|0x40000
comma
id|RxIdle
op_assign
l_int|0x20000
comma
id|IntrSummary
op_assign
l_int|0x010000
comma
DECL|enumerator|PCIBusErr170
DECL|enumerator|PCIBusErr175
DECL|enumerator|PhyEvent175
id|PCIBusErr170
op_assign
l_int|0x7000
comma
id|PCIBusErr175
op_assign
l_int|0x1000
comma
id|PhyEvent175
op_assign
l_int|0x8000
comma
DECL|enumerator|RxStarted
DECL|enumerator|RxEarlyWarn
DECL|enumerator|CntFull
DECL|enumerator|TxUnderrun
id|RxStarted
op_assign
l_int|0x0800
comma
id|RxEarlyWarn
op_assign
l_int|0x0400
comma
id|CntFull
op_assign
l_int|0x0200
comma
id|TxUnderrun
op_assign
l_int|0x0100
comma
DECL|enumerator|TxEmpty
DECL|enumerator|TxDone
DECL|enumerator|RxError
id|TxEmpty
op_assign
l_int|0x0080
comma
id|TxDone
op_assign
l_int|0x0020
comma
id|RxError
op_assign
l_int|0x0010
comma
DECL|enumerator|RxOverflow
DECL|enumerator|RxFull
DECL|enumerator|RxHeader
DECL|enumerator|RxDone
id|RxOverflow
op_assign
l_int|0x0008
comma
id|RxFull
op_assign
l_int|0x0004
comma
id|RxHeader
op_assign
l_int|0x0002
comma
id|RxDone
op_assign
l_int|0x0001
comma
)brace
suffix:semicolon
DECL|enum|CommandBits
r_enum
id|CommandBits
(brace
DECL|enumerator|StopRx
DECL|enumerator|StartRx
DECL|enumerator|TxQueued
DECL|enumerator|RxQueued
id|StopRx
op_assign
l_int|1
comma
id|StartRx
op_assign
l_int|2
comma
id|TxQueued
op_assign
l_int|4
comma
id|RxQueued
op_assign
l_int|8
comma
DECL|enumerator|StopTxDMA
DECL|enumerator|StopRxDMA
DECL|enumerator|RestartTx
id|StopTxDMA
op_assign
l_int|0x20
comma
id|StopRxDMA
op_assign
l_int|0x40
comma
id|RestartTx
op_assign
l_int|0x80
comma
)brace
suffix:semicolon
DECL|variable|media2miictl
r_static
id|u16
id|media2miictl
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
l_int|0x0C00
comma
l_int|0x0C00
comma
l_int|0x2000
comma
l_int|0x0100
comma
l_int|0x2100
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* The EPIC100 Rx and Tx buffer descriptors. */
DECL|struct|epic_tx_desc
r_struct
id|epic_tx_desc
(brace
DECL|member|txstatus
id|u32
id|txstatus
suffix:semicolon
DECL|member|bufaddr
id|u32
id|bufaddr
suffix:semicolon
DECL|member|buflength
id|u32
id|buflength
suffix:semicolon
DECL|member|next
id|u32
id|next
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|epic_rx_desc
r_struct
id|epic_rx_desc
(brace
DECL|member|rxstatus
id|u32
id|rxstatus
suffix:semicolon
DECL|member|bufaddr
id|u32
id|bufaddr
suffix:semicolon
DECL|member|buflength
id|u32
id|buflength
suffix:semicolon
DECL|member|next
id|u32
id|next
suffix:semicolon
)brace
suffix:semicolon
DECL|enum|desc_status_bits
r_enum
id|desc_status_bits
(brace
DECL|enumerator|DescOwn
id|DescOwn
op_assign
l_int|0x8000
comma
)brace
suffix:semicolon
DECL|struct|epic_private
r_struct
id|epic_private
(brace
multiline_comment|/* Tx and Rx rings first so that they remain paragraph aligned. */
DECL|member|rx_ring
r_struct
id|epic_rx_desc
id|rx_ring
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
DECL|member|tx_ring
r_struct
id|epic_tx_desc
id|tx_ring
(braket
id|TX_RING_SIZE
)braket
suffix:semicolon
multiline_comment|/* The saved address of a sent-in-place packet/buffer, for skfree(). */
DECL|member|tx_skbuff
r_struct
id|sk_buff
op_star
id|tx_skbuff
(braket
id|TX_RING_SIZE
)braket
suffix:semicolon
multiline_comment|/* The addresses of receive-in-place skbuffs. */
DECL|member|rx_skbuff
r_struct
id|sk_buff
op_star
id|rx_skbuff
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
multiline_comment|/* Ring pointers. */
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
multiline_comment|/* Group with Tx control cache line. */
DECL|member|cur_tx
DECL|member|dirty_tx
r_int
r_int
id|cur_tx
comma
id|dirty_tx
suffix:semicolon
DECL|member|last_tx_desc
r_struct
id|descriptor
op_star
id|last_tx_desc
suffix:semicolon
DECL|member|cur_rx
DECL|member|dirty_rx
r_int
r_int
id|cur_rx
comma
id|dirty_rx
suffix:semicolon
DECL|member|rx_buf_sz
r_int
r_int
id|rx_buf_sz
suffix:semicolon
multiline_comment|/* Based on MTU+slack. */
DECL|member|last_rx_desc
r_struct
id|descriptor
op_star
id|last_rx_desc
suffix:semicolon
DECL|member|last_rx_time
r_int
id|last_rx_time
suffix:semicolon
multiline_comment|/* Last Rx, in jiffies. */
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
multiline_comment|/* PCI bus location. */
DECL|member|chip_flags
r_int
id|chip_flags
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
multiline_comment|/* Media selection timer. */
DECL|member|tx_threshold
r_int
id|tx_threshold
suffix:semicolon
DECL|member|mc_filter
r_int
r_char
id|mc_filter
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|phys
r_int
r_char
id|phys
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* MII device addresses. */
DECL|member|advertising
id|u16
id|advertising
suffix:semicolon
multiline_comment|/* NWay media advertisement */
DECL|member|mii_phy_cnt
r_int
id|mii_phy_cnt
suffix:semicolon
DECL|member|tx_full
r_int
r_int
id|tx_full
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* The Tx queue is full. */
DECL|member|full_duplex
r_int
r_int
id|full_duplex
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Current duplex setting. */
DECL|member|force_fd
r_int
r_int
id|force_fd
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Full-duplex operation requested. */
DECL|member|default_port
r_int
r_int
id|default_port
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* Last dev-&gt;if_port value. */
DECL|member|media2
r_int
r_int
id|media2
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* Secondary monitored media port. */
DECL|member|medialock
r_int
r_int
id|medialock
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Don&squot;t sense media type. */
DECL|member|mediasense
r_int
r_int
id|mediasense
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Media sensing in progress. */
)brace
suffix:semicolon
r_static
r_int
id|epic_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|read_eeprom
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_int
id|mdio_read
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_void
id|mdio_write
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|epic_restart
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|epic_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|epic_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|epic_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|epic_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|epic_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|epic_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_int
id|epic_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|epic_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
"&f;"
DECL|function|epic_init_one
r_static
r_int
id|__devinit
id|epic_init_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_static
r_int
id|card_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_static
r_int
id|printed_version
op_assign
l_int|0
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|epic_private
op_star
id|ep
suffix:semicolon
r_int
id|i
comma
id|option
op_assign
l_int|0
comma
id|duplex
op_assign
l_int|0
suffix:semicolon
r_struct
id|epic_chip_info
op_star
id|ci
op_assign
op_amp
id|epic_chip_info
(braket
id|ent-&gt;driver_data
)braket
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_int
id|chip_idx
op_assign
(paren
r_int
)paren
id|ent-&gt;driver_data
suffix:semicolon
id|card_idx
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printed_version
op_increment
)paren
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
id|KERN_INFO
l_string|&quot;%s&quot;
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version
comma
id|version2
comma
id|version3
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
OL
id|ci-&gt;io_size
)paren
op_logical_or
(paren
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
OL
id|ci-&gt;io_size
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;card %d: no PCI region space&bslash;n&quot;
comma
id|card_idx
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|i
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|dev
op_assign
id|init_etherdev
c_func
(paren
l_int|NULL
comma
r_sizeof
(paren
op_star
id|ep
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;card %d: no memory for eth device&bslash;n&quot;
comma
id|card_idx
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* request 100% of both regions 0 and 1, just to make&n;&t; * sure noone else steals our regions while we are talking&n;&t; * to them */
r_if
c_cond
(paren
op_logical_neg
id|request_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
comma
id|dev-&gt;name
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;epic100 %d: I/O region busy&bslash;n&quot;
comma
id|card_idx
)paren
suffix:semicolon
r_goto
id|err_out_free_netdev
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|1
)paren
comma
id|dev-&gt;name
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;epic100 %d: I/O region busy&bslash;n&quot;
comma
id|card_idx
)paren
suffix:semicolon
r_goto
id|err_out_free_pio
suffix:semicolon
)brace
macro_line|#ifdef USE_IO_OPS
id|ioaddr
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#else
id|ioaddr
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|ioaddr
op_assign
(paren
r_int
)paren
id|ioremap
(paren
id|ioaddr
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ioaddr
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;epic100 %d: ioremap failed&bslash;n&quot;
comma
id|card_idx
)paren
suffix:semicolon
r_goto
id|err_out_free_mmio
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;mem_start
)paren
(brace
id|option
op_assign
id|dev-&gt;mem_start
suffix:semicolon
id|duplex
op_assign
(paren
id|dev-&gt;mem_start
op_amp
l_int|16
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|card_idx
op_ge
l_int|0
op_logical_and
id|card_idx
OL
id|MAX_UNITS
)paren
(brace
r_if
c_cond
(paren
id|options
(braket
id|card_idx
)braket
op_ge
l_int|0
)paren
id|option
op_assign
id|options
(braket
id|card_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|full_duplex
(braket
id|card_idx
)braket
op_ge
l_int|0
)paren
id|duplex
op_assign
id|full_duplex
(braket
id|card_idx
)braket
suffix:semicolon
)brace
id|pdev-&gt;driver_data
op_assign
id|dev
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|ep
op_assign
id|dev-&gt;priv
suffix:semicolon
id|ep-&gt;pci_dev
op_assign
id|pdev
suffix:semicolon
id|ep-&gt;chip_flags
op_assign
id|ci-&gt;drv_flags
suffix:semicolon
id|spin_lock_init
(paren
op_amp
id|ep-&gt;lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s at %#lx, IRQ %d, &quot;
comma
id|dev-&gt;name
comma
id|ci-&gt;name
comma
id|ioaddr
comma
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* Bring the chip out of low-power mode. */
id|outl
c_func
(paren
l_int|0x4200
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
multiline_comment|/* Magic?!  If we don&squot;t set this bit the MII interface won&squot;t work. */
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|TEST1
)paren
suffix:semicolon
multiline_comment|/* Turn on the MII transceiver. */
id|outl
c_func
(paren
l_int|0x12
comma
id|ioaddr
op_plus
id|MIICfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip_idx
op_eq
l_int|1
)paren
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|NVCTL
)paren
op_amp
op_complement
l_int|0x003C
)paren
op_or
l_int|0x4800
comma
id|ioaddr
op_plus
id|NVCTL
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0200
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
multiline_comment|/* This could also be read from the EEPROM. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
)paren
(braket
id|i
)braket
op_assign
id|le16_to_cpu
c_func
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|LAN0
op_plus
id|i
op_star
l_int|4
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x:&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%2.2x.&bslash;n&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: EEPROM contents&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %4.4x%s&quot;
comma
id|read_eeprom
c_func
(paren
id|ioaddr
comma
id|i
)paren
comma
id|i
op_mod
l_int|16
op_eq
l_int|15
ques
c_cond
l_string|&quot;&bslash;n&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Find the connected MII xcvrs.&n;&t;   Doing this in open() would allow detecting external xcvrs later, but&n;&t;   takes much time and no cards have external MII. */
(brace
r_int
id|phy
comma
id|phy_idx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|phy
op_assign
l_int|1
suffix:semicolon
id|phy
OL
l_int|32
op_logical_and
id|phy_idx
OL
r_sizeof
(paren
id|ep-&gt;phys
)paren
suffix:semicolon
id|phy
op_increment
)paren
(brace
r_int
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|phy
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_ne
l_int|0xffff
op_logical_and
id|mii_status
op_ne
l_int|0x0000
)paren
(brace
id|ep-&gt;phys
(braket
id|phy_idx
op_increment
)braket
op_assign
id|phy
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MII transceiver #%d control &quot;
l_string|&quot;%4.4x status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|phy
comma
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|phy
comma
l_int|0
)paren
comma
id|mii_status
)paren
suffix:semicolon
)brace
)brace
id|ep-&gt;mii_phy_cnt
op_assign
id|phy_idx
suffix:semicolon
r_if
c_cond
(paren
id|phy_idx
op_ne
l_int|0
)paren
(brace
id|phy
op_assign
id|ep-&gt;phys
(braket
l_int|0
)braket
suffix:semicolon
id|ep-&gt;advertising
op_assign
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|phy
comma
l_int|4
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Autonegotiation advertising %4.4x link &quot;
l_string|&quot;partner %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ep-&gt;advertising
comma
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|phy
comma
l_int|5
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|ep-&gt;chip_flags
op_amp
id|NO_MII
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: ***WARNING***: No MII transceiver found!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Use the known PHY address of the EPII. */
id|ep-&gt;phys
(braket
l_int|0
)braket
op_assign
l_int|3
suffix:semicolon
)brace
)brace
multiline_comment|/* Turn off the MII xcvr (175 only!), leave the chip in low-power mode. */
r_if
c_cond
(paren
id|ep-&gt;chip_flags
op_amp
id|MII_PWRDWN
)paren
id|outl
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|NVCTL
)paren
op_amp
op_complement
l_int|0x483C
comma
id|ioaddr
op_plus
id|NVCTL
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
multiline_comment|/* The lower four bits are the media type. */
id|ep-&gt;force_fd
op_assign
id|duplex
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|ep-&gt;default_port
op_assign
id|option
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;default_port
)paren
id|ep-&gt;medialock
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* The Epic-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|epic_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|epic_start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|epic_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|epic_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_rx_mode
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|mii_ioctl
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
op_amp
id|epic_tx_timeout
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#ifndef USE_IO_OPS
id|err_out_free_mmio
suffix:colon
id|release_mem_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|1
)paren
)paren
suffix:semicolon
macro_line|#endif
id|err_out_free_pio
suffix:colon
id|release_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|err_out_free_netdev
suffix:colon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
"&f;"
multiline_comment|/* Serial EEPROM section. */
multiline_comment|/*  EEPROM_Ctrl bits. */
DECL|macro|EE_SHIFT_CLK
mdefine_line|#define EE_SHIFT_CLK&t;0x04&t;/* EEPROM shift clock. */
DECL|macro|EE_CS
mdefine_line|#define EE_CS&t;&t;&t;0x02&t;/* EEPROM chip select. */
DECL|macro|EE_DATA_WRITE
mdefine_line|#define EE_DATA_WRITE&t;0x08&t;/* EEPROM chip data in. */
DECL|macro|EE_WRITE_0
mdefine_line|#define EE_WRITE_0&t;&t;0x01
DECL|macro|EE_WRITE_1
mdefine_line|#define EE_WRITE_1&t;&t;0x09
DECL|macro|EE_DATA_READ
mdefine_line|#define EE_DATA_READ&t;0x10&t;/* EEPROM chip data out. */
DECL|macro|EE_ENB
mdefine_line|#define EE_ENB&t;&t;&t;(0x0001 | EE_CS)
multiline_comment|/* Delay between EEPROM clock transitions.&n;   No extra delay is needed with 33Mhz PCI, but 66Mhz is untested.&n; */
DECL|macro|eeprom_delay
mdefine_line|#define eeprom_delay()&t;inl(ee_addr)
multiline_comment|/* The EEPROM commands include the alway-set leading bit. */
DECL|macro|EE_WRITE_CMD
mdefine_line|#define EE_WRITE_CMD&t;(5 &lt;&lt; 6)
DECL|macro|EE_READ64_CMD
mdefine_line|#define EE_READ64_CMD&t;(6 &lt;&lt; 6)
DECL|macro|EE_READ256_CMD
mdefine_line|#define EE_READ256_CMD&t;(6 &lt;&lt; 8)
DECL|macro|EE_ERASE_CMD
mdefine_line|#define EE_ERASE_CMD&t;(7 &lt;&lt; 6)
DECL|function|read_eeprom
r_static
r_int
id|read_eeprom
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|location
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|ee_addr
op_assign
id|ioaddr
op_plus
id|EECTL
suffix:semicolon
r_int
id|read_cmd
op_assign
id|location
op_or
(paren
id|inl
c_func
(paren
id|ee_addr
)paren
op_amp
l_int|0x40
ques
c_cond
id|EE_READ64_CMD
suffix:colon
id|EE_READ256_CMD
)paren
suffix:semicolon
id|outl
c_func
(paren
id|EE_ENB
op_amp
op_complement
id|EE_CS
comma
id|ee_addr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|12
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|read_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|EE_WRITE_1
suffix:colon
id|EE_WRITE_0
suffix:semicolon
id|outl
c_func
(paren
id|EE_ENB
op_or
id|dataval
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|EE_ENB
op_or
id|dataval
op_or
id|EE_SHIFT_CLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
)brace
id|outl
c_func
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
id|EE_ENB
op_or
id|EE_SHIFT_CLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|inl
c_func
(paren
id|ee_addr
)paren
op_amp
id|EE_DATA_READ
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|outl
c_func
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Terminate the EEPROM access. */
id|outl
c_func
(paren
id|EE_ENB
op_amp
op_complement
id|EE_CS
comma
id|ee_addr
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|macro|MII_READOP
mdefine_line|#define MII_READOP&t;&t;1
DECL|macro|MII_WRITEOP
mdefine_line|#define MII_WRITEOP&t;&t;2
DECL|function|mdio_read
r_static
r_int
id|mdio_read
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
(brace
r_int
id|i
suffix:semicolon
id|outl
c_func
(paren
(paren
id|phy_id
op_lshift
l_int|9
)paren
op_or
(paren
id|location
op_lshift
l_int|4
)paren
op_or
id|MII_READOP
comma
id|ioaddr
op_plus
id|MIICtrl
)paren
suffix:semicolon
multiline_comment|/* Typical operation takes &lt; 50 ticks. */
r_for
c_loop
(paren
id|i
op_assign
l_int|4000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|MIICtrl
)paren
op_amp
id|MII_READOP
)paren
op_eq
l_int|0
)paren
r_return
id|inw
c_func
(paren
id|ioaddr
op_plus
id|MIIData
)paren
suffix:semicolon
r_return
l_int|0xffff
suffix:semicolon
)brace
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
(brace
r_int
id|i
suffix:semicolon
id|outw
c_func
(paren
id|value
comma
id|ioaddr
op_plus
id|MIIData
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|phy_id
op_lshift
l_int|9
)paren
op_or
(paren
id|location
op_lshift
l_int|4
)paren
op_or
id|MII_WRITEOP
comma
id|ioaddr
op_plus
id|MIICtrl
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|10000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|MIICtrl
)paren
op_amp
id|MII_WRITEOP
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
"&f;"
DECL|function|epic_open
r_static
r_int
id|epic_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|ep-&gt;full_duplex
op_assign
id|ep-&gt;force_fd
suffix:semicolon
multiline_comment|/* Soft reset the chip. */
id|outl
c_func
(paren
l_int|0x4001
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|epic_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|epic_init_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x4000
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
multiline_comment|/* This next magic! line by Ken Yamaguchi.. ?? */
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|TEST1
)paren
suffix:semicolon
multiline_comment|/* Pull the chip out of low-power mode, enable interrupts, and set for&n;&t;   PCI read multiple.  The MIIcfg setting and strange write order are&n;&t;   required by the details of which bits are reset and the transceiver&n;&t;   wiring on the Ositech CardBus card.&n;&t;*/
id|outl
c_func
(paren
l_int|0x12
comma
id|ioaddr
op_plus
id|MIICfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;chip_flags
op_amp
id|MII_PWRDWN
)paren
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|NVCTL
)paren
op_amp
op_complement
l_int|0x003C
)paren
op_or
l_int|0x4800
comma
id|ioaddr
op_plus
id|NVCTL
)paren
suffix:semicolon
macro_line|#if defined(__powerpc__) || defined(__sparc__)&t;&t;/* Big endian */
id|outl
c_func
(paren
l_int|0x4432
op_or
(paren
id|RX_FIFO_THRESH
op_lshift
l_int|8
)paren
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|inl
c_func
(paren
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0432
op_or
(paren
id|RX_FIFO_THRESH
op_lshift
l_int|8
)paren
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
macro_line|#else
id|outl
c_func
(paren
l_int|0x4412
op_or
(paren
id|RX_FIFO_THRESH
op_lshift
l_int|8
)paren
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|inl
c_func
(paren
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0412
op_or
(paren
id|RX_FIFO_THRESH
op_lshift
l_int|8
)paren
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
id|outl
c_func
(paren
id|cpu_to_le16
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
)paren
(braket
id|i
)braket
)paren
comma
id|ioaddr
op_plus
id|LAN0
op_plus
id|i
op_star
l_int|4
)paren
suffix:semicolon
id|ep-&gt;tx_threshold
op_assign
id|TX_FIFO_THRESH
suffix:semicolon
id|outl
c_func
(paren
id|ep-&gt;tx_threshold
comma
id|ioaddr
op_plus
id|TxThresh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|media2miictl
(braket
id|dev-&gt;if_port
op_amp
l_int|15
)braket
)paren
(brace
r_if
c_cond
(paren
id|ep-&gt;mii_phy_cnt
)paren
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|ep-&gt;phys
(braket
l_int|0
)braket
comma
l_int|0
comma
id|media2miictl
(braket
id|dev-&gt;if_port
op_amp
l_int|15
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Using the 10base2 transceiver, MII &quot;
l_string|&quot;status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|ep-&gt;phys
(braket
l_int|0
)braket
comma
l_int|1
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x13
comma
id|ioaddr
op_plus
id|MIICfg
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_int
id|mii_reg5
op_assign
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|ep-&gt;phys
(braket
l_int|0
)braket
comma
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_reg5
op_ne
l_int|0xffff
)paren
(brace
r_if
c_cond
(paren
(paren
id|mii_reg5
op_amp
l_int|0x0100
)paren
op_logical_or
(paren
id|mii_reg5
op_amp
l_int|0x01C0
)paren
op_eq
l_int|0x0040
)paren
id|ep-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|mii_reg5
op_amp
l_int|0x4000
)paren
)paren
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|ep-&gt;phys
(braket
l_int|0
)braket
comma
l_int|0
comma
l_int|0x1200
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Setting %s-duplex based on MII xcvr %d&quot;
l_string|&quot; register read of %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ep-&gt;full_duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
comma
id|ep-&gt;phys
(braket
l_int|0
)braket
comma
id|mii_reg5
)paren
suffix:semicolon
)brace
)brace
id|outl
c_func
(paren
id|ep-&gt;full_duplex
ques
c_cond
l_int|0x7F
suffix:colon
l_int|0x79
comma
id|ioaddr
op_plus
id|TxCtrl
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|ep-&gt;rx_ring
)paren
comma
id|ioaddr
op_plus
id|PRxCDAR
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|ep-&gt;tx_ring
)paren
comma
id|ioaddr
op_plus
id|PTxCDAR
)paren
suffix:semicolon
multiline_comment|/* Start the chip&squot;s Rx process. */
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outl
c_func
(paren
id|StartRx
op_or
id|RxQueued
comma
id|ioaddr
op_plus
id|COMMAND
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Enable interrupts by setting the interrupt mask. */
id|outl
c_func
(paren
(paren
id|ep-&gt;chip_flags
op_amp
id|TYPE2_INTR
ques
c_cond
id|PCIBusErr175
suffix:colon
id|PCIBusErr170
)paren
op_or
id|CntFull
op_or
id|TxUnderrun
op_or
id|TxDone
op_or
id|TxEmpty
op_or
id|RxError
op_or
id|RxOverflow
op_or
id|RxFull
op_or
id|RxHeader
op_or
id|RxDone
comma
id|ioaddr
op_plus
id|INTMASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: epic_open() ioaddr %lx IRQ %d status %4.4x &quot;
l_string|&quot;%s-duplex.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ioaddr
comma
id|dev-&gt;irq
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|GENCTL
)paren
comma
id|ep-&gt;full_duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
multiline_comment|/* Set the timer to switch to check for link beat and perhaps switch&n;&t;   to an alternate media type. */
id|init_timer
c_func
(paren
op_amp
id|ep-&gt;timer
)paren
suffix:semicolon
id|ep-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|3
op_star
id|HZ
suffix:semicolon
id|ep-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|ep-&gt;timer.function
op_assign
op_amp
id|epic_timer
suffix:semicolon
multiline_comment|/* timer handler */
id|add_timer
c_func
(paren
op_amp
id|ep-&gt;timer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Reset the chip to recover from a PCI transaction error.&n;   This may occur at interrupt time. */
DECL|function|epic_pause
r_static
r_void
id|epic_pause
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|outl
c_func
(paren
l_int|0x00000000
comma
id|ioaddr
op_plus
id|INTMASK
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx DMA processes. */
id|outw
c_func
(paren
id|StopRx
op_or
id|StopTxDMA
op_or
id|StopRxDMA
comma
id|ioaddr
op_plus
id|COMMAND
)paren
suffix:semicolon
multiline_comment|/* Update the error counts. */
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|COMMAND
)paren
op_ne
l_int|0xffff
)paren
(brace
id|ep-&gt;stats.rx_missed_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|MPCNT
)paren
suffix:semicolon
id|ep-&gt;stats.rx_frame_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|ALICNT
)paren
suffix:semicolon
id|ep-&gt;stats.rx_crc_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CRCCNT
)paren
suffix:semicolon
)brace
multiline_comment|/* Remove the packets on the Rx queue. */
id|epic_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|epic_restart
r_static
r_void
id|epic_restart
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Restarting the EPIC chip, Rx %d/%d Tx %d/%d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ep-&gt;cur_rx
comma
id|ep-&gt;dirty_rx
comma
id|ep-&gt;dirty_tx
comma
id|ep-&gt;cur_tx
)paren
suffix:semicolon
multiline_comment|/* Soft reset the chip. */
id|outl
c_func
(paren
l_int|0x0001
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Duplicate code from epic_open(). */
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|TEST1
)paren
suffix:semicolon
macro_line|#if defined(__powerpc__) || defined(__sparc__)&t;&t;/* Big endian */
id|outl
c_func
(paren
l_int|0x0432
op_or
(paren
id|RX_FIFO_THRESH
op_lshift
l_int|8
)paren
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
macro_line|#else
id|outl
c_func
(paren
l_int|0x0412
op_or
(paren
id|RX_FIFO_THRESH
op_lshift
l_int|8
)paren
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
macro_line|#endif
id|outl
c_func
(paren
id|dev-&gt;if_port
op_eq
l_int|1
ques
c_cond
l_int|0x13
suffix:colon
l_int|0x12
comma
id|ioaddr
op_plus
id|MIICfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;chip_flags
op_amp
id|MII_PWRDWN
)paren
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|NVCTL
)paren
op_amp
op_complement
l_int|0x003C
)paren
op_or
l_int|0x4800
comma
id|ioaddr
op_plus
id|NVCTL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
id|outl
c_func
(paren
id|cpu_to_le16
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
)paren
(braket
id|i
)braket
)paren
comma
id|ioaddr
op_plus
id|LAN0
op_plus
id|i
op_star
l_int|4
)paren
suffix:semicolon
id|ep-&gt;tx_threshold
op_assign
id|TX_FIFO_THRESH
suffix:semicolon
id|outl
c_func
(paren
id|ep-&gt;tx_threshold
comma
id|ioaddr
op_plus
id|TxThresh
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ep-&gt;full_duplex
ques
c_cond
l_int|0x7F
suffix:colon
l_int|0x79
comma
id|ioaddr
op_plus
id|TxCtrl
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|ep-&gt;rx_ring
(braket
id|ep-&gt;cur_rx
op_mod
id|RX_RING_SIZE
)braket
)paren
comma
id|ioaddr
op_plus
id|PRxCDAR
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|ep-&gt;tx_ring
(braket
id|ep-&gt;dirty_tx
op_mod
id|TX_RING_SIZE
)braket
)paren
comma
id|ioaddr
op_plus
id|PTxCDAR
)paren
suffix:semicolon
multiline_comment|/* Start the chip&squot;s Rx process. */
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outl
c_func
(paren
id|StartRx
op_or
id|RxQueued
comma
id|ioaddr
op_plus
id|COMMAND
)paren
suffix:semicolon
multiline_comment|/* Enable interrupts by setting the interrupt mask. */
id|outl
c_func
(paren
(paren
id|ep-&gt;chip_flags
op_amp
id|TYPE2_INTR
ques
c_cond
id|PCIBusErr175
suffix:colon
id|PCIBusErr170
)paren
op_or
id|CntFull
op_or
id|TxUnderrun
op_or
id|TxDone
op_or
id|TxEmpty
op_or
id|RxError
op_or
id|RxOverflow
op_or
id|RxFull
op_or
id|RxHeader
op_or
id|RxDone
comma
id|ioaddr
op_plus
id|INTMASK
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: epic_restart() done, cmd status %4.4x, ctl %4.4x&quot;
l_string|&quot; interrupt %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|COMMAND
)paren
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|GENCTL
)paren
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|INTSTAT
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|epic_timer
r_static
r_void
id|epic_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|next_tick
op_assign
l_int|60
op_star
id|HZ
suffix:semicolon
r_int
id|mii_reg5
op_assign
id|ep-&gt;mii_phy_cnt
ques
c_cond
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|ep-&gt;phys
(braket
l_int|0
)braket
comma
l_int|5
)paren
suffix:colon
l_int|0
suffix:semicolon
r_int
id|negotiated
op_assign
id|mii_reg5
op_amp
id|ep-&gt;advertising
suffix:semicolon
r_int
id|duplex
op_assign
(paren
id|negotiated
op_amp
l_int|0x0100
)paren
op_logical_or
(paren
id|negotiated
op_amp
l_int|0x01C0
)paren
op_eq
l_int|0x0040
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|3
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media monitor tick, Tx status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|TxSTAT
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Other registers are IntMask %4.4x &quot;
l_string|&quot;IntStatus %4.4x RxStatus %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|INTMASK
)paren
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|INTSTAT
)paren
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|RxSTAT
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ep-&gt;force_fd
)paren
(brace
r_if
c_cond
(paren
id|ep-&gt;full_duplex
op_ne
id|duplex
)paren
(brace
id|ep-&gt;full_duplex
op_assign
id|duplex
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Setting %s-duplex based on MII #%d link&quot;
l_string|&quot; partner capability of %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ep-&gt;full_duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
comma
id|ep-&gt;phys
(braket
l_int|0
)braket
comma
id|mii_reg5
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ep-&gt;full_duplex
ques
c_cond
l_int|0x7F
suffix:colon
l_int|0x79
comma
id|ioaddr
op_plus
id|TxCtrl
)paren
suffix:semicolon
)brace
)brace
id|ep-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|next_tick
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ep-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|epic_tx_timeout
r_static
r_void
id|epic_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Transmit timeout using MII device, &quot;
l_string|&quot;Tx status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|TxSTAT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Tx indices: dirty_tx %d, cur_tx %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ep-&gt;dirty_tx
comma
id|ep-&gt;cur_tx
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|TxSTAT
)paren
op_amp
l_int|0x10
)paren
(brace
multiline_comment|/* Tx FIFO underflow. */
id|ep-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
id|outl
c_func
(paren
id|RestartTx
comma
id|ioaddr
op_plus
id|COMMAND
)paren
suffix:semicolon
)brace
r_else
(brace
id|epic_restart
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outl
c_func
(paren
id|TxQueued
comma
id|dev-&gt;base_addr
op_plus
id|COMMAND
)paren
suffix:semicolon
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|ep-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Initialize the Rx and Tx rings, along with various &squot;dev&squot; bits. */
DECL|function|epic_init_ring
r_static
r_void
id|epic_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ep-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;lock
op_assign
(paren
id|spinlock_t
)paren
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|ep-&gt;dirty_tx
op_assign
id|ep-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;cur_rx
op_assign
id|ep-&gt;dirty_rx
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;last_rx_time
op_assign
id|jiffies
suffix:semicolon
id|ep-&gt;rx_buf_sz
op_assign
(paren
id|dev-&gt;mtu
op_le
l_int|1500
ques
c_cond
id|PKT_BUF_SZ
suffix:colon
id|dev-&gt;mtu
op_plus
l_int|32
)paren
suffix:semicolon
multiline_comment|/* Initialize all Rx descriptors. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ep-&gt;rx_ring
(braket
id|i
)braket
dot
id|rxstatus
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;rx_ring
(braket
id|i
)braket
dot
id|buflength
op_assign
id|cpu_to_le32
c_func
(paren
id|ep-&gt;rx_buf_sz
)paren
suffix:semicolon
id|ep-&gt;rx_ring
(braket
id|i
)braket
dot
id|next
op_assign
id|virt_to_le32desc
c_func
(paren
op_amp
id|ep-&gt;rx_ring
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|ep-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Mark the last entry as wrapping the ring. */
id|ep-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|next
op_assign
id|virt_to_le32desc
c_func
(paren
op_amp
id|ep-&gt;rx_ring
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Fill in the Rx buffers.  Handle allocation failure gracefully. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|ep-&gt;rx_buf_sz
)paren
suffix:semicolon
id|ep-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 byte align the IP header. */
id|ep-&gt;rx_ring
(braket
id|i
)braket
dot
id|bufaddr
op_assign
id|virt_to_le32desc
c_func
(paren
id|skb-&gt;tail
)paren
suffix:semicolon
id|ep-&gt;rx_ring
(braket
id|i
)braket
dot
id|rxstatus
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
)brace
id|ep-&gt;dirty_rx
op_assign
(paren
r_int
r_int
)paren
(paren
id|i
op_minus
id|RX_RING_SIZE
)paren
suffix:semicolon
multiline_comment|/* The Tx buffer descriptor is filled in as needed, but we&n;&t;   do need to clear the ownership bit. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ep-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;tx_ring
(braket
id|i
)braket
dot
id|txstatus
op_assign
l_int|0x0000
suffix:semicolon
id|ep-&gt;tx_ring
(braket
id|i
)braket
dot
id|next
op_assign
id|virt_to_le32desc
c_func
(paren
op_amp
id|ep-&gt;tx_ring
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
)brace
id|ep-&gt;tx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|next
op_assign
id|virt_to_le32desc
c_func
(paren
op_amp
id|ep-&gt;tx_ring
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|epic_start_xmit
r_static
r_int
id|epic_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
comma
id|free_count
suffix:semicolon
id|u32
id|ctrl_word
suffix:semicolon
multiline_comment|/* Caution: the write order is important here, set the field with the&n;&t;   &quot;ownership&quot; bit last. */
id|spin_lock_irq
c_func
(paren
op_amp
id|ep-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Calculate the next Tx descriptor entry. */
id|free_count
op_assign
id|ep-&gt;cur_tx
op_minus
id|ep-&gt;dirty_tx
suffix:semicolon
id|entry
op_assign
id|ep-&gt;cur_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
id|ep-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|ep-&gt;tx_ring
(braket
id|entry
)braket
dot
id|bufaddr
op_assign
id|virt_to_le32desc
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|free_count
OL
id|TX_QUEUE_LEN
op_div
l_int|2
)paren
(brace
multiline_comment|/* Typical path */
id|ctrl_word
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x100000
)paren
suffix:semicolon
multiline_comment|/* No interrupt */
)brace
r_else
r_if
c_cond
(paren
id|free_count
op_eq
id|TX_QUEUE_LEN
op_div
l_int|2
)paren
(brace
id|ctrl_word
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x140000
)paren
suffix:semicolon
multiline_comment|/* Tx-done intr. */
)brace
r_else
r_if
c_cond
(paren
id|free_count
OL
id|TX_QUEUE_LEN
op_minus
l_int|1
)paren
(brace
id|ctrl_word
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x100000
)paren
suffix:semicolon
multiline_comment|/* No Tx-done intr. */
)brace
r_else
(brace
multiline_comment|/* Leave room for an additional entry. */
id|ctrl_word
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x140000
)paren
suffix:semicolon
multiline_comment|/* Tx-done intr. */
id|ep-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
)brace
id|ep-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buflength
op_assign
id|ctrl_word
op_or
id|cpu_to_le32
c_func
(paren
id|skb-&gt;len
)paren
suffix:semicolon
id|ep-&gt;tx_ring
(braket
id|entry
)braket
dot
id|txstatus
op_assign
(paren
(paren
id|skb-&gt;len
op_ge
id|ETH_ZLEN
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
)paren
op_lshift
l_int|16
)paren
op_or
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
id|ep-&gt;cur_tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;tx_full
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ep-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|outl
c_func
(paren
id|TxQueued
comma
id|dev-&gt;base_addr
op_plus
id|COMMAND
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Queued Tx packet size %d to slot %d, &quot;
l_string|&quot;flag %2.2x Tx status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
id|entry
comma
id|ctrl_word
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|TxSTAT
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up&n;   after the Tx thread. */
DECL|function|epic_interrupt
r_static
r_void
id|epic_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_instance
suffix:semicolon
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|status
comma
id|boguscnt
op_assign
id|max_interrupt_work
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|ep-&gt;lock
)paren
suffix:semicolon
r_do
(brace
id|status
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|INTSTAT
)paren
suffix:semicolon
multiline_comment|/* Acknowledge all of the current interrupt sources ASAP. */
id|outl
c_func
(paren
id|status
op_amp
l_int|0x00007fff
comma
id|ioaddr
op_plus
id|INTSTAT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Interrupt, status=%#8.8x new &quot;
l_string|&quot;intstat=%#8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|INTSTAT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|IntrSummary
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxDone
op_or
id|RxStarted
op_or
id|RxEarlyWarn
op_or
id|RxOverflow
)paren
)paren
id|epic_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TxEmpty
op_or
id|TxDone
)paren
)paren
(brace
r_int
r_int
id|dirty_tx
comma
id|cur_tx
suffix:semicolon
multiline_comment|/* Note: if this lock becomes a problem we can narrow the locked&n;&t;&t;&t;   region at the cost of occasionally grabbing the lock more&n;&t;&t;&t;   times. */
id|cur_tx
op_assign
id|ep-&gt;cur_tx
suffix:semicolon
id|dirty_tx
op_assign
id|ep-&gt;dirty_tx
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|cur_tx
op_minus
id|dirty_tx
OG
l_int|0
suffix:semicolon
id|dirty_tx
op_increment
)paren
(brace
r_int
id|entry
op_assign
id|dirty_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_int
id|txstatus
op_assign
id|le32_to_cpu
c_func
(paren
id|ep-&gt;tx_ring
(braket
id|entry
)braket
dot
id|txstatus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|txstatus
op_amp
id|DescOwn
)paren
r_break
suffix:semicolon
multiline_comment|/* It still hasn&squot;t been Txed */
r_if
c_cond
(paren
op_logical_neg
(paren
id|txstatus
op_amp
l_int|0x0001
)paren
)paren
(brace
multiline_comment|/* There was an major error, log it. */
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Transmit error, Tx status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|txstatus
)paren
suffix:semicolon
macro_line|#endif
id|ep-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|txstatus
op_amp
l_int|0x1050
)paren
id|ep-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|txstatus
op_amp
l_int|0x0008
)paren
id|ep-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|txstatus
op_amp
l_int|0x0040
)paren
id|ep-&gt;stats.tx_window_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|txstatus
op_amp
l_int|0x0010
)paren
id|ep-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
macro_line|#ifdef ETHER_STATS
r_if
c_cond
(paren
id|txstatus
op_amp
l_int|0x1000
)paren
id|ep-&gt;stats.collisions16
op_increment
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef ETHER_STATS
r_if
c_cond
(paren
(paren
id|txstatus
op_amp
l_int|0x0002
)paren
op_ne
l_int|0
)paren
id|ep-&gt;stats.tx_deferred
op_increment
suffix:semicolon
macro_line|#endif
id|ep-&gt;stats.collisions
op_add_assign
(paren
id|txstatus
op_rshift
l_int|8
)paren
op_amp
l_int|15
suffix:semicolon
id|ep-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|ep-&gt;stats.tx_bytes
op_add_assign
id|ep-&gt;tx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|len
suffix:semicolon
)brace
multiline_comment|/* Free the original skb. */
id|dev_kfree_skb_irq
c_func
(paren
id|ep-&gt;tx_skbuff
(braket
id|entry
)braket
)paren
suffix:semicolon
id|ep-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|cur_tx
op_minus
id|dirty_tx
OG
id|TX_RING_SIZE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Out-of-sync dirty pointer, %d vs. %d, full=%d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dirty_tx
comma
id|cur_tx
comma
id|ep-&gt;tx_full
)paren
suffix:semicolon
id|dirty_tx
op_add_assign
id|TX_RING_SIZE
suffix:semicolon
)brace
macro_line|#endif
id|ep-&gt;dirty_tx
op_assign
id|dirty_tx
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;tx_full
op_logical_and
id|cur_tx
op_minus
id|dirty_tx
OL
id|TX_QUEUE_LEN
op_minus
l_int|4
)paren
(brace
multiline_comment|/* The ring is no longer full, clear tbusy. */
id|ep-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Check uncommon events all at once. */
r_if
c_cond
(paren
id|status
op_amp
(paren
id|CntFull
op_or
id|TxUnderrun
op_or
id|RxOverflow
op_or
id|RxFull
op_or
id|PCIBusErr170
op_or
id|PCIBusErr175
)paren
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
l_int|0xffffffff
)paren
multiline_comment|/* Chip failed or removed (CardBus). */
r_break
suffix:semicolon
multiline_comment|/* Always update the error counts to avoid overhead later. */
id|ep-&gt;stats.rx_missed_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|MPCNT
)paren
suffix:semicolon
id|ep-&gt;stats.rx_frame_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|ALICNT
)paren
suffix:semicolon
id|ep-&gt;stats.rx_crc_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CRCCNT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxUnderrun
)paren
(brace
multiline_comment|/* Tx FIFO underflow. */
id|ep-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
id|outl
c_func
(paren
id|ep-&gt;tx_threshold
op_add_assign
l_int|128
comma
id|ioaddr
op_plus
id|TxThresh
)paren
suffix:semicolon
multiline_comment|/* Restart the transmit process. */
id|outl
c_func
(paren
id|RestartTx
comma
id|ioaddr
op_plus
id|COMMAND
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|RxOverflow
)paren
(brace
multiline_comment|/* Missed a Rx frame. */
id|ep-&gt;stats.rx_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxOverflow
op_or
id|RxFull
)paren
)paren
id|outw
c_func
(paren
id|RxQueued
comma
id|ioaddr
op_plus
id|COMMAND
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PCIBusErr170
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: PCI Bus Error!  EPIC status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|epic_pause
c_func
(paren
id|dev
)paren
suffix:semicolon
id|epic_restart
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear all error sources. */
id|outl
c_func
(paren
id|status
op_amp
l_int|0x7f18
comma
id|ioaddr
op_plus
id|INTSTAT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|boguscnt
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Too much work at interrupt, &quot;
l_string|&quot;IntrStatus=0x%8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
multiline_comment|/* Clear all interrupt sources. */
id|outl
c_func
(paren
l_int|0x0001ffff
comma
id|ioaddr
op_plus
id|INTSTAT
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: exiting interrupt, intr_status=%#4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|ep-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|epic_rx
r_static
r_int
id|epic_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
op_assign
id|ep-&gt;cur_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_int
id|rx_work_limit
op_assign
id|ep-&gt;dirty_rx
op_plus
id|RX_RING_SIZE
op_minus
id|ep-&gt;cur_rx
suffix:semicolon
r_int
id|work_done
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; In epic_rx(), entry %d %8.8x.&bslash;n&quot;
comma
id|entry
comma
id|ep-&gt;rx_ring
(braket
id|entry
)braket
dot
id|rxstatus
)paren
suffix:semicolon
multiline_comment|/* If we own the next entry, it&squot;s a new packet. Send it up. */
r_while
c_loop
(paren
op_logical_neg
(paren
id|le32_to_cpu
c_func
(paren
id|ep-&gt;rx_ring
(braket
id|entry
)braket
dot
id|rxstatus
)paren
op_amp
id|DescOwn
)paren
)paren
(brace
r_int
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|ep-&gt;rx_ring
(braket
id|entry
)braket
dot
id|rxstatus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  epic_rx() status was %8.8x.&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|rx_work_limit
OL
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x2006
)paren
(brace
r_if
c_cond
(paren
id|debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: epic_rx() error status was %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x2000
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Oversized Ethernet frame spanned &quot;
l_string|&quot;multiple buffers, status %4.4x!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|ep-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
l_int|0x0006
)paren
multiline_comment|/* Rx Frame errors are counted in hardware. */
id|ep-&gt;stats.rx_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Malloc up new buffer, compatible with net-2e. */
multiline_comment|/* Omit the four octet CRC from the length. */
r_int
id|pkt_len
op_assign
(paren
id|status
op_rshift
l_int|16
)paren
op_minus
l_int|4
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|pkt_len
OG
id|PKT_BUF_SZ
op_minus
l_int|4
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Oversized Ethernet frame, status %x &quot;
l_string|&quot;%d bytes.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pkt_len
comma
id|status
)paren
suffix:semicolon
id|pkt_len
op_assign
l_int|1514
suffix:semicolon
)brace
multiline_comment|/* Check if the packet is long enough to accept without copying&n;&t;&t;&t;   to a minimally-sized skbuff. */
r_if
c_cond
(paren
id|pkt_len
OL
id|rx_copybreak
op_logical_and
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 byte align the IP header */
macro_line|#if 1 /* HAS_IP_COPYSUM */
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|ep-&gt;rx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|tail
comma
id|pkt_len
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#else
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|ep-&gt;rx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|tail
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|skb_put
c_func
(paren
id|skb
op_assign
id|ep-&gt;rx_skbuff
(braket
id|entry
)braket
comma
id|pkt_len
)paren
suffix:semicolon
id|ep-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|ep-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|ep-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
)brace
id|work_done
op_increment
suffix:semicolon
id|entry
op_assign
(paren
op_increment
id|ep-&gt;cur_rx
)paren
op_mod
id|RX_RING_SIZE
suffix:semicolon
)brace
multiline_comment|/* Refill the Rx ring buffers. */
r_for
c_loop
(paren
suffix:semicolon
id|ep-&gt;cur_rx
op_minus
id|ep-&gt;dirty_rx
OG
l_int|0
suffix:semicolon
id|ep-&gt;dirty_rx
op_increment
)paren
(brace
id|entry
op_assign
id|ep-&gt;dirty_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;rx_skbuff
(braket
id|entry
)braket
op_eq
l_int|NULL
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|ep-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
id|dev_alloc_skb
c_func
(paren
id|ep-&gt;rx_buf_sz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Align IP on 16 byte boundaries */
id|ep-&gt;rx_ring
(braket
id|entry
)braket
dot
id|bufaddr
op_assign
id|virt_to_le32desc
c_func
(paren
id|skb-&gt;tail
)paren
suffix:semicolon
id|work_done
op_increment
suffix:semicolon
)brace
id|ep-&gt;rx_ring
(braket
id|entry
)braket
dot
id|rxstatus
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
)brace
r_return
id|work_done
suffix:semicolon
)brace
DECL|function|epic_close
r_static
r_int
id|epic_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Shutting down ethercard, status was %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|INTSTAT
)paren
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|ep-&gt;timer
)paren
suffix:semicolon
id|epic_pause
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* Free all the skbuffs in the Rx queue. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|ep-&gt;rx_skbuff
(braket
id|i
)braket
suffix:semicolon
id|ep-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;rx_ring
(braket
id|i
)braket
dot
id|rxstatus
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Not owned by Epic chip. */
id|ep-&gt;rx_ring
(braket
id|i
)braket
dot
id|buflength
op_assign
l_int|0
suffix:semicolon
id|ep-&gt;rx_ring
(braket
id|i
)braket
dot
id|bufaddr
op_assign
l_int|0xBADF00D0
suffix:semicolon
multiline_comment|/* An invalid address. */
r_if
c_cond
(paren
id|skb
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ep-&gt;tx_skbuff
(braket
id|i
)braket
)paren
id|dev_kfree_skb
c_func
(paren
id|ep-&gt;tx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|ep-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Green! Leave the chip in low-power mode. */
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|epic_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|epic_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* Update the error counts. */
id|ep-&gt;stats.rx_missed_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|MPCNT
)paren
suffix:semicolon
id|ep-&gt;stats.rx_frame_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|ALICNT
)paren
suffix:semicolon
id|ep-&gt;stats.rx_crc_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|CRCCNT
)paren
suffix:semicolon
)brace
r_return
op_amp
id|ep-&gt;stats
suffix:semicolon
)brace
multiline_comment|/* Set or clear the multicast filter for this adaptor.&n;   Note that we only use exclusion around actually queueing the&n;   new frame, not around filling ep-&gt;setup_frame.  This is non-deterministic&n;   when re-entered but still correct. */
multiline_comment|/* The little-endian AUTODIN II ethernet CRC calculation.&n;   N.B. Do not use for bulk data, use a table-based routine instead.&n;   This is common code and should be moved to net/core/crc.c */
DECL|variable|ethernet_polynomial_le
r_static
r_int
r_const
id|ethernet_polynomial_le
op_assign
l_int|0xedb88320U
suffix:semicolon
DECL|function|ether_crc_le
r_static
r_inline
r_int
id|ether_crc_le
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
r_int
r_int
id|crc
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Initial value. */
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|8
suffix:semicolon
op_decrement
id|bit
op_ge
l_int|0
suffix:semicolon
id|current_octet
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|crc
op_xor
id|current_octet
)paren
op_amp
l_int|1
)paren
(brace
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
id|crc
op_xor_assign
id|ethernet_polynomial_le
suffix:semicolon
)brace
r_else
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|epic_private
op_star
id|ep
op_assign
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_char
id|mc_filter
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* Multicast hash filter */
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Set promiscuous. */
id|outl
c_func
(paren
l_int|0x002C
comma
id|ioaddr
op_plus
id|RxCtrl
)paren
suffix:semicolon
multiline_comment|/* Unconditionally log net taps. */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|memset
c_func
(paren
id|mc_filter
comma
l_int|0xff
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
l_int|0
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* There is apparently a chip bug, so the multicast filter&n;&t;&t;   is never enabled. */
multiline_comment|/* Too many to filter perfectly -- accept all multicasts. */
id|memset
c_func
(paren
id|mc_filter
comma
l_int|0xff
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x000C
comma
id|ioaddr
op_plus
id|RxCtrl
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
op_eq
l_int|0
)paren
(brace
id|outl
c_func
(paren
l_int|0x0004
comma
id|ioaddr
op_plus
id|RxCtrl
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Never executed, for now. */
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
id|memset
c_func
(paren
id|mc_filter
comma
l_int|0
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
id|set_bit
c_func
(paren
id|ether_crc_le
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_amp
l_int|0x3f
comma
id|mc_filter
)paren
suffix:semicolon
)brace
multiline_comment|/* ToDo: perhaps we need to stop the Tx and Rx process here? */
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|mc_filter
comma
id|ep-&gt;mc_filter
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|outw
c_func
(paren
(paren
(paren
id|u16
op_star
)paren
id|mc_filter
)paren
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|MC0
op_plus
id|i
op_star
l_int|4
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|ep-&gt;mc_filter
comma
id|mc_filter
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|mii_ioctl
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u16
op_star
id|data
op_assign
(paren
id|u16
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDEVPRIVATE
suffix:colon
multiline_comment|/* Get the address of the PHY in use. */
id|data
(braket
l_int|0
)braket
op_assign
(paren
(paren
r_struct
id|epic_private
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|phys
(braket
l_int|0
)braket
op_amp
l_int|0x1f
suffix:semicolon
multiline_comment|/* Fall Through */
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
multiline_comment|/* Read the specified MII register. */
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|outl
c_func
(paren
l_int|0x0200
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|NVCTL
)paren
op_amp
op_complement
l_int|0x003C
)paren
op_or
l_int|0x4800
comma
id|ioaddr
op_plus
id|NVCTL
)paren
suffix:semicolon
)brace
id|data
(braket
l_int|3
)braket
op_assign
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
macro_line|#ifdef notdef&t;&t;&t;&t;&t;/* Leave on if the ioctl() is used. */
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|NVCTL
)paren
op_amp
op_complement
l_int|0x483C
)paren
op_or
l_int|0x0000
comma
id|ioaddr
op_plus
id|NVCTL
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
multiline_comment|/* Write the specified MII register */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|outl
c_func
(paren
l_int|0x0200
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|NVCTL
)paren
op_amp
op_complement
l_int|0x003C
)paren
op_or
l_int|0x4800
comma
id|ioaddr
op_plus
id|NVCTL
)paren
suffix:semicolon
)brace
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
macro_line|#ifdef notdef&t;&t;&t;&t;&t;/* Leave on if the ioctl() is used. */
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|NVCTL
)paren
op_amp
op_complement
l_int|0x483C
)paren
op_or
l_int|0x0000
comma
id|ioaddr
op_plus
id|NVCTL
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
DECL|function|epic_remove_one
r_static
r_void
id|__devexit
id|epic_remove_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifndef USE_IO_OPS
id|iounmap
(paren
(paren
r_void
op_star
)paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
macro_line|#endif
id|release_mem_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|1
)paren
)paren
suffix:semicolon
id|release_region
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|epic_suspend
r_static
r_void
id|epic_suspend
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|epic_pause
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Put the chip into low-power mode. */
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|GENCTL
)paren
suffix:semicolon
)brace
DECL|function|epic_resume
r_static
r_void
id|epic_resume
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
id|epic_restart
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|epic_driver
r_static
r_struct
id|pci_driver
id|epic_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;epic100&quot;
comma
id|id_table
suffix:colon
id|epic_pci_tbl
comma
id|probe
suffix:colon
id|epic_init_one
comma
id|remove
suffix:colon
id|epic_remove_one
comma
id|suspend
suffix:colon
id|epic_suspend
comma
id|resume
suffix:colon
id|epic_resume
comma
)brace
suffix:semicolon
DECL|function|epic_init
r_static
r_int
id|__init
id|epic_init
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
(paren
op_amp
id|epic_driver
)paren
suffix:semicolon
)brace
DECL|function|epic_cleanup
r_static
r_void
id|__exit
id|epic_cleanup
(paren
r_void
)paren
(brace
id|pci_unregister_driver
(paren
op_amp
id|epic_driver
)paren
suffix:semicolon
)brace
DECL|variable|epic_init
id|module_init
c_func
(paren
id|epic_init
)paren
suffix:semicolon
DECL|variable|epic_cleanup
id|module_exit
c_func
(paren
id|epic_cleanup
)paren
suffix:semicolon
eof
