multiline_comment|/*&n; * hp100.c: Hewlett Packard HP10/100VG ANY LAN ethernet driver for Linux.&n; *&n; * Author:  Jaroslav Kysela, &lt;perex@pf.jcu.cz&gt;&n; *&n; * Supports only the following Hewlett Packard cards:&n; *&n; *  &t;HP J2577&t;10/100 EISA card with REVA Cascade chip&n; *&t;HP J2573&t;10/100 ISA card with REVA Cascade chip&n; *&t;HP 27248B&t;10 only EISA card with Cascade chip&n; *&t;HP J2577&t;10/100 EISA card with Cascade chip&n; *&t;HP J2573&t;10/100 ISA card with Cascade chip&n; *&t;HP J2585&t;10/100 PCI card&n; *&n; * Other ATT2MD01 Chip based boards might be supported in the future&n; * (there are some minor changes needed).&n; *&n; * This driver is based on the &squot;hpfepkt&squot; crynwr packet driver.&n; *&n; * This source/code is public free; you can distribute it and/or modify &n; * it under terms of the GNU General Public License (published by the&n; * Free Software Foundation) either version two of this License, or any &n; * later version.&n; * ----------------------------------------------------------------------------&n; *&n; * Note: Some routines (interrupt handling, transmit) assumes that  &n; *       there is the PERFORMANCE page selected...&n; *&n; * ----------------------------------------------------------------------------&n; *&n; * If you are going to use the module version of this driver, you may&n; * change this values at the &quot;insert time&quot; :&n; *&n; *   Variable                   Description&n; *&n; *   hp100_rx_ratio&t;&t;Range 1-99 - onboard memory used for RX&n; *                              packets in %.&n; *   hp100_priority_tx&t;&t;If this variable is nonzero - all outgoing&n; *                              packets will be transmitted as priority.&n; *   hp100_port&t;&t;&t;Adapter port (for example 0x380).&n; *&n; * ----------------------------------------------------------------------------&n; * MY BEST REGARDS GOING TO:&n; *&n; * IPEX s.r.o which lend me two HP J2573 cards and&n; * the HP AdvanceStack 100VG Hub-15 for debugging.&n; *&n; * Russel Nellson &lt;nelson@crynwr.com&gt; for help with obtaining sources&n; * of the &squot;hpfepkt&squot; packet driver.&n; *&n; * Also thanks to Abacus Electric s.r.o which let me to use their &n; * motherboard for my second computer.&n; *&n; * ----------------------------------------------------------------------------&n; *&n; * TO DO:&n; * ======&n; *       - ioctl handling - some runtime setup things&n; *       - 100Mb/s Voice Grade AnyLAN network adapter/hub services support&n; *&t;&t;- 802.5 frames&n; *&t;&t;- promiscuous mode&n; *&t;&t;- bridge mode&n; *&t;&t;- cascaded repeater mode&n; *&t;&t;- 100Mbit MAC&n; *&n; * Revision history:&n; * =================&n; * &n; *    Version   Date&t;    Description&n; *&n; *&t;0.1&t;14-May-95   Initial writing. ALPHA code was released.&n; *                          Only HP J2573 on 10Mb/s (two machines) tested.&n; *      0.11    14-Jun-95   Reset interface bug fixed?&n; *&t;&t;&t;    Little bug in hp100_close function fixed.&n; *                          100Mb/s connection debugged.&n; *      0.12    14-Jul-95   Link down is now handled better.&n; *      0.20    01-Aug-95   Added PCI support for HP J2585A card.&n; *                          Statistics bug fixed.&n; *      0.21    04-Aug-95   Memory mapped access support for PCI card.&n; *                          Added priority transmit support for 100Mb/s&n; *                          Voice Grade AnyLAN network.&n; *&n; */
macro_line|#ifdef MODULE
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#endif /* MODULE */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/bios32.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &quot;hp100.h&quot;
multiline_comment|/*&n; *  defines&n; */
DECL|macro|HP100_BUS_ISA
mdefine_line|#define HP100_BUS_ISA&t;&t;0
DECL|macro|HP100_BUS_EISA
mdefine_line|#define HP100_BUS_EISA&t;&t;1
DECL|macro|HP100_BUS_PCI
mdefine_line|#define HP100_BUS_PCI&t;&t;2
DECL|macro|HP100_REGION_SIZE
mdefine_line|#define HP100_REGION_SIZE&t;0x20
DECL|macro|HP100_MAX_PACKET_SIZE
mdefine_line|#define HP100_MAX_PACKET_SIZE&t;(1536+4)
DECL|macro|HP100_MIN_PACKET_SIZE
mdefine_line|#define HP100_MIN_PACKET_SIZE&t;60
macro_line|#ifndef HP100_DEFAULT_RX_RATIO
multiline_comment|/* default - 65% onboard memory on the card are used for RX packets */
DECL|macro|HP100_DEFAULT_RX_RATIO
mdefine_line|#define HP100_DEFAULT_RX_RATIO&t;65
macro_line|#endif
macro_line|#ifndef HP100_DEFAULT_PRIORITY_TX
multiline_comment|/* default - don&squot;t enable transmit outgoing packets as priority */
DECL|macro|HP100_DEFAULT_PRIORITY_TX
mdefine_line|#define HP100_DEFAULT_PRIORITY_TX 0
macro_line|#endif
multiline_comment|/*&n; *  structures&n; */
DECL|struct|hp100_eisa_id
r_struct
id|hp100_eisa_id
(brace
DECL|member|id
id|u_int
id|id
suffix:semicolon
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|bus
id|u_char
id|bus
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|hp100_private
r_struct
id|hp100_private
(brace
DECL|member|id
r_struct
id|hp100_eisa_id
op_star
id|id
suffix:semicolon
DECL|member|soft_model
id|u_short
id|soft_model
suffix:semicolon
DECL|member|memory_size
id|u_int
id|memory_size
suffix:semicolon
DECL|member|rx_ratio
id|u_short
id|rx_ratio
suffix:semicolon
multiline_comment|/* 1 - 99 */
DECL|member|priority_tx
id|u_short
id|priority_tx
suffix:semicolon
multiline_comment|/* != 0 - priority tx */
DECL|member|mem_mapped
r_int
id|mem_mapped
suffix:semicolon
multiline_comment|/* memory mapped access */
DECL|member|mem_ptr_virt
id|u_char
op_star
id|mem_ptr_virt
suffix:semicolon
multiline_comment|/* virtual memory mapped area, maybe NULL */
DECL|member|mem_ptr_phys
id|u_char
op_star
id|mem_ptr_phys
suffix:semicolon
multiline_comment|/* physical memory mapped area */
DECL|member|lan_type
r_int
id|lan_type
suffix:semicolon
multiline_comment|/* 10Mb/s, 100Mb/s or -1 (error) */
DECL|member|hub_status
r_int
id|hub_status
suffix:semicolon
multiline_comment|/* login to hub was successfull? */
DECL|member|mac1_mode
id|u_char
id|mac1_mode
suffix:semicolon
DECL|member|mac2_mode
id|u_char
id|mac2_mode
suffix:semicolon
DECL|member|stats
r_struct
id|enet_statistics
id|stats
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; *  variables&n; */
DECL|variable|hp100_eisa_ids
r_static
r_struct
id|hp100_eisa_id
id|hp100_eisa_ids
(braket
)braket
op_assign
(brace
multiline_comment|/* 10/100 EISA card with REVA Cascade chip */
(brace
l_int|0x080F1F022
comma
l_string|&quot;HP J2577 rev A&quot;
comma
id|HP100_BUS_EISA
)brace
comma
multiline_comment|/* 10/100 ISA card with REVA Cascade chip */
(brace
l_int|0x050F1F022
comma
l_string|&quot;HP J2573 rev A&quot;
comma
id|HP100_BUS_ISA
)brace
comma
multiline_comment|/* 10 only EISA card with Cascade chip */
(brace
l_int|0x02019F022
comma
l_string|&quot;HP 27248B&quot;
comma
id|HP100_BUS_EISA
)brace
comma
multiline_comment|/* 10/100 EISA card with Cascade chip */
(brace
l_int|0x04019F022
comma
l_string|&quot;HP J2577&quot;
comma
id|HP100_BUS_EISA
)brace
comma
multiline_comment|/* 10/100 ISA card with Cascade chip */
(brace
l_int|0x05019F022
comma
l_string|&quot;HP J2573&quot;
comma
id|HP100_BUS_ISA
)brace
comma
multiline_comment|/* 10/100 PCI card */
multiline_comment|/* Note: ID for this card is same as PCI vendor/device numbers. */
(brace
l_int|0x01030103c
comma
l_string|&quot;HP J2585&quot;
comma
id|HP100_BUS_PCI
)brace
comma
)brace
suffix:semicolon
DECL|variable|hp100_rx_ratio
r_int
id|hp100_rx_ratio
op_assign
id|HP100_DEFAULT_RX_RATIO
suffix:semicolon
DECL|variable|hp100_priority_tx
r_int
id|hp100_priority_tx
op_assign
id|HP100_DEFAULT_PRIORITY_TX
suffix:semicolon
multiline_comment|/*&n; *  prototypes&n; */
r_static
r_int
id|hp100_probe1
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|ioaddr
comma
r_int
id|bus
)paren
suffix:semicolon
r_static
r_int
id|hp100_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|hp100_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|hp100_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|hp100_rx
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|enet_statistics
op_star
id|hp100_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|hp100_update_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|hp100_clear_stats
c_func
(paren
r_int
id|ioaddr
)paren
suffix:semicolon
macro_line|#ifdef HAVE_MULTICAST
r_static
r_void
id|hp100_set_multicast_list
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|num_addrs
comma
r_void
op_star
id|addrs
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|hp100_interrupt
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|hp100_start_interface
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|hp100_stop_interface
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|hp100_load_eeprom
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|hp100_sense_lan
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|hp100_login_to_vg_hub
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|hp100_down_vg_link
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/*&n; *  probe functions&n; */
DECL|function|hp100_probe
r_int
id|hp100_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|base_addr
op_assign
id|dev
ques
c_cond
id|dev
op_member_access_from_pointer
id|base_addr
suffix:colon
l_int|0
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_int
id|pci_start_index
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|base_addr
OG
l_int|0xff
)paren
multiline_comment|/* Check a single specified location. */
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|base_addr
comma
id|HP100_REGION_SIZE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|base_addr
OL
l_int|0x400
)paren
r_return
id|hp100_probe1
c_func
(paren
id|dev
comma
id|base_addr
comma
id|HP100_BUS_ISA
)paren
suffix:semicolon
r_else
r_return
id|hp100_probe1
c_func
(paren
id|dev
comma
id|base_addr
comma
id|HP100_BUS_EISA
)paren
suffix:semicolon
)brace
r_else
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|base_addr
OG
l_int|0
op_logical_and
id|base_addr
OL
l_int|8
op_plus
l_int|1
)paren
id|pci_start_index
op_assign
l_int|0x100
op_or
(paren
id|base_addr
op_minus
l_int|1
)paren
suffix:semicolon
r_else
macro_line|#endif
r_if
c_cond
(paren
id|base_addr
op_ne
l_int|0
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
multiline_comment|/* at first - scan PCI bus(es) */
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|pcibios_present
c_func
(paren
)paren
)paren
(brace
r_int
id|pci_index
suffix:semicolon
macro_line|#ifdef HP100_DEBUG_PCI
id|printk
c_func
(paren
l_string|&quot;hp100: PCI BIOS is present, checking for devices..&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|pci_index
op_assign
id|pci_start_index
op_amp
l_int|7
suffix:semicolon
id|pci_index
OL
l_int|8
suffix:semicolon
id|pci_index
op_increment
)paren
(brace
id|u_char
id|pci_bus
comma
id|pci_device_fn
suffix:semicolon
id|u_short
id|pci_command
suffix:semicolon
r_if
c_cond
(paren
id|pcibios_find_device
c_func
(paren
id|PCI_VENDOR_ID_HP
comma
id|PCI_DEVICE_ID_HP_J2585A
comma
id|pci_index
comma
op_amp
id|pci_bus
comma
op_amp
id|pci_device_fn
)paren
op_ne
l_int|0
)paren
r_break
suffix:semicolon
id|pcibios_read_config_dword
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_BASE_ADDRESS_0
comma
op_amp
id|ioaddr
)paren
suffix:semicolon
id|ioaddr
op_and_assign
op_complement
l_int|3
suffix:semicolon
multiline_comment|/* remove I/O space marker in bit 0. */
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|ioaddr
comma
id|HP100_REGION_SIZE
)paren
)paren
r_continue
suffix:semicolon
id|pcibios_read_config_word
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_COMMAND
comma
op_amp
id|pci_command
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pci_command
op_amp
id|PCI_COMMAND_MASTER
)paren
)paren
(brace
macro_line|#ifdef HP100_DEBUG_PCI
id|printk
c_func
(paren
l_string|&quot;hp100: PCI Master Bit has not been set. Setting...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|pci_command
op_or_assign
id|PCI_COMMAND_MASTER
suffix:semicolon
id|pcibios_write_config_word
c_func
(paren
id|pci_bus
comma
id|pci_device_fn
comma
id|PCI_COMMAND
comma
id|pci_command
)paren
suffix:semicolon
)brace
macro_line|#ifdef HP100_DEBUG_PCI
id|printk
c_func
(paren
l_string|&quot;hp100: PCI adapter found at 0x%x&bslash;n&quot;
comma
id|ioaddr
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|hp100_probe1
c_func
(paren
id|dev
comma
id|ioaddr
comma
id|HP100_BUS_PCI
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pci_start_index
OG
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
macro_line|#endif /* CONFIG_PCI */
multiline_comment|/* at second - probe all EISA possible port regions (if EISA bus present) */
r_for
c_loop
(paren
id|ioaddr
op_assign
l_int|0x1c38
suffix:semicolon
id|EISA_bus
op_logical_and
id|ioaddr
OL
l_int|0x10000
suffix:semicolon
id|ioaddr
op_add_assign
l_int|0x400
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|ioaddr
comma
id|HP100_REGION_SIZE
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|hp100_probe1
c_func
(paren
id|dev
comma
id|ioaddr
comma
id|HP100_BUS_EISA
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* at third - probe all ISA possible port regions */
r_for
c_loop
(paren
id|ioaddr
op_assign
l_int|0x100
suffix:semicolon
id|ioaddr
OL
l_int|0x400
suffix:semicolon
id|ioaddr
op_add_assign
l_int|0x20
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|ioaddr
comma
id|HP100_REGION_SIZE
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|hp100_probe1
c_func
(paren
id|dev
comma
id|ioaddr
comma
id|HP100_BUS_ISA
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|hp100_probe1
r_static
r_int
id|hp100_probe1
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|ioaddr
comma
r_int
id|bus
)paren
(brace
r_int
id|i
suffix:semicolon
id|u_char
id|uc
comma
id|uc_1
suffix:semicolon
id|u_int
id|eisa_id
suffix:semicolon
r_int
id|mem_mapped
suffix:semicolon
id|u_char
op_star
id|mem_ptr_phys
comma
op_star
id|mem_ptr_virt
suffix:semicolon
r_struct
id|hp100_private
op_star
id|lp
suffix:semicolon
r_struct
id|hp100_eisa_id
op_star
id|eid
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
macro_line|#ifdef HP100_DEBUG
id|printk
c_func
(paren
l_string|&quot;hp100_probe1: dev == NULL ?&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bus
op_ne
id|HP100_BUS_PCI
)paren
multiline_comment|/* don&squot;t check PCI cards again */
r_if
c_cond
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0
)paren
op_ne
id|HP100_HW_ID_0
op_logical_or
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|1
)paren
op_ne
id|HP100_HW_ID_1
op_logical_or
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|2
)paren
op_amp
l_int|0xf0
)paren
op_ne
id|HP100_HW_ID_2_REVA
op_logical_or
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|3
)paren
op_ne
id|HP100_HW_ID_3
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dev
op_member_access_from_pointer
id|base_addr
op_assign
id|ioaddr
suffix:semicolon
macro_line|#ifdef HP100_DEBUG_PROBE1
id|printk
c_func
(paren
l_string|&quot;hp100_probe1: card found at port 0x%x&bslash;n&quot;
comma
id|ioaddr
)paren
suffix:semicolon
macro_line|#endif
id|hp100_page
c_func
(paren
id|ID_MAC_ADDR
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|uc
op_assign
id|eisa_id
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|eisa_id
op_rshift_assign
l_int|8
suffix:semicolon
id|uc_1
op_assign
id|hp100_inb
c_func
(paren
id|BOARD_ID
op_plus
id|i
)paren
suffix:semicolon
id|eisa_id
op_or_assign
id|uc_1
op_lshift
l_int|24
suffix:semicolon
id|uc
op_add_assign
id|uc_1
suffix:semicolon
)brace
id|uc
op_add_assign
id|hp100_inb
c_func
(paren
id|BOARD_ID
op_plus
l_int|4
)paren
suffix:semicolon
macro_line|#ifdef HP100_DEBUG_PROBE1
id|printk
c_func
(paren
l_string|&quot;hp100_probe1: EISA ID = 0x%08x  checksum = 0x%02x&bslash;n&quot;
comma
id|eisa_id
comma
id|uc
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|uc
op_ne
l_int|0xff
)paren
multiline_comment|/* bad checksum? */
(brace
id|printk
c_func
(paren
l_string|&quot;hp100_probe: bad EISA ID checksum at base port 0x%x&bslash;n&quot;
comma
id|ioaddr
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|hp100_eisa_ids
)paren
op_div
r_sizeof
(paren
r_struct
id|hp100_eisa_id
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|hp100_eisa_ids
(braket
id|i
)braket
dot
id|id
op_amp
l_int|0xf0ffffff
)paren
op_eq
(paren
id|eisa_id
op_amp
l_int|0xf0ffffff
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
r_sizeof
(paren
id|hp100_eisa_ids
)paren
op_div
r_sizeof
(paren
r_struct
id|hp100_eisa_id
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;hp100_probe1: card at port 0x%x isn&squot;t known (id = 0x%x)&bslash;n&quot;
comma
id|ioaddr
comma
id|eisa_id
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|eid
op_assign
op_amp
id|hp100_eisa_ids
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|eid
op_member_access_from_pointer
id|id
op_amp
l_int|0x0f000000
)paren
OL
(paren
id|eisa_id
op_amp
l_int|0x0f000000
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;hp100_probe1: newer version of card %s at port 0x%x - unsupported&bslash;n&quot;
comma
id|eid
op_member_access_from_pointer
id|name
comma
id|ioaddr
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|uc
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|7
suffix:semicolon
id|i
op_increment
)paren
id|uc
op_add_assign
id|hp100_inb
c_func
(paren
id|LAN_ADDR
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uc
op_ne
l_int|0xff
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;hp100_probe1: bad lan address checksum (card %s at port 0x%x)&bslash;n&quot;
comma
id|eid
op_member_access_from_pointer
id|name
comma
id|ioaddr
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#ifndef HP100_IO_MAPPED
id|hp100_page
c_func
(paren
id|HW_MAP
)paren
suffix:semicolon
id|mem_mapped
op_assign
(paren
id|hp100_inw
c_func
(paren
id|OPTION_LSW
)paren
op_amp
(paren
id|HP100_MEM_EN
op_or
id|HP100_BM_WRITE
op_or
id|HP100_BM_READ
)paren
)paren
op_ne
l_int|0
suffix:semicolon
id|mem_ptr_phys
op_assign
id|mem_ptr_virt
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|mem_mapped
)paren
(brace
id|mem_ptr_phys
op_assign
(paren
id|u_char
op_star
)paren
(paren
id|hp100_inw
c_func
(paren
id|MEM_MAP_LSW
)paren
op_or
(paren
id|hp100_inw
c_func
(paren
id|MEM_MAP_MSW
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
(paren
id|u_int
)paren
id|mem_ptr_phys
op_and_assign
op_complement
l_int|0x1fff
suffix:semicolon
multiline_comment|/* 8k aligment */
r_if
c_cond
(paren
id|bus
op_eq
id|HP100_BUS_ISA
op_logical_and
(paren
(paren
id|u_long
)paren
id|mem_ptr_phys
op_amp
op_complement
l_int|0xfffff
)paren
op_ne
l_int|0
)paren
(brace
id|mem_ptr_phys
op_assign
l_int|NULL
suffix:semicolon
id|mem_mapped
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mem_mapped
op_logical_and
id|bus
op_eq
id|HP100_BUS_PCI
)paren
(brace
r_if
c_cond
(paren
(paren
id|mem_ptr_virt
op_assign
id|vremap
c_func
(paren
(paren
id|u_long
)paren
id|mem_ptr_phys
comma
l_int|0x2000
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;hp100: vremap for high PCI memory at 0x%lx failed&bslash;n&quot;
comma
(paren
id|u_long
)paren
id|mem_ptr_phys
)paren
suffix:semicolon
id|mem_ptr_phys
op_assign
l_int|NULL
suffix:semicolon
id|mem_mapped
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
macro_line|#else
id|mem_mapped
op_assign
l_int|0
suffix:semicolon
id|mem_ptr_phys
op_assign
id|mem_ptr_virt
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|dev
op_member_access_from_pointer
id|priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|hp100_private
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|dev
op_member_access_from_pointer
id|priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hp100_private
)paren
)paren
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
suffix:semicolon
id|lp
op_member_access_from_pointer
id|id
op_assign
id|eid
suffix:semicolon
id|lp
op_member_access_from_pointer
id|mem_mapped
op_assign
id|mem_mapped
suffix:semicolon
id|lp
op_member_access_from_pointer
id|mem_ptr_phys
op_assign
id|mem_ptr_phys
suffix:semicolon
id|lp
op_member_access_from_pointer
id|mem_ptr_virt
op_assign
id|mem_ptr_virt
suffix:semicolon
id|hp100_page
c_func
(paren
id|ID_MAC_ADDR
)paren
suffix:semicolon
id|lp
op_member_access_from_pointer
id|soft_model
op_assign
id|hp100_inb
c_func
(paren
id|SOFT_MODEL
)paren
suffix:semicolon
id|lp
op_member_access_from_pointer
id|mac1_mode
op_assign
id|HP100_MAC1MODE3
suffix:semicolon
id|lp
op_member_access_from_pointer
id|mac2_mode
op_assign
id|HP100_MAC2MODE3
suffix:semicolon
id|dev
op_member_access_from_pointer
id|base_addr
op_assign
id|ioaddr
suffix:semicolon
id|hp100_page
c_func
(paren
id|HW_MAP
)paren
suffix:semicolon
id|dev
op_member_access_from_pointer
id|irq
op_assign
id|hp100_inb
c_func
(paren
id|IRQ_CHANNEL
)paren
op_amp
id|HP100_IRQ_MASK
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_member_access_from_pointer
id|irq
op_eq
l_int|2
)paren
id|dev
op_member_access_from_pointer
id|irq
op_assign
l_int|9
suffix:semicolon
id|lp
op_member_access_from_pointer
id|memory_size
op_assign
l_int|0x200
op_lshift
(paren
(paren
id|hp100_inb
c_func
(paren
id|SRAM
)paren
op_amp
l_int|0xe0
)paren
op_rshift
l_int|5
)paren
suffix:semicolon
id|lp
op_member_access_from_pointer
id|rx_ratio
op_assign
id|hp100_rx_ratio
suffix:semicolon
id|dev
op_member_access_from_pointer
id|open
op_assign
id|hp100_open
suffix:semicolon
id|dev
op_member_access_from_pointer
id|stop
op_assign
id|hp100_close
suffix:semicolon
id|dev
op_member_access_from_pointer
id|hard_start_xmit
op_assign
id|hp100_start_xmit
suffix:semicolon
id|dev
op_member_access_from_pointer
id|get_stats
op_assign
id|hp100_get_stats
suffix:semicolon
macro_line|#ifdef HAVE_MULTICAST
id|dev
op_member_access_from_pointer
id|set_multicast_list
op_assign
op_amp
id|hp100_set_multicast_list
suffix:semicolon
macro_line|#endif
id|request_region
c_func
(paren
id|dev
op_member_access_from_pointer
id|base_addr
comma
id|HP100_REGION_SIZE
comma
id|eid
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|ID_MAC_ADDR
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|uc
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|dev
op_member_access_from_pointer
id|dev_addr
(braket
id|i
)braket
op_assign
id|hp100_inb
c_func
(paren
id|LAN_ADDR
op_plus
id|i
)paren
suffix:semicolon
id|hp100_clear_stats
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp
op_member_access_from_pointer
id|lan_type
op_assign
id|hp100_sense_lan
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %s at 0x%x, IRQ %d, &quot;
comma
id|dev
op_member_access_from_pointer
id|name
comma
id|lp
op_member_access_from_pointer
id|id
op_member_access_from_pointer
id|name
comma
id|ioaddr
comma
id|dev
op_member_access_from_pointer
id|irq
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|bus
)paren
(brace
r_case
id|HP100_BUS_EISA
suffix:colon
id|printk
c_func
(paren
l_string|&quot;EISA&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HP100_BUS_PCI
suffix:colon
id|printk
c_func
(paren
l_string|&quot;PCI&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ISA&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot; bus, %dk SRAM (rx/tx %d%%).&bslash;n&quot;
comma
id|lp
op_member_access_from_pointer
id|memory_size
op_rshift
(paren
l_int|10
op_minus
l_int|4
)paren
comma
id|lp
op_member_access_from_pointer
id|rx_ratio
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem_mapped
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Memory area at 0x%lx-0x%lx&quot;
comma
id|dev
op_member_access_from_pointer
id|name
comma
(paren
id|u_long
)paren
id|mem_ptr_phys
comma
(paren
id|u_long
)paren
id|mem_ptr_phys
op_plus
l_int|0x1fff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem_ptr_virt
)paren
id|printk
c_func
(paren
l_string|&quot; (virtual base 0x%lx)&quot;
comma
(paren
id|u_long
)paren
id|mem_ptr_virt
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: &quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|lan_type
op_ne
id|HP100_LAN_ERR
)paren
id|printk
c_func
(paren
l_string|&quot;Adapter is attached to &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|lp
op_member_access_from_pointer
id|lan_type
)paren
(brace
r_case
id|HP100_LAN_100
suffix:colon
id|printk
c_func
(paren
l_string|&quot;100Mb/s Voice Grade AnyLAN network.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HP100_LAN_10
suffix:colon
id|printk
c_func
(paren
l_string|&quot;10Mb/s network.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Warning! Link down.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|hp100_stop_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  open/close functions&n; */
DECL|function|hp100_open
r_static
r_int
id|hp100_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
r_struct
id|hp100_private
op_star
id|lp
op_assign
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev
op_member_access_from_pointer
id|irq
comma
id|hp100_interrupt
comma
id|SA_INTERRUPT
comma
id|lp
op_member_access_from_pointer
id|id
op_member_access_from_pointer
id|name
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: unable to get IRQ %d&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
comma
id|dev
op_member_access_from_pointer
id|irq
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|irq2dev_map
(braket
id|dev
op_member_access_from_pointer
id|irq
)braket
op_assign
id|dev
suffix:semicolon
macro_line|#ifdef MODULE
id|MOD_INC_USE_COUNT
suffix:semicolon
macro_line|#endif
id|dev
op_member_access_from_pointer
id|tbusy
op_assign
l_int|0
suffix:semicolon
id|dev
op_member_access_from_pointer
id|trans_start
op_assign
id|jiffies
suffix:semicolon
id|dev
op_member_access_from_pointer
id|interrupt
op_assign
l_int|0
suffix:semicolon
id|dev
op_member_access_from_pointer
id|start
op_assign
l_int|1
suffix:semicolon
id|lp
op_member_access_from_pointer
id|lan_type
op_assign
id|hp100_sense_lan
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp
op_member_access_from_pointer
id|mac1_mode
op_assign
id|HP100_MAC1MODE3
suffix:semicolon
id|lp
op_member_access_from_pointer
id|mac2_mode
op_assign
id|HP100_MAC2MODE3
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_CTRL
)paren
suffix:semicolon
id|hp100_orw
c_func
(paren
id|HP100_LINK_BEAT_DIS
op_or
id|HP100_RESET_LB
comma
id|LAN_CFG_10
)paren
suffix:semicolon
id|hp100_stop_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_load_eeprom
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
id|HP100_MMAP_DIS
op_or
id|HP100_SET_HB
op_or
id|HP100_IO_EN
op_or
id|HP100_SET_LB
comma
id|OPTION_LSW
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
id|HP100_DEBUG_EN
op_or
id|HP100_RX_HDR
op_or
id|HP100_EE_EN
op_or
id|HP100_RESET_HB
op_or
id|HP100_FAKE_INT
op_or
id|HP100_RESET_LB
comma
id|OPTION_LSW
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
id|HP100_ADV_NXT_PKT
op_or
id|HP100_TX_CMD
op_or
id|HP100_RESET_LB
op_or
id|HP100_PRIORITY_TX
op_or
(paren
id|hp100_priority_tx
ques
c_cond
id|HP100_SET_HB
suffix:colon
id|HP100_RESET_HB
)paren
comma
id|OPTION_MSW
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_ADDRESS
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|hp100_outb
c_func
(paren
id|dev
op_member_access_from_pointer
id|dev_addr
(braket
id|i
)braket
comma
id|MAC_ADDR
op_plus
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* setup multicast filter to receive all */
id|hp100_outb
c_func
(paren
l_int|0xff
comma
id|HASH_BYTE0
op_plus
id|i
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|PERFORMANCE
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
l_int|0xfefe
comma
id|IRQ_MASK
)paren
suffix:semicolon
multiline_comment|/* mask off all ints */
id|hp100_outw
c_func
(paren
l_int|0xffff
comma
id|IRQ_STATUS
)paren
suffix:semicolon
multiline_comment|/* ack IRQ */
id|hp100_outw
c_func
(paren
(paren
id|HP100_RX_PACKET
op_or
id|HP100_RX_ERROR
op_or
id|HP100_SET_HB
)paren
op_or
(paren
id|HP100_TX_ERROR
op_or
id|HP100_SET_LB
)paren
comma
id|IRQ_MASK
)paren
suffix:semicolon
multiline_comment|/* and enable few */
id|hp100_reset_card
c_func
(paren
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|MMU_CFG
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
(paren
id|lp
op_member_access_from_pointer
id|memory_size
op_star
id|lp
op_member_access_from_pointer
id|rx_ratio
)paren
op_div
l_int|100
comma
id|RX_MEM_STOP
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
id|lp
op_member_access_from_pointer
id|memory_size
op_minus
l_int|1
comma
id|TX_MEM_STOP
)paren
suffix:semicolon
id|hp100_unreset_card
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|lan_type
op_eq
id|HP100_LAN_100
)paren
id|lp
op_member_access_from_pointer
id|hub_status
op_assign
id|hp100_login_to_vg_hub
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_start_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hp100_close
r_static
r_int
id|hp100_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
r_struct
id|hp100_private
op_star
id|lp
op_assign
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
suffix:semicolon
id|hp100_page
c_func
(paren
id|PERFORMANCE
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
l_int|0xfefe
comma
id|IRQ_MASK
)paren
suffix:semicolon
multiline_comment|/* mask off all IRQs */
id|hp100_stop_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|lan_type
op_eq
id|HP100_LAN_100
)paren
multiline_comment|/* relogin */
id|hp100_login_to_vg_hub
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev
op_member_access_from_pointer
id|tbusy
op_assign
l_int|1
suffix:semicolon
id|dev
op_member_access_from_pointer
id|start
op_assign
l_int|0
suffix:semicolon
id|free_irq
c_func
(paren
id|dev
op_member_access_from_pointer
id|irq
)paren
suffix:semicolon
id|irq2dev_map
(braket
id|dev
op_member_access_from_pointer
id|irq
)braket
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef MODULE
id|MOD_DEC_USE_COUNT
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; *  transmit&n; */
DECL|function|hp100_start_xmit
r_static
r_int
id|hp100_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
comma
id|ok_flag
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
id|u_short
id|val
suffix:semicolon
r_struct
id|hp100_private
op_star
id|lp
op_assign
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|lan_type
OL
l_int|0
)paren
(brace
id|hp100_stop_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lp
op_member_access_from_pointer
id|lan_type
op_assign
id|hp100_sense_lan
c_func
(paren
id|dev
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: no connection found - check wire&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|hp100_start_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* 10Mb/s RX packets maybe handled */
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|lan_type
op_eq
id|HP100_LAN_100
)paren
id|lp
op_member_access_from_pointer
id|hub_status
op_assign
id|hp100_login_to_vg_hub
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_start_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|i
op_assign
(paren
id|hp100_inl
c_func
(paren
id|TX_MEM_FREE
)paren
op_amp
op_complement
l_int|0x7fffffff
)paren
)paren
OL
id|skb
op_member_access_from_pointer
id|len
op_plus
l_int|16
)paren
(brace
macro_line|#ifdef HP100_DEBUG
id|printk
c_func
(paren
l_string|&quot;hp100_start_xmit: rx free mem = 0x%x&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|jiffies
op_minus
id|dev
op_member_access_from_pointer
id|trans_start
OL
l_int|2
op_star
id|HZ
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|lan_type
op_eq
id|HP100_LAN_100
op_logical_and
id|lp
op_member_access_from_pointer
id|hub_status
OL
l_int|0
)paren
multiline_comment|/* 100Mb/s adapter isn&squot;t connected to hub */
(brace
id|printk
c_func
(paren
l_string|&quot;%s: login to 100Mb/s hub retry&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|hp100_stop_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp
op_member_access_from_pointer
id|hub_status
op_assign
id|hp100_login_to_vg_hub
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_start_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|hp100_ints_off
c_func
(paren
)paren
suffix:semicolon
id|i
op_assign
id|hp100_sense_lan
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|PERFORMANCE
)paren
suffix:semicolon
id|hp100_ints_on
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|HP100_LAN_ERR
)paren
id|printk
c_func
(paren
l_string|&quot;%s: link down detected&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|lan_type
op_ne
id|i
)paren
(brace
multiline_comment|/* it&squot;s very heavy - all network setting must be changed!!! */
id|printk
c_func
(paren
l_string|&quot;%s: cable change 10Mb/s &lt;-&gt; 100Mb/s detected&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|lp
op_member_access_from_pointer
id|lan_type
op_assign
id|i
suffix:semicolon
id|hp100_stop_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|lan_type
op_eq
id|HP100_LAN_100
)paren
id|lp
op_member_access_from_pointer
id|hub_status
op_assign
id|hp100_login_to_vg_hub
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_start_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: interface reset&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|hp100_stop_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_start_interface
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
id|dev
op_member_access_from_pointer
id|trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|dev_tint
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb
op_member_access_from_pointer
id|len
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6000
op_logical_and
(paren
id|hp100_inw
c_func
(paren
id|OPTION_MSW
)paren
op_amp
id|HP100_TX_CMD
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef HP100_DEBUG_TX
id|printk
c_func
(paren
l_string|&quot;hp100_start_xmit: busy&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif    
)brace
id|hp100_ints_off
c_func
(paren
)paren
suffix:semicolon
id|val
op_assign
id|hp100_inw
c_func
(paren
id|IRQ_STATUS
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
id|val
op_amp
id|HP100_TX_COMPLETE
comma
id|IRQ_STATUS
)paren
suffix:semicolon
macro_line|#ifdef HP100_DEBUG_TX
id|printk
c_func
(paren
l_string|&quot;hp100_start_xmit: irq_status = 0x%x, len = %d&bslash;n&quot;
comma
id|val
comma
(paren
r_int
)paren
id|skb
op_member_access_from_pointer
id|len
)paren
suffix:semicolon
macro_line|#endif
id|ok_flag
op_assign
id|skb
op_member_access_from_pointer
id|len
op_ge
id|HP100_MIN_PACKET_SIZE
suffix:semicolon
id|i
op_assign
id|ok_flag
ques
c_cond
id|skb
op_member_access_from_pointer
id|len
suffix:colon
id|HP100_MIN_PACKET_SIZE
suffix:semicolon
id|hp100_outw
c_func
(paren
id|i
comma
id|DATA32
)paren
suffix:semicolon
multiline_comment|/* length to memory manager */
id|hp100_outw
c_func
(paren
id|i
comma
id|FRAGMENT_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|mem_mapped
)paren
(brace
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|mem_ptr_virt
)paren
(brace
id|memcpy
c_func
(paren
id|lp
op_member_access_from_pointer
id|mem_ptr_virt
comma
id|skb
op_member_access_from_pointer
id|data
comma
id|skb
op_member_access_from_pointer
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ok_flag
)paren
id|memset
c_func
(paren
id|lp
op_member_access_from_pointer
id|mem_ptr_virt
comma
l_int|0
comma
id|HP100_MIN_PACKET_SIZE
op_minus
id|skb
op_member_access_from_pointer
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy_toio
c_func
(paren
id|lp
op_member_access_from_pointer
id|mem_ptr_phys
comma
id|skb
op_member_access_from_pointer
id|data
comma
id|skb
op_member_access_from_pointer
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ok_flag
)paren
id|memset_io
c_func
(paren
id|lp
op_member_access_from_pointer
id|mem_ptr_phys
comma
l_int|0
comma
id|HP100_MIN_PACKET_SIZE
op_minus
id|skb
op_member_access_from_pointer
id|len
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|outsl
c_func
(paren
id|ioaddr
op_plus
id|HP100_REG_DATA32
comma
id|skb
op_member_access_from_pointer
id|data
comma
(paren
id|skb
op_member_access_from_pointer
id|len
op_plus
l_int|3
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ok_flag
)paren
r_for
c_loop
(paren
id|i
op_assign
(paren
id|skb
op_member_access_from_pointer
id|len
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|i
OL
id|HP100_MIN_PACKET_SIZE
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
id|hp100_outl
c_func
(paren
l_int|0
comma
id|DATA32
)paren
suffix:semicolon
)brace
id|hp100_outw
c_func
(paren
id|HP100_TX_CMD
op_or
id|HP100_SET_LB
comma
id|OPTION_MSW
)paren
suffix:semicolon
multiline_comment|/* send packet */
id|lp
op_member_access_from_pointer
id|stats.tx_packets
op_increment
suffix:semicolon
id|dev
op_member_access_from_pointer
id|trans_start
op_assign
id|jiffies
suffix:semicolon
id|hp100_ints_on
c_func
(paren
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
macro_line|#ifdef HP100_DEBUG_TX
id|printk
c_func
(paren
l_string|&quot;hp100_start_xmit: end&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  receive - called from interrupt handler&n; */
DECL|function|hp100_rx
r_static
r_void
id|hp100_rx
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|packets
comma
id|pkt_len
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
r_struct
id|hp100_private
op_star
id|lp
op_assign
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
suffix:semicolon
id|u_int
id|header
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|lan_type
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|lp
op_member_access_from_pointer
id|lan_type
op_assign
id|hp100_sense_lan
c_func
(paren
id|dev
)paren
)paren
op_eq
id|HP100_LAN_100
)paren
id|lp
op_member_access_from_pointer
id|hub_status
op_assign
id|hp100_login_to_vg_hub
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|PERFORMANCE
)paren
suffix:semicolon
)brace
macro_line|#endif
id|packets
op_assign
id|hp100_inb
c_func
(paren
id|RX_PKT_CNT
)paren
suffix:semicolon
macro_line|#ifdef HP100_DEBUG
r_if
c_cond
(paren
id|packets
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;hp100_rx: waiting packets = %d&bslash;n&quot;
comma
id|packets
)paren
suffix:semicolon
macro_line|#endif
r_while
c_loop
(paren
id|packets
op_decrement
OG
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|pkt_len
op_assign
l_int|0
suffix:semicolon
id|pkt_len
OL
l_int|6000
op_logical_and
(paren
id|hp100_inw
c_func
(paren
id|OPTION_MSW
)paren
op_amp
id|HP100_ADV_NXT_PKT
)paren
suffix:semicolon
id|pkt_len
op_increment
)paren
(brace
macro_line|#ifdef HP100_DEBUG_TX
id|printk
c_func
(paren
l_string|&quot;hp100_rx: busy, remaining packets = %d&bslash;n&quot;
comma
id|packets
)paren
suffix:semicolon
macro_line|#endif    
)brace
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|mem_mapped
)paren
(brace
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|mem_ptr_virt
)paren
id|header
op_assign
op_star
(paren
id|__u32
op_star
)paren
id|lp
op_member_access_from_pointer
id|mem_ptr_virt
suffix:semicolon
r_else
id|header
op_assign
id|readl
c_func
(paren
id|lp
op_member_access_from_pointer
id|mem_ptr_phys
)paren
suffix:semicolon
)brace
r_else
id|header
op_assign
id|hp100_inl
c_func
(paren
id|DATA32
)paren
suffix:semicolon
id|pkt_len
op_assign
id|header
op_amp
id|HP100_PKT_LEN_MASK
suffix:semicolon
macro_line|#ifdef HP100_DEBUG_RX
id|printk
c_func
(paren
l_string|&quot;hp100_rx: new packet - length = %d, errors = 0x%x, dest = 0x%x&bslash;n&quot;
comma
id|header
op_amp
id|HP100_PKT_LEN_MASK
comma
(paren
id|header
op_rshift
l_int|16
)paren
op_amp
l_int|0xfff8
comma
(paren
id|header
op_rshift
l_int|16
)paren
op_amp
l_int|7
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;       * NOTE! This (and the skb_put() below) depends on the skb-functions&n;       * allocating more than asked (notably, aligning the request up to&n;       * the next 16-byte length).&n;       */
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
macro_line|#ifdef HP100_DEBUG
id|printk
c_func
(paren
l_string|&quot;hp100_rx: couldn&squot;t allocate a sk_buff of size %d&bslash;n&quot;
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#endif
id|lp
op_member_access_from_pointer
id|stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|u_char
op_star
id|ptr
suffix:semicolon
id|skb
op_member_access_from_pointer
id|dev
op_assign
id|dev
suffix:semicolon
id|ptr
op_assign
(paren
id|u_char
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|mem_mapped
)paren
(brace
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|mem_ptr_virt
)paren
id|memcpy
c_func
(paren
id|ptr
comma
id|lp
op_member_access_from_pointer
id|mem_ptr_virt
comma
(paren
id|pkt_len
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
)paren
suffix:semicolon
r_else
id|memcpy_fromio
c_func
(paren
id|ptr
comma
id|lp
op_member_access_from_pointer
id|mem_ptr_phys
comma
(paren
id|pkt_len
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
)paren
suffix:semicolon
)brace
r_else
id|insl
c_func
(paren
id|ioaddr
op_plus
id|HP100_REG_DATA32
comma
id|ptr
comma
(paren
id|pkt_len
op_plus
l_int|3
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
id|skb
op_member_access_from_pointer
id|protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp
op_member_access_from_pointer
id|stats.rx_packets
op_increment
suffix:semicolon
macro_line|#ifdef HP100_DEBUG_RX
id|printk
c_func
(paren
l_string|&quot;rx: %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x&bslash;n&quot;
comma
id|ptr
(braket
l_int|0
)braket
comma
id|ptr
(braket
l_int|1
)braket
comma
id|ptr
(braket
l_int|2
)braket
comma
id|ptr
(braket
l_int|3
)braket
comma
id|ptr
(braket
l_int|4
)braket
comma
id|ptr
(braket
l_int|5
)braket
comma
id|ptr
(braket
l_int|6
)braket
comma
id|ptr
(braket
l_int|7
)braket
comma
id|ptr
(braket
l_int|8
)braket
comma
id|ptr
(braket
l_int|9
)braket
comma
id|ptr
(braket
l_int|10
)braket
comma
id|ptr
(braket
l_int|11
)braket
)paren
suffix:semicolon
macro_line|#endif
)brace
id|hp100_outw
c_func
(paren
id|HP100_ADV_NXT_PKT
op_or
id|HP100_SET_LB
comma
id|OPTION_MSW
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|header
op_amp
l_int|0x00070000
)paren
(brace
r_case
(paren
id|HP100_MULTI_ADDR_HASH
op_lshift
l_int|16
)paren
suffix:colon
r_case
(paren
id|HP100_MULTI_ADDR_NO_HASH
op_lshift
l_int|16
)paren
suffix:colon
id|lp
op_member_access_from_pointer
id|stats.multicast
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#ifdef HP100_DEBUG_RX
id|printk
c_func
(paren
l_string|&quot;hp100_rx: end&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; *  statistics&n; */
DECL|function|hp100_get_stats
r_static
r_struct
id|enet_statistics
op_star
id|hp100_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
id|hp100_ints_off
c_func
(paren
)paren
suffix:semicolon
id|hp100_update_stats
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_ints_on
c_func
(paren
)paren
suffix:semicolon
r_return
op_amp
(paren
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
)paren
op_member_access_from_pointer
id|stats
suffix:semicolon
)brace
DECL|function|hp100_update_stats
r_static
r_void
id|hp100_update_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
id|u_short
id|val
suffix:semicolon
r_struct
id|hp100_private
op_star
id|lp
op_assign
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_CTRL
)paren
suffix:semicolon
multiline_comment|/* get all statistics bytes */
id|val
op_assign
id|hp100_inw
c_func
(paren
id|DROPPED
)paren
op_amp
l_int|0x0fff
suffix:semicolon
id|lp
op_member_access_from_pointer
id|stats.rx_errors
op_add_assign
id|val
suffix:semicolon
id|lp
op_member_access_from_pointer
id|stats.rx_over_errors
op_add_assign
id|val
suffix:semicolon
id|val
op_assign
id|hp100_inb
c_func
(paren
id|CRC
)paren
suffix:semicolon
id|lp
op_member_access_from_pointer
id|stats.rx_errors
op_add_assign
id|val
suffix:semicolon
id|lp
op_member_access_from_pointer
id|stats.rx_crc_errors
op_add_assign
id|val
suffix:semicolon
id|val
op_assign
id|hp100_inb
c_func
(paren
id|ABORT
)paren
suffix:semicolon
id|lp
op_member_access_from_pointer
id|stats.tx_errors
op_add_assign
id|val
suffix:semicolon
id|lp
op_member_access_from_pointer
id|stats.tx_aborted_errors
op_add_assign
id|val
suffix:semicolon
id|hp100_page
c_func
(paren
id|PERFORMANCE
)paren
suffix:semicolon
)brace
DECL|function|hp100_clear_stats
r_static
r_void
id|hp100_clear_stats
c_func
(paren
r_int
id|ioaddr
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_CTRL
)paren
suffix:semicolon
multiline_comment|/* get all statistics bytes */
id|hp100_inw
c_func
(paren
id|DROPPED
)paren
suffix:semicolon
id|hp100_inb
c_func
(paren
id|CRC
)paren
suffix:semicolon
id|hp100_inb
c_func
(paren
id|ABORT
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|PERFORMANCE
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  multicast setup&n; */
macro_line|#ifdef HAVE_MULTICAST
multiline_comment|/*&n; *  Set or clear the multicast filter for this adapter.&n; *&n; *  num_addrs == -1             Promiscuous mode, receive all packets&n; *  num_addrs == 0              Normal mode, clear multicast list&n; *  num_addrs &gt; 0               Multicast mode, receive normal and MC packets,&n; *                              best-effort filtering.&n; */
DECL|function|hp100_set_multicast_list
r_static
r_void
id|hp100_set_multicast_list
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|num_addrs
comma
r_void
op_star
id|addrs
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
r_struct
id|hp100_private
op_star
id|lp
op_assign
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
suffix:semicolon
macro_line|#ifdef HP100_DEBUG_MULTI
id|printk
c_func
(paren
l_string|&quot;hp100_set_multicast_list: num_addrs = %d&bslash;n&quot;
comma
id|num_addrs
)paren
suffix:semicolon
macro_line|#endif
id|cli
c_func
(paren
)paren
suffix:semicolon
id|hp100_ints_off
c_func
(paren
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_CTRL
)paren
suffix:semicolon
id|hp100_andb
c_func
(paren
op_complement
(paren
id|HP100_RX_EN
op_or
id|HP100_TX_EN
)paren
comma
id|MAC_CFG_1
)paren
suffix:semicolon
multiline_comment|/* stop rx/tx */
r_if
c_cond
(paren
id|num_addrs
OL
l_int|0
)paren
(brace
id|lp
op_member_access_from_pointer
id|mac2_mode
op_assign
id|HP100_MAC2MODE6
suffix:semicolon
multiline_comment|/* promiscuous mode, all good */
id|lp
op_member_access_from_pointer
id|mac1_mode
op_assign
id|HP100_MAC1MODE6
suffix:semicolon
multiline_comment|/* packets on the net */
)brace
r_else
r_if
c_cond
(paren
id|num_addrs
OG
l_int|0
)paren
(brace
id|lp
op_member_access_from_pointer
id|mac2_mode
op_assign
id|HP100_MAC2MODE5
suffix:semicolon
multiline_comment|/* multicast mode, packets for me */
id|lp
op_member_access_from_pointer
id|mac1_mode
op_assign
id|HP100_MAC1MODE5
suffix:semicolon
multiline_comment|/* broadcasts and all multicasts */
)brace
r_else
(brace
id|lp
op_member_access_from_pointer
id|mac2_mode
op_assign
id|HP100_MAC2MODE3
suffix:semicolon
multiline_comment|/* normal mode, packets for me */
id|lp
op_member_access_from_pointer
id|mac1_mode
op_assign
id|HP100_MAC1MODE3
suffix:semicolon
multiline_comment|/* and broadcasts */
)brace
id|hp100_outb
c_func
(paren
id|lp
op_member_access_from_pointer
id|mac2_mode
comma
id|MAC_CFG_2
)paren
suffix:semicolon
id|hp100_andb
c_func
(paren
id|HP100_MAC1MODEMASK
comma
id|MAC_CFG_1
)paren
suffix:semicolon
id|hp100_orb
c_func
(paren
id|lp
op_member_access_from_pointer
id|mac1_mode
op_or
id|HP100_RX_EN
op_or
id|HP100_RX_IDLE
op_or
multiline_comment|/* enable rx */
id|HP100_TX_EN
op_or
id|HP100_TX_IDLE
comma
id|MAC_CFG_1
)paren
suffix:semicolon
multiline_comment|/* enable tx */
id|hp100_page
c_func
(paren
id|PERFORMANCE
)paren
suffix:semicolon
id|hp100_ints_on
c_func
(paren
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* HAVE_MULTICAST */
multiline_comment|/*&n; *  hardware interrupt handling&n; */
DECL|function|hp100_interrupt
r_static
r_void
id|hp100_interrupt
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
(paren
r_struct
id|device
op_star
)paren
id|irq2dev_map
(braket
id|irq
)braket
suffix:semicolon
r_struct
id|hp100_private
op_star
id|lp
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
id|u_short
id|val
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_member_access_from_pointer
id|interrupt
)paren
id|printk
c_func
(paren
l_string|&quot;%s: re-entering the interrupt handler&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|hp100_ints_off
c_func
(paren
)paren
suffix:semicolon
id|dev
op_member_access_from_pointer
id|interrupt
op_assign
l_int|1
suffix:semicolon
id|hp100_page
c_func
(paren
id|PERFORMANCE
)paren
suffix:semicolon
id|val
op_assign
id|hp100_inw
c_func
(paren
id|IRQ_STATUS
)paren
suffix:semicolon
macro_line|#ifdef HP100_DEBUG_IRQ
id|printk
c_func
(paren
l_string|&quot;hp100_interrupt: irq_status = 0x%x&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|val
op_amp
id|HP100_RX_PACKET
)paren
(brace
id|hp100_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
id|HP100_RX_PACKET
comma
id|IRQ_STATUS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
(paren
id|HP100_TX_SPACE_AVAIL
op_or
id|HP100_TX_COMPLETE
)paren
)paren
(brace
id|hp100_outw
c_func
(paren
id|val
op_amp
(paren
id|HP100_TX_SPACE_AVAIL
op_or
id|HP100_TX_COMPLETE
)paren
comma
id|IRQ_STATUS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_amp
(paren
id|HP100_TX_ERROR
op_or
id|HP100_RX_ERROR
)paren
)paren
(brace
id|lp
op_assign
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
suffix:semicolon
id|hp100_update_stats
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
id|val
op_amp
(paren
id|HP100_TX_ERROR
op_or
id|HP100_RX_ERROR
)paren
comma
id|IRQ_STATUS
)paren
suffix:semicolon
)brace
macro_line|#ifdef HP100_DEBUG_IRQ
id|printk
c_func
(paren
l_string|&quot;hp100_interrupt: end&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|dev
op_member_access_from_pointer
id|interrupt
op_assign
l_int|0
suffix:semicolon
id|hp100_ints_on
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  some misc functions&n; */
DECL|function|hp100_start_interface
r_static
r_void
id|hp100_start_interface
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
r_struct
id|hp100_private
op_star
id|lp
op_assign
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|hp100_unreset_card
c_func
(paren
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_CTRL
)paren
suffix:semicolon
id|hp100_outb
c_func
(paren
id|lp
op_member_access_from_pointer
id|mac2_mode
comma
id|MAC_CFG_2
)paren
suffix:semicolon
id|hp100_andb
c_func
(paren
id|HP100_MAC1MODEMASK
comma
id|MAC_CFG_1
)paren
suffix:semicolon
id|hp100_orb
c_func
(paren
id|lp
op_member_access_from_pointer
id|mac1_mode
op_or
id|HP100_RX_EN
op_or
id|HP100_RX_IDLE
op_or
id|HP100_TX_EN
op_or
id|HP100_TX_IDLE
comma
id|MAC_CFG_1
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|PERFORMANCE
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
id|HP100_INT_EN
op_or
id|HP100_SET_LB
comma
id|OPTION_LSW
)paren
suffix:semicolon
id|hp100_outw
c_func
(paren
id|HP100_TRI_INT
op_or
id|HP100_RESET_HB
comma
id|OPTION_LSW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|mem_mapped
)paren
(brace
multiline_comment|/* enable memory mapping */
id|hp100_outw
c_func
(paren
id|HP100_MMAP_DIS
op_or
id|HP100_RESET_HB
comma
id|OPTION_LSW
)paren
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|hp100_stop_interface
r_static
r_void
id|hp100_stop_interface
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
id|u_short
id|val
suffix:semicolon
id|hp100_outw
c_func
(paren
id|HP100_INT_EN
op_or
id|HP100_RESET_LB
op_or
id|HP100_TRI_INT
op_or
id|HP100_MMAP_DIS
op_or
id|HP100_SET_HB
comma
id|OPTION_LSW
)paren
suffix:semicolon
id|val
op_assign
id|hp100_inw
c_func
(paren
id|OPTION_LSW
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|HW_MAP
)paren
suffix:semicolon
id|hp100_andb
c_func
(paren
id|HP100_BM_SLAVE
comma
id|BM
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_CTRL
)paren
suffix:semicolon
id|hp100_andb
c_func
(paren
op_complement
(paren
id|HP100_RX_EN
op_or
id|HP100_TX_EN
)paren
comma
id|MAC_CFG_1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
id|HP100_HW_RST
)paren
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|val
op_assign
l_int|0
suffix:semicolon
id|val
OL
l_int|6000
suffix:semicolon
id|val
op_increment
)paren
r_if
c_cond
(paren
(paren
id|hp100_inb
c_func
(paren
id|MAC_CFG_1
)paren
op_amp
(paren
id|HP100_TX_IDLE
op_or
id|HP100_RX_IDLE
)paren
)paren
op_eq
(paren
id|HP100_TX_IDLE
op_or
id|HP100_RX_IDLE
)paren
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: hp100_stop_interface - timeout&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
)brace
DECL|function|hp100_load_eeprom
r_static
r_void
id|hp100_load_eeprom
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
id|hp100_page
c_func
(paren
id|EEPROM_CTRL
)paren
suffix:semicolon
id|hp100_andw
c_func
(paren
op_complement
id|HP100_EEPROM_LOAD
comma
id|EEPROM_CTRL
)paren
suffix:semicolon
id|hp100_orw
c_func
(paren
id|HP100_EEPROM_LOAD
comma
id|EEPROM_CTRL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6000
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|hp100_inw
c_func
(paren
id|OPTION_MSW
)paren
op_amp
id|HP100_EE_LOAD
)paren
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: hp100_load_eeprom - timeout&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
)brace
multiline_comment|/* return values: LAN_10, LAN_100 or LAN_ERR (not connected or hub is down)... */
DECL|function|hp100_sense_lan
r_static
r_int
id|hp100_sense_lan
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
id|u_short
id|val_VG
comma
id|val_10
suffix:semicolon
r_struct
id|hp100_private
op_star
id|lp
op_assign
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev
op_member_access_from_pointer
id|priv
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_CTRL
)paren
suffix:semicolon
id|hp100_orw
c_func
(paren
id|HP100_VG_RESET
comma
id|LAN_CFG_VG
)paren
suffix:semicolon
id|val_10
op_assign
id|hp100_inw
c_func
(paren
id|LAN_CFG_10
)paren
suffix:semicolon
id|val_VG
op_assign
id|hp100_inw
c_func
(paren
id|LAN_CFG_VG
)paren
suffix:semicolon
macro_line|#ifdef HP100_DEBUG_SENSE
id|printk
c_func
(paren
l_string|&quot;hp100_sense_lan: val_VG = 0x%04x, val_10 = 0x%04x&bslash;n&quot;
comma
id|val_VG
comma
id|val_10
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|val_10
op_amp
id|HP100_LINK_BEAT_ST
)paren
r_return
id|HP100_LAN_10
suffix:semicolon
r_if
c_cond
(paren
id|lp
op_member_access_from_pointer
id|id
op_member_access_from_pointer
id|id
op_eq
l_int|0x02019F022
)paren
multiline_comment|/* HP J27248B doesn&squot;t have 100Mb/s interface */
r_return
id|HP100_LAN_ERR
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2500
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val_VG
op_assign
id|hp100_inw
c_func
(paren
id|LAN_CFG_VG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val_VG
op_amp
id|HP100_LINK_CABLE_ST
)paren
r_return
id|HP100_LAN_100
suffix:semicolon
)brace
r_return
id|HP100_LAN_ERR
suffix:semicolon
)brace
DECL|function|hp100_down_vg_link
r_static
r_int
id|hp100_down_vg_link
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
r_int
r_int
id|time
suffix:semicolon
r_int
id|i
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_CTRL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|2500
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|hp100_inw
c_func
(paren
id|LAN_CFG_VG
)paren
op_amp
id|HP100_LINK_CABLE_ST
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_le
l_int|0
)paren
multiline_comment|/* not signal - not logout */
r_return
l_int|0
suffix:semicolon
id|hp100_andw
c_func
(paren
op_complement
id|HP100_LINK_CMD
comma
id|LAN_CFG_VG
)paren
suffix:semicolon
id|time
op_assign
id|jiffies
op_plus
l_int|10
suffix:semicolon
r_while
c_loop
(paren
id|time
OG
id|jiffies
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|hp100_inw
c_func
(paren
id|LAN_CFG_VG
)paren
op_amp
(paren
id|HP100_LINK_UP_ST
op_or
id|HP100_LINK_CABLE_ST
op_or
id|HP100_LINK_GOOD_ST
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#ifdef HP100_DEBUG
id|printk
c_func
(paren
l_string|&quot;hp100_down_vg_link: timeout&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|hp100_login_to_vg_hub
r_static
r_int
id|hp100_login_to_vg_hub
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev
op_member_access_from_pointer
id|base_addr
suffix:semicolon
id|u_short
id|val
suffix:semicolon
r_int
r_int
id|time
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_CTRL
)paren
suffix:semicolon
id|hp100_orw
c_func
(paren
id|HP100_VG_RESET
comma
id|LAN_CFG_VG
)paren
suffix:semicolon
id|time
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|hp100_inw
c_func
(paren
id|LAN_CFG_VG
)paren
op_amp
id|HP100_LINK_CABLE_ST
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time
OG
id|jiffies
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time
op_le
id|jiffies
)paren
(brace
macro_line|#ifdef HP100_DEBUG
id|printk
c_func
(paren
l_string|&quot;hp100_login_to_vg_hub: timeout for link&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hp100_down_vg_link
c_func
(paren
id|dev
)paren
OL
l_int|0
)paren
multiline_comment|/* if fail, try reset VG link */
(brace
id|hp100_andw
c_func
(paren
op_complement
id|HP100_VG_RESET
comma
id|LAN_CFG_VG
)paren
suffix:semicolon
id|hp100_orw
c_func
(paren
id|HP100_VG_RESET
comma
id|LAN_CFG_VG
)paren
suffix:semicolon
)brace
multiline_comment|/* bring up link */
id|hp100_orw
c_func
(paren
id|HP100_LOAD_ADDR
op_or
id|HP100_LINK_CMD
comma
id|LAN_CFG_VG
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|2500
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|hp100_inw
c_func
(paren
id|LAN_CFG_VG
)paren
op_amp
id|HP100_LINK_CABLE_ST
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_le
l_int|0
)paren
(brace
macro_line|#ifdef HP100_DEBUG
id|printk
c_func
(paren
l_string|&quot;hp100_login_to_vg_hub: timeout for link (bring up)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_goto
id|down_link
suffix:semicolon
)brace
id|time
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
r_do
(brace
id|val
op_assign
id|hp100_inw
c_func
(paren
id|LAN_CFG_VG
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
(paren
id|HP100_LINK_UP_ST
op_or
id|HP100_LINK_GOOD_ST
)paren
)paren
op_eq
(paren
id|HP100_LINK_UP_ST
op_or
id|HP100_LINK_GOOD_ST
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* success */
)brace
r_while
c_loop
(paren
id|time
OG
id|jiffies
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|HP100_LINK_GOOD_ST
)paren
id|printk
c_func
(paren
l_string|&quot;%s: 100Mb cable training failed, check cable.&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%s: 100Mb node not accepted by hub, check frame type or security.&bslash;n&quot;
comma
id|dev
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
id|down_link
suffix:colon
id|hp100_down_vg_link
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hp100_page
c_func
(paren
id|MAC_CTRL
)paren
suffix:semicolon
id|hp100_andw
c_func
(paren
op_complement
(paren
id|HP100_LOAD_ADDR
op_or
id|HP100_PROM_MODE
)paren
comma
id|LAN_CFG_VG
)paren
suffix:semicolon
id|hp100_orw
c_func
(paren
id|HP100_LINK_CMD
comma
id|LAN_CFG_VG
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/*&n; *  module section&n; */
macro_line|#ifdef MODULE
DECL|variable|kernel_version
r_char
id|kernel_version
(braket
)braket
op_assign
id|UTS_RELEASE
suffix:semicolon
DECL|variable|hp100_port
r_static
r_int
id|hp100_port
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|dev_hp100
r_static
r_struct
id|device
id|dev_hp100
op_assign
(brace
l_string|&quot;        &quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|hp100_probe
)brace
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|hp100_port
op_eq
l_int|0
op_logical_and
op_logical_neg
id|EISA_bus
)paren
id|printk
c_func
(paren
l_string|&quot;HP100: You should not use auto-probing with insmod!&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hp100_port
OG
l_int|0
)paren
id|dev_hp100.base_addr
op_assign
id|hp100_port
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
op_amp
id|dev_hp100
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|unregister_netdev
c_func
(paren
op_amp
id|dev_hp100
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev_hp100.base_addr
comma
id|HP100_REGION_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev_hp100.priv
)paren
op_member_access_from_pointer
id|mem_ptr_virt
)paren
id|vfree
c_func
(paren
(paren
(paren
r_struct
id|hp100_private
op_star
)paren
id|dev_hp100.priv
)paren
op_member_access_from_pointer
id|mem_ptr_virt
)paren
suffix:semicolon
id|kfree_s
c_func
(paren
id|dev_hp100.priv
comma
r_sizeof
(paren
r_struct
id|hp100_private
)paren
)paren
suffix:semicolon
id|dev_hp100.priv
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
eof
