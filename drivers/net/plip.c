multiline_comment|/* plip.c: A parallel port &quot;network&quot; driver for linux. */
multiline_comment|/* This driver is for parallel port with 5-bit cable (LapLink (R) cable). */
multiline_comment|/*&n; * Authors:&t;Donald Becker,  &lt;becker@super.org&gt;&n; *&t;&t;Tommy Thorn, &lt;thorn@daimi.aau.dk&gt;&n; *&t;&t;Tanabe Hiroyasu, &lt;hiro@sanpo.t.u-tokyo.ac.jp&gt;&n; *&t;&t;Alan Cox, &lt;gw4pts@gw4pts.ampr.org&gt;&n; *&t;&t;Peter Bauer, &lt;100136.3530@compuserve.com&gt;&n; *&t;&t;Niibe Yutaka, &lt;gniibe@mri.co.jp&gt;&n; *&n; *&t;&t;This is the all improved state based PLIP that Niibe Yutaka has contributed.&n; *&n; *&t;&t;Modularization by Alan Cox. I also added the plipconfig program to tune the timeouts&n; *&t;&t;and ifmap support for funny serial port settings or setting odd values using the &n; *&t;&t;modular plip. I also took the panic() calls out. I don&squot;t like panic - especially when&n; *&t;&t;it can be avoided.&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
multiline_comment|/*&n; * Original version and the name &squot;PLIP&squot; from Donald Becker &lt;becker@super.org&gt;&n; * inspired by Russ Nelson&squot;s parallel port packet driver.&n; */
DECL|variable|version
r_static
r_char
op_star
id|version
op_assign
l_string|&quot;NET3 &quot;
macro_line|#ifdef MODULE
l_string|&quot;MODULAR &quot;
macro_line|#endif    
l_string|&quot;PLIP.010+ gniibe@mri.co.jp&bslash;n&quot;
suffix:semicolon
macro_line|#include &lt;linux/config.h&gt;
multiline_comment|/*&n;  Sources:&n;&t;Ideas and protocols came from Russ Nelson&squot;s &lt;nelson@crynwr.com&gt;&n;&t;&quot;parallel.asm&quot; parallel port packet driver.&n;&n;  The &quot;Crynwr&quot; parallel port standard specifies the following protocol:&n;   send header nibble &squot;8&squot;&n;   count-low octet&n;   count-high octet&n;   ... data octets&n;   checksum octet&n;  Each octet is sent as &lt;wait for rx. &squot;0x1?&squot;&gt; &lt;send 0x10+(octet&amp;0x0F)&gt;&n;&t;&t;&t;&lt;wait for rx. &squot;0x0?&squot;&gt; &lt;send 0x00+((octet&gt;&gt;4)&amp;0x0F)&gt;&n;&n;The cable used is a de facto standard parallel null cable -- sold as&n;a &quot;LapLink&quot; cable by various places.  You&squot;ll need a 10-conductor cable to&n;make one yourself.  The wiring is:&n;    SLCTIN&t;17 - 17&n;    GROUND&t;25 - 25&n;    D0-&gt;ERROR&t;2 - 15&t;&t;15 - 2&n;    D1-&gt;SLCT&t;3 - 13&t;&t;13 - 3&n;    D2-&gt;PAPOUT&t;4 - 12&t;&t;12 - 4&n;    D3-&gt;ACK&t;5 - 10&t;&t;10 - 5&n;    D4-&gt;BUSY&t;6 - 11&t;&t;11 - 6&n;  Do not connect the other pins.  They are&n;    D5,D6,D7 are 7,8,9&n;    STROBE is 1, FEED is 14, INIT is 16&n;    extra grounds are 18,19,20,21,22,23,24&n;*/
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/if_ether.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;netinet/in.h&gt;
macro_line|#include &lt;errno.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/if_plip.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#ifdef MODULE
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &quot;../../tools/version.h&quot;
macro_line|#endif
multiline_comment|/* use 0 for production, 1 for verification, &gt;2 for debug */
macro_line|#ifndef NET_DEBUG
DECL|macro|NET_DEBUG
mdefine_line|#define NET_DEBUG 3
macro_line|#endif
DECL|variable|net_debug
r_static
r_int
r_int
id|net_debug
op_assign
id|NET_DEBUG
suffix:semicolon
multiline_comment|/* constants */
DECL|macro|PLIP_MTU
mdefine_line|#define PLIP_MTU 1500
multiline_comment|/* In micro second */
DECL|macro|PLIP_DELAY_UNIT
mdefine_line|#define PLIP_DELAY_UNIT&t;&t;   1
multiline_comment|/* Connection time out = PLIP_TRIGGER_WAIT * PLIP_DELAY_UNIT usec */
DECL|macro|PLIP_TRIGGER_WAIT
mdefine_line|#define PLIP_TRIGGER_WAIT&t; 500
multiline_comment|/* Nibble time out = PLIP_NIBBLE_WAIT * PLIP_DELAY_UNIT usec */
DECL|macro|PLIP_NIBBLE_WAIT
mdefine_line|#define PLIP_NIBBLE_WAIT&t;3000
DECL|macro|PAR_DATA
mdefine_line|#define PAR_DATA(dev)&t;&t;(dev-&gt;base_addr+0)
DECL|macro|PAR_STATUS
mdefine_line|#define PAR_STATUS(dev)&t;&t;(dev-&gt;base_addr+1)
DECL|macro|PAR_CONTROL
mdefine_line|#define PAR_CONTROL(dev)&t;(dev-&gt;base_addr+2)
multiline_comment|/* Index to functions, as function prototypes. */
r_static
r_int
id|plip_tx_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|plip_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|plip_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|plip_header
c_func
(paren
r_int
r_char
op_star
id|buff
comma
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|dest
comma
r_void
op_star
id|source
comma
r_int
id|len
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_struct
id|enet_statistics
op_star
id|plip_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|plip_rebuild_header
c_func
(paren
r_void
op_star
id|buff
comma
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|raddr
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
"&f;"
DECL|enum|plip_state
r_enum
id|plip_state
(brace
DECL|enumerator|PLIP_ST_DONE
id|PLIP_ST_DONE
op_assign
l_int|0
comma
DECL|enumerator|PLIP_ST_TRANSMIT_BEGIN
id|PLIP_ST_TRANSMIT_BEGIN
comma
DECL|enumerator|PLIP_ST_TRIGGER
id|PLIP_ST_TRIGGER
comma
DECL|enumerator|PLIP_ST_LENGTH_LSB
id|PLIP_ST_LENGTH_LSB
comma
DECL|enumerator|PLIP_ST_LENGTH_MSB
id|PLIP_ST_LENGTH_MSB
comma
DECL|enumerator|PLIP_ST_DATA
id|PLIP_ST_DATA
comma
DECL|enumerator|PLIP_ST_CHECKSUM
id|PLIP_ST_CHECKSUM
comma
DECL|enumerator|PLIP_ST_ERROR
id|PLIP_ST_ERROR
)brace
suffix:semicolon
DECL|enum|plip_nibble_state
r_enum
id|plip_nibble_state
(brace
DECL|enumerator|PLIP_NST_BEGIN
id|PLIP_NST_BEGIN
comma
DECL|enumerator|PLIP_NST_1
id|PLIP_NST_1
comma
DECL|enumerator|PLIP_NST_2
id|PLIP_NST_2
comma
DECL|enumerator|PLIP_NST_END
id|PLIP_NST_END
)brace
suffix:semicolon
DECL|macro|PLIP_STATE_STRING
mdefine_line|#define PLIP_STATE_STRING(x) &bslash;&n;    (((x) == PLIP_ST_DONE)?&quot;0&quot;:&bslash;&n;     ((x) == PLIP_ST_TRANSMIT_BEGIN)?&quot;b&quot;:&bslash;&n;     ((x) == PLIP_ST_TRIGGER)?&quot;t&quot;:&bslash;&n;     ((x) == PLIP_ST_LENGTH_LSB)?&quot;l&quot;:&bslash;&n;     ((x) == PLIP_ST_LENGTH_MSB)?&quot;m&quot;:&bslash;&n;     ((x) == PLIP_ST_DATA)?&quot;d&quot;:&bslash;&n;     ((x) == PLIP_ST_CHECKSUM)?&quot;s&quot;:&quot;B&quot;)
DECL|struct|plip_local
r_struct
id|plip_local
(brace
DECL|member|state
r_enum
id|plip_state
id|state
suffix:semicolon
DECL|member|nibble
r_enum
id|plip_nibble_state
id|nibble
suffix:semicolon
DECL|member|length
r_int
r_int
id|length
suffix:semicolon
DECL|member|count
r_int
r_int
id|count
suffix:semicolon
DECL|member|byte
r_int
r_int
id|byte
suffix:semicolon
DECL|member|checksum
r_int
r_char
id|checksum
suffix:semicolon
DECL|member|data
r_int
r_char
id|data
suffix:semicolon
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|net_local
r_struct
id|net_local
(brace
DECL|member|e
r_struct
id|enet_statistics
id|e
suffix:semicolon
DECL|member|tl
r_struct
id|timer_list
id|tl
suffix:semicolon
DECL|member|snd_data
r_struct
id|plip_local
id|snd_data
suffix:semicolon
DECL|member|rcv_data
r_struct
id|plip_local
id|rcv_data
suffix:semicolon
DECL|member|trigger_us
r_int
r_int
id|trigger_us
suffix:semicolon
DECL|member|nibble_us
r_int
r_int
id|nibble_us
suffix:semicolon
DECL|member|unit_us
r_int
r_int
id|unit_us
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Routines used internally. */
r_static
r_void
id|plip_device_clear
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|plip_error
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|plip_receive
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_enum
id|plip_nibble_state
op_star
id|ns_p
comma
r_int
r_char
op_star
id|data_p
)paren
suffix:semicolon
r_static
r_void
id|plip_receive_packet
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|plip_interrupt
c_func
(paren
r_int
id|reg_ptr
)paren
suffix:semicolon
r_static
r_int
id|plip_send
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_enum
id|plip_nibble_state
op_star
id|ns_p
comma
r_int
r_char
id|data
)paren
suffix:semicolon
r_static
r_void
id|plip_send_packet
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|plip_ioctl
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
)paren
suffix:semicolon
r_static
r_int
id|plip_config
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
suffix:semicolon
"&f;"
r_int
DECL|function|plip_init
id|plip_init
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|net_local
op_star
id|pl
suffix:semicolon
multiline_comment|/* Check that there is something at base_addr. */
id|outb
c_func
(paren
l_int|0x00
comma
id|PAR_CONTROL
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|0x00
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* Alpha testers must have the version number to report bugs. */
r_if
c_cond
(paren
id|net_debug
)paren
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;irq
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: configured for parallel port at %#3x, IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: configured for parallel port at %#3x&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|autoirq_setup
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|PAR_CONTROL
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x10
comma
id|PAR_CONTROL
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|PAR_CONTROL
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|autoirq_report
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;irq
)paren
id|printk
c_func
(paren
l_string|&quot;, probed IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;, failed to detect IRQ line.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
multiline_comment|/* Initialize the device structure. */
id|dev-&gt;rmem_end
op_assign
(paren
r_int
r_int
)paren
l_int|NULL
suffix:semicolon
id|dev-&gt;rmem_start
op_assign
(paren
r_int
r_int
)paren
l_int|NULL
suffix:semicolon
id|dev-&gt;mem_end
op_assign
(paren
r_int
r_int
)paren
l_int|NULL
suffix:semicolon
id|dev-&gt;mem_start
op_assign
(paren
r_int
r_int
)paren
l_int|NULL
suffix:semicolon
id|dev-&gt;priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|net_local
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|memset
c_func
(paren
id|dev-&gt;priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_local
)paren
)paren
suffix:semicolon
id|pl
op_assign
id|dev-&gt;priv
suffix:semicolon
id|pl-&gt;trigger_us
op_assign
id|PLIP_TRIGGER_WAIT
suffix:semicolon
id|pl-&gt;nibble_us
op_assign
id|PLIP_NIBBLE_WAIT
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|PLIP_MTU
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|plip_tx_packet
suffix:semicolon
id|dev-&gt;open
op_assign
id|plip_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|plip_close
suffix:semicolon
id|dev-&gt;hard_header
op_assign
id|plip_header
suffix:semicolon
id|dev-&gt;type_trans
op_assign
id|eth_type_trans
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|plip_get_stats
suffix:semicolon
id|dev-&gt;set_config
op_assign
id|plip_config
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|plip_ioctl
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
id|ETH_HLEN
suffix:semicolon
id|dev-&gt;addr_len
op_assign
id|ETH_ALEN
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
id|plip_rebuild_header
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DEV_NUMBUFFS
suffix:semicolon
id|i
op_increment
)paren
id|skb_queue_head_init
c_func
(paren
op_amp
id|dev-&gt;buffs
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;addr_len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;broadcast
(braket
id|i
)braket
op_assign
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* New-style flags. */
id|dev-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;family
op_assign
id|AF_INET
suffix:semicolon
id|dev-&gt;pa_addr
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;pa_brdaddr
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;pa_dstaddr
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;pa_mask
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;pa_alen
op_assign
r_sizeof
(paren
r_int
r_int
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
"&f;"
r_static
r_int
DECL|function|plip_tx_packet
id|plip_tx_packet
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|plip_local
op_star
id|snd
op_assign
op_amp
id|lp-&gt;snd_data
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;tbusy
)paren
(brace
multiline_comment|/* it is sending a packet now */
r_int
id|tickssofar
op_assign
id|jiffies
op_minus
id|dev-&gt;trans_start
suffix:semicolon
r_if
c_cond
(paren
id|tickssofar
OL
l_int|100
)paren
multiline_comment|/* please try later, again */
r_return
l_int|1
suffix:semicolon
multiline_comment|/* something wrong... force to reset */
id|printk
c_func
(paren
l_string|&quot;%s: transmit timed out, cable problem??&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|plip_device_clear
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* If some higher layer thinks we&squot;ve missed an tx-done interrupt&n;       we are passed NULL. Caution: dev_tint() handles the cli()/sti()&n;       itself. */
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|dev_tint
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
op_ne
l_int|0
)paren
(brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Transmitter access conflict.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;interrupt
)paren
(brace
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|snd-&gt;state
op_assign
id|PLIP_ST_TRANSMIT_BEGIN
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;Ss&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|dev-&gt;mtu
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: packet too big, %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|skb-&gt;len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|snd-&gt;skb
op_assign
id|skb
suffix:semicolon
id|snd-&gt;length
op_assign
id|skb-&gt;len
suffix:semicolon
id|snd-&gt;count
op_assign
l_int|0
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;interrupt
op_eq
l_int|0
)paren
(brace
multiline_comment|/* set timer */
id|lp-&gt;tl.expires
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;tl.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|lp-&gt;tl.function
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
id|plip_send_packet
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|TIMER_BH
)paren
suffix:semicolon
)brace
id|snd-&gt;state
op_assign
id|PLIP_ST_TRIGGER
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Open/initialize the board.  This is called (in the current kernel)&n;   sometime after booting when the &squot;ifconfig&squot; program is&n;   run.&n;&n;   This routine gets exclusive access to the parallel port by allocating&n;   its IRQ line.&n;   */
r_static
r_int
DECL|function|plip_open
id|plip_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|plip_local
op_star
id|rcv
op_assign
op_amp
id|lp-&gt;rcv_data
suffix:semicolon
id|rcv-&gt;skb
op_assign
id|alloc_skb
c_func
(paren
id|dev-&gt;mtu
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rcv-&gt;skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: couldn&squot;t get memory for receiving packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|rcv-&gt;skb-&gt;len
op_assign
id|dev-&gt;mtu
suffix:semicolon
id|rcv-&gt;skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|plip_interrupt
comma
l_int|0
comma
l_string|&quot;plip&quot;
)paren
op_ne
l_int|0
)paren
(brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: couldn&squot;t get IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|irq2dev_map
(braket
id|dev-&gt;irq
)braket
op_assign
id|dev
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* enable rx interrupt. */
id|outb
c_func
(paren
l_int|0x10
comma
id|PAR_CONTROL
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|plip_device_clear
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef MODULE
id|MOD_INC_USE_COUNT
suffix:semicolon
macro_line|#endif        
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The inverse routine to plip_open (). */
r_static
r_int
DECL|function|plip_close
id|plip_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|0
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|irq2dev_map
(braket
id|dev-&gt;irq
)braket
op_assign
l_int|NULL
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
multiline_comment|/* make sure that we don&squot;t register the timer */
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
multiline_comment|/* release the interrupt. */
id|outb
c_func
(paren
l_int|0x00
comma
id|PAR_CONTROL
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
macro_line|#ifdef MODULE
id|MOD_DEC_USE_COUNT
suffix:semicolon
macro_line|#endif        
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Fill in the MAC-level header. */
r_static
r_int
DECL|function|plip_header
id|plip_header
c_func
(paren
r_int
r_char
op_star
id|buff
comma
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|len
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ALEN
op_minus
r_sizeof
(paren
r_int
r_int
)paren
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
l_int|0xfc
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
comma
op_amp
id|dev-&gt;pa_addr
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
)brace
r_return
id|eth_header
c_func
(paren
id|buff
comma
id|dev
comma
id|type
comma
id|daddr
comma
id|saddr
comma
id|len
comma
id|skb
)paren
suffix:semicolon
)brace
r_static
r_struct
id|enet_statistics
op_star
DECL|function|plip_get_stats
id|plip_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|enet_statistics
op_star
id|localstats
op_assign
(paren
r_struct
id|enet_statistics
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
id|localstats
suffix:semicolon
)brace
multiline_comment|/* We don&squot;t need to send arp, for plip is point-to-point. */
r_static
r_int
DECL|function|plip_rebuild_header
id|plip_rebuild_header
c_func
(paren
r_void
op_star
id|buff
comma
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|dst
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ethhdr
op_star
id|eth
op_assign
(paren
r_struct
id|ethhdr
op_star
)paren
id|buff
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|eth-&gt;h_proto
op_ne
id|htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;plip_rebuild_header: Don&squot;t know how to resolve type %d addresses?&bslash;n&quot;
comma
(paren
r_int
)paren
id|eth-&gt;h_proto
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eth-&gt;h_source
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ALEN
op_minus
r_sizeof
(paren
r_int
r_int
)paren
suffix:semicolon
id|i
op_increment
)paren
id|eth-&gt;h_dest
(braket
id|i
)braket
op_assign
l_int|0xfc
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|eth-&gt;h_dest
(braket
id|i
)braket
)paren
comma
op_amp
id|dst
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
"&f;"
r_static
r_void
DECL|function|plip_device_clear
id|plip_device_clear
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|outb
(paren
l_int|0x00
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|lp-&gt;snd_data.state
op_assign
id|PLIP_ST_DONE
suffix:semicolon
id|lp-&gt;rcv_data.state
op_assign
id|PLIP_ST_DONE
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* make sure that we don&squot;t register the timer */
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|plip_error
id|plip_error
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|plip_local
op_star
id|snd
op_assign
op_amp
(paren
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|snd_data
suffix:semicolon
r_struct
id|plip_local
op_star
id|rcv
op_assign
op_amp
id|lp-&gt;rcv_data
suffix:semicolon
r_int
r_char
id|status
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
id|snd-&gt;state
op_assign
id|PLIP_ST_ERROR
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rcv-&gt;skb
op_eq
l_int|NULL
)paren
(brace
id|rcv-&gt;skb
op_assign
id|alloc_skb
c_func
(paren
id|dev-&gt;mtu
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rcv-&gt;skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: couldn&squot;t get memory.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|again
suffix:semicolon
)brace
id|rcv-&gt;skb-&gt;len
op_assign
id|dev-&gt;mtu
suffix:semicolon
id|rcv-&gt;skb-&gt;dev
op_assign
id|dev
suffix:semicolon
)brace
id|status
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0xf8
)paren
op_eq
l_int|0x80
)paren
(brace
id|plip_device_clear
c_func
(paren
id|dev
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
)brace
r_else
(brace
id|again
suffix:colon
id|lp-&gt;tl.expires
op_assign
l_int|1
suffix:semicolon
id|lp-&gt;tl.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|lp-&gt;tl.function
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
id|plip_error
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
)brace
)brace
"&f;"
multiline_comment|/* PLIP_RECEIVE --- receive a byte(two nibbles)&n;   Return 0 on success, return 1 on failure */
r_static
r_int
DECL|function|plip_receive
id|plip_receive
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_enum
id|plip_nibble_state
op_star
id|ns_p
comma
r_int
r_char
op_star
id|data_p
)paren
(brace
r_int
r_char
id|c0
comma
id|c1
suffix:semicolon
r_int
r_int
id|cx
suffix:semicolon
r_struct
id|net_local
op_star
id|nl
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
r_switch
c_cond
(paren
op_star
id|ns_p
)paren
(brace
r_case
id|PLIP_NST_BEGIN
suffix:colon
id|cx
op_assign
id|nl-&gt;nibble_us
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|c0
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|PLIP_DELAY_UNIT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c0
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
id|c1
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c0
op_eq
id|c1
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|cx
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
)brace
op_star
id|data_p
op_assign
(paren
id|c0
op_rshift
l_int|3
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|outb
c_func
(paren
l_int|0x10
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
multiline_comment|/* send ACK */
op_star
id|ns_p
op_assign
id|PLIP_NST_1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_NST_1
suffix:colon
id|cx
op_assign
id|nl-&gt;nibble_us
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|c0
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|PLIP_DELAY_UNIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c0
op_amp
l_int|0x80
)paren
(brace
id|c1
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c0
op_eq
id|c1
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|cx
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
)brace
op_star
id|data_p
op_or_assign
(paren
id|c0
op_lshift
l_int|1
)paren
op_amp
l_int|0xf0
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
multiline_comment|/* send ACK */
op_star
id|ns_p
op_assign
id|PLIP_NST_2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;plip:receive state error&bslash;n&quot;
)paren
suffix:semicolon
op_star
id|ns_p
op_assign
id|PLIP_NST_2
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|plip_receive_packet
id|plip_receive_packet
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|enet_statistics
op_star
id|stats
op_assign
(paren
r_struct
id|enet_statistics
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|plip_local
op_star
id|snd
op_assign
op_amp
id|lp-&gt;snd_data
suffix:semicolon
r_struct
id|plip_local
op_star
id|rcv
op_assign
op_amp
id|lp-&gt;rcv_data
suffix:semicolon
r_int
r_char
op_star
id|lbuf
op_assign
id|rcv-&gt;skb-&gt;data
suffix:semicolon
r_int
r_char
id|c0
suffix:semicolon
r_int
r_char
op_star
id|s
op_assign
id|PLIP_STATE_STRING
c_func
(paren
id|rcv-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;R%s&quot;
comma
id|s
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_switch
c_cond
(paren
id|rcv-&gt;state
)paren
(brace
r_case
id|PLIP_ST_TRIGGER
suffix:colon
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|rcv-&gt;state
op_assign
id|PLIP_ST_LENGTH_LSB
suffix:semicolon
id|rcv-&gt;nibble
op_assign
id|PLIP_NST_BEGIN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_ST_LENGTH_LSB
suffix:colon
r_if
c_cond
(paren
id|plip_receive
c_func
(paren
id|dev
comma
op_amp
id|rcv-&gt;nibble
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|rcv-&gt;length
)paren
)paren
r_goto
id|try_again
suffix:semicolon
id|rcv-&gt;state
op_assign
id|PLIP_ST_LENGTH_MSB
suffix:semicolon
id|rcv-&gt;nibble
op_assign
id|PLIP_NST_BEGIN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_ST_LENGTH_MSB
suffix:colon
r_if
c_cond
(paren
id|plip_receive
c_func
(paren
id|dev
comma
op_amp
id|rcv-&gt;nibble
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|rcv-&gt;length
op_plus
l_int|1
)paren
)paren
r_goto
id|try_again
suffix:semicolon
r_if
c_cond
(paren
id|rcv-&gt;length
OG
id|rcv-&gt;skb-&gt;len
op_logical_or
id|rcv-&gt;length
OL
l_int|8
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: bogus packet size %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rcv-&gt;length
)paren
suffix:semicolon
id|plip_error
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|rcv-&gt;skb-&gt;len
op_assign
id|rcv-&gt;length
suffix:semicolon
id|rcv-&gt;state
op_assign
id|PLIP_ST_DATA
suffix:semicolon
id|rcv-&gt;nibble
op_assign
id|PLIP_NST_BEGIN
suffix:semicolon
id|rcv-&gt;byte
op_assign
l_int|0
suffix:semicolon
id|rcv-&gt;checksum
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_ST_DATA
suffix:colon
r_if
c_cond
(paren
id|plip_receive
c_func
(paren
id|dev
comma
op_amp
id|rcv-&gt;nibble
comma
op_amp
id|lbuf
(braket
id|rcv-&gt;byte
)braket
)paren
)paren
r_goto
id|try_again
suffix:semicolon
id|rcv-&gt;checksum
op_add_assign
id|lbuf
(braket
id|rcv-&gt;byte
)braket
suffix:semicolon
id|rcv-&gt;byte
op_increment
suffix:semicolon
id|rcv-&gt;nibble
op_assign
id|PLIP_NST_BEGIN
suffix:semicolon
r_if
c_cond
(paren
id|rcv-&gt;byte
op_eq
id|rcv-&gt;length
)paren
id|rcv-&gt;state
op_assign
id|PLIP_ST_CHECKSUM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_ST_CHECKSUM
suffix:colon
r_if
c_cond
(paren
id|plip_receive
c_func
(paren
id|dev
comma
op_amp
id|rcv-&gt;nibble
comma
op_amp
id|rcv-&gt;data
)paren
)paren
r_goto
id|try_again
suffix:semicolon
r_if
c_cond
(paren
id|rcv-&gt;data
op_ne
id|rcv-&gt;checksum
)paren
(brace
id|stats-&gt;rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
)paren
id|printk
c_func
(paren
l_string|&quot;%s: checksum error&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|plip_error
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|rcv-&gt;state
op_assign
id|PLIP_ST_DONE
suffix:semicolon
id|netif_rx
c_func
(paren
id|rcv-&gt;skb
)paren
suffix:semicolon
multiline_comment|/* Malloc up new buffer. */
id|rcv-&gt;skb
op_assign
id|alloc_skb
c_func
(paren
id|dev-&gt;mtu
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rcv-&gt;skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Memory squeeze.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|plip_error
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|rcv-&gt;skb-&gt;len
op_assign
id|dev-&gt;mtu
suffix:semicolon
id|rcv-&gt;skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|stats-&gt;rx_packets
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;R(%4.4d)&quot;
comma
id|rcv-&gt;length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd-&gt;state
op_eq
id|PLIP_ST_TRANSMIT_BEGIN
)paren
(brace
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|snd-&gt;state
op_eq
id|PLIP_ST_TRIGGER
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;%%&quot;
)paren
suffix:semicolon
id|lp-&gt;tl.expires
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;tl.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|lp-&gt;tl.function
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
id|plip_send_packet
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|TIMER_BH
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
id|plip_device_clear
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;plip: bad STATE?? %04d&quot;
comma
id|rcv-&gt;state
)paren
suffix:semicolon
id|plip_device_clear
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|try_again
suffix:colon
r_if
c_cond
(paren
op_increment
id|rcv-&gt;count
OG
l_int|2
)paren
(brace
multiline_comment|/* timeout */
id|s
op_assign
id|PLIP_STATE_STRING
c_func
(paren
id|rcv-&gt;state
)paren
suffix:semicolon
id|c0
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|stats-&gt;rx_dropped
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: receive timeout(%s,%02x)... reset interface.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|s
comma
(paren
r_int
r_int
)paren
id|c0
)paren
suffix:semicolon
id|plip_error
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|s
op_assign
id|PLIP_STATE_STRING
c_func
(paren
id|rcv-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;r%s&quot;
comma
id|s
)paren
suffix:semicolon
multiline_comment|/* set timer */
id|lp-&gt;tl.expires
op_assign
l_int|1
suffix:semicolon
id|lp-&gt;tl.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|lp-&gt;tl.function
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
id|plip_receive_packet
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Handle the parallel port interrupts. */
r_static
r_void
DECL|function|plip_interrupt
id|plip_interrupt
c_func
(paren
r_int
id|reg_ptr
)paren
(brace
r_int
id|irq
op_assign
op_minus
(paren
(paren
(paren
r_struct
id|pt_regs
op_star
)paren
id|reg_ptr
)paren
op_member_access_from_pointer
id|orig_eax
op_plus
l_int|2
)paren
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
id|irq2dev_map
(braket
id|irq
)braket
suffix:semicolon
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|plip_local
op_star
id|rcv
op_assign
op_amp
id|lp-&gt;rcv_data
suffix:semicolon
r_struct
id|plip_local
op_star
id|snd
op_assign
op_amp
id|lp-&gt;snd_data
suffix:semicolon
r_int
r_char
id|c0
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|net_debug
)paren
id|printk
(paren
l_string|&quot;plip_interrupt: irq %d for unknown device.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;interrupt
)paren
(brace
r_if
c_cond
(paren
id|net_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;2&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;tbusy
)paren
(brace
r_if
c_cond
(paren
id|snd-&gt;state
OG
id|PLIP_ST_TRIGGER
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: rx interrupt in transmission&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|net_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;3&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd-&gt;state
op_eq
id|PLIP_ST_ERROR
)paren
r_return
suffix:semicolon
id|c0
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c0
op_amp
l_int|0xf8
)paren
op_ne
l_int|0xc0
)paren
(brace
r_if
c_cond
(paren
id|net_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;?&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dev-&gt;interrupt
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;!&quot;
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|outb
c_func
(paren
l_int|0x01
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
multiline_comment|/* send ACK */
id|rcv-&gt;state
op_assign
id|PLIP_ST_TRIGGER
suffix:semicolon
id|rcv-&gt;count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set timer */
id|del_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
id|lp-&gt;tl.expires
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;tl.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|lp-&gt;tl.function
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
id|plip_receive_packet
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
id|mark_bh
(paren
id|TIMER_BH
)paren
suffix:semicolon
)brace
"&f;"
multiline_comment|/* PLIP_SEND --- send a byte (two nibbles) &n;   Return 0 on success, return 1 on failure */
r_static
r_int
DECL|function|plip_send
id|plip_send
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_enum
id|plip_nibble_state
op_star
id|ns_p
comma
r_int
r_char
id|data
)paren
(brace
r_int
r_char
id|c0
suffix:semicolon
r_int
r_int
id|cx
suffix:semicolon
r_struct
id|net_local
op_star
id|nl
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
r_switch
c_cond
(paren
op_star
id|ns_p
)paren
(brace
r_case
id|PLIP_NST_BEGIN
suffix:colon
id|outb
c_func
(paren
(paren
id|data
op_amp
l_int|0x0f
)paren
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
op_star
id|ns_p
op_assign
id|PLIP_NST_1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_NST_1
suffix:colon
id|outb
c_func
(paren
l_int|0x10
op_or
(paren
id|data
op_amp
l_int|0x0f
)paren
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|cx
op_assign
id|nl-&gt;nibble_us
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|c0
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c0
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|cx
op_eq
l_int|0
)paren
multiline_comment|/* time out */
r_return
l_int|1
suffix:semicolon
id|udelay
c_func
(paren
id|PLIP_DELAY_UNIT
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0x10
op_or
(paren
id|data
op_rshift
l_int|4
)paren
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
op_star
id|ns_p
op_assign
id|PLIP_NST_2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_NST_2
suffix:colon
id|outb
c_func
(paren
(paren
id|data
op_rshift
l_int|4
)paren
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|cx
op_assign
id|nl-&gt;nibble_us
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|c0
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c0
op_amp
l_int|0x80
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|cx
op_eq
l_int|0
)paren
multiline_comment|/* time out */
r_return
l_int|1
suffix:semicolon
id|udelay
c_func
(paren
id|PLIP_DELAY_UNIT
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;plip:send state error&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|plip_send_packet
id|plip_send_packet
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|enet_statistics
op_star
id|stats
op_assign
(paren
r_struct
id|enet_statistics
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_local
op_star
id|lp
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|plip_local
op_star
id|snd
op_assign
op_amp
id|lp-&gt;snd_data
suffix:semicolon
r_int
r_char
op_star
id|lbuf
op_assign
id|snd-&gt;skb-&gt;data
suffix:semicolon
r_int
r_char
id|c0
suffix:semicolon
r_int
r_int
id|cx
suffix:semicolon
r_int
r_char
op_star
id|s
op_assign
id|PLIP_STATE_STRING
c_func
(paren
id|snd-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;S%s&quot;
comma
id|s
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_switch
c_cond
(paren
id|snd-&gt;state
)paren
(brace
r_case
id|PLIP_ST_TRIGGER
suffix:colon
multiline_comment|/* Trigger remote rx interrupt. */
id|outb
c_func
(paren
l_int|0x08
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|cx
op_assign
id|lp-&gt;trigger_us
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;interrupt
)paren
(brace
id|stats-&gt;collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;$&quot;
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|TIMER_BH
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|c0
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c0
op_amp
l_int|0x08
)paren
(brace
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;+&quot;
)paren
suffix:semicolon
multiline_comment|/* OK, connection established! */
id|snd-&gt;state
op_assign
id|PLIP_ST_LENGTH_LSB
suffix:semicolon
id|snd-&gt;nibble
op_assign
id|PLIP_NST_BEGIN
suffix:semicolon
id|snd-&gt;count
op_assign
l_int|0
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|PLIP_DELAY_UNIT
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|cx
op_eq
l_int|0
)paren
(brace
id|outb
c_func
(paren
l_int|0x00
comma
id|PAR_DATA
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_goto
id|try_again
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|PLIP_ST_LENGTH_LSB
suffix:colon
r_if
c_cond
(paren
id|plip_send
c_func
(paren
id|dev
comma
op_amp
id|snd-&gt;nibble
comma
id|snd-&gt;length
op_amp
l_int|0xff
)paren
)paren
multiline_comment|/* timeout */
r_goto
id|try_again
suffix:semicolon
id|snd-&gt;state
op_assign
id|PLIP_ST_LENGTH_MSB
suffix:semicolon
id|snd-&gt;nibble
op_assign
id|PLIP_NST_BEGIN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_ST_LENGTH_MSB
suffix:colon
r_if
c_cond
(paren
id|plip_send
c_func
(paren
id|dev
comma
op_amp
id|snd-&gt;nibble
comma
id|snd-&gt;length
op_rshift
l_int|8
)paren
)paren
multiline_comment|/* timeout */
r_goto
id|try_again
suffix:semicolon
id|snd-&gt;state
op_assign
id|PLIP_ST_DATA
suffix:semicolon
id|snd-&gt;nibble
op_assign
id|PLIP_NST_BEGIN
suffix:semicolon
id|snd-&gt;byte
op_assign
l_int|0
suffix:semicolon
id|snd-&gt;checksum
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_ST_DATA
suffix:colon
r_if
c_cond
(paren
id|plip_send
c_func
(paren
id|dev
comma
op_amp
id|snd-&gt;nibble
comma
id|lbuf
(braket
id|snd-&gt;byte
)braket
)paren
)paren
multiline_comment|/* timeout */
r_goto
id|try_again
suffix:semicolon
id|snd-&gt;nibble
op_assign
id|PLIP_NST_BEGIN
suffix:semicolon
id|snd-&gt;checksum
op_add_assign
id|lbuf
(braket
id|snd-&gt;byte
)braket
suffix:semicolon
id|snd-&gt;byte
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|snd-&gt;byte
op_eq
id|snd-&gt;length
)paren
id|snd-&gt;state
op_assign
id|PLIP_ST_CHECKSUM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_ST_CHECKSUM
suffix:colon
r_if
c_cond
(paren
id|plip_send
c_func
(paren
id|dev
comma
op_amp
id|snd-&gt;nibble
comma
id|snd-&gt;checksum
)paren
)paren
multiline_comment|/* timeout */
r_goto
id|try_again
suffix:semicolon
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
id|plip_device_clear
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;S(%4.4d)&quot;
comma
id|snd-&gt;length
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|snd-&gt;skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|stats-&gt;tx_packets
op_increment
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;plip: BAD STATE?? %04d&quot;
comma
id|snd-&gt;state
)paren
suffix:semicolon
id|plip_device_clear
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|try_again
suffix:colon
r_if
c_cond
(paren
op_increment
id|snd-&gt;count
OG
l_int|3
)paren
(brace
multiline_comment|/* timeout */
id|s
op_assign
id|PLIP_STATE_STRING
c_func
(paren
id|snd-&gt;state
)paren
suffix:semicolon
id|c0
op_assign
id|inb
c_func
(paren
id|PAR_STATUS
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|stats-&gt;tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: transmit timeout(%s,%02x)... reset interface.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|s
comma
(paren
r_int
r_int
)paren
id|c0
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|snd-&gt;skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|plip_error
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|s
op_assign
id|PLIP_STATE_STRING
c_func
(paren
id|snd-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;s%s&quot;
comma
id|s
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;interrupt
op_eq
l_int|0
)paren
(brace
multiline_comment|/* set timer */
id|lp-&gt;tl.expires
op_assign
l_int|1
suffix:semicolon
id|lp-&gt;tl.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|lp-&gt;tl.function
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
id|plip_send_packet
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|plip_config
r_static
r_int
id|plip_config
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;We could probe this for verification, but since they told us&n; *&t;to do it then they can suffer.&n; */
r_if
c_cond
(paren
id|map-&gt;base_addr
op_ne
(paren
r_int
r_int
)paren
op_minus
l_int|1
)paren
(brace
id|dev-&gt;base_addr
op_assign
id|map-&gt;base_addr
suffix:semicolon
)brace
r_if
c_cond
(paren
id|map-&gt;irq
op_ne
(paren
r_int
r_char
)paren
op_minus
l_int|1
)paren
(brace
id|dev-&gt;irq
op_assign
id|map-&gt;irq
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|plip_ioctl
r_static
r_int
id|plip_ioctl
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
)paren
(brace
r_struct
id|net_local
op_star
id|nl
op_assign
(paren
r_struct
id|net_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|plipconf
op_star
id|pc
op_assign
(paren
r_struct
id|plipconf
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_switch
c_cond
(paren
id|pc-&gt;pcmd
)paren
(brace
r_case
id|PLIP_GET_TIMEOUT
suffix:colon
id|pc-&gt;trigger
op_assign
id|nl-&gt;trigger_us
suffix:semicolon
id|pc-&gt;nibble
op_assign
id|nl-&gt;nibble_us
suffix:semicolon
id|pc-&gt;unit
op_assign
id|nl-&gt;unit_us
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PLIP_SET_TIMEOUT
suffix:colon
id|nl-&gt;trigger_us
op_assign
id|pc-&gt;trigger
suffix:semicolon
id|nl-&gt;nibble_us
op_assign
id|pc-&gt;nibble
suffix:semicolon
id|nl-&gt;unit_us
op_assign
id|pc-&gt;unit
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
"&f;"
macro_line|#ifdef MODULE
DECL|variable|kernel_version
r_char
id|kernel_version
(braket
)braket
op_assign
id|UTS_RELEASE
suffix:semicolon
DECL|variable|dev_plip0
r_static
r_struct
id|device
id|dev_plip0
op_assign
(brace
l_string|&quot;plip0&quot;
multiline_comment|/*&quot;plip&quot;*/
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0x3BC
comma
l_int|5
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|plip_init
)brace
suffix:semicolon
DECL|variable|dev_plip1
r_static
r_struct
id|device
id|dev_plip1
op_assign
(brace
l_string|&quot;plip1&quot;
multiline_comment|/*&quot;plip&quot;*/
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0x378
comma
l_int|7
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|plip_init
)brace
suffix:semicolon
DECL|variable|dev_plip2
r_static
r_struct
id|device
id|dev_plip2
op_assign
(brace
l_string|&quot;plip2&quot;
multiline_comment|/*&quot;plip&quot;*/
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* memory */
l_int|0x278
comma
l_int|2
comma
multiline_comment|/* base, irq */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|plip_init
)brace
suffix:semicolon
r_int
DECL|function|init_module
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|err
op_assign
id|register_netdev
c_func
(paren
op_amp
id|dev_plip0
)paren
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
(paren
id|err
op_assign
id|register_netdev
c_func
(paren
op_amp
id|dev_plip1
)paren
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
(paren
id|err
op_assign
id|register_netdev
c_func
(paren
op_amp
id|dev_plip2
)paren
)paren
op_eq
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|EEXIST
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;plip devices already present. Module not loaded.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|MOD_IN_USE
)paren
id|printk
c_func
(paren
l_string|&quot;plip: device busy, remove delayed&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|unregister_netdev
c_func
(paren
op_amp
id|dev_plip0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_plip0.priv
)paren
(brace
id|kfree_s
c_func
(paren
id|dev_plip0.priv
comma
r_sizeof
(paren
r_struct
id|net_local
)paren
)paren
suffix:semicolon
id|dev_plip0.priv
op_assign
l_int|NULL
suffix:semicolon
)brace
id|unregister_netdev
c_func
(paren
op_amp
id|dev_plip1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_plip1.priv
)paren
(brace
id|kfree_s
c_func
(paren
id|dev_plip1.priv
comma
r_sizeof
(paren
r_struct
id|net_local
)paren
)paren
suffix:semicolon
id|dev_plip0.priv
op_assign
l_int|NULL
suffix:semicolon
)brace
id|unregister_netdev
c_func
(paren
op_amp
id|dev_plip2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_plip2.priv
)paren
(brace
id|kfree_s
c_func
(paren
id|dev_plip2.priv
comma
r_sizeof
(paren
r_struct
id|net_local
)paren
)paren
suffix:semicolon
id|dev_plip2.priv
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* MODULE */
"&f;"
multiline_comment|/*&n; * Local variables:&n; * compile-command: &quot;gcc -D__KERNEL__ -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer -c plip.c&quot;&n; * c-indent-level: 4&n; * c-continued-statement-offset: 4&n; * c-brace-offset: -4&n; * c-argdecl-indent: 4&n; * c-label-offset: -4&n; * version-control: t&n; * kept-new-versions: 10&n; * End:&n; */
eof
