multiline_comment|/*&n; *&t; Aironet 4500/4800 driver core&n; *&n; *&t;&t;Elmer Joandi, Januar 1999&n; *&t;&t;Copyright: &t;GPL&n; *&t;&n; *&n; *&t;Revision 0.1 ,started  30.12.1998&n; *&n; *&n; */
multiline_comment|/* CHANGELOG:&n; &t;march 99, stable version 2.0&n; &t;august 99, stable version 2.2&n; &t;november 99, integration with 2.3&n;&t;17.12.99: finally, got SMP near-correct. &n;&t;&t;timing issues remain- on SMP box its 15% slower on tcp&t;&n;&t;10.03.00 looks like softnet take us back to normal on SMP&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &quot;aironet4500.h&quot;
macro_line|#include &lt;linux/ip.h&gt;
DECL|variable|bap_sleep
r_int
id|bap_sleep
op_assign
l_int|10
suffix:semicolon
DECL|variable|bap_sleep_after_setup
r_int
id|bap_sleep_after_setup
op_assign
l_int|1
suffix:semicolon
DECL|variable|sleep_before_command
r_int
id|sleep_before_command
op_assign
l_int|1
suffix:semicolon
DECL|variable|bap_sleep_before_write
r_int
id|bap_sleep_before_write
op_assign
l_int|1
suffix:semicolon
DECL|variable|sleep_in_command
r_int
id|sleep_in_command
op_assign
l_int|1
suffix:semicolon
DECL|variable|both_bap_lock
r_int
id|both_bap_lock
suffix:semicolon
multiline_comment|/* activated at awc_init in this */
DECL|variable|bap_setup_spinlock
r_int
id|bap_setup_spinlock
suffix:semicolon
multiline_comment|/* file if numcpu &gt;1 */
DECL|variable|bap_sleep
id|EXPORT_SYMBOL
c_func
(paren
id|bap_sleep
)paren
suffix:semicolon
DECL|variable|bap_sleep_after_setup
id|EXPORT_SYMBOL
c_func
(paren
id|bap_sleep_after_setup
)paren
suffix:semicolon
DECL|variable|sleep_before_command
id|EXPORT_SYMBOL
c_func
(paren
id|sleep_before_command
)paren
suffix:semicolon
DECL|variable|bap_sleep_before_write
id|EXPORT_SYMBOL
c_func
(paren
id|bap_sleep_before_write
)paren
suffix:semicolon
DECL|variable|sleep_in_command
id|EXPORT_SYMBOL
c_func
(paren
id|sleep_in_command
)paren
suffix:semicolon
DECL|variable|both_bap_lock
id|EXPORT_SYMBOL
c_func
(paren
id|both_bap_lock
)paren
suffix:semicolon
DECL|variable|bap_setup_spinlock
id|EXPORT_SYMBOL
c_func
(paren
id|bap_setup_spinlock
)paren
suffix:semicolon
DECL|variable|awc_status_error_codes
r_struct
id|awc_strings
id|awc_status_error_codes
(braket
)braket
op_assign
id|awc_reply_error_strings
suffix:semicolon
DECL|variable|awc_command_names
r_struct
id|awc_strings
id|awc_command_names
(braket
)braket
op_assign
id|awc_command_name_strings
suffix:semicolon
DECL|variable|awc_link_status_names
r_struct
id|awc_strings
id|awc_link_status_names
(braket
)braket
op_assign
id|awc_link_status_strings
suffix:semicolon
DECL|variable|awc_rid_names
r_struct
id|awc_strings
id|awc_rid_names
(braket
)braket
op_assign
id|aironet4500_RID_Select_strings
suffix:semicolon
DECL|variable|awc_link_failure_reason_names
r_struct
id|awc_strings
id|awc_link_failure_reason_names
(braket
)braket
op_assign
id|IEEE_802_11_LINK_STATUS_FAILURE_REASON_STRINGS
suffix:semicolon
DECL|function|awc_print_string
r_const
r_char
op_star
(def_block
id|awc_print_string
c_func
(paren
r_struct
id|awc_strings
op_star
id|strings
comma
r_int
id|code
)paren
(brace
r_struct
id|awc_strings
op_star
id|str
op_assign
id|strings
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|str
(braket
id|i
)braket
dot
id|string
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|str
(braket
id|i
)braket
dot
id|par
op_eq
(paren
id|code
op_amp
id|str
(braket
id|i
)braket
dot
id|mask
)paren
)paren
(brace
r_return
id|str
(braket
id|i
)braket
dot
id|string
suffix:semicolon
)brace
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
suffix:semicolon
r_return
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
)brace
)def_block
suffix:semicolon
DECL|function|awc_dump_registers
r_int
(def_block
id|awc_dump_registers
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
macro_line|#ifdef AWC_DEBUG
r_int
id|i
suffix:semicolon
macro_line|#endif
r_int
id|status
op_assign
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
l_int|4
op_star
l_int|2
)paren
suffix:semicolon
r_int
id|r1
op_assign
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
l_int|5
op_star
l_int|2
)paren
suffix:semicolon
r_int
id|r2
op_assign
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
l_int|6
op_star
l_int|2
)paren
suffix:semicolon
r_int
id|r3
op_assign
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
l_int|7
op_star
l_int|2
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Command %s , result: %s, at memblk %x(RID %s) , offset %x &bslash;n&quot;
comma
id|awc_print_string
c_func
(paren
id|awc_command_names
comma
id|status
)paren
comma
id|awc_print_string
c_func
(paren
id|awc_status_error_codes
comma
id|r1
)paren
comma
id|r2
comma
id|awc_print_string
c_func
(paren
id|awc_rid_names
comma
id|r2
)paren
comma
id|r3
)paren
suffix:semicolon
macro_line|#ifdef AWC_DEBUG
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s aironet register dump &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%4x &quot;
comma
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|i
op_star
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%02x&quot;
comma
(paren
id|i
op_plus
l_int|1
)paren
op_star
l_int|2
)paren
suffix:semicolon
)brace
)brace
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; &bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
multiline_comment|/******************************&t;&t;COMMAND &t;******************/
r_inline
DECL|function|awc_command_busy_clear_wait
r_int
(def_block
id|awc_command_busy_clear_wait
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
singleline_comment|//&t;long long jiff = jiffies;
id|u16
id|active_interrupts
suffix:semicolon
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_command_busy_clear_wait &quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|awc_command_busy
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
(brace
r_if
c_cond
(paren
id|cnt
OG
l_int|1000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;awc command busy too long, clearing&bslash;n&quot;
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|awc_event_ack_ClrStckCmdBsy
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|ejected
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|cnt
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|awc_command_busy
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
(brace
singleline_comment|//if (jiffies - jiff &gt; (HZ/3)){
r_if
c_cond
(paren
id|cnt
OG
l_int|30000
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;awc command busy WAY too long, clearing&bslash;n&quot;
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|awc_event_ack_ClrStckCmdBsy
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|active_interrupts
op_assign
id|awc_event_status
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|awc_event_ack
c_func
(paren
id|dev-&gt;base_addr
comma
id|active_interrupts
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;BAD exit&bslash;n &quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|ejected
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit&bslash;n &quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_inline
r_int
r_int
DECL|function|awc_issue_command_and_block
(def_block
id|awc_issue_command_and_block
c_func
(paren
r_struct
id|awc_command
op_star
id|cmd
)paren
(brace
r_int
id|ticks
suffix:semicolon
r_int
r_int
id|jiff
suffix:semicolon
id|u16
id|enabled_interrupts
suffix:semicolon
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
singleline_comment|//     unsigned long flags;
id|jiff
op_assign
id|jiffies
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_issue_command_and_block &quot;
)paren
suffix:semicolon
id|AWC_LOCK_COMMAND_ISSUING
c_func
(paren
id|cmd-&gt;priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_command_busy_clear_wait
c_func
(paren
id|cmd-&gt;dev
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|sleep_before_command
)paren
suffix:semicolon
id|awc4500wout
c_func
(paren
id|cmd-&gt;port
comma
id|cmd-&gt;command
comma
id|cmd-&gt;par0
comma
id|cmd-&gt;par1
comma
id|cmd-&gt;par2
)paren
suffix:semicolon
singleline_comment|//     awc_dump_registers(cmd-&gt;dev);
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|sleep_in_command
)paren
suffix:semicolon
id|enabled_interrupts
op_assign
id|awc_ints_enabled
c_func
(paren
id|cmd-&gt;dev-&gt;base_addr
)paren
suffix:semicolon
id|awc_ints_enable
c_func
(paren
id|cmd-&gt;dev-&gt;base_addr
comma
id|enabled_interrupts
op_amp
op_complement
l_int|0x10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;enabled_interrupts
op_amp
l_int|0x10
)paren
(brace
id|cmd-&gt;priv-&gt;enabled_interrupts
op_and_assign
op_complement
l_int|0x10
suffix:semicolon
)brace
r_while
c_loop
(paren
id|awc_command_read
c_func
(paren
id|cmd-&gt;port
)paren
op_eq
id|cmd-&gt;command
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|awc_command_write
c_func
(paren
id|cmd-&gt;port
comma
id|cmd-&gt;command
)paren
suffix:semicolon
singleline_comment|//if ((jiffies - jiff) &gt; 2){
r_if
c_cond
(paren
id|cnt
OG
l_int|2000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; long wait with commmand reg busy in blocking command &bslash;n&quot;
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|cmd-&gt;dev
)paren
suffix:semicolon
r_goto
id|final
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;ejected
)paren
r_goto
id|final
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; issued &quot;
)paren
suffix:semicolon
id|ticks
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|awc_event_status_Cmd
c_func
(paren
id|cmd-&gt;port
)paren
op_eq
l_int|0
)paren
(brace
id|ticks
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|ticks
OG
l_int|100000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; long wait with commmand reg busy &bslash;n&quot;
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|cmd-&gt;dev
)paren
suffix:semicolon
r_goto
id|final
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|ticks
OG
l_int|500
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot; long wait after issue 10mks * %d &quot;
comma
id|ticks
)paren
suffix:semicolon
singleline_comment|//printk(&quot; long wait with command reg busy about ticks&bslash;n&quot;);
singleline_comment|// sti();
)brace
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;ejected
)paren
r_goto
id|final
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|sleep_in_command
)paren
suffix:semicolon
id|awc_read_response
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; resp read &bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_command_busy
c_func
(paren
id|cmd-&gt;port
)paren
)paren
id|awc_event_ack_ClrStckCmdBsy
c_func
(paren
id|cmd-&gt;port
)paren
suffix:semicolon
id|awc_event_ack_Cmd
c_func
(paren
id|cmd-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|sleep_in_command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;status
op_amp
l_int|0xff00
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; bad response to command %s, parameter %x &bslash;n&quot;
comma
id|awc_print_string
c_func
(paren
id|awc_command_names
comma
id|cmd-&gt;command
)paren
comma
id|cmd-&gt;par0
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|cmd-&gt;dev
)paren
suffix:semicolon
r_goto
id|final
suffix:semicolon
)brace
id|AWC_UNLOCK_COMMAND_ISSUING
c_func
(paren
id|cmd-&gt;priv
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|AWC_UNLOCK_COMMAND_ISSUING
c_func
(paren
id|cmd-&gt;priv
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_inline
r_int
r_int
DECL|function|awc_issue_command
(def_block
id|awc_issue_command
c_func
(paren
r_struct
id|awc_command
op_star
id|cmd
)paren
(brace
singleline_comment|//     long long jiff = jiffies;          
singleline_comment|//     unsigned short enabled_ints;               
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
singleline_comment|//&t;int i=0; 
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_issue_command&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmd
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;cmd == NULL in awc_issue_command&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|cmd-&gt;dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;cmd-&gt;dev == NULL in awc_issue_command&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|AWC_LOCK_COMMAND_ISSUING
c_func
(paren
id|cmd-&gt;priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_command_busy_clear_wait
c_func
(paren
id|cmd-&gt;dev
)paren
)paren
(brace
r_goto
id|final
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|cmd-&gt;priv-&gt;enabled_interrupts
op_amp
l_int|0x10
)paren
(brace
id|cmd-&gt;priv-&gt;enabled_interrupts
op_or_assign
l_int|0x10
suffix:semicolon
id|awc_ints_enable
c_func
(paren
id|cmd-&gt;port
comma
id|cmd-&gt;priv-&gt;enabled_interrupts
)paren
suffix:semicolon
)brace
id|cmd-&gt;priv-&gt;async_command_start
op_assign
id|jiffies
suffix:semicolon
id|cmd-&gt;priv-&gt;command_semaphore_on
op_increment
suffix:semicolon
id|awc4500wout
c_func
(paren
id|cmd-&gt;port
comma
id|cmd-&gt;command
comma
id|cmd-&gt;par0
comma
id|cmd-&gt;par1
comma
id|cmd-&gt;par2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|awc_command_read
c_func
(paren
id|cmd-&gt;port
)paren
op_eq
id|cmd-&gt;command
)paren
(brace
id|awc_command_write
c_func
(paren
id|cmd-&gt;port
comma
id|cmd-&gt;command
)paren
suffix:semicolon
singleline_comment|//if ((jiffies - jiff) &gt; 2){
r_if
c_cond
(paren
id|cnt
OG
l_int|2000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; long wait with commmand reg busy in async command &bslash;n&quot;
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|cmd-&gt;dev
)paren
suffix:semicolon
r_goto
id|final
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;ejected
)paren
r_goto
id|final
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
suffix:semicolon
id|cmd-&gt;priv-&gt;cmd
op_assign
op_star
id|cmd
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|AWC_UNLOCK_COMMAND_ISSUING
c_func
(paren
id|cmd-&gt;priv
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_inline
r_int
r_int
DECL|function|awc_issue_command_no_ack
(def_block
id|awc_issue_command_no_ack
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|com
comma
id|u16
id|par1
comma
id|u16
id|par2
comma
id|u16
id|par3
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|jiff
suffix:semicolon
id|jiff
op_assign
id|jiffies
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_issue_command_no_ack &quot;
)paren
suffix:semicolon
id|AWC_LOCK_COMMAND_ISSUING
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_command_busy_clear_wait
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;aironet4x00 no_ack command (reset) with stuck card &bslash;n&quot;
)paren
suffix:semicolon
)brace
id|awc4500wout
c_func
(paren
id|dev-&gt;base_addr
comma
id|com
comma
id|par1
comma
id|par2
comma
id|par3
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_while
c_loop
(paren
id|awc_event_status_Cmd
c_func
(paren
id|dev-&gt;base_addr
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|awc_command_read
c_func
(paren
id|dev-&gt;base_addr
)paren
op_eq
id|com
)paren
(brace
id|awc_command_write
c_func
(paren
id|dev-&gt;base_addr
comma
id|com
)paren
suffix:semicolon
)brace
singleline_comment|//if ((jiffies - jiff) &gt; 2){
r_if
c_cond
(paren
id|cnt
OG
l_int|2000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; long wait with commmand reg busy in noack command %d par %d %d %d&bslash;n&quot;
comma
id|com
comma
id|par1
comma
id|par2
comma
id|par3
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|dev
)paren
suffix:semicolon
r_goto
id|final
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;ejected
)paren
r_goto
id|final
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|awc_command_busy
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
id|awc_event_ack_ClrStckCmdBsy
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|AWC_UNLOCK_COMMAND_ISSUING
c_func
(paren
id|priv
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|AWC_UNLOCK_COMMAND_ISSUING
c_func
(paren
id|priv
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
suffix:semicolon
multiline_comment|/******************************** &t;BAP&t;*************************/
singleline_comment|// inline // too long for inline
DECL|function|awc_bap_setup
r_int
id|awc_bap_setup
c_func
(paren
r_struct
id|awc_command
op_star
id|cmd
)paren
(brace
r_int
id|status
suffix:semicolon
r_int
r_int
id|jiff
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|cleared
op_assign
l_int|0
suffix:semicolon
r_int
id|cycles
op_assign
l_int|0
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_bap_setup &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|bap_sleep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;ejected
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmd-&gt;bap
op_logical_or
op_logical_neg
(paren
id|cmd-&gt;lock_state
op_amp
(paren
id|AWC_BAP_SEMALOCKED
op_or
id|AWC_BAP_LOCKED
)paren
)paren
)paren
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;no bap or bap not locked cmd %d !!&quot;
comma
id|cmd-&gt;command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bap_setup_spinlock
)paren
id|my_spin_lock_irqsave
c_func
(paren
op_amp
id|cmd-&gt;priv-&gt;bap_setup_spinlock
comma
id|cmd-&gt;priv-&gt;bap_setup_spinlock_flags
)paren
suffix:semicolon
id|status
op_assign
id|AWC_IN
c_func
(paren
id|cmd-&gt;bap-&gt;offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
op_complement
l_int|0x2000
)paren
(brace
id|WAIT61x3
suffix:semicolon
id|status
op_assign
id|AWC_IN
c_func
(paren
id|cmd-&gt;bap-&gt;offset
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
op_complement
l_int|0x2000
)paren
(brace
id|WAIT61x3
suffix:semicolon
id|AWC_IN
c_func
(paren
id|cmd-&gt;dev-&gt;base_addr
op_plus
l_int|0x26
)paren
suffix:semicolon
id|AWC_OUT
c_func
(paren
id|cmd-&gt;dev-&gt;base_addr
op_plus
l_int|0x26
comma
l_int|0
)paren
suffix:semicolon
id|WAIT61x3
suffix:semicolon
id|udelay
c_func
(paren
l_int|60
)paren
suffix:semicolon
macro_line|#ifdef AWC_DEBUG
id|printk
c_func
(paren
l_string|&quot;b&quot;
)paren
suffix:semicolon
macro_line|#endif
id|status
op_assign
id|AWC_IN
c_func
(paren
id|cmd-&gt;bap-&gt;offset
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0xC000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bap entered with err or busy bit set %x &bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;bap-&gt;lock
op_ne
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bap lock bad same time %x&bslash;n&quot;
comma
id|cmd-&gt;bap-&gt;lock
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|cmd-&gt;dev
)paren
suffix:semicolon
singleline_comment|//&t;AWC_OUT(cmd-&gt;bap-&gt;offset, 0x800);
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|AWC_OUT
c_func
(paren
id|cmd-&gt;bap-&gt;select
comma
id|cmd-&gt;rid
)paren
suffix:semicolon
id|WAIT61x3
suffix:semicolon
id|AWC_OUT
c_func
(paren
id|cmd-&gt;bap-&gt;offset
comma
id|cmd-&gt;offset
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|WAIT61x3
suffix:semicolon
id|jiff
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|cycles
op_increment
suffix:semicolon
id|status
op_assign
id|AWC_IN
c_func
(paren
id|cmd-&gt;bap-&gt;offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|bap_sleep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;ejected
)paren
r_goto
id|ejected_unlock
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cycles
OG
l_int|10000
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;deadlock in bap&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|return_AWC_ERROR
suffix:semicolon
)brace
suffix:semicolon
id|status
op_assign
id|AWC_IN
c_func
(paren
id|cmd-&gt;bap-&gt;offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|AWC_BAP_BUSY
)paren
(brace
r_if
c_cond
(paren
id|cycles
op_mod
l_int|100
op_eq
l_int|99
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cleared
)paren
(brace
id|AWC_IN
c_func
(paren
id|cmd-&gt;dev-&gt;base_addr
op_plus
l_int|0x26
)paren
suffix:semicolon
id|AWC_OUT
c_func
(paren
id|cmd-&gt;dev-&gt;base_addr
op_plus
l_int|0x26
comma
l_int|0
)paren
suffix:semicolon
id|WAIT61x3
suffix:semicolon
id|cleared
op_assign
l_int|1
suffix:semicolon
)brace
id|AWC_OUT
c_func
(paren
id|cmd-&gt;bap-&gt;select
comma
id|cmd-&gt;rid
)paren
suffix:semicolon
id|WAIT61x3
suffix:semicolon
id|AWC_OUT
c_func
(paren
id|cmd-&gt;bap-&gt;offset
comma
id|cmd-&gt;offset
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifdef AWC_DEBUG
id|printk
c_func
(paren
l_string|&quot;B&quot;
)paren
suffix:semicolon
macro_line|#endif      
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|bap_sleep
)paren
suffix:semicolon
r_else
id|udelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
singleline_comment|//restart_timeout();
)brace
r_if
c_cond
(paren
id|jiffies
op_minus
id|jiff
OG
l_int|1
)paren
(brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; BAD BUSY  exit &bslash;n&quot;
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|cmd-&gt;dev
)paren
suffix:semicolon
r_goto
id|return_AWC_ERROR
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|AWC_BAP_DONE
)paren
(brace
id|WAIT61x3
suffix:semicolon
id|WAIT61x3
suffix:semicolon
id|WAIT61x3
suffix:semicolon
singleline_comment|//  if ((status &amp; 0xfff) != cmd-&gt;offset)
singleline_comment|//  &t;printk(KERN_ERR &quot;awcPBD %x &quot;,status);
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|bap_sleep_after_setup
)paren
suffix:semicolon
singleline_comment|// success
r_goto
id|return_AWC_SUCCESS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|AWC_BAP_ERR
)paren
(brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; BAD  exit &bslash;n&quot;
)paren
suffix:semicolon
singleline_comment|// invalid rid or offset
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bap setup error bit set for rid %x offset %x &bslash;n&quot;
comma
id|cmd-&gt;rid
comma
id|cmd-&gt;offset
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|cmd-&gt;dev
)paren
suffix:semicolon
r_goto
id|return_AWC_ERROR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|bap_sleep
)paren
suffix:semicolon
r_else
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
singleline_comment|// -- awc missed it, try again
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|AWC_OUT
c_func
(paren
id|cmd-&gt;bap-&gt;select
comma
id|cmd-&gt;rid
)paren
suffix:semicolon
id|WAIT61x3
suffix:semicolon
id|AWC_OUT
c_func
(paren
id|cmd-&gt;bap-&gt;offset
comma
id|cmd-&gt;offset
)paren
suffix:semicolon
id|WAIT61x3
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_minus
id|jiff
OG
id|HZ
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
(paren
id|AWC_BAP_ERR
op_or
id|AWC_BAP_DONE
op_or
id|AWC_BAP_BUSY
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;aironet4500: bap setup lock without any status bits set&quot;
)paren
suffix:semicolon
id|awc_dump_registers
c_func
(paren
id|cmd-&gt;dev
)paren
suffix:semicolon
r_goto
id|return_AWC_ERROR
suffix:semicolon
)brace
suffix:semicolon
)brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; WE MUST NOT BE HERE exit &bslash;n&quot;
)paren
suffix:semicolon
id|ejected_unlock
suffix:colon
r_if
c_cond
(paren
id|bap_setup_spinlock
)paren
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
id|cmd-&gt;priv-&gt;bap_setup_spinlock
comma
id|cmd-&gt;priv-&gt;bap_setup_spinlock_flags
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; ejected_unlock_exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
id|return_AWC_ERROR
suffix:colon
r_if
c_cond
(paren
id|bap_setup_spinlock
)paren
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
id|cmd-&gt;priv-&gt;bap_setup_spinlock
comma
id|cmd-&gt;priv-&gt;bap_setup_spinlock_flags
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; AWC_ERROR_exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
id|AWC_ERROR
suffix:semicolon
id|return_AWC_SUCCESS
suffix:colon
r_if
c_cond
(paren
id|bap_setup_spinlock
)paren
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
id|cmd-&gt;priv-&gt;bap_setup_spinlock
comma
id|cmd-&gt;priv-&gt;bap_setup_spinlock_flags
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
id|AWC_SUCCESS
suffix:semicolon
)brace
singleline_comment|// requires call to awc_bap_setup() first
r_inline
r_int
DECL|function|awc_bap_read
id|awc_bap_read
c_func
(paren
r_struct
id|awc_command
op_star
id|cmd
)paren
(brace
r_register
id|u16
id|len
suffix:semicolon
r_register
id|u16
op_star
id|buff
op_assign
(paren
id|u16
op_star
)paren
id|cmd-&gt;buff
suffix:semicolon
r_register
id|u16
id|port
op_assign
id|cmd-&gt;bap-&gt;data
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_bap_read &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmd-&gt;bap
op_logical_and
op_logical_neg
(paren
id|cmd-&gt;lock_state
op_amp
(paren
id|AWC_BAP_SEMALOCKED
op_or
id|AWC_BAP_LOCKED
)paren
)paren
)paren
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;no bap or bap not locked %d !!&quot;
comma
id|cmd-&gt;command
)paren
suffix:semicolon
id|cmd-&gt;len
op_assign
(paren
id|cmd-&gt;len
op_plus
l_int|1
)paren
op_amp
(paren
op_complement
l_int|1
)paren
suffix:semicolon
singleline_comment|// round up to even value
id|len
op_assign
id|cmd-&gt;len
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;ejected
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|bap_sleep_before_write
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
r_while
c_loop
(paren
id|len
op_decrement
OG
l_int|0
)paren
op_star
id|buff
op_increment
op_assign
id|AWC_IN
c_func
(paren
id|port
)paren
suffix:semicolon
r_else
r_while
c_loop
(paren
id|len
op_decrement
OG
l_int|0
)paren
(brace
op_star
id|buff
op_increment
op_assign
id|AWC_IN
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit  &bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;ejected
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
id|AWC_SUCCESS
suffix:semicolon
)brace
singleline_comment|// requires call to awc_bap_setup() first
r_inline
r_int
DECL|function|awc_bap_write
(def_block
id|awc_bap_write
c_func
(paren
r_struct
id|awc_command
op_star
id|cmd
)paren
(brace
r_register
id|u16
id|len
suffix:semicolon
r_register
id|u16
op_star
id|buff
op_assign
(paren
id|u16
op_star
)paren
id|cmd-&gt;buff
suffix:semicolon
r_register
id|u16
id|port
op_assign
id|cmd-&gt;bap-&gt;data
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_bap_write &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmd-&gt;bap
op_logical_and
op_logical_neg
(paren
id|cmd-&gt;lock_state
op_amp
(paren
id|AWC_BAP_SEMALOCKED
op_or
id|AWC_BAP_LOCKED
)paren
)paren
)paren
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;no bap or bap not locked %d !!&quot;
comma
id|cmd-&gt;command
)paren
suffix:semicolon
id|cmd-&gt;len
op_assign
(paren
id|cmd-&gt;len
op_plus
l_int|1
)paren
op_amp
(paren
op_complement
l_int|1
)paren
suffix:semicolon
singleline_comment|// round up to even value
id|len
op_assign
id|cmd-&gt;len
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;ejected
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
id|udelay
c_func
(paren
id|bap_sleep_before_write
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmd-&gt;priv-&gt;sleeping_bap
)paren
r_while
c_loop
(paren
id|len
op_decrement
OG
l_int|0
)paren
id|AWC_OUT
c_func
(paren
id|port
comma
op_star
id|buff
op_increment
)paren
suffix:semicolon
r_else
r_while
c_loop
(paren
id|len
op_decrement
OG
l_int|0
)paren
(brace
id|AWC_OUT
c_func
(paren
id|port
comma
op_star
id|buff
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd-&gt;priv-&gt;ejected
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit  &bslash;n&quot;
)paren
suffix:semicolon
r_return
id|AWC_SUCCESS
suffix:semicolon
)brace
)def_block
multiline_comment|/***************************** &t;RID READ/WRITE&t;********************/
DECL|variable|aironet4500_RID_Select_General_Config
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_General_Config
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF10
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;General Configuration&quot;
)brace
suffix:semicolon
singleline_comment|//        See notes General Configuration        Many configuration items.
DECL|variable|aironet4500_RID_Select_SSID_list
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_SSID_list
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF11
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;Valid SSID list&quot;
)brace
suffix:semicolon
singleline_comment|//          See notes Valid SSID list              List of SSIDs which the station may associate to.
DECL|variable|aironet4500_RID_Select_AP_list
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_AP_list
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF12
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;Valid AP list&quot;
)brace
suffix:semicolon
singleline_comment|//          See notes Valid AP list                List of APs which the station may associate to.
DECL|variable|aironet4500_RID_Select_Driver_name
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_Driver_name
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF13
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;Driver name&quot;
)brace
suffix:semicolon
singleline_comment|//          See notes Driver name                  The name and version of the driver (for debugging)
DECL|variable|aironet4500_RID_Select_Encapsulation
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_Encapsulation
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF14
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;Ethernet Protocol&quot;
)brace
suffix:semicolon
singleline_comment|//          See notes Ethernet Protocol            Rules for encapsulating ethernet payloads onto 802.11.
DECL|variable|aironet4500_RID_Select_WEP_volatile
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_WEP_volatile
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF15
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;WEP key volatile&quot;
)brace
suffix:semicolon
singleline_comment|//          
DECL|variable|aironet4500_RID_Select_WEP_nonvolatile
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_WEP_nonvolatile
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF16
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;WEP key non-volatile&quot;
)brace
suffix:semicolon
singleline_comment|//
DECL|variable|aironet4500_RID_Select_Modulation
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_Modulation
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF17
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;Modulation&quot;
)brace
suffix:semicolon
singleline_comment|//
DECL|variable|aironet4500_RID_Select_Active_Config
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_Active_Config
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF20
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_string|&quot;Actual Configuration&quot;
)brace
suffix:semicolon
singleline_comment|//          Read only      Actual Configuration    This has the same format as the General Configuration.
DECL|variable|aironet4500_RID_Select_Capabilities
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_Capabilities
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF00
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_string|&quot;Capabilities&quot;
)brace
suffix:semicolon
singleline_comment|//          Read Only      Capabilities            PC4500 Information
DECL|variable|aironet4500_RID_Select_AP_Info
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_AP_Info
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF01
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_string|&quot;AP Info&quot;
)brace
suffix:semicolon
singleline_comment|//          Read Only      AP Info                 Access Point Information
DECL|variable|aironet4500_RID_Select_Radio_Info
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_Radio_Info
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF02
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_string|&quot;Radio Info&quot;
)brace
suffix:semicolon
singleline_comment|//          Read Only      Radio Info              Radio Information -- note radio specific
DECL|variable|aironet4500_RID_Select_Status
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_Status
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF50
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_string|&quot;Status&quot;
)brace
suffix:semicolon
singleline_comment|//          Read Only      Status                  PC4500 Current Status Information
DECL|variable|aironet4500_RID_Select_16_stats
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_16_stats
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF60
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_string|&quot;Cumulative 16-bit Statistics&quot;
)brace
suffix:semicolon
singleline_comment|//          Read Only      16-bit Statistics       Cumulative 16-bit Statistics
DECL|variable|aironet4500_RID_Select_16_stats_delta
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_16_stats_delta
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF61
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_string|&quot;Delta 16-bit Statistics&quot;
)brace
suffix:semicolon
singleline_comment|//          Read Only      16-bit Statistics       Delta 16-bit Statistics (since last clear)
DECL|variable|aironet4500_RID_Select_16_stats_clear
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_16_stats_clear
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF62
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_string|&quot;Delta 16-bit Statistics and Clear&quot;
)brace
suffix:semicolon
singleline_comment|//          Read Only /    16-bit Statistics       Delta 16-bit Statistics and Clear
DECL|variable|aironet4500_RID_Select_32_stats
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_32_stats
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF68
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_string|&quot;Cumulative 32-bit Statistics&quot;
)brace
suffix:semicolon
singleline_comment|//          Read Only      32-bit Statistics       Cumulative 32-bit Statistics
DECL|variable|aironet4500_RID_Select_32_stats_delta
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_32_stats_delta
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF69
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_string|&quot;Delta 32-bit Statistics&quot;
)brace
suffix:semicolon
singleline_comment|//          Read Only      32-bit Statistics       Delta 32-bit Statistics (since last clear)
DECL|variable|aironet4500_RID_Select_32_stats_clear
r_const
r_struct
id|aironet4500_rid_selector
id|aironet4500_RID_Select_32_stats_clear
op_assign
(paren
r_const
r_struct
id|aironet4500_rid_selector
)paren
(brace
l_int|0xFF6A
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_string|&quot;Delta 32-bit Statistics and Clear&quot;
)brace
suffix:semicolon
singleline_comment|//          Read Only /    32-bit Statistics       Delta 32-bit Statistics and Clear
DECL|variable|aironet4500_RID_Select_General_Config
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_General_Config
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_SSID_list
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_SSID_list
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_AP_list
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_AP_list
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_Driver_name
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_Driver_name
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_Encapsulation
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_Encapsulation
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_WEP_volatile
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_WEP_volatile
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_WEP_nonvolatile
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_WEP_nonvolatile
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_Modulation
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_Modulation
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_Active_Config
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_Active_Config
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_Capabilities
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_Capabilities
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_AP_Info
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_AP_Info
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_Radio_Info
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_Radio_Info
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_Status
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_Status
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_16_stats
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_16_stats
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_16_stats_delta
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_16_stats_delta
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_16_stats_clear
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_16_stats_clear
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_32_stats
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_32_stats
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_32_stats_delta
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_32_stats_delta
)paren
suffix:semicolon
DECL|variable|aironet4500_RID_Select_32_stats_clear
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_RID_Select_32_stats_clear
)paren
suffix:semicolon
DECL|variable|awc_rids_temp
r_struct
id|awc_rid_dir
id|awc_rids_temp
(braket
)braket
op_assign
initialization_block
suffix:semicolon
r_int
DECL|function|awc_readrid
(def_block
id|awc_readrid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|aironet4500_RID
op_star
id|rid
comma
r_void
op_star
id|pBuf
)paren
(brace
r_struct
id|awc_command
id|cmd
suffix:semicolon
r_int
id|sleep_state
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_readrid &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rid-&gt;selector
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|AWC_INIT_COMMAND
c_func
(paren
id|AWC_NOT_CLI
comma
id|cmd
comma
id|dev
comma
l_int|0x21
comma
id|rid-&gt;selector-&gt;selector
comma
id|rid-&gt;selector-&gt;selector
comma
id|rid-&gt;offset
comma
(paren
id|rid-&gt;bits
op_div
l_int|8
)paren
comma
id|pBuf
)paren
suffix:semicolon
id|sleep_state
op_assign
id|cmd.priv-&gt;sleeping_bap
suffix:semicolon
id|cmd.priv-&gt;sleeping_bap
op_assign
l_int|1
suffix:semicolon
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
id|AWC_BAP_LOCK_NOT_CLI
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_setup
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_read
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|cmd.priv-&gt;sleeping_bap
op_assign
id|sleep_state
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|cmd.priv-&gt;sleeping_bap
op_assign
id|sleep_state
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
r_int
DECL|function|awc_writerid
(def_block
id|awc_writerid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|aironet4500_RID
op_star
id|rid
comma
r_void
op_star
id|pBuf
)paren
(brace
r_struct
id|awc_command
id|cmd
suffix:semicolon
r_int
id|sleep_state
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_writerid &quot;
)paren
suffix:semicolon
id|AWC_INIT_COMMAND
c_func
(paren
id|AWC_NOT_CLI
comma
id|cmd
comma
id|dev
comma
l_int|0x21
comma
id|rid-&gt;selector-&gt;selector
comma
id|rid-&gt;selector-&gt;selector
comma
id|rid-&gt;offset
comma
id|rid-&gt;bits
op_div
l_int|8
comma
id|pBuf
)paren
suffix:semicolon
id|sleep_state
op_assign
id|cmd.priv-&gt;sleeping_bap
suffix:semicolon
id|cmd.priv-&gt;sleeping_bap
op_assign
l_int|1
suffix:semicolon
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
id|AWC_BAP_LOCK_NOT_CLI
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_setup
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|cmd.command
op_assign
l_int|0x121
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|cmd.priv-&gt;sleeping_bap
op_assign
id|sleep_state
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|cmd.priv-&gt;sleeping_bap
op_assign
id|sleep_state
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
r_int
DECL|function|awc_readrid_dir
(def_block
id|awc_readrid_dir
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_rid_dir
op_star
id|rid
)paren
(brace
r_struct
id|awc_command
id|cmd
suffix:semicolon
r_int
id|sleep_state
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awcreadrid_dir &quot;
)paren
suffix:semicolon
id|AWC_INIT_COMMAND
c_func
(paren
id|AWC_NOT_CLI
comma
id|cmd
comma
id|dev
comma
l_int|0x21
comma
id|rid-&gt;selector-&gt;selector
comma
id|rid-&gt;selector-&gt;selector
comma
l_int|0
comma
id|rid-&gt;bufflen
comma
id|rid-&gt;buff
)paren
suffix:semicolon
id|sleep_state
op_assign
id|cmd.priv-&gt;sleeping_bap
suffix:semicolon
id|cmd.priv-&gt;sleeping_bap
op_assign
l_int|1
suffix:semicolon
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
id|AWC_BAP_LOCK_NOT_CLI
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_setup
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_read
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|cmd.priv-&gt;sleeping_bap
op_assign
id|sleep_state
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|cmd.priv-&gt;sleeping_bap
op_assign
id|sleep_state
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
r_int
DECL|function|awc_writerid_dir
(def_block
id|awc_writerid_dir
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_rid_dir
op_star
id|rid
)paren
(brace
r_struct
id|awc_command
id|cmd
suffix:semicolon
r_int
id|sleep_state
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_writerid_dir &quot;
)paren
suffix:semicolon
id|AWC_INIT_COMMAND
c_func
(paren
id|AWC_NOT_CLI
comma
id|cmd
comma
id|dev
comma
l_int|0x21
comma
id|rid-&gt;selector-&gt;selector
comma
id|rid-&gt;selector-&gt;selector
comma
l_int|0
comma
id|rid-&gt;bufflen
comma
(paren
(paren
r_char
op_star
)paren
id|rid-&gt;buff
)paren
)paren
suffix:semicolon
id|sleep_state
op_assign
id|cmd.priv-&gt;sleeping_bap
suffix:semicolon
id|cmd.priv-&gt;sleeping_bap
op_assign
l_int|1
suffix:semicolon
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
id|AWC_BAP_LOCK_NOT_CLI
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_setup
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|cmd.priv-&gt;sleeping_bap
op_assign
id|sleep_state
suffix:semicolon
id|cmd.command
op_assign
l_int|0x121
suffix:semicolon
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|cmd.priv-&gt;sleeping_bap
op_assign
id|sleep_state
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
DECL|variable|awc_readrid
id|EXPORT_SYMBOL
c_func
(paren
id|awc_readrid
)paren
suffix:semicolon
DECL|variable|awc_writerid
id|EXPORT_SYMBOL
c_func
(paren
id|awc_writerid
)paren
suffix:semicolon
DECL|variable|awc_readrid_dir
id|EXPORT_SYMBOL
c_func
(paren
id|awc_readrid_dir
)paren
suffix:semicolon
DECL|variable|awc_writerid_dir
id|EXPORT_SYMBOL
c_func
(paren
id|awc_writerid_dir
)paren
suffix:semicolon
multiline_comment|/*****************************&t;&t;STARTUP&t;&t;*******************/
r_inline
r_int
DECL|function|awc_issue_blocking_command
(def_block
id|awc_issue_blocking_command
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|comm
)paren
(brace
r_struct
id|awc_command
id|cmd
suffix:semicolon
singleline_comment|//&t;  struct awc_private * priv = (struct awc_private *)dev-&gt;priv;
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_issue_blocking_command &quot;
)paren
suffix:semicolon
id|AWC_INIT_COMMAND
c_func
(paren
id|AWC_NOT_CLI
comma
id|cmd
comma
id|dev
comma
id|comm
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|AWC_BAP_LOCK_NOT_CLI
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_int
DECL|function|awc_issue_soft_reset
(def_block
id|awc_issue_soft_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u16
id|status
suffix:semicolon
singleline_comment|//&t;int i= 0;
multiline_comment|/*&t;outw(inw(dev-&gt;base_addr + 0x30), dev-&gt;base_addr + 0x32);&n;&t;udelay(10);&n;&t;outw(inw(dev-&gt;base_addr + 0x30), dev-&gt;base_addr + 0x34);&n;&n;&t;for (i=0; i&lt; 32; i++)&n;&t;&t;outw(0,dev-&gt;base_addr + i*2);&n;&t;udelay(100);&n;&t;outw(0x6,dev-&gt;base_addr + 0x34);&n;&t;udelay(100);&n;&t;outw(0x6,dev-&gt;base_addr + 0x34);&n;&t;outw(0x6,dev-&gt;base_addr + 0x34);&n;                WAIT61x3;&n;&t;        AWC_IN(dev-&gt;base_addr + 0x26);&n;                AWC_OUT(dev-&gt;base_addr + 0x26, 0);    &n;&t;  &t;WAIT61x3;&n;&t;  &t;udelay(60);&n;&t;&n;&n;&t;outw(0x4, dev-&gt;base_addr);&n;&t;udelay(1000);&n;        WAIT61x3;&n;        AWC_IN(dev-&gt;base_addr + 0x26);&n;        AWC_OUT(dev-&gt;base_addr + 0x26, 0);    &n; &t;WAIT61x3;&n;&t;udelay(60);&n;*/
id|status
op_assign
id|awc_issue_command_no_ack
c_func
(paren
id|dev
comma
id|AWC_COMMAND_SOFT_RESET
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|//&t;awc_command_busy_clear_wait(dev);
r_return
id|status
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_int
DECL|function|awc_issue_noop
(def_block
id|awc_issue_noop
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|retval
suffix:semicolon
id|AWC_OUT
c_func
(paren
id|dev-&gt;base_addr
op_plus
l_int|0x28
comma
l_int|0
)paren
suffix:semicolon
id|AWC_OUT
c_func
(paren
id|dev-&gt;base_addr
op_plus
l_int|0x2A
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|retval
op_assign
id|awc_issue_blocking_command
c_func
(paren
id|dev
comma
id|AWC_COMMAND_NOOP
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
)def_block
suffix:semicolon
DECL|variable|awc_enable_MAC
id|EXPORT_SYMBOL
c_func
(paren
id|awc_enable_MAC
)paren
suffix:semicolon
r_int
DECL|function|awc_enable_MAC
(def_block
id|awc_enable_MAC
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_enable_MAC &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;mac_enabled
)paren
(brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; mac already enabled exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_blocking_command
c_func
(paren
id|dev
comma
id|AWC_COMMAND_ENABLE
)paren
)paren
(brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
id|priv-&gt;mac_enabled
op_assign
l_int|1
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
DECL|variable|awc_disable_MAC
id|EXPORT_SYMBOL
c_func
(paren
id|awc_disable_MAC
)paren
suffix:semicolon
r_int
DECL|function|awc_disable_MAC
(def_block
id|awc_disable_MAC
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_disable_MAC &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;mac_enabled
)paren
(brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; mac allready disabled exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_blocking_command
c_func
(paren
id|dev
comma
id|AWC_COMMAND_DISABLE
)paren
)paren
(brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|priv-&gt;mac_enabled
op_assign
l_int|0
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_int
DECL|function|awc_read_all_rids
(def_block
id|awc_read_all_rids
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|status
comma
id|i
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_read_all_rids &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWC_NOF_RIDS
op_logical_and
id|priv-&gt;rid_dir
(braket
id|i
)braket
dot
id|selector
suffix:semicolon
id|i
op_increment
)paren
(brace
id|status
op_assign
id|awc_readrid_dir
c_func
(paren
id|dev
comma
op_amp
id|priv-&gt;rid_dir
(braket
id|i
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
)brace
id|priv-&gt;rids_read
op_assign
l_int|1
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
r_int
DECL|function|awc_write_all_rids
(def_block
id|awc_write_all_rids
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
comma
id|status
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_write_all_rids &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
op_logical_and
id|i
OL
id|AWC_NOF_RIDS
op_logical_and
id|priv-&gt;rid_dir
(braket
id|i
)braket
dot
id|selector
suffix:semicolon
id|i
op_increment
)paren
(brace
id|status
op_assign
id|awc_writerid_dir
c_func
(paren
id|dev
comma
op_amp
id|priv-&gt;rid_dir
(braket
id|i
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
r_return
id|status
suffix:semicolon
)brace
)brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
multiline_comment|/**************************&t;FID QUEUES ****************************/
multiline_comment|/****************************&t;TX  ALLOC / DEALLOC &t;***************/
DECL|function|awc_tx_alloc
r_int
id|awc_tx_alloc
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_command
id|cmd
suffix:semicolon
r_int
id|k
op_assign
l_int|0
suffix:semicolon
r_int
id|tot
op_assign
l_int|0
suffix:semicolon
r_struct
id|awc_fid
op_star
id|fid
op_assign
l_int|NULL
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_tx_alloc &quot;
)paren
suffix:semicolon
id|AWC_INIT_COMMAND
c_func
(paren
id|AWC_NOT_CLI
comma
id|cmd
comma
id|dev
comma
l_int|0x0A
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|cmd.par0
op_assign
id|dev-&gt;mtu
op_plus
id|AWC_TX_HEAD_SIZE
op_plus
l_int|8
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;about to allocate %x bytes &quot;
comma
id|cmd.priv-&gt;large_buff_mem
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;in %x large buffers &quot;
comma
id|cmd.priv-&gt;large_buff_mem
op_div
(paren
id|dev-&gt;mtu
op_plus
id|AWC_TX_HEAD_SIZE
op_plus
l_int|8
)paren
)paren
suffix:semicolon
id|k
op_assign
l_int|0
suffix:semicolon
id|tot
op_assign
l_int|0
suffix:semicolon
id|AWC_BAP_LOCK_NOT_CLI
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_while
c_loop
(paren
id|k
OL
id|cmd.priv-&gt;large_buff_mem
op_div
(paren
id|dev-&gt;mtu
op_plus
id|AWC_TX_HEAD_SIZE
op_plus
l_int|8
)paren
)paren
(brace
id|fid
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|awc_fid
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fid
)paren
r_goto
id|final
suffix:semicolon
id|memset
c_func
(paren
id|fid
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|awc_fid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_while
c_loop
(paren
id|awc_event_status_Alloc
c_func
(paren
id|cmd.port
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|fid-&gt;u.tx.fid
op_assign
id|awc_Tx_Allocated_Fid
c_func
(paren
id|cmd.port
)paren
suffix:semicolon
id|fid-&gt;u.tx.fid_size
op_assign
id|dev-&gt;mtu
op_plus
id|AWC_TX_HEAD_SIZE
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;allocated large tx fid %x &quot;
comma
id|fid-&gt;u.tx.fid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fid-&gt;u.tx.fid
op_eq
l_int|0
op_logical_or
id|cmd.status
op_ne
l_int|0xA
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s bad tx_alloc&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|fid-&gt;busy
op_assign
l_int|1
suffix:semicolon
r_goto
id|final
suffix:semicolon
)brace
r_else
(brace
id|fid-&gt;busy
op_assign
l_int|0
suffix:semicolon
id|tot
op_increment
suffix:semicolon
)brace
id|awc_event_ack_Alloc
c_func
(paren
id|cmd.port
)paren
suffix:semicolon
singleline_comment|// shoudlnt goto final after that
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|cmd.priv-&gt;tx_large_ready
comma
id|fid
)paren
suffix:semicolon
id|k
op_increment
suffix:semicolon
)brace
id|cmd.priv-&gt;tx_buffs_total
op_assign
id|tot
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;allocated %d large tx buffs&bslash;n&quot;
comma
id|tot
)paren
suffix:semicolon
id|cmd.par0
op_assign
id|AWC_TX_ALLOC_SMALL_SIZE
suffix:semicolon
id|k
op_assign
l_int|0
suffix:semicolon
id|tot
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|k
OL
id|cmd.priv-&gt;small_buff_no
)paren
(brace
id|fid
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|awc_fid
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fid
)paren
r_goto
id|final
suffix:semicolon
id|memset
c_func
(paren
id|fid
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|awc_fid
)paren
)paren
suffix:semicolon
id|cmd.par0
op_assign
id|AWC_TX_ALLOC_SMALL_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_while
c_loop
(paren
id|awc_event_status_Alloc
c_func
(paren
id|cmd.port
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|fid-&gt;u.tx.fid
op_assign
id|awc_Tx_Allocated_Fid
c_func
(paren
id|cmd.port
)paren
suffix:semicolon
id|fid-&gt;u.tx.fid_size
op_assign
id|AWC_TX_ALLOC_SMALL_SIZE
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;allocated large tx fid %x &quot;
comma
id|fid-&gt;u.tx.fid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fid-&gt;u.tx.fid
op_eq
l_int|0
op_logical_or
id|cmd.status
op_ne
l_int|0xA
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s bad tx_alloc&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|fid-&gt;busy
op_assign
l_int|1
suffix:semicolon
r_goto
id|final
suffix:semicolon
)brace
r_else
(brace
id|fid-&gt;busy
op_assign
l_int|0
suffix:semicolon
id|tot
op_increment
suffix:semicolon
)brace
id|awc_event_ack_Alloc
c_func
(paren
id|cmd.port
)paren
suffix:semicolon
singleline_comment|// shoudlnt goto final after that
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|cmd.priv-&gt;tx_small_ready
comma
id|fid
)paren
suffix:semicolon
id|k
op_increment
suffix:semicolon
)brace
id|cmd.priv-&gt;tx_small_buffs_total
op_assign
id|tot
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;allocated %d small tx buffs&bslash;n&quot;
comma
id|tot
)paren
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
r_if
c_cond
(paren
id|fid
)paren
id|kfree
c_func
(paren
id|fid
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s awc tx prealloc failed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
suffix:semicolon
r_int
DECL|function|awc_tx_dealloc_fid
(def_block
id|awc_tx_dealloc_fid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_fid
op_star
id|fid
)paren
(brace
r_struct
id|awc_command
id|cmd
suffix:semicolon
r_int
id|fid_handle
op_assign
l_int|0
suffix:semicolon
id|AWC_INIT_COMMAND
c_func
(paren
id|AWC_NOT_CLI
comma
id|cmd
comma
id|dev
comma
l_int|0x0C
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|AWC_BAP_LOCK_NOT_CLI
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fid-&gt;u.tx.fid
)paren
(brace
id|fid_handle
op_assign
id|cmd.par0
op_assign
id|fid-&gt;u.tx.fid
suffix:semicolon
id|fid-&gt;u.tx.fid
op_assign
l_int|0
suffix:semicolon
id|fid-&gt;busy
op_assign
l_int|0
suffix:semicolon
id|kfree
c_func
(paren
id|fid
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmd.priv-&gt;ejected
)paren
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
singleline_comment|//awc_event_ack_Alloc(cmd.port);
)brace
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;awc_tx_dealloc failed for fid %x &bslash;n&quot;
comma
id|fid_handle
)paren
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_int
DECL|function|awc_tx_dealloc
(def_block
id|awc_tx_dealloc
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
singleline_comment|//&t;  int k=0;
r_struct
id|awc_fid
op_star
id|fid
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_tx_dealloc &quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|NULL
op_ne
(paren
id|fid
op_assign
id|awc_fid_queue_pop_head
c_func
(paren
op_amp
id|priv-&gt;tx_large_ready
)paren
)paren
)paren
id|awc_tx_dealloc_fid
c_func
(paren
id|dev
comma
id|fid
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|NULL
op_ne
(paren
id|fid
op_assign
id|awc_fid_queue_pop_head
c_func
(paren
op_amp
id|priv-&gt;tx_small_ready
)paren
)paren
)paren
id|awc_tx_dealloc_fid
c_func
(paren
id|dev
comma
id|fid
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|NULL
op_ne
(paren
id|fid
op_assign
id|awc_fid_queue_pop_head
c_func
(paren
op_amp
id|priv-&gt;tx_post_process
)paren
)paren
)paren
id|awc_tx_dealloc_fid
c_func
(paren
id|dev
comma
id|fid
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|NULL
op_ne
(paren
id|fid
op_assign
id|awc_fid_queue_pop_head
c_func
(paren
op_amp
id|priv-&gt;tx_in_transmit
)paren
)paren
)paren
id|awc_tx_dealloc_fid
c_func
(paren
id|dev
comma
id|fid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_inline
r_struct
id|awc_fid
op_star
DECL|function|awc_tx_fid_lookup_and_remove
(def_block
id|awc_tx_fid_lookup_and_remove
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|fid_handle
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
singleline_comment|//&t;int k = 0;
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|awc_fid
op_star
id|fid
op_assign
l_int|NULL
suffix:semicolon
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_tx_fid_lookup &quot;
)paren
suffix:semicolon
id|my_spin_lock_irqsave
c_func
(paren
op_amp
(paren
id|priv-&gt;queues_lock
)paren
comma
id|flags
)paren
suffix:semicolon
id|fid
op_assign
id|priv-&gt;tx_in_transmit.head
suffix:semicolon
id|cnt
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|fid
)paren
(brace
r_if
c_cond
(paren
id|fid-&gt;u.tx.fid
op_eq
id|fid_handle
)paren
(brace
id|awc_fid_queue_remove
c_func
(paren
op_amp
id|priv-&gt;tx_in_transmit
comma
id|fid
)paren
suffix:semicolon
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|priv-&gt;queues_lock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|fid
suffix:semicolon
)brace
id|fid
op_assign
id|fid-&gt;next
suffix:semicolon
singleline_comment|//&t;printk(&quot;iT&bslash;n&quot;);
r_if
c_cond
(paren
id|cnt
op_increment
OG
l_int|200
)paren
(brace
singleline_comment|//&t;&t;printk(&quot;bbb in awc_fid_queue&bslash;n&quot;);
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|priv-&gt;queues_lock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
suffix:semicolon
)brace
suffix:semicolon
id|cnt
op_assign
l_int|0
suffix:semicolon
id|fid
op_assign
id|priv-&gt;tx_post_process.head
suffix:semicolon
r_while
c_loop
(paren
id|fid
)paren
(brace
r_if
c_cond
(paren
id|fid-&gt;u.tx.fid
op_eq
id|fid_handle
)paren
(brace
id|awc_fid_queue_remove
c_func
(paren
op_amp
id|priv-&gt;tx_post_process
comma
id|fid
)paren
suffix:semicolon
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|priv-&gt;queues_lock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|fid
suffix:semicolon
)brace
id|fid
op_assign
id|fid-&gt;next
suffix:semicolon
singleline_comment|//&t;printk(&quot;pp&bslash;n&quot;);
r_if
c_cond
(paren
id|cnt
op_increment
OG
l_int|200
)paren
(brace
singleline_comment|//&t;&t;printk(&quot;bbb in awc_fid_queue&bslash;n&quot;);
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|priv-&gt;queues_lock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
suffix:semicolon
)brace
suffix:semicolon
id|cnt
op_assign
l_int|0
suffix:semicolon
id|fid
op_assign
id|priv-&gt;tx_large_ready.head
suffix:semicolon
r_while
c_loop
(paren
id|fid
)paren
(brace
r_if
c_cond
(paren
id|fid-&gt;u.tx.fid
op_eq
id|fid_handle
)paren
(brace
id|awc_fid_queue_remove
c_func
(paren
op_amp
id|priv-&gt;tx_large_ready
comma
id|fid
)paren
suffix:semicolon
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|priv-&gt;queues_lock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|fid
suffix:semicolon
)brace
id|fid
op_assign
id|fid-&gt;next
suffix:semicolon
singleline_comment|//&t;printk(&quot;lr&bslash;n&quot;);
r_if
c_cond
(paren
id|cnt
op_increment
OG
l_int|200
)paren
(brace
singleline_comment|//&t;&t;printk(&quot;bbb in awc_fid_queue&bslash;n&quot;);
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|priv-&gt;queues_lock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
suffix:semicolon
)brace
suffix:semicolon
id|cnt
op_assign
l_int|0
suffix:semicolon
id|fid
op_assign
id|priv-&gt;tx_small_ready.head
suffix:semicolon
r_while
c_loop
(paren
id|fid
)paren
(brace
r_if
c_cond
(paren
id|fid-&gt;u.tx.fid
op_eq
id|fid_handle
)paren
(brace
id|awc_fid_queue_remove
c_func
(paren
op_amp
id|priv-&gt;tx_small_ready
comma
id|fid
)paren
suffix:semicolon
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|priv-&gt;queues_lock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|fid
suffix:semicolon
)brace
id|fid
op_assign
id|fid-&gt;next
suffix:semicolon
singleline_comment|//&t;printk(&quot;sr&bslash;n&quot;);
r_if
c_cond
(paren
id|cnt
op_increment
OG
l_int|200
)paren
(brace
singleline_comment|//&t;&t;printk(&quot;bbb in awc_fid_queue&bslash;n&quot;);
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|priv-&gt;queues_lock
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
suffix:semicolon
)brace
suffix:semicolon
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
(paren
id|priv-&gt;queues_lock
)paren
comma
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s tx fid %x not found &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|fid_handle
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)def_block
r_int
DECL|function|awc_queues_init
(def_block
id|awc_queues_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|awc_fid
op_star
id|fid
op_assign
l_int|NULL
suffix:semicolon
r_int
id|retv
op_assign
l_int|0
suffix:semicolon
r_int
id|k
op_assign
l_int|0
suffix:semicolon
id|awc_fid_queue_init
c_func
(paren
op_amp
id|priv-&gt;tx_in_transmit
)paren
suffix:semicolon
id|awc_fid_queue_init
c_func
(paren
op_amp
id|priv-&gt;tx_post_process
)paren
suffix:semicolon
id|awc_fid_queue_init
c_func
(paren
op_amp
id|priv-&gt;tx_large_ready
)paren
suffix:semicolon
id|awc_fid_queue_init
c_func
(paren
op_amp
id|priv-&gt;tx_small_ready
)paren
suffix:semicolon
id|awc_fid_queue_init
c_func
(paren
op_amp
id|priv-&gt;rx_ready
)paren
suffix:semicolon
id|awc_fid_queue_init
c_func
(paren
op_amp
id|priv-&gt;rx_post_process
)paren
suffix:semicolon
id|retv
op_assign
id|awc_tx_alloc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|k
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|k
OL
id|AWC_RX_BUFFS
)paren
(brace
id|fid
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|awc_fid
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|priv-&gt;rx_ready
comma
id|fid
)paren
suffix:semicolon
id|k
op_increment
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|retv
)paren
r_return
id|retv
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_int
DECL|function|awc_queues_destroy
(def_block
id|awc_queues_destroy
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|awc_fid
op_star
id|fid
op_assign
l_int|NULL
suffix:semicolon
r_int
id|retv
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|NULL
op_ne
(paren
id|fid
op_assign
id|awc_fid_queue_pop_head
c_func
(paren
op_amp
id|priv-&gt;rx_ready
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|fid
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|NULL
op_ne
(paren
id|fid
op_assign
id|awc_fid_queue_pop_head
c_func
(paren
op_amp
id|priv-&gt;rx_post_process
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|fid
)paren
suffix:semicolon
)brace
id|retv
op_assign
id|awc_tx_dealloc
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|retv
suffix:semicolon
)brace
)def_block
suffix:semicolon
multiline_comment|/****************************** &t;802.11router&t;******************/
r_inline
r_int
DECL|function|awc_802_11_copy_path_skb
(def_block
id|awc_802_11_copy_path_skb
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_fid
op_star
id|rx_buff
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;awc_802_11_copy_path_skb&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_buff-&gt;pkt_len
OL
l_int|22
)paren
id|rx_buff-&gt;pkt_len
op_assign
l_int|22
suffix:semicolon
singleline_comment|//&t;if (!rx_buff-&gt;skb)
id|rx_buff-&gt;skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|rx_buff-&gt;pkt_len
op_plus
l_int|12
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_buff-&gt;skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;couldnt alloc rx_buff-&gt;skb in rx event &bslash;n&quot;
)paren
suffix:semicolon
id|priv-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|rx_buff-&gt;type
op_or_assign
id|p80211copy_path_skb
suffix:semicolon
id|rx_buff-&gt;skb-&gt;dev
op_assign
id|dev
suffix:semicolon
singleline_comment|//&t;skb_reserve(rx_buff-&gt;skb, rx_buff-&gt;pkt_len + 12 );
id|rx_buff-&gt;u.rx.payload
op_assign
id|skb_put
c_func
(paren
id|rx_buff-&gt;skb
comma
id|rx_buff-&gt;pkt_len
op_plus
l_int|12
)paren
suffix:semicolon
id|rx_buff-&gt;u.rx.payload
op_assign
(paren
(paren
r_char
op_star
)paren
id|rx_buff-&gt;u.rx.payload
)paren
op_plus
l_int|12
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;exit&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_int
DECL|function|awc_802_11_find_copy_path
(def_block
id|awc_802_11_find_copy_path
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_fid
op_star
id|rx_buff
)paren
(brace
singleline_comment|//        struct awc_private * priv = (struct awc_private * )dev-&gt;priv;
singleline_comment|//        u8 is_802_3 = 0;
singleline_comment|//&t;int i = 0;
id|rx_buff-&gt;type
op_assign
l_int|0
suffix:semicolon
r_return
id|awc_802_11_copy_path_skb
c_func
(paren
id|dev
comma
id|rx_buff
)paren
suffix:semicolon
)brace
)def_block
suffix:semicolon
multiline_comment|/* &t;called from INTERRUPT context,&n;&n;&t;must deliver the packet to where it was meant by &n;&t;&t;awc_802_11_find_copy_path&n;&t;&n;&t;SHOULD be efficient and&n;&t;queue the packet if operations take longer&n;&n;*/
DECL|variable|parse_not_8023
r_int
id|parse_not_8023
suffix:semicolon
r_void
DECL|function|awc_802_11_router_rx
(def_block
id|awc_802_11_router_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_fid
op_star
id|rx_buff
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|rx_buff-&gt;skb
suffix:semicolon
id|u8
op_star
id|payload
op_assign
id|rx_buff-&gt;u.rx.payload
suffix:semicolon
singleline_comment|//&t;u8 * p802_3_macs_place = payload -12;
id|u16
id|pkt_len
op_assign
id|rx_buff-&gt;pkt_len
suffix:semicolon
r_struct
id|ieee_802_11_802_1H_header
op_star
id|bridge
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ieee_802_11_snap_header
op_star
id|snap
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ieee_802_11_802_1H_header
op_star
id|bridge_tmp
suffix:semicolon
r_struct
id|ieee_802_11_snap_header
op_star
id|snap_tmp
suffix:semicolon
id|u16
id|ptr
op_assign
l_int|0
suffix:semicolon
id|u16
id|len
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;awc_802_11_router_rx&quot;
)paren
suffix:semicolon
singleline_comment|//&t;if (rx_buff-&gt;type &amp; p80211_8023)
id|rx_buff-&gt;mac
op_assign
id|rx_buff-&gt;u.rx.ieee_802_3.dst_mac
suffix:semicolon
singleline_comment|//&t;else&t;
singleline_comment|//&t;&t;rx_buff-&gt;mac = rx_buff-&gt;u.rx.ieee_802_11.mac1;&t;
r_if
c_cond
(paren
id|rx_buff-&gt;u.rx.ieee_802_11.frame_control
op_eq
l_int|0x8
)paren
id|memcpy
c_func
(paren
id|priv-&gt;bssid
comma
id|rx_buff-&gt;u.rx.ieee_802_11.mac3
comma
l_int|6
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ptr
OL
id|pkt_len
op_minus
l_int|1
)paren
op_logical_and
id|payload
op_logical_and
id|parse_not_8023
)paren
(brace
id|bridge_tmp
op_assign
(paren
r_struct
id|ieee_802_11_802_1H_header
op_star
)paren
op_amp
id|payload
(braket
id|ptr
)braket
suffix:semicolon
id|snap_tmp
op_assign
(paren
r_struct
id|ieee_802_11_snap_header
op_star
)paren
op_amp
id|payload
(braket
id|ptr
)braket
suffix:semicolon
id|len
op_assign
id|ntohs
c_func
(paren
op_star
(paren
(paren
id|u16
op_star
)paren
op_amp
id|payload
(braket
id|ptr
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0x5DC
)paren
(brace
singleline_comment|// not a protocol
r_if
c_cond
(paren
id|len
op_ne
id|pkt_len
op_minus
l_int|2
op_minus
id|ptr
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s bad encapsulation lenght %x at pkt offset %x &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
comma
id|ptr
)paren
suffix:semicolon
r_goto
id|bad_packet
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;parisng packet of size %x&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;parisng packet of proto %x&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snap_tmp-&gt;dsap
op_eq
l_int|0xaa
op_logical_and
id|snap_tmp-&gt;ssap
op_eq
l_int|0xaa
op_logical_and
id|pkt_len
op_minus
id|ptr
OG
r_sizeof
(paren
r_struct
id|ieee_802_11_snap_header
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;%s SNAP &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snap_tmp-&gt;ctrl
op_ne
l_int|0x03
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s unknown snap ctrl %x &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|snap_tmp-&gt;ctrl
)paren
suffix:semicolon
r_goto
id|bad_packet
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|snap_tmp-&gt;oui
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_and
singleline_comment|// LLC RFC1042
id|snap_tmp-&gt;oui
(braket
l_int|1
)braket
op_eq
l_int|0
op_logical_and
id|snap_tmp-&gt;oui
(braket
l_int|2
)braket
op_eq
l_int|0
)paren
(brace
id|snap
op_assign
id|snap_tmp
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
r_struct
id|ieee_802_11_snap_header
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;%s LLC RFC1042 &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snap_tmp-&gt;oui
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_and
singleline_comment|// LLC 802.1H
id|snap_tmp-&gt;oui
(braket
l_int|1
)braket
op_eq
l_int|0
op_logical_and
id|snap_tmp-&gt;oui
(braket
l_int|2
)braket
op_eq
l_int|0x78
)paren
(brace
id|snap
op_assign
id|snap_tmp
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;%s LLC 802.1H &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|ptr
op_add_assign
r_sizeof
(paren
r_struct
id|ieee_802_11_snap_header
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|snap_tmp-&gt;oui
(braket
l_int|0
)braket
op_eq
l_int|0x00
op_logical_and
singleline_comment|// 802.1H itself
id|snap_tmp-&gt;oui
(braket
l_int|1
)braket
op_eq
l_int|0x40
op_logical_and
id|snap_tmp-&gt;oui
(braket
l_int|2
)braket
op_eq
l_int|0x96
)paren
(brace
id|ptr
op_add_assign
r_sizeof
(paren
r_struct
id|ieee_802_11_802_1H_header
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_ge
id|pkt_len
)paren
(brace
r_goto
id|bad_packet
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s invalid packet len in 802.1H SNAP OUI check &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;%s OUI 004096  &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot; 802.1H uknown1 %x  &quot;
comma
id|ntohs
c_func
(paren
id|bridge_tmp-&gt;unknown1
)paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot; 802.1H uknw type %x  &bslash;n&quot;
comma
l_int|0xf000
op_amp
id|ntohs
c_func
(paren
id|bridge_tmp-&gt;unknown2
)paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot; 802.1H payloadsize %x  &bslash;n&quot;
comma
l_int|0x0fff
op_amp
id|ntohs
c_func
(paren
id|bridge_tmp-&gt;unknown2
)paren
)paren
suffix:semicolon
singleline_comment|//goto bad_packet; // TODO
id|bridge
op_assign
id|bridge_tmp
suffix:semicolon
r_if
c_cond
(paren
id|bridge_tmp-&gt;unknown1
op_eq
l_int|0x0000
op_logical_and
(paren
(paren
id|ntohs
c_func
(paren
id|bridge_tmp-&gt;unknown2
)paren
op_amp
l_int|0xf000
)paren
op_eq
l_int|0x1000
)paren
)paren
(brace
id|rx_buff-&gt;type
op_or_assign
id|p80211_8021H
suffix:semicolon
id|rx_buff-&gt;mac
op_assign
op_amp
id|payload
(braket
id|ptr
)braket
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot; 802.1H DATA packet of size %x&bslash;n&quot;
comma
l_int|0xf000
op_amp
id|ntohs
c_func
(paren
id|bridge_tmp-&gt;unknown2
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;p2p
comma
id|rx_buff-&gt;u.rx.ieee_802_11.mac2
comma
l_int|6
)paren
suffix:semicolon
id|ptr
op_add_assign
l_int|12
suffix:semicolon
r_continue
suffix:semicolon
)brace
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;%s droping unknown  004096 packet &bslash;n &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|bad_packet
suffix:semicolon
)brace
r_goto
id|bad_packet
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OG
l_int|0x5DC
)paren
(brace
singleline_comment|// packet without linklevel header for us
r_if
c_cond
(paren
id|len
op_eq
l_int|0x8000
op_logical_or
id|len
op_eq
l_int|0x8006
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;Non IP packet %x &bslash;n&quot;
comma
id|ntohs
c_func
(paren
id|len
)paren
)paren
suffix:semicolon
)brace
suffix:semicolon
r_goto
id|good_packet
suffix:semicolon
)brace
suffix:semicolon
r_goto
id|good_packet
suffix:semicolon
)brace
id|good_packet
suffix:colon
r_if
c_cond
(paren
id|ptr
OG
id|pkt_len
)paren
r_goto
id|bad_packet
suffix:semicolon
r_if
c_cond
(paren
id|rx_buff-&gt;mac
op_ne
(paren
id|payload
op_plus
id|ptr
op_minus
l_int|12
)paren
)paren
id|memcpy
c_func
(paren
id|payload
op_plus
id|ptr
op_minus
l_int|12
comma
id|rx_buff-&gt;mac
comma
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|payload
op_logical_or
op_logical_neg
id|skb
op_logical_or
op_logical_neg
id|rx_buff-&gt;skb
op_logical_or
op_logical_neg
id|rx_buff-&gt;u.rx.payload
)paren
r_return
suffix:semicolon
singleline_comment|//skb-&gt;ip_summed = CHECKSUM_NONE;
id|skb-&gt;data
op_assign
id|payload
op_plus
id|ptr
op_minus
l_int|12
suffix:semicolon
id|skb-&gt;len
op_add_assign
id|ptr
suffix:semicolon
id|rx_buff-&gt;skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|rx_buff-&gt;skb
comma
id|dev
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;eth_type_trans decided: %x&bslash;n&quot;
comma
id|rx_buff-&gt;skb-&gt;protocol
)paren
suffix:semicolon
id|rx_buff-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|rx_buff-&gt;u.rx.payload
op_assign
l_int|NULL
suffix:semicolon
id|priv-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|priv-&gt;stats.rx_bytes
op_increment
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;exit&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
id|bad_packet
suffix:colon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;%s packet dropped in packet hdr parse &bslash;n &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_buff-&gt;skb
op_logical_and
(paren
id|rx_buff-&gt;type
op_amp
id|p80211copy_path_skb
)paren
)paren
(brace
id|dev_kfree_skb_irq
c_func
(paren
id|rx_buff-&gt;skb
)paren
suffix:semicolon
id|rx_buff-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|rx_buff-&gt;u.rx.payload
op_assign
l_int|NULL
suffix:semicolon
)brace
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;exit&bslash;n&quot;
)paren
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_void
DECL|function|awc_802_11_failed_rx_copy
(def_block
id|awc_802_11_failed_rx_copy
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_fid
op_star
id|rx_buff
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;awc_802_11_failed_rx_copy&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_buff-&gt;skb
)paren
id|dev_kfree_skb_irq
c_func
(paren
id|rx_buff-&gt;skb
)paren
suffix:semicolon
id|rx_buff-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|rx_buff-&gt;u.rx.payload
op_assign
l_int|NULL
suffix:semicolon
id|priv-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;exit&bslash;n&quot;
)paren
suffix:semicolon
)brace
)def_block
suffix:semicolon
multiline_comment|/*&n;&t;called from kernel-&gt;driver tx routine&n;&t;must decide where and how to post the packet &n;&t;must post the packet to wherever it decides&n;&t;either copy to card or enqueue to destination queue&n;&n;*/
r_int
DECL|function|awc_802_11_tx_find_path_and_post
(def_block
id|awc_802_11_tx_find_path_and_post
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|len
op_assign
id|ETH_ZLEN
OL
id|skb-&gt;len
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
suffix:semicolon
multiline_comment|/* check min length*/
r_struct
id|awc_fid
op_star
id|fid
op_assign
l_int|NULL
suffix:semicolon
singleline_comment|//&t;u16 saved_fid ;
id|u16
id|p2p_direct
op_assign
id|priv-&gt;p2p_found
suffix:semicolon
r_struct
id|iphdr
op_star
id|ip_hdr
suffix:semicolon
singleline_comment|//buffer = skb-&gt;data;
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;awc_802_11_tx_find_path_and_post&quot;
)paren
suffix:semicolon
singleline_comment|// netif_stop_queue(dev);
id|DOWN
c_func
(paren
op_amp
id|priv-&gt;tx_buff_semaphore
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|dev-&gt;mtu
op_plus
l_int|16
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s packet size too large %d &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
)paren
suffix:semicolon
r_goto
id|final
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_plus
id|AWC_TX_HEAD_SIZE
OL
id|AWC_TX_ALLOC_SMALL_SIZE
)paren
id|fid
op_assign
id|awc_fid_queue_pop_head
c_func
(paren
op_amp
id|priv-&gt;tx_small_ready
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fid
)paren
id|fid
op_assign
id|awc_fid_queue_pop_head
c_func
(paren
op_amp
id|priv-&gt;tx_large_ready
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fid
)paren
(brace
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;%s buffs in use &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|no_space
suffix:semicolon
)brace
multiline_comment|/*&n;&t;if (fid-&gt;u.tx.fid_size &lt; len + AWC_TX_HEAD_SIZE){&n;&t;&t;awc_fid_queue_push_tail(&amp;priv-&gt;tx_small_ready, fid);&n;&t;&t;fid = awc_fid_queue_pop_head(&amp;priv-&gt;tx_large_ready);&n;&t;}&n;*/
r_if
c_cond
(paren
op_logical_neg
id|fid
)paren
(brace
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;%s buffs in use &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|no_space
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fid-&gt;u.tx.fid_size
OL
id|len
op_plus
id|AWC_TX_HEAD_SIZE
op_minus
l_int|14
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;found too small tx fid size %d, pktlen %d &bslash;n&quot;
comma
id|fid-&gt;u.tx.fid_size
comma
id|len
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|fid-&gt;u.tx.radio_tx
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|aironet4500_radio_tx_header
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|fid-&gt;u.tx.ieee_802_11
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ieee_802_11_header
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|fid-&gt;u.tx.ieee_802_3
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ieee_802_3_header
)paren
)paren
suffix:semicolon
id|fid-&gt;u.tx.payload
op_assign
l_int|NULL
suffix:semicolon
id|fid-&gt;u.tx.gap_length
op_assign
l_int|0
suffix:semicolon
id|fid-&gt;busy
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;tx_buffs_in_use
op_increment
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;found large buff %x &bslash;n&quot;
comma
id|fid-&gt;u.tx.fid
)paren
suffix:semicolon
multiline_comment|/*&n;&t;fid-&gt;type |= p80211_llc_snap;&n;&t;fid-&gt;snap.dsap = 0xaa; &n;&t;fid-&gt;snap.ssap = 0xaa; &n;&t;fid-&gt;snap.ctrl = 0x03;&t;&n;&t;fid-&gt;snap.oui[0] = 0x0;&n;&t;fid-&gt;snap.oui[1] = 0x0;&n;&t;fid-&gt;snap.oui[2] = 0x0;&n;*/
id|fid-&gt;skb
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;p2p_uc
op_logical_and
op_logical_neg
id|priv-&gt;p2p_found
)paren
(brace
singleline_comment|// we go without encapsulation to neighbour;
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|priv-&gt;p2p
(braket
id|i
)braket
op_ne
id|skb-&gt;data
(braket
id|i
)braket
)paren
(brace
id|p2p_direct
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;force_tx_rate
op_eq
l_int|2
op_logical_or
id|priv-&gt;force_tx_rate
op_eq
l_int|4
op_logical_or
id|priv-&gt;force_tx_rate
op_eq
l_int|11
op_logical_or
id|priv-&gt;force_tx_rate
op_eq
l_int|22
)paren
(brace
id|fid-&gt;u.tx.radio_tx.tx_bit_rate
op_assign
id|priv-&gt;force_tx_rate
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|priv-&gt;force_tx_rate
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;wrong force_tx_rate=%d changed to default &bslash;n&quot;
comma
id|priv-&gt;force_tx_rate
)paren
suffix:semicolon
id|priv-&gt;force_tx_rate
op_assign
l_int|0
suffix:semicolon
)brace
suffix:semicolon
id|fid-&gt;u.tx.radio_tx.TX_Control
op_assign
id|aironet4500_tx_control_tx_ok_event_enable
op_or
id|aironet4500_tx_control_tx_fail_event_enable
op_or
id|aironet4500_tx_control_no_release
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|priv-&gt;force_rts_on_shorter
)paren
(brace
id|fid-&gt;u.tx.radio_tx.TX_Control
op_or_assign
id|aironet4500_tx_control_use_rts
suffix:semicolon
)brace
suffix:semicolon
id|ip_hdr
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|skb-&gt;data
)paren
op_plus
l_int|14
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ip_hdr
op_logical_and
id|skb-&gt;data
(braket
l_int|12
)braket
op_eq
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|ip_hdr-&gt;tos
op_amp
id|IPTOS_RELIABILITY
op_logical_and
id|priv-&gt;ip_tos_reliability_rts
)paren
id|fid-&gt;u.tx.radio_tx.TX_Control
op_or_assign
id|aironet4500_tx_control_use_rts
suffix:semicolon
r_if
c_cond
(paren
id|ip_hdr-&gt;tos
op_amp
id|IPTOS_THROUGHPUT
op_logical_and
id|priv-&gt;ip_tos_troughput_no_retries
)paren
id|fid-&gt;u.tx.radio_tx.TX_Control
op_or_assign
id|aironet4500_tx_control_no_retries
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;p802_11_send
op_logical_or
id|memcmp
c_func
(paren
id|dev-&gt;dev_addr
comma
id|skb-&gt;data
op_plus
l_int|6
comma
l_int|6
)paren
)paren
(brace
id|fid-&gt;u.tx.radio_tx.TX_Control
op_or_assign
id|aironet4500_tx_control_header_type_802_11
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;%s bridging, forcing 802_11 send &bslash;n &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;p2p_uc
op_logical_or
id|p2p_direct
)paren
(brace
r_if
c_cond
(paren
(paren
id|fid-&gt;u.tx.radio_tx.TX_Control
op_amp
id|aironet4500_tx_control_header_type_802_11
)paren
)paren
(brace
singleline_comment|// including 802.3 header into 802.11 packet
id|fid-&gt;u.tx.radio_tx.PayloadLength
op_assign
id|len
op_minus
l_int|12
suffix:semicolon
id|fid-&gt;u.tx.ieee_802_3.payload_length
op_assign
id|len
op_minus
l_int|12
suffix:semicolon
id|fid-&gt;pkt_len
op_assign
id|len
op_minus
l_int|12
suffix:semicolon
id|fid-&gt;u.tx.payload
op_assign
id|skb-&gt;data
op_plus
l_int|12
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;simple_bridge
)paren
(brace
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac1
comma
id|skb-&gt;data
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac2
comma
id|skb-&gt;data
op_plus
l_int|6
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac3
comma
id|priv-&gt;status.CurrentBssid
comma
l_int|6
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac4
comma
l_int|0
comma
l_int|6
)paren
suffix:semicolon
id|fid-&gt;u.tx.ieee_802_11.frame_control
op_assign
l_int|0x8
suffix:semicolon
id|fid-&gt;u.tx.ieee_802_11.gapLen
op_assign
l_int|6
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac1
comma
id|skb-&gt;data
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac2
comma
id|dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac3
comma
id|skb-&gt;data
op_plus
l_int|6
comma
l_int|6
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac4
comma
l_int|0
comma
l_int|6
)paren
suffix:semicolon
id|fid-&gt;u.tx.ieee_802_11.frame_control
op_assign
l_int|0x108
suffix:semicolon
id|fid-&gt;u.tx.ieee_802_11.gapLen
op_assign
l_int|6
suffix:semicolon
)brace
)brace
r_else
(brace
singleline_comment|// plain old 802.3, with hdr copied
id|fid-&gt;u.tx.radio_tx.PayloadLength
op_assign
id|len
op_minus
l_int|12
suffix:semicolon
id|fid-&gt;u.tx.ieee_802_3.payload_length
op_assign
id|len
op_minus
l_int|12
suffix:semicolon
id|fid-&gt;pkt_len
op_assign
id|len
op_minus
l_int|12
suffix:semicolon
id|fid-&gt;u.tx.payload
op_assign
id|skb-&gt;data
op_plus
l_int|12
suffix:semicolon
)brace
suffix:semicolon
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_3.dst_mac
comma
id|skb-&gt;data
comma
l_int|12
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;%s tx simply 802.3 type &bslash;n &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// 802.1H bridgeing
id|fid-&gt;type
op_or_assign
id|p80211_8021H
suffix:semicolon
id|fid-&gt;bridge_size
op_assign
id|len
op_plus
r_sizeof
(paren
id|fid-&gt;bridge
)paren
suffix:semicolon
id|fid-&gt;bridge.dsap
op_assign
l_int|0xaa
suffix:semicolon
id|fid-&gt;bridge.ssap
op_assign
l_int|0xaa
suffix:semicolon
id|fid-&gt;bridge.ctrl
op_assign
l_int|0x03
suffix:semicolon
id|fid-&gt;bridge.oui
(braket
l_int|0
)braket
op_assign
l_int|0x0
suffix:semicolon
id|fid-&gt;bridge.oui
(braket
l_int|1
)braket
op_assign
l_int|0x40
suffix:semicolon
id|fid-&gt;bridge.oui
(braket
l_int|2
)braket
op_assign
l_int|0x96
suffix:semicolon
id|fid-&gt;bridge.unknown1
op_assign
l_int|0x0000
suffix:semicolon
id|fid-&gt;bridge.unknown2
op_assign
id|htons
c_func
(paren
(paren
id|len
)paren
op_amp
l_int|0x1000
)paren
suffix:semicolon
id|fid-&gt;u.tx.radio_tx.PayloadLength
op_assign
id|fid-&gt;bridge_size
op_plus
l_int|2
suffix:semicolon
id|fid-&gt;u.tx.ieee_802_3.payload_length
op_assign
id|fid-&gt;u.tx.radio_tx.PayloadLength
suffix:semicolon
id|fid-&gt;u.tx.payload
op_assign
id|skb-&gt;data
op_plus
l_int|12
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fid-&gt;u.tx.radio_tx.TX_Control
op_amp
id|aironet4500_tx_control_header_type_802_11
)paren
)paren
(brace
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac1
comma
id|priv-&gt;p2p
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac2
comma
id|skb-&gt;data
op_plus
l_int|6
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac3
comma
id|priv-&gt;bssid
comma
l_int|6
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fid-&gt;u.tx.ieee_802_11.mac4
comma
l_int|0
comma
l_int|6
)paren
suffix:semicolon
id|fid-&gt;u.tx.ieee_802_11.gapLen
op_assign
l_int|6
suffix:semicolon
id|fid-&gt;u.tx.ieee_802_11.frame_control
op_assign
l_int|0x8
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_3.dst_mac
comma
id|priv-&gt;p2p
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fid-&gt;u.tx.ieee_802_3.src_mac
comma
id|dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|fid-&gt;u.tx.payload
op_assign
id|skb-&gt;data
op_plus
l_int|2
op_plus
r_sizeof
(paren
id|fid-&gt;bridge
)paren
suffix:semicolon
id|fid-&gt;pkt_len
op_assign
id|len
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x200
comma
l_string|&quot;%s tx simply 802.1H type &bslash;n &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
suffix:semicolon
id|priv-&gt;stats.tx_bytes
op_add_assign
id|fid-&gt;u.tx.ieee_802_3.payload_length
suffix:semicolon
id|priv-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|priv-&gt;tx_in_transmit
comma
id|fid
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|awc_transmit_packet
c_func
(paren
id|dev
comma
id|fid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;tx_large_ready.size
op_le
l_int|2
op_logical_or
id|priv-&gt;tx_small_ready.size
op_le
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|UP
c_func
(paren
op_amp
id|priv-&gt;tx_buff_semaphore
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;exit&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|no_space
suffix:colon
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;%s tx buffs not found &bslash;n &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#ifdef AWC_DEBUG
singleline_comment|//&t;&t;printk(&quot;s&quot;);
macro_line|#endif
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
singleline_comment|//weell, here it must be set anyway and before
singleline_comment|//priv-&gt;stats.tx_fifo_errors++;
id|UP
c_func
(paren
op_amp
id|priv-&gt;tx_buff_semaphore
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;NoSpaceExit&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
id|final
suffix:colon
id|priv-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|UP
c_func
(paren
op_amp
id|priv-&gt;tx_buff_semaphore
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;BADExit&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)def_block
suffix:semicolon
multiline_comment|/*&n;&t;called from low level driver-&gt;card tx copy routine  &n;&t;probably wants to free skbuf if failed transmits won&squot;t be&n;&t;resubmitted to another device (if more than one path)&n;&t;or tried again (if tx buffer in card needs to be filled again)&n;*/
r_void
DECL|function|awc_802_11_after_tx_packet_to_card_write
(def_block
id|awc_802_11_after_tx_packet_to_card_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_fid
op_star
id|tx_buff
)paren
(brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;awc_802_11_after_tx_packet_to_card_write&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tx_buff
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s no damn tx_buff in awc_802_11_after_tx_packet_to_card_write &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|tx_buff-&gt;skb
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|tx_buff-&gt;skb
)paren
suffix:semicolon
id|tx_buff-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
)brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;exit&bslash;n&quot;
)paren
suffix:semicolon
)brace
)def_block
suffix:semicolon
multiline_comment|/*&n;        called from low level driver-&gt;card tx copy routine&n;        probably wants to free skbuf if failed writes won&squot;t be&n;        resubmitted to another device (if more than one path) &n;        or tried again (if tx buffer in card needs to be filled again)&n;*/
r_void
DECL|function|awc_802_11_after_failed_tx_packet_to_card_write
(def_block
id|awc_802_11_after_failed_tx_packet_to_card_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_fid
op_star
id|tx_buff
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;awc_802_11_after_failed_tx_packet_to_card_write&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tx_buff
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s no damn tx_buff in awc_802_11_after_failed_tx_packet_to_card_write &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|tx_buff-&gt;skb
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|tx_buff-&gt;skb
)paren
suffix:semicolon
id|tx_buff-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|tx_buff-&gt;busy
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s packet to card write failed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|awc_fid_queue_remove
c_func
(paren
op_amp
id|priv-&gt;tx_in_transmit
comma
id|tx_buff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_buff-&gt;u.tx.fid_size
op_le
id|AWC_TX_ALLOC_SMALL_SIZE
)paren
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|priv-&gt;tx_small_ready
comma
id|tx_buff
)paren
suffix:semicolon
r_else
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|priv-&gt;tx_large_ready
comma
id|tx_buff
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;exit&bslash;n&quot;
)paren
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_inline
r_void
DECL|function|awc_802_11_after_tx_complete
(def_block
id|awc_802_11_after_tx_complete
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_fid
op_star
id|tx_buff
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;awc_802_11_after_tx_complete&quot;
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|32
comma
l_string|&quot;tx complete status %x &bslash;n &quot;
comma
id|tx_buff-&gt;u.tx.radio_tx.Status
)paren
suffix:semicolon
macro_line|#ifdef AWC_DEBUG
r_if
c_cond
(paren
id|tx_buff-&gt;u.tx.radio_tx.Status
)paren
id|printk
c_func
(paren
l_string|&quot;tf%x &quot;
comma
id|tx_buff-&gt;u.tx.radio_tx.Status
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|tx_buff-&gt;u.tx.fid_size
op_le
id|AWC_TX_ALLOC_SMALL_SIZE
)paren
(brace
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|priv-&gt;tx_small_ready
comma
id|tx_buff
)paren
suffix:semicolon
id|priv-&gt;tx_small_buffs_in_use
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|priv-&gt;tx_large_ready
comma
id|tx_buff
)paren
suffix:semicolon
id|priv-&gt;tx_buffs_in_use
op_decrement
suffix:semicolon
)brace
id|tx_buff-&gt;busy
op_assign
l_int|0
suffix:semicolon
singleline_comment|//&t;netif_wake_queue (dev);
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;exit&bslash;n&quot;
)paren
suffix:semicolon
)brace
)def_block
suffix:semicolon
multiline_comment|/********************************&t;R X&t;***********************/
r_inline
r_int
DECL|function|awc_receive_packet
(def_block
id|awc_receive_packet
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_command
id|cmd
suffix:semicolon
id|u16
id|Fid
suffix:semicolon
singleline_comment|//    struct sk_buff *skb = NULL;
r_struct
id|awc_fid
op_star
id|rx_buff
suffix:semicolon
r_struct
id|awc_private
op_star
id|priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|rx_buff
op_assign
id|priv-&gt;rx_ready.head
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_receive_packet &quot;
)paren
suffix:semicolon
id|Fid
op_assign
id|awc_Rx_Fid
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot; RX FID  %x&t;&bslash;n&quot;
comma
id|Fid
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Fid
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;No RxFid when rx event &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|rx_buff
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;No rx_buff in rx event &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|rx_buff-&gt;type
op_assign
l_int|0
suffix:semicolon
id|AWC_INIT_COMMAND
c_func
(paren
id|AWC_CLI
comma
id|cmd
comma
id|dev
comma
l_int|0
comma
l_int|0
comma
id|Fid
comma
l_int|0
comma
l_int|0x14
comma
op_amp
(paren
id|rx_buff-&gt;u.rx.radio_rx
)paren
)paren
suffix:semicolon
singleline_comment|// header reading , order is important
id|AWC_BAP_LOCK_UNDER_CLI
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_setup
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_read
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;rx receive radio header, length %x &bslash;n&quot;
comma
id|rx_buff-&gt;u.rx.radio_rx.PayloadLength
)paren
suffix:semicolon
id|cmd.buff
op_assign
op_amp
(paren
id|rx_buff-&gt;u.rx.ieee_802_11
)paren
suffix:semicolon
id|cmd.len
op_assign
l_int|0x20
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_read
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;rx receive 802_11 header, framecontrol %x &bslash;n&quot;
comma
id|rx_buff-&gt;u.rx.ieee_802_11.frame_control
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_buff-&gt;u.rx.ieee_802_11.gapLen
OG
l_int|8
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: 802.11 gap lenght huge %d &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rx_buff-&gt;u.rx.ieee_802_11.gapLen
)paren
suffix:semicolon
r_goto
id|final
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;SeqCtl %x, 802_11 macs: &quot;
comma
id|rx_buff-&gt;u.rx.ieee_802_11.SeqCtl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_debug
op_amp
l_int|0x7000
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0x7000
comma
l_string|&quot; %s mac1 &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|DEBUG
c_func
(paren
l_int|0x7000
comma
l_string|&quot;%02x:&quot;
comma
(paren
(paren
r_int
r_char
)paren
id|rx_buff-&gt;u.rx.ieee_802_11.mac1
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x7000
comma
l_string|&quot; %s mac2 &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|DEBUG
c_func
(paren
l_int|0x7000
comma
l_string|&quot;%02x:&quot;
comma
(paren
(paren
r_int
r_char
)paren
id|rx_buff-&gt;u.rx.ieee_802_11.mac2
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x7000
comma
l_string|&quot; %s mac3 &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|DEBUG
c_func
(paren
l_int|0x7000
comma
l_string|&quot;%02x:&quot;
comma
(paren
(paren
r_int
r_char
)paren
id|rx_buff-&gt;u.rx.ieee_802_11.mac3
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x7000
comma
l_string|&quot; %s mac4 &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|DEBUG
c_func
(paren
l_int|0x7000
comma
l_string|&quot;%02x:&quot;
comma
(paren
(paren
r_int
r_char
)paren
id|rx_buff-&gt;u.rx.ieee_802_11.mac4
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;&bslash;n GapLen %d &quot;
comma
id|rx_buff-&gt;u.rx.ieee_802_11.gapLen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_buff-&gt;u.rx.ieee_802_11.gapLen
OG
l_int|0
)paren
(brace
id|cmd.buff
op_assign
id|rx_buff-&gt;u.rx.ieee_802_11.gap
suffix:semicolon
id|cmd.len
op_assign
id|rx_buff-&gt;u.rx.ieee_802_11.gapLen
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_read
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;rx receive gap header , gap length %x &bslash;n&quot;
comma
id|rx_buff-&gt;u.rx.gap_length
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rx_buff-&gt;u.rx.ieee_802_11.gapLen
suffix:semicolon
id|i
op_increment
)paren
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;%x&quot;
comma
(paren
(paren
r_int
r_char
)paren
id|rx_buff-&gt;u.rx.ieee_802_11.gap
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|priv-&gt;config.ReceiveMode
op_amp
id|RXMODE_DISABLE_802_3_HEADER
)paren
)paren
(brace
id|cmd.buff
op_assign
op_amp
(paren
id|rx_buff-&gt;u.rx.ieee_802_3
)paren
suffix:semicolon
id|cmd.len
op_assign
l_int|0x10
suffix:semicolon
id|rx_buff-&gt;type
op_or_assign
id|p80211_8023
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_read
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;rx receive 802_3 header, payload length %x &bslash;n&quot;
comma
id|rx_buff-&gt;u.rx.ieee_802_3.payload_length
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;&bslash;n 802_3 status %x &quot;
comma
id|rx_buff-&gt;u.rx.ieee_802_3.status
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot; RX payloadLen %x, dst,src: &quot;
comma
id|rx_buff-&gt;u.rx.ieee_802_3.payload_length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_debug
op_amp
l_int|0x7000
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%02x:&quot;
comma
(paren
(paren
r_int
r_char
)paren
id|rx_buff-&gt;u.rx.ieee_802_3.dst_mac
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%02x:&quot;
comma
(paren
(paren
r_int
r_char
)paren
id|rx_buff-&gt;u.rx.ieee_802_3.src_mac
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
)brace
suffix:semicolon
id|rx_buff-&gt;pkt_len
op_assign
id|rx_buff-&gt;u.rx.radio_rx.PayloadLength
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;config.OperatingMode
op_amp
id|MODE_LLC_HOST
)paren
id|rx_buff-&gt;type
op_or_assign
id|p80211_llc_snap
suffix:semicolon
r_if
c_cond
(paren
id|awc_802_11_find_copy_path
c_func
(paren
id|dev
comma
id|rx_buff
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|rx_buff-&gt;u.rx.payload
)paren
(brace
id|cmd.buff
op_assign
id|rx_buff-&gt;u.rx.payload
suffix:semicolon
id|cmd.len
op_assign
id|rx_buff-&gt;pkt_len
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_read
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;rx payload read %x &bslash;n&quot;
comma
id|rx_buff-&gt;u.rx.ieee_802_3.payload_length
)paren
suffix:semicolon
)brace
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;&bslash;n payload hdr %x &quot;
comma
id|rx_buff-&gt;u.rx.ieee_802_3.status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_debug
op_logical_and
id|rx_buff-&gt;u.rx.payload
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|20
suffix:semicolon
id|i
op_increment
)paren
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;%x&quot;
comma
(paren
(paren
r_int
r_char
)paren
id|rx_buff-&gt;u.rx.payload
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|128
comma
l_string|&quot;%c&quot;
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|awc_802_11_router_rx
c_func
(paren
id|dev
comma
id|rx_buff
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|awc_802_11_failed_rx_copy
c_func
(paren
id|dev
comma
id|rx_buff
)paren
suffix:semicolon
singleline_comment|// if (skb) dev_kfree_skb(skb, FREE_WRITE);
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_int
DECL|function|awc_transmit_packet
id|awc_transmit_packet
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_fid
op_star
id|tx_buff
)paren
(brace
r_struct
id|awc_command
id|cmd
suffix:semicolon
id|u16
id|size
suffix:semicolon
singleline_comment|//&t;unsigned long flags;
r_int
id|i
suffix:semicolon
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_transmit_packet &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;link_status_changed
)paren
(brace
id|priv-&gt;link_status_changed
op_assign
l_int|0
suffix:semicolon
id|awc_readrid_dir
c_func
(paren
id|dev
comma
op_amp
id|priv-&gt;rid_dir
(braket
l_int|7
)braket
)paren
suffix:semicolon
)brace
id|AWC_INIT_COMMAND
c_func
(paren
id|AWC_NOT_CLI
comma
id|cmd
comma
id|dev
comma
l_int|0xB
comma
id|tx_buff-&gt;u.tx.fid
comma
id|tx_buff-&gt;u.tx.fid
comma
l_int|0
comma
l_int|0x14
comma
op_amp
(paren
id|tx_buff-&gt;u.tx.radio_tx
)paren
)paren
suffix:semicolon
id|AWC_BAP_LOCK_NOT_CLI
c_func
(paren
id|cmd
)paren
suffix:semicolon
macro_line|#ifdef AWC_BY_BOOK
macro_line|#warning  By books is bad, AWC_BY_BOOK  
macro_line|#error cli sti bad here
r_if
c_cond
(paren
op_logical_neg
(paren
id|tx_buff-&gt;type
op_amp
(paren
id|p80211_llc_snap
op_or
id|p80211_8021H
)paren
)paren
op_logical_and
op_logical_neg
(paren
id|tx_buff-&gt;u.tx.radio_tx.TX_Control
op_amp
id|aironet4500_tx_control_header_type_802_11
)paren
)paren
(brace
id|cmd.buff
op_assign
op_amp
(paren
id|tx_buff-&gt;u.tx.radio_tx.TX_Control
)paren
suffix:semicolon
id|cmd.len
op_assign
l_int|0x2
suffix:semicolon
id|cmd.offset
op_assign
l_int|0x8
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_setup
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|cmd.buff
op_assign
op_amp
(paren
id|tx_buff-&gt;u.tx.ieee_802_3.payload_length
)paren
suffix:semicolon
id|cmd.len
op_assign
l_int|14
suffix:semicolon
id|cmd.offset
op_assign
l_int|0x36
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_setup
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif
r_if
c_cond
(paren
id|awc_bap_setup
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|64
comma
l_string|&quot; wrote radio tx header for fid %x &bslash;n&quot;
comma
id|tx_buff-&gt;u.tx.fid
)paren
suffix:semicolon
singleline_comment|// 802.11
id|cmd.buff
op_assign
op_amp
(paren
id|tx_buff-&gt;u.tx.ieee_802_11
)paren
suffix:semicolon
id|cmd.len
op_assign
l_int|0x20
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
singleline_comment|// Gap
r_if
c_cond
(paren
id|tx_buff-&gt;u.tx.ieee_802_11.gapLen
)paren
(brace
id|cmd.buff
op_assign
op_amp
(paren
id|tx_buff-&gt;u.tx.ieee_802_11.gap
)paren
suffix:semicolon
id|cmd.len
op_assign
id|tx_buff-&gt;u.tx.ieee_802_11.gapLen
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
)brace
singleline_comment|// 802.3
r_if
c_cond
(paren
op_logical_neg
(paren
id|tx_buff-&gt;u.tx.radio_tx.TX_Control
op_amp
id|aironet4500_tx_control_header_type_802_11
)paren
)paren
(brace
id|cmd.buff
op_assign
op_amp
(paren
id|tx_buff-&gt;u.tx.ieee_802_3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_debug
op_amp
l_int|0x7000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s TX dst &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
(paren
l_string|&quot;%02x:&quot;
comma
(paren
r_int
r_char
)paren
id|tx_buff-&gt;u.tx.ieee_802_3.dst_mac
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; src &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
(paren
l_string|&quot;%02x:&quot;
comma
(paren
r_int
r_char
)paren
id|tx_buff-&gt;u.tx.ieee_802_3.src_mac
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; &bslash;n &quot;
)paren
suffix:semicolon
)brace
id|cmd.len
op_assign
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|tx_buff-&gt;type
op_amp
id|p80211_llc_snap
)paren
(brace
id|cmd.buff
op_assign
op_amp
id|tx_buff-&gt;snap
suffix:semicolon
id|cmd.len
op_assign
r_sizeof
(paren
id|tx_buff-&gt;snap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|tx_buff-&gt;type
op_amp
id|p80211_8021H
)paren
(brace
id|size
op_assign
id|htons
c_func
(paren
id|tx_buff-&gt;bridge_size
)paren
suffix:semicolon
singleline_comment|//&t;size = tx_buff-&gt;bridge_size;// to seasure raw speed of f** UC  
id|cmd.buff
op_assign
op_amp
id|size
suffix:semicolon
id|cmd.len
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|cmd.buff
op_assign
op_amp
id|tx_buff-&gt;bridge
suffix:semicolon
id|cmd.len
op_assign
r_sizeof
(paren
id|tx_buff-&gt;bridge
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
)brace
suffix:semicolon
macro_line|#ifdef AWC_BY_BOOK&t;       &t; 
)brace
macro_line|#endif
id|cmd.buff
op_assign
id|tx_buff-&gt;u.tx.payload
suffix:semicolon
id|cmd.len
op_assign
id|tx_buff-&gt;pkt_len
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_write
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
singleline_comment|// locking probs,  these two lines below and above, swithc order 
r_if
c_cond
(paren
id|awc_issue_command_and_block
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final_unlocked
suffix:semicolon
id|tx_buff-&gt;transmit_start_time
op_assign
id|jiffies
suffix:semicolon
id|awc_802_11_after_tx_packet_to_card_write
c_func
(paren
id|dev
comma
id|tx_buff
)paren
suffix:semicolon
singleline_comment|// issue the transmit command
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|awc_802_11_after_failed_tx_packet_to_card_write
c_func
(paren
id|dev
comma
id|tx_buff
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s awc tx command failed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
id|final_unlocked
suffix:colon
id|awc_802_11_after_failed_tx_packet_to_card_write
c_func
(paren
id|dev
comma
id|tx_buff
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s awc tx command failed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
r_inline
r_int
DECL|function|awc_tx_complete_check
(def_block
id|awc_tx_complete_check
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_fid
op_star
id|fid
suffix:semicolon
r_struct
id|awc_command
id|cmd
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; entry awc_tx_complete_check &quot;
)paren
suffix:semicolon
id|fid
op_assign
id|awc_fid_queue_pop_head
c_func
(paren
op_amp
(paren
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tx_post_process
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fid
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;awc_tx_complete_check with empty queue &bslash;n &quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|64
comma
l_string|&quot; tx_complete fid %x &bslash;n&quot;
comma
id|fid-&gt;u.tx.fid
)paren
suffix:semicolon
id|AWC_INIT_COMMAND
c_func
(paren
id|AWC_NOT_CLI
comma
id|cmd
comma
id|dev
comma
l_int|0
comma
l_int|0
comma
id|fid-&gt;u.tx.fid
comma
l_int|0
comma
l_int|0x14
comma
op_amp
(paren
id|fid-&gt;u.tx.radio_tx
)paren
)paren
suffix:semicolon
id|fid-&gt;state
op_or_assign
id|awc_tx_fid_complete_read
suffix:semicolon
id|AWC_BAP_LOCK_NOT_CLI
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_setup
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
r_if
c_cond
(paren
id|awc_bap_read
c_func
(paren
op_amp
id|cmd
)paren
)paren
r_goto
id|final
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|awc_802_11_after_tx_complete
c_func
(paren
id|dev
comma
id|fid
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|awc_802_11_after_tx_complete
c_func
(paren
id|dev
comma
id|fid
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s awc_tx_complete_check failed &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|AWC_RELEASE_COMMAND
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;  BAD exit &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
suffix:semicolon
)brace
)def_block
DECL|macro|AWC_QUEUE_BH
mdefine_line|#define AWC_QUEUE_BH {&bslash;&n;&t;if (!priv-&gt;bh_active &amp;&amp; !priv-&gt;bh_running){&bslash;&n;&t;&t;priv-&gt;bh_active = 1;&bslash;&n;&t;&t;queue_task(&amp;priv-&gt;immediate_bh, &amp;tq_immediate);&bslash;&n;&t;&t;mark_bh(IMMEDIATE_BH);&bslash;&n;&t;}&bslash;&n;&t;}
r_void
DECL|function|awc_bh
(def_block
id|awc_bh
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|active_interrupts
suffix:semicolon
r_int
id|enabled_interrupts
suffix:semicolon
singleline_comment|//&t;u16&t;tx_status;
r_int
id|multi_ints
op_assign
l_int|0
suffix:semicolon
singleline_comment|//&t;u16&t;tx_fid = 0;
singleline_comment|//&t;unsigned long flags;
id|DEBUG
c_func
(paren
l_int|8
comma
l_string|&quot;awc_bh awoken on jiffie %ld &bslash;n&quot;
comma
id|jiffies
)paren
suffix:semicolon
id|priv-&gt;bh_running
op_assign
l_int|1
suffix:semicolon
id|active_interrupts
op_assign
id|awc_event_status
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|enabled_interrupts
op_assign
id|awc_ints_enabled
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|8
comma
l_string|&quot;awc_bh active ints %x &bslash;n&quot;
comma
id|active_interrupts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|priv-&gt;tx_chain_active
)paren
)paren
(brace
singleline_comment|//&t;&t;printk(KERN_ERR &quot;tx chain active in bh &bslash;n&quot;);
singleline_comment|//&t;&t;queue_task(&amp;priv-&gt;immediate_bh, &amp;tq_immediate);
r_goto
id|bad_end
suffix:semicolon
)brace
id|start
suffix:colon
r_if
c_cond
(paren
id|active_interrupts
op_eq
l_int|0xffff
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s device ejected in interrupt, disabling&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|netif_device_detach
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;command_semaphore_on
)paren
(brace
id|priv-&gt;command_semaphore_on
op_decrement
suffix:semicolon
id|AWC_UNLOCK_COMMAND_ISSUING
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
id|priv-&gt;tx_chain_active
op_assign
l_int|0
suffix:semicolon
r_goto
id|bad_end
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;unlock_command_postponed
)paren
(brace
id|priv-&gt;unlock_command_postponed
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;command_semaphore_on
)paren
(brace
id|awc_read_response
c_func
(paren
(paren
op_amp
id|priv-&gt;cmd
)paren
)paren
suffix:semicolon
id|priv-&gt;async_command_start
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;command_semaphore_on
)paren
(brace
id|priv-&gt;command_semaphore_on
op_decrement
suffix:semicolon
id|AWC_UNLOCK_COMMAND_ISSUING
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
)brace
)brace
suffix:semicolon
multiline_comment|/*        if ( active_interrupts &amp; 0x1 ){&n;&t;       &t;&t;awc_receive_packet(dev) ;&n;&t;&t;&t;awc_event_ack_Rx(dev-&gt;base_addr);&n;&t;&t;&t;priv-&gt;waiting_interrupts &amp;= ~0x1;&n;&t;}&n;*/
r_while
c_loop
(paren
id|priv-&gt;tx_post_process.size
)paren
r_if
c_cond
(paren
id|awc_tx_complete_check
c_func
(paren
id|dev
)paren
)paren
r_break
suffix:semicolon
id|active_interrupts
op_assign
id|awc_event_status
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;command_semaphore_on
op_logical_or
id|priv-&gt;tx_post_process.size
)paren
(brace
r_if
c_cond
(paren
id|multi_ints
op_increment
OL
l_int|10000
)paren
(brace
r_goto
id|start
suffix:semicolon
)brace
)brace
suffix:semicolon
id|priv-&gt;bh_active
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;bh_running
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_chain_active
op_assign
l_int|0
suffix:semicolon
id|bad_end
suffix:colon
singleline_comment|//&t;if (!priv-&gt;tx_chain_active) 
singleline_comment|//&t;&t;wake_up(&amp;priv-&gt;tx_chain_wait_queue);
id|priv-&gt;bh_running
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;bh_active
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_inline
r_int
DECL|function|awc_interrupt_process
(def_block
id|awc_interrupt_process
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
suffix:semicolon
r_int
id|active_interrupts
suffix:semicolon
r_int
id|enabled_interrupts
suffix:semicolon
id|u16
id|tx_status
suffix:semicolon
r_int
id|multi_ints
op_assign
l_int|0
suffix:semicolon
id|u16
id|tx_fid
op_assign
l_int|0
suffix:semicolon
singleline_comment|//&t;u16&t;ints_to_ack =0;
r_struct
id|awc_fid
op_star
id|fid
op_assign
l_int|NULL
suffix:semicolon
singleline_comment|//&t;int interrupt_reenter = 0;
singleline_comment|//&t;unsigned long flags;&t;
singleline_comment|//&t;save_flags(flags);
singleline_comment|//&t;cli();
singleline_comment|// here we need it, because on 2.3 SMP there are truly parallel irqs &t;
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot; entering interrupt handler %s &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;No dev in interrupt   &bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad_end
suffix:semicolon
)brace
suffix:semicolon
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;No PRIV in interrupt &bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad_end
suffix:semicolon
)brace
suffix:semicolon
id|enabled_interrupts
op_assign
id|awc_ints_enabled
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|active_interrupts
op_assign
id|awc_event_status
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;entry: processing interrupts waiting %x &bslash;n&quot;
comma
id|priv-&gt;waiting_interrupts
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;entry: processing interrupts active  %x &bslash;n&quot;
comma
id|active_interrupts
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;entry: processing interrupts enabled %x &bslash;n&quot;
comma
id|enabled_interrupts
)paren
suffix:semicolon
singleline_comment|//&t;printk(&quot;ikka interruptis&bslash;n&quot;);
id|priv-&gt;interrupt_count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;interrupt_count
OG
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot; interrupt count on&bslash;n &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;waiting_interrupts
op_amp
id|active_interrupts
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;double interrupt waiting %x active %x &bslash;n&quot;
comma
id|priv-&gt;waiting_interrupts
comma
id|active_interrupts
)paren
suffix:semicolon
singleline_comment|//       priv-&gt;waiting_interrupts |= active_interrupts;
id|start
suffix:colon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;Start processing int, times %d&bslash;n&quot;
comma
id|multi_ints
)paren
suffix:semicolon
r_if
c_cond
(paren
id|active_interrupts
op_eq
l_int|0xffff
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s device ejected, got interrupt, disabling&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
singleline_comment|//priv-&gt;
id|netif_device_detach
(paren
id|dev
)paren
suffix:semicolon
id|priv-&gt;ejected
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;bh_active
op_logical_or
id|priv-&gt;bh_running
)paren
(brace
id|priv-&gt;interrupt_count
op_decrement
suffix:semicolon
r_goto
id|bad_end
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|priv-&gt;command_semaphore_on
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ejected, last BH fired &bslash;n&quot;
)paren
suffix:semicolon
id|AWC_QUEUE_BH
suffix:semicolon
)brace
id|priv-&gt;interrupt_count
op_decrement
suffix:semicolon
r_goto
id|bad_end
suffix:semicolon
)brace
r_if
c_cond
(paren
id|active_interrupts
op_amp
l_int|0x100
)paren
(brace
id|awc_event_ack_Awaken
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s device awoke &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;waiting_interrupts
op_and_assign
op_complement
l_int|0x100
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|active_interrupts
op_amp
l_int|0x80
)paren
(brace
id|priv-&gt;link_status
op_assign
id|awc_Link_Status
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;link status changed %x &bslash;n&quot;
comma
id|priv-&gt;link_status
)paren
suffix:semicolon
id|awc_event_ack_Link
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|priv-&gt;waiting_interrupts
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;link_status
op_eq
l_int|0x400
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Associated&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Link status change : %s &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|awc_print_string
c_func
(paren
id|awc_link_status_names
comma
id|priv-&gt;link_status
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;link_status
op_amp
l_int|0x8100
op_logical_or
id|priv-&gt;link_status
op_amp
l_int|0x0100
op_logical_or
id|priv-&gt;link_status
op_amp
l_int|0x8200
op_logical_or
id|priv-&gt;link_status
op_amp
l_int|0x8400
op_logical_or
id|priv-&gt;link_status
op_amp
l_int|0x0300
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s Link status change reason : %s &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|awc_print_string
c_func
(paren
id|awc_link_failure_reason_names
comma
id|priv-&gt;link_status
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
)brace
)brace
suffix:semicolon
r_if
c_cond
(paren
id|active_interrupts
op_amp
l_int|0x10
op_amp
id|enabled_interrupts
)paren
(brace
singleline_comment|//&t;&t;printk(KERN_ERR &quot;cmd int shouldnt be active in interrupt routine&bslash;n&quot;);
id|awc_event_ack_Cmd
c_func
(paren
id|priv-&gt;cmd.port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;enabled_interrupts
op_amp
l_int|0x10
)paren
id|priv-&gt;enabled_interrupts
op_and_assign
op_complement
l_int|0x10
suffix:semicolon
id|enabled_interrupts
op_assign
id|awc_ints_enabled
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enabled_interrupts
op_amp
l_int|0x10
)paren
(brace
id|awc_ints_enable
c_func
(paren
id|dev-&gt;base_addr
comma
id|enabled_interrupts
op_amp
op_complement
l_int|0x10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;command_semaphore_on
)paren
(brace
id|priv-&gt;unlock_command_postponed
op_increment
suffix:semicolon
id|AWC_QUEUE_BH
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|active_interrupts
op_amp
l_int|0x10
)paren
op_logical_and
op_logical_neg
(paren
l_int|0x10
op_amp
id|enabled_interrupts
)paren
)paren
(brace
singleline_comment|//&t;&t;printk(KERN_ERR &quot;%s: aironet4500: cmd int shouldnt be active in interrupt routine&bslash;n&quot;,dev-&gt;name);
singleline_comment|//awc_event_ack_Cmd(priv-&gt;cmd.port);
)brace
singleline_comment|//&t;active_interrupts = awc_event_status(dev-&gt;base_addr);
id|tx_status
op_assign
id|active_interrupts
op_amp
l_int|0x6
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
)paren
(brace
id|tx_fid
op_assign
id|awc_Tx_Compl_Fid
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tx_fid
)paren
(brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|tx_fid
op_assign
id|awc_Tx_Compl_Fid
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|tx_fid
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;No tx fid when tx int active&bslash;n&quot;
)paren
suffix:semicolon
id|fid
op_assign
id|awc_tx_fid_lookup_and_remove
c_func
(paren
id|dev
comma
id|tx_fid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fid
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;process_tx_results
)paren
(brace
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|priv-&gt;tx_post_process
comma
id|fid
)paren
suffix:semicolon
id|AWC_QUEUE_BH
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|fid-&gt;u.tx.fid_size
op_le
id|AWC_TX_ALLOC_SMALL_SIZE
)paren
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|priv-&gt;tx_small_ready
comma
id|fid
)paren
suffix:semicolon
r_else
id|awc_fid_queue_push_tail
c_func
(paren
op_amp
id|priv-&gt;tx_large_ready
comma
id|fid
)paren
suffix:semicolon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;awc fid %x not found&bslash;n&quot;
comma
id|tx_fid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|2
)paren
(brace
id|awc_event_ack_Tx
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|priv-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|priv-&gt;waiting_interrupts
op_and_assign
op_complement
l_int|0x2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|4
)paren
(brace
id|priv-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|awc_event_ack_TxExc
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|priv-&gt;waiting_interrupts
op_and_assign
op_complement
l_int|0x4
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tx_status
op_amp
l_int|6
)paren
op_eq
l_int|6
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: both tx and txExc up&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
singleline_comment|//&t;active_interrupts = awc_event_status(dev-&gt;base_addr);
r_if
c_cond
(paren
id|active_interrupts
op_amp
l_int|0x1
)paren
(brace
id|awc_receive_packet
c_func
(paren
id|dev
)paren
suffix:semicolon
id|awc_event_ack_Rx
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
id|priv-&gt;waiting_interrupts
op_and_assign
op_complement
l_int|0x1
suffix:semicolon
)brace
id|active_interrupts
op_assign
id|awc_event_status
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|active_interrupts
op_amp
l_int|0x7
)paren
op_logical_and
op_logical_neg
id|priv-&gt;bh_active
op_logical_and
op_logical_neg
id|priv-&gt;bh_running
)paren
(brace
r_if
c_cond
(paren
id|multi_ints
op_increment
OL
l_int|5
)paren
r_goto
id|start
suffix:semicolon
)brace
r_if
c_cond
(paren
id|multi_ints
op_ge
l_int|5
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s multi_ints &gt; 5 interrupts still active %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|active_interrupts
)paren
suffix:semicolon
id|priv-&gt;interrupt_count
op_decrement
suffix:semicolon
id|awc_ints_enable
c_func
(paren
id|dev-&gt;base_addr
comma
l_int|0x0000
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0x8
comma
l_string|&quot; enabling ints in interrupt_process %x &bslash;n&quot;
comma
id|priv-&gt;enabled_interrupts
op_amp
op_complement
id|priv-&gt;waiting_interrupts
)paren
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; exit &bslash;n&quot;
)paren
suffix:semicolon
id|awc_ints_enable
c_func
(paren
id|dev-&gt;base_addr
comma
id|priv-&gt;enabled_interrupts
)paren
suffix:semicolon
singleline_comment|//end_here:
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
singleline_comment|//  &t;restore_flags(flags);
r_return
l_int|0
suffix:semicolon
id|bad_end
suffix:colon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot; bad_end exit &bslash;n&quot;
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
singleline_comment|//&t;restore_flags(flags);
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)def_block
suffix:semicolon
DECL|variable|aironet4500_core_version
r_static
r_const
r_char
op_star
id|aironet4500_core_version
op_assign
l_string|&quot;aironet4500.c v0.1 1/1/99 Elmer Joandi, elmer@ylenurme.ee.&bslash;n&quot;
suffix:semicolon
DECL|variable|aironet4500_devices
r_struct
id|net_device
op_star
id|aironet4500_devices
(braket
id|MAX_AWCS
)braket
suffix:semicolon
DECL|variable|awc_debug
r_int
id|awc_debug
suffix:semicolon
singleline_comment|//  0xffffff;
DECL|variable|p802_11_send
r_static
r_int
id|p802_11_send
suffix:semicolon
singleline_comment|// 1
DECL|variable|awc_process_tx_results
r_static
r_int
id|awc_process_tx_results
suffix:semicolon
DECL|variable|tx_queue_len
r_int
id|tx_queue_len
op_assign
l_int|10
suffix:semicolon
DECL|variable|tx_rate
r_int
id|tx_rate
suffix:semicolon
DECL|variable|channel
r_int
id|channel
op_assign
l_int|5
suffix:semicolon
singleline_comment|//static int tx_full_rate;
DECL|variable|max_mtu
r_int
id|max_mtu
op_assign
l_int|2312
suffix:semicolon
DECL|variable|adhoc
r_int
id|adhoc
suffix:semicolon
DECL|variable|large_buff_mem
r_int
id|large_buff_mem
op_assign
l_int|1700
op_star
l_int|10
suffix:semicolon
DECL|variable|small_buff_no
r_int
id|small_buff_no
op_assign
l_int|20
suffix:semicolon
DECL|variable|awc_full_stats
r_int
id|awc_full_stats
suffix:semicolon
DECL|variable|SSID
r_char
id|SSID
(braket
l_int|33
)braket
suffix:semicolon
DECL|variable|master
r_int
id|master
suffix:semicolon
DECL|variable|slave
r_int
id|slave
suffix:semicolon
DECL|variable|awc_simple_bridge
r_int
id|awc_simple_bridge
suffix:semicolon
singleline_comment|// int debug =0;
macro_line|#if LINUX_VERSION_CODE &gt;= 0x20100
id|MODULE_PARM
c_func
(paren
id|awc_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rx_queue_len
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|tx_rate
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|channel
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|tx_full_rate
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|adhoc
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|master
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|slave
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|awc_simple_bridge
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_mtu
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|large_buff_mem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|small_buff_no
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|SSID
comma
l_string|&quot;c33&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*EXPORT_SYMBOL(tx_queue_len);&n;EXPORT_SYMBOL(awc_debug);&n; */
DECL|variable|awc_init
id|EXPORT_SYMBOL
c_func
(paren
id|awc_init
)paren
suffix:semicolon
DECL|variable|awc_open
id|EXPORT_SYMBOL
c_func
(paren
id|awc_open
)paren
suffix:semicolon
DECL|variable|awc_close
id|EXPORT_SYMBOL
c_func
(paren
id|awc_close
)paren
suffix:semicolon
DECL|variable|awc_reset
id|EXPORT_SYMBOL
c_func
(paren
id|awc_reset
)paren
suffix:semicolon
DECL|variable|awc_config
id|EXPORT_SYMBOL
c_func
(paren
id|awc_config
)paren
suffix:semicolon
DECL|variable|aironet4500_devices
id|EXPORT_SYMBOL
c_func
(paren
id|aironet4500_devices
)paren
suffix:semicolon
DECL|variable|awc_debug
id|EXPORT_SYMBOL
c_func
(paren
id|awc_debug
)paren
suffix:semicolon
singleline_comment|//EXPORT_SYMBOL();
DECL|variable|awc_private_init
id|EXPORT_SYMBOL
c_func
(paren
id|awc_private_init
)paren
suffix:semicolon
DECL|variable|awc_tx_timeout
id|EXPORT_SYMBOL
c_func
(paren
id|awc_tx_timeout
)paren
suffix:semicolon
DECL|variable|awc_start_xmit
id|EXPORT_SYMBOL
c_func
(paren
id|awc_start_xmit
)paren
suffix:semicolon
singleline_comment|//EXPORT_SYMBOL(awc_rx);
DECL|variable|awc_interrupt
id|EXPORT_SYMBOL
c_func
(paren
id|awc_interrupt
)paren
suffix:semicolon
DECL|variable|awc_get_stats
id|EXPORT_SYMBOL
c_func
(paren
id|awc_get_stats
)paren
suffix:semicolon
DECL|variable|awc_change_mtu
id|EXPORT_SYMBOL
c_func
(paren
id|awc_change_mtu
)paren
suffix:semicolon
DECL|variable|awc_set_multicast_list
id|EXPORT_SYMBOL
c_func
(paren
id|awc_set_multicast_list
)paren
suffix:semicolon
DECL|variable|awc_proc_set_fun
id|EXPORT_SYMBOL
c_func
(paren
id|awc_proc_set_fun
)paren
suffix:semicolon
DECL|variable|awc_proc_unset_fun
id|EXPORT_SYMBOL
c_func
(paren
id|awc_proc_unset_fun
)paren
suffix:semicolon
DECL|variable|awc_register_proc
id|EXPORT_SYMBOL
c_func
(paren
id|awc_register_proc
)paren
suffix:semicolon
DECL|variable|awc_unregister_proc
id|EXPORT_SYMBOL
c_func
(paren
id|awc_unregister_proc
)paren
suffix:semicolon
multiline_comment|/***************************  RESET INIT CONFIG ***********************/
DECL|function|awc_reset
r_void
id|awc_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|jiff
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot; awc_reset dev %p &bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: awc_reset &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|awc_issue_soft_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|jiff
op_assign
id|jiffies
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_while
c_loop
(paren
id|awc_command_read
c_func
(paren
id|dev-&gt;base_addr
)paren
)paren
(brace
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_minus
id|jiff
OG
l_int|5
op_star
id|HZ
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s bad reset&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
suffix:semicolon
)brace
DECL|function|awc_config
r_int
id|awc_config
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
singleline_comment|//&t;struct awc_private *priv = (struct awc_private *)dev-&gt;priv;
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: awc_config &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_disable_MAC
c_func
(paren
id|dev
)paren
)paren
(brace
r_goto
id|final
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_write_all_rids
c_func
(paren
id|dev
)paren
)paren
(brace
r_goto
id|final
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_enable_MAC
c_func
(paren
id|dev
)paren
)paren
(brace
r_goto
id|final
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|variable|name
r_char
id|name
(braket
)braket
op_assign
l_string|&quot;ElmerLinux&quot;
suffix:semicolon
DECL|function|awc_init
r_int
(def_block
id|awc_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_const
r_char
op_star
id|radioType
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: awc_init &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* both_bap_lock decreases performance about 15% &n;&t; * but without it card gets screwed up &n;&t; */
macro_line|#ifdef CONFIG_SMP
r_if
c_cond
(paren
id|smp_num_cpus
OG
l_int|1
)paren
(brace
id|both_bap_lock
op_assign
l_int|1
suffix:semicolon
id|bap_setup_spinlock
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
singleline_comment|//awc_dump_registers(dev);
r_if
c_cond
(paren
id|adhoc
op_amp
op_logical_neg
id|max_mtu
)paren
id|max_mtu
op_assign
l_int|2250
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|max_mtu
)paren
id|max_mtu
op_assign
l_int|1500
suffix:semicolon
id|priv-&gt;sleeping_bap
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;enabled_interrupts
op_assign
id|awc_ints_enabled
c_func
(paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_issue_noop
c_func
(paren
id|dev
)paren
)paren
(brace
r_goto
id|final
suffix:semicolon
)brace
id|awc_ints_enable
c_func
(paren
id|dev-&gt;base_addr
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_disable_MAC
c_func
(paren
id|dev
)paren
)paren
(brace
r_goto
id|final
suffix:semicolon
)brace
singleline_comment|//&t;awc_rids_setup(dev);
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|AWC_NOF_RIDS
)paren
(brace
r_if
c_cond
(paren
id|awc_rids_temp
(braket
id|i
)braket
dot
id|selector
)paren
id|memcpy
c_func
(paren
op_amp
id|priv-&gt;rid_dir
(braket
id|i
)braket
comma
op_amp
id|awc_rids_temp
(braket
id|i
)braket
comma
r_sizeof
(paren
id|priv-&gt;rid_dir
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_else
id|priv-&gt;rid_dir
(braket
id|i
)braket
dot
id|selector
op_assign
l_int|NULL
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
singleline_comment|// following MUST be consistent with awc_rids in count and ordrering !!!
id|priv-&gt;rid_dir
(braket
l_int|0
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;config
suffix:semicolon
singleline_comment|// card RID mirrors
id|priv-&gt;rid_dir
(braket
l_int|1
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;SSIDs
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|2
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;fixed_APs
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|3
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;driver_name
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|4
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;enc_trans
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|5
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;general_config
suffix:semicolon
singleline_comment|//      &t;
id|priv-&gt;rid_dir
(braket
l_int|6
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;capabilities
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|7
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;status
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|8
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;AP
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|9
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;statistics
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|10
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;statistics_delta
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|11
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;statistics_delta_clear
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|12
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;wep_volatile
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|13
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;wep_nonvolatile
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|14
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;modulation
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|15
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;statistics16
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|16
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;statistics16_delta
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|17
)braket
dot
id|buff
op_assign
op_amp
id|priv-&gt;statistics16_delta_clear
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|0
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;config
)paren
suffix:semicolon
singleline_comment|// card RID mirrors
id|priv-&gt;rid_dir
(braket
l_int|1
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;SSIDs
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|2
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;fixed_APs
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|3
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;driver_name
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|4
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;enc_trans
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|5
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;general_config
)paren
suffix:semicolon
singleline_comment|//
id|priv-&gt;rid_dir
(braket
l_int|6
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;capabilities
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|7
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;status
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|8
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;AP
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|9
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;statistics
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|10
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;statistics_delta
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|11
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;statistics_delta_clear
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|12
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;wep_volatile
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|13
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;wep_nonvolatile
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|14
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;modulation
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|15
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;statistics16
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|16
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;statistics16_delta
)paren
suffix:semicolon
id|priv-&gt;rid_dir
(braket
l_int|17
)braket
dot
id|bufflen
op_assign
r_sizeof
(paren
id|priv-&gt;statistics16_delta_clear
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_read_all_rids
c_func
(paren
id|dev
)paren
)paren
(brace
r_goto
id|final
suffix:semicolon
)brace
id|priv-&gt;config.OperatingMode
op_assign
l_int|0
suffix:semicolon
singleline_comment|// MODE_LLC_HOST;
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;ReceiveMode %x &bslash;n&quot;
comma
id|priv-&gt;config.ReceiveMode
)paren
suffix:semicolon
singleline_comment|//&t;priv-&gt;config.ReceiveMode&t;=  RXMODE_DISABLE_802_3_HEADER;
r_if
c_cond
(paren
op_logical_neg
id|adhoc
)paren
id|priv-&gt;config.OperatingMode
op_assign
id|MODE_STA_ESS
suffix:semicolon
singleline_comment|//        priv-&gt;config.OperatingMode = MODE_AP;
singleline_comment|// Setting rates does not work with new hardware, use force_tx_rate via proc
singleline_comment|//&t;priv-&gt;config.Rates[0]&t;=0x82;
singleline_comment|//&t;priv-&gt;config.Rates[1]&t;=0x4;
singleline_comment|//&t;priv-&gt;config.Rates[2]&t;=tx_full_rate;
singleline_comment|//&t;priv-&gt;config.Rates[3]&t;=0;
singleline_comment|//&t;priv-&gt;config.Rates[4]&t;=0;
singleline_comment|//&t;priv-&gt;config.Rates[5]&t;=0;
singleline_comment|//&t;priv-&gt;config.Rates[6]&t;=0;
singleline_comment|//&t;priv-&gt;config.Rates[7]&t;=0;
id|priv-&gt;config.Channel
op_assign
id|channel
suffix:semicolon
r_if
c_cond
(paren
id|adhoc
op_logical_and
id|master
)paren
(brace
id|priv-&gt;config.JoinNetTimeout
op_assign
l_int|0x1
suffix:semicolon
singleline_comment|//0 is facotry default
)brace
r_else
r_if
c_cond
(paren
id|adhoc
op_logical_and
id|slave
)paren
(brace
singleline_comment|// by spec 0xffff, but, this causes immediate bad behaviour
singleline_comment|// firmware behvaiour changed somehere around ver 2??
id|priv-&gt;config.JoinNetTimeout
op_assign
l_int|0x7fff
suffix:semicolon
)brace
suffix:semicolon
singleline_comment|//&t;priv-&gt;config.AuthenticationType = 1;
id|priv-&gt;config.Stationary
op_assign
l_int|1
suffix:semicolon
singleline_comment|//&t;priv-&gt;config.ScanMode&t;= 1;
singleline_comment|//&t;priv-&gt;config.LinkLossDelay&t;= 100;
id|priv-&gt;config.FragmentThreshold
op_assign
l_int|1700
suffix:semicolon
id|priv-&gt;config.RtsThreshold
op_assign
l_int|1700
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;config.NodeName
comma
id|name
comma
l_int|10
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s supported Rates &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%x &quot;
comma
id|priv-&gt;capabilities.SupportedRates
(braket
id|i
)braket
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%c&quot;
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s default Rates &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%x &quot;
comma
id|priv-&gt;config.Rates
(braket
id|i
)braket
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%c&quot;
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
singleline_comment|// here we go, bad aironet
id|memset
c_func
(paren
op_amp
id|priv-&gt;SSIDs
comma
l_int|0
comma
r_sizeof
(paren
id|priv-&gt;SSIDs
)paren
)paren
suffix:semicolon
id|my_spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;queues_lock
)paren
suffix:semicolon
id|priv-&gt;SSIDs.ridLen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|SSID
)paren
(brace
id|priv-&gt;SSIDs.SSID
(braket
l_int|0
)braket
dot
id|SSID
(braket
l_int|0
)braket
op_assign
l_char|&squot;a&squot;
suffix:semicolon
id|priv-&gt;SSIDs.SSID
(braket
l_int|0
)braket
dot
id|SSID
(braket
l_int|1
)braket
op_assign
l_char|&squot;b&squot;
suffix:semicolon
id|priv-&gt;SSIDs.SSID
(braket
l_int|0
)braket
dot
id|SSID
(braket
l_int|2
)braket
op_assign
l_char|&squot;c&squot;
suffix:semicolon
id|priv-&gt;SSIDs.SSID
(braket
l_int|0
)braket
dot
id|lenght
op_assign
l_int|3
suffix:semicolon
)brace
r_else
(brace
r_int
id|sidlen
op_assign
id|strlen
c_func
(paren
id|SSID
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;SSIDs.SSID
(braket
l_int|0
)braket
dot
id|SSID
comma
id|SSID
comma
id|sidlen
)paren
suffix:semicolon
id|priv-&gt;SSIDs.SSID
(braket
l_int|0
)braket
dot
id|lenght
op_assign
id|sidlen
suffix:semicolon
)brace
suffix:semicolon
id|priv-&gt;SSIDs.SSID
(braket
l_int|1
)braket
dot
id|lenght
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;SSIDs.SSID
(braket
l_int|1
)braket
dot
id|SSID
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;SSIDs.SSID
(braket
l_int|1
)braket
dot
id|SSID
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;SSIDs.SSID
(braket
l_int|2
)braket
dot
id|lenght
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;SSIDs.SSID
(braket
l_int|2
)braket
dot
id|SSID
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;SSIDs.SSID
(braket
l_int|2
)braket
dot
id|SSID
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
singleline_comment|//&t;priv-&gt;enc_trans.rules[0].etherType= 0x0008;
singleline_comment|//&t;priv-&gt;enc_trans.rules[0].Action   = 1;        
id|memcpy
c_func
(paren
id|priv-&gt;config.StationMacAddress
comma
id|priv-&gt;capabilities.FactoryAddress
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|priv-&gt;config.StationMacAddress
comma
l_int|6
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: awc_init success &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;capabilities.RadioType
op_eq
l_int|1
)paren
id|radioType
op_assign
l_string|&quot;802.11 Frequency Hoping&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|priv-&gt;capabilities.RadioType
op_eq
l_int|2
)paren
id|radioType
op_assign
l_string|&quot;802.11 Direct Sequence&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|priv-&gt;capabilities.RadioType
op_eq
l_int|4
)paren
id|radioType
op_assign
l_string|&quot;LM2000&quot;
suffix:semicolon
r_else
id|radioType
op_assign
l_string|&quot;Multiple Radio Types&quot;
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %s %s found @ 0x%lx irq %d firmwareVersion %d &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|priv-&gt;capabilities.ProductName
comma
id|radioType
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;irq
comma
id|priv-&gt;capabilities.SoftwareVersion
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|final
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;aironet init failed &bslash;n&quot;
)paren
suffix:semicolon
r_return
id|NODEV
suffix:semicolon
)brace
)def_block
suffix:semicolon
DECL|function|awc_private_init
r_int
(def_block
id|awc_private_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: awc_private_init &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|memset
c_func
(paren
id|priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|awc_private
)paren
)paren
suffix:semicolon
id|my_spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;queues_lock
)paren
suffix:semicolon
id|priv-&gt;bap0.select
op_assign
id|dev-&gt;base_addr
op_plus
id|awc_Select0_register
suffix:semicolon
id|priv-&gt;bap0.offset
op_assign
id|dev-&gt;base_addr
op_plus
id|awc_Offset0_register
suffix:semicolon
id|priv-&gt;bap0.data
op_assign
id|dev-&gt;base_addr
op_plus
id|awc_Data0_register
suffix:semicolon
id|priv-&gt;bap0.lock
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;bap0.status
op_assign
l_int|0
suffix:semicolon
id|my_spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;bap0.spinlock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|priv-&gt;bap0.sem
)paren
suffix:semicolon
id|priv-&gt;bap1.select
op_assign
id|dev-&gt;base_addr
op_plus
id|awc_Select1_register
suffix:semicolon
id|priv-&gt;bap1.offset
op_assign
id|dev-&gt;base_addr
op_plus
id|awc_Offset1_register
suffix:semicolon
id|priv-&gt;bap1.data
op_assign
id|dev-&gt;base_addr
op_plus
id|awc_Data1_register
suffix:semicolon
id|priv-&gt;bap1.lock
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;bap1.status
op_assign
l_int|0
suffix:semicolon
id|my_spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;bap1.spinlock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|priv-&gt;bap1.sem
)paren
suffix:semicolon
id|priv-&gt;sleeping_bap
op_assign
l_int|1
suffix:semicolon
singleline_comment|//spinlock now&t;init_MUTEX(&amp;priv-&gt;command_semaphore);
id|my_spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;command_issuing_spinlock
)paren
suffix:semicolon
id|my_spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;both_bap_spinlock
)paren
suffix:semicolon
id|my_spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;bap_setup_spinlock
)paren
suffix:semicolon
id|my_spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;interrupt_spinlock
)paren
suffix:semicolon
id|priv-&gt;command_semaphore_on
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;unlock_command_postponed
op_assign
l_int|0
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|priv-&gt;immediate_bh.list
)paren
suffix:semicolon
id|priv-&gt;immediate_bh.sync
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;immediate_bh.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|awc_bh
suffix:semicolon
id|priv-&gt;immediate_bh.data
op_assign
id|dev
suffix:semicolon
id|priv-&gt;bh_running
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;bh_active
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_chain_active
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;enabled_interrupts
op_assign
l_int|0x00
suffix:semicolon
id|priv-&gt;waiting_interrupts
op_assign
l_int|0x00
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|priv-&gt;tx_buff_semaphore
)paren
suffix:semicolon
id|priv-&gt;tx_buffs_in_use
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_small_buffs_in_use
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;mac_enabled
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;link_status
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;large_buff_mem
op_assign
id|large_buff_mem
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;large_buff_mem
OL
id|max_mtu
op_plus
id|AWC_TX_HEAD_SIZE
op_plus
l_int|10
)paren
id|priv-&gt;large_buff_mem
op_assign
id|max_mtu
op_plus
id|AWC_TX_HEAD_SIZE
op_plus
l_int|10
suffix:semicolon
id|priv-&gt;small_buff_no
op_assign
id|small_buff_no
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;small_buff_no
OL
l_int|1
)paren
id|priv-&gt;small_buff_no
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;process_tx_results
op_assign
id|awc_process_tx_results
suffix:semicolon
singleline_comment|//init_waitqueue(&amp;priv-&gt;tx_chain_wait_queue);
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|priv-&gt;p2p
(braket
id|i
)braket
op_assign
l_int|0xff
suffix:semicolon
id|priv-&gt;bssid
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
singleline_comment|//&t;priv-&gt;p2p_uc &t;&t;=1;
id|priv-&gt;p2p_found
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;p802_11_send
op_assign
id|p802_11_send
suffix:semicolon
id|priv-&gt;full_stats
op_assign
id|awc_full_stats
suffix:semicolon
id|priv-&gt;simple_bridge
op_assign
id|awc_simple_bridge
suffix:semicolon
id|priv-&gt;force_rts_on_shorter
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;force_tx_rate
op_assign
id|tx_rate
suffix:semicolon
id|priv-&gt;ip_tos_reliability_rts
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;ip_tos_troughput_no_retries
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;ejected
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;interrupt_count
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
multiline_comment|/****************************&t;OPEN&t;CLOSE&t;**********************/
DECL|function|awc_open
r_int
id|awc_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: awc_open &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awc_queues_init
c_func
(paren
id|dev
)paren
)paren
(brace
r_goto
id|final
suffix:semicolon
)brace
r_if
c_cond
(paren
id|awc_config
c_func
(paren
id|dev
)paren
)paren
(brace
r_goto
id|final
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|priv-&gt;config.StationMacAddress
comma
l_int|6
)paren
suffix:semicolon
id|priv-&gt;enabled_interrupts
op_assign
l_int|0x87
suffix:semicolon
id|awc_ints_enable
c_func
(paren
id|dev-&gt;base_addr
comma
id|priv-&gt;enabled_interrupts
)paren
suffix:semicolon
singleline_comment|//&t;priv-&gt;p8022_client &t;= register_8022_client;
singleline_comment|//&t;priv-&gt;snap_client&t;= register_snap_client;&t;
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: opened &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;sleeping_bap
op_assign
l_int|0
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
singleline_comment|//&t;kernel_thread(awc_thread,dev,0);
id|netif_start_queue
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Always succeed */
id|final
suffix:colon
id|netif_device_detach
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;aironet open failed &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|awc_close
r_int
id|awc_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: closing device.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
id|awc_disable_MAC
c_func
(paren
id|dev
)paren
suffix:semicolon
id|awc_queues_destroy
c_func
(paren
id|dev
)paren
suffix:semicolon
id|awc_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10000
)paren
suffix:semicolon
id|AWC_LOCK_COMMAND_ISSUING
c_func
(paren
id|priv
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|AWC_UNLOCK_COMMAND_ISSUING
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/******************************&t;&t;TX  RX STUFF&t;******************/
DECL|function|awc_tx_timeout
r_void
id|awc_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|awc_fid
op_star
id|fid
suffix:semicolon
r_int
id|cnt
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DEBUG
(paren
l_int|2
comma
l_string|&quot;%s: awc_tx_timeout &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
(paren
id|KERN_NOTICE
l_string|&quot;%s: Transmit timed out , buffs %d %d, queues tx %d pp %d lrg %d sm %d  &bslash;n &quot;
comma
id|dev-&gt;name
comma
id|priv-&gt;tx_small_buffs_total
comma
id|priv-&gt;tx_buffs_total
comma
id|priv-&gt;tx_in_transmit.size
comma
id|priv-&gt;tx_post_process.size
comma
id|priv-&gt;tx_large_ready.size
comma
id|priv-&gt;tx_small_ready.size
)paren
suffix:semicolon
id|priv-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|fid
op_assign
id|priv-&gt;tx_in_transmit.head
suffix:semicolon
id|cnt
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|fid
)paren
(brace
singleline_comment|// removing all fids older that that
r_if
c_cond
(paren
id|jiffies
op_minus
id|fid-&gt;transmit_start_time
OG
(paren
id|HZ
)paren
)paren
(brace
singleline_comment|//      printk(KERN_ERR &quot;%s staled tx_buff found, age %uld jiffies&bslash;n&quot;,dev-&gt;name,
singleline_comment|//              jiffies - fid-&gt;transmit_start_time );
id|awc_fid_queue_remove
(paren
op_amp
id|priv-&gt;tx_in_transmit
comma
id|fid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fid-&gt;u.tx.fid_size
op_le
id|AWC_TX_ALLOC_SMALL_SIZE
)paren
id|awc_fid_queue_push_tail
(paren
op_amp
id|priv-&gt;tx_small_ready
comma
id|fid
)paren
suffix:semicolon
r_else
id|awc_fid_queue_push_tail
(paren
op_amp
id|priv-&gt;tx_large_ready
comma
id|fid
)paren
suffix:semicolon
)brace
id|fid
op_assign
id|fid-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_increment
OG
l_int|200
)paren
(brace
id|printk
(paren
l_string|&quot;bbb in awc_fid_queue&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_start_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|last_tx_q_hack
r_int
r_int
id|last_tx_q_hack
suffix:semicolon
DECL|variable|direction
r_int
id|direction
op_assign
l_int|1
suffix:semicolon
DECL|function|awc_start_xmit
r_int
id|awc_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
singleline_comment|//&t;unsigned long flags;
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: awc_start_xmit &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot; xmit dev=NULL, jiffie %ld &bslash;n&quot;
comma
id|jiffies
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot; xmit skb=NULL, jiffie %ld &bslash;n&quot;
comma
id|jiffies
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
suffix:semicolon
singleline_comment|//&t;if (test_and_set_bit( 0, (void *) &amp;priv-&gt;tx_chain_active) ) {
singleline_comment|//&t;&t;netif_start_queue (dev);
singleline_comment|//&t;&t;return 1;
singleline_comment|//&t;}
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|retval
op_assign
id|awc_802_11_tx_find_path_and_post
c_func
(paren
id|dev
comma
id|skb
)paren
suffix:semicolon
id|priv-&gt;tx_chain_active
op_assign
l_int|0
suffix:semicolon
singleline_comment|//&t;wake_up_interruptible(&amp;priv-&gt;tx_chain_wait_queue);&t;
singleline_comment|//&t;if (!dev-&gt;tbusy) dev_tint(dev);
r_return
id|retval
suffix:semicolon
)brace
DECL|function|awc_rx
r_inline
r_int
id|awc_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|awc_fid
op_star
id|rx_fid
)paren
(brace
singleline_comment|//&t;struct awc_private *lp = (struct awc_private *)dev-&gt;priv;
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;%s: in rx_packet &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rx_fid
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;%s: not rx_buff in rx_packet &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rx_fid-&gt;skb
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;%s: not  rx_buff-&gt;skb in rx_packet &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
suffix:semicolon
id|rx_fid-&gt;skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|rx_fid-&gt;skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|rx_fid-&gt;skb
)paren
suffix:semicolon
id|rx_fid
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|awc_interrupt
r_void
id|awc_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|awc_private
op_star
id|priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
singleline_comment|//&t;if ((dev == NULL)) return;
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: awc_interrupt &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|my_spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;interrupt_spinlock
comma
id|flags
)paren
suffix:semicolon
id|awc_interrupt_process
c_func
(paren
id|dev
)paren
suffix:semicolon
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;interrupt_spinlock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/************************&t;STATS, MULTICAST &amp; STUFF  ****************/
DECL|function|awc_get_stats
r_struct
id|net_device_stats
op_star
id|awc_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|awc_private
op_star
id|priv
op_assign
(paren
r_struct
id|awc_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
singleline_comment|//        unsigned long flags;
singleline_comment|//&t;int cnt = 0;
singleline_comment|//&t;int unlocked_stats_in_interrupt=0;
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: awc_get_stats &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
singleline_comment|//&t;save_flags(flags);
singleline_comment|//&t;cli();
r_if
c_cond
(paren
id|awc_full_stats
)paren
id|awc_readrid_dir
c_func
(paren
id|dev
comma
op_amp
id|priv-&gt;rid_dir
(braket
l_int|9
)braket
)paren
suffix:semicolon
singleline_comment|//&t;restore_flags(flags);
singleline_comment|// the very following is the very wrong very probably
r_if
c_cond
(paren
id|awc_full_stats
)paren
(brace
id|priv-&gt;stats.rx_bytes
op_assign
id|priv-&gt;statistics.HostRxBytes
suffix:semicolon
id|priv-&gt;stats.tx_bytes
op_assign
id|priv-&gt;statistics.HostTxBytes
suffix:semicolon
id|priv-&gt;stats.rx_fifo_errors
op_assign
id|priv-&gt;statistics.RxOverrunErr
suffix:semicolon
id|priv-&gt;stats.rx_crc_errors
op_assign
id|priv-&gt;statistics.RxPlcpCrcErr
op_plus
id|priv-&gt;statistics.RxMacCrcErr
suffix:semicolon
id|priv-&gt;stats.rx_frame_errors
op_assign
id|priv-&gt;statistics.RxPlcpFormat
suffix:semicolon
id|priv-&gt;stats.rx_length_errors
op_assign
id|priv-&gt;statistics.RxPlcpLength
suffix:semicolon
id|priv-&gt;stats.rx_missed_errors
op_assign
id|priv-&gt;statistics.RxAged
suffix:semicolon
id|priv-&gt;stats.rx_over_errors
op_assign
id|priv-&gt;statistics.RxOverrunErr
suffix:semicolon
id|priv-&gt;stats.collisions
op_assign
id|priv-&gt;statistics.TxSinColl
suffix:semicolon
id|priv-&gt;stats.tx_aborted_errors
op_assign
id|priv-&gt;statistics.TxAged
suffix:semicolon
id|priv-&gt;stats.tx_fifo_errors
op_assign
id|priv-&gt;statistics.HostTxFail
suffix:semicolon
id|priv-&gt;stats.tx_window_errors
op_assign
id|priv-&gt;statistics.TxMulColl
suffix:semicolon
id|priv-&gt;stats.tx_heartbeat_errors
op_assign
id|priv-&gt;statistics.DefersProt
op_plus
id|priv-&gt;statistics.DefersEngy
suffix:semicolon
id|priv-&gt;stats.tx_carrier_errors
op_assign
id|priv-&gt;statistics.RetryLong
op_plus
id|priv-&gt;statistics.RetryShort
suffix:semicolon
id|priv-&gt;stats.multicast
op_assign
id|priv-&gt;statistics.HostRxMc
suffix:semicolon
)brace
singleline_comment|//&t;printk(&quot;rx_packets %d&bslash;n&quot;,priv-&gt;stats.rx_packets);
r_return
op_amp
(paren
id|priv-&gt;stats
)paren
suffix:semicolon
)brace
DECL|function|awc_change_mtu
r_int
(def_block
id|awc_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
singleline_comment|//&t;struct awc_private *priv = (struct awc_private *)dev-&gt;priv;
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_mtu
OL
l_int|256
)paren
op_logical_or
(paren
id|new_mtu
OG
l_int|2312
)paren
op_logical_or
(paren
id|max_mtu
op_logical_and
id|new_mtu
OG
id|max_mtu
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PLEASE, ifconfig %s down for mtu change&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mtu
op_ne
id|new_mtu
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|awc_disable_MAC
c_func
(paren
id|dev
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awc_tx_dealloc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
id|awc_tx_alloc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|awc_enable_MAC
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s mtu has been changed to %d &bslash;n &quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;mtu
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
r_void
DECL|function|awc_set_multicast_list
id|awc_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
singleline_comment|//&t;int ioaddr = dev-&gt;base_addr;
multiline_comment|/*&t;if (dev-&gt;flags &amp; IFF_PROMISC)&n;&t;&t;promisc&n;&t;else if (dev-&gt;mc_count || (dev-&gt;flags &amp; IFF_ALLMULTI))&n;&t;&t;allmulti&n;&t;else&n;&t;&t;normal&n;&t;&t;*/
)brace
DECL|variable|awc_proc_set_fun
r_int
(paren
op_star
id|awc_proc_set_fun
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|variable|awc_proc_unset_fun
r_int
(paren
op_star
id|awc_proc_unset_fun
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|function|awc_register_proc
r_int
(def_block
id|awc_register_proc
c_func
(paren
r_int
(paren
op_star
id|awc_proc_set_device
)paren
(paren
r_int
)paren
comma
r_int
(paren
op_star
id|awc_proc_unset_device
)paren
(paren
r_int
)paren
)paren
(brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;awc_register_proc&quot;
)paren
suffix:semicolon
id|awc_proc_set_fun
op_assign
id|awc_proc_set_device
suffix:semicolon
id|awc_proc_unset_fun
op_assign
id|awc_proc_unset_device
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;exit&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
DECL|function|awc_unregister_proc
r_int
(def_block
id|awc_unregister_proc
c_func
(paren
r_void
)paren
(brace
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;awc_unregister_proc&quot;
)paren
suffix:semicolon
id|awc_proc_set_fun
op_assign
l_int|NULL
suffix:semicolon
id|awc_proc_unset_fun
op_assign
l_int|NULL
suffix:semicolon
id|AWC_ENTRY_EXIT_DEBUG
c_func
(paren
l_string|&quot;exit&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
suffix:semicolon
DECL|function|aironet_core_init
r_static
r_int
id|aironet_core_init
c_func
(paren
r_void
)paren
(brace
singleline_comment|//&t;unsigned long flags;
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|aironet4500_core_version
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|aironet_core_exit
r_static
r_void
id|aironet_core_exit
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;aironet4500 unloading core module &bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|aironet_core_init
id|module_init
c_func
(paren
id|aironet_core_init
)paren
suffix:semicolon
DECL|variable|aironet_core_exit
id|module_exit
c_func
(paren
id|aironet_core_exit
)paren
suffix:semicolon
eof
