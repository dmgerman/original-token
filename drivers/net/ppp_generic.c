multiline_comment|/*&n; * Generic PPP layer for Linux.&n; *&n; * Copyright 1999 Paul Mackerras.&n; *&n; *  This program is free software; you can redistribute it and/or&n; *  modify it under the terms of the GNU General Public License&n; *  as published by the Free Software Foundation; either version&n; *  2 of the License, or (at your option) any later version.&n; *&n; * The generic PPP layer handles the PPP network interfaces, the&n; * /dev/ppp device, packet and VJ compression, and multilink.&n; * It talks to PPP `channels&squot; via the interface defined in&n; * include/linux/ppp_channel.h.  Channels provide the basic means for&n; * sending and receiving PPP frames on some kind of communications&n; * channel.&n; *&n; * Part of the code in this driver was inspired by the old async-only&n; * PPP driver, written by Michael Callahan and Al Longyear, and&n; * subsequently hacked by Paul Mackerras.&n; *&n; * ==FILEVERSION 990806==&n; */
multiline_comment|/* $Id$ */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/ppp_defs.h&gt;
macro_line|#include &lt;linux/if_ppp.h&gt;
macro_line|#include &lt;linux/ppp_channel.h&gt;
macro_line|#include &lt;linux/ppp-comp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
macro_line|#include &lt;net/slhc_vj.h&gt;
macro_line|#include &lt;asm/spinlock.h&gt;
DECL|macro|PPP_VERSION
mdefine_line|#define PPP_VERSION&t;&quot;2.4.0&quot;
DECL|variable|ppp_register_channel
id|EXPORT_SYMBOL
c_func
(paren
id|ppp_register_channel
)paren
suffix:semicolon
DECL|variable|ppp_unregister_channel
id|EXPORT_SYMBOL
c_func
(paren
id|ppp_unregister_channel
)paren
suffix:semicolon
DECL|variable|ppp_input
id|EXPORT_SYMBOL
c_func
(paren
id|ppp_input
)paren
suffix:semicolon
DECL|variable|ppp_input_error
id|EXPORT_SYMBOL
c_func
(paren
id|ppp_input_error
)paren
suffix:semicolon
DECL|variable|ppp_output_wakeup
id|EXPORT_SYMBOL
c_func
(paren
id|ppp_output_wakeup
)paren
suffix:semicolon
DECL|variable|ppp_register_compressor
id|EXPORT_SYMBOL
c_func
(paren
id|ppp_register_compressor
)paren
suffix:semicolon
DECL|variable|ppp_unregister_compressor
id|EXPORT_SYMBOL
c_func
(paren
id|ppp_unregister_compressor
)paren
suffix:semicolon
multiline_comment|/*&n; * Network protocols we support.&n; */
DECL|macro|NP_IP
mdefine_line|#define NP_IP&t;0&t;&t;/* Internet Protocol V4 */
DECL|macro|NP_IPV6
mdefine_line|#define NP_IPV6&t;1&t;&t;/* Internet Protocol V6 */
DECL|macro|NP_IPX
mdefine_line|#define NP_IPX&t;2&t;&t;/* IPX protocol */
DECL|macro|NP_AT
mdefine_line|#define NP_AT&t;3&t;&t;/* Appletalk protocol */
DECL|macro|NUM_NP
mdefine_line|#define NUM_NP&t;4&t;&t;/* Number of NPs. */
multiline_comment|/*&n; * Data structure describing one ppp unit.&n; * A ppp unit corresponds to a ppp network interface device&n; * and represents a multilink bundle.&n; * It may have 0 or more ppp channels connected to it.&n; */
DECL|struct|ppp
r_struct
id|ppp
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
multiline_comment|/* link in list of ppp units */
DECL|member|index
r_int
id|index
suffix:semicolon
multiline_comment|/* interface unit number */
DECL|member|name
r_char
id|name
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* unit name */
DECL|member|refcnt
r_int
id|refcnt
suffix:semicolon
multiline_comment|/* # open /dev/ppp attached */
DECL|member|busy
r_int
r_int
id|busy
suffix:semicolon
multiline_comment|/* lock and other bits */
DECL|member|channels
r_struct
id|list_head
id|channels
suffix:semicolon
multiline_comment|/* list of attached channels */
DECL|member|n_channels
r_int
id|n_channels
suffix:semicolon
multiline_comment|/* how many channels are attached */
DECL|member|mru
r_int
id|mru
suffix:semicolon
multiline_comment|/* max receive unit */
DECL|member|flags
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* control bits */
DECL|member|xstate
r_int
r_int
id|xstate
suffix:semicolon
multiline_comment|/* transmit state bits */
DECL|member|rstate
r_int
r_int
id|rstate
suffix:semicolon
multiline_comment|/* receive state bits */
DECL|member|debug
r_int
id|debug
suffix:semicolon
multiline_comment|/* debug flags */
DECL|member|vj
r_struct
id|slcompress
op_star
id|vj
suffix:semicolon
multiline_comment|/* state for VJ header compression */
DECL|member|xq
r_struct
id|sk_buff_head
id|xq
suffix:semicolon
multiline_comment|/* pppd transmit queue */
DECL|member|rq
r_struct
id|sk_buff_head
id|rq
suffix:semicolon
multiline_comment|/* receive queue for pppd */
DECL|member|rwait
id|wait_queue_head_t
id|rwait
suffix:semicolon
multiline_comment|/* for poll on reading /dev/ppp */
DECL|member|npmode
r_enum
id|NPmode
id|npmode
(braket
id|NUM_NP
)braket
suffix:semicolon
multiline_comment|/* what to do with each net proto */
DECL|member|xmit_pending
r_struct
id|sk_buff
op_star
id|xmit_pending
suffix:semicolon
multiline_comment|/* a packet ready to go out */
DECL|member|recv_pending
r_struct
id|sk_buff_head
id|recv_pending
suffix:semicolon
multiline_comment|/* pending input packets */
DECL|member|xcomp
r_struct
id|compressor
op_star
id|xcomp
suffix:semicolon
multiline_comment|/* transmit packet compressor */
DECL|member|xc_state
r_void
op_star
id|xc_state
suffix:semicolon
multiline_comment|/* its internal state */
DECL|member|rcomp
r_struct
id|compressor
op_star
id|rcomp
suffix:semicolon
multiline_comment|/* receive decompressor */
DECL|member|rc_state
r_void
op_star
id|rc_state
suffix:semicolon
multiline_comment|/* its internal state */
DECL|member|last_xmit
r_int
r_int
id|last_xmit
suffix:semicolon
multiline_comment|/* jiffies when last pkt sent */
DECL|member|last_recv
r_int
r_int
id|last_recv
suffix:semicolon
multiline_comment|/* jiffies when last pkt rcvd */
DECL|member|dev
r_struct
id|net_device
id|dev
suffix:semicolon
multiline_comment|/* network interface device */
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
multiline_comment|/* statistics */
)brace
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|all_ppp_units
)paren
suffix:semicolon
DECL|variable|all_ppp_lock
r_static
id|spinlock_t
id|all_ppp_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/*&n; * Private data structure for each channel.&n; * Ultimately this will have multilink stuff etc. in it.&n; */
DECL|struct|channel
r_struct
id|channel
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
multiline_comment|/* link in list of channels per unit */
DECL|member|chan
r_struct
id|ppp_channel
op_star
id|chan
suffix:semicolon
multiline_comment|/* public channel data structure */
DECL|member|blocked
r_int
id|blocked
suffix:semicolon
multiline_comment|/* if channel refused last packet */
DECL|member|ppp
r_struct
id|ppp
op_star
id|ppp
suffix:semicolon
multiline_comment|/* ppp unit we&squot;re connected to */
)brace
suffix:semicolon
multiline_comment|/* Bit numbers in busy */
DECL|macro|XMIT_BUSY
mdefine_line|#define XMIT_BUSY&t;0
DECL|macro|RECV_BUSY
mdefine_line|#define RECV_BUSY&t;1
DECL|macro|XMIT_WAKEUP
mdefine_line|#define XMIT_WAKEUP&t;2
multiline_comment|/*&n; * Bits in flags: SC_NO_TCP_CCID, SC_CCP_OPEN, SC_CCP_UP, SC_LOOP_TRAFFIC.&n; * Bits in rstate: SC_DECOMP_RUN, SC_DC_ERROR, SC_DC_FERROR.&n; * Bits in xstate: SC_COMP_RUN&n; */
DECL|macro|SC_FLAG_BITS
mdefine_line|#define SC_FLAG_BITS&t;(SC_NO_TCP_CCID|SC_CCP_OPEN|SC_CCP_UP|SC_LOOP_TRAFFIC)
multiline_comment|/* Get the PPP protocol number from a skb */
DECL|macro|PPP_PROTO
mdefine_line|#define PPP_PROTO(skb)&t;(((skb)-&gt;data[0] &lt;&lt; 8) + (skb)-&gt;data[1])
multiline_comment|/* We limit the length of ppp-&gt;rq to this (arbitrary) value */
DECL|macro|PPP_MAX_RQLEN
mdefine_line|#define PPP_MAX_RQLEN&t;32
multiline_comment|/* Prototypes. */
r_static
r_void
id|ppp_xmit_unlock
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
)paren
suffix:semicolon
r_static
r_void
id|ppp_send_frame
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ppp_push
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
)paren
suffix:semicolon
r_static
r_void
id|ppp_recv_unlock
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
)paren
suffix:semicolon
r_static
r_void
id|ppp_receive_frame
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_struct
id|sk_buff
op_star
id|ppp_decompress_frame
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|ppp_set_compress
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_void
id|ppp_ccp_peek
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|inbound
)paren
suffix:semicolon
r_static
r_void
id|ppp_ccp_closed
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
)paren
suffix:semicolon
r_static
r_struct
id|compressor
op_star
id|find_compressor
c_func
(paren
r_int
id|type
)paren
suffix:semicolon
r_static
r_void
id|ppp_get_stats
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|ppp_stats
op_star
id|st
)paren
suffix:semicolon
r_static
r_struct
id|ppp
op_star
id|ppp_create_unit
c_func
(paren
r_int
id|unit
comma
r_int
op_star
id|retp
)paren
suffix:semicolon
r_static
r_struct
id|ppp
op_star
id|ppp_find_unit
c_func
(paren
r_int
id|unit
)paren
suffix:semicolon
multiline_comment|/* Translates a PPP protocol number to a NP index (NP == network protocol) */
DECL|function|proto_to_npindex
r_static
r_inline
r_int
id|proto_to_npindex
c_func
(paren
r_int
id|proto
)paren
(brace
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|PPP_IP
suffix:colon
r_return
id|NP_IP
suffix:semicolon
r_case
id|PPP_IPV6
suffix:colon
r_return
id|NP_IPV6
suffix:semicolon
r_case
id|PPP_IPX
suffix:colon
r_return
id|NP_IPX
suffix:semicolon
r_case
id|PPP_AT
suffix:colon
r_return
id|NP_AT
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Translates an NP index into a PPP protocol number */
DECL|variable|npindex_to_proto
r_static
r_const
r_int
id|npindex_to_proto
(braket
id|NUM_NP
)braket
op_assign
(brace
id|PPP_IP
comma
id|PPP_IPV6
comma
id|PPP_IPX
comma
id|PPP_AT
comma
)brace
suffix:semicolon
multiline_comment|/* Translates an ethertype into an NP index */
DECL|function|ethertype_to_npindex
r_static
r_inline
r_int
id|ethertype_to_npindex
c_func
(paren
r_int
id|ethertype
)paren
(brace
r_switch
c_cond
(paren
id|ethertype
)paren
(brace
r_case
id|ETH_P_IP
suffix:colon
r_return
id|NP_IP
suffix:semicolon
r_case
id|ETH_P_IPV6
suffix:colon
r_return
id|NP_IPV6
suffix:semicolon
r_case
id|ETH_P_IPX
suffix:colon
r_return
id|NP_IPX
suffix:semicolon
r_case
id|ETH_P_PPPTALK
suffix:colon
r_case
id|ETH_P_ATALK
suffix:colon
r_return
id|NP_AT
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Translates an NP index into an ethertype */
DECL|variable|npindex_to_ethertype
r_static
r_const
r_int
id|npindex_to_ethertype
(braket
id|NUM_NP
)braket
op_assign
(brace
id|ETH_P_IP
comma
id|ETH_P_IPV6
comma
id|ETH_P_IPX
comma
id|ETH_P_PPPTALK
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Routines for locking and unlocking the transmit and receive paths&n; * of each unit.&n; */
r_static
r_inline
r_void
DECL|function|lock_path
id|lock_path
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_int
id|bit
)paren
(brace
r_int
id|timeout
op_assign
l_int|1000000
suffix:semicolon
r_do
(brace
r_while
c_loop
(paren
id|test_bit
c_func
(paren
id|bit
comma
op_amp
id|ppp-&gt;busy
)paren
)paren
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|timeout
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;lock_path timeout ppp=%p bit=%x&bslash;n&quot;
comma
id|ppp
comma
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
r_while
c_loop
(paren
id|test_and_set_bit
c_func
(paren
id|bit
comma
op_amp
id|ppp-&gt;busy
)paren
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|trylock_path
id|trylock_path
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_int
id|bit
)paren
(brace
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|bit
comma
op_amp
id|ppp-&gt;busy
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|unlock_path
id|unlock_path
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_int
id|bit
)paren
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|bit
comma
op_amp
id|ppp-&gt;busy
)paren
suffix:semicolon
)brace
DECL|macro|lock_xmit_path
mdefine_line|#define lock_xmit_path(ppp)&t;lock_path(ppp, XMIT_BUSY)
DECL|macro|trylock_xmit_path
mdefine_line|#define trylock_xmit_path(ppp)&t;trylock_path(ppp, XMIT_BUSY)
DECL|macro|unlock_xmit_path
mdefine_line|#define unlock_xmit_path(ppp)&t;unlock_path(ppp, XMIT_BUSY)
DECL|macro|lock_recv_path
mdefine_line|#define lock_recv_path(ppp)&t;lock_path(ppp, RECV_BUSY)
DECL|macro|trylock_recv_path
mdefine_line|#define trylock_recv_path(ppp)&t;trylock_path(ppp, RECV_BUSY)
DECL|macro|unlock_recv_path
mdefine_line|#define unlock_recv_path(ppp)&t;unlock_path(ppp, RECV_BUSY)
r_static
r_inline
r_void
DECL|function|free_skbs
id|free_skbs
c_func
(paren
r_struct
id|sk_buff_head
op_star
id|head
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
id|head
)paren
)paren
op_ne
l_int|0
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * /dev/ppp device routines.&n; * The /dev/ppp device is used by pppd to control the ppp unit.&n; * It supports the read, write, ioctl and poll functions.&n; */
DECL|function|ppp_open
r_static
r_int
id|ppp_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
multiline_comment|/*&n;&t; * This could (should?) be enforced by the permissions on /dev/ppp.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ppp_release
r_static
r_int
id|ppp_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
op_assign
(paren
r_struct
id|ppp
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|list_head
op_star
id|list
comma
op_star
id|next
suffix:semicolon
r_int
id|ref
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|all_ppp_lock
)paren
suffix:semicolon
id|ref
op_assign
op_decrement
id|ppp-&gt;refcnt
suffix:semicolon
r_if
c_cond
(paren
id|ref
op_eq
l_int|0
)paren
id|list_del
c_func
(paren
op_amp
id|ppp-&gt;list
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|all_ppp_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ref
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Last fd open to this ppp unit is being closed -&n;&t;   mark the interface down, free the ppp unit */
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|dev_close
c_func
(paren
op_amp
id|ppp-&gt;dev
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|ppp-&gt;channels.next
suffix:semicolon
id|list
op_ne
op_amp
id|ppp-&gt;channels
suffix:semicolon
id|list
op_assign
id|next
)paren
(brace
multiline_comment|/* forcibly detach this channel */
r_struct
id|channel
op_star
id|chan
suffix:semicolon
id|chan
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|channel
comma
id|list
)paren
suffix:semicolon
id|chan-&gt;chan-&gt;ppp
op_assign
l_int|0
suffix:semicolon
id|next
op_assign
id|list-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|chan
)paren
suffix:semicolon
)brace
multiline_comment|/* Free up resources. */
id|ppp_ccp_closed
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|lock_xmit_path
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|lock_recv_path
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;vj
)paren
(brace
id|slhc_free
c_func
(paren
id|ppp-&gt;vj
)paren
suffix:semicolon
id|ppp-&gt;vj
op_assign
l_int|0
suffix:semicolon
)brace
id|free_skbs
c_func
(paren
op_amp
id|ppp-&gt;xq
)paren
suffix:semicolon
id|free_skbs
c_func
(paren
op_amp
id|ppp-&gt;rq
)paren
suffix:semicolon
id|free_skbs
c_func
(paren
op_amp
id|ppp-&gt;recv_pending
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
op_amp
id|ppp-&gt;dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|out
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ppp_read
r_static
id|ssize_t
id|ppp_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
op_assign
(paren
r_struct
id|ppp
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* not currently attached */
id|add_wait_queue
c_func
(paren
op_amp
id|ppp-&gt;rwait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ppp-&gt;rq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
r_break
suffix:semicolon
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|ppp-&gt;rwait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|EOVERFLOW
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|count
)paren
r_goto
id|outf
suffix:semicolon
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
)paren
r_goto
id|outf
suffix:semicolon
id|ret
op_assign
id|skb-&gt;len
suffix:semicolon
id|outf
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ppp_write
r_static
id|ssize_t
id|ppp_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
op_assign
(paren
r_struct
id|ppp
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|count
op_plus
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|count
)paren
comma
id|buf
comma
id|count
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|skb_queue_tail
c_func
(paren
op_amp
id|ppp-&gt;xq
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trylock_xmit_path
c_func
(paren
id|ppp
)paren
)paren
id|ppp_xmit_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|ret
op_assign
id|count
suffix:semicolon
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ppp_poll
r_static
r_int
r_int
id|ppp_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
op_assign
(paren
r_struct
id|ppp
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|ppp-&gt;rwait
comma
id|wait
)paren
suffix:semicolon
id|mask
op_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
r_if
c_cond
(paren
id|skb_peek
c_func
(paren
op_amp
id|ppp-&gt;rq
)paren
op_ne
l_int|0
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|ppp_ioctl
r_static
r_int
id|ppp_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
op_assign
(paren
r_struct
id|ppp
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
id|err
comma
id|val
comma
id|val2
comma
id|i
suffix:semicolon
r_struct
id|ppp_idle
id|idle
suffix:semicolon
r_struct
id|npioctl
id|npi
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|PPPIOCNEWUNIT
)paren
(brace
multiline_comment|/* Create a new ppp unit */
r_int
id|unit
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|unit
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ppp
op_assign
id|ppp_create_unit
c_func
(paren
id|unit
comma
op_amp
id|ret
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_eq
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|file-&gt;private_data
op_assign
id|ppp
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|ppp-&gt;index
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|PPPIOCATTACH
)paren
(brace
multiline_comment|/* Attach to an existing ppp unit */
r_int
id|unit
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|unit
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|all_ppp_lock
)paren
suffix:semicolon
id|ppp
op_assign
id|ppp_find_unit
c_func
(paren
id|unit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_ne
l_int|0
)paren
op_increment
id|ppp-&gt;refcnt
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|all_ppp_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_eq
l_int|0
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|file-&gt;private_data
op_assign
id|ppp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ppp
op_eq
l_int|0
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|PPPIOCSMRU
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_break
suffix:semicolon
id|ppp-&gt;mru
op_assign
id|val
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSFLAGS
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;flags
op_amp
op_complement
id|val
op_amp
id|SC_CCP_OPEN
)paren
id|ppp_ccp_closed
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|ppp-&gt;flags
op_assign
id|val
op_amp
id|SC_FLAG_BITS
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGFLAGS
suffix:colon
id|val
op_assign
id|ppp-&gt;flags
op_or
id|ppp-&gt;xstate
op_or
id|ppp-&gt;rstate
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSCOMPRESS
suffix:colon
id|err
op_assign
id|ppp_set_compress
c_func
(paren
id|ppp
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGUNIT
suffix:colon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|ppp-&gt;index
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSDEBUG
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_break
suffix:semicolon
id|ppp-&gt;debug
op_assign
id|val
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGDEBUG
suffix:colon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|ppp-&gt;debug
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGIDLE
suffix:colon
id|idle.xmit_idle
op_assign
(paren
id|jiffies
op_minus
id|ppp-&gt;last_xmit
)paren
op_div
id|HZ
suffix:semicolon
id|idle.recv_idle
op_assign
(paren
id|jiffies
op_minus
id|ppp-&gt;last_recv
)paren
op_div
id|HZ
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|idle
comma
r_sizeof
(paren
id|idle
)paren
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCSMAXCID
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_break
suffix:semicolon
id|val2
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_rshift
l_int|16
)paren
op_ne
l_int|0
)paren
(brace
id|val2
op_assign
id|val
op_rshift
l_int|16
suffix:semicolon
id|val
op_and_assign
l_int|0xffff
suffix:semicolon
)brace
id|lock_xmit_path
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|lock_recv_path
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;vj
op_ne
l_int|0
)paren
id|slhc_free
c_func
(paren
id|ppp-&gt;vj
)paren
suffix:semicolon
id|ppp-&gt;vj
op_assign
id|slhc_init
c_func
(paren
id|val2
op_plus
l_int|1
comma
id|val
op_plus
l_int|1
)paren
suffix:semicolon
id|ppp_recv_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|ppp_xmit_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;vj
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PPP: no memory (VJ compressor)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPPIOCGNPMODE
suffix:colon
r_case
id|PPPIOCSNPMODE
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|npi
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|npi
)paren
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
id|proto_to_npindex
c_func
(paren
id|npi.protocol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_break
suffix:semicolon
id|i
op_assign
id|err
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|PPPIOCGNPMODE
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
id|npi.mode
op_assign
id|ppp-&gt;npmode
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|npi
comma
r_sizeof
(paren
id|npi
)paren
)paren
)paren
r_break
suffix:semicolon
)brace
r_else
(brace
id|ppp-&gt;npmode
(braket
id|i
)braket
op_assign
id|npi.mode
suffix:semicolon
multiline_comment|/* we may be able to transmit more packets now (??) */
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|ENOTTY
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|variable|ppp_device_fops
r_static
r_struct
id|file_operations
id|ppp_device_fops
op_assign
(brace
l_int|NULL
comma
multiline_comment|/* seek */
id|ppp_read
comma
id|ppp_write
comma
l_int|NULL
comma
multiline_comment|/* readdir */
id|ppp_poll
comma
id|ppp_ioctl
comma
l_int|NULL
comma
multiline_comment|/* mmap */
id|ppp_open
comma
l_int|NULL
comma
multiline_comment|/* flush */
id|ppp_release
)brace
suffix:semicolon
DECL|macro|PPP_MAJOR
mdefine_line|#define PPP_MAJOR&t;108
multiline_comment|/* Called at boot time if ppp is compiled into the kernel,&n;   or at module load time (from init_module) if compiled as a module. */
r_int
DECL|function|ppp_init
id|ppp_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
macro_line|#ifndef MODULE
r_extern
r_struct
id|compressor
id|ppp_deflate
comma
id|ppp_deflate_draft
suffix:semicolon
r_extern
r_int
id|ppp_async_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;PPP generic driver version &quot;
id|PPP_VERSION
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
id|register_chrdev
c_func
(paren
id|PPP_MAJOR
comma
l_string|&quot;ppp&quot;
comma
op_amp
id|ppp_device_fops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;failed to register PPP device (%d)&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
macro_line|#ifndef MODULE
macro_line|#ifdef CONFIG_PPP_ASYNC
id|ppp_async_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PPP_DEFLATE
r_if
c_cond
(paren
id|ppp_register_compressor
c_func
(paren
op_amp
id|ppp_deflate
)paren
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;PPP Deflate compression module registered&bslash;n&quot;
)paren
suffix:semicolon
id|ppp_register_compressor
c_func
(paren
op_amp
id|ppp_deflate_draft
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif /* MODULE */
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n; * Network interface unit routines.&n; */
r_static
r_int
DECL|function|ppp_start_xmit
id|ppp_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
op_assign
(paren
r_struct
id|ppp
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|npi
comma
id|proto
suffix:semicolon
r_int
r_char
op_star
id|pp
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* can skb-&gt;data ever be 0? */
id|npi
op_assign
id|ethertype_to_npindex
c_func
(paren
id|ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|npi
OL
l_int|0
)paren
r_goto
id|outf
suffix:semicolon
multiline_comment|/* Drop, accept or reject the packet */
r_switch
c_cond
(paren
id|ppp-&gt;npmode
(braket
id|npi
)braket
)paren
(brace
r_case
id|NPMODE_PASS
suffix:colon
r_break
suffix:semicolon
r_case
id|NPMODE_QUEUE
suffix:colon
multiline_comment|/* it would be nice to have a way to tell the network&n;&t;&t;   system to queue this one up for later. */
r_goto
id|outf
suffix:semicolon
r_case
id|NPMODE_DROP
suffix:colon
r_case
id|NPMODE_ERROR
suffix:colon
r_goto
id|outf
suffix:semicolon
)brace
multiline_comment|/* The transmit side of the ppp interface is serialized by&n;&t;   the XMIT_BUSY bit in ppp-&gt;busy. */
r_if
c_cond
(paren
op_logical_neg
id|trylock_xmit_path
c_func
(paren
id|ppp
)paren
)paren
(brace
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ppp-&gt;xmit_pending
)paren
id|ppp_push
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;xmit_pending
)paren
(brace
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|ppp_xmit_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Put the 2-byte PPP protocol number on the front,&n;&t;   making sure there is room for the address and control fields. */
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
OL
id|PPP_HDRLEN
)paren
(brace
r_struct
id|sk_buff
op_star
id|ns
suffix:semicolon
id|ns
op_assign
id|alloc_skb
c_func
(paren
id|skb-&gt;len
op_plus
id|PPP_HDRLEN
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ns
op_eq
l_int|0
)paren
r_goto
id|outnbusy
suffix:semicolon
id|skb_reserve
c_func
(paren
id|ns
comma
id|PPP_HDRLEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|ns
comma
id|skb-&gt;len
)paren
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|ns
suffix:semicolon
)brace
id|pp
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|proto
op_assign
id|npindex_to_proto
(braket
id|npi
)braket
suffix:semicolon
id|pp
(braket
l_int|0
)braket
op_assign
id|proto
op_rshift
l_int|8
suffix:semicolon
id|pp
(braket
l_int|1
)braket
op_assign
id|proto
suffix:semicolon
id|ppp_send_frame
c_func
(paren
id|ppp
comma
id|skb
)paren
suffix:semicolon
id|ppp_xmit_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|outnbusy
suffix:colon
id|ppp_xmit_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|outf
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|net_device_stats
op_star
DECL|function|ppp_net_stats
id|ppp_net_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
op_assign
(paren
r_struct
id|ppp
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|ppp-&gt;stats
suffix:semicolon
)brace
r_static
r_int
DECL|function|ppp_net_ioctl
id|ppp_net_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_void
op_star
id|addr
op_assign
(paren
r_void
op_star
)paren
id|ifr-&gt;ifr_ifru.ifru_data
suffix:semicolon
r_struct
id|ppp_stats
id|stats
suffix:semicolon
r_struct
id|ppp_comp_stats
id|cstats
suffix:semicolon
r_char
op_star
id|vers
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGPPPSTATS
suffix:colon
id|ppp_get_stats
c_func
(paren
id|ppp
comma
op_amp
id|stats
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|addr
comma
op_amp
id|stats
comma
r_sizeof
(paren
id|stats
)paren
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGPPPCSTATS
suffix:colon
id|memset
c_func
(paren
op_amp
id|cstats
comma
l_int|0
comma
r_sizeof
(paren
id|cstats
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;xc_state
op_ne
l_int|0
)paren
id|ppp-&gt;xcomp
op_member_access_from_pointer
id|comp_stat
c_func
(paren
id|ppp-&gt;xc_state
comma
op_amp
id|cstats.c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;rc_state
op_ne
l_int|0
)paren
id|ppp-&gt;rcomp
op_member_access_from_pointer
id|decomp_stat
c_func
(paren
id|ppp-&gt;rc_state
comma
op_amp
id|cstats.d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|addr
comma
op_amp
id|cstats
comma
r_sizeof
(paren
id|cstats
)paren
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGPPPVER
suffix:colon
id|vers
op_assign
id|PPP_VERSION
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|addr
comma
id|vers
comma
id|strlen
c_func
(paren
id|vers
)paren
op_plus
l_int|1
)paren
)paren
r_break
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
r_int
DECL|function|ppp_net_init
id|ppp_net_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dev-&gt;hard_header_len
op_assign
id|PPP_HDRLEN
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|PPP_MTU
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|ppp_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|ppp_net_stats
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|ppp_net_ioctl
suffix:semicolon
id|dev-&gt;addr_len
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
l_int|3
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_PPP
suffix:semicolon
id|dev-&gt;flags
op_assign
id|IFF_POINTOPOINT
op_or
id|IFF_NOARP
op_or
id|IFF_MULTICAST
suffix:semicolon
id|dev_init_buffers
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Transmit-side routines.&n; */
multiline_comment|/*&n; * Called to unlock the transmit side of the ppp unit,&n; * making sure that any work queued up gets done.&n; */
r_static
r_void
DECL|function|ppp_xmit_unlock
id|ppp_xmit_unlock
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|XMIT_WAKEUP
comma
op_amp
id|ppp-&gt;busy
)paren
)paren
id|ppp_push
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ppp-&gt;xmit_pending
op_eq
l_int|0
op_logical_and
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ppp-&gt;xq
)paren
)paren
op_ne
l_int|0
)paren
id|ppp_send_frame
c_func
(paren
id|ppp
comma
id|skb
)paren
suffix:semicolon
id|unlock_xmit_path
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|test_bit
c_func
(paren
id|XMIT_WAKEUP
comma
op_amp
id|ppp-&gt;busy
)paren
op_logical_or
(paren
id|ppp-&gt;xmit_pending
op_eq
l_int|0
op_logical_and
id|skb_peek
c_func
(paren
op_amp
id|ppp-&gt;xq
)paren
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|trylock_xmit_path
c_func
(paren
id|ppp
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Compress and send a frame.&n; * The caller should have locked the xmit path,&n; * and xmit_pending should be 0.&n; */
r_static
r_void
DECL|function|ppp_send_frame
id|ppp_send_frame
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|proto
op_assign
id|PPP_PROTO
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|new_skb
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
r_char
op_star
id|cp
suffix:semicolon
op_increment
id|ppp-&gt;stats.tx_packets
suffix:semicolon
id|ppp-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
op_minus
l_int|2
suffix:semicolon
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|PPP_IP
suffix:colon
r_if
c_cond
(paren
id|ppp-&gt;vj
op_eq
l_int|0
op_logical_or
(paren
id|ppp-&gt;flags
op_amp
id|SC_COMP_TCP
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
multiline_comment|/* try to do VJ TCP header compression */
id|new_skb
op_assign
id|alloc_skb
c_func
(paren
id|skb-&gt;len
op_plus
l_int|2
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_skb
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PPP: no memory (VJ comp pkt)&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|new_skb
comma
l_int|2
)paren
suffix:semicolon
id|cp
op_assign
id|skb-&gt;data
op_plus
l_int|2
suffix:semicolon
id|len
op_assign
id|slhc_compress
c_func
(paren
id|ppp-&gt;vj
comma
id|cp
comma
id|skb-&gt;len
op_minus
l_int|2
comma
id|new_skb-&gt;data
op_plus
l_int|2
comma
op_amp
id|cp
comma
op_logical_neg
(paren
id|ppp-&gt;flags
op_amp
id|SC_NO_TCP_CCID
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cp
op_eq
id|skb-&gt;data
op_plus
l_int|2
)paren
(brace
multiline_comment|/* didn&squot;t compress */
id|kfree_skb
c_func
(paren
id|new_skb
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cp
(braket
l_int|0
)braket
op_amp
id|SL_TYPE_COMPRESSED_TCP
)paren
(brace
id|proto
op_assign
id|PPP_VJC_COMP
suffix:semicolon
id|cp
(braket
l_int|0
)braket
op_and_assign
op_complement
id|SL_TYPE_COMPRESSED_TCP
suffix:semicolon
)brace
r_else
(brace
id|proto
op_assign
id|PPP_VJC_UNCOMP
suffix:semicolon
id|cp
(braket
l_int|0
)braket
op_assign
id|skb-&gt;data
(braket
l_int|2
)braket
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|new_skb
suffix:semicolon
id|cp
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|len
op_plus
l_int|2
)paren
suffix:semicolon
id|cp
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|cp
(braket
l_int|1
)braket
op_assign
id|proto
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PPP_CCP
suffix:colon
multiline_comment|/* peek at outbound CCP frames */
id|ppp_ccp_peek
c_func
(paren
id|ppp
comma
id|skb
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* try to do packet compression */
r_if
c_cond
(paren
(paren
id|ppp-&gt;xstate
op_amp
id|SC_COMP_RUN
)paren
op_logical_and
id|ppp-&gt;xc_state
op_ne
l_int|0
op_logical_and
id|proto
op_ne
id|PPP_LCP
op_logical_and
id|proto
op_ne
id|PPP_CCP
)paren
(brace
id|new_skb
op_assign
id|alloc_skb
c_func
(paren
id|ppp-&gt;dev.mtu
op_plus
id|PPP_HDRLEN
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_skb
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PPP: no memory (comp pkt)&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
multiline_comment|/* compressor still expects A/C bytes in hdr */
id|len
op_assign
id|ppp-&gt;xcomp
op_member_access_from_pointer
id|compress
c_func
(paren
id|ppp-&gt;xc_state
comma
id|skb-&gt;data
op_minus
l_int|2
comma
id|new_skb-&gt;data
comma
id|skb-&gt;len
op_plus
l_int|2
comma
id|ppp-&gt;dev.mtu
op_plus
id|PPP_HDRLEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
op_logical_and
(paren
id|ppp-&gt;flags
op_amp
id|SC_CCP_UP
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|new_skb
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* pull off A/C bytes */
)brace
r_else
(brace
multiline_comment|/* didn&squot;t compress, or CCP not up yet */
id|kfree_skb
c_func
(paren
id|new_skb
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * If we are waiting for traffic (demand dialling),&n;&t; * queue it up for pppd to receive.&n;&t; */
r_if
c_cond
(paren
id|ppp-&gt;flags
op_amp
id|SC_LOOP_TRAFFIC
)paren
(brace
r_if
c_cond
(paren
id|ppp-&gt;rq.qlen
OG
id|PPP_MAX_RQLEN
)paren
r_goto
id|drop
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|ppp-&gt;rq
comma
id|skb
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|ppp-&gt;rwait
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ppp-&gt;xmit_pending
op_assign
id|skb
suffix:semicolon
id|ppp_push
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_return
suffix:semicolon
id|drop
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
op_increment
id|ppp-&gt;stats.tx_errors
suffix:semicolon
)brace
multiline_comment|/*&n; * Try to send the frame in xmit_pending.&n; * The caller should have the xmit path locked.&n; */
r_static
r_void
DECL|function|ppp_push
id|ppp_push
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
)paren
(brace
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|channel
op_star
id|chan
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|ppp-&gt;xmit_pending
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|list
op_assign
op_amp
id|ppp-&gt;channels
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
id|list
)paren
)paren
(brace
multiline_comment|/* nowhere to send the packet, just drop it */
id|ppp-&gt;xmit_pending
op_assign
l_int|0
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* If we are doing multilink, decide which channel gets the&n;&t;   packet, and/or fragment the packet over several links. */
multiline_comment|/* XXX for now, just take the first channel */
id|list
op_assign
id|list-&gt;next
suffix:semicolon
id|chan
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|channel
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;chan-&gt;ops
op_member_access_from_pointer
id|start_xmit
c_func
(paren
id|chan-&gt;chan
comma
id|skb
)paren
)paren
(brace
id|ppp-&gt;xmit_pending
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;blocked
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|chan-&gt;blocked
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Receive-side routines.&n; */
r_static
r_inline
r_void
DECL|function|ppp_do_recv
id|ppp_do_recv
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|ppp-&gt;recv_pending
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trylock_recv_path
c_func
(paren
id|ppp
)paren
)paren
id|ppp_recv_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
)brace
r_void
DECL|function|ppp_input
id|ppp_input
c_func
(paren
r_struct
id|ppp_channel
op_star
id|chan
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|channel
op_star
id|pch
op_assign
id|chan-&gt;ppp
suffix:semicolon
r_if
c_cond
(paren
id|pch
op_eq
l_int|0
op_logical_or
id|skb-&gt;len
op_eq
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ppp_do_recv
c_func
(paren
id|pch-&gt;ppp
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* Put a 0-length skb in the receive queue as an error indication */
r_void
DECL|function|ppp_input_error
id|ppp_input_error
c_func
(paren
r_struct
id|ppp_channel
op_star
id|chan
comma
r_int
id|code
)paren
(brace
r_struct
id|channel
op_star
id|pch
op_assign
id|chan-&gt;ppp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|pch
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|skb-&gt;len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* probably unnecessary */
id|skb-&gt;cb
(braket
l_int|0
)braket
op_assign
id|code
suffix:semicolon
id|ppp_do_recv
c_func
(paren
id|pch-&gt;ppp
comma
id|skb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ppp_recv_unlock
id|ppp_recv_unlock
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ppp-&gt;recv_pending
)paren
)paren
op_ne
l_int|0
)paren
id|ppp_receive_frame
c_func
(paren
id|ppp
comma
id|skb
)paren
suffix:semicolon
id|unlock_recv_path
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_peek
c_func
(paren
op_amp
id|ppp-&gt;recv_pending
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|trylock_recv_path
c_func
(paren
id|ppp
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|ppp_receive_frame
id|ppp_receive_frame
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|sk_buff
op_star
id|ns
suffix:semicolon
r_int
id|proto
comma
id|len
comma
id|npi
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
op_eq
l_int|0
)paren
(brace
multiline_comment|/* XXX should do something with code in skb-&gt;cb[0] */
r_goto
id|err
suffix:semicolon
multiline_comment|/* error indication */
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|2
)paren
(brace
op_increment
id|ppp-&gt;stats.rx_length_errors
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
multiline_comment|/* Decompress the frame, if compressed. */
r_if
c_cond
(paren
id|ppp-&gt;rc_state
op_ne
l_int|0
op_logical_and
(paren
id|ppp-&gt;rstate
op_amp
id|SC_DECOMP_RUN
)paren
op_logical_and
(paren
id|ppp-&gt;rstate
op_amp
(paren
id|SC_DC_FERROR
op_or
id|SC_DC_ERROR
)paren
)paren
op_eq
l_int|0
)paren
id|skb
op_assign
id|ppp_decompress_frame
c_func
(paren
id|ppp
comma
id|skb
)paren
suffix:semicolon
id|proto
op_assign
id|PPP_PROTO
c_func
(paren
id|skb
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|PPP_VJC_COMP
suffix:colon
multiline_comment|/* decompress VJ compressed packets */
r_if
c_cond
(paren
id|ppp-&gt;vj
op_eq
l_int|0
op_logical_or
(paren
id|ppp-&gt;flags
op_amp
id|SC_REJ_COMP_TCP
)paren
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
l_int|124
)paren
(brace
multiline_comment|/* copy to a new sk_buff with more tailroom */
id|ns
op_assign
id|alloc_skb
c_func
(paren
id|skb-&gt;len
op_plus
l_int|128
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ns
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PPP: no memory (VJ decomp)&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|ns
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|ns
comma
id|skb-&gt;len
)paren
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|ns
suffix:semicolon
)brace
id|len
op_assign
id|slhc_uncompress
c_func
(paren
id|ppp-&gt;vj
comma
id|skb-&gt;data
op_plus
l_int|2
comma
id|skb-&gt;len
op_minus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PPP: VJ decompression error&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|len
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|skb-&gt;len
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
op_minus
id|skb-&gt;len
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|len
OL
id|skb-&gt;len
)paren
id|skb_trim
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|proto
op_assign
id|PPP_IP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_VJC_UNCOMP
suffix:colon
r_if
c_cond
(paren
id|ppp-&gt;vj
op_eq
l_int|0
op_logical_or
(paren
id|ppp-&gt;flags
op_amp
id|SC_REJ_COMP_TCP
)paren
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
id|slhc_remember
c_func
(paren
id|ppp-&gt;vj
comma
id|skb-&gt;data
op_plus
l_int|2
comma
id|skb-&gt;len
op_minus
l_int|2
)paren
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PPP: VJ uncompressed error&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|proto
op_assign
id|PPP_IP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PPP_CCP
suffix:colon
id|ppp_ccp_peek
c_func
(paren
id|ppp
comma
id|skb
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
op_increment
id|ppp-&gt;stats.rx_packets
suffix:semicolon
id|ppp-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
op_minus
l_int|2
suffix:semicolon
id|npi
op_assign
id|proto_to_npindex
c_func
(paren
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
id|npi
OL
l_int|0
)paren
(brace
multiline_comment|/* control or unknown frame - pass it to pppd */
id|skb_queue_tail
c_func
(paren
op_amp
id|ppp-&gt;rq
comma
id|skb
)paren
suffix:semicolon
multiline_comment|/* limit queue length by dropping old frames */
r_while
c_loop
(paren
id|ppp-&gt;rq.qlen
OG
id|PPP_MAX_RQLEN
)paren
(brace
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ppp-&gt;rq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* wake up any process polling or blocking on read */
id|wake_up_interruptible
c_func
(paren
op_amp
id|ppp-&gt;rwait
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* network protocol frame - give it to the kernel */
id|ppp-&gt;last_recv
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ppp-&gt;dev.flags
op_amp
id|IFF_UP
)paren
op_eq
l_int|0
op_logical_or
id|ppp-&gt;npmode
(braket
id|npi
)braket
op_ne
id|NPMODE_PASS
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* chop off protocol */
id|skb-&gt;dev
op_assign
op_amp
id|ppp-&gt;dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|npindex_to_ethertype
(braket
id|npi
)braket
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
id|err
suffix:colon
op_increment
id|ppp-&gt;stats.rx_errors
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;vj
op_ne
l_int|0
)paren
id|slhc_toss
c_func
(paren
id|ppp-&gt;vj
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_static
r_struct
id|sk_buff
op_star
DECL|function|ppp_decompress_frame
id|ppp_decompress_frame
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|proto
op_assign
id|PPP_PROTO
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|ns
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|proto
op_eq
id|PPP_COMP
)paren
(brace
id|ns
op_assign
id|alloc_skb
c_func
(paren
id|ppp-&gt;mru
op_plus
id|PPP_HDRLEN
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ns
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ppp_receive: no memory&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
multiline_comment|/* the decompressor still expects the A/C bytes in the hdr */
id|len
op_assign
id|ppp-&gt;rcomp
op_member_access_from_pointer
id|decompress
c_func
(paren
id|ppp-&gt;rc_state
comma
id|skb-&gt;data
op_minus
l_int|2
comma
id|skb-&gt;len
op_plus
l_int|2
comma
id|ns-&gt;data
comma
id|ppp-&gt;mru
op_plus
id|PPP_HDRLEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
(brace
multiline_comment|/* Pass the compressed frame to pppd as an&n;&t;&t;&t;   error indication. */
r_if
c_cond
(paren
id|len
op_eq
id|DECOMP_FATALERROR
)paren
id|ppp-&gt;rstate
op_or_assign
id|SC_DC_FERROR
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|ns
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* pull off the A/C bytes */
)brace
r_else
(brace
multiline_comment|/* Uncompressed frame - pass to decompressor so it&n;&t;&t;   can update its dictionary if necessary. */
r_if
c_cond
(paren
id|ppp-&gt;rcomp-&gt;incomp
)paren
id|ppp-&gt;rcomp
op_member_access_from_pointer
id|incomp
c_func
(paren
id|ppp-&gt;rc_state
comma
id|skb-&gt;data
op_minus
l_int|2
comma
id|skb-&gt;len
op_plus
l_int|2
)paren
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
id|err
suffix:colon
id|ppp-&gt;rstate
op_or_assign
id|SC_DC_ERROR
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;vj
op_ne
l_int|0
)paren
id|slhc_toss
c_func
(paren
id|ppp-&gt;vj
)paren
suffix:semicolon
op_increment
id|ppp-&gt;stats.rx_errors
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
multiline_comment|/*&n; * Channel interface.&n; */
multiline_comment|/*&n; * Connect a channel to a given PPP unit.&n; * The channel MUST NOT be connected to a PPP unit already.&n; */
r_int
DECL|function|ppp_register_channel
id|ppp_register_channel
c_func
(paren
r_struct
id|ppp_channel
op_star
id|chan
comma
r_int
id|unit
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
suffix:semicolon
r_struct
id|channel
op_star
id|pch
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|all_ppp_lock
)paren
suffix:semicolon
id|ppp
op_assign
id|ppp_find_unit
c_func
(paren
id|unit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|pch
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|channel
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|pch
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|pch
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|channel
)paren
)paren
suffix:semicolon
id|pch-&gt;ppp
op_assign
id|ppp
suffix:semicolon
id|pch-&gt;chan
op_assign
id|chan
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|pch-&gt;list
comma
op_amp
id|ppp-&gt;channels
)paren
suffix:semicolon
id|chan-&gt;ppp
op_assign
id|pch
suffix:semicolon
op_increment
id|ppp-&gt;n_channels
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|all_ppp_lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * Disconnect a channel from its PPP unit.&n; */
r_void
DECL|function|ppp_unregister_channel
id|ppp_unregister_channel
c_func
(paren
r_struct
id|ppp_channel
op_star
id|chan
)paren
(brace
r_struct
id|channel
op_star
id|pch
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|all_ppp_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pch
op_assign
id|chan-&gt;ppp
)paren
op_ne
l_int|0
)paren
(brace
id|chan-&gt;ppp
op_assign
l_int|0
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|pch-&gt;list
)paren
suffix:semicolon
op_decrement
id|pch-&gt;ppp-&gt;n_channels
suffix:semicolon
id|kfree
c_func
(paren
id|pch
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|all_ppp_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Callback from a channel when it can accept more to transmit.&n; * This should ideally be called at BH level, not interrupt level.&n; */
r_void
DECL|function|ppp_output_wakeup
id|ppp_output_wakeup
c_func
(paren
r_struct
id|ppp_channel
op_star
id|chan
)paren
(brace
r_struct
id|channel
op_star
id|pch
op_assign
id|chan-&gt;ppp
suffix:semicolon
r_struct
id|ppp
op_star
id|ppp
suffix:semicolon
r_if
c_cond
(paren
id|pch
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|ppp
op_assign
id|pch-&gt;ppp
suffix:semicolon
id|pch-&gt;blocked
op_assign
l_int|0
suffix:semicolon
id|set_bit
c_func
(paren
id|XMIT_WAKEUP
comma
op_amp
id|ppp-&gt;busy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trylock_xmit_path
c_func
(paren
id|ppp
)paren
)paren
id|ppp_xmit_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;xmit_pending
op_eq
l_int|0
)paren
(brace
id|ppp-&gt;dev.tbusy
op_assign
l_int|0
suffix:semicolon
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Compression control.&n; */
multiline_comment|/* Process the PPPIOCSCOMPRESS ioctl. */
r_static
r_int
DECL|function|ppp_set_compress
id|ppp_set_compress
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|compressor
op_star
id|cp
suffix:semicolon
r_struct
id|ppp_option_data
id|data
suffix:semicolon
r_int
r_char
id|ccp_option
(braket
id|CCP_MAX_OPTION_LENGTH
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_KMOD
r_char
id|modname
(braket
l_int|32
)braket
suffix:semicolon
macro_line|#endif
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|data
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|data
)paren
)paren
op_logical_or
(paren
id|data.length
op_le
id|CCP_MAX_OPTION_LENGTH
op_logical_and
id|copy_from_user
c_func
(paren
id|ccp_option
comma
id|data.ptr
comma
id|data.length
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|data.length
OG
id|CCP_MAX_OPTION_LENGTH
op_logical_or
id|ccp_option
(braket
l_int|1
)braket
template_param
id|data.length
)paren
r_goto
id|out
suffix:semicolon
id|cp
op_assign
id|find_compressor
c_func
(paren
id|ccp_option
(braket
l_int|0
)braket
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_KMOD
r_if
c_cond
(paren
id|cp
op_eq
l_int|0
)paren
(brace
id|sprintf
c_func
(paren
id|modname
comma
l_string|&quot;ppp-compress-%d&quot;
comma
id|ccp_option
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|request_module
c_func
(paren
id|modname
)paren
suffix:semicolon
id|cp
op_assign
id|find_compressor
c_func
(paren
id|ccp_option
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_KMOD */
r_if
c_cond
(paren
id|cp
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_if
c_cond
(paren
id|data.transmit
)paren
(brace
id|lock_xmit_path
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|ppp-&gt;xstate
op_and_assign
op_complement
id|SC_COMP_RUN
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;xc_state
op_ne
l_int|0
)paren
(brace
id|ppp-&gt;xcomp
op_member_access_from_pointer
id|comp_free
c_func
(paren
id|ppp-&gt;xc_state
)paren
suffix:semicolon
id|ppp-&gt;xc_state
op_assign
l_int|0
suffix:semicolon
)brace
id|ppp-&gt;xcomp
op_assign
id|cp
suffix:semicolon
id|ppp-&gt;xc_state
op_assign
id|cp
op_member_access_from_pointer
id|comp_alloc
c_func
(paren
id|ccp_option
comma
id|data.length
)paren
suffix:semicolon
id|ppp_xmit_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;xc_state
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
)brace
r_else
(brace
id|lock_recv_path
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|ppp-&gt;rstate
op_and_assign
op_complement
id|SC_DECOMP_RUN
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;rc_state
op_ne
l_int|0
)paren
(brace
id|ppp-&gt;rcomp
op_member_access_from_pointer
id|decomp_free
c_func
(paren
id|ppp-&gt;rc_state
)paren
suffix:semicolon
id|ppp-&gt;rc_state
op_assign
l_int|0
suffix:semicolon
)brace
id|ppp-&gt;rcomp
op_assign
id|cp
suffix:semicolon
id|ppp-&gt;rc_state
op_assign
id|cp
op_member_access_from_pointer
id|decomp_alloc
c_func
(paren
id|ccp_option
comma
id|data.length
)paren
suffix:semicolon
id|ppp_recv_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;rc_state
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * Look at a CCP packet and update our state accordingly.&n; * We assume the caller has the xmit or recv path locked.&n; */
r_static
r_void
DECL|function|ppp_ccp_peek
id|ppp_ccp_peek
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|inbound
)paren
(brace
r_int
r_char
op_star
id|dp
op_assign
id|skb-&gt;data
op_plus
l_int|2
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
id|CCP_HDRLEN
op_plus
l_int|2
op_logical_or
id|skb-&gt;len
OL
(paren
id|len
op_assign
id|CCP_LENGTH
c_func
(paren
id|dp
)paren
)paren
op_plus
l_int|2
)paren
r_return
suffix:semicolon
multiline_comment|/* too short */
r_switch
c_cond
(paren
id|CCP_CODE
c_func
(paren
id|dp
)paren
)paren
(brace
r_case
id|CCP_CONFREQ
suffix:colon
r_case
id|CCP_TERMREQ
suffix:colon
r_case
id|CCP_TERMACK
suffix:colon
multiline_comment|/*&n;&t;&t; * CCP is going down - disable compression.&n;&t;&t; */
r_if
c_cond
(paren
id|inbound
)paren
id|ppp-&gt;rstate
op_and_assign
op_complement
id|SC_DECOMP_RUN
suffix:semicolon
r_else
id|ppp-&gt;xstate
op_and_assign
op_complement
id|SC_COMP_RUN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CCP_CONFACK
suffix:colon
r_if
c_cond
(paren
(paren
id|ppp-&gt;flags
op_amp
(paren
id|SC_CCP_OPEN
op_or
id|SC_CCP_UP
)paren
)paren
op_ne
id|SC_CCP_OPEN
)paren
r_break
suffix:semicolon
id|dp
op_add_assign
id|CCP_HDRLEN
suffix:semicolon
id|len
op_sub_assign
id|CCP_HDRLEN
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|CCP_OPT_MINLEN
op_logical_or
id|len
OL
id|CCP_OPT_LENGTH
c_func
(paren
id|dp
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|inbound
)paren
(brace
multiline_comment|/* we will start receiving compressed packets */
r_if
c_cond
(paren
id|ppp-&gt;rc_state
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;rcomp
op_member_access_from_pointer
id|decomp_init
c_func
(paren
id|ppp-&gt;rc_state
comma
id|dp
comma
id|len
comma
id|ppp-&gt;index
comma
l_int|0
comma
id|ppp-&gt;mru
comma
id|ppp-&gt;debug
)paren
)paren
(brace
id|ppp-&gt;rstate
op_or_assign
id|SC_DECOMP_RUN
suffix:semicolon
id|ppp-&gt;rstate
op_and_assign
op_complement
(paren
id|SC_DC_ERROR
op_or
id|SC_DC_FERROR
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* we will soon start sending compressed packets */
r_if
c_cond
(paren
id|ppp-&gt;xc_state
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;xcomp
op_member_access_from_pointer
id|comp_init
c_func
(paren
id|ppp-&gt;xc_state
comma
id|dp
comma
id|len
comma
id|ppp-&gt;index
comma
l_int|0
comma
id|ppp-&gt;debug
)paren
)paren
id|ppp-&gt;xstate
op_or_assign
id|SC_COMP_RUN
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CCP_RESETACK
suffix:colon
multiline_comment|/* reset the [de]compressor */
r_if
c_cond
(paren
(paren
id|ppp-&gt;flags
op_amp
id|SC_CCP_UP
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|inbound
)paren
(brace
r_if
c_cond
(paren
id|ppp-&gt;rc_state
op_logical_and
(paren
id|ppp-&gt;rstate
op_amp
id|SC_DECOMP_RUN
)paren
)paren
(brace
id|ppp-&gt;rcomp
op_member_access_from_pointer
id|decomp_reset
c_func
(paren
id|ppp-&gt;rc_state
)paren
suffix:semicolon
id|ppp-&gt;rstate
op_and_assign
op_complement
id|SC_DC_ERROR
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ppp-&gt;xc_state
op_logical_and
(paren
id|ppp-&gt;xstate
op_amp
id|SC_COMP_RUN
)paren
)paren
id|ppp-&gt;xcomp
op_member_access_from_pointer
id|comp_reset
c_func
(paren
id|ppp-&gt;xc_state
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Free up compression resources. */
r_static
r_void
DECL|function|ppp_ccp_closed
id|ppp_ccp_closed
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
)paren
(brace
id|ppp-&gt;flags
op_and_assign
op_complement
(paren
id|SC_CCP_OPEN
op_or
id|SC_CCP_UP
)paren
suffix:semicolon
id|lock_xmit_path
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|ppp-&gt;xstate
op_and_assign
op_complement
id|SC_COMP_RUN
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;xc_state
)paren
(brace
id|ppp-&gt;xcomp
op_member_access_from_pointer
id|comp_free
c_func
(paren
id|ppp-&gt;xc_state
)paren
suffix:semicolon
id|ppp-&gt;xc_state
op_assign
l_int|0
suffix:semicolon
)brace
id|ppp_xmit_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|lock_recv_path
c_func
(paren
id|ppp
)paren
suffix:semicolon
id|ppp-&gt;xstate
op_and_assign
op_complement
id|SC_DECOMP_RUN
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;rc_state
)paren
(brace
id|ppp-&gt;rcomp
op_member_access_from_pointer
id|decomp_free
c_func
(paren
id|ppp-&gt;rc_state
)paren
suffix:semicolon
id|ppp-&gt;rc_state
op_assign
l_int|0
suffix:semicolon
)brace
id|ppp_recv_unlock
c_func
(paren
id|ppp
)paren
suffix:semicolon
)brace
multiline_comment|/* List of compressors. */
r_static
id|LIST_HEAD
c_func
(paren
id|compressor_list
)paren
suffix:semicolon
DECL|variable|compressor_list_lock
r_static
id|spinlock_t
id|compressor_list_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|struct|compressor_entry
r_struct
id|compressor_entry
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|comp
r_struct
id|compressor
op_star
id|comp
suffix:semicolon
)brace
suffix:semicolon
r_static
r_struct
id|compressor_entry
op_star
DECL|function|find_comp_entry
id|find_comp_entry
c_func
(paren
r_int
id|proto
)paren
(brace
r_struct
id|compressor_entry
op_star
id|ce
suffix:semicolon
r_struct
id|list_head
op_star
id|list
op_assign
op_amp
id|compressor_list
suffix:semicolon
r_while
c_loop
(paren
(paren
id|list
op_assign
id|list-&gt;next
)paren
op_ne
op_amp
id|compressor_list
)paren
(brace
id|ce
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|compressor_entry
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ce-&gt;comp-&gt;compress_proto
op_eq
id|proto
)paren
r_return
id|ce
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Register a compressor */
r_int
DECL|function|ppp_register_compressor
id|ppp_register_compressor
c_func
(paren
r_struct
id|compressor
op_star
id|cp
)paren
(brace
r_struct
id|compressor_entry
op_star
id|ce
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|compressor_list_lock
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_if
c_cond
(paren
id|find_comp_entry
c_func
(paren
id|cp-&gt;compress_proto
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|ce
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|compressor_entry
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ce
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|ce-&gt;comp
op_assign
id|cp
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|ce-&gt;list
comma
op_amp
id|compressor_list
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|compressor_list_lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Unregister a compressor */
r_void
DECL|function|ppp_unregister_compressor
id|ppp_unregister_compressor
c_func
(paren
r_struct
id|compressor
op_star
id|cp
)paren
(brace
r_struct
id|compressor_entry
op_star
id|ce
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|compressor_list_lock
)paren
suffix:semicolon
id|ce
op_assign
id|find_comp_entry
c_func
(paren
id|cp-&gt;compress_proto
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ce
op_ne
l_int|0
op_logical_and
id|ce-&gt;comp
op_eq
id|cp
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|ce-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ce
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|compressor_list_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* Find a compressor. */
r_static
r_struct
id|compressor
op_star
DECL|function|find_compressor
id|find_compressor
c_func
(paren
r_int
id|type
)paren
(brace
r_struct
id|compressor_entry
op_star
id|ce
suffix:semicolon
r_struct
id|compressor
op_star
id|cp
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|compressor_list_lock
)paren
suffix:semicolon
id|ce
op_assign
id|find_comp_entry
c_func
(paren
id|type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ce
op_ne
l_int|0
)paren
id|cp
op_assign
id|ce-&gt;comp
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|compressor_list_lock
)paren
suffix:semicolon
r_return
id|cp
suffix:semicolon
)brace
multiline_comment|/*&n; * Miscelleneous stuff.&n; */
r_static
r_void
DECL|function|ppp_get_stats
id|ppp_get_stats
c_func
(paren
r_struct
id|ppp
op_star
id|ppp
comma
r_struct
id|ppp_stats
op_star
id|st
)paren
(brace
r_struct
id|slcompress
op_star
id|vj
op_assign
id|ppp-&gt;vj
suffix:semicolon
id|memset
c_func
(paren
id|st
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|st
)paren
)paren
suffix:semicolon
id|st-&gt;p.ppp_ipackets
op_assign
id|ppp-&gt;stats.rx_packets
suffix:semicolon
id|st-&gt;p.ppp_ierrors
op_assign
id|ppp-&gt;stats.rx_errors
suffix:semicolon
id|st-&gt;p.ppp_ibytes
op_assign
id|ppp-&gt;stats.rx_bytes
suffix:semicolon
id|st-&gt;p.ppp_opackets
op_assign
id|ppp-&gt;stats.tx_packets
suffix:semicolon
id|st-&gt;p.ppp_oerrors
op_assign
id|ppp-&gt;stats.tx_errors
suffix:semicolon
id|st-&gt;p.ppp_obytes
op_assign
id|ppp-&gt;stats.tx_bytes
suffix:semicolon
r_if
c_cond
(paren
id|vj
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|st-&gt;vj.vjs_packets
op_assign
id|vj-&gt;sls_o_compressed
op_plus
id|vj-&gt;sls_o_uncompressed
suffix:semicolon
id|st-&gt;vj.vjs_compressed
op_assign
id|vj-&gt;sls_o_compressed
suffix:semicolon
id|st-&gt;vj.vjs_searches
op_assign
id|vj-&gt;sls_o_searches
suffix:semicolon
id|st-&gt;vj.vjs_misses
op_assign
id|vj-&gt;sls_o_misses
suffix:semicolon
id|st-&gt;vj.vjs_errorin
op_assign
id|vj-&gt;sls_i_error
suffix:semicolon
id|st-&gt;vj.vjs_tossed
op_assign
id|vj-&gt;sls_i_tossed
suffix:semicolon
id|st-&gt;vj.vjs_uncompressedin
op_assign
id|vj-&gt;sls_i_uncompressed
suffix:semicolon
id|st-&gt;vj.vjs_compressedin
op_assign
id|vj-&gt;sls_i_compressed
suffix:semicolon
)brace
multiline_comment|/*&n; * Stuff for handling the list of ppp units and for initialization.&n; */
multiline_comment|/*&n; * Create a new ppp unit.  Fails if it can&squot;t allocate memory or&n; * if there is already a unit with the requested number.&n; * unit == -1 means allocate a new number.&n; */
r_static
r_struct
id|ppp
op_star
DECL|function|ppp_create_unit
id|ppp_create_unit
c_func
(paren
r_int
id|unit
comma
r_int
op_star
id|retp
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_int
id|last_unit
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|all_ppp_lock
)paren
suffix:semicolon
id|list
op_assign
op_amp
id|all_ppp_units
suffix:semicolon
r_while
c_loop
(paren
(paren
id|list
op_assign
id|list-&gt;next
)paren
op_ne
op_amp
id|all_ppp_units
)paren
(brace
id|ppp
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|ppp
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|unit
template_param
id|last_unit
op_plus
l_int|1
)paren
op_logical_or
(paren
id|unit
op_ge
l_int|0
op_logical_and
id|unit
OL
id|ppp-&gt;index
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|unit
op_eq
id|ppp-&gt;index
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* unit already exists */
id|last_unit
op_assign
id|ppp-&gt;index
suffix:semicolon
)brace
r_if
c_cond
(paren
id|unit
OL
l_int|0
)paren
id|unit
op_assign
id|last_unit
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* Create a new ppp structure and link it before `list&squot;. */
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|ppp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ppp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|ppp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ppp
)paren
)paren
suffix:semicolon
id|ppp-&gt;index
op_assign
id|unit
suffix:semicolon
id|sprintf
c_func
(paren
id|ppp-&gt;name
comma
l_string|&quot;ppp%d&quot;
comma
id|unit
)paren
suffix:semicolon
id|ppp-&gt;mru
op_assign
id|PPP_MRU
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|ppp-&gt;xq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|ppp-&gt;rq
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|ppp-&gt;rwait
)paren
suffix:semicolon
id|ppp-&gt;refcnt
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_NP
suffix:semicolon
op_increment
id|i
)paren
id|ppp-&gt;npmode
(braket
id|i
)braket
op_assign
id|NPMODE_PASS
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|ppp-&gt;channels
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|ppp-&gt;recv_pending
)paren
suffix:semicolon
id|ppp-&gt;dev.init
op_assign
id|ppp_net_init
suffix:semicolon
id|ppp-&gt;dev.name
op_assign
id|ppp-&gt;name
suffix:semicolon
id|ppp-&gt;dev.priv
op_assign
id|ppp
suffix:semicolon
id|ret
op_assign
id|register_netdev
c_func
(paren
op_amp
id|ppp-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PPP: couldn&squot;t register device (%d)&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ppp
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|list_add
c_func
(paren
op_amp
id|ppp-&gt;list
comma
id|list-&gt;prev
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|all_ppp_lock
)paren
suffix:semicolon
op_star
id|retp
op_assign
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
id|ppp
op_assign
l_int|0
suffix:semicolon
r_return
id|ppp
suffix:semicolon
)brace
multiline_comment|/*&n; * Locate an existing ppp unit.&n; * The caller should have locked the all_ppp_lock.&n; */
r_static
r_struct
id|ppp
op_star
DECL|function|ppp_find_unit
id|ppp_find_unit
c_func
(paren
r_int
id|unit
)paren
(brace
r_struct
id|ppp
op_star
id|ppp
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|list
op_assign
op_amp
id|all_ppp_units
suffix:semicolon
r_while
c_loop
(paren
(paren
id|list
op_assign
id|list-&gt;next
)paren
op_ne
op_amp
id|all_ppp_units
)paren
(brace
id|ppp
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|ppp
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppp-&gt;index
op_eq
id|unit
)paren
r_return
id|ppp
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Module stuff.&n; */
macro_line|#ifdef MODULE
r_int
DECL|function|init_module
id|init_module
c_func
(paren
r_void
)paren
(brace
id|ppp_init
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* should never happen */
r_if
c_cond
(paren
id|all_ppp_units.next
op_ne
op_amp
id|all_ppp_units
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PPP: removing module but units remain!&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unregister_chrdev
c_func
(paren
id|PPP_MAJOR
comma
l_string|&quot;ppp&quot;
)paren
op_ne
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PPP: failed to unregister PPP device&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
eof
