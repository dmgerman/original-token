multiline_comment|/*&n; *  linux/drivers/ide/ide-pci.c&t;&t;Version 1.05&t;June 9, 2000&n; *&n; *  Copyright (c) 1998-2000  Andre Hedrick &lt;andre@linux-ide.org&gt;&n; *&n; *  Copyright (c) 1995-1998  Mark Lord&n; *  May be copied or modified under the terms of the GNU General Public License&n; */
multiline_comment|/*&n; *  This module provides support for automatic detection and&n; *  configuration of all PCI IDE interfaces present in a system.  &n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
DECL|macro|DEVID_PIIXa
mdefine_line|#define DEVID_PIIXa&t;((ide_pci_devid_t){PCI_VENDOR_ID_INTEL,   PCI_DEVICE_ID_INTEL_82371FB_0})
DECL|macro|DEVID_PIIXb
mdefine_line|#define DEVID_PIIXb&t;((ide_pci_devid_t){PCI_VENDOR_ID_INTEL,   PCI_DEVICE_ID_INTEL_82371FB_1})
DECL|macro|DEVID_PIIX3
mdefine_line|#define DEVID_PIIX3&t;((ide_pci_devid_t){PCI_VENDOR_ID_INTEL,   PCI_DEVICE_ID_INTEL_82371SB_1})
DECL|macro|DEVID_PIIX4
mdefine_line|#define DEVID_PIIX4&t;((ide_pci_devid_t){PCI_VENDOR_ID_INTEL,   PCI_DEVICE_ID_INTEL_82371AB})
DECL|macro|DEVID_PIIX4E
mdefine_line|#define DEVID_PIIX4E&t;((ide_pci_devid_t){PCI_VENDOR_ID_INTEL,   PCI_DEVICE_ID_INTEL_82801AB_1})
DECL|macro|DEVID_PIIX4E2
mdefine_line|#define DEVID_PIIX4E2&t;((ide_pci_devid_t){PCI_VENDOR_ID_INTEL,   PCI_DEVICE_ID_INTEL_82443MX_1})
DECL|macro|DEVID_PIIX4U
mdefine_line|#define DEVID_PIIX4U&t;((ide_pci_devid_t){PCI_VENDOR_ID_INTEL,   PCI_DEVICE_ID_INTEL_82801AA_1})
DECL|macro|DEVID_PIIX4U2
mdefine_line|#define DEVID_PIIX4U2&t;((ide_pci_devid_t){PCI_VENDOR_ID_INTEL,   PCI_DEVICE_ID_INTEL_82372FB_1})
DECL|macro|DEVID_PIIX4NX
mdefine_line|#define DEVID_PIIX4NX&t;((ide_pci_devid_t){PCI_VENDOR_ID_INTEL,   PCI_DEVICE_ID_INTEL_82451NX})
DECL|macro|DEVID_PIIX4U3
mdefine_line|#define DEVID_PIIX4U3&t;((ide_pci_devid_t){PCI_VENDOR_ID_INTEL,   PCI_DEVICE_ID_INTEL_82820FW_5})
DECL|macro|DEVID_VIA_IDE
mdefine_line|#define DEVID_VIA_IDE&t;((ide_pci_devid_t){PCI_VENDOR_ID_VIA,     PCI_DEVICE_ID_VIA_82C561})
DECL|macro|DEVID_VP_IDE
mdefine_line|#define DEVID_VP_IDE&t;((ide_pci_devid_t){PCI_VENDOR_ID_VIA,     PCI_DEVICE_ID_VIA_82C586_1})
DECL|macro|DEVID_PDC20246
mdefine_line|#define DEVID_PDC20246&t;((ide_pci_devid_t){PCI_VENDOR_ID_PROMISE, PCI_DEVICE_ID_PROMISE_20246})
DECL|macro|DEVID_PDC20262
mdefine_line|#define DEVID_PDC20262&t;((ide_pci_devid_t){PCI_VENDOR_ID_PROMISE, PCI_DEVICE_ID_PROMISE_20262})
DECL|macro|DEVID_PDC20265
mdefine_line|#define DEVID_PDC20265&t;((ide_pci_devid_t){PCI_VENDOR_ID_PROMISE, PCI_DEVICE_ID_PROMISE_20265})
DECL|macro|DEVID_PDC20267
mdefine_line|#define DEVID_PDC20267&t;((ide_pci_devid_t){PCI_VENDOR_ID_PROMISE, PCI_DEVICE_ID_PROMISE_20267})
DECL|macro|DEVID_RZ1000
mdefine_line|#define DEVID_RZ1000&t;((ide_pci_devid_t){PCI_VENDOR_ID_PCTECH,  PCI_DEVICE_ID_PCTECH_RZ1000})
DECL|macro|DEVID_RZ1001
mdefine_line|#define DEVID_RZ1001&t;((ide_pci_devid_t){PCI_VENDOR_ID_PCTECH,  PCI_DEVICE_ID_PCTECH_RZ1001})
DECL|macro|DEVID_SAMURAI
mdefine_line|#define DEVID_SAMURAI&t;((ide_pci_devid_t){PCI_VENDOR_ID_PCTECH,  PCI_DEVICE_ID_PCTECH_SAMURAI_IDE})
DECL|macro|DEVID_CMD640
mdefine_line|#define DEVID_CMD640&t;((ide_pci_devid_t){PCI_VENDOR_ID_CMD,     PCI_DEVICE_ID_CMD_640})
DECL|macro|DEVID_CMD643
mdefine_line|#define DEVID_CMD643&t;((ide_pci_devid_t){PCI_VENDOR_ID_CMD,     PCI_DEVICE_ID_CMD_643})
DECL|macro|DEVID_CMD646
mdefine_line|#define DEVID_CMD646&t;((ide_pci_devid_t){PCI_VENDOR_ID_CMD,     PCI_DEVICE_ID_CMD_646})
DECL|macro|DEVID_CMD648
mdefine_line|#define DEVID_CMD648&t;((ide_pci_devid_t){PCI_VENDOR_ID_CMD,     PCI_DEVICE_ID_CMD_648})
DECL|macro|DEVID_CMD649
mdefine_line|#define DEVID_CMD649&t;((ide_pci_devid_t){PCI_VENDOR_ID_CMD,     PCI_DEVICE_ID_CMD_649})
DECL|macro|DEVID_SIS5513
mdefine_line|#define DEVID_SIS5513&t;((ide_pci_devid_t){PCI_VENDOR_ID_SI,      PCI_DEVICE_ID_SI_5513})
DECL|macro|DEVID_OPTI621
mdefine_line|#define DEVID_OPTI621&t;((ide_pci_devid_t){PCI_VENDOR_ID_OPTI,    PCI_DEVICE_ID_OPTI_82C621})
DECL|macro|DEVID_OPTI621V
mdefine_line|#define DEVID_OPTI621V&t;((ide_pci_devid_t){PCI_VENDOR_ID_OPTI,    PCI_DEVICE_ID_OPTI_82C558})
DECL|macro|DEVID_OPTI621X
mdefine_line|#define DEVID_OPTI621X&t;((ide_pci_devid_t){PCI_VENDOR_ID_OPTI,    PCI_DEVICE_ID_OPTI_82C825})
DECL|macro|DEVID_TRM290
mdefine_line|#define DEVID_TRM290&t;((ide_pci_devid_t){PCI_VENDOR_ID_TEKRAM,  PCI_DEVICE_ID_TEKRAM_DC290})
DECL|macro|DEVID_NS87410
mdefine_line|#define DEVID_NS87410&t;((ide_pci_devid_t){PCI_VENDOR_ID_NS,      PCI_DEVICE_ID_NS_87410})
DECL|macro|DEVID_NS87415
mdefine_line|#define DEVID_NS87415&t;((ide_pci_devid_t){PCI_VENDOR_ID_NS,      PCI_DEVICE_ID_NS_87415})
DECL|macro|DEVID_HT6565
mdefine_line|#define DEVID_HT6565&t;((ide_pci_devid_t){PCI_VENDOR_ID_HOLTEK,  PCI_DEVICE_ID_HOLTEK_6565})
DECL|macro|DEVID_AEC6210
mdefine_line|#define DEVID_AEC6210&t;((ide_pci_devid_t){PCI_VENDOR_ID_ARTOP,   PCI_DEVICE_ID_ARTOP_ATP850UF})
DECL|macro|DEVID_AEC6260
mdefine_line|#define DEVID_AEC6260&t;((ide_pci_devid_t){PCI_VENDOR_ID_ARTOP,   PCI_DEVICE_ID_ARTOP_ATP860})
DECL|macro|DEVID_AEC6260R
mdefine_line|#define DEVID_AEC6260R&t;((ide_pci_devid_t){PCI_VENDOR_ID_ARTOP,   PCI_DEVICE_ID_ARTOP_ATP860R})
DECL|macro|DEVID_W82C105
mdefine_line|#define DEVID_W82C105&t;((ide_pci_devid_t){PCI_VENDOR_ID_WINBOND, PCI_DEVICE_ID_WINBOND_82C105})
DECL|macro|DEVID_UM8673F
mdefine_line|#define DEVID_UM8673F&t;((ide_pci_devid_t){PCI_VENDOR_ID_UMC,     PCI_DEVICE_ID_UMC_UM8673F})
DECL|macro|DEVID_UM8886A
mdefine_line|#define DEVID_UM8886A&t;((ide_pci_devid_t){PCI_VENDOR_ID_UMC,     PCI_DEVICE_ID_UMC_UM8886A})
DECL|macro|DEVID_UM8886BF
mdefine_line|#define DEVID_UM8886BF&t;((ide_pci_devid_t){PCI_VENDOR_ID_UMC,     PCI_DEVICE_ID_UMC_UM8886BF})
DECL|macro|DEVID_HPT34X
mdefine_line|#define DEVID_HPT34X&t;((ide_pci_devid_t){PCI_VENDOR_ID_TTI,     PCI_DEVICE_ID_TTI_HPT343})
DECL|macro|DEVID_HPT366
mdefine_line|#define DEVID_HPT366&t;((ide_pci_devid_t){PCI_VENDOR_ID_TTI,     PCI_DEVICE_ID_TTI_HPT366})
DECL|macro|DEVID_ALI15X3
mdefine_line|#define DEVID_ALI15X3&t;((ide_pci_devid_t){PCI_VENDOR_ID_AL,      PCI_DEVICE_ID_AL_M5229})
DECL|macro|DEVID_CY82C693
mdefine_line|#define DEVID_CY82C693&t;((ide_pci_devid_t){PCI_VENDOR_ID_CONTAQ,  PCI_DEVICE_ID_CONTAQ_82C693})
DECL|macro|DEVID_HINT
mdefine_line|#define DEVID_HINT&t;((ide_pci_devid_t){0x3388,                0x8013})
DECL|macro|DEVID_CS5530
mdefine_line|#define DEVID_CS5530&t;((ide_pci_devid_t){PCI_VENDOR_ID_CYRIX,   PCI_DEVICE_ID_CYRIX_5530_IDE})
DECL|macro|DEVID_AMD7403
mdefine_line|#define DEVID_AMD7403&t;((ide_pci_devid_t){PCI_VENDOR_ID_AMD,     PCI_DEVICE_ID_AMD_COBRA_7403})
DECL|macro|DEVID_AMD7409
mdefine_line|#define DEVID_AMD7409&t;((ide_pci_devid_t){PCI_VENDOR_ID_AMD,     PCI_DEVICE_ID_AMD_VIPER_7409})
DECL|macro|DEVID_SLC90E66
mdefine_line|#define DEVID_SLC90E66&t;((ide_pci_devid_t){PCI_VENDOR_ID_EFAR,    PCI_DEVICE_ID_EFAR_SLC90E66_1})
DECL|macro|DEVID_OSB4
mdefine_line|#define DEVID_OSB4&t;((ide_pci_devid_t){PCI_VENDOR_ID_SERVERWORKS, PCI_DEVICE_ID_SERVERWORKS_OSB4IDE})
DECL|macro|IDE_IGNORE
mdefine_line|#define&t;IDE_IGNORE&t;((void *)-1)
macro_line|#ifdef CONFIG_BLK_DEV_AEC62XX
r_extern
r_int
r_int
id|pci_init_aec62xx
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_aec62xx
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_aec62xx
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_dmacapable_aec62xx
c_func
(paren
id|ide_hwif_t
op_star
comma
r_int
r_int
)paren
suffix:semicolon
DECL|macro|PCI_AEC62XX
mdefine_line|#define PCI_AEC62XX&t;&amp;pci_init_aec62xx
DECL|macro|ATA66_AEC62XX
mdefine_line|#define ATA66_AEC62XX&t;&amp;ata66_aec62xx
DECL|macro|INIT_AEC62XX
mdefine_line|#define INIT_AEC62XX&t;&amp;ide_init_aec62xx
DECL|macro|DMA_AEC62XX
mdefine_line|#define DMA_AEC62XX&t;&amp;ide_dmacapable_aec62xx
macro_line|#else
DECL|macro|PCI_AEC62XX
mdefine_line|#define PCI_AEC62XX&t;NULL
DECL|macro|ATA66_AEC62XX
mdefine_line|#define ATA66_AEC62XX&t;NULL
DECL|macro|INIT_AEC62XX
mdefine_line|#define INIT_AEC62XX&t;NULL
DECL|macro|DMA_AEC62XX
mdefine_line|#define DMA_AEC62XX&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_ALI15X3
r_extern
r_int
r_int
id|pci_init_ali15x3
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_ali15x3
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_ali15x3
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_dmacapable_ali15x3
c_func
(paren
id|ide_hwif_t
op_star
comma
r_int
r_int
)paren
suffix:semicolon
DECL|macro|PCI_ALI15X3
mdefine_line|#define PCI_ALI15X3&t;&amp;pci_init_ali15x3
DECL|macro|ATA66_ALI15X3
mdefine_line|#define ATA66_ALI15X3&t;&amp;ata66_ali15x3
DECL|macro|INIT_ALI15X3
mdefine_line|#define INIT_ALI15X3&t;&amp;ide_init_ali15x3
DECL|macro|DMA_ALI15X3
mdefine_line|#define DMA_ALI15X3&t;&amp;ide_dmacapable_ali15x3
macro_line|#else
DECL|macro|PCI_ALI15X3
mdefine_line|#define PCI_ALI15X3&t;NULL
DECL|macro|ATA66_ALI15X3
mdefine_line|#define ATA66_ALI15X3&t;NULL
DECL|macro|INIT_ALI15X3
mdefine_line|#define INIT_ALI15X3&t;NULL
DECL|macro|DMA_ALI15X3
mdefine_line|#define DMA_ALI15X3&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_AMD7409
r_extern
r_int
r_int
id|pci_init_amd7409
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_amd7409
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_amd7409
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_dmacapable_amd7409
c_func
(paren
id|ide_hwif_t
op_star
comma
r_int
r_int
)paren
suffix:semicolon
DECL|macro|PCI_AMD7409
mdefine_line|#define PCI_AMD7409&t;&amp;pci_init_amd7409
DECL|macro|ATA66_AMD7409
mdefine_line|#define ATA66_AMD7409&t;&amp;ata66_amd7409
DECL|macro|INIT_AMD7409
mdefine_line|#define INIT_AMD7409&t;&amp;ide_init_amd7409
DECL|macro|DMA_AMD7409
mdefine_line|#define DMA_AMD7409&t;&amp;ide_dmacapable_amd7409
macro_line|#else
DECL|macro|PCI_AMD7409
mdefine_line|#define PCI_AMD7409&t;NULL
DECL|macro|ATA66_AMD7409
mdefine_line|#define ATA66_AMD7409&t;NULL
DECL|macro|INIT_AMD7409
mdefine_line|#define INIT_AMD7409&t;NULL
DECL|macro|DMA_AMD7409
mdefine_line|#define DMA_AMD7409&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_CMD64X
r_extern
r_int
r_int
id|pci_init_cmd64x
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_cmd64x
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_cmd64x
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_dmacapable_cmd64x
c_func
(paren
id|ide_hwif_t
op_star
comma
r_int
r_int
)paren
suffix:semicolon
DECL|macro|PCI_CMD64X
mdefine_line|#define PCI_CMD64X&t;&amp;pci_init_cmd64x
DECL|macro|ATA66_CMD64X
mdefine_line|#define ATA66_CMD64X&t;&amp;ata66_cmd64x
DECL|macro|INIT_CMD64X
mdefine_line|#define INIT_CMD64X&t;&amp;ide_init_cmd64x
macro_line|#else
DECL|macro|PCI_CMD64X
mdefine_line|#define PCI_CMD64X&t;NULL
DECL|macro|ATA66_CMD64X
mdefine_line|#define ATA66_CMD64X&t;NULL
macro_line|#ifdef __sparc_v9__
DECL|macro|INIT_CMD64X
mdefine_line|#define INIT_CMD64X&t;IDE_IGNORE
macro_line|#else
DECL|macro|INIT_CMD64X
mdefine_line|#define INIT_CMD64X&t;NULL
macro_line|#endif
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_CY82C693
r_extern
r_int
r_int
id|pci_init_cy82c693
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_cy82c693
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|PCI_CY82C693
mdefine_line|#define PCI_CY82C693&t;&amp;pci_init_cy82c693
DECL|macro|INIT_CY82C693
mdefine_line|#define INIT_CY82C693&t;&amp;ide_init_cy82c693
macro_line|#else
DECL|macro|PCI_CY82C693
mdefine_line|#define PCI_CY82C693&t;NULL
DECL|macro|INIT_CY82C693
mdefine_line|#define INIT_CY82C693&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_CS5530
r_extern
r_int
r_int
id|pci_init_cs5530
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_cs5530
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|PCI_CS5530
mdefine_line|#define PCI_CS5530&t;&amp;pci_init_cs5530
DECL|macro|INIT_CS5530
mdefine_line|#define INIT_CS5530&t;&amp;ide_init_cs5530
macro_line|#else
DECL|macro|PCI_CS5530
mdefine_line|#define PCI_CS5530&t;NULL
DECL|macro|INIT_CS5530
mdefine_line|#define INIT_CS5530&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_HPT34X
r_extern
r_int
r_int
id|pci_init_hpt34x
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_hpt34x
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|PCI_HPT34X
mdefine_line|#define PCI_HPT34X&t;&amp;pci_init_hpt34x
DECL|macro|INIT_HPT34X
mdefine_line|#define INIT_HPT34X&t;&amp;ide_init_hpt34x
macro_line|#else
DECL|macro|PCI_HPT34X
mdefine_line|#define PCI_HPT34X&t;NULL
DECL|macro|INIT_HPT34X
mdefine_line|#define INIT_HPT34X&t;IDE_IGNORE
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_HPT366
r_extern
id|byte
id|hpt363_shared_irq
suffix:semicolon
r_extern
id|byte
id|hpt363_shared_pin
suffix:semicolon
r_extern
r_int
r_int
id|pci_init_hpt366
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_hpt366
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_hpt366
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_dmacapable_hpt366
c_func
(paren
id|ide_hwif_t
op_star
comma
r_int
r_int
)paren
suffix:semicolon
DECL|macro|PCI_HPT366
mdefine_line|#define PCI_HPT366&t;&amp;pci_init_hpt366
DECL|macro|ATA66_HPT366
mdefine_line|#define ATA66_HPT366&t;&amp;ata66_hpt366
DECL|macro|INIT_HPT366
mdefine_line|#define INIT_HPT366&t;&amp;ide_init_hpt366
DECL|macro|DMA_HPT366
mdefine_line|#define DMA_HPT366&t;&amp;ide_dmacapable_hpt366
macro_line|#else
DECL|variable|hpt363_shared_irq
r_static
id|byte
id|hpt363_shared_irq
op_assign
l_int|0
suffix:semicolon
DECL|variable|hpt363_shared_pin
r_static
id|byte
id|hpt363_shared_pin
op_assign
l_int|0
suffix:semicolon
DECL|macro|PCI_HPT366
mdefine_line|#define PCI_HPT366&t;NULL
DECL|macro|ATA66_HPT366
mdefine_line|#define ATA66_HPT366&t;NULL
DECL|macro|INIT_HPT366
mdefine_line|#define INIT_HPT366&t;NULL
DECL|macro|DMA_HPT366
mdefine_line|#define DMA_HPT366&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_NS87415
r_extern
r_void
id|ide_init_ns87415
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|INIT_NS87415
mdefine_line|#define INIT_NS87415&t;&amp;ide_init_ns87415
macro_line|#else
DECL|macro|INIT_NS87415
mdefine_line|#define INIT_NS87415&t;IDE_IGNORE
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_OPTI621
r_extern
r_void
id|ide_init_opti621
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|INIT_OPTI621
mdefine_line|#define INIT_OPTI621&t;&amp;ide_init_opti621
macro_line|#else
DECL|macro|INIT_OPTI621
mdefine_line|#define INIT_OPTI621&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_OSB4
r_extern
r_int
r_int
id|pci_init_osb4
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_osb4
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_osb4
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|PCI_OSB4
mdefine_line|#define PCI_OSB4        &amp;pci_init_osb4
DECL|macro|ATA66_OSB4
mdefine_line|#define ATA66_OSB4      &amp;ata66_osb4
DECL|macro|INIT_OSB4
mdefine_line|#define INIT_OSB4       &amp;ide_init_osb4
macro_line|#else
DECL|macro|PCI_OSB4
mdefine_line|#define PCI_OSB4        NULL
DECL|macro|ATA66_OSB4
mdefine_line|#define ATA66_OSB4      NULL
DECL|macro|INIT_OSB4
mdefine_line|#define INIT_OSB4       NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_PDC202XX
r_extern
r_int
r_int
id|pci_init_pdc202xx
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_pdc202xx
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_pdc202xx
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|PCI_PDC202XX
mdefine_line|#define PCI_PDC202XX&t;&amp;pci_init_pdc202xx
DECL|macro|ATA66_PDC202XX
mdefine_line|#define ATA66_PDC202XX&t;&amp;ata66_pdc202xx
DECL|macro|INIT_PDC202XX
mdefine_line|#define INIT_PDC202XX&t;&amp;ide_init_pdc202xx
macro_line|#else
DECL|macro|PCI_PDC202XX
mdefine_line|#define PCI_PDC202XX&t;NULL
DECL|macro|ATA66_PDC202XX
mdefine_line|#define ATA66_PDC202XX&t;NULL
DECL|macro|INIT_PDC202XX
mdefine_line|#define INIT_PDC202XX&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_PIIX
r_extern
r_int
r_int
id|pci_init_piix
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_piix
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_piix
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|PCI_PIIX
mdefine_line|#define PCI_PIIX&t;&amp;pci_init_piix
DECL|macro|ATA66_PIIX
mdefine_line|#define ATA66_PIIX&t;&amp;ata66_piix
DECL|macro|INIT_PIIX
mdefine_line|#define INIT_PIIX&t;&amp;ide_init_piix
macro_line|#else
DECL|macro|PCI_PIIX
mdefine_line|#define PCI_PIIX&t;NULL
DECL|macro|ATA66_PIIX
mdefine_line|#define ATA66_PIIX&t;NULL
DECL|macro|INIT_PIIX
mdefine_line|#define INIT_PIIX&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_RZ1000
r_extern
r_void
id|ide_init_rz1000
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|INIT_RZ1000
mdefine_line|#define INIT_RZ1000&t;&amp;ide_init_rz1000
macro_line|#else
DECL|macro|INIT_RZ1000
mdefine_line|#define INIT_RZ1000&t;IDE_IGNORE
macro_line|#endif
DECL|macro|INIT_SAMURAI
mdefine_line|#define INIT_SAMURAI&t;NULL
macro_line|#ifdef CONFIG_BLK_DEV_SIS5513
r_extern
r_int
r_int
id|pci_init_sis5513
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_sis5513
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_sis5513
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|PCI_SIS5513
mdefine_line|#define PCI_SIS5513&t;&amp;pci_init_sis5513
DECL|macro|ATA66_SIS5513
mdefine_line|#define ATA66_SIS5513&t;&amp;ata66_sis5513
DECL|macro|INIT_SIS5513
mdefine_line|#define INIT_SIS5513&t;&amp;ide_init_sis5513
macro_line|#else
DECL|macro|PCI_SIS5513
mdefine_line|#define PCI_SIS5513&t;NULL
DECL|macro|ATA66_SIS5513
mdefine_line|#define ATA66_SIS5513&t;NULL
DECL|macro|INIT_SIS5513
mdefine_line|#define INIT_SIS5513&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_SLC90E66
r_extern
r_int
r_int
id|pci_init_slc90e66
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_slc90e66
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_slc90e66
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|PCI_SLC90E66
mdefine_line|#define PCI_SLC90E66&t;&amp;pci_init_slc90e66
DECL|macro|ATA66_SLC90E66
mdefine_line|#define ATA66_SLC90E66&t;&amp;ata66_slc90e66
DECL|macro|INIT_SLC90E66
mdefine_line|#define INIT_SLC90E66&t;&amp;ide_init_slc90e66
macro_line|#else
DECL|macro|PCI_SLC90E66
mdefine_line|#define PCI_SLC90E66&t;NULL
DECL|macro|ATA66_SLC90E66
mdefine_line|#define ATA66_SLC90E66&t;NULL
DECL|macro|INIT_SLC90E66
mdefine_line|#define INIT_SLC90E66&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_SL82C105
r_extern
r_void
id|ide_init_sl82c105
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_dmacapable_sl82c105
c_func
(paren
id|ide_hwif_t
op_star
comma
r_int
r_int
)paren
suffix:semicolon
DECL|macro|INIT_W82C105
mdefine_line|#define INIT_W82C105&t;&amp;ide_init_sl82c105
DECL|macro|DMA_W82C105
mdefine_line|#define DMA_W82C105&t;&amp;ide_dmacapable_sl82c105
macro_line|#else
DECL|macro|INIT_W82C105
mdefine_line|#define INIT_W82C105&t;IDE_IGNORE
DECL|macro|DMA_W82C105
mdefine_line|#define DMA_W82C105&t;NULL
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_TRM290
r_extern
r_void
id|ide_init_trm290
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
DECL|macro|INIT_TRM290
mdefine_line|#define INIT_TRM290&t;&amp;ide_init_trm290
macro_line|#else
DECL|macro|INIT_TRM290
mdefine_line|#define INIT_TRM290&t;IDE_IGNORE
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_VIA82CXXX
r_extern
r_int
r_int
id|pci_init_via82cxxx
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ata66_via82cxxx
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_init_via82cxxx
c_func
(paren
id|ide_hwif_t
op_star
)paren
suffix:semicolon
r_extern
r_void
id|ide_dmacapable_via82cxxx
c_func
(paren
id|ide_hwif_t
op_star
comma
r_int
r_int
)paren
suffix:semicolon
DECL|macro|PCI_VIA82CXXX
mdefine_line|#define PCI_VIA82CXXX&t;&amp;pci_init_via82cxxx
DECL|macro|ATA66_VIA82CXXX
mdefine_line|#define ATA66_VIA82CXXX&t;&amp;ata66_via82cxxx
DECL|macro|INIT_VIA82CXXX
mdefine_line|#define INIT_VIA82CXXX&t;&amp;ide_init_via82cxxx
DECL|macro|DMA_VIA82CXXX
mdefine_line|#define DMA_VIA82CXXX&t;&amp;ide_dmacapable_via82cxxx
macro_line|#else
DECL|macro|PCI_VIA82CXXX
mdefine_line|#define PCI_VIA82CXXX&t;NULL
DECL|macro|ATA66_VIA82CXXX
mdefine_line|#define ATA66_VIA82CXXX&t;NULL
DECL|macro|INIT_VIA82CXXX
mdefine_line|#define INIT_VIA82CXXX&t;NULL
DECL|macro|DMA_VIA82CXXX
mdefine_line|#define DMA_VIA82CXXX&t;NULL
macro_line|#endif
DECL|struct|ide_pci_enablebit_s
r_typedef
r_struct
id|ide_pci_enablebit_s
(brace
DECL|member|reg
id|byte
id|reg
suffix:semicolon
multiline_comment|/* byte pci reg holding the enable-bit */
DECL|member|mask
id|byte
id|mask
suffix:semicolon
multiline_comment|/* mask to isolate the enable-bit */
DECL|member|val
id|byte
id|val
suffix:semicolon
multiline_comment|/* value of masked reg when &quot;enabled&quot; */
DECL|typedef|ide_pci_enablebit_t
)brace
id|ide_pci_enablebit_t
suffix:semicolon
DECL|struct|ide_pci_device_s
r_typedef
r_struct
id|ide_pci_device_s
(brace
DECL|member|devid
id|ide_pci_devid_t
id|devid
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|init_chipset
r_int
r_int
(paren
op_star
id|init_chipset
)paren
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_char
op_star
id|name
)paren
suffix:semicolon
DECL|member|ata66_check
r_int
r_int
(paren
op_star
id|ata66_check
)paren
(paren
id|ide_hwif_t
op_star
id|hwif
)paren
suffix:semicolon
DECL|member|init_hwif
r_void
(paren
op_star
id|init_hwif
)paren
(paren
id|ide_hwif_t
op_star
id|hwif
)paren
suffix:semicolon
DECL|member|dma_init
r_void
(paren
op_star
id|dma_init
)paren
(paren
id|ide_hwif_t
op_star
id|hwif
comma
r_int
r_int
id|dmabase
)paren
suffix:semicolon
DECL|member|enablebits
id|ide_pci_enablebit_t
id|enablebits
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|bootable
id|byte
id|bootable
suffix:semicolon
DECL|member|extra
r_int
r_int
id|extra
suffix:semicolon
DECL|typedef|ide_pci_device_t
)brace
id|ide_pci_device_t
suffix:semicolon
DECL|variable|__initdata
r_static
id|ide_pci_device_t
id|ide_pci_chipsets
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|DEVID_PIIXa
comma
l_string|&quot;PIIX&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|INIT_PIIX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_PIIXb
comma
l_string|&quot;PIIX&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|INIT_PIIX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_PIIX3
comma
l_string|&quot;PIIX3&quot;
comma
id|PCI_PIIX
comma
l_int|NULL
comma
id|INIT_PIIX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_PIIX4
comma
l_string|&quot;PIIX4&quot;
comma
id|PCI_PIIX
comma
l_int|NULL
comma
id|INIT_PIIX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_PIIX4E
comma
l_string|&quot;PIIX4&quot;
comma
id|PCI_PIIX
comma
l_int|NULL
comma
id|INIT_PIIX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_PIIX4E2
comma
l_string|&quot;PIIX4&quot;
comma
id|PCI_PIIX
comma
l_int|NULL
comma
id|INIT_PIIX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_PIIX4U
comma
l_string|&quot;PIIX4&quot;
comma
id|PCI_PIIX
comma
id|ATA66_PIIX
comma
id|INIT_PIIX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_PIIX4U2
comma
l_string|&quot;PIIX4&quot;
comma
id|PCI_PIIX
comma
id|ATA66_PIIX
comma
id|INIT_PIIX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_PIIX4NX
comma
l_string|&quot;PIIX4&quot;
comma
id|PCI_PIIX
comma
l_int|NULL
comma
id|INIT_PIIX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_PIIX4U3
comma
l_string|&quot;PIIX4&quot;
comma
id|PCI_PIIX
comma
id|ATA66_PIIX
comma
id|INIT_PIIX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_VIA_IDE
comma
l_string|&quot;VIA_IDE&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_VP_IDE
comma
l_string|&quot;VP_IDE&quot;
comma
id|PCI_VIA82CXXX
comma
id|ATA66_VIA82CXXX
comma
id|INIT_VIA82CXXX
comma
id|DMA_VIA82CXXX
comma
(brace
(brace
l_int|0x40
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
(brace
l_int|0x40
comma
l_int|0x01
comma
l_int|0x01
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_PDC20246
comma
l_string|&quot;PDC20246&quot;
comma
id|PCI_PDC202XX
comma
l_int|NULL
comma
id|INIT_PDC202XX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x50
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
(brace
l_int|0x50
comma
l_int|0x04
comma
l_int|0x04
)brace
)brace
comma
id|OFF_BOARD
comma
l_int|16
)brace
comma
(brace
id|DEVID_PDC20262
comma
l_string|&quot;PDC20262&quot;
comma
id|PCI_PDC202XX
comma
id|ATA66_PDC202XX
comma
id|INIT_PDC202XX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x50
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
(brace
l_int|0x50
comma
l_int|0x04
comma
l_int|0x04
)brace
)brace
comma
id|OFF_BOARD
comma
l_int|48
)brace
comma
(brace
id|DEVID_PDC20265
comma
l_string|&quot;PDC20265&quot;
comma
id|PCI_PDC202XX
comma
id|ATA66_PDC202XX
comma
id|INIT_PDC202XX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x50
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
(brace
l_int|0x50
comma
l_int|0x04
comma
l_int|0x04
)brace
)brace
comma
id|OFF_BOARD
comma
l_int|48
)brace
comma
(brace
id|DEVID_PDC20267
comma
l_string|&quot;PDC20267&quot;
comma
id|PCI_PDC202XX
comma
id|ATA66_PDC202XX
comma
id|INIT_PDC202XX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x50
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
(brace
l_int|0x50
comma
l_int|0x04
comma
l_int|0x04
)brace
)brace
comma
id|OFF_BOARD
comma
l_int|48
)brace
comma
(brace
id|DEVID_RZ1000
comma
l_string|&quot;RZ1000&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|INIT_RZ1000
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_RZ1001
comma
l_string|&quot;RZ1001&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|INIT_RZ1000
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_SAMURAI
comma
l_string|&quot;SAMURAI&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|INIT_SAMURAI
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_CMD640
comma
l_string|&quot;CMD640&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|IDE_IGNORE
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_NS87410
comma
l_string|&quot;NS87410&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
(brace
(brace
l_int|0x43
comma
l_int|0x08
comma
l_int|0x08
)brace
comma
(brace
l_int|0x47
comma
l_int|0x08
comma
l_int|0x08
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_SIS5513
comma
l_string|&quot;SIS5513&quot;
comma
id|PCI_SIS5513
comma
id|ATA66_SIS5513
comma
id|INIT_SIS5513
comma
l_int|NULL
comma
(brace
(brace
l_int|0x4a
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
(brace
l_int|0x4a
comma
l_int|0x04
comma
l_int|0x04
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_CMD643
comma
l_string|&quot;CMD643&quot;
comma
id|PCI_CMD64X
comma
l_int|NULL
comma
id|INIT_CMD64X
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_CMD646
comma
l_string|&quot;CMD646&quot;
comma
id|PCI_CMD64X
comma
l_int|NULL
comma
id|INIT_CMD64X
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x51
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_CMD648
comma
l_string|&quot;CMD648&quot;
comma
id|PCI_CMD64X
comma
id|ATA66_CMD64X
comma
id|INIT_CMD64X
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_CMD649
comma
l_string|&quot;CMD649&quot;
comma
id|PCI_CMD64X
comma
id|ATA66_CMD64X
comma
id|INIT_CMD64X
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_HT6565
comma
l_string|&quot;HT6565&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_OPTI621
comma
l_string|&quot;OPTI621&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|INIT_OPTI621
comma
l_int|NULL
comma
(brace
(brace
l_int|0x45
comma
l_int|0x80
comma
l_int|0x00
)brace
comma
(brace
l_int|0x40
comma
l_int|0x08
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_OPTI621X
comma
l_string|&quot;OPTI621X&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|INIT_OPTI621
comma
l_int|NULL
comma
(brace
(brace
l_int|0x45
comma
l_int|0x80
comma
l_int|0x00
)brace
comma
(brace
l_int|0x40
comma
l_int|0x08
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_TRM290
comma
l_string|&quot;TRM290&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|INIT_TRM290
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_NS87415
comma
l_string|&quot;NS87415&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|INIT_NS87415
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_AEC6210
comma
l_string|&quot;AEC6210&quot;
comma
id|PCI_AEC62XX
comma
l_int|NULL
comma
id|INIT_AEC62XX
comma
id|DMA_AEC62XX
comma
(brace
(brace
l_int|0x4a
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
(brace
l_int|0x4a
comma
l_int|0x04
comma
l_int|0x04
)brace
)brace
comma
id|OFF_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_AEC6260
comma
l_string|&quot;AEC6260&quot;
comma
id|PCI_AEC62XX
comma
id|ATA66_AEC62XX
comma
id|INIT_AEC62XX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|NEVER_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_AEC6260R
comma
l_string|&quot;AEC6260R&quot;
comma
id|PCI_AEC62XX
comma
id|ATA66_AEC62XX
comma
id|INIT_AEC62XX
comma
l_int|NULL
comma
(brace
(brace
l_int|0x4a
comma
l_int|0x02
comma
l_int|0x02
)brace
comma
(brace
l_int|0x4a
comma
l_int|0x04
comma
l_int|0x04
)brace
)brace
comma
id|OFF_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_W82C105
comma
l_string|&quot;W82C105&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|INIT_W82C105
comma
id|DMA_W82C105
comma
(brace
(brace
l_int|0x40
comma
l_int|0x01
comma
l_int|0x01
)brace
comma
(brace
l_int|0x40
comma
l_int|0x10
comma
l_int|0x10
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_UM8673F
comma
l_string|&quot;UM8673F&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_UM8886A
comma
l_string|&quot;UM8886A&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_UM8886BF
comma
l_string|&quot;UM8886BF&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_HPT34X
comma
l_string|&quot;HPT34X&quot;
comma
id|PCI_HPT34X
comma
l_int|NULL
comma
id|INIT_HPT34X
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|NEVER_BOARD
comma
l_int|16
)brace
comma
(brace
id|DEVID_HPT366
comma
l_string|&quot;HPT366&quot;
comma
id|PCI_HPT366
comma
id|ATA66_HPT366
comma
id|INIT_HPT366
comma
id|DMA_HPT366
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|OFF_BOARD
comma
l_int|240
)brace
comma
(brace
id|DEVID_ALI15X3
comma
l_string|&quot;ALI15X3&quot;
comma
id|PCI_ALI15X3
comma
id|ATA66_ALI15X3
comma
id|INIT_ALI15X3
comma
id|DMA_ALI15X3
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_CY82C693
comma
l_string|&quot;CY82C693&quot;
comma
id|PCI_CY82C693
comma
l_int|NULL
comma
id|INIT_CY82C693
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_HINT
comma
l_string|&quot;HINT_IDE&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_CS5530
comma
l_string|&quot;CS5530&quot;
comma
id|PCI_CS5530
comma
l_int|NULL
comma
id|INIT_CS5530
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_AMD7403
comma
l_string|&quot;AMD7403&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_AMD7409
comma
l_string|&quot;AMD7409&quot;
comma
id|PCI_AMD7409
comma
id|ATA66_AMD7409
comma
id|INIT_AMD7409
comma
id|DMA_AMD7409
comma
(brace
(brace
l_int|0x40
comma
l_int|0x01
comma
l_int|0x01
)brace
comma
(brace
l_int|0x40
comma
l_int|0x02
comma
l_int|0x02
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_SLC90E66
comma
l_string|&quot;SLC90E66&quot;
comma
id|PCI_SLC90E66
comma
id|ATA66_SLC90E66
comma
id|INIT_SLC90E66
comma
l_int|NULL
comma
(brace
(brace
l_int|0x41
comma
l_int|0x80
comma
l_int|0x80
)brace
comma
(brace
l_int|0x43
comma
l_int|0x80
comma
l_int|0x80
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|DEVID_OSB4
comma
l_string|&quot;ServerWorks OSB4&quot;
comma
id|PCI_OSB4
comma
id|ATA66_OSB4
comma
id|INIT_OSB4
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
comma
(brace
id|IDE_PCI_DEVID_NULL
comma
l_string|&quot;PCI_IDE&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
(brace
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
id|ON_BOARD
comma
l_int|0
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * This allows offboard ide-pci cards the enable a BIOS, verify interrupt&n; * settings of split-mirror pci-config space, place chipset into init-mode,&n; * and/or preserve an interrupt if the card is not native ide support.&n; */
DECL|function|ide_special_settings
r_static
r_int
r_int
id|__init
id|ide_special_settings
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_char
op_star
id|name
)paren
(brace
r_switch
c_cond
(paren
id|dev-&gt;device
)paren
(brace
r_case
id|PCI_DEVICE_ID_TTI_HPT366
suffix:colon
r_case
id|PCI_DEVICE_ID_PROMISE_20246
suffix:colon
r_case
id|PCI_DEVICE_ID_PROMISE_20262
suffix:colon
r_case
id|PCI_DEVICE_ID_PROMISE_20265
suffix:colon
r_case
id|PCI_DEVICE_ID_PROMISE_20267
suffix:colon
r_case
id|PCI_DEVICE_ID_ARTOP_ATP850UF
suffix:colon
r_case
id|PCI_DEVICE_ID_ARTOP_ATP860
suffix:colon
r_case
id|PCI_DEVICE_ID_ARTOP_ATP860R
suffix:colon
r_return
id|dev-&gt;irq
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Match a PCI IDE port against an entry in ide_hwifs[],&n; * based on io_base port if possible.&n; */
DECL|function|ide_match_hwif
r_static
id|ide_hwif_t
id|__init
op_star
id|ide_match_hwif
(paren
r_int
r_int
id|io_base
comma
id|byte
id|bootable
comma
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|h
suffix:semicolon
id|ide_hwif_t
op_star
id|hwif
suffix:semicolon
multiline_comment|/*&n;&t; * Look for a hwif with matching io_base specified using&n;&t; * parameters to ide_setup().&n;&t; */
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|MAX_HWIFS
suffix:semicolon
op_increment
id|h
)paren
(brace
id|hwif
op_assign
op_amp
id|ide_hwifs
(braket
id|h
)braket
suffix:semicolon
r_if
c_cond
(paren
id|hwif-&gt;io_ports
(braket
id|IDE_DATA_OFFSET
)braket
op_eq
id|io_base
)paren
(brace
r_if
c_cond
(paren
id|hwif-&gt;chipset
op_eq
id|ide_generic
)paren
r_return
id|hwif
suffix:semicolon
multiline_comment|/* a perfect match */
)brace
)brace
multiline_comment|/*&n;&t; * Look for a hwif with matching io_base default value.&n;&t; * If chipset is &quot;ide_unknown&quot;, then claim that hwif slot.&n;&t; * Otherwise, some other chipset has already claimed it..  :(&n;&t; */
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|MAX_HWIFS
suffix:semicolon
op_increment
id|h
)paren
(brace
id|hwif
op_assign
op_amp
id|ide_hwifs
(braket
id|h
)braket
suffix:semicolon
r_if
c_cond
(paren
id|hwif-&gt;io_ports
(braket
id|IDE_DATA_OFFSET
)braket
op_eq
id|io_base
)paren
(brace
r_if
c_cond
(paren
id|hwif-&gt;chipset
op_eq
id|ide_unknown
)paren
r_return
id|hwif
suffix:semicolon
multiline_comment|/* match */
id|printk
c_func
(paren
l_string|&quot;%s: port 0x%04lx already claimed by %s&bslash;n&quot;
comma
id|name
comma
id|io_base
comma
id|hwif-&gt;name
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* already claimed */
)brace
)brace
multiline_comment|/*&n;&t; * Okay, there is no hwif matching our io_base,&n;&t; * so we&squot;ll just claim an unassigned slot.&n;&t; * Give preference to claiming other slots before claiming ide0/ide1,&n;&t; * just in case there&squot;s another interface yet-to-be-scanned&n;&t; * which uses ports 1f0/170 (the ide0/ide1 defaults).&n;&t; *&n;&t; * Unless there is a bootable card that does not use the standard&n;&t; * ports 1f0/170 (the ide0/ide1 defaults). The (bootable) flag.&n;&t; */
r_if
c_cond
(paren
id|bootable
)paren
(brace
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|MAX_HWIFS
suffix:semicolon
op_increment
id|h
)paren
(brace
id|hwif
op_assign
op_amp
id|ide_hwifs
(braket
id|h
)braket
suffix:semicolon
r_if
c_cond
(paren
id|hwif-&gt;chipset
op_eq
id|ide_unknown
)paren
r_return
id|hwif
suffix:semicolon
multiline_comment|/* pick an unused entry */
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|h
op_assign
l_int|2
suffix:semicolon
id|h
OL
id|MAX_HWIFS
suffix:semicolon
op_increment
id|h
)paren
(brace
id|hwif
op_assign
id|ide_hwifs
op_plus
id|h
suffix:semicolon
r_if
c_cond
(paren
id|hwif-&gt;chipset
op_eq
id|ide_unknown
)paren
r_return
id|hwif
suffix:semicolon
multiline_comment|/* pick an unused entry */
)brace
)brace
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
l_int|2
suffix:semicolon
op_increment
id|h
)paren
(brace
id|hwif
op_assign
id|ide_hwifs
op_plus
id|h
suffix:semicolon
r_if
c_cond
(paren
id|hwif-&gt;chipset
op_eq
id|ide_unknown
)paren
r_return
id|hwif
suffix:semicolon
multiline_comment|/* pick an unused entry */
)brace
id|printk
c_func
(paren
l_string|&quot;%s: too many IDE interfaces, no room in table&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ide_setup_pci_baseregs
r_static
r_int
id|__init
id|ide_setup_pci_baseregs
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_char
op_star
id|name
)paren
(brace
id|byte
id|reg
comma
id|progif
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Place both IDE interfaces into PCI &quot;native&quot; mode:&n;&t; */
r_if
c_cond
(paren
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_CLASS_PROG
comma
op_amp
id|progif
)paren
op_logical_or
(paren
id|progif
op_amp
l_int|5
)paren
op_ne
l_int|5
)paren
(brace
r_if
c_cond
(paren
(paren
id|progif
op_amp
l_int|0xa
)paren
op_ne
l_int|0xa
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: device not capable of full native PCI mode&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: placing both ports into native PCI mode&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
(paren
r_void
)paren
id|pci_write_config_byte
c_func
(paren
id|dev
comma
id|PCI_CLASS_PROG
comma
id|progif
op_or
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_CLASS_PROG
comma
op_amp
id|progif
)paren
op_logical_or
(paren
id|progif
op_amp
l_int|5
)paren
op_ne
l_int|5
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: rewrite of PROGIF failed, wanted 0x%04x, got 0x%04x&bslash;n&quot;
comma
id|name
comma
id|progif
op_or
l_int|5
comma
id|progif
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * Setup base registers for IDE command/control spaces for each interface:&n;&t; */
r_for
c_loop
(paren
id|reg
op_assign
l_int|0
suffix:semicolon
id|reg
OL
l_int|4
suffix:semicolon
id|reg
op_increment
)paren
(brace
r_struct
id|resource
op_star
id|res
op_assign
id|dev-&gt;resource
op_plus
id|reg
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res-&gt;flags
op_amp
id|IORESOURCE_IO
)paren
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res-&gt;start
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Missing I/O address #%d&bslash;n&quot;
comma
id|name
comma
id|reg
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * ide_setup_pci_device() looks at the primary/secondary interfaces&n; * on a PCI IDE device and, if they are enabled, prepares the IDE driver&n; * for use with them.  This generic code works for most PCI chipsets.&n; *&n; * One thing that is not standardized is the location of the&n; * primary/secondary interface &quot;enable/disable&quot; bits.  For chipsets that&n; * we &quot;know&quot; about, this information is in the ide_pci_device_t struct;&n; * for all other chipsets, we just assume both interfaces are enabled.&n; */
DECL|function|ide_setup_pci_device
r_static
r_void
id|__init
id|ide_setup_pci_device
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
id|ide_pci_device_t
op_star
id|d
)paren
(brace
r_int
r_int
id|port
comma
id|at_least_one_hwif_enabled
op_assign
l_int|0
comma
id|autodma
op_assign
l_int|0
comma
id|pciirq
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|pcicmd
op_assign
l_int|0
comma
id|tried_config
op_assign
l_int|0
suffix:semicolon
id|byte
id|tmp
op_assign
l_int|0
suffix:semicolon
id|ide_hwif_t
op_star
id|hwif
comma
op_star
id|mate
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|class_rev
suffix:semicolon
macro_line|#ifdef CONFIG_IDEDMA_AUTO
id|autodma
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|pci_enable_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|check_if_enabled
suffix:colon
r_if
c_cond
(paren
id|pci_read_config_word
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
op_amp
id|pcicmd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: error accessing PCI regs&bslash;n&quot;
comma
id|d-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pcicmd
op_amp
id|PCI_COMMAND_IO
)paren
)paren
(brace
multiline_comment|/* is device disabled? */
multiline_comment|/*&n;&t;&t; * PnP BIOS was *supposed* to have set this device up for us,&n;&t;&t; * but we can do it ourselves, so long as the BIOS has assigned an IRQ&n;&t;&t; *  (or possibly the device is using a &quot;legacy header&quot; for IRQs).&n;&t;&t; * Maybe the user deliberately *disabled* the device,&n;&t;&t; * but we&squot;ll eventually ignore it again if no drives respond.&n;&t;&t; */
r_if
c_cond
(paren
id|tried_config
op_increment
op_logical_or
id|ide_setup_pci_baseregs
c_func
(paren
id|dev
comma
id|d-&gt;name
)paren
op_logical_or
id|pci_write_config_word
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
id|pcicmd
op_or
id|PCI_COMMAND_IO
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: device disabled (BIOS)&bslash;n&quot;
comma
id|d-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|autodma
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* default DMA off if we had to configure it here */
r_goto
id|check_if_enabled
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tried_config
)paren
id|printk
c_func
(paren
l_string|&quot;%s: device enabled (Linux)&bslash;n&quot;
comma
id|d-&gt;name
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|class_rev
)paren
suffix:semicolon
id|class_rev
op_and_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_HPT34X
)paren
)paren
(brace
multiline_comment|/* see comments in hpt34x.c on why..... */
r_char
op_star
id|chipset_names
(braket
)braket
op_assign
(brace
l_string|&quot;HPT343&quot;
comma
l_string|&quot;HPT345&quot;
)brace
suffix:semicolon
id|strcpy
c_func
(paren
id|d-&gt;name
comma
id|chipset_names
(braket
(paren
id|pcicmd
op_amp
id|PCI_COMMAND_MEMORY
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)braket
)paren
suffix:semicolon
id|d-&gt;bootable
op_assign
(paren
id|pcicmd
op_amp
id|PCI_COMMAND_MEMORY
)paren
ques
c_cond
id|OFF_BOARD
suffix:colon
id|NEVER_BOARD
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: chipset revision %d&bslash;n&quot;
comma
id|d-&gt;name
comma
id|class_rev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Can we trust the reported IRQ?&n;&t; */
id|pciirq
op_assign
id|dev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_member_access_from_pointer
r_class
op_amp
op_complement
(paren
l_int|0xfa
)paren
)paren
op_ne
(paren
(paren
id|PCI_CLASS_STORAGE_IDE
op_lshift
l_int|8
)paren
op_or
l_int|5
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: not 100%% native mode: will probe irqs later&bslash;n&quot;
comma
id|d-&gt;name
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * This allows offboard ide-pci cards the enable a BIOS,&n;&t;&t; * verify interrupt settings of split-mirror pci-config&n;&t;&t; * space, place chipset into init-mode, and/or preserve&n;&t;&t; * an interrupt if the card is not native ide support.&n;&t;&t; */
id|pciirq
op_assign
(paren
id|d-&gt;init_chipset
)paren
ques
c_cond
id|d
op_member_access_from_pointer
id|init_chipset
c_func
(paren
id|dev
comma
id|d-&gt;name
)paren
suffix:colon
id|ide_special_settings
c_func
(paren
id|dev
comma
id|d-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tried_config
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: will probe irqs later&bslash;n&quot;
comma
id|d-&gt;name
)paren
suffix:semicolon
id|pciirq
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|pciirq
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: bad irq (%d): will probe later&bslash;n&quot;
comma
id|d-&gt;name
comma
id|pciirq
)paren
suffix:semicolon
id|pciirq
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|d-&gt;init_chipset
)paren
(paren
r_void
)paren
id|d
op_member_access_from_pointer
id|init_chipset
c_func
(paren
id|dev
comma
id|d-&gt;name
)paren
suffix:semicolon
macro_line|#ifdef __sparc__
id|printk
c_func
(paren
l_string|&quot;%s: 100%% native mode on irq %s&bslash;n&quot;
comma
id|d-&gt;name
comma
id|__irq_itoa
c_func
(paren
id|pciirq
)paren
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;%s: 100%% native mode on irq %d&bslash;n&quot;
comma
id|d-&gt;name
comma
id|pciirq
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n;&t; * Set up the IDE ports&n;&t; */
r_for
c_loop
(paren
id|port
op_assign
l_int|0
suffix:semicolon
id|port
op_le
l_int|1
suffix:semicolon
op_increment
id|port
)paren
(brace
r_int
r_int
id|base
op_assign
l_int|0
comma
id|ctl
op_assign
l_int|0
suffix:semicolon
id|ide_pci_enablebit_t
op_star
id|e
op_assign
op_amp
(paren
id|d-&gt;enablebits
(braket
id|port
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|e-&gt;reg
op_logical_and
(paren
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|e-&gt;reg
comma
op_amp
id|tmp
)paren
op_logical_or
(paren
id|tmp
op_amp
id|e-&gt;mask
)paren
op_ne
id|e-&gt;val
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* port not enabled */
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_HPT366
)paren
op_logical_and
(paren
id|port
)paren
op_logical_and
(paren
id|class_rev
OL
l_int|0x03
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_member_access_from_pointer
r_class
op_rshift
l_int|8
)paren
op_ne
id|PCI_CLASS_STORAGE_IDE
op_logical_or
(paren
id|dev
op_member_access_from_pointer
r_class
op_amp
(paren
id|port
ques
c_cond
l_int|4
suffix:colon
l_int|1
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|ctl
op_assign
id|dev-&gt;resource
(braket
(paren
l_int|2
op_star
id|port
)paren
op_plus
l_int|1
)braket
dot
id|start
suffix:semicolon
id|base
op_assign
id|dev-&gt;resource
(braket
l_int|2
op_star
id|port
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ctl
op_amp
id|PCI_BASE_ADDRESS_IO_MASK
)paren
op_logical_or
op_logical_neg
(paren
id|base
op_amp
id|PCI_BASE_ADDRESS_IO_MASK
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: IO baseregs (BIOS) are reported as MEM, report to &lt;andre@linux-ide.org&gt;.&bslash;n&quot;
comma
id|d-&gt;name
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* FIXME! This really should check that it really gets the IO/MEM part right! */
r_continue
suffix:semicolon
macro_line|#endif
)brace
)brace
r_if
c_cond
(paren
(paren
id|ctl
op_logical_and
op_logical_neg
id|base
)paren
op_logical_or
(paren
id|base
op_logical_and
op_logical_neg
id|ctl
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: inconsistent baseregs (BIOS) for port %d, skipping&bslash;n&quot;
comma
id|d-&gt;name
comma
id|port
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ctl
)paren
id|ctl
op_assign
id|port
ques
c_cond
l_int|0x374
suffix:colon
l_int|0x3f4
suffix:semicolon
multiline_comment|/* use default value */
r_if
c_cond
(paren
op_logical_neg
id|base
)paren
id|base
op_assign
id|port
ques
c_cond
l_int|0x170
suffix:colon
l_int|0x1f0
suffix:semicolon
multiline_comment|/* use default value */
r_if
c_cond
(paren
(paren
id|hwif
op_assign
id|ide_match_hwif
c_func
(paren
id|base
comma
id|d-&gt;bootable
comma
id|d-&gt;name
)paren
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
multiline_comment|/* no room in ide_hwifs[] */
r_if
c_cond
(paren
id|hwif-&gt;io_ports
(braket
id|IDE_DATA_OFFSET
)braket
op_ne
id|base
)paren
(brace
id|ide_init_hwif_ports
c_func
(paren
op_amp
id|hwif-&gt;hw
comma
id|base
comma
(paren
id|ctl
op_or
l_int|2
)paren
comma
l_int|NULL
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|hwif-&gt;io_ports
comma
id|hwif-&gt;hw.io_ports
comma
r_sizeof
(paren
id|hwif-&gt;io_ports
)paren
)paren
suffix:semicolon
id|hwif-&gt;noprobe
op_assign
op_logical_neg
id|hwif-&gt;io_ports
(braket
id|IDE_DATA_OFFSET
)braket
suffix:semicolon
)brace
id|hwif-&gt;chipset
op_assign
id|ide_pci
suffix:semicolon
id|hwif-&gt;pci_dev
op_assign
id|dev
suffix:semicolon
id|hwif-&gt;pci_devid
op_assign
id|d-&gt;devid
suffix:semicolon
id|hwif-&gt;channel
op_assign
id|port
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwif-&gt;irq
)paren
id|hwif-&gt;irq
op_assign
id|pciirq
suffix:semicolon
r_if
c_cond
(paren
id|mate
)paren
(brace
id|hwif-&gt;mate
op_assign
id|mate
suffix:semicolon
id|mate-&gt;mate
op_assign
id|hwif
suffix:semicolon
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_AEC6210
)paren
)paren
(brace
id|hwif-&gt;serialized
op_assign
l_int|1
suffix:semicolon
id|mate-&gt;serialized
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_UM8886A
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_UM8886BF
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_UM8673F
)paren
)paren
(brace
id|hwif-&gt;irq
op_assign
id|hwif-&gt;channel
ques
c_cond
l_int|15
suffix:colon
l_int|14
suffix:semicolon
r_goto
id|bypass_umc_dma
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hwif-&gt;udma_four
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: ATA-66/100 forced bit set (WARNING)!!&bslash;n&quot;
comma
id|d-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|hwif-&gt;udma_four
op_assign
(paren
id|d-&gt;ata66_check
)paren
ques
c_cond
id|d
op_member_access_from_pointer
id|ata66_check
c_func
(paren
id|hwif
)paren
suffix:colon
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BLK_DEV_IDEDMA
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_SIS5513
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_AEC6260
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_PIIX4NX
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_HPT34X
)paren
)paren
id|autodma
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|autodma
)paren
id|hwif-&gt;autodma
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_PDC20246
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_PDC20262
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_PDC20265
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_PDC20267
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_AEC6210
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_AEC6260
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_AEC6260R
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_HPT34X
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_HPT366
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_CS5530
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_CY82C693
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_CMD646
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_CMD648
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_CMD649
)paren
op_logical_or
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_OSB4
)paren
op_logical_or
(paren
(paren
id|dev
op_member_access_from_pointer
r_class
op_rshift
l_int|8
)paren
op_eq
id|PCI_CLASS_STORAGE_IDE
op_logical_and
(paren
id|dev
op_member_access_from_pointer
r_class
op_amp
l_int|0x80
)paren
)paren
)paren
(brace
r_int
r_int
id|dma_base
op_assign
id|ide_get_or_set_dma_base
c_func
(paren
id|hwif
comma
(paren
op_logical_neg
id|mate
op_logical_and
id|d-&gt;extra
)paren
ques
c_cond
id|d-&gt;extra
suffix:colon
l_int|0
comma
id|d-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma_base
op_logical_and
op_logical_neg
(paren
id|pcicmd
op_amp
id|PCI_COMMAND_MASTER
)paren
)paren
(brace
multiline_comment|/*&n; &t; &t;&t;&t; * Set up BM-DMA capability (PnP BIOS should have done this)&n; &t; &t;&t;&t; */
id|hwif-&gt;autodma
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* default DMA off if we had to configure it here */
(paren
r_void
)paren
id|pci_write_config_word
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
id|pcicmd
op_or
id|PCI_COMMAND_MASTER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_read_config_word
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
op_amp
id|pcicmd
)paren
op_logical_or
op_logical_neg
(paren
id|pcicmd
op_amp
id|PCI_COMMAND_MASTER
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %s error updating PCICMD&bslash;n&quot;
comma
id|hwif-&gt;name
comma
id|d-&gt;name
)paren
suffix:semicolon
id|dma_base
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dma_base
)paren
(brace
r_if
c_cond
(paren
id|d-&gt;dma_init
)paren
(brace
id|d
op_member_access_from_pointer
id|dma_init
c_func
(paren
id|hwif
comma
id|dma_base
)paren
suffix:semicolon
)brace
r_else
(brace
id|ide_setup_dma
c_func
(paren
id|hwif
comma
id|dma_base
comma
l_int|8
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %s Bus-Master DMA disabled (BIOS)&bslash;n&quot;
comma
id|hwif-&gt;name
comma
id|d-&gt;name
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif&t;/* CONFIG_BLK_DEV_IDEDMA */
id|bypass_umc_dma
suffix:colon
r_if
c_cond
(paren
id|d-&gt;init_hwif
)paren
multiline_comment|/* Call chipset-specific routine for each enabled hwif */
id|d
op_member_access_from_pointer
id|init_hwif
c_func
(paren
id|hwif
)paren
suffix:semicolon
id|mate
op_assign
id|hwif
suffix:semicolon
id|at_least_one_hwif_enabled
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|at_least_one_hwif_enabled
)paren
id|printk
c_func
(paren
l_string|&quot;%s: neither IDE port enabled (BIOS)&bslash;n&quot;
comma
id|d-&gt;name
)paren
suffix:semicolon
)brace
DECL|function|hpt366_device_order_fixup
r_static
r_void
id|__init
id|hpt366_device_order_fixup
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
id|ide_pci_device_t
op_star
id|d
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev2
op_assign
l_int|NULL
comma
op_star
id|findev
suffix:semicolon
id|ide_pci_device_t
op_star
id|d2
suffix:semicolon
r_int
r_char
id|pin1
op_assign
l_int|0
comma
id|pin2
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|class_rev
suffix:semicolon
r_char
op_star
id|chipset_names
(braket
)braket
op_assign
(brace
l_string|&quot;HPT366&quot;
comma
l_string|&quot;HPT366&quot;
comma
l_string|&quot;HPT368&quot;
comma
l_string|&quot;HPT370&quot;
comma
l_string|&quot;HPT370A&quot;
)brace
suffix:semicolon
r_if
c_cond
(paren
id|PCI_FUNC
c_func
(paren
id|dev-&gt;devfn
)paren
op_amp
l_int|1
)paren
r_return
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|class_rev
)paren
suffix:semicolon
id|class_rev
op_and_assign
l_int|0xff
suffix:semicolon
id|strcpy
c_func
(paren
id|d-&gt;name
comma
id|chipset_names
(braket
id|class_rev
)braket
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|class_rev
)paren
(brace
r_case
l_int|4
suffix:colon
r_case
l_int|3
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: IDE controller on PCI bus %02x dev %02x&bslash;n&quot;
comma
id|d-&gt;name
comma
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
)paren
suffix:semicolon
id|ide_setup_pci_device
c_func
(paren
id|dev
comma
id|d
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_INTERRUPT_PIN
comma
op_amp
id|pin1
)paren
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|findev
)paren
(brace
r_if
c_cond
(paren
(paren
id|findev-&gt;vendor
op_eq
id|dev-&gt;vendor
)paren
op_logical_and
(paren
id|findev-&gt;device
op_eq
id|dev-&gt;device
)paren
op_logical_and
(paren
(paren
id|findev-&gt;devfn
op_minus
id|dev-&gt;devfn
)paren
op_eq
l_int|1
)paren
op_logical_and
(paren
id|PCI_FUNC
c_func
(paren
id|findev-&gt;devfn
)paren
op_amp
l_int|1
)paren
)paren
(brace
id|dev2
op_assign
id|findev
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|dev2
comma
id|PCI_INTERRUPT_PIN
comma
op_amp
id|pin2
)paren
suffix:semicolon
id|hpt363_shared_pin
op_assign
(paren
id|pin1
op_ne
id|pin2
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|hpt363_shared_irq
op_assign
(paren
id|dev-&gt;irq
op_eq
id|dev2-&gt;irq
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hpt363_shared_pin
op_logical_and
id|hpt363_shared_irq
)paren
(brace
id|d-&gt;bootable
op_assign
id|ON_BOARD
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: onboard version of chipset, pin1=%d pin2=%d&bslash;n&quot;
comma
id|d-&gt;name
comma
id|pin1
comma
id|pin2
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;%s: IDE controller on PCI bus %02x dev %02x&bslash;n&quot;
comma
id|d-&gt;name
comma
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
)paren
suffix:semicolon
id|ide_setup_pci_device
c_func
(paren
id|dev
comma
id|d
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev2
)paren
r_return
suffix:semicolon
id|d2
op_assign
id|d
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: IDE controller on PCI bus %02x dev %02x&bslash;n&quot;
comma
id|d2-&gt;name
comma
id|dev2-&gt;bus-&gt;number
comma
id|dev2-&gt;devfn
)paren
suffix:semicolon
id|ide_setup_pci_device
c_func
(paren
id|dev2
comma
id|d2
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ide_scan_pcibus() gets invoked at boot time from ide.c.&n; * It finds all PCI IDE controllers and calls ide_setup_pci_device for them.&n; */
DECL|function|ide_scan_pcidev
r_void
id|__init
id|ide_scan_pcidev
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|ide_pci_devid_t
id|devid
suffix:semicolon
id|ide_pci_device_t
op_star
id|d
suffix:semicolon
id|devid.vid
op_assign
id|dev-&gt;vendor
suffix:semicolon
id|devid.did
op_assign
id|dev-&gt;device
suffix:semicolon
r_for
c_loop
(paren
id|d
op_assign
id|ide_pci_chipsets
suffix:semicolon
id|d-&gt;devid.vid
op_logical_and
op_logical_neg
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|devid
)paren
suffix:semicolon
op_increment
id|d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;init_hwif
op_eq
id|IDE_IGNORE
)paren
id|printk
c_func
(paren
l_string|&quot;%s: ignored by ide_scan_pci_device() (uses own driver)&bslash;n&quot;
comma
id|d-&gt;name
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_OPTI621V
)paren
op_logical_and
op_logical_neg
(paren
id|PCI_FUNC
c_func
(paren
id|dev-&gt;devfn
)paren
op_amp
l_int|1
)paren
)paren
r_return
suffix:semicolon
r_else
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_CY82C693
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|PCI_FUNC
c_func
(paren
id|dev-&gt;devfn
)paren
op_amp
l_int|1
)paren
op_logical_or
op_logical_neg
(paren
(paren
id|dev
op_member_access_from_pointer
r_class
op_rshift
l_int|8
)paren
op_eq
id|PCI_CLASS_STORAGE_IDE
)paren
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* CY82C693 is more than only a IDE controller */
r_else
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_UM8886A
)paren
op_logical_and
op_logical_neg
(paren
id|PCI_FUNC
c_func
(paren
id|dev-&gt;devfn
)paren
op_amp
l_int|1
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* UM8886A/BF pair */
r_else
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|DEVID_HPT366
)paren
)paren
id|hpt366_device_order_fixup
c_func
(paren
id|dev
comma
id|d
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|IDE_PCI_DEVID_NULL
)paren
op_logical_or
(paren
id|dev
op_member_access_from_pointer
r_class
op_rshift
l_int|8
)paren
op_eq
id|PCI_CLASS_STORAGE_IDE
)paren
(brace
r_if
c_cond
(paren
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|d-&gt;devid
comma
id|IDE_PCI_DEVID_NULL
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s: unknown IDE controller on PCI bus %02x device %02x, VID=%04x, DID=%04x&bslash;n&quot;
comma
id|d-&gt;name
comma
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
id|devid.vid
comma
id|devid.did
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%s: IDE controller on PCI bus %02x dev %02x&bslash;n&quot;
comma
id|d-&gt;name
comma
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
)paren
suffix:semicolon
id|ide_setup_pci_device
c_func
(paren
id|dev
comma
id|d
)paren
suffix:semicolon
)brace
)brace
DECL|function|ide_scan_pcibus
r_void
id|__init
id|ide_scan_pcibus
(paren
r_int
id|scan_direction
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scan_direction
)paren
(brace
id|pci_for_each_dev
c_func
(paren
id|dev
)paren
(brace
id|ide_scan_pcidev
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|pci_for_each_dev_reverse
c_func
(paren
id|dev
)paren
(brace
id|ide_scan_pcidev
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
eof
