multiline_comment|/*&n; *  linux/drivers/ide/ide-proc.c&t;Version 1.03&t;January  2, 1998&n; *&n; *  Copyright (C) 1997-1998&t;Mark Lord&n; */
multiline_comment|/*&n; * This is the /proc/ide/ filesystem implementation.&n; *&n; * The major reason this exists is to provide sufficient access&n; * to driver and config data, such that user-mode programs can&n; * be developed to handle chipset tuning for most PCI interfaces.&n; * This should provide better utilities, and less kernel bloat.&n; *&n; * The entire pci config space for a PCI interface chipset can be&n; * retrieved by just reading it.  e.g.    &quot;cat /proc/ide3/config&quot;&n; *&n; * To modify registers *safely*, do something like:&n; *   echo &quot;P40:88&quot; &gt;/proc/ide/ide3/config&n; * That expression writes 0x88 to pci config register 0x40&n; * on the chip which controls ide3.  Multiple tuples can be issued,&n; * and the writes will be completed as an atomic set:&n; *   echo &quot;P40:88 P41:35 P42:00 P43:00&quot; &gt;/proc/ide/ide3/config&n; *&n; * All numbers must be specified using pairs of ascii hex digits.&n; * It is important to note that these writes will be performed&n; * after waiting for the IDE controller (both interfaces)&n; * to be completely idle, to ensure no corruption of I/O in progress.&n; *&n; * Non-PCI registers can also be written, using &quot;R&quot; in place of &quot;P&quot;&n; * in the above examples.  The size of the port transfer is determined&n; * by the number of pairs of hex digits given for the data.  If a two&n; * digit value is given, the write will be a byte operation; if four&n; * digits are used, the write will be performed as a 16-bit operation;&n; * and if eight digits are specified, a 32-bit &quot;dword&quot; write will be&n; * performed.  Odd numbers of digits are not permitted.&n; *&n; * If there is an error *anywhere* in the string of registers/data&n; * then *none* of the writes will be performed.&n; *&n; * Drive/Driver settings can be retrieved by reading the drive&squot;s&n; * &quot;settings&quot; files.  e.g.    &quot;cat /proc/ide0/hda/settings&quot;&n; * To write a new value &quot;val&quot; into a specific setting &quot;name&quot;, use:&n; *   echo &quot;name:val&quot; &gt;/proc/ide/ide0/hda/settings&n; *&n; * Also useful, &quot;cat /proc/ide0/hda/[identify, smart_values,&n; * smart_thresholds, capabilities]&quot; will issue an IDENTIFY /&n; * PACKET_IDENTIFY / SMART_READ_VALUES / SMART_READ_THRESHOLDS /&n; * SENSE CAPABILITIES command to /dev/hda, and then dump out the&n; * returned data as 256 16-bit words.  The &quot;hdparm&quot; utility will&n; * be updated someday soon to use this mechanism.&n; *&n; * Feel free to develop and distribute fancy GUI configuration&n; * utilities for your favorite PCI chipsets.  I&squot;ll be working on&n; * one for the Promise 20246 someday soon.  -ml&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#ifndef MIN
DECL|macro|MIN
mdefine_line|#define MIN(a,b) (((a) &lt; (b)) ? (a) : (b))
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_AEC62XX
r_extern
id|byte
id|aec62xx_proc
suffix:semicolon
DECL|variable|aec62xx_display_info
r_int
(paren
op_star
id|aec62xx_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AEC62XX */
macro_line|#ifdef CONFIG_BLK_DEV_ALI15X3
r_extern
id|byte
id|ali_proc
suffix:semicolon
DECL|variable|ali_display_info
r_int
(paren
op_star
id|ali_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_ALI15X3 */
macro_line|#ifdef CONFIG_BLK_DEV_AMD7409
r_extern
id|byte
id|amd7409_proc
suffix:semicolon
DECL|variable|amd7409_display_info
r_int
(paren
op_star
id|amd7409_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AMD7409 */
macro_line|#ifdef CONFIG_BLK_DEV_CMD64X
r_extern
id|byte
id|cmd64x_proc
suffix:semicolon
DECL|variable|cmd64x_display_info
r_int
(paren
op_star
id|cmd64x_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CMD64X */
macro_line|#ifdef CONFIG_BLK_DEV_CS5530
r_extern
id|byte
id|cs5530_proc
suffix:semicolon
DECL|variable|cs5530_display_info
r_int
(paren
op_star
id|cs5530_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CS5530 */
macro_line|#ifdef CONFIG_BLK_DEV_HPT34X
r_extern
id|byte
id|hpt34x_proc
suffix:semicolon
DECL|variable|hpt34x_display_info
r_int
(paren
op_star
id|hpt34x_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT34X */
macro_line|#ifdef CONFIG_BLK_DEV_HPT366
r_extern
id|byte
id|hpt366_proc
suffix:semicolon
DECL|variable|hpt366_display_info
r_int
(paren
op_star
id|hpt366_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT366 */
macro_line|#ifdef CONFIG_BLK_DEV_OSB4
r_extern
id|byte
id|osb4_proc
suffix:semicolon
DECL|variable|osb4_display_info
r_int
(paren
op_star
id|osb4_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_OSB4 */
macro_line|#ifdef CONFIG_BLK_DEV_PDC202XX
r_extern
id|byte
id|pdc202xx_proc
suffix:semicolon
DECL|variable|pdc202xx_display_info
r_int
(paren
op_star
id|pdc202xx_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PDC202XX */
macro_line|#ifdef CONFIG_BLK_DEV_PIIX
r_extern
id|byte
id|piix_proc
suffix:semicolon
DECL|variable|piix_display_info
r_int
(paren
op_star
id|piix_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PIIX */
macro_line|#ifdef CONFIG_BLK_DEV_SIS5513
r_extern
id|byte
id|sis_proc
suffix:semicolon
DECL|variable|sis_display_info
r_int
(paren
op_star
id|sis_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SIS5513 */
macro_line|#ifdef CONFIG_BLK_DEV_SLC90E66
r_extern
id|byte
id|slc90e66_proc
suffix:semicolon
DECL|variable|slc90e66_display_info
r_int
(paren
op_star
id|slc90e66_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SLC90E66 */
macro_line|#ifdef CONFIG_BLK_DEV_VIA82CXXX
r_extern
id|byte
id|via_proc
suffix:semicolon
DECL|variable|via_display_info
r_int
(paren
op_star
id|via_display_info
)paren
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_VIA82CXXX */
DECL|function|ide_getxdigit
r_static
r_int
id|ide_getxdigit
c_func
(paren
r_char
id|c
)paren
(brace
r_int
id|digit
suffix:semicolon
r_if
c_cond
(paren
id|isdigit
c_func
(paren
id|c
)paren
)paren
id|digit
op_assign
id|c
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|isxdigit
c_func
(paren
id|c
)paren
)paren
id|digit
op_assign
id|tolower
c_func
(paren
id|c
)paren
op_minus
l_char|&squot;a&squot;
op_plus
l_int|10
suffix:semicolon
r_else
id|digit
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
id|digit
suffix:semicolon
)brace
DECL|function|xx_xx_parse_error
r_static
r_int
id|xx_xx_parse_error
(paren
r_const
r_char
op_star
id|data
comma
r_int
r_int
id|len
comma
r_const
r_char
op_star
id|msg
)paren
(brace
r_char
id|errbuf
(braket
l_int|16
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ge
r_sizeof
(paren
id|errbuf
)paren
)paren
id|len
op_assign
r_sizeof
(paren
id|errbuf
)paren
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
op_increment
id|i
)paren
(brace
r_char
id|c
op_assign
id|data
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
op_logical_or
id|c
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|c
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|iscntrl
c_func
(paren
id|c
)paren
)paren
id|c
op_assign
l_char|&squot;?&squot;
suffix:semicolon
id|errbuf
(braket
id|i
)braket
op_assign
id|c
suffix:semicolon
)brace
id|errbuf
(braket
id|i
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;proc_ide: error: %s: &squot;%s&squot;&bslash;n&quot;
comma
id|msg
comma
id|errbuf
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|proc_ide_root
r_static
r_struct
id|proc_dir_entry
op_star
id|proc_ide_root
op_assign
l_int|NULL
suffix:semicolon
DECL|function|proc_ide_write_config
r_static
r_int
id|proc_ide_write_config
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
id|ide_hwif_t
op_star
id|hwif
op_assign
(paren
id|ide_hwif_t
op_star
)paren
id|data
suffix:semicolon
r_int
id|for_real
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|startn
op_assign
l_int|0
comma
id|n
comma
id|flags
suffix:semicolon
r_const
r_char
op_star
id|start
op_assign
l_int|NULL
comma
op_star
id|msg
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
op_logical_or
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
multiline_comment|/*&n;&t; * Skip over leading whitespace&n;&t; */
r_while
c_loop
(paren
id|count
op_logical_and
id|isspace
c_func
(paren
op_star
id|buffer
)paren
)paren
(brace
op_decrement
id|count
suffix:semicolon
op_increment
id|buffer
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Do one full pass to verify all parameters,&n;&t; * then do another to actually write the regs.&n;&t; */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* all CPUs */
r_do
(brace
r_const
r_char
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|for_real
)paren
(brace
r_int
r_int
id|timeout
op_assign
id|jiffies
op_plus
(paren
l_int|3
op_star
id|HZ
)paren
suffix:semicolon
id|ide_hwgroup_t
op_star
id|mygroup
op_assign
(paren
id|ide_hwgroup_t
op_star
)paren
(paren
id|hwif-&gt;hwgroup
)paren
suffix:semicolon
id|ide_hwgroup_t
op_star
id|mategroup
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|hwif-&gt;mate
op_logical_and
id|hwif-&gt;mate-&gt;hwgroup
)paren
id|mategroup
op_assign
(paren
id|ide_hwgroup_t
op_star
)paren
(paren
id|hwif-&gt;mate-&gt;hwgroup
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* all CPUs; ensure all writes are done together */
r_while
c_loop
(paren
id|mygroup-&gt;busy
op_logical_or
(paren
id|mategroup
op_logical_and
id|mategroup-&gt;busy
)paren
)paren
(brace
id|sti
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* all CPUs */
r_if
c_cond
(paren
l_int|0
OL
(paren
r_int
r_int
)paren
(paren
id|jiffies
op_minus
id|timeout
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;/proc/ide/%s/config: channel(s) busy, cannot write&bslash;n&quot;
comma
id|hwif-&gt;name
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* all CPUs */
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* all CPUs */
)brace
)brace
id|p
op_assign
id|buffer
suffix:semicolon
id|n
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
)paren
(brace
r_int
id|d
comma
id|digits
suffix:semicolon
r_int
r_int
id|reg
op_assign
l_int|0
comma
id|val
op_assign
l_int|0
comma
id|is_pci
suffix:semicolon
id|start
op_assign
id|p
suffix:semicolon
id|startn
op_assign
id|n
op_decrement
suffix:semicolon
r_switch
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
r_case
l_char|&squot;R&squot;
suffix:colon
id|is_pci
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;P&squot;
suffix:colon
id|is_pci
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_IDEPCI
r_if
c_cond
(paren
id|hwif-&gt;pci_dev
op_logical_and
op_logical_neg
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|hwif-&gt;pci_devid
comma
id|IDE_PCI_DEVID_NULL
)paren
)paren
r_break
suffix:semicolon
macro_line|#endif&t;/* CONFIG_BLK_DEV_IDEPCI */
id|msg
op_assign
l_string|&quot;not a PCI device&quot;
suffix:semicolon
r_goto
id|parse_error
suffix:semicolon
r_default
suffix:colon
id|msg
op_assign
l_string|&quot;expected &squot;R&squot; or &squot;P&squot;&quot;
suffix:semicolon
r_goto
id|parse_error
suffix:semicolon
)brace
id|digits
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
op_logical_and
(paren
id|d
op_assign
id|ide_getxdigit
c_func
(paren
op_star
id|p
)paren
)paren
op_ge
l_int|0
)paren
(brace
id|reg
op_assign
(paren
id|reg
op_lshift
l_int|4
)paren
op_or
id|d
suffix:semicolon
op_decrement
id|n
suffix:semicolon
op_increment
id|p
suffix:semicolon
op_increment
id|digits
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|digits
op_logical_or
(paren
id|digits
OG
l_int|4
)paren
op_logical_or
(paren
id|is_pci
op_logical_and
id|reg
OG
l_int|0xff
)paren
)paren
(brace
id|msg
op_assign
l_string|&quot;bad/missing register number&quot;
suffix:semicolon
r_goto
id|parse_error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|n
op_decrement
op_eq
l_int|0
op_logical_or
op_star
id|p
op_increment
op_ne
l_char|&squot;:&squot;
)paren
(brace
id|msg
op_assign
l_string|&quot;missing &squot;:&squot;&quot;
suffix:semicolon
r_goto
id|parse_error
suffix:semicolon
)brace
id|digits
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
op_logical_and
(paren
id|d
op_assign
id|ide_getxdigit
c_func
(paren
op_star
id|p
)paren
)paren
op_ge
l_int|0
)paren
(brace
id|val
op_assign
(paren
id|val
op_lshift
l_int|4
)paren
op_or
id|d
suffix:semicolon
op_decrement
id|n
suffix:semicolon
op_increment
id|p
suffix:semicolon
op_increment
id|digits
suffix:semicolon
)brace
r_if
c_cond
(paren
id|digits
op_ne
l_int|2
op_logical_and
id|digits
op_ne
l_int|4
op_logical_and
id|digits
op_ne
l_int|8
)paren
(brace
id|msg
op_assign
l_string|&quot;bad data, 2/4/8 digits required&quot;
suffix:semicolon
r_goto
id|parse_error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|n
OG
l_int|0
op_logical_and
op_logical_neg
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
(brace
id|msg
op_assign
l_string|&quot;expected whitespace after data&quot;
suffix:semicolon
r_goto
id|parse_error
suffix:semicolon
)brace
r_while
c_loop
(paren
id|n
OG
l_int|0
op_logical_and
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
(brace
op_decrement
id|n
suffix:semicolon
op_increment
id|p
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BLK_DEV_IDEPCI
r_if
c_cond
(paren
id|is_pci
op_logical_and
(paren
id|reg
op_amp
(paren
(paren
id|digits
op_rshift
l_int|1
)paren
op_minus
l_int|1
)paren
)paren
)paren
(brace
id|msg
op_assign
l_string|&quot;misaligned access&quot;
suffix:semicolon
r_goto
id|parse_error
suffix:semicolon
)brace
macro_line|#endif&t;/* CONFIG_BLK_DEV_IDEPCI */
r_if
c_cond
(paren
id|for_real
)paren
(brace
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;proc_ide_write_config: type=%c, reg=0x%x, val=0x%x, digits=%d&bslash;n&quot;
comma
id|is_pci
ques
c_cond
l_string|&quot;PCI&quot;
suffix:colon
l_string|&quot;non-PCI&quot;
comma
id|reg
comma
id|val
comma
id|digits
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|is_pci
)paren
(brace
macro_line|#ifdef CONFIG_BLK_DEV_IDEPCI
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|hwif-&gt;pci_dev
suffix:semicolon
r_switch
c_cond
(paren
id|digits
)paren
(brace
r_case
l_int|2
suffix:colon
id|msg
op_assign
l_string|&quot;byte&quot;
suffix:semicolon
id|rc
op_assign
id|pci_write_config_byte
c_func
(paren
id|dev
comma
id|reg
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|msg
op_assign
l_string|&quot;word&quot;
suffix:semicolon
id|rc
op_assign
id|pci_write_config_word
c_func
(paren
id|dev
comma
id|reg
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|msg
op_assign
l_string|&quot;dword&quot;
suffix:semicolon
id|rc
op_assign
id|pci_write_config_dword
c_func
(paren
id|dev
comma
id|reg
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rc
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* all CPUs */
id|printk
c_func
(paren
l_string|&quot;proc_ide_write_config: error writing %s at bus %02x dev %02x reg 0x%x value 0x%x&bslash;n&quot;
comma
id|msg
comma
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;proc_ide_write_config: error %d&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#endif&t;/* CONFIG_BLK_DEV_IDEPCI */
)brace
r_else
(brace
multiline_comment|/* not pci */
macro_line|#if !defined(__mc68000__) &amp;&amp; !defined(CONFIG_APUS)
multiline_comment|/*&n; * Geert Uytterhoeven&n; *&n; * unless you can explain me what it really does.&n; * On m68k, we don&squot;t have outw() and outl() yet,&n; * and I need a good reason to implement it.&n; * &n; * BTW, IMHO the main remaining portability problem with the IDE driver &n; * is that it mixes IO (ioport) and MMIO (iomem) access on different platforms.&n; * &n; * I think all accesses should be done using&n; * &n; *     ide_in[bwl](ide_device_instance, offset)&n; *     ide_out[bwl](ide_device_instance, value, offset)&n; * &n; * so the architecture specific code can #define ide_{in,out}[bwl] to the&n; * appropriate function.&n; * &n; */
r_switch
c_cond
(paren
id|digits
)paren
(brace
r_case
l_int|2
suffix:colon
id|outb
c_func
(paren
id|val
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|outw
c_func
(paren
id|val
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|outl
c_func
(paren
id|val
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif /* !__mc68000__ &amp;&amp; !CONFIG_APUS */
)brace
)brace
)brace
)brace
r_while
c_loop
(paren
op_logical_neg
id|for_real
op_increment
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* all CPUs */
r_return
id|count
suffix:semicolon
id|parse_error
suffix:colon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* all CPUs */
id|printk
c_func
(paren
l_string|&quot;parse error&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|xx_xx_parse_error
c_func
(paren
id|start
comma
id|startn
comma
id|msg
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_read_config
r_static
r_int
id|proc_ide_read_config
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_char
op_star
id|out
op_assign
id|page
suffix:semicolon
r_int
id|len
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_IDEPCI
id|ide_hwif_t
op_star
id|hwif
op_assign
(paren
id|ide_hwif_t
op_star
)paren
id|data
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|hwif-&gt;pci_dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IDE_PCI_DEVID_EQ
c_func
(paren
id|hwif-&gt;pci_devid
comma
id|IDE_PCI_DEVID_NULL
)paren
op_logical_and
id|dev
op_logical_and
id|dev-&gt;bus
)paren
(brace
r_int
id|reg
op_assign
l_int|0
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;pci bus %02x device %02x vid %04x did %04x channel %d&bslash;n&quot;
comma
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
id|hwif-&gt;pci_devid.vid
comma
id|hwif-&gt;pci_devid.did
comma
id|hwif-&gt;channel
)paren
suffix:semicolon
r_do
(brace
id|byte
id|val
suffix:semicolon
r_int
id|rc
op_assign
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|reg
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;proc_ide_read_config: error %d reading bus %02x dev %02x reg 0x%02x&bslash;n&quot;
comma
id|rc
comma
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
id|reg
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;??%c&quot;
comma
(paren
op_increment
id|reg
op_amp
l_int|0xf
)paren
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
r_else
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%02x%c&quot;
comma
id|val
comma
(paren
op_increment
id|reg
op_amp
l_int|0xf
)paren
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|reg
OL
l_int|0x100
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif&t;/* CONFIG_BLK_DEV_IDEPCI */
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;(none)&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_assign
id|out
op_minus
id|page
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|ide_getdigit
r_static
r_int
id|ide_getdigit
c_func
(paren
r_char
id|c
)paren
(brace
r_int
id|digit
suffix:semicolon
r_if
c_cond
(paren
id|isdigit
c_func
(paren
id|c
)paren
)paren
id|digit
op_assign
id|c
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_else
id|digit
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
id|digit
suffix:semicolon
)brace
DECL|function|proc_ide_read_drivers
r_static
r_int
id|proc_ide_read_drivers
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_char
op_star
id|out
op_assign
id|page
suffix:semicolon
r_int
id|len
suffix:semicolon
id|ide_module_t
op_star
id|p
op_assign
id|ide_modules
suffix:semicolon
id|ide_driver_t
op_star
id|driver
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
id|driver
op_assign
(paren
id|ide_driver_t
op_star
)paren
id|p-&gt;info
suffix:semicolon
r_if
c_cond
(paren
id|driver
)paren
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%s version %s&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|driver-&gt;version
)paren
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
id|len
op_assign
id|out
op_minus
id|page
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_read_imodel
r_static
r_int
id|proc_ide_read_imodel
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_hwif_t
op_star
id|hwif
op_assign
(paren
id|ide_hwif_t
op_star
)paren
id|data
suffix:semicolon
r_int
id|len
suffix:semicolon
r_const
r_char
op_star
id|name
suffix:semicolon
r_switch
c_cond
(paren
id|hwif-&gt;chipset
)paren
(brace
r_case
id|ide_unknown
suffix:colon
id|name
op_assign
l_string|&quot;(none)&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_generic
suffix:colon
id|name
op_assign
l_string|&quot;generic&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_pci
suffix:colon
id|name
op_assign
l_string|&quot;pci&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_cmd640
suffix:colon
id|name
op_assign
l_string|&quot;cmd640&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_dtc2278
suffix:colon
id|name
op_assign
l_string|&quot;dtc2278&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_ali14xx
suffix:colon
id|name
op_assign
l_string|&quot;ali14xx&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_qd6580
suffix:colon
id|name
op_assign
l_string|&quot;qd6580&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_umc8672
suffix:colon
id|name
op_assign
l_string|&quot;umc8672&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_ht6560b
suffix:colon
id|name
op_assign
l_string|&quot;ht6560b&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_pdc4030
suffix:colon
id|name
op_assign
l_string|&quot;pdc4030&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_rz1000
suffix:colon
id|name
op_assign
l_string|&quot;rz1000&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_trm290
suffix:colon
id|name
op_assign
l_string|&quot;trm290&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_cmd646
suffix:colon
id|name
op_assign
l_string|&quot;cmd646&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_cy82c693
suffix:colon
id|name
op_assign
l_string|&quot;cy82c693&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_4drives
suffix:colon
id|name
op_assign
l_string|&quot;4drives&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_pmac
suffix:colon
id|name
op_assign
l_string|&quot;mac-io&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|name
op_assign
l_string|&quot;(unknown)&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_read_mate
r_static
r_int
id|proc_ide_read_mate
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_hwif_t
op_star
id|hwif
op_assign
(paren
id|ide_hwif_t
op_star
)paren
id|data
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|hwif
op_logical_and
id|hwif-&gt;mate
op_logical_and
id|hwif-&gt;mate-&gt;present
)paren
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|hwif-&gt;mate-&gt;name
)paren
suffix:semicolon
r_else
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;(none)&bslash;n&quot;
)paren
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_read_channel
r_static
r_int
id|proc_ide_read_channel
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_hwif_t
op_star
id|hwif
op_assign
(paren
id|ide_hwif_t
op_star
)paren
id|data
suffix:semicolon
r_int
id|len
suffix:semicolon
id|page
(braket
l_int|0
)braket
op_assign
id|hwif-&gt;channel
ques
c_cond
l_char|&squot;1&squot;
suffix:colon
l_char|&squot;0&squot;
suffix:semicolon
id|page
(braket
l_int|1
)braket
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|len
op_assign
l_int|2
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_get_identify
r_static
r_int
id|proc_ide_get_identify
c_func
(paren
id|ide_drive_t
op_star
id|drive
comma
id|byte
op_star
id|buf
)paren
(brace
r_return
id|ide_wait_cmd
c_func
(paren
id|drive
comma
(paren
id|drive-&gt;media
op_eq
id|ide_disk
)paren
ques
c_cond
id|WIN_IDENTIFY
suffix:colon
id|WIN_PIDENTIFY
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
id|buf
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_read_identify
r_static
r_int
id|proc_ide_read_identify
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
(paren
id|ide_drive_t
op_star
)paren
id|data
suffix:semicolon
r_int
id|len
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|drive
op_logical_and
op_logical_neg
id|proc_ide_get_identify
c_func
(paren
id|drive
comma
id|page
)paren
)paren
(brace
r_int
r_int
op_star
id|val
op_assign
(paren
(paren
r_int
r_int
op_star
)paren
id|page
)paren
op_plus
l_int|2
suffix:semicolon
r_char
op_star
id|out
op_assign
(paren
(paren
r_char
op_star
)paren
id|val
)paren
op_plus
(paren
id|SECTOR_WORDS
op_star
l_int|4
)paren
suffix:semicolon
id|page
op_assign
id|out
suffix:semicolon
r_do
(brace
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%04x%c&quot;
comma
id|le16_to_cpu
c_func
(paren
op_star
id|val
)paren
comma
(paren
op_increment
id|i
op_amp
l_int|7
)paren
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|val
op_add_assign
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
(paren
id|SECTOR_WORDS
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|len
op_assign
id|out
op_minus
id|page
suffix:semicolon
)brace
r_else
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_read_settings
r_static
r_int
id|proc_ide_read_settings
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
(paren
id|ide_drive_t
op_star
)paren
id|data
suffix:semicolon
id|ide_settings_t
op_star
id|setting
op_assign
(paren
id|ide_settings_t
op_star
)paren
id|drive-&gt;settings
suffix:semicolon
r_char
op_star
id|out
op_assign
id|page
suffix:semicolon
r_int
id|len
comma
id|rc
comma
id|mul_factor
comma
id|div_factor
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;name&bslash;t&bslash;t&bslash;tvalue&bslash;t&bslash;tmin&bslash;t&bslash;tmax&bslash;t&bslash;tmode&bslash;n&quot;
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;----&bslash;t&bslash;t&bslash;t-----&bslash;t&bslash;t---&bslash;t&bslash;t---&bslash;t&bslash;t----&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|setting
)paren
(brace
id|mul_factor
op_assign
id|setting-&gt;mul_factor
suffix:semicolon
id|div_factor
op_assign
id|setting-&gt;div_factor
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%-24s&quot;
comma
id|setting-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|ide_read_setting
c_func
(paren
id|drive
comma
id|setting
)paren
)paren
op_ge
l_int|0
)paren
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%-16d&quot;
comma
id|rc
op_star
id|mul_factor
op_div
id|div_factor
)paren
suffix:semicolon
r_else
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%-16s&quot;
comma
l_string|&quot;write-only&quot;
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;%-16d%-16d&quot;
comma
(paren
id|setting-&gt;min
op_star
id|mul_factor
op_plus
id|div_factor
op_minus
l_int|1
)paren
op_div
id|div_factor
comma
id|setting-&gt;max
op_star
id|mul_factor
op_div
id|div_factor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|setting-&gt;rw
op_amp
id|SETTING_READ
)paren
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;r&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|setting-&gt;rw
op_amp
id|SETTING_WRITE
)paren
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;w&quot;
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|setting
op_assign
id|setting-&gt;next
suffix:semicolon
)brace
id|len
op_assign
id|out
op_minus
id|page
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|macro|MAX_LEN
mdefine_line|#define MAX_LEN&t;30
DECL|function|proc_ide_write_settings
r_static
r_int
id|proc_ide_write_settings
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
(paren
id|ide_drive_t
op_star
)paren
id|data
suffix:semicolon
r_char
id|name
(braket
id|MAX_LEN
op_plus
l_int|1
)braket
suffix:semicolon
r_int
id|for_real
op_assign
l_int|0
comma
id|len
suffix:semicolon
r_int
r_int
id|n
suffix:semicolon
r_const
r_char
op_star
id|start
op_assign
l_int|NULL
suffix:semicolon
id|ide_settings_t
op_star
id|setting
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
multiline_comment|/*&n;&t; * Skip over leading whitespace&n;&t; */
r_while
c_loop
(paren
id|count
op_logical_and
id|isspace
c_func
(paren
op_star
id|buffer
)paren
)paren
(brace
op_decrement
id|count
suffix:semicolon
op_increment
id|buffer
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Do one full pass to verify all parameters,&n;&t; * then do another to actually write the new settings.&n;&t; */
r_do
(brace
r_const
r_char
op_star
id|p
suffix:semicolon
id|p
op_assign
id|buffer
suffix:semicolon
id|n
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
)paren
(brace
r_int
id|d
comma
id|digits
suffix:semicolon
r_int
r_int
id|val
op_assign
l_int|0
suffix:semicolon
id|start
op_assign
id|p
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
op_logical_and
op_star
id|p
op_ne
l_char|&squot;:&squot;
)paren
(brace
op_decrement
id|n
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_ne
l_char|&squot;:&squot;
)paren
r_goto
id|parse_error
suffix:semicolon
id|len
op_assign
id|IDE_MIN
c_func
(paren
id|p
op_minus
id|start
comma
id|MAX_LEN
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|name
comma
id|start
comma
id|IDE_MIN
c_func
(paren
id|len
comma
id|MAX_LEN
)paren
)paren
suffix:semicolon
id|name
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
l_int|0
)paren
(brace
op_decrement
id|n
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
r_else
r_goto
id|parse_error
suffix:semicolon
id|digits
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
op_logical_and
(paren
id|d
op_assign
id|ide_getdigit
c_func
(paren
op_star
id|p
)paren
)paren
op_ge
l_int|0
)paren
(brace
id|val
op_assign
(paren
id|val
op_star
l_int|10
)paren
op_plus
id|d
suffix:semicolon
op_decrement
id|n
suffix:semicolon
op_increment
id|p
suffix:semicolon
op_increment
id|digits
suffix:semicolon
)brace
r_if
c_cond
(paren
id|n
OG
l_int|0
op_logical_and
op_logical_neg
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
r_goto
id|parse_error
suffix:semicolon
r_while
c_loop
(paren
id|n
OG
l_int|0
op_logical_and
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
(brace
op_decrement
id|n
suffix:semicolon
op_increment
id|p
suffix:semicolon
)brace
id|setting
op_assign
id|ide_find_setting_by_name
c_func
(paren
id|drive
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|setting
)paren
r_goto
id|parse_error
suffix:semicolon
r_if
c_cond
(paren
id|for_real
)paren
id|ide_write_setting
c_func
(paren
id|drive
comma
id|setting
comma
id|val
op_star
id|setting-&gt;div_factor
op_div
id|setting-&gt;mul_factor
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_logical_neg
id|for_real
op_increment
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
id|parse_error
suffix:colon
id|printk
c_func
(paren
l_string|&quot;proc_ide_write_settings(): parse error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|proc_ide_read_capacity
r_int
id|proc_ide_read_capacity
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
(paren
id|ide_drive_t
op_star
)paren
id|data
suffix:semicolon
id|ide_driver_t
op_star
id|driver
op_assign
(paren
id|ide_driver_t
op_star
)paren
id|drive-&gt;driver
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|driver
)paren
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;(none)&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%li&bslash;n&quot;
comma
(paren
(paren
id|ide_driver_t
op_star
)paren
id|drive-&gt;driver
)paren
op_member_access_from_pointer
id|capacity
c_func
(paren
id|drive
)paren
)paren
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_read_geometry
r_int
id|proc_ide_read_geometry
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
(paren
id|ide_drive_t
op_star
)paren
id|data
suffix:semicolon
r_char
op_star
id|out
op_assign
id|page
suffix:semicolon
r_int
id|len
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;physical     %d/%d/%d&bslash;n&quot;
comma
id|drive-&gt;cyl
comma
id|drive-&gt;head
comma
id|drive-&gt;sect
)paren
suffix:semicolon
id|out
op_add_assign
id|sprintf
c_func
(paren
id|out
comma
l_string|&quot;logical      %d/%d/%d&bslash;n&quot;
comma
id|drive-&gt;bios_cyl
comma
id|drive-&gt;bios_head
comma
id|drive-&gt;bios_sect
)paren
suffix:semicolon
id|len
op_assign
id|out
op_minus
id|page
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_read_dmodel
r_static
r_int
id|proc_ide_read_dmodel
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
(paren
id|ide_drive_t
op_star
)paren
id|data
suffix:semicolon
r_struct
id|hd_driveid
op_star
id|id
op_assign
id|drive-&gt;id
suffix:semicolon
r_int
id|len
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%.40s&bslash;n&quot;
comma
(paren
id|id
op_logical_and
id|id-&gt;model
(braket
l_int|0
)braket
)paren
ques
c_cond
(paren
r_char
op_star
)paren
id|id-&gt;model
suffix:colon
l_string|&quot;(none)&quot;
)paren
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_read_driver
r_static
r_int
id|proc_ide_read_driver
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
(paren
id|ide_drive_t
op_star
)paren
id|data
suffix:semicolon
id|ide_driver_t
op_star
id|driver
op_assign
(paren
id|ide_driver_t
op_star
)paren
id|drive-&gt;driver
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|driver
)paren
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;(none)&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s version %s&bslash;n&quot;
comma
id|driver-&gt;name
comma
id|driver-&gt;version
)paren
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|proc_ide_write_driver
r_static
r_int
id|proc_ide_write_driver
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
(paren
id|ide_drive_t
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|ide_replace_subdriver
c_func
(paren
id|drive
comma
id|buffer
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|proc_ide_read_media
r_static
r_int
id|proc_ide_read_media
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
(paren
id|ide_drive_t
op_star
)paren
id|data
suffix:semicolon
r_const
r_char
op_star
id|media
suffix:semicolon
r_int
id|len
suffix:semicolon
r_switch
c_cond
(paren
id|drive-&gt;media
)paren
(brace
r_case
id|ide_disk
suffix:colon
id|media
op_assign
l_string|&quot;disk&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_cdrom
suffix:colon
id|media
op_assign
l_string|&quot;cdrom&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_tape
suffix:colon
id|media
op_assign
l_string|&quot;tape&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ide_floppy
suffix:colon
id|media
op_assign
l_string|&quot;floppy&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|media
op_assign
l_string|&quot;UNKNOWN&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|page
comma
id|media
)paren
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|media
)paren
suffix:semicolon
id|PROC_IDE_READ_RETURN
c_func
(paren
id|page
comma
id|start
comma
id|off
comma
id|count
comma
id|eof
comma
id|len
)paren
suffix:semicolon
)brace
DECL|variable|generic_drive_entries
r_static
id|ide_proc_entry_t
id|generic_drive_entries
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;driver&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
id|proc_ide_read_driver
comma
id|proc_ide_write_driver
)brace
comma
(brace
l_string|&quot;identify&quot;
comma
id|S_IFREG
op_or
id|S_IRUSR
comma
id|proc_ide_read_identify
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;media&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
id|proc_ide_read_media
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;model&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
id|proc_ide_read_dmodel
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;settings&quot;
comma
id|S_IFREG
op_or
id|S_IRUSR
op_or
id|S_IWUSR
comma
id|proc_ide_read_settings
comma
id|proc_ide_write_settings
)brace
comma
(brace
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)brace
)brace
suffix:semicolon
DECL|function|ide_add_proc_entries
r_void
id|ide_add_proc_entries
c_func
(paren
r_struct
id|proc_dir_entry
op_star
id|dir
comma
id|ide_proc_entry_t
op_star
id|p
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|ent
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dir
op_logical_or
op_logical_neg
id|p
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|p-&gt;name
op_ne
l_int|NULL
)paren
(brace
id|ent
op_assign
id|create_proc_entry
c_func
(paren
id|p-&gt;name
comma
id|p-&gt;mode
comma
id|dir
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ent
)paren
r_return
suffix:semicolon
id|ent-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|ent-&gt;data
op_assign
id|data
suffix:semicolon
id|ent-&gt;read_proc
op_assign
id|p-&gt;read_proc
suffix:semicolon
id|ent-&gt;write_proc
op_assign
id|p-&gt;write_proc
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
)brace
DECL|function|ide_remove_proc_entries
r_void
id|ide_remove_proc_entries
c_func
(paren
r_struct
id|proc_dir_entry
op_star
id|dir
comma
id|ide_proc_entry_t
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dir
op_logical_or
op_logical_neg
id|p
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|p-&gt;name
op_ne
l_int|NULL
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|p-&gt;name
comma
id|dir
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
)brace
DECL|function|create_proc_ide_drives
r_static
r_void
id|create_proc_ide_drives
c_func
(paren
id|ide_hwif_t
op_star
id|hwif
)paren
(brace
r_int
id|d
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|ent
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|parent
op_assign
id|hwif-&gt;proc
suffix:semicolon
r_char
id|name
(braket
l_int|64
)braket
suffix:semicolon
r_for
c_loop
(paren
id|d
op_assign
l_int|0
suffix:semicolon
id|d
OL
id|MAX_DRIVES
suffix:semicolon
id|d
op_increment
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
op_amp
id|hwif-&gt;drives
(braket
id|d
)braket
suffix:semicolon
id|ide_driver_t
op_star
id|driver
op_assign
id|drive-&gt;driver
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|drive-&gt;present
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|drive-&gt;proc
)paren
r_continue
suffix:semicolon
id|drive-&gt;proc
op_assign
id|proc_mkdir
c_func
(paren
id|drive-&gt;name
comma
id|parent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drive-&gt;proc
)paren
(brace
id|ide_add_proc_entries
c_func
(paren
id|drive-&gt;proc
comma
id|generic_drive_entries
comma
id|drive
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver
)paren
(brace
id|ide_add_proc_entries
c_func
(paren
id|drive-&gt;proc
comma
id|generic_subdriver_entries
comma
id|drive
)paren
suffix:semicolon
id|ide_add_proc_entries
c_func
(paren
id|drive-&gt;proc
comma
id|driver-&gt;proc
comma
id|drive
)paren
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;ide%d/%s&quot;
comma
(paren
id|drive-&gt;name
(braket
l_int|2
)braket
op_minus
l_char|&squot;a&squot;
)paren
op_div
l_int|2
comma
id|drive-&gt;name
)paren
suffix:semicolon
id|ent
op_assign
id|proc_symlink
c_func
(paren
id|drive-&gt;name
comma
id|proc_ide_root
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ent
)paren
r_return
suffix:semicolon
)brace
)brace
DECL|function|destroy_proc_ide_drives
r_void
id|destroy_proc_ide_drives
c_func
(paren
id|ide_hwif_t
op_star
id|hwif
)paren
(brace
r_int
id|d
suffix:semicolon
r_for
c_loop
(paren
id|d
op_assign
l_int|0
suffix:semicolon
id|d
OL
id|MAX_DRIVES
suffix:semicolon
id|d
op_increment
)paren
(brace
id|ide_drive_t
op_star
id|drive
op_assign
op_amp
id|hwif-&gt;drives
(braket
id|d
)braket
suffix:semicolon
id|ide_driver_t
op_star
id|driver
op_assign
id|drive-&gt;driver
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|drive-&gt;proc
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|driver
)paren
id|ide_remove_proc_entries
c_func
(paren
id|drive-&gt;proc
comma
id|driver-&gt;proc
)paren
suffix:semicolon
id|ide_remove_proc_entries
c_func
(paren
id|drive-&gt;proc
comma
id|generic_drive_entries
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|drive-&gt;name
comma
id|proc_ide_root
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|drive-&gt;name
comma
id|hwif-&gt;proc
)paren
suffix:semicolon
id|drive-&gt;proc
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|variable|hwif_entries
r_static
id|ide_proc_entry_t
id|hwif_entries
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;channel&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
id|proc_ide_read_channel
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;config&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|proc_ide_read_config
comma
id|proc_ide_write_config
)brace
comma
(brace
l_string|&quot;mate&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
id|proc_ide_read_mate
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;model&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
id|proc_ide_read_imodel
comma
l_int|NULL
)brace
comma
(brace
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)brace
)brace
suffix:semicolon
DECL|function|create_proc_ide_interfaces
r_void
id|create_proc_ide_interfaces
c_func
(paren
r_void
)paren
(brace
r_int
id|h
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|MAX_HWIFS
suffix:semicolon
id|h
op_increment
)paren
(brace
id|ide_hwif_t
op_star
id|hwif
op_assign
op_amp
id|ide_hwifs
(braket
id|h
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwif-&gt;present
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwif-&gt;proc
)paren
(brace
id|hwif-&gt;proc
op_assign
id|proc_mkdir
c_func
(paren
id|hwif-&gt;name
comma
id|proc_ide_root
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwif-&gt;proc
)paren
r_return
suffix:semicolon
id|ide_add_proc_entries
c_func
(paren
id|hwif-&gt;proc
comma
id|hwif_entries
comma
id|hwif
)paren
suffix:semicolon
)brace
id|create_proc_ide_drives
c_func
(paren
id|hwif
)paren
suffix:semicolon
)brace
)brace
DECL|function|destroy_proc_ide_interfaces
r_static
r_void
id|destroy_proc_ide_interfaces
c_func
(paren
r_void
)paren
(brace
r_int
id|h
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|MAX_HWIFS
suffix:semicolon
id|h
op_increment
)paren
(brace
id|ide_hwif_t
op_star
id|hwif
op_assign
op_amp
id|ide_hwifs
(braket
id|h
)braket
suffix:semicolon
r_int
id|exist
op_assign
(paren
id|hwif-&gt;proc
op_ne
l_int|NULL
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
op_logical_neg
id|hwif-&gt;present
)paren
r_continue
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|exist
)paren
(brace
id|destroy_proc_ide_drives
c_func
(paren
id|hwif
)paren
suffix:semicolon
id|ide_remove_proc_entries
c_func
(paren
id|hwif-&gt;proc
comma
id|hwif_entries
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|hwif-&gt;name
comma
id|proc_ide_root
)paren
suffix:semicolon
id|hwif-&gt;proc
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_continue
suffix:semicolon
)brace
)brace
DECL|function|proc_ide_create
r_void
id|proc_ide_create
c_func
(paren
r_void
)paren
(brace
id|proc_ide_root
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;ide&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_ide_root
)paren
r_return
suffix:semicolon
id|create_proc_ide_interfaces
c_func
(paren
)paren
suffix:semicolon
id|create_proc_read_entry
c_func
(paren
l_string|&quot;drivers&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|proc_ide_read_drivers
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_AEC62XX
r_if
c_cond
(paren
(paren
id|aec62xx_display_info
)paren
op_logical_and
(paren
id|aec62xx_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;aec62xx&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|aec62xx_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AEC62XX */
macro_line|#ifdef CONFIG_BLK_DEV_ALI15X3
r_if
c_cond
(paren
(paren
id|ali_display_info
)paren
op_logical_and
(paren
id|ali_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;ali&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|ali_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_ALI15X3 */
macro_line|#ifdef CONFIG_BLK_DEV_AMD7409
r_if
c_cond
(paren
(paren
id|amd7409_display_info
)paren
op_logical_and
(paren
id|amd7409_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;amd7409&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|amd7409_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AMD7409 */
macro_line|#ifdef CONFIG_BLK_DEV_CMD64X
r_if
c_cond
(paren
(paren
id|cmd64x_display_info
)paren
op_logical_and
(paren
id|cmd64x_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;cmd64x&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|cmd64x_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CMD64X */
macro_line|#ifdef CONFIG_BLK_DEV_CS5530
r_if
c_cond
(paren
(paren
id|cs5530_display_info
)paren
op_logical_and
(paren
id|cs5530_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;cs5530&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|cs5530_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CS5530 */
macro_line|#ifdef CONFIG_BLK_DEV_HPT34X
r_if
c_cond
(paren
(paren
id|hpt34x_display_info
)paren
op_logical_and
(paren
id|hpt34x_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;hpt34x&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|hpt34x_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT34X */
macro_line|#ifdef CONFIG_BLK_DEV_HPT366
r_if
c_cond
(paren
(paren
id|hpt366_display_info
)paren
op_logical_and
(paren
id|hpt366_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;hpt366&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|hpt366_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT366 */
macro_line|#ifdef CONFIG_BLK_DEV_OSB4
r_if
c_cond
(paren
(paren
id|osb4_display_info
)paren
op_logical_and
(paren
id|osb4_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;osb4&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|osb4_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_OSB4 */
macro_line|#ifdef CONFIG_BLK_DEV_PDC202XX
r_if
c_cond
(paren
(paren
id|pdc202xx_display_info
)paren
op_logical_and
(paren
id|pdc202xx_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;pdc202xx&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|pdc202xx_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PDC202XX */
macro_line|#ifdef CONFIG_BLK_DEV_PIIX
r_if
c_cond
(paren
(paren
id|piix_display_info
)paren
op_logical_and
(paren
id|piix_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;piix&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|piix_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PIIX */
macro_line|#ifdef CONFIG_BLK_DEV_SIS5513
r_if
c_cond
(paren
(paren
id|sis_display_info
)paren
op_logical_and
(paren
id|sis_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;sis&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|sis_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SIS5513 */
macro_line|#ifdef CONFIG_BLK_DEV_SLC90E66
r_if
c_cond
(paren
(paren
id|slc90e66_display_info
)paren
op_logical_and
(paren
id|slc90e66_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;slc90e66&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|slc90e66_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SLC90E66 */
macro_line|#ifdef CONFIG_BLK_DEV_VIA82CXXX
r_if
c_cond
(paren
(paren
id|via_display_info
)paren
op_logical_and
(paren
id|via_proc
)paren
)paren
id|create_proc_info_entry
c_func
(paren
l_string|&quot;via&quot;
comma
l_int|0
comma
id|proc_ide_root
comma
id|via_display_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_VIA82CXXX */
)brace
DECL|function|proc_ide_destroy
r_void
id|proc_ide_destroy
c_func
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; * Mmmm.. does this free up all resources,&n;&t; * or do we need to do a more proper cleanup here ??&n;&t; */
macro_line|#ifdef CONFIG_BLK_DEV_AEC62XX
r_if
c_cond
(paren
(paren
id|aec62xx_display_info
)paren
op_logical_and
(paren
id|aec62xx_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/aec62xx&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AEC62XX */
macro_line|#ifdef CONFIG_BLK_DEV_ALI15X3
r_if
c_cond
(paren
(paren
id|ali_display_info
)paren
op_logical_and
(paren
id|ali_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/ali&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_ALI15X3 */
macro_line|#ifdef CONFIG_BLK_DEV_AMD7409
r_if
c_cond
(paren
(paren
id|amd7409_display_info
)paren
op_logical_and
(paren
id|amd7409_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/amd7409&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_AMD7409 */
macro_line|#ifdef CONFIG_BLK_DEV_CMD64X
r_if
c_cond
(paren
(paren
id|cmd64x_display_info
)paren
op_logical_and
(paren
id|cmd64x_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/cmd64x&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CMD64X */
macro_line|#ifdef CONFIG_BLK_DEV_CS5530
r_if
c_cond
(paren
(paren
id|cs5530_display_info
)paren
op_logical_and
(paren
id|cs5530_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/cs5530&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_CS5530 */
macro_line|#ifdef CONFIG_BLK_DEV_HPT34X
r_if
c_cond
(paren
(paren
id|hpt34x_display_info
)paren
op_logical_and
(paren
id|hpt34x_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/hpt34x&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT34X */
macro_line|#ifdef CONFIG_BLK_DEV_HPT366
r_if
c_cond
(paren
(paren
id|hpt366_display_info
)paren
op_logical_and
(paren
id|hpt366_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/hpt366&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_HPT366 */
macro_line|#ifdef CONFIG_BLK_DEV_OSB4
r_if
c_cond
(paren
(paren
id|osb4_display_info
)paren
op_logical_and
(paren
id|osb4_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/osb4&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_OSB4 */
macro_line|#ifdef CONFIG_BLK_DEV_PDC202XX
r_if
c_cond
(paren
(paren
id|pdc202xx_display_info
)paren
op_logical_and
(paren
id|pdc202xx_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/pdc202xx&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PDC202XX */
macro_line|#ifdef CONFIG_BLK_DEV_PIIX
r_if
c_cond
(paren
(paren
id|piix_display_info
)paren
op_logical_and
(paren
id|piix_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/piix&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_PIIX */
macro_line|#ifdef CONFIG_BLK_DEV_SIS5513
r_if
c_cond
(paren
(paren
id|sis_display_info
)paren
op_logical_and
(paren
id|sis_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/sis&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SIS5513 */
macro_line|#ifdef CONFIG_BLK_DEV_SLC90E66
r_if
c_cond
(paren
(paren
id|slc90e66_display_info
)paren
op_logical_and
(paren
id|slc90e66_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/slc90e66&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_SLC90E66 */
macro_line|#ifdef CONFIG_BLK_DEV_VIA82CXXX
r_if
c_cond
(paren
(paren
id|via_display_info
)paren
op_logical_and
(paren
id|via_proc
)paren
)paren
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/via&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_VIA82CXXX */
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide/drivers&quot;
comma
l_int|0
)paren
suffix:semicolon
id|destroy_proc_ide_interfaces
c_func
(paren
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;ide&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
eof
