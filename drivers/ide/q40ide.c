multiline_comment|/*&n; *  linux/drivers/ide/q40ide.c -- Q40 I/O port IDE Driver&n; *&n; *     original file created 12 Jul 1997 by Geert Uytterhoeven&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive for&n; *  more details.&n; *&n; * RZ:&n; *  almost identical with pcide.c, maybe we can merge it later. &n; *  Differences:&n; *       max 2 HWIFS for now&n; *       translate portaddresses to q40 native addresses (not yet...) instead rely on in/out[bw]&n; *         address translation&n; *&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/hdreg.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
multiline_comment|/*&n;     *  Bases of the IDE interfaces&n;     */
DECL|macro|PCIDE_NUM_HWIFS
mdefine_line|#define PCIDE_NUM_HWIFS&t;2
DECL|macro|PCIDE_BASE1
mdefine_line|#define PCIDE_BASE1&t;0x1f0
DECL|macro|PCIDE_BASE2
mdefine_line|#define PCIDE_BASE2&t;0x170
DECL|macro|PCIDE_BASE3
mdefine_line|#define PCIDE_BASE3&t;0x1e8
DECL|macro|PCIDE_BASE4
mdefine_line|#define PCIDE_BASE4&t;0x168
DECL|macro|PCIDE_BASE5
mdefine_line|#define PCIDE_BASE5&t;0x1e0
DECL|macro|PCIDE_BASE6
mdefine_line|#define PCIDE_BASE6&t;0x160
DECL|variable|pcide_bases
r_static
r_const
id|q40ide_ioreg_t
id|pcide_bases
(braket
id|PCIDE_NUM_HWIFS
)braket
op_assign
(brace
id|PCIDE_BASE1
comma
id|PCIDE_BASE2
comma
multiline_comment|/* PCIDE_BASE3, PCIDE_BASE4  , PCIDE_BASE5,&n;    PCIDE_BASE6 */
)brace
suffix:semicolon
multiline_comment|/*&n;     *  Offsets from one of the above bases&n;     */
DECL|macro|HD_DATA
macro_line|#undef HD_DATA
DECL|macro|HD_DATA
mdefine_line|#define HD_DATA  0x1f0
DECL|macro|PCIDE_REG
mdefine_line|#define PCIDE_REG(x)&t;((q40ide_ioreg_t)(HD_##x-PCIDE_BASE1))
DECL|variable|pcide_offsets
r_static
r_const
r_int
id|pcide_offsets
(braket
id|IDE_NR_PORTS
)braket
op_assign
(brace
id|PCIDE_REG
c_func
(paren
id|DATA
)paren
comma
id|PCIDE_REG
c_func
(paren
id|ERROR
)paren
comma
id|PCIDE_REG
c_func
(paren
id|NSECTOR
)paren
comma
id|PCIDE_REG
c_func
(paren
id|SECTOR
)paren
comma
id|PCIDE_REG
c_func
(paren
id|LCYL
)paren
comma
id|PCIDE_REG
c_func
(paren
id|HCYL
)paren
comma
id|PCIDE_REG
c_func
(paren
id|CURRENT
)paren
comma
id|PCIDE_REG
c_func
(paren
id|STATUS
)paren
comma
id|PCIDE_REG
c_func
(paren
id|CMD
)paren
)brace
suffix:semicolon
DECL|function|q40ide_default_irq
r_int
id|q40ide_default_irq
c_func
(paren
id|q40ide_ioreg_t
id|base
)paren
(brace
r_switch
c_cond
(paren
id|base
)paren
(brace
r_case
l_int|0x1f0
suffix:colon
r_return
l_int|14
suffix:semicolon
r_case
l_int|0x170
suffix:colon
r_return
l_int|15
suffix:semicolon
r_case
l_int|0x1e8
suffix:colon
r_return
l_int|11
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|q40_ide_init_hwif_ports
r_void
id|q40_ide_init_hwif_ports
(paren
id|q40ide_ioreg_t
op_star
id|p
comma
id|q40ide_ioreg_t
id|base
comma
r_int
op_star
id|irq
)paren
(brace
id|q40ide_ioreg_t
id|port
op_assign
id|base
suffix:semicolon
r_int
id|i
op_assign
l_int|8
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
)paren
op_star
id|p
op_increment
op_assign
id|port
op_increment
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|base
op_plus
l_int|0x206
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_ne
l_int|NULL
)paren
op_star
id|irq
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;     *  Probe for PC IDE interfaces&n;     */
DECL|function|q40ide_probe_hwif
r_int
id|q40ide_probe_hwif
c_func
(paren
r_int
id|index
comma
id|ide_hwif_t
op_star
id|hwif
)paren
(brace
r_static
r_int
id|pcide_index
(braket
id|PCIDE_NUM_HWIFS
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MACH_IS_Q40
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PCIDE_NUM_HWIFS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pcide_index
(braket
id|i
)braket
)paren
(brace
multiline_comment|/*printk(&quot;ide%d: Q40 IDE interface&bslash;n&quot;, index);*/
id|pcide_index
(braket
id|i
)braket
op_assign
id|index
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pcide_index
(braket
id|i
)braket
op_eq
id|index
op_plus
l_int|1
)paren
(brace
id|ide_setup_ports
c_func
(paren
id|hwif
comma
(paren
id|ide_ioreg_t
)paren
id|pcide_bases
(braket
id|i
)braket
comma
id|pcide_offsets
comma
l_int|0
comma
multiline_comment|/*q40_ack_intr???*/
l_int|NULL
)paren
suffix:semicolon
id|hwif-&gt;irq
op_assign
id|ide_default_irq
c_func
(paren
(paren
id|ide_ioreg_t
)paren
id|pcide_bases
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/*q40_ide_irq[i];  */
multiline_comment|/* 14 */
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
