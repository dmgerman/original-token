multiline_comment|/*&n; * sgicons.c: Setting up and registering console I/O on the SGI.&n; *&n; * Copyright (C) 1996 David S. Miller (dm@engr.sgi.com)&n; * Copyright (C) 1997 Miguel de Icaza (miguel@nuclecu.unam.mx)&n; *&n; * This implement a virtual console interface.&n; *&n; * This should be replaced with Gert&squot;s all-singing all-dancing&n; * graphics console code in the future&n; *&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;gconsole.h&quot;
multiline_comment|/* To make psaux code cleaner */
DECL|variable|aux_device_present
r_int
id|aux_device_present
op_assign
l_int|0xaa
suffix:semicolon
multiline_comment|/* This is the system graphics console (the first adapter found) */
DECL|variable|gconsole
r_struct
id|console_ops
op_star
id|gconsole
op_assign
l_int|0
suffix:semicolon
DECL|variable|real_gconsole
r_struct
id|console_ops
op_star
id|real_gconsole
op_assign
l_int|0
suffix:semicolon
r_void
DECL|function|enable_gconsole
id|enable_gconsole
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|gconsole
)paren
id|gconsole
op_assign
id|real_gconsole
suffix:semicolon
)brace
r_void
DECL|function|disable_gconsole
id|disable_gconsole
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
(brace
id|real_gconsole
op_assign
id|gconsole
suffix:semicolon
id|gconsole
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_void
DECL|function|register_gconsole
id|register_gconsole
(paren
r_struct
id|console_ops
op_star
id|gc
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
r_return
suffix:semicolon
id|gconsole
op_assign
id|gc
suffix:semicolon
)brace
r_void
DECL|function|__set_origin
id|__set_origin
(paren
r_int
r_int
id|offset
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
(paren
op_star
id|gconsole-&gt;set_origin
)paren
(paren
id|offset
)paren
suffix:semicolon
)brace
r_void
DECL|function|hide_cursor
id|hide_cursor
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
(paren
op_star
id|gconsole-&gt;hide_cursor
)paren
(paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|set_cursor
id|set_cursor
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
(paren
op_star
id|gconsole-&gt;set_cursor
)paren
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_void
DECL|function|get_scrmem
id|get_scrmem
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
(paren
op_star
id|gconsole-&gt;get_scrmem
)paren
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_void
DECL|function|set_scrmem
id|set_scrmem
(paren
r_int
id|currcons
comma
r_int
id|offset
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
(paren
op_star
id|gconsole-&gt;set_scrmem
)paren
(paren
id|currcons
comma
id|offset
)paren
suffix:semicolon
)brace
r_int
DECL|function|set_get_cmap
id|set_get_cmap
(paren
r_int
r_char
op_star
id|arg
comma
r_int
id|set
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
r_return
(paren
op_star
id|gconsole-&gt;set_get_cmap
)paren
(paren
id|arg
comma
id|set
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|blitc
id|blitc
(paren
r_int
r_int
id|charattr
comma
r_int
r_int
id|addr
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
(paren
op_star
id|gconsole-&gt;blitc
)paren
(paren
id|charattr
comma
id|addr
)paren
suffix:semicolon
)brace
r_void
DECL|function|memsetw
id|memsetw
(paren
r_void
op_star
id|s
comma
r_int
r_int
id|c
comma
r_int
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
(paren
op_star
id|gconsole-&gt;memsetw
)paren
(paren
id|s
comma
id|c
comma
id|count
)paren
suffix:semicolon
)brace
r_void
DECL|function|memcpyw
id|memcpyw
(paren
r_int
r_int
op_star
id|to
comma
r_int
r_int
op_star
id|from
comma
r_int
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|gconsole
)paren
(paren
op_star
id|gconsole-&gt;memcpyw
)paren
(paren
id|to
comma
id|from
comma
id|count
)paren
suffix:semicolon
)brace
r_int
DECL|function|con_adjust_height
id|con_adjust_height
(paren
r_int
r_int
id|fontheight
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_int
DECL|function|set_get_font
id|set_get_font
(paren
r_char
op_star
id|arg
comma
r_int
id|set
comma
r_int
id|ch512
)paren
(brace
r_int
id|error
comma
id|i
comma
id|line
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|error
op_assign
id|verify_area
(paren
id|set
ques
c_cond
id|VERIFY_READ
suffix:colon
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
id|ch512
ques
c_cond
l_int|2
op_star
id|cmapsz
suffix:colon
id|cmapsz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
multiline_comment|/* download the current font */
r_if
c_cond
(paren
op_logical_neg
id|set
)paren
(brace
id|memset
(paren
id|arg
comma
l_int|0
comma
id|cmapsz
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|CHAR_HEIGHT
suffix:semicolon
id|line
op_increment
)paren
id|__put_user
(paren
id|vga_font
(braket
id|i
)braket
comma
id|arg
op_plus
(paren
id|i
op_star
l_int|32
op_plus
id|line
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set the font */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|CHAR_HEIGHT
suffix:semicolon
id|line
op_increment
)paren
(brace
id|__get_user
c_func
(paren
id|vga_font
(braket
id|i
op_star
id|CHAR_HEIGHT
op_plus
id|line
)braket
comma
id|arg
op_plus
(paren
id|i
op_star
l_int|32
op_plus
id|line
)paren
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * dummy routines for the VESA blanking code, which is VGA only,&n; * so we don&squot;t have to carry that stuff around for the Sparc...  */
DECL|function|vesa_blank
r_void
id|vesa_blank
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|vesa_unblank
r_void
id|vesa_unblank
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|set_vesa_blanking
r_void
id|set_vesa_blanking
c_func
(paren
r_const
r_int
r_int
id|arg
)paren
(brace
)brace
DECL|function|vesa_powerdown
r_void
id|vesa_powerdown
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|set_palette
r_void
id|set_palette
(paren
r_void
)paren
(brace
)brace
r_extern
r_int
r_int
id|video_mem_base
comma
id|video_screen_size
comma
id|video_mem_term
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
r_int
id|con_type_init
c_func
(paren
r_int
r_int
id|start_mem
comma
r_const
r_char
op_star
op_star
id|name
)paren
)paren
(brace
r_extern
r_int
id|serial_console
suffix:semicolon
r_if
c_cond
(paren
id|serial_console
)paren
op_star
id|name
op_assign
l_string|&quot;NONE&quot;
suffix:semicolon
r_else
(brace
id|gfx_init
(paren
id|name
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Video screen size is %08lx at %08lx&bslash;n&quot;
comma
id|video_screen_size
comma
id|start_mem
)paren
suffix:semicolon
id|video_mem_base
op_assign
id|start_mem
suffix:semicolon
id|start_mem
op_add_assign
(paren
id|video_screen_size
op_star
l_int|2
)paren
suffix:semicolon
id|video_mem_term
op_assign
id|start_mem
suffix:semicolon
)brace
r_return
id|start_mem
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|con_type_init_finish
c_func
(paren
r_void
)paren
)paren
(brace
)brace
eof
