multiline_comment|/*&n; * sound/sb_common.c&n; *&n; * Common routines for Sound Blaster compatible cards.&n; */
multiline_comment|/*&n; * Copyright (C) by Hannu Savolainen 1993-1996&n; *&n; * USS/Lite for Linux is distributed under the GNU GENERAL PUBLIC LICENSE (GPL)&n; * Version 2 (June 1991). See the &quot;COPYING&quot; file distributed with this software&n; * for more info.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &quot;sound_config.h&quot;
macro_line|#if defined(CONFIG_SBDSP)
macro_line|#ifndef CONFIG_AUDIO
macro_line|#error You will need to configure the sound driver with CONFIG_AUDIO option.
macro_line|#endif
macro_line|#include &quot;sb_mixer.h&quot;
macro_line|#include &quot;sb.h&quot;
DECL|variable|detected_devc
r_static
id|sb_devc
op_star
id|detected_devc
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* For communication from probe to init */
DECL|variable|last_devc
r_static
id|sb_devc
op_star
id|last_devc
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* For MPU401 initialization */
DECL|variable|irq2devc
r_static
id|sb_devc
op_star
id|irq2devc
(braket
l_int|16
)braket
op_assign
(brace
l_int|NULL
)brace
suffix:semicolon
DECL|variable|jazz_irq_bits
r_static
r_int
r_char
id|jazz_irq_bits
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|2
comma
l_int|3
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|4
comma
l_int|0
comma
l_int|2
comma
l_int|5
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|6
)brace
suffix:semicolon
DECL|variable|jazz_dma_bits
r_static
r_int
r_char
id|jazz_dma_bits
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|2
comma
l_int|0
comma
l_int|3
comma
l_int|0
comma
l_int|4
)brace
suffix:semicolon
multiline_comment|/*&n; * Jazz16 chipset specific control variables&n; */
DECL|variable|jazz16_base
r_static
r_int
id|jazz16_base
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Not detected */
DECL|variable|jazz16_bits
r_static
r_int
r_char
id|jazz16_bits
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* I/O relocation bits */
multiline_comment|/*&n; * Logitech SoundMan Wave specific initialization code&n; */
macro_line|#ifdef SMW_MIDI0001_INCLUDED
macro_line|#include &quot;smw-midi0001.h&quot;
macro_line|#else
DECL|variable|smw_ucode
r_int
r_char
op_star
id|smw_ucode
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|smw_ucodeLen
r_int
id|smw_ucodeLen
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_int
DECL|function|sb_dsp_command
id|sb_dsp_command
(paren
id|sb_devc
op_star
id|devc
comma
r_int
r_char
id|val
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|limit
suffix:semicolon
id|limit
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|10
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;   * The timeout is 0.1 seconds&n;&t;&t;&t;&t; */
multiline_comment|/*&n;   * Note! the i&lt;500000 is an emergency exit. The sb_dsp_command() is sometimes&n;   * called while interrupts are disabled. This means that the timer is&n;   * disabled also. However the timeout situation is a abnormal condition.&n;   * Normally the DSP should be ready to accept commands after just couple of&n;   * loops.&n;   */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|500000
op_logical_and
id|jiffies
OL
id|limit
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
(paren
id|DSP_STATUS
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
id|outb
(paren
id|val
comma
id|DSP_COMMAND
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
id|printk
(paren
l_string|&quot;Sound Blaster: DSP Command(%x) Timeout.&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|sb_dsp_get_byte
id|sb_dsp_get_byte
(paren
id|sb_devc
op_star
id|devc
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|inb
(paren
id|DSP_DATA_AVAIL
)paren
op_amp
l_int|0x80
)paren
(brace
r_return
id|inb
(paren
id|DSP_READ
)paren
suffix:semicolon
)brace
r_return
l_int|0xffff
suffix:semicolon
)brace
r_int
DECL|function|ess_write
id|ess_write
(paren
id|sb_devc
op_star
id|devc
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|data
)paren
(brace
multiline_comment|/* Write a byte to an extended mode register of ES1688 */
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
(paren
id|devc
comma
id|reg
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|sb_dsp_command
(paren
id|devc
comma
id|data
)paren
suffix:semicolon
)brace
r_int
DECL|function|ess_read
id|ess_read
(paren
id|sb_devc
op_star
id|devc
comma
r_int
r_char
id|reg
)paren
(brace
multiline_comment|/* Read a byte from an extended mode register of ES1688 */
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
(paren
id|devc
comma
l_int|0xc0
)paren
)paren
multiline_comment|/* Read register command */
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
(paren
id|devc
comma
id|reg
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
id|sb_dsp_get_byte
(paren
id|devc
)paren
suffix:semicolon
)brace
r_void
DECL|function|sbintr
id|sbintr
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|dummy
)paren
(brace
r_int
id|status
suffix:semicolon
r_int
r_char
id|src
op_assign
l_int|0xff
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|irq2devc
(braket
id|irq
)braket
suffix:semicolon
r_if
c_cond
(paren
id|devc
op_eq
l_int|NULL
op_logical_or
id|devc-&gt;irq
op_ne
id|irq
)paren
(brace
id|DEB
(paren
id|printk
(paren
l_string|&quot;sbintr: Bogus interrupt IRQ%d&bslash;n&quot;
comma
id|irq
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|devc-&gt;irq_ok
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_SB16
)paren
(brace
id|src
op_assign
id|sb_getmixer
(paren
id|devc
comma
id|IRQ_STAT
)paren
suffix:semicolon
multiline_comment|/* Interrupt source register */
macro_line|#if defined(CONFIG_MIDI) &amp;&amp; defined(CONFIG_UART401)
r_if
c_cond
(paren
id|src
op_amp
l_int|4
)paren
id|uart401intr
(paren
id|devc-&gt;irq
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* MPU401 interrupt */
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|src
op_amp
l_int|3
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* Not a DSP interrupt */
)brace
r_if
c_cond
(paren
id|devc-&gt;intr_active
)paren
r_switch
c_cond
(paren
id|devc-&gt;irq_mode
)paren
(brace
r_case
id|IMODE_OUTPUT
suffix:colon
id|DMAbuf_outputintr
(paren
id|devc-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMODE_INPUT
suffix:colon
id|DMAbuf_inputintr
(paren
id|devc-&gt;dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMODE_INIT
suffix:colon
r_break
suffix:semicolon
r_case
id|IMODE_MIDI
suffix:colon
macro_line|#ifdef CONFIG_MIDI
id|sb_midi_interrupt
(paren
id|devc
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
(paren
l_string|&quot;Sound Blaster: Unexpected interrupt&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Acknowledge interrupts &n; */
r_if
c_cond
(paren
id|src
op_amp
l_int|0x01
)paren
id|status
op_assign
id|inb
(paren
id|DSP_DATA_AVAIL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_SB16
op_logical_and
id|src
op_amp
l_int|0x02
)paren
id|status
op_assign
id|inb
(paren
id|DSP_DATA_AVL16
)paren
suffix:semicolon
)brace
r_int
DECL|function|sb_dsp_reset
id|sb_dsp_reset
(paren
id|sb_devc
op_star
id|devc
)paren
(brace
r_int
id|loopc
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_ESS
)paren
id|outb
(paren
l_int|3
comma
id|DSP_RESET
)paren
suffix:semicolon
multiline_comment|/* Reset FIFO too */
r_else
id|outb
(paren
l_int|1
comma
id|DSP_RESET
)paren
suffix:semicolon
id|tenmicrosec
(paren
id|devc-&gt;osp
)paren
suffix:semicolon
id|outb
(paren
l_int|0
comma
id|DSP_RESET
)paren
suffix:semicolon
id|tenmicrosec
(paren
id|devc-&gt;osp
)paren
suffix:semicolon
id|tenmicrosec
(paren
id|devc-&gt;osp
)paren
suffix:semicolon
id|tenmicrosec
(paren
id|devc-&gt;osp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|loopc
op_assign
l_int|0
suffix:semicolon
id|loopc
OL
l_int|1000
op_logical_and
op_logical_neg
(paren
id|inb
(paren
id|DSP_DATA_AVAIL
)paren
op_amp
l_int|0x80
)paren
suffix:semicolon
id|loopc
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inb
(paren
id|DSP_READ
)paren
op_ne
l_int|0xAA
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Sorry */
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_ESS
)paren
id|sb_dsp_command
(paren
id|devc
comma
l_int|0xc6
)paren
suffix:semicolon
multiline_comment|/* Enable extended mode */
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|dsp_get_vers
id|dsp_get_vers
(paren
id|sb_devc
op_star
id|devc
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|devc-&gt;major
op_assign
id|devc-&gt;minor
op_assign
l_int|0
suffix:semicolon
id|sb_dsp_command
(paren
id|devc
comma
l_int|0xe1
)paren
suffix:semicolon
multiline_comment|/* Get version */
r_for
c_loop
(paren
id|i
op_assign
l_int|100000
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|inb
(paren
id|DSP_DATA_AVAIL
)paren
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|devc-&gt;major
op_eq
l_int|0
)paren
id|devc-&gt;major
op_assign
id|inb
(paren
id|DSP_READ
)paren
suffix:semicolon
r_else
(brace
id|devc-&gt;minor
op_assign
id|inb
(paren
id|DSP_READ
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|sb16_set_dma_hw
id|sb16_set_dma_hw
(paren
id|sb_devc
op_star
id|devc
)paren
(brace
r_int
id|bits
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dma8
op_ne
l_int|0
op_logical_and
id|devc-&gt;dma8
op_ne
l_int|1
op_logical_and
id|devc-&gt;dma8
op_ne
l_int|3
)paren
(brace
id|printk
(paren
l_string|&quot;SB16: Invalid 8 bit DMA (%d)&bslash;n&quot;
comma
id|devc-&gt;dma8
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|bits
op_assign
(paren
l_int|1
op_lshift
id|devc-&gt;dma8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ge
l_int|5
op_logical_and
id|devc-&gt;dma16
op_le
l_int|7
)paren
id|bits
op_or_assign
(paren
l_int|1
op_lshift
id|devc-&gt;dma16
)paren
suffix:semicolon
id|sb_setmixer
(paren
id|devc
comma
id|DMA_NR
comma
id|bits
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|sb16_set_mpu_port
id|sb16_set_mpu_port
c_func
(paren
id|sb_devc
op_star
id|devc
comma
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
multiline_comment|/*&n; * This routine initializes new MIDI port setup register of SB Vibra.&n; */
r_int
r_char
id|bits
op_assign
id|sb_getmixer
c_func
(paren
id|devc
comma
l_int|0x84
)paren
op_amp
op_complement
l_int|0x06
suffix:semicolon
r_switch
c_cond
(paren
id|hw_config-&gt;io_base
)paren
(brace
r_case
l_int|0x300
suffix:colon
id|sb_setmixer
(paren
id|devc
comma
l_int|0x84
comma
id|bits
op_or
l_int|0x04
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x330
suffix:colon
id|sb_setmixer
(paren
id|devc
comma
l_int|0x84
comma
id|bits
op_or
l_int|0x00
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sb_setmixer
(paren
id|devc
comma
l_int|0x84
comma
id|bits
op_or
l_int|0x02
)paren
suffix:semicolon
multiline_comment|/* Disable MPU */
id|printk
c_func
(paren
l_string|&quot;SB16: Invalid MIDI I/O port %x&bslash;n&quot;
comma
id|hw_config-&gt;io_base
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|sb16_set_irq_hw
id|sb16_set_irq_hw
(paren
id|sb_devc
op_star
id|devc
comma
r_int
id|level
)paren
(brace
r_int
id|ival
suffix:semicolon
r_switch
c_cond
(paren
id|level
)paren
(brace
r_case
l_int|5
suffix:colon
id|ival
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|ival
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|ival
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|ival
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
(paren
l_string|&quot;SB16 IRQ%d is not possible&bslash;n&quot;
comma
id|level
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|sb_setmixer
(paren
id|devc
comma
id|IRQ_NR
comma
id|ival
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|relocate_Jazz16
id|relocate_Jazz16
(paren
id|sb_devc
op_star
id|devc
comma
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_int
r_char
id|bits
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|jazz16_base
op_ne
l_int|0
op_logical_and
id|jazz16_base
op_ne
id|hw_config-&gt;io_base
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|hw_config-&gt;io_base
)paren
(brace
r_case
l_int|0x220
suffix:colon
id|bits
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x240
suffix:colon
id|bits
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x260
suffix:colon
id|bits
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
id|bits
op_assign
id|jazz16_bits
op_assign
id|bits
op_lshift
l_int|5
suffix:semicolon
id|jazz16_base
op_assign
id|hw_config-&gt;io_base
suffix:semicolon
multiline_comment|/*&n; * Magic wake up sequence by writing to 0x201 (aka Joystick port)&n; */
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|outb
(paren
l_int|0xAF
comma
l_int|0x201
)paren
suffix:semicolon
id|outb
(paren
l_int|0x50
comma
l_int|0x201
)paren
suffix:semicolon
id|outb
(paren
id|bits
comma
l_int|0x201
)paren
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|init_Jazz16
id|init_Jazz16
(paren
id|sb_devc
op_star
id|devc
comma
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_char
id|name
(braket
l_int|100
)braket
suffix:semicolon
multiline_comment|/*&n; * First try to check that the card has Jazz16 chip. It identifies itself&n; * by returning 0x12 as response to DSP command 0xfa.&n; */
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
(paren
id|devc
comma
l_int|0xfa
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_get_byte
(paren
id|devc
)paren
op_ne
l_int|0x12
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n; * OK so far. Now configure the IRQ and DMA channel used by the card.&n; */
r_if
c_cond
(paren
id|hw_config-&gt;irq
template_param
l_int|15
op_logical_or
id|jazz_irq_bits
(braket
id|hw_config-&gt;irq
)braket
op_eq
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;Jazz16: Invalid interrupt (IRQ%d)&bslash;n&quot;
comma
id|hw_config-&gt;irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw_config-&gt;dma
template_param
l_int|3
op_logical_or
id|jazz_dma_bits
(braket
id|hw_config-&gt;dma
)braket
op_eq
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;Jazz16: Invalid 8 bit DMA (DMA%d)&bslash;n&quot;
comma
id|hw_config-&gt;dma
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw_config-&gt;dma2
OL
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;Jazz16: No 16 bit DMA channel defined&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw_config-&gt;dma2
template_param
l_int|7
op_logical_or
id|jazz_dma_bits
(braket
id|hw_config-&gt;dma2
)braket
op_eq
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;Jazz16: Invalid 16 bit DMA (DMA%d)&bslash;n&quot;
comma
id|hw_config-&gt;dma2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|devc-&gt;dma16
op_assign
id|hw_config-&gt;dma2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
(paren
id|devc
comma
l_int|0xfb
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
(paren
id|devc
comma
id|jazz_dma_bits
(braket
id|hw_config-&gt;dma
)braket
op_or
(paren
id|jazz_dma_bits
(braket
id|hw_config-&gt;dma2
)braket
op_lshift
l_int|4
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
(paren
id|devc
comma
id|jazz_irq_bits
(braket
id|hw_config-&gt;irq
)braket
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n; * Now we have configured a standard Jazz16 device. &n; */
id|devc-&gt;model
op_assign
id|MDL_JAZZ
suffix:semicolon
id|strcpy
(paren
id|name
comma
l_string|&quot;Jazz16&quot;
)paren
suffix:semicolon
id|hw_config-&gt;name
op_assign
(paren
r_char
op_star
)paren
(paren
id|sound_mem_blocks
(braket
id|sound_nblocks
)braket
op_assign
id|vmalloc
(paren
id|strlen
(paren
id|name
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound_nblocks
OL
l_int|1024
)paren
id|sound_nblocks
op_increment
suffix:semicolon
suffix:semicolon
r_if
c_cond
(paren
id|hw_config-&gt;name
op_ne
l_int|NULL
)paren
id|strcpy
(paren
id|hw_config-&gt;name
comma
id|name
)paren
suffix:semicolon
id|devc-&gt;caps
op_or_assign
id|SB_NO_MIDI
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|ess_init
id|ess_init
(paren
id|sb_devc
op_star
id|devc
comma
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_int
r_char
id|cfg
comma
id|irq_bits
op_assign
l_int|0
comma
id|dma_bits
op_assign
l_int|0
suffix:semicolon
r_int
id|ess_major
op_assign
l_int|0
comma
id|ess_minor
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
id|name
(braket
l_int|100
)braket
suffix:semicolon
multiline_comment|/*&n; * Try to detect ESS chips.&n; */
id|sb_dsp_command
(paren
id|devc
comma
l_int|0xe7
)paren
suffix:semicolon
multiline_comment|/* Return identification */
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|inb
(paren
id|DSP_DATA_AVAIL
)paren
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|ess_major
op_eq
l_int|0
)paren
id|ess_major
op_assign
id|inb
(paren
id|DSP_READ
)paren
suffix:semicolon
r_else
(brace
id|ess_minor
op_assign
id|inb
(paren
id|DSP_READ
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|ess_major
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ess_major
op_eq
l_int|0x48
op_logical_and
(paren
id|ess_minor
op_amp
l_int|0xf0
)paren
op_eq
l_int|0x80
)paren
(brace
id|sprintf
(paren
id|name
comma
l_string|&quot;ESS ES488 AudioDrive (rev %d)&quot;
comma
id|ess_minor
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|hw_config-&gt;name
op_assign
id|name
suffix:semicolon
id|devc-&gt;model
op_assign
id|MDL_SBPRO
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ess_major
op_eq
l_int|0x68
op_logical_and
(paren
id|ess_minor
op_amp
l_int|0xf0
)paren
op_eq
l_int|0x80
)paren
(brace
id|sprintf
(paren
id|name
comma
l_string|&quot;ESS ES1688 AudioDrive (rev %d)&quot;
comma
id|ess_minor
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
r_else
id|strcpy
(paren
id|name
comma
l_string|&quot;Jazz16&quot;
)paren
suffix:semicolon
id|devc-&gt;model
op_assign
id|MDL_ESS
suffix:semicolon
id|devc-&gt;submodel
op_assign
id|ess_minor
op_amp
l_int|0x0f
suffix:semicolon
id|hw_config-&gt;name
op_assign
(paren
r_char
op_star
)paren
(paren
id|sound_mem_blocks
(braket
id|sound_nblocks
)braket
op_assign
id|vmalloc
(paren
id|strlen
(paren
id|name
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound_nblocks
OL
l_int|1024
)paren
id|sound_nblocks
op_increment
suffix:semicolon
suffix:semicolon
r_if
c_cond
(paren
id|hw_config-&gt;name
op_ne
l_int|NULL
)paren
id|strcpy
(paren
id|hw_config-&gt;name
comma
id|name
)paren
suffix:semicolon
id|sb_dsp_reset
(paren
id|devc
)paren
suffix:semicolon
multiline_comment|/* Turn on extended mode */
multiline_comment|/*&n; *    Set IRQ configuration register&n; */
id|cfg
op_assign
l_int|0x50
suffix:semicolon
multiline_comment|/* Enable only DMA counter interrupt */
r_switch
c_cond
(paren
id|devc-&gt;irq
)paren
(brace
r_case
l_int|2
suffix:colon
r_case
l_int|9
suffix:colon
id|irq_bits
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|irq_bits
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|irq_bits
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|irq_bits
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|irq_bits
op_assign
l_int|0
suffix:semicolon
id|cfg
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* Disable all interrupts */
id|printk
(paren
l_string|&quot;&bslash;nESS1688: Invalid IRQ %d&bslash;n&quot;
comma
id|devc-&gt;irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ess_write
(paren
id|devc
comma
l_int|0xb1
comma
id|cfg
op_or
(paren
id|irq_bits
op_lshift
l_int|2
)paren
)paren
)paren
id|printk
(paren
l_string|&quot;&bslash;nESS1688: Failed to write to IRQ config register&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; *    Set DMA configuration register&n; */
id|cfg
op_assign
l_int|0x50
suffix:semicolon
multiline_comment|/* Extended mode DMA enable */
r_if
c_cond
(paren
id|devc-&gt;dma8
OG
l_int|3
op_logical_or
id|devc-&gt;dma8
OL
l_int|0
op_logical_or
id|devc-&gt;dma8
op_eq
l_int|2
)paren
(brace
id|dma_bits
op_assign
l_int|0
suffix:semicolon
id|cfg
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* Disable all DMA */
id|printk
(paren
l_string|&quot;&bslash;nESS1688: Invalid DMA %d&bslash;n&quot;
comma
id|devc-&gt;dma8
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|devc-&gt;dma8
op_eq
l_int|3
)paren
id|dma_bits
op_assign
l_int|3
suffix:semicolon
r_else
id|dma_bits
op_assign
id|devc-&gt;dma8
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ess_write
(paren
id|devc
comma
l_int|0xb2
comma
id|cfg
op_or
(paren
id|dma_bits
op_lshift
l_int|2
)paren
)paren
)paren
id|printk
(paren
l_string|&quot;&bslash;nESS1688: Failed to write to DMA config register&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; * Enable joystick and OPL3&n; */
id|cfg
op_assign
id|sb_getmixer
(paren
id|devc
comma
l_int|0x40
)paren
suffix:semicolon
id|sb_setmixer
(paren
id|devc
comma
l_int|0x40
comma
id|cfg
op_or
l_int|0x03
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;submodel
op_ge
l_int|8
)paren
multiline_comment|/* ES1688 */
id|devc-&gt;caps
op_or_assign
id|SB_NO_MIDI
suffix:semicolon
multiline_comment|/* ES1688 uses MPU401 MIDI mode */
id|sb_dsp_reset
(paren
id|devc
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|sb_dsp_detect
id|sb_dsp_detect
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|sb_devc
id|sb_info
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
op_amp
id|sb_info
suffix:semicolon
multiline_comment|/*&n; * Initialize variables &n; */
id|DDB
(paren
id|printk
(paren
l_string|&quot;sb_dsp_detect(%x) entered&bslash;n&quot;
comma
id|hw_config-&gt;io_base
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|check_region
(paren
id|hw_config-&gt;io_base
comma
l_int|16
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|memset
(paren
(paren
r_char
op_star
)paren
op_amp
id|sb_info
comma
l_int|0
comma
r_sizeof
(paren
id|sb_info
)paren
)paren
suffix:semicolon
multiline_comment|/* Zero everything */
id|devc-&gt;osp
op_assign
id|hw_config-&gt;osp
suffix:semicolon
id|devc-&gt;type
op_assign
id|hw_config-&gt;card_subtype
suffix:semicolon
id|devc-&gt;base
op_assign
id|hw_config-&gt;io_base
suffix:semicolon
id|devc-&gt;irq
op_assign
id|hw_config-&gt;irq
suffix:semicolon
id|devc-&gt;dma8
op_assign
id|hw_config-&gt;dma
suffix:semicolon
id|devc-&gt;dma16
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n; * Detect the device&n; */
r_if
c_cond
(paren
id|sb_dsp_reset
(paren
id|devc
)paren
)paren
id|dsp_get_vers
(paren
id|devc
)paren
suffix:semicolon
r_else
id|devc-&gt;major
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;type
op_eq
l_int|0
op_logical_or
id|devc-&gt;type
op_eq
id|MDL_JAZZ
op_logical_or
id|devc-&gt;type
op_eq
id|MDL_SMW
)paren
r_if
c_cond
(paren
id|devc-&gt;major
op_eq
l_int|0
op_logical_or
(paren
id|devc-&gt;major
op_eq
l_int|3
op_logical_and
id|devc-&gt;minor
op_eq
l_int|1
)paren
)paren
id|relocate_Jazz16
(paren
id|devc
comma
id|hw_config
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_reset
(paren
id|devc
)paren
)paren
(brace
id|DDB
(paren
id|printk
(paren
l_string|&quot;SB reset failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devc-&gt;major
op_eq
l_int|0
)paren
id|dsp_get_vers
(paren
id|devc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;major
op_eq
l_int|3
op_logical_and
id|devc-&gt;minor
op_eq
l_int|1
)paren
r_if
c_cond
(paren
id|devc-&gt;type
op_eq
id|MDL_AZTECH
)paren
multiline_comment|/* SG Washington? */
(brace
r_if
c_cond
(paren
id|sb_dsp_command
(paren
id|devc
comma
l_int|0x09
)paren
)paren
r_if
c_cond
(paren
id|sb_dsp_command
(paren
id|devc
comma
l_int|0x00
)paren
)paren
multiline_comment|/* Enter WSS mode */
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Have some delay */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
id|inb
(paren
id|DSP_DATA_AVAIL
)paren
suffix:semicolon
id|devc-&gt;caps
op_assign
id|SB_NO_AUDIO
op_or
id|SB_NO_MIDI
suffix:semicolon
multiline_comment|/* Mixer only */
)brace
)brace
multiline_comment|/*&n; * Save device information for sb_dsp_init()&n; */
id|detected_devc
op_assign
(paren
id|sb_devc
op_star
)paren
(paren
id|sound_mem_blocks
(braket
id|sound_nblocks
)braket
op_assign
id|vmalloc
(paren
r_sizeof
(paren
id|sb_devc
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound_nblocks
OL
l_int|1024
)paren
id|sound_nblocks
op_increment
suffix:semicolon
suffix:semicolon
r_if
c_cond
(paren
id|detected_devc
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
l_string|&quot;sb: Can&squot;t allocate memory for device information&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memcpy
(paren
(paren
r_char
op_star
)paren
id|detected_devc
comma
(paren
r_char
op_star
)paren
id|devc
comma
r_sizeof
(paren
id|sb_devc
)paren
)paren
suffix:semicolon
id|DDB
(paren
id|printk
(paren
l_string|&quot;SB %d.%d detected OK (%x)&bslash;n&quot;
comma
id|devc-&gt;major
comma
id|devc-&gt;minor
comma
id|hw_config-&gt;io_base
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_void
DECL|function|sb_dsp_init
id|sb_dsp_init
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|sb_devc
op_star
id|devc
suffix:semicolon
r_char
id|name
(braket
l_int|100
)braket
suffix:semicolon
macro_line|#ifndef NO_SB_IRQ_TEST
r_int
id|n
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * Check if we had detected a SB device earlier&n; */
id|DDB
(paren
id|printk
(paren
l_string|&quot;sb_dsp_init(%x) entered&bslash;n&quot;
comma
id|hw_config-&gt;io_base
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|detected_devc
op_eq
l_int|NULL
)paren
(brace
id|DDB
(paren
id|printk
(paren
l_string|&quot;No detected device&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|devc
op_assign
id|detected_devc
suffix:semicolon
id|detected_devc
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;base
op_ne
id|hw_config-&gt;io_base
)paren
(brace
id|DDB
(paren
id|printk
(paren
l_string|&quot;I/O port mismatch&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Now continue initialization of the device&n; */
id|devc-&gt;dev
op_assign
id|num_audiodevs
suffix:semicolon
id|devc-&gt;caps
op_assign
id|hw_config-&gt;driver_use_1
suffix:semicolon
id|irq2devc
(braket
id|hw_config-&gt;irq
)braket
op_assign
id|devc
suffix:semicolon
id|devc-&gt;irq_ok
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|snd_set_irq_handler
(paren
id|hw_config-&gt;irq
comma
id|sbintr
comma
l_string|&quot;sound blaster&quot;
comma
id|devc-&gt;osp
)paren
OL
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;SB: Can&squot;t allocate IRQ%d&bslash;n&quot;
comma
id|hw_config-&gt;irq
)paren
suffix:semicolon
id|irq2devc
(braket
id|hw_config-&gt;irq
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devc-&gt;major
op_eq
l_int|4
)paren
r_if
c_cond
(paren
op_logical_neg
id|sb16_set_irq_hw
(paren
id|devc
comma
id|devc-&gt;irq
)paren
)paren
multiline_comment|/* Unsupported IRQ */
(brace
id|snd_release_irq
(paren
id|devc-&gt;irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|devc-&gt;type
op_eq
l_int|0
op_logical_or
id|devc-&gt;type
op_eq
id|MDL_ESS
)paren
op_logical_and
id|devc-&gt;major
op_eq
l_int|3
op_logical_and
id|devc-&gt;minor
op_eq
l_int|1
)paren
(brace
multiline_comment|/* Handle various chipsets which claim they are SB Pro compatible */
r_if
c_cond
(paren
(paren
id|devc-&gt;type
op_ne
l_int|0
op_logical_and
id|devc-&gt;type
op_ne
id|MDL_ESS
)paren
op_logical_or
op_logical_neg
id|ess_init
(paren
id|devc
comma
id|hw_config
)paren
)paren
r_if
c_cond
(paren
(paren
id|devc-&gt;type
op_ne
l_int|0
op_logical_and
id|devc-&gt;type
op_ne
id|MDL_JAZZ
op_logical_and
id|devc-&gt;type
op_ne
id|MDL_SMW
)paren
op_logical_or
op_logical_neg
id|init_Jazz16
(paren
id|devc
comma
id|hw_config
)paren
)paren
(brace
id|DDB
(paren
id|printk
(paren
l_string|&quot;This is a genuine SB Pro&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifndef NO_SB_IRQ_TEST
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
l_int|3
op_logical_and
id|devc-&gt;irq_ok
op_eq
l_int|0
suffix:semicolon
id|n
op_increment
)paren
r_if
c_cond
(paren
id|sb_dsp_command
(paren
id|devc
comma
l_int|0xf2
)paren
)paren
multiline_comment|/* Cause interrupt immediately */
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|devc-&gt;irq_ok
op_logical_and
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|devc-&gt;irq_ok
)paren
(brace
id|printk
(paren
l_string|&quot;sb: Interrupt test on IRQ%d failed - device disabled&bslash;n&quot;
comma
id|devc-&gt;irq
)paren
suffix:semicolon
id|snd_release_irq
(paren
id|devc-&gt;irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|DDB
(paren
id|printk
(paren
l_string|&quot;IRQ test OK (IRQ%d)&bslash;n&quot;
comma
id|devc-&gt;irq
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|request_region
(paren
id|hw_config-&gt;io_base
comma
l_int|16
comma
l_string|&quot;sound blaster&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|devc-&gt;major
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* SB 1.0 or 1.5 */
id|devc-&gt;model
op_assign
id|hw_config-&gt;card_subtype
op_assign
id|MDL_SB1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* SB 2.x */
r_if
c_cond
(paren
id|devc-&gt;minor
op_eq
l_int|0
)paren
id|devc-&gt;model
op_assign
id|hw_config-&gt;card_subtype
op_assign
id|MDL_SB2
suffix:semicolon
r_else
id|devc-&gt;model
op_assign
id|hw_config-&gt;card_subtype
op_assign
id|MDL_SB201
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* SB Pro and most clones */
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
l_int|0
)paren
(brace
id|devc-&gt;model
op_assign
id|hw_config-&gt;card_subtype
op_assign
id|MDL_SBPRO
suffix:semicolon
r_if
c_cond
(paren
id|hw_config-&gt;name
op_eq
l_int|NULL
)paren
id|hw_config-&gt;name
op_assign
l_string|&quot;Sound Blaster Pro&quot;
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|devc-&gt;model
op_assign
id|hw_config-&gt;card_subtype
op_assign
id|MDL_SB16
suffix:semicolon
r_if
c_cond
(paren
id|hw_config-&gt;name
op_eq
l_int|NULL
)paren
id|hw_config-&gt;name
op_assign
l_string|&quot;Sound Blaster 16&quot;
suffix:semicolon
r_if
c_cond
(paren
id|hw_config-&gt;dma2
op_eq
op_minus
l_int|1
)paren
id|devc-&gt;dma16
op_assign
id|devc-&gt;dma8
suffix:semicolon
r_else
r_if
c_cond
(paren
id|hw_config-&gt;dma2
template_param
l_int|7
)paren
(brace
id|printk
(paren
l_string|&quot;SB16: Bad or missing 16 bit DMA channel&bslash;n&quot;
)paren
suffix:semicolon
id|devc-&gt;dma16
op_assign
id|devc-&gt;dma8
suffix:semicolon
)brace
r_else
id|devc-&gt;dma16
op_assign
id|hw_config-&gt;dma2
suffix:semicolon
id|sb16_set_dma_hw
(paren
id|devc
)paren
suffix:semicolon
id|devc-&gt;caps
op_or_assign
id|SB_NO_MIDI
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|devc-&gt;caps
op_amp
id|SB_NO_MIXER
)paren
)paren
r_if
c_cond
(paren
id|devc-&gt;major
op_eq
l_int|3
op_logical_or
id|devc-&gt;major
op_eq
l_int|4
)paren
id|sb_mixer_init
(paren
id|devc
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MIDI
r_if
c_cond
(paren
op_logical_neg
(paren
id|devc-&gt;caps
op_amp
id|SB_NO_MIDI
)paren
)paren
id|sb_dsp_midi_init
(paren
id|devc
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|hw_config-&gt;name
op_eq
l_int|NULL
)paren
id|hw_config-&gt;name
op_assign
l_string|&quot;Sound Blaster&quot;
suffix:semicolon
id|sprintf
(paren
id|name
comma
l_string|&quot;%s (%d.%d)&quot;
comma
id|hw_config-&gt;name
comma
id|devc-&gt;major
comma
id|devc-&gt;minor
)paren
suffix:semicolon
id|conf_printf
(paren
id|name
comma
id|hw_config
)paren
suffix:semicolon
id|hw_config-&gt;card_subtype
op_assign
id|devc-&gt;model
suffix:semicolon
id|last_devc
op_assign
id|devc
suffix:semicolon
multiline_comment|/* For SB MPU detection */
r_if
c_cond
(paren
op_logical_neg
(paren
id|devc-&gt;caps
op_amp
id|SB_NO_AUDIO
)paren
)paren
(brace
r_if
c_cond
(paren
id|sound_alloc_dma
(paren
id|devc-&gt;dma8
comma
l_string|&quot;Sound Blaster8&quot;
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;SB: Can&squot;t allocate 8 bit DMA channel %d&bslash;n&quot;
comma
id|devc-&gt;dma8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ge
l_int|0
op_logical_and
id|devc-&gt;dma16
op_ne
id|devc-&gt;dma8
)paren
r_if
c_cond
(paren
id|sound_alloc_dma
(paren
id|devc-&gt;dma16
comma
l_string|&quot;Sound Blaster16&quot;
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;SB: Can&squot;t allocate 16 bit DMA channel %d&bslash;n&quot;
comma
id|devc-&gt;dma16
)paren
suffix:semicolon
)brace
id|sb_audio_init
(paren
id|devc
comma
id|name
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|sb_dsp_disable_midi
id|sb_dsp_disable_midi
(paren
r_int
id|io_base
)paren
(brace
)brace
r_void
DECL|function|sb_dsp_disable_recording
id|sb_dsp_disable_recording
(paren
r_int
id|io_base
)paren
(brace
)brace
r_void
DECL|function|sb_dsp_unload
id|sb_dsp_unload
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|sb_devc
op_star
id|devc
suffix:semicolon
r_int
id|irq
op_assign
id|hw_config-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|irq
OL
l_int|0
)paren
id|irq
op_mul_assign
op_minus
l_int|1
suffix:semicolon
id|devc
op_assign
id|irq2devc
(braket
id|irq
)braket
suffix:semicolon
r_if
c_cond
(paren
id|devc
op_logical_and
id|devc-&gt;base
op_eq
id|hw_config-&gt;io_base
)paren
(brace
id|release_region
(paren
id|devc-&gt;base
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|devc-&gt;caps
op_amp
id|SB_NO_AUDIO
)paren
)paren
(brace
id|sound_free_dma
(paren
id|devc-&gt;dma8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ge
l_int|0
)paren
id|sound_free_dma
(paren
id|devc-&gt;dma16
)paren
suffix:semicolon
)brace
id|snd_release_irq
(paren
id|devc-&gt;irq
)paren
suffix:semicolon
id|irq2devc
(braket
id|devc-&gt;irq
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Mixer access routines&n; */
r_void
DECL|function|sb_setmixer
id|sb_setmixer
(paren
id|sb_devc
op_star
id|devc
comma
r_int
r_int
id|port
comma
r_int
r_int
id|value
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|outb
(paren
(paren
r_int
r_char
)paren
(paren
id|port
op_amp
l_int|0xff
)paren
comma
id|MIXER_ADDR
)paren
suffix:semicolon
id|tenmicrosec
(paren
id|devc-&gt;osp
)paren
suffix:semicolon
id|outb
(paren
(paren
r_int
r_char
)paren
(paren
id|value
op_amp
l_int|0xff
)paren
comma
id|MIXER_DATA
)paren
suffix:semicolon
id|tenmicrosec
(paren
id|devc-&gt;osp
)paren
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
)brace
r_int
r_int
DECL|function|sb_getmixer
id|sb_getmixer
(paren
id|sb_devc
op_star
id|devc
comma
r_int
r_int
id|port
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|outb
(paren
(paren
r_int
r_char
)paren
(paren
id|port
op_amp
l_int|0xff
)paren
comma
id|MIXER_ADDR
)paren
suffix:semicolon
id|tenmicrosec
(paren
id|devc-&gt;osp
)paren
suffix:semicolon
id|val
op_assign
id|inb
(paren
id|MIXER_DATA
)paren
suffix:semicolon
id|tenmicrosec
(paren
id|devc-&gt;osp
)paren
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_MIDI
multiline_comment|/*&n; * MPU401 MIDI initialization.&n; */
r_static
r_void
DECL|function|smw_putmem
id|smw_putmem
(paren
id|sb_devc
op_star
id|devc
comma
r_int
id|base
comma
r_int
id|addr
comma
r_int
r_char
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|outb
(paren
id|addr
op_amp
l_int|0xff
comma
id|base
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Low address bits */
id|outb
(paren
id|addr
op_rshift
l_int|8
comma
id|base
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* High address bits */
id|outb
(paren
id|val
comma
id|base
)paren
suffix:semicolon
multiline_comment|/* Data */
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
r_char
DECL|function|smw_getmem
id|smw_getmem
(paren
id|sb_devc
op_star
id|devc
comma
r_int
id|base
comma
r_int
id|addr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|outb
(paren
id|addr
op_amp
l_int|0xff
comma
id|base
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Low address bits */
id|outb
(paren
id|addr
op_rshift
l_int|8
comma
id|base
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* High address bits */
id|val
op_assign
id|inb
(paren
id|base
)paren
suffix:semicolon
multiline_comment|/* Data */
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
r_static
r_int
DECL|function|smw_midi_init
id|smw_midi_init
(paren
id|sb_devc
op_star
id|devc
comma
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_int
id|mpu_base
op_assign
id|hw_config-&gt;io_base
suffix:semicolon
r_int
id|mp_base
op_assign
id|mpu_base
op_plus
l_int|4
suffix:semicolon
multiline_comment|/* Microcontroller base */
r_int
id|i
suffix:semicolon
r_int
r_char
id|control
suffix:semicolon
multiline_comment|/*&n;     *  Reset the microcontroller so that the RAM can be accessed&n;   */
id|control
op_assign
id|inb
(paren
id|mpu_base
op_plus
l_int|7
)paren
suffix:semicolon
id|outb
(paren
id|control
op_or
l_int|3
comma
id|mpu_base
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* Set last two bits to 1 (?) */
id|outb
(paren
(paren
id|control
op_amp
l_int|0xfe
)paren
op_or
l_int|2
comma
id|mpu_base
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* xxxxxxx0 resets the mc */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|300
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* Wait at least 1ms */
id|tenmicrosec
(paren
id|devc-&gt;osp
)paren
suffix:semicolon
id|outb
(paren
id|control
op_amp
l_int|0xfc
comma
id|mpu_base
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* xxxxxx00 enables RAM */
multiline_comment|/*&n;     *  Detect microcontroller by probing the 8k RAM area&n;   */
id|smw_putmem
(paren
id|devc
comma
id|mp_base
comma
l_int|0
comma
l_int|0x00
)paren
suffix:semicolon
id|smw_putmem
(paren
id|devc
comma
id|mp_base
comma
l_int|1
comma
l_int|0xff
)paren
suffix:semicolon
id|tenmicrosec
(paren
id|devc-&gt;osp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smw_getmem
(paren
id|devc
comma
id|mp_base
comma
l_int|0
)paren
op_ne
l_int|0x00
op_logical_or
id|smw_getmem
(paren
id|devc
comma
id|mp_base
comma
l_int|1
)paren
op_ne
l_int|0xff
)paren
(brace
id|DDB
(paren
id|printk
(paren
l_string|&quot;&bslash;nSM Wave: No microcontroller RAM detected (%02x, %02x)&bslash;n&quot;
comma
id|smw_getmem
(paren
id|devc
comma
id|mp_base
comma
l_int|0
)paren
comma
id|smw_getmem
(paren
id|devc
comma
id|mp_base
comma
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* No RAM */
)brace
multiline_comment|/*&n;     *  There is RAM so assume it&squot;s really a SM Wave&n;   */
id|devc-&gt;model
op_assign
id|MDL_SMW
suffix:semicolon
id|smw_mixer_init
(paren
id|devc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smw_ucodeLen
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|smw_ucodeLen
op_ne
l_int|8192
)paren
(brace
id|printk
(paren
l_string|&quot;&bslash;nSM Wave: Invalid microcode (MIDI0001.BIN) length&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;       *  Download microcode&n;       */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8192
suffix:semicolon
id|i
op_increment
)paren
id|smw_putmem
(paren
id|devc
comma
id|mp_base
comma
id|i
comma
id|smw_ucode
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/*&n;       *  Verify microcode&n;       */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8192
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|smw_getmem
(paren
id|devc
comma
id|mp_base
comma
id|i
)paren
op_ne
id|smw_ucode
(braket
id|i
)braket
)paren
(brace
id|printk
(paren
l_string|&quot;SM Wave: Microcode verification failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|control
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef SMW_SCSI_IRQ
multiline_comment|/*&n;     * Set the SCSI interrupt (IRQ2/9, IRQ3 or IRQ10). The SCSI interrupt&n;     * is disabled by default.&n;     *&n;     * BTW the Zilog 5380 SCSI controller is located at MPU base + 0x10.&n;   */
(brace
r_static
r_int
r_char
id|scsi_irq_bits
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|3
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|3
comma
l_int|2
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|control
op_or_assign
id|scsi_irq_bits
(braket
id|SMW_SCSI_IRQ
)braket
op_lshift
l_int|6
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef SMW_OPL4_ENABLE
multiline_comment|/*&n;     *  Make the OPL4 chip visible on the PC bus at 0x380.&n;     *&n;     *  There is no need to enable this feature since this driver&n;     *  doesn&squot;t support OPL4 yet. Also there is no RAM in SM Wave so&n;     *  enabling OPL4 is pretty useless.&n;   */
id|control
op_or_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* Uses IRQ12 if bit 0x20 == 0 */
multiline_comment|/* control |= 0x20;      Uncomment this if you want to use IRQ7 */
macro_line|#endif
id|outb
(paren
id|control
op_or
l_int|0x03
comma
id|mpu_base
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* xxxxxx11 restarts */
id|hw_config-&gt;name
op_assign
l_string|&quot;SoundMan Wave&quot;
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|ess_midi_init
id|ess_midi_init
(paren
id|sb_devc
op_star
id|devc
comma
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_int
r_char
id|cfg
comma
id|tmp
suffix:semicolon
id|cfg
op_assign
id|sb_getmixer
(paren
id|devc
comma
l_int|0x40
)paren
op_amp
l_int|0x03
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;submodel
OL
l_int|8
)paren
(brace
id|sb_setmixer
(paren
id|devc
comma
l_int|0x40
comma
id|cfg
op_or
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/* Enable OPL3 &amp; joystick */
r_return
l_int|0
suffix:semicolon
multiline_comment|/* ES688 doesn&squot;t support MPU401 mode */
)brace
id|tmp
op_assign
(paren
id|hw_config-&gt;io_base
op_amp
l_int|0x0f0
)paren
op_rshift
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OG
l_int|3
)paren
(brace
id|sb_setmixer
(paren
id|devc
comma
l_int|0x40
comma
id|cfg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|cfg
op_or_assign
id|tmp
op_lshift
l_int|3
suffix:semicolon
id|tmp
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* MPU enabled without interrupts */
r_switch
c_cond
(paren
id|hw_config-&gt;irq
)paren
(brace
r_case
l_int|9
suffix:colon
id|tmp
op_assign
l_int|0x4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|tmp
op_assign
l_int|0x5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|tmp
op_assign
l_int|0x6
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|tmp
op_assign
l_int|0x7
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
id|cfg
op_or_assign
id|tmp
op_lshift
l_int|5
suffix:semicolon
id|sb_setmixer
(paren
id|devc
comma
l_int|0x40
comma
id|cfg
op_or
l_int|0x03
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|init_Jazz16_midi
id|init_Jazz16_midi
(paren
id|sb_devc
op_star
id|devc
comma
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_int
id|mpu_base
op_assign
id|hw_config-&gt;io_base
suffix:semicolon
r_int
id|sb_base
op_assign
id|devc-&gt;base
suffix:semicolon
r_int
id|irq
op_assign
id|hw_config-&gt;irq
suffix:semicolon
r_int
r_char
id|bits
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|irq
OL
l_int|0
)paren
id|irq
op_mul_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
l_int|15
op_logical_or
id|jazz_irq_bits
(braket
id|irq
)braket
op_eq
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;Jazz16: Invalid MIDI interrupt (IRQ%d)&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|sb_base
)paren
(brace
r_case
l_int|0x220
suffix:colon
id|bits
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x240
suffix:colon
id|bits
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x260
suffix:colon
id|bits
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
id|bits
op_assign
id|jazz16_bits
op_assign
id|bits
op_lshift
l_int|5
suffix:semicolon
r_switch
c_cond
(paren
id|mpu_base
)paren
(brace
r_case
l_int|0x310
suffix:colon
id|bits
op_or_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x320
suffix:colon
id|bits
op_or_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x330
suffix:colon
id|bits
op_or_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
(paren
l_string|&quot;Jazz16: Invalid MIDI I/O port %x&bslash;n&quot;
comma
id|mpu_base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Magic wake up sequence by writing to 0x201 (aka Joystick port)&n; */
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|outb
(paren
l_int|0xAF
comma
l_int|0x201
)paren
suffix:semicolon
id|outb
(paren
l_int|0x50
comma
l_int|0x201
)paren
suffix:semicolon
id|outb
(paren
id|bits
comma
l_int|0x201
)paren
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
id|hw_config-&gt;name
op_assign
l_string|&quot;Jazz16&quot;
suffix:semicolon
id|smw_midi_init
(paren
id|devc
comma
id|hw_config
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
(paren
id|devc
comma
l_int|0xfb
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
(paren
id|devc
comma
id|jazz_dma_bits
(braket
id|devc-&gt;dma8
)braket
op_or
(paren
id|jazz_dma_bits
(braket
id|devc-&gt;dma16
)braket
op_lshift
l_int|4
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
(paren
id|devc
comma
id|jazz_irq_bits
(braket
id|devc-&gt;irq
)braket
op_or
(paren
id|jazz_irq_bits
(braket
id|irq
)braket
op_lshift
l_int|4
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_void
DECL|function|attach_sbmpu
id|attach_sbmpu
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
macro_line|#if defined(CONFIG_MIDI) &amp;&amp; defined(CONFIG_UART401)
id|attach_uart401
(paren
id|hw_config
)paren
suffix:semicolon
macro_line|#endif
)brace
r_int
DECL|function|probe_sbmpu
id|probe_sbmpu
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
macro_line|#if defined(CONFIG_MIDI) &amp;&amp; defined(CONFIG_UART401)
id|sb_devc
op_star
id|devc
op_assign
id|last_devc
suffix:semicolon
r_if
c_cond
(paren
id|last_devc
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|last_devc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hw_config-&gt;io_base
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|check_region
(paren
id|hw_config-&gt;io_base
comma
l_int|4
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;sbmpu: I/O port conflict (%x)&bslash;n&quot;
comma
id|hw_config-&gt;io_base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|devc-&gt;model
)paren
(brace
r_case
id|MDL_SB16
suffix:colon
r_if
c_cond
(paren
id|hw_config-&gt;io_base
op_ne
l_int|0x300
op_logical_and
id|hw_config-&gt;io_base
op_ne
l_int|0x330
)paren
(brace
id|printk
(paren
l_string|&quot;SB16: Invalid MIDI port %x&bslash;n&quot;
comma
id|hw_config-&gt;irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|hw_config-&gt;name
op_assign
l_string|&quot;Sound Blaster 16&quot;
suffix:semicolon
id|hw_config-&gt;irq
op_assign
op_minus
id|devc-&gt;irq
suffix:semicolon
id|sb16_set_mpu_port
c_func
(paren
id|devc
comma
id|hw_config
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_ESS
suffix:colon
r_if
c_cond
(paren
id|hw_config-&gt;irq
OL
l_int|3
op_logical_or
id|hw_config-&gt;irq
op_eq
id|devc-&gt;irq
)paren
id|hw_config-&gt;irq
op_assign
op_minus
id|devc-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ess_midi_init
(paren
id|devc
comma
id|hw_config
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|hw_config-&gt;name
op_assign
l_string|&quot;ESS ES1688&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_JAZZ
suffix:colon
r_if
c_cond
(paren
id|hw_config-&gt;irq
OL
l_int|3
op_logical_or
id|hw_config-&gt;irq
op_eq
id|devc-&gt;irq
)paren
id|hw_config-&gt;irq
op_assign
op_minus
id|devc-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init_Jazz16_midi
(paren
id|devc
comma
id|hw_config
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|probe_uart401
(paren
id|hw_config
)paren
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
r_void
DECL|function|unload_sbmpu
id|unload_sbmpu
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
macro_line|#if defined(CONFIG_MIDI) &amp;&amp; defined(CONFIG_UART401)
id|unload_uart401
(paren
id|hw_config
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#else /* !CONFIG_MIDI */
r_void
DECL|function|unload_sbmpu
id|unload_sbmpu
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
)brace
r_int
DECL|function|probe_sbmpu
id|probe_sbmpu
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|attach_sbmpu
id|attach_sbmpu
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
)brace
macro_line|#endif
macro_line|#endif
eof
