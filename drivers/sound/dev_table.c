multiline_comment|/*&n; * sound/dev_table.c&n; *&n; * Device call tables.&n; *&n; *&n; * Copyright (C) by Hannu Savolainen 1993-1997&n; *&n; * OSS/Free for Linux is distributed under the GNU GENERAL PUBLIC LICENSE (GPL)&n; * Version 2 (June 1991). See the &quot;COPYING&quot; file distributed with this software&n; * for more info.&n; */
macro_line|#include &lt;linux/init.h&gt;
DECL|macro|_DEV_TABLE_C_
mdefine_line|#define _DEV_TABLE_C_
macro_line|#include &quot;sound_config.h&quot;
DECL|function|sound_install_audiodrv
r_int
id|sound_install_audiodrv
c_func
(paren
r_int
id|vers
comma
r_char
op_star
id|name
comma
r_struct
id|audio_driver
op_star
id|driver
comma
r_int
id|driver_size
comma
r_int
id|flags
comma
r_int
r_int
id|format_mask
comma
r_void
op_star
id|devc
comma
r_int
id|dma1
comma
r_int
id|dma2
)paren
(brace
r_struct
id|audio_driver
op_star
id|d
suffix:semicolon
r_struct
id|audio_operations
op_star
id|op
suffix:semicolon
r_int
id|l
comma
id|num
suffix:semicolon
r_if
c_cond
(paren
id|vers
op_ne
id|AUDIO_DRIVER_VERSION
op_logical_or
id|driver_size
OG
r_sizeof
(paren
r_struct
id|audio_driver
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound: Incompatible audio driver for %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
op_minus
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|num
op_assign
id|sound_alloc_audiodev
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|num
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sound: Too many audio drivers&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
(paren
id|EBUSY
)paren
suffix:semicolon
)brace
id|d
op_assign
(paren
r_struct
id|audio_driver
op_star
)paren
(paren
id|sound_mem_blocks
(braket
id|sound_nblocks
)braket
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|audio_driver
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound_nblocks
OL
l_int|1024
)paren
id|sound_nblocks
op_increment
suffix:semicolon
id|op
op_assign
(paren
r_struct
id|audio_operations
op_star
)paren
(paren
id|sound_mem_blocks
(braket
id|sound_nblocks
)braket
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|audio_operations
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound_nblocks
OL
l_int|1024
)paren
id|sound_nblocks
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
l_int|NULL
op_logical_or
id|op
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound: Can&squot;t allocate driver for (%s)&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|sound_unload_audiodev
c_func
(paren
id|num
)paren
suffix:semicolon
r_return
op_minus
(paren
id|ENOMEM
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|op
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|audio_operations
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|op-&gt;in_sleeper
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|op-&gt;out_sleeper
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|op-&gt;poll_sleeper
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver_size
OL
r_sizeof
(paren
r_struct
id|audio_driver
)paren
)paren
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|d
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|audio_driver
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|d
comma
(paren
r_char
op_star
)paren
id|driver
comma
id|driver_size
)paren
suffix:semicolon
id|op-&gt;d
op_assign
id|d
suffix:semicolon
id|l
op_assign
id|strlen
c_func
(paren
id|name
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
r_sizeof
(paren
id|op-&gt;name
)paren
)paren
id|l
op_assign
r_sizeof
(paren
id|op-&gt;name
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|op-&gt;name
comma
id|name
comma
id|l
)paren
suffix:semicolon
id|op-&gt;name
(braket
id|l
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|op-&gt;flags
op_assign
id|flags
suffix:semicolon
id|op-&gt;format_mask
op_assign
id|format_mask
suffix:semicolon
id|op-&gt;devc
op_assign
id|devc
suffix:semicolon
multiline_comment|/*&n;&t; *    Hardcoded defaults&n;&t; */
id|audio_devs
(braket
id|num
)braket
op_assign
id|op
suffix:semicolon
id|DMAbuf_init
c_func
(paren
id|num
comma
id|dma1
comma
id|dma2
)paren
suffix:semicolon
id|audio_init_devices
c_func
(paren
)paren
suffix:semicolon
r_return
id|num
suffix:semicolon
)brace
DECL|function|sound_install_mixer
r_int
id|sound_install_mixer
c_func
(paren
r_int
id|vers
comma
r_char
op_star
id|name
comma
r_struct
id|mixer_operations
op_star
id|driver
comma
r_int
id|driver_size
comma
r_void
op_star
id|devc
)paren
(brace
r_struct
id|mixer_operations
op_star
id|op
suffix:semicolon
r_int
id|l
suffix:semicolon
r_int
id|n
op_assign
id|sound_alloc_mixerdev
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound: Too many mixer drivers&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vers
op_ne
id|MIXER_DRIVER_VERSION
op_logical_or
id|driver_size
OG
r_sizeof
(paren
r_struct
id|mixer_operations
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound: Incompatible mixer driver for %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* FIXME: This leaks a mixer_operations struct every time its called&n;&t;   until you unload sound! */
id|op
op_assign
(paren
r_struct
id|mixer_operations
op_star
)paren
(paren
id|sound_mem_blocks
(braket
id|sound_nblocks
)braket
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mixer_operations
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound_nblocks
OL
l_int|1024
)paren
id|sound_nblocks
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|op
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound: Can&squot;t allocate mixer driver for (%s)&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|op
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|mixer_operations
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|op
comma
(paren
r_char
op_star
)paren
id|driver
comma
id|driver_size
)paren
suffix:semicolon
id|l
op_assign
id|strlen
c_func
(paren
id|name
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
r_sizeof
(paren
id|op-&gt;name
)paren
)paren
id|l
op_assign
r_sizeof
(paren
id|op-&gt;name
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|op-&gt;name
comma
id|name
comma
id|l
)paren
suffix:semicolon
id|op-&gt;name
(braket
id|l
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|op-&gt;devc
op_assign
id|devc
suffix:semicolon
id|mixer_devs
(braket
id|n
)braket
op_assign
id|op
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
DECL|function|sound_unload_audiodev
r_void
id|sound_unload_audiodev
c_func
(paren
r_int
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev
op_ne
op_minus
l_int|1
)paren
(brace
id|DMAbuf_deinit
c_func
(paren
id|dev
)paren
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_assign
l_int|NULL
suffix:semicolon
id|unregister_sound_dsp
c_func
(paren
(paren
id|dev
op_lshift
l_int|4
)paren
op_plus
l_int|3
)paren
suffix:semicolon
)brace
)brace
DECL|function|sound_alloc_audiodev
r_int
id|sound_alloc_audiodev
c_func
(paren
r_void
)paren
(brace
r_int
id|i
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|oss_sound_fops
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
op_minus
l_int|1
)paren
(brace
r_return
id|i
suffix:semicolon
)brace
id|i
op_rshift_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|num_audiodevs
)paren
(brace
id|num_audiodevs
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
DECL|function|sound_alloc_mididev
r_int
id|sound_alloc_mididev
c_func
(paren
r_void
)paren
(brace
r_int
id|i
op_assign
id|register_sound_midi
c_func
(paren
op_amp
id|oss_sound_fops
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
op_minus
l_int|1
)paren
(brace
r_return
id|i
suffix:semicolon
)brace
id|i
op_rshift_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|num_midis
)paren
(brace
id|num_midis
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
DECL|function|sound_alloc_synthdev
r_int
id|sound_alloc_synthdev
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_SYNTH_DEV
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|synth_devs
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|i
op_ge
id|num_synths
)paren
id|num_synths
op_increment
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|sound_alloc_mixerdev
r_int
id|sound_alloc_mixerdev
c_func
(paren
r_void
)paren
(brace
r_int
id|i
op_assign
id|register_sound_mixer
c_func
(paren
op_amp
id|oss_sound_fops
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
op_minus
l_int|1
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|i
op_rshift_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|num_mixers
)paren
(brace
id|num_mixers
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
DECL|function|sound_alloc_timerdev
r_int
id|sound_alloc_timerdev
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_TIMER_DEV
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sound_timer_devs
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|i
op_ge
id|num_sound_timers
)paren
id|num_sound_timers
op_increment
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|sound_unload_mixerdev
r_void
id|sound_unload_mixerdev
c_func
(paren
r_int
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev
op_ne
op_minus
l_int|1
)paren
(brace
id|mixer_devs
(braket
id|dev
)braket
op_assign
l_int|NULL
suffix:semicolon
id|unregister_sound_mixer
c_func
(paren
id|dev
op_lshift
l_int|4
)paren
suffix:semicolon
id|num_mixers
op_decrement
suffix:semicolon
)brace
)brace
DECL|function|sound_unload_mididev
r_void
id|sound_unload_mididev
c_func
(paren
r_int
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev
op_ne
op_minus
l_int|1
)paren
(brace
id|midi_devs
(braket
id|dev
)braket
op_assign
l_int|NULL
suffix:semicolon
id|unregister_sound_midi
c_func
(paren
(paren
id|dev
op_lshift
l_int|4
)paren
op_plus
l_int|2
)paren
suffix:semicolon
)brace
)brace
DECL|function|sound_unload_synthdev
r_void
id|sound_unload_synthdev
c_func
(paren
r_int
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev
op_ne
op_minus
l_int|1
)paren
id|synth_devs
(braket
id|dev
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|sound_unload_timerdev
r_void
id|sound_unload_timerdev
c_func
(paren
r_int
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev
op_ne
op_minus
l_int|1
)paren
id|sound_timer_devs
(braket
id|dev
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
eof
