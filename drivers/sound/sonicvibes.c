multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *      sonicvibes.c  --  S3 Sonic Vibes audio driver.&n; *&n; *      Copyright (C) 1998-2000  Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *&n; *      This program is free software; you can redistribute it and/or modify&n; *      it under the terms of the GNU General Public License as published by&n; *      the Free Software Foundation; either version 2 of the License, or&n; *      (at your option) any later version.&n; *&n; *      This program is distributed in the hope that it will be useful,&n; *      but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *      GNU General Public License for more details.&n; *&n; *      You should have received a copy of the GNU General Public License&n; *      along with this program; if not, write to the Free Software&n; *      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * Special thanks to David C. Niemi&n; *&n; *&n; * Module command line parameters:&n; *   none so far&n; *&n; *&n; *  Supported devices:&n; *  /dev/dsp    standard /dev/dsp device, (mostly) OSS compatible&n; *  /dev/mixer  standard /dev/mixer device, (mostly) OSS compatible&n; *  /dev/midi   simple MIDI UART interface, no ioctl&n; *&n; *  The card has both an FM and a Wavetable synth, but I have to figure&n; *  out first how to drive them...&n; *&n; *  Revision history&n; *    06.05.1998   0.1   Initial release&n; *    10.05.1998   0.2   Fixed many bugs, esp. ADC rate calculation&n; *                       First stab at a simple midi interface (no bells&amp;whistles)&n; *    13.05.1998   0.3   Fix stupid cut&amp;paste error: set_adc_rate was called instead of&n; *                       set_dac_rate in the FMODE_WRITE case in sv_open&n; *                       Fix hwptr out of bounds (now mpg123 works)&n; *    14.05.1998   0.4   Don&squot;t allow excessive interrupt rates&n; *    08.06.1998   0.5   First release using Alan Cox&squot; soundcore instead of miscdevice&n; *    03.08.1998   0.6   Do not include modversions.h&n; *                       Now mixer behaviour can basically be selected between&n; *                       &quot;OSS documented&quot; and &quot;OSS actual&quot; behaviour&n; *    31.08.1998   0.7   Fix realplayer problems - dac.count issues&n; *    10.12.1998   0.8   Fix drain_dac trying to wait on not yet initialized DMA&n; *    16.12.1998   0.9   Fix a few f_file &amp; FMODE_ bugs&n; *    06.01.1999   0.10  remove the silly SA_INTERRUPT flag.&n; *                       hopefully killed the egcs section type conflict&n; *    12.03.1999   0.11  cinfo.blocks should be reset after GETxPTR ioctl.&n; *                       reported by Johan Maes &lt;joma@telindus.be&gt;&n; *    22.03.1999   0.12  return EAGAIN instead of EBUSY when O_NONBLOCK&n; *                       read/write cannot be executed&n; *    05.04.1999   0.13  added code to sv_read and sv_write which should detect&n; *                       lockups of the sound chip and revive it. This is basically&n; *                       an ugly hack, but at least applications using this driver&n; *                       won&squot;t hang forever. I don&squot;t know why these lockups happen,&n; *                       it might well be the motherboard chipset (an early 486 PCI&n; *                       board with ALI chipset), since every busmastering 100MB&n; *                       ethernet card I&squot;ve tried (Realtek 8139 and Macronix tulip clone)&n; *                       exhibit similar behaviour (they work for a couple of packets&n; *                       and then lock up and can be revived by ifconfig down/up).&n; *    07.04.1999   0.14  implemented the following ioctl&squot;s: SOUND_PCM_READ_RATE, &n; *                       SOUND_PCM_READ_CHANNELS, SOUND_PCM_READ_BITS; &n; *                       Alpha fixes reported by Peter Jones &lt;pjones@redhat.com&gt;&n; *                       Note: dmaio hack might still be wrong on archs other than i386&n; *    15.06.1999   0.15  Fix bad allocation bug.&n; *                       Thanks to Deti Fliegl &lt;fliegl@in.tum.de&gt;&n; *    28.06.1999   0.16  Add pci_set_master&n; *    03.08.1999   0.17  adapt to Linus&squot; new __setup/__initcall&n; *                       added kernel command line options &quot;sonicvibes=reverb&quot; and &quot;sonicvibesdmaio=dmaioaddr&quot;&n; *    12.08.1999   0.18  module_init/__setup fixes&n; *    24.08.1999   0.19  get rid of the dmaio kludge, replace with allocate_resource&n; *    31.08.1999   0.20  add spin_lock_init&n; *                       use new resource allocation to allocate DDMA IO space&n; *                       replaced current-&gt;state = x with set_current_state(x)&n; *    03.09.1999   0.21  change read semantics for MIDI to match&n; *                       OSS more closely; remove possible wakeup race&n; *    28.10.1999   0.22  More waitqueue races fixed&n; *    01.12.1999   0.23  New argument to allocate_resource&n; *    07.12.1999   0.24  More allocate_resource semantics change&n; *    08.01.2000   0.25  Prevent some ioctl&squot;s from returning bad count values on underrun/overrun;&n; *                       Tim Janik&squot;s BSE (Bedevilled Sound Engine) found this&n; *                       use Martin Mares&squot; pci_assign_resource&n; *    07.02.2000   0.26  Use pci_alloc_consistent and pci_register_driver&n; *    21.11.2000   0.27  Initialize dma buffers in poll, otherwise poll may return a bogus mask&n; *&n; */
multiline_comment|/*****************************************************************************/
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/sound.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/wrapper.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/hardirq.h&gt;
macro_line|#include &quot;dm.h&quot;
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|OSS_DOCUMENTED_MIXER_SEMANTICS
macro_line|#undef OSS_DOCUMENTED_MIXER_SEMANTICS
multiline_comment|/* --------------------------------------------------------------------- */
macro_line|#ifndef PCI_VENDOR_ID_S3
DECL|macro|PCI_VENDOR_ID_S3
mdefine_line|#define PCI_VENDOR_ID_S3             0x5333
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_S3_SONICVIBES
DECL|macro|PCI_DEVICE_ID_S3_SONICVIBES
mdefine_line|#define PCI_DEVICE_ID_S3_SONICVIBES  0xca00
macro_line|#endif
DECL|macro|SV_MAGIC
mdefine_line|#define SV_MAGIC  ((PCI_VENDOR_ID_S3&lt;&lt;16)|PCI_DEVICE_ID_S3_SONICVIBES)
DECL|macro|SV_EXTENT_SB
mdefine_line|#define SV_EXTENT_SB      0x10
DECL|macro|SV_EXTENT_ENH
mdefine_line|#define SV_EXTENT_ENH     0x10
DECL|macro|SV_EXTENT_SYNTH
mdefine_line|#define SV_EXTENT_SYNTH   0x4
DECL|macro|SV_EXTENT_MIDI
mdefine_line|#define SV_EXTENT_MIDI    0x4
DECL|macro|SV_EXTENT_GAME
mdefine_line|#define SV_EXTENT_GAME    0x8
DECL|macro|SV_EXTENT_DMA
mdefine_line|#define SV_EXTENT_DMA     0x10
multiline_comment|/*&n; * we are not a bridge and thus use a resource for DDMA that is used for bridges but&n; * left empty for normal devices&n; */
DECL|macro|RESOURCE_SB
mdefine_line|#define RESOURCE_SB       0
DECL|macro|RESOURCE_ENH
mdefine_line|#define RESOURCE_ENH      1
DECL|macro|RESOURCE_SYNTH
mdefine_line|#define RESOURCE_SYNTH    2
DECL|macro|RESOURCE_MIDI
mdefine_line|#define RESOURCE_MIDI     3
DECL|macro|RESOURCE_GAME
mdefine_line|#define RESOURCE_GAME     4
DECL|macro|RESOURCE_DDMA
mdefine_line|#define RESOURCE_DDMA     7
DECL|macro|SV_MIDI_DATA
mdefine_line|#define SV_MIDI_DATA      0
DECL|macro|SV_MIDI_COMMAND
mdefine_line|#define SV_MIDI_COMMAND   1
DECL|macro|SV_MIDI_STATUS
mdefine_line|#define SV_MIDI_STATUS    1
DECL|macro|SV_DMA_ADDR0
mdefine_line|#define SV_DMA_ADDR0      0
DECL|macro|SV_DMA_ADDR1
mdefine_line|#define SV_DMA_ADDR1      1
DECL|macro|SV_DMA_ADDR2
mdefine_line|#define SV_DMA_ADDR2      2
DECL|macro|SV_DMA_ADDR3
mdefine_line|#define SV_DMA_ADDR3      3
DECL|macro|SV_DMA_COUNT0
mdefine_line|#define SV_DMA_COUNT0     4
DECL|macro|SV_DMA_COUNT1
mdefine_line|#define SV_DMA_COUNT1     5
DECL|macro|SV_DMA_COUNT2
mdefine_line|#define SV_DMA_COUNT2     6
DECL|macro|SV_DMA_MODE
mdefine_line|#define SV_DMA_MODE       0xb
DECL|macro|SV_DMA_RESET
mdefine_line|#define SV_DMA_RESET      0xd
DECL|macro|SV_DMA_MASK
mdefine_line|#define SV_DMA_MASK       0xf
multiline_comment|/*&n; * DONT reset the DMA controllers unless you understand&n; * the reset semantics. Assuming reset semantics as in&n; * the 8237 does not work.&n; */
DECL|macro|DMA_MODE_AUTOINIT
mdefine_line|#define DMA_MODE_AUTOINIT 0x10
DECL|macro|DMA_MODE_READ
mdefine_line|#define DMA_MODE_READ     0x44    /* I/O to memory, no autoinit, increment, single mode */
DECL|macro|DMA_MODE_WRITE
mdefine_line|#define DMA_MODE_WRITE    0x48    /* memory to I/O, no autoinit, increment, single mode */
DECL|macro|SV_CODEC_CONTROL
mdefine_line|#define SV_CODEC_CONTROL  0
DECL|macro|SV_CODEC_INTMASK
mdefine_line|#define SV_CODEC_INTMASK  1
DECL|macro|SV_CODEC_STATUS
mdefine_line|#define SV_CODEC_STATUS   2
DECL|macro|SV_CODEC_IADDR
mdefine_line|#define SV_CODEC_IADDR    4
DECL|macro|SV_CODEC_IDATA
mdefine_line|#define SV_CODEC_IDATA    5
DECL|macro|SV_CCTRL_RESET
mdefine_line|#define SV_CCTRL_RESET      0x80
DECL|macro|SV_CCTRL_INTADRIVE
mdefine_line|#define SV_CCTRL_INTADRIVE  0x20
DECL|macro|SV_CCTRL_WAVETABLE
mdefine_line|#define SV_CCTRL_WAVETABLE  0x08
DECL|macro|SV_CCTRL_REVERB
mdefine_line|#define SV_CCTRL_REVERB     0x04
DECL|macro|SV_CCTRL_ENHANCED
mdefine_line|#define SV_CCTRL_ENHANCED   0x01
DECL|macro|SV_CINTMASK_DMAA
mdefine_line|#define SV_CINTMASK_DMAA    0x01
DECL|macro|SV_CINTMASK_DMAC
mdefine_line|#define SV_CINTMASK_DMAC    0x04
DECL|macro|SV_CINTMASK_SPECIAL
mdefine_line|#define SV_CINTMASK_SPECIAL 0x08
DECL|macro|SV_CINTMASK_UPDOWN
mdefine_line|#define SV_CINTMASK_UPDOWN  0x40
DECL|macro|SV_CINTMASK_MIDI
mdefine_line|#define SV_CINTMASK_MIDI    0x80
DECL|macro|SV_CSTAT_DMAA
mdefine_line|#define SV_CSTAT_DMAA       0x01
DECL|macro|SV_CSTAT_DMAC
mdefine_line|#define SV_CSTAT_DMAC&t;    0x04
DECL|macro|SV_CSTAT_SPECIAL
mdefine_line|#define SV_CSTAT_SPECIAL    0x08
DECL|macro|SV_CSTAT_UPDOWN
mdefine_line|#define SV_CSTAT_UPDOWN&t;    0x40
DECL|macro|SV_CSTAT_MIDI
mdefine_line|#define SV_CSTAT_MIDI&t;    0x80
DECL|macro|SV_CIADDR_TRD
mdefine_line|#define SV_CIADDR_TRD       0x80
DECL|macro|SV_CIADDR_MCE
mdefine_line|#define SV_CIADDR_MCE       0x40
multiline_comment|/* codec indirect registers */
DECL|macro|SV_CIMIX_ADCINL
mdefine_line|#define SV_CIMIX_ADCINL     0x00
DECL|macro|SV_CIMIX_ADCINR
mdefine_line|#define SV_CIMIX_ADCINR     0x01
DECL|macro|SV_CIMIX_AUX1INL
mdefine_line|#define SV_CIMIX_AUX1INL    0x02
DECL|macro|SV_CIMIX_AUX1INR
mdefine_line|#define SV_CIMIX_AUX1INR    0x03
DECL|macro|SV_CIMIX_CDINL
mdefine_line|#define SV_CIMIX_CDINL      0x04
DECL|macro|SV_CIMIX_CDINR
mdefine_line|#define SV_CIMIX_CDINR      0x05
DECL|macro|SV_CIMIX_LINEINL
mdefine_line|#define SV_CIMIX_LINEINL    0x06
DECL|macro|SV_CIMIX_LINEINR
mdefine_line|#define SV_CIMIX_LINEINR    0x07
DECL|macro|SV_CIMIX_MICIN
mdefine_line|#define SV_CIMIX_MICIN      0x08
DECL|macro|SV_CIMIX_SYNTHINL
mdefine_line|#define SV_CIMIX_SYNTHINL   0x0A
DECL|macro|SV_CIMIX_SYNTHINR
mdefine_line|#define SV_CIMIX_SYNTHINR   0x0B
DECL|macro|SV_CIMIX_AUX2INL
mdefine_line|#define SV_CIMIX_AUX2INL    0x0C
DECL|macro|SV_CIMIX_AUX2INR
mdefine_line|#define SV_CIMIX_AUX2INR    0x0D
DECL|macro|SV_CIMIX_ANALOGINL
mdefine_line|#define SV_CIMIX_ANALOGINL  0x0E
DECL|macro|SV_CIMIX_ANALOGINR
mdefine_line|#define SV_CIMIX_ANALOGINR  0x0F
DECL|macro|SV_CIMIX_PCMINL
mdefine_line|#define SV_CIMIX_PCMINL     0x10
DECL|macro|SV_CIMIX_PCMINR
mdefine_line|#define SV_CIMIX_PCMINR     0x11
DECL|macro|SV_CIGAMECONTROL
mdefine_line|#define SV_CIGAMECONTROL    0x09
DECL|macro|SV_CIDATAFMT
mdefine_line|#define SV_CIDATAFMT        0x12
DECL|macro|SV_CIENABLE
mdefine_line|#define SV_CIENABLE         0x13
DECL|macro|SV_CIUPDOWN
mdefine_line|#define SV_CIUPDOWN         0x14
DECL|macro|SV_CIREVISION
mdefine_line|#define SV_CIREVISION       0x15
DECL|macro|SV_CIADCOUTPUT
mdefine_line|#define SV_CIADCOUTPUT      0x16
DECL|macro|SV_CIDMAABASECOUNT1
mdefine_line|#define SV_CIDMAABASECOUNT1 0x18
DECL|macro|SV_CIDMAABASECOUNT0
mdefine_line|#define SV_CIDMAABASECOUNT0 0x19
DECL|macro|SV_CIDMACBASECOUNT1
mdefine_line|#define SV_CIDMACBASECOUNT1 0x1c
DECL|macro|SV_CIDMACBASECOUNT0
mdefine_line|#define SV_CIDMACBASECOUNT0 0x1d
DECL|macro|SV_CIPCMSR0
mdefine_line|#define SV_CIPCMSR0         0x1e
DECL|macro|SV_CIPCMSR1
mdefine_line|#define SV_CIPCMSR1         0x1f
DECL|macro|SV_CISYNTHSR0
mdefine_line|#define SV_CISYNTHSR0       0x20
DECL|macro|SV_CISYNTHSR1
mdefine_line|#define SV_CISYNTHSR1       0x21
DECL|macro|SV_CIADCCLKSOURCE
mdefine_line|#define SV_CIADCCLKSOURCE   0x22
DECL|macro|SV_CIADCALTSR
mdefine_line|#define SV_CIADCALTSR       0x23
DECL|macro|SV_CIADCPLLM
mdefine_line|#define SV_CIADCPLLM        0x24
DECL|macro|SV_CIADCPLLN
mdefine_line|#define SV_CIADCPLLN        0x25
DECL|macro|SV_CISYNTHPLLM
mdefine_line|#define SV_CISYNTHPLLM      0x26
DECL|macro|SV_CISYNTHPLLN
mdefine_line|#define SV_CISYNTHPLLN      0x27
DECL|macro|SV_CIUARTCONTROL
mdefine_line|#define SV_CIUARTCONTROL    0x2a
DECL|macro|SV_CIDRIVECONTROL
mdefine_line|#define SV_CIDRIVECONTROL   0x2b
DECL|macro|SV_CISRSSPACE
mdefine_line|#define SV_CISRSSPACE       0x2c
DECL|macro|SV_CISRSCENTER
mdefine_line|#define SV_CISRSCENTER      0x2d
DECL|macro|SV_CIWAVETABLESRC
mdefine_line|#define SV_CIWAVETABLESRC   0x2e
DECL|macro|SV_CIANALOGPWRDOWN
mdefine_line|#define SV_CIANALOGPWRDOWN  0x30
DECL|macro|SV_CIDIGITALPWRDOWN
mdefine_line|#define SV_CIDIGITALPWRDOWN 0x31
DECL|macro|SV_CIMIX_ADCSRC_CD
mdefine_line|#define SV_CIMIX_ADCSRC_CD     0x20
DECL|macro|SV_CIMIX_ADCSRC_DAC
mdefine_line|#define SV_CIMIX_ADCSRC_DAC    0x40
DECL|macro|SV_CIMIX_ADCSRC_AUX2
mdefine_line|#define SV_CIMIX_ADCSRC_AUX2   0x60
DECL|macro|SV_CIMIX_ADCSRC_LINE
mdefine_line|#define SV_CIMIX_ADCSRC_LINE   0x80
DECL|macro|SV_CIMIX_ADCSRC_AUX1
mdefine_line|#define SV_CIMIX_ADCSRC_AUX1   0xa0
DECL|macro|SV_CIMIX_ADCSRC_MIC
mdefine_line|#define SV_CIMIX_ADCSRC_MIC    0xc0
DECL|macro|SV_CIMIX_ADCSRC_MIXOUT
mdefine_line|#define SV_CIMIX_ADCSRC_MIXOUT 0xe0
DECL|macro|SV_CIMIX_ADCSRC_MASK
mdefine_line|#define SV_CIMIX_ADCSRC_MASK   0xe0
DECL|macro|SV_CFMT_STEREO
mdefine_line|#define SV_CFMT_STEREO     0x01
DECL|macro|SV_CFMT_16BIT
mdefine_line|#define SV_CFMT_16BIT      0x02
DECL|macro|SV_CFMT_MASK
mdefine_line|#define SV_CFMT_MASK       0x03
DECL|macro|SV_CFMT_ASHIFT
mdefine_line|#define SV_CFMT_ASHIFT     0   
DECL|macro|SV_CFMT_CSHIFT
mdefine_line|#define SV_CFMT_CSHIFT     4
DECL|variable|sample_size
r_static
r_const
r_int
id|sample_size
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|2
comma
l_int|4
)brace
suffix:semicolon
DECL|variable|sample_shift
r_static
r_const
r_int
id|sample_shift
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|2
)brace
suffix:semicolon
DECL|macro|SV_CENABLE_PPE
mdefine_line|#define SV_CENABLE_PPE     0x4
DECL|macro|SV_CENABLE_RE
mdefine_line|#define SV_CENABLE_RE      0x2
DECL|macro|SV_CENABLE_PE
mdefine_line|#define SV_CENABLE_PE      0x1
multiline_comment|/* MIDI buffer sizes */
DECL|macro|MIDIINBUF
mdefine_line|#define MIDIINBUF  256
DECL|macro|MIDIOUTBUF
mdefine_line|#define MIDIOUTBUF 256
DECL|macro|FMODE_MIDI_SHIFT
mdefine_line|#define FMODE_MIDI_SHIFT 2
DECL|macro|FMODE_MIDI_READ
mdefine_line|#define FMODE_MIDI_READ  (FMODE_READ &lt;&lt; FMODE_MIDI_SHIFT)
DECL|macro|FMODE_MIDI_WRITE
mdefine_line|#define FMODE_MIDI_WRITE (FMODE_WRITE &lt;&lt; FMODE_MIDI_SHIFT)
DECL|macro|FMODE_DMFM
mdefine_line|#define FMODE_DMFM 0x10
multiline_comment|/* --------------------------------------------------------------------- */
DECL|struct|sv_state
r_struct
id|sv_state
(brace
multiline_comment|/* magic */
DECL|member|magic
r_int
r_int
id|magic
suffix:semicolon
multiline_comment|/* list of sonicvibes devices */
DECL|member|devs
r_struct
id|list_head
id|devs
suffix:semicolon
multiline_comment|/* the corresponding pci_dev structure */
DECL|member|dev
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
multiline_comment|/* soundcore stuff */
DECL|member|dev_audio
r_int
id|dev_audio
suffix:semicolon
DECL|member|dev_mixer
r_int
id|dev_mixer
suffix:semicolon
DECL|member|dev_midi
r_int
id|dev_midi
suffix:semicolon
DECL|member|dev_dmfm
r_int
id|dev_dmfm
suffix:semicolon
multiline_comment|/* hardware resources */
DECL|member|iosb
DECL|member|ioenh
DECL|member|iosynth
DECL|member|iomidi
DECL|member|iogame
r_int
r_int
id|iosb
comma
id|ioenh
comma
id|iosynth
comma
id|iomidi
comma
id|iogame
suffix:semicolon
multiline_comment|/* long for SPARC */
DECL|member|iodmaa
DECL|member|iodmac
DECL|member|irq
r_int
r_int
id|iodmaa
comma
id|iodmac
comma
id|irq
suffix:semicolon
multiline_comment|/* mixer stuff */
r_struct
(brace
DECL|member|modcnt
r_int
r_int
id|modcnt
suffix:semicolon
macro_line|#ifndef OSS_DOCUMENTED_MIXER_SEMANTICS
DECL|member|vol
r_int
r_int
id|vol
(braket
l_int|13
)braket
suffix:semicolon
macro_line|#endif /* OSS_DOCUMENTED_MIXER_SEMANTICS */
DECL|member|mix
)brace
id|mix
suffix:semicolon
multiline_comment|/* wave stuff */
DECL|member|rateadc
DECL|member|ratedac
r_int
r_int
id|rateadc
comma
id|ratedac
suffix:semicolon
DECL|member|fmt
DECL|member|enable
r_int
r_char
id|fmt
comma
id|enable
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|open_sem
r_struct
id|semaphore
id|open_sem
suffix:semicolon
DECL|member|open_mode
id|mode_t
id|open_mode
suffix:semicolon
DECL|member|open_wait
id|wait_queue_head_t
id|open_wait
suffix:semicolon
DECL|struct|dmabuf
r_struct
id|dmabuf
(brace
DECL|member|rawbuf
r_void
op_star
id|rawbuf
suffix:semicolon
DECL|member|dmaaddr
id|dma_addr_t
id|dmaaddr
suffix:semicolon
DECL|member|buforder
r_int
id|buforder
suffix:semicolon
DECL|member|numfrag
r_int
id|numfrag
suffix:semicolon
DECL|member|fragshift
r_int
id|fragshift
suffix:semicolon
DECL|member|hwptr
DECL|member|swptr
r_int
id|hwptr
comma
id|swptr
suffix:semicolon
DECL|member|total_bytes
r_int
id|total_bytes
suffix:semicolon
DECL|member|count
r_int
id|count
suffix:semicolon
DECL|member|error
r_int
id|error
suffix:semicolon
multiline_comment|/* over/underrun */
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
multiline_comment|/* redundant, but makes calculations easier */
DECL|member|fragsize
r_int
id|fragsize
suffix:semicolon
DECL|member|dmasize
r_int
id|dmasize
suffix:semicolon
DECL|member|fragsamples
r_int
id|fragsamples
suffix:semicolon
multiline_comment|/* OSS stuff */
DECL|member|mapped
r_int
id|mapped
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ready
r_int
id|ready
suffix:colon
l_int|1
suffix:semicolon
DECL|member|endcleared
r_int
id|endcleared
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ossfragshift
r_int
id|ossfragshift
suffix:semicolon
DECL|member|ossmaxfrags
r_int
id|ossmaxfrags
suffix:semicolon
DECL|member|subdivision
r_int
id|subdivision
suffix:semicolon
DECL|member|dma_dac
DECL|member|dma_adc
)brace
id|dma_dac
comma
id|dma_adc
suffix:semicolon
multiline_comment|/* midi stuff */
r_struct
(brace
DECL|member|ird
DECL|member|iwr
DECL|member|icnt
r_int
id|ird
comma
id|iwr
comma
id|icnt
suffix:semicolon
DECL|member|ord
DECL|member|owr
DECL|member|ocnt
r_int
id|ord
comma
id|owr
comma
id|ocnt
suffix:semicolon
DECL|member|iwait
id|wait_queue_head_t
id|iwait
suffix:semicolon
DECL|member|owait
id|wait_queue_head_t
id|owait
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
DECL|member|ibuf
r_int
r_char
id|ibuf
(braket
id|MIDIINBUF
)braket
suffix:semicolon
DECL|member|obuf
r_int
r_char
id|obuf
(braket
id|MIDIOUTBUF
)braket
suffix:semicolon
DECL|member|midi
)brace
id|midi
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
r_static
id|LIST_HEAD
c_func
(paren
id|devs
)paren
suffix:semicolon
DECL|variable|wavetable_mem
r_static
r_int
r_int
id|wavetable_mem
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|ld2
r_extern
id|__inline__
r_int
id|ld2
c_func
(paren
r_int
r_int
id|x
)paren
(brace
r_int
id|r
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x
op_ge
l_int|0x10000
)paren
(brace
id|x
op_rshift_assign
l_int|16
suffix:semicolon
id|r
op_add_assign
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|0x100
)paren
(brace
id|x
op_rshift_assign
l_int|8
suffix:semicolon
id|r
op_add_assign
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|0x10
)paren
(brace
id|x
op_rshift_assign
l_int|4
suffix:semicolon
id|r
op_add_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|4
)paren
(brace
id|x
op_rshift_assign
l_int|2
suffix:semicolon
id|r
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|2
)paren
id|r
op_increment
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
multiline_comment|/*&n; * hweightN: returns the hamming weight (i.e. the number&n; * of bits set) of a N-bit word&n; */
macro_line|#ifdef hweight32
DECL|macro|hweight32
macro_line|#undef hweight32
macro_line|#endif
DECL|function|hweight32
r_extern
id|__inline__
r_int
r_int
id|hweight32
c_func
(paren
r_int
r_int
id|w
)paren
(brace
r_int
r_int
id|res
op_assign
(paren
id|w
op_amp
l_int|0x55555555
)paren
op_plus
(paren
(paren
id|w
op_rshift
l_int|1
)paren
op_amp
l_int|0x55555555
)paren
suffix:semicolon
id|res
op_assign
(paren
id|res
op_amp
l_int|0x33333333
)paren
op_plus
(paren
(paren
id|res
op_rshift
l_int|2
)paren
op_amp
l_int|0x33333333
)paren
suffix:semicolon
id|res
op_assign
(paren
id|res
op_amp
l_int|0x0F0F0F0F
)paren
op_plus
(paren
(paren
id|res
op_rshift
l_int|4
)paren
op_amp
l_int|0x0F0F0F0F
)paren
suffix:semicolon
id|res
op_assign
(paren
id|res
op_amp
l_int|0x00FF00FF
)paren
op_plus
(paren
(paren
id|res
op_rshift
l_int|8
)paren
op_amp
l_int|0x00FF00FF
)paren
suffix:semicolon
r_return
(paren
id|res
op_amp
l_int|0x0000FFFF
)paren
op_plus
(paren
(paren
id|res
op_rshift
l_int|16
)paren
op_amp
l_int|0x0000FFFF
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/*&n; * Why use byte IO? Nobody knows, but S3 does it also in their Windows driver.&n; */
DECL|macro|DMABYTEIO
macro_line|#undef DMABYTEIO
DECL|function|set_dmaa
r_static
r_void
id|set_dmaa
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|count
)paren
(brace
macro_line|#ifdef DMABYTEIO
r_int
id|io
op_assign
id|s-&gt;iodmaa
comma
id|u
suffix:semicolon
id|count
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|u
op_assign
l_int|4
suffix:semicolon
id|u
OG
l_int|0
suffix:semicolon
id|u
op_decrement
comma
id|addr
op_rshift_assign
l_int|8
comma
id|io
op_increment
)paren
id|outb
c_func
(paren
id|addr
op_amp
l_int|0xff
comma
id|io
)paren
suffix:semicolon
r_for
c_loop
(paren
id|u
op_assign
l_int|3
suffix:semicolon
id|u
OG
l_int|0
suffix:semicolon
id|u
op_decrement
comma
id|count
op_rshift_assign
l_int|8
comma
id|io
op_increment
)paren
id|outb
c_func
(paren
id|count
op_amp
l_int|0xff
comma
id|io
)paren
suffix:semicolon
macro_line|#else /* DMABYTEIO */
id|count
op_decrement
suffix:semicolon
id|outl
c_func
(paren
id|addr
comma
id|s-&gt;iodmaa
op_plus
id|SV_DMA_ADDR0
)paren
suffix:semicolon
id|outl
c_func
(paren
id|count
comma
id|s-&gt;iodmaa
op_plus
id|SV_DMA_COUNT0
)paren
suffix:semicolon
macro_line|#endif /* DMABYTEIO */
id|outb
c_func
(paren
l_int|0x18
comma
id|s-&gt;iodmaa
op_plus
id|SV_DMA_MODE
)paren
suffix:semicolon
)brace
DECL|function|set_dmac
r_static
r_void
id|set_dmac
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|count
)paren
(brace
macro_line|#ifdef DMABYTEIO
r_int
id|io
op_assign
id|s-&gt;iodmac
comma
id|u
suffix:semicolon
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|u
op_assign
l_int|4
suffix:semicolon
id|u
OG
l_int|0
suffix:semicolon
id|u
op_decrement
comma
id|addr
op_rshift_assign
l_int|8
comma
id|io
op_increment
)paren
id|outb
c_func
(paren
id|addr
op_amp
l_int|0xff
comma
id|io
)paren
suffix:semicolon
r_for
c_loop
(paren
id|u
op_assign
l_int|3
suffix:semicolon
id|u
OG
l_int|0
suffix:semicolon
id|u
op_decrement
comma
id|count
op_rshift_assign
l_int|8
comma
id|io
op_increment
)paren
id|outb
c_func
(paren
id|count
op_amp
l_int|0xff
comma
id|io
)paren
suffix:semicolon
macro_line|#else /* DMABYTEIO */
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|outl
c_func
(paren
id|addr
comma
id|s-&gt;iodmac
op_plus
id|SV_DMA_ADDR0
)paren
suffix:semicolon
id|outl
c_func
(paren
id|count
comma
id|s-&gt;iodmac
op_plus
id|SV_DMA_COUNT0
)paren
suffix:semicolon
macro_line|#endif /* DMABYTEIO */
id|outb
c_func
(paren
l_int|0x14
comma
id|s-&gt;iodmac
op_plus
id|SV_DMA_MODE
)paren
suffix:semicolon
)brace
DECL|function|get_dmaa
r_extern
id|__inline__
r_int
id|get_dmaa
c_func
(paren
r_struct
id|sv_state
op_star
id|s
)paren
(brace
macro_line|#ifdef DMABYTEIO
r_int
id|io
op_assign
id|s-&gt;iodmaa
op_plus
l_int|6
comma
id|v
op_assign
l_int|0
comma
id|u
suffix:semicolon
r_for
c_loop
(paren
id|u
op_assign
l_int|3
suffix:semicolon
id|u
OG
l_int|0
suffix:semicolon
id|u
op_decrement
comma
id|io
op_decrement
)paren
(brace
id|v
op_lshift_assign
l_int|8
suffix:semicolon
id|v
op_or_assign
id|inb
c_func
(paren
id|io
)paren
suffix:semicolon
)brace
r_return
id|v
op_plus
l_int|1
suffix:semicolon
macro_line|#else /* DMABYTEIO */
r_return
(paren
id|inl
c_func
(paren
id|s-&gt;iodmaa
op_plus
id|SV_DMA_COUNT0
)paren
op_amp
l_int|0xffffff
)paren
op_plus
l_int|1
suffix:semicolon
macro_line|#endif /* DMABYTEIO */
)brace
DECL|function|get_dmac
r_extern
id|__inline__
r_int
id|get_dmac
c_func
(paren
r_struct
id|sv_state
op_star
id|s
)paren
(brace
macro_line|#ifdef DMABYTEIO
r_int
id|io
op_assign
id|s-&gt;iodmac
op_plus
l_int|6
comma
id|v
op_assign
l_int|0
comma
id|u
suffix:semicolon
r_for
c_loop
(paren
id|u
op_assign
l_int|3
suffix:semicolon
id|u
OG
l_int|0
suffix:semicolon
id|u
op_decrement
comma
id|io
op_decrement
)paren
(brace
id|v
op_lshift_assign
l_int|8
suffix:semicolon
id|v
op_or_assign
id|inb
c_func
(paren
id|io
)paren
suffix:semicolon
)brace
r_return
(paren
id|v
op_plus
l_int|1
)paren
op_lshift
l_int|1
suffix:semicolon
macro_line|#else /* DMABYTEIO */
r_return
(paren
(paren
id|inl
c_func
(paren
id|s-&gt;iodmac
op_plus
id|SV_DMA_COUNT0
)paren
op_amp
l_int|0xffffff
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|1
suffix:semicolon
macro_line|#endif /* DMABYTEIO */
)brace
DECL|function|wrindir
r_static
r_void
id|wrindir
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
r_char
id|idx
comma
r_int
r_char
id|data
)paren
(brace
id|outb
c_func
(paren
id|idx
op_amp
l_int|0x3f
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
id|data
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IDATA
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|rdindir
r_static
r_int
r_char
id|rdindir
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
r_char
id|idx
)paren
(brace
r_int
r_char
id|v
suffix:semicolon
id|outb
c_func
(paren
id|idx
op_amp
l_int|0x3f
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|v
op_assign
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IDATA
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
DECL|function|set_fmt
r_static
r_void
id|set_fmt
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
r_char
id|mask
comma
r_int
r_char
id|data
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|SV_CIDATAFMT
op_or
id|SV_CIADDR_MCE
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask
)paren
(brace
id|s-&gt;fmt
op_assign
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IDATA
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|s-&gt;fmt
op_assign
(paren
id|s-&gt;fmt
op_amp
id|mask
)paren
op_or
id|data
suffix:semicolon
id|outb
c_func
(paren
id|s-&gt;fmt
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IDATA
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IADDR
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|frobindir
r_static
r_void
id|frobindir
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
r_char
id|idx
comma
r_int
r_char
id|mask
comma
r_int
r_char
id|data
)paren
(brace
id|outb
c_func
(paren
id|idx
op_amp
l_int|0x3f
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IDATA
)paren
op_amp
id|mask
)paren
op_xor
id|data
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IDATA
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|macro|REFFREQUENCY
mdefine_line|#define REFFREQUENCY  24576000
DECL|macro|ADCMULT
mdefine_line|#define ADCMULT 512
DECL|macro|FULLRATE
mdefine_line|#define FULLRATE 48000
DECL|function|setpll
r_static
r_int
id|setpll
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
r_char
id|reg
comma
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|r
comma
id|m
op_assign
l_int|0
comma
id|n
op_assign
l_int|0
suffix:semicolon
r_int
id|xm
comma
id|xn
comma
id|xr
comma
id|xd
comma
id|metric
op_assign
op_complement
l_int|0U
suffix:semicolon
multiline_comment|/* the warnings about m and n used uninitialized are bogus and may safely be ignored */
r_if
c_cond
(paren
id|rate
OL
l_int|625000
op_div
id|ADCMULT
)paren
id|rate
op_assign
l_int|625000
op_div
id|ADCMULT
suffix:semicolon
r_if
c_cond
(paren
id|rate
OG
l_int|150000000
op_div
id|ADCMULT
)paren
id|rate
op_assign
l_int|150000000
op_div
id|ADCMULT
suffix:semicolon
multiline_comment|/* slight violation of specs, needed for continuous sampling rates */
r_for
c_loop
(paren
id|r
op_assign
l_int|0
suffix:semicolon
id|rate
OL
l_int|75000000
op_div
id|ADCMULT
suffix:semicolon
id|r
op_add_assign
l_int|0x20
comma
id|rate
op_lshift_assign
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|xn
op_assign
l_int|3
suffix:semicolon
id|xn
OL
l_int|35
suffix:semicolon
id|xn
op_increment
)paren
r_for
c_loop
(paren
id|xm
op_assign
l_int|3
suffix:semicolon
id|xm
OL
l_int|130
suffix:semicolon
id|xm
op_increment
)paren
(brace
id|xr
op_assign
id|REFFREQUENCY
op_div
id|ADCMULT
op_star
id|xm
op_div
id|xn
suffix:semicolon
id|xd
op_assign
id|abs
c_func
(paren
(paren
r_int
)paren
(paren
id|xr
op_minus
id|rate
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xd
OL
id|metric
)paren
(brace
id|metric
op_assign
id|xd
suffix:semicolon
id|m
op_assign
id|xm
op_minus
l_int|2
suffix:semicolon
id|n
op_assign
id|xn
op_minus
l_int|2
suffix:semicolon
)brace
)brace
id|reg
op_and_assign
l_int|0x3f
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
id|m
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IDATA
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
op_plus
l_int|1
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
id|r
op_or
id|n
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IDATA
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_return
(paren
id|REFFREQUENCY
op_div
id|ADCMULT
op_star
(paren
id|m
op_plus
l_int|2
)paren
op_div
(paren
id|n
op_plus
l_int|2
)paren
)paren
op_rshift
(paren
(paren
id|r
op_rshift
l_int|5
)paren
op_amp
l_int|7
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_int
id|getpll
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
r_char
id|reg
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|m
comma
id|n
suffix:semicolon
id|reg
op_and_assign
l_int|0x3f
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|m
op_assign
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IDATA
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
op_plus
l_int|1
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|n
op_assign
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_IDATA
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_return
(paren
id|REFFREQUENCY
op_div
id|ADCMULT
op_star
(paren
id|m
op_plus
l_int|2
)paren
op_div
(paren
(paren
id|n
op_amp
l_int|0x1f
)paren
op_plus
l_int|2
)paren
)paren
op_rshift
(paren
(paren
id|n
op_rshift
l_int|5
)paren
op_amp
l_int|7
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|set_dac_rate
r_static
r_void
id|set_dac_rate
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_int
id|div
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|rate
OG
l_int|48000
)paren
id|rate
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|rate
OL
l_int|4000
)paren
id|rate
op_assign
l_int|4000
suffix:semicolon
id|div
op_assign
(paren
id|rate
op_star
l_int|65536
op_plus
id|FULLRATE
op_div
l_int|2
)paren
op_div
id|FULLRATE
suffix:semicolon
r_if
c_cond
(paren
id|div
OG
l_int|65535
)paren
id|div
op_assign
l_int|65535
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIPCMSR1
comma
id|div
op_rshift
l_int|8
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIPCMSR0
comma
id|div
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;ratedac
op_assign
(paren
id|div
op_star
id|FULLRATE
op_plus
l_int|32768
)paren
op_div
l_int|65536
suffix:semicolon
)brace
DECL|function|set_adc_rate
r_static
r_void
id|set_adc_rate
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rate1
comma
id|rate2
comma
id|div
suffix:semicolon
r_if
c_cond
(paren
id|rate
OG
l_int|48000
)paren
id|rate
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|rate
OL
l_int|4000
)paren
id|rate
op_assign
l_int|4000
suffix:semicolon
id|rate1
op_assign
id|setpll
c_func
(paren
id|s
comma
id|SV_CIADCPLLM
comma
id|rate
)paren
suffix:semicolon
id|div
op_assign
(paren
l_int|48000
op_plus
id|rate
op_div
l_int|2
)paren
op_div
id|rate
suffix:semicolon
r_if
c_cond
(paren
id|div
OG
l_int|8
)paren
id|div
op_assign
l_int|8
suffix:semicolon
id|rate2
op_assign
(paren
l_int|48000
op_plus
id|div
op_div
l_int|2
)paren
op_div
id|div
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIADCALTSR
comma
(paren
id|div
op_minus
l_int|1
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|abs
c_func
(paren
(paren
r_int
)paren
(paren
id|rate
op_minus
id|rate2
)paren
)paren
op_le
id|abs
c_func
(paren
(paren
r_int
)paren
(paren
id|rate
op_minus
id|rate1
)paren
)paren
)paren
(brace
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIADCCLKSOURCE
comma
l_int|0x10
)paren
suffix:semicolon
id|s-&gt;rateadc
op_assign
id|rate2
suffix:semicolon
)brace
r_else
(brace
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIADCCLKSOURCE
comma
l_int|0x00
)paren
suffix:semicolon
id|s-&gt;rateadc
op_assign
id|rate1
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|stop_adc
r_extern
r_inline
r_void
id|stop_adc
c_func
(paren
r_struct
id|sv_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;enable
op_and_assign
op_complement
id|SV_CENABLE_RE
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIENABLE
comma
id|s-&gt;enable
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|stop_dac
r_extern
r_inline
r_void
id|stop_dac
c_func
(paren
r_struct
id|sv_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;enable
op_and_assign
op_complement
(paren
id|SV_CENABLE_PPE
op_or
id|SV_CENABLE_PE
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIENABLE
comma
id|s-&gt;enable
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|start_dac
r_static
r_void
id|start_dac
c_func
(paren
r_struct
id|sv_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dma_dac.mapped
op_logical_or
id|s-&gt;dma_dac.count
OG
l_int|0
)paren
op_logical_and
id|s-&gt;dma_dac.ready
)paren
(brace
id|s-&gt;enable
op_assign
(paren
id|s-&gt;enable
op_amp
op_complement
id|SV_CENABLE_PPE
)paren
op_or
id|SV_CENABLE_PE
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIENABLE
comma
id|s-&gt;enable
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|start_adc
r_static
r_void
id|start_adc
c_func
(paren
r_struct
id|sv_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dma_adc.mapped
op_logical_or
id|s-&gt;dma_adc.count
OL
(paren
r_int
)paren
(paren
id|s-&gt;dma_adc.dmasize
op_minus
l_int|2
op_star
id|s-&gt;dma_adc.fragsize
)paren
)paren
op_logical_and
id|s-&gt;dma_adc.ready
)paren
(brace
id|s-&gt;enable
op_or_assign
id|SV_CENABLE_RE
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIENABLE
comma
id|s-&gt;enable
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|DMABUF_DEFAULTORDER
mdefine_line|#define DMABUF_DEFAULTORDER (17-PAGE_SHIFT)
DECL|macro|DMABUF_MINORDER
mdefine_line|#define DMABUF_MINORDER 1
DECL|function|dealloc_dmabuf
r_static
r_void
id|dealloc_dmabuf
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_struct
id|dmabuf
op_star
id|db
)paren
(brace
r_struct
id|page
op_star
id|page
comma
op_star
id|pend
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;rawbuf
)paren
(brace
multiline_comment|/* undo marking the pages as reserved */
id|pend
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|page
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
)paren
suffix:semicolon
id|page
op_le
id|pend
suffix:semicolon
id|page
op_increment
)paren
id|mem_map_unreserve
c_func
(paren
id|page
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|s-&gt;dev
comma
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
comma
id|db-&gt;rawbuf
comma
id|db-&gt;dmaaddr
)paren
suffix:semicolon
)brace
id|db-&gt;rawbuf
op_assign
l_int|NULL
suffix:semicolon
id|db-&gt;mapped
op_assign
id|db-&gt;ready
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* DMAA is used for playback, DMAC is used for recording */
DECL|function|prog_dmabuf
r_static
r_int
id|prog_dmabuf
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
id|rec
)paren
(brace
r_struct
id|dmabuf
op_star
id|db
op_assign
id|rec
ques
c_cond
op_amp
id|s-&gt;dma_adc
suffix:colon
op_amp
id|s-&gt;dma_dac
suffix:semicolon
r_int
id|rate
op_assign
id|rec
ques
c_cond
id|s-&gt;rateadc
suffix:colon
id|s-&gt;ratedac
suffix:semicolon
r_int
id|order
suffix:semicolon
r_int
id|bytepersec
suffix:semicolon
r_int
id|bufs
suffix:semicolon
r_struct
id|page
op_star
id|page
comma
op_star
id|pend
suffix:semicolon
r_int
r_char
id|fmt
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|fmt
op_assign
id|s-&gt;fmt
suffix:semicolon
r_if
c_cond
(paren
id|rec
)paren
(brace
id|s-&gt;enable
op_and_assign
op_complement
id|SV_CENABLE_RE
suffix:semicolon
id|fmt
op_rshift_assign
id|SV_CFMT_CSHIFT
suffix:semicolon
)brace
r_else
(brace
id|s-&gt;enable
op_and_assign
op_complement
id|SV_CENABLE_PE
suffix:semicolon
id|fmt
op_rshift_assign
id|SV_CFMT_ASHIFT
suffix:semicolon
)brace
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIENABLE
comma
id|s-&gt;enable
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|fmt
op_and_assign
id|SV_CFMT_MASK
suffix:semicolon
id|db-&gt;hwptr
op_assign
id|db-&gt;swptr
op_assign
id|db-&gt;total_bytes
op_assign
id|db-&gt;count
op_assign
id|db-&gt;error
op_assign
id|db-&gt;endcleared
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;rawbuf
)paren
(brace
id|db-&gt;ready
op_assign
id|db-&gt;mapped
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
id|DMABUF_DEFAULTORDER
suffix:semicolon
id|order
op_ge
id|DMABUF_MINORDER
suffix:semicolon
id|order
op_decrement
)paren
r_if
c_cond
(paren
(paren
id|db-&gt;rawbuf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|s-&gt;dev
comma
id|PAGE_SIZE
op_lshift
id|order
comma
op_amp
id|db-&gt;dmaaddr
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;rawbuf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|db-&gt;buforder
op_assign
id|order
suffix:semicolon
r_if
c_cond
(paren
(paren
id|virt_to_bus
c_func
(paren
id|db-&gt;rawbuf
)paren
op_xor
(paren
id|virt_to_bus
c_func
(paren
id|db-&gt;rawbuf
)paren
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
op_minus
l_int|1
)paren
)paren
op_amp
op_complement
l_int|0xffff
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sv: DMA buffer crosses 64k boundary: busaddr 0x%lx  size %ld&bslash;n&quot;
comma
id|virt_to_bus
c_func
(paren
id|db-&gt;rawbuf
)paren
comma
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|virt_to_bus
c_func
(paren
id|db-&gt;rawbuf
)paren
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
op_minus
l_int|1
)paren
op_amp
op_complement
l_int|0xffffff
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sv: DMA buffer beyond 16MB: busaddr 0x%lx  size %ld&bslash;n&quot;
comma
id|virt_to_bus
c_func
(paren
id|db-&gt;rawbuf
)paren
comma
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
suffix:semicolon
multiline_comment|/* now mark the pages as reserved; otherwise remap_page_range doesn&squot;t do what we want */
id|pend
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|page
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
)paren
suffix:semicolon
id|page
op_le
id|pend
suffix:semicolon
id|page
op_increment
)paren
id|mem_map_reserve
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
id|bytepersec
op_assign
id|rate
op_lshift
id|sample_shift
(braket
id|fmt
)braket
suffix:semicolon
id|bufs
op_assign
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;ossfragshift
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|1000
op_lshift
id|db-&gt;ossfragshift
)paren
OL
id|bytepersec
)paren
id|db-&gt;fragshift
op_assign
id|ld2
c_func
(paren
id|bytepersec
op_div
l_int|1000
)paren
suffix:semicolon
r_else
id|db-&gt;fragshift
op_assign
id|db-&gt;ossfragshift
suffix:semicolon
)brace
r_else
(brace
id|db-&gt;fragshift
op_assign
id|ld2
c_func
(paren
id|bytepersec
op_div
l_int|100
op_div
(paren
id|db-&gt;subdivision
ques
c_cond
id|db-&gt;subdivision
suffix:colon
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;fragshift
OL
l_int|3
)paren
id|db-&gt;fragshift
op_assign
l_int|3
suffix:semicolon
)brace
id|db-&gt;numfrag
op_assign
id|bufs
op_rshift
id|db-&gt;fragshift
suffix:semicolon
r_while
c_loop
(paren
id|db-&gt;numfrag
template_param
l_int|3
)paren
(brace
id|db-&gt;fragshift
op_decrement
suffix:semicolon
id|db-&gt;numfrag
op_assign
id|bufs
op_rshift
id|db-&gt;fragshift
suffix:semicolon
)brace
id|db-&gt;fragsize
op_assign
l_int|1
op_lshift
id|db-&gt;fragshift
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;ossmaxfrags
op_ge
l_int|4
op_logical_and
id|db-&gt;ossmaxfrags
OL
id|db-&gt;numfrag
)paren
id|db-&gt;numfrag
op_assign
id|db-&gt;ossmaxfrags
suffix:semicolon
id|db-&gt;fragsamples
op_assign
id|db-&gt;fragsize
op_rshift
id|sample_shift
(braket
id|fmt
)braket
suffix:semicolon
id|db-&gt;dmasize
op_assign
id|db-&gt;numfrag
op_lshift
id|db-&gt;fragshift
suffix:semicolon
id|memset
c_func
(paren
id|db-&gt;rawbuf
comma
(paren
id|fmt
op_amp
id|SV_CFMT_16BIT
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|0x80
comma
id|db-&gt;dmasize
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rec
)paren
(brace
id|set_dmac
c_func
(paren
id|s
comma
id|db-&gt;dmaaddr
comma
id|db-&gt;numfrag
op_lshift
id|db-&gt;fragshift
)paren
suffix:semicolon
multiline_comment|/* program enhanced mode registers */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIDMACBASECOUNT1
comma
(paren
id|db-&gt;fragsamples
op_minus
l_int|1
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIDMACBASECOUNT0
comma
id|db-&gt;fragsamples
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|set_dmaa
c_func
(paren
id|s
comma
id|db-&gt;dmaaddr
comma
id|db-&gt;numfrag
op_lshift
id|db-&gt;fragshift
)paren
suffix:semicolon
multiline_comment|/* program enhanced mode registers */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIDMAABASECOUNT1
comma
(paren
id|db-&gt;fragsamples
op_minus
l_int|1
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIDMAABASECOUNT0
comma
id|db-&gt;fragsamples
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|db-&gt;ready
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|clear_advance
r_extern
id|__inline__
r_void
id|clear_advance
c_func
(paren
r_struct
id|sv_state
op_star
id|s
)paren
(brace
r_int
r_char
id|c
op_assign
(paren
id|s-&gt;fmt
op_amp
(paren
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_ASHIFT
)paren
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|0x80
suffix:semicolon
r_int
r_char
op_star
id|buf
op_assign
id|s-&gt;dma_dac.rawbuf
suffix:semicolon
r_int
id|bsize
op_assign
id|s-&gt;dma_dac.dmasize
suffix:semicolon
r_int
id|bptr
op_assign
id|s-&gt;dma_dac.swptr
suffix:semicolon
r_int
id|len
op_assign
id|s-&gt;dma_dac.fragsize
suffix:semicolon
r_if
c_cond
(paren
id|bptr
op_plus
id|len
OG
id|bsize
)paren
(brace
r_int
id|x
op_assign
id|bsize
op_minus
id|bptr
suffix:semicolon
id|memset
c_func
(paren
id|buf
op_plus
id|bptr
comma
id|c
comma
id|x
)paren
suffix:semicolon
id|bptr
op_assign
l_int|0
suffix:semicolon
id|len
op_sub_assign
id|x
suffix:semicolon
)brace
id|memset
c_func
(paren
id|buf
op_plus
id|bptr
comma
id|c
comma
id|len
)paren
suffix:semicolon
)brace
multiline_comment|/* call with spinlock held! */
DECL|function|sv_update_ptr
r_static
r_void
id|sv_update_ptr
c_func
(paren
r_struct
id|sv_state
op_star
id|s
)paren
(brace
r_int
id|hwptr
suffix:semicolon
r_int
id|diff
suffix:semicolon
multiline_comment|/* update ADC pointer */
r_if
c_cond
(paren
id|s-&gt;dma_adc.ready
)paren
(brace
id|hwptr
op_assign
(paren
id|s-&gt;dma_adc.dmasize
op_minus
id|get_dmac
c_func
(paren
id|s
)paren
)paren
op_mod
id|s-&gt;dma_adc.dmasize
suffix:semicolon
id|diff
op_assign
(paren
id|s-&gt;dma_adc.dmasize
op_plus
id|hwptr
op_minus
id|s-&gt;dma_adc.hwptr
)paren
op_mod
id|s-&gt;dma_adc.dmasize
suffix:semicolon
id|s-&gt;dma_adc.hwptr
op_assign
id|hwptr
suffix:semicolon
id|s-&gt;dma_adc.total_bytes
op_add_assign
id|diff
suffix:semicolon
id|s-&gt;dma_adc.count
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_adc.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.mapped
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
OG
(paren
r_int
)paren
(paren
id|s-&gt;dma_adc.dmasize
op_minus
(paren
(paren
l_int|3
op_star
id|s-&gt;dma_adc.fragsize
)paren
op_rshift
l_int|1
)paren
)paren
)paren
(brace
id|s-&gt;enable
op_and_assign
op_complement
id|SV_CENABLE_RE
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIENABLE
comma
id|s-&gt;enable
)paren
suffix:semicolon
id|s-&gt;dma_adc.error
op_increment
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* update DAC pointer */
r_if
c_cond
(paren
id|s-&gt;dma_dac.ready
)paren
(brace
id|hwptr
op_assign
(paren
id|s-&gt;dma_dac.dmasize
op_minus
id|get_dmaa
c_func
(paren
id|s
)paren
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
id|diff
op_assign
(paren
id|s-&gt;dma_dac.dmasize
op_plus
id|hwptr
op_minus
id|s-&gt;dma_dac.hwptr
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
id|s-&gt;dma_dac.hwptr
op_assign
id|hwptr
suffix:semicolon
id|s-&gt;dma_dac.total_bytes
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
(brace
id|s-&gt;dma_dac.count
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
)paren
suffix:semicolon
)brace
r_else
(brace
id|s-&gt;dma_dac.count
op_sub_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_le
l_int|0
)paren
(brace
id|s-&gt;enable
op_and_assign
op_complement
id|SV_CENABLE_PE
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIENABLE
comma
id|s-&gt;enable
)paren
suffix:semicolon
id|s-&gt;dma_dac.error
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_le
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
op_logical_and
op_logical_neg
id|s-&gt;dma_dac.endcleared
)paren
(brace
id|clear_advance
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.endcleared
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_plus
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
op_le
(paren
r_int
)paren
id|s-&gt;dma_dac.dmasize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* hold spinlock for the following! */
DECL|function|sv_handle_midi
r_static
r_void
id|sv_handle_midi
c_func
(paren
r_struct
id|sv_state
op_star
id|s
)paren
(brace
r_int
r_char
id|ch
suffix:semicolon
r_int
id|wake
suffix:semicolon
id|wake
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|s-&gt;iomidi
op_plus
l_int|1
)paren
op_amp
l_int|0x80
)paren
)paren
(brace
id|ch
op_assign
id|inb
c_func
(paren
id|s-&gt;iomidi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.icnt
OL
id|MIDIINBUF
)paren
(brace
id|s-&gt;midi.ibuf
(braket
id|s-&gt;midi.iwr
)braket
op_assign
id|ch
suffix:semicolon
id|s-&gt;midi.iwr
op_assign
(paren
id|s-&gt;midi.iwr
op_plus
l_int|1
)paren
op_mod
id|MIDIINBUF
suffix:semicolon
id|s-&gt;midi.icnt
op_increment
suffix:semicolon
)brace
id|wake
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wake
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;midi.iwait
)paren
suffix:semicolon
id|wake
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|s-&gt;iomidi
op_plus
l_int|1
)paren
op_amp
l_int|0x40
)paren
op_logical_and
id|s-&gt;midi.ocnt
OG
l_int|0
)paren
(brace
id|outb
c_func
(paren
id|s-&gt;midi.obuf
(braket
id|s-&gt;midi.ord
)braket
comma
id|s-&gt;iomidi
)paren
suffix:semicolon
id|s-&gt;midi.ord
op_assign
(paren
id|s-&gt;midi.ord
op_plus
l_int|1
)paren
op_mod
id|MIDIOUTBUF
suffix:semicolon
id|s-&gt;midi.ocnt
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.ocnt
OL
id|MIDIOUTBUF
op_minus
l_int|16
)paren
id|wake
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wake
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;midi.owait
)paren
suffix:semicolon
)brace
DECL|function|sv_interrupt
r_static
r_void
id|sv_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|dev_id
suffix:semicolon
r_int
r_int
id|intsrc
suffix:semicolon
multiline_comment|/* fastpath out, to ease interrupt sharing */
id|intsrc
op_assign
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|intsrc
op_amp
(paren
id|SV_CSTAT_DMAA
op_or
id|SV_CSTAT_DMAC
op_or
id|SV_CSTAT_MIDI
)paren
)paren
)paren
r_return
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
id|sv_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|sv_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|sv_midi_timer
r_static
r_void
id|sv_midi_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sv_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;midi.timer.expires
op_assign
id|jiffies
op_plus
l_int|1
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|s-&gt;midi.timer
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|invalid_magic
r_static
r_const
r_char
id|invalid_magic
(braket
)braket
op_assign
id|KERN_CRIT
l_string|&quot;sv: invalid magic value&bslash;n&quot;
suffix:semicolon
DECL|macro|VALIDATE_STATE
mdefine_line|#define VALIDATE_STATE(s)                         &bslash;&n;({                                                &bslash;&n;&t;if (!(s) || (s)-&gt;magic != SV_MAGIC) { &bslash;&n;&t;&t;printk(invalid_magic);            &bslash;&n;&t;&t;return -ENXIO;                    &bslash;&n;&t;}                                         &bslash;&n;})
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|MT_4
mdefine_line|#define MT_4          1
DECL|macro|MT_5MUTE
mdefine_line|#define MT_5MUTE      2
DECL|macro|MT_4MUTEMONO
mdefine_line|#define MT_4MUTEMONO  3
DECL|macro|MT_6MUTE
mdefine_line|#define MT_6MUTE      4
r_static
r_const
r_struct
(brace
DECL|member|left
r_int
id|left
suffix:colon
l_int|5
suffix:semicolon
DECL|member|right
r_int
id|right
suffix:colon
l_int|5
suffix:semicolon
DECL|member|type
r_int
id|type
suffix:colon
l_int|3
suffix:semicolon
DECL|member|rec
r_int
id|rec
suffix:colon
l_int|3
suffix:semicolon
DECL|variable|mixtable
)brace
id|mixtable
(braket
id|SOUND_MIXER_NRDEVICES
)braket
op_assign
(brace
(braket
id|SOUND_MIXER_RECLEV
)braket
op_assign
(brace
id|SV_CIMIX_ADCINL
comma
id|SV_CIMIX_ADCINR
comma
id|MT_4
comma
l_int|0
)brace
comma
(braket
id|SOUND_MIXER_LINE1
)braket
op_assign
(brace
id|SV_CIMIX_AUX1INL
comma
id|SV_CIMIX_AUX1INR
comma
id|MT_5MUTE
comma
l_int|5
)brace
comma
(braket
id|SOUND_MIXER_CD
)braket
op_assign
(brace
id|SV_CIMIX_CDINL
comma
id|SV_CIMIX_CDINR
comma
id|MT_5MUTE
comma
l_int|1
)brace
comma
(braket
id|SOUND_MIXER_LINE
)braket
op_assign
(brace
id|SV_CIMIX_LINEINL
comma
id|SV_CIMIX_LINEINR
comma
id|MT_5MUTE
comma
l_int|4
)brace
comma
(braket
id|SOUND_MIXER_MIC
)braket
op_assign
(brace
id|SV_CIMIX_MICIN
comma
id|SV_CIMIX_ADCINL
comma
id|MT_4MUTEMONO
comma
l_int|6
)brace
comma
(braket
id|SOUND_MIXER_SYNTH
)braket
op_assign
(brace
id|SV_CIMIX_SYNTHINL
comma
id|SV_CIMIX_SYNTHINR
comma
id|MT_5MUTE
comma
l_int|2
)brace
comma
(braket
id|SOUND_MIXER_LINE2
)braket
op_assign
(brace
id|SV_CIMIX_AUX2INL
comma
id|SV_CIMIX_AUX2INR
comma
id|MT_5MUTE
comma
l_int|3
)brace
comma
(braket
id|SOUND_MIXER_VOLUME
)braket
op_assign
(brace
id|SV_CIMIX_ANALOGINL
comma
id|SV_CIMIX_ANALOGINR
comma
id|MT_5MUTE
comma
l_int|7
)brace
comma
(braket
id|SOUND_MIXER_PCM
)braket
op_assign
(brace
id|SV_CIMIX_PCMINL
comma
id|SV_CIMIX_PCMINR
comma
id|MT_6MUTE
comma
l_int|0
)brace
)brace
suffix:semicolon
macro_line|#ifdef OSS_DOCUMENTED_MIXER_SEMANTICS
DECL|function|return_mixval
r_static
r_int
id|return_mixval
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
id|i
comma
r_int
op_star
id|arg
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|l
comma
id|r
comma
id|rl
comma
id|rr
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|l
op_assign
id|rdindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
)paren
suffix:semicolon
id|r
op_assign
id|rdindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|right
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|type
)paren
(brace
r_case
id|MT_4
suffix:colon
id|r
op_and_assign
l_int|0xf
suffix:semicolon
id|l
op_and_assign
l_int|0xf
suffix:semicolon
id|rl
op_assign
l_int|10
op_plus
l_int|6
op_star
(paren
id|l
op_amp
l_int|15
)paren
suffix:semicolon
id|rr
op_assign
l_int|10
op_plus
l_int|6
op_star
(paren
id|r
op_amp
l_int|15
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_4MUTEMONO
suffix:colon
id|rl
op_assign
l_int|55
op_minus
l_int|3
op_star
(paren
id|l
op_amp
l_int|15
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_amp
l_int|0x10
)paren
id|rl
op_add_assign
l_int|45
suffix:semicolon
id|rr
op_assign
id|rl
suffix:semicolon
id|r
op_assign
id|l
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_5MUTE
suffix:colon
r_default
suffix:colon
id|rl
op_assign
l_int|100
op_minus
l_int|3
op_star
(paren
id|l
op_amp
l_int|31
)paren
suffix:semicolon
id|rr
op_assign
l_int|100
op_minus
l_int|3
op_star
(paren
id|r
op_amp
l_int|31
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_6MUTE
suffix:colon
id|rl
op_assign
l_int|100
op_minus
l_int|3
op_star
(paren
id|l
op_amp
l_int|63
)paren
op_div
l_int|2
suffix:semicolon
id|rr
op_assign
l_int|100
op_minus
l_int|3
op_star
(paren
id|r
op_amp
l_int|63
)paren
op_div
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|l
op_amp
l_int|0x80
)paren
id|rl
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|r
op_amp
l_int|0x80
)paren
id|rr
op_assign
l_int|0
suffix:semicolon
r_return
id|put_user
c_func
(paren
(paren
id|rr
op_lshift
l_int|8
)paren
op_or
id|rl
comma
id|arg
)paren
suffix:semicolon
)brace
macro_line|#else /* OSS_DOCUMENTED_MIXER_SEMANTICS */
DECL|variable|volidx
r_static
r_const
r_int
r_char
id|volidx
(braket
id|SOUND_MIXER_NRDEVICES
)braket
op_assign
(brace
(braket
id|SOUND_MIXER_RECLEV
)braket
op_assign
l_int|1
comma
(braket
id|SOUND_MIXER_LINE1
)braket
op_assign
l_int|2
comma
(braket
id|SOUND_MIXER_CD
)braket
op_assign
l_int|3
comma
(braket
id|SOUND_MIXER_LINE
)braket
op_assign
l_int|4
comma
(braket
id|SOUND_MIXER_MIC
)braket
op_assign
l_int|5
comma
(braket
id|SOUND_MIXER_SYNTH
)braket
op_assign
l_int|6
comma
(braket
id|SOUND_MIXER_LINE2
)braket
op_assign
l_int|7
comma
(braket
id|SOUND_MIXER_VOLUME
)braket
op_assign
l_int|8
comma
(braket
id|SOUND_MIXER_PCM
)braket
op_assign
l_int|9
)brace
suffix:semicolon
macro_line|#endif /* OSS_DOCUMENTED_MIXER_SEMANTICS */
DECL|function|mixer_recmask
r_static
r_int
id|mixer_recmask
c_func
(paren
r_struct
id|sv_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|j
op_assign
id|rdindir
c_func
(paren
id|s
comma
id|SV_CIMIX_ADCINL
)paren
op_rshift
l_int|5
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|j
op_and_assign
l_int|7
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
op_logical_and
id|mixtable
(braket
id|i
)braket
dot
id|rec
op_ne
id|j
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_return
l_int|1
op_lshift
id|i
suffix:semicolon
)brace
DECL|function|mixer_ioctl
r_static
r_int
id|mixer_ioctl
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|val
suffix:semicolon
r_int
r_char
id|l
comma
id|r
comma
id|rl
comma
id|rr
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_INFO
)paren
(brace
id|mixer_info
id|info
suffix:semicolon
id|strncpy
c_func
(paren
id|info.id
comma
l_string|&quot;SonicVibes&quot;
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|info.name
comma
l_string|&quot;S3 SonicVibes&quot;
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
id|info.modify_counter
op_assign
id|s-&gt;mix.modcnt
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_OLD_MIXER_INFO
)paren
(brace
id|_old_mixer_info
id|info
suffix:semicolon
id|strncpy
c_func
(paren
id|info.id
comma
l_string|&quot;SonicVibes&quot;
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|info.name
comma
l_string|&quot;S3 SonicVibes&quot;
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|OSS_GETVERSION
)paren
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_PRIVATE1
)paren
(brace
multiline_comment|/* SRS settings */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
l_int|2
)paren
(brace
id|l
op_assign
l_int|4
op_minus
(paren
(paren
id|val
op_rshift
l_int|2
)paren
op_amp
l_int|7
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
op_amp
op_complement
l_int|3
)paren
id|l
op_assign
l_int|4
suffix:semicolon
id|r
op_assign
l_int|4
op_minus
(paren
(paren
id|val
op_rshift
l_int|5
)paren
op_amp
l_int|7
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_amp
op_complement
l_int|3
)paren
id|r
op_assign
l_int|4
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CISRSSPACE
comma
id|l
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CISRSCENTER
comma
id|r
)paren
suffix:semicolon
)brace
r_else
id|wrindir
c_func
(paren
id|s
comma
id|SV_CISRSSPACE
comma
l_int|0x80
)paren
suffix:semicolon
)brace
id|l
op_assign
id|rdindir
c_func
(paren
id|s
comma
id|SV_CISRSSPACE
)paren
suffix:semicolon
id|r
op_assign
id|rdindir
c_func
(paren
id|s
comma
id|SV_CISRSCENTER
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
op_amp
l_int|0x80
)paren
r_return
id|put_user
c_func
(paren
l_int|0
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
(paren
(paren
l_int|4
op_minus
(paren
id|l
op_amp
l_int|7
)paren
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
l_int|4
op_minus
(paren
id|r
op_amp
l_int|7
)paren
)paren
op_lshift
l_int|5
)paren
op_or
l_int|2
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|_IOC_TYPE
c_func
(paren
id|cmd
)paren
op_ne
l_char|&squot;M&squot;
op_logical_or
id|_SIOC_SIZE
c_func
(paren
id|cmd
)paren
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_eq
id|_SIOC_READ
)paren
(brace
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
r_return
id|put_user
c_func
(paren
id|mixer_recmask
c_func
(paren
id|s
)paren
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported device */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|type
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported recording source */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|rec
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
multiline_comment|/* Mixer channels supporting stereo */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|type
op_logical_and
id|mixtable
(braket
id|i
)braket
dot
id|type
op_ne
id|MT_4MUTEMONO
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
r_return
id|put_user
c_func
(paren
id|SOUND_CAP_EXCL_INPUT
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|SOUND_MIXER_NRDEVICES
op_logical_or
op_logical_neg
id|mixtable
(braket
id|i
)braket
dot
id|type
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#ifdef OSS_DOCUMENTED_MIXER_SEMANTICS
r_return
id|return_mixval
c_func
(paren
id|s
comma
id|i
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#else /* OSS_DOCUMENTED_MIXER_SEMANTICS */
r_if
c_cond
(paren
op_logical_neg
id|volidx
(braket
id|i
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
id|volidx
(braket
id|i
)braket
op_minus
l_int|1
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#endif /* OSS_DOCUMENTED_MIXER_SEMANTICS */
)brace
)brace
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_ne
(paren
id|_SIOC_READ
op_or
id|_SIOC_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s-&gt;mix.modcnt
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|i
op_assign
id|hweight32
c_func
(paren
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*val = mixer_recmask(s);*/
r_else
r_if
c_cond
(paren
id|i
OG
l_int|1
)paren
id|val
op_and_assign
op_complement
id|mixer_recmask
c_func
(paren
id|s
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|rec
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mixtable
(braket
id|i
)braket
dot
id|rec
)paren
r_return
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|frobindir
c_func
(paren
id|s
comma
id|SV_CIMIX_ADCINL
comma
l_int|0x1f
comma
id|mixtable
(braket
id|i
)braket
dot
id|rec
op_lshift
l_int|5
)paren
suffix:semicolon
id|frobindir
c_func
(paren
id|s
comma
id|SV_CIMIX_ADCINR
comma
l_int|0x1f
comma
id|mixtable
(braket
id|i
)braket
dot
id|rec
op_lshift
l_int|5
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|SOUND_MIXER_NRDEVICES
op_logical_or
op_logical_neg
id|mixtable
(braket
id|i
)braket
dot
id|type
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|l
op_assign
id|val
op_amp
l_int|0xff
suffix:semicolon
id|r
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|type
op_eq
id|MT_4MUTEMONO
)paren
id|l
op_assign
(paren
id|r
op_plus
id|l
)paren
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|100
)paren
id|l
op_assign
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|r
OG
l_int|100
)paren
id|r
op_assign
l_int|100
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|type
)paren
(brace
r_case
id|MT_4
suffix:colon
r_if
c_cond
(paren
id|l
op_ge
l_int|10
)paren
id|l
op_sub_assign
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|r
op_ge
l_int|10
)paren
id|r
op_sub_assign
l_int|10
suffix:semicolon
id|frobindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
comma
l_int|0xf0
comma
id|l
op_div
l_int|6
)paren
suffix:semicolon
id|frobindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|right
comma
l_int|0xf0
comma
id|l
op_div
l_int|6
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_4MUTEMONO
suffix:colon
id|rr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|l
OL
l_int|10
)paren
id|rl
op_assign
l_int|0x80
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|l
op_ge
l_int|55
)paren
(brace
id|rr
op_assign
l_int|0x10
suffix:semicolon
id|l
op_sub_assign
l_int|45
suffix:semicolon
)brace
id|rl
op_assign
(paren
l_int|55
op_minus
id|l
)paren
op_div
l_int|3
suffix:semicolon
)brace
id|wrindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
comma
id|rl
)paren
suffix:semicolon
id|frobindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|right
comma
op_complement
l_int|0x10
comma
id|rr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_5MUTE
suffix:colon
r_if
c_cond
(paren
id|l
OL
l_int|7
)paren
id|rl
op_assign
l_int|0x80
suffix:semicolon
r_else
id|rl
op_assign
(paren
l_int|100
op_minus
id|l
)paren
op_div
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|r
OL
l_int|7
)paren
id|rr
op_assign
l_int|0x80
suffix:semicolon
r_else
id|rr
op_assign
(paren
l_int|100
op_minus
id|r
)paren
op_div
l_int|3
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
comma
id|rl
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|right
comma
id|rr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_6MUTE
suffix:colon
r_if
c_cond
(paren
id|l
OL
l_int|6
)paren
id|rl
op_assign
l_int|0x80
suffix:semicolon
r_else
id|rl
op_assign
(paren
l_int|100
op_minus
id|l
)paren
op_star
l_int|2
op_div
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|r
OL
l_int|6
)paren
id|rr
op_assign
l_int|0x80
suffix:semicolon
r_else
id|rr
op_assign
(paren
l_int|100
op_minus
id|r
)paren
op_star
l_int|2
op_div
l_int|3
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
comma
id|rl
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|right
comma
id|rr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#ifdef OSS_DOCUMENTED_MIXER_SEMANTICS
r_return
id|return_mixval
c_func
(paren
id|s
comma
id|i
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#else /* OSS_DOCUMENTED_MIXER_SEMANTICS */
r_if
c_cond
(paren
op_logical_neg
id|volidx
(braket
id|i
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s-&gt;mix.vol
(braket
id|volidx
(braket
id|i
)braket
op_minus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
id|volidx
(braket
id|i
)braket
op_minus
l_int|1
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#endif /* OSS_DOCUMENTED_MIXER_SEMANTICS */
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sv_llseek
r_static
id|loff_t
id|sv_llseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|loff_t
id|offset
comma
r_int
id|origin
)paren
(brace
r_return
op_minus
id|ESPIPE
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sv_open_mixdev
r_static
r_int
id|sv_open_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|sv_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|sv_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dev_mixer
op_eq
id|minor
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sv_release_mixdev
r_static
r_int
id|sv_release_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sv_ioctl_mixdev
r_static
r_int
id|sv_ioctl_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|mixer_ioctl
c_func
(paren
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|variable|sv_mixer_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|sv_mixer_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|sv_llseek
comma
id|ioctl
suffix:colon
id|sv_ioctl_mixdev
comma
id|open
suffix:colon
id|sv_open_mixdev
comma
id|release
suffix:colon
id|sv_release_mixdev
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|drain_dac
r_static
r_int
id|drain_dac
c_func
(paren
r_struct
id|sv_state
op_star
id|s
comma
r_int
id|nonblock
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
comma
id|tmo
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
op_logical_or
op_logical_neg
id|s-&gt;dma_dac.ready
)paren
r_return
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|nonblock
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|tmo
op_assign
l_int|3
op_star
id|HZ
op_star
(paren
id|count
op_plus
id|s-&gt;dma_dac.fragsize
)paren
op_div
l_int|2
op_div
id|s-&gt;ratedac
suffix:semicolon
id|tmo
op_rshift_assign
id|sample_shift
(braket
(paren
id|s-&gt;fmt
op_rshift
id|SV_CFMT_ASHIFT
)paren
op_amp
id|SV_CFMT_MASK
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|tmo
op_plus
l_int|1
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sv: dma timed out??&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sv_read
r_static
id|ssize_t
id|sv_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|swptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sv_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#endif
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|swptr
op_assign
id|s-&gt;dma_adc.swptr
suffix:semicolon
id|cnt
op_assign
id|s-&gt;dma_adc.dmasize
op_minus
id|swptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
OL
id|cnt
)paren
id|cnt
op_assign
id|s-&gt;dma_adc.count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|HZ
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sv: read: chip lockup? dmasz %u fragsz %u count %i hwptr %u swptr %u&bslash;n&quot;
comma
id|s-&gt;dma_adc.dmasize
comma
id|s-&gt;dma_adc.fragsize
comma
id|s-&gt;dma_adc.count
comma
id|s-&gt;dma_adc.hwptr
comma
id|s-&gt;dma_adc.swptr
)paren
suffix:semicolon
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|set_dmac
c_func
(paren
id|s
comma
id|virt_to_bus
c_func
(paren
id|s-&gt;dma_adc.rawbuf
)paren
comma
id|s-&gt;dma_adc.numfrag
op_lshift
id|s-&gt;dma_adc.fragshift
)paren
suffix:semicolon
multiline_comment|/* program enhanced mode registers */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIDMACBASECOUNT1
comma
(paren
id|s-&gt;dma_adc.fragsamples
op_minus
l_int|1
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIDMACBASECOUNT0
comma
id|s-&gt;dma_adc.fragsamples
op_minus
l_int|1
)paren
suffix:semicolon
id|s-&gt;dma_adc.count
op_assign
id|s-&gt;dma_adc.hwptr
op_assign
id|s-&gt;dma_adc.swptr
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|s-&gt;dma_adc.rawbuf
op_plus
id|swptr
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_adc.dmasize
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;dma_adc.swptr
op_assign
id|swptr
suffix:semicolon
id|s-&gt;dma_adc.count
op_sub_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sv_write
r_static
id|ssize_t
id|sv_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|swptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sv_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#endif
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
OL
l_int|0
)paren
(brace
id|s-&gt;dma_dac.count
op_assign
l_int|0
suffix:semicolon
id|s-&gt;dma_dac.swptr
op_assign
id|s-&gt;dma_dac.hwptr
suffix:semicolon
)brace
id|swptr
op_assign
id|s-&gt;dma_dac.swptr
suffix:semicolon
id|cnt
op_assign
id|s-&gt;dma_dac.dmasize
op_minus
id|swptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_plus
id|cnt
OG
id|s-&gt;dma_dac.dmasize
)paren
id|cnt
op_assign
id|s-&gt;dma_dac.dmasize
op_minus
id|s-&gt;dma_dac.count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
id|start_dac
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|HZ
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sv: write: chip lockup? dmasz %u fragsz %u count %i hwptr %u swptr %u&bslash;n&quot;
comma
id|s-&gt;dma_dac.dmasize
comma
id|s-&gt;dma_dac.fragsize
comma
id|s-&gt;dma_dac.count
comma
id|s-&gt;dma_dac.hwptr
comma
id|s-&gt;dma_dac.swptr
)paren
suffix:semicolon
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|set_dmaa
c_func
(paren
id|s
comma
id|virt_to_bus
c_func
(paren
id|s-&gt;dma_dac.rawbuf
)paren
comma
id|s-&gt;dma_dac.numfrag
op_lshift
id|s-&gt;dma_dac.fragshift
)paren
suffix:semicolon
multiline_comment|/* program enhanced mode registers */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIDMAABASECOUNT1
comma
(paren
id|s-&gt;dma_dac.fragsamples
op_minus
l_int|1
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIDMAABASECOUNT0
comma
id|s-&gt;dma_dac.fragsamples
op_minus
l_int|1
)paren
suffix:semicolon
id|s-&gt;dma_dac.count
op_assign
id|s-&gt;dma_dac.hwptr
op_assign
id|s-&gt;dma_dac.swptr
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|s-&gt;dma_dac.rawbuf
op_plus
id|swptr
comma
id|buffer
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;dma_dac.swptr
op_assign
id|swptr
suffix:semicolon
id|s-&gt;dma_dac.count
op_add_assign
id|cnt
suffix:semicolon
id|s-&gt;dma_dac.endcleared
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
id|start_dac
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* No kernel lock - we have our own spinlock */
DECL|function|sv_poll
r_static
r_int
r_int
id|sv_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;dma_dac.wait
comma
id|wait
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;dma_adc.wait
comma
id|wait
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sv_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_adc.fragsize
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|s-&gt;dma_dac.dmasize
op_ge
id|s-&gt;dma_dac.count
op_plus
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|sv_mmap
r_static
r_int
id|sv_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmabuf
op_star
id|db
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|db
op_assign
op_amp
id|s-&gt;dma_dac
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_READ
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|db
op_assign
op_amp
id|s-&gt;dma_adc
suffix:semicolon
)brace
r_else
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|vma-&gt;vm_start
comma
id|virt_to_phys
c_func
(paren
id|db-&gt;rawbuf
)paren
comma
id|size
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_goto
id|out
suffix:semicolon
id|db-&gt;mapped
op_assign
l_int|1
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sv_ioctl
r_static
r_int
id|sv_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|audio_buf_info
id|abinfo
suffix:semicolon
id|count_info
id|cinfo
suffix:semicolon
r_int
id|count
suffix:semicolon
r_int
id|val
comma
id|mapped
comma
id|ret
suffix:semicolon
r_int
r_char
id|fmtm
comma
id|fmtd
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|mapped
op_assign
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
op_logical_and
id|s-&gt;dma_dac.mapped
)paren
op_logical_or
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
op_logical_and
id|s-&gt;dma_adc.mapped
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|OSS_GETVERSION
suffix:colon
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
r_return
id|drain_dac
c_func
(paren
id|s
comma
l_int|0
multiline_comment|/*file-&gt;f_flags &amp; O_NONBLOCK*/
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SETDUPLEX
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETCAPS
suffix:colon
r_return
id|put_user
c_func
(paren
id|DSP_CAP_DUPLEX
op_or
id|DSP_CAP_REALTIME
op_or
id|DSP_CAP_TRIGGER
op_or
id|DSP_CAP_MMAP
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_RESET
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|s-&gt;dma_dac.swptr
op_assign
id|s-&gt;dma_dac.hwptr
op_assign
id|s-&gt;dma_dac.count
op_assign
id|s-&gt;dma_dac.total_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|s-&gt;dma_adc.swptr
op_assign
id|s-&gt;dma_adc.hwptr
op_assign
id|s-&gt;dma_adc.count
op_assign
id|s-&gt;dma_adc.total_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
id|set_adc_rate
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
id|set_dac_rate
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
)brace
)brace
r_return
id|put_user
c_func
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|s-&gt;rateadc
suffix:colon
id|s-&gt;ratedac
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|fmtd
op_assign
l_int|0
suffix:semicolon
id|fmtm
op_assign
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|fmtd
op_or_assign
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_CSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_CSHIFT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|fmtd
op_or_assign
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_ASHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_ASHIFT
)paren
suffix:semicolon
)brace
id|set_fmt
c_func
(paren
id|s
comma
id|fmtm
comma
id|fmtd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_CHANNELS
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|0
)paren
(brace
id|fmtd
op_assign
l_int|0
suffix:semicolon
id|fmtm
op_assign
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|2
)paren
id|fmtd
op_or_assign
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_CSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_CSHIFT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|2
)paren
id|fmtd
op_or_assign
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_ASHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_ASHIFT
)paren
suffix:semicolon
)brace
id|set_fmt
c_func
(paren
id|s
comma
id|fmtm
comma
id|fmtd
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;fmt
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
(paren
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_CSHIFT
)paren
suffix:colon
(paren
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_ASHIFT
)paren
)paren
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETFMTS
suffix:colon
multiline_comment|/* Returns a mask */
r_return
id|put_user
c_func
(paren
id|AFMT_S16_LE
op_or
id|AFMT_U8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFMT
suffix:colon
multiline_comment|/* Selects ONE fmt*/
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|AFMT_QUERY
)paren
(brace
id|fmtd
op_assign
l_int|0
suffix:semicolon
id|fmtm
op_assign
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_S16_LE
)paren
id|fmtd
op_or_assign
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_CSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_CSHIFT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_S16_LE
)paren
id|fmtd
op_or_assign
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_ASHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_ASHIFT
)paren
suffix:semicolon
)brace
id|set_fmt
c_func
(paren
id|s
comma
id|fmtm
comma
id|fmtd
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;fmt
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
(paren
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_CSHIFT
)paren
suffix:colon
(paren
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_ASHIFT
)paren
)paren
)paren
ques
c_cond
id|AFMT_S16_LE
suffix:colon
id|AFMT_U8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_POST
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETTRIGGER
suffix:colon
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
id|s-&gt;enable
op_amp
id|SV_CENABLE_RE
)paren
id|val
op_or_assign
id|PCM_ENABLE_INPUT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
id|s-&gt;enable
op_amp
id|SV_CENABLE_PE
)paren
id|val
op_or_assign
id|PCM_ENABLE_OUTPUT
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETTRIGGER
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_INPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_else
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_OUTPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|start_dac
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_else
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOSPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sv_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|s-&gt;dma_dac.fragsize
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|abinfo.bytes
op_assign
id|s-&gt;dma_dac.dmasize
op_minus
id|count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|s-&gt;dma_dac.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|s-&gt;dma_dac.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETISPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sv_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|s-&gt;dma_adc.fragsize
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_adc.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|abinfo.bytes
op_assign
id|count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|s-&gt;dma_adc.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|s-&gt;dma_adc.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_NONBLOCK
suffix:colon
id|file-&gt;f_flags
op_or_assign
id|O_NONBLOCK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETODELAY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sv_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|count
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETIPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sv_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|s-&gt;dma_adc.total_bytes
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_adc.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|cinfo.blocks
op_assign
id|count
op_rshift
id|s-&gt;dma_adc.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|s-&gt;dma_adc.hwptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
id|s-&gt;dma_adc.count
op_and_assign
id|s-&gt;dma_adc.fragsize
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sv_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|s-&gt;dma_dac.total_bytes
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|cinfo.blocks
op_assign
id|count
op_rshift
id|s-&gt;dma_dac.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|s-&gt;dma_dac.hwptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
id|s-&gt;dma_dac.count
op_and_assign
id|s-&gt;dma_dac.fragsize
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;dma_dac.fragsize
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;dma_adc.fragsize
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|s-&gt;dma_adc.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|s-&gt;dma_adc.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossfragshift
OL
l_int|4
)paren
id|s-&gt;dma_adc.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossfragshift
OG
l_int|15
)paren
id|s-&gt;dma_adc.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossmaxfrags
OL
l_int|4
)paren
id|s-&gt;dma_adc.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|s-&gt;dma_dac.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|s-&gt;dma_dac.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.ossfragshift
OL
l_int|4
)paren
id|s-&gt;dma_dac.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.ossfragshift
OG
l_int|15
)paren
id|s-&gt;dma_dac.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.ossmaxfrags
OL
l_int|4
)paren
id|s-&gt;dma_dac.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
r_if
c_cond
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
id|s-&gt;dma_adc.subdivision
)paren
op_logical_or
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
id|s-&gt;dma_dac.subdivision
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|1
op_logical_and
id|val
op_ne
l_int|2
op_logical_and
id|val
op_ne
l_int|4
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|s-&gt;dma_adc.subdivision
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|s-&gt;dma_dac.subdivision
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_PCM_READ_RATE
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|s-&gt;rateadc
suffix:colon
id|s-&gt;ratedac
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_CHANNELS
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;fmt
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
(paren
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_CSHIFT
)paren
suffix:colon
(paren
id|SV_CFMT_STEREO
op_lshift
id|SV_CFMT_ASHIFT
)paren
)paren
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_BITS
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;fmt
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
(paren
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_CSHIFT
)paren
suffix:colon
(paren
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_ASHIFT
)paren
)paren
)paren
ques
c_cond
l_int|16
suffix:colon
l_int|8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_WRITE_FILTER
suffix:colon
r_case
id|SNDCTL_DSP_SETSYNCRO
suffix:colon
r_case
id|SOUND_PCM_READ_FILTER
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|mixer_ioctl
c_func
(paren
id|s
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|sv_open
r_static
r_int
id|sv_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_char
id|fmtm
op_assign
op_complement
l_int|0
comma
id|fmts
op_assign
l_int|0
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|sv_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|sv_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|s-&gt;dev_audio
op_xor
id|minor
)paren
op_amp
op_complement
l_int|0xf
)paren
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
multiline_comment|/* wait for device to become free */
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;open_mode
op_amp
id|file-&gt;f_mode
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|fmtm
op_and_assign
op_complement
(paren
(paren
id|SV_CFMT_STEREO
op_or
id|SV_CFMT_16BIT
)paren
op_lshift
id|SV_CFMT_CSHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|minor
op_amp
l_int|0xf
)paren
op_eq
id|SND_DEV_DSP16
)paren
id|fmts
op_or_assign
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_CSHIFT
suffix:semicolon
id|s-&gt;dma_adc.ossfragshift
op_assign
id|s-&gt;dma_adc.ossmaxfrags
op_assign
id|s-&gt;dma_adc.subdivision
op_assign
l_int|0
suffix:semicolon
id|set_adc_rate
c_func
(paren
id|s
comma
l_int|8000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|fmtm
op_and_assign
op_complement
(paren
(paren
id|SV_CFMT_STEREO
op_or
id|SV_CFMT_16BIT
)paren
op_lshift
id|SV_CFMT_ASHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|minor
op_amp
l_int|0xf
)paren
op_eq
id|SND_DEV_DSP16
)paren
id|fmts
op_or_assign
id|SV_CFMT_16BIT
op_lshift
id|SV_CFMT_ASHIFT
suffix:semicolon
id|s-&gt;dma_dac.ossfragshift
op_assign
id|s-&gt;dma_dac.ossmaxfrags
op_assign
id|s-&gt;dma_dac.subdivision
op_assign
l_int|0
suffix:semicolon
id|set_dac_rate
c_func
(paren
id|s
comma
l_int|8000
)paren
suffix:semicolon
)brace
id|set_fmt
c_func
(paren
id|s
comma
id|fmtm
comma
id|fmts
)paren
suffix:semicolon
id|s-&gt;open_mode
op_or_assign
id|file-&gt;f_mode
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sv_release
r_static
r_int
id|sv_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|drain_dac
c_func
(paren
id|s
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|dealloc_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_dac
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|dealloc_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_adc
)paren
suffix:semicolon
)brace
id|s-&gt;open_mode
op_and_assign
(paren
op_complement
id|file-&gt;f_mode
)paren
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sv_audio_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|sv_audio_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|sv_llseek
comma
id|read
suffix:colon
id|sv_read
comma
id|write
suffix:colon
id|sv_write
comma
id|poll
suffix:colon
id|sv_poll
comma
id|ioctl
suffix:colon
id|sv_ioctl
comma
id|mmap
suffix:colon
id|sv_mmap
comma
id|open
suffix:colon
id|sv_open
comma
id|release
suffix:colon
id|sv_release
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sv_midi_read
r_static
id|ssize_t
id|sv_midi_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.iwait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ptr
op_assign
id|s-&gt;midi.ird
suffix:semicolon
id|cnt
op_assign
id|MIDIINBUF
op_minus
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.icnt
OL
id|cnt
)paren
id|cnt
op_assign
id|s-&gt;midi.icnt
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|s-&gt;midi.ibuf
op_plus
id|ptr
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ptr
op_assign
(paren
id|ptr
op_plus
id|cnt
)paren
op_mod
id|MIDIINBUF
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;midi.ird
op_assign
id|ptr
suffix:semicolon
id|s-&gt;midi.icnt
op_sub_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
r_break
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.iwait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sv_midi_write
r_static
id|ssize_t
id|sv_midi_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ptr
op_assign
id|s-&gt;midi.owr
suffix:semicolon
id|cnt
op_assign
id|MIDIOUTBUF
op_minus
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.ocnt
op_plus
id|cnt
OG
id|MIDIOUTBUF
)paren
id|cnt
op_assign
id|MIDIOUTBUF
op_minus
id|s-&gt;midi.ocnt
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|sv_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|s-&gt;midi.obuf
op_plus
id|ptr
comma
id|buffer
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ptr
op_assign
(paren
id|ptr
op_plus
id|cnt
)paren
op_mod
id|MIDIOUTBUF
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;midi.owr
op_assign
id|ptr
suffix:semicolon
id|s-&gt;midi.ocnt
op_add_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sv_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* No kernel lock - we have our own spinlock */
DECL|function|sv_midi_poll
r_static
r_int
r_int
id|sv_midi_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;midi.owait
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;midi.iwait
comma
id|wait
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;midi.icnt
OG
l_int|0
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;midi.ocnt
OL
id|MIDIOUTBUF
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|sv_midi_open
r_static
r_int
id|sv_midi_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|sv_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|sv_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dev_midi
op_eq
id|minor
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
multiline_comment|/* wait for device to become free */
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;open_mode
op_amp
(paren
id|file-&gt;f_mode
op_lshift
id|FMODE_MIDI_SHIFT
)paren
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;open_mode
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
)paren
)paren
(brace
id|s-&gt;midi.ird
op_assign
id|s-&gt;midi.iwr
op_assign
id|s-&gt;midi.icnt
op_assign
l_int|0
suffix:semicolon
id|s-&gt;midi.ord
op_assign
id|s-&gt;midi.owr
op_assign
id|s-&gt;midi.ocnt
op_assign
l_int|0
suffix:semicolon
singleline_comment|//outb(inb(s-&gt;ioenh + SV_CODEC_CONTROL) | SV_CCTRL_WAVETABLE, s-&gt;ioenh + SV_CODEC_CONTROL);
id|outb
c_func
(paren
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_INTMASK
)paren
op_or
id|SV_CINTMASK_MIDI
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_INTMASK
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIUARTCONTROL
comma
l_int|5
)paren
suffix:semicolon
multiline_comment|/* output MIDI data to external and internal synth */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIWAVETABLESRC
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Wavetable in PC RAM */
id|outb
c_func
(paren
l_int|0xff
comma
id|s-&gt;iomidi
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* reset command */
id|outb
c_func
(paren
l_int|0x3f
comma
id|s-&gt;iomidi
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* uart command */
r_if
c_cond
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|s-&gt;iomidi
op_plus
l_int|1
)paren
op_amp
l_int|0x80
)paren
)paren
id|inb
c_func
(paren
id|s-&gt;iomidi
)paren
suffix:semicolon
id|s-&gt;midi.ird
op_assign
id|s-&gt;midi.iwr
op_assign
id|s-&gt;midi.icnt
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|s-&gt;midi.timer
)paren
suffix:semicolon
id|s-&gt;midi.timer.expires
op_assign
id|jiffies
op_plus
l_int|1
suffix:semicolon
id|s-&gt;midi.timer.data
op_assign
(paren
r_int
r_int
)paren
id|s
suffix:semicolon
id|s-&gt;midi.timer.function
op_assign
id|sv_midi_timer
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|s-&gt;midi.timer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|s-&gt;midi.ird
op_assign
id|s-&gt;midi.iwr
op_assign
id|s-&gt;midi.icnt
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|s-&gt;midi.ord
op_assign
id|s-&gt;midi.owr
op_assign
id|s-&gt;midi.ocnt
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;open_mode
op_or_assign
(paren
id|file-&gt;f_mode
op_lshift
id|FMODE_MIDI_SHIFT
)paren
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sv_midi_release
r_static
r_int
id|sv_midi_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
comma
id|tmo
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;midi.ocnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|tmo
op_assign
(paren
id|count
op_star
id|HZ
)paren
op_div
l_int|3100
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|tmo
ques
c_cond
suffix:colon
l_int|1
)paren
op_logical_and
id|tmo
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sv: midi timed out??&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|s-&gt;open_mode
op_and_assign
(paren
op_complement
(paren
id|file-&gt;f_mode
op_lshift
id|FMODE_MIDI_SHIFT
)paren
)paren
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;open_mode
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
)paren
)paren
(brace
id|outb
c_func
(paren
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_INTMASK
)paren
op_amp
op_complement
id|SV_CINTMASK_MIDI
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_INTMASK
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|s-&gt;midi.timer
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sv_midi_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|sv_midi_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|sv_llseek
comma
id|read
suffix:colon
id|sv_midi_read
comma
id|write
suffix:colon
id|sv_midi_write
comma
id|poll
suffix:colon
id|sv_midi_poll
comma
id|open
suffix:colon
id|sv_midi_open
comma
id|release
suffix:colon
id|sv_midi_release
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|sv_dmfm_ioctl
r_static
r_int
id|sv_dmfm_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_static
r_const
r_int
r_char
id|op_offset
(braket
l_int|18
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x08
comma
l_int|0x09
comma
l_int|0x0A
comma
l_int|0x0B
comma
l_int|0x0C
comma
l_int|0x0D
comma
l_int|0x10
comma
l_int|0x11
comma
l_int|0x12
comma
l_int|0x13
comma
l_int|0x14
comma
l_int|0x15
)brace
suffix:semicolon
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dm_fm_voice
id|v
suffix:semicolon
r_struct
id|dm_fm_note
id|n
suffix:semicolon
r_struct
id|dm_fm_params
id|p
suffix:semicolon
r_int
r_int
id|io
suffix:semicolon
r_int
r_int
id|regb
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FM_IOCTL_RESET
suffix:colon
r_for
c_loop
(paren
id|regb
op_assign
l_int|0xb0
suffix:semicolon
id|regb
OL
l_int|0xb9
suffix:semicolon
id|regb
op_increment
)paren
(brace
id|outb
c_func
(paren
id|regb
comma
id|s-&gt;iosynth
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iosynth
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
id|regb
comma
id|s-&gt;iosynth
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iosynth
op_plus
l_int|3
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|FM_IOCTL_PLAY_NOTE
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|n
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|n
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|n.voice
op_ge
l_int|18
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|n.voice
op_ge
l_int|9
)paren
(brace
id|regb
op_assign
id|n.voice
op_minus
l_int|9
suffix:semicolon
id|io
op_assign
id|s-&gt;iosynth
op_plus
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|regb
op_assign
id|n.voice
suffix:semicolon
id|io
op_assign
id|s-&gt;iosynth
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0xa0
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
id|n.fnum
op_amp
l_int|0xff
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xb0
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|n.fnum
op_rshift
l_int|8
)paren
op_amp
l_int|3
)paren
op_or
(paren
(paren
id|n.octave
op_amp
l_int|7
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|n.key_on
op_amp
l_int|1
)paren
op_lshift
l_int|5
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FM_IOCTL_SET_VOICE
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|v.voice
op_ge
l_int|18
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|regb
op_assign
id|op_offset
(braket
id|v.voice
)braket
suffix:semicolon
id|io
op_assign
id|s-&gt;iosynth
op_plus
(paren
(paren
id|v.op
op_amp
l_int|1
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|v.am
op_amp
l_int|1
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|v.vibrato
op_amp
l_int|1
)paren
op_lshift
l_int|6
)paren
op_or
(paren
(paren
id|v.do_sustain
op_amp
l_int|1
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|v.kbd_scale
op_amp
l_int|1
)paren
op_lshift
l_int|4
)paren
op_or
(paren
id|v.harmonic
op_amp
l_int|0xf
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x40
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|v.scale_level
op_amp
l_int|0x3
)paren
op_lshift
l_int|6
)paren
op_or
(paren
id|v.volume
op_amp
l_int|0x3f
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x60
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|v.attack
op_amp
l_int|0xf
)paren
op_lshift
l_int|4
)paren
op_or
(paren
id|v.decay
op_amp
l_int|0xf
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x80
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|v.sustain
op_amp
l_int|0xf
)paren
op_lshift
l_int|4
)paren
op_or
(paren
id|v.release
op_amp
l_int|0xf
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xe0
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
id|v.waveform
op_amp
l_int|0x7
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n.voice
op_ge
l_int|9
)paren
(brace
id|regb
op_assign
id|n.voice
op_minus
l_int|9
suffix:semicolon
id|io
op_assign
id|s-&gt;iosynth
op_plus
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|regb
op_assign
id|n.voice
suffix:semicolon
id|io
op_assign
id|s-&gt;iosynth
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0xc0
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|v.right
op_amp
l_int|1
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|v.left
op_amp
l_int|1
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|v.feedback
op_amp
l_int|7
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|v.connection
op_amp
l_int|1
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FM_IOCTL_SET_PARAMS
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|p
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|s-&gt;iosynth
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|p.kbd_split
op_amp
l_int|1
)paren
op_lshift
l_int|6
comma
id|s-&gt;iosynth
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xbd
comma
id|s-&gt;iosynth
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|p.am_depth
op_amp
l_int|1
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|p.vib_depth
op_amp
l_int|1
)paren
op_lshift
l_int|6
)paren
op_or
(paren
(paren
id|p.rhythm
op_amp
l_int|1
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|p.bass
op_amp
l_int|1
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|p.snare
op_amp
l_int|1
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|p.tomtom
op_amp
l_int|1
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|p.cymbal
op_amp
l_int|1
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|p.hihat
op_amp
l_int|1
)paren
comma
id|s-&gt;iosynth
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FM_IOCTL_SET_OPL
suffix:colon
id|outb
c_func
(paren
l_int|4
comma
id|s-&gt;iosynth
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
id|arg
comma
id|s-&gt;iosynth
op_plus
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FM_IOCTL_SET_MODE
suffix:colon
id|outb
c_func
(paren
l_int|5
comma
id|s-&gt;iosynth
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
id|arg
op_amp
l_int|1
comma
id|s-&gt;iosynth
op_plus
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|function|sv_dmfm_open
r_static
r_int
id|sv_dmfm_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|sv_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|sv_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dev_dmfm
op_eq
id|minor
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
multiline_comment|/* wait for device to become free */
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;open_mode
op_amp
id|FMODE_DMFM
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
)brace
multiline_comment|/* init the stuff */
id|outb
c_func
(paren
l_int|1
comma
id|s-&gt;iosynth
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|s-&gt;iosynth
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* enable waveforms */
id|outb
c_func
(paren
l_int|4
comma
id|s-&gt;iosynth
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iosynth
op_plus
l_int|3
)paren
suffix:semicolon
multiline_comment|/* no 4op enabled */
id|outb
c_func
(paren
l_int|5
comma
id|s-&gt;iosynth
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
id|s-&gt;iosynth
op_plus
l_int|3
)paren
suffix:semicolon
multiline_comment|/* enable OPL3 */
id|s-&gt;open_mode
op_or_assign
id|FMODE_DMFM
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sv_dmfm_release
r_static
r_int
id|sv_dmfm_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
(paren
r_struct
id|sv_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|regb
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|s-&gt;open_mode
op_and_assign
op_complement
id|FMODE_DMFM
suffix:semicolon
r_for
c_loop
(paren
id|regb
op_assign
l_int|0xb0
suffix:semicolon
id|regb
OL
l_int|0xb9
suffix:semicolon
id|regb
op_increment
)paren
(brace
id|outb
c_func
(paren
id|regb
comma
id|s-&gt;iosynth
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iosynth
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
id|regb
comma
id|s-&gt;iosynth
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iosynth
op_plus
l_int|3
)paren
suffix:semicolon
)brace
id|wake_up
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sv_dmfm_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|sv_dmfm_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|sv_llseek
comma
id|ioctl
suffix:colon
id|sv_dmfm_ioctl
comma
id|open
suffix:colon
id|sv_dmfm_open
comma
id|release
suffix:colon
id|sv_dmfm_release
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/* maximum number of devices; only used for command line params */
DECL|macro|NR_DEVICE
mdefine_line|#define NR_DEVICE 5
DECL|variable|reverb
r_static
r_int
id|reverb
(braket
id|NR_DEVICE
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
macro_line|#if 0
r_static
r_int
id|wavetable
(braket
id|NR_DEVICE
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|devindex
r_static
r_int
r_int
id|devindex
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|reverb
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_DEVICE
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|reverb
comma
l_string|&quot;if 1 enables the reverb circuitry. NOTE: your card must have the reverb RAM&quot;
)paren
suffix:semicolon
macro_line|#if 0
id|MODULE_PARM
c_func
(paren
id|wavetable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_DEVICE
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|wavetable
comma
l_string|&quot;if 1 the wavetable synth is enabled&quot;
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Thomas M. Sailer, sailer@ife.ee.ethz.ch, hb9jnx@hb9w.che.eu&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;S3 SonicVibes Driver&quot;
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|struct|initvol
r_static
r_struct
id|initvol
(brace
DECL|member|mixch
r_int
id|mixch
suffix:semicolon
DECL|member|vol
r_int
id|vol
suffix:semicolon
DECL|variable|__initdata
)brace
id|initvol
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|SOUND_MIXER_WRITE_RECLEV
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE1
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_CD
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_MIC
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_SYNTH
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE2
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_VOLUME
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_PCM
comma
l_int|0x4040
)brace
)brace
suffix:semicolon
DECL|macro|RSRCISIOREGION
mdefine_line|#define RSRCISIOREGION(dev,num) (pci_resource_start((dev), (num)) != 0 &amp;&amp; &bslash;&n;&t;&t;&t;&t; (pci_resource_flags((dev), (num)) &amp; IORESOURCE_IO))
DECL|function|sv_probe
r_static
r_int
id|__devinit
id|sv_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pcidev
comma
r_const
r_struct
id|pci_device_id
op_star
id|pciid
)paren
(brace
r_static
r_const
r_char
id|__initdata
id|sv_ddma_name
(braket
)braket
op_assign
l_string|&quot;S3 Inc. SonicVibes DDMA Controller&quot;
suffix:semicolon
r_struct
id|sv_state
op_star
id|s
suffix:semicolon
id|mm_segment_t
id|fs
suffix:semicolon
r_int
id|i
comma
id|val
suffix:semicolon
r_char
op_star
id|ddmaname
suffix:semicolon
r_int
id|ddmanamelen
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
id|RESOURCE_SB
)paren
op_logical_or
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
id|RESOURCE_ENH
)paren
op_logical_or
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
id|RESOURCE_SYNTH
)paren
op_logical_or
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
id|RESOURCE_MIDI
)paren
op_logical_or
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
id|RESOURCE_GAME
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pcidev-&gt;irq
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_dma_supported
c_func
(paren
id|pcidev
comma
l_int|0x00ffffff
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sonicvibes: architecture does not support 24bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* try to allocate a DDMA resource if not already available */
r_if
c_cond
(paren
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
id|RESOURCE_DDMA
)paren
)paren
(brace
id|pcidev-&gt;resource
(braket
id|RESOURCE_DDMA
)braket
dot
id|start
op_assign
l_int|0
suffix:semicolon
id|pcidev-&gt;resource
(braket
id|RESOURCE_DDMA
)braket
dot
id|end
op_assign
l_int|2
op_star
id|SV_EXTENT_DMA
op_minus
l_int|1
suffix:semicolon
id|pcidev-&gt;resource
(braket
id|RESOURCE_DDMA
)braket
dot
id|flags
op_assign
id|PCI_BASE_ADDRESS_SPACE_IO
op_or
id|IORESOURCE_IO
suffix:semicolon
id|ddmanamelen
op_assign
id|strlen
c_func
(paren
id|sv_ddma_name
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ddmaname
op_assign
id|kmalloc
c_func
(paren
id|ddmanamelen
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|ddmaname
comma
id|sv_ddma_name
comma
id|ddmanamelen
)paren
suffix:semicolon
id|pcidev-&gt;resource
(braket
id|RESOURCE_DDMA
)braket
dot
id|name
op_assign
id|ddmaname
suffix:semicolon
r_if
c_cond
(paren
id|pci_assign_resource
c_func
(paren
id|pcidev
comma
id|RESOURCE_DDMA
)paren
)paren
(brace
id|pcidev-&gt;resource
(braket
id|RESOURCE_DDMA
)braket
dot
id|name
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|ddmaname
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sv: cannot allocate DDMA controller io ports&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|sv_state
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sv: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|sv_state
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;midi.iwait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;midi.owait
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
id|s-&gt;magic
op_assign
id|SV_MAGIC
suffix:semicolon
id|s-&gt;dev
op_assign
id|pcidev
suffix:semicolon
id|s-&gt;iosb
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
id|RESOURCE_SB
)paren
suffix:semicolon
id|s-&gt;ioenh
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
id|RESOURCE_ENH
)paren
suffix:semicolon
id|s-&gt;iosynth
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
id|RESOURCE_SYNTH
)paren
suffix:semicolon
id|s-&gt;iomidi
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
id|RESOURCE_MIDI
)paren
suffix:semicolon
id|s-&gt;iogame
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
id|RESOURCE_GAME
)paren
suffix:semicolon
id|s-&gt;iodmaa
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
id|RESOURCE_DDMA
)paren
suffix:semicolon
id|s-&gt;iodmac
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
id|RESOURCE_DDMA
)paren
op_plus
id|SV_EXTENT_DMA
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pcidev
comma
l_int|0x40
comma
id|s-&gt;iodmaa
op_or
l_int|9
)paren
suffix:semicolon
multiline_comment|/* enable and use extended mode */
id|pci_write_config_dword
c_func
(paren
id|pcidev
comma
l_int|0x48
comma
id|s-&gt;iodmac
op_or
l_int|9
)paren
suffix:semicolon
multiline_comment|/* enable */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sv: io ports: %#lx %#lx %#lx %#lx %#lx %#x %#x&bslash;n&quot;
comma
id|s-&gt;iosb
comma
id|s-&gt;ioenh
comma
id|s-&gt;iosynth
comma
id|s-&gt;iomidi
comma
id|s-&gt;iogame
comma
id|s-&gt;iodmaa
comma
id|s-&gt;iodmac
)paren
suffix:semicolon
id|s-&gt;irq
op_assign
id|pcidev-&gt;irq
suffix:semicolon
multiline_comment|/* hack */
id|pci_write_config_dword
c_func
(paren
id|pcidev
comma
l_int|0x60
comma
id|wavetable_mem
op_rshift
l_int|12
)paren
suffix:semicolon
multiline_comment|/* wavetable base address */
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;ioenh
comma
id|SV_EXTENT_ENH
comma
l_string|&quot;S3 SonicVibes PCM&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sv: io ports %#lx-%#lx in use&bslash;n&quot;
comma
id|s-&gt;ioenh
comma
id|s-&gt;ioenh
op_plus
id|SV_EXTENT_ENH
op_minus
l_int|1
)paren
suffix:semicolon
r_goto
id|err_region5
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;iodmaa
comma
id|SV_EXTENT_DMA
comma
l_string|&quot;S3 SonicVibes DMAA&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sv: io ports %#x-%#x in use&bslash;n&quot;
comma
id|s-&gt;iodmaa
comma
id|s-&gt;iodmaa
op_plus
id|SV_EXTENT_DMA
op_minus
l_int|1
)paren
suffix:semicolon
r_goto
id|err_region4
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;iodmac
comma
id|SV_EXTENT_DMA
comma
l_string|&quot;S3 SonicVibes DMAC&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sv: io ports %#x-%#x in use&bslash;n&quot;
comma
id|s-&gt;iodmac
comma
id|s-&gt;iodmac
op_plus
id|SV_EXTENT_DMA
op_minus
l_int|1
)paren
suffix:semicolon
r_goto
id|err_region3
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;iomidi
comma
id|SV_EXTENT_MIDI
comma
l_string|&quot;S3 SonicVibes Midi&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sv: io ports %#lx-%#lx in use&bslash;n&quot;
comma
id|s-&gt;iomidi
comma
id|s-&gt;iomidi
op_plus
id|SV_EXTENT_MIDI
op_minus
l_int|1
)paren
suffix:semicolon
r_goto
id|err_region2
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;iosynth
comma
id|SV_EXTENT_SYNTH
comma
l_string|&quot;S3 SonicVibes Synth&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sv: io ports %#lx-%#lx in use&bslash;n&quot;
comma
id|s-&gt;iosynth
comma
id|s-&gt;iosynth
op_plus
id|SV_EXTENT_SYNTH
op_minus
l_int|1
)paren
suffix:semicolon
r_goto
id|err_region1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pcidev
)paren
)paren
r_goto
id|err_irq
suffix:semicolon
multiline_comment|/* initialize codec registers */
id|outb
c_func
(paren
l_int|0x80
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_CONTROL
)paren
suffix:semicolon
multiline_comment|/* assert reset */
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_CONTROL
)paren
suffix:semicolon
multiline_comment|/* deassert reset */
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|outb
c_func
(paren
id|SV_CCTRL_INTADRIVE
op_or
id|SV_CCTRL_ENHANCED
multiline_comment|/*| SV_CCTRL_WAVETABLE */
op_or
(paren
id|reverb
(braket
id|devindex
)braket
ques
c_cond
id|SV_CCTRL_REVERB
suffix:colon
l_int|0
)paren
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_CONTROL
)paren
suffix:semicolon
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_STATUS
)paren
suffix:semicolon
multiline_comment|/* clear ints */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIDRIVECONTROL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* drive current 16mA */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIENABLE
comma
id|s-&gt;enable
op_assign
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable DMAA and DMAC */
id|outb
c_func
(paren
op_complement
(paren
id|SV_CINTMASK_DMAA
op_or
id|SV_CINTMASK_DMAC
)paren
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_INTMASK
)paren
suffix:semicolon
multiline_comment|/* outb(0xff, s-&gt;iodmaa + SV_DMA_RESET); */
multiline_comment|/* outb(0xff, s-&gt;iodmac + SV_DMA_RESET); */
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_STATUS
)paren
suffix:semicolon
multiline_comment|/* ack interrupts */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIADCCLKSOURCE
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* use pll as ADC clock source */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIANALOGPWRDOWN
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* power up the analog parts of the device */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIDIGITALPWRDOWN
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* power up the digital parts of the device */
id|setpll
c_func
(paren
id|s
comma
id|SV_CIADCPLLM
comma
l_int|8000
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CISRSSPACE
comma
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* SRS off */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIPCMSR0
comma
(paren
l_int|8000
op_star
l_int|65536
op_div
id|FULLRATE
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIPCMSR1
comma
(paren
(paren
l_int|8000
op_star
l_int|65536
op_div
id|FULLRATE
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIADCOUTPUT
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* request irq */
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|s-&gt;irq
comma
id|sv_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;S3 SonicVibes&quot;
comma
id|s
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sv: irq %u in use&bslash;n&quot;
comma
id|s-&gt;irq
)paren
suffix:semicolon
r_goto
id|err_irq
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sv: found adapter at io %#lx irq %u dmaa %#06x dmac %#06x revision %u&bslash;n&quot;
comma
id|s-&gt;ioenh
comma
id|s-&gt;irq
comma
id|s-&gt;iodmaa
comma
id|s-&gt;iodmac
comma
id|rdindir
c_func
(paren
id|s
comma
id|SV_CIREVISION
)paren
)paren
suffix:semicolon
multiline_comment|/* register devices */
r_if
c_cond
(paren
(paren
id|s-&gt;dev_audio
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|sv_audio_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dev_mixer
op_assign
id|register_sound_mixer
c_func
(paren
op_amp
id|sv_mixer_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dev_midi
op_assign
id|register_sound_midi
c_func
(paren
op_amp
id|sv_midi_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dev_dmfm
op_assign
id|register_sound_special
c_func
(paren
op_amp
id|sv_dmfm_fops
comma
l_int|15
multiline_comment|/* ?? */
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev4
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pcidev
)paren
suffix:semicolon
multiline_comment|/* enable bus mastering */
multiline_comment|/* initialize the chips */
id|fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|val
op_assign
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_SYNTH
suffix:semicolon
id|mixer_ioctl
c_func
(paren
id|s
comma
id|SOUND_MIXER_WRITE_RECSRC
comma
(paren
r_int
r_int
)paren
op_amp
id|val
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|initvol
)paren
op_div
r_sizeof
(paren
id|initvol
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|initvol
(braket
id|i
)braket
dot
id|vol
suffix:semicolon
id|mixer_ioctl
c_func
(paren
id|s
comma
id|initvol
(braket
id|i
)braket
dot
id|mixch
comma
(paren
r_int
r_int
)paren
op_amp
id|val
)paren
suffix:semicolon
)brace
id|set_fs
c_func
(paren
id|fs
)paren
suffix:semicolon
multiline_comment|/* store it in the driver field */
id|pci_set_drvdata
c_func
(paren
id|pcidev
comma
id|s
)paren
suffix:semicolon
id|pcidev-&gt;dma_mask
op_assign
l_int|0x00ffffff
suffix:semicolon
multiline_comment|/* put it into driver list */
id|list_add_tail
c_func
(paren
op_amp
id|s-&gt;devs
comma
op_amp
id|devs
)paren
suffix:semicolon
multiline_comment|/* increment devindex */
r_if
c_cond
(paren
id|devindex
OL
id|NR_DEVICE
op_minus
l_int|1
)paren
id|devindex
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_dev4
suffix:colon
id|unregister_sound_midi
c_func
(paren
id|s-&gt;dev_midi
)paren
suffix:semicolon
id|err_dev3
suffix:colon
id|unregister_sound_mixer
c_func
(paren
id|s-&gt;dev_mixer
)paren
suffix:semicolon
id|err_dev2
suffix:colon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_audio
)paren
suffix:semicolon
id|err_dev1
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sv: cannot register misc device&bslash;n&quot;
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|s-&gt;irq
comma
id|s
)paren
suffix:semicolon
id|err_irq
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;iosynth
comma
id|SV_EXTENT_SYNTH
)paren
suffix:semicolon
id|err_region1
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;iomidi
comma
id|SV_EXTENT_MIDI
)paren
suffix:semicolon
id|err_region2
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;iodmac
comma
id|SV_EXTENT_DMA
)paren
suffix:semicolon
id|err_region3
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;iodmaa
comma
id|SV_EXTENT_DMA
)paren
suffix:semicolon
id|err_region4
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;ioenh
comma
id|SV_EXTENT_ENH
)paren
suffix:semicolon
id|err_region5
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|sv_remove
r_static
r_void
id|__devinit
id|sv_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|sv_state
op_star
id|s
op_assign
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_return
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|s-&gt;devs
)paren
suffix:semicolon
id|outb
c_func
(paren
op_complement
l_int|0
comma
id|s-&gt;ioenh
op_plus
id|SV_CODEC_INTMASK
)paren
suffix:semicolon
multiline_comment|/* disable ints */
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|inb
c_func
(paren
id|s-&gt;ioenh
op_plus
id|SV_CODEC_STATUS
)paren
suffix:semicolon
multiline_comment|/* ack interrupts */
id|wrindir
c_func
(paren
id|s
comma
id|SV_CIENABLE
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable DMAA and DMAC */
multiline_comment|/*outb(0, s-&gt;iodmaa + SV_DMA_RESET);*/
multiline_comment|/*outb(0, s-&gt;iodmac + SV_DMA_RESET);*/
id|free_irq
c_func
(paren
id|s-&gt;irq
comma
id|s
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;iodmac
comma
id|SV_EXTENT_DMA
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;iodmaa
comma
id|SV_EXTENT_DMA
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;ioenh
comma
id|SV_EXTENT_ENH
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;iomidi
comma
id|SV_EXTENT_MIDI
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;iosynth
comma
id|SV_EXTENT_SYNTH
)paren
suffix:semicolon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_audio
)paren
suffix:semicolon
id|unregister_sound_mixer
c_func
(paren
id|s-&gt;dev_mixer
)paren
suffix:semicolon
id|unregister_sound_midi
c_func
(paren
id|s-&gt;dev_midi
)paren
suffix:semicolon
id|unregister_sound_special
c_func
(paren
id|s-&gt;dev_dmfm
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|id_table
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_S3
comma
id|PCI_DEVICE_ID_S3_SONICVIBES
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|id_table
)paren
suffix:semicolon
DECL|variable|sv_driver
r_static
r_struct
id|pci_driver
id|sv_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;sonicvibes&quot;
comma
id|id_table
suffix:colon
id|id_table
comma
id|probe
suffix:colon
id|sv_probe
comma
id|remove
suffix:colon
id|sv_remove
)brace
suffix:semicolon
DECL|function|init_sonicvibes
r_static
r_int
id|__init
id|init_sonicvibes
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
multiline_comment|/* No PCI bus in this machine! */
r_return
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sv: version v0.27 time &quot;
id|__TIME__
l_string|&quot; &quot;
id|__DATE__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
op_logical_neg
(paren
id|wavetable_mem
op_assign
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|20
op_minus
id|PAGE_SHIFT
)paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sv: cannot allocate 1MB of contiguous nonpageable memory for wavetable data&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pci_module_init
c_func
(paren
op_amp
id|sv_driver
)paren
suffix:semicolon
)brace
DECL|function|cleanup_sonicvibes
r_static
r_void
id|__exit
id|cleanup_sonicvibes
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sv: unloading&bslash;n&quot;
)paren
suffix:semicolon
id|pci_unregister_driver
c_func
(paren
op_amp
id|sv_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wavetable_mem
)paren
id|free_pages
c_func
(paren
id|wavetable_mem
comma
l_int|20
op_minus
id|PAGE_SHIFT
)paren
suffix:semicolon
)brace
DECL|variable|init_sonicvibes
id|module_init
c_func
(paren
id|init_sonicvibes
)paren
suffix:semicolon
DECL|variable|cleanup_sonicvibes
id|module_exit
c_func
(paren
id|cleanup_sonicvibes
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
macro_line|#ifndef MODULE
multiline_comment|/* format is: sonicvibes=[reverb] sonicvibesdmaio=dmaioaddr */
DECL|function|sonicvibes_setup
r_static
r_int
id|__init
id|sonicvibes_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|NR_DEVICE
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|reverb
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
(paren
r_void
)paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|wavetable
(braket
id|nr_dev
)braket
)paren
suffix:semicolon
macro_line|#else
(paren
r_void
)paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|reverb
(braket
id|nr_dev
)braket
)paren
suffix:semicolon
macro_line|#endif
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;sonicvibes=&quot;
comma
id|sonicvibes_setup
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
eof
