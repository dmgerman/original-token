multiline_comment|/*&n;   drivers/sound/lowlevel/aedsp16.c&n;&n;   Audio Excel DSP 16 software configuration routines&n;   Copyright (C) 1995,1996,1997,1998  Riccardo Facchetti (fizban@tin.it)&n;&n;   This program is free software; you can redistribute it and/or modify&n;   it under the terms of the GNU General Public License as published by&n;   the Free Software Foundation; either version 2 of the License, or&n;   (at your option) any later version.&n;&n;   This program is distributed in the hope that it will be useful,&n;   but WITHOUT ANY WARRANTY; without even the implied warranty of&n;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;   GNU General Public License for more details.&n;&n;   You should have received a copy of the GNU General Public License&n;   along with this program; if not, write to the Free Software&n;   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;&n; */
multiline_comment|/*&n; * Include the main OSS Lite header file. It include all the os, OSS Lite, etc&n; * headers needed by this source.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;sound_config.h&quot;
multiline_comment|/*&n; * Sanity checks&n; */
macro_line|#if defined(CONFIG_SOUND_AEDSP16_SBPRO) &amp;&amp; defined(CONFIG_SOUND_AEDSP16_MSS)
macro_line|#error You have to enable only one of the MSS and SBPRO emulations.
macro_line|#endif
multiline_comment|/*&n;&n;   READ THIS&n;&n;   This module started to configure the Audio Excel DSP 16 Sound Card.&n;   Now works with the SC-6000 (old aedsp16) and new SC-6600 based cards.&n;&n;   NOTE: I have NO idea about Audio Excel DSP 16 III. If someone owns this&n;   audio card and want to see the kernel support for it, please contact me.&n;&n;   Audio Excel DSP 16 is an SB pro II, Microsoft Sound System and MPU-401&n;   compatible card.&n;   It is software-only configurable (no jumpers to hard-set irq/dma/mpu-irq),&n;   so before this module, the only way to configure the DSP under linux was&n;   boot the MS-DOS loading the sound.sys device driver (this driver soft-&n;   configure the sound board hardware by massaging someone of its registers),&n;   and then ctrl-alt-del to boot linux with the DSP configured by the DOS&n;   driver.&n;&n;   This module works configuring your Audio Excel DSP 16&squot;s irq, dma and&n;   mpu-401-irq. The OSS Lite routines rely on the fact that if the&n;   hardware is there, they can detect it. The problem with AEDSP16 is&n;   that no hardware can be found by the probe routines if the sound card&n;   is not configured properly. Sometimes the kernel probe routines can find&n;   an SBPRO even when the card is not configured (this is the standard setup&n;   of the card), but the SBPRO emulation don&squot;t work well if the card is not&n;   properly initialized. For this reason&n;&n;   aedsp16_init_board()&n;&n;   routine is called before the OSS Lite probe routines try to detect the&n;   hardware.&n;&n;   NOTE (READ THE NOTE TOO, IT CONTAIN USEFUL INFORMATIONS)&n;&n;   NOTE: Now it works with SC-6000 and SC-6600 based audio cards. The new cards&n;   have no jumper switch at all. No more WSS or MPU-401 I/O port switches. They&n;   have to be configured by software.&n;&n;   NOTE: The driver is merged with the new OSS Lite sound driver. It works&n;   as a lowlevel driver.&n;&n;   The Audio Excel DSP 16 Sound Card emulates both SBPRO and MSS;&n;   the OSS Lite sound driver can be configured for SBPRO and MSS cards&n;   at the same time, but the aedsp16 can&squot;t be two cards!!&n;   When we configure it, we have to choose the SBPRO or the MSS emulation&n;   for AEDSP16. We also can install a *REAL* card of the other type (see [1]).&n;&n;   NOTE: If someone can test the combination AEDSP16+MSS or AEDSP16+SBPRO&n;   please let me know if it works.&n;&n;   The MPU-401 support can be compiled in together with one of the other&n;   two operating modes.&n;&n;   NOTE: This is something like plug-and-play: we have only to plug&n;   the AEDSP16 board in the socket, and then configure and compile&n;   a kernel that uses the AEDSP16 software configuration capability.&n;   No jumper setting is needed!&n;&n;   For example, if you want AEDSP16 to be an SBPro, on irq 10, dma 3&n;   you have just to make config the OSS Lite package, configuring&n;   the AEDSP16 sound card, then activating the SBPro emulation mode&n;   and at last configuring IRQ and DMA.&n;   Compile the kernel and run it.&n;&n;   NOTE: This means for SC-6000 cards that you can choose irq and dma,&n;   but not the I/O addresses. To change I/O addresses you have to set&n;   them with jumpers. For SC-6600 cards you have no jumpers so you have&n;   to set up your full card configuration in the make config.&n;&n;   You can change the irq/dma/mirq settings WITHOUT THE NEED to open&n;   your computer and massage the jumpers (there are no irq/dma/mirq&n;   jumpers to be configured anyway, only I/O BASE values have to be&n;   configured with jumpers)&n;&n;   For some ununderstandable reason, the card default of irq 7, dma 1,&n;   don&squot;t work for me. Seems to be an IRQ or DMA conflict. Under heavy&n;   HDD work, the kernel start to erupt out a lot of messages like:&n;&n;   &squot;Sound: DMA timed out - IRQ/DRQ config error?&squot;&n;&n;   For what I can say, I have NOT any conflict at irq 7 (under linux I&squot;m&n;   using the lp polling driver), and dma line 1 is unused as stated by&n;   /proc/dma. I can suppose this is a bug of AEDSP16. I know my hardware so&n;   I&squot;m pretty sure I have not any conflict, but may be I&squot;m wrong. Who knows!&n;   Anyway a setting of irq 10, dma 3 works really fine.&n;&n;   NOTE: if someone can use AEDSP16 with irq 7, dma 1, please let me know&n;   the emulation mode, all the installed hardware and the hardware&n;   configuration (irq and dma settings of all the hardware).&n;&n;   This init module should work with SBPRO+MSS, when one of the two is&n;   the AEDSP16 emulation and the other the real card. (see [1])&n;   For example:&n;&n;   AEDSP16 (0x220) in SBPRO emu (0x220) + real MSS + other&n;   AEDSP16 (0x220) in MSS emu + real SBPRO (0x240) + other&n;&n;   MPU401 should work. (see [2])&n;&n;   [1]&n;       ---&n;       Date: Mon, 29 Jul 1997 08:35:40 +0100&n;       From: Mr S J Greenaway &lt;sjg95@unixfe.rl.ac.uk&gt;&n;&n;       [...]&n;       Just to let you know got my Audio Excel (emulating a MSS) working&n;       with my original SB16, thanks for the driver!&n;       [...]&n;       ---&n;&n;   [2] Not tested by me for lack of hardware.&n;&n;   TODO, WISHES AND TECH&n;&n;   - About I/O ports allocation -&n;&n;   Request the 2x0h region (port base) in any case if we are using this card.&n;&n;   NOTE: the &quot;aedsp16 (base)&quot; string with which we are requesting the aedsp16&n;   port base region (see code) does not mean necessarily that we are emulating&n;   sbpro.  Even if this region is the sbpro I/O ports region, we use this&n;   region to access the control registers of the card, and if emulating&n;   sbpro, I/O sbpro registers too. If we are emulating MSS, the sbpro&n;   registers are not used, in no way, to emulate an sbpro: they are&n;   used only for configuration purposes.&n;&n;   Started Fri Mar 17 16:13:18 MET 1995&n;&n;   v0.1 (ALPHA, was an user-level program called AudioExcelDSP16.c)&n;   - Initial code.&n;   v0.2 (ALPHA)&n;   - Cleanups.&n;   - Integrated with Linux voxware v 2.90-2 kernel sound driver.&n;   - SoundBlaster Pro mode configuration.&n;   - Microsoft Sound System mode configuration.&n;   - MPU-401 mode configuration.&n;   v0.3 (ALPHA)&n;   - Cleanups.&n;   - Rearranged the code to let aedsp16_init_board be more general.&n;   - Erased the REALLY_SLOW_IO. We don&squot;t need it. Erased the linux/io.h&n;   inclusion too. We rely on os.h&n;   - Used the  to get a variable&n;   len string (we are not sure about the len of Copyright string).&n;   This works with any SB and compatible.&n;   - Added the code to request_region at device init (should go in&n;   the main body of voxware).&n;   v0.4 (BETA)&n;   - Better configure.c patch for aedsp16 configuration (better&n;   logic of inclusion of AEDSP16 support)&n;   - Modified the conditional compilation to better support more than&n;   one sound card of the emulated type (read the NOTES above)&n;   - Moved the sb init routine from the attach to the very first&n;   probe in sb_card.c&n;   - Rearrangements and cleanups&n;   - Wiped out some unnecessary code and variables: this is kernel&n;   code so it is better save some TEXT and DATA&n;   - Fixed the request_region code. We must allocate the aedsp16 (sbpro)&n;   I/O ports in any case because they are used to access the DSP&n;   configuration registers and we can not allow anyone to get them.&n;   v0.5&n;   - cleanups on comments&n;   - prep for diffs against v3.0-proto-950402&n;   v0.6&n;   - removed the request_region()s when compiling the MODULE sound.o&n;   because we are not allowed (by the actual voxware structure) to&n;   release_region()&n;   v0.7 (pre ALPHA, not distributed)&n;   - started porting this module to kernel 1.3.84. Dummy probe/attach&n;   routines.&n;   v0.8 (ALPHA)&n;   - attached all the init routines.&n;   v0.9 (BETA)&n;   - Integrated with linux-pre2.0.7&n;   - Integrated with configuration scripts.&n;   - Cleaned up and beautyfied the code.&n;   v0.9.9 (BETA)&n;   - Thanks to Piercarlo Grandi: corrected the conditonal compilation code.&n;     Now only the code configured is compiled in, with some memory saving.&n;   v0.9.10&n;   - Integration into the sound/lowlevel/ section of the sound driver.&n;   - Re-organized the code.&n;   v0.9.11 (not distributed)&n;   - Rewritten the init interface-routines to initialize the AEDSP16 in&n;     one shot.&n;   - More cosmetics.&n;   - SC-6600 support.&n;   - More soft/hard configuration.&n;   v0.9.12&n;   - Refined the v0.9.11 code with conditional compilation to distinguish&n;     between SC-6000 and SC-6600 code.&n;   v1.0.0&n;   - Prep for merging with OSS Lite and Linux kernel 2.1.13&n;   - Corrected a bug in request/check/release region calls (thanks to the&n;     new kernel exception handling).&n;   v1.1&n;   - Revamped for integration with new modularized sound drivers: to enhance&n;     the flexibility of modular version, I have removed all the conditional&n;     compilation for SBPRO, MPU and MSS code. Now it is all managed with&n;     the ae_config structure.&n;   v1.2&n;   - Module informations added.&n;   - Removed aedsp16_delay_10msec(), now using mdelay(10)&n;   - All data and funcs moved to .*.init section.&n;   v1.3&n;   Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - 2000/09/27&n;   - got rid of check_region&n;&n;   Known Problems:&n;   - Audio Excel DSP 16 III don&squot;t work with this driver.&n;&n;   Credits:&n;   Many thanks to Gerald Britton &lt;gbritton@CapAccess.org&gt;. He helped me a&n;   lot in testing the 0.9.11 and 0.9.12 versions of this driver.&n;&n; */
DECL|macro|VERSION
mdefine_line|#define VERSION &quot;1.3&quot;&t;&t;/* Version of Audio Excel DSP 16 driver */
DECL|macro|AEDSP16_DEBUG
macro_line|#undef&t;AEDSP16_DEBUG 1&t;&t;/* Define this to enable debug code     */
DECL|macro|AEDSP16_DEBUG_MORE
macro_line|#undef&t;AEDSP16_DEBUG_MORE 1&t;/* Define this to enable more debug     */
DECL|macro|AEDSP16_INFO
macro_line|#undef&t;AEDSP16_INFO  1&t;&t;/* Define this to enable info code      */
macro_line|#if defined(AEDSP16_DEBUG)
DECL|macro|DBG
macro_line|# define DBG(x)  printk x
macro_line|# if defined(AEDSP16_DEBUG_MORE)
DECL|macro|DBG1
macro_line|#  define DBG1(x) printk x
macro_line|# else
DECL|macro|DBG1
macro_line|#  define DBG1(x)
macro_line|# endif
macro_line|#else
DECL|macro|DBG
macro_line|# define DBG(x)
DECL|macro|DBG1
macro_line|# define DBG1(x)
macro_line|#endif
multiline_comment|/*&n; * Misc definitions&n; */
DECL|macro|TRUE
mdefine_line|#define TRUE&t;1
DECL|macro|FALSE
mdefine_line|#define FALSE&t;0
multiline_comment|/*&n; * Region Size for request/check/release region.&n; */
DECL|macro|IOBASE_REGION_SIZE
mdefine_line|#define IOBASE_REGION_SIZE&t;0x10
multiline_comment|/*&n; * Hardware related defaults&n; */
DECL|macro|DEF_AEDSP16_IOB
mdefine_line|#define DEF_AEDSP16_IOB 0x220   /* 0x220(default) 0x240                 */
DECL|macro|DEF_AEDSP16_IRQ
mdefine_line|#define DEF_AEDSP16_IRQ 7&t;/* 5 7(default) 9 10 11                 */
DECL|macro|DEF_AEDSP16_MRQ
mdefine_line|#define DEF_AEDSP16_MRQ 0&t;/* 5 7 9 10 0(default), 0 means disable */
DECL|macro|DEF_AEDSP16_DMA
mdefine_line|#define DEF_AEDSP16_DMA 1&t;/* 0 1(default) 3                       */
multiline_comment|/*&n; * Commands of AEDSP16&squot;s DSP (SBPRO+special).&n; * Some of them are COMMAND_xx, in the future they may change.&n; */
DECL|macro|WRITE_MDIRQ_CFG
mdefine_line|#define WRITE_MDIRQ_CFG   0x50&t;/* Set M&amp;I&amp;DRQ mask (the real config)   */
DECL|macro|COMMAND_52
mdefine_line|#define COMMAND_52        0x52&t;/*                                      */
DECL|macro|READ_HARD_CFG
mdefine_line|#define READ_HARD_CFG     0x58&t;/* Read Hardware Config (I/O base etc)  */
DECL|macro|COMMAND_5C
mdefine_line|#define COMMAND_5C        0x5c&t;/*                                      */
DECL|macro|COMMAND_60
mdefine_line|#define COMMAND_60        0x60&t;/*                                      */
DECL|macro|COMMAND_66
mdefine_line|#define COMMAND_66        0x66&t;/*                                      */
DECL|macro|COMMAND_6C
mdefine_line|#define COMMAND_6C        0x6c&t;/*                                      */
DECL|macro|COMMAND_6E
mdefine_line|#define COMMAND_6E        0x6e&t;/*                                      */
DECL|macro|COMMAND_88
mdefine_line|#define COMMAND_88        0x88&t;/*                                      */
DECL|macro|DSP_INIT_MSS
mdefine_line|#define DSP_INIT_MSS      0x8c&t;/* Enable Microsoft Sound System mode   */
DECL|macro|COMMAND_C5
mdefine_line|#define COMMAND_C5        0xc5&t;/*                                      */
DECL|macro|GET_DSP_VERSION
mdefine_line|#define GET_DSP_VERSION   0xe1&t;/* Get DSP Version                      */
DECL|macro|GET_DSP_COPYRIGHT
mdefine_line|#define GET_DSP_COPYRIGHT 0xe3&t;/* Get DSP Copyright                    */
multiline_comment|/*&n; * Offsets of AEDSP16 DSP I/O ports. The offset is added to base I/O port&n; * to have the actual I/O port.&n; * Register permissions are:&n; * (wo) == Write Only&n; * (ro) == Read  Only&n; * (w-) == Write&n; * (r-) == Read&n; */
DECL|macro|DSP_RESET
mdefine_line|#define DSP_RESET    0x06&t;/* offset of DSP RESET             (wo) */
DECL|macro|DSP_READ
mdefine_line|#define DSP_READ     0x0a&t;/* offset of DSP READ              (ro) */
DECL|macro|DSP_WRITE
mdefine_line|#define DSP_WRITE    0x0c&t;/* offset of DSP WRITE             (w-) */
DECL|macro|DSP_COMMAND
mdefine_line|#define DSP_COMMAND  0x0c&t;/* offset of DSP COMMAND           (w-) */
DECL|macro|DSP_STATUS
mdefine_line|#define DSP_STATUS   0x0c&t;/* offset of DSP STATUS            (r-) */
DECL|macro|DSP_DATAVAIL
mdefine_line|#define DSP_DATAVAIL 0x0e&t;/* offset of DSP DATA AVAILABLE    (ro) */
DECL|macro|RETRY
mdefine_line|#define RETRY           10&t;/* Various retry values on I/O opera-   */
DECL|macro|STATUSRETRY
mdefine_line|#define STATUSRETRY   1000&t;/* tions. Sometimes we have to          */
DECL|macro|HARDRETRY
mdefine_line|#define HARDRETRY   500000&t;/* wait for previous cmd to complete    */
multiline_comment|/*&n; * Size of character arrays that store name and version of sound card&n; */
DECL|macro|CARDNAMELEN
mdefine_line|#define CARDNAMELEN 15&t;&t;/* Size of the card&squot;s name in chars     */
DECL|macro|CARDVERLEN
mdefine_line|#define CARDVERLEN  2&t;&t;/* Size of the card&squot;s version in chars  */
macro_line|#if defined(CONFIG_SC6600)
multiline_comment|/*&n; * Bitmapped flags of hard configuration&n; */
multiline_comment|/*&n; * Decode macros (xl == low byte, xh = high byte)&n; */
DECL|macro|IOBASE
mdefine_line|#define IOBASE(xl)&t;&t;((xl &amp; 0x01)?0x240:0x220)
DECL|macro|JOY
mdefine_line|#define JOY(xl)  &t;&t;(xl &amp; 0x02)
DECL|macro|MPUADDR
mdefine_line|#define MPUADDR(xl)&t;&t;( &t;&t;&t;&bslash;&n;&t;&t;&t;&t;(xl &amp; 0x0C)?0x330:&t;&bslash;&n;&t;&t;&t;&t;(xl &amp; 0x08)?0x320:&t;&bslash;&n;&t;&t;&t;&t;(xl &amp; 0x04)?0x310:&t;&bslash;&n;&t;&t;&t;&t;&t;&t;0x300)
DECL|macro|WSSADDR
mdefine_line|#define WSSADDR(xl)&t;&t;((xl &amp; 0x10)?0xE80:0x530)
DECL|macro|CDROM
mdefine_line|#define CDROM(xh)&t;&t;(xh &amp; 0x20)
DECL|macro|CDROMADDR
mdefine_line|#define CDROMADDR(xh)&t;&t;(((xh &amp; 0x1F) &lt;&lt; 4) + 0x200)
multiline_comment|/*&n; * Encode macros&n; */
DECL|macro|BLDIOBASE
mdefine_line|#define BLDIOBASE(xl, val) {&t;&t;&bslash;&n;&t;xl &amp;= ~0x01; &t;&t;&t;&bslash;&n;&t;if (val == 0x240)&t;&t;&bslash;&n;&t;&t;xl |= 0x01;&t;&t;&bslash;&n;&t;}
DECL|macro|BLDJOY
mdefine_line|#define BLDJOY(xl, val) {&t;&t;&bslash;&n;&t;xl &amp;= ~0x02; &t;&t;&t;&bslash;&n;&t;if (val == 1)&t;&t;&t;&bslash;&n;&t;&t;xl |= 0x02;&t;&t;&bslash;&n;&t;}
DECL|macro|BLDMPUADDR
mdefine_line|#define BLDMPUADDR(xl, val) {&t;&t;&bslash;&n;&t;xl &amp;= ~0x0C;&t;&t;&t;&bslash;&n;&t;switch (val) {&t;&t;&t;&bslash;&n;&t;&t;case 0x330:&t;&t;&bslash;&n;&t;&t;&t;xl |= 0x0C;&t;&bslash;&n;&t;&t;&t;break;&t;&t;&bslash;&n;&t;&t;case 0x320:&t;&t;&bslash;&n;&t;&t;&t;xl |= 0x08;&t;&bslash;&n;&t;&t;&t;break;&t;&t;&bslash;&n;&t;&t;case 0x310:&t;&t;&bslash;&n;&t;&t;&t;xl |= 0x04;&t;&bslash;&n;&t;&t;&t;break;&t;&t;&bslash;&n;&t;&t;case 0x300:&t;&t;&bslash;&n;&t;&t;&t;xl |= 0x00;&t;&bslash;&n;&t;&t;&t;break;&t;&t;&bslash;&n;&t;&t;default:&t;&t;&bslash;&n;&t;&t;&t;xl |= 0x00;&t;&bslash;&n;&t;&t;&t;break;&t;&t;&bslash;&n;&t;&t;}&t;&t;&t;&bslash;&n;&t;}
DECL|macro|BLDWSSADDR
mdefine_line|#define BLDWSSADDR(xl, val) {&t;&t;&bslash;&n;&t;xl &amp;= ~0x10; &t;&t;&t;&bslash;&n;&t;if (val == 0xE80)&t;&t;&bslash;&n;&t;&t;xl |= 0x10;&t;&t;&bslash;&n;&t;}
DECL|macro|BLDCDROM
mdefine_line|#define BLDCDROM(xh, val) {&t;&t;&bslash;&n;&t;xh &amp;= ~0x20; &t;&t;&t;&bslash;&n;&t;if (val == 1)&t;&t;&t;&bslash;&n;&t;&t;xh |= 0x20;&t;&t;&bslash;&n;&t;}
DECL|macro|BLDCDROMADDR
mdefine_line|#define BLDCDROMADDR(xh, val) {&t;&t;&bslash;&n;&t;int tmp = val;&t;&t;&t;&bslash;&n;&t;tmp -= 0x200;&t;&t;&t;&bslash;&n;&t;tmp &gt;&gt;= 4;&t;&t;&t;&bslash;&n;&t;tmp &amp;= 0x1F;&t;&t;&t;&bslash;&n;&t;xh |= tmp;&t;&t;&t;&bslash;&n;&t;xh &amp;= 0x7F;&t;&t;&t;&bslash;&n;&t;xh |= 0x40;&t;&t;&t;&bslash;&n;&t;}
macro_line|#endif /* CONFIG_SC6600 */
multiline_comment|/*&n; * Bit mapped flags for calling aedsp16_init_board(), and saving the current&n; * emulation mode.&n; */
DECL|macro|INIT_NONE
mdefine_line|#define INIT_NONE   (0   )
DECL|macro|INIT_SBPRO
mdefine_line|#define INIT_SBPRO  (1&lt;&lt;0)
DECL|macro|INIT_MSS
mdefine_line|#define INIT_MSS    (1&lt;&lt;1)
DECL|macro|INIT_MPU401
mdefine_line|#define INIT_MPU401 (1&lt;&lt;2)
DECL|variable|__initdata
r_static
r_int
id|soft_cfg
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* bitmapped config */
DECL|variable|__initdata
r_static
r_int
id|soft_cfg_mss
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* bitmapped mss config */
DECL|variable|__initdata
r_static
r_int
id|ver
(braket
id|CARDVERLEN
)braket
id|__initdata
op_assign
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* DSP Ver:&n;&t;&t;&t;&t;&t;&t;   hi-&gt;ver[0] lo-&gt;ver[1] */
macro_line|#if defined(CONFIG_SC6600)
r_static
r_int
id|hard_cfg
(braket
l_int|2
)braket
multiline_comment|/* lo&lt;-hard_cfg[0] hi&lt;-hard_cfg[1]      */
DECL|variable|__initdata
id|__initdata
op_assign
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_SC6600 */
macro_line|#if defined(CONFIG_SC6600)
multiline_comment|/* Decoded hard configuration */
DECL|struct|d_hcfg
r_struct
id|d_hcfg
(brace
DECL|member|iobase
r_int
id|iobase
suffix:semicolon
DECL|member|joystick
r_int
id|joystick
suffix:semicolon
DECL|member|mpubase
r_int
id|mpubase
suffix:semicolon
DECL|member|wssbase
r_int
id|wssbase
suffix:semicolon
DECL|member|cdrom
r_int
id|cdrom
suffix:semicolon
DECL|member|cdrombase
r_int
id|cdrombase
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|__initdata
r_struct
id|d_hcfg
id|decoded_hcfg
id|__initdata
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_SC6600 */
multiline_comment|/* orVals contain the values to be or&squot;ed       &t;&t;&t;&t;*/
DECL|struct|orVals
r_struct
id|orVals
(brace
DECL|member|val
r_int
id|val
suffix:semicolon
multiline_comment|/* irq|mirq|dma                         */
DECL|member|or
r_int
op_logical_or
suffix:semicolon
multiline_comment|/* soft_cfg |= TheStruct.or             */
)brace
suffix:semicolon
multiline_comment|/* aedsp16_info contain the audio card configuration                  */
DECL|struct|aedsp16_info
r_struct
id|aedsp16_info
(brace
DECL|member|base_io
r_int
id|base_io
suffix:semicolon
multiline_comment|/* base I/O address for accessing card  */
DECL|member|irq
r_int
id|irq
suffix:semicolon
multiline_comment|/* irq value for DSP I/O                */
DECL|member|mpu_irq
r_int
id|mpu_irq
suffix:semicolon
multiline_comment|/* irq for mpu401 interface I/O         */
DECL|member|dma
r_int
id|dma
suffix:semicolon
multiline_comment|/* dma value for DSP I/O                */
DECL|member|mss_base
r_int
id|mss_base
suffix:semicolon
multiline_comment|/* base I/O for Microsoft Sound System  */
DECL|member|mpu_base
r_int
id|mpu_base
suffix:semicolon
multiline_comment|/* base I/O for MPU-401 emulation       */
DECL|member|init
r_int
id|init
suffix:semicolon
multiline_comment|/* Initialization status of the card    */
)brace
suffix:semicolon
multiline_comment|/*&n; * Magic values that the DSP will eat when configuring irq/mirq/dma&n; */
multiline_comment|/* DSP IRQ conversion array             */
DECL|variable|__initdata
r_static
r_struct
id|orVals
id|orIRQ
(braket
)braket
id|__initdata
op_assign
(brace
(brace
l_int|0x05
comma
l_int|0x28
)brace
comma
(brace
l_int|0x07
comma
l_int|0x08
)brace
comma
(brace
l_int|0x09
comma
l_int|0x10
)brace
comma
(brace
l_int|0x0a
comma
l_int|0x18
)brace
comma
(brace
l_int|0x0b
comma
l_int|0x20
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
)brace
)brace
suffix:semicolon
multiline_comment|/* MPU-401 IRQ conversion array         */
DECL|variable|__initdata
r_static
r_struct
id|orVals
id|orMIRQ
(braket
)braket
id|__initdata
op_assign
(brace
(brace
l_int|0x05
comma
l_int|0x04
)brace
comma
(brace
l_int|0x07
comma
l_int|0x44
)brace
comma
(brace
l_int|0x09
comma
l_int|0x84
)brace
comma
(brace
l_int|0x0a
comma
l_int|0xc4
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
)brace
)brace
suffix:semicolon
multiline_comment|/* DMA Channels conversion array        */
DECL|variable|__initdata
r_static
r_struct
id|orVals
id|orDMA
(braket
)braket
id|__initdata
op_assign
(brace
(brace
l_int|0x00
comma
l_int|0x01
)brace
comma
(brace
l_int|0x01
comma
l_int|0x02
)brace
comma
(brace
l_int|0x03
comma
l_int|0x03
)brace
comma
(brace
l_int|0x00
comma
l_int|0x00
)brace
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|aedsp16_info
id|ae_config
id|__initdata
op_assign
(brace
id|DEF_AEDSP16_IOB
comma
id|DEF_AEDSP16_IRQ
comma
id|DEF_AEDSP16_MRQ
comma
id|DEF_AEDSP16_DMA
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|INIT_NONE
)brace
suffix:semicolon
multiline_comment|/*&n; * Buffers to store audio card informations&n; */
DECL|variable|__initdata
r_static
r_char
id|DSPCopyright
(braket
id|CARDNAMELEN
op_plus
l_int|1
)braket
id|__initdata
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|DSPVersion
(braket
id|CARDVERLEN
op_plus
l_int|1
)braket
id|__initdata
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|function|aedsp16_wait_data
r_static
r_int
id|__init
id|aedsp16_wait_data
c_func
(paren
r_int
id|port
)paren
(brace
r_int
id|loop
op_assign
id|STATUSRETRY
suffix:semicolon
r_int
r_char
id|ret
op_assign
l_int|0
suffix:semicolon
id|DBG1
c_func
(paren
(paren
l_string|&quot;aedsp16_wait_data (0x%x): &quot;
comma
id|port
)paren
)paren
suffix:semicolon
r_do
(brace
id|ret
op_assign
id|inb
c_func
(paren
id|port
op_plus
id|DSP_DATAVAIL
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Wait for data available (bit 7 of ret == 1)&n;&t; */
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|ret
op_amp
l_int|0x80
)paren
op_logical_and
id|loop
op_decrement
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_amp
l_int|0x80
)paren
(brace
id|DBG1
c_func
(paren
(paren
l_string|&quot;success.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
id|DBG1
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
DECL|function|aedsp16_read
r_static
r_int
id|__init
id|aedsp16_read
c_func
(paren
r_int
id|port
)paren
(brace
r_int
id|inbyte
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;    Read DSP Byte (0x%x): &quot;
comma
id|port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_wait_data
c_func
(paren
id|port
)paren
op_eq
id|FALSE
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|inbyte
op_assign
id|inb
c_func
(paren
id|port
op_plus
id|DSP_READ
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;read [0x%x]/{%c}.&bslash;n&quot;
comma
id|inbyte
comma
id|inbyte
)paren
)paren
suffix:semicolon
r_return
id|inbyte
suffix:semicolon
)brace
DECL|function|aedsp16_test_dsp
r_static
r_int
id|__init
id|aedsp16_test_dsp
c_func
(paren
r_int
id|port
)paren
(brace
r_return
(paren
(paren
id|aedsp16_read
c_func
(paren
id|port
)paren
op_eq
l_int|0xaa
)paren
ques
c_cond
id|TRUE
suffix:colon
id|FALSE
)paren
suffix:semicolon
)brace
DECL|function|aedsp16_dsp_reset
r_static
r_int
id|__init
id|aedsp16_dsp_reset
c_func
(paren
r_int
id|port
)paren
(brace
multiline_comment|/*&n;&t; * Reset DSP&n;&t; */
id|DBG
c_func
(paren
(paren
l_string|&quot;Reset DSP:&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
(paren
id|port
op_plus
id|DSP_RESET
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
(paren
id|port
op_plus
id|DSP_RESET
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_test_dsp
c_func
(paren
id|port
)paren
op_eq
id|TRUE
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;success.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
r_else
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
DECL|function|aedsp16_write
r_static
r_int
id|__init
id|aedsp16_write
c_func
(paren
r_int
id|port
comma
r_int
id|cmd
)paren
(brace
r_int
r_char
id|ret
suffix:semicolon
r_int
id|loop
op_assign
id|HARDRETRY
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;    Write DSP Byte (0x%x) [0x%x]: &quot;
comma
id|port
comma
id|cmd
)paren
)paren
suffix:semicolon
r_do
(brace
id|ret
op_assign
id|inb
c_func
(paren
id|port
op_plus
id|DSP_STATUS
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * DSP ready to receive data if bit 7 of ret == 0&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ret
op_amp
l_int|0x80
)paren
)paren
(brace
id|outb
c_func
(paren
id|cmd
comma
id|port
op_plus
id|DSP_COMMAND
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;success.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|loop
op_decrement
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;timeout.&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] DSP Command (0x%x) timeout.&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_SC6600)
macro_line|#if defined(AEDSP16_INFO) || defined(AEDSP16_DEBUG)
DECL|function|aedsp16_pinfo
r_void
id|__init
id|aedsp16_pinfo
c_func
(paren
r_void
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;&bslash;n Base address:  %x&bslash;n&quot;
comma
id|decoded_hcfg.iobase
)paren
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot; Joystick    : %s present&bslash;n&quot;
comma
id|decoded_hcfg.joystick
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot; not&quot;
)paren
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot; WSS addr    :  %x&bslash;n&quot;
comma
id|decoded_hcfg.wssbase
)paren
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot; MPU-401 addr:  %x&bslash;n&quot;
comma
id|decoded_hcfg.mpubase
)paren
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot; CDROM       : %s present&bslash;n&quot;
comma
(paren
id|decoded_hcfg.cdrom
op_ne
l_int|4
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot; not&quot;
)paren
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot; CDROMADDR   :  %x&bslash;n&bslash;n&quot;
comma
id|decoded_hcfg.cdrombase
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|aedsp16_hard_decode
r_void
id|__init
id|aedsp16_hard_decode
c_func
(paren
r_void
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot; aedsp16_hard_decode: 0x%x, 0x%x&bslash;n&quot;
comma
id|hard_cfg
(braket
l_int|0
)braket
comma
id|hard_cfg
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
multiline_comment|/*&n; * Decode Cfg Bytes.&n; */
id|decoded_hcfg.iobase
op_assign
id|IOBASE
c_func
(paren
id|hard_cfg
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|decoded_hcfg.joystick
op_assign
id|JOY
c_func
(paren
id|hard_cfg
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|decoded_hcfg.wssbase
op_assign
id|WSSADDR
c_func
(paren
id|hard_cfg
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|decoded_hcfg.mpubase
op_assign
id|MPUADDR
c_func
(paren
id|hard_cfg
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|decoded_hcfg.cdrom
op_assign
id|CDROM
c_func
(paren
id|hard_cfg
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|decoded_hcfg.cdrombase
op_assign
id|CDROMADDR
c_func
(paren
id|hard_cfg
(braket
l_int|1
)braket
)paren
suffix:semicolon
macro_line|#if defined(AEDSP16_INFO) || defined(AEDSP16_DEBUG)
id|printk
c_func
(paren
l_string|&quot; Original sound card configuration:&bslash;n&quot;
)paren
suffix:semicolon
id|aedsp16_pinfo
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * Now set up the real kernel configuration.&n; */
id|decoded_hcfg.iobase
op_assign
id|ae_config.base_io
suffix:semicolon
id|decoded_hcfg.wssbase
op_assign
id|ae_config.mss_base
suffix:semicolon
id|decoded_hcfg.mpubase
op_assign
id|ae_config.mpu_base
suffix:semicolon
macro_line|#if defined(CONFIG_SC6600_JOY)
id|decoded_hcfg.joystick
op_assign
id|CONFIG_SC6600_JOY
suffix:semicolon
multiline_comment|/* Enable */
macro_line|#endif
macro_line|#if defined(CONFIG_SC6600_CDROM)
id|decoded_hcfg.cdrom
op_assign
id|CONFIG_SC6600_CDROM
suffix:semicolon
multiline_comment|/* 4:N-3:I-2:G-1:P-0:S */
macro_line|#endif
macro_line|#if defined(CONFIG_SC6600_CDROMBASE)
id|decoded_hcfg.cdrombase
op_assign
id|CONFIG_SC6600_CDROMBASE
suffix:semicolon
multiline_comment|/* 0 Disable */
macro_line|#endif
macro_line|#if defined(AEDSP16_DEBUG)
id|DBG
c_func
(paren
(paren
l_string|&quot; New Values:&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|aedsp16_pinfo
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|DBG
c_func
(paren
(paren
l_string|&quot;success.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
DECL|function|aedsp16_hard_encode
r_void
id|__init
id|aedsp16_hard_encode
c_func
(paren
r_void
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot; aedsp16_hard_encode: 0x%x, 0x%x&bslash;n&quot;
comma
id|hard_cfg
(braket
l_int|0
)braket
comma
id|hard_cfg
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|hard_cfg
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|hard_cfg
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|hard_cfg
(braket
l_int|0
)braket
op_or_assign
l_int|0x20
suffix:semicolon
id|BLDIOBASE
(paren
id|hard_cfg
(braket
l_int|0
)braket
comma
id|decoded_hcfg.iobase
)paren
suffix:semicolon
id|BLDWSSADDR
c_func
(paren
id|hard_cfg
(braket
l_int|0
)braket
comma
id|decoded_hcfg.wssbase
)paren
suffix:semicolon
id|BLDMPUADDR
c_func
(paren
id|hard_cfg
(braket
l_int|0
)braket
comma
id|decoded_hcfg.mpubase
)paren
suffix:semicolon
id|BLDJOY
c_func
(paren
id|hard_cfg
(braket
l_int|0
)braket
comma
id|decoded_hcfg.joystick
)paren
suffix:semicolon
id|BLDCDROM
c_func
(paren
id|hard_cfg
(braket
l_int|1
)braket
comma
id|decoded_hcfg.cdrom
)paren
suffix:semicolon
id|BLDCDROMADDR
c_func
(paren
id|hard_cfg
(braket
l_int|1
)braket
comma
id|decoded_hcfg.cdrombase
)paren
suffix:semicolon
macro_line|#if defined(AEDSP16_DEBUG)
id|aedsp16_pinfo
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|DBG
c_func
(paren
(paren
l_string|&quot; aedsp16_hard_encode: 0x%x, 0x%x&bslash;n&quot;
comma
id|hard_cfg
(braket
l_int|0
)braket
comma
id|hard_cfg
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;success.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
DECL|function|aedsp16_hard_write
r_static
r_int
id|__init
id|aedsp16_hard_write
c_func
(paren
r_int
id|port
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;aedsp16_hard_write:&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_6C
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_6C
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_5C
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_5C
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|hard_cfg
(braket
l_int|0
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] DATA 0x%x: failed!&bslash;n&quot;
comma
id|hard_cfg
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|hard_cfg
(braket
l_int|1
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] DATA 0x%x: failed!&bslash;n&quot;
comma
id|hard_cfg
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_C5
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_C5
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|DBG
c_func
(paren
(paren
l_string|&quot;success.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|aedsp16_hard_read
r_static
r_int
id|__init
id|aedsp16_hard_read
c_func
(paren
r_int
id|port
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;aedsp16_hard_read:&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|READ_HARD_CFG
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|READ_HARD_CFG
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|hard_cfg
(braket
l_int|0
)braket
op_assign
id|aedsp16_read
c_func
(paren
id|port
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_read after CMD 0x%x: failed&bslash;n&quot;
comma
id|READ_HARD_CFG
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|hard_cfg
(braket
l_int|1
)braket
op_assign
id|aedsp16_read
c_func
(paren
id|port
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_read after CMD 0x%x: failed&bslash;n&quot;
comma
id|READ_HARD_CFG
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_read
c_func
(paren
id|port
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_read after CMD 0x%x: failed&bslash;n&quot;
comma
id|READ_HARD_CFG
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|DBG
c_func
(paren
(paren
l_string|&quot;success.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|aedsp16_ext_cfg_write
r_static
r_int
id|__init
id|aedsp16_ext_cfg_write
c_func
(paren
r_int
id|port
)paren
(brace
r_int
id|extcfg
comma
id|val
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_66
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_66
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|extcfg
op_assign
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|decoded_hcfg.cdrom
op_ne
l_int|2
)paren
id|extcfg
op_assign
l_int|0x0F
suffix:semicolon
r_if
c_cond
(paren
(paren
id|decoded_hcfg.cdrom
op_eq
l_int|4
)paren
op_logical_or
(paren
id|decoded_hcfg.cdrom
op_eq
l_int|3
)paren
)paren
id|extcfg
op_and_assign
op_complement
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|decoded_hcfg.cdrombase
op_eq
l_int|0
)paren
id|extcfg
op_and_assign
op_complement
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|decoded_hcfg.mpubase
op_eq
l_int|0
)paren
id|extcfg
op_and_assign
op_complement
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|extcfg
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] Write extcfg: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] Write extcfg: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|decoded_hcfg.cdrom
op_eq
l_int|3
)paren
(brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_52
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_52
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|aedsp16_read
c_func
(paren
id|port
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_read after CMD 0x%x: failed&bslash;n&quot;
comma
id|COMMAND_52
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|val
op_and_assign
l_int|0x7F
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_60
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_60
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|val
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] Write val: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
)brace
r_return
id|TRUE
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_SC6600 */
DECL|function|aedsp16_cfg_write
r_static
r_int
id|__init
id|aedsp16_cfg_write
c_func
(paren
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|WRITE_MDIRQ_CFG
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|WRITE_MDIRQ_CFG
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|soft_cfg
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] Initialization of (M)IRQ and DMA: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|aedsp16_init_mss
r_static
r_int
id|__init
id|aedsp16_init_mss
c_func
(paren
r_int
id|port
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;aedsp16_init_mss:&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|DSP_INIT_MSS
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_init_mss [0x%x]: failed!&bslash;n&quot;
comma
id|DSP_INIT_MSS
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failure.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_cfg_write
c_func
(paren
id|port
)paren
op_eq
id|FALSE
)paren
r_return
id|FALSE
suffix:semicolon
id|outb
c_func
(paren
id|soft_cfg_mss
comma
id|ae_config.mss_base
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;success.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|aedsp16_setup_board
r_static
r_int
id|__init
id|aedsp16_setup_board
c_func
(paren
r_int
id|port
)paren
(brace
r_int
id|loop
op_assign
id|RETRY
suffix:semicolon
macro_line|#if defined(CONFIG_SC6600)
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_hard_read
c_func
(paren
id|port
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_hard_read: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_52
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_52
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|aedsp16_read
c_func
(paren
id|port
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_read after CMD 0x%x: failed&bslash;n&quot;
comma
id|COMMAND_52
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
macro_line|#endif
r_do
(brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_88
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_88
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|aedsp16_wait_data
c_func
(paren
id|port
)paren
op_eq
id|FALSE
)paren
op_logical_and
id|loop
op_decrement
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_read
c_func
(paren
id|port
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_read after CMD 0x%x: failed&bslash;n&quot;
comma
id|COMMAND_88
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
macro_line|#if !defined(CONFIG_SC6600)
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_5C
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_5C
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|aedsp16_cfg_write
c_func
(paren
id|port
)paren
op_eq
id|FALSE
)paren
r_return
id|FALSE
suffix:semicolon
macro_line|#if defined(CONFIG_SC6600)
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_60
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_60
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|val
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] DATA 0x%x: failed!&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_6E
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_6E
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|ver
(braket
l_int|0
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] DATA 0x%x: failed!&bslash;n&quot;
comma
id|ver
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|ver
(braket
l_int|1
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] DATA 0x%x: failed!&bslash;n&quot;
comma
id|ver
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_hard_write
c_func
(paren
id|port
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_hard_write: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|COMMAND_5C
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|COMMAND_5C
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
macro_line|#if defined(THIS_IS_A_THING_I_HAVE_NOT_TESTED_YET)
r_if
c_cond
(paren
id|aedsp16_cfg_write
c_func
(paren
id|port
)paren
op_eq
id|FALSE
)paren
r_return
id|FALSE
suffix:semicolon
macro_line|#endif
macro_line|#endif
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|aedsp16_stdcfg
r_static
r_int
id|__init
id|aedsp16_stdcfg
c_func
(paren
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
id|WRITE_MDIRQ_CFG
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|WRITE_MDIRQ_CFG
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * 0x0A == (IRQ 7, DMA 1, MIRQ 0)&n;&t; */
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|port
comma
l_int|0x0A
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_stdcfg: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|aedsp16_dsp_version
r_static
r_int
id|__init
id|aedsp16_dsp_version
c_func
(paren
r_int
id|port
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;Get DSP Version:&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|ae_config.base_io
comma
id|GET_DSP_VERSION
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|GET_DSP_VERSION
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failed.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_do
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aedsp16_read
c_func
(paren
id|port
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;failed.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * We already know how many int are stored (2), so we know when the&n;&t; * string is finished.&n;&t; */
id|ver
(braket
id|len
op_increment
)braket
op_assign
id|ret
suffix:semicolon
)brace
r_while
c_loop
(paren
id|len
OL
id|CARDVERLEN
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|DSPVersion
comma
l_string|&quot;%d.%d&quot;
comma
id|ver
(braket
l_int|0
)braket
comma
id|ver
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;success.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|aedsp16_dsp_copyright
r_static
r_int
id|__init
id|aedsp16_dsp_copyright
c_func
(paren
r_int
id|port
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;Get DSP Copyright:&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_write
c_func
(paren
id|ae_config.base_io
comma
id|GET_DSP_COPYRIGHT
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] CMD 0x%x: failed!&bslash;n&quot;
comma
id|GET_DSP_COPYRIGHT
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;failed.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_do
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|aedsp16_read
c_func
(paren
id|port
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/*&n;&t; * If no more data available, return to the caller, no error if len&gt;0.&n;&t; * We have no other way to know when the string is finished.&n;&t; */
r_if
c_cond
(paren
id|len
)paren
r_break
suffix:semicolon
r_else
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;failed.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
)brace
id|DSPCopyright
(braket
id|len
op_increment
)braket
op_assign
id|ret
suffix:semicolon
)brace
r_while
c_loop
(paren
id|len
OL
id|CARDNAMELEN
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;success.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|aedsp16_init_tables
r_static
r_void
id|__init
id|aedsp16_init_tables
c_func
(paren
r_void
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|DSPCopyright
comma
l_int|0
comma
id|CARDNAMELEN
op_plus
l_int|1
)paren
suffix:semicolon
id|memset
c_func
(paren
id|DSPVersion
comma
l_int|0
comma
id|CARDVERLEN
op_plus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|orIRQ
(braket
id|i
)braket
dot
op_logical_or
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|orIRQ
(braket
id|i
)braket
dot
id|val
op_eq
id|ae_config.irq
)paren
(brace
id|soft_cfg
op_or_assign
id|orIRQ
(braket
id|i
)braket
dot
op_logical_or
suffix:semicolon
id|soft_cfg_mss
op_or_assign
id|orIRQ
(braket
id|i
)braket
dot
op_logical_or
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|orMIRQ
(braket
id|i
)braket
dot
op_logical_or
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|orMIRQ
(braket
id|i
)braket
dot
op_logical_or
op_eq
id|ae_config.mpu_irq
)paren
id|soft_cfg
op_or_assign
id|orMIRQ
(braket
id|i
)braket
dot
op_logical_or
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|orDMA
(braket
id|i
)braket
dot
op_logical_or
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|orDMA
(braket
id|i
)braket
dot
id|val
op_eq
id|ae_config.dma
)paren
(brace
id|soft_cfg
op_or_assign
id|orDMA
(braket
id|i
)braket
dot
op_logical_or
suffix:semicolon
id|soft_cfg_mss
op_or_assign
id|orDMA
(braket
id|i
)braket
dot
op_logical_or
suffix:semicolon
)brace
)brace
DECL|function|aedsp16_init_board
r_static
r_int
id|__init
id|aedsp16_init_board
c_func
(paren
r_void
)paren
(brace
id|aedsp16_init_tables
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_dsp_reset
c_func
(paren
id|ae_config.base_io
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_dsp_reset: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_dsp_copyright
c_func
(paren
id|ae_config.base_io
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_dsp_copyright: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * My AEDSP16 card return SC-6000 in DSPCopyright, so&n;&t; * if we have something different, we have to be warned.&n;&t; */
r_if
c_cond
(paren
id|strcmp
c_func
(paren
l_string|&quot;SC-6000&quot;
comma
id|DSPCopyright
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] Warning: non SC-6000 audio card!&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_dsp_version
c_func
(paren
id|ae_config.base_io
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_dsp_version: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_stdcfg
c_func
(paren
id|ae_config.base_io
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_stdcfg: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_SC6600)
r_if
c_cond
(paren
id|aedsp16_hard_read
c_func
(paren
id|ae_config.base_io
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_hard_read: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|aedsp16_hard_decode
c_func
(paren
)paren
suffix:semicolon
id|aedsp16_hard_encode
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aedsp16_hard_write
c_func
(paren
id|ae_config.base_io
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_hard_write: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aedsp16_ext_cfg_write
c_func
(paren
id|ae_config.base_io
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_ext_cfg_write: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_SC6600 */
r_if
c_cond
(paren
id|aedsp16_setup_board
c_func
(paren
id|ae_config.base_io
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] aedsp16_setup_board: failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ae_config.mss_base
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ae_config.init
op_amp
id|INIT_MSS
)paren
(brace
r_if
c_cond
(paren
id|aedsp16_init_mss
c_func
(paren
id|ae_config.base_io
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[AEDSP16] Can not initialize&quot;
l_string|&quot;Microsoft Sound System mode.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
)brace
)brace
macro_line|#if !defined(MODULE) || defined(AEDSP16_INFO) || defined(AEDSP16_DEBUG)
id|printk
c_func
(paren
l_string|&quot;Audio Excel DSP 16 init v%s (%s %s) [&quot;
comma
id|VERSION
comma
id|DSPCopyright
comma
id|DSPVersion
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ae_config.mpu_base
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ae_config.init
op_amp
id|INIT_MPU401
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MPU401&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ae_config.init
op_amp
id|INIT_MSS
)paren
op_logical_or
(paren
id|ae_config.init
op_amp
id|INIT_SBPRO
)paren
)paren
id|printk
c_func
(paren
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ae_config.mss_base
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ae_config.init
op_amp
id|INIT_SBPRO
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;SBPro&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ae_config.init
op_amp
id|INIT_MSS
)paren
id|printk
c_func
(paren
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ae_config.mss_base
op_ne
op_minus
l_int|1
)paren
r_if
c_cond
(paren
id|ae_config.init
op_amp
id|INIT_MSS
)paren
id|printk
c_func
(paren
l_string|&quot;MSS&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;]&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif /* MODULE || AEDSP16_INFO || AEDSP16_DEBUG */
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|init_aedsp16_sb
r_static
r_int
id|__init
id|init_aedsp16_sb
c_func
(paren
r_void
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;init_aedsp16_sb: &quot;
)paren
)paren
suffix:semicolon
multiline_comment|/*&n; * If the card is already init&squot;ed MSS, we can not init it to SBPRO too&n; * because the board can not emulate simultaneously MSS and SBPRO.&n; */
r_if
c_cond
(paren
id|ae_config.init
op_amp
id|INIT_MSS
)paren
r_return
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|ae_config.init
op_amp
id|INIT_SBPRO
)paren
r_return
id|FALSE
suffix:semicolon
id|ae_config.init
op_or_assign
id|INIT_SBPRO
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;done.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|uninit_aedsp16_sb
r_static
r_void
id|__init
id|uninit_aedsp16_sb
c_func
(paren
r_void
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;uninit_aedsp16_sb: &quot;
)paren
)paren
suffix:semicolon
id|ae_config.init
op_and_assign
op_complement
id|INIT_SBPRO
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;done.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
DECL|function|init_aedsp16_mss
r_static
r_int
id|__init
id|init_aedsp16_mss
c_func
(paren
r_void
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;init_aedsp16_mss: &quot;
)paren
)paren
suffix:semicolon
multiline_comment|/*&n; * If the card is already init&squot;ed SBPRO, we can not init it to MSS too&n; * because the board can not emulate simultaneously MSS and SBPRO.&n; */
r_if
c_cond
(paren
id|ae_config.init
op_amp
id|INIT_SBPRO
)paren
r_return
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|ae_config.init
op_amp
id|INIT_MSS
)paren
r_return
id|FALSE
suffix:semicolon
multiline_comment|/*&n; * We must allocate the CONFIG_AEDSP16_BASE region too because these are the &n; * I/O ports to access card&squot;s control registers.&n; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ae_config.init
op_amp
id|INIT_MPU401
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|ae_config.base_io
comma
id|IOBASE_REGION_SIZE
comma
l_string|&quot;aedsp16 (base)&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AEDSP16 BASE I/O port region is already in use.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
)brace
id|ae_config.init
op_or_assign
id|INIT_MSS
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;done.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|uninit_aedsp16_mss
r_static
r_void
id|__init
id|uninit_aedsp16_mss
c_func
(paren
r_void
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;uninit_aedsp16_mss: &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|ae_config.init
op_amp
id|INIT_MPU401
)paren
)paren
op_logical_and
(paren
id|ae_config.init
op_amp
id|INIT_MSS
)paren
)paren
(brace
id|release_region
c_func
(paren
id|ae_config.base_io
comma
id|IOBASE_REGION_SIZE
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;AEDSP16 base region released.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
id|ae_config.init
op_and_assign
op_complement
id|INIT_MSS
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;done.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
DECL|function|init_aedsp16_mpu
r_static
r_int
id|__init
id|init_aedsp16_mpu
c_func
(paren
r_void
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;init_aedsp16_mpu: &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ae_config.init
op_amp
id|INIT_MPU401
)paren
r_return
id|FALSE
suffix:semicolon
multiline_comment|/*&n; * We must request the CONFIG_AEDSP16_BASE region too because these are the I/O &n; * ports to access card&squot;s control registers.&n; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ae_config.init
op_amp
(paren
id|INIT_MSS
op_or
id|INIT_SBPRO
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|ae_config.base_io
comma
id|IOBASE_REGION_SIZE
comma
l_string|&quot;aedsp16 (base)&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AEDSP16 BASE I/O port region is already in use.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
)brace
id|ae_config.init
op_or_assign
id|INIT_MPU401
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;done.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|uninit_aedsp16_mpu
r_static
r_void
id|__init
id|uninit_aedsp16_mpu
c_func
(paren
r_void
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;uninit_aedsp16_mpu: &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|ae_config.init
op_amp
(paren
id|INIT_MSS
op_or
id|INIT_SBPRO
)paren
)paren
)paren
op_logical_and
(paren
id|ae_config.init
op_amp
id|INIT_MPU401
)paren
)paren
(brace
id|release_region
c_func
(paren
id|ae_config.base_io
comma
id|IOBASE_REGION_SIZE
)paren
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;AEDSP16 base region released.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
id|ae_config.init
op_and_assign
op_complement
id|INIT_MPU401
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;done.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
DECL|function|init_aedsp16
r_int
id|__init
id|init_aedsp16
c_func
(paren
r_void
)paren
(brace
r_int
id|initialized
op_assign
id|FALSE
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;Initializing BASE[0x%x] IRQ[%d] DMA[%d] MIRQ[%d]&bslash;n&quot;
comma
id|ae_config.base_io
comma
id|ae_config.irq
comma
id|ae_config.dma
comma
id|ae_config.mpu_irq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ae_config.mss_base
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|init_aedsp16_sb
c_func
(paren
)paren
op_eq
id|FALSE
)paren
(brace
id|uninit_aedsp16_sb
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|initialized
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ae_config.mpu_base
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|init_aedsp16_mpu
c_func
(paren
)paren
op_eq
id|FALSE
)paren
(brace
id|uninit_aedsp16_mpu
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|initialized
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * In the sequence of init routines, the MSS init MUST be the last!&n; * This because of the special register programming the MSS mode needs.&n; * A board reset would disable the MSS mode restoring the default SBPRO&n; * mode.&n; */
r_if
c_cond
(paren
id|ae_config.mss_base
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|init_aedsp16_mss
c_func
(paren
)paren
op_eq
id|FALSE
)paren
(brace
id|uninit_aedsp16_mss
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|initialized
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|initialized
)paren
id|initialized
op_assign
id|aedsp16_init_board
c_func
(paren
)paren
suffix:semicolon
r_return
id|initialized
suffix:semicolon
)brace
DECL|function|uninit_aedsp16
r_void
id|__init
id|uninit_aedsp16
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|ae_config.mss_base
op_ne
op_minus
l_int|1
)paren
id|uninit_aedsp16_mss
c_func
(paren
)paren
suffix:semicolon
r_else
id|uninit_aedsp16_sb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ae_config.mpu_base
op_ne
op_minus
l_int|1
)paren
id|uninit_aedsp16_mpu
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|io
r_static
r_int
id|__initdata
id|io
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|__initdata
id|irq
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|dma
r_static
r_int
id|__initdata
id|dma
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|mpu_irq
r_static
r_int
id|__initdata
id|mpu_irq
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|mss_base
r_static
r_int
id|__initdata
id|mss_base
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|mpu_base
r_static
r_int
id|__initdata
id|mpu_base
op_assign
op_minus
l_int|1
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|io
comma
l_string|&quot;I/O base address (0x220 0x240)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq
comma
l_string|&quot;IRQ line (5 7 9 10 11)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dma
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dma
comma
l_string|&quot;dma line (0 1 3)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mpu_irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mpu_irq
comma
l_string|&quot;MPU-401 IRQ line (5 7 9 10 0)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mss_base
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mss_base
comma
l_string|&quot;MSS emulation I/O base address (0x530 0xE80)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mpu_base
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mpu_base
comma
l_string|&quot;MPU-401 I/O base address (0x300 0x310 0x320 0x330)&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Riccardo Facchetti &lt;fizban@tin.it&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Audio Excel DSP 16 Driver Version &quot;
id|VERSION
)paren
suffix:semicolon
DECL|function|do_init_aedsp16
r_static
r_int
id|__init
id|do_init_aedsp16
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Audio Excel DSP 16 init driver Copyright (C) Riccardo Facchetti 1995-98&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io
op_eq
op_minus
l_int|1
op_logical_or
id|dma
op_eq
op_minus
l_int|1
op_logical_or
id|irq
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;aedsp16: I/O, IRQ and DMA are mandatory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|ae_config.base_io
op_assign
id|io
suffix:semicolon
id|ae_config.irq
op_assign
id|irq
suffix:semicolon
id|ae_config.dma
op_assign
id|dma
suffix:semicolon
id|ae_config.mss_base
op_assign
id|mss_base
suffix:semicolon
id|ae_config.mpu_base
op_assign
id|mpu_base
suffix:semicolon
id|ae_config.mpu_irq
op_assign
id|mpu_irq
suffix:semicolon
r_if
c_cond
(paren
id|init_aedsp16
c_func
(paren
)paren
op_eq
id|FALSE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;aedsp16: initialization failed&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * XXX&n;&t;&t; * What error should we return here ?&n;&t;&t; */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_aedsp16
r_static
r_void
id|__exit
id|cleanup_aedsp16
c_func
(paren
r_void
)paren
(brace
id|uninit_aedsp16
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|do_init_aedsp16
id|module_init
c_func
(paren
id|do_init_aedsp16
)paren
suffix:semicolon
DECL|variable|cleanup_aedsp16
id|module_exit
c_func
(paren
id|cleanup_aedsp16
)paren
suffix:semicolon
macro_line|#ifndef MODULE
DECL|function|setup_aedsp16
r_static
r_int
id|__init
id|setup_aedsp16
c_func
(paren
r_char
op_star
id|str
)paren
(brace
multiline_comment|/* io, irq, dma, mss_io, mpu_io, mpu_irq */
r_int
id|ints
(braket
l_int|7
)braket
suffix:semicolon
id|str
op_assign
id|get_options
c_func
(paren
id|str
comma
id|ARRAY_SIZE
c_func
(paren
id|ints
)paren
comma
id|ints
)paren
suffix:semicolon
id|io
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
id|irq
op_assign
id|ints
(braket
l_int|2
)braket
suffix:semicolon
id|dma
op_assign
id|ints
(braket
l_int|3
)braket
suffix:semicolon
id|mss_base
op_assign
id|ints
(braket
l_int|4
)braket
suffix:semicolon
id|mpu_base
op_assign
id|ints
(braket
l_int|5
)braket
suffix:semicolon
id|mpu_irq
op_assign
id|ints
(braket
l_int|6
)braket
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;aedsp16=&quot;
comma
id|setup_aedsp16
)paren
suffix:semicolon
macro_line|#endif
eof
