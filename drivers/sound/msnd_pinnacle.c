multiline_comment|/*********************************************************************&n; *&n; * Turtle Beach MultiSound Sound Card Driver for Linux&n; * Linux 2.0/2.2 Version&n; *&n; * msnd_pinnacle.c / msnd_classic.c&n; *&n; * -- If MSND_CLASSIC is defined:&n; *&n; *     -&gt; driver for Turtle Beach Classic/Monterey/Tahiti&n; *&n; * -- Else&n; *&n; *     -&gt; driver for Turtle Beach Pinnacle/Fiji&n; *&n; * Copyright (C) 1998 Andrew Veliath&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * $Id: msnd_pinnacle.c,v 1.8 1998/08/06 21:06:14 andrewtv Exp $&n; *&n; ********************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#if LINUX_VERSION_CODE &lt; 0x020101
DECL|macro|LINUX20
macro_line|#  define LINUX20
macro_line|#endif
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#ifndef LINUX20
macro_line|#  include &lt;linux/init.h&gt;
macro_line|#endif
macro_line|#include &quot;sound_config.h&quot;
macro_line|#include &quot;sound_firmware.h&quot;
macro_line|#ifdef MSND_CLASSIC
DECL|macro|SLOWIO
macro_line|#  define SLOWIO
macro_line|#endif
macro_line|#include &quot;msnd.h&quot;
macro_line|#ifdef MSND_CLASSIC
macro_line|#  include &quot;msnd_classic.h&quot;
DECL|macro|LOGNAME
macro_line|#  define LOGNAME&t;&t;&t;&quot;msnd_classic&quot;
macro_line|#else
macro_line|#  include &quot;msnd_pinnacle.h&quot;
DECL|macro|LOGNAME
macro_line|#  define LOGNAME&t;&t;&t;&quot;msnd_pinnacle&quot;
macro_line|#endif
DECL|macro|DEVNAME
mdefine_line|#define DEVNAME&t;&t;&t;&t;dev.name
DECL|macro|MIXERMINOR
mdefine_line|#define MIXERMINOR&t;&t;&t;dev.mixer_minor
DECL|macro|DSPMINOR
mdefine_line|#define DSPMINOR&t;&t;&t;dev.dsp_minor
DECL|variable|dev
id|multisound_dev_t
id|dev
suffix:semicolon
macro_line|#ifndef HAVE_DSPCODEH
DECL|variable|dspini
DECL|variable|permini
r_static
r_char
op_star
id|dspini
comma
op_star
id|permini
suffix:semicolon
DECL|variable|sizeof_dspini
DECL|variable|sizeof_permini
r_static
r_int
id|sizeof_dspini
comma
id|sizeof_permini
suffix:semicolon
macro_line|#endif
DECL|function|reset_play_queue
r_static
r_void
id|reset_play_queue
c_func
(paren
r_void
)paren
(brace
r_int
id|n
suffix:semicolon
id|LPDAQD
id|lpDAQ
suffix:semicolon
id|msnd_fifo_make_empty
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|dev.DAPQ-&gt;wHead
op_assign
l_int|0
suffix:semicolon
id|dev.DAPQ-&gt;wTail
op_assign
id|PCTODSP_OFFSET
c_func
(paren
l_int|2
op_star
id|DAPQ_STRUCT_SIZE
)paren
suffix:semicolon
id|dev.CurDAQD
op_assign
(paren
id|LPDAQD
)paren
(paren
id|dev.base
op_plus
l_int|1
op_star
id|DAPQ_DATA_BUFF
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|memset_io
c_func
(paren
id|dev.base
comma
l_int|0
comma
id|DAP_BUFF_SIZE
op_star
l_int|3
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
comma
id|lpDAQ
op_assign
id|dev.CurDAQD
suffix:semicolon
id|n
OL
l_int|3
suffix:semicolon
op_increment
id|n
comma
op_increment
id|lpDAQ
)paren
(brace
id|writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
(paren
id|DWORD
)paren
(paren
id|DAP_BUFF_SIZE
op_star
id|n
)paren
)paren
comma
op_amp
id|lpDAQ-&gt;wStart
)paren
suffix:semicolon
id|writew
c_func
(paren
id|DAP_BUFF_SIZE
comma
op_amp
id|lpDAQ-&gt;wSize
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|1
comma
op_amp
id|lpDAQ-&gt;wFormat
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.sample_size
comma
op_amp
id|lpDAQ-&gt;wSampleSize
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.channels
comma
op_amp
id|lpDAQ-&gt;wChannels
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.sample_rate
comma
op_amp
id|lpDAQ-&gt;wSampleRate
)paren
suffix:semicolon
id|writew
c_func
(paren
id|HIMT_PLAY_DONE
op_star
l_int|0x100
op_plus
id|n
comma
op_amp
id|lpDAQ-&gt;wIntMsg
)paren
suffix:semicolon
id|writew
c_func
(paren
id|n
op_plus
l_int|1
comma
op_amp
id|lpDAQ-&gt;wFlags
)paren
suffix:semicolon
)brace
id|dev.lastbank
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|reset_record_queue
r_static
r_void
id|reset_record_queue
c_func
(paren
r_void
)paren
(brace
r_int
id|n
suffix:semicolon
id|LPDAQD
id|lpDAQ
suffix:semicolon
id|msnd_fifo_make_empty
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
id|dev.DARQ-&gt;wHead
op_assign
l_int|0
suffix:semicolon
id|dev.DARQ-&gt;wTail
op_assign
id|PCTODSP_OFFSET
c_func
(paren
l_int|2
op_star
id|DARQ_STRUCT_SIZE
)paren
suffix:semicolon
id|dev.CurDARQD
op_assign
(paren
id|LPDAQD
)paren
(paren
id|dev.base
op_plus
l_int|1
op_star
id|DARQ_DATA_BUFF
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBLKSEL_1
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|memset_io
c_func
(paren
id|dev.base
comma
l_int|0
comma
id|DAR_BUFF_SIZE
op_star
l_int|3
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
comma
id|lpDAQ
op_assign
id|dev.CurDARQD
suffix:semicolon
id|n
OL
l_int|3
suffix:semicolon
op_increment
id|n
comma
op_increment
id|lpDAQ
)paren
(brace
id|writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
(paren
id|DWORD
)paren
(paren
id|DAR_BUFF_SIZE
op_star
id|n
)paren
)paren
op_plus
l_int|0x4000
comma
op_amp
id|lpDAQ-&gt;wStart
)paren
suffix:semicolon
id|writew
c_func
(paren
id|DAR_BUFF_SIZE
comma
op_amp
id|lpDAQ-&gt;wSize
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|1
comma
op_amp
id|lpDAQ-&gt;wFormat
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.sample_size
comma
op_amp
id|lpDAQ-&gt;wSampleSize
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.channels
comma
op_amp
id|lpDAQ-&gt;wChannels
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.sample_rate
comma
op_amp
id|lpDAQ-&gt;wSampleRate
)paren
suffix:semicolon
id|writew
c_func
(paren
id|HIMT_RECORD_DONE
op_star
l_int|0x100
op_plus
id|n
comma
op_amp
id|lpDAQ-&gt;wIntMsg
)paren
suffix:semicolon
id|writew
c_func
(paren
id|n
op_plus
l_int|1
comma
op_amp
id|lpDAQ-&gt;wFlags
)paren
suffix:semicolon
)brace
)brace
DECL|function|reset_queues
r_static
r_void
id|reset_queues
c_func
(paren
r_void
)paren
(brace
id|dev.DSPQ-&gt;wHead
op_assign
id|dev.DSPQ-&gt;wTail
op_assign
l_int|0
suffix:semicolon
id|reset_play_queue
c_func
(paren
)paren
suffix:semicolon
id|reset_record_queue
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|dsp_ioctl
r_static
r_int
id|dsp_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|val
comma
id|i
comma
id|data
comma
id|tmp
suffix:semicolon
id|LPDAQD
id|lpDAQ
comma
id|lpDARQ
suffix:semicolon
id|lpDAQ
op_assign
(paren
id|LPDAQD
)paren
(paren
id|dev.base
op_plus
id|DAPQ_DATA_BUFF
)paren
suffix:semicolon
id|lpDARQ
op_assign
(paren
id|LPDAQD
)paren
(paren
id|dev.base
op_plus
id|DARQ_DATA_BUFF
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
r_case
id|SNDCTL_DSP_SETDUPLEX
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETIPTR
suffix:colon
r_case
id|SNDCTL_DSP_GETOPTR
suffix:colon
r_case
id|SNDCTL_DSP_MAPINBUF
suffix:colon
r_case
id|SNDCTL_DSP_MAPOUTBUF
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
r_case
id|SNDCTL_DSP_RESET
suffix:colon
id|reset_play_queue
c_func
(paren
)paren
suffix:semicolon
id|reset_record_queue
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
id|tmp
op_assign
id|dev.fifosize
op_div
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|tmp
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_NONBLOCK
suffix:colon
id|dev.mode
op_or_assign
id|O_NONBLOCK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETCAPS
suffix:colon
id|val
op_assign
id|DSP_CAP_DUPLEX
op_or
id|DSP_CAP_BATCH
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SAMPLESIZE
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|16
suffix:colon
r_case
l_int|8
suffix:colon
id|data
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|data
op_assign
id|DEFSAMPLESIZE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
comma
op_increment
id|lpDAQ
comma
op_increment
id|lpDARQ
)paren
(brace
id|lpDAQ-&gt;wSampleSize
op_assign
id|data
suffix:semicolon
id|lpDARQ-&gt;wSampleSize
op_assign
id|data
suffix:semicolon
)brace
id|dev.sample_size
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
l_int|8000
)paren
id|val
op_assign
l_int|8000
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
l_int|48000
)paren
id|val
op_assign
l_int|48000
suffix:semicolon
id|data
op_assign
id|val
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
comma
op_increment
id|lpDAQ
comma
op_increment
id|lpDARQ
)paren
(brace
id|lpDAQ-&gt;wSampleRate
op_assign
id|data
suffix:semicolon
id|lpDARQ-&gt;wSampleRate
op_assign
id|data
suffix:semicolon
)brace
id|dev.sample_rate
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_CHANNELS
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
id|data
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|val
op_assign
id|data
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
comma
op_increment
id|lpDAQ
comma
op_increment
id|lpDARQ
)paren
(brace
id|lpDAQ-&gt;wChannels
op_assign
id|data
suffix:semicolon
id|lpDARQ-&gt;wChannels
op_assign
id|data
suffix:semicolon
)brace
id|dev.channels
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|0
suffix:colon
id|data
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|val
op_assign
l_int|1
suffix:semicolon
r_case
l_int|1
suffix:colon
id|data
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
comma
op_increment
id|lpDAQ
comma
op_increment
id|lpDARQ
)paren
(brace
id|lpDAQ-&gt;wChannels
op_assign
id|data
suffix:semicolon
id|lpDARQ-&gt;wChannels
op_assign
id|data
suffix:semicolon
)brace
id|dev.channels
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|mixer_get
r_static
r_int
id|mixer_get
c_func
(paren
r_int
id|d
)paren
(brace
r_if
c_cond
(paren
id|d
OG
l_int|31
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|d
)paren
(brace
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
r_case
id|SOUND_MIXER_SYNTH
suffix:colon
r_case
id|SOUND_MIXER_PCM
suffix:colon
r_case
id|SOUND_MIXER_LINE
suffix:colon
macro_line|#ifndef MSND_CLASSIC
r_case
id|SOUND_MIXER_MIC
suffix:colon
macro_line|#endif
r_case
id|SOUND_MIXER_IMIX
suffix:colon
r_case
id|SOUND_MIXER_LINE1
suffix:colon
r_return
(paren
id|dev.left_levels
(braket
id|d
)braket
op_rshift
l_int|8
)paren
op_star
l_int|100
op_div
l_int|0xff
op_or
(paren
(paren
(paren
id|dev.right_levels
(braket
id|d
)braket
op_rshift
l_int|8
)paren
op_star
l_int|100
op_div
l_int|0xff
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|macro|update_vol
mdefine_line|#define update_vol(a,b,s)&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;writew(dev.left_levels[a] * readw(&amp;dev.SMA-&gt;wCurrMastVolLeft) / 0xffff / s,&t;&bslash;&n;&t;       &amp;dev.SMA-&gt;b##Left);&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;writew(dev.right_levels[a] * readw(&amp;dev.SMA-&gt;wCurrMastVolRight) / 0xffff / s,&t;&bslash;&n;&t;       &amp;dev.SMA-&gt;b##Right);
DECL|function|mixer_set
r_static
r_int
id|mixer_set
c_func
(paren
r_int
id|d
comma
r_int
id|value
)paren
(brace
r_int
id|left
op_assign
id|value
op_amp
l_int|0x000000ff
suffix:semicolon
r_int
id|right
op_assign
(paren
id|value
op_amp
l_int|0x0000ff00
)paren
op_rshift
l_int|8
suffix:semicolon
r_int
id|bLeft
comma
id|bRight
suffix:semicolon
r_int
id|wLeft
comma
id|wRight
suffix:semicolon
r_if
c_cond
(paren
id|d
OG
l_int|31
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|bLeft
op_assign
id|left
op_star
l_int|0xff
op_div
l_int|100
suffix:semicolon
id|wLeft
op_assign
id|left
op_star
l_int|0xffff
op_div
l_int|100
suffix:semicolon
id|bRight
op_assign
id|right
op_star
l_int|0xff
op_div
l_int|100
suffix:semicolon
id|wRight
op_assign
id|right
op_star
l_int|0xffff
op_div
l_int|100
suffix:semicolon
id|dev.left_levels
(braket
id|d
)braket
op_assign
id|wLeft
suffix:semicolon
id|dev.right_levels
(braket
id|d
)braket
op_assign
id|wRight
suffix:semicolon
r_switch
c_cond
(paren
id|d
)paren
(brace
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
multiline_comment|/* master volume */
id|writew
c_func
(paren
id|wLeft
op_div
l_int|2
comma
op_amp
id|dev.SMA-&gt;wCurrMastVolLeft
)paren
suffix:semicolon
id|writew
c_func
(paren
id|wRight
op_div
l_int|2
comma
op_amp
id|dev.SMA-&gt;wCurrMastVolRight
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* pot controls */
r_case
id|SOUND_MIXER_LINE
suffix:colon
multiline_comment|/* aux pot control */
id|writeb
c_func
(paren
id|bLeft
comma
op_amp
id|dev.SMA-&gt;bInPotPosLeft
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|bRight
comma
op_amp
id|dev.SMA-&gt;bInPotPosRight
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_IN_SET_POTS
)paren
op_eq
l_int|0
)paren
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
r_case
id|SOUND_MIXER_MIC
suffix:colon
multiline_comment|/* mic pot control */
id|writeb
c_func
(paren
id|bLeft
comma
op_amp
id|dev.SMA-&gt;bMicPotPosLeft
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|bRight
comma
op_amp
id|dev.SMA-&gt;bMicPotPosRight
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_MIC_SET_POTS
)paren
op_eq
l_int|0
)paren
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|SOUND_MIXER_LINE1
suffix:colon
multiline_comment|/* line pot control */
id|writeb
c_func
(paren
id|bLeft
comma
op_amp
id|dev.SMA-&gt;bAuxPotPosLeft
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|bRight
comma
op_amp
id|dev.SMA-&gt;bAuxPotPosRight
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_AUX_SET_POTS
)paren
op_eq
l_int|0
)paren
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* digital controls */
r_case
id|SOUND_MIXER_SYNTH
suffix:colon
multiline_comment|/* synth vol (dsp mix) */
r_case
id|SOUND_MIXER_PCM
suffix:colon
multiline_comment|/* pcm vol (dsp mix) */
r_case
id|SOUND_MIXER_IMIX
suffix:colon
multiline_comment|/* input monitor (dsp mix) */
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* update digital controls for master volume */
id|update_vol
c_func
(paren
id|SOUND_MIXER_PCM
comma
id|wCurrPlayVol
comma
l_int|1
)paren
suffix:semicolon
id|update_vol
c_func
(paren
id|SOUND_MIXER_IMIX
comma
id|wCurrInVol
comma
l_int|1
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|update_vol
c_func
(paren
id|SOUND_MIXER_SYNTH
comma
id|wCurrMHdrVol
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
r_return
id|mixer_get
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
DECL|function|set_recsrc
r_static
r_int
r_int
id|set_recsrc
c_func
(paren
r_int
r_int
id|recsrc
)paren
(brace
r_if
c_cond
(paren
id|dev.recsrc
op_eq
id|recsrc
)paren
r_return
id|dev.recsrc
suffix:semicolon
macro_line|#ifdef HAVE_NORECSRC
r_else
r_if
c_cond
(paren
id|recsrc
op_eq
l_int|0
)paren
id|dev.recsrc
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_else
id|dev.recsrc
op_xor_assign
id|recsrc
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
r_if
c_cond
(paren
id|dev.recsrc
op_amp
id|SOUND_MASK_LINE
)paren
(brace
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_SET_ANA_IN
)paren
op_eq
l_int|0
)paren
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev.recsrc
op_amp
id|SOUND_MASK_SYNTH
)paren
(brace
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_SET_SYNTH_IN
)paren
op_eq
l_int|0
)paren
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev.recsrc
op_amp
id|SOUND_MASK_DIGITAL1
)paren
op_logical_and
id|test_bit
c_func
(paren
id|F_HAVEDIGITAL
comma
op_amp
id|dev.flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_SET_DAT_IN
)paren
op_eq
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
macro_line|#ifdef HAVE_NORECSRC
multiline_comment|/* Select no input (?) */
id|dev.recsrc
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|dev.recsrc
op_assign
id|SOUND_MASK_LINE
suffix:semicolon
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_SET_ANA_IN
)paren
op_eq
l_int|0
)paren
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif /* MSND_CLASSIC */
r_return
id|dev.recsrc
suffix:semicolon
)brace
DECL|macro|set_mixer_info
mdefine_line|#define set_mixer_info()&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;strncpy(info.id, &quot;MSNDMIXER&quot;, sizeof(info.id));&t;&t;&t;&bslash;&n;&t;&t;strncpy(info.name, &quot;MultiSound Mixer&quot;, sizeof(info.name));
DECL|function|mixer_ioctl
r_static
r_int
id|mixer_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_INFO
)paren
(brace
id|mixer_info
id|info
suffix:semicolon
id|set_mixer_info
c_func
(paren
)paren
suffix:semicolon
id|info.modify_counter
op_assign
id|dev.mixer_mod_count
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_OLD_MIXER_INFO
)paren
(brace
id|_old_mixer_info
id|info
suffix:semicolon
id|set_mixer_info
c_func
(paren
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|OSS_GETVERSION
)paren
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
(paren
id|cmd
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_eq
l_char|&squot;M&squot;
)paren
(brace
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_amp
id|_SIOC_WRITE
)paren
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|set_recsrc
c_func
(paren
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|mixer_set
c_func
(paren
id|cmd
op_amp
l_int|0xff
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
op_increment
id|dev.mixer_mod_count
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
id|val
op_assign
id|dev.recsrc
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
id|val
op_assign
id|SOUND_MASK_VOLUME
op_or
macro_line|#ifndef MSND_CLASSIC
id|SOUND_MASK_SYNTH
op_or
id|SOUND_MASK_MIC
op_or
macro_line|#endif
id|SOUND_MASK_PCM
op_or
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_IMIX
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
macro_line|#ifdef MSND_CLASSIC
id|val
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|val
op_assign
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_SYNTH
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_HAVEDIGITAL
comma
op_amp
id|dev.flags
)paren
)paren
id|val
op_or_assign
id|SOUND_MASK_DIGITAL1
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
id|val
op_assign
id|SOUND_CAP_EXCL_INPUT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|mixer_get
c_func
(paren
id|cmd
op_amp
l_int|0xff
)paren
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|dev_ioctl
r_static
r_int
id|dev_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|DSPMINOR
)paren
r_return
id|dsp_ioctl
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|minor
op_eq
id|MIXERMINOR
)paren
r_return
id|mixer_ioctl
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|dsp_halt
r_static
r_void
id|dsp_halt
c_func
(paren
r_void
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef LINUX20
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
)paren
(brace
id|clear_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
)paren
(brace
macro_line|#endif
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_RECORD_STOP
)paren
suffix:semicolon
id|msnd_disable_irq
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef LINUX20
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
)paren
(brace
id|clear_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
)paren
(brace
macro_line|#endif
id|set_bit
c_func
(paren
id|F_WRITEFLUSH
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|dev.writeflush
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|current-&gt;timeout
op_assign
id|jiffies
op_plus
id|DAP_BUFF_SIZE
op_div
l_int|2
op_star
id|HZ
op_div
id|dev.sample_rate
op_div
id|dev.channels
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|current-&gt;timeout
op_assign
l_int|0
suffix:semicolon
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_PLAY_STOP
)paren
suffix:semicolon
id|msnd_disable_irq
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
id|memset_io
c_func
(paren
id|dev.base
comma
l_int|0
comma
id|DAP_BUFF_SIZE
op_star
l_int|3
)paren
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|reset_queues
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|dsp_open
r_static
r_int
id|dsp_open
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
id|dev.mode
op_assign
id|file-&gt;f_mode
suffix:semicolon
id|set_bit
c_func
(paren
id|F_AUDIO_INUSE
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|reset_queues
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dsp_close
r_static
r_int
id|dsp_close
c_func
(paren
r_void
)paren
(brace
id|dsp_halt
c_func
(paren
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_AUDIO_INUSE
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dev_open
r_static
r_int
id|dev_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|DSPMINOR
)paren
(brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_AUDIO_INUSE
comma
op_amp
id|dev.flags
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|err
op_assign
id|dsp_open
c_func
(paren
id|file
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|minor
op_eq
id|MIXERMINOR
)paren
(brace
multiline_comment|/* nothing */
)brace
r_else
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|0
)paren
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef LINUX20
DECL|function|dev_close
r_static
r_void
id|dev_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
macro_line|#else
r_static
r_int
id|dev_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
macro_line|#endif
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
macro_line|#ifndef LINUX20
r_int
id|err
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|minor
op_eq
id|DSPMINOR
)paren
(brace
macro_line|#ifndef LINUX20
id|err
op_assign
macro_line|#endif
id|dsp_close
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|minor
op_eq
id|MIXERMINOR
)paren
(brace
multiline_comment|/* nothing */
)brace
macro_line|#ifndef LINUX20
r_else
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|0
)paren
macro_line|#endif
id|MOD_DEC_USE_COUNT
suffix:semicolon
macro_line|#ifndef LINUX20&t;
r_return
id|err
suffix:semicolon
macro_line|#endif
)brace
DECL|function|DAPF_to_bank
r_static
r_int
id|DAPF_to_bank
c_func
(paren
r_int
id|bank
)paren
(brace
r_return
id|msnd_fifo_read
c_func
(paren
op_amp
id|dev.DAPF
comma
id|dev.base
op_plus
id|bank
op_star
id|DAP_BUFF_SIZE
comma
id|DAP_BUFF_SIZE
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|bank_to_DARF
r_static
r_int
id|bank_to_DARF
c_func
(paren
r_int
id|bank
)paren
(brace
r_return
id|msnd_fifo_write
c_func
(paren
op_amp
id|dev.DARF
comma
id|dev.base
op_plus
id|bank
op_star
id|DAR_BUFF_SIZE
comma
id|DAR_BUFF_SIZE
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|dsp_read
r_static
r_int
id|dsp_read
c_func
(paren
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|count
op_assign
id|len
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|msnd_fifo_read
c_func
(paren
op_amp
id|dev.DARF
comma
id|buf
comma
id|count
comma
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: FIFO read error&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
id|buf
op_add_assign
id|n
suffix:semicolon
id|count
op_sub_assign
id|n
suffix:semicolon
macro_line|#ifdef LINUX20&t;&t;
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
op_logical_and
(paren
id|dev.mode
op_amp
id|FMODE_READ
)paren
)paren
(brace
id|set_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
op_logical_and
(paren
id|dev.mode
op_amp
id|FMODE_READ
)paren
)paren
(brace
macro_line|#endif
id|reset_record_queue
c_func
(paren
)paren
suffix:semicolon
id|msnd_enable_irq
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_RECORD_START
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev.mode
op_amp
id|O_NONBLOCK
)paren
r_return
id|count
op_eq
id|len
ques
c_cond
op_minus
id|EAGAIN
suffix:colon
id|len
op_minus
id|count
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
(brace
id|set_bit
c_func
(paren
id|F_READBLOCK
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|dev.readblock
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_READBLOCK
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
id|err
op_assign
op_minus
id|EINTR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
id|len
op_minus
id|count
suffix:semicolon
)brace
DECL|function|dsp_write
r_static
r_int
id|dsp_write
c_func
(paren
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|count
op_assign
id|len
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|msnd_fifo_write
c_func
(paren
op_amp
id|dev.DAPF
comma
id|buf
comma
id|count
comma
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: FIFO write error&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
id|buf
op_add_assign
id|n
suffix:semicolon
id|count
op_sub_assign
id|n
suffix:semicolon
macro_line|#ifdef LINUX20
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
op_logical_and
(paren
id|dev.mode
op_amp
id|FMODE_WRITE
)paren
)paren
(brace
id|set_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
op_logical_and
(paren
id|dev.mode
op_amp
id|FMODE_WRITE
)paren
)paren
(brace
macro_line|#endif
id|reset_play_queue
c_func
(paren
)paren
suffix:semicolon
id|msnd_enable_irq
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_PLAY_START
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev.mode
op_amp
id|O_NONBLOCK
)paren
r_return
id|count
op_eq
id|len
ques
c_cond
op_minus
id|EAGAIN
suffix:colon
id|len
op_minus
id|count
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
(brace
id|set_bit
c_func
(paren
id|F_WRITEBLOCK
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|dev.writeblock
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_WRITEBLOCK
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
id|err
op_assign
op_minus
id|EINTR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
id|len
op_minus
id|count
suffix:semicolon
)brace
macro_line|#ifdef LINUX20
DECL|function|dev_read
r_static
r_int
id|dev_read
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
macro_line|#else
r_static
id|ssize_t
id|dev_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|minor
op_eq
id|DSPMINOR
)paren
(brace
r_return
id|dsp_read
c_func
(paren
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#ifdef LINUX20
DECL|function|dev_write
r_static
r_int
id|dev_write
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
macro_line|#else
r_static
id|ssize_t
id|dev_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|minor
op_eq
id|DSPMINOR
)paren
(brace
r_return
id|dsp_write
c_func
(paren
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|eval_dsp_msg
r_static
r_void
id|eval_dsp_msg
c_func
(paren
id|WORD
id|wMessage
)paren
(brace
r_switch
c_cond
(paren
id|HIBYTE
c_func
(paren
id|wMessage
)paren
)paren
(brace
r_case
id|HIMT_PLAY_DONE
suffix:colon
r_if
c_cond
(paren
id|dev.lastbank
op_eq
id|LOBYTE
c_func
(paren
id|wMessage
)paren
)paren
r_break
suffix:semicolon
id|dev.lastbank
op_assign
id|LOBYTE
c_func
(paren
id|wMessage
)paren
suffix:semicolon
id|dev.CurDAQD-&gt;wSize
op_assign
id|DAP_BUFF_SIZE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev.DAPQ-&gt;wTail
op_add_assign
id|PCTODSP_OFFSET
c_func
(paren
id|DAPQ_STRUCT_SIZE
)paren
)paren
OG
id|dev.DAPQ-&gt;wSize
)paren
id|dev.DAPQ-&gt;wTail
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|dev.CurDAQD
OG
(paren
id|LPDAQD
)paren
(paren
id|dev.base
op_plus
id|DAPQ_DATA_BUFF
op_plus
l_int|2
op_star
id|DAPQ_STRUCT_SIZE
)paren
)paren
id|dev.CurDAQD
op_assign
(paren
id|LPDAQD
)paren
(paren
id|dev.base
op_plus
id|DAPQ_DATA_BUFF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev.lastbank
OL
l_int|3
)paren
(brace
r_if
c_cond
(paren
id|DAPF_to_bank
c_func
(paren
id|dev.lastbank
)paren
OG
l_int|0
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_PLAY_START
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|F_WRITEBLOCK
comma
op_amp
id|dev.flags
)paren
)paren
(brace
id|clear_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
macro_line|#ifdef LINUX20
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_WRITEFLUSH
comma
op_amp
id|dev.flags
)paren
)paren
(brace
id|clear_bit
c_func
(paren
id|F_WRITEFLUSH
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev.writeflush
)paren
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|F_WRITEFLUSH
comma
op_amp
id|dev.flags
)paren
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev.writeflush
)paren
suffix:semicolon
macro_line|#endif
id|msnd_disable_irq
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_WRITEBLOCK
comma
op_amp
id|dev.flags
)paren
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev.writeblock
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIMT_RECORD_DONE
suffix:colon
(brace
id|WORD
id|wTemp
suffix:semicolon
id|wTemp
op_assign
id|dev.DARQ-&gt;wTail
op_plus
(paren
id|DARQ_STRUCT_SIZE
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wTemp
OG
id|dev.DARQ-&gt;wSize
)paren
id|wTemp
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|wTemp
op_eq
id|dev.DARQ-&gt;wHead
)paren
suffix:semicolon
id|dev.DARQ-&gt;wTail
op_assign
id|wTemp
suffix:semicolon
id|outb
c_func
(paren
id|HPBLKSEL_1
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bank_to_DARF
c_func
(paren
id|LOBYTE
c_func
(paren
id|wMessage
)paren
)paren
op_eq
l_int|0
op_logical_and
op_logical_neg
id|test_bit
c_func
(paren
id|F_READBLOCK
comma
op_amp
id|dev.flags
)paren
)paren
(brace
id|memset_io
c_func
(paren
id|dev.base
comma
l_int|0
comma
id|DAR_BUFF_SIZE
op_star
l_int|3
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|msnd_disable_irq
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_READBLOCK
comma
op_amp
id|dev.flags
)paren
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev.readblock
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HIMT_DSP
suffix:colon
r_switch
c_cond
(paren
id|LOBYTE
c_func
(paren
id|wMessage
)paren
)paren
(brace
macro_line|#ifndef MSND_CLASSIC
r_case
id|HIDSP_PLAY_UNDER
suffix:colon
macro_line|#endif
r_case
id|HIDSP_INT_PLAY_UNDER
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Write underflow&bslash;n&quot;
)paren
suffix:semicolon
id|reset_play_queue
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIDSP_INT_RECORD_OVER
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Read overflow&bslash;n&quot;
)paren
suffix:semicolon
id|reset_record_queue
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
id|LOGNAME
l_string|&quot;: DSP message %u&bslash;n&quot;
comma
id|LOBYTE
c_func
(paren
id|wMessage
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HIMT_MIDI_IN_UCHAR
suffix:colon
r_if
c_cond
(paren
id|dev.midi_in_interrupt
)paren
(paren
op_star
id|dev.midi_in_interrupt
)paren
(paren
op_amp
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIMT_MIDI_OUT
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
id|LOGNAME
l_string|&quot;: MIDI out event&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
id|LOGNAME
l_string|&quot;: HIMT message %u&bslash;n&quot;
comma
id|HIBYTE
c_func
(paren
id|wMessage
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|intr
r_static
r_void
id|intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_INTERRUPT
comma
op_amp
id|dev.flags
)paren
)paren
r_return
suffix:semicolon
id|set_bit
c_func
(paren
id|F_INTERRUPT
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_BANKONE
comma
op_amp
id|dev.flags
)paren
)paren
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|inb
c_func
(paren
id|dev.io
op_plus
id|HP_RXL
)paren
suffix:semicolon
r_while
c_loop
(paren
id|dev.DSPQ-&gt;wTail
op_ne
id|dev.DSPQ-&gt;wHead
)paren
(brace
id|eval_dsp_msg
c_func
(paren
op_star
(paren
id|dev.pwDSPQData
op_plus
id|dev.DSPQ-&gt;wHead
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|dev.DSPQ-&gt;wHead
OG
id|dev.DSPQ-&gt;wSize
)paren
id|dev.DSPQ-&gt;wHead
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_BANKONE
comma
op_amp
id|dev.flags
)paren
)paren
id|outb
c_func
(paren
id|HPBLKSEL_1
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_INTERRUPT
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
)brace
DECL|variable|dev_fileops
r_static
r_struct
id|file_operations
id|dev_fileops
op_assign
(brace
l_int|NULL
comma
id|dev_read
comma
id|dev_write
comma
l_int|NULL
comma
l_int|NULL
comma
id|dev_ioctl
comma
l_int|NULL
comma
id|dev_open
comma
id|dev_close
comma
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|reset_dsp
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|timeout
op_assign
l_int|20000
suffix:semicolon
id|outb
c_func
(paren
id|HPDSPRESET_ON
comma
id|dev.io
op_plus
id|HP_DSPR
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|dev.info
op_assign
id|inb
c_func
(paren
id|dev.io
op_plus
id|HP_INFO
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPDSPRESET_OFF
comma
id|dev.io
op_plus
id|HP_DSPR
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|inb
c_func
(paren
id|dev.io
op_plus
id|HP_CVR
)paren
op_eq
id|HP_CVR_DEF
)paren
r_return
l_int|0
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Cannot reset DSP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|probe_multisound
c_func
(paren
r_void
)paren
)paren
(brace
macro_line|#ifndef MSND_CLASSIC
r_char
op_star
id|xv
comma
op_star
id|rev
op_assign
l_int|NULL
suffix:semicolon
r_char
op_star
id|pin
op_assign
l_string|&quot;Pinnacle&quot;
comma
op_star
id|fiji
op_assign
l_string|&quot;Fiji&quot;
suffix:semicolon
r_char
op_star
id|pinfiji
op_assign
l_string|&quot;Pinnacle/Fiji&quot;
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: I/O port conflict&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|request_region
c_func
(paren
id|dev.io
comma
id|dev.numio
comma
l_string|&quot;probing&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reset_dsp
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: DSP reset successful&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef MSND_CLASSIC
id|dev.name
op_assign
l_string|&quot;Classic/Tahiti/Monterey&quot;
suffix:semicolon
id|printk
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Turtle Beach %s, &quot;
macro_line|#else
r_switch
c_cond
(paren
id|dev.info
op_rshift
l_int|4
)paren
(brace
r_case
l_int|0xf
suffix:colon
id|xv
op_assign
l_string|&quot;&lt;= 1.15&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1
suffix:colon
id|xv
op_assign
l_string|&quot;1.18/1.2&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
id|xv
op_assign
l_string|&quot;1.3&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
id|xv
op_assign
l_string|&quot;1.4&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|xv
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|dev.info
op_amp
l_int|0x7
)paren
(brace
r_case
l_int|0x0
suffix:colon
id|rev
op_assign
l_string|&quot;I&quot;
suffix:semicolon
id|dev.name
op_assign
id|pin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1
suffix:colon
id|rev
op_assign
l_string|&quot;F&quot;
suffix:semicolon
id|dev.name
op_assign
id|pin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
id|rev
op_assign
l_string|&quot;G&quot;
suffix:semicolon
id|dev.name
op_assign
id|pin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
id|rev
op_assign
l_string|&quot;H&quot;
suffix:semicolon
id|dev.name
op_assign
id|pin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x4
suffix:colon
id|rev
op_assign
l_string|&quot;E&quot;
suffix:semicolon
id|dev.name
op_assign
id|fiji
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x5
suffix:colon
id|rev
op_assign
l_string|&quot;C&quot;
suffix:semicolon
id|dev.name
op_assign
id|fiji
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x6
suffix:colon
id|rev
op_assign
l_string|&quot;D&quot;
suffix:semicolon
id|dev.name
op_assign
id|fiji
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x7
suffix:colon
id|rev
op_assign
l_string|&quot;A-B (Fiji) or A-E (Pinnacle)&quot;
suffix:semicolon
id|dev.name
op_assign
id|pinfiji
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Turtle Beach %s revision %s, Xilinx version %s, &quot;
macro_line|#endif /* MSND_CLASSIC */
l_string|&quot;I/O 0x%x-0x%x, IRQ %d, memory mapped to 0x%p-0x%p&bslash;n&quot;
comma
id|dev.name
comma
macro_line|#ifndef MSND_CLASSIC
id|rev
comma
id|xv
comma
macro_line|#endif
id|dev.io
comma
id|dev.io
op_plus
id|dev.numio
op_minus
l_int|1
comma
id|dev.irq
comma
id|dev.base
comma
id|dev.base
op_plus
l_int|0x7fff
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|init_sma
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|n
suffix:semicolon
id|LPDAQD
id|lpDAQ
suffix:semicolon
macro_line|#ifdef MSND_CLASSIC
id|outb
c_func
(paren
id|dev.memid
comma
id|dev.io
op_plus
id|HP_MEMM
)paren
suffix:semicolon
macro_line|#endif
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|memset_io
c_func
(paren
id|dev.base
comma
l_int|0
comma
l_int|0x8000
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBLKSEL_1
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|memset_io
c_func
(paren
id|dev.base
comma
l_int|0
comma
l_int|0x8000
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|dev.DAPQ
op_assign
(paren
r_struct
id|JobQueueStruct
op_star
)paren
(paren
id|dev.base
op_plus
id|DAPQ_OFFSET
)paren
suffix:semicolon
id|dev.DARQ
op_assign
(paren
r_struct
id|JobQueueStruct
op_star
)paren
(paren
id|dev.base
op_plus
id|DARQ_OFFSET
)paren
suffix:semicolon
id|dev.MODQ
op_assign
(paren
r_struct
id|JobQueueStruct
op_star
)paren
(paren
id|dev.base
op_plus
id|MODQ_OFFSET
)paren
suffix:semicolon
id|dev.MIDQ
op_assign
(paren
r_struct
id|JobQueueStruct
op_star
)paren
(paren
id|dev.base
op_plus
id|MIDQ_OFFSET
)paren
suffix:semicolon
id|dev.DSPQ
op_assign
(paren
r_struct
id|JobQueueStruct
op_star
)paren
(paren
id|dev.base
op_plus
id|DSPQ_OFFSET
)paren
suffix:semicolon
id|dev.SMA
op_assign
(paren
r_struct
id|SMA0_CommonData
op_star
)paren
(paren
id|dev.base
op_plus
id|SMA_STRUCT_START
)paren
suffix:semicolon
id|dev.CurDAQD
op_assign
(paren
id|LPDAQD
)paren
(paren
id|dev.base
op_plus
id|DAPQ_DATA_BUFF
)paren
suffix:semicolon
id|dev.CurDARQD
op_assign
(paren
id|LPDAQD
)paren
(paren
id|dev.base
op_plus
id|DARQ_DATA_BUFF
)paren
suffix:semicolon
id|dev.sample_size
op_assign
id|DEFSAMPLESIZE
suffix:semicolon
id|dev.sample_rate
op_assign
id|DEFSAMPLERATE
suffix:semicolon
id|dev.channels
op_assign
id|DEFCHANNELS
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
comma
id|lpDAQ
op_assign
id|dev.CurDAQD
suffix:semicolon
id|n
OL
l_int|3
suffix:semicolon
op_increment
id|n
comma
op_increment
id|lpDAQ
)paren
(brace
id|writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
(paren
id|DWORD
)paren
(paren
id|DAP_BUFF_SIZE
op_star
id|n
)paren
)paren
comma
op_amp
id|lpDAQ-&gt;wStart
)paren
suffix:semicolon
id|writew
c_func
(paren
id|DAP_BUFF_SIZE
comma
op_amp
id|lpDAQ-&gt;wSize
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|1
comma
op_amp
id|lpDAQ-&gt;wFormat
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.sample_size
comma
op_amp
id|lpDAQ-&gt;wSampleSize
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.channels
comma
op_amp
id|lpDAQ-&gt;wChannels
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.sample_rate
comma
op_amp
id|lpDAQ-&gt;wSampleRate
)paren
suffix:semicolon
id|writew
c_func
(paren
id|HIMT_PLAY_DONE
op_star
l_int|0x100
op_plus
id|n
comma
op_amp
id|lpDAQ-&gt;wIntMsg
)paren
suffix:semicolon
id|writew
c_func
(paren
id|n
op_plus
l_int|1
comma
op_amp
id|lpDAQ-&gt;wFlags
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|n
op_assign
l_int|0
comma
id|lpDAQ
op_assign
id|dev.CurDARQD
suffix:semicolon
id|n
OL
l_int|3
suffix:semicolon
op_increment
id|n
comma
op_increment
id|lpDAQ
)paren
(brace
id|writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
(paren
id|DWORD
)paren
(paren
id|DAR_BUFF_SIZE
op_star
id|n
)paren
)paren
op_plus
l_int|0x4000
comma
op_amp
id|lpDAQ-&gt;wStart
)paren
suffix:semicolon
id|writew
c_func
(paren
id|DAR_BUFF_SIZE
comma
op_amp
id|lpDAQ-&gt;wSize
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|1
comma
op_amp
id|lpDAQ-&gt;wFormat
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.sample_size
comma
op_amp
id|lpDAQ-&gt;wSampleSize
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.channels
comma
op_amp
id|lpDAQ-&gt;wChannels
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.sample_rate
comma
op_amp
id|lpDAQ-&gt;wSampleRate
)paren
suffix:semicolon
id|writew
c_func
(paren
id|HIMT_RECORD_DONE
op_star
l_int|0x100
op_plus
id|n
comma
op_amp
id|lpDAQ-&gt;wIntMsg
)paren
suffix:semicolon
id|writew
c_func
(paren
id|n
op_plus
l_int|1
comma
op_amp
id|lpDAQ-&gt;wFlags
)paren
suffix:semicolon
)brace
id|dev.pwDSPQData
op_assign
(paren
id|WORD
op_star
)paren
(paren
id|dev.base
op_plus
id|DSPQ_DATA_BUFF
)paren
suffix:semicolon
id|dev.pwMODQData
op_assign
(paren
id|WORD
op_star
)paren
(paren
id|dev.base
op_plus
id|MODQ_DATA_BUFF
)paren
suffix:semicolon
id|dev.pwMIDQData
op_assign
(paren
id|WORD
op_star
)paren
(paren
id|dev.base
op_plus
id|MIDQ_DATA_BUFF
)paren
suffix:semicolon
id|writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
id|MIDQ_DATA_BUFF
)paren
comma
op_amp
id|dev.MIDQ-&gt;wStart
)paren
suffix:semicolon
id|writew
c_func
(paren
id|PCTODSP_OFFSET
c_func
(paren
id|MIDQ_BUFF_SIZE
)paren
op_minus
l_int|1
comma
op_amp
id|dev.MIDQ-&gt;wSize
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.MIDQ-&gt;wHead
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.MIDQ-&gt;wTail
)paren
suffix:semicolon
id|writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
id|MODQ_DATA_BUFF
)paren
comma
op_amp
id|dev.MODQ-&gt;wStart
)paren
suffix:semicolon
id|writew
c_func
(paren
id|PCTODSP_OFFSET
c_func
(paren
id|MODQ_BUFF_SIZE
)paren
op_minus
l_int|1
comma
op_amp
id|dev.MODQ-&gt;wSize
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.MODQ-&gt;wHead
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.MODQ-&gt;wTail
)paren
suffix:semicolon
id|writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
id|DAPQ_DATA_BUFF
)paren
comma
op_amp
id|dev.DAPQ-&gt;wStart
)paren
suffix:semicolon
id|writew
c_func
(paren
id|PCTODSP_OFFSET
c_func
(paren
id|DAPQ_BUFF_SIZE
)paren
op_minus
l_int|1
comma
op_amp
id|dev.DAPQ-&gt;wSize
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.DAPQ-&gt;wHead
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.DAPQ-&gt;wTail
)paren
suffix:semicolon
id|writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
id|DARQ_DATA_BUFF
)paren
comma
op_amp
id|dev.DARQ-&gt;wStart
)paren
suffix:semicolon
id|writew
c_func
(paren
id|PCTODSP_OFFSET
c_func
(paren
id|DARQ_BUFF_SIZE
)paren
op_minus
l_int|1
comma
op_amp
id|dev.DARQ-&gt;wSize
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.DARQ-&gt;wHead
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.DARQ-&gt;wTail
)paren
suffix:semicolon
id|writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
id|DSPQ_DATA_BUFF
)paren
comma
op_amp
id|dev.DSPQ-&gt;wStart
)paren
suffix:semicolon
id|writew
c_func
(paren
id|PCTODSP_OFFSET
c_func
(paren
id|DSPQ_BUFF_SIZE
)paren
op_minus
l_int|1
comma
op_amp
id|dev.DSPQ-&gt;wSize
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.DSPQ-&gt;wHead
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.DSPQ-&gt;wTail
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;wCurrPlayBytes
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;wCurrRecordBytes
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;wCurrPlayVolLeft
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;wCurrPlayVolRight
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;wCurrInVolLeft
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;wCurrInVolRight
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;wCurrMastVolLeft
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;wCurrMastVolRight
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|writel
c_func
(paren
l_int|0x00010000
comma
op_amp
id|dev.SMA-&gt;dwCurrPlayPitch
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000001
comma
op_amp
id|dev.SMA-&gt;dwCurrPlayRate
)paren
suffix:semicolon
macro_line|#endif
id|writew
c_func
(paren
l_int|0x0000
comma
op_amp
id|dev.SMA-&gt;wCurrDSPStatusFlags
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0x0000
comma
op_amp
id|dev.SMA-&gt;wCurrHostStatusFlags
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0x303
comma
op_amp
id|dev.SMA-&gt;wCurrInputTagBits
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;wCurrLeftPeak
)paren
suffix:semicolon
id|writew
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;wCurrRightPeak
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;bInPotPosRight
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;bInPotPosLeft
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;bAuxPotPosRight
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
op_amp
id|dev.SMA-&gt;bAuxPotPosLeft
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|writew
c_func
(paren
l_int|1
comma
op_amp
id|dev.SMA-&gt;wCurrPlayFormat
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.sample_size
comma
op_amp
id|dev.SMA-&gt;wCurrPlaySampleSize
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.channels
comma
op_amp
id|dev.SMA-&gt;wCurrPlayChannels
)paren
suffix:semicolon
id|writew
c_func
(paren
id|dev.sample_rate
comma
op_amp
id|dev.SMA-&gt;wCurrPlaySampleRate
)paren
suffix:semicolon
macro_line|#endif
id|writew
c_func
(paren
id|dev.sample_rate
comma
op_amp
id|dev.SMA-&gt;wCalFreqAtoD
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|calibrate_adc
c_func
(paren
id|WORD
id|srate
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev.calibrate_signal
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: ADC calibration to board ground &quot;
)paren
suffix:semicolon
id|writew
c_func
(paren
id|readw
c_func
(paren
op_amp
id|dev.SMA-&gt;wCurrHostStatusFlags
)paren
op_or
l_int|0x0001
comma
op_amp
id|dev.SMA-&gt;wCurrHostStatusFlags
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: ADC calibration to signal ground &quot;
)paren
suffix:semicolon
id|writew
c_func
(paren
id|readw
c_func
(paren
op_amp
id|dev.SMA-&gt;wCurrHostStatusFlags
)paren
op_amp
op_complement
l_int|0x0001
comma
op_amp
id|dev.SMA-&gt;wCurrHostStatusFlags
)paren
suffix:semicolon
)brace
id|writew
c_func
(paren
id|srate
comma
op_amp
id|dev.SMA-&gt;wCalFreqAtoD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_CAL_A_TO_D
)paren
op_eq
l_int|0
op_logical_and
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
op_eq
l_int|0
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|current-&gt;timeout
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|current-&gt;timeout
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;successful&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|upload_dsp_code
c_func
(paren
r_void
)paren
)paren
(brace
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
macro_line|#ifdef HAVE_DSPCODEH
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Using resident Turtle Beach DSP code&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else&t;
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Loading Turtle Beach DSP code&bslash;n&quot;
)paren
suffix:semicolon
id|INITCODESIZE
op_assign
id|mod_firmware_load
c_func
(paren
id|INITCODEFILE
comma
op_amp
id|INITCODE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|INITCODE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Error loading &quot;
id|INITCODEFILE
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|PERMCODESIZE
op_assign
id|mod_firmware_load
c_func
(paren
id|PERMCODEFILE
comma
op_amp
id|PERMCODE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|PERMCODE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Error loading &quot;
id|PERMCODEFILE
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|INITCODE
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
macro_line|#endif
id|memcpy_toio
c_func
(paren
id|dev.base
comma
id|PERMCODE
comma
id|PERMCODESIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_upload_host
c_func
(paren
op_amp
id|dev
comma
id|INITCODE
comma
id|INITCODESIZE
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: Error uploading to DSP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#ifndef HAVE_DSPCODEH
id|vfree
c_func
(paren
id|INITCODE
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|PERMCODE
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MSND_CLASSIC
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|reset_proteus
c_func
(paren
r_void
)paren
)paren
(brace
id|outb
c_func
(paren
id|HPPRORESET_ON
comma
id|dev.io
op_plus
id|HP_PROR
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|TIME_PRO_RESET
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPPRORESET_OFF
comma
id|dev.io
op_plus
id|HP_PROR
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|TIME_PRO_RESET_DONE
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|initialize
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|err
comma
id|timeout
suffix:semicolon
macro_line|#ifdef MSND_CLASSIC
id|outb
c_func
(paren
id|HPWAITSTATE_0
comma
id|dev.io
op_plus
id|HP_WAIT
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBITMODE_16
comma
id|dev.io
op_plus
id|HP_BITM
)paren
suffix:semicolon
id|reset_proteus
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|err
op_assign
id|init_sma
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: Cannot initialize SMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|reset_dsp
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|upload_dsp_code
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: Cannot upload DSP code&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: DSP upload successful&bslash;n&quot;
)paren
suffix:semicolon
id|timeout
op_assign
l_int|2000
suffix:semicolon
r_while
c_loop
(paren
id|readw
c_func
(paren
id|dev.base
)paren
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|timeout
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|attach_multisound
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|err
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
id|LOGNAME
l_string|&quot;: Intializing DSP&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|request_irq
c_func
(paren
id|dev.irq
comma
id|intr
comma
id|SA_SHIRQ
comma
id|DEVNAME
comma
op_amp
id|dev
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Couldn&squot;t grab IRQ %d&bslash;n&quot;
comma
id|dev.irq
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|request_region
c_func
(paren
id|dev.io
comma
id|dev.numio
comma
id|DEVNAME
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|initialize
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: Initialization failure&bslash;n&quot;
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev.irq
comma
op_amp
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|msnd_register
c_func
(paren
op_amp
id|dev
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Unable to register MultiSound&bslash;n&quot;
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev.irq
comma
op_amp
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|DSPMINOR
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|dev_fileops
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Unable to register DSP operations&bslash;n&quot;
)paren
suffix:semicolon
id|msnd_unregister
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev.irq
comma
op_amp
id|dev
)paren
suffix:semicolon
r_return
id|DSPMINOR
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|MIXERMINOR
op_assign
id|register_sound_mixer
c_func
(paren
op_amp
id|dev_fileops
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Unable to register mixer operations&bslash;n&quot;
)paren
suffix:semicolon
id|unregister_sound_mixer
c_func
(paren
id|MIXERMINOR
)paren
suffix:semicolon
id|msnd_unregister
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev.irq
comma
op_amp
id|dev
)paren
suffix:semicolon
r_return
id|MIXERMINOR
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Using DSP minor %d, mixer minor %d&bslash;n&quot;
comma
id|MIXERMINOR
comma
id|DSPMINOR
)paren
suffix:semicolon
id|calibrate_adc
c_func
(paren
id|dev.sample_rate
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Setting recording source to Line In&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_SET_ANA_IN
)paren
op_ne
l_int|0
op_logical_or
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
id|LOGNAME
l_string|&quot;: Error setting Line In as recording source&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|dev.recsrc
op_assign
id|SOUND_MASK_LINE
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unload_multisound
r_static
r_void
id|unload_multisound
c_func
(paren
r_void
)paren
(brace
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev.irq
comma
op_amp
id|dev
)paren
suffix:semicolon
id|unregister_sound_mixer
c_func
(paren
id|MIXERMINOR
)paren
suffix:semicolon
id|unregister_sound_dsp
c_func
(paren
id|DSPMINOR
)paren
suffix:semicolon
id|msnd_unregister
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
)brace
DECL|function|mod_inc_ref
r_static
r_void
id|mod_inc_ref
c_func
(paren
r_void
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
)brace
DECL|function|mod_dec_ref
r_static
r_void
id|mod_dec_ref
c_func
(paren
r_void
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|MODULE_AUTHOR
(paren
l_string|&quot;Andrew Veliath &lt;andrewtv@usa.net&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
(paren
l_string|&quot;Turtle Beach &quot;
id|LONGNAME
l_string|&quot; Linux Driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|mem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|major
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|fifosize
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|calibrate_signal
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|MODULE_PARM
(paren
id|digital
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|io
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|irq
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|mem
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
DECL|variable|__initdata
r_static
r_int
id|digital
id|__initdata
suffix:semicolon
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|fifosize
id|__initdata
op_assign
id|DEFFIFOSIZE
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|calibrate_signal
id|__initdata
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
macro_line|#else /* not a module */
macro_line|#ifdef MSND_CLASSIC
r_static
r_int
id|io
id|__initdata
op_assign
id|CONFIG_MSNDCLAS_IO
suffix:semicolon
r_static
r_int
id|irq
id|__initdata
op_assign
id|CONFIG_MSNDCLAS_IRQ
suffix:semicolon
r_static
r_int
id|mem
id|__initdata
op_assign
id|CONFIG_MSNDCLAS_MEM
suffix:semicolon
macro_line|#else /* Pinnacle/Fiji */
r_static
r_int
id|io
id|__initdata
op_assign
id|CONFIG_MSNDPIN_IO
suffix:semicolon
r_static
r_int
id|irq
id|__initdata
op_assign
id|CONFIG_MSNDPIN_IRQ
suffix:semicolon
r_static
r_int
id|mem
id|__initdata
op_assign
id|CONFIG_MSNDPIN_MEM
suffix:semicolon
macro_line|#ifndef CONFIG_MSNDPIN_DIGITAL
macro_line|#  define CONFIG_MSNDPIN_DIGITAL&t;0
macro_line|#endif
r_static
r_int
id|digital
id|__initdata
op_assign
id|CONFIG_MSNDPIN_DIGITAL
suffix:semicolon
macro_line|#endif /* MSND_CLASSIC */
macro_line|#ifndef CONFIG_MSND_FIFOSIZE
macro_line|#  define CONFIG_MSND_FIFOSIZE&t;&t;DEFFIFOSIZE
macro_line|#endif /* CONFIG_MSND_FIFOSIZE */
r_static
r_int
id|fifosize
id|__initdata
op_assign
id|CONFIG_MSND_FIFOSIZE
suffix:semicolon
macro_line|#ifndef CONFIG_MSND_CALSIGNAL
macro_line|#  define CONFIG_MSND_CALSIGNAL&t;&t;0
macro_line|#endif /* CONFIG_MSND_CALSIGNAL */
r_static
r_int
id|calibrate_signal
id|__initdata
op_assign
id|CONFIG_MSND_CALSIGNAL
suffix:semicolon
macro_line|#ifdef MSND_CLASSIC
id|__initfunc
c_func
(paren
r_int
id|msnd_classic_init
c_func
(paren
r_void
)paren
)paren
macro_line|#else
id|__initfunc
c_func
(paren
r_int
id|msnd_pinnacle_init
c_func
(paren
r_void
)paren
)paren
macro_line|#endif /* MSND_CLASSIC */
macro_line|#endif
(brace
r_int
id|err
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Turtle Beach &quot;
id|LONGNAME
l_string|&quot; Linux Driver Version &quot;
id|VERSION
l_string|&quot;, Copyright (C) 1998 Andrew Veliath&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io
op_eq
op_minus
l_int|1
op_logical_or
id|irq
op_eq
op_minus
l_int|1
op_logical_or
id|mem
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: io, irq and mem must be set&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|io
op_eq
op_minus
l_int|1
op_logical_or
op_logical_neg
(paren
id|io
op_eq
l_int|0x290
op_logical_or
id|io
op_eq
l_int|0x260
op_logical_or
id|io
op_eq
l_int|0x250
op_logical_or
id|io
op_eq
l_int|0x240
op_logical_or
id|io
op_eq
l_int|0x230
op_logical_or
id|io
op_eq
l_int|0x220
op_logical_or
id|io
op_eq
l_int|0x210
op_logical_or
id|io
op_eq
l_int|0x3e0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: &bslash;&quot;io&bslash;&quot; - DSP I/O base must be set&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
op_logical_or
op_logical_neg
(paren
id|irq
op_eq
l_int|5
op_logical_or
id|irq
op_eq
l_int|7
op_logical_or
id|irq
op_eq
l_int|9
op_logical_or
id|irq
op_eq
l_int|10
op_logical_or
id|irq
op_eq
l_int|11
op_logical_or
id|irq
op_eq
l_int|12
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: &bslash;&quot;irq&bslash;&quot; - must be set to 5, 7, 9, 10, 11 or 12&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mem
op_eq
op_minus
l_int|1
op_logical_or
op_logical_neg
(paren
id|mem
op_eq
l_int|0xb0000
op_logical_or
id|mem
op_eq
l_int|0xc8000
op_logical_or
id|mem
op_eq
l_int|0xd0000
op_logical_or
id|mem
op_eq
l_int|0xd8000
op_logical_or
id|mem
op_eq
l_int|0xe0000
op_logical_or
id|mem
op_eq
l_int|0xe8000
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: &bslash;&quot;mem&bslash;&quot; - must be set to &quot;
l_string|&quot;0xb0000, 0xc8000, 0xd0000, 0xd8000, 0xe0000 or 0xe8000&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#ifdef MSND_CLASSIC
r_switch
c_cond
(paren
id|irq
)paren
(brace
r_case
l_int|5
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_7
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_9
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_10
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|11
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_11
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_12
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|mem
)paren
(brace
r_case
l_int|0xb0000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_B000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xc8000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_C800
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xd0000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_D000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xd8000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_D800
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xe0000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_E000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xe8000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_E800
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif /* MSND_CLASSIC */
r_if
c_cond
(paren
id|fifosize
OL
l_int|16
)paren
id|fifosize
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|fifosize
OG
l_int|768
)paren
id|fifosize
op_assign
l_int|768
suffix:semicolon
macro_line|#ifdef MSND_CLASSIC
id|dev.type
op_assign
id|msndClassic
suffix:semicolon
macro_line|#else
id|dev.type
op_assign
id|msndPinnacle
suffix:semicolon
macro_line|#endif
id|dev.io
op_assign
id|io
suffix:semicolon
id|dev.numio
op_assign
id|DSP_NUMIO
suffix:semicolon
id|dev.irq
op_assign
id|irq
suffix:semicolon
id|dev.base
op_assign
id|phys_to_virt
c_func
(paren
id|mem
)paren
suffix:semicolon
id|dev.fifosize
op_assign
id|fifosize
op_star
l_int|1024
suffix:semicolon
id|dev.calibrate_signal
op_assign
id|calibrate_signal
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|dev.recsrc
op_assign
l_int|0
suffix:semicolon
id|dev.inc_ref
op_assign
id|mod_inc_ref
suffix:semicolon
id|dev.dec_ref
op_assign
id|mod_dec_ref
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
r_if
c_cond
(paren
id|digital
)paren
(brace
id|set_bit
c_func
(paren
id|F_HAVEDIGITAL
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Digital I/O access enabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|init_waitqueue
c_func
(paren
op_amp
id|dev.writeblock
)paren
suffix:semicolon
id|init_waitqueue
c_func
(paren
op_amp
id|dev.readblock
)paren
suffix:semicolon
id|init_waitqueue
c_func
(paren
op_amp
id|dev.writeflush
)paren
suffix:semicolon
id|msnd_fifo_init
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|msnd_fifo_init
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
macro_line|#ifndef LINUX20
id|spin_lock_init
c_func
(paren
op_amp
id|dev.lock
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Using %u byte digital audio FIFOs (x2)&bslash;n&quot;
comma
id|dev.fifosize
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|msnd_fifo_alloc
c_func
(paren
op_amp
id|dev.DAPF
comma
id|dev.fifosize
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Couldn&squot;t allocate write FIFO&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|msnd_fifo_alloc
c_func
(paren
op_amp
id|dev.DARF
comma
id|dev.fifosize
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Couldn&squot;t allocate read FIFO&bslash;n&quot;
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|probe_multisound
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Probe failed&bslash;n&quot;
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|attach_multisound
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Attach failed&bslash;n&quot;
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Unloading&bslash;n&quot;
)paren
suffix:semicolon
id|unload_multisound
c_func
(paren
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
