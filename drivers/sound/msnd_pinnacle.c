multiline_comment|/*********************************************************************&n; *&n; * Turtle Beach MultiSound Sound Card Driver for Linux&n; * Linux 2.0/2.2 Version&n; *&n; * msnd_pinnacle.c / msnd_classic.c&n; *&n; * -- If MSND_CLASSIC is defined:&n; *&n; *     -&gt; driver for Turtle Beach Classic/Monterey/Tahiti&n; *&n; * -- Else&n; *&n; *     -&gt; driver for Turtle Beach Pinnacle/Fiji&n; *&n; * Copyright (C) 1998 Andrew Veliath&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * $Id: msnd_pinnacle.c,v 1.75 1999/03/21 16:50:09 andrewtv Exp $&n; *&n; ********************************************************************/
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;sound_config.h&quot;
macro_line|#include &quot;sound_firmware.h&quot;
macro_line|#ifdef MSND_CLASSIC
DECL|macro|SLOWIO
macro_line|#  define SLOWIO
macro_line|#endif
macro_line|#include &quot;msnd.h&quot;
macro_line|#ifdef MSND_CLASSIC
macro_line|#  ifdef CONFIG_MSNDCLAS_HAVE_BOOT
DECL|macro|HAVE_DSPCODEH
macro_line|#    define HAVE_DSPCODEH
macro_line|#  endif
macro_line|#  include &quot;msnd_classic.h&quot;
DECL|macro|LOGNAME
macro_line|#  define LOGNAME&t;&t;&t;&quot;msnd_classic&quot;
macro_line|#else
macro_line|#  ifdef CONFIG_MSNDPIN_HAVE_BOOT
DECL|macro|HAVE_DSPCODEH
macro_line|#    define HAVE_DSPCODEH
macro_line|#  endif
macro_line|#  include &quot;msnd_pinnacle.h&quot;
DECL|macro|LOGNAME
macro_line|#  define LOGNAME&t;&t;&t;&quot;msnd_pinnacle&quot;
macro_line|#endif
macro_line|#ifndef CONFIG_MSND_WRITE_NDELAY
DECL|macro|CONFIG_MSND_WRITE_NDELAY
macro_line|#  define CONFIG_MSND_WRITE_NDELAY&t;1
macro_line|#endif
DECL|macro|get_play_delay_jiffies
mdefine_line|#define get_play_delay_jiffies(size)&t;((size) * HZ *&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t; dev.play_sample_size / 8 /&t;&bslash;&n;&t;&t;&t;&t;&t; dev.play_sample_rate /&t;&t;&bslash;&n;&t;&t;&t;&t;&t; dev.play_channels)
DECL|macro|get_rec_delay_jiffies
mdefine_line|#define get_rec_delay_jiffies(size)&t;((size) * HZ *&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t; dev.rec_sample_size / 8 /&t;&bslash;&n;&t;&t;&t;&t;&t; dev.rec_sample_rate /&t;&t;&bslash;&n;&t;&t;&t;&t;&t; dev.rec_channels)
DECL|variable|dev
r_static
id|multisound_dev_t
id|dev
suffix:semicolon
macro_line|#ifndef HAVE_DSPCODEH
DECL|variable|dspini
DECL|variable|permini
r_static
r_char
op_star
id|dspini
comma
op_star
id|permini
suffix:semicolon
DECL|variable|sizeof_dspini
DECL|variable|sizeof_permini
r_static
r_int
id|sizeof_dspini
comma
id|sizeof_permini
suffix:semicolon
macro_line|#endif
r_static
r_int
id|dsp_full_reset
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|dsp_write_flush
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|chk_send_dsp_cmd
r_static
id|__inline__
r_int
id|chk_send_dsp_cmd
c_func
(paren
id|multisound_dev_t
op_star
id|dev
comma
r_register
id|BYTE
id|cmd
)paren
(brace
r_if
c_cond
(paren
id|msnd_send_dsp_cmd
c_func
(paren
id|dev
comma
id|cmd
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|dsp_full_reset
c_func
(paren
)paren
suffix:semicolon
r_return
id|msnd_send_dsp_cmd
c_func
(paren
id|dev
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|reset_play_queue
r_static
r_void
id|reset_play_queue
c_func
(paren
r_void
)paren
(brace
r_int
id|n
suffix:semicolon
id|LPDAQD
id|lpDAQ
suffix:semicolon
id|dev.last_playbank
op_assign
op_minus
l_int|1
suffix:semicolon
id|isa_writew
c_func
(paren
id|PCTODSP_OFFSET
c_func
(paren
l_int|0
op_star
id|DAQDS__size
)paren
comma
id|dev.DAPQ
op_plus
id|JQS_wHead
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|PCTODSP_OFFSET
c_func
(paren
l_int|0
op_star
id|DAQDS__size
)paren
comma
id|dev.DAPQ
op_plus
id|JQS_wTail
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
comma
id|lpDAQ
op_assign
id|dev.base
op_plus
id|DAPQ_DATA_BUFF
suffix:semicolon
id|n
OL
l_int|3
suffix:semicolon
op_increment
id|n
comma
id|lpDAQ
op_add_assign
id|DAQDS__size
)paren
(brace
id|isa_writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
(paren
id|DWORD
)paren
(paren
id|DAP_BUFF_SIZE
op_star
id|n
)paren
)paren
comma
id|lpDAQ
op_plus
id|DAQDS_wStart
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
l_int|0
comma
id|lpDAQ
op_plus
id|DAQDS_wSize
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
l_int|1
comma
id|lpDAQ
op_plus
id|DAQDS_wFormat
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|dev.play_sample_size
comma
id|lpDAQ
op_plus
id|DAQDS_wSampleSize
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|dev.play_channels
comma
id|lpDAQ
op_plus
id|DAQDS_wChannels
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|dev.play_sample_rate
comma
id|lpDAQ
op_plus
id|DAQDS_wSampleRate
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|HIMT_PLAY_DONE
op_star
l_int|0x100
op_plus
id|n
comma
id|lpDAQ
op_plus
id|DAQDS_wIntMsg
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|n
comma
id|lpDAQ
op_plus
id|DAQDS_wFlags
)paren
suffix:semicolon
)brace
)brace
DECL|function|reset_record_queue
r_static
r_void
id|reset_record_queue
c_func
(paren
r_void
)paren
(brace
r_int
id|n
suffix:semicolon
id|LPDAQD
id|lpDAQ
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|dev.last_recbank
op_assign
l_int|2
suffix:semicolon
id|isa_writew
c_func
(paren
id|PCTODSP_OFFSET
c_func
(paren
l_int|0
op_star
id|DAQDS__size
)paren
comma
id|dev.DARQ
op_plus
id|JQS_wHead
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|PCTODSP_OFFSET
c_func
(paren
id|dev.last_recbank
op_star
id|DAQDS__size
)paren
comma
id|dev.DARQ
op_plus
id|JQS_wTail
)paren
suffix:semicolon
multiline_comment|/* Critical section: bank 1 access */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBLKSEL_1
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|isa_memset_io
c_func
(paren
id|dev.base
comma
l_int|0
comma
id|DAR_BUFF_SIZE
op_star
l_int|3
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
comma
id|lpDAQ
op_assign
id|dev.base
op_plus
id|DARQ_DATA_BUFF
suffix:semicolon
id|n
OL
l_int|3
suffix:semicolon
op_increment
id|n
comma
id|lpDAQ
op_add_assign
id|DAQDS__size
)paren
(brace
id|isa_writew
c_func
(paren
id|PCTODSP_BASED
c_func
(paren
(paren
id|DWORD
)paren
(paren
id|DAR_BUFF_SIZE
op_star
id|n
)paren
)paren
op_plus
l_int|0x4000
comma
id|lpDAQ
op_plus
id|DAQDS_wStart
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|DAR_BUFF_SIZE
comma
id|lpDAQ
op_plus
id|DAQDS_wSize
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
l_int|1
comma
id|lpDAQ
op_plus
id|DAQDS_wFormat
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|dev.rec_sample_size
comma
id|lpDAQ
op_plus
id|DAQDS_wSampleSize
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|dev.rec_channels
comma
id|lpDAQ
op_plus
id|DAQDS_wChannels
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|dev.rec_sample_rate
comma
id|lpDAQ
op_plus
id|DAQDS_wSampleRate
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|HIMT_RECORD_DONE
op_star
l_int|0x100
op_plus
id|n
comma
id|lpDAQ
op_plus
id|DAQDS_wIntMsg
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|n
comma
id|lpDAQ
op_plus
id|DAQDS_wFlags
)paren
suffix:semicolon
)brace
)brace
DECL|function|reset_queues
r_static
r_void
id|reset_queues
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|dev.mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|msnd_fifo_make_empty
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|reset_play_queue
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev.mode
op_amp
id|FMODE_READ
)paren
(brace
id|msnd_fifo_make_empty
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
id|reset_record_queue
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|dsp_set_format
r_static
r_int
id|dsp_set_format
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
id|val
)paren
(brace
r_int
id|data
comma
id|i
suffix:semicolon
id|LPDAQD
id|lpDAQ
comma
id|lpDARQ
suffix:semicolon
id|lpDAQ
op_assign
id|dev.base
op_plus
id|DAPQ_DATA_BUFF
suffix:semicolon
id|lpDARQ
op_assign
id|dev.base
op_plus
id|DARQ_DATA_BUFF
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
id|AFMT_U8
suffix:colon
r_case
id|AFMT_S16_LE
suffix:colon
id|data
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|data
op_assign
id|DEFSAMPLESIZE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
comma
id|lpDAQ
op_add_assign
id|DAQDS__size
comma
id|lpDARQ
op_add_assign
id|DAQDS__size
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|isa_writew
c_func
(paren
id|data
comma
id|lpDAQ
op_plus
id|DAQDS_wSampleSize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|isa_writew
c_func
(paren
id|data
comma
id|lpDARQ
op_plus
id|DAQDS_wSampleSize
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|dev.play_sample_size
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|dev.rec_sample_size
op_assign
id|data
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|dsp_get_frag_size
r_static
r_int
id|dsp_get_frag_size
c_func
(paren
r_void
)paren
(brace
r_int
id|size
suffix:semicolon
id|size
op_assign
id|dev.fifosize
op_div
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|32
op_star
l_int|1024
)paren
id|size
op_assign
l_int|32
op_star
l_int|1024
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
DECL|function|dsp_ioctl
r_static
r_int
id|dsp_ioctl
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|val
comma
id|i
comma
id|data
comma
id|tmp
suffix:semicolon
id|LPDAQD
id|lpDAQ
comma
id|lpDARQ
suffix:semicolon
id|audio_buf_info
id|abinfo
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|lpDAQ
op_assign
id|dev.base
op_plus
id|DAPQ_DATA_BUFF
suffix:semicolon
id|lpDARQ
op_assign
id|dev.base
op_plus
id|DARQ_DATA_BUFF
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
r_case
id|SNDCTL_DSP_SETDUPLEX
suffix:colon
r_case
id|SNDCTL_DSP_POST
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETIPTR
suffix:colon
r_case
id|SNDCTL_DSP_GETOPTR
suffix:colon
r_case
id|SNDCTL_DSP_MAPINBUF
suffix:colon
r_case
id|SNDCTL_DSP_MAPOUTBUF
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOSPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|dsp_get_frag_size
c_func
(paren
)paren
suffix:semicolon
id|abinfo.bytes
op_assign
id|dev.DAPF.n
op_minus
id|dev.DAPF.len
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|dev.DAPF.n
op_div
id|abinfo.fragsize
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_div
id|abinfo.fragsize
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETISPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|dsp_get_frag_size
c_func
(paren
)paren
suffix:semicolon
id|abinfo.bytes
op_assign
id|dev.DARF.n
op_minus
id|dev.DARF.len
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|dev.DARF.n
op_div
id|abinfo.fragsize
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_div
id|abinfo.fragsize
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_RESET
suffix:colon
id|dev.nresets
op_assign
l_int|0
suffix:semicolon
id|reset_queues
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
id|dsp_write_flush
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
id|tmp
op_assign
id|dsp_get_frag_size
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|tmp
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETFMTS
suffix:colon
id|val
op_assign
id|AFMT_S16_LE
op_or
id|AFMT_U8
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFMT
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|data
op_assign
id|val
op_eq
id|AFMT_QUERY
ques
c_cond
id|dev.play_sample_size
suffix:colon
id|dsp_set_format
c_func
(paren
id|file
comma
id|val
)paren
suffix:semicolon
r_else
id|data
op_assign
id|val
op_eq
id|AFMT_QUERY
ques
c_cond
id|dev.rec_sample_size
suffix:colon
id|dsp_set_format
c_func
(paren
id|file
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_NONBLOCK
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|F_DISABLE_WRITE_NDELAY
comma
op_amp
id|dev.flags
)paren
op_logical_and
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|dev.play_ndelay
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|dev.rec_ndelay
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETCAPS
suffix:colon
id|val
op_assign
id|DSP_CAP_DUPLEX
op_or
id|DSP_CAP_BATCH
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
l_int|8000
)paren
id|val
op_assign
l_int|8000
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
l_int|48000
)paren
id|val
op_assign
l_int|48000
suffix:semicolon
id|data
op_assign
id|val
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
comma
id|lpDAQ
op_add_assign
id|DAQDS__size
comma
id|lpDARQ
op_add_assign
id|DAQDS__size
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|isa_writew
c_func
(paren
id|data
comma
id|lpDAQ
op_plus
id|DAQDS_wSampleRate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|isa_writew
c_func
(paren
id|data
comma
id|lpDARQ
op_plus
id|DAQDS_wSampleRate
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|dev.play_sample_rate
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|dev.rec_sample_rate
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_CHANNELS
suffix:colon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDCTL_DSP_CHANNELS
)paren
(brace
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
id|data
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|val
op_assign
id|data
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|0
suffix:colon
id|data
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|val
op_assign
l_int|1
suffix:semicolon
r_case
l_int|1
suffix:colon
id|data
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
comma
id|lpDAQ
op_add_assign
id|DAQDS__size
comma
id|lpDARQ
op_add_assign
id|DAQDS__size
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|isa_writew
c_func
(paren
id|data
comma
id|lpDAQ
op_plus
id|DAQDS_wChannels
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|isa_writew
c_func
(paren
id|data
comma
id|lpDARQ
op_plus
id|DAQDS_wChannels
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|dev.play_channels
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|dev.rec_channels
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|mixer_get
r_static
r_int
id|mixer_get
c_func
(paren
r_int
id|d
)paren
(brace
r_if
c_cond
(paren
id|d
OG
l_int|31
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|d
)paren
(brace
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
r_case
id|SOUND_MIXER_PCM
suffix:colon
r_case
id|SOUND_MIXER_LINE
suffix:colon
r_case
id|SOUND_MIXER_IMIX
suffix:colon
r_case
id|SOUND_MIXER_LINE1
suffix:colon
macro_line|#ifndef MSND_CLASSIC
r_case
id|SOUND_MIXER_MIC
suffix:colon
r_case
id|SOUND_MIXER_SYNTH
suffix:colon
macro_line|#endif
r_return
(paren
id|dev.left_levels
(braket
id|d
)braket
op_rshift
l_int|8
)paren
op_star
l_int|100
op_div
l_int|0xff
op_or
(paren
(paren
(paren
id|dev.right_levels
(braket
id|d
)braket
op_rshift
l_int|8
)paren
op_star
l_int|100
op_div
l_int|0xff
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|macro|update_volm
mdefine_line|#define update_volm(a,b)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;isa_writew((dev.left_levels[a] &gt;&gt; 1) *&t;&t;&t;&t;&bslash;&n;&t;       isa_readw(dev.SMA + SMA_wCurrMastVolLeft) / 0xffff,&t;&bslash;&n;&t;       dev.SMA + SMA_##b##Left);&t;&t;&t;&t;&bslash;&n;&t;isa_writew((dev.right_levels[a] &gt;&gt; 1)  *&t;&t;&t;&bslash;&n;&t;       isa_readw(dev.SMA + SMA_wCurrMastVolRight) / 0xffff,&t;&bslash;&n;&t;       dev.SMA + SMA_##b##Right);
DECL|macro|update_potm
mdefine_line|#define update_potm(d,s,ar)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;isa_writeb((dev.left_levels[d] &gt;&gt; 8) *&t;&t;&t;&t;&bslash;&n;&t;       isa_readw(dev.SMA + SMA_wCurrMastVolLeft) / 0xffff,&t;&bslash;&n;&t;       dev.SMA + SMA_##s##Left);&t;&t;&t;&t;&bslash;&n;&t;isa_writeb((dev.right_levels[d] &gt;&gt; 8) *&t;&t;&t;&t;&bslash;&n;&t;       isa_readw(dev.SMA + SMA_wCurrMastVolRight) / 0xffff,&t;&bslash;&n;&t;       dev.SMA + SMA_##s##Right);&t;&t;&t;&t;&bslash;&n;&t;if (msnd_send_word(&amp;dev, 0, 0, ar) == 0)&t;&t;&t;&bslash;&n;&t;&t;chk_send_dsp_cmd(&amp;dev, HDEX_AUX_REQ);
DECL|macro|update_pot
mdefine_line|#define update_pot(d,s,ar)&t;&t;&t;&t;&bslash;&n;&t;isa_writeb(dev.left_levels[d] &gt;&gt; 8,&t;&t;&bslash;&n;&t;       dev.SMA + SMA_##s##Left);&t;&t;&bslash;&n;&t;isa_writeb(dev.right_levels[d] &gt;&gt; 8,&t;&t;&bslash;&n;&t;       dev.SMA + SMA_##s##Right);&t;&t;&bslash;&n;&t;if (msnd_send_word(&amp;dev, 0, 0, ar) == 0)&t;&bslash;&n;&t;&t;chk_send_dsp_cmd(&amp;dev, HDEX_AUX_REQ);
DECL|function|mixer_set
r_static
r_int
id|mixer_set
c_func
(paren
r_int
id|d
comma
r_int
id|value
)paren
(brace
r_int
id|left
op_assign
id|value
op_amp
l_int|0x000000ff
suffix:semicolon
r_int
id|right
op_assign
(paren
id|value
op_amp
l_int|0x0000ff00
)paren
op_rshift
l_int|8
suffix:semicolon
r_int
id|bLeft
comma
id|bRight
suffix:semicolon
r_int
id|wLeft
comma
id|wRight
suffix:semicolon
r_int
id|updatemaster
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|d
OG
l_int|31
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|bLeft
op_assign
id|left
op_star
l_int|0xff
op_div
l_int|100
suffix:semicolon
id|wLeft
op_assign
id|left
op_star
l_int|0xffff
op_div
l_int|100
suffix:semicolon
id|bRight
op_assign
id|right
op_star
l_int|0xff
op_div
l_int|100
suffix:semicolon
id|wRight
op_assign
id|right
op_star
l_int|0xffff
op_div
l_int|100
suffix:semicolon
id|dev.left_levels
(braket
id|d
)braket
op_assign
id|wLeft
suffix:semicolon
id|dev.right_levels
(braket
id|d
)braket
op_assign
id|wRight
suffix:semicolon
r_switch
c_cond
(paren
id|d
)paren
(brace
multiline_comment|/* master volume unscaled controls */
r_case
id|SOUND_MIXER_LINE
suffix:colon
multiline_comment|/* line pot control */
multiline_comment|/* scaled by IMIX in digital mix */
id|isa_writeb
c_func
(paren
id|bLeft
comma
id|dev.SMA
op_plus
id|SMA_bInPotPosLeft
)paren
suffix:semicolon
id|isa_writeb
c_func
(paren
id|bRight
comma
id|dev.SMA
op_plus
id|SMA_bInPotPosRight
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_IN_SET_POTS
)paren
op_eq
l_int|0
)paren
id|chk_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
r_case
id|SOUND_MIXER_MIC
suffix:colon
multiline_comment|/* mic pot control */
multiline_comment|/* scaled by IMIX in digital mix */
id|isa_writeb
c_func
(paren
id|bLeft
comma
id|dev.SMA
op_plus
id|SMA_bMicPotPosLeft
)paren
suffix:semicolon
id|isa_writeb
c_func
(paren
id|bRight
comma
id|dev.SMA
op_plus
id|SMA_bMicPotPosRight
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_MIC_SET_POTS
)paren
op_eq
l_int|0
)paren
id|chk_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
multiline_comment|/* master volume */
id|isa_writew
c_func
(paren
id|wLeft
comma
id|dev.SMA
op_plus
id|SMA_wCurrMastVolLeft
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|wRight
comma
id|dev.SMA
op_plus
id|SMA_wCurrMastVolRight
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_LINE1
suffix:colon
multiline_comment|/* aux pot control */
multiline_comment|/* scaled by master volume */
multiline_comment|/* fall through */
multiline_comment|/* digital controls */
r_case
id|SOUND_MIXER_SYNTH
suffix:colon
multiline_comment|/* synth vol (dsp mix) */
r_case
id|SOUND_MIXER_PCM
suffix:colon
multiline_comment|/* pcm vol (dsp mix) */
r_case
id|SOUND_MIXER_IMIX
suffix:colon
multiline_comment|/* input monitor (dsp mix) */
multiline_comment|/* scaled by master volume */
id|updatemaster
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|updatemaster
)paren
(brace
multiline_comment|/* update master volume scaled controls */
id|update_volm
c_func
(paren
id|SOUND_MIXER_PCM
comma
id|wCurrPlayVol
)paren
suffix:semicolon
id|update_volm
c_func
(paren
id|SOUND_MIXER_IMIX
comma
id|wCurrInVol
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|update_volm
c_func
(paren
id|SOUND_MIXER_SYNTH
comma
id|wCurrMHdrVol
)paren
suffix:semicolon
macro_line|#endif
id|update_potm
c_func
(paren
id|SOUND_MIXER_LINE1
comma
id|bAuxPotPos
comma
id|HDEXAR_AUX_SET_POTS
)paren
suffix:semicolon
)brace
r_return
id|mixer_get
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
DECL|function|mixer_setup
r_static
r_void
id|mixer_setup
c_func
(paren
r_void
)paren
(brace
id|update_pot
c_func
(paren
id|SOUND_MIXER_LINE
comma
id|bInPotPos
comma
id|HDEXAR_IN_SET_POTS
)paren
suffix:semicolon
id|update_potm
c_func
(paren
id|SOUND_MIXER_LINE1
comma
id|bAuxPotPos
comma
id|HDEXAR_AUX_SET_POTS
)paren
suffix:semicolon
id|update_volm
c_func
(paren
id|SOUND_MIXER_PCM
comma
id|wCurrPlayVol
)paren
suffix:semicolon
id|update_volm
c_func
(paren
id|SOUND_MIXER_IMIX
comma
id|wCurrInVol
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|update_pot
c_func
(paren
id|SOUND_MIXER_MIC
comma
id|bMicPotPos
comma
id|HDEXAR_MIC_SET_POTS
)paren
suffix:semicolon
id|update_volm
c_func
(paren
id|SOUND_MIXER_SYNTH
comma
id|wCurrMHdrVol
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|set_recsrc
r_static
r_int
r_int
id|set_recsrc
c_func
(paren
r_int
r_int
id|recsrc
)paren
(brace
r_if
c_cond
(paren
id|dev.recsrc
op_eq
id|recsrc
)paren
r_return
id|dev.recsrc
suffix:semicolon
macro_line|#ifdef HAVE_NORECSRC
r_else
r_if
c_cond
(paren
id|recsrc
op_eq
l_int|0
)paren
id|dev.recsrc
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_else
id|dev.recsrc
op_xor_assign
id|recsrc
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
r_if
c_cond
(paren
id|dev.recsrc
op_amp
id|SOUND_MASK_IMIX
)paren
(brace
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_SET_ANA_IN
)paren
op_eq
l_int|0
)paren
id|chk_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev.recsrc
op_amp
id|SOUND_MASK_SYNTH
)paren
(brace
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_SET_SYNTH_IN
)paren
op_eq
l_int|0
)paren
id|chk_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev.recsrc
op_amp
id|SOUND_MASK_DIGITAL1
)paren
op_logical_and
id|test_bit
c_func
(paren
id|F_HAVEDIGITAL
comma
op_amp
id|dev.flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_SET_DAT_IN
)paren
op_eq
l_int|0
)paren
id|chk_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef HAVE_NORECSRC
multiline_comment|/* Select no input (?) */
id|dev.recsrc
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|dev.recsrc
op_assign
id|SOUND_MASK_IMIX
suffix:semicolon
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_SET_ANA_IN
)paren
op_eq
l_int|0
)paren
id|chk_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif /* MSND_CLASSIC */
r_return
id|dev.recsrc
suffix:semicolon
)brace
DECL|function|force_recsrc
r_static
r_int
r_int
id|force_recsrc
c_func
(paren
r_int
r_int
id|recsrc
)paren
(brace
id|dev.recsrc
op_assign
l_int|0
suffix:semicolon
r_return
id|set_recsrc
c_func
(paren
id|recsrc
)paren
suffix:semicolon
)brace
DECL|macro|set_mixer_info
mdefine_line|#define set_mixer_info()&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;strncpy(info.id, &quot;MSNDMIXER&quot;, sizeof(info.id));&t;&t;&t;&bslash;&n;&t;&t;strncpy(info.name, &quot;MultiSound Mixer&quot;, sizeof(info.name));
DECL|function|mixer_ioctl
r_static
r_int
id|mixer_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_INFO
)paren
(brace
id|mixer_info
id|info
suffix:semicolon
id|set_mixer_info
c_func
(paren
)paren
suffix:semicolon
id|info.modify_counter
op_assign
id|dev.mixer_mod_count
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_OLD_MIXER_INFO
)paren
(brace
id|_old_mixer_info
id|info
suffix:semicolon
id|set_mixer_info
c_func
(paren
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_PRIVATE1
)paren
(brace
id|dev.nresets
op_assign
l_int|0
suffix:semicolon
id|dsp_full_reset
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
id|cmd
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_eq
l_char|&squot;M&squot;
)paren
(brace
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_amp
id|_SIOC_WRITE
)paren
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|set_recsrc
c_func
(paren
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|mixer_set
c_func
(paren
id|cmd
op_amp
l_int|0xff
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
op_increment
id|dev.mixer_mod_count
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
id|val
op_assign
id|dev.recsrc
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
id|val
op_assign
id|SOUND_MASK_PCM
op_or
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_IMIX
op_or
id|SOUND_MASK_LINE1
op_or
macro_line|#ifndef MSND_CLASSIC
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_SYNTH
op_or
macro_line|#endif
id|SOUND_MASK_VOLUME
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
macro_line|#ifdef MSND_CLASSIC
id|val
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|val
op_assign
id|SOUND_MASK_IMIX
op_or
id|SOUND_MASK_SYNTH
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_HAVEDIGITAL
comma
op_amp
id|dev.flags
)paren
)paren
id|val
op_or_assign
id|SOUND_MASK_DIGITAL1
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
id|val
op_assign
id|SOUND_CAP_EXCL_INPUT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|mixer_get
c_func
(paren
id|cmd
op_amp
l_int|0xff
)paren
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|dev_ioctl
r_static
r_int
id|dev_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|OSS_GETVERSION
)paren
(brace
r_int
id|sound_version
op_assign
id|SOUND_VERSION
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|sound_version
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|minor
op_eq
id|dev.dsp_minor
)paren
r_return
id|dsp_ioctl
c_func
(paren
id|file
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|minor
op_eq
id|dev.mixer_minor
)paren
r_return
id|mixer_ioctl
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|dsp_write_flush
r_static
r_void
id|dsp_write_flush
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev.mode
op_amp
id|FMODE_WRITE
)paren
op_logical_or
op_logical_neg
id|test_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
)paren
r_return
suffix:semicolon
id|set_bit
c_func
(paren
id|F_WRITEFLUSH
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|dev.writeflush
comma
id|get_play_delay_jiffies
c_func
(paren
id|dev.DAPF.len
)paren
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_WRITEFLUSH
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|get_play_delay_jiffies
c_func
(paren
id|DAP_BUFF_SIZE
)paren
)paren
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
)brace
DECL|function|dsp_halt
r_static
r_void
id|dsp_halt
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_if
c_cond
(paren
(paren
id|file
ques
c_cond
id|file-&gt;f_mode
suffix:colon
id|dev.mode
)paren
op_amp
id|FMODE_READ
)paren
(brace
id|clear_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|chk_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_RECORD_STOP
)paren
suffix:semicolon
id|msnd_disable_irq
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
id|LOGNAME
l_string|&quot;: Stopping read for %p&bslash;n&quot;
comma
id|file
)paren
suffix:semicolon
id|dev.mode
op_and_assign
op_complement
id|FMODE_READ
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|F_AUDIO_READ_INUSE
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|file
ques
c_cond
id|file-&gt;f_mode
suffix:colon
id|dev.mode
)paren
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
)paren
(brace
id|dsp_write_flush
c_func
(paren
)paren
suffix:semicolon
id|chk_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_PLAY_STOP
)paren
suffix:semicolon
)brace
id|msnd_disable_irq
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
id|LOGNAME
l_string|&quot;: Stopping write for %p&bslash;n&quot;
comma
id|file
)paren
suffix:semicolon
id|dev.mode
op_and_assign
op_complement
id|FMODE_WRITE
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|F_AUDIO_WRITE_INUSE
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|dsp_release
r_static
r_int
id|dsp_release
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
id|dsp_halt
c_func
(paren
id|file
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dsp_open
r_static
r_int
id|dsp_open
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_if
c_cond
(paren
(paren
id|file
ques
c_cond
id|file-&gt;f_mode
suffix:colon
id|dev.mode
)paren
op_amp
id|FMODE_WRITE
)paren
(brace
id|set_bit
c_func
(paren
id|F_AUDIO_WRITE_INUSE
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|msnd_fifo_make_empty
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|reset_play_queue
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
id|LOGNAME
l_string|&quot;: Starting write for %p&bslash;n&quot;
comma
id|file
)paren
suffix:semicolon
id|dev.mode
op_or_assign
id|FMODE_WRITE
suffix:semicolon
)brace
id|msnd_enable_irq
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|file
ques
c_cond
id|file-&gt;f_mode
suffix:colon
id|dev.mode
)paren
op_amp
id|FMODE_READ
)paren
(brace
id|set_bit
c_func
(paren
id|F_AUDIO_READ_INUSE
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|msnd_fifo_make_empty
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
id|reset_record_queue
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
id|LOGNAME
l_string|&quot;: Starting read for %p&bslash;n&quot;
comma
id|file
)paren
suffix:semicolon
id|dev.mode
op_or_assign
id|FMODE_READ
suffix:semicolon
)brace
id|msnd_enable_irq
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_default_play_audio_parameters
r_static
r_void
id|set_default_play_audio_parameters
c_func
(paren
r_void
)paren
(brace
id|dev.play_sample_size
op_assign
id|DEFSAMPLESIZE
suffix:semicolon
id|dev.play_sample_rate
op_assign
id|DEFSAMPLERATE
suffix:semicolon
id|dev.play_channels
op_assign
id|DEFCHANNELS
suffix:semicolon
)brace
DECL|function|set_default_rec_audio_parameters
r_static
r_void
id|set_default_rec_audio_parameters
c_func
(paren
r_void
)paren
(brace
id|dev.rec_sample_size
op_assign
id|DEFSAMPLESIZE
suffix:semicolon
id|dev.rec_sample_rate
op_assign
id|DEFSAMPLERATE
suffix:semicolon
id|dev.rec_channels
op_assign
id|DEFCHANNELS
suffix:semicolon
)brace
DECL|function|set_default_audio_parameters
r_static
r_void
id|set_default_audio_parameters
c_func
(paren
r_void
)paren
(brace
id|set_default_play_audio_parameters
c_func
(paren
)paren
suffix:semicolon
id|set_default_rec_audio_parameters
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|dev_open
r_static
r_int
id|dev_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|dev.dsp_minor
)paren
(brace
r_if
c_cond
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
id|test_bit
c_func
(paren
id|F_AUDIO_WRITE_INUSE
comma
op_amp
id|dev.flags
)paren
)paren
op_logical_or
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
id|test_bit
c_func
(paren
id|F_AUDIO_READ_INUSE
comma
op_amp
id|dev.flags
)paren
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dsp_open
c_func
(paren
id|file
)paren
)paren
op_ge
l_int|0
)paren
(brace
id|dev.nresets
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|set_default_play_audio_parameters
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|F_DISABLE_WRITE_NDELAY
comma
op_amp
id|dev.flags
)paren
)paren
id|dev.play_ndelay
op_assign
(paren
id|file-&gt;f_flags
op_amp
id|O_NDELAY
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_else
id|dev.play_ndelay
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|set_default_rec_audio_parameters
c_func
(paren
)paren
suffix:semicolon
id|dev.rec_ndelay
op_assign
(paren
id|file-&gt;f_flags
op_amp
id|O_NDELAY
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|minor
op_eq
id|dev.mixer_minor
)paren
(brace
multiline_comment|/* nothing */
)brace
r_else
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dev_release
r_static
r_int
id|dev_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|dev.dsp_minor
)paren
id|err
op_assign
id|dsp_release
c_func
(paren
id|file
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|minor
op_eq
id|dev.mixer_minor
)paren
(brace
multiline_comment|/* nothing */
)brace
r_else
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|pack_DARQ_to_DARF
r_static
id|__inline__
r_int
id|pack_DARQ_to_DARF
c_func
(paren
r_register
r_int
id|bank
)paren
(brace
r_register
r_int
id|size
comma
id|n
comma
id|timeout
op_assign
l_int|3
suffix:semicolon
r_register
id|WORD
id|wTmp
suffix:semicolon
id|LPDAQD
id|DAQD
suffix:semicolon
multiline_comment|/* Increment the tail and check for queue wrap */
id|wTmp
op_assign
id|isa_readw
c_func
(paren
id|dev.DARQ
op_plus
id|JQS_wTail
)paren
op_plus
id|PCTODSP_OFFSET
c_func
(paren
id|DAQDS__size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wTmp
OG
id|isa_readw
c_func
(paren
id|dev.DARQ
op_plus
id|JQS_wSize
)paren
)paren
id|wTmp
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|wTmp
op_eq
id|isa_readw
c_func
(paren
id|dev.DARQ
op_plus
id|JQS_wHead
)paren
op_logical_and
id|timeout
op_decrement
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|wTmp
comma
id|dev.DARQ
op_plus
id|JQS_wTail
)paren
suffix:semicolon
multiline_comment|/* Get our digital audio queue struct */
id|DAQD
op_assign
id|bank
op_star
id|DAQDS__size
op_plus
id|dev.base
op_plus
id|DARQ_DATA_BUFF
suffix:semicolon
multiline_comment|/* Get length of data */
id|size
op_assign
id|isa_readw
c_func
(paren
id|DAQD
op_plus
id|DAQDS_wSize
)paren
suffix:semicolon
multiline_comment|/* Read data from the head (unprotected bank 1 access okay&n;           since this is only called inside an interrupt) */
id|outb
c_func
(paren
id|HPBLKSEL_1
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|msnd_fifo_write
c_func
(paren
op_amp
id|dev.DARF
comma
(paren
r_char
op_star
)paren
(paren
id|dev.base
op_plus
id|bank
op_star
id|DAR_BUFF_SIZE
)paren
comma
id|size
comma
l_int|0
)paren
)paren
op_le
l_int|0
)paren
(brace
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|pack_DAPF_to_DAPQ
r_static
id|__inline__
r_int
id|pack_DAPF_to_DAPQ
c_func
(paren
r_register
r_int
id|start
)paren
(brace
r_register
id|WORD
id|DAPQ_tail
suffix:semicolon
r_register
r_int
id|protect
op_assign
id|start
comma
id|nbanks
op_assign
l_int|0
suffix:semicolon
id|LPDAQD
id|DAQD
suffix:semicolon
id|DAPQ_tail
op_assign
id|isa_readw
c_func
(paren
id|dev.DAPQ
op_plus
id|JQS_wTail
)paren
suffix:semicolon
r_while
c_loop
(paren
id|DAPQ_tail
op_ne
id|isa_readw
c_func
(paren
id|dev.DAPQ
op_plus
id|JQS_wHead
)paren
op_logical_or
id|start
)paren
(brace
r_register
r_int
id|bank_num
op_assign
id|DAPQ_tail
op_div
id|PCTODSP_OFFSET
c_func
(paren
id|DAQDS__size
)paren
suffix:semicolon
r_register
r_int
id|n
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Write the data to the new tail */
r_if
c_cond
(paren
id|protect
)paren
(brace
multiline_comment|/* Critical section: protect fifo in non-interrupt */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|msnd_fifo_read
c_func
(paren
op_amp
id|dev.DAPF
comma
(paren
r_char
op_star
)paren
(paren
id|dev.base
op_plus
id|bank_num
op_star
id|DAP_BUFF_SIZE
)paren
comma
id|DAP_BUFF_SIZE
comma
l_int|0
)paren
)paren
OL
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|n
op_assign
id|msnd_fifo_read
c_func
(paren
op_amp
id|dev.DAPF
comma
(paren
r_char
op_star
)paren
(paren
id|dev.base
op_plus
id|bank_num
op_star
id|DAP_BUFF_SIZE
)paren
comma
id|DAP_BUFF_SIZE
comma
l_int|0
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|n
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|n
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|start
)paren
id|start
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Get our digital audio queue struct */
id|DAQD
op_assign
id|bank_num
op_star
id|DAQDS__size
op_plus
id|dev.base
op_plus
id|DAPQ_DATA_BUFF
suffix:semicolon
multiline_comment|/* Write size of this bank */
id|isa_writew
c_func
(paren
id|n
comma
id|DAQD
op_plus
id|DAQDS_wSize
)paren
suffix:semicolon
op_increment
id|nbanks
suffix:semicolon
multiline_comment|/* Then advance the tail */
id|DAPQ_tail
op_assign
(paren
op_increment
id|bank_num
op_mod
l_int|3
)paren
op_star
id|PCTODSP_OFFSET
c_func
(paren
id|DAQDS__size
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|DAPQ_tail
comma
id|dev.DAPQ
op_plus
id|JQS_wTail
)paren
suffix:semicolon
multiline_comment|/* Tell the DSP to play the bank */
id|msnd_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_PLAY_START
)paren
suffix:semicolon
)brace
r_return
id|nbanks
suffix:semicolon
)brace
DECL|function|dsp_read
r_static
r_int
id|dsp_read
c_func
(paren
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|count
op_assign
id|len
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_int
id|n
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Critical section: protect fifo in non-interrupt */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|msnd_fifo_read
c_func
(paren
op_amp
id|dev.DARF
comma
id|buf
comma
id|count
comma
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: FIFO read error&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
id|buf
op_add_assign
id|n
suffix:semicolon
id|count
op_sub_assign
id|n
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
op_logical_and
id|dev.mode
op_amp
id|FMODE_READ
)paren
(brace
id|dev.last_recbank
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|chk_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_RECORD_START
)paren
op_eq
l_int|0
)paren
id|set_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev.rec_ndelay
)paren
r_return
id|count
op_eq
id|len
ques
c_cond
op_minus
id|EAGAIN
suffix:colon
id|len
op_minus
id|count
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
(brace
id|set_bit
c_func
(paren
id|F_READBLOCK
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|dev.readblock
comma
id|get_rec_delay_jiffies
c_func
(paren
id|DAR_BUFF_SIZE
)paren
)paren
)paren
id|clear_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_READBLOCK
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
)brace
r_return
id|len
op_minus
id|count
suffix:semicolon
)brace
DECL|function|dsp_write
r_static
r_int
id|dsp_write
c_func
(paren
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|count
op_assign
id|len
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_int
id|n
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Critical section: protect fifo in non-interrupt */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|msnd_fifo_write
c_func
(paren
op_amp
id|dev.DAPF
comma
id|buf
comma
id|count
comma
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: FIFO write error&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
id|buf
op_add_assign
id|n
suffix:semicolon
id|count
op_sub_assign
id|n
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
op_logical_and
(paren
id|dev.mode
op_amp
id|FMODE_WRITE
)paren
)paren
(brace
id|dev.last_playbank
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pack_DAPF_to_DAPQ
c_func
(paren
l_int|1
)paren
OG
l_int|0
)paren
id|set_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev.play_ndelay
)paren
r_return
id|count
op_eq
id|len
ques
c_cond
op_minus
id|EAGAIN
suffix:colon
id|len
op_minus
id|count
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
(brace
id|set_bit
c_func
(paren
id|F_WRITEBLOCK
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|dev.writeblock
comma
id|get_play_delay_jiffies
c_func
(paren
id|DAP_BUFF_SIZE
)paren
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_WRITEBLOCK
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
)brace
r_return
id|len
op_minus
id|count
suffix:semicolon
)brace
DECL|function|dev_read
r_static
id|ssize_t
id|dev_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|dev.dsp_minor
)paren
r_return
id|dsp_read
c_func
(paren
id|buf
comma
id|count
)paren
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|dev_write
r_static
id|ssize_t
id|dev_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|minor
op_eq
id|dev.dsp_minor
)paren
r_return
id|dsp_write
c_func
(paren
id|buf
comma
id|count
)paren
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|eval_dsp_msg
r_static
id|__inline__
r_void
id|eval_dsp_msg
c_func
(paren
r_register
id|WORD
id|wMessage
)paren
(brace
r_switch
c_cond
(paren
id|HIBYTE
c_func
(paren
id|wMessage
)paren
)paren
(brace
r_case
id|HIMT_PLAY_DONE
suffix:colon
r_if
c_cond
(paren
id|dev.last_playbank
op_eq
id|LOBYTE
c_func
(paren
id|wMessage
)paren
op_logical_or
op_logical_neg
id|test_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
)paren
r_break
suffix:semicolon
id|dev.last_playbank
op_assign
id|LOBYTE
c_func
(paren
id|wMessage
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pack_DAPF_to_DAPQ
c_func
(paren
l_int|0
)paren
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|F_WRITEBLOCK
comma
op_amp
id|dev.flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|F_WRITEFLUSH
comma
op_amp
id|dev.flags
)paren
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev.writeflush
)paren
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_WRITEBLOCK
comma
op_amp
id|dev.flags
)paren
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev.writeblock
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIMT_RECORD_DONE
suffix:colon
r_if
c_cond
(paren
id|dev.last_recbank
op_eq
id|LOBYTE
c_func
(paren
id|wMessage
)paren
)paren
r_break
suffix:semicolon
id|dev.last_recbank
op_assign
id|LOBYTE
c_func
(paren
id|wMessage
)paren
suffix:semicolon
id|pack_DARQ_to_DARF
c_func
(paren
id|dev.last_recbank
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_READBLOCK
comma
op_amp
id|dev.flags
)paren
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|dev.readblock
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIMT_DSP
suffix:colon
r_switch
c_cond
(paren
id|LOBYTE
c_func
(paren
id|wMessage
)paren
)paren
(brace
macro_line|#ifndef MSND_CLASSIC
r_case
id|HIDSP_PLAY_UNDER
suffix:colon
macro_line|#endif
r_case
id|HIDSP_INT_PLAY_UNDER
suffix:colon
multiline_comment|/*&t;&t;&t;printk(KERN_DEBUG LOGNAME &quot;: Play underflow&bslash;n&quot;); */
id|clear_bit
c_func
(paren
id|F_WRITING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIDSP_INT_RECORD_OVER
suffix:colon
multiline_comment|/*&t;&t;&t;printk(KERN_DEBUG LOGNAME &quot;: Record overflow&bslash;n&quot;); */
id|clear_bit
c_func
(paren
id|F_READING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/*&t;&t;&t;printk(KERN_DEBUG LOGNAME &quot;: DSP message %d 0x%02x&bslash;n&quot;,&n;&t;&t;&t;LOBYTE(wMessage), LOBYTE(wMessage)); */
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|HIMT_MIDI_IN_UCHAR
suffix:colon
r_if
c_cond
(paren
id|dev.midi_in_interrupt
)paren
(paren
op_star
id|dev.midi_in_interrupt
)paren
(paren
op_amp
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/*&t;&t;printk(KERN_DEBUG LOGNAME &quot;: HIMT message %d 0x%02x&bslash;n&quot;, HIBYTE(wMessage), HIBYTE(wMessage)); */
r_break
suffix:semicolon
)brace
)brace
DECL|function|intr
r_static
r_void
id|intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
multiline_comment|/* Send ack to DSP */
id|inb
c_func
(paren
id|dev.io
op_plus
id|HP_RXL
)paren
suffix:semicolon
multiline_comment|/* Evaluate queued DSP messages */
r_while
c_loop
(paren
id|isa_readw
c_func
(paren
id|dev.DSPQ
op_plus
id|JQS_wTail
)paren
op_ne
id|isa_readw
c_func
(paren
id|dev.DSPQ
op_plus
id|JQS_wHead
)paren
)paren
(brace
r_register
id|WORD
id|wTmp
suffix:semicolon
id|eval_dsp_msg
c_func
(paren
id|isa_readw
c_func
(paren
id|dev.pwDSPQData
op_plus
l_int|2
op_star
id|isa_readw
c_func
(paren
id|dev.DSPQ
op_plus
id|JQS_wHead
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wTmp
op_assign
id|isa_readw
c_func
(paren
id|dev.DSPQ
op_plus
id|JQS_wHead
)paren
op_plus
l_int|1
)paren
OG
id|isa_readw
c_func
(paren
id|dev.DSPQ
op_plus
id|JQS_wSize
)paren
)paren
id|isa_writew
c_func
(paren
l_int|0
comma
id|dev.DSPQ
op_plus
id|JQS_wHead
)paren
suffix:semicolon
r_else
id|isa_writew
c_func
(paren
id|wTmp
comma
id|dev.DSPQ
op_plus
id|JQS_wHead
)paren
suffix:semicolon
)brace
)brace
DECL|variable|dev_fileops
r_static
r_struct
id|file_operations
id|dev_fileops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|read
suffix:colon
id|dev_read
comma
id|write
suffix:colon
id|dev_write
comma
id|ioctl
suffix:colon
id|dev_ioctl
comma
id|open
suffix:colon
id|dev_open
comma
id|release
suffix:colon
id|dev_release
comma
)brace
suffix:semicolon
DECL|function|reset_dsp
r_static
r_int
id|reset_dsp
c_func
(paren
r_void
)paren
(brace
r_int
id|timeout
op_assign
l_int|100
suffix:semicolon
id|outb
c_func
(paren
id|HPDSPRESET_ON
comma
id|dev.io
op_plus
id|HP_DSPR
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|dev.info
op_assign
id|inb
c_func
(paren
id|dev.io
op_plus
id|HP_INFO
)paren
suffix:semicolon
macro_line|#endif
id|outb
c_func
(paren
id|HPDSPRESET_OFF
comma
id|dev.io
op_plus
id|HP_DSPR
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|inb
c_func
(paren
id|dev.io
op_plus
id|HP_CVR
)paren
op_eq
id|HP_CVR_DEF
)paren
r_return
l_int|0
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Cannot reset DSP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|probe_multisound
r_static
r_int
id|__init
id|probe_multisound
c_func
(paren
r_void
)paren
(brace
macro_line|#ifndef MSND_CLASSIC
r_char
op_star
id|xv
comma
op_star
id|rev
op_assign
l_int|NULL
suffix:semicolon
r_char
op_star
id|pin
op_assign
l_string|&quot;Pinnacle&quot;
comma
op_star
id|fiji
op_assign
l_string|&quot;Fiji&quot;
suffix:semicolon
r_char
op_star
id|pinfiji
op_assign
l_string|&quot;Pinnacle/Fiji&quot;
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: I/O port conflict&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|request_region
c_func
(paren
id|dev.io
comma
id|dev.numio
comma
l_string|&quot;probing&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reset_dsp
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#ifdef MSND_CLASSIC
id|dev.name
op_assign
l_string|&quot;Classic/Tahiti/Monterey&quot;
suffix:semicolon
id|printk
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: %s, &quot;
macro_line|#else
r_switch
c_cond
(paren
id|dev.info
op_rshift
l_int|4
)paren
(brace
r_case
l_int|0xf
suffix:colon
id|xv
op_assign
l_string|&quot;&lt;= 1.15&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1
suffix:colon
id|xv
op_assign
l_string|&quot;1.18/1.2&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
id|xv
op_assign
l_string|&quot;1.3&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
id|xv
op_assign
l_string|&quot;1.4&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|xv
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|dev.info
op_amp
l_int|0x7
)paren
(brace
r_case
l_int|0x0
suffix:colon
id|rev
op_assign
l_string|&quot;I&quot;
suffix:semicolon
id|dev.name
op_assign
id|pin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1
suffix:colon
id|rev
op_assign
l_string|&quot;F&quot;
suffix:semicolon
id|dev.name
op_assign
id|pin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
id|rev
op_assign
l_string|&quot;G&quot;
suffix:semicolon
id|dev.name
op_assign
id|pin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
id|rev
op_assign
l_string|&quot;H&quot;
suffix:semicolon
id|dev.name
op_assign
id|pin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x4
suffix:colon
id|rev
op_assign
l_string|&quot;E&quot;
suffix:semicolon
id|dev.name
op_assign
id|fiji
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x5
suffix:colon
id|rev
op_assign
l_string|&quot;C&quot;
suffix:semicolon
id|dev.name
op_assign
id|fiji
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x6
suffix:colon
id|rev
op_assign
l_string|&quot;D&quot;
suffix:semicolon
id|dev.name
op_assign
id|fiji
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x7
suffix:colon
id|rev
op_assign
l_string|&quot;A-B (Fiji) or A-E (Pinnacle)&quot;
suffix:semicolon
id|dev.name
op_assign
id|pinfiji
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: %s revision %s, Xilinx version %s, &quot;
macro_line|#endif /* MSND_CLASSIC */
l_string|&quot;I/O 0x%x-0x%x, IRQ %d, memory mapped to 0x%lX-0x%lX&bslash;n&quot;
comma
id|dev.name
comma
macro_line|#ifndef MSND_CLASSIC
id|rev
comma
id|xv
comma
macro_line|#endif
id|dev.io
comma
id|dev.io
op_plus
id|dev.numio
op_minus
l_int|1
comma
id|dev.irq
comma
id|dev.base
comma
id|dev.base
op_plus
l_int|0x7fff
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|init_sma
r_static
r_int
id|init_sma
c_func
(paren
r_void
)paren
(brace
r_static
r_int
id|initted
suffix:semicolon
id|WORD
id|mastVolLeft
comma
id|mastVolRight
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
macro_line|#ifdef MSND_CLASSIC
id|outb
c_func
(paren
id|dev.memid
comma
id|dev.io
op_plus
id|HP_MEMM
)paren
suffix:semicolon
macro_line|#endif
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|initted
)paren
(brace
id|mastVolLeft
op_assign
id|isa_readw
c_func
(paren
id|dev.SMA
op_plus
id|SMA_wCurrMastVolLeft
)paren
suffix:semicolon
id|mastVolRight
op_assign
id|isa_readw
c_func
(paren
id|dev.SMA
op_plus
id|SMA_wCurrMastVolRight
)paren
suffix:semicolon
)brace
r_else
id|mastVolLeft
op_assign
id|mastVolRight
op_assign
l_int|0
suffix:semicolon
id|isa_memset_io
c_func
(paren
id|dev.base
comma
l_int|0
comma
l_int|0x8000
)paren
suffix:semicolon
multiline_comment|/* Critical section: bank 1 access */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBLKSEL_1
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|isa_memset_io
c_func
(paren
id|dev.base
comma
l_int|0
comma
l_int|0x8000
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dev.lock
comma
id|flags
)paren
suffix:semicolon
id|dev.pwDSPQData
op_assign
(paren
id|dev.base
op_plus
id|DSPQ_DATA_BUFF
)paren
suffix:semicolon
id|dev.pwMODQData
op_assign
(paren
id|dev.base
op_plus
id|MODQ_DATA_BUFF
)paren
suffix:semicolon
id|dev.pwMIDQData
op_assign
(paren
id|dev.base
op_plus
id|MIDQ_DATA_BUFF
)paren
suffix:semicolon
multiline_comment|/* Motorola 56k shared memory base */
id|dev.SMA
op_assign
id|dev.base
op_plus
id|SMA_STRUCT_START
suffix:semicolon
multiline_comment|/* Digital audio play queue */
id|dev.DAPQ
op_assign
id|dev.base
op_plus
id|DAPQ_OFFSET
suffix:semicolon
id|msnd_init_queue
c_func
(paren
id|dev.DAPQ
comma
id|DAPQ_DATA_BUFF
comma
id|DAPQ_BUFF_SIZE
)paren
suffix:semicolon
multiline_comment|/* Digital audio record queue */
id|dev.DARQ
op_assign
id|dev.base
op_plus
id|DARQ_OFFSET
suffix:semicolon
id|msnd_init_queue
c_func
(paren
id|dev.DARQ
comma
id|DARQ_DATA_BUFF
comma
id|DARQ_BUFF_SIZE
)paren
suffix:semicolon
multiline_comment|/* MIDI out queue */
id|dev.MODQ
op_assign
id|dev.base
op_plus
id|MODQ_OFFSET
suffix:semicolon
id|msnd_init_queue
c_func
(paren
id|dev.MODQ
comma
id|MODQ_DATA_BUFF
comma
id|MODQ_BUFF_SIZE
)paren
suffix:semicolon
multiline_comment|/* MIDI in queue */
id|dev.MIDQ
op_assign
id|dev.base
op_plus
id|MIDQ_OFFSET
suffix:semicolon
id|msnd_init_queue
c_func
(paren
id|dev.MIDQ
comma
id|MIDQ_DATA_BUFF
comma
id|MIDQ_BUFF_SIZE
)paren
suffix:semicolon
multiline_comment|/* DSP -&gt; host message queue */
id|dev.DSPQ
op_assign
id|dev.base
op_plus
id|DSPQ_OFFSET
suffix:semicolon
id|msnd_init_queue
c_func
(paren
id|dev.DSPQ
comma
id|DSPQ_DATA_BUFF
comma
id|DSPQ_BUFF_SIZE
)paren
suffix:semicolon
multiline_comment|/* Setup some DSP values */
macro_line|#ifndef MSND_CLASSIC
id|isa_writew
c_func
(paren
l_int|1
comma
id|dev.SMA
op_plus
id|SMA_wCurrPlayFormat
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|dev.play_sample_size
comma
id|dev.SMA
op_plus
id|SMA_wCurrPlaySampleSize
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|dev.play_channels
comma
id|dev.SMA
op_plus
id|SMA_wCurrPlayChannels
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|dev.play_sample_rate
comma
id|dev.SMA
op_plus
id|SMA_wCurrPlaySampleRate
)paren
suffix:semicolon
macro_line|#endif
id|isa_writew
c_func
(paren
id|dev.play_sample_rate
comma
id|dev.SMA
op_plus
id|SMA_wCalFreqAtoD
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|mastVolLeft
comma
id|dev.SMA
op_plus
id|SMA_wCurrMastVolLeft
)paren
suffix:semicolon
id|isa_writew
c_func
(paren
id|mastVolRight
comma
id|dev.SMA
op_plus
id|SMA_wCurrMastVolRight
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|isa_writel
c_func
(paren
l_int|0x00010000
comma
id|dev.SMA
op_plus
id|SMA_dwCurrPlayPitch
)paren
suffix:semicolon
id|isa_writel
c_func
(paren
l_int|0x00000001
comma
id|dev.SMA
op_plus
id|SMA_dwCurrPlayRate
)paren
suffix:semicolon
macro_line|#endif
id|isa_writew
c_func
(paren
l_int|0x303
comma
id|dev.SMA
op_plus
id|SMA_wCurrInputTagBits
)paren
suffix:semicolon
id|initted
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|calibrate_adc
r_static
r_int
id|__init
id|calibrate_adc
c_func
(paren
id|WORD
id|srate
)paren
(brace
id|isa_writew
c_func
(paren
id|srate
comma
id|dev.SMA
op_plus
id|SMA_wCalFreqAtoD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev.calibrate_signal
op_eq
l_int|0
)paren
id|isa_writew
c_func
(paren
id|isa_readw
c_func
(paren
id|dev.SMA
op_plus
id|SMA_wCurrHostStatusFlags
)paren
op_or
l_int|0x0001
comma
id|dev.SMA
op_plus
id|SMA_wCurrHostStatusFlags
)paren
suffix:semicolon
r_else
id|isa_writew
c_func
(paren
id|isa_readw
c_func
(paren
id|dev.SMA
op_plus
id|SMA_wCurrHostStatusFlags
)paren
op_amp
op_complement
l_int|0x0001
comma
id|dev.SMA
op_plus
id|SMA_wCurrHostStatusFlags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_send_word
c_func
(paren
op_amp
id|dev
comma
l_int|0
comma
l_int|0
comma
id|HDEXAR_CAL_A_TO_D
)paren
op_eq
l_int|0
op_logical_and
id|chk_send_dsp_cmd
c_func
(paren
op_amp
id|dev
comma
id|HDEX_AUX_REQ
)paren
op_eq
l_int|0
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: ADC calibration failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|upload_dsp_code
r_static
r_int
id|upload_dsp_code
c_func
(paren
r_void
)paren
(brace
id|outb
c_func
(paren
id|HPBLKSEL_0
comma
id|dev.io
op_plus
id|HP_BLKS
)paren
suffix:semicolon
macro_line|#ifndef HAVE_DSPCODEH
id|INITCODESIZE
op_assign
id|mod_firmware_load
c_func
(paren
id|INITCODEFILE
comma
op_amp
id|INITCODE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|INITCODE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Error loading &quot;
id|INITCODEFILE
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|PERMCODESIZE
op_assign
id|mod_firmware_load
c_func
(paren
id|PERMCODEFILE
comma
op_amp
id|PERMCODE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|PERMCODE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Error loading &quot;
id|PERMCODEFILE
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|INITCODE
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
macro_line|#endif
id|isa_memcpy_toio
c_func
(paren
id|dev.base
comma
id|PERMCODE
comma
id|PERMCODESIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_upload_host
c_func
(paren
op_amp
id|dev
comma
id|INITCODE
comma
id|INITCODESIZE
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: Error uploading to DSP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#ifdef HAVE_DSPCODEH
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: DSP firmware uploaded (resident)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: DSP firmware uploaded&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifndef HAVE_DSPCODEH
id|vfree
c_func
(paren
id|INITCODE
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|PERMCODE
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MSND_CLASSIC
DECL|function|reset_proteus
r_static
r_void
id|reset_proteus
c_func
(paren
r_void
)paren
(brace
id|outb
c_func
(paren
id|HPPRORESET_ON
comma
id|dev.io
op_plus
id|HP_PROR
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|TIME_PRO_RESET
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPPRORESET_OFF
comma
id|dev.io
op_plus
id|HP_PROR
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|TIME_PRO_RESET_DONE
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|initialize
r_static
r_int
id|initialize
c_func
(paren
r_void
)paren
(brace
r_int
id|err
comma
id|timeout
suffix:semicolon
macro_line|#ifdef MSND_CLASSIC
id|outb
c_func
(paren
id|HPWAITSTATE_0
comma
id|dev.io
op_plus
id|HP_WAIT
)paren
suffix:semicolon
id|outb
c_func
(paren
id|HPBITMODE_16
comma
id|dev.io
op_plus
id|HP_BITM
)paren
suffix:semicolon
id|reset_proteus
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|err
op_assign
id|init_sma
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: Cannot initialize SMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|reset_dsp
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|upload_dsp_code
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: Cannot upload DSP code&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|timeout
op_assign
l_int|200
suffix:semicolon
r_while
c_loop
(paren
id|isa_readw
c_func
(paren
id|dev.base
)paren
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
op_decrement
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
id|LOGNAME
l_string|&quot;: DSP reset timeout&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
id|mixer_setup
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dsp_full_reset
r_static
r_int
id|dsp_full_reset
c_func
(paren
r_void
)paren
(brace
r_int
id|rv
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|F_RESETTING
comma
op_amp
id|dev.flags
)paren
op_logical_or
op_increment
id|dev.nresets
OG
l_int|10
)paren
r_return
l_int|0
suffix:semicolon
id|set_bit
c_func
(paren
id|F_RESETTING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: DSP reset&bslash;n&quot;
)paren
suffix:semicolon
id|dsp_halt
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* Unconditionally halt */
r_if
c_cond
(paren
(paren
id|rv
op_assign
id|initialize
c_func
(paren
)paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: DSP reset failed&bslash;n&quot;
)paren
suffix:semicolon
id|force_recsrc
c_func
(paren
id|dev.recsrc
)paren
suffix:semicolon
id|dsp_open
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|F_RESETTING
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
DECL|function|attach_multisound
r_static
r_int
id|__init
id|attach_multisound
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|request_irq
c_func
(paren
id|dev.irq
comma
id|intr
comma
l_int|0
comma
id|dev.name
comma
op_amp
id|dev
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Couldn&squot;t grab IRQ %d&bslash;n&quot;
comma
id|dev.irq
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|request_region
c_func
(paren
id|dev.io
comma
id|dev.numio
comma
id|dev.name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dsp_full_reset
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev.irq
comma
op_amp
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|msnd_register
c_func
(paren
op_amp
id|dev
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Unable to register MultiSound&bslash;n&quot;
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev.irq
comma
op_amp
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev.dsp_minor
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|dev_fileops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Unable to register DSP operations&bslash;n&quot;
)paren
suffix:semicolon
id|msnd_unregister
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev.irq
comma
op_amp
id|dev
)paren
suffix:semicolon
r_return
id|dev.dsp_minor
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev.mixer_minor
op_assign
id|register_sound_mixer
c_func
(paren
op_amp
id|dev_fileops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Unable to register mixer operations&bslash;n&quot;
)paren
suffix:semicolon
id|unregister_sound_mixer
c_func
(paren
id|dev.mixer_minor
)paren
suffix:semicolon
id|msnd_unregister
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev.irq
comma
op_amp
id|dev
)paren
suffix:semicolon
r_return
id|dev.mixer_minor
suffix:semicolon
)brace
id|dev.ext_midi_dev
op_assign
id|dev.hdr_midi_dev
op_assign
op_minus
l_int|1
suffix:semicolon
id|disable_irq
c_func
(paren
id|dev.irq
)paren
suffix:semicolon
id|calibrate_adc
c_func
(paren
id|dev.play_sample_rate
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|force_recsrc
c_func
(paren
id|SOUND_MASK_IMIX
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|unload_multisound
r_static
r_void
id|__exit
id|unload_multisound
c_func
(paren
r_void
)paren
(brace
id|release_region
c_func
(paren
id|dev.io
comma
id|dev.numio
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev.irq
comma
op_amp
id|dev
)paren
suffix:semicolon
id|unregister_sound_mixer
c_func
(paren
id|dev.mixer_minor
)paren
suffix:semicolon
id|unregister_sound_dsp
c_func
(paren
id|dev.dsp_minor
)paren
suffix:semicolon
id|msnd_unregister
c_func
(paren
op_amp
id|dev
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifndef MSND_CLASSIC
multiline_comment|/* Pinnacle/Fiji Logical Device Configuration */
DECL|function|msnd_write_cfg
r_static
r_int
id|__init
id|msnd_write_cfg
c_func
(paren
r_int
id|cfg
comma
r_int
id|reg
comma
r_int
id|value
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|cfg
)paren
suffix:semicolon
id|outb
c_func
(paren
id|value
comma
id|cfg
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
id|inb
c_func
(paren
id|cfg
op_plus
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: msnd_write_cfg: I/O error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|msnd_write_cfg_io0
r_static
r_int
id|__init
id|msnd_write_cfg_io0
c_func
(paren
r_int
id|cfg
comma
r_int
id|num
comma
id|WORD
id|io
)paren
(brace
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_LOGDEVICE
comma
id|num
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_IO0_BASEHI
comma
id|HIBYTE
c_func
(paren
id|io
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_IO0_BASELO
comma
id|LOBYTE
c_func
(paren
id|io
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|msnd_write_cfg_io1
r_static
r_int
id|__init
id|msnd_write_cfg_io1
c_func
(paren
r_int
id|cfg
comma
r_int
id|num
comma
id|WORD
id|io
)paren
(brace
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_LOGDEVICE
comma
id|num
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_IO1_BASEHI
comma
id|HIBYTE
c_func
(paren
id|io
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_IO1_BASELO
comma
id|LOBYTE
c_func
(paren
id|io
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|msnd_write_cfg_irq
r_static
r_int
id|__init
id|msnd_write_cfg_irq
c_func
(paren
r_int
id|cfg
comma
r_int
id|num
comma
id|WORD
id|irq
)paren
(brace
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_LOGDEVICE
comma
id|num
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_IRQ_NUMBER
comma
id|LOBYTE
c_func
(paren
id|irq
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_IRQ_TYPE
comma
id|IRQTYPE_EDGE
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|msnd_write_cfg_mem
r_static
r_int
id|__init
id|msnd_write_cfg_mem
c_func
(paren
r_int
id|cfg
comma
r_int
id|num
comma
r_int
id|mem
)paren
(brace
id|WORD
id|wmem
suffix:semicolon
id|mem
op_rshift_assign
l_int|8
suffix:semicolon
id|mem
op_and_assign
l_int|0xfff
suffix:semicolon
id|wmem
op_assign
(paren
id|WORD
)paren
id|mem
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_LOGDEVICE
comma
id|num
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_MEMBASEHI
comma
id|HIBYTE
c_func
(paren
id|wmem
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_MEMBASELO
comma
id|LOBYTE
c_func
(paren
id|wmem
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|wmem
op_logical_and
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_MEMCONTROL
comma
(paren
id|MEMTYPE_HIADDR
op_or
id|MEMTYPE_16BIT
)paren
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|msnd_activate_logical
r_static
r_int
id|__init
id|msnd_activate_logical
c_func
(paren
r_int
id|cfg
comma
r_int
id|num
)paren
(brace
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_LOGDEVICE
comma
id|num
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_ACTIVATE
comma
id|LD_ACTIVATE
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|msnd_write_cfg_logical
r_static
r_int
id|__init
id|msnd_write_cfg_logical
c_func
(paren
r_int
id|cfg
comma
r_int
id|num
comma
id|WORD
id|io0
comma
id|WORD
id|io1
comma
id|WORD
id|irq
comma
r_int
id|mem
)paren
(brace
r_if
c_cond
(paren
id|msnd_write_cfg
c_func
(paren
id|cfg
comma
id|IREG_LOGDEVICE
comma
id|num
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg_io0
c_func
(paren
id|cfg
comma
id|num
comma
id|io0
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg_io1
c_func
(paren
id|cfg
comma
id|num
comma
id|io1
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg_irq
c_func
(paren
id|cfg
comma
id|num
comma
id|irq
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_write_cfg_mem
c_func
(paren
id|cfg
comma
id|num
comma
id|mem
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|msnd_activate_logical
c_func
(paren
id|cfg
comma
id|num
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|msnd_pinnacle_cfg_device
r_typedef
r_struct
id|msnd_pinnacle_cfg_device
(brace
DECL|member|io0
DECL|member|io1
DECL|member|irq
id|WORD
id|io0
comma
id|io1
comma
id|irq
suffix:semicolon
DECL|member|mem
r_int
id|mem
suffix:semicolon
DECL|typedef|msnd_pinnacle_cfg_t
)brace
id|msnd_pinnacle_cfg_t
(braket
l_int|4
)braket
suffix:semicolon
DECL|function|msnd_pinnacle_cfg_devices
r_static
r_int
id|__init
id|msnd_pinnacle_cfg_devices
c_func
(paren
r_int
id|cfg
comma
r_int
id|reset
comma
id|msnd_pinnacle_cfg_t
id|device
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Reset devices if told to */
r_if
c_cond
(paren
id|reset
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Resetting all devices&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|msnd_write_cfg_logical
c_func
(paren
id|cfg
comma
id|i
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* Configure specified devices */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
op_increment
id|i
)paren
(brace
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* DSP */
r_if
c_cond
(paren
op_logical_neg
(paren
id|device
(braket
id|i
)braket
dot
id|io0
op_logical_and
id|device
(braket
id|i
)braket
dot
id|irq
op_logical_and
id|device
(braket
id|i
)braket
dot
id|mem
)paren
)paren
r_continue
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* MPU */
r_if
c_cond
(paren
op_logical_neg
(paren
id|device
(braket
id|i
)braket
dot
id|io0
op_logical_and
id|device
(braket
id|i
)braket
dot
id|irq
)paren
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Configuring MPU to I/O 0x%x IRQ %d&bslash;n&quot;
comma
id|device
(braket
id|i
)braket
dot
id|io0
comma
id|device
(braket
id|i
)braket
dot
id|irq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* IDE */
r_if
c_cond
(paren
op_logical_neg
(paren
id|device
(braket
id|i
)braket
dot
id|io0
op_logical_and
id|device
(braket
id|i
)braket
dot
id|io1
op_logical_and
id|device
(braket
id|i
)braket
dot
id|irq
)paren
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Configuring IDE to I/O 0x%x, 0x%x IRQ %d&bslash;n&quot;
comma
id|device
(braket
id|i
)braket
dot
id|io0
comma
id|device
(braket
id|i
)braket
dot
id|io1
comma
id|device
(braket
id|i
)braket
dot
id|irq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* Joystick */
r_if
c_cond
(paren
op_logical_neg
(paren
id|device
(braket
id|i
)braket
dot
id|io0
)paren
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Configuring joystick to I/O 0x%x&bslash;n&quot;
comma
id|device
(braket
id|i
)braket
dot
id|io0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Configure the device */
r_if
c_cond
(paren
id|msnd_write_cfg_logical
c_func
(paren
id|cfg
comma
id|i
comma
id|device
(braket
id|i
)braket
dot
id|io0
comma
id|device
(braket
id|i
)braket
dot
id|io1
comma
id|device
(braket
id|i
)braket
dot
id|irq
comma
id|device
(braket
id|i
)braket
dot
id|mem
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef MODULE
id|MODULE_AUTHOR
(paren
l_string|&quot;Andrew Veliath &lt;andrewtv@usa.net&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
(paren
l_string|&quot;Turtle Beach &quot;
id|LONGNAME
l_string|&quot; Linux Driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|mem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|write_ndelay
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|major
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|fifosize
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|calibrate_signal
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
id|MODULE_PARM
(paren
id|digital
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|cfg
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|reset
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|mpu_io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|mpu_irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|ide_io0
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|ide_io1
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|ide_irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|joystick_io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|io
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|irq
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|mem
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|write_ndelay
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
multiline_comment|/* Pinnacle/Fiji non-PnP Config Port */
DECL|variable|__initdata
r_static
r_int
id|cfg
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Extra Peripheral Configuration */
DECL|variable|__initdata
r_static
r_int
id|reset
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|mpu_io
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|mpu_irq
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|ide_io0
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|ide_io1
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|ide_irq
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|joystick_io
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* If we have the digital daugherboard... */
DECL|variable|__initdata
r_static
r_int
id|digital
id|__initdata
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|fifosize
id|__initdata
op_assign
id|DEFFIFOSIZE
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|calibrate_signal
id|__initdata
op_assign
l_int|0
suffix:semicolon
macro_line|#else /* not a module */
DECL|variable|__initdata
r_static
r_int
id|write_ndelay
id|__initdata
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef MSND_CLASSIC
DECL|variable|__initdata
r_static
r_int
id|io
id|__initdata
op_assign
id|CONFIG_MSNDCLAS_IO
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|irq
id|__initdata
op_assign
id|CONFIG_MSNDCLAS_IRQ
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|mem
id|__initdata
op_assign
id|CONFIG_MSNDCLAS_MEM
suffix:semicolon
macro_line|#else /* Pinnacle/Fiji */
DECL|variable|__initdata
r_static
r_int
id|io
id|__initdata
op_assign
id|CONFIG_MSNDPIN_IO
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|irq
id|__initdata
op_assign
id|CONFIG_MSNDPIN_IRQ
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|mem
id|__initdata
op_assign
id|CONFIG_MSNDPIN_MEM
suffix:semicolon
multiline_comment|/* Pinnacle/Fiji non-PnP Config Port */
macro_line|#ifdef CONFIG_MSNDPIN_NONPNP
macro_line|#  ifndef CONFIG_MSNDPIN_CFG
DECL|macro|CONFIG_MSNDPIN_CFG
macro_line|#    define CONFIG_MSNDPIN_CFG&t;&t;0x250
macro_line|#  endif
macro_line|#else
macro_line|#  ifdef CONFIG_MSNDPIN_CFG
DECL|macro|CONFIG_MSNDPIN_CFG
macro_line|#    undef CONFIG_MSNDPIN_CFG
macro_line|#  endif
DECL|macro|CONFIG_MSNDPIN_CFG
macro_line|#  define CONFIG_MSNDPIN_CFG&t;&t;-1
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|cfg
id|__initdata
op_assign
id|CONFIG_MSNDPIN_CFG
suffix:semicolon
multiline_comment|/* If not a module, we don&squot;t need to bother with reset=1 */
DECL|variable|reset
r_static
r_int
id|reset
suffix:semicolon
multiline_comment|/* Extra Peripheral Configuration (Default: Disable) */
macro_line|#ifndef CONFIG_MSNDPIN_MPU_IO
DECL|macro|CONFIG_MSNDPIN_MPU_IO
macro_line|#  define CONFIG_MSNDPIN_MPU_IO&t;&t;0
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|mpu_io
id|__initdata
op_assign
id|CONFIG_MSNDPIN_MPU_IO
suffix:semicolon
macro_line|#ifndef CONFIG_MSNDPIN_MPU_IRQ
DECL|macro|CONFIG_MSNDPIN_MPU_IRQ
macro_line|#  define CONFIG_MSNDPIN_MPU_IRQ&t;0
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|mpu_irq
id|__initdata
op_assign
id|CONFIG_MSNDPIN_MPU_IRQ
suffix:semicolon
macro_line|#ifndef CONFIG_MSNDPIN_IDE_IO0
DECL|macro|CONFIG_MSNDPIN_IDE_IO0
macro_line|#  define CONFIG_MSNDPIN_IDE_IO0&t;0
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|ide_io0
id|__initdata
op_assign
id|CONFIG_MSNDPIN_IDE_IO0
suffix:semicolon
macro_line|#ifndef CONFIG_MSNDPIN_IDE_IO1
DECL|macro|CONFIG_MSNDPIN_IDE_IO1
macro_line|#  define CONFIG_MSNDPIN_IDE_IO1&t;0
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|ide_io1
id|__initdata
op_assign
id|CONFIG_MSNDPIN_IDE_IO1
suffix:semicolon
macro_line|#ifndef CONFIG_MSNDPIN_IDE_IRQ
DECL|macro|CONFIG_MSNDPIN_IDE_IRQ
macro_line|#  define CONFIG_MSNDPIN_IDE_IRQ&t;0
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|ide_irq
id|__initdata
op_assign
id|CONFIG_MSNDPIN_IDE_IRQ
suffix:semicolon
macro_line|#ifndef CONFIG_MSNDPIN_JOYSTICK_IO
DECL|macro|CONFIG_MSNDPIN_JOYSTICK_IO
macro_line|#  define CONFIG_MSNDPIN_JOYSTICK_IO&t;0
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|joystick_io
id|__initdata
op_assign
id|CONFIG_MSNDPIN_JOYSTICK_IO
suffix:semicolon
multiline_comment|/* Have SPDIF (Digital) Daughterboard */
macro_line|#ifndef CONFIG_MSNDPIN_DIGITAL
DECL|macro|CONFIG_MSNDPIN_DIGITAL
macro_line|#  define CONFIG_MSNDPIN_DIGITAL&t;0
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|digital
id|__initdata
op_assign
id|CONFIG_MSNDPIN_DIGITAL
suffix:semicolon
macro_line|#endif /* MSND_CLASSIC */
macro_line|#ifndef CONFIG_MSND_FIFOSIZE
DECL|macro|CONFIG_MSND_FIFOSIZE
macro_line|#  define CONFIG_MSND_FIFOSIZE&t;&t;DEFFIFOSIZE
macro_line|#endif
DECL|variable|__initdata
r_static
r_int
id|fifosize
id|__initdata
op_assign
id|CONFIG_MSND_FIFOSIZE
suffix:semicolon
macro_line|#ifndef CONFIG_MSND_CALSIGNAL
DECL|macro|CONFIG_MSND_CALSIGNAL
macro_line|#  define CONFIG_MSND_CALSIGNAL&t;&t;0
macro_line|#endif
r_static
r_int
DECL|variable|__initdata
id|calibrate_signal
id|__initdata
op_assign
id|CONFIG_MSND_CALSIGNAL
suffix:semicolon
macro_line|#endif /* MODULE */
DECL|function|msnd_init
r_static
r_int
id|__init
id|msnd_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
r_static
id|msnd_pinnacle_cfg_t
id|pinnacle_devs
suffix:semicolon
macro_line|#endif /* MSND_CLASSIC */
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Turtle Beach &quot;
id|LONGNAME
l_string|&quot; Linux Driver Version &quot;
id|VERSION
l_string|&quot;, Copyright (C) 1998 Andrew Veliath&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io
op_eq
op_minus
l_int|1
op_logical_or
id|irq
op_eq
op_minus
l_int|1
op_logical_or
id|mem
op_eq
op_minus
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
id|LOGNAME
l_string|&quot;: io, irq and mem must be set&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io
op_eq
op_minus
l_int|1
op_logical_or
op_logical_neg
(paren
id|io
op_eq
l_int|0x290
op_logical_or
id|io
op_eq
l_int|0x260
op_logical_or
id|io
op_eq
l_int|0x250
op_logical_or
id|io
op_eq
l_int|0x240
op_logical_or
id|io
op_eq
l_int|0x230
op_logical_or
id|io
op_eq
l_int|0x220
op_logical_or
id|io
op_eq
l_int|0x210
op_logical_or
id|io
op_eq
l_int|0x3e0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: &bslash;&quot;io&bslash;&quot; - DSP I/O base must be set to 0x210, 0x220, 0x230, 0x240, 0x250, 0x260, 0x290, or 0x3E0&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
op_logical_or
op_logical_neg
(paren
id|irq
op_eq
l_int|5
op_logical_or
id|irq
op_eq
l_int|7
op_logical_or
id|irq
op_eq
l_int|9
op_logical_or
id|irq
op_eq
l_int|10
op_logical_or
id|irq
op_eq
l_int|11
op_logical_or
id|irq
op_eq
l_int|12
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: &bslash;&quot;irq&bslash;&quot; - must be set to 5, 7, 9, 10, 11 or 12&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mem
op_eq
op_minus
l_int|1
op_logical_or
op_logical_neg
(paren
id|mem
op_eq
l_int|0xb0000
op_logical_or
id|mem
op_eq
l_int|0xc8000
op_logical_or
id|mem
op_eq
l_int|0xd0000
op_logical_or
id|mem
op_eq
l_int|0xd8000
op_logical_or
id|mem
op_eq
l_int|0xe0000
op_logical_or
id|mem
op_eq
l_int|0xe8000
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: &bslash;&quot;mem&bslash;&quot; - must be set to &quot;
l_string|&quot;0xb0000, 0xc8000, 0xd0000, 0xd8000, 0xe0000 or 0xe8000&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#ifdef MSND_CLASSIC
r_switch
c_cond
(paren
id|irq
)paren
(brace
r_case
l_int|5
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_7
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_9
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_10
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|11
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_11
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
id|dev.irqid
op_assign
id|HPIRQ_12
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|mem
)paren
(brace
r_case
l_int|0xb0000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_B000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xc8000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_C800
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xd0000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_D000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xd8000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_D800
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xe0000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_E000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xe8000
suffix:colon
id|dev.memid
op_assign
id|HPMEM_E800
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
id|cfg
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Assuming PnP mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cfg
op_ne
l_int|0x250
op_logical_and
id|cfg
op_ne
l_int|0x260
op_logical_and
id|cfg
op_ne
l_int|0x270
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Config port must be 0x250, 0x260 or 0x270 (or unspecified for PnP mode)&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: Non-PnP mode: configuring at port 0x%x&bslash;n&quot;
comma
id|cfg
)paren
suffix:semicolon
multiline_comment|/* DSP */
id|pinnacle_devs
(braket
l_int|0
)braket
dot
id|io0
op_assign
id|io
suffix:semicolon
id|pinnacle_devs
(braket
l_int|0
)braket
dot
id|irq
op_assign
id|irq
suffix:semicolon
id|pinnacle_devs
(braket
l_int|0
)braket
dot
id|mem
op_assign
id|mem
suffix:semicolon
multiline_comment|/* The following are Pinnacle specific */
multiline_comment|/* MPU */
id|pinnacle_devs
(braket
l_int|1
)braket
dot
id|io0
op_assign
id|mpu_io
suffix:semicolon
id|pinnacle_devs
(braket
l_int|1
)braket
dot
id|irq
op_assign
id|mpu_irq
suffix:semicolon
multiline_comment|/* IDE */
id|pinnacle_devs
(braket
l_int|2
)braket
dot
id|io0
op_assign
id|ide_io0
suffix:semicolon
id|pinnacle_devs
(braket
l_int|2
)braket
dot
id|io1
op_assign
id|ide_io1
suffix:semicolon
id|pinnacle_devs
(braket
l_int|2
)braket
dot
id|irq
op_assign
id|ide_irq
suffix:semicolon
multiline_comment|/* Joystick */
id|pinnacle_devs
(braket
l_int|3
)braket
dot
id|io0
op_assign
id|joystick_io
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|cfg
comma
l_int|2
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Config port 0x%x conflict&bslash;n&quot;
comma
id|cfg
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|request_region
c_func
(paren
id|cfg
comma
l_int|2
comma
l_string|&quot;Pinnacle/Fiji Config&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msnd_pinnacle_cfg_devices
c_func
(paren
id|cfg
comma
id|reset
comma
id|pinnacle_devs
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Device configuration error&bslash;n&quot;
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|cfg
comma
l_int|2
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|release_region
c_func
(paren
id|cfg
comma
l_int|2
)paren
suffix:semicolon
)brace
macro_line|#endif /* MSND_CLASSIC */
r_if
c_cond
(paren
id|fifosize
OL
l_int|16
)paren
id|fifosize
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|fifosize
OG
l_int|1024
)paren
id|fifosize
op_assign
l_int|1024
suffix:semicolon
id|set_default_audio_parameters
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef MSND_CLASSIC
id|dev.type
op_assign
id|msndClassic
suffix:semicolon
macro_line|#else
id|dev.type
op_assign
id|msndPinnacle
suffix:semicolon
macro_line|#endif
id|dev.io
op_assign
id|io
suffix:semicolon
id|dev.numio
op_assign
id|DSP_NUMIO
suffix:semicolon
id|dev.irq
op_assign
id|irq
suffix:semicolon
id|dev.base
op_assign
id|mem
suffix:semicolon
id|dev.fifosize
op_assign
id|fifosize
op_star
l_int|1024
suffix:semicolon
id|dev.calibrate_signal
op_assign
id|calibrate_signal
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|dev.recsrc
op_assign
l_int|0
suffix:semicolon
id|dev.dspq_data_buff
op_assign
id|DSPQ_DATA_BUFF
suffix:semicolon
id|dev.dspq_buff_size
op_assign
id|DSPQ_BUFF_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|write_ndelay
op_eq
op_minus
l_int|1
)paren
id|write_ndelay
op_assign
id|CONFIG_MSND_WRITE_NDELAY
suffix:semicolon
r_if
c_cond
(paren
id|write_ndelay
)paren
id|clear_bit
c_func
(paren
id|F_DISABLE_WRITE_NDELAY
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
r_else
id|set_bit
c_func
(paren
id|F_DISABLE_WRITE_NDELAY
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
macro_line|#ifndef MSND_CLASSIC
r_if
c_cond
(paren
id|digital
)paren
id|set_bit
c_func
(paren
id|F_HAVEDIGITAL
comma
op_amp
id|dev.flags
)paren
suffix:semicolon
macro_line|#endif
id|init_waitqueue_head
c_func
(paren
op_amp
id|dev.writeblock
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|dev.readblock
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|dev.writeflush
)paren
suffix:semicolon
id|msnd_fifo_init
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|msnd_fifo_init
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|dev.lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|LOGNAME
l_string|&quot;: %u byte audio FIFOs (x2)&bslash;n&quot;
comma
id|dev.fifosize
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|msnd_fifo_alloc
c_func
(paren
op_amp
id|dev.DAPF
comma
id|dev.fifosize
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Couldn&squot;t allocate write FIFO&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|msnd_fifo_alloc
c_func
(paren
op_amp
id|dev.DARF
comma
id|dev.fifosize
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Couldn&squot;t allocate read FIFO&bslash;n&quot;
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|probe_multisound
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Probe failed&bslash;n&quot;
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|attach_multisound
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|LOGNAME
l_string|&quot;: Attach failed&bslash;n&quot;
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|msdn_cleanup
r_static
r_void
id|__exit
id|msdn_cleanup
c_func
(paren
r_void
)paren
(brace
id|unload_multisound
c_func
(paren
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DAPF
)paren
suffix:semicolon
id|msnd_fifo_free
c_func
(paren
op_amp
id|dev.DARF
)paren
suffix:semicolon
)brace
DECL|variable|msnd_init
id|module_init
c_func
(paren
id|msnd_init
)paren
suffix:semicolon
DECL|variable|msdn_cleanup
id|module_exit
c_func
(paren
id|msdn_cleanup
)paren
suffix:semicolon
eof
