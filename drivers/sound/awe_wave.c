multiline_comment|/*&n; * sound/awe_wave.c&n; *&n; * The low level driver for the AWE32/SB32/AWE64 wave table synth.&n; *   version 0.4.4; Jan. 4, 2000&n; *&n; * Copyright (C) 1996-2000 Takashi Iwai&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/awe_voice.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
macro_line|#include &lt;linux/isapnp.h&gt;
macro_line|#endif
macro_line|#include &quot;sound_config.h&quot;
macro_line|#include &quot;awe_wave.h&quot;
macro_line|#include &quot;awe_hw.h&quot;
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
macro_line|#include &quot;tuning.h&quot;
macro_line|#include &lt;linux/ultrasound.h&gt;
macro_line|#endif
multiline_comment|/*&n; * debug message&n; */
macro_line|#ifdef AWE_DEBUG_ON
DECL|macro|DEBUG
mdefine_line|#define DEBUG(LVL,XXX)&t;{if (ctrls[AWE_MD_DEBUG_MODE] &gt; LVL) { XXX; }}
DECL|macro|ERRMSG
mdefine_line|#define ERRMSG(XXX)&t;{if (ctrls[AWE_MD_DEBUG_MODE]) { XXX; }}
DECL|macro|FATALERR
mdefine_line|#define FATALERR(XXX)&t;XXX
macro_line|#else
DECL|macro|DEBUG
mdefine_line|#define DEBUG(LVL,XXX) /**/
DECL|macro|ERRMSG
mdefine_line|#define ERRMSG(XXX)&t;XXX
DECL|macro|FATALERR
mdefine_line|#define FATALERR(XXX)&t;XXX
macro_line|#endif
multiline_comment|/*&n; * bank and voice record&n; */
DECL|typedef|sf_list
r_typedef
r_struct
id|_sf_list
id|sf_list
suffix:semicolon
DECL|typedef|awe_voice_list
r_typedef
r_struct
id|_awe_voice_list
id|awe_voice_list
suffix:semicolon
DECL|typedef|awe_sample_list
r_typedef
r_struct
id|_awe_sample_list
id|awe_sample_list
suffix:semicolon
multiline_comment|/* soundfont record */
DECL|struct|_sf_list
r_struct
id|_sf_list
(brace
DECL|member|sf_id
r_int
r_int
id|sf_id
suffix:semicolon
multiline_comment|/* id number */
DECL|member|type
r_int
r_int
id|type
suffix:semicolon
multiline_comment|/* lock &amp; shared flags */
DECL|member|num_info
r_int
id|num_info
suffix:semicolon
multiline_comment|/* current info table index */
DECL|member|num_sample
r_int
id|num_sample
suffix:semicolon
multiline_comment|/* current sample table index */
DECL|member|mem_ptr
r_int
id|mem_ptr
suffix:semicolon
multiline_comment|/* current word byte pointer */
DECL|member|infos
DECL|member|last_infos
id|awe_voice_list
op_star
id|infos
comma
op_star
id|last_infos
suffix:semicolon
multiline_comment|/* instruments */
DECL|member|samples
DECL|member|last_samples
id|awe_sample_list
op_star
id|samples
comma
op_star
id|last_samples
suffix:semicolon
multiline_comment|/* samples */
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
DECL|member|shared
id|sf_list
op_star
id|shared
suffix:semicolon
multiline_comment|/* shared list */
DECL|member|name
r_int
r_char
id|name
(braket
id|AWE_PATCH_NAME_LEN
)braket
suffix:semicolon
multiline_comment|/* sharing id */
macro_line|#endif
DECL|member|next
DECL|member|prev
id|sf_list
op_star
id|next
comma
op_star
id|prev
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* instrument list */
DECL|struct|_awe_voice_list
r_struct
id|_awe_voice_list
(brace
DECL|member|v
id|awe_voice_info
id|v
suffix:semicolon
multiline_comment|/* instrument information */
DECL|member|holder
id|sf_list
op_star
id|holder
suffix:semicolon
multiline_comment|/* parent sf_list of this record */
DECL|member|bank
DECL|member|instr
r_int
r_char
id|bank
comma
id|instr
suffix:semicolon
multiline_comment|/* preset number information */
DECL|member|type
DECL|member|disabled
r_char
id|type
comma
id|disabled
suffix:semicolon
multiline_comment|/* type=normal/mapped, disabled=boolean */
DECL|member|next
id|awe_voice_list
op_star
id|next
suffix:semicolon
multiline_comment|/* linked list with same sf_id */
DECL|member|next_instr
id|awe_voice_list
op_star
id|next_instr
suffix:semicolon
multiline_comment|/* instrument list */
DECL|member|next_bank
id|awe_voice_list
op_star
id|next_bank
suffix:semicolon
multiline_comment|/* hash table list */
)brace
suffix:semicolon
multiline_comment|/* voice list type */
DECL|macro|V_ST_NORMAL
mdefine_line|#define V_ST_NORMAL&t;0
DECL|macro|V_ST_MAPPED
mdefine_line|#define V_ST_MAPPED&t;1
multiline_comment|/* sample list */
DECL|struct|_awe_sample_list
r_struct
id|_awe_sample_list
(brace
DECL|member|v
id|awe_sample_info
id|v
suffix:semicolon
multiline_comment|/* sample information */
DECL|member|holder
id|sf_list
op_star
id|holder
suffix:semicolon
multiline_comment|/* parent sf_list of this record */
DECL|member|next
id|awe_sample_list
op_star
id|next
suffix:semicolon
multiline_comment|/* linked list with same sf_id */
)brace
suffix:semicolon
multiline_comment|/* sample and information table */
DECL|variable|current_sf_id
r_static
r_int
id|current_sf_id
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* current number of fonts */
DECL|variable|locked_sf_id
r_static
r_int
id|locked_sf_id
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* locked position */
DECL|variable|sfhead
DECL|variable|sftail
r_static
id|sf_list
op_star
id|sfhead
op_assign
l_int|NULL
comma
op_star
id|sftail
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* linked-lists */
DECL|macro|awe_free_mem_ptr
mdefine_line|#define awe_free_mem_ptr() (sftail ? sftail-&gt;mem_ptr : 0)
DECL|macro|awe_free_info
mdefine_line|#define awe_free_info() (sftail ? sftail-&gt;num_info : 0)
DECL|macro|awe_free_sample
mdefine_line|#define awe_free_sample() (sftail ? sftail-&gt;num_sample : 0)
DECL|macro|AWE_MAX_PRESETS
mdefine_line|#define AWE_MAX_PRESETS&t;&t;256
DECL|macro|AWE_DEFAULT_PRESET
mdefine_line|#define AWE_DEFAULT_PRESET&t;0
DECL|macro|AWE_DEFAULT_BANK
mdefine_line|#define AWE_DEFAULT_BANK&t;0
DECL|macro|AWE_DEFAULT_DRUM
mdefine_line|#define AWE_DEFAULT_DRUM&t;0
DECL|macro|AWE_DRUM_BANK
mdefine_line|#define AWE_DRUM_BANK&t;&t;128
DECL|macro|MAX_LAYERS
mdefine_line|#define MAX_LAYERS&t;AWE_MAX_VOICES
multiline_comment|/* preset table index */
DECL|variable|preset_table
r_static
id|awe_voice_list
op_star
id|preset_table
(braket
id|AWE_MAX_PRESETS
)braket
suffix:semicolon
multiline_comment|/*&n; * voice table&n; */
multiline_comment|/* effects table */
DECL|struct|FX_Rec
r_typedef
r_struct
id|FX_Rec
(brace
multiline_comment|/* channel effects */
DECL|member|flags
r_int
r_char
id|flags
(braket
id|AWE_FX_END
)braket
suffix:semicolon
DECL|member|val
r_int
id|val
(braket
id|AWE_FX_END
)braket
suffix:semicolon
DECL|typedef|FX_Rec
)brace
id|FX_Rec
suffix:semicolon
multiline_comment|/* channel parameters */
DECL|struct|_awe_chan_info
r_typedef
r_struct
id|_awe_chan_info
(brace
DECL|member|channel
r_int
id|channel
suffix:semicolon
multiline_comment|/* channel number */
DECL|member|bank
r_int
id|bank
suffix:semicolon
multiline_comment|/* current tone bank */
DECL|member|instr
r_int
id|instr
suffix:semicolon
multiline_comment|/* current program */
DECL|member|bender
r_int
id|bender
suffix:semicolon
multiline_comment|/* midi pitchbend (-8192 - 8192) */
DECL|member|bender_range
r_int
id|bender_range
suffix:semicolon
multiline_comment|/* midi bender range (x100) */
DECL|member|panning
r_int
id|panning
suffix:semicolon
multiline_comment|/* panning (0-127) */
DECL|member|main_vol
r_int
id|main_vol
suffix:semicolon
multiline_comment|/* channel volume (0-127) */
DECL|member|expression_vol
r_int
id|expression_vol
suffix:semicolon
multiline_comment|/* midi expression (0-127) */
DECL|member|chan_press
r_int
id|chan_press
suffix:semicolon
multiline_comment|/* channel pressure */
DECL|member|sustained
r_int
id|sustained
suffix:semicolon
multiline_comment|/* sustain status in MIDI */
DECL|member|fx
id|FX_Rec
id|fx
suffix:semicolon
multiline_comment|/* effects */
DECL|member|fx_layer
id|FX_Rec
id|fx_layer
(braket
id|MAX_LAYERS
)braket
suffix:semicolon
multiline_comment|/* layer effects */
DECL|typedef|awe_chan_info
)brace
id|awe_chan_info
suffix:semicolon
multiline_comment|/* voice parameters */
DECL|struct|_voice_info
r_typedef
r_struct
id|_voice_info
(brace
DECL|member|state
r_int
id|state
suffix:semicolon
DECL|macro|AWE_ST_OFF
mdefine_line|#define AWE_ST_OFF&t;&t;(1&lt;&lt;0)&t;/* no sound */
DECL|macro|AWE_ST_ON
mdefine_line|#define AWE_ST_ON&t;&t;(1&lt;&lt;1)&t;/* playing */
DECL|macro|AWE_ST_STANDBY
mdefine_line|#define AWE_ST_STANDBY&t;&t;(1&lt;&lt;2)&t;/* stand by for playing */
DECL|macro|AWE_ST_SUSTAINED
mdefine_line|#define AWE_ST_SUSTAINED&t;(1&lt;&lt;3)&t;/* sustained */
DECL|macro|AWE_ST_MARK
mdefine_line|#define AWE_ST_MARK&t;&t;(1&lt;&lt;4)&t;/* marked for allocation */
DECL|macro|AWE_ST_DRAM
mdefine_line|#define AWE_ST_DRAM&t;&t;(1&lt;&lt;5)&t;/* DRAM read/write */
DECL|macro|AWE_ST_FM
mdefine_line|#define AWE_ST_FM&t;&t;(1&lt;&lt;6)&t;/* reserved for FM */
DECL|macro|AWE_ST_RELEASED
mdefine_line|#define AWE_ST_RELEASED&t;&t;(1&lt;&lt;7)&t;/* released */
DECL|member|ch
r_int
id|ch
suffix:semicolon
multiline_comment|/* midi channel */
DECL|member|key
r_int
id|key
suffix:semicolon
multiline_comment|/* internal key for search */
DECL|member|layer
r_int
id|layer
suffix:semicolon
multiline_comment|/* layer number (for channel mode only) */
DECL|member|time
r_int
id|time
suffix:semicolon
multiline_comment|/* allocated time */
DECL|member|cinfo
id|awe_chan_info
op_star
id|cinfo
suffix:semicolon
multiline_comment|/* channel info */
DECL|member|note
r_int
id|note
suffix:semicolon
multiline_comment|/* midi key (0-127) */
DECL|member|velocity
r_int
id|velocity
suffix:semicolon
multiline_comment|/* midi velocity (0-127) */
DECL|member|sostenuto
r_int
id|sostenuto
suffix:semicolon
multiline_comment|/* sostenuto on/off */
DECL|member|sample
id|awe_voice_info
op_star
id|sample
suffix:semicolon
multiline_comment|/* assigned voice */
multiline_comment|/* EMU8000 parameters */
DECL|member|apitch
r_int
id|apitch
suffix:semicolon
multiline_comment|/* pitch parameter */
DECL|member|avol
r_int
id|avol
suffix:semicolon
multiline_comment|/* volume parameter */
DECL|member|apan
r_int
id|apan
suffix:semicolon
multiline_comment|/* panning parameter */
DECL|member|acutoff
r_int
id|acutoff
suffix:semicolon
multiline_comment|/* cutoff parameter */
DECL|member|aaux
r_int
id|aaux
suffix:semicolon
multiline_comment|/* aux word */
DECL|typedef|voice_info
)brace
id|voice_info
suffix:semicolon
multiline_comment|/* voice information */
DECL|variable|voices
r_static
id|voice_info
id|voices
(braket
id|AWE_MAX_VOICES
)braket
suffix:semicolon
DECL|macro|IS_NO_SOUND
mdefine_line|#define IS_NO_SOUND(v)&t;(voices[v].state &amp; (AWE_ST_OFF|AWE_ST_RELEASED|AWE_ST_STANDBY|AWE_ST_SUSTAINED))
DECL|macro|IS_NO_EFFECT
mdefine_line|#define IS_NO_EFFECT(v)&t;(voices[v].state != AWE_ST_ON)
DECL|macro|IS_PLAYING
mdefine_line|#define IS_PLAYING(v)&t;(voices[v].state &amp; (AWE_ST_ON|AWE_ST_SUSTAINED|AWE_ST_RELEASED))
DECL|macro|IS_EMPTY
mdefine_line|#define IS_EMPTY(v)&t;(voices[v].state &amp; (AWE_ST_OFF|AWE_ST_MARK|AWE_ST_DRAM|AWE_ST_FM))
multiline_comment|/* MIDI channel effects information (for hw control) */
DECL|variable|channels
r_static
id|awe_chan_info
id|channels
(braket
id|AWE_MAX_CHANNELS
)braket
suffix:semicolon
multiline_comment|/*&n; * global variables&n; */
macro_line|#ifndef AWE_DEFAULT_BASE_ADDR
DECL|macro|AWE_DEFAULT_BASE_ADDR
mdefine_line|#define AWE_DEFAULT_BASE_ADDR&t;0&t;/* autodetect */
macro_line|#endif
macro_line|#ifndef AWE_DEFAULT_MEM_SIZE
DECL|macro|AWE_DEFAULT_MEM_SIZE
mdefine_line|#define AWE_DEFAULT_MEM_SIZE&t;-1&t;/* autodetect */
macro_line|#endif
DECL|variable|io
r_int
id|io
op_assign
id|AWE_DEFAULT_BASE_ADDR
suffix:semicolon
multiline_comment|/* Emu8000 base address */
DECL|variable|memsize
r_int
id|memsize
op_assign
id|AWE_DEFAULT_MEM_SIZE
suffix:semicolon
multiline_comment|/* memory size in Kbytes */
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
DECL|variable|isapnp
r_static
r_int
id|isapnp
op_assign
l_int|1
suffix:semicolon
macro_line|#else
DECL|variable|isapnp
r_static
r_int
id|isapnp
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Takashi Iwai &lt;iwai@ww.uni-erlangen.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SB AWE32/64 WaveTable driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|io
comma
l_string|&quot;base i/o port of Emu8000&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|memsize
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|memsize
comma
l_string|&quot;onboard DRAM size in Kbytes&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|isapnp
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp
comma
l_string|&quot;use ISAPnP detection&quot;
)paren
suffix:semicolon
id|EXPORT_NO_SYMBOLS
suffix:semicolon
multiline_comment|/* DRAM start offset */
DECL|variable|awe_mem_start
r_static
r_int
id|awe_mem_start
op_assign
id|AWE_DRAM_OFFSET
suffix:semicolon
multiline_comment|/* maximum channels for playing */
DECL|variable|awe_max_voices
r_static
r_int
id|awe_max_voices
op_assign
id|AWE_MAX_VOICES
suffix:semicolon
DECL|variable|patch_opened
r_static
r_int
id|patch_opened
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* sample already loaded? */
DECL|variable|atten_relative
r_static
r_char
id|atten_relative
op_assign
id|FALSE
suffix:semicolon
DECL|variable|atten_offset
r_static
r_int
id|atten_offset
op_assign
l_int|0
suffix:semicolon
DECL|variable|awe_present
r_static
r_int
id|awe_present
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* awe device present? */
DECL|variable|awe_busy
r_static
r_int
id|awe_busy
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* awe device opened? */
DECL|variable|my_dev
r_static
r_int
id|my_dev
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|macro|DEFAULT_DRUM_FLAGS
mdefine_line|#define DEFAULT_DRUM_FLAGS&t;((1 &lt;&lt; 9) | (1 &lt;&lt; 25))
DECL|macro|IS_DRUM_CHANNEL
mdefine_line|#define IS_DRUM_CHANNEL(c)&t;(drum_flags &amp; (1 &lt;&lt; (c)))
DECL|macro|DRUM_CHANNEL_ON
mdefine_line|#define DRUM_CHANNEL_ON(c)&t;(drum_flags |= (1 &lt;&lt; (c)))
DECL|macro|DRUM_CHANNEL_OFF
mdefine_line|#define DRUM_CHANNEL_OFF(c)&t;(drum_flags &amp;= ~(1 &lt;&lt; (c)))
DECL|variable|drum_flags
r_static
r_int
r_int
id|drum_flags
op_assign
id|DEFAULT_DRUM_FLAGS
suffix:semicolon
multiline_comment|/* channel flags */
DECL|variable|playing_mode
r_static
r_int
id|playing_mode
op_assign
id|AWE_PLAY_INDIRECT
suffix:semicolon
DECL|macro|SINGLE_LAYER_MODE
mdefine_line|#define SINGLE_LAYER_MODE()&t;(playing_mode == AWE_PLAY_INDIRECT || playing_mode == AWE_PLAY_DIRECT)
DECL|macro|MULTI_LAYER_MODE
mdefine_line|#define MULTI_LAYER_MODE()&t;(playing_mode == AWE_PLAY_MULTI || playing_mode == AWE_PLAY_MULTI2)
DECL|variable|current_alloc_time
r_static
r_int
id|current_alloc_time
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* voice allocation index for channel mode */
DECL|variable|awe_info
r_static
r_struct
id|synth_info
id|awe_info
op_assign
(brace
l_string|&quot;AWE32 Synth&quot;
comma
multiline_comment|/* name */
l_int|0
comma
multiline_comment|/* device */
id|SYNTH_TYPE_SAMPLE
comma
multiline_comment|/* synth_type */
id|SAMPLE_TYPE_AWE32
comma
multiline_comment|/* synth_subtype */
l_int|0
comma
multiline_comment|/* perc_mode (obsolete) */
id|AWE_MAX_VOICES
comma
multiline_comment|/* nr_voices */
l_int|0
comma
multiline_comment|/* nr_drums (obsolete) */
l_int|400
multiline_comment|/* instr_bank_size */
)brace
suffix:semicolon
DECL|variable|voice_alloc
r_static
r_struct
id|voice_alloc_info
op_star
id|voice_alloc
suffix:semicolon
multiline_comment|/* set at initialization */
multiline_comment|/*&n; * function prototypes&n; */
r_static
r_int
id|awe_check_port
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_request_region
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_release_region
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_reset_samples
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* emu8000 chip i/o access */
r_static
r_void
id|setup_ports
c_func
(paren
r_int
id|p1
comma
r_int
id|p2
comma
r_int
id|p3
)paren
suffix:semicolon
r_static
r_void
id|awe_poke
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
comma
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|awe_poke_dw
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
comma
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_int
r_int
id|awe_peek
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
)paren
suffix:semicolon
r_static
r_int
r_int
id|awe_peek_dw
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
)paren
suffix:semicolon
r_static
r_void
id|awe_wait
c_func
(paren
r_int
r_int
id|delay
)paren
suffix:semicolon
multiline_comment|/* initialize emu8000 chip */
r_static
r_int
id|_attach_awe
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|_unload_awe
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_initialize
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* set voice parameters */
r_static
r_void
id|awe_init_ctrl_parms
c_func
(paren
r_int
id|init_all
)paren
suffix:semicolon
r_static
r_void
id|awe_init_voice_info
c_func
(paren
id|awe_voice_info
op_star
id|vp
)paren
suffix:semicolon
r_static
r_void
id|awe_init_voice_parm
c_func
(paren
id|awe_voice_parm
op_star
id|pp
)paren
suffix:semicolon
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
r_static
r_int
id|freq_to_note
c_func
(paren
r_int
id|freq
)paren
suffix:semicolon
r_static
r_int
id|calc_rate_offset
c_func
(paren
r_int
id|Hz
)paren
suffix:semicolon
multiline_comment|/*static int calc_parm_delay(int msec);*/
r_static
r_int
id|calc_parm_hold
c_func
(paren
r_int
id|msec
)paren
suffix:semicolon
r_static
r_int
id|calc_parm_attack
c_func
(paren
r_int
id|msec
)paren
suffix:semicolon
r_static
r_int
id|calc_parm_decay
c_func
(paren
r_int
id|msec
)paren
suffix:semicolon
r_static
r_int
id|calc_parm_search
c_func
(paren
r_int
id|msec
comma
r_int
op_star
id|table
)paren
suffix:semicolon
macro_line|#endif /* gus compat */
multiline_comment|/* turn on/off note */
r_static
r_void
id|awe_note_on
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_note_off
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_terminate
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_exclusive_off
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_note_off_all
c_func
(paren
r_int
id|do_sustain
)paren
suffix:semicolon
multiline_comment|/* calculate voice parameters */
DECL|typedef|fx_affect_func
r_typedef
r_void
(paren
op_star
id|fx_affect_func
)paren
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_set_pitch
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_set_voice_pitch
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_set_volume
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_set_voice_vol
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_set_pan
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_fx_fmmod
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_fx_tremfrq
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_fx_fm2frq2
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_fx_filterQ
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_calc_pitch
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
r_static
r_void
id|awe_calc_pitch_from_freq
c_func
(paren
r_int
id|voice
comma
r_int
id|freq
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|awe_calc_volume
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_update_volume
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_change_master_volume
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_void
id|awe_voice_init
c_func
(paren
r_int
id|voice
comma
r_int
id|init_all
)paren
suffix:semicolon
r_static
r_void
id|awe_channel_init
c_func
(paren
r_int
id|ch
comma
r_int
id|init_all
)paren
suffix:semicolon
r_static
r_void
id|awe_fx_init
c_func
(paren
r_int
id|ch
)paren
suffix:semicolon
r_static
r_void
id|awe_send_effect
c_func
(paren
r_int
id|voice
comma
r_int
id|layer
comma
r_int
id|type
comma
r_int
id|val
)paren
suffix:semicolon
r_static
r_void
id|awe_modwheel_change
c_func
(paren
r_int
id|voice
comma
r_int
id|value
)paren
suffix:semicolon
multiline_comment|/* sequencer interface */
r_static
r_int
id|awe_open
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
suffix:semicolon
r_static
r_void
id|awe_close
c_func
(paren
r_int
id|dev
)paren
suffix:semicolon
r_static
r_int
id|awe_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
suffix:semicolon
r_static
r_int
id|awe_kill_note
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|note
comma
r_int
id|velocity
)paren
suffix:semicolon
r_static
r_int
id|awe_start_note
c_func
(paren
r_int
id|dev
comma
r_int
id|v
comma
r_int
id|note_num
comma
r_int
id|volume
)paren
suffix:semicolon
r_static
r_int
id|awe_set_instr
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|instr_no
)paren
suffix:semicolon
r_static
r_int
id|awe_set_instr_2
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|instr_no
)paren
suffix:semicolon
r_static
r_void
id|awe_reset
c_func
(paren
r_int
id|dev
)paren
suffix:semicolon
r_static
r_void
id|awe_hw_control
c_func
(paren
r_int
id|dev
comma
r_int
r_char
op_star
id|event
)paren
suffix:semicolon
r_static
r_int
id|awe_load_patch
c_func
(paren
r_int
id|dev
comma
r_int
id|format
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|offs
comma
r_int
id|count
comma
r_int
id|pmgr_flag
)paren
suffix:semicolon
r_static
r_void
id|awe_aftertouch
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|pressure
)paren
suffix:semicolon
r_static
r_void
id|awe_controller
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|ctrl_num
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|awe_panning
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|awe_volume_method
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
suffix:semicolon
r_static
r_void
id|awe_bender
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_int
id|awe_alloc
c_func
(paren
r_int
id|dev
comma
r_int
id|chn
comma
r_int
id|note
comma
r_struct
id|voice_alloc_info
op_star
id|alloc
)paren
suffix:semicolon
r_static
r_void
id|awe_setup_voice
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|chn
)paren
suffix:semicolon
DECL|macro|awe_key_pressure
mdefine_line|#define awe_key_pressure(dev,voice,key,press) awe_start_note(dev,voice,(key)+128,press)
multiline_comment|/* hardware controls */
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
r_static
r_void
id|awe_hw_gus_control
c_func
(paren
r_int
id|dev
comma
r_int
id|cmd
comma
r_int
r_char
op_star
id|event
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|awe_hw_awe_control
c_func
(paren
r_int
id|dev
comma
r_int
id|cmd
comma
r_int
r_char
op_star
id|event
)paren
suffix:semicolon
r_static
r_void
id|awe_voice_change
c_func
(paren
r_int
id|voice
comma
id|fx_affect_func
id|func
)paren
suffix:semicolon
r_static
r_void
id|awe_sostenuto_on
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_sustain_off
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_terminate_and_init
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
multiline_comment|/* voice search */
r_static
r_int
id|awe_search_key
c_func
(paren
r_int
id|bank
comma
r_int
id|preset
comma
r_int
id|note
)paren
suffix:semicolon
r_static
id|awe_voice_list
op_star
id|awe_search_instr
c_func
(paren
r_int
id|bank
comma
r_int
id|preset
comma
r_int
id|note
)paren
suffix:semicolon
r_static
r_int
id|awe_search_multi_voices
c_func
(paren
id|awe_voice_list
op_star
id|rec
comma
r_int
id|note
comma
r_int
id|velocity
comma
id|awe_voice_info
op_star
op_star
id|vlist
)paren
suffix:semicolon
r_static
r_void
id|awe_alloc_multi_voices
c_func
(paren
r_int
id|ch
comma
r_int
id|note
comma
r_int
id|velocity
comma
r_int
id|key
)paren
suffix:semicolon
r_static
r_void
id|awe_alloc_one_voice
c_func
(paren
r_int
id|voice
comma
r_int
id|note
comma
r_int
id|velocity
)paren
suffix:semicolon
r_static
r_int
id|awe_clear_voice
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* load / remove patches */
r_static
r_int
id|awe_open_patch
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|awe_close_patch
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|awe_unload_patch
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|awe_load_info
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|awe_remove_info
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|awe_load_data
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|awe_replace_data
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|awe_load_map
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
r_static
r_int
id|awe_load_guspatch
c_func
(paren
r_const
r_char
op_star
id|addr
comma
r_int
id|offs
comma
r_int
id|size
comma
r_int
id|pmgr_flag
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*static int awe_probe_info(awe_patch_info *patch, const char *addr, int count);*/
r_static
r_int
id|awe_probe_data
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|sf_list
op_star
id|check_patch_opened
c_func
(paren
r_int
id|type
comma
r_char
op_star
id|name
)paren
suffix:semicolon
r_static
r_int
id|awe_write_wave_data
c_func
(paren
r_const
r_char
op_star
id|addr
comma
r_int
id|offset
comma
id|awe_sample_list
op_star
id|sp
comma
r_int
id|channels
)paren
suffix:semicolon
r_static
r_int
id|awe_create_sf
c_func
(paren
r_int
id|type
comma
r_char
op_star
id|name
)paren
suffix:semicolon
r_static
r_void
id|awe_free_sf
c_func
(paren
id|sf_list
op_star
id|sf
)paren
suffix:semicolon
r_static
r_void
id|add_sf_info
c_func
(paren
id|sf_list
op_star
id|sf
comma
id|awe_voice_list
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|add_sf_sample
c_func
(paren
id|sf_list
op_star
id|sf
comma
id|awe_sample_list
op_star
id|smp
)paren
suffix:semicolon
r_static
r_void
id|purge_old_list
c_func
(paren
id|awe_voice_list
op_star
id|rec
comma
id|awe_voice_list
op_star
id|next
)paren
suffix:semicolon
r_static
r_void
id|add_info_list
c_func
(paren
id|awe_voice_list
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|awe_remove_samples
c_func
(paren
r_int
id|sf_id
)paren
suffix:semicolon
r_static
r_void
id|rebuild_preset_list
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|awe_set_sample
c_func
(paren
id|awe_voice_list
op_star
id|rec
)paren
suffix:semicolon
r_static
id|awe_sample_list
op_star
id|search_sample_index
c_func
(paren
id|sf_list
op_star
id|sf
comma
r_int
id|sample
)paren
suffix:semicolon
r_static
r_int
id|is_identical_holder
c_func
(paren
id|sf_list
op_star
id|sf1
comma
id|sf_list
op_star
id|sf2
)paren
suffix:semicolon
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
r_static
r_int
id|is_identical_name
c_func
(paren
r_int
r_char
op_star
id|name
comma
id|sf_list
op_star
id|p
)paren
suffix:semicolon
r_static
r_int
id|is_shared_sf
c_func
(paren
r_int
r_char
op_star
id|name
)paren
suffix:semicolon
r_static
r_int
id|info_duplicated
c_func
(paren
id|sf_list
op_star
id|sf
comma
id|awe_voice_list
op_star
id|rec
)paren
suffix:semicolon
macro_line|#endif /* allow sharing */
multiline_comment|/* lowlevel functions */
r_static
r_void
id|awe_init_audio
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_init_dma
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_init_array
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_send_array
c_func
(paren
r_int
r_int
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|awe_tweak_voice
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_tweak
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_init_fm
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|awe_open_dram_for_write
c_func
(paren
r_int
id|offset
comma
r_int
id|channels
)paren
suffix:semicolon
r_static
r_void
id|awe_open_dram_for_check
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_close_dram
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*static void awe_write_dram(unsigned short c);*/
r_static
r_int
id|awe_detect_base
c_func
(paren
r_int
id|addr
)paren
suffix:semicolon
r_static
r_int
id|awe_detect
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_check_dram
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|awe_load_chorus_fx
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_void
id|awe_set_chorus_mode
c_func
(paren
r_int
id|mode
)paren
suffix:semicolon
r_static
r_void
id|awe_update_chorus_mode
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|awe_load_reverb_fx
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_void
id|awe_set_reverb_mode
c_func
(paren
r_int
id|mode
)paren
suffix:semicolon
r_static
r_void
id|awe_update_reverb_mode
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_equalizer
c_func
(paren
r_int
id|bass
comma
r_int
id|treble
)paren
suffix:semicolon
r_static
r_void
id|awe_update_equalizer
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_AWE32_MIXER
r_static
r_void
id|attach_mixer
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|unload_mixer
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_AWE32_MIDIEMU
r_static
r_void
id|attach_midiemu
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|unload_midiemu
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
DECL|macro|limitvalue
mdefine_line|#define limitvalue(x, a, b) if ((x) &lt; (a)) (x) = (a); else if ((x) &gt; (b)) (x) = (b)
multiline_comment|/*&n; * control parameters&n; */
macro_line|#ifdef AWE_USE_NEW_VOLUME_CALC
DECL|macro|DEF_VOLUME_CALC
mdefine_line|#define DEF_VOLUME_CALC&t;TRUE
macro_line|#else
DECL|macro|DEF_VOLUME_CALC
mdefine_line|#define DEF_VOLUME_CALC&t;FALSE
macro_line|#endif /* new volume */
DECL|macro|DEF_ZERO_ATTEN
mdefine_line|#define DEF_ZERO_ATTEN&t;&t;32&t;/* 12dB below */
DECL|macro|DEF_MOD_SENSE
mdefine_line|#define DEF_MOD_SENSE&t;&t;18
DECL|macro|DEF_CHORUS_MODE
mdefine_line|#define DEF_CHORUS_MODE&t;&t;2
DECL|macro|DEF_REVERB_MODE
mdefine_line|#define DEF_REVERB_MODE&t;&t;4
DECL|macro|DEF_BASS_LEVEL
mdefine_line|#define DEF_BASS_LEVEL&t;&t;5
DECL|macro|DEF_TREBLE_LEVEL
mdefine_line|#define DEF_TREBLE_LEVEL&t;9
DECL|struct|CtrlParmsDef
r_static
r_struct
id|CtrlParmsDef
(brace
DECL|member|value
r_int
id|value
suffix:semicolon
DECL|member|init_each_time
r_int
id|init_each_time
suffix:semicolon
DECL|member|update
r_void
(paren
op_star
id|update
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|ctrl_parms
)brace
id|ctrl_parms
(braket
id|AWE_MD_END
)braket
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|NULL
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|NULL
)brace
comma
multiline_comment|/* &lt;-- not used */
(brace
id|AWE_VERSION_NUMBER
comma
id|FALSE
comma
l_int|NULL
)brace
comma
(brace
id|TRUE
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* exclusive */
(brace
id|TRUE
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* realpan */
(brace
id|AWE_DEFAULT_BANK
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* gusbank */
(brace
id|FALSE
comma
id|TRUE
comma
l_int|NULL
)brace
comma
multiline_comment|/* keep effect */
(brace
id|DEF_ZERO_ATTEN
comma
id|FALSE
comma
id|awe_update_volume
)brace
comma
multiline_comment|/* zero_atten */
(brace
id|FALSE
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* chn_prior */
(brace
id|DEF_MOD_SENSE
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* modwheel sense */
(brace
id|AWE_DEFAULT_PRESET
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* def_preset */
(brace
id|AWE_DEFAULT_BANK
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* def_bank */
(brace
id|AWE_DEFAULT_DRUM
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* def_drum */
(brace
id|FALSE
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* toggle_drum_bank */
(brace
id|DEF_VOLUME_CALC
comma
id|FALSE
comma
id|awe_update_volume
)brace
comma
multiline_comment|/* new_volume_calc */
(brace
id|DEF_CHORUS_MODE
comma
id|FALSE
comma
id|awe_update_chorus_mode
)brace
comma
multiline_comment|/* chorus mode */
(brace
id|DEF_REVERB_MODE
comma
id|FALSE
comma
id|awe_update_reverb_mode
)brace
comma
multiline_comment|/* reverb mode */
(brace
id|DEF_BASS_LEVEL
comma
id|FALSE
comma
id|awe_update_equalizer
)brace
comma
multiline_comment|/* bass level */
(brace
id|DEF_TREBLE_LEVEL
comma
id|FALSE
comma
id|awe_update_equalizer
)brace
comma
multiline_comment|/* treble level */
(brace
l_int|0
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* debug mode */
(brace
id|FALSE
comma
id|FALSE
comma
l_int|NULL
)brace
comma
multiline_comment|/* pan exchange */
)brace
suffix:semicolon
DECL|variable|ctrls
r_static
r_int
id|ctrls
(braket
id|AWE_MD_END
)braket
suffix:semicolon
multiline_comment|/*&n; * synth operation table&n; */
DECL|variable|awe_operations
r_static
r_struct
id|synth_operations
id|awe_operations
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|id
suffix:colon
l_string|&quot;EMU8K&quot;
comma
id|info
suffix:colon
op_amp
id|awe_info
comma
id|midi_dev
suffix:colon
l_int|0
comma
id|synth_type
suffix:colon
id|SYNTH_TYPE_SAMPLE
comma
id|synth_subtype
suffix:colon
id|SAMPLE_TYPE_AWE32
comma
id|open
suffix:colon
id|awe_open
comma
id|close
suffix:colon
id|awe_close
comma
id|ioctl
suffix:colon
id|awe_ioctl
comma
id|kill_note
suffix:colon
id|awe_kill_note
comma
id|start_note
suffix:colon
id|awe_start_note
comma
id|set_instr
suffix:colon
id|awe_set_instr_2
comma
id|reset
suffix:colon
id|awe_reset
comma
id|hw_control
suffix:colon
id|awe_hw_control
comma
id|load_patch
suffix:colon
id|awe_load_patch
comma
id|aftertouch
suffix:colon
id|awe_aftertouch
comma
id|controller
suffix:colon
id|awe_controller
comma
id|panning
suffix:colon
id|awe_panning
comma
id|volume_method
suffix:colon
id|awe_volume_method
comma
id|bender
suffix:colon
id|awe_bender
comma
id|alloc_voice
suffix:colon
id|awe_alloc
comma
id|setup_voice
suffix:colon
id|awe_setup_voice
)brace
suffix:semicolon
multiline_comment|/*&n; * General attach / unload interface&n; */
DECL|function|_attach_awe
r_static
r_int
id|__init
id|_attach_awe
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|awe_present
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* for OSS38.. called twice? */
multiline_comment|/* check presence of AWE32 card */
r_if
c_cond
(paren
op_logical_neg
id|awe_detect
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWE32: not detected&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* check AWE32 ports are available */
r_if
c_cond
(paren
id|awe_check_port
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWE32: I/O area already used.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set buffers to NULL */
id|sfhead
op_assign
id|sftail
op_assign
l_int|NULL
suffix:semicolon
id|my_dev
op_assign
id|sound_alloc_synthdev
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|my_dev
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWE32 Error: too many synthesizers&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|voice_alloc
op_assign
op_amp
id|awe_operations.alloc
suffix:semicolon
id|voice_alloc-&gt;max_voice
op_assign
id|awe_max_voices
suffix:semicolon
id|synth_devs
(braket
id|my_dev
)braket
op_assign
op_amp
id|awe_operations
suffix:semicolon
macro_line|#ifdef CONFIG_AWE32_MIXER
id|attach_mixer
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_AWE32_MIDIEMU
id|attach_midiemu
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* reserve I/O ports for awedrv */
id|awe_request_region
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* clear all samples */
id|awe_reset_samples
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* intialize AWE32 hardware */
id|awe_initialize
c_func
(paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|awe_info.name
comma
l_string|&quot;AWE32-%s (RAM%dk)&quot;
comma
id|AWEDRV_VERSION
comma
id|memsize
op_div
l_int|1024
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;&lt;SoundBlaster EMU8000 (RAM%dk)&gt;&bslash;n&quot;
comma
id|memsize
op_div
l_int|1024
)paren
suffix:semicolon
id|awe_present
op_assign
id|TRUE
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|free_tables
r_static
r_void
id|free_tables
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|sftail
)paren
(brace
id|sf_list
op_star
id|p
comma
op_star
id|prev
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|sftail
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|prev
)paren
(brace
id|prev
op_assign
id|p-&gt;prev
suffix:semicolon
id|awe_free_sf
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
)brace
id|sfhead
op_assign
id|sftail
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|_unload_awe
r_static
r_void
id|__exit
id|_unload_awe
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|awe_present
)paren
(brace
id|awe_reset_samples
c_func
(paren
)paren
suffix:semicolon
id|awe_release_region
c_func
(paren
)paren
suffix:semicolon
id|free_tables
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_AWE32_MIXER
id|unload_mixer
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_AWE32_MIDIEMU
id|unload_midiemu
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|sound_unload_synthdev
c_func
(paren
id|my_dev
)paren
suffix:semicolon
id|awe_present
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * clear sample tables &n; */
r_static
r_void
DECL|function|awe_reset_samples
id|awe_reset_samples
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* free all bank tables */
id|memset
c_func
(paren
id|preset_table
comma
l_int|0
comma
r_sizeof
(paren
id|preset_table
)paren
)paren
suffix:semicolon
id|free_tables
c_func
(paren
)paren
suffix:semicolon
id|current_sf_id
op_assign
l_int|0
suffix:semicolon
id|locked_sf_id
op_assign
l_int|0
suffix:semicolon
id|patch_opened
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * EMU register access&n; */
multiline_comment|/* select a given AWE32 pointer */
DECL|variable|awe_ports
r_static
r_int
id|awe_ports
(braket
l_int|5
)braket
suffix:semicolon
DECL|variable|port_setuped
r_static
r_int
id|port_setuped
op_assign
id|FALSE
suffix:semicolon
DECL|variable|awe_cur_cmd
r_static
r_int
id|awe_cur_cmd
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|macro|awe_set_cmd
mdefine_line|#define awe_set_cmd(cmd) &bslash;&n;if (awe_cur_cmd != cmd) { outw(cmd, awe_ports[Pointer]); awe_cur_cmd = cmd; }
multiline_comment|/* store values to i/o port array */
DECL|function|setup_ports
r_static
r_void
id|setup_ports
c_func
(paren
r_int
id|port1
comma
r_int
id|port2
comma
r_int
id|port3
)paren
(brace
id|awe_ports
(braket
l_int|0
)braket
op_assign
id|port1
suffix:semicolon
r_if
c_cond
(paren
id|port2
op_eq
l_int|0
)paren
id|port2
op_assign
id|port1
op_plus
l_int|0x400
suffix:semicolon
id|awe_ports
(braket
l_int|1
)braket
op_assign
id|port2
suffix:semicolon
id|awe_ports
(braket
l_int|2
)braket
op_assign
id|port2
op_plus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|port3
op_eq
l_int|0
)paren
id|port3
op_assign
id|port1
op_plus
l_int|0x800
suffix:semicolon
id|awe_ports
(braket
l_int|3
)braket
op_assign
id|port3
suffix:semicolon
id|awe_ports
(braket
l_int|4
)braket
op_assign
id|port3
op_plus
l_int|2
suffix:semicolon
id|port_setuped
op_assign
id|TRUE
suffix:semicolon
)brace
multiline_comment|/* write 16bit data */
r_static
r_void
DECL|function|awe_poke
id|awe_poke
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
comma
r_int
r_int
id|data
)paren
(brace
id|awe_set_cmd
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|outw
c_func
(paren
id|data
comma
id|awe_ports
(braket
id|port
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* write 32bit data */
r_static
r_void
DECL|function|awe_poke_dw
id|awe_poke_dw
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
comma
r_int
r_int
id|data
)paren
(brace
r_int
r_int
id|addr
op_assign
id|awe_ports
(braket
id|port
)braket
suffix:semicolon
id|awe_set_cmd
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|outw
c_func
(paren
id|data
comma
id|addr
)paren
suffix:semicolon
multiline_comment|/* write lower 16 bits */
id|outw
c_func
(paren
id|data
op_rshift
l_int|16
comma
id|addr
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* write higher 16 bits */
)brace
multiline_comment|/* read 16bit data */
r_static
r_int
r_int
DECL|function|awe_peek
id|awe_peek
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
)paren
(brace
r_int
r_int
id|k
suffix:semicolon
id|awe_set_cmd
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|k
op_assign
id|inw
c_func
(paren
id|awe_ports
(braket
id|port
)braket
)paren
suffix:semicolon
r_return
id|k
suffix:semicolon
)brace
multiline_comment|/* read 32bit data */
r_static
r_int
r_int
DECL|function|awe_peek_dw
id|awe_peek_dw
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
)paren
(brace
r_int
r_int
id|k1
comma
id|k2
suffix:semicolon
r_int
r_int
id|addr
op_assign
id|awe_ports
(braket
id|port
)braket
suffix:semicolon
id|awe_set_cmd
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|k1
op_assign
id|inw
c_func
(paren
id|addr
)paren
suffix:semicolon
id|k2
op_assign
id|inw
c_func
(paren
id|addr
op_plus
l_int|2
)paren
suffix:semicolon
id|k1
op_or_assign
id|k2
op_lshift
l_int|16
suffix:semicolon
r_return
id|k1
suffix:semicolon
)brace
multiline_comment|/* wait delay number of AWE32 44100Hz clocks */
macro_line|#ifdef WAIT_BY_LOOP /* wait by loop -- that&squot;s not good.. */
r_static
r_void
DECL|function|awe_wait
id|awe_wait
c_func
(paren
r_int
r_int
id|delay
)paren
(brace
r_int
r_int
id|clock
comma
id|target
suffix:semicolon
r_int
r_int
id|port
op_assign
id|awe_ports
(braket
id|AWE_WC_Port
)braket
suffix:semicolon
r_int
id|counter
suffix:semicolon
multiline_comment|/* sample counter */
id|awe_set_cmd
c_func
(paren
id|AWE_WC_Cmd
)paren
suffix:semicolon
id|clock
op_assign
(paren
r_int
r_int
)paren
id|inw
c_func
(paren
id|port
)paren
suffix:semicolon
id|target
op_assign
id|clock
op_plus
id|delay
suffix:semicolon
id|counter
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|target
OL
id|clock
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
(paren
r_int
r_int
)paren
id|inw
c_func
(paren
id|port
)paren
OG
id|target
suffix:semicolon
id|counter
op_increment
)paren
r_if
c_cond
(paren
id|counter
OG
l_int|65536
)paren
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
(paren
r_int
r_int
)paren
id|inw
c_func
(paren
id|port
)paren
OL
id|target
suffix:semicolon
id|counter
op_increment
)paren
r_if
c_cond
(paren
id|counter
OG
l_int|65536
)paren
r_break
suffix:semicolon
)brace
macro_line|#else
DECL|function|awe_wait
r_static
r_void
id|awe_wait
c_func
(paren
r_int
r_int
id|delay
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
id|HZ
op_star
(paren
r_int
r_int
)paren
id|delay
op_plus
l_int|44099
)paren
op_div
l_int|44100
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;static void awe_wait(unsigned short delay)&n;{&n;&t;udelay(((unsigned long)delay * 1000000L + 44099) / 44100);&n;}&n;*/
macro_line|#endif /* wait by loop */
multiline_comment|/* write a word data */
DECL|macro|awe_write_dram
mdefine_line|#define awe_write_dram(c)&t;awe_poke(AWE_SMLD, c)
multiline_comment|/*&n; * port check / request&n; *  0x620-623, 0xA20-A23, 0xE20-E23&n; */
r_static
r_int
id|__init
DECL|function|awe_check_port
id|awe_check_port
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|port_setuped
)paren
r_return
l_int|0
suffix:semicolon
r_return
(paren
id|check_region
c_func
(paren
id|awe_ports
(braket
l_int|0
)braket
comma
l_int|4
)paren
op_logical_or
id|check_region
c_func
(paren
id|awe_ports
(braket
l_int|1
)braket
comma
l_int|4
)paren
op_logical_or
id|check_region
c_func
(paren
id|awe_ports
(braket
l_int|3
)braket
comma
l_int|4
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|awe_request_region
id|awe_request_region
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|port_setuped
)paren
r_return
suffix:semicolon
id|request_region
c_func
(paren
id|awe_ports
(braket
l_int|0
)braket
comma
l_int|4
comma
l_string|&quot;sound driver (AWE32)&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
id|awe_ports
(braket
l_int|1
)braket
comma
l_int|4
comma
l_string|&quot;sound driver (AWE32)&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
id|awe_ports
(braket
l_int|3
)braket
comma
l_int|4
comma
l_string|&quot;sound driver (AWE32)&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|awe_release_region
id|awe_release_region
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|port_setuped
)paren
r_return
suffix:semicolon
id|release_region
c_func
(paren
id|awe_ports
(braket
l_int|0
)braket
comma
l_int|4
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|awe_ports
(braket
l_int|1
)braket
comma
l_int|4
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|awe_ports
(braket
l_int|3
)braket
comma
l_int|4
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * initialization of AWE driver&n; */
r_static
r_void
DECL|function|awe_initialize
id|awe_initialize
c_func
(paren
r_void
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: initializing..&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* initialize hardware configuration */
id|awe_poke
c_func
(paren
id|AWE_HWCF1
comma
l_int|0x0059
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_HWCF2
comma
l_int|0x0020
)paren
suffix:semicolon
multiline_comment|/* disable audio; this seems to reduce a clicking noise a bit.. */
id|awe_poke
c_func
(paren
id|AWE_HWCF3
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* initialize audio channels */
id|awe_init_audio
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* initialize DMA */
id|awe_init_dma
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* initialize init array */
id|awe_init_array
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* check DRAM memory size */
id|awe_check_dram
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* initialize the FM section of the AWE32 */
id|awe_init_fm
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set up voice envelopes */
id|awe_tweak
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* enable audio */
id|awe_poke
c_func
(paren
id|AWE_HWCF3
comma
l_int|0x0004
)paren
suffix:semicolon
multiline_comment|/* set default values */
id|awe_init_ctrl_parms
c_func
(paren
id|TRUE
)paren
suffix:semicolon
multiline_comment|/* set equalizer */
id|awe_update_equalizer
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set reverb &amp; chorus modes */
id|awe_update_reverb_mode
c_func
(paren
)paren
suffix:semicolon
id|awe_update_chorus_mode
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * AWE32 voice parameters&n; */
multiline_comment|/* initialize voice_info record */
r_static
r_void
DECL|function|awe_init_voice_info
id|awe_init_voice_info
c_func
(paren
id|awe_voice_info
op_star
id|vp
)paren
(brace
id|vp-&gt;sample
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;rate_offset
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;start
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;end
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;loopstart
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;loopend
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;mode
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;root
op_assign
l_int|60
suffix:semicolon
id|vp-&gt;tune
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;low
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;high
op_assign
l_int|127
suffix:semicolon
id|vp-&gt;vellow
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;velhigh
op_assign
l_int|127
suffix:semicolon
id|vp-&gt;fixkey
op_assign
op_minus
l_int|1
suffix:semicolon
id|vp-&gt;fixvel
op_assign
op_minus
l_int|1
suffix:semicolon
id|vp-&gt;fixpan
op_assign
op_minus
l_int|1
suffix:semicolon
id|vp-&gt;pan
op_assign
op_minus
l_int|1
suffix:semicolon
id|vp-&gt;exclusiveClass
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;amplitude
op_assign
l_int|127
suffix:semicolon
id|vp-&gt;attenuation
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;scaleTuning
op_assign
l_int|100
suffix:semicolon
id|awe_init_voice_parm
c_func
(paren
op_amp
id|vp-&gt;parm
)paren
suffix:semicolon
)brace
multiline_comment|/* initialize voice_parm record:&n; * Env1/2: delay=0, attack=0, hold=0, sustain=0, decay=0, release=0.&n; * Vibrato and Tremolo effects are zero.&n; * Cutoff is maximum.&n; * Chorus and Reverb effects are zero.&n; */
r_static
r_void
DECL|function|awe_init_voice_parm
id|awe_init_voice_parm
c_func
(paren
id|awe_voice_parm
op_star
id|pp
)paren
(brace
id|pp-&gt;moddelay
op_assign
l_int|0x8000
suffix:semicolon
id|pp-&gt;modatkhld
op_assign
l_int|0x7f7f
suffix:semicolon
id|pp-&gt;moddcysus
op_assign
l_int|0x7f7f
suffix:semicolon
id|pp-&gt;modrelease
op_assign
l_int|0x807f
suffix:semicolon
id|pp-&gt;modkeyhold
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;modkeydecay
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;voldelay
op_assign
l_int|0x8000
suffix:semicolon
id|pp-&gt;volatkhld
op_assign
l_int|0x7f7f
suffix:semicolon
id|pp-&gt;voldcysus
op_assign
l_int|0x7f7f
suffix:semicolon
id|pp-&gt;volrelease
op_assign
l_int|0x807f
suffix:semicolon
id|pp-&gt;volkeyhold
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;volkeydecay
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;lfo1delay
op_assign
l_int|0x8000
suffix:semicolon
id|pp-&gt;lfo2delay
op_assign
l_int|0x8000
suffix:semicolon
id|pp-&gt;pefe
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;fmmod
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;tremfrq
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;fm2frq2
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;cutoff
op_assign
l_int|0xff
suffix:semicolon
id|pp-&gt;filterQ
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;chorus
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;reverb
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
multiline_comment|/* convert frequency mHz to abstract cents (= midi key * 100) */
r_static
r_int
DECL|function|freq_to_note
id|freq_to_note
c_func
(paren
r_int
id|mHz
)paren
(brace
multiline_comment|/* abscents = log(mHz/8176) / log(2) * 1200 */
r_int
r_int
id|max_val
op_assign
(paren
r_int
r_int
)paren
l_int|0xffffffff
op_div
l_int|10000
suffix:semicolon
r_int
id|i
comma
id|times
suffix:semicolon
r_int
r_int
id|base
suffix:semicolon
r_int
r_int
id|freq
suffix:semicolon
r_int
id|note
comma
id|tune
suffix:semicolon
r_if
c_cond
(paren
id|mHz
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mHz
OL
l_int|0
)paren
r_return
l_int|12799
suffix:semicolon
multiline_comment|/* maximum */
id|freq
op_assign
id|mHz
suffix:semicolon
id|note
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|base
op_assign
l_int|8176
op_star
l_int|2
suffix:semicolon
id|freq
op_ge
id|base
suffix:semicolon
id|base
op_mul_assign
l_int|2
)paren
(brace
id|note
op_add_assign
l_int|12
suffix:semicolon
r_if
c_cond
(paren
id|note
op_ge
l_int|128
)paren
multiline_comment|/* over maximum */
r_return
l_int|12799
suffix:semicolon
)brace
id|base
op_div_assign
l_int|2
suffix:semicolon
multiline_comment|/* to avoid overflow... */
id|times
op_assign
l_int|10000
suffix:semicolon
r_while
c_loop
(paren
id|freq
OG
id|max_val
)paren
(brace
id|max_val
op_mul_assign
l_int|10
suffix:semicolon
id|times
op_div_assign
l_int|10
suffix:semicolon
id|base
op_div_assign
l_int|10
suffix:semicolon
)brace
id|freq
op_assign
id|freq
op_star
id|times
op_div
id|base
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|12
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|freq
OL
id|semitone_tuning
(braket
id|i
op_plus
l_int|1
)braket
)paren
r_break
suffix:semicolon
id|note
op_increment
suffix:semicolon
)brace
id|tune
op_assign
l_int|0
suffix:semicolon
id|freq
op_assign
id|freq
op_star
l_int|10000
op_div
id|semitone_tuning
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|freq
OL
id|cent_tuning
(braket
id|i
op_plus
l_int|1
)braket
)paren
r_break
suffix:semicolon
id|tune
op_increment
suffix:semicolon
)brace
r_return
id|note
op_star
l_int|100
op_plus
id|tune
suffix:semicolon
)brace
multiline_comment|/* convert Hz to AWE32 rate offset:&n; * sample pitch offset for the specified sample rate&n; * rate=44100 is no offset, each 4096 is 1 octave (twice).&n; * eg, when rate is 22050, this offset becomes -4096.&n; */
r_static
r_int
DECL|function|calc_rate_offset
id|calc_rate_offset
c_func
(paren
r_int
id|Hz
)paren
(brace
multiline_comment|/* offset = log(Hz / 44100) / log(2) * 4096 */
r_int
id|freq
comma
id|base
comma
id|i
suffix:semicolon
multiline_comment|/* maybe smaller than max (44100Hz) */
r_if
c_cond
(paren
id|Hz
op_le
l_int|0
op_logical_or
id|Hz
op_ge
l_int|44100
)paren
r_return
l_int|0
suffix:semicolon
id|base
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|freq
op_assign
id|Hz
op_star
l_int|2
suffix:semicolon
id|freq
OL
l_int|44100
suffix:semicolon
id|freq
op_mul_assign
l_int|2
)paren
id|base
op_increment
suffix:semicolon
id|base
op_mul_assign
l_int|1200
suffix:semicolon
id|freq
op_assign
l_int|44100
op_star
l_int|10000
op_div
(paren
id|freq
op_div
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|12
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|freq
OL
id|semitone_tuning
(braket
id|i
op_plus
l_int|1
)braket
)paren
r_break
suffix:semicolon
id|base
op_add_assign
l_int|100
suffix:semicolon
)brace
id|freq
op_assign
id|freq
op_star
l_int|10000
op_div
id|semitone_tuning
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|freq
OL
id|cent_tuning
(braket
id|i
op_plus
l_int|1
)braket
)paren
r_break
suffix:semicolon
id|base
op_increment
suffix:semicolon
)brace
r_return
op_minus
id|base
op_star
l_int|4096
op_div
l_int|1200
suffix:semicolon
)brace
multiline_comment|/*&n; * convert envelope time parameter to AWE32 raw parameter&n; */
multiline_comment|/* attack &amp; decay/release time table (msec) */
DECL|variable|attack_time_tbl
r_static
r_int
id|attack_time_tbl
(braket
l_int|128
)braket
op_assign
(brace
l_int|32767
comma
l_int|32767
comma
l_int|5989
comma
l_int|4235
comma
l_int|2994
comma
l_int|2518
comma
l_int|2117
comma
l_int|1780
comma
l_int|1497
comma
l_int|1373
comma
l_int|1259
comma
l_int|1154
comma
l_int|1058
comma
l_int|970
comma
l_int|890
comma
l_int|816
comma
l_int|707
comma
l_int|691
comma
l_int|662
comma
l_int|634
comma
l_int|607
comma
l_int|581
comma
l_int|557
comma
l_int|533
comma
l_int|510
comma
l_int|489
comma
l_int|468
comma
l_int|448
comma
l_int|429
comma
l_int|411
comma
l_int|393
comma
l_int|377
comma
l_int|361
comma
l_int|345
comma
l_int|331
comma
l_int|317
comma
l_int|303
comma
l_int|290
comma
l_int|278
comma
l_int|266
comma
l_int|255
comma
l_int|244
comma
l_int|234
comma
l_int|224
comma
l_int|214
comma
l_int|205
comma
l_int|196
comma
l_int|188
comma
l_int|180
comma
l_int|172
comma
l_int|165
comma
l_int|158
comma
l_int|151
comma
l_int|145
comma
l_int|139
comma
l_int|133
comma
l_int|127
comma
l_int|122
comma
l_int|117
comma
l_int|112
comma
l_int|107
comma
l_int|102
comma
l_int|98
comma
l_int|94
comma
l_int|90
comma
l_int|86
comma
l_int|82
comma
l_int|79
comma
l_int|75
comma
l_int|72
comma
l_int|69
comma
l_int|66
comma
l_int|63
comma
l_int|61
comma
l_int|58
comma
l_int|56
comma
l_int|53
comma
l_int|51
comma
l_int|49
comma
l_int|47
comma
l_int|45
comma
l_int|43
comma
l_int|41
comma
l_int|39
comma
l_int|37
comma
l_int|36
comma
l_int|34
comma
l_int|33
comma
l_int|31
comma
l_int|30
comma
l_int|29
comma
l_int|28
comma
l_int|26
comma
l_int|25
comma
l_int|24
comma
l_int|23
comma
l_int|22
comma
l_int|21
comma
l_int|20
comma
l_int|19
comma
l_int|19
comma
l_int|18
comma
l_int|17
comma
l_int|16
comma
l_int|16
comma
l_int|15
comma
l_int|15
comma
l_int|14
comma
l_int|13
comma
l_int|13
comma
l_int|12
comma
l_int|12
comma
l_int|11
comma
l_int|11
comma
l_int|10
comma
l_int|10
comma
l_int|10
comma
l_int|9
comma
l_int|9
comma
l_int|8
comma
l_int|8
comma
l_int|8
comma
l_int|8
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|6
comma
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|decay_time_tbl
r_static
r_int
id|decay_time_tbl
(braket
l_int|128
)braket
op_assign
(brace
l_int|32767
comma
l_int|32767
comma
l_int|22614
comma
l_int|15990
comma
l_int|11307
comma
l_int|9508
comma
l_int|7995
comma
l_int|6723
comma
l_int|5653
comma
l_int|5184
comma
l_int|4754
comma
l_int|4359
comma
l_int|3997
comma
l_int|3665
comma
l_int|3361
comma
l_int|3082
comma
l_int|2828
comma
l_int|2765
comma
l_int|2648
comma
l_int|2535
comma
l_int|2428
comma
l_int|2325
comma
l_int|2226
comma
l_int|2132
comma
l_int|2042
comma
l_int|1955
comma
l_int|1872
comma
l_int|1793
comma
l_int|1717
comma
l_int|1644
comma
l_int|1574
comma
l_int|1507
comma
l_int|1443
comma
l_int|1382
comma
l_int|1324
comma
l_int|1267
comma
l_int|1214
comma
l_int|1162
comma
l_int|1113
comma
l_int|1066
comma
l_int|978
comma
l_int|936
comma
l_int|897
comma
l_int|859
comma
l_int|822
comma
l_int|787
comma
l_int|754
comma
l_int|722
comma
l_int|691
comma
l_int|662
comma
l_int|634
comma
l_int|607
comma
l_int|581
comma
l_int|557
comma
l_int|533
comma
l_int|510
comma
l_int|489
comma
l_int|468
comma
l_int|448
comma
l_int|429
comma
l_int|411
comma
l_int|393
comma
l_int|377
comma
l_int|361
comma
l_int|345
comma
l_int|331
comma
l_int|317
comma
l_int|303
comma
l_int|290
comma
l_int|278
comma
l_int|266
comma
l_int|255
comma
l_int|244
comma
l_int|234
comma
l_int|224
comma
l_int|214
comma
l_int|205
comma
l_int|196
comma
l_int|188
comma
l_int|180
comma
l_int|172
comma
l_int|165
comma
l_int|158
comma
l_int|151
comma
l_int|145
comma
l_int|139
comma
l_int|133
comma
l_int|127
comma
l_int|122
comma
l_int|117
comma
l_int|112
comma
l_int|107
comma
l_int|102
comma
l_int|98
comma
l_int|94
comma
l_int|90
comma
l_int|86
comma
l_int|82
comma
l_int|79
comma
l_int|75
comma
l_int|72
comma
l_int|69
comma
l_int|66
comma
l_int|63
comma
l_int|61
comma
l_int|58
comma
l_int|56
comma
l_int|53
comma
l_int|51
comma
l_int|49
comma
l_int|47
comma
l_int|45
comma
l_int|43
comma
l_int|41
comma
l_int|39
comma
l_int|37
comma
l_int|36
comma
l_int|34
comma
l_int|33
comma
l_int|31
comma
l_int|30
comma
l_int|29
comma
l_int|28
comma
l_int|26
comma
l_int|25
comma
l_int|24
comma
l_int|23
comma
l_int|22
comma
)brace
suffix:semicolon
DECL|macro|calc_parm_delay
mdefine_line|#define calc_parm_delay(msec) (0x8000 - (msec) * 1000 / 725);
multiline_comment|/* delay time = 0x8000 - msec/92 */
r_static
r_int
DECL|function|calc_parm_hold
id|calc_parm_hold
c_func
(paren
r_int
id|msec
)paren
(brace
r_int
id|val
op_assign
(paren
l_int|0x7f
op_star
l_int|92
op_minus
id|msec
)paren
op_div
l_int|92
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
l_int|1
)paren
id|val
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
l_int|127
)paren
id|val
op_assign
l_int|127
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
multiline_comment|/* attack time: search from time table */
r_static
r_int
DECL|function|calc_parm_attack
id|calc_parm_attack
c_func
(paren
r_int
id|msec
)paren
(brace
r_return
id|calc_parm_search
c_func
(paren
id|msec
comma
id|attack_time_tbl
)paren
suffix:semicolon
)brace
multiline_comment|/* decay/release time: search from time table */
r_static
r_int
DECL|function|calc_parm_decay
id|calc_parm_decay
c_func
(paren
r_int
id|msec
)paren
(brace
r_return
id|calc_parm_search
c_func
(paren
id|msec
comma
id|decay_time_tbl
)paren
suffix:semicolon
)brace
multiline_comment|/* search an index for specified time from given time table */
r_static
r_int
DECL|function|calc_parm_search
id|calc_parm_search
c_func
(paren
r_int
id|msec
comma
r_int
op_star
id|table
)paren
(brace
r_int
id|left
op_assign
l_int|1
comma
id|right
op_assign
l_int|127
comma
id|mid
suffix:semicolon
r_while
c_loop
(paren
id|left
OL
id|right
)paren
(brace
id|mid
op_assign
(paren
id|left
op_plus
id|right
)paren
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|msec
OL
(paren
r_int
)paren
id|table
(braket
id|mid
)braket
)paren
id|left
op_assign
id|mid
op_plus
l_int|1
suffix:semicolon
r_else
id|right
op_assign
id|mid
suffix:semicolon
)brace
r_return
id|left
suffix:semicolon
)brace
macro_line|#endif /* AWE_HAS_GUS_COMPATIBILITY */
multiline_comment|/*&n; * effects table&n; */
multiline_comment|/* set an effect value */
DECL|macro|FX_FLAG_OFF
mdefine_line|#define FX_FLAG_OFF&t;0
DECL|macro|FX_FLAG_SET
mdefine_line|#define FX_FLAG_SET&t;1
DECL|macro|FX_FLAG_ADD
mdefine_line|#define FX_FLAG_ADD&t;2
DECL|macro|FX_SET
mdefine_line|#define FX_SET(rec,type,value) &bslash;&n;&t;((rec)-&gt;flags[type] = FX_FLAG_SET, (rec)-&gt;val[type] = (value))
DECL|macro|FX_ADD
mdefine_line|#define FX_ADD(rec,type,value) &bslash;&n;&t;((rec)-&gt;flags[type] = FX_FLAG_ADD, (rec)-&gt;val[type] = (value))
DECL|macro|FX_UNSET
mdefine_line|#define FX_UNSET(rec,type) &bslash;&n;&t;((rec)-&gt;flags[type] = FX_FLAG_OFF, (rec)-&gt;val[type] = 0)
multiline_comment|/* check the effect value is set */
DECL|macro|FX_ON
mdefine_line|#define FX_ON(rec,type)&t;((rec)-&gt;flags[type])
DECL|macro|PARM_BYTE
mdefine_line|#define PARM_BYTE&t;0
DECL|macro|PARM_WORD
mdefine_line|#define PARM_WORD&t;1
DECL|macro|PARM_SIGN
mdefine_line|#define PARM_SIGN&t;2
DECL|struct|PARM_DEFS
r_static
r_struct
id|PARM_DEFS
(brace
DECL|member|type
r_int
id|type
suffix:semicolon
multiline_comment|/* byte or word */
DECL|member|low
DECL|member|high
r_int
id|low
comma
id|high
suffix:semicolon
multiline_comment|/* value range */
DECL|member|realtime
id|fx_affect_func
id|realtime
suffix:semicolon
multiline_comment|/* realtime paramater change */
DECL|variable|parm_defs
)brace
id|parm_defs
(braket
)braket
op_assign
(brace
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0x8000
comma
l_int|NULL
)brace
comma
multiline_comment|/* env1 delay */
(brace
id|PARM_BYTE
comma
l_int|1
comma
l_int|0x7f
comma
l_int|NULL
)brace
comma
multiline_comment|/* env1 attack */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0x7e
comma
l_int|NULL
)brace
comma
multiline_comment|/* env1 hold */
(brace
id|PARM_BYTE
comma
l_int|1
comma
l_int|0x7f
comma
l_int|NULL
)brace
comma
multiline_comment|/* env1 decay */
(brace
id|PARM_BYTE
comma
l_int|1
comma
l_int|0x7f
comma
l_int|NULL
)brace
comma
multiline_comment|/* env1 release */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0x7f
comma
l_int|NULL
)brace
comma
multiline_comment|/* env1 sustain */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
l_int|NULL
)brace
comma
multiline_comment|/* env1 pitch */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
l_int|NULL
)brace
comma
multiline_comment|/* env1 cutoff */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0x8000
comma
l_int|NULL
)brace
comma
multiline_comment|/* env2 delay */
(brace
id|PARM_BYTE
comma
l_int|1
comma
l_int|0x7f
comma
l_int|NULL
)brace
comma
multiline_comment|/* env2 attack */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0x7e
comma
l_int|NULL
)brace
comma
multiline_comment|/* env2 hold */
(brace
id|PARM_BYTE
comma
l_int|1
comma
l_int|0x7f
comma
l_int|NULL
)brace
comma
multiline_comment|/* env2 decay */
(brace
id|PARM_BYTE
comma
l_int|1
comma
l_int|0x7f
comma
l_int|NULL
)brace
comma
multiline_comment|/* env2 release */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0x7f
comma
l_int|NULL
)brace
comma
multiline_comment|/* env2 sustain */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0x8000
comma
l_int|NULL
)brace
comma
multiline_comment|/* lfo1 delay */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
id|awe_fx_tremfrq
)brace
comma
multiline_comment|/* lfo1 freq */
(brace
id|PARM_SIGN
comma
op_minus
l_int|128
comma
l_int|127
comma
id|awe_fx_tremfrq
)brace
comma
multiline_comment|/* lfo1 volume */
(brace
id|PARM_SIGN
comma
op_minus
l_int|128
comma
l_int|127
comma
id|awe_fx_fmmod
)brace
comma
multiline_comment|/* lfo1 pitch */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
id|awe_fx_fmmod
)brace
comma
multiline_comment|/* lfo1 cutoff */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0x8000
comma
l_int|NULL
)brace
comma
multiline_comment|/* lfo2 delay */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
id|awe_fx_fm2frq2
)brace
comma
multiline_comment|/* lfo2 freq */
(brace
id|PARM_SIGN
comma
op_minus
l_int|128
comma
l_int|127
comma
id|awe_fx_fm2frq2
)brace
comma
multiline_comment|/* lfo2 pitch */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
id|awe_set_voice_pitch
)brace
comma
multiline_comment|/* initial pitch */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
l_int|NULL
)brace
comma
multiline_comment|/* chorus */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
l_int|NULL
)brace
comma
multiline_comment|/* reverb */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
id|awe_set_volume
)brace
comma
multiline_comment|/* initial cutoff */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|15
comma
id|awe_fx_filterQ
)brace
comma
multiline_comment|/* initial resonance */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
l_int|NULL
)brace
comma
multiline_comment|/* sample start */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
l_int|NULL
)brace
comma
multiline_comment|/* loop start */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
l_int|NULL
)brace
comma
multiline_comment|/* loop end */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
l_int|NULL
)brace
comma
multiline_comment|/* coarse sample start */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
l_int|NULL
)brace
comma
multiline_comment|/* coarse loop start */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
l_int|NULL
)brace
comma
multiline_comment|/* coarse loop end */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
id|awe_set_volume
)brace
comma
multiline_comment|/* initial attenuation */
)brace
suffix:semicolon
r_static
r_int
r_char
DECL|function|FX_BYTE
id|FX_BYTE
c_func
(paren
id|FX_Rec
op_star
id|rec
comma
id|FX_Rec
op_star
id|lay
comma
r_int
id|type
comma
r_int
r_char
id|value
)paren
(brace
r_int
id|effect
op_assign
l_int|0
suffix:semicolon
r_int
id|on
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lay
op_logical_and
(paren
id|on
op_assign
id|FX_ON
c_func
(paren
id|lay
comma
id|type
)paren
)paren
op_ne
l_int|0
)paren
id|effect
op_assign
id|lay-&gt;val
(braket
id|type
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|on
op_logical_and
(paren
id|on
op_assign
id|FX_ON
c_func
(paren
id|rec
comma
id|type
)paren
)paren
op_ne
l_int|0
)paren
id|effect
op_assign
id|rec-&gt;val
(braket
id|type
)braket
suffix:semicolon
r_if
c_cond
(paren
id|on
op_eq
id|FX_FLAG_ADD
)paren
(brace
r_if
c_cond
(paren
id|parm_defs
(braket
id|type
)braket
dot
id|type
op_eq
id|PARM_SIGN
)paren
(brace
r_if
c_cond
(paren
id|value
OG
l_int|0x7f
)paren
id|effect
op_add_assign
(paren
r_int
)paren
id|value
op_minus
l_int|0x100
suffix:semicolon
r_else
id|effect
op_add_assign
(paren
r_int
)paren
id|value
suffix:semicolon
)brace
r_else
(brace
id|effect
op_add_assign
(paren
r_int
)paren
id|value
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|on
)paren
(brace
r_if
c_cond
(paren
id|effect
OL
id|parm_defs
(braket
id|type
)braket
dot
id|low
)paren
id|effect
op_assign
id|parm_defs
(braket
id|type
)braket
dot
id|low
suffix:semicolon
r_else
r_if
c_cond
(paren
id|effect
OG
id|parm_defs
(braket
id|type
)braket
dot
id|high
)paren
id|effect
op_assign
id|parm_defs
(braket
id|type
)braket
dot
id|high
suffix:semicolon
r_return
(paren
r_int
r_char
)paren
id|effect
suffix:semicolon
)brace
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/* get word effect value */
r_static
r_int
r_int
DECL|function|FX_WORD
id|FX_WORD
c_func
(paren
id|FX_Rec
op_star
id|rec
comma
id|FX_Rec
op_star
id|lay
comma
r_int
id|type
comma
r_int
r_int
id|value
)paren
(brace
r_int
id|effect
op_assign
l_int|0
suffix:semicolon
r_int
id|on
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lay
op_logical_and
(paren
id|on
op_assign
id|FX_ON
c_func
(paren
id|lay
comma
id|type
)paren
)paren
op_ne
l_int|0
)paren
id|effect
op_assign
id|lay-&gt;val
(braket
id|type
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|on
op_logical_and
(paren
id|on
op_assign
id|FX_ON
c_func
(paren
id|rec
comma
id|type
)paren
)paren
op_ne
l_int|0
)paren
id|effect
op_assign
id|rec-&gt;val
(braket
id|type
)braket
suffix:semicolon
r_if
c_cond
(paren
id|on
op_eq
id|FX_FLAG_ADD
)paren
id|effect
op_add_assign
(paren
r_int
)paren
id|value
suffix:semicolon
r_if
c_cond
(paren
id|on
)paren
(brace
r_if
c_cond
(paren
id|effect
OL
id|parm_defs
(braket
id|type
)braket
dot
id|low
)paren
id|effect
op_assign
id|parm_defs
(braket
id|type
)braket
dot
id|low
suffix:semicolon
r_else
r_if
c_cond
(paren
id|effect
OG
id|parm_defs
(braket
id|type
)braket
dot
id|high
)paren
id|effect
op_assign
id|parm_defs
(braket
id|type
)braket
dot
id|high
suffix:semicolon
r_return
(paren
r_int
r_int
)paren
id|effect
suffix:semicolon
)brace
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/* get word (upper=type1/lower=type2) effect value */
r_static
r_int
r_int
DECL|function|FX_COMB
id|FX_COMB
c_func
(paren
id|FX_Rec
op_star
id|rec
comma
id|FX_Rec
op_star
id|lay
comma
r_int
id|type1
comma
r_int
id|type2
comma
r_int
r_int
id|value
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|FX_BYTE
c_func
(paren
id|rec
comma
id|lay
comma
id|type1
comma
(paren
r_int
r_char
)paren
(paren
id|value
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|tmp
op_lshift_assign
l_int|8
suffix:semicolon
id|tmp
op_or_assign
id|FX_BYTE
c_func
(paren
id|rec
comma
id|lay
comma
id|type2
comma
(paren
r_int
r_char
)paren
(paren
id|value
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
r_return
id|tmp
suffix:semicolon
)brace
multiline_comment|/* address offset */
r_static
r_int
DECL|function|FX_OFFSET
id|FX_OFFSET
c_func
(paren
id|FX_Rec
op_star
id|rec
comma
id|FX_Rec
op_star
id|lay
comma
r_int
id|lo
comma
r_int
id|hi
comma
r_int
id|mode
)paren
(brace
r_int
id|addr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lay
op_logical_and
id|FX_ON
c_func
(paren
id|lay
comma
id|hi
)paren
)paren
id|addr
op_assign
(paren
r_int
)paren
id|lay-&gt;val
(braket
id|hi
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|rec
comma
id|hi
)paren
)paren
id|addr
op_assign
(paren
r_int
)paren
id|rec-&gt;val
(braket
id|hi
)braket
suffix:semicolon
id|addr
op_assign
id|addr
op_lshift
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|lay
op_logical_and
id|FX_ON
c_func
(paren
id|lay
comma
id|lo
)paren
)paren
id|addr
op_add_assign
(paren
r_int
)paren
id|lay-&gt;val
(braket
id|lo
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|rec
comma
id|lo
)paren
)paren
id|addr
op_add_assign
(paren
r_int
)paren
id|rec-&gt;val
(braket
id|lo
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mode
op_amp
id|AWE_SAMPLE_8BITS
)paren
)paren
id|addr
op_div_assign
l_int|2
suffix:semicolon
r_return
id|addr
suffix:semicolon
)brace
multiline_comment|/*&n; * turn on/off sample&n; */
multiline_comment|/* table for volume target calculation */
DECL|variable|voltarget
r_static
r_int
r_int
id|voltarget
(braket
l_int|16
)braket
op_assign
(brace
l_int|0xEAC0
comma
l_int|0XE0C8
comma
l_int|0XD740
comma
l_int|0XCE20
comma
l_int|0XC560
comma
l_int|0XBD08
comma
l_int|0XB500
comma
l_int|0XAD58
comma
l_int|0XA5F8
comma
l_int|0X9EF0
comma
l_int|0X9830
comma
l_int|0X91C0
comma
l_int|0X8B90
comma
l_int|0X85A8
comma
l_int|0X8000
comma
l_int|0X7A90
)brace
suffix:semicolon
r_static
r_void
DECL|function|awe_note_on
id|awe_note_on
c_func
(paren
r_int
id|voice
)paren
(brace
r_int
r_int
id|temp
suffix:semicolon
r_int
id|addr
suffix:semicolon
r_int
id|vtarget
comma
id|ftarget
comma
id|ptarget
comma
id|pitch
suffix:semicolon
id|awe_voice_info
op_star
id|vp
suffix:semicolon
id|awe_voice_parm_block
op_star
id|parm
suffix:semicolon
id|FX_Rec
op_star
id|fx
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx
suffix:semicolon
id|FX_Rec
op_star
id|fx_lay
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|layer
OL
id|MAX_LAYERS
)paren
id|fx_lay
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx_layer
(braket
id|voices
(braket
id|voice
)braket
dot
id|layer
)braket
suffix:semicolon
multiline_comment|/* A voice sample must assigned before calling */
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|parm
op_assign
(paren
id|awe_voice_parm_block
op_star
)paren
op_amp
id|vp-&gt;parm
suffix:semicolon
multiline_comment|/* channel to be silent and idle */
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|voice
)paren
comma
l_int|0x0080
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|voice
)paren
comma
l_int|0x0000FFFF
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|voice
)paren
comma
l_int|0x0000FFFF
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|voice
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_CPF
c_func
(paren
id|voice
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* set pitch offset */
id|awe_set_pitch
c_func
(paren
id|voice
comma
id|TRUE
)paren
suffix:semicolon
multiline_comment|/* modulation &amp; volume envelope */
r_if
c_cond
(paren
id|parm-&gt;modatk
op_ge
l_int|0x80
op_logical_and
id|parm-&gt;moddelay
op_ge
l_int|0x8000
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_ENVVAL
c_func
(paren
id|voice
)paren
comma
l_int|0xBFFF
)paren
suffix:semicolon
id|pitch
op_assign
(paren
id|parm-&gt;env1pit
op_lshift
l_int|4
)paren
op_plus
id|voices
(braket
id|voice
)braket
dot
id|apitch
suffix:semicolon
r_if
c_cond
(paren
id|pitch
OG
l_int|0xffff
)paren
id|pitch
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* calculate filter target */
id|ftarget
op_assign
id|parm-&gt;cutoff
op_plus
id|parm-&gt;env1fc
suffix:semicolon
id|limitvalue
c_func
(paren
id|ftarget
comma
l_int|0
comma
l_int|255
)paren
suffix:semicolon
id|ftarget
op_lshift_assign
l_int|8
suffix:semicolon
)brace
r_else
(brace
id|awe_poke
c_func
(paren
id|AWE_ENVVAL
c_func
(paren
id|voice
)paren
comma
id|FX_WORD
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV1_DELAY
comma
id|parm-&gt;moddelay
)paren
)paren
suffix:semicolon
id|ftarget
op_assign
id|parm-&gt;cutoff
suffix:semicolon
id|ftarget
op_lshift_assign
l_int|8
suffix:semicolon
id|pitch
op_assign
id|voices
(braket
id|voice
)braket
dot
id|apitch
suffix:semicolon
)brace
multiline_comment|/* calcualte pitch target */
r_if
c_cond
(paren
id|pitch
op_ne
l_int|0xffff
)paren
(brace
id|ptarget
op_assign
l_int|1
op_lshift
(paren
id|pitch
op_rshift
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pitch
op_amp
l_int|0x800
)paren
id|ptarget
op_add_assign
(paren
id|ptarget
op_star
l_int|0x102e
)paren
op_div
l_int|0x2710
suffix:semicolon
r_if
c_cond
(paren
id|pitch
op_amp
l_int|0x400
)paren
id|ptarget
op_add_assign
(paren
id|ptarget
op_star
l_int|0x764
)paren
op_div
l_int|0x2710
suffix:semicolon
r_if
c_cond
(paren
id|pitch
op_amp
l_int|0x200
)paren
id|ptarget
op_add_assign
(paren
id|ptarget
op_star
l_int|0x389
)paren
op_div
l_int|0x2710
suffix:semicolon
id|ptarget
op_add_assign
(paren
id|ptarget
op_rshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptarget
OG
l_int|0xffff
)paren
id|ptarget
op_assign
l_int|0xffff
suffix:semicolon
)brace
r_else
id|ptarget
op_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|parm-&gt;modatk
op_ge
l_int|0x80
)paren
id|awe_poke
c_func
(paren
id|AWE_ATKHLD
c_func
(paren
id|voice
)paren
comma
id|FX_BYTE
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV1_HOLD
comma
id|parm-&gt;modhld
)paren
op_lshift
l_int|8
op_or
l_int|0x7f
)paren
suffix:semicolon
r_else
id|awe_poke
c_func
(paren
id|AWE_ATKHLD
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV1_HOLD
comma
id|AWE_FX_ENV1_ATTACK
comma
id|vp-&gt;parm.modatkhld
)paren
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUS
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV1_SUSTAIN
comma
id|AWE_FX_ENV1_DECAY
comma
id|vp-&gt;parm.moddcysus
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|parm-&gt;volatk
op_ge
l_int|0x80
op_logical_and
id|parm-&gt;voldelay
op_ge
l_int|0x8000
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_ENVVOL
c_func
(paren
id|voice
)paren
comma
l_int|0xBFFF
)paren
suffix:semicolon
id|vtarget
op_assign
id|voltarget
(braket
id|voices
(braket
id|voice
)braket
dot
id|avol
op_mod
l_int|0x10
)braket
op_rshift
(paren
id|voices
(braket
id|voice
)braket
dot
id|avol
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|awe_poke
c_func
(paren
id|AWE_ENVVOL
c_func
(paren
id|voice
)paren
comma
id|FX_WORD
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV2_DELAY
comma
id|vp-&gt;parm.voldelay
)paren
)paren
suffix:semicolon
id|vtarget
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|parm-&gt;volatk
op_ge
l_int|0x80
)paren
id|awe_poke
c_func
(paren
id|AWE_ATKHLDV
c_func
(paren
id|voice
)paren
comma
id|FX_BYTE
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV2_HOLD
comma
id|parm-&gt;volhld
)paren
op_lshift
l_int|8
op_or
l_int|0x7f
)paren
suffix:semicolon
r_else
id|awe_poke
c_func
(paren
id|AWE_ATKHLDV
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV2_HOLD
comma
id|AWE_FX_ENV2_ATTACK
comma
id|vp-&gt;parm.volatkhld
)paren
)paren
suffix:semicolon
multiline_comment|/* decay/sustain parameter for volume envelope must be set at last */
multiline_comment|/* cutoff and volume */
id|awe_set_volume
c_func
(paren
id|voice
comma
id|TRUE
)paren
suffix:semicolon
multiline_comment|/* modulation envelope heights */
id|awe_poke
c_func
(paren
id|AWE_PEFE
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV1_PITCH
comma
id|AWE_FX_ENV1_CUTOFF
comma
id|vp-&gt;parm.pefe
)paren
)paren
suffix:semicolon
multiline_comment|/* lfo1/2 delay */
id|awe_poke
c_func
(paren
id|AWE_LFO1VAL
c_func
(paren
id|voice
)paren
comma
id|FX_WORD
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_LFO1_DELAY
comma
id|vp-&gt;parm.lfo1delay
)paren
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_LFO2VAL
c_func
(paren
id|voice
)paren
comma
id|FX_WORD
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_LFO2_DELAY
comma
id|vp-&gt;parm.lfo2delay
)paren
)paren
suffix:semicolon
multiline_comment|/* lfo1 pitch &amp; cutoff shift */
id|awe_fx_fmmod
c_func
(paren
id|voice
comma
id|TRUE
)paren
suffix:semicolon
multiline_comment|/* lfo1 volume &amp; freq */
id|awe_fx_tremfrq
c_func
(paren
id|voice
comma
id|TRUE
)paren
suffix:semicolon
multiline_comment|/* lfo2 pitch &amp; freq */
id|awe_fx_fm2frq2
c_func
(paren
id|voice
comma
id|TRUE
)paren
suffix:semicolon
multiline_comment|/* pan &amp; loop start */
id|awe_set_pan
c_func
(paren
id|voice
comma
id|TRUE
)paren
suffix:semicolon
multiline_comment|/* chorus &amp; loop end (chorus 8bit, MSB) */
id|addr
op_assign
id|vp-&gt;loopend
op_minus
l_int|1
suffix:semicolon
id|addr
op_add_assign
id|FX_OFFSET
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_LOOP_END
comma
id|AWE_FX_COARSE_LOOP_END
comma
id|vp-&gt;mode
)paren
suffix:semicolon
id|temp
op_assign
id|FX_BYTE
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_CHORUS
comma
id|vp-&gt;parm.chorus
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_lshift
l_int|24
)paren
op_or
(paren
r_int
r_int
)paren
id|addr
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
id|voice
)paren
comma
id|temp
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- loopend=%x/%x]&bslash;n&quot;
comma
id|vp-&gt;loopend
comma
id|addr
)paren
)paren
suffix:semicolon
multiline_comment|/* Q &amp; current address (Q 4bit value, MSB) */
id|addr
op_assign
id|vp-&gt;start
op_minus
l_int|1
suffix:semicolon
id|addr
op_add_assign
id|FX_OFFSET
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_SAMPLE_START
comma
id|AWE_FX_COARSE_SAMPLE_START
comma
id|vp-&gt;mode
)paren
suffix:semicolon
id|temp
op_assign
id|FX_BYTE
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_FILTERQ
comma
id|vp-&gt;parm.filterQ
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_lshift
l_int|28
)paren
op_or
(paren
r_int
r_int
)paren
id|addr
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|voice
)paren
comma
id|temp
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- startaddr=%x/%x]&bslash;n&quot;
comma
id|vp-&gt;start
comma
id|addr
)paren
)paren
suffix:semicolon
multiline_comment|/* clear unknown registers */
id|awe_poke_dw
c_func
(paren
id|AWE_00A0
c_func
(paren
id|voice
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_0080
c_func
(paren
id|voice
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* reset volume */
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|voice
)paren
comma
(paren
id|vtarget
op_lshift
l_int|16
)paren
op_or
id|ftarget
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|voice
)paren
comma
(paren
id|vtarget
op_lshift
l_int|16
)paren
op_or
id|ftarget
)paren
suffix:semicolon
multiline_comment|/* set reverb */
id|temp
op_assign
id|FX_BYTE
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_REVERB
comma
id|vp-&gt;parm.reverb
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_lshift
l_int|8
)paren
op_or
(paren
id|ptarget
op_lshift
l_int|16
)paren
op_or
id|voices
(braket
id|voice
)braket
dot
id|aaux
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|voice
)paren
comma
id|temp
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
id|voice
)paren
comma
id|ptarget
op_lshift
l_int|16
)paren
suffix:semicolon
multiline_comment|/* turn on envelope */
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV2_SUSTAIN
comma
id|AWE_FX_ENV2_DECAY
comma
id|vp-&gt;parm.voldcysus
)paren
)paren
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|state
op_assign
id|AWE_ST_ON
suffix:semicolon
multiline_comment|/* clear voice position for the next note on this channel */
r_if
c_cond
(paren
id|SINGLE_LAYER_MODE
c_func
(paren
)paren
)paren
(brace
id|FX_UNSET
c_func
(paren
id|fx
comma
id|AWE_FX_SAMPLE_START
)paren
suffix:semicolon
id|FX_UNSET
c_func
(paren
id|fx
comma
id|AWE_FX_COARSE_SAMPLE_START
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* turn off the voice */
r_static
r_void
DECL|function|awe_note_off
id|awe_note_off
c_func
(paren
r_int
id|voice
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|FX_Rec
op_star
id|fx
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx
suffix:semicolon
id|FX_Rec
op_star
id|fx_lay
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|layer
OL
id|MAX_LAYERS
)paren
id|fx_lay
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx_layer
(braket
id|voices
(braket
id|voice
)braket
dot
id|layer
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
)paren
(brace
id|voices
(braket
id|voice
)braket
dot
id|state
op_assign
id|AWE_ST_OFF
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tmp
op_assign
l_int|0x8000
op_or
id|FX_BYTE
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV1_RELEASE
comma
(paren
r_int
r_char
)paren
id|vp-&gt;parm.modrelease
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUS
c_func
(paren
id|voice
)paren
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
l_int|0x8000
op_or
id|FX_BYTE
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ENV2_RELEASE
comma
(paren
r_int
r_char
)paren
id|vp-&gt;parm.volrelease
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|voice
)paren
comma
id|tmp
)paren
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|state
op_assign
id|AWE_ST_RELEASED
suffix:semicolon
)brace
multiline_comment|/* force to terminate the voice (no releasing echo) */
r_static
r_void
DECL|function|awe_terminate
id|awe_terminate
c_func
(paren
r_int
id|voice
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|voice
)paren
comma
l_int|0x807F
)paren
suffix:semicolon
id|awe_tweak_voice
c_func
(paren
id|voice
)paren
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|state
op_assign
id|AWE_ST_OFF
suffix:semicolon
)brace
multiline_comment|/* turn off other voices with the same exclusive class (for drums) */
r_static
r_void
DECL|function|awe_exclusive_off
id|awe_exclusive_off
c_func
(paren
r_int
id|voice
)paren
(brace
r_int
id|i
comma
id|exclass
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|sample
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|exclass
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample-&gt;exclusiveClass
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* not exclusive */
multiline_comment|/* turn off voices with the same class */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_ne
id|voice
op_logical_and
id|IS_PLAYING
c_func
(paren
id|i
)paren
op_logical_and
id|voices
(braket
id|i
)braket
dot
id|sample
op_logical_and
id|voices
(braket
id|i
)braket
dot
id|ch
op_eq
id|voices
(braket
id|voice
)braket
dot
id|ch
op_logical_and
id|voices
(braket
id|i
)braket
dot
id|sample-&gt;exclusiveClass
op_eq
id|exclass
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [exoff(%d)]&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
id|awe_terminate
c_func
(paren
id|i
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|i
comma
id|TRUE
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * change the parameters of an audible voice&n; */
multiline_comment|/* change pitch */
r_static
r_void
DECL|function|awe_set_pitch
id|awe_set_pitch
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
r_if
c_cond
(paren
id|IS_NO_EFFECT
c_func
(paren
id|voice
)paren
op_logical_and
op_logical_neg
id|forced
)paren
r_return
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IP
c_func
(paren
id|voice
)paren
comma
id|voices
(braket
id|voice
)braket
dot
id|apitch
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- pitch=%x]&bslash;n&quot;
comma
id|voices
(braket
id|voice
)braket
dot
id|apitch
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* calculate &amp; change pitch */
r_static
r_void
DECL|function|awe_set_voice_pitch
id|awe_set_voice_pitch
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
id|awe_calc_pitch
c_func
(paren
id|voice
)paren
suffix:semicolon
id|awe_set_pitch
c_func
(paren
id|voice
comma
id|forced
)paren
suffix:semicolon
)brace
multiline_comment|/* change volume &amp; cutoff */
r_static
r_void
DECL|function|awe_set_volume
id|awe_set_volume
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
r_int
r_int
id|tmp2
suffix:semicolon
id|FX_Rec
op_star
id|fx
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx
suffix:semicolon
id|FX_Rec
op_star
id|fx_lay
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|layer
OL
id|MAX_LAYERS
)paren
id|fx_lay
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx_layer
(braket
id|voices
(braket
id|voice
)braket
dot
id|layer
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_PLAYING
c_func
(paren
id|voice
)paren
op_logical_and
op_logical_neg
id|forced
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|tmp2
op_assign
id|FX_BYTE
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_CUTOFF
comma
(paren
r_int
r_char
)paren
id|voices
(braket
id|voice
)braket
dot
id|acutoff
)paren
suffix:semicolon
id|tmp2
op_assign
(paren
id|tmp2
op_lshift
l_int|8
)paren
suffix:semicolon
id|tmp2
op_or_assign
id|FX_BYTE
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_ATTEN
comma
(paren
r_int
r_char
)paren
id|voices
(braket
id|voice
)braket
dot
id|avol
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IFATN
c_func
(paren
id|voice
)paren
comma
id|tmp2
)paren
suffix:semicolon
)brace
multiline_comment|/* calculate &amp; change volume */
r_static
r_void
DECL|function|awe_set_voice_vol
id|awe_set_voice_vol
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
r_if
c_cond
(paren
id|IS_EMPTY
c_func
(paren
id|voice
)paren
)paren
r_return
suffix:semicolon
id|awe_calc_volume
c_func
(paren
id|voice
)paren
suffix:semicolon
id|awe_set_volume
c_func
(paren
id|voice
comma
id|forced
)paren
suffix:semicolon
)brace
multiline_comment|/* change pan; this could make a click noise.. */
r_static
r_void
DECL|function|awe_set_pan
id|awe_set_pan
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
r_int
r_int
id|temp
suffix:semicolon
r_int
id|addr
suffix:semicolon
id|awe_voice_info
op_star
id|vp
suffix:semicolon
id|FX_Rec
op_star
id|fx
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx
suffix:semicolon
id|FX_Rec
op_star
id|fx_lay
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|layer
OL
id|MAX_LAYERS
)paren
id|fx_lay
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx_layer
(braket
id|voices
(braket
id|voice
)braket
dot
id|layer
)braket
suffix:semicolon
r_if
c_cond
(paren
id|IS_NO_EFFECT
c_func
(paren
id|voice
)paren
op_logical_and
op_logical_neg
id|forced
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
op_eq
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* pan &amp; loop start (pan 8bit, MSB, 0:right, 0xff:left) */
r_if
c_cond
(paren
id|vp-&gt;fixpan
OG
l_int|0
)paren
multiline_comment|/* 0-127 */
id|temp
op_assign
l_int|255
op_minus
(paren
r_int
)paren
id|vp-&gt;fixpan
op_star
l_int|2
suffix:semicolon
r_else
(brace
r_int
id|pos
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;pan
op_ge
l_int|0
)paren
multiline_comment|/* 0-127 */
id|pos
op_assign
(paren
r_int
)paren
id|vp-&gt;pan
op_star
l_int|2
op_minus
l_int|128
suffix:semicolon
id|pos
op_add_assign
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;panning
suffix:semicolon
multiline_comment|/* -128 - 127 */
id|temp
op_assign
l_int|127
op_minus
id|pos
suffix:semicolon
)brace
id|limitvalue
c_func
(paren
id|temp
comma
l_int|0
comma
l_int|255
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctrls
(braket
id|AWE_MD_PAN_EXCHANGE
)braket
)paren
(brace
id|temp
op_assign
l_int|255
op_minus
id|temp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|forced
op_logical_or
id|temp
op_ne
id|voices
(braket
id|voice
)braket
dot
id|apan
)paren
(brace
id|voices
(braket
id|voice
)braket
dot
id|apan
op_assign
id|temp
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_eq
l_int|0
)paren
id|voices
(braket
id|voice
)braket
dot
id|aaux
op_assign
l_int|0xff
suffix:semicolon
r_else
id|voices
(braket
id|voice
)braket
dot
id|aaux
op_assign
(paren
op_minus
id|temp
)paren
op_amp
l_int|0xff
suffix:semicolon
id|addr
op_assign
id|vp-&gt;loopstart
op_minus
l_int|1
suffix:semicolon
id|addr
op_add_assign
id|FX_OFFSET
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_LOOP_START
comma
id|AWE_FX_COARSE_LOOP_START
comma
id|vp-&gt;mode
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_lshift
l_int|24
)paren
op_or
(paren
r_int
r_int
)paren
id|addr
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
id|voice
)paren
comma
id|temp
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- loopstart=%x/%x]&bslash;n&quot;
comma
id|vp-&gt;loopstart
comma
id|addr
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* effects change during playing */
r_static
r_void
DECL|function|awe_fx_fmmod
id|awe_fx_fmmod
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
id|FX_Rec
op_star
id|fx
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx
suffix:semicolon
id|FX_Rec
op_star
id|fx_lay
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|layer
OL
id|MAX_LAYERS
)paren
id|fx_lay
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx_layer
(braket
id|voices
(braket
id|voice
)braket
dot
id|layer
)braket
suffix:semicolon
r_if
c_cond
(paren
id|IS_NO_EFFECT
c_func
(paren
id|voice
)paren
op_logical_and
op_logical_neg
id|forced
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FMMOD
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_LFO1_PITCH
comma
id|AWE_FX_LFO1_CUTOFF
comma
id|vp-&gt;parm.fmmod
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* set tremolo (lfo1) volume &amp; frequency */
r_static
r_void
DECL|function|awe_fx_tremfrq
id|awe_fx_tremfrq
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
id|FX_Rec
op_star
id|fx
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx
suffix:semicolon
id|FX_Rec
op_star
id|fx_lay
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|layer
OL
id|MAX_LAYERS
)paren
id|fx_lay
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx_layer
(braket
id|voices
(braket
id|voice
)braket
dot
id|layer
)braket
suffix:semicolon
r_if
c_cond
(paren
id|IS_NO_EFFECT
c_func
(paren
id|voice
)paren
op_logical_and
op_logical_neg
id|forced
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_TREMFRQ
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_LFO1_VOLUME
comma
id|AWE_FX_LFO1_FREQ
comma
id|vp-&gt;parm.tremfrq
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* set lfo2 pitch &amp; frequency */
r_static
r_void
DECL|function|awe_fx_fm2frq2
id|awe_fx_fm2frq2
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
id|FX_Rec
op_star
id|fx
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx
suffix:semicolon
id|FX_Rec
op_star
id|fx_lay
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|layer
OL
id|MAX_LAYERS
)paren
id|fx_lay
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx_layer
(braket
id|voices
(braket
id|voice
)braket
dot
id|layer
)braket
suffix:semicolon
r_if
c_cond
(paren
id|IS_NO_EFFECT
c_func
(paren
id|voice
)paren
op_logical_and
op_logical_neg
id|forced
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FM2FRQ2
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_LFO2_PITCH
comma
id|AWE_FX_LFO2_FREQ
comma
id|vp-&gt;parm.fm2frq2
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Q &amp; current address (Q 4bit value, MSB) */
r_static
r_void
DECL|function|awe_fx_filterQ
id|awe_fx_filterQ
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
r_int
r_int
id|addr
suffix:semicolon
id|awe_voice_info
op_star
id|vp
suffix:semicolon
id|FX_Rec
op_star
id|fx
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx
suffix:semicolon
id|FX_Rec
op_star
id|fx_lay
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|layer
OL
id|MAX_LAYERS
)paren
id|fx_lay
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx_layer
(braket
id|voices
(braket
id|voice
)braket
dot
id|layer
)braket
suffix:semicolon
r_if
c_cond
(paren
id|IS_NO_EFFECT
c_func
(paren
id|voice
)paren
op_logical_and
op_logical_neg
id|forced
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|addr
op_assign
id|awe_peek_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|voice
)paren
)paren
op_amp
l_int|0xffffff
suffix:semicolon
id|addr
op_or_assign
(paren
id|FX_BYTE
c_func
(paren
id|fx
comma
id|fx_lay
comma
id|AWE_FX_FILTERQ
comma
id|vp-&gt;parm.filterQ
)paren
op_lshift
l_int|28
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|voice
)paren
comma
id|addr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * calculate pitch offset&n; *&n; * 0xE000 is no pitch offset at 44100Hz sample.&n; * Every 4096 is one octave.&n; */
r_static
r_void
DECL|function|awe_calc_pitch
id|awe_calc_pitch
c_func
(paren
r_int
id|voice
)paren
(brace
id|voice_info
op_star
id|vp
op_assign
op_amp
id|voices
(braket
id|voice
)braket
suffix:semicolon
id|awe_voice_info
op_star
id|ap
suffix:semicolon
id|awe_chan_info
op_star
id|cp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|cinfo
suffix:semicolon
r_int
id|offset
suffix:semicolon
multiline_comment|/* search voice information */
r_if
c_cond
(paren
(paren
id|ap
op_assign
id|vp-&gt;sample
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;index
op_eq
l_int|0
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: set sample (%d)&bslash;n&quot;
comma
id|ap-&gt;sample
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awe_set_sample
c_func
(paren
(paren
id|awe_voice_list
op_star
)paren
id|ap
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* calculate offset */
r_if
c_cond
(paren
id|ap-&gt;fixkey
op_ge
l_int|0
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; fixkey(%d) tune(%d)&bslash;n&quot;
comma
id|ap-&gt;fixkey
comma
id|ap-&gt;tune
)paren
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|ap-&gt;fixkey
op_minus
id|ap-&gt;root
)paren
op_star
l_int|4096
op_div
l_int|12
suffix:semicolon
)brace
r_else
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p(%d)-&gt; root(%d) tune(%d)&bslash;n&quot;
comma
id|vp-&gt;note
comma
id|ap-&gt;root
comma
id|ap-&gt;tune
)paren
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|vp-&gt;note
op_minus
id|ap-&gt;root
)paren
op_star
l_int|4096
op_div
l_int|12
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; ofs=%d&bslash;n&quot;
comma
id|offset
)paren
)paren
suffix:semicolon
)brace
id|offset
op_assign
(paren
id|offset
op_star
id|ap-&gt;scaleTuning
)paren
op_div
l_int|100
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; scale* ofs=%d&bslash;n&quot;
comma
id|offset
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
id|ap-&gt;tune
op_star
l_int|4096
op_div
l_int|1200
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; tune+ ofs=%d&bslash;n&quot;
comma
id|offset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cp-&gt;bender
op_ne
l_int|0
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; bend(%d) %d&bslash;n&quot;
comma
id|voice
comma
id|cp-&gt;bender
)paren
)paren
suffix:semicolon
multiline_comment|/* (819200: 1 semitone) ==&gt; (4096: 12 semitones) */
id|offset
op_add_assign
id|cp-&gt;bender
op_star
id|cp-&gt;bender_range
op_div
l_int|2400
suffix:semicolon
)brace
multiline_comment|/* add initial pitch correction */
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
op_amp
id|cp-&gt;fx_layer
(braket
id|vp-&gt;layer
)braket
comma
id|AWE_FX_INIT_PITCH
)paren
)paren
id|offset
op_add_assign
id|cp-&gt;fx_layer
(braket
id|vp-&gt;layer
)braket
dot
id|val
(braket
id|AWE_FX_INIT_PITCH
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
op_amp
id|cp-&gt;fx
comma
id|AWE_FX_INIT_PITCH
)paren
)paren
id|offset
op_add_assign
id|cp-&gt;fx.val
(braket
id|AWE_FX_INIT_PITCH
)braket
suffix:semicolon
multiline_comment|/* 0xe000: root pitch */
id|vp-&gt;apitch
op_assign
l_int|0xe000
op_plus
id|ap-&gt;rate_offset
op_plus
id|offset
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; sum aofs=%x, rate_ofs=%d&bslash;n&quot;
comma
id|vp-&gt;apitch
comma
id|ap-&gt;rate_offset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;apitch
OG
l_int|0xffff
)paren
id|vp-&gt;apitch
op_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;apitch
OL
l_int|0
)paren
id|vp-&gt;apitch
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
multiline_comment|/* calculate MIDI key and semitone from the specified frequency */
r_static
r_void
DECL|function|awe_calc_pitch_from_freq
id|awe_calc_pitch_from_freq
c_func
(paren
r_int
id|voice
comma
r_int
id|freq
)paren
(brace
id|voice_info
op_star
id|vp
op_assign
op_amp
id|voices
(braket
id|voice
)braket
suffix:semicolon
id|awe_voice_info
op_star
id|ap
suffix:semicolon
id|FX_Rec
op_star
id|fx
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx
suffix:semicolon
id|FX_Rec
op_star
id|fx_lay
op_assign
l_int|NULL
suffix:semicolon
r_int
id|offset
suffix:semicolon
r_int
id|note
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|layer
OL
id|MAX_LAYERS
)paren
id|fx_lay
op_assign
op_amp
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;fx_layer
(braket
id|voices
(braket
id|voice
)braket
dot
id|layer
)braket
suffix:semicolon
multiline_comment|/* search voice information */
r_if
c_cond
(paren
(paren
id|ap
op_assign
id|vp-&gt;sample
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;index
op_eq
l_int|0
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: set sample (%d)&bslash;n&quot;
comma
id|ap-&gt;sample
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awe_set_sample
c_func
(paren
(paren
id|awe_voice_list
op_star
)paren
id|ap
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
)brace
id|note
op_assign
id|freq_to_note
c_func
(paren
id|freq
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|note
op_minus
id|ap-&gt;root
op_star
l_int|100
op_plus
id|ap-&gt;tune
)paren
op_star
l_int|4096
op_div
l_int|1200
suffix:semicolon
id|offset
op_assign
(paren
id|offset
op_star
id|ap-&gt;scaleTuning
)paren
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|fx_lay
op_logical_and
id|FX_ON
c_func
(paren
id|fx_lay
comma
id|AWE_FX_INIT_PITCH
)paren
)paren
id|offset
op_add_assign
id|fx_lay-&gt;val
(braket
id|AWE_FX_INIT_PITCH
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|fx
comma
id|AWE_FX_INIT_PITCH
)paren
)paren
id|offset
op_add_assign
id|fx-&gt;val
(braket
id|AWE_FX_INIT_PITCH
)braket
suffix:semicolon
id|vp-&gt;apitch
op_assign
l_int|0xe000
op_plus
id|ap-&gt;rate_offset
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;apitch
OG
l_int|0xffff
)paren
id|vp-&gt;apitch
op_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;apitch
OL
l_int|0
)paren
id|vp-&gt;apitch
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* AWE_HAS_GUS_COMPATIBILITY */
multiline_comment|/*&n; * calculate volume attenuation&n; *&n; * Voice volume is controlled by volume attenuation parameter.&n; * So volume becomes maximum when avol is 0 (no attenuation), and&n; * minimum when 255 (-96dB or silence).&n; */
DECL|variable|vol_table
r_static
r_int
id|vol_table
(braket
l_int|128
)braket
op_assign
(brace
l_int|255
comma
l_int|111
comma
l_int|95
comma
l_int|86
comma
l_int|79
comma
l_int|74
comma
l_int|70
comma
l_int|66
comma
l_int|63
comma
l_int|61
comma
l_int|58
comma
l_int|56
comma
l_int|54
comma
l_int|52
comma
l_int|50
comma
l_int|49
comma
l_int|47
comma
l_int|46
comma
l_int|45
comma
l_int|43
comma
l_int|42
comma
l_int|41
comma
l_int|40
comma
l_int|39
comma
l_int|38
comma
l_int|37
comma
l_int|36
comma
l_int|35
comma
l_int|34
comma
l_int|34
comma
l_int|33
comma
l_int|32
comma
l_int|31
comma
l_int|31
comma
l_int|30
comma
l_int|29
comma
l_int|29
comma
l_int|28
comma
l_int|27
comma
l_int|27
comma
l_int|26
comma
l_int|26
comma
l_int|25
comma
l_int|24
comma
l_int|24
comma
l_int|23
comma
l_int|23
comma
l_int|22
comma
l_int|22
comma
l_int|21
comma
l_int|21
comma
l_int|21
comma
l_int|20
comma
l_int|20
comma
l_int|19
comma
l_int|19
comma
l_int|18
comma
l_int|18
comma
l_int|18
comma
l_int|17
comma
l_int|17
comma
l_int|16
comma
l_int|16
comma
l_int|16
comma
l_int|15
comma
l_int|15
comma
l_int|15
comma
l_int|14
comma
l_int|14
comma
l_int|14
comma
l_int|13
comma
l_int|13
comma
l_int|13
comma
l_int|12
comma
l_int|12
comma
l_int|12
comma
l_int|11
comma
l_int|11
comma
l_int|11
comma
l_int|10
comma
l_int|10
comma
l_int|10
comma
l_int|10
comma
l_int|9
comma
l_int|9
comma
l_int|9
comma
l_int|8
comma
l_int|8
comma
l_int|8
comma
l_int|8
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* tables for volume-&gt;attenuation calculation */
DECL|variable|voltab1
r_static
r_int
r_char
id|voltab1
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x2b
comma
l_int|0x29
comma
l_int|0x28
comma
l_int|0x27
comma
l_int|0x26
comma
l_int|0x25
comma
l_int|0x24
comma
l_int|0x23
comma
l_int|0x22
comma
l_int|0x21
comma
l_int|0x20
comma
l_int|0x1f
comma
l_int|0x1e
comma
l_int|0x1e
comma
l_int|0x1d
comma
l_int|0x1c
comma
l_int|0x1b
comma
l_int|0x1b
comma
l_int|0x1a
comma
l_int|0x19
comma
l_int|0x19
comma
l_int|0x18
comma
l_int|0x17
comma
l_int|0x17
comma
l_int|0x16
comma
l_int|0x16
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x14
comma
l_int|0x14
comma
l_int|0x13
comma
l_int|0x13
comma
l_int|0x13
comma
l_int|0x12
comma
l_int|0x12
comma
l_int|0x11
comma
l_int|0x11
comma
l_int|0x11
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|variable|voltab2
r_static
r_int
r_char
id|voltab2
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x32
comma
l_int|0x31
comma
l_int|0x30
comma
l_int|0x2f
comma
l_int|0x2e
comma
l_int|0x2d
comma
l_int|0x2c
comma
l_int|0x2b
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x29
comma
l_int|0x28
comma
l_int|0x27
comma
l_int|0x26
comma
l_int|0x25
comma
l_int|0x24
comma
l_int|0x24
comma
l_int|0x23
comma
l_int|0x22
comma
l_int|0x21
comma
l_int|0x21
comma
l_int|0x20
comma
l_int|0x1f
comma
l_int|0x1e
comma
l_int|0x1e
comma
l_int|0x1d
comma
l_int|0x1c
comma
l_int|0x1c
comma
l_int|0x1b
comma
l_int|0x1a
comma
l_int|0x1a
comma
l_int|0x19
comma
l_int|0x19
comma
l_int|0x18
comma
l_int|0x18
comma
l_int|0x17
comma
l_int|0x16
comma
l_int|0x16
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x14
comma
l_int|0x14
comma
l_int|0x13
comma
l_int|0x13
comma
l_int|0x13
comma
l_int|0x12
comma
l_int|0x12
comma
l_int|0x11
comma
l_int|0x11
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|variable|expressiontab
r_static
r_int
r_char
id|expressiontab
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x7f
comma
l_int|0x6c
comma
l_int|0x62
comma
l_int|0x5a
comma
l_int|0x54
comma
l_int|0x50
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x45
comma
l_int|0x42
comma
l_int|0x40
comma
l_int|0x3d
comma
l_int|0x3b
comma
l_int|0x39
comma
l_int|0x38
comma
l_int|0x36
comma
l_int|0x34
comma
l_int|0x33
comma
l_int|0x31
comma
l_int|0x30
comma
l_int|0x2f
comma
l_int|0x2d
comma
l_int|0x2c
comma
l_int|0x2b
comma
l_int|0x2a
comma
l_int|0x29
comma
l_int|0x28
comma
l_int|0x27
comma
l_int|0x26
comma
l_int|0x25
comma
l_int|0x24
comma
l_int|0x24
comma
l_int|0x23
comma
l_int|0x22
comma
l_int|0x21
comma
l_int|0x21
comma
l_int|0x20
comma
l_int|0x1f
comma
l_int|0x1e
comma
l_int|0x1e
comma
l_int|0x1d
comma
l_int|0x1d
comma
l_int|0x1c
comma
l_int|0x1b
comma
l_int|0x1b
comma
l_int|0x1a
comma
l_int|0x1a
comma
l_int|0x19
comma
l_int|0x18
comma
l_int|0x18
comma
l_int|0x17
comma
l_int|0x17
comma
l_int|0x16
comma
l_int|0x16
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x14
comma
l_int|0x14
comma
l_int|0x13
comma
l_int|0x13
comma
l_int|0x12
comma
l_int|0x12
comma
l_int|0x11
comma
l_int|0x11
comma
l_int|0x11
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0f
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0e
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0d
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0c
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0b
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x0a
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x09
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x08
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x07
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x06
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x02
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
r_static
r_void
DECL|function|awe_calc_volume
id|awe_calc_volume
c_func
(paren
r_int
id|voice
)paren
(brace
id|voice_info
op_star
id|vp
op_assign
op_amp
id|voices
(braket
id|voice
)braket
suffix:semicolon
id|awe_voice_info
op_star
id|ap
suffix:semicolon
id|awe_chan_info
op_star
id|cp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|cinfo
suffix:semicolon
r_int
id|vol
suffix:semicolon
multiline_comment|/* search voice information */
r_if
c_cond
(paren
(paren
id|ap
op_assign
id|vp-&gt;sample
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|ap
op_assign
id|vp-&gt;sample
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;index
op_eq
l_int|0
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: set sample (%d)&bslash;n&quot;
comma
id|ap-&gt;sample
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awe_set_sample
c_func
(paren
(paren
id|awe_voice_list
op_star
)paren
id|ap
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctrls
(braket
id|AWE_MD_NEW_VOLUME_CALC
)braket
)paren
(brace
r_int
id|main_vol
op_assign
id|cp-&gt;main_vol
op_star
id|ap-&gt;amplitude
op_div
l_int|127
suffix:semicolon
id|limitvalue
c_func
(paren
id|vp-&gt;velocity
comma
l_int|0
comma
l_int|127
)paren
suffix:semicolon
id|limitvalue
c_func
(paren
id|main_vol
comma
l_int|0
comma
l_int|127
)paren
suffix:semicolon
id|limitvalue
c_func
(paren
id|cp-&gt;expression_vol
comma
l_int|0
comma
l_int|127
)paren
suffix:semicolon
id|vol
op_assign
id|voltab1
(braket
id|main_vol
)braket
op_plus
id|voltab2
(braket
id|vp-&gt;velocity
)braket
suffix:semicolon
id|vol
op_assign
(paren
id|vol
op_star
l_int|8
)paren
op_div
l_int|3
suffix:semicolon
id|vol
op_add_assign
id|ap-&gt;attenuation
suffix:semicolon
r_if
c_cond
(paren
id|cp-&gt;expression_vol
OL
l_int|127
)paren
id|vol
op_add_assign
(paren
(paren
l_int|0x100
op_minus
id|vol
)paren
op_star
id|expressiontab
(braket
id|cp-&gt;expression_vol
)braket
)paren
op_div
l_int|128
suffix:semicolon
id|vol
op_add_assign
id|atten_offset
suffix:semicolon
r_if
c_cond
(paren
id|atten_relative
)paren
id|vol
op_add_assign
id|ctrls
(braket
id|AWE_MD_ZERO_ATTEN
)braket
suffix:semicolon
id|limitvalue
c_func
(paren
id|vol
comma
l_int|0
comma
l_int|255
)paren
suffix:semicolon
id|vp-&gt;avol
op_assign
id|vol
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 0 - 127 */
id|vol
op_assign
(paren
id|vp-&gt;velocity
op_star
id|cp-&gt;main_vol
op_star
id|cp-&gt;expression_vol
)paren
op_div
(paren
l_int|127
op_star
l_int|127
)paren
suffix:semicolon
id|vol
op_assign
id|vol
op_star
id|ap-&gt;amplitude
op_div
l_int|127
suffix:semicolon
r_if
c_cond
(paren
id|vol
OL
l_int|0
)paren
id|vol
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vol
OG
l_int|127
)paren
id|vol
op_assign
l_int|127
suffix:semicolon
multiline_comment|/* calc to attenuation */
id|vol
op_assign
id|vol_table
(braket
id|vol
)braket
suffix:semicolon
id|vol
op_add_assign
(paren
r_int
)paren
id|ap-&gt;attenuation
suffix:semicolon
id|vol
op_add_assign
id|atten_offset
suffix:semicolon
r_if
c_cond
(paren
id|atten_relative
)paren
id|vol
op_add_assign
id|ctrls
(braket
id|AWE_MD_ZERO_ATTEN
)braket
suffix:semicolon
r_if
c_cond
(paren
id|vol
OG
l_int|255
)paren
id|vol
op_assign
l_int|255
suffix:semicolon
id|vp-&gt;avol
op_assign
id|vol
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cp-&gt;bank
op_ne
id|AWE_DRUM_BANK
op_logical_and
(paren
(paren
id|awe_voice_parm_block
op_star
)paren
(paren
op_amp
id|ap-&gt;parm
)paren
)paren
op_member_access_from_pointer
id|volatk
OL
l_int|0x7d
)paren
(brace
r_int
id|atten
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;velocity
OL
l_int|70
)paren
id|atten
op_assign
l_int|70
suffix:semicolon
r_else
id|atten
op_assign
id|vp-&gt;velocity
suffix:semicolon
id|vp-&gt;acutoff
op_assign
(paren
id|atten
op_star
id|ap-&gt;parm.cutoff
op_plus
l_int|0xa0
)paren
op_rshift
l_int|7
suffix:semicolon
)brace
r_else
(brace
id|vp-&gt;acutoff
op_assign
id|ap-&gt;parm.cutoff
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- voice(%d) vol=%x]&bslash;n&quot;
comma
id|voice
comma
id|vol
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* change master volume */
r_static
r_void
DECL|function|awe_change_master_volume
id|awe_change_master_volume
c_func
(paren
r_int
id|val
)paren
(brace
id|limitvalue
c_func
(paren
id|val
comma
l_int|0
comma
l_int|127
)paren
suffix:semicolon
id|atten_offset
op_assign
id|vol_table
(braket
id|val
)braket
suffix:semicolon
id|atten_relative
op_assign
id|TRUE
suffix:semicolon
id|awe_update_volume
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* update volumes of all available channels */
DECL|function|awe_update_volume
r_static
r_void
id|awe_update_volume
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
id|awe_set_voice_vol
c_func
(paren
id|i
comma
id|TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/* set sostenuto on */
DECL|function|awe_sostenuto_on
r_static
r_void
id|awe_sostenuto_on
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
r_if
c_cond
(paren
id|IS_NO_EFFECT
c_func
(paren
id|voice
)paren
op_logical_and
op_logical_neg
id|forced
)paren
r_return
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|sostenuto
op_assign
l_int|127
suffix:semicolon
)brace
multiline_comment|/* drop sustain */
DECL|function|awe_sustain_off
r_static
r_void
id|awe_sustain_off
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|state
op_eq
id|AWE_ST_SUSTAINED
)paren
(brace
id|awe_note_off
c_func
(paren
id|voice
)paren
suffix:semicolon
id|awe_fx_init
c_func
(paren
id|voices
(braket
id|voice
)braket
dot
id|ch
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|voice
comma
id|FALSE
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* terminate and initialize voice */
DECL|function|awe_terminate_and_init
r_static
r_void
id|awe_terminate_and_init
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
id|awe_terminate
c_func
(paren
id|voice
)paren
suffix:semicolon
id|awe_fx_init
c_func
(paren
id|voices
(braket
id|voice
)braket
dot
id|ch
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|voice
comma
id|TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * synth operation routines&n; */
DECL|macro|AWE_VOICE_KEY
mdefine_line|#define AWE_VOICE_KEY(v)&t;(0x8000 | (v))
DECL|macro|AWE_CHAN_KEY
mdefine_line|#define AWE_CHAN_KEY(c,n)&t;(((c) &lt;&lt; 8) | ((n) + 1))
DECL|macro|KEY_CHAN_MATCH
mdefine_line|#define KEY_CHAN_MATCH(key,c)&t;(((key) &gt;&gt; 8) == (c))
multiline_comment|/* initialize the voice */
r_static
r_void
DECL|function|awe_voice_init
id|awe_voice_init
c_func
(paren
r_int
id|voice
comma
r_int
id|init_all
)paren
(brace
id|voice_info
op_star
id|vp
op_assign
op_amp
id|voices
(braket
id|voice
)braket
suffix:semicolon
multiline_comment|/* reset voice search key */
r_if
c_cond
(paren
id|playing_mode
op_eq
id|AWE_PLAY_DIRECT
)paren
id|vp-&gt;key
op_assign
id|AWE_VOICE_KEY
c_func
(paren
id|voice
)paren
suffix:semicolon
r_else
id|vp-&gt;key
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* clear voice mapping */
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* touch the timing flag */
id|vp-&gt;time
op_assign
id|current_alloc_time
suffix:semicolon
multiline_comment|/* initialize other parameters if necessary */
r_if
c_cond
(paren
id|init_all
)paren
(brace
id|vp-&gt;note
op_assign
op_minus
l_int|1
suffix:semicolon
id|vp-&gt;velocity
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;sostenuto
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;sample
op_assign
l_int|NULL
suffix:semicolon
id|vp-&gt;cinfo
op_assign
op_amp
id|channels
(braket
id|voice
)braket
suffix:semicolon
id|vp-&gt;ch
op_assign
id|voice
suffix:semicolon
id|vp-&gt;state
op_assign
id|AWE_ST_OFF
suffix:semicolon
multiline_comment|/* emu8000 parameters */
id|vp-&gt;apitch
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;avol
op_assign
l_int|255
suffix:semicolon
id|vp-&gt;apan
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* clear effects */
DECL|function|awe_fx_init
r_static
r_void
id|awe_fx_init
c_func
(paren
r_int
id|ch
)paren
(brace
r_if
c_cond
(paren
id|SINGLE_LAYER_MODE
c_func
(paren
)paren
op_logical_and
op_logical_neg
id|ctrls
(braket
id|AWE_MD_KEEP_EFFECT
)braket
)paren
(brace
id|memset
c_func
(paren
op_amp
id|channels
(braket
id|ch
)braket
dot
id|fx
comma
l_int|0
comma
r_sizeof
(paren
id|channels
(braket
id|ch
)braket
dot
id|fx
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|channels
(braket
id|ch
)braket
dot
id|fx_layer
comma
l_int|0
comma
r_sizeof
(paren
op_amp
id|channels
(braket
id|ch
)braket
dot
id|fx_layer
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* initialize channel info */
DECL|function|awe_channel_init
r_static
r_void
id|awe_channel_init
c_func
(paren
r_int
id|ch
comma
r_int
id|init_all
)paren
(brace
id|awe_chan_info
op_star
id|cp
op_assign
op_amp
id|channels
(braket
id|ch
)braket
suffix:semicolon
id|cp-&gt;channel
op_assign
id|ch
suffix:semicolon
r_if
c_cond
(paren
id|init_all
)paren
(brace
id|cp-&gt;panning
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* zero center */
id|cp-&gt;bender_range
op_assign
l_int|200
suffix:semicolon
multiline_comment|/* sense * 100 */
id|cp-&gt;main_vol
op_assign
l_int|127
suffix:semicolon
r_if
c_cond
(paren
id|MULTI_LAYER_MODE
c_func
(paren
)paren
op_logical_and
id|IS_DRUM_CHANNEL
c_func
(paren
id|ch
)paren
)paren
(brace
id|cp-&gt;instr
op_assign
id|ctrls
(braket
id|AWE_MD_DEF_DRUM
)braket
suffix:semicolon
id|cp-&gt;bank
op_assign
id|AWE_DRUM_BANK
suffix:semicolon
)brace
r_else
(brace
id|cp-&gt;instr
op_assign
id|ctrls
(braket
id|AWE_MD_DEF_PRESET
)braket
suffix:semicolon
id|cp-&gt;bank
op_assign
id|ctrls
(braket
id|AWE_MD_DEF_BANK
)braket
suffix:semicolon
)brace
)brace
id|cp-&gt;bender
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* zero tune skew */
id|cp-&gt;expression_vol
op_assign
l_int|127
suffix:semicolon
id|cp-&gt;chan_press
op_assign
l_int|0
suffix:semicolon
id|cp-&gt;sustained
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ctrls
(braket
id|AWE_MD_KEEP_EFFECT
)braket
)paren
(brace
id|memset
c_func
(paren
op_amp
id|cp-&gt;fx
comma
l_int|0
comma
r_sizeof
(paren
id|cp-&gt;fx
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cp-&gt;fx_layer
comma
l_int|0
comma
r_sizeof
(paren
id|cp-&gt;fx_layer
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* change the voice parameters; voice = channel */
DECL|function|awe_voice_change
r_static
r_void
id|awe_voice_change
c_func
(paren
r_int
id|voice
comma
id|fx_affect_func
id|func
)paren
(brace
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|playing_mode
)paren
(brace
r_case
id|AWE_PLAY_DIRECT
suffix:colon
id|func
c_func
(paren
id|voice
comma
id|FALSE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_PLAY_INDIRECT
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|key
op_eq
id|AWE_VOICE_KEY
c_func
(paren
id|voice
)paren
)paren
id|func
c_func
(paren
id|i
comma
id|FALSE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|KEY_CHAN_MATCH
c_func
(paren
id|voices
(braket
id|i
)braket
dot
id|key
comma
id|voice
)paren
)paren
id|func
c_func
(paren
id|i
comma
id|FALSE
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * device open / close&n; */
multiline_comment|/* open device:&n; *   reset status of all voices, and clear sample position flag&n; */
r_static
r_int
DECL|function|awe_open
id|awe_open
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
(brace
r_if
c_cond
(paren
id|awe_busy
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|awe_busy
op_assign
id|TRUE
suffix:semicolon
multiline_comment|/* set default mode */
id|awe_init_ctrl_parms
c_func
(paren
id|FALSE
)paren
suffix:semicolon
id|atten_relative
op_assign
id|TRUE
suffix:semicolon
id|atten_offset
op_assign
l_int|0
suffix:semicolon
id|drum_flags
op_assign
id|DEFAULT_DRUM_FLAGS
suffix:semicolon
id|playing_mode
op_assign
id|AWE_PLAY_INDIRECT
suffix:semicolon
multiline_comment|/* reset voices &amp; channels */
id|awe_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|patch_opened
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* close device:&n; *   reset all voices again (terminate sounds)&n; */
r_static
r_void
DECL|function|awe_close
id|awe_close
c_func
(paren
r_int
id|dev
)paren
(brace
id|awe_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|awe_busy
op_assign
id|FALSE
suffix:semicolon
)brace
multiline_comment|/* set miscellaneous mode parameters&n; */
r_static
r_void
DECL|function|awe_init_ctrl_parms
id|awe_init_ctrl_parms
c_func
(paren
r_int
id|init_all
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MD_END
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|init_all
op_logical_or
id|ctrl_parms
(braket
id|i
)braket
dot
id|init_each_time
)paren
id|ctrls
(braket
id|i
)braket
op_assign
id|ctrl_parms
(braket
id|i
)braket
dot
id|value
suffix:semicolon
)brace
)brace
multiline_comment|/* sequencer I/O control:&n; */
r_static
r_int
DECL|function|awe_ioctl
id|awe_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDCTL_SYNTH_INFO
suffix:colon
r_if
c_cond
(paren
id|playing_mode
op_eq
id|AWE_PLAY_DIRECT
)paren
id|awe_info.nr_voices
op_assign
id|awe_max_voices
suffix:semicolon
r_else
id|awe_info.nr_voices
op_assign
id|AWE_MAX_CHANNELS
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
op_amp
id|awe_info
comma
r_sizeof
(paren
id|awe_info
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_SEQ_RESETSAMPLES
suffix:colon
id|awe_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|awe_reset_samples
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_SEQ_PERCMODE
suffix:colon
multiline_comment|/* what&squot;s this? */
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_SYNTH_MEMAVL
suffix:colon
r_return
id|memsize
op_minus
id|awe_free_mem_ptr
c_func
(paren
)paren
op_star
l_int|2
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32: unsupported ioctl %d&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|function|voice_in_range
r_static
r_int
id|voice_in_range
c_func
(paren
r_int
id|voice
)paren
(brace
r_if
c_cond
(paren
id|playing_mode
op_eq
id|AWE_PLAY_DIRECT
)paren
(brace
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|awe_max_voices
)paren
r_return
id|FALSE
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|AWE_MAX_CHANNELS
)paren
r_return
id|FALSE
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
DECL|function|release_voice
r_static
r_void
id|release_voice
c_func
(paren
r_int
id|voice
comma
r_int
id|do_sustain
)paren
(brace
r_if
c_cond
(paren
id|IS_NO_SOUND
c_func
(paren
id|voice
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|do_sustain
op_logical_and
(paren
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;sustained
op_eq
l_int|127
op_logical_or
id|voices
(braket
id|voice
)braket
dot
id|sostenuto
op_eq
l_int|127
)paren
)paren
id|voices
(braket
id|voice
)braket
dot
id|state
op_assign
id|AWE_ST_SUSTAINED
suffix:semicolon
r_else
(brace
id|awe_note_off
c_func
(paren
id|voice
)paren
suffix:semicolon
id|awe_fx_init
c_func
(paren
id|voices
(braket
id|voice
)braket
dot
id|ch
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|voice
comma
id|FALSE
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* release all notes */
DECL|function|awe_note_off_all
r_static
r_void
id|awe_note_off_all
c_func
(paren
r_int
id|do_sustain
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
id|release_voice
c_func
(paren
id|i
comma
id|do_sustain
)paren
suffix:semicolon
)brace
multiline_comment|/* kill a voice:&n; *   not terminate, just release the voice.&n; */
r_static
r_int
DECL|function|awe_kill_note
id|awe_kill_note
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|note
comma
r_int
id|velocity
)paren
(brace
r_int
id|i
comma
id|v2
comma
id|key
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [off(%d) nt=%d vl=%d]&bslash;n&quot;
comma
id|voice
comma
id|note
comma
id|velocity
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice_in_range
c_func
(paren
id|voice
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|playing_mode
)paren
(brace
r_case
id|AWE_PLAY_DIRECT
suffix:colon
r_case
id|AWE_PLAY_INDIRECT
suffix:colon
id|key
op_assign
id|AWE_VOICE_KEY
c_func
(paren
id|voice
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_PLAY_MULTI2
suffix:colon
id|v2
op_assign
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_rshift
l_int|8
suffix:semicolon
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_assign
l_int|0
suffix:semicolon
id|voice
op_assign
id|v2
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|AWE_MAX_CHANNELS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* continue to below */
r_default
suffix:colon
id|key
op_assign
id|AWE_CHAN_KEY
c_func
(paren
id|voice
comma
id|note
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|key
op_eq
id|key
)paren
id|release_voice
c_func
(paren
id|i
comma
id|TRUE
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|start_or_volume_change
r_static
r_void
id|start_or_volume_change
c_func
(paren
r_int
id|voice
comma
r_int
id|velocity
)paren
(brace
id|voices
(braket
id|voice
)braket
dot
id|velocity
op_assign
id|velocity
suffix:semicolon
id|awe_calc_volume
c_func
(paren
id|voice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|state
op_eq
id|AWE_ST_STANDBY
)paren
id|awe_note_on
c_func
(paren
id|voice
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|state
op_eq
id|AWE_ST_ON
)paren
id|awe_set_volume
c_func
(paren
id|voice
comma
id|FALSE
)paren
suffix:semicolon
)brace
DECL|function|set_and_start_voice
r_static
r_void
id|set_and_start_voice
c_func
(paren
r_int
id|voice
comma
r_int
id|state
)paren
(brace
multiline_comment|/* calculate pitch &amp; volume parameters */
id|voices
(braket
id|voice
)braket
dot
id|state
op_assign
id|state
suffix:semicolon
id|awe_calc_pitch
c_func
(paren
id|voice
)paren
suffix:semicolon
id|awe_calc_volume
c_func
(paren
id|voice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
id|AWE_ST_ON
)paren
id|awe_note_on
c_func
(paren
id|voice
)paren
suffix:semicolon
)brace
multiline_comment|/* start a voice:&n; *   if note is 255, identical with aftertouch function.&n; *   Otherwise, start a voice with specified not and volume.&n; */
r_static
r_int
DECL|function|awe_start_note
id|awe_start_note
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|note
comma
r_int
id|velocity
)paren
(brace
r_int
id|i
comma
id|key
comma
id|state
comma
id|volonly
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [on(%d) nt=%d vl=%d]&bslash;n&quot;
comma
id|voice
comma
id|note
comma
id|velocity
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice_in_range
c_func
(paren
id|voice
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|velocity
op_eq
l_int|0
)paren
id|state
op_assign
id|AWE_ST_STANDBY
suffix:semicolon
multiline_comment|/* stand by for playing */
r_else
id|state
op_assign
id|AWE_ST_ON
suffix:semicolon
multiline_comment|/* really play */
id|volonly
op_assign
id|FALSE
suffix:semicolon
r_switch
c_cond
(paren
id|playing_mode
)paren
(brace
r_case
id|AWE_PLAY_DIRECT
suffix:colon
r_case
id|AWE_PLAY_INDIRECT
suffix:colon
id|key
op_assign
id|AWE_VOICE_KEY
c_func
(paren
id|voice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|note
op_eq
l_int|255
)paren
id|volonly
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_PLAY_MULTI2
suffix:colon
id|voice
op_assign
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|AWE_MAX_CHANNELS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* continue to below */
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|note
op_ge
l_int|128
)paren
(brace
multiline_comment|/* key volume mode */
id|note
op_sub_assign
l_int|128
suffix:semicolon
id|volonly
op_assign
id|TRUE
suffix:semicolon
)brace
id|key
op_assign
id|AWE_CHAN_KEY
c_func
(paren
id|voice
comma
id|note
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* dynamic volume change */
r_if
c_cond
(paren
id|volonly
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|key
op_eq
id|key
)paren
id|start_or_volume_change
c_func
(paren
id|i
comma
id|velocity
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* if the same note still playing, stop it */
r_if
c_cond
(paren
id|playing_mode
op_ne
id|AWE_PLAY_DIRECT
op_logical_or
id|ctrls
(braket
id|AWE_MD_EXCLUSIVE_SOUND
)braket
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|key
op_eq
id|key
)paren
(brace
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|state
op_eq
id|AWE_ST_ON
)paren
(brace
id|awe_note_off
c_func
(paren
id|i
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|i
comma
id|FALSE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|state
op_eq
id|AWE_ST_STANDBY
)paren
id|awe_voice_init
c_func
(paren
id|i
comma
id|TRUE
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* allocate voices */
r_if
c_cond
(paren
id|playing_mode
op_eq
id|AWE_PLAY_DIRECT
)paren
id|awe_alloc_one_voice
c_func
(paren
id|voice
comma
id|note
comma
id|velocity
)paren
suffix:semicolon
r_else
id|awe_alloc_multi_voices
c_func
(paren
id|voice
comma
id|note
comma
id|velocity
comma
id|key
)paren
suffix:semicolon
multiline_comment|/* turn off other voices exlusively (for drums) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|key
op_eq
id|key
)paren
id|awe_exclusive_off
c_func
(paren
id|i
)paren
suffix:semicolon
multiline_comment|/* set up pitch and volume parameters */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|key
op_eq
id|key
op_logical_and
id|voices
(braket
id|i
)braket
dot
id|state
op_eq
id|AWE_ST_OFF
)paren
id|set_and_start_voice
c_func
(paren
id|i
comma
id|state
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* calculate hash key */
r_static
r_int
DECL|function|awe_search_key
id|awe_search_key
c_func
(paren
r_int
id|bank
comma
r_int
id|preset
comma
r_int
id|note
)paren
(brace
r_int
r_int
id|key
suffix:semicolon
macro_line|#if 1 /* new hash table */
r_if
c_cond
(paren
id|bank
op_eq
id|AWE_DRUM_BANK
)paren
id|key
op_assign
id|preset
op_plus
id|note
op_plus
l_int|128
suffix:semicolon
r_else
id|key
op_assign
id|bank
op_plus
id|preset
suffix:semicolon
macro_line|#else
id|key
op_assign
id|preset
suffix:semicolon
macro_line|#endif
id|key
op_mod_assign
id|AWE_MAX_PRESETS
suffix:semicolon
r_return
(paren
r_int
)paren
id|key
suffix:semicolon
)brace
multiline_comment|/* search instrument from hash table */
r_static
id|awe_voice_list
op_star
DECL|function|awe_search_instr
id|awe_search_instr
c_func
(paren
r_int
id|bank
comma
r_int
id|preset
comma
r_int
id|note
)paren
(brace
id|awe_voice_list
op_star
id|p
suffix:semicolon
r_int
id|key
comma
id|key2
suffix:semicolon
id|key
op_assign
id|awe_search_key
c_func
(paren
id|bank
comma
id|preset
comma
id|note
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|preset_table
(braket
id|key
)braket
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next_bank
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;instr
op_eq
id|preset
op_logical_and
id|p-&gt;bank
op_eq
id|bank
)paren
r_return
id|p
suffix:semicolon
)brace
id|key2
op_assign
id|awe_search_key
c_func
(paren
id|bank
comma
id|preset
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* search default */
r_if
c_cond
(paren
id|key
op_eq
id|key2
)paren
r_return
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|preset_table
(braket
id|key2
)braket
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next_bank
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;instr
op_eq
id|preset
op_logical_and
id|p-&gt;bank
op_eq
id|bank
)paren
r_return
id|p
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* assign the instrument to a voice */
r_static
r_int
DECL|function|awe_set_instr_2
id|awe_set_instr_2
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|instr_no
)paren
(brace
r_if
c_cond
(paren
id|playing_mode
op_eq
id|AWE_PLAY_MULTI2
)paren
(brace
id|voice
op_assign
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|AWE_MAX_CHANNELS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|awe_set_instr
c_func
(paren
id|dev
comma
id|voice
comma
id|instr_no
)paren
suffix:semicolon
)brace
multiline_comment|/* assign the instrument to a channel; voice is the channel number */
r_static
r_int
DECL|function|awe_set_instr
id|awe_set_instr
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|instr_no
)paren
(brace
id|awe_chan_info
op_star
id|cinfo
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice_in_range
c_func
(paren
id|voice
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|instr_no
OL
l_int|0
op_logical_or
id|instr_no
op_ge
id|AWE_MAX_PRESETS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|cinfo
op_assign
op_amp
id|channels
(braket
id|voice
)braket
suffix:semicolon
id|cinfo-&gt;instr
op_assign
id|instr_no
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [program(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|instr_no
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* reset all voices; terminate sounds and initialize parameters */
r_static
r_void
DECL|function|awe_reset
id|awe_reset
c_func
(paren
r_int
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
id|current_alloc_time
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* don&squot;t turn off voice 31 and 32.  they are used also for FM voices */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
(brace
id|awe_terminate
c_func
(paren
id|i
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|i
comma
id|TRUE
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
id|awe_channel_init
c_func
(paren
id|i
comma
id|TRUE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|awe_operations.chn_info
(braket
id|i
)braket
dot
id|controllers
(braket
id|CTL_MAIN_VOLUME
)braket
op_assign
l_int|127
suffix:semicolon
id|awe_operations.chn_info
(braket
id|i
)braket
dot
id|controllers
(braket
id|CTL_EXPRESSION
)braket
op_assign
l_int|127
suffix:semicolon
)brace
id|awe_init_fm
c_func
(paren
)paren
suffix:semicolon
id|awe_tweak
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* hardware specific control:&n; *   GUS specific and AWE32 specific controls are available.&n; */
r_static
r_void
DECL|function|awe_hw_control
id|awe_hw_control
c_func
(paren
r_int
id|dev
comma
r_int
r_char
op_star
id|event
)paren
(brace
r_int
id|cmd
op_assign
id|event
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_amp
id|_AWE_MODE_FLAG
)paren
id|awe_hw_awe_control
c_func
(paren
id|dev
comma
id|cmd
op_amp
id|_AWE_MODE_VALUE_MASK
comma
id|event
)paren
suffix:semicolon
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
r_else
id|awe_hw_gus_control
c_func
(paren
id|dev
comma
id|cmd
op_amp
id|_AWE_MODE_VALUE_MASK
comma
id|event
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
multiline_comment|/* GUS compatible controls */
r_static
r_void
DECL|function|awe_hw_gus_control
id|awe_hw_gus_control
c_func
(paren
r_int
id|dev
comma
r_int
id|cmd
comma
r_int
r_char
op_star
id|event
)paren
(brace
r_int
id|voice
comma
id|i
comma
id|key
suffix:semicolon
r_int
r_int
id|p1
suffix:semicolon
r_int
id|p2
suffix:semicolon
r_int
id|plong
suffix:semicolon
r_if
c_cond
(paren
id|MULTI_LAYER_MODE
c_func
(paren
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|_GUS_NUMVOICES
)paren
r_return
suffix:semicolon
id|voice
op_assign
id|event
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice_in_range
c_func
(paren
id|voice
)paren
)paren
r_return
suffix:semicolon
id|p1
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|4
)braket
suffix:semicolon
id|p2
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|6
)braket
suffix:semicolon
id|plong
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|4
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|_GUS_VOICESAMPLE
suffix:colon
id|awe_set_instr
c_func
(paren
id|dev
comma
id|voice
comma
id|p1
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|_GUS_VOICEBALA
suffix:colon
multiline_comment|/* 0 to 15 --&gt; -128 to 127 */
id|awe_panning
c_func
(paren
id|dev
comma
id|voice
comma
(paren
(paren
r_int
)paren
id|p1
op_lshift
l_int|4
)paren
op_minus
l_int|128
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|_GUS_VOICEVOL
suffix:colon
r_case
id|_GUS_VOICEVOL2
suffix:colon
multiline_comment|/* not supported yet */
r_return
suffix:semicolon
r_case
id|_GUS_RAMPRANGE
suffix:colon
r_case
id|_GUS_RAMPRATE
suffix:colon
r_case
id|_GUS_RAMPMODE
suffix:colon
r_case
id|_GUS_RAMPON
suffix:colon
r_case
id|_GUS_RAMPOFF
suffix:colon
multiline_comment|/* volume ramping not supported */
r_return
suffix:semicolon
r_case
id|_GUS_VOLUME_SCALE
suffix:colon
r_return
suffix:semicolon
r_case
id|_GUS_VOICE_POS
suffix:colon
id|FX_SET
c_func
(paren
op_amp
id|channels
(braket
id|voice
)braket
dot
id|fx
comma
id|AWE_FX_SAMPLE_START
comma
(paren
r_int
)paren
(paren
id|plong
op_amp
l_int|0x7fff
)paren
)paren
suffix:semicolon
id|FX_SET
c_func
(paren
op_amp
id|channels
(braket
id|voice
)braket
dot
id|fx
comma
id|AWE_FX_COARSE_SAMPLE_START
comma
(paren
id|plong
op_rshift
l_int|15
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|key
op_assign
id|AWE_VOICE_KEY
c_func
(paren
id|voice
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|key
op_eq
id|key
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|_GUS_VOICEON
suffix:colon
id|awe_note_on
c_func
(paren
id|i
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_GUS_VOICEOFF
suffix:colon
id|awe_terminate
c_func
(paren
id|i
)paren
suffix:semicolon
id|awe_fx_init
c_func
(paren
id|voices
(braket
id|i
)braket
dot
id|ch
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|i
comma
id|TRUE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_GUS_VOICEFADE
suffix:colon
id|awe_note_off
c_func
(paren
id|i
)paren
suffix:semicolon
id|awe_fx_init
c_func
(paren
id|voices
(braket
id|i
)braket
dot
id|ch
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|i
comma
id|FALSE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_GUS_VOICEFREQ
suffix:colon
id|awe_calc_pitch_from_freq
c_func
(paren
id|i
comma
id|plong
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
macro_line|#endif /* gus_compat */
multiline_comment|/* AWE32 specific controls */
r_static
r_void
DECL|function|awe_hw_awe_control
id|awe_hw_awe_control
c_func
(paren
r_int
id|dev
comma
r_int
id|cmd
comma
r_int
r_char
op_star
id|event
)paren
(brace
r_int
id|voice
suffix:semicolon
r_int
r_int
id|p1
suffix:semicolon
r_int
id|p2
suffix:semicolon
r_int
id|i
suffix:semicolon
id|voice
op_assign
id|event
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice_in_range
c_func
(paren
id|voice
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|playing_mode
op_eq
id|AWE_PLAY_MULTI2
)paren
(brace
id|voice
op_assign
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|AWE_MAX_CHANNELS
)paren
r_return
suffix:semicolon
)brace
id|p1
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|4
)braket
suffix:semicolon
id|p2
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|6
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|_AWE_DEBUG_MODE
suffix:colon
id|ctrls
(braket
id|AWE_MD_DEBUG_MODE
)braket
op_assign
id|p1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;AWE32: debug mode = %d&bslash;n&quot;
comma
id|ctrls
(braket
id|AWE_MD_DEBUG_MODE
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_REVERB_MODE
suffix:colon
id|ctrls
(braket
id|AWE_MD_REVERB_MODE
)braket
op_assign
id|p1
suffix:semicolon
id|awe_update_reverb_mode
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_CHORUS_MODE
suffix:colon
id|ctrls
(braket
id|AWE_MD_CHORUS_MODE
)braket
op_assign
id|p1
suffix:semicolon
id|awe_update_chorus_mode
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_REMOVE_LAST_SAMPLES
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: remove last samples&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|awe_reset
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|locked_sf_id
OG
l_int|0
)paren
id|awe_remove_samples
c_func
(paren
id|locked_sf_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_INITIALIZE_CHIP
suffix:colon
id|awe_initialize
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_SEND_EFFECT
suffix:colon
id|i
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|p1
op_ge
l_int|0x100
)paren
(brace
id|i
op_assign
(paren
id|p1
op_rshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
op_logical_or
id|i
op_ge
id|MAX_LAYERS
)paren
r_break
suffix:semicolon
)brace
id|awe_send_effect
c_func
(paren
id|voice
comma
id|i
comma
id|p1
comma
id|p2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_RESET_CHANNEL
suffix:colon
id|awe_channel_init
c_func
(paren
id|voice
comma
op_logical_neg
id|p1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_TERMINATE_ALL
suffix:colon
id|awe_reset
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_TERMINATE_CHANNEL
suffix:colon
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_terminate_and_init
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_RELEASE_ALL
suffix:colon
id|awe_note_off_all
c_func
(paren
id|FALSE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_NOTEOFF_ALL
suffix:colon
id|awe_note_off_all
c_func
(paren
id|TRUE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_INITIAL_VOLUME
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: init attenuation %d&bslash;n&quot;
comma
id|p1
)paren
)paren
suffix:semicolon
id|atten_relative
op_assign
(paren
r_char
)paren
id|p2
suffix:semicolon
id|atten_offset
op_assign
(paren
r_int
)paren
id|p1
suffix:semicolon
id|awe_update_volume
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_CHN_PRESSURE
suffix:colon
id|channels
(braket
id|voice
)braket
dot
id|chan_press
op_assign
id|p1
suffix:semicolon
id|awe_modwheel_change
c_func
(paren
id|voice
comma
id|p1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_CHANNEL_MODE
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: channel mode = %d&bslash;n&quot;
comma
id|p1
)paren
)paren
suffix:semicolon
id|playing_mode
op_assign
id|p1
suffix:semicolon
id|awe_reset
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_DRUM_CHANNELS
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: drum flags = %x&bslash;n&quot;
comma
id|p1
)paren
)paren
suffix:semicolon
id|drum_flags
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|4
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_MISC_MODE
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: ctrl parms = %d %d&bslash;n&quot;
comma
id|p1
comma
id|p2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p1
OG
id|AWE_MD_VERSION
op_logical_and
id|p1
OL
id|AWE_MD_END
)paren
(brace
id|ctrls
(braket
id|p1
)braket
op_assign
id|p2
suffix:semicolon
r_if
c_cond
(paren
id|ctrl_parms
(braket
id|p1
)braket
dot
id|update
)paren
id|ctrl_parms
(braket
id|p1
)braket
dot
id|update
c_func
(paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_AWE_EQUALIZER
suffix:colon
id|ctrls
(braket
id|AWE_MD_BASS_LEVEL
)braket
op_assign
id|p1
suffix:semicolon
id|ctrls
(braket
id|AWE_MD_TREBLE_LEVEL
)braket
op_assign
id|p2
suffix:semicolon
id|awe_update_equalizer
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: hw control cmd=%d voice=%d&bslash;n&quot;
comma
id|cmd
comma
id|voice
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* change effects */
r_static
r_void
DECL|function|awe_send_effect
id|awe_send_effect
c_func
(paren
r_int
id|voice
comma
r_int
id|layer
comma
r_int
id|type
comma
r_int
id|val
)paren
(brace
id|awe_chan_info
op_star
id|cinfo
suffix:semicolon
id|FX_Rec
op_star
id|fx
suffix:semicolon
r_int
id|mode
suffix:semicolon
id|cinfo
op_assign
op_amp
id|channels
(braket
id|voice
)braket
suffix:semicolon
r_if
c_cond
(paren
id|layer
op_ge
l_int|0
op_logical_and
id|layer
OL
id|MAX_LAYERS
)paren
id|fx
op_assign
op_amp
id|cinfo-&gt;fx_layer
(braket
id|layer
)braket
suffix:semicolon
r_else
id|fx
op_assign
op_amp
id|cinfo-&gt;fx
suffix:semicolon
r_if
c_cond
(paren
id|type
op_amp
l_int|0x40
)paren
id|mode
op_assign
id|FX_FLAG_OFF
suffix:semicolon
r_else
r_if
c_cond
(paren
id|type
op_amp
l_int|0x80
)paren
id|mode
op_assign
id|FX_FLAG_ADD
suffix:semicolon
r_else
id|mode
op_assign
id|FX_FLAG_SET
suffix:semicolon
id|type
op_and_assign
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ge
l_int|0
op_logical_and
id|type
OL
id|AWE_FX_END
)paren
(brace
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: effects (%d) %d %d&bslash;n&quot;
comma
id|voice
comma
id|type
comma
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|FX_FLAG_SET
)paren
id|FX_SET
c_func
(paren
id|fx
comma
id|type
comma
id|val
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|mode
op_eq
id|FX_FLAG_ADD
)paren
id|FX_ADD
c_func
(paren
id|fx
comma
id|type
comma
id|val
)paren
suffix:semicolon
r_else
id|FX_UNSET
c_func
(paren
id|fx
comma
id|type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_ne
id|FX_FLAG_OFF
op_logical_and
id|parm_defs
(braket
id|type
)braket
dot
id|realtime
)paren
(brace
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: fx_realtime (%d)&bslash;n&quot;
comma
id|voice
)paren
)paren
suffix:semicolon
id|awe_voice_change
c_func
(paren
id|voice
comma
id|parm_defs
(braket
id|type
)braket
dot
id|realtime
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* change modulation wheel; voice is already mapped on multi2 mode */
r_static
r_void
DECL|function|awe_modwheel_change
id|awe_modwheel_change
c_func
(paren
r_int
id|voice
comma
r_int
id|value
)paren
(brace
r_int
id|i
suffix:semicolon
id|awe_chan_info
op_star
id|cinfo
suffix:semicolon
id|cinfo
op_assign
op_amp
id|channels
(braket
id|voice
)braket
suffix:semicolon
id|i
op_assign
id|value
op_star
id|ctrls
(braket
id|AWE_MD_MOD_SENSE
)braket
op_div
l_int|1200
suffix:semicolon
id|FX_ADD
c_func
(paren
op_amp
id|cinfo-&gt;fx
comma
id|AWE_FX_LFO1_PITCH
comma
id|i
)paren
suffix:semicolon
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_fx_fmmod
)paren
suffix:semicolon
id|FX_ADD
c_func
(paren
op_amp
id|cinfo-&gt;fx
comma
id|AWE_FX_LFO2_PITCH
comma
id|i
)paren
suffix:semicolon
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_fx_fm2frq2
)paren
suffix:semicolon
)brace
multiline_comment|/* voice pressure change */
r_static
r_void
DECL|function|awe_aftertouch
id|awe_aftertouch
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|pressure
)paren
(brace
r_int
id|note
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [after(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|pressure
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice_in_range
c_func
(paren
id|voice
)paren
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|playing_mode
)paren
(brace
r_case
id|AWE_PLAY_DIRECT
suffix:colon
r_case
id|AWE_PLAY_INDIRECT
suffix:colon
id|awe_start_note
c_func
(paren
id|dev
comma
id|voice
comma
l_int|255
comma
id|pressure
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_PLAY_MULTI2
suffix:colon
id|note
op_assign
(paren
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_amp
l_int|0xff
)paren
op_minus
l_int|1
suffix:semicolon
id|awe_key_pressure
c_func
(paren
id|dev
comma
id|voice
comma
id|note
op_plus
l_int|0x80
comma
id|pressure
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* voice control change */
r_static
r_void
DECL|function|awe_controller
id|awe_controller
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|ctrl_num
comma
r_int
id|value
)paren
(brace
id|awe_chan_info
op_star
id|cinfo
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice_in_range
c_func
(paren
id|voice
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|playing_mode
op_eq
id|AWE_PLAY_MULTI2
)paren
(brace
id|voice
op_assign
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|AWE_MAX_CHANNELS
)paren
r_return
suffix:semicolon
)brace
id|cinfo
op_assign
op_amp
id|channels
(braket
id|voice
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|ctrl_num
)paren
(brace
r_case
id|CTL_BANK_SELECT
suffix:colon
multiline_comment|/* MIDI control #0 */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [bank(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|MULTI_LAYER_MODE
c_func
(paren
)paren
op_logical_and
id|IS_DRUM_CHANNEL
c_func
(paren
id|voice
)paren
op_logical_and
op_logical_neg
id|ctrls
(braket
id|AWE_MD_TOGGLE_DRUM_BANK
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|value
template_param
l_int|255
)paren
r_break
suffix:semicolon
id|cinfo-&gt;bank
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|cinfo-&gt;bank
op_eq
id|AWE_DRUM_BANK
)paren
id|DRUM_CHANNEL_ON
c_func
(paren
id|cinfo-&gt;channel
)paren
suffix:semicolon
r_else
id|DRUM_CHANNEL_OFF
c_func
(paren
id|cinfo-&gt;channel
)paren
suffix:semicolon
id|awe_set_instr
c_func
(paren
id|dev
comma
id|voice
comma
id|cinfo-&gt;instr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_MODWHEEL
suffix:colon
multiline_comment|/* MIDI control #1 */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [modwheel(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
id|awe_modwheel_change
c_func
(paren
id|voice
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTRL_PITCH_BENDER
suffix:colon
multiline_comment|/* SEQ1 V2 contorl */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [bend(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* zero centered */
id|cinfo-&gt;bender
op_assign
id|value
suffix:semicolon
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_set_voice_pitch
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTRL_PITCH_BENDER_RANGE
suffix:colon
multiline_comment|/* SEQ1 V2 control */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [range(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* value = sense x 100 */
id|cinfo-&gt;bender_range
op_assign
id|value
suffix:semicolon
multiline_comment|/* no audible pitch change yet.. */
r_break
suffix:semicolon
r_case
id|CTL_EXPRESSION
suffix:colon
multiline_comment|/* MIDI control #11 */
r_if
c_cond
(paren
id|SINGLE_LAYER_MODE
c_func
(paren
)paren
)paren
id|value
op_div_assign
l_int|128
suffix:semicolon
r_case
id|CTRL_EXPRESSION
suffix:colon
multiline_comment|/* SEQ1 V2 control */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [expr(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* 0 - 127 */
id|cinfo-&gt;expression_vol
op_assign
id|value
suffix:semicolon
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_set_voice_vol
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_PAN
suffix:colon
multiline_comment|/* MIDI control #10 */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [pan(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* (0-127) -&gt; signed 8bit */
id|cinfo-&gt;panning
op_assign
id|value
op_star
l_int|2
op_minus
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|ctrls
(braket
id|AWE_MD_REALTIME_PAN
)braket
)paren
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_set_pan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_MAIN_VOLUME
suffix:colon
multiline_comment|/* MIDI control #7 */
r_if
c_cond
(paren
id|SINGLE_LAYER_MODE
c_func
(paren
)paren
)paren
id|value
op_assign
(paren
id|value
op_star
l_int|100
)paren
op_div
l_int|16383
suffix:semicolon
r_case
id|CTRL_MAIN_VOLUME
suffix:colon
multiline_comment|/* SEQ1 V2 control */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [mainvol(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* 0 - 127 */
id|cinfo-&gt;main_vol
op_assign
id|value
suffix:semicolon
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_set_voice_vol
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_EXT_EFF_DEPTH
suffix:colon
multiline_comment|/* reverb effects: 0-127 */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [reverb(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
id|FX_SET
c_func
(paren
op_amp
id|cinfo-&gt;fx
comma
id|AWE_FX_REVERB
comma
id|value
op_star
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_CHORUS_DEPTH
suffix:colon
multiline_comment|/* chorus effects: 0-127 */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [chorus(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
id|FX_SET
c_func
(paren
op_amp
id|cinfo-&gt;fx
comma
id|AWE_FX_CHORUS
comma
id|value
op_star
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|120
suffix:colon
multiline_comment|/* all sounds off */
id|awe_note_off_all
c_func
(paren
id|FALSE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|123
suffix:colon
multiline_comment|/* all notes off */
id|awe_note_off_all
c_func
(paren
id|TRUE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_SUSTAIN
suffix:colon
multiline_comment|/* MIDI control #64 */
id|cinfo-&gt;sustained
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|127
)paren
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_sustain_off
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_SOSTENUTO
suffix:colon
multiline_comment|/* MIDI control #66 */
r_if
c_cond
(paren
id|value
op_eq
l_int|127
)paren
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_sostenuto_on
)paren
suffix:semicolon
r_else
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_sustain_off
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [control(%d) ctrl=%d val=%d]&bslash;n&quot;
comma
id|voice
comma
id|ctrl_num
comma
id|value
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* voice pan change (value = -128 - 127) */
r_static
r_void
DECL|function|awe_panning
id|awe_panning
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|value
)paren
(brace
id|awe_chan_info
op_star
id|cinfo
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice_in_range
c_func
(paren
id|voice
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|playing_mode
op_eq
id|AWE_PLAY_MULTI2
)paren
(brace
id|voice
op_assign
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|AWE_MAX_CHANNELS
)paren
r_return
suffix:semicolon
)brace
id|cinfo
op_assign
op_amp
id|channels
(braket
id|voice
)braket
suffix:semicolon
id|cinfo-&gt;panning
op_assign
id|value
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [pan(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|cinfo-&gt;panning
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctrls
(braket
id|AWE_MD_REALTIME_PAN
)braket
)paren
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_set_pan
)paren
suffix:semicolon
)brace
multiline_comment|/* volume mode change */
r_static
r_void
DECL|function|awe_volume_method
id|awe_volume_method
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
(brace
multiline_comment|/* not impremented */
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [volmethod mode=%d]&bslash;n&quot;
comma
id|mode
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* pitch wheel change: 0-16384 */
r_static
r_void
DECL|function|awe_bender
id|awe_bender
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|value
)paren
(brace
id|awe_chan_info
op_star
id|cinfo
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice_in_range
c_func
(paren
id|voice
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|playing_mode
op_eq
id|AWE_PLAY_MULTI2
)paren
(brace
id|voice
op_assign
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|AWE_MAX_CHANNELS
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* convert to zero centered value */
id|cinfo
op_assign
op_amp
id|channels
(braket
id|voice
)braket
suffix:semicolon
id|cinfo-&gt;bender
op_assign
id|value
op_minus
l_int|8192
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [bend(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|cinfo-&gt;bender
)paren
)paren
suffix:semicolon
id|awe_voice_change
c_func
(paren
id|voice
comma
id|awe_set_voice_pitch
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * load a sound patch:&n; *   three types of patches are accepted: AWE, GUS, and SYSEX.&n; */
r_static
r_int
DECL|function|awe_load_patch
id|awe_load_patch
c_func
(paren
r_int
id|dev
comma
r_int
id|format
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|offs
comma
r_int
id|count
comma
r_int
id|pmgr_flag
)paren
(brace
id|awe_patch_info
id|patch
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
r_if
c_cond
(paren
id|format
op_eq
id|GUS_PATCH
)paren
(brace
r_return
id|awe_load_guspatch
c_func
(paren
id|addr
comma
id|offs
comma
id|count
comma
id|pmgr_flag
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|format
op_eq
id|SYSEX_PATCH
)paren
(brace
multiline_comment|/* no system exclusive message supported yet */
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|format
op_ne
id|AWE_PATCH
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: Invalid patch format (key) 0x%x&bslash;n&quot;
comma
id|format
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OL
id|AWE_PATCH_INFO_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: Patch header too short&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
(paren
r_char
op_star
)paren
op_amp
id|patch
)paren
op_plus
id|offs
comma
id|addr
op_plus
id|offs
comma
id|AWE_PATCH_INFO_SIZE
op_minus
id|offs
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|count
op_sub_assign
id|AWE_PATCH_INFO_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|patch.len
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32: sample: Patch record too short (%d&lt;%d)&bslash;n&quot;
comma
id|count
comma
id|patch.len
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|patch.type
)paren
(brace
r_case
id|AWE_LOAD_INFO
suffix:colon
id|rc
op_assign
id|awe_load_info
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_LOAD_DATA
suffix:colon
id|rc
op_assign
id|awe_load_data
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_OPEN_PATCH
suffix:colon
id|rc
op_assign
id|awe_open_patch
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_CLOSE_PATCH
suffix:colon
id|rc
op_assign
id|awe_close_patch
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_UNLOAD_PATCH
suffix:colon
id|rc
op_assign
id|awe_unload_patch
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_REPLACE_DATA
suffix:colon
id|rc
op_assign
id|awe_replace_data
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_MAP_PRESET
suffix:colon
id|rc
op_assign
id|awe_load_map
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* case AWE_PROBE_INFO:&n;&t;&t;rc = awe_probe_info(&amp;patch, addr, count);&n;&t;&t;break;*/
r_case
id|AWE_PROBE_DATA
suffix:colon
id|rc
op_assign
id|awe_probe_data
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_REMOVE_INFO
suffix:colon
id|rc
op_assign
id|awe_remove_info
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_LOAD_CHORUS_FX
suffix:colon
id|rc
op_assign
id|awe_load_chorus_fx
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_LOAD_REVERB_FX
suffix:colon
id|rc
op_assign
id|awe_load_reverb_fx
c_func
(paren
op_amp
id|patch
comma
id|addr
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: unknown patch format type %d&bslash;n&quot;
comma
id|patch.type
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* create an sf list record */
r_static
r_int
DECL|function|awe_create_sf
id|awe_create_sf
c_func
(paren
r_int
id|type
comma
r_char
op_star
id|name
)paren
(brace
id|sf_list
op_star
id|rec
suffix:semicolon
multiline_comment|/* terminate sounds */
id|awe_reset
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|rec
op_assign
(paren
id|sf_list
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|rec
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rec
op_eq
l_int|NULL
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* no memory */
id|rec-&gt;sf_id
op_assign
id|current_sf_id
op_plus
l_int|1
suffix:semicolon
id|rec-&gt;type
op_assign
id|type
suffix:semicolon
r_if
c_cond
(paren
multiline_comment|/*current_sf_id == 0 ||*/
(paren
id|type
op_amp
id|AWE_PAT_LOCKED
)paren
op_ne
l_int|0
)paren
id|locked_sf_id
op_assign
id|current_sf_id
op_plus
l_int|1
suffix:semicolon
id|rec-&gt;num_info
op_assign
id|awe_free_info
c_func
(paren
)paren
suffix:semicolon
id|rec-&gt;num_sample
op_assign
id|awe_free_sample
c_func
(paren
)paren
suffix:semicolon
id|rec-&gt;mem_ptr
op_assign
id|awe_free_mem_ptr
c_func
(paren
)paren
suffix:semicolon
id|rec-&gt;infos
op_assign
id|rec-&gt;last_infos
op_assign
l_int|NULL
suffix:semicolon
id|rec-&gt;samples
op_assign
id|rec-&gt;last_samples
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* add to linked-list */
id|rec-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|rec-&gt;prev
op_assign
id|sftail
suffix:semicolon
r_if
c_cond
(paren
id|sftail
)paren
id|sftail-&gt;next
op_assign
id|rec
suffix:semicolon
r_else
id|sfhead
op_assign
id|rec
suffix:semicolon
id|sftail
op_assign
id|rec
suffix:semicolon
id|current_sf_id
op_increment
suffix:semicolon
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
id|rec-&gt;shared
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|name
)paren
id|memcpy
c_func
(paren
id|rec-&gt;name
comma
id|name
comma
id|AWE_PATCH_NAME_LEN
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|rec-&gt;name
comma
l_string|&quot;*TEMPORARY*&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current_sf_id
OG
l_int|1
op_logical_and
id|name
op_logical_and
(paren
id|type
op_amp
id|AWE_PAT_SHARED
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* is the current font really a shared font? */
r_if
c_cond
(paren
id|is_shared_sf
c_func
(paren
id|rec-&gt;name
)paren
)paren
(brace
multiline_comment|/* check if the shared font is already installed */
id|sf_list
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|rec-&gt;prev
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;prev
)paren
(brace
r_if
c_cond
(paren
id|is_identical_name
c_func
(paren
id|rec-&gt;name
comma
id|p
)paren
)paren
(brace
id|rec-&gt;shared
op_assign
id|p
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
macro_line|#endif /* allow sharing */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
multiline_comment|/* check if the given name is a valid shared name */
DECL|macro|ASC_TO_KEY
mdefine_line|#define ASC_TO_KEY(c) ((c) - &squot;A&squot; + 1)
DECL|function|is_shared_sf
r_static
r_int
id|is_shared_sf
c_func
(paren
r_int
r_char
op_star
id|name
)paren
(brace
r_static
r_int
r_char
id|id_head
(braket
l_int|4
)braket
op_assign
(brace
id|ASC_TO_KEY
c_func
(paren
l_char|&squot;A&squot;
)paren
comma
id|ASC_TO_KEY
c_func
(paren
l_char|&squot;W&squot;
)paren
comma
id|ASC_TO_KEY
c_func
(paren
l_char|&squot;E&squot;
)paren
comma
id|AWE_MAJOR_VERSION
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|name
comma
id|id_head
comma
l_int|4
)paren
op_eq
l_int|0
)paren
r_return
id|TRUE
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/* check if the given name matches to the existing list */
DECL|function|is_identical_name
r_static
r_int
id|is_identical_name
c_func
(paren
r_int
r_char
op_star
id|name
comma
id|sf_list
op_star
id|p
)paren
(brace
r_char
op_star
id|id
op_assign
id|p-&gt;name
suffix:semicolon
r_if
c_cond
(paren
id|is_shared_sf
c_func
(paren
id|id
)paren
op_logical_and
id|memcmp
c_func
(paren
id|id
comma
id|name
comma
id|AWE_PATCH_NAME_LEN
)paren
op_eq
l_int|0
)paren
r_return
id|TRUE
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/* check if the given voice info exists */
DECL|function|info_duplicated
r_static
r_int
id|info_duplicated
c_func
(paren
id|sf_list
op_star
id|sf
comma
id|awe_voice_list
op_star
id|rec
)paren
(brace
multiline_comment|/* search for all sharing lists */
r_for
c_loop
(paren
suffix:semicolon
id|sf
suffix:semicolon
id|sf
op_assign
id|sf-&gt;shared
)paren
(brace
id|awe_voice_list
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|sf-&gt;infos
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|V_ST_NORMAL
op_logical_and
id|p-&gt;bank
op_eq
id|rec-&gt;bank
op_logical_and
id|p-&gt;instr
op_eq
id|rec-&gt;instr
op_logical_and
id|p-&gt;v.low
op_eq
id|rec-&gt;v.low
op_logical_and
id|p-&gt;v.high
op_eq
id|rec-&gt;v.high
op_logical_and
id|p-&gt;v.sample
op_eq
id|rec-&gt;v.sample
)paren
r_return
id|TRUE
suffix:semicolon
)brace
)brace
r_return
id|FALSE
suffix:semicolon
)brace
macro_line|#endif /* AWE_ALLOW_SAMPLE_SHARING */
multiline_comment|/* free sf_list record */
multiline_comment|/* linked-list in this function is not cared */
r_static
r_void
DECL|function|awe_free_sf
id|awe_free_sf
c_func
(paren
id|sf_list
op_star
id|sf
)paren
(brace
r_if
c_cond
(paren
id|sf-&gt;infos
)paren
(brace
id|awe_voice_list
op_star
id|p
comma
op_star
id|next
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|sf-&gt;infos
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|next
)paren
(brace
id|next
op_assign
id|p-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sf-&gt;samples
)paren
(brace
id|awe_sample_list
op_star
id|p
comma
op_star
id|next
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|sf-&gt;samples
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|next
)paren
(brace
id|next
op_assign
id|p-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
)brace
id|kfree
c_func
(paren
id|sf
)paren
suffix:semicolon
)brace
multiline_comment|/* open patch; create sf list and set opened flag */
r_static
r_int
DECL|function|awe_open_patch
id|awe_open_patch
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
id|awe_open_parm
id|parm
suffix:semicolon
r_int
id|shared
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|parm
comma
id|addr
op_plus
id|AWE_PATCH_INFO_SIZE
comma
r_sizeof
(paren
id|parm
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|shared
op_assign
id|FALSE
suffix:semicolon
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
r_if
c_cond
(paren
id|sftail
op_logical_and
(paren
id|parm.type
op_amp
id|AWE_PAT_SHARED
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* is the previous font the same font? */
r_if
c_cond
(paren
id|is_identical_name
c_func
(paren
id|parm.name
comma
id|sftail
)paren
)paren
(brace
multiline_comment|/* then append to the previous */
id|shared
op_assign
id|TRUE
suffix:semicolon
id|awe_reset
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|parm.type
op_amp
id|AWE_PAT_LOCKED
)paren
id|locked_sf_id
op_assign
id|current_sf_id
suffix:semicolon
)brace
)brace
macro_line|#endif /* allow sharing */
r_if
c_cond
(paren
op_logical_neg
id|shared
)paren
(brace
r_if
c_cond
(paren
id|awe_create_sf
c_func
(paren
id|parm.type
comma
id|parm.name
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWE32: can&squot;t open: failed to alloc new list&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
id|patch_opened
op_assign
id|TRUE
suffix:semicolon
r_return
id|current_sf_id
suffix:semicolon
)brace
multiline_comment|/* check if the patch is already opened */
r_static
id|sf_list
op_star
DECL|function|check_patch_opened
id|check_patch_opened
c_func
(paren
r_int
id|type
comma
r_char
op_star
id|name
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|patch_opened
)paren
(brace
r_if
c_cond
(paren
id|awe_create_sf
c_func
(paren
id|type
comma
id|name
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWE32: failed to alloc new list&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|patch_opened
op_assign
id|TRUE
suffix:semicolon
r_return
id|sftail
suffix:semicolon
)brace
r_return
id|sftail
suffix:semicolon
)brace
multiline_comment|/* close the patch; if no voice is loaded, remove the patch */
r_static
r_int
DECL|function|awe_close_patch
id|awe_close_patch
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|patch_opened
op_logical_and
id|sftail
)paren
(brace
multiline_comment|/* if no voice is loaded, release the current patch */
r_if
c_cond
(paren
id|sftail-&gt;infos
op_eq
l_int|NULL
)paren
(brace
id|awe_reset
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|awe_remove_samples
c_func
(paren
id|current_sf_id
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
id|patch_opened
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* remove the latest patch */
r_static
r_int
DECL|function|awe_unload_patch
id|awe_unload_patch
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|current_sf_id
OG
l_int|0
op_logical_and
id|current_sf_id
OG
id|locked_sf_id
)paren
(brace
id|awe_reset
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|awe_remove_samples
c_func
(paren
id|current_sf_id
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* allocate voice info list records */
r_static
id|awe_voice_list
op_star
DECL|function|alloc_new_info
id|alloc_new_info
c_func
(paren
r_void
)paren
(brace
id|awe_voice_list
op_star
id|newlist
suffix:semicolon
id|newlist
op_assign
(paren
id|awe_voice_list
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|newlist
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newlist
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWE32: can&squot;t alloc info table&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|newlist
suffix:semicolon
)brace
multiline_comment|/* allocate sample info list records */
r_static
id|awe_sample_list
op_star
DECL|function|alloc_new_sample
id|alloc_new_sample
c_func
(paren
r_void
)paren
(brace
id|awe_sample_list
op_star
id|newlist
suffix:semicolon
id|newlist
op_assign
(paren
id|awe_sample_list
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|newlist
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newlist
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWE32: can&squot;t alloc sample table&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|newlist
suffix:semicolon
)brace
multiline_comment|/* load voice map */
r_static
r_int
DECL|function|awe_load_map
id|awe_load_map
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
id|awe_voice_map
id|map
suffix:semicolon
id|awe_voice_list
op_star
id|rec
comma
op_star
id|p
suffix:semicolon
id|sf_list
op_star
id|sf
suffix:semicolon
multiline_comment|/* get the link info */
r_if
c_cond
(paren
id|count
OL
r_sizeof
(paren
id|map
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: invalid patch info length&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|map
comma
id|addr
op_plus
id|AWE_PATCH_INFO_SIZE
comma
r_sizeof
(paren
id|map
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* check if the identical mapping already exists */
id|p
op_assign
id|awe_search_instr
c_func
(paren
id|map.map_bank
comma
id|map.map_instr
comma
id|map.map_key
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next_instr
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|V_ST_MAPPED
op_logical_and
id|p-&gt;v.start
op_eq
id|map.src_instr
op_logical_and
id|p-&gt;v.end
op_eq
id|map.src_bank
op_logical_and
id|p-&gt;v.fixkey
op_eq
id|map.src_key
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* already present! */
)brace
r_if
c_cond
(paren
(paren
id|sf
op_assign
id|check_patch_opened
c_func
(paren
id|AWE_PAT_TYPE_MAP
comma
l_int|NULL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rec
op_assign
id|alloc_new_info
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|rec-&gt;bank
op_assign
id|map.map_bank
suffix:semicolon
id|rec-&gt;instr
op_assign
id|map.map_instr
suffix:semicolon
id|rec-&gt;type
op_assign
id|V_ST_MAPPED
suffix:semicolon
id|rec-&gt;disabled
op_assign
id|FALSE
suffix:semicolon
id|awe_init_voice_info
c_func
(paren
op_amp
id|rec-&gt;v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|map.map_key
op_ge
l_int|0
)paren
(brace
id|rec-&gt;v.low
op_assign
id|map.map_key
suffix:semicolon
id|rec-&gt;v.high
op_assign
id|map.map_key
suffix:semicolon
)brace
id|rec-&gt;v.start
op_assign
id|map.src_instr
suffix:semicolon
id|rec-&gt;v.end
op_assign
id|map.src_bank
suffix:semicolon
id|rec-&gt;v.fixkey
op_assign
id|map.src_key
suffix:semicolon
id|add_sf_info
c_func
(paren
id|sf
comma
id|rec
)paren
suffix:semicolon
id|add_info_list
c_func
(paren
id|rec
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* probe preset in the current list -- nothing to be loaded */
r_static
r_int
id|awe_probe_info
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
id|awe_voice_map
id|map
suffix:semicolon
id|awe_voice_list
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|patch_opened
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* get the link info */
r_if
c_cond
(paren
id|count
OL
r_sizeof
(paren
id|map
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: invalid patch info length&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|map
comma
id|addr
op_plus
id|AWE_PATCH_INFO_SIZE
comma
r_sizeof
(paren
id|map
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* check if the identical mapping already exists */
r_if
c_cond
(paren
id|sftail
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p
op_assign
id|awe_search_instr
c_func
(paren
id|map.src_bank
comma
id|map.src_instr
comma
id|map.src_key
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next_instr
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|V_ST_NORMAL
op_logical_and
id|is_identical_holder
c_func
(paren
id|p-&gt;holder
comma
id|sftail
)paren
op_logical_and
id|p-&gt;v.low
op_le
id|map.src_key
op_logical_and
id|p-&gt;v.high
op_ge
id|map.src_key
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* already present! */
)brace
macro_line|#endif /* allow sharing */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* probe sample in the current list -- nothing to be loaded */
r_static
r_int
DECL|function|awe_probe_data
id|awe_probe_data
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
r_if
c_cond
(paren
op_logical_neg
id|patch_opened
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* search the specified sample by optarg */
r_if
c_cond
(paren
id|search_sample_index
c_func
(paren
id|sftail
comma
id|patch-&gt;optarg
)paren
op_ne
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif /* allow sharing */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* remove the present instrument layers */
r_static
r_int
DECL|function|remove_info
id|remove_info
c_func
(paren
id|sf_list
op_star
id|sf
comma
r_int
id|bank
comma
r_int
id|instr
)paren
(brace
id|awe_voice_list
op_star
id|prev
comma
op_star
id|next
comma
op_star
id|p
suffix:semicolon
r_int
id|removed
op_assign
l_int|0
suffix:semicolon
id|prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|sf-&gt;infos
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|next
)paren
(brace
id|next
op_assign
id|p-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|V_ST_NORMAL
op_logical_and
id|p-&gt;bank
op_eq
id|bank
op_logical_and
id|p-&gt;instr
op_eq
id|instr
)paren
(brace
multiline_comment|/* remove this layer */
r_if
c_cond
(paren
id|prev
)paren
id|prev-&gt;next
op_assign
id|next
suffix:semicolon
r_else
id|sf-&gt;infos
op_assign
id|next
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
id|sf-&gt;last_infos
)paren
id|sf-&gt;last_infos
op_assign
id|prev
suffix:semicolon
id|sf-&gt;num_info
op_decrement
suffix:semicolon
id|removed
op_increment
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_else
id|prev
op_assign
id|p
suffix:semicolon
)brace
r_if
c_cond
(paren
id|removed
)paren
id|rebuild_preset_list
c_func
(paren
)paren
suffix:semicolon
r_return
id|removed
suffix:semicolon
)brace
multiline_comment|/* load voice information data */
r_static
r_int
DECL|function|awe_load_info
id|awe_load_info
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
r_int
id|offset
suffix:semicolon
id|awe_voice_rec_hdr
id|hdr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|total_size
suffix:semicolon
id|sf_list
op_star
id|sf
suffix:semicolon
id|awe_voice_list
op_star
id|rec
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|AWE_VOICE_REC_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: invalid patch info length&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|offset
op_assign
id|AWE_PATCH_INFO_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|hdr
comma
id|addr
op_plus
id|offset
comma
id|AWE_VOICE_REC_SIZE
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|offset
op_add_assign
id|AWE_VOICE_REC_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|hdr.nvoices
op_le
l_int|0
op_logical_or
id|hdr.nvoices
op_ge
l_int|100
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: Invalid voice number %d&bslash;n&quot;
comma
id|hdr.nvoices
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|total_size
op_assign
id|AWE_VOICE_REC_SIZE
op_plus
id|AWE_VOICE_INFO_SIZE
op_star
id|hdr.nvoices
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|total_size
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: patch length(%d) is smaller than nvoices(%d)&bslash;n&quot;
comma
id|count
comma
id|hdr.nvoices
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sf
op_assign
id|check_patch_opened
c_func
(paren
id|AWE_PAT_TYPE_MISC
comma
l_int|NULL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_switch
c_cond
(paren
id|hdr.write_mode
)paren
(brace
r_case
id|AWE_WR_EXCLUSIVE
suffix:colon
multiline_comment|/* exclusive mode - if the instrument already exists,&n;&t;&t;   return error */
r_for
c_loop
(paren
id|rec
op_assign
id|sf-&gt;infos
suffix:semicolon
id|rec
suffix:semicolon
id|rec
op_assign
id|rec-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|rec-&gt;type
op_eq
id|V_ST_NORMAL
op_logical_and
id|rec-&gt;bank
op_eq
id|hdr.bank
op_logical_and
id|rec-&gt;instr
op_eq
id|hdr.instr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AWE_WR_REPLACE
suffix:colon
multiline_comment|/* replace mode - remove the instrument if it already exists */
id|remove_info
c_func
(paren
id|sf
comma
id|hdr.bank
comma
id|hdr.instr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* append new layers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|hdr.nvoices
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rec
op_assign
id|alloc_new_info
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rec
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|rec-&gt;bank
op_assign
id|hdr.bank
suffix:semicolon
id|rec-&gt;instr
op_assign
id|hdr.instr
suffix:semicolon
id|rec-&gt;type
op_assign
id|V_ST_NORMAL
suffix:semicolon
id|rec-&gt;disabled
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* copy awe_voice_info parameters */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|rec-&gt;v
comma
id|addr
op_plus
id|offset
comma
id|AWE_VOICE_INFO_SIZE
)paren
)paren
(brace
id|kfree
c_func
(paren
id|rec
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|offset
op_add_assign
id|AWE_VOICE_INFO_SIZE
suffix:semicolon
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
r_if
c_cond
(paren
id|sf
op_logical_and
id|sf-&gt;shared
)paren
(brace
r_if
c_cond
(paren
id|info_duplicated
c_func
(paren
id|sf
comma
id|rec
)paren
)paren
(brace
id|kfree
c_func
(paren
id|rec
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
macro_line|#endif /* allow sharing */
r_if
c_cond
(paren
id|rec-&gt;v.mode
op_amp
id|AWE_MODE_INIT_PARM
)paren
id|awe_init_voice_parm
c_func
(paren
op_amp
id|rec-&gt;v.parm
)paren
suffix:semicolon
id|add_sf_info
c_func
(paren
id|sf
comma
id|rec
)paren
suffix:semicolon
id|awe_set_sample
c_func
(paren
id|rec
)paren
suffix:semicolon
id|add_info_list
c_func
(paren
id|rec
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* remove instrument layers */
r_static
r_int
DECL|function|awe_remove_info
id|awe_remove_info
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
r_int
r_char
id|bank
comma
id|instr
suffix:semicolon
id|sf_list
op_star
id|sf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|patch_opened
op_logical_or
(paren
id|sf
op_assign
id|sftail
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32: remove_info: patch not opened&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|bank
op_assign
(paren
(paren
r_int
r_int
)paren
id|patch-&gt;optarg
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|instr
op_assign
(paren
r_int
r_int
)paren
id|patch-&gt;optarg
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|remove_info
c_func
(paren
id|sf
comma
id|bank
comma
id|instr
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* load wave sample data */
r_static
r_int
DECL|function|awe_load_data
id|awe_load_data
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
r_int
id|offset
comma
id|size
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|awe_sample_info
id|tmprec
suffix:semicolon
id|awe_sample_list
op_star
id|rec
suffix:semicolon
id|sf_list
op_star
id|sf
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sf
op_assign
id|check_patch_opened
c_func
(paren
id|AWE_PAT_TYPE_MISC
comma
l_int|NULL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|size
op_assign
(paren
id|count
op_minus
id|AWE_SAMPLE_INFO_SIZE
)paren
op_div
l_int|2
suffix:semicolon
id|offset
op_assign
id|AWE_PATCH_INFO_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|tmprec
comma
id|addr
op_plus
id|offset
comma
id|AWE_SAMPLE_INFO_SIZE
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|offset
op_add_assign
id|AWE_SAMPLE_INFO_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ne
id|tmprec.size
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32: load: sample size differed (%d != %d)&bslash;n&quot;
comma
id|tmprec.size
comma
id|size
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|search_sample_index
c_func
(paren
id|sf
comma
id|tmprec.sample
)paren
op_ne
l_int|NULL
)paren
(brace
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
multiline_comment|/* if shared sample, skip this data */
r_if
c_cond
(paren
id|sf-&gt;type
op_amp
id|AWE_PAT_SHARED
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif /* allow sharing */
id|DEBUG
c_func
(paren
l_int|1
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: sample data %d already present&bslash;n&quot;
comma
id|tmprec.sample
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rec
op_assign
id|alloc_new_sample
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rec-&gt;v
comma
op_amp
id|tmprec
comma
r_sizeof
(paren
id|tmprec
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;v.size
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|awe_write_wave_data
c_func
(paren
id|addr
comma
id|offset
comma
id|rec
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|rec
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|sf-&gt;mem_ptr
op_add_assign
id|rc
suffix:semicolon
)brace
id|add_sf_sample
c_func
(paren
id|sf
comma
id|rec
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* replace wave sample data */
r_static
r_int
DECL|function|awe_replace_data
id|awe_replace_data
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
r_int
id|offset
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_int
id|channels
suffix:semicolon
id|awe_sample_info
id|cursmp
suffix:semicolon
r_int
id|save_mem_ptr
suffix:semicolon
id|sf_list
op_star
id|sf
suffix:semicolon
id|awe_sample_list
op_star
id|rec
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|patch_opened
op_logical_or
(paren
id|sf
op_assign
id|sftail
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32: replace: patch not opened&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|size
op_assign
(paren
id|count
op_minus
id|AWE_SAMPLE_INFO_SIZE
)paren
op_div
l_int|2
suffix:semicolon
id|offset
op_assign
id|AWE_PATCH_INFO_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|cursmp
comma
id|addr
op_plus
id|offset
comma
id|AWE_SAMPLE_INFO_SIZE
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|offset
op_add_assign
id|AWE_SAMPLE_INFO_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|cursmp.size
op_eq
l_int|0
op_logical_or
id|size
op_ne
id|cursmp.size
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32: replace: invalid sample size (%d!=%d)&bslash;n&quot;
comma
id|cursmp.size
comma
id|size
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|channels
op_assign
id|patch-&gt;optarg
suffix:semicolon
r_if
c_cond
(paren
id|channels
op_le
l_int|0
op_logical_or
id|channels
OG
id|AWE_NORMAL_VOICES
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32: replace: invalid channels %d&bslash;n&quot;
comma
id|channels
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|rec
op_assign
id|sf-&gt;samples
suffix:semicolon
id|rec
suffix:semicolon
id|rec
op_assign
id|rec-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|rec-&gt;v.sample
op_eq
id|cursmp.sample
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rec
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32: replace: cannot find existing sample data %d&bslash;n&quot;
comma
id|cursmp.sample
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rec-&gt;v.size
op_ne
id|cursmp.size
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32: replace: exiting size differed (%d!=%d)&bslash;n&quot;
comma
id|rec-&gt;v.size
comma
id|cursmp.size
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|save_mem_ptr
op_assign
id|awe_free_mem_ptr
c_func
(paren
)paren
suffix:semicolon
id|sftail-&gt;mem_ptr
op_assign
id|rec-&gt;v.start
op_minus
id|awe_mem_start
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rec-&gt;v
comma
op_amp
id|cursmp
comma
r_sizeof
(paren
id|cursmp
)paren
)paren
suffix:semicolon
id|rec-&gt;v.sf_id
op_assign
id|current_sf_id
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|awe_write_wave_data
c_func
(paren
id|addr
comma
id|offset
comma
id|rec
comma
id|channels
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
id|sftail-&gt;mem_ptr
op_assign
id|save_mem_ptr
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------*/
DECL|variable|readbuf_addr
r_static
r_const
r_char
op_star
id|readbuf_addr
suffix:semicolon
DECL|variable|readbuf_offs
r_static
r_int
id|readbuf_offs
suffix:semicolon
DECL|variable|readbuf_flags
r_static
r_int
id|readbuf_flags
suffix:semicolon
multiline_comment|/* initialize read buffer */
r_static
r_int
DECL|function|readbuf_init
id|readbuf_init
c_func
(paren
r_const
r_char
op_star
id|addr
comma
r_int
id|offset
comma
id|awe_sample_info
op_star
id|sp
)paren
(brace
id|readbuf_addr
op_assign
id|addr
suffix:semicolon
id|readbuf_offs
op_assign
id|offset
suffix:semicolon
id|readbuf_flags
op_assign
id|sp-&gt;mode_flags
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* read directly from user buffer */
r_static
r_int
r_int
DECL|function|readbuf_word
id|readbuf_word
c_func
(paren
r_int
id|pos
)paren
(brace
r_int
r_int
id|c
suffix:semicolon
multiline_comment|/* read from user buffer */
r_if
c_cond
(paren
id|readbuf_flags
op_amp
id|AWE_SAMPLE_8BITS
)paren
(brace
r_int
r_char
id|cc
suffix:semicolon
id|get_user
c_func
(paren
id|cc
comma
(paren
r_int
r_char
op_star
)paren
(paren
id|readbuf_addr
op_plus
id|readbuf_offs
op_plus
id|pos
)paren
)paren
suffix:semicolon
id|c
op_assign
(paren
r_int
r_int
)paren
id|cc
op_lshift
l_int|8
suffix:semicolon
multiline_comment|/* convert 8bit -&gt; 16bit */
)brace
r_else
(brace
id|get_user
c_func
(paren
id|c
comma
(paren
r_int
r_int
op_star
)paren
(paren
id|readbuf_addr
op_plus
id|readbuf_offs
op_plus
id|pos
op_star
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|readbuf_flags
op_amp
id|AWE_SAMPLE_UNSIGNED
)paren
id|c
op_xor_assign
l_int|0x8000
suffix:semicolon
multiline_comment|/* unsigned -&gt; signed */
r_return
id|c
suffix:semicolon
)brace
DECL|macro|readbuf_word_cache
mdefine_line|#define readbuf_word_cache&t;readbuf_word
DECL|macro|readbuf_end
mdefine_line|#define readbuf_end()&t;&t;/**/
multiline_comment|/*----------------------------------------------------------------*/
DECL|macro|BLANK_LOOP_START
mdefine_line|#define BLANK_LOOP_START&t;8
DECL|macro|BLANK_LOOP_END
mdefine_line|#define BLANK_LOOP_END&t;&t;40
DECL|macro|BLANK_LOOP_SIZE
mdefine_line|#define BLANK_LOOP_SIZE&t;&t;48
multiline_comment|/* loading onto memory - return the actual written size */
r_static
r_int
DECL|function|awe_write_wave_data
id|awe_write_wave_data
c_func
(paren
r_const
r_char
op_star
id|addr
comma
r_int
id|offset
comma
id|awe_sample_list
op_star
id|list
comma
r_int
id|channels
)paren
(brace
r_int
id|i
comma
id|truesize
comma
id|dram_offset
suffix:semicolon
id|awe_sample_info
op_star
id|sp
op_assign
op_amp
id|list-&gt;v
suffix:semicolon
r_int
id|rc
suffix:semicolon
multiline_comment|/* be sure loop points start &lt; end */
r_if
c_cond
(paren
id|sp-&gt;loopstart
OG
id|sp-&gt;loopend
)paren
(brace
r_int
id|tmp
op_assign
id|sp-&gt;loopstart
suffix:semicolon
id|sp-&gt;loopstart
op_assign
id|sp-&gt;loopend
suffix:semicolon
id|sp-&gt;loopend
op_assign
id|tmp
suffix:semicolon
)brace
multiline_comment|/* compute true data size to be loaded */
id|truesize
op_assign
id|sp-&gt;size
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
(paren
id|AWE_SAMPLE_BIDIR_LOOP
op_or
id|AWE_SAMPLE_REVERSE_LOOP
)paren
)paren
id|truesize
op_add_assign
id|sp-&gt;loopend
op_minus
id|sp-&gt;loopstart
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_NO_BLANK
)paren
id|truesize
op_add_assign
id|BLANK_LOOP_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|awe_free_mem_ptr
c_func
(paren
)paren
op_plus
id|truesize
op_ge
id|memsize
op_div
l_int|2
)paren
(brace
id|DEBUG
c_func
(paren
op_minus
l_int|1
comma
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: Sample memory full&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOSPC
suffix:semicolon
)brace
multiline_comment|/* recalculate address offset */
id|sp-&gt;end
op_sub_assign
id|sp-&gt;start
suffix:semicolon
id|sp-&gt;loopstart
op_sub_assign
id|sp-&gt;start
suffix:semicolon
id|sp-&gt;loopend
op_sub_assign
id|sp-&gt;start
suffix:semicolon
id|dram_offset
op_assign
id|awe_free_mem_ptr
c_func
(paren
)paren
op_plus
id|awe_mem_start
suffix:semicolon
id|sp-&gt;start
op_assign
id|dram_offset
suffix:semicolon
id|sp-&gt;end
op_add_assign
id|dram_offset
suffix:semicolon
id|sp-&gt;loopstart
op_add_assign
id|dram_offset
suffix:semicolon
id|sp-&gt;loopend
op_add_assign
id|dram_offset
suffix:semicolon
multiline_comment|/* set the total size (store onto obsolete checksum value) */
r_if
c_cond
(paren
id|sp-&gt;size
op_eq
l_int|0
)paren
id|sp-&gt;checksum
op_assign
l_int|0
suffix:semicolon
r_else
id|sp-&gt;checksum
op_assign
id|truesize
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|awe_open_dram_for_write
c_func
(paren
id|dram_offset
comma
id|channels
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|readbuf_init
c_func
(paren
id|addr
comma
id|offset
comma
id|sp
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOSPC
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sp-&gt;size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|c
suffix:semicolon
id|c
op_assign
id|readbuf_word
c_func
(paren
id|i
)paren
suffix:semicolon
id|awe_write_dram
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|sp-&gt;loopend
op_logical_and
(paren
id|sp-&gt;mode_flags
op_amp
(paren
id|AWE_SAMPLE_BIDIR_LOOP
op_or
id|AWE_SAMPLE_REVERSE_LOOP
)paren
)paren
)paren
(brace
r_int
id|looplen
op_assign
id|sp-&gt;loopend
op_minus
id|sp-&gt;loopstart
suffix:semicolon
multiline_comment|/* copy reverse loop */
r_int
id|k
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|1
suffix:semicolon
id|k
op_le
id|looplen
suffix:semicolon
id|k
op_increment
)paren
(brace
id|c
op_assign
id|readbuf_word_cache
c_func
(paren
id|i
op_minus
id|k
)paren
suffix:semicolon
id|awe_write_dram
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_BIDIR_LOOP
)paren
(brace
id|sp-&gt;end
op_add_assign
id|looplen
suffix:semicolon
)brace
r_else
(brace
id|sp-&gt;start
op_add_assign
id|looplen
suffix:semicolon
id|sp-&gt;end
op_add_assign
id|looplen
suffix:semicolon
)brace
)brace
)brace
id|readbuf_end
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* if no blank loop is attached in the sample, add it */
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_NO_BLANK
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|BLANK_LOOP_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|awe_write_dram
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_SINGLESHOT
)paren
(brace
id|sp-&gt;loopstart
op_assign
id|sp-&gt;end
op_plus
id|BLANK_LOOP_START
suffix:semicolon
id|sp-&gt;loopend
op_assign
id|sp-&gt;end
op_plus
id|BLANK_LOOP_END
suffix:semicolon
)brace
)brace
id|awe_close_dram
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* initialize FM */
id|awe_init_fm
c_func
(paren
)paren
suffix:semicolon
r_return
id|truesize
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------*/
macro_line|#ifdef AWE_HAS_GUS_COMPATIBILITY
multiline_comment|/* calculate GUS envelope time:&n; * is this correct?  i have no idea..&n; */
r_static
r_int
DECL|function|calc_gus_envelope_time
id|calc_gus_envelope_time
c_func
(paren
r_int
id|rate
comma
r_int
id|start
comma
r_int
id|end
)paren
(brace
r_int
id|r
comma
id|p
comma
id|t
suffix:semicolon
id|r
op_assign
(paren
l_int|3
op_minus
(paren
(paren
id|rate
op_rshift
l_int|6
)paren
op_amp
l_int|3
)paren
)paren
op_star
l_int|3
suffix:semicolon
id|p
op_assign
id|rate
op_amp
l_int|0x3f
suffix:semicolon
id|t
op_assign
id|end
op_minus
id|start
suffix:semicolon
r_if
c_cond
(paren
id|t
OL
l_int|0
)paren
id|t
op_assign
op_minus
id|t
suffix:semicolon
r_if
c_cond
(paren
l_int|13
OG
id|r
)paren
id|t
op_assign
id|t
op_lshift
(paren
l_int|13
op_minus
id|r
)paren
suffix:semicolon
r_else
id|t
op_assign
id|t
op_rshift
(paren
id|r
op_minus
l_int|13
)paren
suffix:semicolon
r_return
(paren
id|t
op_star
l_int|10
)paren
op_div
(paren
id|p
op_star
l_int|441
)paren
suffix:semicolon
)brace
DECL|macro|calc_gus_sustain
mdefine_line|#define calc_gus_sustain(val)  (0x7f - vol_table[(val)/2])
DECL|macro|calc_gus_attenuation
mdefine_line|#define calc_gus_attenuation(val)&t;vol_table[(val)/2]
multiline_comment|/* load GUS patch */
r_static
r_int
DECL|function|awe_load_guspatch
id|awe_load_guspatch
c_func
(paren
r_const
r_char
op_star
id|addr
comma
r_int
id|offs
comma
r_int
id|size
comma
r_int
id|pmgr_flag
)paren
(brace
r_struct
id|patch_info
id|patch
suffix:semicolon
id|awe_voice_info
op_star
id|rec
suffix:semicolon
id|awe_sample_info
op_star
id|smp
suffix:semicolon
id|awe_voice_list
op_star
id|vrec
suffix:semicolon
id|awe_sample_list
op_star
id|smprec
suffix:semicolon
r_int
id|sizeof_patch
suffix:semicolon
r_int
id|note
comma
id|rc
suffix:semicolon
id|sf_list
op_star
id|sf
suffix:semicolon
id|sizeof_patch
op_assign
(paren
r_int
)paren
(paren
(paren
r_int
)paren
op_amp
id|patch.data
(braket
l_int|0
)braket
op_minus
(paren
r_int
)paren
op_amp
id|patch
)paren
suffix:semicolon
multiline_comment|/* header size */
r_if
c_cond
(paren
id|size
OL
id|sizeof_patch
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: Patch header too short&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
(paren
r_char
op_star
)paren
op_amp
id|patch
)paren
op_plus
id|offs
comma
id|addr
op_plus
id|offs
comma
id|sizeof_patch
op_minus
id|offs
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|size
op_sub_assign
id|sizeof_patch
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
id|patch.len
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: Patch record too short (%d&lt;%d)&bslash;n&quot;
comma
id|size
comma
id|patch.len
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sf
op_assign
id|check_patch_opened
c_func
(paren
id|AWE_PAT_TYPE_GUS
comma
l_int|NULL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|smprec
op_assign
id|alloc_new_sample
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vrec
op_assign
id|alloc_new_info
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|smprec
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|smp
op_assign
op_amp
id|smprec-&gt;v
suffix:semicolon
id|smp-&gt;sample
op_assign
id|sf-&gt;num_sample
suffix:semicolon
id|smp-&gt;start
op_assign
l_int|0
suffix:semicolon
id|smp-&gt;end
op_assign
id|patch.len
suffix:semicolon
id|smp-&gt;loopstart
op_assign
id|patch.loop_start
suffix:semicolon
id|smp-&gt;loopend
op_assign
id|patch.loop_end
suffix:semicolon
id|smp-&gt;size
op_assign
id|patch.len
suffix:semicolon
multiline_comment|/* set up mode flags */
id|smp-&gt;mode_flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|patch.mode
op_amp
id|WAVE_16_BITS
)paren
)paren
id|smp-&gt;mode_flags
op_or_assign
id|AWE_SAMPLE_8BITS
suffix:semicolon
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_UNSIGNED
)paren
id|smp-&gt;mode_flags
op_or_assign
id|AWE_SAMPLE_UNSIGNED
suffix:semicolon
id|smp-&gt;mode_flags
op_or_assign
id|AWE_SAMPLE_NO_BLANK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|patch.mode
op_amp
(paren
id|WAVE_LOOPING
op_or
id|WAVE_BIDIR_LOOP
op_or
id|WAVE_LOOP_BACK
)paren
)paren
)paren
id|smp-&gt;mode_flags
op_or_assign
id|AWE_SAMPLE_SINGLESHOT
suffix:semicolon
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_BIDIR_LOOP
)paren
id|smp-&gt;mode_flags
op_or_assign
id|AWE_SAMPLE_BIDIR_LOOP
suffix:semicolon
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_LOOP_BACK
)paren
id|smp-&gt;mode_flags
op_or_assign
id|AWE_SAMPLE_REVERSE_LOOP
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [sample %d mode %x]&bslash;n&quot;
comma
id|patch.instr_no
comma
id|smp-&gt;mode_flags
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_16_BITS
)paren
(brace
multiline_comment|/* convert to word offsets */
id|smp-&gt;size
op_div_assign
l_int|2
suffix:semicolon
id|smp-&gt;end
op_div_assign
l_int|2
suffix:semicolon
id|smp-&gt;loopstart
op_div_assign
l_int|2
suffix:semicolon
id|smp-&gt;loopend
op_div_assign
l_int|2
suffix:semicolon
)brace
id|smp-&gt;checksum_flag
op_assign
l_int|0
suffix:semicolon
id|smp-&gt;checksum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|awe_write_wave_data
c_func
(paren
id|addr
comma
id|sizeof_patch
comma
id|smprec
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
id|sf-&gt;mem_ptr
op_add_assign
id|rc
suffix:semicolon
id|add_sf_sample
c_func
(paren
id|sf
comma
id|smprec
)paren
suffix:semicolon
multiline_comment|/* set up voice info */
id|rec
op_assign
op_amp
id|vrec-&gt;v
suffix:semicolon
id|awe_init_voice_info
c_func
(paren
id|rec
)paren
suffix:semicolon
id|rec-&gt;sample
op_assign
id|sf-&gt;num_info
suffix:semicolon
multiline_comment|/* the last sample */
id|rec-&gt;rate_offset
op_assign
id|calc_rate_offset
c_func
(paren
id|patch.base_freq
)paren
suffix:semicolon
id|note
op_assign
id|freq_to_note
c_func
(paren
id|patch.base_note
)paren
suffix:semicolon
id|rec-&gt;root
op_assign
id|note
op_div
l_int|100
suffix:semicolon
id|rec-&gt;tune
op_assign
op_minus
(paren
id|note
op_mod
l_int|100
)paren
suffix:semicolon
id|rec-&gt;low
op_assign
id|freq_to_note
c_func
(paren
id|patch.low_note
)paren
op_div
l_int|100
suffix:semicolon
id|rec-&gt;high
op_assign
id|freq_to_note
c_func
(paren
id|patch.high_note
)paren
op_div
l_int|100
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [gus base offset=%d, note=%d, range=%d-%d(%d-%d)]&bslash;n&quot;
comma
id|rec-&gt;rate_offset
comma
id|note
comma
id|rec-&gt;low
comma
id|rec-&gt;high
comma
id|patch.low_note
comma
id|patch.high_note
)paren
)paren
suffix:semicolon
multiline_comment|/* panning position; -128 - 127 =&gt; 0-127 */
id|rec-&gt;pan
op_assign
(paren
id|patch.panning
op_plus
l_int|128
)paren
op_div
l_int|2
suffix:semicolon
multiline_comment|/* detuning is ignored */
multiline_comment|/* 6points volume envelope */
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_ENVELOPES
)paren
(brace
r_int
id|attack
comma
id|hold
comma
id|decay
comma
id|release
suffix:semicolon
id|attack
op_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|0
)braket
comma
l_int|0
comma
id|patch.env_offset
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|hold
op_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|1
)braket
comma
id|patch.env_offset
(braket
l_int|0
)braket
comma
id|patch.env_offset
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|decay
op_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|2
)braket
comma
id|patch.env_offset
(braket
l_int|1
)braket
comma
id|patch.env_offset
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|release
op_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|3
)braket
comma
id|patch.env_offset
(braket
l_int|1
)braket
comma
id|patch.env_offset
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|release
op_add_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|4
)braket
comma
id|patch.env_offset
(braket
l_int|3
)braket
comma
id|patch.env_offset
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|release
op_add_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|5
)braket
comma
id|patch.env_offset
(braket
l_int|4
)braket
comma
id|patch.env_offset
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|rec-&gt;parm.volatkhld
op_assign
(paren
id|calc_parm_hold
c_func
(paren
id|hold
)paren
op_lshift
l_int|8
)paren
op_or
id|calc_parm_attack
c_func
(paren
id|attack
)paren
suffix:semicolon
id|rec-&gt;parm.voldcysus
op_assign
(paren
id|calc_gus_sustain
c_func
(paren
id|patch.env_offset
(braket
l_int|2
)braket
)paren
op_lshift
l_int|8
)paren
op_or
id|calc_parm_decay
c_func
(paren
id|decay
)paren
suffix:semicolon
id|rec-&gt;parm.volrelease
op_assign
l_int|0x8000
op_or
id|calc_parm_decay
c_func
(paren
id|release
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [gusenv atk=%d, hld=%d, dcy=%d, rel=%d]&bslash;n&quot;
comma
id|attack
comma
id|hold
comma
id|decay
comma
id|release
)paren
)paren
suffix:semicolon
id|rec-&gt;attenuation
op_assign
id|calc_gus_attenuation
c_func
(paren
id|patch.env_offset
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* tremolo effect */
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_TREMOLO
)paren
(brace
r_int
id|rate
op_assign
(paren
id|patch.tremolo_rate
op_star
l_int|1000
op_div
l_int|38
)paren
op_div
l_int|42
suffix:semicolon
id|rec-&gt;parm.tremfrq
op_assign
(paren
(paren
id|patch.tremolo_depth
op_div
l_int|2
)paren
op_lshift
l_int|8
)paren
op_or
id|rate
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [gusenv tremolo rate=%d, dep=%d, tremfrq=%x]&bslash;n&quot;
comma
id|patch.tremolo_rate
comma
id|patch.tremolo_depth
comma
id|rec-&gt;parm.tremfrq
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* vibrato effect */
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_VIBRATO
)paren
(brace
r_int
id|rate
op_assign
(paren
id|patch.vibrato_rate
op_star
l_int|1000
op_div
l_int|38
)paren
op_div
l_int|42
suffix:semicolon
id|rec-&gt;parm.fm2frq2
op_assign
(paren
(paren
id|patch.vibrato_depth
op_div
l_int|6
)paren
op_lshift
l_int|8
)paren
op_or
id|rate
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [gusenv vibrato rate=%d, dep=%d, tremfrq=%x]&bslash;n&quot;
comma
id|patch.tremolo_rate
comma
id|patch.tremolo_depth
comma
id|rec-&gt;parm.tremfrq
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* scale_freq, scale_factor, volume, and fractions not implemented */
multiline_comment|/* append to the tail of the list */
id|vrec-&gt;bank
op_assign
id|ctrls
(braket
id|AWE_MD_GUS_BANK
)braket
suffix:semicolon
id|vrec-&gt;instr
op_assign
id|patch.instr_no
suffix:semicolon
id|vrec-&gt;disabled
op_assign
id|FALSE
suffix:semicolon
id|vrec-&gt;type
op_assign
id|V_ST_NORMAL
suffix:semicolon
id|add_sf_info
c_func
(paren
id|sf
comma
id|vrec
)paren
suffix:semicolon
id|add_info_list
c_func
(paren
id|vrec
)paren
suffix:semicolon
multiline_comment|/* set the voice index */
id|awe_set_sample
c_func
(paren
id|vrec
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif  /* AWE_HAS_GUS_COMPATIBILITY */
multiline_comment|/*&n; * sample and voice list handlers&n; */
multiline_comment|/* append this to the current sf list */
DECL|function|add_sf_info
r_static
r_void
id|add_sf_info
c_func
(paren
id|sf_list
op_star
id|sf
comma
id|awe_voice_list
op_star
id|rec
)paren
(brace
r_if
c_cond
(paren
id|sf
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|rec-&gt;holder
op_assign
id|sf
suffix:semicolon
id|rec-&gt;v.sf_id
op_assign
id|sf-&gt;sf_id
suffix:semicolon
r_if
c_cond
(paren
id|sf-&gt;last_infos
)paren
id|sf-&gt;last_infos-&gt;next
op_assign
id|rec
suffix:semicolon
r_else
id|sf-&gt;infos
op_assign
id|rec
suffix:semicolon
id|sf-&gt;last_infos
op_assign
id|rec
suffix:semicolon
id|rec-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|sf-&gt;num_info
op_increment
suffix:semicolon
)brace
multiline_comment|/* prepend this sample to sf list */
DECL|function|add_sf_sample
r_static
r_void
id|add_sf_sample
c_func
(paren
id|sf_list
op_star
id|sf
comma
id|awe_sample_list
op_star
id|rec
)paren
(brace
r_if
c_cond
(paren
id|sf
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|rec-&gt;holder
op_assign
id|sf
suffix:semicolon
id|rec-&gt;v.sf_id
op_assign
id|sf-&gt;sf_id
suffix:semicolon
r_if
c_cond
(paren
id|sf-&gt;last_samples
)paren
id|sf-&gt;last_samples-&gt;next
op_assign
id|rec
suffix:semicolon
r_else
id|sf-&gt;samples
op_assign
id|rec
suffix:semicolon
id|sf-&gt;last_samples
op_assign
id|rec
suffix:semicolon
id|rec-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|sf-&gt;num_sample
op_increment
suffix:semicolon
)brace
multiline_comment|/* purge the old records which don&squot;t belong with the same file id */
DECL|function|purge_old_list
r_static
r_void
id|purge_old_list
c_func
(paren
id|awe_voice_list
op_star
id|rec
comma
id|awe_voice_list
op_star
id|next
)paren
(brace
id|rec-&gt;next_instr
op_assign
id|next
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;bank
op_eq
id|AWE_DRUM_BANK
)paren
(brace
multiline_comment|/* remove samples with the same note range */
id|awe_voice_list
op_star
id|cur
comma
op_star
id|prev
op_assign
id|rec
suffix:semicolon
r_int
id|low
op_assign
id|rec-&gt;v.low
suffix:semicolon
r_int
id|high
op_assign
id|rec-&gt;v.high
suffix:semicolon
r_for
c_loop
(paren
id|cur
op_assign
id|next
suffix:semicolon
id|cur
suffix:semicolon
id|cur
op_assign
id|cur-&gt;next_instr
)paren
(brace
r_if
c_cond
(paren
id|cur-&gt;v.low
op_eq
id|low
op_logical_and
id|cur-&gt;v.high
op_eq
id|high
op_logical_and
op_logical_neg
id|is_identical_holder
c_func
(paren
id|cur-&gt;holder
comma
id|rec-&gt;holder
)paren
)paren
id|prev-&gt;next_instr
op_assign
id|cur-&gt;next_instr
suffix:semicolon
r_else
id|prev
op_assign
id|cur
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|is_identical_holder
c_func
(paren
id|next-&gt;holder
comma
id|rec-&gt;holder
)paren
)paren
multiline_comment|/* remove all samples */
id|rec-&gt;next_instr
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/* prepend to top of the preset table */
DECL|function|add_info_list
r_static
r_void
id|add_info_list
c_func
(paren
id|awe_voice_list
op_star
id|rec
)paren
(brace
id|awe_voice_list
op_star
id|prev
comma
op_star
id|cur
suffix:semicolon
r_int
id|key
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;disabled
)paren
r_return
suffix:semicolon
id|key
op_assign
id|awe_search_key
c_func
(paren
id|rec-&gt;bank
comma
id|rec-&gt;instr
comma
id|rec-&gt;v.low
)paren
suffix:semicolon
id|prev
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|cur
op_assign
id|preset_table
(braket
id|key
)braket
suffix:semicolon
id|cur
suffix:semicolon
id|cur
op_assign
id|cur-&gt;next_bank
)paren
(brace
multiline_comment|/* search the first record with the same bank number */
r_if
c_cond
(paren
id|cur-&gt;instr
op_eq
id|rec-&gt;instr
op_logical_and
id|cur-&gt;bank
op_eq
id|rec-&gt;bank
)paren
(brace
multiline_comment|/* replace the list with the new record */
id|rec-&gt;next_bank
op_assign
id|cur-&gt;next_bank
suffix:semicolon
r_if
c_cond
(paren
id|prev
)paren
id|prev-&gt;next_bank
op_assign
id|rec
suffix:semicolon
r_else
id|preset_table
(braket
id|key
)braket
op_assign
id|rec
suffix:semicolon
id|purge_old_list
c_func
(paren
id|rec
comma
id|cur
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|prev
op_assign
id|cur
suffix:semicolon
)brace
multiline_comment|/* this is the first bank record.. just add this */
id|rec-&gt;next_instr
op_assign
l_int|NULL
suffix:semicolon
id|rec-&gt;next_bank
op_assign
id|preset_table
(braket
id|key
)braket
suffix:semicolon
id|preset_table
(braket
id|key
)braket
op_assign
id|rec
suffix:semicolon
)brace
multiline_comment|/* remove samples later than the specified sf_id */
r_static
r_void
DECL|function|awe_remove_samples
id|awe_remove_samples
c_func
(paren
r_int
id|sf_id
)paren
(brace
id|sf_list
op_star
id|p
comma
op_star
id|prev
suffix:semicolon
r_if
c_cond
(paren
id|sf_id
op_le
l_int|0
)paren
(brace
id|awe_reset_samples
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* already removed? */
r_if
c_cond
(paren
id|current_sf_id
op_le
id|sf_id
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|sftail
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|prev
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;sf_id
op_le
id|sf_id
)paren
r_break
suffix:semicolon
id|prev
op_assign
id|p-&gt;prev
suffix:semicolon
id|awe_free_sf
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|sftail
op_assign
id|p
suffix:semicolon
r_if
c_cond
(paren
id|sftail
)paren
(brace
id|sf_id
op_assign
id|sftail-&gt;sf_id
suffix:semicolon
id|sftail-&gt;next
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|sf_id
op_assign
l_int|0
suffix:semicolon
id|sfhead
op_assign
l_int|NULL
suffix:semicolon
)brace
id|current_sf_id
op_assign
id|sf_id
suffix:semicolon
r_if
c_cond
(paren
id|locked_sf_id
OG
id|sf_id
)paren
id|locked_sf_id
op_assign
id|sf_id
suffix:semicolon
id|rebuild_preset_list
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* rebuild preset search list */
DECL|function|rebuild_preset_list
r_static
r_void
id|rebuild_preset_list
c_func
(paren
r_void
)paren
(brace
id|sf_list
op_star
id|p
suffix:semicolon
id|awe_voice_list
op_star
id|rec
suffix:semicolon
id|memset
c_func
(paren
id|preset_table
comma
l_int|0
comma
r_sizeof
(paren
id|preset_table
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|sfhead
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
)paren
(brace
r_for
c_loop
(paren
id|rec
op_assign
id|p-&gt;infos
suffix:semicolon
id|rec
suffix:semicolon
id|rec
op_assign
id|rec-&gt;next
)paren
id|add_info_list
c_func
(paren
id|rec
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* compare the given sf_id pair */
DECL|function|is_identical_holder
r_static
r_int
id|is_identical_holder
c_func
(paren
id|sf_list
op_star
id|sf1
comma
id|sf_list
op_star
id|sf2
)paren
(brace
r_if
c_cond
(paren
id|sf1
op_eq
l_int|NULL
op_logical_or
id|sf2
op_eq
l_int|NULL
)paren
r_return
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|sf1
op_eq
id|sf2
)paren
r_return
id|TRUE
suffix:semicolon
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
(brace
multiline_comment|/* compare with the sharing id */
id|sf_list
op_star
id|p
suffix:semicolon
r_int
id|counter
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sf1-&gt;sf_id
OL
id|sf2-&gt;sf_id
)paren
(brace
multiline_comment|/* make sure id1 &gt; id2 */
id|sf_list
op_star
id|tmp
suffix:semicolon
id|tmp
op_assign
id|sf1
suffix:semicolon
id|sf1
op_assign
id|sf2
suffix:semicolon
id|sf2
op_assign
id|tmp
suffix:semicolon
)brace
r_for
c_loop
(paren
id|p
op_assign
id|sf1-&gt;shared
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;shared
)paren
(brace
r_if
c_cond
(paren
id|counter
op_increment
OG
id|current_sf_id
)paren
r_break
suffix:semicolon
multiline_comment|/* strange sharing loop.. quit */
r_if
c_cond
(paren
id|p
op_eq
id|sf2
)paren
r_return
id|TRUE
suffix:semicolon
)brace
)brace
macro_line|#endif /* allow sharing */
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/* search the sample index matching with the given sample id */
r_static
id|awe_sample_list
op_star
DECL|function|search_sample_index
id|search_sample_index
c_func
(paren
id|sf_list
op_star
id|sf
comma
r_int
id|sample
)paren
(brace
id|awe_sample_list
op_star
id|p
suffix:semicolon
macro_line|#ifdef AWE_ALLOW_SAMPLE_SHARING
r_int
id|counter
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|sf
)paren
(brace
r_for
c_loop
(paren
id|p
op_assign
id|sf-&gt;samples
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;v.sample
op_eq
id|sample
)paren
r_return
id|p
suffix:semicolon
)brace
id|sf
op_assign
id|sf-&gt;shared
suffix:semicolon
r_if
c_cond
(paren
id|counter
op_increment
OG
id|current_sf_id
)paren
r_break
suffix:semicolon
multiline_comment|/* strange sharing loop.. quit */
)brace
macro_line|#else
r_if
c_cond
(paren
id|sf
)paren
(brace
r_for
c_loop
(paren
id|p
op_assign
id|sf-&gt;samples
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;v.sample
op_eq
id|sample
)paren
r_return
id|p
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* search the specified sample */
multiline_comment|/* non-zero = found */
r_static
r_int
DECL|function|awe_set_sample
id|awe_set_sample
c_func
(paren
id|awe_voice_list
op_star
id|rec
)paren
(brace
id|awe_sample_list
op_star
id|smp
suffix:semicolon
id|awe_voice_info
op_star
id|vp
op_assign
op_amp
id|rec-&gt;v
suffix:semicolon
id|vp-&gt;index
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|smp
op_assign
id|search_sample_index
c_func
(paren
id|rec-&gt;holder
comma
id|vp-&gt;sample
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* set the actual sample offsets */
id|vp-&gt;start
op_add_assign
id|smp-&gt;v.start
suffix:semicolon
id|vp-&gt;end
op_add_assign
id|smp-&gt;v.end
suffix:semicolon
id|vp-&gt;loopstart
op_add_assign
id|smp-&gt;v.loopstart
suffix:semicolon
id|vp-&gt;loopend
op_add_assign
id|smp-&gt;v.loopend
suffix:semicolon
multiline_comment|/* copy mode flags */
id|vp-&gt;mode
op_assign
id|smp-&gt;v.mode_flags
suffix:semicolon
multiline_comment|/* set flag */
id|vp-&gt;index
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * voice allocation&n; */
multiline_comment|/* look for all voices associated with the specified note &amp; velocity */
r_static
r_int
DECL|function|awe_search_multi_voices
id|awe_search_multi_voices
c_func
(paren
id|awe_voice_list
op_star
id|rec
comma
r_int
id|note
comma
r_int
id|velocity
comma
id|awe_voice_info
op_star
op_star
id|vlist
)paren
(brace
r_int
id|nvoices
suffix:semicolon
id|nvoices
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|rec
suffix:semicolon
id|rec
op_assign
id|rec-&gt;next_instr
)paren
(brace
r_if
c_cond
(paren
id|note
op_ge
id|rec-&gt;v.low
op_logical_and
id|note
op_le
id|rec-&gt;v.high
op_logical_and
id|velocity
op_ge
id|rec-&gt;v.vellow
op_logical_and
id|velocity
op_le
id|rec-&gt;v.velhigh
)paren
(brace
r_if
c_cond
(paren
id|rec-&gt;type
op_eq
id|V_ST_MAPPED
)paren
(brace
multiline_comment|/* mapper */
id|vlist
(braket
l_int|0
)braket
op_assign
op_amp
id|rec-&gt;v
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|vlist
(braket
id|nvoices
op_increment
)braket
op_assign
op_amp
id|rec-&gt;v
suffix:semicolon
r_if
c_cond
(paren
id|nvoices
op_ge
id|AWE_MAX_VOICES
)paren
r_break
suffix:semicolon
)brace
)brace
r_return
id|nvoices
suffix:semicolon
)brace
multiline_comment|/* store the voice list from the specified note and velocity.&n;   if the preset is mapped, seek for the destination preset, and rewrite&n;   the note number if necessary.&n;   */
r_static
r_int
DECL|function|really_alloc_voices
id|really_alloc_voices
c_func
(paren
r_int
id|bank
comma
r_int
id|instr
comma
r_int
op_star
id|note
comma
r_int
id|velocity
comma
id|awe_voice_info
op_star
op_star
id|vlist
)paren
(brace
r_int
id|nvoices
suffix:semicolon
id|awe_voice_list
op_star
id|vrec
suffix:semicolon
r_int
id|level
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|vrec
op_assign
id|awe_search_instr
c_func
(paren
id|bank
comma
id|instr
comma
op_star
id|note
)paren
suffix:semicolon
id|nvoices
op_assign
id|awe_search_multi_voices
c_func
(paren
id|vrec
comma
op_star
id|note
comma
id|velocity
comma
id|vlist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nvoices
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|bank
op_eq
id|AWE_DRUM_BANK
)paren
multiline_comment|/* search default drumset */
id|vrec
op_assign
id|awe_search_instr
c_func
(paren
id|bank
comma
id|ctrls
(braket
id|AWE_MD_DEF_DRUM
)braket
comma
op_star
id|note
)paren
suffix:semicolon
r_else
multiline_comment|/* search default preset */
id|vrec
op_assign
id|awe_search_instr
c_func
(paren
id|ctrls
(braket
id|AWE_MD_DEF_BANK
)braket
comma
id|instr
comma
op_star
id|note
)paren
suffix:semicolon
id|nvoices
op_assign
id|awe_search_multi_voices
c_func
(paren
id|vrec
comma
op_star
id|note
comma
id|velocity
comma
id|vlist
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nvoices
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|bank
op_eq
id|AWE_DRUM_BANK
op_logical_and
id|ctrls
(braket
id|AWE_MD_DEF_DRUM
)braket
op_ne
l_int|0
)paren
multiline_comment|/* search default drumset */
id|vrec
op_assign
id|awe_search_instr
c_func
(paren
id|bank
comma
l_int|0
comma
op_star
id|note
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|bank
op_ne
id|AWE_DRUM_BANK
op_logical_and
id|ctrls
(braket
id|AWE_MD_DEF_BANK
)braket
op_ne
l_int|0
)paren
multiline_comment|/* search default preset */
id|vrec
op_assign
id|awe_search_instr
c_func
(paren
l_int|0
comma
id|instr
comma
op_star
id|note
)paren
suffix:semicolon
id|nvoices
op_assign
id|awe_search_multi_voices
c_func
(paren
id|vrec
comma
op_star
id|note
comma
id|velocity
comma
id|vlist
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nvoices
OL
l_int|0
)paren
(brace
multiline_comment|/* mapping */
r_int
id|key
op_assign
id|vlist
(braket
l_int|0
)braket
op_member_access_from_pointer
id|fixkey
suffix:semicolon
id|instr
op_assign
id|vlist
(braket
l_int|0
)braket
op_member_access_from_pointer
id|start
suffix:semicolon
id|bank
op_assign
id|vlist
(braket
l_int|0
)braket
op_member_access_from_pointer
id|end
suffix:semicolon
r_if
c_cond
(paren
id|level
op_increment
OG
l_int|5
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWE32: too deep mapping level&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|key
op_ge
l_int|0
)paren
op_star
id|note
op_assign
id|key
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
r_return
id|nvoices
suffix:semicolon
)brace
multiline_comment|/* allocate voices corresponding note and velocity; supports multiple insts. */
r_static
r_void
DECL|function|awe_alloc_multi_voices
id|awe_alloc_multi_voices
c_func
(paren
r_int
id|ch
comma
r_int
id|note
comma
r_int
id|velocity
comma
r_int
id|key
)paren
(brace
r_int
id|i
comma
id|v
comma
id|nvoices
comma
id|bank
suffix:semicolon
id|awe_voice_info
op_star
id|vlist
(braket
id|AWE_MAX_VOICES
)braket
suffix:semicolon
r_if
c_cond
(paren
id|MULTI_LAYER_MODE
c_func
(paren
)paren
op_logical_and
id|IS_DRUM_CHANNEL
c_func
(paren
id|ch
)paren
)paren
id|bank
op_assign
id|AWE_DRUM_BANK
suffix:semicolon
multiline_comment|/* always search drumset */
r_else
id|bank
op_assign
id|channels
(braket
id|ch
)braket
dot
id|bank
suffix:semicolon
multiline_comment|/* check the possible voices; note may be changeable if mapped */
id|nvoices
op_assign
id|really_alloc_voices
c_func
(paren
id|bank
comma
id|channels
(braket
id|ch
)braket
dot
id|instr
comma
op_amp
id|note
comma
id|velocity
comma
id|vlist
)paren
suffix:semicolon
multiline_comment|/* set the voices */
id|current_alloc_time
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nvoices
suffix:semicolon
id|i
op_increment
)paren
(brace
id|v
op_assign
id|awe_clear_voice
c_func
(paren
)paren
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|key
op_assign
id|key
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|ch
op_assign
id|ch
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|note
op_assign
id|note
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|velocity
op_assign
id|velocity
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|time
op_assign
id|current_alloc_time
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|cinfo
op_assign
op_amp
id|channels
(braket
id|ch
)braket
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|sample
op_assign
id|vlist
(braket
id|i
)braket
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|state
op_assign
id|AWE_ST_MARK
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|layer
op_assign
id|nvoices
op_minus
id|i
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* in reverse order */
)brace
multiline_comment|/* clear the mark in allocated voices */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|state
op_eq
id|AWE_ST_MARK
)paren
id|voices
(braket
id|i
)braket
dot
id|state
op_assign
id|AWE_ST_OFF
suffix:semicolon
)brace
)brace
multiline_comment|/* search an empty voice.&n;   if no empty voice is found, at least terminate a voice&n;   */
r_static
r_int
DECL|function|awe_clear_voice
id|awe_clear_voice
c_func
(paren
r_void
)paren
(brace
r_enum
(brace
id|OFF
op_assign
l_int|0
comma
id|RELEASED
comma
id|SUSTAINED
comma
id|PLAYING
comma
id|END
)brace
suffix:semicolon
r_struct
id|voice_candidate_t
(brace
r_int
id|best
suffix:semicolon
r_int
id|time
suffix:semicolon
r_int
id|vtarget
suffix:semicolon
)brace
id|candidate
(braket
id|END
)braket
suffix:semicolon
r_int
id|i
comma
id|type
comma
id|vtarget
suffix:semicolon
id|vtarget
op_assign
l_int|0xffff
suffix:semicolon
r_for
c_loop
(paren
id|type
op_assign
id|OFF
suffix:semicolon
id|type
OL
id|END
suffix:semicolon
id|type
op_increment
)paren
(brace
id|candidate
(braket
id|type
)braket
dot
id|best
op_assign
op_minus
l_int|1
suffix:semicolon
id|candidate
(braket
id|type
)braket
dot
id|time
op_assign
id|current_alloc_time
op_plus
l_int|1
suffix:semicolon
id|candidate
(braket
id|type
)braket
dot
id|vtarget
op_assign
id|vtarget
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|state
op_amp
id|AWE_ST_OFF
)paren
id|type
op_assign
id|OFF
suffix:semicolon
r_else
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|state
op_amp
id|AWE_ST_RELEASED
)paren
id|type
op_assign
id|RELEASED
suffix:semicolon
r_else
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|state
op_amp
id|AWE_ST_SUSTAINED
)paren
id|type
op_assign
id|SUSTAINED
suffix:semicolon
r_else
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|state
op_amp
op_complement
id|AWE_ST_MARK
)paren
id|type
op_assign
id|PLAYING
suffix:semicolon
r_else
r_continue
suffix:semicolon
macro_line|#ifdef AWE_CHECK_VTARGET
multiline_comment|/* get current volume */
id|vtarget
op_assign
(paren
id|awe_peek_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|i
)paren
)paren
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|candidate
(braket
id|type
)braket
dot
id|best
OL
l_int|0
op_logical_or
id|vtarget
OL
id|candidate
(braket
id|type
)braket
dot
id|vtarget
op_logical_or
(paren
id|vtarget
op_eq
id|candidate
(braket
id|type
)braket
dot
id|vtarget
op_logical_and
id|voices
(braket
id|i
)braket
dot
id|time
OL
id|candidate
(braket
id|type
)braket
dot
id|time
)paren
)paren
(brace
id|candidate
(braket
id|type
)braket
dot
id|best
op_assign
id|i
suffix:semicolon
id|candidate
(braket
id|type
)braket
dot
id|time
op_assign
id|voices
(braket
id|i
)braket
dot
id|time
suffix:semicolon
id|candidate
(braket
id|type
)braket
dot
id|vtarget
op_assign
id|vtarget
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|type
op_assign
id|OFF
suffix:semicolon
id|type
OL
id|END
suffix:semicolon
id|type
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|i
op_assign
id|candidate
(braket
id|type
)braket
dot
id|best
)paren
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|state
op_ne
id|AWE_ST_OFF
)paren
id|awe_terminate
c_func
(paren
id|i
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|i
comma
id|TRUE
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* search sample for the specified note &amp; velocity and set it on the voice;&n; * note that voice is the voice index (not channel index)&n; */
r_static
r_void
DECL|function|awe_alloc_one_voice
id|awe_alloc_one_voice
c_func
(paren
r_int
id|voice
comma
r_int
id|note
comma
r_int
id|velocity
)paren
(brace
r_int
id|ch
comma
id|nvoices
comma
id|bank
suffix:semicolon
id|awe_voice_info
op_star
id|vlist
(braket
id|AWE_MAX_VOICES
)braket
suffix:semicolon
id|ch
op_assign
id|voices
(braket
id|voice
)braket
dot
id|ch
suffix:semicolon
r_if
c_cond
(paren
id|MULTI_LAYER_MODE
c_func
(paren
)paren
op_logical_and
id|IS_DRUM_CHANNEL
c_func
(paren
id|voice
)paren
)paren
id|bank
op_assign
id|AWE_DRUM_BANK
suffix:semicolon
multiline_comment|/* always search drumset */
r_else
id|bank
op_assign
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;bank
suffix:semicolon
id|nvoices
op_assign
id|really_alloc_voices
c_func
(paren
id|bank
comma
id|voices
(braket
id|voice
)braket
dot
id|cinfo-&gt;instr
comma
op_amp
id|note
comma
id|velocity
comma
id|vlist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nvoices
OG
l_int|0
)paren
(brace
id|voices
(braket
id|voice
)braket
dot
id|time
op_assign
op_increment
id|current_alloc_time
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|sample
op_assign
id|vlist
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* use the first one */
id|voices
(braket
id|voice
)braket
dot
id|layer
op_assign
l_int|0
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|note
op_assign
id|note
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|velocity
op_assign
id|velocity
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * sequencer2 functions&n; */
multiline_comment|/* search an empty voice; used by sequencer2 */
r_static
r_int
DECL|function|awe_alloc
id|awe_alloc
c_func
(paren
r_int
id|dev
comma
r_int
id|chn
comma
r_int
id|note
comma
r_struct
id|voice_alloc_info
op_star
id|alloc
)paren
(brace
id|playing_mode
op_assign
id|AWE_PLAY_MULTI2
suffix:semicolon
id|awe_info.nr_voices
op_assign
id|AWE_MAX_CHANNELS
suffix:semicolon
r_return
id|awe_clear_voice
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* set up voice; used by sequencer2 */
r_static
r_void
DECL|function|awe_setup_voice
id|awe_setup_voice
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|chn
)paren
(brace
r_struct
id|channel_info
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
id|synth_devs
(braket
id|dev
)braket
op_eq
l_int|NULL
op_logical_or
(paren
id|info
op_assign
op_amp
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|chn_info
(braket
id|chn
)braket
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|awe_max_voices
)paren
r_return
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [setup(%d) ch=%d]&bslash;n&quot;
comma
id|voice
comma
id|chn
)paren
)paren
suffix:semicolon
id|channels
(braket
id|chn
)braket
dot
id|expression_vol
op_assign
id|info-&gt;controllers
(braket
id|CTL_EXPRESSION
)braket
suffix:semicolon
id|channels
(braket
id|chn
)braket
dot
id|main_vol
op_assign
id|info-&gt;controllers
(braket
id|CTL_MAIN_VOLUME
)braket
suffix:semicolon
id|channels
(braket
id|chn
)braket
dot
id|panning
op_assign
id|info-&gt;controllers
(braket
id|CTL_PAN
)braket
op_star
l_int|2
op_minus
l_int|128
suffix:semicolon
multiline_comment|/* signed 8bit */
id|channels
(braket
id|chn
)braket
dot
id|bender
op_assign
id|info-&gt;bender_value
suffix:semicolon
multiline_comment|/* zero center */
id|channels
(braket
id|chn
)braket
dot
id|bank
op_assign
id|info-&gt;controllers
(braket
id|CTL_BANK_SELECT
)braket
suffix:semicolon
id|channels
(braket
id|chn
)braket
dot
id|sustained
op_assign
id|info-&gt;controllers
(braket
id|CTL_SUSTAIN
)braket
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;controllers
(braket
id|CTL_EXT_EFF_DEPTH
)braket
)paren
(brace
id|FX_SET
c_func
(paren
op_amp
id|channels
(braket
id|chn
)braket
dot
id|fx
comma
id|AWE_FX_REVERB
comma
id|info-&gt;controllers
(braket
id|CTL_EXT_EFF_DEPTH
)braket
op_star
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;controllers
(braket
id|CTL_CHORUS_DEPTH
)braket
)paren
(brace
id|FX_SET
c_func
(paren
op_amp
id|channels
(braket
id|chn
)braket
dot
id|fx
comma
id|AWE_FX_CHORUS
comma
id|info-&gt;controllers
(braket
id|CTL_CHORUS_DEPTH
)braket
op_star
l_int|2
)paren
suffix:semicolon
)brace
id|awe_set_instr
c_func
(paren
id|dev
comma
id|chn
comma
id|info-&gt;pgm_num
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_AWE32_MIXER
multiline_comment|/*&n; * AWE32 mixer device control&n; */
r_static
r_int
id|awe_mixer_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
suffix:semicolon
DECL|variable|my_mixerdev
r_static
r_int
id|my_mixerdev
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|awe_mixer_operations
r_static
r_struct
id|mixer_operations
id|awe_mixer_operations
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|id
suffix:colon
l_string|&quot;AWE&quot;
comma
id|name
suffix:colon
l_string|&quot;AWE32 Equalizer&quot;
comma
id|ioctl
suffix:colon
id|awe_mixer_ioctl
comma
)brace
suffix:semicolon
DECL|function|attach_mixer
r_static
r_void
id|__init
id|attach_mixer
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
(paren
id|my_mixerdev
op_assign
id|sound_alloc_mixerdev
c_func
(paren
)paren
)paren
op_ge
l_int|0
)paren
(brace
id|mixer_devs
(braket
id|my_mixerdev
)braket
op_assign
op_amp
id|awe_mixer_operations
suffix:semicolon
)brace
)brace
DECL|function|unload_mixer
r_static
r_void
id|__exit
id|unload_mixer
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|my_mixerdev
op_ge
l_int|0
)paren
id|sound_unload_mixerdev
c_func
(paren
id|my_mixerdev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|awe_mixer_ioctl
id|awe_mixer_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
r_int
id|i
comma
id|level
comma
id|value
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|cmd
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_ne
l_char|&squot;M&squot;
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|level
op_assign
op_star
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
id|level
op_assign
(paren
(paren
id|level
op_amp
l_int|0xff
)paren
op_plus
(paren
id|level
op_rshift
l_int|8
)paren
)paren
op_div
l_int|2
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWEMix: cmd=%x val=%d&bslash;n&quot;
comma
id|cmd
op_amp
l_int|0xff
comma
id|level
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_amp
id|_SIOC_WRITE
)paren
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
id|SOUND_MIXER_BASS
suffix:colon
id|value
op_assign
id|level
op_star
l_int|12
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ge
l_int|12
)paren
id|value
op_assign
l_int|11
suffix:semicolon
id|ctrls
(braket
id|AWE_MD_BASS_LEVEL
)braket
op_assign
id|value
suffix:semicolon
id|awe_update_equalizer
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_TREBLE
suffix:colon
id|value
op_assign
id|level
op_star
l_int|12
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ge
l_int|12
)paren
id|value
op_assign
l_int|11
suffix:semicolon
id|ctrls
(braket
id|AWE_MD_TREBLE_LEVEL
)braket
op_assign
id|value
suffix:semicolon
id|awe_update_equalizer
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
id|level
op_assign
id|level
op_star
l_int|127
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|level
op_ge
l_int|128
)paren
id|level
op_assign
l_int|127
suffix:semicolon
id|atten_relative
op_assign
id|FALSE
suffix:semicolon
id|atten_offset
op_assign
id|vol_table
(braket
id|level
)braket
suffix:semicolon
id|awe_update_volume
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
id|SOUND_MIXER_BASS
suffix:colon
id|level
op_assign
id|ctrls
(braket
id|AWE_MD_BASS_LEVEL
)braket
op_star
l_int|100
op_div
l_int|24
suffix:semicolon
id|level
op_assign
(paren
id|level
op_lshift
l_int|8
)paren
op_or
id|level
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_TREBLE
suffix:colon
id|level
op_assign
id|ctrls
(braket
id|AWE_MD_TREBLE_LEVEL
)braket
op_star
l_int|100
op_div
l_int|24
suffix:semicolon
id|level
op_assign
(paren
id|level
op_lshift
l_int|8
)paren
op_or
id|level
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
id|value
op_assign
id|atten_offset
suffix:semicolon
r_if
c_cond
(paren
id|atten_relative
)paren
id|value
op_add_assign
id|ctrls
(braket
id|AWE_MD_ZERO_ATTEN
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|127
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|value
op_le
id|vol_table
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
)brace
id|level
op_assign
id|i
op_star
l_int|100
op_div
l_int|127
suffix:semicolon
id|level
op_assign
(paren
id|level
op_lshift
l_int|8
)paren
op_or
id|level
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
id|level
op_assign
id|SOUND_MASK_BASS
op_or
id|SOUND_MASK_TREBLE
op_or
id|SOUND_MASK_VOLUME
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|level
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
op_star
(paren
r_int
op_star
)paren
id|arg
op_assign
id|level
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AWE32_MIXER */
multiline_comment|/*&n; * initialization of Emu8000&n; */
multiline_comment|/* intiailize audio channels */
r_static
r_void
DECL|function|awe_init_audio
id|awe_init_audio
c_func
(paren
r_void
)paren
(brace
r_int
id|ch
suffix:semicolon
multiline_comment|/* turn off envelope engines */
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|ch
)paren
comma
l_int|0x80
)paren
suffix:semicolon
)brace
multiline_comment|/* reset all other parameters to zero */
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_ENVVOL
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ENVVAL
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUS
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ATKHLDV
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_LFO1VAL
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ATKHLD
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_LFO2VAL
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IP
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IFATN
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_PEFE
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FMMOD
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_TREMFRQ
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FM2FRQ2
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* initialize DMA address */
r_static
r_void
DECL|function|awe_init_dma
id|awe_init_dma
c_func
(paren
r_void
)paren
(brace
id|awe_poke_dw
c_func
(paren
id|AWE_SMALR
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_SMARR
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_SMALW
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_SMARW
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* initialization arrays; from ADIP */
DECL|variable|init1
r_static
r_int
r_int
id|init1
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x03ff
comma
l_int|0x0030
comma
l_int|0x07ff
comma
l_int|0x0130
comma
l_int|0x0bff
comma
l_int|0x0230
comma
l_int|0x0fff
comma
l_int|0x0330
comma
l_int|0x13ff
comma
l_int|0x0430
comma
l_int|0x17ff
comma
l_int|0x0530
comma
l_int|0x1bff
comma
l_int|0x0630
comma
l_int|0x1fff
comma
l_int|0x0730
comma
l_int|0x23ff
comma
l_int|0x0830
comma
l_int|0x27ff
comma
l_int|0x0930
comma
l_int|0x2bff
comma
l_int|0x0a30
comma
l_int|0x2fff
comma
l_int|0x0b30
comma
l_int|0x33ff
comma
l_int|0x0c30
comma
l_int|0x37ff
comma
l_int|0x0d30
comma
l_int|0x3bff
comma
l_int|0x0e30
comma
l_int|0x3fff
comma
l_int|0x0f30
comma
l_int|0x43ff
comma
l_int|0x0030
comma
l_int|0x47ff
comma
l_int|0x0130
comma
l_int|0x4bff
comma
l_int|0x0230
comma
l_int|0x4fff
comma
l_int|0x0330
comma
l_int|0x53ff
comma
l_int|0x0430
comma
l_int|0x57ff
comma
l_int|0x0530
comma
l_int|0x5bff
comma
l_int|0x0630
comma
l_int|0x5fff
comma
l_int|0x0730
comma
l_int|0x63ff
comma
l_int|0x0830
comma
l_int|0x67ff
comma
l_int|0x0930
comma
l_int|0x6bff
comma
l_int|0x0a30
comma
l_int|0x6fff
comma
l_int|0x0b30
comma
l_int|0x73ff
comma
l_int|0x0c30
comma
l_int|0x77ff
comma
l_int|0x0d30
comma
l_int|0x7bff
comma
l_int|0x0e30
comma
l_int|0x7fff
comma
l_int|0x0f30
comma
l_int|0x83ff
comma
l_int|0x0030
comma
l_int|0x87ff
comma
l_int|0x0130
comma
l_int|0x8bff
comma
l_int|0x0230
comma
l_int|0x8fff
comma
l_int|0x0330
comma
l_int|0x93ff
comma
l_int|0x0430
comma
l_int|0x97ff
comma
l_int|0x0530
comma
l_int|0x9bff
comma
l_int|0x0630
comma
l_int|0x9fff
comma
l_int|0x0730
comma
l_int|0xa3ff
comma
l_int|0x0830
comma
l_int|0xa7ff
comma
l_int|0x0930
comma
l_int|0xabff
comma
l_int|0x0a30
comma
l_int|0xafff
comma
l_int|0x0b30
comma
l_int|0xb3ff
comma
l_int|0x0c30
comma
l_int|0xb7ff
comma
l_int|0x0d30
comma
l_int|0xbbff
comma
l_int|0x0e30
comma
l_int|0xbfff
comma
l_int|0x0f30
comma
l_int|0xc3ff
comma
l_int|0x0030
comma
l_int|0xc7ff
comma
l_int|0x0130
comma
l_int|0xcbff
comma
l_int|0x0230
comma
l_int|0xcfff
comma
l_int|0x0330
comma
l_int|0xd3ff
comma
l_int|0x0430
comma
l_int|0xd7ff
comma
l_int|0x0530
comma
l_int|0xdbff
comma
l_int|0x0630
comma
l_int|0xdfff
comma
l_int|0x0730
comma
l_int|0xe3ff
comma
l_int|0x0830
comma
l_int|0xe7ff
comma
l_int|0x0930
comma
l_int|0xebff
comma
l_int|0x0a30
comma
l_int|0xefff
comma
l_int|0x0b30
comma
l_int|0xf3ff
comma
l_int|0x0c30
comma
l_int|0xf7ff
comma
l_int|0x0d30
comma
l_int|0xfbff
comma
l_int|0x0e30
comma
l_int|0xffff
comma
l_int|0x0f30
comma
)brace
suffix:semicolon
DECL|variable|init2
r_static
r_int
r_int
id|init2
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x03ff
comma
l_int|0x8030
comma
l_int|0x07ff
comma
l_int|0x8130
comma
l_int|0x0bff
comma
l_int|0x8230
comma
l_int|0x0fff
comma
l_int|0x8330
comma
l_int|0x13ff
comma
l_int|0x8430
comma
l_int|0x17ff
comma
l_int|0x8530
comma
l_int|0x1bff
comma
l_int|0x8630
comma
l_int|0x1fff
comma
l_int|0x8730
comma
l_int|0x23ff
comma
l_int|0x8830
comma
l_int|0x27ff
comma
l_int|0x8930
comma
l_int|0x2bff
comma
l_int|0x8a30
comma
l_int|0x2fff
comma
l_int|0x8b30
comma
l_int|0x33ff
comma
l_int|0x8c30
comma
l_int|0x37ff
comma
l_int|0x8d30
comma
l_int|0x3bff
comma
l_int|0x8e30
comma
l_int|0x3fff
comma
l_int|0x8f30
comma
l_int|0x43ff
comma
l_int|0x8030
comma
l_int|0x47ff
comma
l_int|0x8130
comma
l_int|0x4bff
comma
l_int|0x8230
comma
l_int|0x4fff
comma
l_int|0x8330
comma
l_int|0x53ff
comma
l_int|0x8430
comma
l_int|0x57ff
comma
l_int|0x8530
comma
l_int|0x5bff
comma
l_int|0x8630
comma
l_int|0x5fff
comma
l_int|0x8730
comma
l_int|0x63ff
comma
l_int|0x8830
comma
l_int|0x67ff
comma
l_int|0x8930
comma
l_int|0x6bff
comma
l_int|0x8a30
comma
l_int|0x6fff
comma
l_int|0x8b30
comma
l_int|0x73ff
comma
l_int|0x8c30
comma
l_int|0x77ff
comma
l_int|0x8d30
comma
l_int|0x7bff
comma
l_int|0x8e30
comma
l_int|0x7fff
comma
l_int|0x8f30
comma
l_int|0x83ff
comma
l_int|0x8030
comma
l_int|0x87ff
comma
l_int|0x8130
comma
l_int|0x8bff
comma
l_int|0x8230
comma
l_int|0x8fff
comma
l_int|0x8330
comma
l_int|0x93ff
comma
l_int|0x8430
comma
l_int|0x97ff
comma
l_int|0x8530
comma
l_int|0x9bff
comma
l_int|0x8630
comma
l_int|0x9fff
comma
l_int|0x8730
comma
l_int|0xa3ff
comma
l_int|0x8830
comma
l_int|0xa7ff
comma
l_int|0x8930
comma
l_int|0xabff
comma
l_int|0x8a30
comma
l_int|0xafff
comma
l_int|0x8b30
comma
l_int|0xb3ff
comma
l_int|0x8c30
comma
l_int|0xb7ff
comma
l_int|0x8d30
comma
l_int|0xbbff
comma
l_int|0x8e30
comma
l_int|0xbfff
comma
l_int|0x8f30
comma
l_int|0xc3ff
comma
l_int|0x8030
comma
l_int|0xc7ff
comma
l_int|0x8130
comma
l_int|0xcbff
comma
l_int|0x8230
comma
l_int|0xcfff
comma
l_int|0x8330
comma
l_int|0xd3ff
comma
l_int|0x8430
comma
l_int|0xd7ff
comma
l_int|0x8530
comma
l_int|0xdbff
comma
l_int|0x8630
comma
l_int|0xdfff
comma
l_int|0x8730
comma
l_int|0xe3ff
comma
l_int|0x8830
comma
l_int|0xe7ff
comma
l_int|0x8930
comma
l_int|0xebff
comma
l_int|0x8a30
comma
l_int|0xefff
comma
l_int|0x8b30
comma
l_int|0xf3ff
comma
l_int|0x8c30
comma
l_int|0xf7ff
comma
l_int|0x8d30
comma
l_int|0xfbff
comma
l_int|0x8e30
comma
l_int|0xffff
comma
l_int|0x8f30
comma
)brace
suffix:semicolon
DECL|variable|init3
r_static
r_int
r_int
id|init3
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x0C10
comma
l_int|0x8470
comma
l_int|0x14FE
comma
l_int|0xB488
comma
l_int|0x167F
comma
l_int|0xA470
comma
l_int|0x18E7
comma
l_int|0x84B5
comma
l_int|0x1B6E
comma
l_int|0x842A
comma
l_int|0x1F1D
comma
l_int|0x852A
comma
l_int|0x0DA3
comma
l_int|0x8F7C
comma
l_int|0x167E
comma
l_int|0xF254
comma
l_int|0x0000
comma
l_int|0x842A
comma
l_int|0x0001
comma
l_int|0x852A
comma
l_int|0x18E6
comma
l_int|0x8BAA
comma
l_int|0x1B6D
comma
l_int|0xF234
comma
l_int|0x229F
comma
l_int|0x8429
comma
l_int|0x2746
comma
l_int|0x8529
comma
l_int|0x1F1C
comma
l_int|0x86E7
comma
l_int|0x229E
comma
l_int|0xF224
comma
l_int|0x0DA4
comma
l_int|0x8429
comma
l_int|0x2C29
comma
l_int|0x8529
comma
l_int|0x2745
comma
l_int|0x87F6
comma
l_int|0x2C28
comma
l_int|0xF254
comma
l_int|0x383B
comma
l_int|0x8428
comma
l_int|0x320F
comma
l_int|0x8528
comma
l_int|0x320E
comma
l_int|0x8F02
comma
l_int|0x1341
comma
l_int|0xF264
comma
l_int|0x3EB6
comma
l_int|0x8428
comma
l_int|0x3EB9
comma
l_int|0x8528
comma
l_int|0x383A
comma
l_int|0x8FA9
comma
l_int|0x3EB5
comma
l_int|0xF294
comma
l_int|0x3EB7
comma
l_int|0x8474
comma
l_int|0x3EBA
comma
l_int|0x8575
comma
l_int|0x3EB8
comma
l_int|0xC4C3
comma
l_int|0x3EBB
comma
l_int|0xC5C3
comma
l_int|0x0000
comma
l_int|0xA404
comma
l_int|0x0001
comma
l_int|0xA504
comma
l_int|0x141F
comma
l_int|0x8671
comma
l_int|0x14FD
comma
l_int|0x8287
comma
l_int|0x3EBC
comma
l_int|0xE610
comma
l_int|0x3EC8
comma
l_int|0x8C7B
comma
l_int|0x031A
comma
l_int|0x87E6
comma
l_int|0x3EC8
comma
l_int|0x86F7
comma
l_int|0x3EC0
comma
l_int|0x821E
comma
l_int|0x3EBE
comma
l_int|0xD208
comma
l_int|0x3EBD
comma
l_int|0x821F
comma
l_int|0x3ECA
comma
l_int|0x8386
comma
l_int|0x3EC1
comma
l_int|0x8C03
comma
l_int|0x3EC9
comma
l_int|0x831E
comma
l_int|0x3ECA
comma
l_int|0x8C4C
comma
l_int|0x3EBF
comma
l_int|0x8C55
comma
l_int|0x3EC9
comma
l_int|0xC208
comma
l_int|0x3EC4
comma
l_int|0xBC84
comma
l_int|0x3EC8
comma
l_int|0x8EAD
comma
l_int|0x3EC8
comma
l_int|0xD308
comma
l_int|0x3EC2
comma
l_int|0x8F7E
comma
l_int|0x3ECB
comma
l_int|0x8219
comma
l_int|0x3ECB
comma
l_int|0xD26E
comma
l_int|0x3EC5
comma
l_int|0x831F
comma
l_int|0x3EC6
comma
l_int|0xC308
comma
l_int|0x3EC3
comma
l_int|0xB2FF
comma
l_int|0x3EC9
comma
l_int|0x8265
comma
l_int|0x3EC9
comma
l_int|0x8319
comma
l_int|0x1342
comma
l_int|0xD36E
comma
l_int|0x3EC7
comma
l_int|0xB3FF
comma
l_int|0x0000
comma
l_int|0x8365
comma
l_int|0x1420
comma
l_int|0x9570
comma
)brace
suffix:semicolon
DECL|variable|init4
r_static
r_int
r_int
id|init4
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x0C10
comma
l_int|0x8470
comma
l_int|0x14FE
comma
l_int|0xB488
comma
l_int|0x167F
comma
l_int|0xA470
comma
l_int|0x18E7
comma
l_int|0x84B5
comma
l_int|0x1B6E
comma
l_int|0x842A
comma
l_int|0x1F1D
comma
l_int|0x852A
comma
l_int|0x0DA3
comma
l_int|0x0F7C
comma
l_int|0x167E
comma
l_int|0x7254
comma
l_int|0x0000
comma
l_int|0x842A
comma
l_int|0x0001
comma
l_int|0x852A
comma
l_int|0x18E6
comma
l_int|0x0BAA
comma
l_int|0x1B6D
comma
l_int|0x7234
comma
l_int|0x229F
comma
l_int|0x8429
comma
l_int|0x2746
comma
l_int|0x8529
comma
l_int|0x1F1C
comma
l_int|0x06E7
comma
l_int|0x229E
comma
l_int|0x7224
comma
l_int|0x0DA4
comma
l_int|0x8429
comma
l_int|0x2C29
comma
l_int|0x8529
comma
l_int|0x2745
comma
l_int|0x07F6
comma
l_int|0x2C28
comma
l_int|0x7254
comma
l_int|0x383B
comma
l_int|0x8428
comma
l_int|0x320F
comma
l_int|0x8528
comma
l_int|0x320E
comma
l_int|0x0F02
comma
l_int|0x1341
comma
l_int|0x7264
comma
l_int|0x3EB6
comma
l_int|0x8428
comma
l_int|0x3EB9
comma
l_int|0x8528
comma
l_int|0x383A
comma
l_int|0x0FA9
comma
l_int|0x3EB5
comma
l_int|0x7294
comma
l_int|0x3EB7
comma
l_int|0x8474
comma
l_int|0x3EBA
comma
l_int|0x8575
comma
l_int|0x3EB8
comma
l_int|0x44C3
comma
l_int|0x3EBB
comma
l_int|0x45C3
comma
l_int|0x0000
comma
l_int|0xA404
comma
l_int|0x0001
comma
l_int|0xA504
comma
l_int|0x141F
comma
l_int|0x0671
comma
l_int|0x14FD
comma
l_int|0x0287
comma
l_int|0x3EBC
comma
l_int|0xE610
comma
l_int|0x3EC8
comma
l_int|0x0C7B
comma
l_int|0x031A
comma
l_int|0x07E6
comma
l_int|0x3EC8
comma
l_int|0x86F7
comma
l_int|0x3EC0
comma
l_int|0x821E
comma
l_int|0x3EBE
comma
l_int|0xD208
comma
l_int|0x3EBD
comma
l_int|0x021F
comma
l_int|0x3ECA
comma
l_int|0x0386
comma
l_int|0x3EC1
comma
l_int|0x0C03
comma
l_int|0x3EC9
comma
l_int|0x031E
comma
l_int|0x3ECA
comma
l_int|0x8C4C
comma
l_int|0x3EBF
comma
l_int|0x0C55
comma
l_int|0x3EC9
comma
l_int|0xC208
comma
l_int|0x3EC4
comma
l_int|0xBC84
comma
l_int|0x3EC8
comma
l_int|0x0EAD
comma
l_int|0x3EC8
comma
l_int|0xD308
comma
l_int|0x3EC2
comma
l_int|0x8F7E
comma
l_int|0x3ECB
comma
l_int|0x0219
comma
l_int|0x3ECB
comma
l_int|0xD26E
comma
l_int|0x3EC5
comma
l_int|0x031F
comma
l_int|0x3EC6
comma
l_int|0xC308
comma
l_int|0x3EC3
comma
l_int|0x32FF
comma
l_int|0x3EC9
comma
l_int|0x0265
comma
l_int|0x3EC9
comma
l_int|0x8319
comma
l_int|0x1342
comma
l_int|0xD36E
comma
l_int|0x3EC7
comma
l_int|0x33FF
comma
l_int|0x0000
comma
l_int|0x8365
comma
l_int|0x1420
comma
l_int|0x9570
comma
)brace
suffix:semicolon
multiline_comment|/* send initialization arrays to start up */
r_static
r_void
DECL|function|awe_init_array
id|awe_init_array
c_func
(paren
r_void
)paren
(brace
id|awe_send_array
c_func
(paren
id|init1
)paren
suffix:semicolon
id|awe_wait
c_func
(paren
l_int|1024
)paren
suffix:semicolon
id|awe_send_array
c_func
(paren
id|init2
)paren
suffix:semicolon
id|awe_send_array
c_func
(paren
id|init3
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_HWCF4
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_HWCF5
comma
l_int|0x83
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_HWCF6
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_send_array
c_func
(paren
id|init4
)paren
suffix:semicolon
)brace
multiline_comment|/* send an initialization array */
r_static
r_void
DECL|function|awe_send_array
id|awe_send_array
c_func
(paren
r_int
r_int
op_star
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
op_star
id|p
suffix:semicolon
id|p
op_assign
id|data
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|awe_poke
c_func
(paren
id|AWE_INIT1
c_func
(paren
id|i
)paren
comma
op_star
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|awe_poke
c_func
(paren
id|AWE_INIT2
c_func
(paren
id|i
)paren
comma
op_star
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|awe_poke
c_func
(paren
id|AWE_INIT3
c_func
(paren
id|i
)paren
comma
op_star
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
id|i
)paren
comma
op_star
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * set up awe32 channels to some known state.&n; */
multiline_comment|/* set the envelope &amp; LFO parameters to the default values; see ADIP */
r_static
r_void
DECL|function|awe_tweak_voice
id|awe_tweak_voice
c_func
(paren
r_int
id|i
)paren
(brace
multiline_comment|/* set all mod/vol envelope shape to minimum */
id|awe_poke
c_func
(paren
id|AWE_ENVVOL
c_func
(paren
id|i
)paren
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ENVVAL
c_func
(paren
id|i
)paren
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUS
c_func
(paren
id|i
)paren
comma
l_int|0x7F7F
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ATKHLDV
c_func
(paren
id|i
)paren
comma
l_int|0x7F7F
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ATKHLD
c_func
(paren
id|i
)paren
comma
l_int|0x7F7F
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_PEFE
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* mod envelope height to zero */
id|awe_poke
c_func
(paren
id|AWE_LFO1VAL
c_func
(paren
id|i
)paren
comma
l_int|0x8000
)paren
suffix:semicolon
multiline_comment|/* no delay for LFO1 */
id|awe_poke
c_func
(paren
id|AWE_LFO2VAL
c_func
(paren
id|i
)paren
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IP
c_func
(paren
id|i
)paren
comma
l_int|0xE000
)paren
suffix:semicolon
multiline_comment|/* no pitch shift */
id|awe_poke
c_func
(paren
id|AWE_IFATN
c_func
(paren
id|i
)paren
comma
l_int|0xFF00
)paren
suffix:semicolon
multiline_comment|/* volume to minimum */
id|awe_poke
c_func
(paren
id|AWE_FMMOD
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_TREMFRQ
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FM2FRQ2
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_tweak
id|awe_tweak
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* reset all channels */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
id|awe_tweak_voice
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  initializes the FM section of AWE32;&n; *   see Vince Vu&squot;s unofficial AWE32 programming guide&n; */
r_static
r_void
DECL|function|awe_init_fm
id|awe_init_fm
c_func
(paren
r_void
)paren
(brace
macro_line|#ifndef AWE_ALWAYS_INIT_FM
multiline_comment|/* if no extended memory is on board.. */
r_if
c_cond
(paren
id|memsize
op_le
l_int|0
)paren
r_return
suffix:semicolon
macro_line|#endif
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: initializing FM&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* Initialize the last two channels for DRAM refresh and producing&n;&t;   the reverb and chorus effects for Yamaha OPL-3 synthesizer */
multiline_comment|/* 31: FM left channel, 0xffffe0-0xffffe8 */
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
l_int|30
)paren
comma
l_int|0x80
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
l_int|30
)paren
comma
l_int|0xFFFFFFE0
)paren
suffix:semicolon
multiline_comment|/* full left */
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
l_int|30
)paren
comma
l_int|0x00FFFFE8
op_or
(paren
id|DEF_FM_CHORUS_DEPTH
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
l_int|30
)paren
comma
(paren
id|DEF_FM_REVERB_DEPTH
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
l_int|30
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
l_int|30
)paren
comma
l_int|0x00FFFFE3
)paren
suffix:semicolon
multiline_comment|/* 32: FM right channel, 0xfffff0-0xfffff8 */
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
l_int|31
)paren
comma
l_int|0x80
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
l_int|31
)paren
comma
l_int|0x00FFFFF0
)paren
suffix:semicolon
multiline_comment|/* full right */
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
l_int|31
)paren
comma
l_int|0x00FFFFF8
op_or
(paren
id|DEF_FM_CHORUS_DEPTH
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
l_int|31
)paren
comma
(paren
id|DEF_FM_REVERB_DEPTH
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
l_int|31
)paren
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
l_int|31
)paren
comma
l_int|0x00FFFFF3
)paren
suffix:semicolon
multiline_comment|/* skew volume &amp; cutoff */
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
l_int|30
)paren
comma
l_int|0x8000FFFF
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
l_int|31
)paren
comma
l_int|0x8000FFFF
)paren
suffix:semicolon
id|voices
(braket
l_int|30
)braket
dot
id|state
op_assign
id|AWE_ST_FM
suffix:semicolon
id|voices
(braket
l_int|31
)braket
dot
id|state
op_assign
id|AWE_ST_FM
suffix:semicolon
multiline_comment|/* change maximum channels to 30 */
id|awe_max_voices
op_assign
id|AWE_NORMAL_VOICES
suffix:semicolon
r_if
c_cond
(paren
id|playing_mode
op_eq
id|AWE_PLAY_DIRECT
)paren
id|awe_info.nr_voices
op_assign
id|awe_max_voices
suffix:semicolon
r_else
id|awe_info.nr_voices
op_assign
id|AWE_MAX_CHANNELS
suffix:semicolon
id|voice_alloc-&gt;max_voice
op_assign
id|awe_max_voices
suffix:semicolon
)brace
multiline_comment|/*&n; *  AWE32 DRAM access routines&n; */
multiline_comment|/* open DRAM write accessing mode */
r_static
r_int
DECL|function|awe_open_dram_for_write
id|awe_open_dram_for_write
c_func
(paren
r_int
id|offset
comma
r_int
id|channels
)paren
(brace
r_int
id|vidx
(braket
id|AWE_NORMAL_VOICES
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|channels
OL
l_int|0
op_logical_or
id|channels
op_ge
id|AWE_NORMAL_VOICES
)paren
(brace
id|channels
op_assign
id|AWE_NORMAL_VOICES
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|i
op_increment
)paren
id|vidx
(braket
id|i
)braket
op_assign
id|i
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|channels
suffix:semicolon
id|i
op_increment
)paren
(brace
id|vidx
(braket
id|i
)braket
op_assign
id|awe_clear_voice
c_func
(paren
)paren
suffix:semicolon
id|voices
(braket
id|vidx
(braket
id|i
)braket
)braket
dot
id|state
op_assign
id|AWE_ST_MARK
suffix:semicolon
)brace
)brace
multiline_comment|/* use all channels for DMA transfer */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|channels
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|vidx
(braket
id|i
)braket
OL
l_int|0
)paren
r_continue
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|vidx
(braket
id|i
)braket
)paren
comma
l_int|0x80
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|vidx
(braket
id|i
)braket
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|vidx
(braket
id|i
)braket
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|vidx
(braket
id|i
)braket
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
id|vidx
(braket
id|i
)braket
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
id|vidx
(braket
id|i
)braket
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
id|vidx
(braket
id|i
)braket
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|vidx
(braket
id|i
)braket
)paren
comma
l_int|0x06000000
)paren
suffix:semicolon
id|voices
(braket
id|vidx
(braket
id|i
)braket
)braket
dot
id|state
op_assign
id|AWE_ST_DRAM
suffix:semicolon
)brace
multiline_comment|/* point channels 31 &amp; 32 to ROM samples for DRAM refresh */
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
l_int|30
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
l_int|30
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
l_int|30
)paren
comma
l_int|0x1e0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
l_int|30
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
l_int|31
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
l_int|31
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
l_int|31
)paren
comma
l_int|0x1e0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
l_int|31
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
id|voices
(braket
l_int|30
)braket
dot
id|state
op_assign
id|AWE_ST_FM
suffix:semicolon
id|voices
(braket
l_int|31
)braket
dot
id|state
op_assign
id|AWE_ST_FM
suffix:semicolon
multiline_comment|/* if full bit is on, not ready to write on */
r_if
c_cond
(paren
id|awe_peek_dw
c_func
(paren
id|AWE_SMALW
)paren
op_amp
l_int|0x80000000
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|channels
suffix:semicolon
id|i
op_increment
)paren
(brace
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|vidx
(braket
id|i
)braket
)paren
comma
l_int|0
)paren
suffix:semicolon
id|voices
(braket
id|vidx
(braket
id|i
)braket
)braket
dot
id|state
op_assign
id|AWE_ST_OFF
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;awe: not ready to write..&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
multiline_comment|/* set address to write */
id|awe_poke_dw
c_func
(paren
id|AWE_SMALW
comma
id|offset
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* open DRAM for RAM size detection */
r_static
r_void
DECL|function|awe_open_dram_for_check
id|awe_open_dram_for_check
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|i
)paren
comma
l_int|0x80
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|i
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
id|i
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_amp
l_int|1
)paren
multiline_comment|/* DMA write */
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|i
)paren
comma
l_int|0x06000000
)paren
suffix:semicolon
r_else
multiline_comment|/* DMA read */
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|i
)paren
comma
l_int|0x04000000
)paren
suffix:semicolon
id|voices
(braket
id|i
)braket
dot
id|state
op_assign
id|AWE_ST_DRAM
suffix:semicolon
)brace
)brace
multiline_comment|/* close dram access */
r_static
r_void
DECL|function|awe_close_dram
id|awe_close_dram
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* wait until FULL bit in SMAxW register be false */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|awe_peek_dw
c_func
(paren
id|AWE_SMALW
)paren
op_amp
l_int|0x80000000
)paren
)paren
r_break
suffix:semicolon
id|awe_wait
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|voices
(braket
id|i
)braket
dot
id|state
op_eq
id|AWE_ST_DRAM
)paren
(brace
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|i
)paren
comma
l_int|0x807F
)paren
suffix:semicolon
id|voices
(braket
id|i
)braket
dot
id|state
op_assign
id|AWE_ST_OFF
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * detect presence of AWE32 and check memory size&n; */
multiline_comment|/* detect emu8000 chip on the specified address; from VV&squot;s guide */
r_static
r_int
id|__init
DECL|function|awe_detect_base
id|awe_detect_base
c_func
(paren
r_int
id|addr
)paren
(brace
id|setup_ports
c_func
(paren
id|addr
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|awe_peek
c_func
(paren
id|AWE_U1
)paren
op_amp
l_int|0x000F
)paren
op_ne
l_int|0x000C
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|awe_peek
c_func
(paren
id|AWE_HWCF1
)paren
op_amp
l_int|0x007E
)paren
op_ne
l_int|0x0058
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|awe_peek
c_func
(paren
id|AWE_HWCF2
)paren
op_amp
l_int|0x0003
)paren
op_ne
l_int|0x0003
)paren
r_return
l_int|0
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32 found at %x&bslash;n&quot;
comma
id|addr
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
r_static
r_struct
(brace
DECL|member|vendor
r_int
r_int
id|vendor
suffix:semicolon
DECL|member|function
r_int
r_int
id|function
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|__initdata
)brace
id|isapnp_awe_list
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;T&squot;
comma
l_char|&squot;L&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x0021
)paren
comma
l_string|&quot;AWE32 WaveTable&quot;
)brace
comma
(brace
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;T&squot;
comma
l_char|&squot;L&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x0022
)paren
comma
l_string|&quot;AWE64 WaveTable&quot;
)brace
comma
(brace
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;T&squot;
comma
l_char|&squot;L&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x0023
)paren
comma
l_string|&quot;AWE64 Gold WaveTable&quot;
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|variable|idev
r_static
r_struct
id|pci_dev
op_star
id|idev
op_assign
l_int|NULL
suffix:semicolon
DECL|function|awe_probe_isapnp
r_static
r_int
id|__init
id|awe_probe_isapnp
c_func
(paren
r_int
op_star
id|port
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|isapnp_awe_list
(braket
id|i
)braket
dot
id|vendor
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
r_while
c_loop
(paren
(paren
id|idev
op_assign
id|isapnp_find_dev
c_func
(paren
l_int|NULL
comma
id|isapnp_awe_list
(braket
id|i
)braket
dot
id|vendor
comma
id|isapnp_awe_list
(braket
id|i
)braket
dot
id|function
comma
id|idev
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|idev
op_member_access_from_pointer
id|prepare
c_func
(paren
id|idev
)paren
OL
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|idev
op_member_access_from_pointer
id|activate
c_func
(paren
id|idev
)paren
OL
l_int|0
op_logical_or
op_logical_neg
id|idev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
)paren
(brace
id|idev
op_member_access_from_pointer
id|deactivate
c_func
(paren
id|idev
)paren
suffix:semicolon
id|idev
op_member_access_from_pointer
id|deactivate
c_func
(paren
id|idev
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
op_star
id|port
op_assign
id|idev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|idev
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ISAPnP reports %s at i/o %#x&bslash;n&quot;
comma
id|isapnp_awe_list
(braket
id|i
)braket
dot
id|name
comma
op_star
id|port
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|awe_deactivate_isapnp
r_static
r_void
id|__exit
id|awe_deactivate_isapnp
c_func
(paren
r_void
)paren
(brace
macro_line|#if 1
r_if
c_cond
(paren
id|idev
)paren
(brace
id|idev
op_member_access_from_pointer
id|deactivate
c_func
(paren
id|idev
)paren
suffix:semicolon
id|idev
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
)brace
macro_line|#endif
r_static
r_int
id|__init
DECL|function|awe_detect
id|awe_detect
c_func
(paren
r_void
)paren
(brace
r_int
id|base
suffix:semicolon
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
r_if
c_cond
(paren
id|isapnp
)paren
(brace
r_if
c_cond
(paren
id|awe_probe_isapnp
c_func
(paren
op_amp
id|io
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWE32: No ISAPnP cards found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|setup_ports
c_func
(paren
id|io
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif /* isapnp */
r_if
c_cond
(paren
id|io
)paren
multiline_comment|/* use default i/o port value */
id|setup_ports
c_func
(paren
id|io
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* probe it */
r_for
c_loop
(paren
id|base
op_assign
l_int|0x620
suffix:semicolon
id|base
op_le
l_int|0x680
suffix:semicolon
id|base
op_add_assign
l_int|0x20
)paren
r_if
c_cond
(paren
id|awe_detect_base
c_func
(paren
id|base
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32 not found&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * check dram size on AWE board&n; */
multiline_comment|/* any three numbers you like */
DECL|macro|UNIQUE_ID1
mdefine_line|#define UNIQUE_ID1&t;0x1234
DECL|macro|UNIQUE_ID2
mdefine_line|#define UNIQUE_ID2&t;0x4321
DECL|macro|UNIQUE_ID3
mdefine_line|#define UNIQUE_ID3&t;0xFFFF
r_static
r_void
id|__init
DECL|function|awe_check_dram
id|awe_check_dram
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|awe_present
)paren
multiline_comment|/* already initialized */
r_return
suffix:semicolon
r_if
c_cond
(paren
id|memsize
op_ge
l_int|0
)paren
(brace
multiline_comment|/* given by config file or module option */
id|memsize
op_mul_assign
l_int|1024
suffix:semicolon
multiline_comment|/* convert to Kbytes */
r_return
suffix:semicolon
)brace
id|awe_open_dram_for_check
c_func
(paren
)paren
suffix:semicolon
id|memsize
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set up unique two id numbers */
id|awe_poke_dw
c_func
(paren
id|AWE_SMALW
comma
id|AWE_DRAM_OFFSET
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_SMLD
comma
id|UNIQUE_ID1
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_SMLD
comma
id|UNIQUE_ID2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|memsize
OL
id|AWE_MAX_DRAM_SIZE
)paren
(brace
id|awe_wait
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/* read a data on the DRAM start address */
id|awe_poke_dw
c_func
(paren
id|AWE_SMALR
comma
id|AWE_DRAM_OFFSET
)paren
suffix:semicolon
id|awe_peek
c_func
(paren
id|AWE_SMLD
)paren
suffix:semicolon
multiline_comment|/* discard stale data  */
r_if
c_cond
(paren
id|awe_peek
c_func
(paren
id|AWE_SMLD
)paren
op_ne
id|UNIQUE_ID1
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|awe_peek
c_func
(paren
id|AWE_SMLD
)paren
op_ne
id|UNIQUE_ID2
)paren
r_break
suffix:semicolon
id|memsize
op_add_assign
l_int|512
suffix:semicolon
multiline_comment|/* increment 512kbytes */
multiline_comment|/* Write a unique data on the test address;&n;&t;&t; * if the address is out of range, the data is written on&n;&t;&t; * 0x200000(=AWE_DRAM_OFFSET).  Then the two id words are&n;&t;&t; * broken by this data.&n;&t;&t; */
id|awe_poke_dw
c_func
(paren
id|AWE_SMALW
comma
id|AWE_DRAM_OFFSET
op_plus
id|memsize
op_star
l_int|512L
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_SMLD
comma
id|UNIQUE_ID3
)paren
suffix:semicolon
id|awe_wait
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/* read a data on the just written DRAM address */
id|awe_poke_dw
c_func
(paren
id|AWE_SMALR
comma
id|AWE_DRAM_OFFSET
op_plus
id|memsize
op_star
l_int|512L
)paren
suffix:semicolon
id|awe_peek
c_func
(paren
id|AWE_SMLD
)paren
suffix:semicolon
multiline_comment|/* discard stale data  */
r_if
c_cond
(paren
id|awe_peek
c_func
(paren
id|AWE_SMLD
)paren
op_ne
id|UNIQUE_ID3
)paren
r_break
suffix:semicolon
)brace
id|awe_close_dram
c_func
(paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: %d Kbytes memory detected&bslash;n&quot;
comma
id|memsize
)paren
)paren
suffix:semicolon
multiline_comment|/* convert to Kbytes */
id|memsize
op_mul_assign
l_int|1024
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------*/
multiline_comment|/*&n; * chorus and reverb controls; from VV&squot;s guide&n; */
multiline_comment|/* 5 parameters for each chorus mode; 3 x 16bit, 2 x 32bit */
DECL|variable|chorus_defined
r_static
r_char
id|chorus_defined
(braket
id|AWE_CHORUS_NUMBERS
)braket
suffix:semicolon
DECL|variable|chorus_parm
r_static
id|awe_chorus_fx_rec
id|chorus_parm
(braket
id|AWE_CHORUS_NUMBERS
)braket
op_assign
(brace
(brace
l_int|0xE600
comma
l_int|0x03F6
comma
l_int|0xBC2C
comma
l_int|0x00000000
comma
l_int|0x0000006D
)brace
comma
multiline_comment|/* chorus 1 */
(brace
l_int|0xE608
comma
l_int|0x031A
comma
l_int|0xBC6E
comma
l_int|0x00000000
comma
l_int|0x0000017C
)brace
comma
multiline_comment|/* chorus 2 */
(brace
l_int|0xE610
comma
l_int|0x031A
comma
l_int|0xBC84
comma
l_int|0x00000000
comma
l_int|0x00000083
)brace
comma
multiline_comment|/* chorus 3 */
(brace
l_int|0xE620
comma
l_int|0x0269
comma
l_int|0xBC6E
comma
l_int|0x00000000
comma
l_int|0x0000017C
)brace
comma
multiline_comment|/* chorus 4 */
(brace
l_int|0xE680
comma
l_int|0x04D3
comma
l_int|0xBCA6
comma
l_int|0x00000000
comma
l_int|0x0000005B
)brace
comma
multiline_comment|/* feedback */
(brace
l_int|0xE6E0
comma
l_int|0x044E
comma
l_int|0xBC37
comma
l_int|0x00000000
comma
l_int|0x00000026
)brace
comma
multiline_comment|/* flanger */
(brace
l_int|0xE600
comma
l_int|0x0B06
comma
l_int|0xBC00
comma
l_int|0x0000E000
comma
l_int|0x00000083
)brace
comma
multiline_comment|/* short delay */
(brace
l_int|0xE6C0
comma
l_int|0x0B06
comma
l_int|0xBC00
comma
l_int|0x0000E000
comma
l_int|0x00000083
)brace
comma
multiline_comment|/* short delay + feedback */
)brace
suffix:semicolon
r_static
r_int
DECL|function|awe_load_chorus_fx
id|awe_load_chorus_fx
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|patch-&gt;optarg
OL
id|AWE_CHORUS_PREDEFINED
op_logical_or
id|patch-&gt;optarg
op_ge
id|AWE_CHORUS_NUMBERS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: invalid chorus mode %d for uploading&bslash;n&quot;
comma
id|patch-&gt;optarg
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OL
r_sizeof
(paren
id|awe_chorus_fx_rec
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: too short chorus fx parameters&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|chorus_parm
(braket
id|patch-&gt;optarg
)braket
comma
id|addr
op_plus
id|AWE_PATCH_INFO_SIZE
comma
r_sizeof
(paren
id|awe_chorus_fx_rec
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|chorus_defined
(braket
id|patch-&gt;optarg
)braket
op_assign
id|TRUE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_set_chorus_mode
id|awe_set_chorus_mode
c_func
(paren
r_int
id|effect
)paren
(brace
r_if
c_cond
(paren
id|effect
OL
l_int|0
op_logical_or
id|effect
op_ge
id|AWE_CHORUS_NUMBERS
op_logical_or
(paren
id|effect
op_ge
id|AWE_CHORUS_PREDEFINED
op_logical_and
op_logical_neg
id|chorus_defined
(braket
id|effect
)braket
)paren
)paren
r_return
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT3
c_func
(paren
l_int|9
)paren
comma
id|chorus_parm
(braket
id|effect
)braket
dot
id|feedback
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT3
c_func
(paren
l_int|12
)paren
comma
id|chorus_parm
(braket
id|effect
)braket
dot
id|delay_offset
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
l_int|3
)paren
comma
id|chorus_parm
(braket
id|effect
)braket
dot
id|lfo_depth
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_HWCF4
comma
id|chorus_parm
(braket
id|effect
)braket
dot
id|delay
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_HWCF5
comma
id|chorus_parm
(braket
id|effect
)braket
dot
id|lfo_freq
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_HWCF6
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_HWCF7
comma
l_int|0x0000
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_update_chorus_mode
id|awe_update_chorus_mode
c_func
(paren
r_void
)paren
(brace
id|awe_set_chorus_mode
c_func
(paren
id|ctrls
(braket
id|AWE_MD_CHORUS_MODE
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------*/
multiline_comment|/* reverb mode settings; write the following 28 data of 16 bit length&n; *   on the corresponding ports in the reverb_cmds array&n; */
DECL|variable|reverb_defined
r_static
r_char
id|reverb_defined
(braket
id|AWE_CHORUS_NUMBERS
)braket
suffix:semicolon
DECL|variable|reverb_parm
r_static
id|awe_reverb_fx_rec
id|reverb_parm
(braket
id|AWE_REVERB_NUMBERS
)braket
op_assign
(brace
(brace
(brace
multiline_comment|/* room 1 */
l_int|0xB488
comma
l_int|0xA450
comma
l_int|0x9550
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x72F4
comma
l_int|0x72A4
comma
l_int|0x7254
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x4416
comma
l_int|0x4516
comma
l_int|0xA490
comma
l_int|0xA590
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* room 2 */
l_int|0xB488
comma
l_int|0xA458
comma
l_int|0x9558
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7284
comma
l_int|0x7254
comma
l_int|0x7224
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7284
comma
l_int|0x4448
comma
l_int|0x4548
comma
l_int|0xA440
comma
l_int|0xA540
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* room 3 */
l_int|0xB488
comma
l_int|0xA460
comma
l_int|0x9560
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7284
comma
l_int|0x7254
comma
l_int|0x7224
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7284
comma
l_int|0x4416
comma
l_int|0x4516
comma
l_int|0xA490
comma
l_int|0xA590
comma
l_int|0x842C
comma
l_int|0x852C
comma
l_int|0x842C
comma
l_int|0x852C
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* hall 1 */
l_int|0xB488
comma
l_int|0xA470
comma
l_int|0x9570
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7284
comma
l_int|0x7254
comma
l_int|0x7224
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7284
comma
l_int|0x4448
comma
l_int|0x4548
comma
l_int|0xA440
comma
l_int|0xA540
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* hall 2 */
l_int|0xB488
comma
l_int|0xA470
comma
l_int|0x9570
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7254
comma
l_int|0x7234
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7264
comma
l_int|0x7294
comma
l_int|0x44C3
comma
l_int|0x45C3
comma
l_int|0xA404
comma
l_int|0xA504
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* plate */
l_int|0xB4FF
comma
l_int|0xA470
comma
l_int|0x9570
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x4448
comma
l_int|0x4548
comma
l_int|0xA440
comma
l_int|0xA540
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* delay */
l_int|0xB4FF
comma
l_int|0xA470
comma
l_int|0x9500
comma
l_int|0x84B5
comma
l_int|0x333A
comma
l_int|0x39B5
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x72F4
comma
l_int|0x4400
comma
l_int|0x4500
comma
l_int|0xA4FF
comma
l_int|0xA5FF
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* panning delay */
l_int|0xB4FF
comma
l_int|0xA490
comma
l_int|0x9590
comma
l_int|0x8474
comma
l_int|0x333A
comma
l_int|0x39B5
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x72F4
comma
l_int|0x4400
comma
l_int|0x4500
comma
l_int|0xA4FF
comma
l_int|0xA5FF
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
)brace
)brace
comma
)brace
suffix:semicolon
DECL|struct|ReverbCmdPair
r_static
r_struct
id|ReverbCmdPair
(brace
DECL|member|cmd
DECL|member|port
r_int
r_int
id|cmd
comma
id|port
suffix:semicolon
DECL|variable|reverb_cmds
)brace
id|reverb_cmds
(braket
l_int|28
)braket
op_assign
(brace
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x03
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x05
)paren
)brace
comma
(brace
id|AWE_INIT4
c_func
(paren
l_int|0x1F
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x07
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x14
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x16
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x0F
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x17
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x1F
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x07
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x0F
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x17
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x1D
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x1F
)paren
)brace
comma
(brace
id|AWE_INIT3
c_func
(paren
l_int|0x01
)paren
)brace
comma
(brace
id|AWE_INIT3
c_func
(paren
l_int|0x03
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x09
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x0B
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x11
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x13
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x19
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x1B
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x01
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x03
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x09
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x0B
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x11
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x13
)paren
)brace
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|awe_load_reverb_fx
id|awe_load_reverb_fx
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|patch-&gt;optarg
OL
id|AWE_REVERB_PREDEFINED
op_logical_or
id|patch-&gt;optarg
op_ge
id|AWE_REVERB_NUMBERS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: invalid reverb mode %d for uploading&bslash;n&quot;
comma
id|patch-&gt;optarg
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OL
r_sizeof
(paren
id|awe_reverb_fx_rec
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWE32 Error: too short reverb fx parameters&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|reverb_parm
(braket
id|patch-&gt;optarg
)braket
comma
id|addr
op_plus
id|AWE_PATCH_INFO_SIZE
comma
r_sizeof
(paren
id|awe_reverb_fx_rec
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|reverb_defined
(braket
id|patch-&gt;optarg
)braket
op_assign
id|TRUE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_set_reverb_mode
id|awe_set_reverb_mode
c_func
(paren
r_int
id|effect
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|effect
OL
l_int|0
op_logical_or
id|effect
op_ge
id|AWE_REVERB_NUMBERS
op_logical_or
(paren
id|effect
op_ge
id|AWE_REVERB_PREDEFINED
op_logical_and
op_logical_neg
id|reverb_defined
(braket
id|effect
)braket
)paren
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|28
suffix:semicolon
id|i
op_increment
)paren
id|awe_poke
c_func
(paren
id|reverb_cmds
(braket
id|i
)braket
dot
id|cmd
comma
id|reverb_cmds
(braket
id|i
)braket
dot
id|port
comma
id|reverb_parm
(braket
id|effect
)braket
dot
id|parms
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_update_reverb_mode
id|awe_update_reverb_mode
c_func
(paren
r_void
)paren
(brace
id|awe_set_reverb_mode
c_func
(paren
id|ctrls
(braket
id|AWE_MD_REVERB_MODE
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * treble/bass equalizer control&n; */
DECL|variable|bass_parm
r_static
r_int
r_int
id|bass_parm
(braket
l_int|12
)braket
(braket
l_int|3
)braket
op_assign
(brace
(brace
l_int|0xD26A
comma
l_int|0xD36A
comma
l_int|0x0000
)brace
comma
multiline_comment|/* -12 dB */
(brace
l_int|0xD25B
comma
l_int|0xD35B
comma
l_int|0x0000
)brace
comma
multiline_comment|/*  -8 */
(brace
l_int|0xD24C
comma
l_int|0xD34C
comma
l_int|0x0000
)brace
comma
multiline_comment|/*  -6 */
(brace
l_int|0xD23D
comma
l_int|0xD33D
comma
l_int|0x0000
)brace
comma
multiline_comment|/*  -4 */
(brace
l_int|0xD21F
comma
l_int|0xD31F
comma
l_int|0x0000
)brace
comma
multiline_comment|/*  -2 */
(brace
l_int|0xC208
comma
l_int|0xC308
comma
l_int|0x0001
)brace
comma
multiline_comment|/*   0 (HW default) */
(brace
l_int|0xC219
comma
l_int|0xC319
comma
l_int|0x0001
)brace
comma
multiline_comment|/*  +2 */
(brace
l_int|0xC22A
comma
l_int|0xC32A
comma
l_int|0x0001
)brace
comma
multiline_comment|/*  +4 */
(brace
l_int|0xC24C
comma
l_int|0xC34C
comma
l_int|0x0001
)brace
comma
multiline_comment|/*  +6 */
(brace
l_int|0xC26E
comma
l_int|0xC36E
comma
l_int|0x0001
)brace
comma
multiline_comment|/*  +8 */
(brace
l_int|0xC248
comma
l_int|0xC348
comma
l_int|0x0002
)brace
comma
multiline_comment|/* +10 */
(brace
l_int|0xC26A
comma
l_int|0xC36A
comma
l_int|0x0002
)brace
comma
multiline_comment|/* +12 dB */
)brace
suffix:semicolon
DECL|variable|treble_parm
r_static
r_int
r_int
id|treble_parm
(braket
l_int|12
)braket
(braket
l_int|9
)braket
op_assign
(brace
(brace
l_int|0x821E
comma
l_int|0xC26A
comma
l_int|0x031E
comma
l_int|0xC36A
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0001
)brace
comma
multiline_comment|/* -12 dB */
(brace
l_int|0x821E
comma
l_int|0xC25B
comma
l_int|0x031E
comma
l_int|0xC35B
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0001
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xC24C
comma
l_int|0x031E
comma
l_int|0xC34C
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0001
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xC23D
comma
l_int|0x031E
comma
l_int|0xC33D
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0001
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xC21F
comma
l_int|0x031E
comma
l_int|0xC31F
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0001
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xD208
comma
l_int|0x031E
comma
l_int|0xD308
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0002
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xD208
comma
l_int|0x031E
comma
l_int|0xD308
comma
l_int|0x021D
comma
l_int|0xD219
comma
l_int|0x831D
comma
l_int|0xD319
comma
l_int|0x0002
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xD208
comma
l_int|0x031E
comma
l_int|0xD308
comma
l_int|0x021C
comma
l_int|0xD22A
comma
l_int|0x831C
comma
l_int|0xD32A
comma
l_int|0x0002
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xD208
comma
l_int|0x031E
comma
l_int|0xD308
comma
l_int|0x021A
comma
l_int|0xD24C
comma
l_int|0x831A
comma
l_int|0xD34C
comma
l_int|0x0002
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xD208
comma
l_int|0x031E
comma
l_int|0xD308
comma
l_int|0x0219
comma
l_int|0xD26E
comma
l_int|0x8319
comma
l_int|0xD36E
comma
l_int|0x0002
)brace
comma
multiline_comment|/* +8 (HW default) */
(brace
l_int|0x821D
comma
l_int|0xD219
comma
l_int|0x031D
comma
l_int|0xD319
comma
l_int|0x0219
comma
l_int|0xD26E
comma
l_int|0x8319
comma
l_int|0xD36E
comma
l_int|0x0002
)brace
comma
(brace
l_int|0x821C
comma
l_int|0xD22A
comma
l_int|0x031C
comma
l_int|0xD32A
comma
l_int|0x0219
comma
l_int|0xD26E
comma
l_int|0x8319
comma
l_int|0xD36E
comma
l_int|0x0002
)brace
comma
multiline_comment|/* +12 dB */
)brace
suffix:semicolon
multiline_comment|/*&n; * set Emu8000 digital equalizer; from 0 to 11 [-12dB - 12dB]&n; */
r_static
r_void
DECL|function|awe_equalizer
id|awe_equalizer
c_func
(paren
r_int
id|bass
comma
r_int
id|treble
)paren
(brace
r_int
r_int
id|w
suffix:semicolon
r_if
c_cond
(paren
id|bass
template_param
l_int|11
op_logical_or
id|treble
template_param
l_int|11
)paren
r_return
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
l_int|0x01
)paren
comma
id|bass_parm
(braket
id|bass
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
l_int|0x11
)paren
comma
id|bass_parm
(braket
id|bass
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT3
c_func
(paren
l_int|0x11
)paren
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT3
c_func
(paren
l_int|0x13
)paren
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT3
c_func
(paren
l_int|0x1B
)paren
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
l_int|0x07
)paren
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
l_int|0x0B
)paren
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
l_int|0x0D
)paren
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
l_int|0x17
)paren
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
l_int|0x19
)paren
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|w
op_assign
id|bass_parm
(braket
id|bass
)braket
(braket
l_int|2
)braket
op_plus
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|8
)braket
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
l_int|0x15
)paren
comma
(paren
r_int
r_int
)paren
(paren
id|w
op_plus
l_int|0x0262
)paren
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
l_int|0x1D
)paren
comma
(paren
r_int
r_int
)paren
(paren
id|w
op_plus
l_int|0x8362
)paren
)paren
suffix:semicolon
)brace
DECL|function|awe_update_equalizer
r_static
r_void
id|awe_update_equalizer
c_func
(paren
r_void
)paren
(brace
id|awe_equalizer
c_func
(paren
id|ctrls
(braket
id|AWE_MD_BASS_LEVEL
)braket
comma
id|ctrls
(braket
id|AWE_MD_TREBLE_LEVEL
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------*/
macro_line|#ifdef CONFIG_AWE32_MIDIEMU
multiline_comment|/*&n; * Emu8000 MIDI Emulation&n; */
multiline_comment|/*&n; * midi queue record&n; */
multiline_comment|/* queue type */
DECL|enumerator|Q_NONE
DECL|enumerator|Q_VARLEN
DECL|enumerator|Q_READ
DECL|enumerator|Q_SYSEX
r_enum
(brace
id|Q_NONE
comma
id|Q_VARLEN
comma
id|Q_READ
comma
id|Q_SYSEX
comma
)brace
suffix:semicolon
DECL|macro|MAX_MIDIBUF
mdefine_line|#define MAX_MIDIBUF&t;64
multiline_comment|/* midi status */
DECL|struct|MidiStatus
r_typedef
r_struct
id|MidiStatus
(brace
DECL|member|queue
r_int
id|queue
suffix:semicolon
multiline_comment|/* queue type */
DECL|member|qlen
r_int
id|qlen
suffix:semicolon
multiline_comment|/* queue length */
DECL|member|read
r_int
id|read
suffix:semicolon
multiline_comment|/* chars read */
DECL|member|status
r_int
id|status
suffix:semicolon
multiline_comment|/* current status */
DECL|member|chan
r_int
id|chan
suffix:semicolon
multiline_comment|/* current channel */
DECL|member|buf
r_int
r_char
id|buf
(braket
id|MAX_MIDIBUF
)braket
suffix:semicolon
DECL|typedef|MidiStatus
)brace
id|MidiStatus
suffix:semicolon
multiline_comment|/* MIDI mode type */
DECL|enumerator|MODE_GM
DECL|enumerator|MODE_GS
DECL|enumerator|MODE_XG
r_enum
(brace
id|MODE_GM
comma
id|MODE_GS
comma
id|MODE_XG
comma
)brace
suffix:semicolon
multiline_comment|/* NRPN / CC -&gt; Emu8000 parameter converter */
r_typedef
r_struct
(brace
DECL|member|control
r_int
id|control
suffix:semicolon
DECL|member|awe_effect
r_int
id|awe_effect
suffix:semicolon
DECL|member|convert
r_int
r_int
(paren
op_star
id|convert
)paren
(paren
r_int
id|val
)paren
suffix:semicolon
DECL|typedef|ConvTable
)brace
id|ConvTable
suffix:semicolon
multiline_comment|/*&n; * prototypes&n; */
r_static
r_int
id|awe_midi_open
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
comma
r_void
(paren
op_star
id|input
)paren
(paren
r_int
comma
r_int
r_char
)paren
comma
r_void
(paren
op_star
id|output
)paren
(paren
r_int
)paren
)paren
suffix:semicolon
r_static
r_void
id|awe_midi_close
c_func
(paren
r_int
id|dev
)paren
suffix:semicolon
r_static
r_int
id|awe_midi_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
suffix:semicolon
r_static
r_int
id|awe_midi_outputc
c_func
(paren
r_int
id|dev
comma
r_int
r_char
id|midi_byte
)paren
suffix:semicolon
r_static
r_void
id|init_midi_status
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_void
id|clear_rpn
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|get_midi_char
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|c
)paren
suffix:semicolon
multiline_comment|/*static void queue_varlen(MidiStatus *st, int c);*/
r_static
r_void
id|special_event
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|c
)paren
suffix:semicolon
r_static
r_void
id|queue_read
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|c
)paren
suffix:semicolon
r_static
r_void
id|midi_note_on
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_void
id|midi_note_off
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_void
id|midi_key_pressure
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_void
id|midi_channel_pressure
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_void
id|midi_pitch_wheel
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_void
id|midi_program_change
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_void
id|midi_control_change
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_void
id|midi_select_bank
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|val
)paren
suffix:semicolon
r_static
r_void
id|midi_nrpn_event
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_void
id|midi_rpn_event
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_void
id|midi_detune
c_func
(paren
r_int
id|chan
comma
r_int
id|coarse
comma
r_int
id|fine
)paren
suffix:semicolon
r_static
r_void
id|midi_system_exclusive
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
r_static
r_int
id|send_converted_effect
c_func
(paren
id|ConvTable
op_star
id|table
comma
r_int
id|num_tables
comma
id|MidiStatus
op_star
id|st
comma
r_int
id|type
comma
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
id|add_converted_effect
c_func
(paren
id|ConvTable
op_star
id|table
comma
r_int
id|num_tables
comma
id|MidiStatus
op_star
id|st
comma
r_int
id|type
comma
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
id|xg_control_change
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|cmd
comma
r_int
id|val
)paren
suffix:semicolon
DECL|macro|numberof
mdefine_line|#define numberof(ary)&t;(sizeof(ary)/sizeof(ary[0]))
multiline_comment|/*&n; * OSS Midi device record&n; */
DECL|variable|awe_midi_operations
r_static
r_struct
id|midi_operations
id|awe_midi_operations
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|info
suffix:colon
(brace
l_string|&quot;AWE Midi Emu&quot;
comma
l_int|0
comma
l_int|0
comma
id|SNDCARD_SB
)brace
comma
id|in_info
suffix:colon
(brace
l_int|0
)brace
comma
id|open
suffix:colon
id|awe_midi_open
comma
multiline_comment|/*open*/
id|close
suffix:colon
id|awe_midi_close
comma
multiline_comment|/*close*/
id|ioctl
suffix:colon
id|awe_midi_ioctl
comma
multiline_comment|/*ioctl*/
id|outputc
suffix:colon
id|awe_midi_outputc
comma
multiline_comment|/*outputc*/
)brace
suffix:semicolon
DECL|variable|my_mididev
r_static
r_int
id|my_mididev
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|function|attach_midiemu
r_static
r_void
id|__init
id|attach_midiemu
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
(paren
id|my_mididev
op_assign
id|sound_alloc_mididev
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
id|printk
(paren
l_string|&quot;Sound: Too many midi devices detected&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|midi_devs
(braket
id|my_mididev
)braket
op_assign
op_amp
id|awe_midi_operations
suffix:semicolon
)brace
DECL|function|unload_midiemu
r_static
r_void
id|__exit
id|unload_midiemu
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|my_mididev
op_ge
l_int|0
)paren
id|sound_unload_mididev
c_func
(paren
id|my_mididev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * open/close midi device&n; */
DECL|variable|midi_opened
r_static
r_int
id|midi_opened
op_assign
id|FALSE
suffix:semicolon
DECL|variable|midi_mode
r_static
r_int
id|midi_mode
suffix:semicolon
DECL|variable|coarsetune
DECL|variable|finetune
r_static
r_int
id|coarsetune
op_assign
l_int|0
comma
id|finetune
op_assign
l_int|0
suffix:semicolon
DECL|variable|xg_mapping
r_static
r_int
id|xg_mapping
op_assign
id|TRUE
suffix:semicolon
DECL|variable|xg_bankmode
r_static
r_int
id|xg_bankmode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* effect sensitivity */
DECL|macro|FX_CUTOFF
mdefine_line|#define FX_CUTOFF&t;0
DECL|macro|FX_RESONANCE
mdefine_line|#define FX_RESONANCE&t;1
DECL|macro|FX_ATTACK
mdefine_line|#define FX_ATTACK&t;2
DECL|macro|FX_RELEASE
mdefine_line|#define FX_RELEASE&t;3
DECL|macro|FX_VIBRATE
mdefine_line|#define FX_VIBRATE&t;4
DECL|macro|FX_VIBDEPTH
mdefine_line|#define FX_VIBDEPTH&t;5
DECL|macro|FX_VIBDELAY
mdefine_line|#define FX_VIBDELAY&t;6
DECL|macro|FX_NUMS
mdefine_line|#define FX_NUMS&t;&t;7
DECL|macro|DEF_FX_CUTOFF
mdefine_line|#define DEF_FX_CUTOFF&t;&t;170
DECL|macro|DEF_FX_RESONANCE
mdefine_line|#define DEF_FX_RESONANCE&t;6
DECL|macro|DEF_FX_ATTACK
mdefine_line|#define DEF_FX_ATTACK&t;&t;50
DECL|macro|DEF_FX_RELEASE
mdefine_line|#define DEF_FX_RELEASE&t;&t;50
DECL|macro|DEF_FX_VIBRATE
mdefine_line|#define DEF_FX_VIBRATE&t;&t;30
DECL|macro|DEF_FX_VIBDEPTH
mdefine_line|#define DEF_FX_VIBDEPTH&t;&t;4
DECL|macro|DEF_FX_VIBDELAY
mdefine_line|#define DEF_FX_VIBDELAY&t;&t;1500
multiline_comment|/* effect sense: */
DECL|variable|gs_sense
r_static
r_int
id|gs_sense
(braket
)braket
op_assign
(brace
id|DEF_FX_CUTOFF
comma
id|DEF_FX_RESONANCE
comma
id|DEF_FX_ATTACK
comma
id|DEF_FX_RELEASE
comma
id|DEF_FX_VIBRATE
comma
id|DEF_FX_VIBDEPTH
comma
id|DEF_FX_VIBDELAY
)brace
suffix:semicolon
DECL|variable|xg_sense
r_static
r_int
id|xg_sense
(braket
)braket
op_assign
(brace
id|DEF_FX_CUTOFF
comma
id|DEF_FX_RESONANCE
comma
id|DEF_FX_ATTACK
comma
id|DEF_FX_RELEASE
comma
id|DEF_FX_VIBRATE
comma
id|DEF_FX_VIBDEPTH
comma
id|DEF_FX_VIBDELAY
)brace
suffix:semicolon
multiline_comment|/* current status */
DECL|variable|curst
r_static
id|MidiStatus
id|curst
suffix:semicolon
r_static
r_int
DECL|function|awe_midi_open
id|awe_midi_open
(paren
r_int
id|dev
comma
r_int
id|mode
comma
r_void
(paren
op_star
id|input
)paren
(paren
r_int
comma
r_int
r_char
)paren
comma
r_void
(paren
op_star
id|output
)paren
(paren
r_int
)paren
)paren
(brace
r_if
c_cond
(paren
id|midi_opened
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|midi_opened
op_assign
id|TRUE
suffix:semicolon
id|midi_mode
op_assign
id|MODE_GM
suffix:semicolon
id|curst.queue
op_assign
id|Q_NONE
suffix:semicolon
id|curst.qlen
op_assign
l_int|0
suffix:semicolon
id|curst.read
op_assign
l_int|0
suffix:semicolon
id|curst.status
op_assign
l_int|0
suffix:semicolon
id|curst.chan
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|curst.buf
comma
l_int|0
comma
r_sizeof
(paren
id|curst.buf
)paren
)paren
suffix:semicolon
id|init_midi_status
c_func
(paren
op_amp
id|curst
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_midi_close
id|awe_midi_close
(paren
r_int
id|dev
)paren
(brace
id|midi_opened
op_assign
id|FALSE
suffix:semicolon
)brace
r_static
r_int
DECL|function|awe_midi_ioctl
id|awe_midi_ioctl
(paren
r_int
id|dev
comma
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_static
r_int
DECL|function|awe_midi_outputc
id|awe_midi_outputc
(paren
r_int
id|dev
comma
r_int
r_char
id|midi_byte
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|midi_opened
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* force to change playing mode */
id|playing_mode
op_assign
id|AWE_PLAY_MULTI
suffix:semicolon
id|get_midi_char
c_func
(paren
op_amp
id|curst
comma
id|midi_byte
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize&n; */
DECL|function|init_midi_status
r_static
r_void
id|init_midi_status
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
id|clear_rpn
c_func
(paren
)paren
suffix:semicolon
id|coarsetune
op_assign
l_int|0
suffix:semicolon
id|finetune
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * RPN &amp; NRPN&n; */
DECL|macro|MAX_MIDI_CHANNELS
mdefine_line|#define MAX_MIDI_CHANNELS&t;16
multiline_comment|/* RPN &amp; NRPN */
DECL|variable|nrpn
r_static
r_int
r_char
id|nrpn
(braket
id|MAX_MIDI_CHANNELS
)braket
suffix:semicolon
multiline_comment|/* current event is NRPN? */
DECL|variable|msb_bit
r_static
r_int
id|msb_bit
suffix:semicolon
multiline_comment|/* current event is msb for RPN/NRPN */
multiline_comment|/* RPN &amp; NRPN indeces */
DECL|variable|rpn_msb
DECL|variable|rpn_lsb
r_static
r_int
r_char
id|rpn_msb
(braket
id|MAX_MIDI_CHANNELS
)braket
comma
id|rpn_lsb
(braket
id|MAX_MIDI_CHANNELS
)braket
suffix:semicolon
multiline_comment|/* RPN &amp; NRPN values */
DECL|variable|rpn_val
r_static
r_int
id|rpn_val
(braket
id|MAX_MIDI_CHANNELS
)braket
suffix:semicolon
DECL|function|clear_rpn
r_static
r_void
id|clear_rpn
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_MIDI_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|nrpn
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|rpn_msb
(braket
id|i
)braket
op_assign
l_int|127
suffix:semicolon
id|rpn_lsb
(braket
id|i
)braket
op_assign
l_int|127
suffix:semicolon
id|rpn_val
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|msb_bit
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * process midi queue&n; */
multiline_comment|/* status event types */
DECL|typedef|StatusEvent
r_typedef
r_void
(paren
op_star
id|StatusEvent
)paren
(paren
id|MidiStatus
op_star
id|st
)paren
suffix:semicolon
DECL|struct|StatusEventList
r_static
r_struct
id|StatusEventList
(brace
DECL|member|process
id|StatusEvent
id|process
suffix:semicolon
DECL|member|qlen
r_int
id|qlen
suffix:semicolon
DECL|variable|status_event
)brace
id|status_event
(braket
l_int|8
)braket
op_assign
(brace
(brace
id|midi_note_off
comma
l_int|2
)brace
comma
(brace
id|midi_note_on
comma
l_int|2
)brace
comma
(brace
id|midi_key_pressure
comma
l_int|2
)brace
comma
(brace
id|midi_control_change
comma
l_int|2
)brace
comma
(brace
id|midi_program_change
comma
l_int|1
)brace
comma
(brace
id|midi_channel_pressure
comma
l_int|1
)brace
comma
(brace
id|midi_pitch_wheel
comma
l_int|2
)brace
comma
(brace
l_int|NULL
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* read a char from fifo and process it */
DECL|function|get_midi_char
r_static
r_void
id|get_midi_char
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|c
)paren
(brace
r_if
c_cond
(paren
id|c
op_eq
l_int|0xfe
)paren
(brace
multiline_comment|/* ignore active sense */
id|st-&gt;queue
op_assign
id|Q_NONE
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|st-&gt;queue
)paren
(brace
multiline_comment|/* case Q_VARLEN: queue_varlen(st, c); break;*/
r_case
id|Q_READ
suffix:colon
r_case
id|Q_SYSEX
suffix:colon
id|queue_read
c_func
(paren
id|st
comma
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Q_NONE
suffix:colon
id|st-&gt;read
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c
op_amp
l_int|0xf0
)paren
op_eq
l_int|0xf0
)paren
(brace
id|special_event
c_func
(paren
id|st
comma
id|c
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* status change */
id|st-&gt;status
op_assign
(paren
id|c
op_rshift
l_int|4
)paren
op_amp
l_int|0x07
suffix:semicolon
id|st-&gt;chan
op_assign
id|c
op_amp
l_int|0x0f
suffix:semicolon
id|st-&gt;queue
op_assign
id|Q_READ
suffix:semicolon
id|st-&gt;qlen
op_assign
id|status_event
(braket
id|st-&gt;status
)braket
dot
id|qlen
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;qlen
op_eq
l_int|0
)paren
id|st-&gt;queue
op_assign
id|Q_NONE
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* 0xfx events */
DECL|function|special_event
r_static
r_void
id|special_event
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|c
)paren
(brace
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_int|0xf0
suffix:colon
multiline_comment|/* system exclusive */
id|st-&gt;queue
op_assign
id|Q_SYSEX
suffix:semicolon
id|st-&gt;qlen
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xf1
suffix:colon
multiline_comment|/* MTC quarter frame */
r_case
l_int|0xf3
suffix:colon
multiline_comment|/* song select */
id|st-&gt;queue
op_assign
id|Q_READ
suffix:semicolon
id|st-&gt;qlen
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xf2
suffix:colon
multiline_comment|/* song position */
id|st-&gt;queue
op_assign
id|Q_READ
suffix:semicolon
id|st-&gt;qlen
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#if 0
multiline_comment|/* read variable length value */
r_static
r_void
id|queue_varlen
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|c
)paren
(brace
id|st-&gt;qlen
op_add_assign
(paren
id|c
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_amp
l_int|0x80
)paren
(brace
id|st-&gt;qlen
op_lshift_assign
l_int|7
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|st-&gt;qlen
op_le
l_int|0
)paren
(brace
id|st-&gt;qlen
op_assign
l_int|0
suffix:semicolon
id|st-&gt;queue
op_assign
id|Q_NONE
suffix:semicolon
)brace
id|st-&gt;queue
op_assign
id|Q_READ
suffix:semicolon
id|st-&gt;read
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* read a char */
DECL|function|queue_read
r_static
r_void
id|queue_read
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|c
)paren
(brace
r_if
c_cond
(paren
id|st-&gt;read
OL
id|MAX_MIDIBUF
)paren
(brace
r_if
c_cond
(paren
id|st-&gt;queue
op_ne
id|Q_SYSEX
)paren
id|c
op_and_assign
l_int|0x7f
suffix:semicolon
id|st-&gt;buf
(braket
id|st-&gt;read
)braket
op_assign
(paren
r_int
r_char
)paren
id|c
suffix:semicolon
)brace
id|st-&gt;read
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;queue
op_eq
id|Q_SYSEX
op_logical_and
id|c
op_eq
l_int|0xf7
)paren
(brace
id|midi_system_exclusive
c_func
(paren
id|st
)paren
suffix:semicolon
id|st-&gt;queue
op_assign
id|Q_NONE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|st-&gt;queue
op_eq
id|Q_READ
op_logical_and
id|st-&gt;read
op_ge
id|st-&gt;qlen
)paren
(brace
r_if
c_cond
(paren
id|status_event
(braket
id|st-&gt;status
)braket
dot
id|process
)paren
id|status_event
(braket
id|st-&gt;status
)braket
dot
id|process
c_func
(paren
id|st
)paren
suffix:semicolon
id|st-&gt;queue
op_assign
id|Q_NONE
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * status events&n; */
multiline_comment|/* note on */
DECL|function|midi_note_on
r_static
r_void
id|midi_note_on
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;midi: note_on (%d) %d %d&bslash;n&quot;
comma
id|st-&gt;chan
comma
id|st-&gt;buf
(braket
l_int|0
)braket
comma
id|st-&gt;buf
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;buf
(braket
l_int|1
)braket
op_eq
l_int|0
)paren
id|midi_note_off
c_func
(paren
id|st
)paren
suffix:semicolon
r_else
id|awe_start_note
c_func
(paren
l_int|0
comma
id|st-&gt;chan
comma
id|st-&gt;buf
(braket
l_int|0
)braket
comma
id|st-&gt;buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* note off */
DECL|function|midi_note_off
r_static
r_void
id|midi_note_off
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;midi: note_off (%d) %d %d&bslash;n&quot;
comma
id|st-&gt;chan
comma
id|st-&gt;buf
(braket
l_int|0
)braket
comma
id|st-&gt;buf
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|awe_kill_note
c_func
(paren
l_int|0
comma
id|st-&gt;chan
comma
id|st-&gt;buf
(braket
l_int|0
)braket
comma
id|st-&gt;buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* key pressure change */
DECL|function|midi_key_pressure
r_static
r_void
id|midi_key_pressure
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
id|awe_key_pressure
c_func
(paren
l_int|0
comma
id|st-&gt;chan
comma
id|st-&gt;buf
(braket
l_int|0
)braket
comma
id|st-&gt;buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* channel pressure change */
DECL|function|midi_channel_pressure
r_static
r_void
id|midi_channel_pressure
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
id|channels
(braket
id|st-&gt;chan
)braket
dot
id|chan_press
op_assign
id|st-&gt;buf
(braket
l_int|0
)braket
suffix:semicolon
id|awe_modwheel_change
c_func
(paren
id|st-&gt;chan
comma
id|st-&gt;buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* pitch wheel change */
DECL|function|midi_pitch_wheel
r_static
r_void
id|midi_pitch_wheel
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
r_int
id|val
op_assign
(paren
r_int
)paren
id|st-&gt;buf
(braket
l_int|1
)braket
op_star
l_int|128
op_plus
id|st-&gt;buf
(braket
l_int|0
)braket
suffix:semicolon
id|awe_bender
c_func
(paren
l_int|0
comma
id|st-&gt;chan
comma
id|val
)paren
suffix:semicolon
)brace
multiline_comment|/* program change */
DECL|function|midi_program_change
r_static
r_void
id|midi_program_change
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
r_int
id|preset
suffix:semicolon
id|preset
op_assign
id|st-&gt;buf
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|midi_mode
op_eq
id|MODE_GS
op_logical_and
id|IS_DRUM_CHANNEL
c_func
(paren
id|st-&gt;chan
)paren
op_logical_and
id|preset
op_eq
l_int|127
)paren
id|preset
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|midi_mode
op_eq
id|MODE_XG
op_logical_and
id|xg_mapping
op_logical_and
id|IS_DRUM_CHANNEL
c_func
(paren
id|st-&gt;chan
)paren
)paren
id|preset
op_add_assign
l_int|64
suffix:semicolon
id|awe_set_instr
c_func
(paren
l_int|0
comma
id|st-&gt;chan
comma
id|preset
)paren
suffix:semicolon
)brace
DECL|macro|send_effect
mdefine_line|#define send_effect(chan,type,val) awe_send_effect(chan,-1,type,val)
DECL|macro|add_effect
mdefine_line|#define add_effect(chan,type,val) awe_send_effect(chan,-1,(type)|0x80,val)
DECL|macro|unset_effect
mdefine_line|#define unset_effect(chan,type) awe_send_effect(chan,-1,(type)|0x40,0)
multiline_comment|/* midi control change */
DECL|function|midi_control_change
r_static
r_void
id|midi_control_change
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
r_int
id|cmd
op_assign
id|st-&gt;buf
(braket
l_int|0
)braket
suffix:semicolon
r_int
id|val
op_assign
id|st-&gt;buf
(braket
l_int|1
)braket
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;midi: control (%d) %d %d&bslash;n&quot;
comma
id|st-&gt;chan
comma
id|cmd
comma
id|val
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|midi_mode
op_eq
id|MODE_XG
)paren
(brace
r_if
c_cond
(paren
id|xg_control_change
c_func
(paren
id|st
comma
id|cmd
comma
id|val
)paren
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* controls #31 - #64 are LSB of #0 - #31 */
id|msb_bit
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_ge
l_int|0x20
op_logical_and
id|cmd
OL
l_int|0x40
)paren
(brace
id|msb_bit
op_assign
l_int|0
suffix:semicolon
id|cmd
op_sub_assign
l_int|0x20
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|CTL_SOFT_PEDAL
suffix:colon
r_if
c_cond
(paren
id|val
op_eq
l_int|127
)paren
id|add_effect
c_func
(paren
id|st-&gt;chan
comma
id|AWE_FX_CUTOFF
comma
op_minus
l_int|160
)paren
suffix:semicolon
r_else
id|unset_effect
c_func
(paren
id|st-&gt;chan
comma
id|AWE_FX_CUTOFF
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_BANK_SELECT
suffix:colon
id|midi_select_bank
c_func
(paren
id|st
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* set RPN/NRPN parameter */
r_case
id|CTL_REGIST_PARM_NUM_MSB
suffix:colon
id|nrpn
(braket
id|st-&gt;chan
)braket
op_assign
l_int|0
suffix:semicolon
id|rpn_msb
(braket
id|st-&gt;chan
)braket
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_REGIST_PARM_NUM_LSB
suffix:colon
id|nrpn
(braket
id|st-&gt;chan
)braket
op_assign
l_int|0
suffix:semicolon
id|rpn_lsb
(braket
id|st-&gt;chan
)braket
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_NONREG_PARM_NUM_MSB
suffix:colon
id|nrpn
(braket
id|st-&gt;chan
)braket
op_assign
l_int|1
suffix:semicolon
id|rpn_msb
(braket
id|st-&gt;chan
)braket
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_NONREG_PARM_NUM_LSB
suffix:colon
id|nrpn
(braket
id|st-&gt;chan
)braket
op_assign
l_int|1
suffix:semicolon
id|rpn_lsb
(braket
id|st-&gt;chan
)braket
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* send RPN/NRPN entry */
r_case
id|CTL_DATA_ENTRY
suffix:colon
r_if
c_cond
(paren
id|msb_bit
)paren
id|rpn_val
(braket
id|st-&gt;chan
)braket
op_assign
id|val
op_star
l_int|128
suffix:semicolon
r_else
id|rpn_val
(braket
id|st-&gt;chan
)braket
op_or_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|nrpn
(braket
id|st-&gt;chan
)braket
)paren
id|midi_nrpn_event
c_func
(paren
id|st
)paren
suffix:semicolon
r_else
id|midi_rpn_event
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* increase/decrease data entry */
r_case
id|CTL_DATA_INCREMENT
suffix:colon
id|rpn_val
(braket
id|st-&gt;chan
)braket
op_increment
suffix:semicolon
id|midi_rpn_event
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_DATA_DECREMENT
suffix:colon
id|rpn_val
(braket
id|st-&gt;chan
)braket
op_decrement
suffix:semicolon
id|midi_rpn_event
c_func
(paren
id|st
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* default */
r_default
suffix:colon
id|awe_controller
c_func
(paren
l_int|0
comma
id|st-&gt;chan
comma
id|cmd
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* tone bank change */
DECL|function|midi_select_bank
r_static
r_void
id|midi_select_bank
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|val
)paren
(brace
r_if
c_cond
(paren
id|midi_mode
op_eq
id|MODE_XG
op_logical_and
id|msb_bit
)paren
(brace
id|xg_bankmode
op_assign
id|val
suffix:semicolon
multiline_comment|/* XG MSB value; not normal bank selection */
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|127
suffix:colon
multiline_comment|/* remap to drum channel */
id|awe_controller
c_func
(paren
l_int|0
comma
id|st-&gt;chan
comma
id|CTL_BANK_SELECT
comma
l_int|128
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* remap to normal channel */
id|awe_controller
c_func
(paren
l_int|0
comma
id|st-&gt;chan
comma
id|CTL_BANK_SELECT
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|midi_mode
op_eq
id|MODE_GS
op_logical_and
op_logical_neg
id|msb_bit
)paren
multiline_comment|/* ignore LSB bank in GS mode (used for mapping) */
r_return
suffix:semicolon
multiline_comment|/* normal bank controls; accept both MSB and LSB */
r_if
c_cond
(paren
op_logical_neg
id|IS_DRUM_CHANNEL
c_func
(paren
id|st-&gt;chan
)paren
)paren
(brace
r_if
c_cond
(paren
id|midi_mode
op_eq
id|MODE_XG
)paren
(brace
r_if
c_cond
(paren
id|xg_bankmode
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
l_int|64
op_logical_or
id|val
op_eq
l_int|126
)paren
id|val
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|midi_mode
op_eq
id|MODE_GS
op_logical_and
id|val
op_eq
l_int|127
)paren
id|val
op_assign
l_int|0
suffix:semicolon
id|awe_controller
c_func
(paren
l_int|0
comma
id|st-&gt;chan
comma
id|CTL_BANK_SELECT
comma
id|val
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * RPN events&n; */
DECL|function|midi_rpn_event
r_static
r_void
id|midi_rpn_event
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
r_int
id|type
suffix:semicolon
id|type
op_assign
(paren
id|rpn_msb
(braket
id|st-&gt;chan
)braket
op_lshift
l_int|8
)paren
op_or
id|rpn_lsb
(braket
id|st-&gt;chan
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
l_int|0x0000
suffix:colon
multiline_comment|/* Pitch bend sensitivity */
multiline_comment|/* MSB only / 1 semitone per 128 */
r_if
c_cond
(paren
id|msb_bit
)paren
(brace
id|channels
(braket
id|st-&gt;chan
)braket
dot
id|bender_range
op_assign
id|rpn_val
(braket
id|st-&gt;chan
)braket
op_star
l_int|100
op_div
l_int|128
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x0001
suffix:colon
multiline_comment|/* fine tuning: */
multiline_comment|/* MSB/LSB, 8192=center, 100/8192 cent step */
id|finetune
op_assign
id|rpn_val
(braket
id|st-&gt;chan
)braket
op_minus
l_int|8192
suffix:semicolon
id|midi_detune
c_func
(paren
id|st-&gt;chan
comma
id|coarsetune
comma
id|finetune
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0002
suffix:colon
multiline_comment|/* coarse tuning */
multiline_comment|/* MSB only / 8192=center, 1 semitone per 128 */
r_if
c_cond
(paren
id|msb_bit
)paren
(brace
id|coarsetune
op_assign
id|rpn_val
(braket
id|st-&gt;chan
)braket
op_minus
l_int|8192
suffix:semicolon
id|midi_detune
c_func
(paren
id|st-&gt;chan
comma
id|coarsetune
comma
id|finetune
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x7F7F
suffix:colon
multiline_comment|/* &quot;lock-in&quot; RPN */
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* tuning:&n; *   coarse = -8192 to 8192 (100 cent per 128)&n; *   fine = -8192 to 8192 (max=100cent)&n; */
DECL|function|midi_detune
r_static
r_void
id|midi_detune
c_func
(paren
r_int
id|chan
comma
r_int
id|coarse
comma
r_int
id|fine
)paren
(brace
multiline_comment|/* 4096 = 1200 cents in AWE parameter */
r_int
id|val
suffix:semicolon
id|val
op_assign
id|coarse
op_star
l_int|4096
op_div
(paren
l_int|12
op_star
l_int|128
)paren
suffix:semicolon
id|val
op_add_assign
id|fine
op_div
l_int|24
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|send_effect
c_func
(paren
id|chan
comma
id|AWE_FX_INIT_PITCH
comma
id|val
)paren
suffix:semicolon
r_else
id|unset_effect
c_func
(paren
id|chan
comma
id|AWE_FX_INIT_PITCH
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * system exclusive message&n; * GM/GS/XG macros are accepted&n; */
DECL|function|midi_system_exclusive
r_static
r_void
id|midi_system_exclusive
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
multiline_comment|/* GM on */
r_static
r_int
r_char
id|gm_on_macro
(braket
)braket
op_assign
(brace
l_int|0x7e
comma
l_int|0x7f
comma
l_int|0x09
comma
l_int|0x01
comma
)brace
suffix:semicolon
multiline_comment|/* XG on */
r_static
r_int
r_char
id|xg_on_macro
(braket
)braket
op_assign
(brace
l_int|0x43
comma
l_int|0x10
comma
l_int|0x4c
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x7e
comma
l_int|0x00
comma
)brace
suffix:semicolon
multiline_comment|/* GS prefix&n;&t; * drum channel: XX=0x1?(channel), YY=0x15, ZZ=on/off&n;&t; * reverb mode: XX=0x01, YY=0x30, ZZ=0-7&n;&t; * chorus mode: XX=0x01, YY=0x38, ZZ=0-7&n;&t; */
r_static
r_int
r_char
id|gs_pfx_macro
(braket
)braket
op_assign
(brace
l_int|0x41
comma
l_int|0x10
comma
l_int|0x42
comma
l_int|0x12
comma
l_int|0x40
comma
multiline_comment|/*XX,YY,ZZ*/
)brace
suffix:semicolon
macro_line|#if 0
multiline_comment|/* SC88 system mode set&n;&t; * single module mode: XX=1&n;&t; * double module mode: XX=0&n;&t; */
r_static
r_int
r_char
id|gs_mode_macro
(braket
)braket
op_assign
(brace
l_int|0x41
comma
l_int|0x10
comma
l_int|0x42
comma
l_int|0x12
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x7F
comma
multiline_comment|/*ZZ*/
)brace
suffix:semicolon
multiline_comment|/* SC88 display macro: XX=01:bitmap, 00:text&n;&t; */
r_static
r_int
r_char
id|gs_disp_macro
(braket
)braket
op_assign
(brace
l_int|0x41
comma
l_int|0x10
comma
l_int|0x45
comma
l_int|0x12
comma
l_int|0x10
comma
multiline_comment|/*XX,00*/
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* GM on */
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|st-&gt;buf
comma
id|gm_on_macro
comma
r_sizeof
(paren
id|gm_on_macro
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|midi_mode
op_ne
id|MODE_GS
op_logical_and
id|midi_mode
op_ne
id|MODE_XG
)paren
id|midi_mode
op_assign
id|MODE_GM
suffix:semicolon
id|init_midi_status
c_func
(paren
id|st
)paren
suffix:semicolon
)brace
multiline_comment|/* GS macros */
r_else
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|st-&gt;buf
comma
id|gs_pfx_macro
comma
r_sizeof
(paren
id|gs_pfx_macro
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|midi_mode
op_ne
id|MODE_GS
op_logical_and
id|midi_mode
op_ne
id|MODE_XG
)paren
id|midi_mode
op_assign
id|MODE_GS
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;buf
(braket
l_int|5
)braket
op_eq
l_int|0x00
op_logical_and
id|st-&gt;buf
(braket
l_int|6
)braket
op_eq
l_int|0x7f
op_logical_and
id|st-&gt;buf
(braket
l_int|7
)braket
op_eq
l_int|0x00
)paren
(brace
multiline_comment|/* GS reset */
id|init_midi_status
c_func
(paren
id|st
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|st-&gt;buf
(braket
l_int|5
)braket
op_amp
l_int|0xf0
)paren
op_eq
l_int|0x10
op_logical_and
id|st-&gt;buf
(braket
l_int|6
)braket
op_eq
l_int|0x15
)paren
(brace
multiline_comment|/* drum pattern */
r_int
id|p
op_assign
id|st-&gt;buf
(braket
l_int|5
)braket
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|0
)paren
id|p
op_assign
l_int|9
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p
OL
l_int|10
)paren
id|p
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|st-&gt;buf
(braket
l_int|7
)braket
op_eq
l_int|0
)paren
id|DRUM_CHANNEL_OFF
c_func
(paren
id|p
)paren
suffix:semicolon
r_else
id|DRUM_CHANNEL_ON
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|st-&gt;buf
(braket
l_int|5
)braket
op_amp
l_int|0xf0
)paren
op_eq
l_int|0x10
op_logical_and
id|st-&gt;buf
(braket
l_int|6
)braket
op_eq
l_int|0x21
)paren
(brace
multiline_comment|/* program */
r_int
id|p
op_assign
id|st-&gt;buf
(braket
l_int|5
)braket
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|0
)paren
id|p
op_assign
l_int|9
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p
OL
l_int|10
)paren
id|p
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_DRUM_CHANNEL
c_func
(paren
id|p
)paren
)paren
id|awe_set_instr
c_func
(paren
l_int|0
comma
id|p
comma
id|st-&gt;buf
(braket
l_int|7
)braket
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|st-&gt;buf
(braket
l_int|5
)braket
op_eq
l_int|0x01
op_logical_and
id|st-&gt;buf
(braket
l_int|6
)braket
op_eq
l_int|0x30
)paren
(brace
multiline_comment|/* reverb mode */
id|awe_set_reverb_mode
c_func
(paren
id|st-&gt;buf
(braket
l_int|7
)braket
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|st-&gt;buf
(braket
l_int|5
)braket
op_eq
l_int|0x01
op_logical_and
id|st-&gt;buf
(braket
l_int|6
)braket
op_eq
l_int|0x38
)paren
(brace
multiline_comment|/* chorus mode */
id|awe_set_chorus_mode
c_func
(paren
id|st-&gt;buf
(braket
l_int|7
)braket
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|st-&gt;buf
(braket
l_int|5
)braket
op_eq
l_int|0x00
op_logical_and
id|st-&gt;buf
(braket
l_int|6
)braket
op_eq
l_int|0x04
)paren
(brace
multiline_comment|/* master volume */
id|awe_change_master_volume
c_func
(paren
id|st-&gt;buf
(braket
l_int|7
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* XG on */
r_else
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|st-&gt;buf
comma
id|xg_on_macro
comma
r_sizeof
(paren
id|xg_on_macro
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|midi_mode
op_assign
id|MODE_XG
suffix:semicolon
id|xg_mapping
op_assign
id|TRUE
suffix:semicolon
id|xg_bankmode
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*----------------------------------------------------------------*/
multiline_comment|/*&n; * convert NRPN/control values&n; */
DECL|function|send_converted_effect
r_static
r_int
id|send_converted_effect
c_func
(paren
id|ConvTable
op_star
id|table
comma
r_int
id|num_tables
comma
id|MidiStatus
op_star
id|st
comma
r_int
id|type
comma
r_int
id|val
)paren
(brace
r_int
id|i
comma
id|cval
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_tables
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|table
(braket
id|i
)braket
dot
id|control
op_eq
id|type
)paren
(brace
id|cval
op_assign
id|table
(braket
id|i
)braket
dot
id|convert
c_func
(paren
id|val
)paren
suffix:semicolon
id|send_effect
c_func
(paren
id|st-&gt;chan
comma
id|table
(braket
id|i
)braket
dot
id|awe_effect
comma
id|cval
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
)brace
r_return
id|FALSE
suffix:semicolon
)brace
DECL|function|add_converted_effect
r_static
r_int
id|add_converted_effect
c_func
(paren
id|ConvTable
op_star
id|table
comma
r_int
id|num_tables
comma
id|MidiStatus
op_star
id|st
comma
r_int
id|type
comma
r_int
id|val
)paren
(brace
r_int
id|i
comma
id|cval
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_tables
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|table
(braket
id|i
)braket
dot
id|control
op_eq
id|type
)paren
(brace
id|cval
op_assign
id|table
(braket
id|i
)braket
dot
id|convert
c_func
(paren
id|val
)paren
suffix:semicolon
id|add_effect
c_func
(paren
id|st-&gt;chan
comma
id|table
(braket
id|i
)braket
dot
id|awe_effect
op_or
l_int|0x80
comma
id|cval
)paren
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
)brace
r_return
id|FALSE
suffix:semicolon
)brace
multiline_comment|/*&n; * AWE32 NRPN effects&n; */
r_static
r_int
r_int
id|fx_delay
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
r_int
id|fx_attack
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
r_int
id|fx_hold
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
r_int
id|fx_decay
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
r_int
id|fx_the_value
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
r_int
id|fx_twice_value
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
r_int
id|fx_conv_pitch
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
r_int
id|fx_conv_Q
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
multiline_comment|/* function for each NRPN */
multiline_comment|/* [range]  units */
DECL|macro|fx_env1_delay
mdefine_line|#define fx_env1_delay&t;fx_delay&t;/* [0,5900] 4msec */
DECL|macro|fx_env1_attack
mdefine_line|#define fx_env1_attack&t;fx_attack&t;/* [0,5940] 1msec */
DECL|macro|fx_env1_hold
mdefine_line|#define fx_env1_hold&t;fx_hold&t;&t;/* [0,8191] 1msec */
DECL|macro|fx_env1_decay
mdefine_line|#define fx_env1_decay&t;fx_decay&t;/* [0,5940] 4msec */
DECL|macro|fx_env1_release
mdefine_line|#define fx_env1_release&t;fx_decay&t;/* [0,5940] 4msec */
DECL|macro|fx_env1_sustain
mdefine_line|#define fx_env1_sustain&t;fx_the_value&t;/* [0,127] 0.75dB */
DECL|macro|fx_env1_pitch
mdefine_line|#define fx_env1_pitch&t;fx_the_value&t;/* [-127,127] 9.375cents */
DECL|macro|fx_env1_cutoff
mdefine_line|#define fx_env1_cutoff&t;fx_the_value&t;/* [-127,127] 56.25cents */
DECL|macro|fx_env2_delay
mdefine_line|#define fx_env2_delay&t;fx_delay&t;/* [0,5900] 4msec */
DECL|macro|fx_env2_attack
mdefine_line|#define fx_env2_attack&t;fx_attack&t;/* [0,5940] 1msec */
DECL|macro|fx_env2_hold
mdefine_line|#define fx_env2_hold&t;fx_hold&t;&t;/* [0,8191] 1msec */
DECL|macro|fx_env2_decay
mdefine_line|#define fx_env2_decay&t;fx_decay&t;/* [0,5940] 4msec */
DECL|macro|fx_env2_release
mdefine_line|#define fx_env2_release&t;fx_decay&t;/* [0,5940] 4msec */
DECL|macro|fx_env2_sustain
mdefine_line|#define fx_env2_sustain&t;fx_the_value&t;/* [0,127] 0.75dB */
DECL|macro|fx_lfo1_delay
mdefine_line|#define fx_lfo1_delay&t;fx_delay&t;/* [0,5900] 4msec */
DECL|macro|fx_lfo1_freq
mdefine_line|#define fx_lfo1_freq&t;fx_twice_value&t;/* [0,127] 84mHz */
DECL|macro|fx_lfo1_volume
mdefine_line|#define fx_lfo1_volume&t;fx_twice_value&t;/* [0,127] 0.1875dB */
DECL|macro|fx_lfo1_pitch
mdefine_line|#define fx_lfo1_pitch&t;fx_the_value&t;/* [-127,127] 9.375cents */
DECL|macro|fx_lfo1_cutoff
mdefine_line|#define fx_lfo1_cutoff&t;fx_twice_value&t;/* [-64,63] 56.25cents */
DECL|macro|fx_lfo2_delay
mdefine_line|#define fx_lfo2_delay&t;fx_delay&t;/* [0,5900] 4msec */
DECL|macro|fx_lfo2_freq
mdefine_line|#define fx_lfo2_freq&t;fx_twice_value&t;/* [0,127] 84mHz */
DECL|macro|fx_lfo2_pitch
mdefine_line|#define fx_lfo2_pitch&t;fx_the_value&t;/* [-127,127] 9.375cents */
DECL|macro|fx_init_pitch
mdefine_line|#define fx_init_pitch&t;fx_conv_pitch&t;/* [-8192,8192] cents */
DECL|macro|fx_chorus
mdefine_line|#define fx_chorus&t;fx_the_value&t;/* [0,255] -- */
DECL|macro|fx_reverb
mdefine_line|#define fx_reverb&t;fx_the_value&t;/* [0,255] -- */
DECL|macro|fx_cutoff
mdefine_line|#define fx_cutoff&t;fx_twice_value&t;/* [0,127] 62Hz */
DECL|macro|fx_filterQ
mdefine_line|#define fx_filterQ&t;fx_conv_Q&t;/* [0,127] -- */
DECL|function|fx_delay
r_static
r_int
r_int
id|fx_delay
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
r_int
r_int
)paren
id|calc_parm_delay
c_func
(paren
id|val
)paren
suffix:semicolon
)brace
DECL|function|fx_attack
r_static
r_int
r_int
id|fx_attack
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
r_int
r_int
)paren
id|calc_parm_attack
c_func
(paren
id|val
)paren
suffix:semicolon
)brace
DECL|function|fx_hold
r_static
r_int
r_int
id|fx_hold
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
r_int
r_int
)paren
id|calc_parm_hold
c_func
(paren
id|val
)paren
suffix:semicolon
)brace
DECL|function|fx_decay
r_static
r_int
r_int
id|fx_decay
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
r_int
r_int
)paren
id|calc_parm_decay
c_func
(paren
id|val
)paren
suffix:semicolon
)brace
DECL|function|fx_the_value
r_static
r_int
r_int
id|fx_the_value
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
r_int
r_int
)paren
(paren
id|val
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
DECL|function|fx_twice_value
r_static
r_int
r_int
id|fx_twice_value
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
r_int
r_int
)paren
(paren
(paren
id|val
op_star
l_int|2
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
DECL|function|fx_conv_pitch
r_static
r_int
r_int
id|fx_conv_pitch
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
r_int
)paren
(paren
id|val
op_star
l_int|4096
op_div
l_int|1200
)paren
suffix:semicolon
)brace
DECL|function|fx_conv_Q
r_static
r_int
r_int
id|fx_conv_Q
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
r_int
r_int
)paren
(paren
(paren
id|val
op_div
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
DECL|variable|awe_effects
r_static
id|ConvTable
id|awe_effects
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
id|AWE_FX_LFO1_DELAY
comma
id|fx_lfo1_delay
)brace
comma
(brace
l_int|1
comma
id|AWE_FX_LFO1_FREQ
comma
id|fx_lfo1_freq
)brace
comma
(brace
l_int|2
comma
id|AWE_FX_LFO2_DELAY
comma
id|fx_lfo2_delay
)brace
comma
(brace
l_int|3
comma
id|AWE_FX_LFO2_FREQ
comma
id|fx_lfo2_freq
)brace
comma
(brace
l_int|4
comma
id|AWE_FX_ENV1_DELAY
comma
id|fx_env1_delay
)brace
comma
(brace
l_int|5
comma
id|AWE_FX_ENV1_ATTACK
comma
id|fx_env1_attack
)brace
comma
(brace
l_int|6
comma
id|AWE_FX_ENV1_HOLD
comma
id|fx_env1_hold
)brace
comma
(brace
l_int|7
comma
id|AWE_FX_ENV1_DECAY
comma
id|fx_env1_decay
)brace
comma
(brace
l_int|8
comma
id|AWE_FX_ENV1_SUSTAIN
comma
id|fx_env1_sustain
)brace
comma
(brace
l_int|9
comma
id|AWE_FX_ENV1_RELEASE
comma
id|fx_env1_release
)brace
comma
(brace
l_int|10
comma
id|AWE_FX_ENV2_DELAY
comma
id|fx_env2_delay
)brace
comma
(brace
l_int|11
comma
id|AWE_FX_ENV2_ATTACK
comma
id|fx_env2_attack
)brace
comma
(brace
l_int|12
comma
id|AWE_FX_ENV2_HOLD
comma
id|fx_env2_hold
)brace
comma
(brace
l_int|13
comma
id|AWE_FX_ENV2_DECAY
comma
id|fx_env2_decay
)brace
comma
(brace
l_int|14
comma
id|AWE_FX_ENV2_SUSTAIN
comma
id|fx_env2_sustain
)brace
comma
(brace
l_int|15
comma
id|AWE_FX_ENV2_RELEASE
comma
id|fx_env2_release
)brace
comma
(brace
l_int|16
comma
id|AWE_FX_INIT_PITCH
comma
id|fx_init_pitch
)brace
comma
(brace
l_int|17
comma
id|AWE_FX_LFO1_PITCH
comma
id|fx_lfo1_pitch
)brace
comma
(brace
l_int|18
comma
id|AWE_FX_LFO2_PITCH
comma
id|fx_lfo2_pitch
)brace
comma
(brace
l_int|19
comma
id|AWE_FX_ENV1_PITCH
comma
id|fx_env1_pitch
)brace
comma
(brace
l_int|20
comma
id|AWE_FX_LFO1_VOLUME
comma
id|fx_lfo1_volume
)brace
comma
(brace
l_int|21
comma
id|AWE_FX_CUTOFF
comma
id|fx_cutoff
)brace
comma
(brace
l_int|22
comma
id|AWE_FX_FILTERQ
comma
id|fx_filterQ
)brace
comma
(brace
l_int|23
comma
id|AWE_FX_LFO1_CUTOFF
comma
id|fx_lfo1_cutoff
)brace
comma
(brace
l_int|24
comma
id|AWE_FX_ENV1_CUTOFF
comma
id|fx_env1_cutoff
)brace
comma
(brace
l_int|25
comma
id|AWE_FX_CHORUS
comma
id|fx_chorus
)brace
comma
(brace
l_int|26
comma
id|AWE_FX_REVERB
comma
id|fx_reverb
)brace
comma
)brace
suffix:semicolon
DECL|variable|num_awe_effects
r_static
r_int
id|num_awe_effects
op_assign
id|numberof
c_func
(paren
id|awe_effects
)paren
suffix:semicolon
multiline_comment|/*&n; * GS(SC88) NRPN effects; still experimental&n; */
multiline_comment|/* cutoff: quarter semitone step, max=255 */
DECL|function|gs_cutoff
r_static
r_int
r_int
id|gs_cutoff
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|gs_sense
(braket
id|FX_CUTOFF
)braket
op_div
l_int|50
suffix:semicolon
)brace
multiline_comment|/* resonance: 0 to 15(max) */
DECL|function|gs_filterQ
r_static
r_int
r_int
id|gs_filterQ
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|gs_sense
(braket
id|FX_RESONANCE
)braket
op_div
l_int|50
suffix:semicolon
)brace
multiline_comment|/* attack: */
DECL|function|gs_attack
r_static
r_int
r_int
id|gs_attack
c_func
(paren
r_int
id|val
)paren
(brace
r_return
op_minus
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|gs_sense
(braket
id|FX_ATTACK
)braket
op_div
l_int|50
suffix:semicolon
)brace
multiline_comment|/* decay: */
DECL|function|gs_decay
r_static
r_int
r_int
id|gs_decay
c_func
(paren
r_int
id|val
)paren
(brace
r_return
op_minus
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|gs_sense
(braket
id|FX_RELEASE
)braket
op_div
l_int|50
suffix:semicolon
)brace
multiline_comment|/* release: */
DECL|function|gs_release
r_static
r_int
r_int
id|gs_release
c_func
(paren
r_int
id|val
)paren
(brace
r_return
op_minus
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|gs_sense
(braket
id|FX_RELEASE
)braket
op_div
l_int|50
suffix:semicolon
)brace
multiline_comment|/* vibrato freq: 0.042Hz step, max=255 */
DECL|function|gs_vib_rate
r_static
r_int
r_int
id|gs_vib_rate
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|gs_sense
(braket
id|FX_VIBRATE
)braket
op_div
l_int|50
suffix:semicolon
)brace
multiline_comment|/* vibrato depth: max=127, 1 octave */
DECL|function|gs_vib_depth
r_static
r_int
r_int
id|gs_vib_depth
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|gs_sense
(braket
id|FX_VIBDEPTH
)braket
op_div
l_int|50
suffix:semicolon
)brace
multiline_comment|/* vibrato delay: -0.725msec step */
DECL|function|gs_vib_delay
r_static
r_int
r_int
id|gs_vib_delay
c_func
(paren
r_int
id|val
)paren
(brace
r_return
op_minus
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|gs_sense
(braket
id|FX_VIBDELAY
)braket
op_div
l_int|50
suffix:semicolon
)brace
DECL|variable|gs_effects
r_static
id|ConvTable
id|gs_effects
(braket
)braket
op_assign
(brace
(brace
l_int|32
comma
id|AWE_FX_CUTOFF
comma
id|gs_cutoff
)brace
comma
(brace
l_int|33
comma
id|AWE_FX_FILTERQ
comma
id|gs_filterQ
)brace
comma
(brace
l_int|99
comma
id|AWE_FX_ENV2_ATTACK
comma
id|gs_attack
)brace
comma
(brace
l_int|100
comma
id|AWE_FX_ENV2_DECAY
comma
id|gs_decay
)brace
comma
(brace
l_int|102
comma
id|AWE_FX_ENV2_RELEASE
comma
id|gs_release
)brace
comma
(brace
l_int|8
comma
id|AWE_FX_LFO1_FREQ
comma
id|gs_vib_rate
)brace
comma
(brace
l_int|9
comma
id|AWE_FX_LFO1_VOLUME
comma
id|gs_vib_depth
)brace
comma
(brace
l_int|10
comma
id|AWE_FX_LFO1_DELAY
comma
id|gs_vib_delay
)brace
comma
)brace
suffix:semicolon
DECL|variable|num_gs_effects
r_static
r_int
id|num_gs_effects
op_assign
id|numberof
c_func
(paren
id|gs_effects
)paren
suffix:semicolon
multiline_comment|/*&n; * NRPN events: accept as AWE32/SC88 specific controls&n; */
DECL|function|midi_nrpn_event
r_static
r_void
id|midi_nrpn_event
c_func
(paren
id|MidiStatus
op_star
id|st
)paren
(brace
r_if
c_cond
(paren
id|rpn_msb
(braket
id|st-&gt;chan
)braket
op_eq
l_int|127
op_logical_and
id|rpn_lsb
(braket
id|st-&gt;chan
)braket
op_le
l_int|26
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|msb_bit
)paren
multiline_comment|/* both MSB/LSB necessary */
id|send_converted_effect
c_func
(paren
id|awe_effects
comma
id|num_awe_effects
comma
id|st
comma
id|rpn_lsb
(braket
id|st-&gt;chan
)braket
comma
id|rpn_val
(braket
id|st-&gt;chan
)braket
op_minus
l_int|8192
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rpn_msb
(braket
id|st-&gt;chan
)braket
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|msb_bit
)paren
multiline_comment|/* only MSB is valid */
id|add_converted_effect
c_func
(paren
id|gs_effects
comma
id|num_gs_effects
comma
id|st
comma
id|rpn_lsb
(braket
id|st-&gt;chan
)braket
comma
id|rpn_val
(braket
id|st-&gt;chan
)braket
op_div
l_int|128
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * XG control effects; still experimental&n; */
multiline_comment|/* cutoff: quarter semitone step, max=255 */
DECL|function|xg_cutoff
r_static
r_int
r_int
id|xg_cutoff
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|xg_sense
(braket
id|FX_CUTOFF
)braket
op_div
l_int|64
suffix:semicolon
)brace
multiline_comment|/* resonance: 0(open) to 15(most nasal) */
DECL|function|xg_filterQ
r_static
r_int
r_int
id|xg_filterQ
c_func
(paren
r_int
id|val
)paren
(brace
r_return
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|xg_sense
(braket
id|FX_RESONANCE
)braket
op_div
l_int|64
suffix:semicolon
)brace
multiline_comment|/* attack: */
DECL|function|xg_attack
r_static
r_int
r_int
id|xg_attack
c_func
(paren
r_int
id|val
)paren
(brace
r_return
op_minus
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|xg_sense
(braket
id|FX_ATTACK
)braket
op_div
l_int|64
suffix:semicolon
)brace
multiline_comment|/* release: */
DECL|function|xg_release
r_static
r_int
r_int
id|xg_release
c_func
(paren
r_int
id|val
)paren
(brace
r_return
op_minus
(paren
id|val
op_minus
l_int|64
)paren
op_star
id|xg_sense
(braket
id|FX_RELEASE
)braket
op_div
l_int|64
suffix:semicolon
)brace
DECL|variable|xg_effects
r_static
id|ConvTable
id|xg_effects
(braket
)braket
op_assign
(brace
(brace
l_int|71
comma
id|AWE_FX_CUTOFF
comma
id|xg_cutoff
)brace
comma
(brace
l_int|74
comma
id|AWE_FX_FILTERQ
comma
id|xg_filterQ
)brace
comma
(brace
l_int|72
comma
id|AWE_FX_ENV2_RELEASE
comma
id|xg_release
)brace
comma
(brace
l_int|73
comma
id|AWE_FX_ENV2_ATTACK
comma
id|xg_attack
)brace
comma
)brace
suffix:semicolon
DECL|variable|num_xg_effects
r_static
r_int
id|num_xg_effects
op_assign
id|numberof
c_func
(paren
id|xg_effects
)paren
suffix:semicolon
DECL|function|xg_control_change
r_static
r_int
id|xg_control_change
c_func
(paren
id|MidiStatus
op_star
id|st
comma
r_int
id|cmd
comma
r_int
id|val
)paren
(brace
r_return
id|add_converted_effect
c_func
(paren
id|xg_effects
comma
id|num_xg_effects
comma
id|st
comma
id|cmd
comma
id|val
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AWE32_MIDIEMU */
multiline_comment|/*----------------------------------------------------------------*/
multiline_comment|/*&n; * device / lowlevel (module) interface&n; */
DECL|function|attach_awe
r_int
id|__init
id|attach_awe
c_func
(paren
r_void
)paren
(brace
r_return
id|_attach_awe
c_func
(paren
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|unload_awe
r_void
id|__exit
id|unload_awe
c_func
(paren
r_void
)paren
(brace
id|_unload_awe
c_func
(paren
)paren
suffix:semicolon
macro_line|#if defined CONFIG_ISAPNP || defined CONFIG_ISAPNP_MODULE
r_if
c_cond
(paren
id|isapnp
)paren
id|awe_deactivate_isapnp
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* isapnp */
)brace
DECL|variable|attach_awe
id|module_init
c_func
(paren
id|attach_awe
)paren
suffix:semicolon
DECL|variable|unload_awe
id|module_exit
c_func
(paren
id|unload_awe
)paren
suffix:semicolon
macro_line|#ifndef MODULE
DECL|function|setup_awe
r_static
r_int
id|__init
id|setup_awe
c_func
(paren
r_char
op_star
id|str
)paren
(brace
multiline_comment|/* io, memsize, isapnp */
r_int
id|ints
(braket
l_int|4
)braket
suffix:semicolon
id|str
op_assign
id|get_options
c_func
(paren
id|str
comma
id|ARRAY_SIZE
c_func
(paren
id|ints
)paren
comma
id|ints
)paren
suffix:semicolon
id|io
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
id|memsize
op_assign
id|ints
(braket
l_int|2
)braket
suffix:semicolon
id|isapnp
op_assign
id|ints
(braket
l_int|3
)braket
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;awe=&quot;
comma
id|setup_awe
)paren
suffix:semicolon
macro_line|#endif
eof
