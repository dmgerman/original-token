multiline_comment|/*&n; *  linux/drivers/sound/dmasound/dmasound_atari.c&n; *&n; *  Atari TT and Falcon DMA Sound Driver&n; *&n; *  See linux/drivers/sound/dmasound/dmasound_core.c for copyright and credits&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/pgalloc.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/atariints.h&gt;
macro_line|#include &lt;asm/atari_stram.h&gt;
macro_line|#include &quot;dmasound.h&quot;
r_extern
r_void
id|atari_microwire_cmd
c_func
(paren
r_int
id|cmd
)paren
suffix:semicolon
DECL|variable|is_falcon
r_static
r_int
id|is_falcon
suffix:semicolon
DECL|variable|write_sq_ignore_int
r_static
r_int
id|write_sq_ignore_int
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ++TeSche: used for Falcon */
DECL|variable|expand_bal
r_static
r_int
id|expand_bal
suffix:semicolon
multiline_comment|/* Balance factor for expanding (not volume!) */
DECL|variable|expand_data
r_static
r_int
id|expand_data
suffix:semicolon
multiline_comment|/* Data for expanding */
multiline_comment|/*** Translations ************************************************************/
multiline_comment|/* ++TeSche: radically changed for new expanding purposes...&n; *&n; * These two routines now deal with copying/expanding/translating the samples&n; * from user space into our buffer at the right frequency. They take care about&n; * how much data there&squot;s actually to read, how much buffer space there is and&n; * to convert samples into the right frequency/encoding. They will only work on&n; * complete samples so it may happen they leave some bytes in the input stream&n; * if the user didn&squot;t write a multiple of the current sample size. They both&n; * return the number of bytes they&squot;ve used from both streams so you may detect&n; * such a situation. Luckily all programs should be able to cope with that.&n; *&n; * I think I&squot;ve optimized anything as far as one can do in plain C, all&n; * variables should fit in registers and the loops are really short. There&squot;s&n; * one loop for every possible situation. Writing a more generalized and thus&n; * parameterized loop would only produce slower code. Feel free to optimize&n; * this in assembler if you like. :)&n; *&n; * I think these routines belong here because they&squot;re not yet really hardware&n; * independent, especially the fact that the Falcon can play 16bit samples&n; * only in stereo is hardcoded in both of them!&n; *&n; * ++geert: split in even more functions (one per format)&n; */
r_static
id|ssize_t
id|ata_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
multiline_comment|/*** Low level stuff *********************************************************/
r_static
r_void
id|AtaOpen
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|AtaRelease
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
op_star
id|AtaAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
suffix:semicolon
r_static
r_void
id|AtaFree
c_func
(paren
r_void
op_star
comma
r_int
r_int
id|size
)paren
suffix:semicolon
r_static
r_int
id|AtaIrqInit
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef MODULE
r_static
r_void
id|AtaIrqCleanUp
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
r_static
r_int
id|AtaSetBass
c_func
(paren
r_int
id|bass
)paren
suffix:semicolon
r_static
r_int
id|AtaSetTreble
c_func
(paren
r_int
id|treble
)paren
suffix:semicolon
r_static
r_void
id|TTSilence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|TTInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|TTSetFormat
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|TTSetVolume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
r_static
r_int
id|TTSetGain
c_func
(paren
r_int
id|gain
)paren
suffix:semicolon
r_static
r_void
id|FalconSilence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|FalconInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|FalconSetFormat
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|FalconSetVolume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
r_static
r_void
id|AtaPlayNextFrame
c_func
(paren
r_int
id|index
)paren
suffix:semicolon
r_static
r_void
id|AtaPlay
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|AtaInterrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
suffix:semicolon
multiline_comment|/*** Mid level stuff *********************************************************/
r_static
r_void
id|TTMixerInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|FalconMixerInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|AtaMixerIoctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
suffix:semicolon
r_static
r_int
id|TTMixerIoctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
suffix:semicolon
r_static
r_int
id|FalconMixerIoctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
suffix:semicolon
r_static
r_void
id|AtaWriteSqSetup
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|AtaSqOpen
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|TTStateInfo
c_func
(paren
r_char
op_star
id|buffer
)paren
suffix:semicolon
r_static
r_int
id|FalconStateInfo
c_func
(paren
r_char
op_star
id|buffer
)paren
suffix:semicolon
multiline_comment|/*** Translations ************************************************************/
DECL|function|ata_ct_law
r_static
id|ssize_t
id|ata_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_char
op_star
id|table
op_assign
id|dmasound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|dmasound_ulaw2dma8
suffix:colon
id|dmasound_alaw2dma8
suffix:semicolon
id|ssize_t
id|count
comma
id|used
suffix:semicolon
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmasound.soft.stereo
)paren
id|count
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|table
(braket
id|data
)braket
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_s8
r_static
id|ssize_t
id|ata_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_void
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmasound.soft.stereo
)paren
id|count
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|p
comma
id|userPtr
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_u8
r_static
id|ssize_t
id|ata_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
op_xor
l_int|0x80
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
op_xor
l_int|0x8080
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_s16be
r_static
id|ssize_t
id|ata_ct_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
r_void
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|p
comma
id|userPtr
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_u16be
r_static
id|ssize_t
id|ata_ct_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x8000
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
op_xor
l_int|0x80008000
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_s16le
r_static
id|ssize_t
id|ata_ct_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
id|count
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_u16le
r_static
id|ssize_t
id|ata_ct_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
id|count
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
op_xor
l_int|0x80008000
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_law
r_static
id|ssize_t
id|ata_ctx_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_char
op_star
id|table
op_assign
id|dmasound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|dmasound_ulaw2dma8
suffix:colon
id|dmasound_alaw2dma8
suffix:semicolon
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_char
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
id|u_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|userCount
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|table
(braket
id|c
)braket
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|2
)paren
(brace
id|u_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|table
(braket
id|c
)braket
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_or_assign
id|table
(braket
id|c
)braket
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_s8
r_static
id|ssize_t
id|ata_ctx_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_char
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|userCount
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_u8
r_static
id|ssize_t
id|ata_ctx_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_char
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|userCount
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x80
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x8080
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_s16be
r_static
id|ssize_t
id|ata_ctx_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_long
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_u16be
r_static
id|ssize_t
id|ata_ctx_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x8000
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_long
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x80008000
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_s16le
r_static
id|ssize_t
id|ata_ctx_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_long
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_u16le
r_static
id|ssize_t
id|ata_ctx_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmasound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_long
id|data
op_assign
id|expand_data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
op_xor
l_int|0x80008000
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_data
op_assign
id|data
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|variable|transTTNormal
r_static
id|TRANS
id|transTTNormal
op_assign
(brace
id|ct_ulaw
suffix:colon
id|ata_ct_law
comma
id|ct_alaw
suffix:colon
id|ata_ct_law
comma
id|ct_s8
suffix:colon
id|ata_ct_s8
comma
id|ct_u8
suffix:colon
id|ata_ct_u8
comma
)brace
suffix:semicolon
DECL|variable|transTTExpanding
r_static
id|TRANS
id|transTTExpanding
op_assign
(brace
id|ct_ulaw
suffix:colon
id|ata_ctx_law
comma
id|ct_alaw
suffix:colon
id|ata_ctx_law
comma
id|ct_s8
suffix:colon
id|ata_ctx_s8
comma
id|ct_u8
suffix:colon
id|ata_ctx_u8
comma
)brace
suffix:semicolon
DECL|variable|transFalconNormal
r_static
id|TRANS
id|transFalconNormal
op_assign
(brace
id|ct_ulaw
suffix:colon
id|ata_ct_law
comma
id|ct_alaw
suffix:colon
id|ata_ct_law
comma
id|ct_s8
suffix:colon
id|ata_ct_s8
comma
id|ct_u8
suffix:colon
id|ata_ct_u8
comma
id|ct_s16be
suffix:colon
id|ata_ct_s16be
comma
id|ct_u16be
suffix:colon
id|ata_ct_u16be
comma
id|ct_s16le
suffix:colon
id|ata_ct_s16le
comma
id|ct_u16le
suffix:colon
id|ata_ct_u16le
)brace
suffix:semicolon
DECL|variable|transFalconExpanding
r_static
id|TRANS
id|transFalconExpanding
op_assign
(brace
id|ct_ulaw
suffix:colon
id|ata_ctx_law
comma
id|ct_alaw
suffix:colon
id|ata_ctx_law
comma
id|ct_s8
suffix:colon
id|ata_ctx_s8
comma
id|ct_u8
suffix:colon
id|ata_ctx_u8
comma
id|ct_s16be
suffix:colon
id|ata_ctx_s16be
comma
id|ct_u16be
suffix:colon
id|ata_ctx_u16be
comma
id|ct_s16le
suffix:colon
id|ata_ctx_s16le
comma
id|ct_u16le
suffix:colon
id|ata_ctx_u16le
comma
)brace
suffix:semicolon
multiline_comment|/*** Low level stuff *********************************************************/
multiline_comment|/*&n; * Atari (TT/Falcon)&n; */
DECL|function|AtaOpen
r_static
r_void
id|AtaOpen
c_func
(paren
r_void
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
)brace
DECL|function|AtaRelease
r_static
r_void
id|AtaRelease
c_func
(paren
r_void
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|AtaAlloc
r_static
r_void
op_star
id|AtaAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_return
id|atari_stram_alloc
c_func
(paren
id|size
comma
l_string|&quot;dmasound&quot;
)paren
suffix:semicolon
)brace
DECL|function|AtaFree
r_static
r_void
id|AtaFree
c_func
(paren
r_void
op_star
id|obj
comma
r_int
r_int
id|size
)paren
(brace
id|atari_stram_free
c_func
(paren
id|obj
)paren
suffix:semicolon
)brace
DECL|function|AtaIrqInit
r_static
r_int
id|__init
id|AtaIrqInit
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Set up timer A. Timer A&n;&t;   will receive a signal upon end of playing from the sound&n;&t;   hardware. Furthermore Timer A is able to count events&n;&t;   and will cause an interrupt after a programmed number&n;&t;   of events. So all we need to keep the music playing is&n;&t;   to provide the sound hardware with new data upon&n;&t;   an interrupt from timer A. */
id|mfp.tim_ct_a
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ++roman: Stop timer before programming! */
id|mfp.tim_dt_a
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Cause interrupt after first event. */
id|mfp.tim_ct_a
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* Turn on event counting. */
multiline_comment|/* Register interrupt handler. */
id|request_irq
c_func
(paren
id|IRQ_MFP_TIMA
comma
id|AtaInterrupt
comma
id|IRQ_TYPE_SLOW
comma
l_string|&quot;DMA sound&quot;
comma
id|AtaInterrupt
)paren
suffix:semicolon
id|mfp.int_en_a
op_or_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* Turn interrupt on. */
id|mfp.int_mk_a
op_or_assign
l_int|0x20
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|AtaIrqCleanUp
r_static
r_void
id|AtaIrqCleanUp
c_func
(paren
r_void
)paren
(brace
id|mfp.tim_ct_a
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* stop timer */
id|mfp.int_en_a
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
multiline_comment|/* turn interrupt off */
id|free_irq
c_func
(paren
id|IRQ_MFP_TIMA
comma
id|AtaInterrupt
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
DECL|macro|TONE_VOXWARE_TO_DB
mdefine_line|#define TONE_VOXWARE_TO_DB(v) &bslash;&n;&t;(((v) &lt; 0) ? -12 : ((v) &gt; 100) ? 12 : ((v) - 50) * 6 / 25)
DECL|macro|TONE_DB_TO_VOXWARE
mdefine_line|#define TONE_DB_TO_VOXWARE(v) (((v) * 25 + ((v) &gt; 0 ? 5 : -5)) / 6 + 50)
DECL|function|AtaSetBass
r_static
r_int
id|AtaSetBass
c_func
(paren
r_int
id|bass
)paren
(brace
id|dmasound.bass
op_assign
id|TONE_VOXWARE_TO_DB
c_func
(paren
id|bass
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BASS
c_func
(paren
id|dmasound.bass
)paren
)paren
suffix:semicolon
r_return
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|dmasound.bass
)paren
suffix:semicolon
)brace
DECL|function|AtaSetTreble
r_static
r_int
id|AtaSetTreble
c_func
(paren
r_int
id|treble
)paren
(brace
id|dmasound.treble
op_assign
id|TONE_VOXWARE_TO_DB
c_func
(paren
id|treble
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_TREBLE
c_func
(paren
id|dmasound.treble
)paren
)paren
suffix:semicolon
r_return
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|dmasound.treble
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * TT&n; */
DECL|function|TTSilence
r_static
r_void
id|TTSilence
c_func
(paren
r_void
)paren
(brace
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_OFF
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_PSG_HIGH
)paren
suffix:semicolon
multiline_comment|/* mix in PSG signal 1:1 */
)brace
DECL|function|TTInit
r_static
r_void
id|TTInit
c_func
(paren
r_void
)paren
(brace
r_int
id|mode
comma
id|i
comma
id|idx
suffix:semicolon
r_const
r_int
id|freq
(braket
l_int|4
)braket
op_assign
(brace
l_int|50066
comma
l_int|25033
comma
l_int|12517
comma
l_int|6258
)brace
suffix:semicolon
multiline_comment|/* search a frequency that fits into the allowed error range */
id|idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|freq
)paren
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* this isn&squot;t as much useful for a TT than for a Falcon, but&n;&t;&t; * then it doesn&squot;t hurt very much to implement it for a TT too.&n;&t;&t; */
r_if
c_cond
(paren
(paren
l_int|100
op_star
id|abs
c_func
(paren
id|dmasound.soft.speed
op_minus
id|freq
(braket
id|i
)braket
)paren
op_div
id|freq
(braket
id|i
)braket
)paren
OL
id|catchRadius
)paren
id|idx
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|idx
OG
op_minus
l_int|1
)paren
(brace
id|dmasound.soft.speed
op_assign
id|freq
(braket
id|idx
)braket
suffix:semicolon
id|dmasound.trans_write
op_assign
op_amp
id|transTTNormal
suffix:semicolon
)brace
r_else
id|dmasound.trans_write
op_assign
op_amp
id|transTTExpanding
suffix:semicolon
id|TTSilence
c_func
(paren
)paren
suffix:semicolon
id|dmasound.hard
op_assign
id|dmasound.soft
suffix:semicolon
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|50066
)paren
(brace
multiline_comment|/* we would need to squeeze the sound, but we won&squot;t do that */
id|dmasound.hard.speed
op_assign
l_int|50066
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_50KHZ
suffix:semicolon
id|dmasound.trans_write
op_assign
op_amp
id|transTTNormal
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|25033
)paren
(brace
id|dmasound.hard.speed
op_assign
l_int|50066
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_50KHZ
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|12517
)paren
(brace
id|dmasound.hard.speed
op_assign
l_int|25033
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_25KHZ
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|6258
)paren
(brace
id|dmasound.hard.speed
op_assign
l_int|12517
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_12KHZ
suffix:semicolon
)brace
r_else
(brace
id|dmasound.hard.speed
op_assign
l_int|6258
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_6KHZ
suffix:semicolon
)brace
id|tt_dmasnd.mode
op_assign
(paren
id|dmasound.hard.stereo
ques
c_cond
id|DMASND_MODE_STEREO
suffix:colon
id|DMASND_MODE_MONO
)paren
op_or
id|DMASND_MODE_8BIT
op_or
id|mode
suffix:semicolon
id|expand_bal
op_assign
op_minus
id|dmasound.soft.speed
suffix:semicolon
)brace
DECL|function|TTSetFormat
r_static
r_int
id|TTSetFormat
c_func
(paren
r_int
id|format
)paren
(brace
multiline_comment|/* TT sound DMA supports only 8bit modes */
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|AFMT_QUERY
suffix:colon
r_return
id|dmasound.soft.format
suffix:semicolon
r_case
id|AFMT_MU_LAW
suffix:colon
r_case
id|AFMT_A_LAW
suffix:colon
r_case
id|AFMT_S8
suffix:colon
r_case
id|AFMT_U8
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|format
op_assign
id|AFMT_S8
suffix:semicolon
)brace
id|dmasound.soft.format
op_assign
id|format
suffix:semicolon
id|dmasound.soft.size
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|dmasound.minDev
op_eq
id|SND_DEV_DSP
)paren
(brace
id|dmasound.dsp.format
op_assign
id|format
suffix:semicolon
id|dmasound.dsp.size
op_assign
l_int|8
suffix:semicolon
)brace
id|TTInit
c_func
(paren
)paren
suffix:semicolon
r_return
id|format
suffix:semicolon
)brace
DECL|macro|VOLUME_VOXWARE_TO_DB
mdefine_line|#define VOLUME_VOXWARE_TO_DB(v) &bslash;&n;&t;(((v) &lt; 0) ? -40 : ((v) &gt; 100) ? 0 : ((v) * 2) / 5 - 40)
DECL|macro|VOLUME_DB_TO_VOXWARE
mdefine_line|#define VOLUME_DB_TO_VOXWARE(v) ((((v) + 40) * 5 + 1) / 2)
DECL|function|TTSetVolume
r_static
r_int
id|TTSetVolume
c_func
(paren
r_int
id|volume
)paren
(brace
id|dmasound.volume_left
op_assign
id|VOLUME_VOXWARE_TO_DB
c_func
(paren
id|volume
op_amp
l_int|0xff
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALLEFT
c_func
(paren
id|dmasound.volume_left
)paren
)paren
suffix:semicolon
id|dmasound.volume_right
op_assign
id|VOLUME_VOXWARE_TO_DB
c_func
(paren
(paren
id|volume
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALRIGHT
c_func
(paren
id|dmasound.volume_right
)paren
)paren
suffix:semicolon
r_return
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|dmasound.volume_left
)paren
op_or
(paren
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|dmasound.volume_right
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|macro|GAIN_VOXWARE_TO_DB
mdefine_line|#define GAIN_VOXWARE_TO_DB(v) &bslash;&n;&t;(((v) &lt; 0) ? -80 : ((v) &gt; 100) ? 0 : ((v) * 4) / 5 - 80)
DECL|macro|GAIN_DB_TO_VOXWARE
mdefine_line|#define GAIN_DB_TO_VOXWARE(v) ((((v) + 80) * 5 + 1) / 4)
DECL|function|TTSetGain
r_static
r_int
id|TTSetGain
c_func
(paren
r_int
id|gain
)paren
(brace
id|dmasound.gain
op_assign
id|GAIN_VOXWARE_TO_DB
c_func
(paren
id|gain
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_VOLUME
c_func
(paren
id|dmasound.gain
)paren
)paren
suffix:semicolon
r_return
id|GAIN_DB_TO_VOXWARE
c_func
(paren
id|dmasound.gain
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Falcon&n; */
DECL|function|FalconSilence
r_static
r_void
id|FalconSilence
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* stop playback, set sample rate 50kHz for PSG sound */
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_OFF
suffix:semicolon
id|tt_dmasnd.mode
op_assign
id|DMASND_MODE_50KHZ
op_or
id|DMASND_MODE_STEREO
op_or
id|DMASND_MODE_8BIT
suffix:semicolon
id|tt_dmasnd.int_div
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* STE compatible divider */
id|tt_dmasnd.int_ctrl
op_assign
l_int|0x0
suffix:semicolon
id|tt_dmasnd.cbar_src
op_assign
l_int|0x0000
suffix:semicolon
multiline_comment|/* no matrix inputs */
id|tt_dmasnd.cbar_dst
op_assign
l_int|0x0000
suffix:semicolon
multiline_comment|/* no matrix outputs */
id|tt_dmasnd.dac_src
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* connect ADC to DAC, disconnect matrix */
id|tt_dmasnd.adc_src
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* ADC Input = PSG */
)brace
DECL|function|FalconInit
r_static
r_void
id|FalconInit
c_func
(paren
r_void
)paren
(brace
r_int
id|divider
comma
id|i
comma
id|idx
suffix:semicolon
r_const
r_int
id|freq
(braket
l_int|8
)braket
op_assign
(brace
l_int|49170
comma
l_int|32780
comma
l_int|24585
comma
l_int|19668
comma
l_int|16390
comma
l_int|12292
comma
l_int|9834
comma
l_int|8195
)brace
suffix:semicolon
multiline_comment|/* search a frequency that fits into the allowed error range */
id|idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|freq
)paren
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* if we will tolerate 3% error 8000Hz-&gt;8195Hz (2.38%) would&n;&t;&t; * be playable without expanding, but that now a kernel runtime&n;&t;&t; * option&n;&t;&t; */
r_if
c_cond
(paren
(paren
l_int|100
op_star
id|abs
c_func
(paren
id|dmasound.soft.speed
op_minus
id|freq
(braket
id|i
)braket
)paren
op_div
id|freq
(braket
id|i
)braket
)paren
OL
id|catchRadius
)paren
id|idx
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|idx
OG
op_minus
l_int|1
)paren
(brace
id|dmasound.soft.speed
op_assign
id|freq
(braket
id|idx
)braket
suffix:semicolon
id|dmasound.trans_write
op_assign
op_amp
id|transFalconNormal
suffix:semicolon
)brace
r_else
id|dmasound.trans_write
op_assign
op_amp
id|transFalconExpanding
suffix:semicolon
id|FalconSilence
c_func
(paren
)paren
suffix:semicolon
id|dmasound.hard
op_assign
id|dmasound.soft
suffix:semicolon
r_if
c_cond
(paren
id|dmasound.hard.size
op_eq
l_int|16
)paren
(brace
multiline_comment|/* the Falcon can play 16bit samples only in stereo */
id|dmasound.hard.stereo
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|49170
)paren
(brace
multiline_comment|/* we would need to squeeze the sound, but we won&squot;t do that */
id|dmasound.hard.speed
op_assign
l_int|49170
suffix:semicolon
id|divider
op_assign
l_int|1
suffix:semicolon
id|dmasound.trans_write
op_assign
op_amp
id|transFalconNormal
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|32780
)paren
(brace
id|dmasound.hard.speed
op_assign
l_int|49170
suffix:semicolon
id|divider
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|24585
)paren
(brace
id|dmasound.hard.speed
op_assign
l_int|32780
suffix:semicolon
id|divider
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|19668
)paren
(brace
id|dmasound.hard.speed
op_assign
l_int|24585
suffix:semicolon
id|divider
op_assign
l_int|3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|16390
)paren
(brace
id|dmasound.hard.speed
op_assign
l_int|19668
suffix:semicolon
id|divider
op_assign
l_int|4
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|12292
)paren
(brace
id|dmasound.hard.speed
op_assign
l_int|16390
suffix:semicolon
id|divider
op_assign
l_int|5
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|9834
)paren
(brace
id|dmasound.hard.speed
op_assign
l_int|12292
suffix:semicolon
id|divider
op_assign
l_int|7
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dmasound.hard.speed
OG
l_int|8195
)paren
(brace
id|dmasound.hard.speed
op_assign
l_int|9834
suffix:semicolon
id|divider
op_assign
l_int|9
suffix:semicolon
)brace
r_else
(brace
id|dmasound.hard.speed
op_assign
l_int|8195
suffix:semicolon
id|divider
op_assign
l_int|11
suffix:semicolon
)brace
id|tt_dmasnd.int_div
op_assign
id|divider
suffix:semicolon
multiline_comment|/* Setup Falcon sound DMA for playback */
id|tt_dmasnd.int_ctrl
op_assign
l_int|0x4
suffix:semicolon
multiline_comment|/* Timer A int at play end */
id|tt_dmasnd.track_select
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* play 1 track, track 1 */
id|tt_dmasnd.cbar_src
op_assign
l_int|0x0001
suffix:semicolon
multiline_comment|/* DMA(25MHz) --&gt; DAC */
id|tt_dmasnd.cbar_dst
op_assign
l_int|0x0000
suffix:semicolon
id|tt_dmasnd.rec_track_select
op_assign
l_int|0
suffix:semicolon
id|tt_dmasnd.dac_src
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* connect matrix to DAC */
id|tt_dmasnd.adc_src
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ADC Input = Mic */
id|tt_dmasnd.mode
op_assign
(paren
id|dmasound.hard.stereo
ques
c_cond
id|DMASND_MODE_STEREO
suffix:colon
id|DMASND_MODE_MONO
)paren
op_or
(paren
(paren
id|dmasound.hard.size
op_eq
l_int|8
)paren
ques
c_cond
id|DMASND_MODE_8BIT
suffix:colon
id|DMASND_MODE_16BIT
)paren
op_or
id|DMASND_MODE_6KHZ
suffix:semicolon
id|expand_bal
op_assign
op_minus
id|dmasound.soft.speed
suffix:semicolon
)brace
DECL|function|FalconSetFormat
r_static
r_int
id|FalconSetFormat
c_func
(paren
r_int
id|format
)paren
(brace
r_int
id|size
suffix:semicolon
multiline_comment|/* Falcon sound DMA supports 8bit and 16bit modes */
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|AFMT_QUERY
suffix:colon
r_return
id|dmasound.soft.format
suffix:semicolon
r_case
id|AFMT_MU_LAW
suffix:colon
r_case
id|AFMT_A_LAW
suffix:colon
r_case
id|AFMT_U8
suffix:colon
r_case
id|AFMT_S8
suffix:colon
id|size
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
r_case
id|AFMT_U16_BE
suffix:colon
r_case
id|AFMT_S16_LE
suffix:colon
r_case
id|AFMT_U16_LE
suffix:colon
id|size
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* :-) */
id|size
op_assign
l_int|8
suffix:semicolon
id|format
op_assign
id|AFMT_S8
suffix:semicolon
)brace
id|dmasound.soft.format
op_assign
id|format
suffix:semicolon
id|dmasound.soft.size
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|dmasound.minDev
op_eq
id|SND_DEV_DSP
)paren
(brace
id|dmasound.dsp.format
op_assign
id|format
suffix:semicolon
id|dmasound.dsp.size
op_assign
id|dmasound.soft.size
suffix:semicolon
)brace
id|FalconInit
c_func
(paren
)paren
suffix:semicolon
r_return
id|format
suffix:semicolon
)brace
multiline_comment|/* This is for the Falcon output *attenuation* in 1.5dB steps,&n; * i.e. output level from 0 to -22.5dB in -1.5dB steps.&n; */
DECL|macro|VOLUME_VOXWARE_TO_ATT
mdefine_line|#define VOLUME_VOXWARE_TO_ATT(v) &bslash;&n;&t;((v) &lt; 0 ? 15 : (v) &gt; 100 ? 0 : 15 - (v) * 3 / 20)
DECL|macro|VOLUME_ATT_TO_VOXWARE
mdefine_line|#define VOLUME_ATT_TO_VOXWARE(v) (100 - (v) * 20 / 3)
DECL|function|FalconSetVolume
r_static
r_int
id|FalconSetVolume
c_func
(paren
r_int
id|volume
)paren
(brace
id|dmasound.volume_left
op_assign
id|VOLUME_VOXWARE_TO_ATT
c_func
(paren
id|volume
op_amp
l_int|0xff
)paren
suffix:semicolon
id|dmasound.volume_right
op_assign
id|VOLUME_VOXWARE_TO_ATT
c_func
(paren
(paren
id|volume
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|tt_dmasnd.output_atten
op_assign
id|dmasound.volume_left
op_lshift
l_int|8
op_or
id|dmasound.volume_right
op_lshift
l_int|4
suffix:semicolon
r_return
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|dmasound.volume_left
)paren
op_or
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|dmasound.volume_right
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
DECL|function|AtaPlayNextFrame
r_static
r_void
id|AtaPlayNextFrame
c_func
(paren
r_int
id|index
)paren
(brace
r_char
op_star
id|start
comma
op_star
id|end
suffix:semicolon
multiline_comment|/* used by AtaPlay() if all doubts whether there really is something&n;&t; * to be played are already wiped out.&n;&t; */
id|start
op_assign
id|write_sq.buffers
(braket
id|write_sq.front
)braket
suffix:semicolon
id|end
op_assign
id|start
op_plus
(paren
(paren
id|write_sq.count
op_eq
id|index
)paren
ques
c_cond
id|write_sq.rear_size
suffix:colon
id|write_sq.block_size
)paren
suffix:semicolon
multiline_comment|/* end might not be a legal virtual address. */
id|DMASNDSetEnd
c_func
(paren
id|virt_to_phys
c_func
(paren
id|end
op_minus
l_int|1
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|DMASNDSetBase
c_func
(paren
id|virt_to_phys
c_func
(paren
id|start
)paren
)paren
suffix:semicolon
multiline_comment|/* Since only an even number of samples per frame can&n;&t;   be played, we might lose one byte here. (TO DO) */
id|write_sq.front
op_assign
(paren
id|write_sq.front
op_plus
l_int|1
)paren
op_mod
id|write_sq.max_count
suffix:semicolon
id|write_sq.active
op_increment
suffix:semicolon
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_ON
op_or
id|DMASND_CTRL_REPEAT
suffix:semicolon
)brace
DECL|function|AtaPlay
r_static
r_void
id|AtaPlay
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* ++TeSche: Note that write_sq.active is no longer just a flag but&n;&t; * holds the number of frames the DMA is currently programmed for&n;&t; * instead, may be 0, 1 (currently being played) or 2 (pre-programmed).&n;&t; *&n;&t; * Changes done to write_sq.count and write_sq.active are a bit more&n;&t; * subtle again so now I must admit I also prefer disabling the irq&n;&t; * here rather than considering all possible situations. But the point&n;&t; * is that disabling the irq doesn&squot;t have any bad influence on this&n;&t; * version of the driver as we benefit from having pre-programmed the&n;&t; * DMA wherever possible: There&squot;s no need to reload the DMA at the&n;&t; * exact time of an interrupt but only at some time while the&n;&t; * pre-programmed frame is playing!&n;&t; */
id|atari_disable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_sq.active
op_eq
l_int|2
op_logical_or
multiline_comment|/* DMA is &squot;full&squot; */
id|write_sq.count
op_le
l_int|0
)paren
(brace
multiline_comment|/* nothing to do */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|write_sq.active
op_eq
l_int|0
)paren
(brace
multiline_comment|/* looks like there&squot;s nothing &squot;in&squot; the DMA yet, so try&n;&t;&t; * to put two frames into it (at least one is available).&n;&t;&t; */
r_if
c_cond
(paren
id|write_sq.count
op_eq
l_int|1
op_logical_and
id|write_sq.rear_size
OL
id|write_sq.block_size
op_logical_and
op_logical_neg
id|write_sq.syncing
)paren
(brace
multiline_comment|/* hmmm, the only existing frame is not&n;&t;&t;&t; * yet filled and we&squot;re not syncing?&n;&t;&t;&t; */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|AtaPlayNextFrame
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_sq.count
op_eq
l_int|1
)paren
(brace
multiline_comment|/* no more frames */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|write_sq.count
op_eq
l_int|2
op_logical_and
id|write_sq.rear_size
OL
id|write_sq.block_size
op_logical_and
op_logical_neg
id|write_sq.syncing
)paren
(brace
multiline_comment|/* hmmm, there were two frames, but the second&n;&t;&t;&t; * one is not yet filled and we&squot;re not syncing?&n;&t;&t;&t; */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|AtaPlayNextFrame
c_func
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* there&squot;s already a frame being played so we may only stuff&n;&t;&t; * one new into the DMA, but even if this may be the last&n;&t;&t; * frame existing the previous one is still on write_sq.count.&n;&t;&t; */
r_if
c_cond
(paren
id|write_sq.count
op_eq
l_int|2
op_logical_and
id|write_sq.rear_size
OL
id|write_sq.block_size
op_logical_and
op_logical_neg
id|write_sq.syncing
)paren
(brace
multiline_comment|/* hmmm, the only existing frame is not&n;&t;&t;&t; * yet filled and we&squot;re not syncing?&n;&t;&t;&t; */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|AtaPlayNextFrame
c_func
(paren
l_int|2
)paren
suffix:semicolon
)brace
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
)brace
DECL|function|AtaInterrupt
r_static
r_void
id|AtaInterrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
macro_line|#if 0
multiline_comment|/* ++TeSche: if you should want to test this... */
r_static
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|write_sq.active
op_eq
l_int|2
)paren
r_if
c_cond
(paren
op_increment
id|cnt
op_eq
l_int|10
)paren
(brace
multiline_comment|/* simulate losing an interrupt */
id|cnt
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|write_sq_ignore_int
op_logical_and
id|is_falcon
)paren
(brace
multiline_comment|/* ++TeSche: Falcon only: ignore first irq because it comes&n;&t;&t; * immediately after starting a frame. after that, irqs come&n;&t;&t; * (almost) like on the TT.&n;&t;&t; */
id|write_sq_ignore_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|write_sq.active
)paren
(brace
multiline_comment|/* playing was interrupted and sq_reset() has already cleared&n;&t;&t; * the sq variables, so better don&squot;t do anything here.&n;&t;&t; */
id|WAKE_UP
c_func
(paren
id|write_sq.sync_queue
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Probably ;) one frame is finished. Well, in fact it may be that a&n;&t; * pre-programmed one is also finished because there has been a long&n;&t; * delay in interrupt delivery and we&squot;ve completely lost one, but&n;&t; * there&squot;s no way to detect such a situation. In such a case the last&n;&t; * frame will be played more than once and the situation will recover&n;&t; * as soon as the irq gets through.&n;&t; */
id|write_sq.count
op_decrement
suffix:semicolon
id|write_sq.active
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|write_sq.active
)paren
(brace
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_OFF
suffix:semicolon
id|write_sq_ignore_int
op_assign
l_int|1
suffix:semicolon
)brace
id|WAKE_UP
c_func
(paren
id|write_sq.action_queue
)paren
suffix:semicolon
multiline_comment|/* At least one block of the queue is free now&n;&t;   so wake up a writing process blocked because&n;&t;   of a full queue. */
r_if
c_cond
(paren
(paren
id|write_sq.active
op_ne
l_int|1
)paren
op_logical_or
(paren
id|write_sq.count
op_ne
l_int|1
)paren
)paren
multiline_comment|/* We must be a bit carefully here: write_sq.count indicates the&n;&t;&t; * number of buffers used and not the number of frames to be&n;&t;&t; * played. If write_sq.count==1 and write_sq.active==1 that&n;&t;&t; * means the only remaining frame was already programmed&n;&t;&t; * earlier (and is currently running) so we mustn&squot;t call&n;&t;&t; * AtaPlay() here, otherwise we&squot;ll play one frame too much.&n;&t;&t; */
id|AtaPlay
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|write_sq.active
)paren
id|WAKE_UP
c_func
(paren
id|write_sq.sync_queue
)paren
suffix:semicolon
multiline_comment|/* We are not playing after AtaPlay(), so there&n;&t;   is nothing to play any more. Wake up a process&n;&t;   waiting for audio output to drain. */
)brace
multiline_comment|/*** Mid level stuff *********************************************************/
multiline_comment|/*&n; * /dev/mixer abstraction&n; */
DECL|macro|RECLEVEL_VOXWARE_TO_GAIN
mdefine_line|#define RECLEVEL_VOXWARE_TO_GAIN(v)&t;&bslash;&n;&t;((v) &lt; 0 ? 0 : (v) &gt; 100 ? 15 : (v) * 3 / 20)
DECL|macro|RECLEVEL_GAIN_TO_VOXWARE
mdefine_line|#define RECLEVEL_GAIN_TO_VOXWARE(v)&t;(((v) * 20 + 2) / 3)
DECL|function|TTMixerInit
r_static
r_void
id|__init
id|TTMixerInit
c_func
(paren
r_void
)paren
(brace
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_VOLUME
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|dmasound.volume_left
op_assign
l_int|0
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALLEFT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|dmasound.volume_right
op_assign
l_int|0
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALRIGHT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_TREBLE
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BASS
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|FalconMixerInit
r_static
r_void
id|__init
id|FalconMixerInit
c_func
(paren
r_void
)paren
(brace
id|dmasound.volume_left
op_assign
(paren
id|tt_dmasnd.output_atten
op_amp
l_int|0xf00
)paren
op_rshift
l_int|8
suffix:semicolon
id|dmasound.volume_right
op_assign
(paren
id|tt_dmasnd.output_atten
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
suffix:semicolon
)brace
DECL|function|AtaMixerIoctl
r_static
r_int
id|AtaMixerIoctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
r_int
id|data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_SPEAKER
suffix:colon
r_if
c_cond
(paren
id|is_falcon
op_logical_or
id|MACH_IS_TT
)paren
(brace
r_int
id|porta
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sound_ym.rd_data_reg_sel
op_assign
l_int|14
suffix:semicolon
id|porta
op_assign
id|sound_ym.rd_data_reg_sel
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|porta
op_amp
l_int|0x40
ques
c_cond
l_int|0
suffix:colon
l_int|100
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_VOLUME
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|dmasound_set_volume
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_SPEAKER
suffix:colon
r_if
c_cond
(paren
id|is_falcon
op_logical_or
id|MACH_IS_TT
)paren
(brace
r_int
id|porta
suffix:semicolon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sound_ym.rd_data_reg_sel
op_assign
l_int|14
suffix:semicolon
id|porta
op_assign
(paren
id|sound_ym.rd_data_reg_sel
op_amp
op_complement
l_int|0x40
)paren
op_or
(paren
id|data
OL
l_int|50
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
suffix:semicolon
id|sound_ym.wd_data
op_assign
id|porta
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|porta
op_amp
l_int|0x40
ques
c_cond
l_int|0
suffix:colon
l_int|100
)paren
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|TTMixerIoctl
r_static
r_int
id|TTMixerIoctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
r_int
id|data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
l_int|0
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_TREBLE
op_or
id|SOUND_MASK_BASS
op_or
(paren
id|MACH_IS_TT
ques
c_cond
id|SOUND_MASK_SPEAKER
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|dmasound.volume_left
)paren
op_or
(paren
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|dmasound.volume_right
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_BASS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|dmasound.bass
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_TREBLE
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|dmasound.treble
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_OGAIN
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|GAIN_DB_TO_VOXWARE
c_func
(paren
id|dmasound.gain
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_BASS
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|dmasound_set_bass
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_TREBLE
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|dmasound_set_treble
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_OGAIN
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|dmasound_set_gain
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
)brace
r_return
id|AtaMixerIoctl
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|FalconMixerIoctl
r_static
r_int
id|FalconMixerIoctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
r_int
id|data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_MIC
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_SPEAKER
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_MIC
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|dmasound.volume_left
)paren
op_or
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|dmasound.volume_right
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_CAPS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_CAP_EXCL_INPUT
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_MIC
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|tt_dmasnd.input_gain
op_assign
id|RECLEVEL_VOXWARE_TO_GAIN
c_func
(paren
id|data
op_amp
l_int|0xff
)paren
op_lshift
l_int|4
op_or
id|RECLEVEL_VOXWARE_TO_GAIN
c_func
(paren
id|data
op_rshift
l_int|8
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* fall thru, return set value */
r_case
id|SOUND_MIXER_READ_MIC
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|RECLEVEL_GAIN_TO_VOXWARE
c_func
(paren
id|tt_dmasnd.input_gain
op_rshift
l_int|4
op_amp
l_int|0xf
)paren
op_or
id|RECLEVEL_GAIN_TO_VOXWARE
c_func
(paren
id|tt_dmasnd.input_gain
op_amp
l_int|0xf
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_return
id|AtaMixerIoctl
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|AtaWriteSqSetup
r_static
r_void
id|AtaWriteSqSetup
c_func
(paren
r_void
)paren
(brace
id|write_sq_ignore_int
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|AtaSqOpen
r_static
r_void
id|AtaSqOpen
c_func
(paren
r_void
)paren
(brace
id|write_sq_ignore_int
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|TTStateInfo
r_static
r_int
id|TTStateInfo
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_left = %ddB [-40...0]&bslash;n&quot;
comma
id|dmasound.volume_left
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_right = %ddB [-40...0]&bslash;n&quot;
comma
id|dmasound.volume_right
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.bass = %ddB [-12...+12]&bslash;n&quot;
comma
id|dmasound.bass
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.treble = %ddB [-12...+12]&bslash;n&quot;
comma
id|dmasound.treble
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|FalconStateInfo
r_static
r_int
id|FalconStateInfo
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_left = %ddB [-22.5...0]&bslash;n&quot;
comma
id|dmasound.volume_left
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_right = %ddB [-22.5...0]&bslash;n&quot;
comma
id|dmasound.volume_right
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*** Machine definitions *****************************************************/
DECL|variable|machTT
r_static
id|MACHINE
id|machTT
op_assign
(brace
id|name
suffix:colon
l_string|&quot;Atari&quot;
comma
id|name2
suffix:colon
l_string|&quot;TT&quot;
comma
id|open
suffix:colon
id|AtaOpen
comma
id|release
suffix:colon
id|AtaRelease
comma
id|dma_alloc
suffix:colon
id|AtaAlloc
comma
id|dma_free
suffix:colon
id|AtaFree
comma
id|irqinit
suffix:colon
id|AtaIrqInit
comma
macro_line|#ifdef MODULE
id|irqcleanup
suffix:colon
id|AtaIrqCleanUp
comma
macro_line|#endif /* MODULE */
id|init
suffix:colon
id|TTInit
comma
id|silence
suffix:colon
id|TTSilence
comma
id|setFormat
suffix:colon
id|TTSetFormat
comma
id|setVolume
suffix:colon
id|TTSetVolume
comma
id|setBass
suffix:colon
id|AtaSetBass
comma
id|setTreble
suffix:colon
id|AtaSetTreble
comma
id|setGain
suffix:colon
id|TTSetGain
comma
id|play
suffix:colon
id|AtaPlay
comma
id|mixer_init
suffix:colon
id|TTMixerInit
comma
id|mixer_ioctl
suffix:colon
id|TTMixerIoctl
comma
id|write_sq_setup
suffix:colon
id|AtaWriteSqSetup
comma
id|sq_open
suffix:colon
id|AtaSqOpen
comma
id|state_info
suffix:colon
id|TTStateInfo
comma
id|min_dsp_speed
suffix:colon
l_int|6258
comma
)brace
suffix:semicolon
DECL|variable|machFalcon
r_static
id|MACHINE
id|machFalcon
op_assign
(brace
id|name
suffix:colon
l_string|&quot;Atari&quot;
comma
id|name2
suffix:colon
l_string|&quot;FALCON&quot;
comma
id|dma_alloc
suffix:colon
id|AtaAlloc
comma
id|dma_free
suffix:colon
id|AtaFree
comma
id|irqinit
suffix:colon
id|AtaIrqInit
comma
macro_line|#ifdef MODULE
id|irqcleanup
suffix:colon
id|AtaIrqCleanUp
comma
macro_line|#endif /* MODULE */
id|init
suffix:colon
id|FalconInit
comma
id|silence
suffix:colon
id|FalconSilence
comma
id|setFormat
suffix:colon
id|FalconSetFormat
comma
id|setVolume
suffix:colon
id|FalconSetVolume
comma
id|setBass
suffix:colon
id|AtaSetBass
comma
id|setTreble
suffix:colon
id|AtaSetTreble
comma
id|play
suffix:colon
id|AtaPlay
comma
id|mixer_init
suffix:colon
id|FalconMixerInit
comma
id|mixer_ioctl
suffix:colon
id|FalconMixerIoctl
comma
id|write_sq_setup
suffix:colon
id|AtaWriteSqSetup
comma
id|sq_open
suffix:colon
id|AtaSqOpen
comma
id|state_info
suffix:colon
id|FalconStateInfo
comma
id|min_dsp_speed
suffix:colon
l_int|8195
comma
)brace
suffix:semicolon
multiline_comment|/*** Config &amp; Setup **********************************************************/
DECL|function|dmasound_atari_init
r_static
r_int
id|__init
id|dmasound_atari_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|MACH_IS_ATARI
op_logical_and
id|ATARIHW_PRESENT
c_func
(paren
id|PCM_8BIT
)paren
)paren
(brace
r_if
c_cond
(paren
id|ATARIHW_PRESENT
c_func
(paren
id|CODEC
)paren
)paren
(brace
id|dmasound.mach
op_assign
id|machFalcon
suffix:semicolon
id|is_falcon
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ATARIHW_PRESENT
c_func
(paren
id|MICROWIRE
)paren
)paren
(brace
id|dmasound.mach
op_assign
id|machTT
suffix:semicolon
id|is_falcon
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mfp.int_en_a
op_amp
id|mfp.int_mk_a
op_amp
l_int|0x20
)paren
op_eq
l_int|0
)paren
r_return
id|dmasound_init
c_func
(paren
)paren
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;DMA sound driver: Timer A interrupt already in use&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|dmasound_atari_cleanup
r_static
r_void
id|__exit
id|dmasound_atari_cleanup
c_func
(paren
r_void
)paren
(brace
id|dmasound_deinit
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|dmasound_atari_init
id|module_init
c_func
(paren
id|dmasound_atari_init
)paren
suffix:semicolon
DECL|variable|dmasound_atari_cleanup
id|module_exit
c_func
(paren
id|dmasound_atari_cleanup
)paren
suffix:semicolon
eof
