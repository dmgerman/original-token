multiline_comment|/*&n; *  linux/drivers/sound/dmasound/dmasound_awacs.c&n; *&n; *  PowerMac `AWACS&squot; and `Burgundy&squot; DMA Sound Driver&n; *&n; *  See linux/drivers/sound/dmasound/dmasound_core.c for copyright and credits&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#include &lt;linux/adb.h&gt;
macro_line|#include &lt;linux/nvram.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#ifdef CONFIG_ADB_CUDA
macro_line|#include &lt;linux/cuda.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_ADB_PMU
macro_line|#include &lt;linux/pmu.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dbdma.h&gt;
macro_line|#include &lt;asm/feature.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &quot;awacs_defs.h&quot;
macro_line|#include &quot;dmasound.h&quot;
multiline_comment|/*&n; * Interrupt numbers and addresses, obtained from the device tree.&n; */
DECL|variable|awacs_irq
DECL|variable|awacs_tx_irq
DECL|variable|awacs_rx_irq
r_static
r_int
id|awacs_irq
comma
id|awacs_tx_irq
comma
id|awacs_rx_irq
suffix:semicolon
DECL|variable|awacs
r_static
r_volatile
r_struct
id|awacs_regs
op_star
id|awacs
suffix:semicolon
DECL|variable|awacs_txdma
DECL|variable|awacs_rxdma
r_static
r_volatile
r_struct
id|dbdma_regs
op_star
id|awacs_txdma
comma
op_star
id|awacs_rxdma
suffix:semicolon
DECL|variable|awacs_rate_index
r_static
r_int
id|awacs_rate_index
suffix:semicolon
DECL|variable|awacs_subframe
r_static
r_int
id|awacs_subframe
suffix:semicolon
DECL|variable|awacs_spkr_vol
r_static
r_int
id|awacs_spkr_vol
suffix:semicolon
DECL|variable|awacs_node
r_static
r_struct
id|device_node
op_star
id|awacs_node
suffix:semicolon
DECL|variable|awacs_name
r_static
r_char
id|awacs_name
(braket
l_int|64
)braket
suffix:semicolon
DECL|variable|awacs_revision
r_static
r_int
id|awacs_revision
suffix:semicolon
DECL|variable|awacs_is_screamer
r_int
id|awacs_is_screamer
op_assign
l_int|0
suffix:semicolon
DECL|variable|awacs_device_id
r_int
id|awacs_device_id
op_assign
l_int|0
suffix:semicolon
DECL|variable|awacs_has_iic
r_int
id|awacs_has_iic
op_assign
l_int|0
suffix:semicolon
DECL|macro|AWACS_BURGUNDY
mdefine_line|#define AWACS_BURGUNDY&t;100&t;&t;/* fake revision # for burgundy */
multiline_comment|/*&n; * Space for the DBDMA command blocks.&n; */
DECL|variable|awacs_tx_cmd_space
r_static
r_void
op_star
id|awacs_tx_cmd_space
suffix:semicolon
DECL|variable|awacs_tx_cmds
r_static
r_volatile
r_struct
id|dbdma_cmd
op_star
id|awacs_tx_cmds
suffix:semicolon
DECL|variable|awacs_rx_cmd_space
r_static
r_void
op_star
id|awacs_rx_cmd_space
suffix:semicolon
DECL|variable|awacs_rx_cmds
r_static
r_volatile
r_struct
id|dbdma_cmd
op_star
id|awacs_rx_cmds
suffix:semicolon
multiline_comment|/*&n; * Cached values of AWACS registers (we can&squot;t read them).&n; * Except on the burgundy. XXX&n; */
DECL|variable|awacs_reg
r_int
id|awacs_reg
(braket
l_int|8
)braket
suffix:semicolon
DECL|macro|HAS_16BIT_TABLES
mdefine_line|#define HAS_16BIT_TABLES
DECL|macro|HAS_8BIT_TABLES
macro_line|#undef HAS_8BIT_TABLES
multiline_comment|/*&n; * Stuff for outputting a beep.  The values range from -327 to +327&n; * so we can multiply by an amplitude in the range 0..100 to get a&n; * signed short value to put in the output buffer.&n; */
DECL|variable|beep_wform
r_static
r_int
id|beep_wform
(braket
l_int|256
)braket
op_assign
(brace
l_int|0
comma
l_int|40
comma
l_int|79
comma
l_int|117
comma
l_int|153
comma
l_int|187
comma
l_int|218
comma
l_int|245
comma
l_int|269
comma
l_int|288
comma
l_int|304
comma
l_int|316
comma
l_int|323
comma
l_int|327
comma
l_int|327
comma
l_int|324
comma
l_int|318
comma
l_int|310
comma
l_int|299
comma
l_int|288
comma
l_int|275
comma
l_int|262
comma
l_int|249
comma
l_int|236
comma
l_int|224
comma
l_int|213
comma
l_int|204
comma
l_int|196
comma
l_int|190
comma
l_int|186
comma
l_int|183
comma
l_int|182
comma
l_int|182
comma
l_int|183
comma
l_int|186
comma
l_int|189
comma
l_int|192
comma
l_int|196
comma
l_int|200
comma
l_int|203
comma
l_int|206
comma
l_int|208
comma
l_int|209
comma
l_int|209
comma
l_int|209
comma
l_int|207
comma
l_int|204
comma
l_int|201
comma
l_int|197
comma
l_int|193
comma
l_int|188
comma
l_int|183
comma
l_int|179
comma
l_int|174
comma
l_int|170
comma
l_int|166
comma
l_int|163
comma
l_int|161
comma
l_int|160
comma
l_int|159
comma
l_int|159
comma
l_int|160
comma
l_int|161
comma
l_int|162
comma
l_int|164
comma
l_int|166
comma
l_int|168
comma
l_int|169
comma
l_int|171
comma
l_int|171
comma
l_int|171
comma
l_int|170
comma
l_int|169
comma
l_int|167
comma
l_int|163
comma
l_int|159
comma
l_int|155
comma
l_int|150
comma
l_int|144
comma
l_int|139
comma
l_int|133
comma
l_int|128
comma
l_int|122
comma
l_int|117
comma
l_int|113
comma
l_int|110
comma
l_int|107
comma
l_int|105
comma
l_int|103
comma
l_int|103
comma
l_int|103
comma
l_int|103
comma
l_int|104
comma
l_int|104
comma
l_int|105
comma
l_int|105
comma
l_int|105
comma
l_int|103
comma
l_int|101
comma
l_int|97
comma
l_int|92
comma
l_int|86
comma
l_int|78
comma
l_int|68
comma
l_int|58
comma
l_int|45
comma
l_int|32
comma
l_int|18
comma
l_int|3
comma
op_minus
l_int|11
comma
op_minus
l_int|26
comma
op_minus
l_int|41
comma
op_minus
l_int|55
comma
op_minus
l_int|68
comma
op_minus
l_int|79
comma
op_minus
l_int|88
comma
op_minus
l_int|95
comma
op_minus
l_int|100
comma
op_minus
l_int|102
comma
op_minus
l_int|102
comma
op_minus
l_int|99
comma
op_minus
l_int|93
comma
op_minus
l_int|85
comma
op_minus
l_int|75
comma
op_minus
l_int|62
comma
op_minus
l_int|48
comma
op_minus
l_int|33
comma
op_minus
l_int|16
comma
l_int|0
comma
l_int|16
comma
l_int|33
comma
l_int|48
comma
l_int|62
comma
l_int|75
comma
l_int|85
comma
l_int|93
comma
l_int|99
comma
l_int|102
comma
l_int|102
comma
l_int|100
comma
l_int|95
comma
l_int|88
comma
l_int|79
comma
l_int|68
comma
l_int|55
comma
l_int|41
comma
l_int|26
comma
l_int|11
comma
op_minus
l_int|3
comma
op_minus
l_int|18
comma
op_minus
l_int|32
comma
op_minus
l_int|45
comma
op_minus
l_int|58
comma
op_minus
l_int|68
comma
op_minus
l_int|78
comma
op_minus
l_int|86
comma
op_minus
l_int|92
comma
op_minus
l_int|97
comma
op_minus
l_int|101
comma
op_minus
l_int|103
comma
op_minus
l_int|105
comma
op_minus
l_int|105
comma
op_minus
l_int|105
comma
op_minus
l_int|104
comma
op_minus
l_int|104
comma
op_minus
l_int|103
comma
op_minus
l_int|103
comma
op_minus
l_int|103
comma
op_minus
l_int|103
comma
op_minus
l_int|105
comma
op_minus
l_int|107
comma
op_minus
l_int|110
comma
op_minus
l_int|113
comma
op_minus
l_int|117
comma
op_minus
l_int|122
comma
op_minus
l_int|128
comma
op_minus
l_int|133
comma
op_minus
l_int|139
comma
op_minus
l_int|144
comma
op_minus
l_int|150
comma
op_minus
l_int|155
comma
op_minus
l_int|159
comma
op_minus
l_int|163
comma
op_minus
l_int|167
comma
op_minus
l_int|169
comma
op_minus
l_int|170
comma
op_minus
l_int|171
comma
op_minus
l_int|171
comma
op_minus
l_int|171
comma
op_minus
l_int|169
comma
op_minus
l_int|168
comma
op_minus
l_int|166
comma
op_minus
l_int|164
comma
op_minus
l_int|162
comma
op_minus
l_int|161
comma
op_minus
l_int|160
comma
op_minus
l_int|159
comma
op_minus
l_int|159
comma
op_minus
l_int|160
comma
op_minus
l_int|161
comma
op_minus
l_int|163
comma
op_minus
l_int|166
comma
op_minus
l_int|170
comma
op_minus
l_int|174
comma
op_minus
l_int|179
comma
op_minus
l_int|183
comma
op_minus
l_int|188
comma
op_minus
l_int|193
comma
op_minus
l_int|197
comma
op_minus
l_int|201
comma
op_minus
l_int|204
comma
op_minus
l_int|207
comma
op_minus
l_int|209
comma
op_minus
l_int|209
comma
op_minus
l_int|209
comma
op_minus
l_int|208
comma
op_minus
l_int|206
comma
op_minus
l_int|203
comma
op_minus
l_int|200
comma
op_minus
l_int|196
comma
op_minus
l_int|192
comma
op_minus
l_int|189
comma
op_minus
l_int|186
comma
op_minus
l_int|183
comma
op_minus
l_int|182
comma
op_minus
l_int|182
comma
op_minus
l_int|183
comma
op_minus
l_int|186
comma
op_minus
l_int|190
comma
op_minus
l_int|196
comma
op_minus
l_int|204
comma
op_minus
l_int|213
comma
op_minus
l_int|224
comma
op_minus
l_int|236
comma
op_minus
l_int|249
comma
op_minus
l_int|262
comma
op_minus
l_int|275
comma
op_minus
l_int|288
comma
op_minus
l_int|299
comma
op_minus
l_int|310
comma
op_minus
l_int|318
comma
op_minus
l_int|324
comma
op_minus
l_int|327
comma
op_minus
l_int|327
comma
op_minus
l_int|323
comma
op_minus
l_int|316
comma
op_minus
l_int|304
comma
op_minus
l_int|288
comma
op_minus
l_int|269
comma
op_minus
l_int|245
comma
op_minus
l_int|218
comma
op_minus
l_int|187
comma
op_minus
l_int|153
comma
op_minus
l_int|117
comma
op_minus
l_int|79
comma
op_minus
l_int|40
comma
)brace
suffix:semicolon
DECL|macro|BEEP_SRATE
mdefine_line|#define BEEP_SRATE&t;22050&t;/* 22050 Hz sample rate */
DECL|macro|BEEP_BUFLEN
mdefine_line|#define BEEP_BUFLEN&t;512
DECL|macro|BEEP_VOLUME
mdefine_line|#define BEEP_VOLUME&t;15&t;/* 0 - 100 */
DECL|variable|beep_volume
r_static
r_int
id|beep_volume
op_assign
id|BEEP_VOLUME
suffix:semicolon
DECL|variable|beep_playing
r_static
r_int
id|beep_playing
op_assign
l_int|0
suffix:semicolon
DECL|variable|awacs_beep_state
r_static
r_int
id|awacs_beep_state
op_assign
l_int|0
suffix:semicolon
DECL|variable|beep_buf
r_static
r_int
op_star
id|beep_buf
suffix:semicolon
DECL|variable|beep_dbdma_cmd
r_static
r_volatile
r_struct
id|dbdma_cmd
op_star
id|beep_dbdma_cmd
suffix:semicolon
DECL|variable|orig_mksound
r_static
r_void
(paren
op_star
id|orig_mksound
)paren
(paren
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
DECL|variable|is_pbook_3400
r_static
r_int
id|is_pbook_3400
suffix:semicolon
DECL|variable|latch_base
r_static
r_int
r_char
op_star
id|latch_base
suffix:semicolon
DECL|variable|is_pbook_G3
r_static
r_int
id|is_pbook_G3
suffix:semicolon
DECL|variable|macio_base
r_static
r_int
r_char
op_star
id|macio_base
suffix:semicolon
multiline_comment|/* Burgundy functions */
r_static
r_void
id|awacs_burgundy_wcw
c_func
(paren
r_int
id|addr
comma
r_int
id|newval
)paren
suffix:semicolon
r_static
r_int
id|awacs_burgundy_rcw
c_func
(paren
r_int
id|addr
)paren
suffix:semicolon
r_static
r_void
id|awacs_burgundy_write_volume
c_func
(paren
r_int
id|address
comma
r_int
id|volume
)paren
suffix:semicolon
r_static
r_int
id|awacs_burgundy_read_volume
c_func
(paren
r_int
id|address
)paren
suffix:semicolon
r_static
r_void
id|awacs_burgundy_write_mvolume
c_func
(paren
r_int
id|address
comma
r_int
id|volume
)paren
suffix:semicolon
r_static
r_int
id|awacs_burgundy_read_mvolume
c_func
(paren
r_int
id|address
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
multiline_comment|/*&n; * Stuff for restoring after a sleep.&n; */
r_static
r_int
id|awacs_sleep_notify
c_func
(paren
r_struct
id|pmu_sleep_notifier
op_star
id|self
comma
r_int
id|when
)paren
suffix:semicolon
DECL|variable|awacs_sleep_notifier
r_struct
id|pmu_sleep_notifier
id|awacs_sleep_notifier
op_assign
(brace
id|awacs_sleep_notify
comma
id|SLEEP_LEVEL_SOUND
comma
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_PBOOK */
DECL|variable|expand_bal
r_static
r_int
id|expand_bal
suffix:semicolon
multiline_comment|/* Balance factor for expanding (not volume!) */
DECL|variable|expand_data
r_static
r_int
id|expand_data
suffix:semicolon
multiline_comment|/* Data for expanding */
multiline_comment|/*** Translations ************************************************************/
multiline_comment|/* ++TeSche: radically changed for new expanding purposes...&n; *&n; * These two routines now deal with copying/expanding/translating the samples&n; * from user space into our buffer at the right frequency. They take care about&n; * how much data there&squot;s actually to read, how much buffer space there is and&n; * to convert samples into the right frequency/encoding. They will only work on&n; * complete samples so it may happen they leave some bytes in the input stream&n; * if the user didn&squot;t write a multiple of the current sample size. They both&n; * return the number of bytes they&squot;ve used from both streams so you may detect&n; * such a situation. Luckily all programs should be able to cope with that.&n; *&n; * I think I&squot;ve optimized anything as far as one can do in plain C, all&n; * variables should fit in registers and the loops are really short. There&squot;s&n; * one loop for every possible situation. Writing a more generalized and thus&n; * parameterized loop would only produce slower code. Feel free to optimize&n; * this in assembler if you like. :)&n; *&n; * I think these routines belong here because they&squot;re not yet really hardware&n; * independent, especially the fact that the Falcon can play 16bit samples&n; * only in stereo is hardcoded in both of them!&n; *&n; * ++geert: split in even more functions (one per format)&n; */
r_static
id|ssize_t
id|pmac_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ct_s16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ct_u16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ctx_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ctx_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ctx_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ctx_s16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ctx_u16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ct_s16_read
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ct_u16_read
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
multiline_comment|/*** Low level stuff *********************************************************/
r_static
r_void
id|PMacOpen
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|PMacRelease
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
op_star
id|PMacAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
suffix:semicolon
r_static
r_void
id|PMacFree
c_func
(paren
r_void
op_star
id|ptr
comma
r_int
r_int
id|size
)paren
suffix:semicolon
r_static
r_int
id|PMacIrqInit
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef MODULE
r_static
r_void
id|PMacIrqCleanup
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|PMacSilence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|PMacInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|PMacSetFormat
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|PMacSetVolume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
r_static
r_void
id|PMacPlay
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|PMacRecord
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|pmac_awacs_tx_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|pmac_awacs_rx_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|pmac_awacs_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|awacs_write
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
id|awacs_get_volume
c_func
(paren
r_int
id|reg
comma
r_int
id|lshift
)paren
suffix:semicolon
r_static
r_int
id|awacs_volume_setter
c_func
(paren
r_int
id|volume
comma
r_int
id|n
comma
r_int
id|mute
comma
r_int
id|lshift
)paren
suffix:semicolon
r_static
r_void
id|awacs_mksound
c_func
(paren
r_int
r_int
id|hz
comma
r_int
r_int
id|ticks
)paren
suffix:semicolon
r_static
r_void
id|awacs_nosound
c_func
(paren
r_int
r_int
id|xx
)paren
suffix:semicolon
multiline_comment|/*** Mid level stuff **********************************************************/
r_static
r_int
id|PMacMixerIoctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
suffix:semicolon
r_static
r_void
id|PMacWriteSqSetup
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|PMacReadSqSetup
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|PMacAbortRead
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*** Translations ************************************************************/
DECL|function|pmac_ct_law
r_static
id|ssize_t
id|pmac_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
op_star
id|table
op_assign
id|dmasound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|dmasound_ulaw2dma16
suffix:colon
id|dmasound_alaw2dma16
suffix:semicolon
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
op_star
id|p
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
id|val
comma
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|table
(braket
id|data
)braket
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|table
(braket
id|data
)braket
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|2
suffix:colon
id|used
suffix:semicolon
)brace
DECL|function|pmac_ct_s8
r_static
id|ssize_t
id|pmac_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
op_star
id|p
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
id|val
comma
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|data
op_lshift
l_int|8
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|data
op_lshift
l_int|8
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|2
suffix:colon
id|used
suffix:semicolon
)brace
DECL|function|pmac_ct_u8
r_static
id|ssize_t
id|pmac_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
op_star
id|p
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
id|val
comma
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
(paren
id|data
op_xor
l_int|0x80
)paren
op_lshift
l_int|8
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
(paren
id|data
op_xor
l_int|0x80
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|2
suffix:colon
id|used
suffix:semicolon
)brace
DECL|function|pmac_ct_s16
r_static
id|ssize_t
id|pmac_ct_s16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
r_int
op_star
id|fp
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
id|userCount
op_rshift_assign
(paren
id|stereo
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|stereo
)paren
(brace
r_int
op_star
id|up
op_assign
(paren
r_int
op_star
)paren
id|userPtr
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_int
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|fp
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|fp
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|fp
comma
id|userPtr
comma
id|count
op_star
l_int|4
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|4
suffix:colon
id|used
op_star
l_int|2
suffix:semicolon
)brace
DECL|function|pmac_ct_u16
r_static
id|ssize_t
id|pmac_ct_u16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|dmasound.soft.format
op_eq
id|AFMT_U16_LE
ques
c_cond
l_int|0x0080
suffix:colon
l_int|0x8000
)paren
suffix:semicolon
r_int
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
r_int
op_star
id|fp
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
op_star
id|up
op_assign
(paren
r_int
op_star
)paren
id|userPtr
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
id|userCount
op_rshift_assign
(paren
id|stereo
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_int
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
id|mask
suffix:semicolon
op_star
id|fp
op_increment
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
id|mask
suffix:semicolon
)brace
op_star
id|fp
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|4
suffix:colon
id|used
op_star
l_int|2
suffix:semicolon
)brace
DECL|function|pmac_ctx_law
r_static
id|ssize_t
id|pmac_ctx_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
r_int
op_star
id|table
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|dmasound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|dmasound_ulaw2dma16
suffix:colon
id|dmasound_alaw2dma16
)paren
suffix:semicolon
r_int
r_int
id|data
op_assign
id|expand_data
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
r_int
id|utotal
comma
id|ftotal
suffix:semicolon
r_int
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|ftotal
op_assign
id|frameLeft
suffix:semicolon
id|utotal
op_assign
id|userCount
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
id|u_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|table
(braket
id|c
)braket
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|table
(braket
id|c
)braket
suffix:semicolon
)brace
r_else
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|expand_data
op_assign
id|data
suffix:semicolon
op_star
id|frameUsed
op_add_assign
(paren
id|ftotal
op_minus
id|frameLeft
)paren
op_star
l_int|4
suffix:semicolon
id|utotal
op_sub_assign
id|userCount
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|utotal
op_star
l_int|2
suffix:colon
id|utotal
suffix:semicolon
)brace
DECL|function|pmac_ctx_s8
r_static
id|ssize_t
id|pmac_ctx_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
r_int
id|data
op_assign
id|expand_data
suffix:semicolon
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
r_int
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
r_int
id|utotal
comma
id|ftotal
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|ftotal
op_assign
id|frameLeft
suffix:semicolon
id|utotal
op_assign
id|userCount
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
id|u_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|c
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
(paren
id|c
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|expand_data
op_assign
id|data
suffix:semicolon
op_star
id|frameUsed
op_add_assign
(paren
id|ftotal
op_minus
id|frameLeft
)paren
op_star
l_int|4
suffix:semicolon
id|utotal
op_sub_assign
id|userCount
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|utotal
op_star
l_int|2
suffix:colon
id|utotal
suffix:semicolon
)brace
DECL|function|pmac_ctx_u8
r_static
id|ssize_t
id|pmac_ctx_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
r_int
id|data
op_assign
id|expand_data
suffix:semicolon
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
r_int
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
r_int
id|utotal
comma
id|ftotal
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|ftotal
op_assign
id|frameLeft
suffix:semicolon
id|utotal
op_assign
id|userCount
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
id|u_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|c
op_xor
l_int|0x80
)paren
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
(paren
(paren
id|c
op_xor
l_int|0x80
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|expand_data
op_assign
id|data
suffix:semicolon
op_star
id|frameUsed
op_add_assign
(paren
id|ftotal
op_minus
id|frameLeft
)paren
op_star
l_int|4
suffix:semicolon
id|utotal
op_sub_assign
id|userCount
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|utotal
op_star
l_int|2
suffix:colon
id|utotal
suffix:semicolon
)brace
DECL|function|pmac_ctx_s16
r_static
id|ssize_t
id|pmac_ctx_s16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
r_int
id|data
op_assign
id|expand_data
suffix:semicolon
r_int
r_int
op_star
id|up
op_assign
(paren
r_int
r_int
op_star
)paren
id|userPtr
suffix:semicolon
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
r_int
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
r_int
id|utotal
comma
id|ftotal
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
id|userCount
op_rshift_assign
(paren
id|stereo
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|ftotal
op_assign
id|frameLeft
suffix:semicolon
id|utotal
op_assign
id|userCount
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_int
r_int
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|c
suffix:semicolon
)brace
r_else
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|expand_data
op_assign
id|data
suffix:semicolon
op_star
id|frameUsed
op_add_assign
(paren
id|ftotal
op_minus
id|frameLeft
)paren
op_star
l_int|4
suffix:semicolon
id|utotal
op_sub_assign
id|userCount
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|utotal
op_star
l_int|4
suffix:colon
id|utotal
op_star
l_int|2
suffix:semicolon
)brace
DECL|function|pmac_ctx_u16
r_static
id|ssize_t
id|pmac_ctx_u16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
id|mask
op_assign
(paren
id|dmasound.soft.format
op_eq
id|AFMT_U16_LE
ques
c_cond
l_int|0x0080
suffix:colon
l_int|0x8000
)paren
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
r_int
id|data
op_assign
id|expand_data
suffix:semicolon
r_int
r_int
op_star
id|up
op_assign
(paren
r_int
r_int
op_star
)paren
id|userPtr
suffix:semicolon
r_int
id|bal
op_assign
id|expand_bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|dmasound.hard.speed
comma
id|sSpeed
op_assign
id|dmasound.soft.speed
suffix:semicolon
r_int
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
r_int
id|utotal
comma
id|ftotal
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
id|userCount
op_rshift_assign
(paren
id|stereo
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|ftotal
op_assign
id|frameLeft
suffix:semicolon
id|utotal
op_assign
id|userCount
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_int
r_int
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
(paren
id|c
op_xor
id|mask
)paren
suffix:semicolon
)brace
r_else
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|expand_bal
op_assign
id|bal
suffix:semicolon
id|expand_data
op_assign
id|data
suffix:semicolon
op_star
id|frameUsed
op_add_assign
(paren
id|ftotal
op_minus
id|frameLeft
)paren
op_star
l_int|4
suffix:semicolon
id|utotal
op_sub_assign
id|userCount
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|utotal
op_star
l_int|4
suffix:colon
id|utotal
op_star
l_int|2
suffix:semicolon
)brace
DECL|function|pmac_ct_s8_read
r_static
id|ssize_t
id|pmac_ct_s8_read
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
op_star
id|p
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
id|val
comma
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
id|val
op_assign
op_star
id|p
op_increment
suffix:semicolon
id|data
op_assign
id|val
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
(paren
id|u_char
op_star
)paren
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
id|val
op_assign
op_star
id|p
suffix:semicolon
id|data
op_assign
id|val
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
(paren
id|u_char
op_star
)paren
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|p
op_increment
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|2
suffix:colon
id|used
suffix:semicolon
)brace
DECL|function|pmac_ct_u8_read
r_static
id|ssize_t
id|pmac_ct_u8_read
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
op_star
id|p
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
id|val
comma
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
id|val
op_assign
op_star
id|p
op_increment
suffix:semicolon
id|data
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_xor
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
(paren
id|u_char
op_star
)paren
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
id|val
op_assign
op_star
id|p
suffix:semicolon
id|data
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_xor
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
(paren
id|u_char
op_star
)paren
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|p
op_increment
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|2
suffix:colon
id|used
suffix:semicolon
)brace
DECL|function|pmac_ct_s16_read
r_static
id|ssize_t
id|pmac_ct_s16_read
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
r_int
op_star
id|fp
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
id|userCount
op_rshift_assign
(paren
id|stereo
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|stereo
)paren
(brace
r_int
op_star
id|up
op_assign
(paren
r_int
op_star
)paren
id|userPtr
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_int
id|data
suffix:semicolon
id|data
op_assign
op_star
id|fp
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|fp
op_add_assign
l_int|2
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
id|u_char
op_star
)paren
id|userPtr
comma
id|fp
comma
id|count
op_star
l_int|4
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|4
suffix:colon
id|used
op_star
l_int|2
suffix:semicolon
)brace
DECL|function|pmac_ct_u16_read
r_static
id|ssize_t
id|pmac_ct_u16_read
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|dmasound.soft.format
op_eq
id|AFMT_U16_LE
ques
c_cond
l_int|0x0080
suffix:colon
l_int|0x8000
)paren
suffix:semicolon
r_int
id|stereo
op_assign
id|dmasound.soft.stereo
suffix:semicolon
r_int
op_star
id|fp
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
op_star
id|up
op_assign
(paren
r_int
op_star
)paren
id|userPtr
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
id|userCount
op_rshift_assign
(paren
id|stereo
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_int
id|data
suffix:semicolon
id|data
op_assign
op_star
id|fp
op_increment
suffix:semicolon
id|data
op_xor_assign
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
id|data
op_assign
op_star
id|fp
suffix:semicolon
id|data
op_xor_assign
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|fp
op_increment
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|4
suffix:colon
id|used
op_star
l_int|2
suffix:semicolon
)brace
DECL|variable|transAwacsNormal
r_static
id|TRANS
id|transAwacsNormal
op_assign
(brace
id|ct_ulaw
suffix:colon
id|pmac_ct_law
comma
id|ct_alaw
suffix:colon
id|pmac_ct_law
comma
id|ct_s8
suffix:colon
id|pmac_ct_s8
comma
id|ct_u8
suffix:colon
id|pmac_ct_u8
comma
id|ct_s16be
suffix:colon
id|pmac_ct_s16
comma
id|ct_u16be
suffix:colon
id|pmac_ct_u16
comma
id|ct_s16le
suffix:colon
id|pmac_ct_s16
comma
id|ct_u16le
suffix:colon
id|pmac_ct_u16
comma
)brace
suffix:semicolon
DECL|variable|transAwacsExpand
r_static
id|TRANS
id|transAwacsExpand
op_assign
(brace
id|ct_ulaw
suffix:colon
id|pmac_ctx_law
comma
id|ct_alaw
suffix:colon
id|pmac_ctx_law
comma
id|ct_s8
suffix:colon
id|pmac_ctx_s8
comma
id|ct_u8
suffix:colon
id|pmac_ctx_u8
comma
id|ct_s16be
suffix:colon
id|pmac_ctx_s16
comma
id|ct_u16be
suffix:colon
id|pmac_ctx_u16
comma
id|ct_s16le
suffix:colon
id|pmac_ctx_s16
comma
id|ct_u16le
suffix:colon
id|pmac_ctx_u16
comma
)brace
suffix:semicolon
DECL|variable|transAwacsNormalRead
r_static
id|TRANS
id|transAwacsNormalRead
op_assign
(brace
id|ct_s8
suffix:colon
id|pmac_ct_s8_read
comma
id|ct_u8
suffix:colon
id|pmac_ct_u8_read
comma
id|ct_s16be
suffix:colon
id|pmac_ct_s16_read
comma
id|ct_u16be
suffix:colon
id|pmac_ct_u16_read
comma
id|ct_s16le
suffix:colon
id|pmac_ct_s16_read
comma
id|ct_u16le
suffix:colon
id|pmac_ct_u16_read
comma
)brace
suffix:semicolon
multiline_comment|/*** Low level stuff *********************************************************/
multiline_comment|/*&n; * PCI PowerMac, with AWACS and DBDMA.&n; */
DECL|function|PMacOpen
r_static
r_void
id|PMacOpen
c_func
(paren
r_void
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
)brace
DECL|function|PMacRelease
r_static
r_void
id|PMacRelease
c_func
(paren
r_void
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|PMacAlloc
r_static
r_void
op_star
id|PMacAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_return
id|kmalloc
c_func
(paren
id|size
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|PMacFree
r_static
r_void
id|PMacFree
c_func
(paren
r_void
op_star
id|ptr
comma
r_int
r_int
id|size
)paren
(brace
id|kfree
c_func
(paren
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|PMacIrqInit
r_static
r_int
id|__init
id|PMacIrqInit
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|awacs_irq
comma
id|pmac_awacs_intr
comma
l_int|0
comma
l_string|&quot;AWACS&quot;
comma
l_int|0
)paren
op_logical_or
id|request_irq
c_func
(paren
id|awacs_tx_irq
comma
id|pmac_awacs_tx_intr
comma
l_int|0
comma
l_string|&quot;AWACS out&quot;
comma
l_int|0
)paren
op_logical_or
id|request_irq
c_func
(paren
id|awacs_rx_irq
comma
id|pmac_awacs_rx_intr
comma
l_int|0
comma
l_string|&quot;AWACS in&quot;
comma
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|PMacIrqCleanup
r_static
r_void
id|PMacIrqCleanup
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* turn off output dma */
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
id|RUN
op_lshift
l_int|16
)paren
suffix:semicolon
multiline_comment|/* disable interrupts from awacs interface */
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;control
)paren
op_amp
l_int|0xfff
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
r_if
c_cond
(paren
id|is_pbook_G3
)paren
(brace
id|feature_clear
c_func
(paren
id|awacs_node
comma
id|FEATURE_Sound_power
)paren
suffix:semicolon
id|feature_clear
c_func
(paren
id|awacs_node
comma
id|FEATURE_Sound_CLK_enable
)paren
suffix:semicolon
)brace
macro_line|#endif
id|free_irq
c_func
(paren
id|awacs_irq
comma
l_int|0
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|awacs_tx_irq
comma
l_int|0
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|awacs_rx_irq
comma
l_int|0
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|awacs_tx_cmd_space
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awacs_rx_cmd_space
)paren
id|kfree
c_func
(paren
id|awacs_rx_cmd_space
)paren
suffix:semicolon
r_if
c_cond
(paren
id|beep_buf
)paren
id|kfree
c_func
(paren
id|beep_buf
)paren
suffix:semicolon
id|kd_mksound
op_assign
id|orig_mksound
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
id|pmu_unregister_sleep_notifier
c_func
(paren
op_amp
id|awacs_sleep_notifier
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif /* MODULE */
DECL|function|PMacSilence
r_static
r_void
id|PMacSilence
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* turn off output dma */
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
id|RUN
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
DECL|variable|awacs_freqs
r_static
r_int
id|awacs_freqs
(braket
l_int|8
)braket
op_assign
(brace
l_int|44100
comma
l_int|29400
comma
l_int|22050
comma
l_int|17640
comma
l_int|14700
comma
l_int|11025
comma
l_int|8820
comma
l_int|7350
)brace
suffix:semicolon
DECL|variable|awacs_freqs_ok
r_static
r_int
id|awacs_freqs_ok
(braket
l_int|8
)braket
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
)brace
suffix:semicolon
DECL|function|PMacInit
r_static
r_void
id|PMacInit
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|tolerance
suffix:semicolon
r_switch
c_cond
(paren
id|dmasound.soft.format
)paren
(brace
r_case
id|AFMT_S16_LE
suffix:colon
r_case
id|AFMT_U16_LE
suffix:colon
id|dmasound.hard.format
op_assign
id|AFMT_S16_LE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dmasound.hard.format
op_assign
id|AFMT_S16_BE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dmasound.hard.stereo
op_assign
l_int|1
suffix:semicolon
id|dmasound.hard.size
op_assign
l_int|16
suffix:semicolon
multiline_comment|/*&n;&t; * If we have a sample rate which is within catchRadius percent&n;&t; * of the requested value, we don&squot;t have to expand the samples.&n;&t; * Otherwise choose the next higher rate.&n;&t; * N.B.: burgundy awacs (iMac and later) only works at 44100 Hz.&n;&t; */
id|i
op_assign
l_int|8
suffix:semicolon
r_do
(brace
id|tolerance
op_assign
id|catchRadius
op_star
id|awacs_freqs
(braket
op_decrement
id|i
)braket
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|awacs_freqs_ok
(braket
id|i
)braket
op_logical_and
id|dmasound.soft.speed
op_le
id|awacs_freqs
(braket
id|i
)braket
op_plus
id|tolerance
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmasound.soft.speed
op_ge
id|awacs_freqs
(braket
id|i
)braket
op_minus
id|tolerance
)paren
id|dmasound.trans_write
op_assign
op_amp
id|transAwacsNormal
suffix:semicolon
r_else
id|dmasound.trans_write
op_assign
op_amp
id|transAwacsExpand
suffix:semicolon
id|dmasound.trans_read
op_assign
op_amp
id|transAwacsNormalRead
suffix:semicolon
id|dmasound.hard.speed
op_assign
id|awacs_freqs
(braket
id|i
)braket
suffix:semicolon
id|awacs_rate_index
op_assign
id|i
suffix:semicolon
multiline_comment|/* XXX disable error interrupt on burgundy for now */
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
id|MASK_IEPC
op_or
(paren
id|i
op_lshift
l_int|8
)paren
op_or
l_int|0x11
op_or
(paren
id|awacs_revision
OL
id|AWACS_BURGUNDY
ques
c_cond
id|MASK_IEE
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|1
)braket
op_assign
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_amp
op_complement
id|MASK_SAMPLERATE
)paren
op_or
(paren
id|i
op_lshift
l_int|3
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_or
id|MASK_ADDR1
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;byteswap
comma
id|dmasound.hard.format
op_ne
id|AFMT_S16_BE
)paren
suffix:semicolon
multiline_comment|/* We really want to execute a DMA stop command, after the AWACS&n;&t; * is initialized.&n;&t; * For reasons I don&squot;t understand, it stops the hissing noise&n;&t; * common to many PowerBook G3 systems (like mine :-).&n;&t; */
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
(paren
id|RUN
op_or
id|WAKE
op_or
id|FLUSH
op_or
id|PAUSE
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;command
comma
id|DBDMA_STOP
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;cmdptr
comma
id|virt_to_bus
c_func
(paren
id|beep_dbdma_cmd
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
id|RUN
op_or
(paren
id|RUN
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|expand_bal
op_assign
op_minus
id|dmasound.soft.speed
suffix:semicolon
)brace
DECL|function|PMacSetFormat
r_static
r_int
id|PMacSetFormat
c_func
(paren
r_int
id|format
)paren
(brace
r_int
id|size
suffix:semicolon
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|AFMT_QUERY
suffix:colon
r_return
id|dmasound.soft.format
suffix:semicolon
r_case
id|AFMT_MU_LAW
suffix:colon
r_case
id|AFMT_A_LAW
suffix:colon
r_case
id|AFMT_U8
suffix:colon
r_case
id|AFMT_S8
suffix:colon
id|size
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
r_case
id|AFMT_U16_BE
suffix:colon
r_case
id|AFMT_S16_LE
suffix:colon
r_case
id|AFMT_U16_LE
suffix:colon
id|size
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* :-) */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dmasound: unknown format 0x%x, using AFMT_U8&bslash;n&quot;
comma
id|format
)paren
suffix:semicolon
id|size
op_assign
l_int|8
suffix:semicolon
id|format
op_assign
id|AFMT_U8
suffix:semicolon
)brace
id|dmasound.soft.format
op_assign
id|format
suffix:semicolon
id|dmasound.soft.size
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|dmasound.minDev
op_eq
id|SND_DEV_DSP
)paren
(brace
id|dmasound.dsp.format
op_assign
id|format
suffix:semicolon
id|dmasound.dsp.size
op_assign
id|size
suffix:semicolon
)brace
id|PMacInit
c_func
(paren
)paren
suffix:semicolon
r_return
id|format
suffix:semicolon
)brace
DECL|macro|AWACS_VOLUME_TO_MASK
mdefine_line|#define AWACS_VOLUME_TO_MASK(x)&t;(15 - ((((x) - 1) * 15) / 99))
DECL|macro|AWACS_MASK_TO_VOLUME
mdefine_line|#define AWACS_MASK_TO_VOLUME(y)&t;(100 - ((y) * 99 / 15))
DECL|function|awacs_get_volume
r_static
r_int
id|awacs_get_volume
c_func
(paren
r_int
id|reg
comma
r_int
id|lshift
)paren
(brace
r_int
id|volume
suffix:semicolon
id|volume
op_assign
id|AWACS_MASK_TO_VOLUME
c_func
(paren
(paren
id|reg
op_rshift
id|lshift
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
id|volume
op_or_assign
id|AWACS_MASK_TO_VOLUME
c_func
(paren
id|reg
op_amp
l_int|0xf
)paren
op_lshift
l_int|8
suffix:semicolon
r_return
id|volume
suffix:semicolon
)brace
DECL|function|awacs_volume_setter
r_static
r_int
id|awacs_volume_setter
c_func
(paren
r_int
id|volume
comma
r_int
id|n
comma
r_int
id|mute
comma
r_int
id|lshift
)paren
(brace
r_int
id|r1
comma
id|rn
suffix:semicolon
r_if
c_cond
(paren
id|mute
op_logical_and
id|volume
op_eq
l_int|0
)paren
(brace
id|r1
op_assign
id|awacs_reg
(braket
l_int|1
)braket
op_or
id|mute
suffix:semicolon
)brace
r_else
(brace
id|r1
op_assign
id|awacs_reg
(braket
l_int|1
)braket
op_amp
op_complement
id|mute
suffix:semicolon
id|rn
op_assign
id|awacs_reg
(braket
id|n
)braket
op_amp
op_complement
(paren
l_int|0xf
op_or
(paren
l_int|0xf
op_lshift
id|lshift
)paren
)paren
suffix:semicolon
id|rn
op_or_assign
(paren
(paren
id|AWACS_VOLUME_TO_MASK
c_func
(paren
id|volume
op_amp
l_int|0xff
)paren
op_amp
l_int|0xf
)paren
op_lshift
id|lshift
)paren
suffix:semicolon
id|rn
op_or_assign
id|AWACS_VOLUME_TO_MASK
c_func
(paren
(paren
id|volume
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_amp
l_int|0xf
suffix:semicolon
id|awacs_reg
(braket
id|n
)braket
op_assign
id|rn
suffix:semicolon
id|awacs_write
c_func
(paren
(paren
id|n
op_lshift
l_int|12
)paren
op_or
id|rn
)paren
suffix:semicolon
id|volume
op_assign
id|awacs_get_volume
c_func
(paren
id|rn
comma
id|lshift
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r1
op_ne
id|awacs_reg
(braket
l_int|1
)braket
)paren
(brace
id|awacs_reg
(braket
l_int|1
)braket
op_assign
id|r1
suffix:semicolon
id|awacs_write
c_func
(paren
id|r1
op_or
id|MASK_ADDR1
)paren
suffix:semicolon
)brace
r_return
id|volume
suffix:semicolon
)brace
DECL|function|PMacSetVolume
r_static
r_int
id|PMacSetVolume
c_func
(paren
r_int
id|volume
)paren
(brace
r_return
id|awacs_volume_setter
c_func
(paren
id|volume
comma
l_int|2
comma
id|MASK_AMUTE
comma
l_int|6
)paren
suffix:semicolon
)brace
DECL|function|PMacPlay
r_static
r_void
id|PMacPlay
c_func
(paren
r_void
)paren
(brace
r_volatile
r_struct
id|dbdma_cmd
op_star
id|cp
suffix:semicolon
r_int
id|i
comma
id|count
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awacs_beep_state
)paren
(brace
multiline_comment|/* sound takes precedence over beeps */
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
(paren
id|RUN
op_or
id|PAUSE
op_or
id|FLUSH
op_or
id|WAKE
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;control
)paren
op_amp
op_complement
l_int|0x1f00
)paren
op_or
(paren
id|awacs_rate_index
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;byteswap
comma
id|dmasound.hard.format
op_ne
id|AFMT_S16_BE
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;cmdptr
comma
id|virt_to_bus
c_func
(paren
op_amp
(paren
id|awacs_tx_cmds
(braket
(paren
id|write_sq.front
op_plus
id|write_sq.active
)paren
op_mod
id|write_sq.max_count
)braket
)paren
)paren
)paren
suffix:semicolon
id|beep_playing
op_assign
l_int|0
suffix:semicolon
id|awacs_beep_state
op_assign
l_int|0
suffix:semicolon
)brace
id|i
op_assign
id|write_sq.front
op_plus
id|write_sq.active
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|write_sq.max_count
)paren
id|i
op_sub_assign
id|write_sq.max_count
suffix:semicolon
r_while
c_loop
(paren
id|write_sq.active
OL
l_int|2
op_logical_and
id|write_sq.active
OL
id|write_sq.count
)paren
(brace
id|count
op_assign
(paren
id|write_sq.count
op_eq
id|write_sq.active
op_plus
l_int|1
)paren
ques
c_cond
id|write_sq.rear_size
suffix:colon
id|write_sq.block_size
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|write_sq.block_size
op_logical_and
op_logical_neg
id|write_sq.syncing
)paren
multiline_comment|/* last block not yet filled, and we&squot;re not syncing. */
r_break
suffix:semicolon
id|cp
op_assign
op_amp
id|awacs_tx_cmds
(braket
id|i
)braket
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;req_count
comma
id|count
)paren
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;xfer_status
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|i
op_ge
id|write_sq.max_count
)paren
id|i
op_assign
l_int|0
suffix:semicolon
id|out_le16
c_func
(paren
op_amp
id|awacs_tx_cmds
(braket
id|i
)braket
dot
id|command
comma
id|DBDMA_STOP
)paren
suffix:semicolon
id|out_le16
c_func
(paren
op_amp
id|cp-&gt;command
comma
id|OUTPUT_MORE
op_plus
id|INTR_ALWAYS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_sq.active
op_eq
l_int|0
)paren
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;cmdptr
comma
id|virt_to_bus
c_func
(paren
id|cp
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
(paren
(paren
id|RUN
op_or
id|WAKE
)paren
op_lshift
l_int|16
)paren
op_plus
(paren
id|RUN
op_or
id|WAKE
)paren
)paren
suffix:semicolon
op_increment
id|write_sq.active
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|PMacRecord
r_static
r_void
id|PMacRecord
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|read_sq.active
)paren
r_return
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* This is all we have to do......Just start it up.&n;&t;*/
id|out_le32
c_func
(paren
op_amp
id|awacs_rxdma-&gt;control
comma
(paren
(paren
id|RUN
op_or
id|WAKE
)paren
op_lshift
l_int|16
)paren
op_plus
(paren
id|RUN
op_or
id|WAKE
)paren
)paren
suffix:semicolon
id|read_sq.active
op_assign
l_int|1
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|pmac_awacs_tx_intr
id|pmac_awacs_tx_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|i
op_assign
id|write_sq.front
suffix:semicolon
r_int
id|stat
suffix:semicolon
r_volatile
r_struct
id|dbdma_cmd
op_star
id|cp
suffix:semicolon
r_while
c_loop
(paren
id|write_sq.active
OG
l_int|0
)paren
(brace
id|cp
op_assign
op_amp
id|awacs_tx_cmds
(braket
id|i
)braket
suffix:semicolon
id|stat
op_assign
id|ld_le16
c_func
(paren
op_amp
id|cp-&gt;xfer_status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|ACTIVE
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
multiline_comment|/* this frame is still going */
op_decrement
id|write_sq.count
suffix:semicolon
op_decrement
id|write_sq.active
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|i
op_ge
id|write_sq.max_count
)paren
id|i
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ne
id|write_sq.front
)paren
id|WAKE_UP
c_func
(paren
id|write_sq.action_queue
)paren
suffix:semicolon
id|write_sq.front
op_assign
id|i
suffix:semicolon
id|PMacPlay
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|write_sq.active
)paren
id|WAKE_UP
c_func
(paren
id|write_sq.sync_queue
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|pmac_awacs_rx_intr
id|pmac_awacs_rx_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
multiline_comment|/* For some reason on my PowerBook G3, I get one interrupt&n;&t; * when the interrupt vector is installed (like something is&n;&t; * pending).  This happens before the dbdma is initialize by&n;&t; * us, so I just check the command pointer and if it is zero,&n;&t; * just blow it off.&n;&t; */
r_if
c_cond
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs_rxdma-&gt;cmdptr
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* We also want to blow &squot;em off when shutting down.&n;&t;*/
r_if
c_cond
(paren
id|read_sq.active
op_eq
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* Check multiple buffers in case we were held off from&n;&t; * interrupt processing for a long time.  Geeze, I really hope&n;&t; * this doesn&squot;t happen.&n;&t; */
r_while
c_loop
(paren
id|awacs_rx_cmds
(braket
id|read_sq.rear
)braket
dot
id|xfer_status
)paren
(brace
multiline_comment|/* Clear status and move on to next buffer.&n;&t;&t;*/
id|awacs_rx_cmds
(braket
id|read_sq.rear
)braket
dot
id|xfer_status
op_assign
l_int|0
suffix:semicolon
id|read_sq.rear
op_increment
suffix:semicolon
multiline_comment|/* Wrap the buffer ring.&n;&t;&t;*/
r_if
c_cond
(paren
id|read_sq.rear
op_ge
id|read_sq.max_active
)paren
id|read_sq.rear
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* If we have caught up to the front buffer, bump it.&n;&t;&t; * This will cause weird (but not fatal) results if the&n;&t;&t; * read loop is currently using this buffer.  The user is&n;&t;&t; * behind in this case anyway, so weird things are going&n;&t;&t; * to happen.&n;&t;&t; */
r_if
c_cond
(paren
id|read_sq.rear
op_eq
id|read_sq.front
)paren
(brace
id|read_sq.front
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|read_sq.front
op_ge
id|read_sq.max_active
)paren
id|read_sq.front
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|WAKE_UP
c_func
(paren
id|read_sq.action_queue
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|pmac_awacs_intr
id|pmac_awacs_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|ctrl
op_assign
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;control
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctrl
op_amp
id|MASK_PORTCHG
)paren
(brace
multiline_comment|/* do something when headphone is plugged/unplugged? */
)brace
r_if
c_cond
(paren
id|ctrl
op_amp
id|MASK_CNTLERR
)paren
(brace
r_int
id|err
op_assign
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_stat
)paren
op_amp
id|MASK_ERRCODE
)paren
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
op_logical_and
id|awacs_revision
OL
id|AWACS_BURGUNDY
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWACS: error %x&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/* Writing 1s to the CNTLERR and PORTCHG bits clears them... */
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
id|ctrl
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awacs_write
id|awacs_write
c_func
(paren
r_int
id|val
)paren
(brace
r_if
c_cond
(paren
id|awacs_revision
op_ge
id|AWACS_BURGUNDY
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
)paren
op_amp
id|MASK_NEWECMD
)paren
suffix:semicolon
multiline_comment|/* XXX should have timeout */
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|val
op_or
(paren
id|awacs_subframe
op_lshift
l_int|22
)paren
)paren
suffix:semicolon
)brace
DECL|function|awacs_nosound
r_static
r_void
id|awacs_nosound
c_func
(paren
r_int
r_int
id|xx
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|beep_playing
)paren
(brace
id|st_le16
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;command
comma
id|DBDMA_STOP
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
(paren
id|RUN
op_or
id|PAUSE
op_or
id|FLUSH
op_or
id|WAKE
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;control
)paren
op_amp
op_complement
l_int|0x1f00
)paren
op_or
(paren
id|awacs_rate_index
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;byteswap
comma
id|dmasound.hard.format
op_ne
id|AFMT_S16_BE
)paren
suffix:semicolon
id|beep_playing
op_assign
l_int|0
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|beep_timer
r_static
r_struct
id|timer_list
id|beep_timer
op_assign
(brace
id|function
suffix:colon
id|awacs_nosound
)brace
suffix:semicolon
DECL|function|awacs_mksound
r_static
r_void
id|awacs_mksound
c_func
(paren
r_int
r_int
id|hz
comma
r_int
r_int
id|ticks
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|beep_speed
op_assign
l_int|0
suffix:semicolon
r_int
id|srate
suffix:semicolon
r_int
id|period
comma
id|ncycles
comma
id|nsamples
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|f
suffix:semicolon
r_int
op_star
id|p
suffix:semicolon
r_static
r_int
id|beep_hz_cache
suffix:semicolon
r_static
r_int
id|beep_nsamples_cache
suffix:semicolon
r_static
r_int
id|beep_volume_cache
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
op_logical_and
id|awacs_freqs
(braket
id|i
)braket
op_ge
id|BEEP_SRATE
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|awacs_freqs_ok
(braket
id|i
)braket
)paren
id|beep_speed
op_assign
id|i
suffix:semicolon
id|srate
op_assign
id|awacs_freqs
(braket
id|beep_speed
)braket
suffix:semicolon
r_if
c_cond
(paren
id|hz
op_le
id|srate
op_div
id|BEEP_BUFLEN
op_logical_or
id|hz
OG
id|srate
op_div
l_int|2
)paren
(brace
macro_line|#if 1
multiline_comment|/* this is a hack for broken X server code */
id|hz
op_assign
l_int|750
suffix:semicolon
id|ticks
op_assign
l_int|12
suffix:semicolon
macro_line|#else
multiline_comment|/* cancel beep currently playing */
id|awacs_nosound
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
macro_line|#endif
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|beep_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ticks
)paren
(brace
id|beep_timer.expires
op_assign
id|jiffies
op_plus
id|ticks
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|beep_timer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|beep_playing
op_logical_or
id|write_sq.active
op_logical_or
id|beep_buf
op_eq
l_int|NULL
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* too hard, sorry :-( */
)brace
id|beep_playing
op_assign
l_int|1
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;command
comma
id|OUTPUT_MORE
op_plus
id|BR_ALWAYS
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hz
op_eq
id|beep_hz_cache
op_logical_and
id|beep_volume
op_eq
id|beep_volume_cache
)paren
(brace
id|nsamples
op_assign
id|beep_nsamples_cache
suffix:semicolon
)brace
r_else
(brace
id|period
op_assign
id|srate
op_star
l_int|256
op_div
id|hz
suffix:semicolon
multiline_comment|/* fixed point */
id|ncycles
op_assign
id|BEEP_BUFLEN
op_star
l_int|256
op_div
id|period
suffix:semicolon
id|nsamples
op_assign
(paren
id|period
op_star
id|ncycles
)paren
op_rshift
l_int|8
suffix:semicolon
id|f
op_assign
id|ncycles
op_star
l_int|65536
op_div
id|nsamples
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
id|p
op_assign
id|beep_buf
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nsamples
suffix:semicolon
op_increment
id|i
comma
id|p
op_add_assign
l_int|2
)paren
(brace
id|p
(braket
l_int|0
)braket
op_assign
id|p
(braket
l_int|1
)braket
op_assign
id|beep_wform
(braket
id|j
op_rshift
l_int|8
)braket
op_star
id|beep_volume
suffix:semicolon
id|j
op_assign
(paren
id|j
op_plus
id|f
)paren
op_amp
l_int|0xffff
suffix:semicolon
)brace
id|beep_hz_cache
op_assign
id|hz
suffix:semicolon
id|beep_volume_cache
op_assign
id|beep_volume
suffix:semicolon
id|beep_nsamples_cache
op_assign
id|nsamples
suffix:semicolon
)brace
id|st_le16
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;req_count
comma
id|nsamples
op_star
l_int|4
)paren
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;xfer_status
comma
l_int|0
)paren
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;cmd_dep
comma
id|virt_to_bus
c_func
(paren
id|beep_dbdma_cmd
)paren
)paren
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;phy_addr
comma
id|virt_to_bus
c_func
(paren
id|beep_buf
)paren
)paren
suffix:semicolon
id|awacs_beep_state
op_assign
l_int|1
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|beep_playing
)paren
(brace
multiline_comment|/* i.e. haven&squot;t been terminated already */
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
(paren
id|RUN
op_or
id|WAKE
op_or
id|FLUSH
op_or
id|PAUSE
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;control
)paren
op_amp
op_complement
l_int|0x1f00
)paren
op_or
(paren
id|beep_speed
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;byteswap
comma
l_int|0
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;cmdptr
comma
id|virt_to_bus
c_func
(paren
id|beep_dbdma_cmd
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
id|RUN
op_or
(paren
id|RUN
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PMAC_PBOOK
multiline_comment|/*&n; * Save state when going to sleep, restore it afterwards.&n; */
DECL|function|awacs_sleep_notify
r_static
r_int
id|awacs_sleep_notify
c_func
(paren
r_struct
id|pmu_sleep_notifier
op_star
id|self
comma
r_int
id|when
)paren
(brace
r_switch
c_cond
(paren
id|when
)paren
(brace
r_case
id|PBOOK_SLEEP_NOW
suffix:colon
multiline_comment|/* XXX we should stop any dma in progress when going to sleep&n;&t;&t;   and restart it when we wake. */
id|PMacSilence
c_func
(paren
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|awacs_irq
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|awacs_tx_irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_pbook_G3
)paren
(brace
id|feature_clear
c_func
(paren
id|awacs_node
comma
id|FEATURE_Sound_CLK_enable
)paren
suffix:semicolon
id|feature_clear
c_func
(paren
id|awacs_node
comma
id|FEATURE_Sound_power
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PBOOK_WAKE
suffix:colon
multiline_comment|/* There is still a problem on wake. Sound seems to work fine&n;&t;&t;   if I launch mpg123 and resumes fine if mpg123 was playing,&n;&t;&t;   but the console beep is dead until I do something with the&n;&t;&t;   mixer. Probably yet another timing issue */
r_if
c_cond
(paren
op_logical_neg
id|feature_test
c_func
(paren
id|awacs_node
comma
id|FEATURE_Sound_CLK_enable
)paren
op_logical_or
op_logical_neg
id|feature_test
c_func
(paren
id|awacs_node
comma
id|FEATURE_Sound_power
)paren
)paren
(brace
multiline_comment|/* these aren&squot;t present on the 3400 AFAIK -- paulus */
id|feature_set
c_func
(paren
id|awacs_node
comma
id|FEATURE_Sound_CLK_enable
)paren
suffix:semicolon
id|feature_set
c_func
(paren
id|awacs_node
comma
id|FEATURE_Sound_power
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
id|MASK_IEPC
op_or
(paren
id|awacs_rate_index
op_lshift
l_int|8
)paren
op_or
l_int|0x11
op_or
(paren
id|awacs_revision
OL
id|AWACS_BURGUNDY
ques
c_cond
id|MASK_IEE
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_or
id|MASK_ADDR0
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_or
id|MASK_ADDR1
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|2
)braket
op_or
id|MASK_ADDR2
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|4
)braket
op_or
id|MASK_ADDR4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awacs_is_screamer
)paren
(brace
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|5
)braket
op_plus
id|MASK_ADDR5
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|6
)braket
op_plus
id|MASK_ADDR6
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|7
)braket
op_plus
id|MASK_ADDR7
)paren
suffix:semicolon
)brace
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;byteswap
comma
id|dmasound.hard.format
op_ne
id|AFMT_S16_BE
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|awacs_irq
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|awacs_tx_irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awacs_revision
op_eq
l_int|3
)paren
(brace
id|mdelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
l_int|0x6000
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_or
id|MASK_ADDR1
)paren
suffix:semicolon
)brace
multiline_comment|/* enable CD sound input */
r_if
c_cond
(paren
id|macio_base
op_logical_and
id|is_pbook_G3
)paren
(brace
id|out_8
c_func
(paren
id|macio_base
op_plus
l_int|0x37
comma
l_int|3
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|is_pbook_3400
)paren
(brace
id|feature_set
c_func
(paren
id|awacs_node
comma
id|FEATURE_IOBUS_enable
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|in_8
c_func
(paren
id|latch_base
op_plus
l_int|0x190
)paren
suffix:semicolon
)brace
multiline_comment|/* Resume pending sounds. */
id|PMacPlay
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|PBOOK_SLEEP_OK
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PMAC_PBOOK */
multiline_comment|/* All the burgundy functions: */
multiline_comment|/* Waits for busy flag to clear */
r_inline
r_static
r_void
DECL|function|awacs_burgundy_busy_wait
id|awacs_burgundy_busy_wait
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
)paren
op_amp
id|MASK_NEWECMD
)paren
suffix:semicolon
)brace
r_inline
r_static
r_void
DECL|function|awacs_burgundy_extend_wait
id|awacs_burgundy_extend_wait
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_stat
)paren
op_amp
id|MASK_EXTEND
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_stat
)paren
op_amp
id|MASK_EXTEND
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awacs_burgundy_wcw
id|awacs_burgundy_wcw
c_func
(paren
r_int
id|addr
comma
r_int
id|val
)paren
(brace
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x200c00
op_plus
(paren
id|val
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|awacs_burgundy_busy_wait
c_func
(paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x200d00
op_plus
(paren
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|awacs_burgundy_busy_wait
c_func
(paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x200e00
op_plus
(paren
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|awacs_burgundy_busy_wait
c_func
(paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x200f00
op_plus
(paren
(paren
id|val
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|awacs_burgundy_busy_wait
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|awacs_burgundy_rcw
id|awacs_burgundy_rcw
c_func
(paren
r_int
id|addr
)paren
(brace
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* should have timeouts here */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x100000
)paren
suffix:semicolon
id|awacs_burgundy_busy_wait
c_func
(paren
)paren
suffix:semicolon
id|awacs_burgundy_extend_wait
c_func
(paren
)paren
suffix:semicolon
id|val
op_add_assign
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_stat
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x100100
)paren
suffix:semicolon
id|awacs_burgundy_busy_wait
c_func
(paren
)paren
suffix:semicolon
id|awacs_burgundy_extend_wait
c_func
(paren
)paren
suffix:semicolon
id|val
op_add_assign
(paren
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_stat
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x100200
)paren
suffix:semicolon
id|awacs_burgundy_busy_wait
c_func
(paren
)paren
suffix:semicolon
id|awacs_burgundy_extend_wait
c_func
(paren
)paren
suffix:semicolon
id|val
op_add_assign
(paren
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_stat
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x100300
)paren
suffix:semicolon
id|awacs_burgundy_busy_wait
c_func
(paren
)paren
suffix:semicolon
id|awacs_burgundy_extend_wait
c_func
(paren
)paren
suffix:semicolon
id|val
op_add_assign
(paren
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_stat
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|24
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
r_static
r_void
DECL|function|awacs_burgundy_wcb
id|awacs_burgundy_wcb
c_func
(paren
r_int
id|addr
comma
r_int
id|val
)paren
(brace
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x300000
op_plus
(paren
id|val
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|awacs_burgundy_busy_wait
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|awacs_burgundy_rcb
id|awacs_burgundy_rcb
c_func
(paren
r_int
id|addr
)paren
(brace
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* should have timeouts here */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x100000
)paren
suffix:semicolon
id|awacs_burgundy_busy_wait
c_func
(paren
)paren
suffix:semicolon
id|awacs_burgundy_extend_wait
c_func
(paren
)paren
suffix:semicolon
id|val
op_add_assign
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_stat
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
r_static
r_int
DECL|function|awacs_burgundy_check
id|awacs_burgundy_check
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Checks to see the chip is alive and kicking */
r_int
id|error
op_assign
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
)paren
op_amp
id|MASK_ERRCODE
suffix:semicolon
r_return
id|error
op_eq
l_int|0xf0000
suffix:semicolon
)brace
r_static
r_int
DECL|function|awacs_burgundy_init
id|awacs_burgundy_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|awacs_burgundy_check
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AWACS: disabled by MacOS :-(&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_OUTPUTENABLES
comma
id|DEF_BURGUNDY_OUTPUTENABLES
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
comma
id|DEF_BURGUNDY_MORE_OUTPUTENABLES
)paren
suffix:semicolon
id|awacs_burgundy_wcw
c_func
(paren
id|MASK_ADDR_BURGUNDY_OUTPUTSELECTS
comma
id|DEF_BURGUNDY_OUTPUTSELECTS
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_INPSEL21
comma
id|DEF_BURGUNDY_INPSEL21
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_INPSEL3
comma
id|DEF_BURGUNDY_INPSEL3
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_GAINCD
comma
id|DEF_BURGUNDY_GAINCD
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_GAINLINE
comma
id|DEF_BURGUNDY_GAINLINE
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_GAINMIC
comma
id|DEF_BURGUNDY_GAINMIC
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_GAINMODEM
comma
id|DEF_BURGUNDY_GAINMODEM
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_ATTENSPEAKER
comma
id|DEF_BURGUNDY_ATTENSPEAKER
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_ATTENLINEOUT
comma
id|DEF_BURGUNDY_ATTENLINEOUT
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_ATTENHP
comma
id|DEF_BURGUNDY_ATTENHP
)paren
suffix:semicolon
id|awacs_burgundy_wcw
c_func
(paren
id|MASK_ADDR_BURGUNDY_MASTER_VOLUME
comma
id|DEF_BURGUNDY_MASTER_VOLUME
)paren
suffix:semicolon
id|awacs_burgundy_wcw
c_func
(paren
id|MASK_ADDR_BURGUNDY_VOLCD
comma
id|DEF_BURGUNDY_VOLCD
)paren
suffix:semicolon
id|awacs_burgundy_wcw
c_func
(paren
id|MASK_ADDR_BURGUNDY_VOLLINE
comma
id|DEF_BURGUNDY_VOLLINE
)paren
suffix:semicolon
id|awacs_burgundy_wcw
c_func
(paren
id|MASK_ADDR_BURGUNDY_VOLMIC
comma
id|DEF_BURGUNDY_VOLMIC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|awacs_burgundy_write_volume
id|awacs_burgundy_write_volume
c_func
(paren
r_int
id|address
comma
r_int
id|volume
)paren
(brace
r_int
id|hardvolume
comma
id|lvolume
comma
id|rvolume
suffix:semicolon
id|lvolume
op_assign
(paren
id|volume
op_amp
l_int|0xff
)paren
ques
c_cond
(paren
id|volume
op_amp
l_int|0xff
)paren
op_plus
l_int|155
suffix:colon
l_int|0
suffix:semicolon
id|rvolume
op_assign
(paren
(paren
id|volume
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
ques
c_cond
(paren
(paren
id|volume
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_plus
l_int|155
suffix:colon
l_int|0
suffix:semicolon
id|hardvolume
op_assign
id|lvolume
op_plus
(paren
id|rvolume
op_lshift
l_int|16
)paren
suffix:semicolon
id|awacs_burgundy_wcw
c_func
(paren
id|address
comma
id|hardvolume
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|awacs_burgundy_read_volume
id|awacs_burgundy_read_volume
c_func
(paren
r_int
id|address
)paren
(brace
r_int
id|softvolume
comma
id|wvolume
suffix:semicolon
id|wvolume
op_assign
id|awacs_burgundy_rcw
c_func
(paren
id|address
)paren
suffix:semicolon
id|softvolume
op_assign
(paren
id|wvolume
op_amp
l_int|0xff
)paren
op_minus
l_int|155
suffix:semicolon
id|softvolume
op_add_assign
(paren
(paren
(paren
id|wvolume
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
op_minus
l_int|155
)paren
op_lshift
l_int|8
suffix:semicolon
r_return
id|softvolume
OG
l_int|0
ques
c_cond
id|softvolume
suffix:colon
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|awacs_burgundy_read_mvolume
id|awacs_burgundy_read_mvolume
c_func
(paren
r_int
id|address
)paren
(brace
r_int
id|lvolume
comma
id|rvolume
comma
id|wvolume
suffix:semicolon
id|wvolume
op_assign
id|awacs_burgundy_rcw
c_func
(paren
id|address
)paren
suffix:semicolon
id|wvolume
op_and_assign
l_int|0xffff
suffix:semicolon
id|rvolume
op_assign
(paren
id|wvolume
op_amp
l_int|0xff
)paren
op_minus
l_int|155
suffix:semicolon
id|lvolume
op_assign
(paren
(paren
id|wvolume
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
op_minus
l_int|155
suffix:semicolon
r_return
id|lvolume
op_plus
(paren
id|rvolume
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awacs_burgundy_write_mvolume
id|awacs_burgundy_write_mvolume
c_func
(paren
r_int
id|address
comma
r_int
id|volume
)paren
(brace
r_int
id|lvolume
comma
id|rvolume
comma
id|hardvolume
suffix:semicolon
id|lvolume
op_assign
(paren
id|volume
op_amp
l_int|0xff
)paren
ques
c_cond
(paren
id|volume
op_amp
l_int|0xff
)paren
op_plus
l_int|155
suffix:colon
l_int|0
suffix:semicolon
id|rvolume
op_assign
(paren
(paren
id|volume
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
ques
c_cond
(paren
id|volume
op_rshift
l_int|8
)paren
op_plus
l_int|155
suffix:colon
l_int|0
suffix:semicolon
id|hardvolume
op_assign
id|lvolume
op_plus
(paren
id|rvolume
op_lshift
l_int|8
)paren
suffix:semicolon
id|hardvolume
op_add_assign
(paren
id|hardvolume
op_lshift
l_int|16
)paren
suffix:semicolon
id|awacs_burgundy_wcw
c_func
(paren
id|address
comma
id|hardvolume
)paren
suffix:semicolon
)brace
multiline_comment|/* End burgundy functions */
multiline_comment|/* Turn on sound output, needed on G3 desktop powermacs */
r_static
r_void
DECL|function|awacs_enable_amp
id|awacs_enable_amp
c_func
(paren
r_int
id|spkr_vol
)paren
(brace
r_struct
id|adb_request
id|req
suffix:semicolon
id|awacs_spkr_vol
op_assign
id|spkr_vol
suffix:semicolon
r_if
c_cond
(paren
id|sys_ctrler
op_ne
id|SYS_CTRLER_CUDA
)paren
r_return
suffix:semicolon
macro_line|#ifdef CONFIG_ADB_CUDA
multiline_comment|/* turn on headphones */
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
l_int|4
comma
l_int|0
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
l_int|6
comma
l_int|0
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* turn on speaker */
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
l_int|3
comma
(paren
l_int|100
op_minus
(paren
id|spkr_vol
op_amp
l_int|0xff
)paren
)paren
op_star
l_int|32
op_div
l_int|100
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
l_int|5
comma
(paren
l_int|100
op_minus
(paren
(paren
id|spkr_vol
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
op_star
l_int|32
op_div
l_int|100
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
l_int|1
comma
l_int|0x29
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ADB_CUDA */
)brace
multiline_comment|/*** Mid level stuff *********************************************************/
multiline_comment|/*&n; * /dev/mixer abstraction&n; */
DECL|function|awacs_mixer_ioctl
r_static
r_int
id|awacs_mixer_ioctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
r_int
id|data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
id|data
op_assign
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_SPEAKER
op_or
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_CD
op_or
id|SOUND_MASK_RECLEV
op_or
id|SOUND_MASK_ALTPCM
op_or
id|SOUND_MASK_MONITOR
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
id|data
op_assign
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_CD
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECSRC
suffix:colon
id|data
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_AUDIN
)paren
id|data
op_or_assign
id|SOUND_MASK_LINE
suffix:semicolon
r_if
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_MIC
)paren
id|data
op_or_assign
id|SOUND_MASK_MIC
suffix:semicolon
r_if
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_CD
)paren
id|data
op_or_assign
id|SOUND_MASK_CD
suffix:semicolon
r_if
c_cond
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_amp
id|MASK_LOOPTHRU
)paren
id|data
op_or_assign
id|SOUND_MASK_MONITOR
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_RECSRC
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|data
op_and_assign
(paren
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_CD
op_or
id|SOUND_MASK_MONITOR
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_and_assign
op_complement
(paren
id|MASK_MUX_CD
op_or
id|MASK_MUX_MIC
op_or
id|MASK_MUX_AUDIN
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|1
)braket
op_and_assign
op_complement
id|MASK_LOOPTHRU
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SOUND_MASK_LINE
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_AUDIN
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SOUND_MASK_MIC
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_MIC
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SOUND_MASK_CD
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_CD
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SOUND_MASK_MONITOR
)paren
id|awacs_reg
(braket
l_int|1
)braket
op_or_assign
id|MASK_LOOPTHRU
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_or
id|MASK_ADDR0
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_or
id|MASK_ADDR1
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
id|data
op_assign
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_SPEAKER
op_or
id|SOUND_MASK_RECLEV
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_CAPS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
l_int|0
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_amp
id|MASK_AMUTE
)paren
ques
c_cond
l_int|0
suffix:colon
id|awacs_get_volume
c_func
(paren
id|awacs_reg
(braket
l_int|2
)braket
comma
l_int|6
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_VOLUME
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|PMacSetVolume
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_SPEAKER
suffix:colon
r_if
c_cond
(paren
id|awacs_revision
op_eq
l_int|3
op_logical_and
id|sys_ctrler
op_eq
id|SYS_CTRLER_CUDA
)paren
id|data
op_assign
id|awacs_spkr_vol
suffix:semicolon
r_else
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_amp
id|MASK_CMUTE
)paren
ques
c_cond
l_int|0
suffix:colon
id|awacs_get_volume
c_func
(paren
id|awacs_reg
(braket
l_int|4
)braket
comma
l_int|6
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_SPEAKER
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awacs_revision
op_eq
l_int|3
op_logical_and
id|sys_ctrler
op_eq
id|SYS_CTRLER_CUDA
)paren
id|awacs_enable_amp
c_func
(paren
id|data
)paren
suffix:semicolon
r_else
id|data
op_assign
id|awacs_volume_setter
c_func
(paren
id|data
comma
l_int|4
comma
id|MASK_CMUTE
comma
l_int|6
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_ALTPCM
suffix:colon
multiline_comment|/* really bell volume */
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|beep_volume
op_assign
id|data
op_amp
l_int|0xff
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_ALTPCM
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|beep_volume
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_LINE
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_and_assign
op_complement
id|MASK_MUX_AUDIN
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data
op_amp
l_int|0xff
)paren
op_ge
l_int|50
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_AUDIN
suffix:semicolon
id|awacs_write
c_func
(paren
id|MASK_ADDR0
op_or
id|awacs_reg
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_LINE
suffix:colon
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_AUDIN
)paren
ques
c_cond
l_int|100
suffix:colon
l_int|0
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_MIC
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|data
op_and_assign
l_int|0xff
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_and_assign
op_complement
(paren
id|MASK_MUX_MIC
op_or
id|MASK_GAINLINE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_ge
l_int|25
)paren
(brace
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_MIC
suffix:semicolon
r_if
c_cond
(paren
id|data
op_ge
l_int|75
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_GAINLINE
suffix:semicolon
)brace
id|awacs_write
c_func
(paren
id|MASK_ADDR0
op_or
id|awacs_reg
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_MIC
suffix:colon
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_MIC
)paren
ques
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_GAINLINE
ques
c_cond
l_int|100
suffix:colon
l_int|50
)paren
suffix:colon
l_int|0
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_CD
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_and_assign
op_complement
id|MASK_MUX_CD
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data
op_amp
l_int|0xff
)paren
op_ge
l_int|50
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_CD
suffix:semicolon
id|awacs_write
c_func
(paren
id|MASK_ADDR0
op_or
id|awacs_reg
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_CD
suffix:colon
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_CD
)paren
ques
c_cond
l_int|100
suffix:colon
l_int|0
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_RECLEV
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|data
op_assign
id|awacs_volume_setter
c_func
(paren
id|data
comma
l_int|0
comma
l_int|0
comma
l_int|4
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECLEV
suffix:colon
id|data
op_assign
id|awacs_get_volume
c_func
(paren
id|awacs_reg
(braket
l_int|0
)braket
comma
l_int|4
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|MIXER_WRITE
c_func
(paren
id|SOUND_MIXER_MONITOR
)paren
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|1
)braket
op_and_assign
op_complement
id|MASK_LOOPTHRU
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data
op_amp
l_int|0xff
)paren
op_ge
l_int|50
)paren
id|awacs_reg
(braket
l_int|1
)braket
op_or_assign
id|MASK_LOOPTHRU
suffix:semicolon
id|awacs_write
c_func
(paren
id|MASK_ADDR1
op_or
id|awacs_reg
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|MIXER_READ
c_func
(paren
id|SOUND_MIXER_MONITOR
)paren
suffix:colon
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_amp
id|MASK_LOOPTHRU
)paren
ques
c_cond
l_int|100
suffix:colon
l_int|0
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|burgundy_mixer_ioctl
r_static
r_int
id|burgundy_mixer_ioctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
r_int
id|data
suffix:semicolon
multiline_comment|/* We are, we are, we are... Burgundy or better */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
id|data
op_assign
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_CD
op_or
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_SPEAKER
op_or
id|SOUND_MASK_ALTPCM
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
id|data
op_assign
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_CD
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECSRC
suffix:colon
id|data
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_AUDIN
)paren
id|data
op_or_assign
id|SOUND_MASK_LINE
suffix:semicolon
r_if
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_MIC
)paren
id|data
op_or_assign
id|SOUND_MASK_MIC
suffix:semicolon
r_if
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_CD
)paren
id|data
op_or_assign
id|SOUND_MASK_CD
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_RECSRC
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|data
op_and_assign
(paren
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_CD
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_and_assign
op_complement
(paren
id|MASK_MUX_CD
op_or
id|MASK_MUX_MIC
op_or
id|MASK_MUX_AUDIN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SOUND_MASK_LINE
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_AUDIN
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SOUND_MASK_MIC
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_MIC
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SOUND_MASK_CD
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_CD
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_or
id|MASK_ADDR0
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
id|data
op_assign
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_SPEAKER
op_or
id|SOUND_MASK_RECLEV
op_or
id|SOUND_MASK_CD
op_or
id|SOUND_MASK_LINE
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_CAPS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
l_int|0
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_VOLUME
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|awacs_burgundy_write_mvolume
c_func
(paren
id|MASK_ADDR_BURGUNDY_MASTER_VOLUME
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* Fall through */
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|awacs_burgundy_read_mvolume
c_func
(paren
id|MASK_ADDR_BURGUNDY_MASTER_VOLUME
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_SPEAKER
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_amp
l_int|0xff
)paren
)paren
(brace
multiline_comment|/* Mute the left speaker */
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
comma
id|awacs_burgundy_rcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
)paren
op_amp
op_complement
l_int|0x2
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Unmute the left speaker */
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
comma
id|awacs_burgundy_rcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
)paren
op_or
l_int|0x2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_amp
l_int|0xff00
)paren
)paren
(brace
multiline_comment|/* Mute the right speaker */
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
comma
id|awacs_burgundy_rcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
)paren
op_amp
op_complement
l_int|0x4
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Unmute the right speaker */
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
comma
id|awacs_burgundy_rcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
)paren
op_or
l_int|0x4
)paren
suffix:semicolon
)brace
id|data
op_assign
(paren
(paren
(paren
id|data
op_amp
l_int|0xff
)paren
op_star
l_int|16
)paren
op_div
l_int|100
OG
l_int|0xf
ques
c_cond
l_int|0xf
suffix:colon
(paren
(paren
(paren
id|data
op_amp
l_int|0xff
)paren
op_star
l_int|16
)paren
op_div
l_int|100
)paren
)paren
op_plus
(paren
(paren
(paren
(paren
id|data
op_rshift
l_int|8
)paren
op_star
l_int|16
)paren
op_div
l_int|100
OG
l_int|0xf
ques
c_cond
l_int|0xf
suffix:colon
(paren
(paren
(paren
(paren
id|data
op_rshift
l_int|8
)paren
op_star
l_int|16
)paren
op_div
l_int|100
)paren
)paren
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|awacs_burgundy_wcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_ATTENSPEAKER
comma
op_complement
id|data
)paren
suffix:semicolon
multiline_comment|/* Fall through */
r_case
id|SOUND_MIXER_READ_SPEAKER
suffix:colon
id|data
op_assign
id|awacs_burgundy_rcb
c_func
(paren
id|MASK_ADDR_BURGUNDY_ATTENSPEAKER
)paren
suffix:semicolon
id|data
op_assign
(paren
(paren
(paren
id|data
op_amp
l_int|0xf
)paren
op_star
l_int|100
)paren
op_div
l_int|16
)paren
op_plus
(paren
(paren
(paren
(paren
id|data
op_rshift
l_int|4
)paren
op_star
l_int|100
)paren
op_div
l_int|16
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
op_complement
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_ALTPCM
suffix:colon
multiline_comment|/* really bell volume */
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|beep_volume
op_assign
id|data
op_amp
l_int|0xff
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_ALTPCM
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|beep_volume
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_LINE
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|awacs_burgundy_write_volume
c_func
(paren
id|MASK_ADDR_BURGUNDY_VOLLINE
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_LINE
suffix:colon
id|data
op_assign
id|awacs_burgundy_read_volume
c_func
(paren
id|MASK_ADDR_BURGUNDY_VOLLINE
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_MIC
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* Mic is mono device */
id|data
op_assign
(paren
id|data
op_lshift
l_int|8
)paren
op_plus
(paren
id|data
op_lshift
l_int|24
)paren
suffix:semicolon
id|awacs_burgundy_write_volume
c_func
(paren
id|MASK_ADDR_BURGUNDY_VOLMIC
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_MIC
suffix:colon
id|data
op_assign
id|awacs_burgundy_read_volume
c_func
(paren
id|MASK_ADDR_BURGUNDY_VOLMIC
)paren
suffix:semicolon
id|data
op_lshift_assign
l_int|24
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_CD
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|awacs_burgundy_write_volume
c_func
(paren
id|MASK_ADDR_BURGUNDY_VOLCD
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_CD
suffix:colon
id|data
op_assign
id|awacs_burgundy_read_volume
c_func
(paren
id|MASK_ADDR_BURGUNDY_VOLCD
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_RECLEV
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|data
op_assign
id|awacs_volume_setter
c_func
(paren
id|data
comma
l_int|0
comma
l_int|0
comma
l_int|4
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECLEV
suffix:colon
id|data
op_assign
id|awacs_get_volume
c_func
(paren
id|awacs_reg
(braket
l_int|0
)braket
comma
l_int|4
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_OUTMASK
suffix:colon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_OUTSRC
suffix:colon
r_break
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|PMacMixerIoctl
r_static
r_int
id|PMacMixerIoctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
multiline_comment|/* Different IOCTLS for burgundy*/
r_if
c_cond
(paren
id|awacs_revision
op_ge
id|AWACS_BURGUNDY
)paren
r_return
id|burgundy_mixer_ioctl
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_return
id|awacs_mixer_ioctl
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|PMacWriteSqSetup
r_static
r_void
id|PMacWriteSqSetup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_volatile
r_struct
id|dbdma_cmd
op_star
id|cp
suffix:semicolon
id|cp
op_assign
id|awacs_tx_cmds
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|cp
comma
l_int|0
comma
(paren
id|write_sq.numBufs
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|dbdma_cmd
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|write_sq.numBufs
suffix:semicolon
op_increment
id|i
comma
op_increment
id|cp
)paren
(brace
id|st_le32
c_func
(paren
op_amp
id|cp-&gt;phy_addr
comma
id|virt_to_bus
c_func
(paren
id|write_sq.buffers
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;command
comma
id|DBDMA_NOP
op_plus
id|BR_ALWAYS
)paren
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|cp-&gt;cmd_dep
comma
id|virt_to_bus
c_func
(paren
id|awacs_tx_cmds
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
(paren
id|RUN
op_or
id|PAUSE
op_or
id|FLUSH
op_or
id|WAKE
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;cmdptr
comma
id|virt_to_bus
c_func
(paren
id|awacs_tx_cmds
)paren
)paren
suffix:semicolon
)brace
DECL|function|PMacReadSqSetup
r_static
r_void
id|PMacReadSqSetup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_volatile
r_struct
id|dbdma_cmd
op_star
id|cp
suffix:semicolon
id|cp
op_assign
id|awacs_rx_cmds
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|cp
comma
l_int|0
comma
(paren
id|read_sq.numBufs
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|dbdma_cmd
)paren
)paren
suffix:semicolon
multiline_comment|/* Set dma buffers up in a loop */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|read_sq.numBufs
suffix:semicolon
id|i
op_increment
comma
id|cp
op_increment
)paren
(brace
id|st_le32
c_func
(paren
op_amp
id|cp-&gt;phy_addr
comma
id|virt_to_bus
c_func
(paren
id|read_sq.buffers
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;command
comma
id|INPUT_MORE
op_plus
id|INTR_ALWAYS
)paren
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;req_count
comma
id|read_sq.block_size
)paren
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;xfer_status
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* The next two lines make the thing loop around.&n;&t;*/
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;command
comma
id|DBDMA_NOP
op_plus
id|BR_ALWAYS
)paren
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|cp-&gt;cmd_dep
comma
id|virt_to_bus
c_func
(paren
id|awacs_rx_cmds
)paren
)paren
suffix:semicolon
multiline_comment|/* Don&squot;t start until the first read is done.&n;&t; * This will also abort any operations in progress if the DMA&n;&t; * happens to be running (and it shouldn&squot;t).&n;&t; */
id|out_le32
c_func
(paren
op_amp
id|awacs_rxdma-&gt;control
comma
(paren
id|RUN
op_or
id|PAUSE
op_or
id|FLUSH
op_or
id|WAKE
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_rxdma-&gt;cmdptr
comma
id|virt_to_bus
c_func
(paren
id|awacs_rx_cmds
)paren
)paren
suffix:semicolon
)brace
DECL|function|PMacAbortRead
r_static
r_void
id|PMacAbortRead
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_volatile
r_struct
id|dbdma_cmd
op_star
id|cp
suffix:semicolon
id|cp
op_assign
id|awacs_rx_cmds
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|read_sq.numBufs
suffix:semicolon
id|i
op_increment
comma
id|cp
op_increment
)paren
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;command
comma
id|DBDMA_STOP
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We should probably wait for the thing to stop before we&n;&t; * release the memory&n;&t; */
)brace
multiline_comment|/*** Machine definitions *****************************************************/
DECL|variable|machPMac
r_static
id|MACHINE
id|machPMac
op_assign
(brace
id|name
suffix:colon
id|awacs_name
comma
id|name2
suffix:colon
l_string|&quot;AWACS&quot;
comma
id|open
suffix:colon
id|PMacOpen
comma
id|release
suffix:colon
id|PMacRelease
comma
id|dma_alloc
suffix:colon
id|PMacAlloc
comma
id|dma_free
suffix:colon
id|PMacFree
comma
id|irqinit
suffix:colon
id|PMacIrqInit
comma
macro_line|#ifdef MODULE
id|irqcleanup
suffix:colon
id|PMacIrqCleanup
comma
macro_line|#endif /* MODULE */
id|init
suffix:colon
id|PMacInit
comma
id|silence
suffix:colon
id|PMacSilence
comma
id|setFormat
suffix:colon
id|PMacSetFormat
comma
id|setVolume
suffix:colon
id|PMacSetVolume
comma
id|play
suffix:colon
id|PMacPlay
comma
id|record
suffix:colon
id|PMacRecord
comma
id|mixer_ioctl
suffix:colon
id|PMacMixerIoctl
comma
id|write_sq_setup
suffix:colon
id|PMacWriteSqSetup
comma
id|read_sq_setup
suffix:colon
id|PMacReadSqSetup
comma
id|abort_read
suffix:colon
id|PMacAbortRead
comma
id|min_dsp_speed
suffix:colon
l_int|8000
)brace
suffix:semicolon
multiline_comment|/*** Config &amp; Setup **********************************************************/
DECL|function|dmasound_awacs_init
r_int
id|__init
id|dmasound_awacs_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|device_node
op_star
id|np
suffix:semicolon
r_if
c_cond
(paren
id|_machine
op_ne
id|_MACH_Pmac
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|awacs_subframe
op_assign
l_int|0
suffix:semicolon
id|awacs_revision
op_assign
l_int|0
suffix:semicolon
id|np
op_assign
id|find_devices
c_func
(paren
l_string|&quot;awacs&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * powermac G3 models have a node called &quot;davbus&quot;&n;&t;&t; * with a child called &quot;sound&quot;.&n;&t;&t; */
r_struct
id|device_node
op_star
id|sound
suffix:semicolon
id|np
op_assign
id|find_devices
c_func
(paren
l_string|&quot;davbus&quot;
)paren
suffix:semicolon
id|sound
op_assign
id|find_devices
c_func
(paren
l_string|&quot;sound&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound
op_ne
l_int|0
op_logical_and
id|sound-&gt;parent
op_eq
id|np
)paren
(brace
r_int
r_int
op_star
id|prop
comma
id|l
comma
id|i
suffix:semicolon
id|prop
op_assign
(paren
r_int
r_int
op_star
)paren
id|get_property
c_func
(paren
id|sound
comma
l_string|&quot;sub-frame&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop
op_ne
l_int|0
op_logical_and
op_star
id|prop
op_ge
l_int|0
op_logical_and
op_star
id|prop
OL
l_int|16
)paren
id|awacs_subframe
op_assign
op_star
id|prop
suffix:semicolon
r_if
c_cond
(paren
id|device_is_compatible
c_func
(paren
id|sound
comma
l_string|&quot;burgundy&quot;
)paren
)paren
id|awacs_revision
op_assign
id|AWACS_BURGUNDY
suffix:semicolon
multiline_comment|/* This should be verified on older screamers */
r_if
c_cond
(paren
id|device_is_compatible
c_func
(paren
id|sound
comma
l_string|&quot;screamer&quot;
)paren
)paren
id|awacs_is_screamer
op_assign
l_int|1
suffix:semicolon
id|prop
op_assign
(paren
r_int
r_int
op_star
)paren
id|get_property
c_func
(paren
id|sound
comma
l_string|&quot;device-id&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop
op_ne
l_int|0
)paren
id|awacs_device_id
op_assign
op_star
id|prop
suffix:semicolon
id|awacs_has_iic
op_assign
(paren
id|find_devices
c_func
(paren
l_string|&quot;perch&quot;
)paren
op_ne
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* look for a property saying what sample rates&n;&t;&t;&t;   are available */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
op_increment
id|i
)paren
id|awacs_freqs_ok
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|prop
op_assign
(paren
r_int
r_int
op_star
)paren
id|get_property
(paren
id|sound
comma
l_string|&quot;sample-rates&quot;
comma
op_amp
id|l
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop
op_eq
l_int|0
)paren
id|prop
op_assign
(paren
r_int
r_int
op_star
)paren
id|get_property
(paren
id|sound
comma
l_string|&quot;output-frame-rates&quot;
comma
op_amp
id|l
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop
op_ne
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|l
op_div_assign
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|l
OG
l_int|0
suffix:semicolon
op_decrement
id|l
)paren
(brace
multiline_comment|/* sometimes the rate is in the&n;&t;&t;&t;&t;&t;   high-order 16 bits (?) */
r_int
r_int
id|r
op_assign
op_star
id|prop
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|r
op_ge
l_int|0x10000
)paren
id|r
op_rshift_assign
l_int|16
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|r
op_eq
id|awacs_freqs
(braket
id|i
)braket
)paren
(brace
id|awacs_freqs_ok
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* assume just 44.1k is OK */
id|awacs_freqs_ok
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|np
op_ne
l_int|NULL
op_logical_and
id|np-&gt;n_addrs
op_ge
l_int|3
op_logical_and
id|np-&gt;n_intrs
op_ge
l_int|3
)paren
(brace
r_int
id|vol
suffix:semicolon
id|dmasound.mach
op_assign
id|machPMac
suffix:semicolon
id|awacs
op_assign
(paren
r_volatile
r_struct
id|awacs_regs
op_star
)paren
id|ioremap
c_func
(paren
id|np-&gt;addrs
(braket
l_int|0
)braket
dot
id|address
comma
l_int|0x80
)paren
suffix:semicolon
id|awacs_txdma
op_assign
(paren
r_volatile
r_struct
id|dbdma_regs
op_star
)paren
id|ioremap
c_func
(paren
id|np-&gt;addrs
(braket
l_int|1
)braket
dot
id|address
comma
l_int|0x100
)paren
suffix:semicolon
id|awacs_rxdma
op_assign
(paren
r_volatile
r_struct
id|dbdma_regs
op_star
)paren
id|ioremap
c_func
(paren
id|np-&gt;addrs
(braket
l_int|2
)braket
dot
id|address
comma
l_int|0x100
)paren
suffix:semicolon
id|awacs_irq
op_assign
id|np-&gt;intrs
(braket
l_int|0
)braket
dot
id|line
suffix:semicolon
id|awacs_tx_irq
op_assign
id|np-&gt;intrs
(braket
l_int|1
)braket
dot
id|line
suffix:semicolon
id|awacs_rx_irq
op_assign
id|np-&gt;intrs
(braket
l_int|2
)braket
dot
id|line
suffix:semicolon
id|awacs_tx_cmd_space
op_assign
id|kmalloc
c_func
(paren
(paren
id|write_sq.numBufs
op_plus
l_int|4
)paren
op_star
r_sizeof
(paren
r_struct
id|dbdma_cmd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awacs_tx_cmd_space
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DMA sound driver: Not enough buffer memory, driver disabled!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|awacs_node
op_assign
id|np
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
r_if
c_cond
(paren
id|machine_is_compatible
c_func
(paren
l_string|&quot;PowerBook1,1&quot;
)paren
op_logical_or
id|machine_is_compatible
c_func
(paren
l_string|&quot;AAPL,PowerBook1998&quot;
)paren
)paren
(brace
id|pmu_suspend
c_func
(paren
)paren
suffix:semicolon
id|feature_set
c_func
(paren
id|np
comma
id|FEATURE_Sound_CLK_enable
)paren
suffix:semicolon
id|feature_set
c_func
(paren
id|np
comma
id|FEATURE_Sound_power
)paren
suffix:semicolon
multiline_comment|/* Shorter delay will not work */
id|mdelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|pmu_resume
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|awacs_tx_cmds
op_assign
(paren
r_volatile
r_struct
id|dbdma_cmd
op_star
)paren
id|DBDMA_ALIGN
c_func
(paren
id|awacs_tx_cmd_space
)paren
suffix:semicolon
id|awacs_rx_cmd_space
op_assign
id|kmalloc
c_func
(paren
(paren
id|read_sq.numBufs
op_plus
l_int|4
)paren
op_star
r_sizeof
(paren
r_struct
id|dbdma_cmd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awacs_rx_cmd_space
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DMA sound driver: No memory for input&quot;
)paren
suffix:semicolon
)brace
id|awacs_rx_cmds
op_assign
(paren
r_volatile
r_struct
id|dbdma_cmd
op_star
)paren
id|DBDMA_ALIGN
c_func
(paren
id|awacs_rx_cmd_space
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_assign
id|MASK_MUX_CD
suffix:semicolon
multiline_comment|/* FIXME: Only machines with external SRS module need MASK_PAROUT */
id|awacs_reg
(braket
l_int|1
)braket
op_assign
id|MASK_LOOPTHRU
suffix:semicolon
r_if
c_cond
(paren
id|awacs_has_iic
op_logical_or
id|awacs_device_id
op_eq
l_int|0x5
op_logical_or
multiline_comment|/*awacs_device_id == 0x8&n;&t;&t;&t;|| */
id|awacs_device_id
op_eq
l_int|0xb
)paren
id|awacs_reg
(braket
l_int|1
)braket
op_or_assign
id|MASK_PAROUT
suffix:semicolon
multiline_comment|/* get default volume from nvram */
id|vol
op_assign
(paren
op_complement
id|nvram_read_byte
c_func
(paren
l_int|0x1308
)paren
op_amp
l_int|7
)paren
op_lshift
l_int|1
suffix:semicolon
id|awacs_reg
(braket
l_int|2
)braket
op_assign
id|vol
op_plus
(paren
id|vol
op_lshift
l_int|6
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|4
)braket
op_assign
id|vol
op_plus
(paren
id|vol
op_lshift
l_int|6
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
id|awacs_reg
(braket
l_int|6
)braket
op_assign
l_int|0
suffix:semicolon
id|awacs_reg
(braket
l_int|7
)braket
op_assign
l_int|0
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
l_int|0x11
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_plus
id|MASK_ADDR0
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_plus
id|MASK_ADDR1
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|2
)braket
op_plus
id|MASK_ADDR2
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|4
)braket
op_plus
id|MASK_ADDR4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awacs_is_screamer
)paren
(brace
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|5
)braket
op_plus
id|MASK_ADDR5
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|6
)braket
op_plus
id|MASK_ADDR6
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|7
)braket
op_plus
id|MASK_ADDR7
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize recent versions of the awacs */
r_if
c_cond
(paren
id|awacs_revision
op_eq
l_int|0
)paren
(brace
id|awacs_revision
op_assign
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_stat
)paren
op_rshift
l_int|12
)paren
op_amp
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|awacs_revision
op_eq
l_int|3
)paren
(brace
id|mdelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
l_int|0x6000
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_plus
id|MASK_ADDR1
)paren
suffix:semicolon
id|awacs_enable_amp
c_func
(paren
l_int|100
op_star
l_int|0x101
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|awacs_revision
op_ge
id|AWACS_BURGUNDY
)paren
id|awacs_burgundy_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Initialize beep stuff */
id|beep_dbdma_cmd
op_assign
id|awacs_tx_cmds
op_plus
(paren
id|write_sq.numBufs
op_plus
l_int|1
)paren
suffix:semicolon
id|orig_mksound
op_assign
id|kd_mksound
suffix:semicolon
id|kd_mksound
op_assign
id|awacs_mksound
suffix:semicolon
id|beep_buf
op_assign
(paren
r_int
op_star
)paren
id|kmalloc
c_func
(paren
id|BEEP_BUFLEN
op_star
l_int|4
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|beep_buf
op_eq
l_int|NULL
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;dmasound: no memory for &quot;
l_string|&quot;beep buffer&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
id|pmu_register_sleep_notifier
c_func
(paren
op_amp
id|awacs_sleep_notifier
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_PBOOK */
multiline_comment|/* Powerbooks have odd ways of enabling inputs such as&n;&t;&t;   an expansion-bay CD or sound from an internal modem&n;&t;&t;   or a PC-card modem. */
r_if
c_cond
(paren
id|machine_is_compatible
c_func
(paren
l_string|&quot;AAPL,3400/2400&quot;
)paren
op_logical_or
id|machine_is_compatible
c_func
(paren
l_string|&quot;AAPL,3500&quot;
)paren
)paren
(brace
id|is_pbook_3400
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Enable CD and PC-card sound inputs.&n;&t;&t;&t; * This is done by reading from address&n;&t;&t;&t; * f301a000, + 0x10 to enable the expansion-bay&n;&t;&t;&t; * CD sound input, + 0x80 to enable the PC-card&n;&t;&t;&t; * sound input.  The 0x100 enables the SCSI bus&n;&t;&t;&t; * terminator power.&n;&t;&t;&t; */
id|latch_base
op_assign
(paren
r_int
r_char
op_star
)paren
id|ioremap
(paren
l_int|0xf301a000
comma
l_int|0x1000
)paren
suffix:semicolon
id|in_8
c_func
(paren
id|latch_base
op_plus
l_int|0x190
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|machine_is_compatible
c_func
(paren
l_string|&quot;PowerBook1,1&quot;
)paren
op_logical_or
id|machine_is_compatible
c_func
(paren
l_string|&quot;AAPL,PowerBook1998&quot;
)paren
)paren
(brace
r_struct
id|device_node
op_star
id|mio
suffix:semicolon
id|macio_base
op_assign
l_int|0
suffix:semicolon
id|is_pbook_G3
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|mio
op_assign
id|np-&gt;parent
suffix:semicolon
id|mio
suffix:semicolon
id|mio
op_assign
id|mio-&gt;parent
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|mio-&gt;name
comma
l_string|&quot;mac-io&quot;
)paren
op_eq
l_int|0
op_logical_and
id|mio-&gt;n_addrs
OG
l_int|0
)paren
(brace
id|macio_base
op_assign
(paren
r_int
r_char
op_star
)paren
id|ioremap
(paren
id|mio-&gt;addrs
(braket
l_int|0
)braket
dot
id|address
comma
l_int|0x40
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t;&t; * Enable CD sound input.&n;&t;&t;&t; * The relevant bits for writing to this byte are 0x8f.&n;&t;&t;&t; * I haven&squot;t found out what the 0x80 bit does.&n;&t;&t;&t; * For the 0xf bits, writing 3 or 7 enables the CD&n;&t;&t;&t; * input, any other value disables it.  Values&n;&t;&t;&t; * 1, 3, 5, 7 enable the microphone.  Values 0, 2,&n;&t;&t;&t; * 4, 6, 8 - f enable the input from the modem.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|macio_base
)paren
id|out_8
c_func
(paren
id|macio_base
op_plus
l_int|0x37
comma
l_int|3
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|awacs_name
comma
l_string|&quot;PowerMac (AWACS rev %d) &quot;
comma
id|awacs_revision
)paren
suffix:semicolon
r_return
id|dmasound_init
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|dmasound_awacs_cleanup
r_static
r_void
id|__exit
id|dmasound_awacs_cleanup
c_func
(paren
r_void
)paren
(brace
id|dmasound_deinit
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|dmasound_awacs_init
id|module_init
c_func
(paren
id|dmasound_awacs_init
)paren
suffix:semicolon
DECL|variable|dmasound_awacs_cleanup
id|module_exit
c_func
(paren
id|dmasound_awacs_cleanup
)paren
suffix:semicolon
eof
