multiline_comment|/* linux/drivers/sound/dmasound.c */
multiline_comment|/*&n;&n;VoxWare compatible Atari TT DMA sound driver for 680x0 Linux&n;&n;(c) 1995 by Michael Schlueter &amp; Michael Marte&n;&n;Michael Schlueter (michael@duck.syd.de) did the basic structure of the VFS&n;interface and the u-law to signed byte conversion.&n;&n;Michael Marte (marte@informatik.uni-muenchen.de) did the sound queue,&n;/dev/mixer, /dev/sndstat and complemented the VFS interface. He would like&n;to thank:&n;Michael Schlueter for initial ideas and documentation on the MFP and&n;the DMA sound hardware.&n;Therapy? for their CD &squot;Troublegum&squot; which really made me rock.&n;&n;/dev/sndstat is based on code by Hannu Savolainen, the author of the&n;VoxWare family of drivers.&n;&n;This file is subject to the terms and conditions of the GNU General Public&n;License.  See the file COPYING in the main directory of this archive&n;for more details.&n;&n;History:&n;1995/8/25&t;first release&n;&n;1995/9/02&t;++roman: fixed atari_stram_alloc() call, the timer programming&n;&t;&t;&t;and several race conditions&n;&n;1995/9/14&t;++roman: After some discussion with Michael Schlueter, revised&n;&t;&t;&t;the interrupt disabling&n;&t;&t;&t;Slightly speeded up U8-&gt;S8 translation by using long&n;&t;&t;&t;operations where possible&n;&t;&t;&t;Added 4:3 interpolation for /dev/audio&n;&n;1995/9/20&t;++TeSche: Fixed a bug in sq_write and changed /dev/audio&n;&t;&t;&t;converting to play at 12517Hz instead of 6258Hz.&n;&n;1995/9/23&t;++TeSche: Changed sq_interrupt() and sq_play() to pre-program&n;&t;&t;&t;the DMA for another frame while there&squot;s still one&n;&t;&t;&t;running. This allows the IRQ response to be&n;&t;&t;&t;arbitrarily delayed and playing will still continue.&n;&n;1995/10/14&t;++Guenther_Kelleter@ac3.maus.de, ++TeSche: better support for&n;&t;&t;&t;Falcon audio (the Falcon doesn&squot;t raise an IRQ at the&n;&t;&t;&t;end of a frame, but at the beginning instead!). uses&n;&t;&t;&t;&squot;if (codec_dma)&squot; in lots of places to simply switch&n;&t;&t;&t;between Falcon and TT code.&n;&n;1995/11/06&t;++TeSche: started introducing a hardware abstraction scheme&n;&t;&t;&t;(may perhaps also serve for Amigas?), can now play&n;&t;&t;&t;samples at almost all frequencies by means of a more&n;&t;&t;&t;generalized expand routine, takes a good deal of care&n;&t;&t;&t;to cut data only at sample sizes, buffer size is now&n;&t;&t;&t;a kernel runtime option, implemented fsync() &amp; several&n;&t;&t;&t;minor improvements&n;&t;&t;++Guenther: useful hints and bug fixes, cross-checked it for&n;&t;&t;&t;Falcons&n;&n;1996/3/9&t;++geert: support added for Amiga, A-law, 16-bit little endian.&n;&t;&t;&t;Unification to drivers/sound/dmasound.c.&n;1996/4/6&t;++Martin Mitchell: updated to 1.3 kernel.&n;*/
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#ifdef CONFIG_ATARI
macro_line|#include &lt;asm/atarihw.h&gt;
macro_line|#include &lt;asm/atariints.h&gt;
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
macro_line|#include &lt;asm/amigahw.h&gt;
macro_line|#include &lt;asm/amigaints.h&gt;
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#include &quot;dmasound.h&quot;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#ifdef CONFIG_ATARI
r_extern
r_void
id|atari_microwire_cmd
c_func
(paren
r_int
id|cmd
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
multiline_comment|/*&n;    *&t;The minimum period for audio depends on total (for OCS/ECS/AGA)&n;    *&t;(Imported from arch/m68k/amiga/amisound.c)&n;    */
r_extern
r_volatile
id|u_short
id|amiga_audio_min_period
suffix:semicolon
multiline_comment|/*&n;    *&t;amiga_mksound() should be able to restore the period after beeping&n;    *&t;(Imported from arch/m68k/amiga/amisound.c)&n;    */
r_extern
id|u_short
id|amiga_audio_period
suffix:semicolon
multiline_comment|/*&n;    *&t;Audio DMA masks&n;    */
DECL|macro|AMI_AUDIO_OFF
mdefine_line|#define AMI_AUDIO_OFF&t;(DMAF_AUD0 | DMAF_AUD1 | DMAF_AUD2 | DMAF_AUD3)
DECL|macro|AMI_AUDIO_8
mdefine_line|#define AMI_AUDIO_8&t;(DMAF_SETCLR | DMAF_MASTER | DMAF_AUD0 | DMAF_AUD1)
DECL|macro|AMI_AUDIO_14
mdefine_line|#define AMI_AUDIO_14&t;(AMI_AUDIO_8 | DMAF_AUD2 | DMAF_AUD3)
macro_line|#endif /* CONFIG_AMIGA */
multiline_comment|/*** Some declarations *******************************************************/
DECL|macro|DMASND_TT
mdefine_line|#define DMASND_TT&t;&t;1
DECL|macro|DMASND_FALCON
mdefine_line|#define DMASND_FALCON&t;&t;2
DECL|macro|DMASND_AMIGA
mdefine_line|#define DMASND_AMIGA&t;&t;3
DECL|macro|MAX_CATCH_RADIUS
mdefine_line|#define MAX_CATCH_RADIUS&t;10
DECL|macro|MIN_BUFFERS
mdefine_line|#define MIN_BUFFERS&t;&t;4
DECL|macro|MIN_BUFSIZE
mdefine_line|#define MIN_BUFSIZE &t;&t;4
DECL|macro|MAX_BUFSIZE
mdefine_line|#define MAX_BUFSIZE&t;&t;128&t;/* Limit for Amiga */
DECL|variable|catchRadius
DECL|variable|numBufs
DECL|variable|bufSize
r_static
r_int
id|catchRadius
op_assign
l_int|0
comma
id|numBufs
op_assign
l_int|4
comma
id|bufSize
op_assign
l_int|32
suffix:semicolon
DECL|macro|arraysize
mdefine_line|#define arraysize(x)&t;(sizeof(x)/sizeof(*(x)))
DECL|macro|min
mdefine_line|#define min(x, y)&t;((x) &lt; (y) ? (x) : (y))
DECL|macro|le2be16
mdefine_line|#define le2be16(x)&t;(((x)&lt;&lt;8 &amp; 0xff00) | ((x)&gt;&gt;8 &amp; 0x00ff))
DECL|macro|le2be16dbl
mdefine_line|#define le2be16dbl(x)&t;(((x)&lt;&lt;8 &amp; 0xff00ff00) | ((x)&gt;&gt;8 &amp; 0x00ff00ff))
DECL|macro|IOCTL_IN
mdefine_line|#define IOCTL_IN(arg)&t;&t;get_user((int *)(arg))
DECL|macro|IOCTL_OUT
mdefine_line|#define IOCTL_OUT(arg, ret)&t;ioctl_return((int *)arg, ret)
multiline_comment|/*** Some low level helpers **************************************************/
multiline_comment|/* 8 bit mu-law */
DECL|variable|ulaw2dma8
r_static
r_char
id|ulaw2dma8
(braket
)braket
op_assign
(brace
op_minus
l_int|126
comma
op_minus
l_int|122
comma
op_minus
l_int|118
comma
op_minus
l_int|114
comma
op_minus
l_int|110
comma
op_minus
l_int|106
comma
op_minus
l_int|102
comma
op_minus
l_int|98
comma
op_minus
l_int|94
comma
op_minus
l_int|90
comma
op_minus
l_int|86
comma
op_minus
l_int|82
comma
op_minus
l_int|78
comma
op_minus
l_int|74
comma
op_minus
l_int|70
comma
op_minus
l_int|66
comma
op_minus
l_int|63
comma
op_minus
l_int|61
comma
op_minus
l_int|59
comma
op_minus
l_int|57
comma
op_minus
l_int|55
comma
op_minus
l_int|53
comma
op_minus
l_int|51
comma
op_minus
l_int|49
comma
op_minus
l_int|47
comma
op_minus
l_int|45
comma
op_minus
l_int|43
comma
op_minus
l_int|41
comma
op_minus
l_int|39
comma
op_minus
l_int|37
comma
op_minus
l_int|35
comma
op_minus
l_int|33
comma
op_minus
l_int|31
comma
op_minus
l_int|30
comma
op_minus
l_int|29
comma
op_minus
l_int|28
comma
op_minus
l_int|27
comma
op_minus
l_int|26
comma
op_minus
l_int|25
comma
op_minus
l_int|24
comma
op_minus
l_int|23
comma
op_minus
l_int|22
comma
op_minus
l_int|21
comma
op_minus
l_int|20
comma
op_minus
l_int|19
comma
op_minus
l_int|18
comma
op_minus
l_int|17
comma
op_minus
l_int|16
comma
op_minus
l_int|16
comma
op_minus
l_int|15
comma
op_minus
l_int|15
comma
op_minus
l_int|14
comma
op_minus
l_int|14
comma
op_minus
l_int|13
comma
op_minus
l_int|13
comma
op_minus
l_int|12
comma
op_minus
l_int|12
comma
op_minus
l_int|11
comma
op_minus
l_int|11
comma
op_minus
l_int|10
comma
op_minus
l_int|10
comma
op_minus
l_int|9
comma
op_minus
l_int|9
comma
op_minus
l_int|8
comma
op_minus
l_int|8
comma
op_minus
l_int|8
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|0
comma
l_int|125
comma
l_int|121
comma
l_int|117
comma
l_int|113
comma
l_int|109
comma
l_int|105
comma
l_int|101
comma
l_int|97
comma
l_int|93
comma
l_int|89
comma
l_int|85
comma
l_int|81
comma
l_int|77
comma
l_int|73
comma
l_int|69
comma
l_int|65
comma
l_int|62
comma
l_int|60
comma
l_int|58
comma
l_int|56
comma
l_int|54
comma
l_int|52
comma
l_int|50
comma
l_int|48
comma
l_int|46
comma
l_int|44
comma
l_int|42
comma
l_int|40
comma
l_int|38
comma
l_int|36
comma
l_int|34
comma
l_int|32
comma
l_int|30
comma
l_int|29
comma
l_int|28
comma
l_int|27
comma
l_int|26
comma
l_int|25
comma
l_int|24
comma
l_int|23
comma
l_int|22
comma
l_int|21
comma
l_int|20
comma
l_int|19
comma
l_int|18
comma
l_int|17
comma
l_int|16
comma
l_int|15
comma
l_int|15
comma
l_int|14
comma
l_int|14
comma
l_int|13
comma
l_int|13
comma
l_int|12
comma
l_int|12
comma
l_int|11
comma
l_int|11
comma
l_int|10
comma
l_int|10
comma
l_int|9
comma
l_int|9
comma
l_int|8
comma
l_int|8
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* 8 bit A-law */
DECL|variable|alaw2dma8
r_static
r_char
id|alaw2dma8
(braket
)braket
op_assign
(brace
op_minus
l_int|22
comma
op_minus
l_int|21
comma
op_minus
l_int|24
comma
op_minus
l_int|23
comma
op_minus
l_int|18
comma
op_minus
l_int|17
comma
op_minus
l_int|20
comma
op_minus
l_int|19
comma
op_minus
l_int|30
comma
op_minus
l_int|29
comma
op_minus
l_int|32
comma
op_minus
l_int|31
comma
op_minus
l_int|26
comma
op_minus
l_int|25
comma
op_minus
l_int|28
comma
op_minus
l_int|27
comma
op_minus
l_int|11
comma
op_minus
l_int|11
comma
op_minus
l_int|12
comma
op_minus
l_int|12
comma
op_minus
l_int|9
comma
op_minus
l_int|9
comma
op_minus
l_int|10
comma
op_minus
l_int|10
comma
op_minus
l_int|15
comma
op_minus
l_int|15
comma
op_minus
l_int|16
comma
op_minus
l_int|16
comma
op_minus
l_int|13
comma
op_minus
l_int|13
comma
op_minus
l_int|14
comma
op_minus
l_int|14
comma
op_minus
l_int|86
comma
op_minus
l_int|82
comma
op_minus
l_int|94
comma
op_minus
l_int|90
comma
op_minus
l_int|70
comma
op_minus
l_int|66
comma
op_minus
l_int|78
comma
op_minus
l_int|74
comma
op_minus
l_int|118
comma
op_minus
l_int|114
comma
op_minus
l_int|126
comma
op_minus
l_int|122
comma
op_minus
l_int|102
comma
op_minus
l_int|98
comma
op_minus
l_int|110
comma
op_minus
l_int|106
comma
op_minus
l_int|43
comma
op_minus
l_int|41
comma
op_minus
l_int|47
comma
op_minus
l_int|45
comma
op_minus
l_int|35
comma
op_minus
l_int|33
comma
op_minus
l_int|39
comma
op_minus
l_int|37
comma
op_minus
l_int|59
comma
op_minus
l_int|57
comma
op_minus
l_int|63
comma
op_minus
l_int|61
comma
op_minus
l_int|51
comma
op_minus
l_int|49
comma
op_minus
l_int|55
comma
op_minus
l_int|53
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|8
comma
op_minus
l_int|8
comma
op_minus
l_int|8
comma
op_minus
l_int|8
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
l_int|21
comma
l_int|20
comma
l_int|23
comma
l_int|22
comma
l_int|17
comma
l_int|16
comma
l_int|19
comma
l_int|18
comma
l_int|29
comma
l_int|28
comma
l_int|31
comma
l_int|30
comma
l_int|25
comma
l_int|24
comma
l_int|27
comma
l_int|26
comma
l_int|10
comma
l_int|10
comma
l_int|11
comma
l_int|11
comma
l_int|8
comma
l_int|8
comma
l_int|9
comma
l_int|9
comma
l_int|14
comma
l_int|14
comma
l_int|15
comma
l_int|15
comma
l_int|12
comma
l_int|12
comma
l_int|13
comma
l_int|13
comma
l_int|86
comma
l_int|82
comma
l_int|94
comma
l_int|90
comma
l_int|70
comma
l_int|66
comma
l_int|78
comma
l_int|74
comma
l_int|118
comma
l_int|114
comma
l_int|126
comma
l_int|122
comma
l_int|102
comma
l_int|98
comma
l_int|110
comma
l_int|106
comma
l_int|43
comma
l_int|41
comma
l_int|47
comma
l_int|45
comma
l_int|35
comma
l_int|33
comma
l_int|39
comma
l_int|37
comma
l_int|59
comma
l_int|57
comma
l_int|63
comma
l_int|61
comma
l_int|51
comma
l_int|49
comma
l_int|55
comma
l_int|53
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
)brace
suffix:semicolon
macro_line|#ifdef HAS_16BIT_TABLES
multiline_comment|/* 16 bit mu-law */
DECL|variable|ulaw2dma16
r_static
r_char
id|ulaw2dma16
(braket
)braket
op_assign
(brace
op_minus
l_int|32124
comma
op_minus
l_int|31100
comma
op_minus
l_int|30076
comma
op_minus
l_int|29052
comma
op_minus
l_int|28028
comma
op_minus
l_int|27004
comma
op_minus
l_int|25980
comma
op_minus
l_int|24956
comma
op_minus
l_int|23932
comma
op_minus
l_int|22908
comma
op_minus
l_int|21884
comma
op_minus
l_int|20860
comma
op_minus
l_int|19836
comma
op_minus
l_int|18812
comma
op_minus
l_int|17788
comma
op_minus
l_int|16764
comma
op_minus
l_int|15996
comma
op_minus
l_int|15484
comma
op_minus
l_int|14972
comma
op_minus
l_int|14460
comma
op_minus
l_int|13948
comma
op_minus
l_int|13436
comma
op_minus
l_int|12924
comma
op_minus
l_int|12412
comma
op_minus
l_int|11900
comma
op_minus
l_int|11388
comma
op_minus
l_int|10876
comma
op_minus
l_int|10364
comma
op_minus
l_int|9852
comma
op_minus
l_int|9340
comma
op_minus
l_int|8828
comma
op_minus
l_int|8316
comma
op_minus
l_int|7932
comma
op_minus
l_int|7676
comma
op_minus
l_int|7420
comma
op_minus
l_int|7164
comma
op_minus
l_int|6908
comma
op_minus
l_int|6652
comma
op_minus
l_int|6396
comma
op_minus
l_int|6140
comma
op_minus
l_int|5884
comma
op_minus
l_int|5628
comma
op_minus
l_int|5372
comma
op_minus
l_int|5116
comma
op_minus
l_int|4860
comma
op_minus
l_int|4604
comma
op_minus
l_int|4348
comma
op_minus
l_int|4092
comma
op_minus
l_int|3900
comma
op_minus
l_int|3772
comma
op_minus
l_int|3644
comma
op_minus
l_int|3516
comma
op_minus
l_int|3388
comma
op_minus
l_int|3260
comma
op_minus
l_int|3132
comma
op_minus
l_int|3004
comma
op_minus
l_int|2876
comma
op_minus
l_int|2748
comma
op_minus
l_int|2620
comma
op_minus
l_int|2492
comma
op_minus
l_int|2364
comma
op_minus
l_int|2236
comma
op_minus
l_int|2108
comma
op_minus
l_int|1980
comma
op_minus
l_int|1884
comma
op_minus
l_int|1820
comma
op_minus
l_int|1756
comma
op_minus
l_int|1692
comma
op_minus
l_int|1628
comma
op_minus
l_int|1564
comma
op_minus
l_int|1500
comma
op_minus
l_int|1436
comma
op_minus
l_int|1372
comma
op_minus
l_int|1308
comma
op_minus
l_int|1244
comma
op_minus
l_int|1180
comma
op_minus
l_int|1116
comma
op_minus
l_int|1052
comma
op_minus
l_int|988
comma
op_minus
l_int|924
comma
op_minus
l_int|876
comma
op_minus
l_int|844
comma
op_minus
l_int|812
comma
op_minus
l_int|780
comma
op_minus
l_int|748
comma
op_minus
l_int|716
comma
op_minus
l_int|684
comma
op_minus
l_int|652
comma
op_minus
l_int|620
comma
op_minus
l_int|588
comma
op_minus
l_int|556
comma
op_minus
l_int|524
comma
op_minus
l_int|492
comma
op_minus
l_int|460
comma
op_minus
l_int|428
comma
op_minus
l_int|396
comma
op_minus
l_int|372
comma
op_minus
l_int|356
comma
op_minus
l_int|340
comma
op_minus
l_int|324
comma
op_minus
l_int|308
comma
op_minus
l_int|292
comma
op_minus
l_int|276
comma
op_minus
l_int|260
comma
op_minus
l_int|244
comma
op_minus
l_int|228
comma
op_minus
l_int|212
comma
op_minus
l_int|196
comma
op_minus
l_int|180
comma
op_minus
l_int|164
comma
op_minus
l_int|148
comma
op_minus
l_int|132
comma
op_minus
l_int|120
comma
op_minus
l_int|112
comma
op_minus
l_int|104
comma
op_minus
l_int|96
comma
op_minus
l_int|88
comma
op_minus
l_int|80
comma
op_minus
l_int|72
comma
op_minus
l_int|64
comma
op_minus
l_int|56
comma
op_minus
l_int|48
comma
op_minus
l_int|40
comma
op_minus
l_int|32
comma
op_minus
l_int|24
comma
op_minus
l_int|16
comma
op_minus
l_int|8
comma
l_int|0
comma
l_int|32124
comma
l_int|31100
comma
l_int|30076
comma
l_int|29052
comma
l_int|28028
comma
l_int|27004
comma
l_int|25980
comma
l_int|24956
comma
l_int|23932
comma
l_int|22908
comma
l_int|21884
comma
l_int|20860
comma
l_int|19836
comma
l_int|18812
comma
l_int|17788
comma
l_int|16764
comma
l_int|15996
comma
l_int|15484
comma
l_int|14972
comma
l_int|14460
comma
l_int|13948
comma
l_int|13436
comma
l_int|12924
comma
l_int|12412
comma
l_int|11900
comma
l_int|11388
comma
l_int|10876
comma
l_int|10364
comma
l_int|9852
comma
l_int|9340
comma
l_int|8828
comma
l_int|8316
comma
l_int|7932
comma
l_int|7676
comma
l_int|7420
comma
l_int|7164
comma
l_int|6908
comma
l_int|6652
comma
l_int|6396
comma
l_int|6140
comma
l_int|5884
comma
l_int|5628
comma
l_int|5372
comma
l_int|5116
comma
l_int|4860
comma
l_int|4604
comma
l_int|4348
comma
l_int|4092
comma
l_int|3900
comma
l_int|3772
comma
l_int|3644
comma
l_int|3516
comma
l_int|3388
comma
l_int|3260
comma
l_int|3132
comma
l_int|3004
comma
l_int|2876
comma
l_int|2748
comma
l_int|2620
comma
l_int|2492
comma
l_int|2364
comma
l_int|2236
comma
l_int|2108
comma
l_int|1980
comma
l_int|1884
comma
l_int|1820
comma
l_int|1756
comma
l_int|1692
comma
l_int|1628
comma
l_int|1564
comma
l_int|1500
comma
l_int|1436
comma
l_int|1372
comma
l_int|1308
comma
l_int|1244
comma
l_int|1180
comma
l_int|1116
comma
l_int|1052
comma
l_int|988
comma
l_int|924
comma
l_int|876
comma
l_int|844
comma
l_int|812
comma
l_int|780
comma
l_int|748
comma
l_int|716
comma
l_int|684
comma
l_int|652
comma
l_int|620
comma
l_int|588
comma
l_int|556
comma
l_int|524
comma
l_int|492
comma
l_int|460
comma
l_int|428
comma
l_int|396
comma
l_int|372
comma
l_int|356
comma
l_int|340
comma
l_int|324
comma
l_int|308
comma
l_int|292
comma
l_int|276
comma
l_int|260
comma
l_int|244
comma
l_int|228
comma
l_int|212
comma
l_int|196
comma
l_int|180
comma
l_int|164
comma
l_int|148
comma
l_int|132
comma
l_int|120
comma
l_int|112
comma
l_int|104
comma
l_int|96
comma
l_int|88
comma
l_int|80
comma
l_int|72
comma
l_int|64
comma
l_int|56
comma
l_int|48
comma
l_int|40
comma
l_int|32
comma
l_int|24
comma
l_int|16
comma
l_int|8
comma
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* 16 bit A-law */
DECL|variable|alaw2dma16
r_static
r_char
id|alaw2dma16
(braket
)braket
op_assign
(brace
op_minus
l_int|5504
comma
op_minus
l_int|5248
comma
op_minus
l_int|6016
comma
op_minus
l_int|5760
comma
op_minus
l_int|4480
comma
op_minus
l_int|4224
comma
op_minus
l_int|4992
comma
op_minus
l_int|4736
comma
op_minus
l_int|7552
comma
op_minus
l_int|7296
comma
op_minus
l_int|8064
comma
op_minus
l_int|7808
comma
op_minus
l_int|6528
comma
op_minus
l_int|6272
comma
op_minus
l_int|7040
comma
op_minus
l_int|6784
comma
op_minus
l_int|2752
comma
op_minus
l_int|2624
comma
op_minus
l_int|3008
comma
op_minus
l_int|2880
comma
op_minus
l_int|2240
comma
op_minus
l_int|2112
comma
op_minus
l_int|2496
comma
op_minus
l_int|2368
comma
op_minus
l_int|3776
comma
op_minus
l_int|3648
comma
op_minus
l_int|4032
comma
op_minus
l_int|3904
comma
op_minus
l_int|3264
comma
op_minus
l_int|3136
comma
op_minus
l_int|3520
comma
op_minus
l_int|3392
comma
op_minus
l_int|22016
comma
op_minus
l_int|20992
comma
op_minus
l_int|24064
comma
op_minus
l_int|23040
comma
op_minus
l_int|17920
comma
op_minus
l_int|16896
comma
op_minus
l_int|19968
comma
op_minus
l_int|18944
comma
op_minus
l_int|30208
comma
op_minus
l_int|29184
comma
op_minus
l_int|32256
comma
op_minus
l_int|31232
comma
op_minus
l_int|26112
comma
op_minus
l_int|25088
comma
op_minus
l_int|28160
comma
op_minus
l_int|27136
comma
op_minus
l_int|11008
comma
op_minus
l_int|10496
comma
op_minus
l_int|12032
comma
op_minus
l_int|11520
comma
op_minus
l_int|8960
comma
op_minus
l_int|8448
comma
op_minus
l_int|9984
comma
op_minus
l_int|9472
comma
op_minus
l_int|15104
comma
op_minus
l_int|14592
comma
op_minus
l_int|16128
comma
op_minus
l_int|15616
comma
op_minus
l_int|13056
comma
op_minus
l_int|12544
comma
op_minus
l_int|14080
comma
op_minus
l_int|13568
comma
op_minus
l_int|344
comma
op_minus
l_int|328
comma
op_minus
l_int|376
comma
op_minus
l_int|360
comma
op_minus
l_int|280
comma
op_minus
l_int|264
comma
op_minus
l_int|312
comma
op_minus
l_int|296
comma
op_minus
l_int|472
comma
op_minus
l_int|456
comma
op_minus
l_int|504
comma
op_minus
l_int|488
comma
op_minus
l_int|408
comma
op_minus
l_int|392
comma
op_minus
l_int|440
comma
op_minus
l_int|424
comma
op_minus
l_int|88
comma
op_minus
l_int|72
comma
op_minus
l_int|120
comma
op_minus
l_int|104
comma
op_minus
l_int|24
comma
op_minus
l_int|8
comma
op_minus
l_int|56
comma
op_minus
l_int|40
comma
op_minus
l_int|216
comma
op_minus
l_int|200
comma
op_minus
l_int|248
comma
op_minus
l_int|232
comma
op_minus
l_int|152
comma
op_minus
l_int|136
comma
op_minus
l_int|184
comma
op_minus
l_int|168
comma
op_minus
l_int|1376
comma
op_minus
l_int|1312
comma
op_minus
l_int|1504
comma
op_minus
l_int|1440
comma
op_minus
l_int|1120
comma
op_minus
l_int|1056
comma
op_minus
l_int|1248
comma
op_minus
l_int|1184
comma
op_minus
l_int|1888
comma
op_minus
l_int|1824
comma
op_minus
l_int|2016
comma
op_minus
l_int|1952
comma
op_minus
l_int|1632
comma
op_minus
l_int|1568
comma
op_minus
l_int|1760
comma
op_minus
l_int|1696
comma
op_minus
l_int|688
comma
op_minus
l_int|656
comma
op_minus
l_int|752
comma
op_minus
l_int|720
comma
op_minus
l_int|560
comma
op_minus
l_int|528
comma
op_minus
l_int|624
comma
op_minus
l_int|592
comma
op_minus
l_int|944
comma
op_minus
l_int|912
comma
op_minus
l_int|1008
comma
op_minus
l_int|976
comma
op_minus
l_int|816
comma
op_minus
l_int|784
comma
op_minus
l_int|880
comma
op_minus
l_int|848
comma
l_int|5504
comma
l_int|5248
comma
l_int|6016
comma
l_int|5760
comma
l_int|4480
comma
l_int|4224
comma
l_int|4992
comma
l_int|4736
comma
l_int|7552
comma
l_int|7296
comma
l_int|8064
comma
l_int|7808
comma
l_int|6528
comma
l_int|6272
comma
l_int|7040
comma
l_int|6784
comma
l_int|2752
comma
l_int|2624
comma
l_int|3008
comma
l_int|2880
comma
l_int|2240
comma
l_int|2112
comma
l_int|2496
comma
l_int|2368
comma
l_int|3776
comma
l_int|3648
comma
l_int|4032
comma
l_int|3904
comma
l_int|3264
comma
l_int|3136
comma
l_int|3520
comma
l_int|3392
comma
l_int|22016
comma
l_int|20992
comma
l_int|24064
comma
l_int|23040
comma
l_int|17920
comma
l_int|16896
comma
l_int|19968
comma
l_int|18944
comma
l_int|30208
comma
l_int|29184
comma
l_int|32256
comma
l_int|31232
comma
l_int|26112
comma
l_int|25088
comma
l_int|28160
comma
l_int|27136
comma
l_int|11008
comma
l_int|10496
comma
l_int|12032
comma
l_int|11520
comma
l_int|8960
comma
l_int|8448
comma
l_int|9984
comma
l_int|9472
comma
l_int|15104
comma
l_int|14592
comma
l_int|16128
comma
l_int|15616
comma
l_int|13056
comma
l_int|12544
comma
l_int|14080
comma
l_int|13568
comma
l_int|344
comma
l_int|328
comma
l_int|376
comma
l_int|360
comma
l_int|280
comma
l_int|264
comma
l_int|312
comma
l_int|296
comma
l_int|472
comma
l_int|456
comma
l_int|504
comma
l_int|488
comma
l_int|408
comma
l_int|392
comma
l_int|440
comma
l_int|424
comma
l_int|88
comma
l_int|72
comma
l_int|120
comma
l_int|104
comma
l_int|24
comma
l_int|8
comma
l_int|56
comma
l_int|40
comma
l_int|216
comma
l_int|200
comma
l_int|248
comma
l_int|232
comma
l_int|152
comma
l_int|136
comma
l_int|184
comma
l_int|168
comma
l_int|1376
comma
l_int|1312
comma
l_int|1504
comma
l_int|1440
comma
l_int|1120
comma
l_int|1056
comma
l_int|1248
comma
l_int|1184
comma
l_int|1888
comma
l_int|1824
comma
l_int|2016
comma
l_int|1952
comma
l_int|1632
comma
l_int|1568
comma
l_int|1760
comma
l_int|1696
comma
l_int|688
comma
l_int|656
comma
l_int|752
comma
l_int|720
comma
l_int|560
comma
l_int|528
comma
l_int|624
comma
l_int|592
comma
l_int|944
comma
l_int|912
comma
l_int|1008
comma
l_int|976
comma
l_int|816
comma
l_int|784
comma
l_int|880
comma
l_int|848
comma
)brace
suffix:semicolon
macro_line|#endif /* HAS_16BIT_TABLES */
macro_line|#ifdef HAS_14BIT_TABLES
multiline_comment|/* 14 bit mu-law (LSB) */
DECL|variable|alaw2dma14l
r_static
r_char
id|alaw2dma14l
(braket
)braket
op_assign
(brace
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|41
comma
l_int|57
comma
l_int|9
comma
l_int|25
comma
l_int|41
comma
l_int|57
comma
l_int|9
comma
l_int|25
comma
l_int|41
comma
l_int|57
comma
l_int|9
comma
l_int|25
comma
l_int|41
comma
l_int|57
comma
l_int|9
comma
l_int|25
comma
l_int|37
comma
l_int|45
comma
l_int|53
comma
l_int|61
comma
l_int|5
comma
l_int|13
comma
l_int|21
comma
l_int|29
comma
l_int|37
comma
l_int|45
comma
l_int|53
comma
l_int|61
comma
l_int|5
comma
l_int|13
comma
l_int|21
comma
l_int|29
comma
l_int|35
comma
l_int|39
comma
l_int|43
comma
l_int|47
comma
l_int|51
comma
l_int|55
comma
l_int|59
comma
l_int|63
comma
l_int|3
comma
l_int|7
comma
l_int|11
comma
l_int|15
comma
l_int|19
comma
l_int|23
comma
l_int|27
comma
l_int|31
comma
l_int|34
comma
l_int|36
comma
l_int|38
comma
l_int|40
comma
l_int|42
comma
l_int|44
comma
l_int|46
comma
l_int|48
comma
l_int|50
comma
l_int|52
comma
l_int|54
comma
l_int|56
comma
l_int|58
comma
l_int|60
comma
l_int|62
comma
l_int|0
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|23
comma
l_int|7
comma
l_int|55
comma
l_int|39
comma
l_int|23
comma
l_int|7
comma
l_int|55
comma
l_int|39
comma
l_int|23
comma
l_int|7
comma
l_int|55
comma
l_int|39
comma
l_int|23
comma
l_int|7
comma
l_int|55
comma
l_int|39
comma
l_int|27
comma
l_int|19
comma
l_int|11
comma
l_int|3
comma
l_int|59
comma
l_int|51
comma
l_int|43
comma
l_int|35
comma
l_int|27
comma
l_int|19
comma
l_int|11
comma
l_int|3
comma
l_int|59
comma
l_int|51
comma
l_int|43
comma
l_int|35
comma
l_int|29
comma
l_int|25
comma
l_int|21
comma
l_int|17
comma
l_int|13
comma
l_int|9
comma
l_int|5
comma
l_int|1
comma
l_int|61
comma
l_int|57
comma
l_int|53
comma
l_int|49
comma
l_int|45
comma
l_int|41
comma
l_int|37
comma
l_int|33
comma
l_int|30
comma
l_int|28
comma
l_int|26
comma
l_int|24
comma
l_int|22
comma
l_int|20
comma
l_int|18
comma
l_int|16
comma
l_int|14
comma
l_int|12
comma
l_int|10
comma
l_int|8
comma
l_int|6
comma
l_int|4
comma
l_int|2
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* 14 bit A-law (LSB) */
DECL|variable|alaw2dma14l
r_static
r_char
id|alaw2dma14l
(braket
)braket
op_assign
(brace
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|42
comma
l_int|46
comma
l_int|34
comma
l_int|38
comma
l_int|58
comma
l_int|62
comma
l_int|50
comma
l_int|54
comma
l_int|10
comma
l_int|14
comma
l_int|2
comma
l_int|6
comma
l_int|26
comma
l_int|30
comma
l_int|18
comma
l_int|22
comma
l_int|42
comma
l_int|46
comma
l_int|34
comma
l_int|38
comma
l_int|58
comma
l_int|62
comma
l_int|50
comma
l_int|54
comma
l_int|10
comma
l_int|14
comma
l_int|2
comma
l_int|6
comma
l_int|26
comma
l_int|30
comma
l_int|18
comma
l_int|22
comma
l_int|40
comma
l_int|56
comma
l_int|8
comma
l_int|24
comma
l_int|40
comma
l_int|56
comma
l_int|8
comma
l_int|24
comma
l_int|40
comma
l_int|56
comma
l_int|8
comma
l_int|24
comma
l_int|40
comma
l_int|56
comma
l_int|8
comma
l_int|24
comma
l_int|20
comma
l_int|28
comma
l_int|4
comma
l_int|12
comma
l_int|52
comma
l_int|60
comma
l_int|36
comma
l_int|44
comma
l_int|20
comma
l_int|28
comma
l_int|4
comma
l_int|12
comma
l_int|52
comma
l_int|60
comma
l_int|36
comma
l_int|44
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|22
comma
l_int|18
comma
l_int|30
comma
l_int|26
comma
l_int|6
comma
l_int|2
comma
l_int|14
comma
l_int|10
comma
l_int|54
comma
l_int|50
comma
l_int|62
comma
l_int|58
comma
l_int|38
comma
l_int|34
comma
l_int|46
comma
l_int|42
comma
l_int|22
comma
l_int|18
comma
l_int|30
comma
l_int|26
comma
l_int|6
comma
l_int|2
comma
l_int|14
comma
l_int|10
comma
l_int|54
comma
l_int|50
comma
l_int|62
comma
l_int|58
comma
l_int|38
comma
l_int|34
comma
l_int|46
comma
l_int|42
comma
l_int|24
comma
l_int|8
comma
l_int|56
comma
l_int|40
comma
l_int|24
comma
l_int|8
comma
l_int|56
comma
l_int|40
comma
l_int|24
comma
l_int|8
comma
l_int|56
comma
l_int|40
comma
l_int|24
comma
l_int|8
comma
l_int|56
comma
l_int|40
comma
l_int|44
comma
l_int|36
comma
l_int|60
comma
l_int|52
comma
l_int|12
comma
l_int|4
comma
l_int|28
comma
l_int|20
comma
l_int|44
comma
l_int|36
comma
l_int|60
comma
l_int|52
comma
l_int|12
comma
l_int|4
comma
l_int|28
comma
l_int|20
)brace
suffix:semicolon
macro_line|#endif /* HAS_14BIT_TABLES */
multiline_comment|/*** Translations ************************************************************/
macro_line|#ifdef CONFIG_ATARI
r_static
r_int
id|ata_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ct_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ct_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ct_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ct_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ctx_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ctx_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ctx_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ctx_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ctx_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ctx_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ata_ctx_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_static
r_int
id|ami_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ami_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ami_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ami_ct_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ami_ct_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ami_ct_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
r_static
r_int
id|ami_ct_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
multiline_comment|/*** Machine definitions *****************************************************/
r_typedef
r_struct
(brace
DECL|member|type
r_int
id|type
suffix:semicolon
DECL|member|dma_alloc
r_void
op_star
(paren
op_star
id|dma_alloc
)paren
(paren
r_int
r_int
comma
r_int
)paren
suffix:semicolon
DECL|member|dma_free
r_void
(paren
op_star
id|dma_free
)paren
(paren
r_void
op_star
comma
r_int
r_int
)paren
suffix:semicolon
DECL|member|irqinit
r_int
(paren
op_star
id|irqinit
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|member|init
r_void
(paren
op_star
id|init
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|member|silence
r_void
(paren
op_star
id|silence
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|member|setFormat
r_int
(paren
op_star
id|setFormat
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|member|setVolume
r_int
(paren
op_star
id|setVolume
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|member|setBass
r_int
(paren
op_star
id|setBass
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|member|setTreble
r_int
(paren
op_star
id|setTreble
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|member|play
r_void
(paren
op_star
id|play
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|typedef|MACHINE
)brace
id|MACHINE
suffix:semicolon
multiline_comment|/*** Low level stuff *********************************************************/
r_typedef
r_struct
(brace
DECL|member|format
r_int
id|format
suffix:semicolon
multiline_comment|/* AFMT_* */
DECL|member|stereo
r_int
id|stereo
suffix:semicolon
multiline_comment|/* 0 = mono, 1 = stereo */
DECL|member|size
r_int
id|size
suffix:semicolon
multiline_comment|/* 8/16 bit*/
DECL|member|speed
r_int
id|speed
suffix:semicolon
multiline_comment|/* speed */
DECL|typedef|SETTINGS
)brace
id|SETTINGS
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|ct_ulaw
r_int
(paren
op_star
id|ct_ulaw
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
r_int
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|ct_alaw
r_int
(paren
op_star
id|ct_alaw
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
r_int
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|ct_s8
r_int
(paren
op_star
id|ct_s8
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
r_int
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|ct_u8
r_int
(paren
op_star
id|ct_u8
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
r_int
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|ct_s16be
r_int
(paren
op_star
id|ct_s16be
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
r_int
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|ct_u16be
r_int
(paren
op_star
id|ct_u16be
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
r_int
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|ct_s16le
r_int
(paren
op_star
id|ct_s16le
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
r_int
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|ct_u16le
r_int
(paren
op_star
id|ct_u16le
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
r_int
op_star
comma
r_int
)paren
suffix:semicolon
DECL|typedef|TRANS
)brace
id|TRANS
suffix:semicolon
DECL|struct|sound_settings
r_struct
id|sound_settings
(brace
DECL|member|mach
id|MACHINE
id|mach
suffix:semicolon
multiline_comment|/* machine dependent things */
DECL|member|hard
id|SETTINGS
id|hard
suffix:semicolon
multiline_comment|/* hardware settings */
DECL|member|soft
id|SETTINGS
id|soft
suffix:semicolon
multiline_comment|/* software settings */
DECL|member|dsp
id|SETTINGS
id|dsp
suffix:semicolon
multiline_comment|/* /dev/dsp default settings */
DECL|member|trans
id|TRANS
op_star
id|trans
suffix:semicolon
multiline_comment|/* supported translations */
DECL|member|volume_left
r_int
id|volume_left
suffix:semicolon
multiline_comment|/* volume (range is machine dependent) */
DECL|member|volume_right
r_int
id|volume_right
suffix:semicolon
DECL|member|bass
r_int
id|bass
suffix:semicolon
multiline_comment|/* tone (range is machine dependent) */
DECL|member|treble
r_int
id|treble
suffix:semicolon
DECL|member|minDev
r_int
id|minDev
suffix:semicolon
multiline_comment|/* minor device number currently open */
macro_line|#ifdef CONFIG_ATARI
DECL|member|bal
r_int
id|bal
suffix:semicolon
multiline_comment|/* balance factor for expanding (not volume!) */
DECL|member|data
id|u_long
id|data
suffix:semicolon
multiline_comment|/* data for expanding */
macro_line|#endif /* CONFIG_ATARI */
)brace
suffix:semicolon
DECL|variable|sound
r_static
r_struct
id|sound_settings
id|sound
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
r_static
r_void
op_star
id|AtaAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
suffix:semicolon
r_static
r_void
id|AtaFree
c_func
(paren
r_void
op_star
comma
r_int
r_int
id|size
)paren
suffix:semicolon
r_static
r_int
id|AtaIrqInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|AtaSetBass
c_func
(paren
r_int
id|bass
)paren
suffix:semicolon
r_static
r_int
id|AtaSetTreble
c_func
(paren
r_int
id|treble
)paren
suffix:semicolon
r_static
r_void
id|TTSilence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|TTInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|TTSetFormat
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|TTSetVolume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
r_static
r_void
id|FalconSilence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|FalconInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|FalconSetFormat
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|FalconSetVolume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
r_static
r_void
id|ata_sq_play_next_frame
c_func
(paren
r_int
id|index
)paren
suffix:semicolon
r_static
r_void
id|AtaPlay
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ata_sq_interrupt
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|fp
comma
r_void
op_star
id|dummy
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_static
r_void
op_star
id|AmiAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
suffix:semicolon
r_static
r_void
id|AmiFree
c_func
(paren
r_void
op_star
comma
r_int
r_int
)paren
suffix:semicolon
r_static
r_int
id|AmiIrqInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|AmiSilence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|AmiInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|AmiSetFormat
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|AmiSetVolume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
r_static
r_int
id|AmiSetTreble
c_func
(paren
r_int
id|treble
)paren
suffix:semicolon
r_static
r_void
id|ami_sq_play_next_frame
c_func
(paren
r_int
id|index
)paren
suffix:semicolon
r_static
r_void
id|AmiPlay
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ami_sq_interrupt
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|fp
comma
r_void
op_star
id|dummy
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
multiline_comment|/*** Mid level stuff *********************************************************/
r_static
r_void
id|sound_silence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|sound_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|sound_set_format
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|sound_set_speed
c_func
(paren
r_int
id|speed
)paren
suffix:semicolon
r_static
r_int
id|sound_set_stereo
c_func
(paren
r_int
id|stereo
)paren
suffix:semicolon
r_static
r_int
id|sound_set_volume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
r_static
r_int
id|sound_set_bass
c_func
(paren
r_int
id|bass
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
r_static
r_int
id|sound_set_treble
c_func
(paren
r_int
id|treble
)paren
suffix:semicolon
r_static
r_int
id|sound_copy_translate
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
suffix:semicolon
multiline_comment|/*&n; * /dev/mixer abstraction&n; */
DECL|struct|sound_mixer
r_struct
id|sound_mixer
(brace
DECL|member|busy
r_int
id|busy
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|mixer
r_static
r_struct
id|sound_mixer
id|mixer
suffix:semicolon
r_static
r_void
id|mixer_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|mixer_open
c_func
(paren
r_int
id|open_mode
)paren
suffix:semicolon
r_static
r_int
id|mixer_release
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|mixer_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
suffix:semicolon
multiline_comment|/*&n; * Sound queue stuff, the heart of the driver&n; */
DECL|struct|sound_queue
r_struct
id|sound_queue
(brace
DECL|member|max_count
DECL|member|block_size
r_int
id|max_count
comma
id|block_size
suffix:semicolon
DECL|member|buffers
r_char
op_star
op_star
id|buffers
suffix:semicolon
multiline_comment|/* it shouldn&squot;t be necessary to declare any of these volatile */
DECL|member|front
DECL|member|rear
DECL|member|count
r_int
id|front
comma
id|rear
comma
id|count
suffix:semicolon
DECL|member|rear_size
r_int
id|rear_size
suffix:semicolon
multiline_comment|/*&n;     *&t;The use of the playing field depends on the hardware&n;     *&n;     *&t;Atari: The number of frames that are loaded/playing&n;     *&n;     *&t;Amiga: Bit 0 is set: a frame is loaded&n;     *&t;       Bit 1 is set: a frame is playing&n;     */
DECL|member|playing
r_int
id|playing
suffix:semicolon
DECL|member|write_queue
DECL|member|open_queue
DECL|member|sync_queue
r_struct
id|wait_queue
op_star
id|write_queue
comma
op_star
id|open_queue
comma
op_star
id|sync_queue
suffix:semicolon
DECL|member|open_mode
r_int
id|open_mode
suffix:semicolon
DECL|member|busy
DECL|member|syncing
r_int
id|busy
comma
id|syncing
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
DECL|member|ignore_int
r_int
id|ignore_int
suffix:semicolon
multiline_comment|/* ++TeSche: used for Falcon */
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
DECL|member|block_size_half
DECL|member|block_size_quarter
r_int
id|block_size_half
comma
id|block_size_quarter
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
suffix:semicolon
DECL|variable|sq
r_static
r_struct
id|sound_queue
id|sq
suffix:semicolon
DECL|macro|sq_block_address
mdefine_line|#define sq_block_address(i)&t;(sq.buffers[i])
DECL|macro|SIGNAL_RECEIVED
mdefine_line|#define SIGNAL_RECEIVED&t;(current-&gt;signal &amp; ~current-&gt;blocked)
DECL|macro|NON_BLOCKING
mdefine_line|#define NON_BLOCKING(open_mode)&t;(open_mode &amp; O_NONBLOCK)
DECL|macro|ONE_SECOND
mdefine_line|#define ONE_SECOND&t;HZ&t;/* in jiffies (100ths of a second) */
DECL|macro|NO_TIME_LIMIT
mdefine_line|#define NO_TIME_LIMIT&t;0xffffffff
DECL|macro|SLEEP
mdefine_line|#define SLEEP(queue, time_limit) &bslash;&n;&t;current-&gt;timeout = jiffies+(time_limit); &bslash;&n;&t;interruptible_sleep_on(&amp;queue);
DECL|macro|WAKE_UP
mdefine_line|#define WAKE_UP(queue)&t;(wake_up_interruptible(&amp;queue))
r_static
r_void
id|sq_init
c_func
(paren
r_int
id|numBufs
comma
r_int
id|bufSize
comma
r_char
op_star
op_star
id|buffers
)paren
suffix:semicolon
r_static
r_void
id|sq_play
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|sq_write
c_func
(paren
r_const
r_char
op_star
id|src
comma
r_int
id|uLeft
)paren
suffix:semicolon
r_static
r_int
id|sq_open
c_func
(paren
r_int
id|open_mode
)paren
suffix:semicolon
r_static
r_void
id|sq_reset
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|sq_sync
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|sq_release
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; * /dev/sndstat&n; */
DECL|struct|sound_state
r_struct
id|sound_state
(brace
DECL|member|busy
r_int
id|busy
suffix:semicolon
DECL|member|buf
r_char
id|buf
(braket
l_int|512
)braket
suffix:semicolon
DECL|member|len
DECL|member|ptr
r_int
id|len
comma
id|ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|state
r_static
r_struct
id|sound_state
id|state
suffix:semicolon
r_static
r_void
id|state_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|state_open
c_func
(paren
r_int
id|open_mode
)paren
suffix:semicolon
r_static
r_int
id|state_release
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|state_read
c_func
(paren
r_char
op_star
id|dest
comma
r_int
id|count
)paren
suffix:semicolon
multiline_comment|/*** High level stuff ********************************************************/
r_static
r_int
id|sound_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|sound_fsync
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
suffix:semicolon
r_static
r_void
id|sound_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|sound_lseek
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|off_t
id|offset
comma
r_int
id|orig
)paren
suffix:semicolon
r_static
r_int
id|sound_read
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|sound_write
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|ioctl_return
c_func
(paren
r_int
op_star
id|addr
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_int
id|unknown_minor_dev
c_func
(paren
r_char
op_star
id|fname
comma
r_int
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sound_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
suffix:semicolon
multiline_comment|/*** Config &amp; Setup **********************************************************/
r_void
id|soundcard_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|dmasound_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
suffix:semicolon
r_void
id|sound_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
suffix:semicolon
multiline_comment|/* ++Martin: stub for now */
multiline_comment|/*** Translations ************************************************************/
multiline_comment|/* ++TeSche: radically changed for new expanding purposes...&n; *&n; * These two routines now deal with copying/expanding/translating the samples&n; * from user space into our buffer at the right frequency. They take care about&n; * how much data there&squot;s actually to read, how much buffer space there is and&n; * to convert samples into the right frequency/encoding. They will only work on&n; * complete samples so it may happen they leave some bytes in the input stream&n; * if the user didn&squot;t write a multiple of the current sample size. They both&n; * return the number of bytes they&squot;ve used from both streams so you may detect&n; * such a situation. Luckily all programs should be able to cope with that.&n; *&n; * I think I&squot;ve optimized anything as far as one can do in plain C, all&n; * variables should fit in registers and the loops are really short. There&squot;s&n; * one loop for every possible situation. Writing a more generalized and thus&n; * parameterized loop would only produce slower code. Feel free to optimize&n; * this in assembler if you like. :)&n; *&n; * I think these routines belong here because they&squot;re not yet really hardware&n; * independent, especially the fact that the Falcon can play 16bit samples&n; * only in stereo is hardcoded in both of them!&n; *&n; * ++geert: split in even more functions (one per format)&n; */
macro_line|#ifdef CONFIG_ATARI
DECL|function|ata_ct_law
r_static
r_int
id|ata_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_char
op_star
id|table
op_assign
id|sound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|ulaw2dma8
suffix:colon
id|alaw2dma8
suffix:semicolon
r_int
id|count
comma
id|used
suffix:semicolon
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound.soft.stereo
)paren
id|count
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|table
(braket
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
)braket
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_s8
r_static
r_int
id|ata_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
r_void
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound.soft.stereo
)paren
id|count
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
id|copy_from_user
c_func
(paren
id|p
comma
id|userPtr
comma
id|count
)paren
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_u8
r_static
r_int
id|ata_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
op_xor
l_int|0x80
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
op_xor
l_int|0x8080
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_s16be
r_static
r_int
id|ata_ct_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
r_void
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
id|copy_from_user
c_func
(paren
id|p
comma
id|userPtr
comma
id|count
)paren
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_u16be
r_static
r_int
id|ata_ct_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
op_xor
l_int|0x80008000
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_s16le
r_static
r_int
id|ata_ct_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
id|u_long
id|data
suffix:semicolon
id|count
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_u16le
r_static
r_int
id|ata_ct_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
id|u_long
id|data
suffix:semicolon
id|count
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
op_xor
l_int|0x80008000
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_law
r_static
r_int
id|ata_ctx_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_char
op_star
id|table
op_assign
id|sound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|ulaw2dma8
suffix:colon
id|alaw2dma8
suffix:semicolon
multiline_comment|/* this should help gcc to stuff everything into registers */
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|userCount
)paren
r_break
suffix:semicolon
id|data
op_assign
id|table
(braket
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
)braket
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
id|data
op_assign
id|table
(braket
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
)braket
op_lshift
l_int|8
suffix:semicolon
id|data
op_or_assign
id|table
(braket
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
)braket
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_s8
r_static
r_int
id|ata_ctx_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|userCount
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_u8
r_static
r_int
id|ata_ctx_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|userCount
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
op_xor
l_int|0x80
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
op_xor
l_int|0x8080
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_s16be
r_static
r_int
id|ata_ctx_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_u16be
r_static
r_int
id|ata_ctx_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
op_xor
l_int|0x8000
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
op_xor
l_int|0x80008000
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_s16le
r_static
r_int
id|ata_ctx_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_u16le
r_static
r_int
id|ata_ctx_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
op_xor
l_int|0x80008000
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
DECL|function|ami_ct_law
r_static
r_int
id|ami_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_char
op_star
id|table
op_assign
id|sound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|ulaw2dma8
suffix:colon
id|alaw2dma8
suffix:semicolon
r_int
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|table
(braket
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
)braket
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|left
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|right
op_assign
id|left
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
op_star
id|left
op_increment
op_assign
id|table
(braket
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
)braket
suffix:semicolon
op_star
id|right
op_increment
op_assign
id|table
(braket
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
)braket
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_s8
r_static
r_int
id|ami_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
r_void
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
id|copy_from_user
c_func
(paren
id|p
comma
id|userPtr
comma
id|count
)paren
suffix:semicolon
)brace
r_else
(brace
id|u_char
op_star
id|left
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|right
op_assign
id|left
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
op_star
id|left
op_increment
op_assign
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
suffix:semicolon
op_star
id|right
op_increment
op_assign
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_u8
r_static
r_int
id|ami_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
r_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
op_xor
l_int|0x80
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|left
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|right
op_assign
id|left
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
op_star
id|left
op_increment
op_assign
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
op_xor
l_int|0x80
suffix:semicolon
op_star
id|right
op_increment
op_assign
id|get_user
c_func
(paren
id|userPtr
op_increment
)paren
op_xor
l_int|0x80
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_s16be
r_static
r_int
id|ami_ct_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|high
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|low
op_assign
id|high
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
op_star
id|high
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|low
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|lefth
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|2
)braket
suffix:semicolon
id|u_char
op_star
id|leftl
op_assign
id|lefth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|u_char
op_star
id|righth
op_assign
id|lefth
op_plus
id|sq.block_size_half
suffix:semicolon
id|u_char
op_star
id|rightl
op_assign
id|righth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
op_star
id|lefth
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|leftl
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
op_star
id|righth
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|rightl
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_u16be
r_static
r_int
id|ami_ct_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|high
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|low
op_assign
id|high
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|high
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|low
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|lefth
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|2
)braket
suffix:semicolon
id|u_char
op_star
id|leftl
op_assign
id|lefth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|u_char
op_star
id|righth
op_assign
id|lefth
op_plus
id|sq.block_size_half
suffix:semicolon
id|u_char
op_star
id|rightl
op_assign
id|righth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|lefth
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|leftl
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|righth
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|rightl
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_s16le
r_static
r_int
id|ami_ct_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|high
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|low
op_assign
id|high
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|high
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|low
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|lefth
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|2
)braket
suffix:semicolon
id|u_char
op_star
id|leftl
op_assign
id|lefth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|u_char
op_star
id|righth
op_assign
id|lefth
op_plus
id|sq.block_size_half
suffix:semicolon
id|u_char
op_star
id|rightl
op_assign
id|righth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|lefth
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|leftl
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|righth
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|rightl
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_u16le
r_static
r_int
id|ami_ct_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
id|count
comma
id|used
suffix:semicolon
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|high
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|low
op_assign
id|high
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|high
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|low
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|lefth
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|2
)braket
suffix:semicolon
id|u_char
op_star
id|leftl
op_assign
id|lefth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|u_char
op_star
id|righth
op_assign
id|lefth
op_plus
id|sq.block_size_half
suffix:semicolon
id|u_char
op_star
id|rightl
op_assign
id|righth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|lefth
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|leftl
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|data
op_assign
id|get_user
c_func
(paren
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|righth
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|rightl
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_ATARI
DECL|variable|transTTNormal
r_static
id|TRANS
id|transTTNormal
op_assign
(brace
id|ata_ct_law
comma
id|ata_ct_law
comma
id|ata_ct_s8
comma
id|ata_ct_u8
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|transTTExpanding
r_static
id|TRANS
id|transTTExpanding
op_assign
(brace
id|ata_ctx_law
comma
id|ata_ctx_law
comma
id|ata_ctx_s8
comma
id|ata_ctx_u8
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|transFalconNormal
r_static
id|TRANS
id|transFalconNormal
op_assign
(brace
id|ata_ct_law
comma
id|ata_ct_law
comma
id|ata_ct_s8
comma
id|ata_ct_u8
comma
id|ata_ct_s16be
comma
id|ata_ct_u16be
comma
id|ata_ct_s16le
comma
id|ata_ct_u16le
)brace
suffix:semicolon
DECL|variable|transFalconExpanding
r_static
id|TRANS
id|transFalconExpanding
op_assign
(brace
id|ata_ctx_law
comma
id|ata_ctx_law
comma
id|ata_ctx_s8
comma
id|ata_ctx_u8
comma
id|ata_ctx_s16be
comma
id|ata_ctx_u16be
comma
id|ata_ctx_s16le
comma
id|ata_ctx_u16le
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
DECL|variable|transAmiga
r_static
id|TRANS
id|transAmiga
op_assign
(brace
id|ami_ct_law
comma
id|ami_ct_law
comma
id|ami_ct_s8
comma
id|ami_ct_u8
comma
id|ami_ct_s16be
comma
id|ami_ct_u16be
comma
id|ami_ct_s16le
comma
id|ami_ct_u16le
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
multiline_comment|/*** Low level stuff *********************************************************/
macro_line|#ifdef CONFIG_ATARI
multiline_comment|/*&n; * Atari (TT/Falcon)&n; */
DECL|function|AtaAlloc
r_static
r_void
op_star
id|AtaAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_int
id|order
suffix:semicolon
r_int
r_int
id|a_size
suffix:semicolon
id|order
op_assign
l_int|0
suffix:semicolon
id|a_size
op_assign
id|PAGE_SIZE
suffix:semicolon
r_while
c_loop
(paren
id|a_size
OL
id|size
)paren
(brace
id|order
op_increment
suffix:semicolon
id|a_size
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_return
(paren
r_void
op_star
)paren
id|__get_dma_pages
c_func
(paren
id|flags
comma
id|order
)paren
suffix:semicolon
)brace
DECL|function|AtaFree
r_static
r_void
id|AtaFree
c_func
(paren
r_void
op_star
id|obj
comma
r_int
r_int
id|size
)paren
(brace
r_int
id|order
suffix:semicolon
r_int
r_int
id|a_size
suffix:semicolon
id|order
op_assign
l_int|0
suffix:semicolon
id|a_size
op_assign
id|PAGE_SIZE
suffix:semicolon
r_while
c_loop
(paren
id|a_size
OL
id|size
)paren
(brace
id|order
op_increment
suffix:semicolon
id|a_size
op_lshift_assign
l_int|1
suffix:semicolon
)brace
id|free_pages
(paren
(paren
r_int
r_int
)paren
id|obj
comma
id|order
)paren
suffix:semicolon
)brace
DECL|function|AtaIrqInit
r_static
r_int
id|AtaIrqInit
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Set up timer A. Timer A&n;    will receive a signal upon end of playing from the sound&n;    hardware. Furthermore Timer A is able to count events&n;    and will cause an interrupt after a programmed number&n;    of events. So all we need to keep the music playing is&n;    to provide the sound hardware with new data upon&n;    an interrupt from timer A. */
id|mfp.tim_ct_a
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ++roman: Stop timer before programming! */
id|mfp.tim_dt_a
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Cause interrupt after first event. */
id|mfp.tim_ct_a
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* Turn on event counting. */
multiline_comment|/* Register interrupt handler. */
id|add_isr
c_func
(paren
id|IRQ_MFP_TIMA
comma
id|ata_sq_interrupt
comma
id|IRQ_TYPE_SLOW
comma
l_int|NULL
comma
l_string|&quot;DMA sound&quot;
)paren
suffix:semicolon
id|mfp.int_en_a
op_or_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* Turn interrupt on. */
id|mfp.int_mk_a
op_or_assign
l_int|0x20
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|macro|TONE_VOXWARE_TO_DB
mdefine_line|#define TONE_VOXWARE_TO_DB(v) &bslash;&n;&t;(((v) &lt; 0) ? -12 : ((v) &gt; 100) ? 12 : ((v) - 50) * 6 / 25)
DECL|macro|TONE_DB_TO_VOXWARE
mdefine_line|#define TONE_DB_TO_VOXWARE(v) (((v) * 25 + ((v) &gt; 0 ? 5 : -5)) / 6 + 50)
DECL|function|AtaSetBass
r_static
r_int
id|AtaSetBass
c_func
(paren
r_int
id|bass
)paren
(brace
id|sound.bass
op_assign
id|TONE_VOXWARE_TO_DB
c_func
(paren
id|bass
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BASS
c_func
(paren
id|sound.bass
)paren
)paren
suffix:semicolon
r_return
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|sound.bass
)paren
suffix:semicolon
)brace
DECL|function|AtaSetTreble
r_static
r_int
id|AtaSetTreble
c_func
(paren
r_int
id|treble
)paren
(brace
id|sound.treble
op_assign
id|TONE_VOXWARE_TO_DB
c_func
(paren
id|treble
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_TREBLE
c_func
(paren
id|sound.treble
)paren
)paren
suffix:semicolon
r_return
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|sound.treble
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * TT&n; */
DECL|function|TTSilence
r_static
r_void
id|TTSilence
c_func
(paren
r_void
)paren
(brace
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_OFF
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_PSG_HIGH
)paren
suffix:semicolon
multiline_comment|/* mix in PSG signal 1:1 */
)brace
DECL|function|TTInit
r_static
r_void
id|TTInit
c_func
(paren
r_void
)paren
(brace
r_int
id|mode
comma
id|i
comma
id|idx
suffix:semicolon
r_const
r_int
id|freq
(braket
l_int|4
)braket
op_assign
(brace
l_int|50066
comma
l_int|25033
comma
l_int|12517
comma
l_int|6258
)brace
suffix:semicolon
multiline_comment|/* search a frequency that fits into the allowed error range */
id|idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|arraysize
c_func
(paren
id|freq
)paren
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* this isn&squot;t as much useful for a TT than for a Falcon, but&n;&t; * then it doesn&squot;t hurt very much to implement it for a TT too.&n;&t; */
r_if
c_cond
(paren
(paren
l_int|100
op_star
id|abs
c_func
(paren
id|sound.soft.speed
op_minus
id|freq
(braket
id|i
)braket
)paren
op_div
id|freq
(braket
id|i
)braket
)paren
OL
id|catchRadius
)paren
id|idx
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|idx
OG
op_minus
l_int|1
)paren
(brace
id|sound.soft.speed
op_assign
id|freq
(braket
id|idx
)braket
suffix:semicolon
id|sound.trans
op_assign
op_amp
id|transTTNormal
suffix:semicolon
)brace
r_else
id|sound.trans
op_assign
op_amp
id|transTTExpanding
suffix:semicolon
id|TTSilence
c_func
(paren
)paren
suffix:semicolon
id|sound.hard
op_assign
id|sound.soft
suffix:semicolon
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|50066
)paren
(brace
multiline_comment|/* we would need to squeeze the sound, but we won&squot;t do that */
id|sound.hard.speed
op_assign
l_int|50066
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_50KHZ
suffix:semicolon
id|sound.trans
op_assign
op_amp
id|transTTNormal
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|25033
)paren
(brace
id|sound.hard.speed
op_assign
l_int|50066
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_50KHZ
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|12517
)paren
(brace
id|sound.hard.speed
op_assign
l_int|25033
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_25KHZ
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|6258
)paren
(brace
id|sound.hard.speed
op_assign
l_int|12517
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_12KHZ
suffix:semicolon
)brace
r_else
(brace
id|sound.hard.speed
op_assign
l_int|6258
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_6KHZ
suffix:semicolon
)brace
id|tt_dmasnd.mode
op_assign
(paren
id|sound.hard.stereo
ques
c_cond
id|DMASND_MODE_STEREO
suffix:colon
id|DMASND_MODE_MONO
)paren
op_or
id|DMASND_MODE_8BIT
op_or
id|mode
suffix:semicolon
id|sound.bal
op_assign
op_minus
id|sound.soft.speed
suffix:semicolon
)brace
DECL|function|TTSetFormat
r_static
r_int
id|TTSetFormat
c_func
(paren
r_int
id|format
)paren
(brace
multiline_comment|/* TT sound DMA supports only 8bit modes */
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|AFMT_QUERY
suffix:colon
r_return
id|sound.soft.format
suffix:semicolon
r_case
id|AFMT_MU_LAW
suffix:colon
r_case
id|AFMT_A_LAW
suffix:colon
r_case
id|AFMT_S8
suffix:colon
r_case
id|AFMT_U8
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|format
op_assign
id|AFMT_S8
suffix:semicolon
)brace
id|sound.soft.format
op_assign
id|format
suffix:semicolon
id|sound.soft.size
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
(brace
id|sound.dsp.format
op_assign
id|format
suffix:semicolon
id|sound.dsp.size
op_assign
l_int|8
suffix:semicolon
)brace
id|TTInit
c_func
(paren
)paren
suffix:semicolon
r_return
id|format
suffix:semicolon
)brace
DECL|macro|VOLUME_VOXWARE_TO_DB
mdefine_line|#define VOLUME_VOXWARE_TO_DB(v) &bslash;&n;&t;(((v) &lt; 0) ? -40 : ((v) &gt; 100) ? 0 : ((v) * 2) / 5 - 40)
DECL|macro|VOLUME_DB_TO_VOXWARE
mdefine_line|#define VOLUME_DB_TO_VOXWARE(v) ((((v) + 40) * 5 + 1) / 2)
DECL|function|TTSetVolume
r_static
r_int
id|TTSetVolume
c_func
(paren
r_int
id|volume
)paren
(brace
id|sound.volume_left
op_assign
id|VOLUME_VOXWARE_TO_DB
c_func
(paren
id|volume
op_amp
l_int|0xff
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALLEFT
c_func
(paren
id|sound.volume_left
)paren
)paren
suffix:semicolon
id|sound.volume_right
op_assign
id|VOLUME_VOXWARE_TO_DB
c_func
(paren
(paren
id|volume
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALRIGHT
c_func
(paren
id|sound.volume_right
)paren
)paren
suffix:semicolon
r_return
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
(paren
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Falcon&n; */
DECL|function|FalconSilence
r_static
r_void
id|FalconSilence
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* stop playback, set sample rate 50kHz for PSG sound */
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_OFF
suffix:semicolon
id|tt_dmasnd.mode
op_assign
id|DMASND_MODE_50KHZ
op_or
id|DMASND_MODE_STEREO
op_or
id|DMASND_MODE_8BIT
suffix:semicolon
id|tt_dmasnd.int_div
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* STE compatible divider */
id|tt_dmasnd.int_ctrl
op_assign
l_int|0x0
suffix:semicolon
id|tt_dmasnd.cbar_src
op_assign
l_int|0x0000
suffix:semicolon
multiline_comment|/* no matrix inputs */
id|tt_dmasnd.cbar_dst
op_assign
l_int|0x0000
suffix:semicolon
multiline_comment|/* no matrix outputs */
id|tt_dmasnd.dac_src
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* connect ADC to DAC, disconnect matrix */
id|tt_dmasnd.adc_src
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* ADC Input = PSG */
)brace
DECL|function|FalconInit
r_static
r_void
id|FalconInit
c_func
(paren
r_void
)paren
(brace
r_int
id|divider
comma
id|i
comma
id|idx
suffix:semicolon
r_const
r_int
id|freq
(braket
l_int|8
)braket
op_assign
(brace
l_int|49170
comma
l_int|32780
comma
l_int|24585
comma
l_int|19668
comma
l_int|16390
comma
l_int|12292
comma
l_int|9834
comma
l_int|8195
)brace
suffix:semicolon
multiline_comment|/* search a frequency that fits into the allowed error range */
id|idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|arraysize
c_func
(paren
id|freq
)paren
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* if we will tolerate 3% error 8000Hz-&gt;8195Hz (2.38%) would&n;&t; * be playable without expanding, but that now a kernel runtime&n;&t; * option&n;&t; */
r_if
c_cond
(paren
(paren
l_int|100
op_star
id|abs
c_func
(paren
id|sound.soft.speed
op_minus
id|freq
(braket
id|i
)braket
)paren
op_div
id|freq
(braket
id|i
)braket
)paren
OL
id|catchRadius
)paren
id|idx
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|idx
OG
op_minus
l_int|1
)paren
(brace
id|sound.soft.speed
op_assign
id|freq
(braket
id|idx
)braket
suffix:semicolon
id|sound.trans
op_assign
op_amp
id|transFalconNormal
suffix:semicolon
)brace
r_else
id|sound.trans
op_assign
op_amp
id|transFalconExpanding
suffix:semicolon
id|FalconSilence
c_func
(paren
)paren
suffix:semicolon
id|sound.hard
op_assign
id|sound.soft
suffix:semicolon
r_if
c_cond
(paren
id|sound.hard.size
op_eq
l_int|16
)paren
(brace
multiline_comment|/* the Falcon can play 16bit samples only in stereo */
id|sound.hard.stereo
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|49170
)paren
(brace
multiline_comment|/* we would need to squeeze the sound, but we won&squot;t do that */
id|sound.hard.speed
op_assign
l_int|49170
suffix:semicolon
id|divider
op_assign
l_int|1
suffix:semicolon
id|sound.trans
op_assign
op_amp
id|transFalconNormal
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|32780
)paren
(brace
id|sound.hard.speed
op_assign
l_int|49170
suffix:semicolon
id|divider
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|24585
)paren
(brace
id|sound.hard.speed
op_assign
l_int|32780
suffix:semicolon
id|divider
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|19668
)paren
(brace
id|sound.hard.speed
op_assign
l_int|24585
suffix:semicolon
id|divider
op_assign
l_int|3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|16390
)paren
(brace
id|sound.hard.speed
op_assign
l_int|19668
suffix:semicolon
id|divider
op_assign
l_int|4
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|12292
)paren
(brace
id|sound.hard.speed
op_assign
l_int|16390
suffix:semicolon
id|divider
op_assign
l_int|5
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|9834
)paren
(brace
id|sound.hard.speed
op_assign
l_int|12292
suffix:semicolon
id|divider
op_assign
l_int|7
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|8195
)paren
(brace
id|sound.hard.speed
op_assign
l_int|9834
suffix:semicolon
id|divider
op_assign
l_int|9
suffix:semicolon
)brace
r_else
(brace
id|sound.hard.speed
op_assign
l_int|8195
suffix:semicolon
id|divider
op_assign
l_int|11
suffix:semicolon
)brace
id|tt_dmasnd.int_div
op_assign
id|divider
suffix:semicolon
multiline_comment|/* Setup Falcon sound DMA for playback */
id|tt_dmasnd.int_ctrl
op_assign
l_int|0x4
suffix:semicolon
multiline_comment|/* Timer A int at play end */
id|tt_dmasnd.track_select
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* play 1 track, track 1 */
id|tt_dmasnd.cbar_src
op_assign
l_int|0x0001
suffix:semicolon
multiline_comment|/* DMA(25MHz) --&gt; DAC */
id|tt_dmasnd.cbar_dst
op_assign
l_int|0x0000
suffix:semicolon
id|tt_dmasnd.rec_track_select
op_assign
l_int|0
suffix:semicolon
id|tt_dmasnd.dac_src
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* connect matrix to DAC */
id|tt_dmasnd.adc_src
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ADC Input = Mic */
id|tt_dmasnd.mode
op_assign
(paren
id|sound.hard.stereo
ques
c_cond
id|DMASND_MODE_STEREO
suffix:colon
id|DMASND_MODE_MONO
)paren
op_or
(paren
(paren
id|sound.hard.size
op_eq
l_int|8
)paren
ques
c_cond
id|DMASND_MODE_8BIT
suffix:colon
id|DMASND_MODE_16BIT
)paren
op_or
id|DMASND_MODE_6KHZ
suffix:semicolon
id|sound.bal
op_assign
op_minus
id|sound.soft.speed
suffix:semicolon
)brace
DECL|function|FalconSetFormat
r_static
r_int
id|FalconSetFormat
c_func
(paren
r_int
id|format
)paren
(brace
r_int
id|size
suffix:semicolon
multiline_comment|/* Falcon sound DMA supports 8bit and 16bit modes */
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|AFMT_QUERY
suffix:colon
r_return
id|sound.soft.format
suffix:semicolon
r_case
id|AFMT_MU_LAW
suffix:colon
r_case
id|AFMT_A_LAW
suffix:colon
r_case
id|AFMT_U8
suffix:colon
r_case
id|AFMT_S8
suffix:colon
id|size
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
r_case
id|AFMT_U16_BE
suffix:colon
r_case
id|AFMT_S16_LE
suffix:colon
r_case
id|AFMT_U16_LE
suffix:colon
id|size
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* :-) */
id|size
op_assign
l_int|8
suffix:semicolon
id|format
op_assign
id|AFMT_S8
suffix:semicolon
)brace
id|sound.soft.format
op_assign
id|format
suffix:semicolon
id|sound.soft.size
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
(brace
id|sound.dsp.format
op_assign
id|format
suffix:semicolon
id|sound.dsp.size
op_assign
id|sound.soft.size
suffix:semicolon
)brace
id|FalconInit
c_func
(paren
)paren
suffix:semicolon
r_return
id|format
suffix:semicolon
)brace
multiline_comment|/* This is for the Falcon output *attenuation* in 1.5dB steps,&n; * i.e. output level from 0 to -22.5dB in -1.5dB steps.&n; */
DECL|macro|VOLUME_VOXWARE_TO_ATT
mdefine_line|#define VOLUME_VOXWARE_TO_ATT(v) &bslash;&n;&t;((v) &lt; 0 ? 15 : (v) &gt; 100 ? 0 : 15 - (v) * 3 / 20)
DECL|macro|VOLUME_ATT_TO_VOXWARE
mdefine_line|#define VOLUME_ATT_TO_VOXWARE(v) (100 - (v) * 20 / 3)
DECL|function|FalconSetVolume
r_static
r_int
id|FalconSetVolume
c_func
(paren
r_int
id|volume
)paren
(brace
id|sound.volume_left
op_assign
id|VOLUME_VOXWARE_TO_ATT
c_func
(paren
id|volume
op_amp
l_int|0xff
)paren
suffix:semicolon
id|sound.volume_right
op_assign
id|VOLUME_VOXWARE_TO_ATT
c_func
(paren
(paren
id|volume
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|tt_dmasnd.output_atten
op_assign
id|sound.volume_left
op_lshift
l_int|8
op_or
id|sound.volume_right
op_lshift
l_int|4
suffix:semicolon
r_return
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
DECL|function|ata_sq_play_next_frame
r_static
r_void
id|ata_sq_play_next_frame
c_func
(paren
r_int
id|index
)paren
(brace
r_char
op_star
id|start
comma
op_star
id|end
suffix:semicolon
multiline_comment|/* used by AtaPlay() if all doubts whether there really is something&n;     * to be played are already wiped out.&n;     */
id|start
op_assign
id|sq_block_address
c_func
(paren
id|sq.front
)paren
suffix:semicolon
id|end
op_assign
id|start
op_plus
(paren
(paren
id|sq.count
op_eq
id|index
)paren
ques
c_cond
id|sq.rear_size
suffix:colon
id|sq.block_size
)paren
suffix:semicolon
multiline_comment|/* end might not be a legal virtual address. */
id|DMASNDSetEnd
c_func
(paren
id|VTOP
c_func
(paren
id|end
op_minus
l_int|1
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|DMASNDSetBase
c_func
(paren
id|VTOP
c_func
(paren
id|start
)paren
)paren
suffix:semicolon
multiline_comment|/* Since only an even number of samples per frame can&n;&t;be played, we might lose one byte here. (TO DO) */
id|sq.front
op_assign
(paren
id|sq.front
op_plus
l_int|1
)paren
op_mod
id|sq.max_count
suffix:semicolon
id|sq.playing
op_increment
suffix:semicolon
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_ON
op_or
id|DMASND_CTRL_REPEAT
suffix:semicolon
)brace
DECL|function|AtaPlay
r_static
r_void
id|AtaPlay
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* ++TeSche: Note that sq.playing is no longer just a flag but holds&n;     * the number of frames the DMA is currently programmed for instead,&n;     * may be 0, 1 (currently being played) or 2 (pre-programmed).&n;     *&n;     * Changes done to sq.count and sq.playing are a bit more subtle again&n;     * so now I must admit I also prefer disabling the irq here rather&n;     * than considering all possible situations. But the point is that&n;     * disabling the irq doesn&squot;t have any bad influence on this version of&n;     * the driver as we benefit from having pre-programmed the DMA&n;     * wherever possible: There&squot;s no need to reload the DMA at the exact&n;     * time of an interrupt but only at some time while the pre-programmed&n;     * frame is playing!&n;     */
id|atari_disable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sq.playing
op_eq
l_int|2
op_logical_or
multiline_comment|/* DMA is &squot;full&squot; */
id|sq.count
op_le
l_int|0
)paren
(brace
multiline_comment|/* nothing to do */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.playing
op_eq
l_int|0
)paren
(brace
multiline_comment|/* looks like there&squot;s nothing &squot;in&squot; the DMA yet, so try&n;&t; * to put two frames into it (at least one is available).&n;&t; */
r_if
c_cond
(paren
id|sq.count
op_eq
l_int|1
op_logical_and
id|sq.rear_size
OL
id|sq.block_size
op_logical_and
op_logical_neg
id|sq.syncing
)paren
(brace
multiline_comment|/* hmmm, the only existing frame is not&n;&t;     * yet filled and we&squot;re not syncing?&n;&t;     */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ata_sq_play_next_frame
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sq.count
op_eq
l_int|1
)paren
(brace
multiline_comment|/* no more frames */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.count
op_eq
l_int|2
op_logical_and
id|sq.rear_size
OL
id|sq.block_size
op_logical_and
op_logical_neg
id|sq.syncing
)paren
(brace
multiline_comment|/* hmmm, there were two frames, but the second&n;&t;     * one is not yet filled and we&squot;re not syncing?&n;&t;     */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ata_sq_play_next_frame
c_func
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* there&squot;s already a frame being played so we may only stuff&n;&t; * one new into the DMA, but even if this may be the last&n;&t; * frame existing the previous one is still on sq.count.&n;&t; */
r_if
c_cond
(paren
id|sq.count
op_eq
l_int|2
op_logical_and
id|sq.rear_size
OL
id|sq.block_size
op_logical_and
op_logical_neg
id|sq.syncing
)paren
(brace
multiline_comment|/* hmmm, the only existing frame is not&n;&t;     * yet filled and we&squot;re not syncing?&n;&t;     */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ata_sq_play_next_frame
c_func
(paren
l_int|2
)paren
suffix:semicolon
)brace
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
)brace
DECL|function|ata_sq_interrupt
r_static
r_void
id|ata_sq_interrupt
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|fp
comma
r_void
op_star
id|dummy
)paren
(brace
macro_line|#if 0
multiline_comment|/* ++TeSche: if you should want to test this... */
r_static
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sq.playing
op_eq
l_int|2
)paren
r_if
c_cond
(paren
op_increment
id|cnt
op_eq
l_int|10
)paren
(brace
multiline_comment|/* simulate losing an interrupt */
id|cnt
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sq.ignore_int
op_logical_and
(paren
id|sound.mach.type
op_eq
id|DMASND_FALCON
)paren
)paren
(brace
multiline_comment|/* ++TeSche: Falcon only: ignore first irq because it comes&n;&t; * immediately after starting a frame. after that, irqs come&n;&t; * (almost) like on the TT.&n;&t; */
id|sq.ignore_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
(brace
multiline_comment|/* playing was interrupted and sq_reset() has already cleared&n;&t; * the sq variables, so better don&squot;t do anything here.&n;&t; */
id|WAKE_UP
c_func
(paren
id|sq.sync_queue
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Probably ;) one frame is finished. Well, in fact it may be that a&n;     * pre-programmed one is also finished because there has been a long&n;     * delay in interrupt delivery and we&squot;ve completely lost one, but&n;     * there&squot;s no way to detect such a situation. In such a case the last&n;     * frame will be played more than once and the situation will recover&n;     * as soon as the irq gets through.&n;     */
id|sq.count
op_decrement
suffix:semicolon
id|sq.playing
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
(brace
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_OFF
suffix:semicolon
id|sq.ignore_int
op_assign
l_int|1
suffix:semicolon
)brace
id|WAKE_UP
c_func
(paren
id|sq.write_queue
)paren
suffix:semicolon
multiline_comment|/* At least one block of the queue is free now&n;&t;so wake up a writing process blocked because&n;&t;of a full queue. */
r_if
c_cond
(paren
(paren
id|sq.playing
op_ne
l_int|1
)paren
op_logical_or
(paren
id|sq.count
op_ne
l_int|1
)paren
)paren
multiline_comment|/* We must be a bit carefully here: sq.count indicates the&n;&t; * number of buffers used and not the number of frames to&n;&t; * be played. If sq.count==1 and sq.playing==1 that means&n;&t; * the only remaining frame was already programmed earlier&n;&t; * (and is currently running) so we mustn&squot;t call AtaPlay()&n;&t; * here, otherwise we&squot;ll play one frame too much.&n;&t; */
id|AtaPlay
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
id|WAKE_UP
c_func
(paren
id|sq.sync_queue
)paren
suffix:semicolon
multiline_comment|/* We are not playing after AtaPlay(), so there&n;&t;is nothing to play any more. Wake up a process&n;&t;waiting for audio output to drain. */
)brace
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
multiline_comment|/*&n; * Amiga&n; */
DECL|function|AmiAlloc
r_static
r_void
op_star
id|AmiAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_return
id|amiga_chip_alloc
c_func
(paren
(paren
r_int
)paren
id|size
)paren
suffix:semicolon
)brace
DECL|function|AmiFree
r_static
r_void
id|AmiFree
c_func
(paren
r_void
op_star
id|obj
comma
r_int
r_int
id|size
)paren
(brace
id|amiga_chip_free
(paren
id|obj
)paren
suffix:semicolon
)brace
DECL|function|AmiIrqInit
r_static
r_int
id|AmiIrqInit
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* turn off DMA for audio channels */
id|custom.dmacon
op_assign
id|AMI_AUDIO_OFF
suffix:semicolon
multiline_comment|/* Register interrupt handler. */
r_if
c_cond
(paren
op_logical_neg
id|add_isr
c_func
(paren
id|IRQ_AMIGA_AUD0
comma
id|ami_sq_interrupt
comma
l_int|0
comma
l_int|NULL
comma
l_string|&quot;DMA sound&quot;
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;Couldn&squot;t add audio interrupt&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|AmiSilence
r_static
r_void
id|AmiSilence
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* turn off DMA for audio channels */
id|custom.dmacon
op_assign
id|AMI_AUDIO_OFF
suffix:semicolon
)brace
DECL|function|AmiInit
r_static
r_void
id|AmiInit
c_func
(paren
r_void
)paren
(brace
r_int
id|period
comma
id|i
suffix:semicolon
id|AmiSilence
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound.soft.speed
)paren
id|period
op_assign
id|amiga_colorclock
op_div
id|sound.soft.speed
op_minus
l_int|1
suffix:semicolon
r_else
id|period
op_assign
id|amiga_audio_min_period
suffix:semicolon
id|sound.hard
op_assign
id|sound.soft
suffix:semicolon
id|sound.trans
op_assign
op_amp
id|transAmiga
suffix:semicolon
r_if
c_cond
(paren
id|period
OL
id|amiga_audio_min_period
)paren
(brace
multiline_comment|/* we would need to squeeze the sound, but we won&squot;t do that */
id|period
op_assign
id|amiga_audio_min_period
suffix:semicolon
id|sound.hard.speed
op_assign
id|amiga_colorclock
op_div
(paren
id|period
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|period
OG
l_int|65535
)paren
(brace
id|period
op_assign
l_int|65535
suffix:semicolon
id|sound.hard.speed
op_assign
id|amiga_colorclock
op_div
(paren
id|period
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|custom.aud
(braket
id|i
)braket
dot
id|audper
op_assign
id|period
suffix:semicolon
id|amiga_audio_period
op_assign
id|period
suffix:semicolon
)brace
DECL|function|AmiSetFormat
r_static
r_int
id|AmiSetFormat
c_func
(paren
r_int
id|format
)paren
(brace
r_int
id|size
suffix:semicolon
multiline_comment|/* Amiga sound DMA supports 8bit and 16bit (pseudo 14 bit) modes */
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|AFMT_QUERY
suffix:colon
r_return
id|sound.soft.format
suffix:semicolon
r_case
id|AFMT_MU_LAW
suffix:colon
r_case
id|AFMT_A_LAW
suffix:colon
r_case
id|AFMT_U8
suffix:colon
r_case
id|AFMT_S8
suffix:colon
id|size
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
r_case
id|AFMT_U16_BE
suffix:colon
r_case
id|AFMT_S16_LE
suffix:colon
r_case
id|AFMT_U16_LE
suffix:colon
id|size
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* :-) */
id|size
op_assign
l_int|8
suffix:semicolon
id|format
op_assign
id|AFMT_S8
suffix:semicolon
)brace
id|sound.soft.format
op_assign
id|format
suffix:semicolon
id|sound.soft.size
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
(brace
id|sound.dsp.format
op_assign
id|format
suffix:semicolon
id|sound.dsp.size
op_assign
id|sound.soft.size
suffix:semicolon
)brace
id|AmiInit
c_func
(paren
)paren
suffix:semicolon
r_return
id|format
suffix:semicolon
)brace
DECL|macro|VOLUME_VOXWARE_TO_AMI
mdefine_line|#define VOLUME_VOXWARE_TO_AMI(v) &bslash;&n;&t;(((v) &lt; 0) ? 0 : ((v) &gt; 100) ? 64 : ((v) * 64)/100)
DECL|macro|VOLUME_AMI_TO_VOXWARE
mdefine_line|#define VOLUME_AMI_TO_VOXWARE(v) ((v)*100/64)
DECL|function|AmiSetVolume
r_static
r_int
id|AmiSetVolume
c_func
(paren
r_int
id|volume
)paren
(brace
id|sound.volume_left
op_assign
id|VOLUME_VOXWARE_TO_AMI
c_func
(paren
id|volume
op_amp
l_int|0xff
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|0
)braket
dot
id|audvol
op_assign
id|sound.volume_left
suffix:semicolon
id|sound.volume_right
op_assign
id|VOLUME_VOXWARE_TO_AMI
c_func
(paren
(paren
id|volume
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|1
)braket
dot
id|audvol
op_assign
id|sound.volume_right
suffix:semicolon
r_return
id|VOLUME_AMI_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
(paren
id|VOLUME_AMI_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|function|AmiSetTreble
r_static
r_int
id|AmiSetTreble
c_func
(paren
r_int
id|treble
)paren
(brace
id|sound.treble
op_assign
id|treble
suffix:semicolon
r_if
c_cond
(paren
id|treble
OG
l_int|50
)paren
id|ciaa.pra
op_or_assign
l_int|0x02
suffix:semicolon
r_else
id|ciaa.pra
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
r_return
id|treble
suffix:semicolon
)brace
DECL|macro|AMI_PLAY_LOADED
mdefine_line|#define AMI_PLAY_LOADED&t;&t;1
DECL|macro|AMI_PLAY_PLAYING
mdefine_line|#define AMI_PLAY_PLAYING&t;2
DECL|macro|AMI_PLAY_MASK
mdefine_line|#define AMI_PLAY_MASK&t;&t;3
DECL|function|ami_sq_play_next_frame
r_static
r_void
id|ami_sq_play_next_frame
c_func
(paren
r_int
id|index
)paren
(brace
id|u_char
op_star
id|start
comma
op_star
id|ch0
comma
op_star
id|ch1
comma
op_star
id|ch2
comma
op_star
id|ch3
suffix:semicolon
id|u_long
id|size
suffix:semicolon
multiline_comment|/* used by AmiPlay() if all doubts whether there really is something&n;     * to be played are already wiped out.&n;     */
id|start
op_assign
id|sq_block_address
c_func
(paren
id|sq.front
)paren
suffix:semicolon
id|size
op_assign
(paren
id|sq.count
op_eq
id|index
ques
c_cond
id|sq.rear_size
suffix:colon
id|sq.block_size
)paren
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sound.hard.stereo
)paren
(brace
id|ch0
op_assign
id|start
suffix:semicolon
id|ch1
op_assign
id|start
op_plus
id|sq.block_size_half
suffix:semicolon
id|size
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|ch0
op_assign
id|start
suffix:semicolon
id|ch1
op_assign
id|start
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sound.hard.size
op_eq
l_int|8
)paren
(brace
id|custom.aud
(braket
l_int|0
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch0
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|0
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
id|custom.aud
(braket
l_int|1
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch1
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|1
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
id|custom.dmacon
op_assign
id|AMI_AUDIO_8
suffix:semicolon
)brace
r_else
(brace
id|size
op_rshift_assign
l_int|1
suffix:semicolon
id|custom.aud
(braket
l_int|0
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch0
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|0
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
id|custom.aud
(braket
l_int|1
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch1
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|1
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sound.volume_left
op_eq
l_int|64
op_logical_and
id|sound.volume_right
op_eq
l_int|64
)paren
(brace
multiline_comment|/* We can play pseudo 14-bit only with the maximum volume */
id|ch3
op_assign
id|ch0
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|ch2
op_assign
id|ch1
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|custom.aud
(braket
l_int|2
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch2
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|2
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
id|custom.aud
(braket
l_int|3
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch3
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|3
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
id|custom.dmacon
op_assign
id|AMI_AUDIO_14
suffix:semicolon
)brace
r_else
id|custom.dmacon
op_assign
id|AMI_AUDIO_8
suffix:semicolon
)brace
id|sq.front
op_assign
(paren
id|sq.front
op_plus
l_int|1
)paren
op_mod
id|sq.max_count
suffix:semicolon
id|sq.playing
op_or_assign
id|AMI_PLAY_LOADED
suffix:semicolon
)brace
DECL|function|AmiPlay
r_static
r_void
id|AmiPlay
c_func
(paren
r_void
)paren
(brace
r_int
id|minframes
op_assign
l_int|1
suffix:semicolon
id|custom.intena
op_assign
id|IF_AUD0
suffix:semicolon
r_if
c_cond
(paren
id|sq.playing
op_amp
id|AMI_PLAY_LOADED
)paren
(brace
multiline_comment|/* There&squot;s already a frame loaded */
id|custom.intena
op_assign
id|IF_SETCLR
op_or
id|IF_AUD0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.playing
op_amp
id|AMI_PLAY_PLAYING
)paren
multiline_comment|/* Increase threshold: frame 1 is already being played */
id|minframes
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|sq.count
OL
id|minframes
)paren
(brace
multiline_comment|/* Nothing to do */
id|custom.intena
op_assign
id|IF_SETCLR
op_or
id|IF_AUD0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.count
op_le
id|minframes
op_logical_and
id|sq.rear_size
OL
id|sq.block_size
op_logical_and
op_logical_neg
id|sq.syncing
)paren
(brace
multiline_comment|/* hmmm, the only existing frame is not&n;&t; * yet filled and we&squot;re not syncing?&n;&t; */
id|custom.intena
op_assign
id|IF_SETCLR
op_or
id|IF_AUD0
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ami_sq_play_next_frame
c_func
(paren
id|minframes
)paren
suffix:semicolon
id|custom.intena
op_assign
id|IF_SETCLR
op_or
id|IF_AUD0
suffix:semicolon
)brace
DECL|function|ami_sq_interrupt
r_static
r_void
id|ami_sq_interrupt
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|fp
comma
r_void
op_star
id|dummy
)paren
(brace
r_int
id|minframes
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
(brace
multiline_comment|/* Playing was interrupted and sq_reset() has already cleared&n;&t; * the sq variables, so better don&squot;t do anything here.&n;&t; */
id|WAKE_UP
c_func
(paren
id|sq.sync_queue
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.playing
op_amp
id|AMI_PLAY_PLAYING
)paren
(brace
multiline_comment|/* We&squot;ve just finished a frame */
id|sq.count
op_decrement
suffix:semicolon
id|WAKE_UP
c_func
(paren
id|sq.write_queue
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.playing
op_amp
id|AMI_PLAY_LOADED
)paren
multiline_comment|/* Increase threshold: frame 1 is already being played */
id|minframes
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Shift the flags */
id|sq.playing
op_assign
(paren
id|sq.playing
op_lshift
l_int|1
)paren
op_amp
id|AMI_PLAY_MASK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
multiline_comment|/* No frame is playing, disable audio DMA */
id|custom.dmacon
op_assign
id|AMI_AUDIO_OFF
suffix:semicolon
r_if
c_cond
(paren
id|sq.count
op_ge
id|minframes
)paren
multiline_comment|/* Try to play the next frame */
id|AmiPlay
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
multiline_comment|/* Nothing to play anymore.&n;&t;   Wake up a process waiting for audio output to drain. */
id|WAKE_UP
c_func
(paren
id|sq.sync_queue
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AMIGA */
multiline_comment|/*** Machine definitions *****************************************************/
macro_line|#ifdef CONFIG_ATARI
DECL|variable|machTT
r_static
id|MACHINE
id|machTT
op_assign
(brace
id|DMASND_TT
comma
id|AtaAlloc
comma
id|AtaFree
comma
id|AtaIrqInit
comma
id|TTInit
comma
id|TTSilence
comma
id|TTSetFormat
comma
id|TTSetVolume
comma
id|AtaSetBass
comma
id|AtaSetTreble
comma
id|AtaPlay
)brace
suffix:semicolon
DECL|variable|machFalcon
r_static
id|MACHINE
id|machFalcon
op_assign
(brace
id|DMASND_FALCON
comma
id|AtaAlloc
comma
id|AtaFree
comma
id|AtaIrqInit
comma
id|FalconInit
comma
id|FalconSilence
comma
id|FalconSetFormat
comma
id|FalconSetVolume
comma
id|AtaSetBass
comma
id|AtaSetTreble
comma
id|AtaPlay
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
DECL|variable|machAmiga
r_static
id|MACHINE
id|machAmiga
op_assign
(brace
id|DMASND_AMIGA
comma
id|AmiAlloc
comma
id|AmiFree
comma
id|AmiIrqInit
comma
id|AmiInit
comma
id|AmiSilence
comma
id|AmiSetFormat
comma
id|AmiSetVolume
comma
l_int|NULL
comma
id|AmiSetTreble
comma
id|AmiPlay
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
multiline_comment|/*** Mid level stuff *********************************************************/
DECL|function|sound_silence
r_static
r_void
id|sound_silence
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* update hardware settings one more */
(paren
op_star
id|sound.mach.init
)paren
(paren
)paren
suffix:semicolon
(paren
op_star
id|sound.mach.silence
)paren
(paren
)paren
suffix:semicolon
)brace
DECL|function|sound_init
r_static
r_void
id|sound_init
c_func
(paren
r_void
)paren
(brace
(paren
op_star
id|sound.mach.init
)paren
(paren
)paren
suffix:semicolon
)brace
DECL|function|sound_set_format
r_static
r_int
id|sound_set_format
c_func
(paren
r_int
id|format
)paren
(brace
r_return
(paren
op_star
id|sound.mach.setFormat
)paren
(paren
id|format
)paren
suffix:semicolon
)brace
DECL|function|sound_set_speed
r_static
r_int
id|sound_set_speed
c_func
(paren
r_int
id|speed
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|0
)paren
r_return
id|sound.soft.speed
suffix:semicolon
id|sound.soft.speed
op_assign
id|speed
suffix:semicolon
(paren
op_star
id|sound.mach.init
)paren
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
id|sound.dsp.speed
op_assign
id|sound.soft.speed
suffix:semicolon
r_return
id|sound.soft.speed
suffix:semicolon
)brace
DECL|function|sound_set_stereo
r_static
r_int
id|sound_set_stereo
c_func
(paren
r_int
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|stereo
OL
l_int|0
)paren
r_return
id|sound.soft.stereo
suffix:semicolon
id|stereo
op_assign
op_logical_neg
op_logical_neg
id|stereo
suffix:semicolon
multiline_comment|/* should be 0 or 1 now */
id|sound.soft.stereo
op_assign
id|stereo
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
id|sound.dsp.stereo
op_assign
id|stereo
suffix:semicolon
(paren
op_star
id|sound.mach.init
)paren
(paren
)paren
suffix:semicolon
r_return
id|stereo
suffix:semicolon
)brace
DECL|function|sound_set_volume
r_static
r_int
id|sound_set_volume
c_func
(paren
r_int
id|volume
)paren
(brace
r_return
(paren
op_star
id|sound.mach.setVolume
)paren
(paren
id|volume
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ATARI
DECL|function|sound_set_bass
r_static
r_int
id|sound_set_bass
c_func
(paren
r_int
id|bass
)paren
(brace
r_return
id|sound.mach.setBass
ques
c_cond
(paren
op_star
id|sound.mach.setBass
)paren
(paren
id|bass
)paren
suffix:colon
l_int|50
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ATARI */
DECL|function|sound_set_treble
r_static
r_int
id|sound_set_treble
c_func
(paren
r_int
id|treble
)paren
(brace
r_return
id|sound.mach.setTreble
ques
c_cond
(paren
op_star
id|sound.mach.setTreble
)paren
(paren
id|treble
)paren
suffix:colon
l_int|50
suffix:semicolon
)brace
DECL|function|sound_copy_translate
r_static
r_int
id|sound_copy_translate
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
r_int
op_star
id|frameUsed
comma
r_int
id|frameLeft
)paren
(brace
r_int
(paren
op_star
id|ct_func
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
r_int
op_star
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|sound.soft.format
)paren
(brace
r_case
id|AFMT_MU_LAW
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_ulaw
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_A_LAW
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_alaw
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S8
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_s8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U8
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_u8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_s16be
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U16_BE
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_u16be
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_LE
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_s16le
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U16_LE
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_u16le
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ct_func
)paren
r_return
id|ct_func
c_func
(paren
id|userPtr
comma
id|userCount
comma
id|frame
comma
id|frameUsed
comma
id|frameLeft
)paren
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * /dev/mixer abstraction&n; */
DECL|macro|RECLEVEL_VOXWARE_TO_GAIN
mdefine_line|#define RECLEVEL_VOXWARE_TO_GAIN(v) &bslash;&n;&t;((v) &lt; 0 ? 0 : (v) &gt; 100 ? 15 : (v) * 3 / 20)
DECL|macro|RECLEVEL_GAIN_TO_VOXWARE
mdefine_line|#define RECLEVEL_GAIN_TO_VOXWARE(v) (((v) * 20 + 2) / 3)
DECL|function|mixer_init
r_static
r_void
id|mixer_init
c_func
(paren
r_void
)paren
(brace
id|mixer.busy
op_assign
l_int|0
suffix:semicolon
id|sound.treble
op_assign
l_int|0
suffix:semicolon
id|sound.bass
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|sound.mach.type
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|DMASND_TT
suffix:colon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_VOLUME
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|sound.volume_left
op_assign
l_int|0
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALLEFT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|sound.volume_right
op_assign
l_int|0
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALRIGHT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_TREBLE
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BASS
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMASND_FALCON
suffix:colon
id|sound.volume_left
op_assign
(paren
id|tt_dmasnd.output_atten
op_amp
l_int|0xf00
)paren
op_rshift
l_int|8
suffix:semicolon
id|sound.volume_right
op_assign
(paren
id|tt_dmasnd.output_atten
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|DMASND_AMIGA
suffix:colon
id|sound.volume_left
op_assign
l_int|64
suffix:semicolon
id|sound.volume_right
op_assign
l_int|64
suffix:semicolon
id|custom.aud
(braket
l_int|0
)braket
dot
id|audvol
op_assign
id|sound.volume_left
suffix:semicolon
id|custom.aud
(braket
l_int|3
)braket
dot
id|audvol
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* For pseudo 14bit */
id|custom.aud
(braket
l_int|1
)braket
dot
id|audvol
op_assign
id|sound.volume_right
suffix:semicolon
id|custom.aud
(braket
l_int|2
)braket
dot
id|audvol
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* For pseudo 14bit */
id|sound.treble
op_assign
l_int|50
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
)brace
DECL|function|mixer_open
r_static
r_int
id|mixer_open
c_func
(paren
r_int
id|open_mode
)paren
(brace
r_if
c_cond
(paren
id|mixer.busy
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|mixer.busy
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixer_release
r_static
r_int
id|mixer_release
c_func
(paren
r_void
)paren
(brace
id|mixer.busy
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixer_ioctl
r_static
r_int
id|mixer_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|sound.mach.type
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|DMASND_FALCON
suffix:colon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_SPEAKER
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_MIC
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_MIC
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_CAPS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_CAP_EXCL_INPUT
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_MIC
suffix:colon
id|tt_dmasnd.input_gain
op_assign
id|RECLEVEL_VOXWARE_TO_GAIN
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|4
op_or
id|RECLEVEL_VOXWARE_TO_GAIN
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
op_rshift
l_int|8
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* fall thru, return set value */
r_case
id|SOUND_MIXER_READ_MIC
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|RECLEVEL_GAIN_TO_VOXWARE
c_func
(paren
id|tt_dmasnd.input_gain
op_rshift
l_int|4
op_amp
l_int|0xf
)paren
op_or
id|RECLEVEL_GAIN_TO_VOXWARE
c_func
(paren
id|tt_dmasnd.input_gain
op_amp
l_int|0xf
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_SPEAKER
suffix:colon
(brace
r_int
id|porta
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sound_ym.rd_data_reg_sel
op_assign
l_int|14
suffix:semicolon
id|porta
op_assign
id|sound_ym.rd_data_reg_sel
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|porta
op_amp
l_int|0x40
ques
c_cond
l_int|0
suffix:colon
l_int|100
)paren
suffix:semicolon
)brace
r_case
id|SOUND_MIXER_WRITE_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_volume
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_SPEAKER
suffix:colon
(brace
r_int
id|porta
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sound_ym.rd_data_reg_sel
op_assign
l_int|14
suffix:semicolon
id|porta
op_assign
(paren
id|sound_ym.rd_data_reg_sel
op_amp
op_complement
l_int|0x40
)paren
op_or
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
OL
l_int|50
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
suffix:semicolon
id|sound_ym.wd_data
op_assign
id|porta
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|porta
op_amp
l_int|0x40
ques
c_cond
l_int|0
suffix:colon
l_int|100
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|DMASND_TT
suffix:colon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_TREBLE
op_or
id|SOUND_MASK_BASS
op_or
(paren
(paren
id|boot_info.bi_atari.mch_cookie
op_rshift
l_int|16
)paren
op_eq
id|ATARI_MCH_TT
ques
c_cond
id|SOUND_MASK_SPEAKER
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
l_int|0
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
(paren
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_BASS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|sound.bass
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_TREBLE
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|sound.treble
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_SPEAKER
suffix:colon
(brace
r_int
id|porta
suffix:semicolon
r_if
c_cond
(paren
(paren
id|boot_info.bi_atari.mch_cookie
op_rshift
l_int|16
)paren
op_eq
id|ATARI_MCH_TT
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sound_ym.rd_data_reg_sel
op_assign
l_int|14
suffix:semicolon
id|porta
op_assign
id|sound_ym.rd_data_reg_sel
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|porta
op_amp
l_int|0x40
ques
c_cond
l_int|0
suffix:colon
l_int|100
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_case
id|SOUND_MIXER_WRITE_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_volume
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_BASS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_bass
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_TREBLE
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_treble
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_SPEAKER
suffix:colon
r_if
c_cond
(paren
(paren
id|boot_info.bi_atari.mch_cookie
op_rshift
l_int|16
)paren
op_eq
id|ATARI_MCH_TT
)paren
(brace
r_int
id|porta
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sound_ym.rd_data_reg_sel
op_assign
l_int|14
suffix:semicolon
id|porta
op_assign
(paren
id|sound_ym.rd_data_reg_sel
op_amp
op_complement
l_int|0x40
)paren
op_or
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
OL
l_int|50
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
suffix:semicolon
id|sound_ym.wd_data
op_assign
id|porta
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|porta
op_amp
l_int|0x40
ques
c_cond
l_int|0
suffix:colon
l_int|100
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|DMASND_AMIGA
suffix:colon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_TREBLE
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
l_int|0
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|VOLUME_AMI_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
id|VOLUME_AMI_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_volume
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_TREBLE
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound.treble
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_TREBLE
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_treble
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; * Sound queue stuff, the heart of the driver&n; */
DECL|function|sq_init
r_static
r_void
id|sq_init
c_func
(paren
r_int
id|numBufs
comma
r_int
id|bufSize
comma
r_char
op_star
op_star
id|buffers
)paren
(brace
id|sq.max_count
op_assign
id|numBufs
suffix:semicolon
id|sq.block_size
op_assign
id|bufSize
suffix:semicolon
id|sq.buffers
op_assign
id|buffers
suffix:semicolon
id|sq.front
op_assign
id|sq.count
op_assign
l_int|0
suffix:semicolon
id|sq.rear
op_assign
op_minus
l_int|1
suffix:semicolon
id|sq.write_queue
op_assign
id|sq.open_queue
op_assign
id|sq.sync_queue
op_assign
l_int|0
suffix:semicolon
id|sq.busy
op_assign
l_int|0
suffix:semicolon
id|sq.syncing
op_assign
l_int|0
suffix:semicolon
id|sq.playing
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
id|sq.ignore_int
op_assign
l_int|0
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
id|sq.block_size_half
op_assign
id|sq.block_size
op_rshift
l_int|1
suffix:semicolon
id|sq.block_size_quarter
op_assign
id|sq.block_size_half
op_rshift
l_int|1
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
id|sound_silence
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* whatever you like as startup mode for /dev/dsp,&n;     * (/dev/audio hasn&squot;t got a startup mode). note that&n;     * once changed a new open() will *not* restore these!&n;     */
id|sound.dsp.format
op_assign
id|AFMT_S8
suffix:semicolon
id|sound.dsp.stereo
op_assign
l_int|0
suffix:semicolon
id|sound.dsp.size
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* set minimum rate possible without expanding */
r_switch
c_cond
(paren
id|sound.mach.type
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|DMASND_TT
suffix:colon
id|sound.dsp.speed
op_assign
l_int|6258
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMASND_FALCON
suffix:colon
id|sound.dsp.speed
op_assign
l_int|8195
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|DMASND_AMIGA
suffix:colon
id|sound.dsp.speed
op_assign
l_int|8000
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
multiline_comment|/* before the first open to /dev/dsp this wouldn&squot;t be set */
id|sound.soft
op_assign
id|sound.dsp
suffix:semicolon
)brace
DECL|function|sq_play
r_static
r_void
id|sq_play
c_func
(paren
r_void
)paren
(brace
(paren
op_star
id|sound.mach.play
)paren
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ++TeSche: radically changed this one too */
DECL|function|sq_write
r_static
r_int
id|sq_write
c_func
(paren
r_const
r_char
op_star
id|src
comma
r_int
id|uLeft
)paren
(brace
r_int
id|uWritten
op_assign
l_int|0
suffix:semicolon
id|u_char
op_star
id|dest
suffix:semicolon
r_int
id|uUsed
comma
id|bUsed
comma
id|bLeft
suffix:semicolon
multiline_comment|/* ++TeSche: Is something like this necessary?&n;     * Hey, that&squot;s an honest question! Or does any other part of the&n;     * filesystem already checks this situation? I really don&squot;t know.&n;     */
r_if
c_cond
(paren
id|uLeft
OL
l_int|1
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* The interrupt doesn&squot;t start to play the last, incomplete frame.&n;     * Thus we can append to it without disabling the interrupts! (Note&n;     * also that sq.rear isn&squot;t affected by the interrupt.)&n;     */
r_if
c_cond
(paren
id|sq.count
OG
l_int|0
op_logical_and
(paren
id|bLeft
op_assign
id|sq.block_size
op_minus
id|sq.rear_size
)paren
OG
l_int|0
)paren
(brace
id|dest
op_assign
id|sq_block_address
c_func
(paren
id|sq.rear
)paren
suffix:semicolon
id|bUsed
op_assign
id|sq.rear_size
suffix:semicolon
id|uUsed
op_assign
id|sound_copy_translate
c_func
(paren
id|src
comma
id|uLeft
comma
id|dest
comma
op_amp
id|bUsed
comma
id|bLeft
)paren
suffix:semicolon
id|src
op_add_assign
id|uUsed
suffix:semicolon
id|uWritten
op_add_assign
id|uUsed
suffix:semicolon
id|uLeft
op_sub_assign
id|uUsed
suffix:semicolon
id|sq.rear_size
op_assign
id|bUsed
suffix:semicolon
)brace
r_do
(brace
r_if
c_cond
(paren
id|sq.count
op_eq
id|sq.max_count
)paren
(brace
id|sq_play
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NON_BLOCKING
c_func
(paren
id|sq.open_mode
)paren
)paren
r_return
id|uWritten
OG
l_int|0
ques
c_cond
id|uWritten
suffix:colon
op_minus
id|EAGAIN
suffix:semicolon
id|SLEEP
c_func
(paren
id|sq.write_queue
comma
id|ONE_SECOND
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SIGNAL_RECEIVED
)paren
r_return
id|uWritten
OG
l_int|0
ques
c_cond
id|uWritten
suffix:colon
op_minus
id|EINTR
suffix:semicolon
)brace
multiline_comment|/* Here, we can avoid disabling the interrupt by first&n;&t; * copying and translating the data, and then updating&n;&t; * the sq variables. Until this is done, the interrupt&n;&t; * won&squot;t see the new frame and we can work on it&n;&t; * undisturbed.&n;&t; */
id|dest
op_assign
id|sq_block_address
c_func
(paren
(paren
id|sq.rear
op_plus
l_int|1
)paren
op_mod
id|sq.max_count
)paren
suffix:semicolon
id|bUsed
op_assign
l_int|0
suffix:semicolon
id|bLeft
op_assign
id|sq.block_size
suffix:semicolon
id|uUsed
op_assign
id|sound_copy_translate
c_func
(paren
id|src
comma
id|uLeft
comma
id|dest
comma
op_amp
id|bUsed
comma
id|bLeft
)paren
suffix:semicolon
id|src
op_add_assign
id|uUsed
suffix:semicolon
id|uWritten
op_add_assign
id|uUsed
suffix:semicolon
id|uLeft
op_sub_assign
id|uUsed
suffix:semicolon
r_if
c_cond
(paren
id|bUsed
)paren
(brace
id|sq.rear
op_assign
(paren
id|sq.rear
op_plus
l_int|1
)paren
op_mod
id|sq.max_count
suffix:semicolon
id|sq.rear_size
op_assign
id|bUsed
suffix:semicolon
id|sq.count
op_increment
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|bUsed
)paren
suffix:semicolon
multiline_comment|/* uUsed may have been 0 */
id|sq_play
c_func
(paren
)paren
suffix:semicolon
r_return
id|uWritten
suffix:semicolon
)brace
DECL|function|sq_open
r_static
r_int
id|sq_open
c_func
(paren
r_int
id|open_mode
)paren
(brace
r_if
c_cond
(paren
id|sq.busy
)paren
(brace
r_if
c_cond
(paren
id|NON_BLOCKING
c_func
(paren
id|open_mode
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_while
c_loop
(paren
id|sq.busy
)paren
(brace
id|SLEEP
c_func
(paren
id|sq.open_queue
comma
id|ONE_SECOND
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SIGNAL_RECEIVED
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
)brace
id|sq.open_mode
op_assign
id|open_mode
suffix:semicolon
id|sq.busy
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
id|sq.ignore_int
op_assign
l_int|1
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sq_reset
r_static
r_void
id|sq_reset
c_func
(paren
r_void
)paren
(brace
id|sound_silence
c_func
(paren
)paren
suffix:semicolon
id|sq.playing
op_assign
l_int|0
suffix:semicolon
id|sq.count
op_assign
l_int|0
suffix:semicolon
id|sq.front
op_assign
(paren
id|sq.rear
op_plus
l_int|1
)paren
op_mod
id|sq.max_count
suffix:semicolon
)brace
DECL|function|sq_sync
r_static
r_int
id|sq_sync
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|sq.syncing
op_assign
l_int|1
suffix:semicolon
id|sq_play
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* there may be an incomplete frame waiting */
r_while
c_loop
(paren
id|sq.playing
)paren
(brace
id|SLEEP
c_func
(paren
id|sq.sync_queue
comma
id|ONE_SECOND
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SIGNAL_RECEIVED
)paren
(brace
multiline_comment|/* While waiting for audio output to drain, an interrupt occurred.&n;&t;       Stop audio output immediately and clear the queue. */
id|sq_reset
c_func
(paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINTR
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|sq.syncing
op_assign
l_int|0
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|sq_release
r_static
r_int
id|sq_release
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sq.busy
)paren
(brace
id|rc
op_assign
id|sq_sync
c_func
(paren
)paren
suffix:semicolon
id|sq.busy
op_assign
l_int|0
suffix:semicolon
id|WAKE_UP
c_func
(paren
id|sq.open_queue
)paren
suffix:semicolon
multiline_comment|/* Wake up a process waiting for the queue being released.&n;&t;   Note: There may be several processes waiting for a call to open()&n;&t;&t; returning. */
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * /dev/sndstat&n; */
DECL|function|state_init
r_static
r_void
id|state_init
c_func
(paren
r_void
)paren
(brace
id|state.busy
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* state.buf should not overflow! */
DECL|function|state_open
r_static
r_int
id|state_open
c_func
(paren
r_int
id|open_mode
)paren
(brace
r_char
op_star
id|buffer
op_assign
id|state.buf
comma
op_star
id|mach
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|state.busy
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|state.ptr
op_assign
l_int|0
suffix:semicolon
id|state.busy
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|sound.mach.type
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|DMASND_TT
suffix:colon
r_case
id|DMASND_FALCON
suffix:colon
id|mach
op_assign
l_string|&quot;Atari &quot;
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|DMASND_AMIGA
suffix:colon
id|mach
op_assign
l_string|&quot;Amiga &quot;
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%sDMA sound driver:&bslash;n&quot;
comma
id|mach
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.format = 0x%x&quot;
comma
id|sound.soft.format
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sound.soft.format
)paren
(brace
r_case
id|AFMT_MU_LAW
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (mu-law)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_A_LAW
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (A-law)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U8
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (unsigned 8 bit)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S8
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (signed 8 bit)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (signed 16 bit big)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U16_BE
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (unsigned 16 bit big)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_LE
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (signed 16 bit little)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U16_LE
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (unsigned 16 bit little)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.speed = %dHz (phys. %dHz)&bslash;n&quot;
comma
id|sound.soft.speed
comma
id|sound.hard.speed
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.stereo = 0x%x (%s)&bslash;n&quot;
comma
id|sound.soft.stereo
comma
id|sound.soft.stereo
ques
c_cond
l_string|&quot;stereo&quot;
suffix:colon
l_string|&quot;mono&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sound.mach.type
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|DMASND_TT
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_left = %ddB [-40...0]&bslash;n&quot;
comma
id|sound.volume_left
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_right = %ddB [-40...0]&bslash;n&quot;
comma
id|sound.volume_right
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.bass = %ddB [-12...+12]&bslash;n&quot;
comma
id|sound.bass
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.treble = %ddB [-12...+12]&bslash;n&quot;
comma
id|sound.treble
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMASND_FALCON
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_left = %ddB [-22.5...0]&bslash;n&quot;
comma
id|sound.volume_left
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_right = %ddB [-22.5...0]&bslash;n&quot;
comma
id|sound.volume_right
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|DMASND_AMIGA
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_left = %d [0...64]&bslash;n&quot;
comma
id|sound.volume_left
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_right = %d [0...64]&bslash;n&quot;
comma
id|sound.volume_right
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsq.block_size = %d sq.max_count = %d&bslash;n&quot;
comma
id|sq.block_size
comma
id|sq.max_count
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsq.count = %d sq.rear_size = %d&bslash;n&quot;
comma
id|sq.count
comma
id|sq.rear_size
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsq.playing = %d sq.syncing = %d&bslash;n&quot;
comma
id|sq.playing
comma
id|sq.syncing
)paren
suffix:semicolon
id|state.len
op_assign
id|len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|state_release
r_static
r_int
id|state_release
c_func
(paren
r_void
)paren
(brace
id|state.busy
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|state_read
r_static
r_int
id|state_read
c_func
(paren
r_char
op_star
id|dest
comma
r_int
id|count
)paren
(brace
r_int
id|n
op_assign
id|state.len
op_minus
id|state.ptr
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
id|count
)paren
id|n
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|n
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|copy_to_user
c_func
(paren
id|dest
comma
op_amp
id|state.buf
(braket
id|state.ptr
)braket
comma
id|n
)paren
suffix:semicolon
id|state.ptr
op_add_assign
id|n
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
multiline_comment|/*** High level stuff ********************************************************/
DECL|function|sound_open
r_static
r_int
id|sound_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|dev
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_switch
c_cond
(paren
id|dev
)paren
(brace
r_case
id|SND_DEV_STATUS
suffix:colon
r_return
id|state_open
c_func
(paren
id|file-&gt;f_flags
)paren
suffix:semicolon
r_case
id|SND_DEV_CTL
suffix:colon
r_return
id|mixer_open
c_func
(paren
id|file-&gt;f_flags
)paren
suffix:semicolon
r_case
id|SND_DEV_DSP
suffix:colon
r_case
id|SND_DEV_AUDIO
suffix:colon
(brace
r_int
id|rc
op_assign
id|sq_open
c_func
(paren
id|file-&gt;f_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
(brace
id|sound.minDev
op_assign
id|dev
suffix:semicolon
id|sound.soft
op_assign
id|sound.dsp
suffix:semicolon
id|sound_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
id|SND_DEV_AUDIO
)paren
(brace
id|sound_set_speed
c_func
(paren
l_int|8000
)paren
suffix:semicolon
id|sound_set_stereo
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|sound_set_format
c_func
(paren
id|AFMT_MU_LAW
)paren
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
)brace
DECL|function|sound_fsync
r_static
r_int
id|sound_fsync
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_int
id|dev
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_switch
c_cond
(paren
id|dev
)paren
(brace
r_case
id|SND_DEV_STATUS
suffix:colon
r_case
id|SND_DEV_CTL
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SND_DEV_DSP
suffix:colon
r_case
id|SND_DEV_AUDIO
suffix:colon
r_return
id|sq_sync
c_func
(paren
)paren
suffix:semicolon
r_default
suffix:colon
r_return
id|unknown_minor_dev
c_func
(paren
l_string|&quot;sound_fsync&quot;
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|sound_release
r_static
r_void
id|sound_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|dev
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dev
op_amp
l_int|0x0f
)paren
(brace
r_case
id|SND_DEV_STATUS
suffix:colon
id|state_release
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|SND_DEV_CTL
suffix:colon
id|mixer_release
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|SND_DEV_DSP
suffix:colon
r_case
id|SND_DEV_AUDIO
suffix:colon
id|sq_release
c_func
(paren
)paren
suffix:semicolon
id|sound.soft
op_assign
id|sound.dsp
suffix:semicolon
id|sound_silence
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|unknown_minor_dev
c_func
(paren
l_string|&quot;sound_release&quot;
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|sound_lseek
r_static
r_int
id|sound_lseek
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|off_t
id|offset
comma
r_int
id|orig
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
DECL|function|sound_read
r_static
r_int
id|sound_read
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|dev
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dev
op_amp
l_int|0x0f
)paren
(brace
r_case
id|SND_DEV_STATUS
suffix:colon
r_return
id|state_read
c_func
(paren
id|buf
comma
id|count
)paren
suffix:semicolon
r_case
id|SND_DEV_CTL
suffix:colon
r_case
id|SND_DEV_DSP
suffix:colon
r_case
id|SND_DEV_AUDIO
suffix:colon
r_return
op_minus
id|EPERM
suffix:semicolon
r_default
suffix:colon
r_return
id|unknown_minor_dev
c_func
(paren
l_string|&quot;sound_read&quot;
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|sound_write
r_static
r_int
id|sound_write
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|dev
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dev
op_amp
l_int|0x0f
)paren
(brace
r_case
id|SND_DEV_STATUS
suffix:colon
r_case
id|SND_DEV_CTL
suffix:colon
r_return
op_minus
id|EPERM
suffix:semicolon
r_case
id|SND_DEV_DSP
suffix:colon
r_case
id|SND_DEV_AUDIO
suffix:colon
r_return
id|sq_write
c_func
(paren
id|buf
comma
id|count
)paren
suffix:semicolon
r_default
suffix:colon
r_return
id|unknown_minor_dev
c_func
(paren
l_string|&quot;sound_write&quot;
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|ioctl_return
r_static
r_int
id|ioctl_return
c_func
(paren
r_int
op_star
id|addr
comma
r_int
id|value
)paren
(brace
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
r_return
id|value
suffix:semicolon
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|addr
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|put_user
c_func
(paren
id|value
comma
id|addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unknown_minor_dev
r_static
r_int
id|unknown_minor_dev
c_func
(paren
r_char
op_star
id|fname
comma
r_int
id|dev
)paren
(brace
multiline_comment|/* printk(&quot;%s: Unknown minor device %d&bslash;n&quot;, fname, dev); */
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
DECL|function|sound_ioctl
r_static
r_int
id|sound_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
r_int
id|dev
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|u_long
id|fmt
suffix:semicolon
r_switch
c_cond
(paren
id|dev
op_amp
l_int|0x0f
)paren
(brace
r_case
id|SND_DEV_STATUS
suffix:colon
r_return
op_minus
id|EPERM
suffix:semicolon
r_case
id|SND_DEV_CTL
suffix:colon
r_return
id|mixer_ioctl
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|SND_DEV_AUDIO
suffix:colon
r_case
id|SND_DEV_DSP
suffix:colon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDCTL_DSP_RESET
suffix:colon
id|sq_reset
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_POST
suffix:colon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
r_return
id|sound_fsync
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
multiline_comment|/* ++TeSche: before changing any of these it&squot;s probably wise to&n;&t;&t; * wait until sound playing has settled down&n;&t;&t; */
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
id|sound_fsync
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_speed
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
id|sound_fsync
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_stereo
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
)paren
)paren
suffix:semicolon
r_case
id|SOUND_PCM_WRITE_CHANNELS
suffix:colon
id|sound_fsync
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_stereo
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
op_minus
l_int|1
)paren
op_plus
l_int|1
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFMT
suffix:colon
id|sound_fsync
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_format
c_func
(paren
id|IOCTL_IN
c_func
(paren
id|arg
)paren
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETFMTS
suffix:colon
id|fmt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans
)paren
(brace
r_if
c_cond
(paren
id|sound.trans-&gt;ct_ulaw
)paren
id|fmt
op_or_assign
id|AFMT_MU_LAW
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_alaw
)paren
id|fmt
op_or_assign
id|AFMT_A_LAW
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_s8
)paren
id|fmt
op_or_assign
id|AFMT_S8
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_u8
)paren
id|fmt
op_or_assign
id|AFMT_U8
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_s16be
)paren
id|fmt
op_or_assign
id|AFMT_S16_BE
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_u16be
)paren
id|fmt
op_or_assign
id|AFMT_U16_BE
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_s16le
)paren
id|fmt
op_or_assign
id|AFMT_S16_LE
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_u16le
)paren
id|fmt
op_or_assign
id|AFMT_U16_LE
suffix:semicolon
)brace
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|fmt
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
l_int|10240
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|mixer_ioctl
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|unknown_minor_dev
c_func
(paren
l_string|&quot;sound_ioctl&quot;
comma
id|dev
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|sound_fops
r_static
r_struct
id|file_operations
id|sound_fops
op_assign
(brace
id|sound_lseek
comma
id|sound_read
comma
id|sound_write
comma
l_int|NULL
comma
l_int|NULL
comma
multiline_comment|/* select */
id|sound_ioctl
comma
l_int|NULL
comma
id|sound_open
comma
id|sound_release
comma
id|sound_fsync
)brace
suffix:semicolon
multiline_comment|/*** Config &amp; Setup **********************************************************/
DECL|function|soundcard_init
r_void
id|soundcard_init
c_func
(paren
r_void
)paren
(brace
r_int
id|has_sound
op_assign
l_int|0
suffix:semicolon
r_char
op_star
op_star
id|buffers
suffix:semicolon
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|boot_info.machtype
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|MACH_ATARI
suffix:colon
r_if
c_cond
(paren
id|ATARIHW_PRESENT
c_func
(paren
id|PCM_8BIT
)paren
)paren
(brace
r_if
c_cond
(paren
id|ATARIHW_PRESENT
c_func
(paren
id|CODEC
)paren
)paren
id|sound.mach
op_assign
id|machFalcon
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ATARIHW_PRESENT
c_func
(paren
id|MICROWIRE
)paren
)paren
id|sound.mach
op_assign
id|machTT
suffix:semicolon
r_else
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mfp.int_en_a
op_amp
id|mfp.int_mk_a
op_amp
l_int|0x20
)paren
op_eq
l_int|0
)paren
id|has_sound
op_assign
l_int|1
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;DMA sound driver: Timer A interrupt already in use&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|MACH_AMIGA
suffix:colon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|AMI_AUDIO
)paren
)paren
(brace
id|sound.mach
op_assign
id|machAmiga
suffix:semicolon
id|has_sound
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
r_if
c_cond
(paren
op_logical_neg
id|has_sound
)paren
r_return
suffix:semicolon
multiline_comment|/* Set up sound queue, /dev/audio and /dev/dsp. */
id|buffers
op_assign
id|kmalloc
(paren
id|numBufs
op_star
r_sizeof
(paren
r_char
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffers
)paren
(brace
id|out_of_memory
suffix:colon
id|printk
c_func
(paren
l_string|&quot;DMA sound driver: Not enough buffer memory, driver disabled!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numBufs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buffers
(braket
id|i
)braket
op_assign
id|sound.mach.dma_alloc
(paren
id|bufSize
op_lshift
l_int|10
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffers
(braket
id|i
)braket
)paren
(brace
r_while
c_loop
(paren
id|i
op_decrement
)paren
id|sound.mach.dma_free
(paren
id|buffers
(braket
id|i
)braket
comma
id|bufSize
op_lshift
l_int|10
)paren
suffix:semicolon
id|kfree
(paren
id|buffers
)paren
suffix:semicolon
r_goto
id|out_of_memory
suffix:semicolon
)brace
)brace
multiline_comment|/* Register driver with the VFS. */
id|register_chrdev
c_func
(paren
id|SOUND_MAJOR
comma
l_string|&quot;sound&quot;
comma
op_amp
id|sound_fops
)paren
suffix:semicolon
id|sq_init
c_func
(paren
id|numBufs
comma
id|bufSize
op_lshift
l_int|10
comma
id|buffers
)paren
suffix:semicolon
multiline_comment|/* Set up /dev/sndstat. */
id|state_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Set up /dev/mixer. */
id|mixer_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.mach
dot
id|irqinit
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DMA sound driver: Interrupt initialization failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;DMA sound driver installed, using %d buffers of %dk.&bslash;n&quot;
comma
id|numBufs
comma
id|bufSize
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|sound_setup
r_void
id|sound_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
(brace
multiline_comment|/* ++Martin: stub, could possibly be merged with soundcard.c et al later */
)brace
DECL|function|dmasound_setup
r_void
id|dmasound_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
(brace
multiline_comment|/* check the bootstrap parameter for &quot;dmasound=&quot; */
r_switch
c_cond
(paren
id|ints
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|3
suffix:colon
r_if
c_cond
(paren
(paren
id|ints
(braket
l_int|3
)braket
OL
l_int|0
)paren
op_logical_or
(paren
id|ints
(braket
l_int|3
)braket
OG
id|MAX_CATCH_RADIUS
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;dmasound_setup: illegal catch radius, using default = %d&bslash;n&quot;
comma
id|catchRadius
)paren
suffix:semicolon
r_else
id|catchRadius
op_assign
id|ints
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* fall through */
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|1
)braket
OL
id|MIN_BUFFERS
)paren
id|printk
c_func
(paren
l_string|&quot;dmasound_setup: illegal number of buffers, using default = %d&bslash;n&quot;
comma
id|numBufs
)paren
suffix:semicolon
r_else
id|numBufs
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ints
(braket
l_int|2
)braket
template_param
id|MAX_BUFSIZE
)paren
id|printk
c_func
(paren
l_string|&quot;dmasound_setup: illegal buffer size, using default = %d&bslash;n&quot;
comma
id|bufSize
)paren
suffix:semicolon
r_else
id|bufSize
op_assign
id|ints
(braket
l_int|2
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;dmasound_setup: illegal number of arguments&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
eof
