multiline_comment|/* linux/drivers/sound/dmasound.c */
multiline_comment|/*&n;&n;OSS/Free compatible Atari TT/Falcon and Amiga DMA sound driver for Linux/m68k&n;Extended to support Power Macintosh for Linux/ppc by Paul Mackerras&n;&n;(c) 1995 by Michael Schlueter &amp; Michael Marte&n;&n;Michael Schlueter (michael@duck.syd.de) did the basic structure of the VFS&n;interface and the u-law to signed byte conversion.&n;&n;Michael Marte (marte@informatik.uni-muenchen.de) did the sound queue,&n;/dev/mixer, /dev/sndstat and complemented the VFS interface. He would like&n;to thank:&n;Michael Schlueter for initial ideas and documentation on the MFP and&n;the DMA sound hardware.&n;Therapy? for their CD &squot;Troublegum&squot; which really made me rock.&n;&n;/dev/sndstat is based on code by Hannu Savolainen, the author of the&n;VoxWare family of drivers.&n;&n;This file is subject to the terms and conditions of the GNU General Public&n;License.  See the file COPYING in the main directory of this archive&n;for more details.&n;&n;History:&n;1995/8/25&t;first release&n;&n;1995/9/02&t;++roman: fixed atari_stram_alloc() call, the timer programming&n;&t;&t;&t;and several race conditions&n;&n;1995/9/14&t;++roman: After some discussion with Michael Schlueter, revised&n;&t;&t;&t;the interrupt disabling&n;&t;&t;&t;Slightly speeded up U8-&gt;S8 translation by using long&n;&t;&t;&t;operations where possible&n;&t;&t;&t;Added 4:3 interpolation for /dev/audio&n;&n;1995/9/20&t;++TeSche: Fixed a bug in sq_write and changed /dev/audio&n;&t;&t;&t;converting to play at 12517Hz instead of 6258Hz.&n;&n;1995/9/23&t;++TeSche: Changed sq_interrupt() and sq_play() to pre-program&n;&t;&t;&t;the DMA for another frame while there&squot;s still one&n;&t;&t;&t;running. This allows the IRQ response to be&n;&t;&t;&t;arbitrarily delayed and playing will still continue.&n;&n;1995/10/14&t;++Guenther_Kelleter@ac3.maus.de, ++TeSche: better support for&n;&t;&t;&t;Falcon audio (the Falcon doesn&squot;t raise an IRQ at the&n;&t;&t;&t;end of a frame, but at the beginning instead!). uses&n;&t;&t;&t;&squot;if (codec_dma)&squot; in lots of places to simply switch&n;&t;&t;&t;between Falcon and TT code.&n;&n;1995/11/06&t;++TeSche: started introducing a hardware abstraction scheme&n;&t;&t;&t;(may perhaps also serve for Amigas?), can now play&n;&t;&t;&t;samples at almost all frequencies by means of a more&n;&t;&t;&t;generalized expand routine, takes a good deal of care&n;&t;&t;&t;to cut data only at sample sizes, buffer size is now&n;&t;&t;&t;a kernel runtime option, implemented fsync() &amp; several&n;&t;&t;&t;minor improvements&n;&t;&t;++Guenther: useful hints and bug fixes, cross-checked it for&n;&t;&t;&t;Falcons&n;&n;1996/3/9&t;++geert: support added for Amiga, A-law, 16-bit little endian.&n;&t;&t;&t;Unification to drivers/sound/dmasound.c.&n;&n;1996/4/6&t;++Martin Mitchell: updated to 1.3 kernel.&n;&n;1996/6/13       ++topi: fixed things that were broken (mainly the amiga&n;                        14-bit routines), /dev/sndstat shows now the real&n;                        hardware frequency, the lowpass filter is disabled&n;&t;&t;&t;by default now.&n;&n;1996/9/25&t;++geert: modularization&n;&n;1998-06-10&t;++andreas: converted to use sound_core&n;&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/sound.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#ifdef __mc68000__
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifdef CONFIG_ATARI
macro_line|#include &lt;asm/atarihw.h&gt;
macro_line|#include &lt;asm/atariints.h&gt;
macro_line|#include &lt;asm/atari_stram.h&gt;
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
macro_line|#include &lt;asm/amigahw.h&gt;
macro_line|#include &lt;asm/amigaints.h&gt;
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dbdma.h&gt;
macro_line|#ifdef CONFIG_PMAC_PBOOK
macro_line|#include &lt;asm/adb.h&gt;
macro_line|#include &lt;asm/pmu.h&gt;
macro_line|#endif /* CONFIG_PMAC_PBOOK */
macro_line|#include &quot;awacs_defs.h&quot;
macro_line|#include &lt;linux/nvram.h&gt;
macro_line|#include &lt;linux/vt_kern.h&gt;
macro_line|#endif /* CONFIG_PMAC */
macro_line|#include &quot;dmasound.h&quot;
macro_line|#include &lt;linux/soundcard.h&gt;
DECL|macro|HAS_8BIT_TABLES
mdefine_line|#define HAS_8BIT_TABLES
macro_line|#ifdef MODULE
DECL|variable|sq_unit
r_static
r_int
id|sq_unit
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|mixer_unit
r_static
r_int
id|mixer_unit
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|state_unit
r_static
r_int
id|state_unit
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|irq_installed
r_static
r_int
id|irq_installed
op_assign
l_int|0
suffix:semicolon
macro_line|#endif /* MODULE */
DECL|variable|sound_buffers
r_static
r_char
op_star
op_star
id|sound_buffers
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
r_extern
r_void
id|atari_microwire_cmd
c_func
(paren
r_int
id|cmd
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
multiline_comment|/*&n;    *&t;The minimum period for audio depends on htotal (for OCS/ECS/AGA)&n;    *&t;(Imported from arch/m68k/amiga/amisound.c)&n;    */
r_extern
r_volatile
id|u_short
id|amiga_audio_min_period
suffix:semicolon
multiline_comment|/*&n;    *&t;amiga_mksound() should be able to restore the period after beeping&n;    *&t;(Imported from arch/m68k/amiga/amisound.c)&n;    */
r_extern
id|u_short
id|amiga_audio_period
suffix:semicolon
multiline_comment|/*&n;    *&t;Audio DMA masks&n;    */
DECL|macro|AMI_AUDIO_OFF
mdefine_line|#define AMI_AUDIO_OFF&t;(DMAF_AUD0 | DMAF_AUD1 | DMAF_AUD2 | DMAF_AUD3)
DECL|macro|AMI_AUDIO_8
mdefine_line|#define AMI_AUDIO_8&t;(DMAF_SETCLR | DMAF_MASTER | DMAF_AUD0 | DMAF_AUD1)
DECL|macro|AMI_AUDIO_14
mdefine_line|#define AMI_AUDIO_14&t;(AMI_AUDIO_8 | DMAF_AUD2 | DMAF_AUD3)
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
multiline_comment|/*&n; * Interrupt numbers and addresses, obtained from the device tree.&n; */
DECL|variable|awacs_irq
DECL|variable|awacs_tx_irq
DECL|variable|awacs_rx_irq
r_static
r_int
id|awacs_irq
comma
id|awacs_tx_irq
comma
id|awacs_rx_irq
suffix:semicolon
DECL|variable|awacs
r_static
r_volatile
r_struct
id|awacs_regs
op_star
id|awacs
suffix:semicolon
DECL|variable|awacs_txdma
DECL|variable|awacs_rxdma
r_static
r_volatile
r_struct
id|dbdma_regs
op_star
id|awacs_txdma
comma
op_star
id|awacs_rxdma
suffix:semicolon
DECL|variable|awacs_rate_index
r_static
r_int
id|awacs_rate_index
suffix:semicolon
DECL|variable|awacs_subframe
r_static
r_int
id|awacs_subframe
suffix:semicolon
multiline_comment|/*&n; * Space for the DBDMA command blocks.&n; */
DECL|variable|awacs_tx_cmd_space
r_static
r_void
op_star
id|awacs_tx_cmd_space
suffix:semicolon
DECL|variable|awacs_tx_cmds
r_static
r_volatile
r_struct
id|dbdma_cmd
op_star
id|awacs_tx_cmds
suffix:semicolon
multiline_comment|/*&n; * Cached values of AWACS registers (we can&squot;t read them).&n; */
DECL|variable|awacs_reg
r_int
id|awacs_reg
(braket
l_int|5
)braket
suffix:semicolon
DECL|macro|HAS_16BIT_TABLES
mdefine_line|#define HAS_16BIT_TABLES
DECL|macro|HAS_8BIT_TABLES
macro_line|#undef HAS_8BIT_TABLES
multiline_comment|/*&n; * Stuff for outputting a beep.  The values range from -327 to +327&n; * so we can multiply by an amplitude in the range 0..100 to get a&n; * signed short value to put in the output buffer.&n; */
DECL|variable|beep_wform
r_static
r_int
id|beep_wform
(braket
l_int|256
)braket
op_assign
(brace
l_int|0
comma
l_int|40
comma
l_int|79
comma
l_int|117
comma
l_int|153
comma
l_int|187
comma
l_int|218
comma
l_int|245
comma
l_int|269
comma
l_int|288
comma
l_int|304
comma
l_int|316
comma
l_int|323
comma
l_int|327
comma
l_int|327
comma
l_int|324
comma
l_int|318
comma
l_int|310
comma
l_int|299
comma
l_int|288
comma
l_int|275
comma
l_int|262
comma
l_int|249
comma
l_int|236
comma
l_int|224
comma
l_int|213
comma
l_int|204
comma
l_int|196
comma
l_int|190
comma
l_int|186
comma
l_int|183
comma
l_int|182
comma
l_int|182
comma
l_int|183
comma
l_int|186
comma
l_int|189
comma
l_int|192
comma
l_int|196
comma
l_int|200
comma
l_int|203
comma
l_int|206
comma
l_int|208
comma
l_int|209
comma
l_int|209
comma
l_int|209
comma
l_int|207
comma
l_int|204
comma
l_int|201
comma
l_int|197
comma
l_int|193
comma
l_int|188
comma
l_int|183
comma
l_int|179
comma
l_int|174
comma
l_int|170
comma
l_int|166
comma
l_int|163
comma
l_int|161
comma
l_int|160
comma
l_int|159
comma
l_int|159
comma
l_int|160
comma
l_int|161
comma
l_int|162
comma
l_int|164
comma
l_int|166
comma
l_int|168
comma
l_int|169
comma
l_int|171
comma
l_int|171
comma
l_int|171
comma
l_int|170
comma
l_int|169
comma
l_int|167
comma
l_int|163
comma
l_int|159
comma
l_int|155
comma
l_int|150
comma
l_int|144
comma
l_int|139
comma
l_int|133
comma
l_int|128
comma
l_int|122
comma
l_int|117
comma
l_int|113
comma
l_int|110
comma
l_int|107
comma
l_int|105
comma
l_int|103
comma
l_int|103
comma
l_int|103
comma
l_int|103
comma
l_int|104
comma
l_int|104
comma
l_int|105
comma
l_int|105
comma
l_int|105
comma
l_int|103
comma
l_int|101
comma
l_int|97
comma
l_int|92
comma
l_int|86
comma
l_int|78
comma
l_int|68
comma
l_int|58
comma
l_int|45
comma
l_int|32
comma
l_int|18
comma
l_int|3
comma
op_minus
l_int|11
comma
op_minus
l_int|26
comma
op_minus
l_int|41
comma
op_minus
l_int|55
comma
op_minus
l_int|68
comma
op_minus
l_int|79
comma
op_minus
l_int|88
comma
op_minus
l_int|95
comma
op_minus
l_int|100
comma
op_minus
l_int|102
comma
op_minus
l_int|102
comma
op_minus
l_int|99
comma
op_minus
l_int|93
comma
op_minus
l_int|85
comma
op_minus
l_int|75
comma
op_minus
l_int|62
comma
op_minus
l_int|48
comma
op_minus
l_int|33
comma
op_minus
l_int|16
comma
l_int|0
comma
l_int|16
comma
l_int|33
comma
l_int|48
comma
l_int|62
comma
l_int|75
comma
l_int|85
comma
l_int|93
comma
l_int|99
comma
l_int|102
comma
l_int|102
comma
l_int|100
comma
l_int|95
comma
l_int|88
comma
l_int|79
comma
l_int|68
comma
l_int|55
comma
l_int|41
comma
l_int|26
comma
l_int|11
comma
op_minus
l_int|3
comma
op_minus
l_int|18
comma
op_minus
l_int|32
comma
op_minus
l_int|45
comma
op_minus
l_int|58
comma
op_minus
l_int|68
comma
op_minus
l_int|78
comma
op_minus
l_int|86
comma
op_minus
l_int|92
comma
op_minus
l_int|97
comma
op_minus
l_int|101
comma
op_minus
l_int|103
comma
op_minus
l_int|105
comma
op_minus
l_int|105
comma
op_minus
l_int|105
comma
op_minus
l_int|104
comma
op_minus
l_int|104
comma
op_minus
l_int|103
comma
op_minus
l_int|103
comma
op_minus
l_int|103
comma
op_minus
l_int|103
comma
op_minus
l_int|105
comma
op_minus
l_int|107
comma
op_minus
l_int|110
comma
op_minus
l_int|113
comma
op_minus
l_int|117
comma
op_minus
l_int|122
comma
op_minus
l_int|128
comma
op_minus
l_int|133
comma
op_minus
l_int|139
comma
op_minus
l_int|144
comma
op_minus
l_int|150
comma
op_minus
l_int|155
comma
op_minus
l_int|159
comma
op_minus
l_int|163
comma
op_minus
l_int|167
comma
op_minus
l_int|169
comma
op_minus
l_int|170
comma
op_minus
l_int|171
comma
op_minus
l_int|171
comma
op_minus
l_int|171
comma
op_minus
l_int|169
comma
op_minus
l_int|168
comma
op_minus
l_int|166
comma
op_minus
l_int|164
comma
op_minus
l_int|162
comma
op_minus
l_int|161
comma
op_minus
l_int|160
comma
op_minus
l_int|159
comma
op_minus
l_int|159
comma
op_minus
l_int|160
comma
op_minus
l_int|161
comma
op_minus
l_int|163
comma
op_minus
l_int|166
comma
op_minus
l_int|170
comma
op_minus
l_int|174
comma
op_minus
l_int|179
comma
op_minus
l_int|183
comma
op_minus
l_int|188
comma
op_minus
l_int|193
comma
op_minus
l_int|197
comma
op_minus
l_int|201
comma
op_minus
l_int|204
comma
op_minus
l_int|207
comma
op_minus
l_int|209
comma
op_minus
l_int|209
comma
op_minus
l_int|209
comma
op_minus
l_int|208
comma
op_minus
l_int|206
comma
op_minus
l_int|203
comma
op_minus
l_int|200
comma
op_minus
l_int|196
comma
op_minus
l_int|192
comma
op_minus
l_int|189
comma
op_minus
l_int|186
comma
op_minus
l_int|183
comma
op_minus
l_int|182
comma
op_minus
l_int|182
comma
op_minus
l_int|183
comma
op_minus
l_int|186
comma
op_minus
l_int|190
comma
op_minus
l_int|196
comma
op_minus
l_int|204
comma
op_minus
l_int|213
comma
op_minus
l_int|224
comma
op_minus
l_int|236
comma
op_minus
l_int|249
comma
op_minus
l_int|262
comma
op_minus
l_int|275
comma
op_minus
l_int|288
comma
op_minus
l_int|299
comma
op_minus
l_int|310
comma
op_minus
l_int|318
comma
op_minus
l_int|324
comma
op_minus
l_int|327
comma
op_minus
l_int|327
comma
op_minus
l_int|323
comma
op_minus
l_int|316
comma
op_minus
l_int|304
comma
op_minus
l_int|288
comma
op_minus
l_int|269
comma
op_minus
l_int|245
comma
op_minus
l_int|218
comma
op_minus
l_int|187
comma
op_minus
l_int|153
comma
op_minus
l_int|117
comma
op_minus
l_int|79
comma
op_minus
l_int|40
comma
)brace
suffix:semicolon
DECL|macro|BEEP_SPEED
mdefine_line|#define BEEP_SPEED&t;2&t;/* 22050 Hz sample rate */
DECL|macro|BEEP_BUFLEN
mdefine_line|#define BEEP_BUFLEN&t;512
DECL|macro|BEEP_VOLUME
mdefine_line|#define BEEP_VOLUME&t;15&t;/* 0 - 100 */
DECL|variable|beep_volume
r_static
r_int
id|beep_volume
op_assign
id|BEEP_VOLUME
suffix:semicolon
DECL|variable|beep_playing
r_static
r_int
id|beep_playing
op_assign
l_int|0
suffix:semicolon
DECL|variable|beep_buf
r_static
r_int
op_star
id|beep_buf
suffix:semicolon
DECL|variable|beep_dbdma_cmd
r_static
r_volatile
r_struct
id|dbdma_cmd
op_star
id|beep_dbdma_cmd
suffix:semicolon
DECL|variable|orig_mksound
r_static
r_void
(paren
op_star
id|orig_mksound
)paren
(paren
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
multiline_comment|/*&n; * Stuff for restoring after a sleep.&n; */
r_static
r_int
id|awacs_sleep_notify
c_func
(paren
r_struct
id|notifier_block
op_star
comma
r_int
r_int
comma
r_void
op_star
)paren
suffix:semicolon
DECL|variable|awacs_sleep_notifier
r_struct
id|notifier_block
id|awacs_sleep_notifier
op_assign
(brace
id|awacs_sleep_notify
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_PBOOK */
macro_line|#endif /* CONFIG_PMAC */
multiline_comment|/*** Some declarations *******************************************************/
DECL|macro|DMASND_TT
mdefine_line|#define DMASND_TT&t;&t;1
DECL|macro|DMASND_FALCON
mdefine_line|#define DMASND_FALCON&t;&t;2
DECL|macro|DMASND_AMIGA
mdefine_line|#define DMASND_AMIGA&t;&t;3
DECL|macro|DMASND_AWACS
mdefine_line|#define DMASND_AWACS&t;&t;4
DECL|macro|MAX_CATCH_RADIUS
mdefine_line|#define MAX_CATCH_RADIUS&t;10
DECL|macro|MIN_BUFFERS
mdefine_line|#define MIN_BUFFERS&t;&t;4
DECL|macro|MIN_BUFSIZE
mdefine_line|#define MIN_BUFSIZE &t;&t;4
DECL|macro|MAX_BUFSIZE
mdefine_line|#define MAX_BUFSIZE&t;&t;128&t;/* Limit for Amiga */
DECL|variable|catchRadius
DECL|variable|numBufs
DECL|variable|bufSize
r_static
r_int
id|catchRadius
op_assign
l_int|0
comma
id|numBufs
op_assign
l_int|4
comma
id|bufSize
op_assign
l_int|32
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|catchRadius
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|numBufs
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|bufSize
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|macro|arraysize
mdefine_line|#define arraysize(x)&t;(sizeof(x)/sizeof(*(x)))
DECL|macro|min
mdefine_line|#define min(x, y)&t;((x) &lt; (y) ? (x) : (y))
DECL|macro|le2be16
mdefine_line|#define le2be16(x)&t;(((x)&lt;&lt;8 &amp; 0xff00) | ((x)&gt;&gt;8 &amp; 0x00ff))
DECL|macro|le2be16dbl
mdefine_line|#define le2be16dbl(x)&t;(((x)&lt;&lt;8 &amp; 0xff00ff00) | ((x)&gt;&gt;8 &amp; 0x00ff00ff))
DECL|macro|IOCTL_IN
mdefine_line|#define IOCTL_IN(arg, ret) &bslash;&n;&t;do { int error = get_user(ret, (int *)(arg)); &bslash;&n;&t;&t;if (error) return error; &bslash;&n;&t;} while (0)
DECL|macro|IOCTL_OUT
mdefine_line|#define IOCTL_OUT(arg, ret)&t;ioctl_return((int *)(arg), ret)
multiline_comment|/*** Some low level helpers **************************************************/
macro_line|#ifdef HAS_8BIT_TABLES
multiline_comment|/* 8 bit mu-law */
DECL|variable|ulaw2dma8
r_static
r_char
id|ulaw2dma8
(braket
)braket
op_assign
(brace
op_minus
l_int|126
comma
op_minus
l_int|122
comma
op_minus
l_int|118
comma
op_minus
l_int|114
comma
op_minus
l_int|110
comma
op_minus
l_int|106
comma
op_minus
l_int|102
comma
op_minus
l_int|98
comma
op_minus
l_int|94
comma
op_minus
l_int|90
comma
op_minus
l_int|86
comma
op_minus
l_int|82
comma
op_minus
l_int|78
comma
op_minus
l_int|74
comma
op_minus
l_int|70
comma
op_minus
l_int|66
comma
op_minus
l_int|63
comma
op_minus
l_int|61
comma
op_minus
l_int|59
comma
op_minus
l_int|57
comma
op_minus
l_int|55
comma
op_minus
l_int|53
comma
op_minus
l_int|51
comma
op_minus
l_int|49
comma
op_minus
l_int|47
comma
op_minus
l_int|45
comma
op_minus
l_int|43
comma
op_minus
l_int|41
comma
op_minus
l_int|39
comma
op_minus
l_int|37
comma
op_minus
l_int|35
comma
op_minus
l_int|33
comma
op_minus
l_int|31
comma
op_minus
l_int|30
comma
op_minus
l_int|29
comma
op_minus
l_int|28
comma
op_minus
l_int|27
comma
op_minus
l_int|26
comma
op_minus
l_int|25
comma
op_minus
l_int|24
comma
op_minus
l_int|23
comma
op_minus
l_int|22
comma
op_minus
l_int|21
comma
op_minus
l_int|20
comma
op_minus
l_int|19
comma
op_minus
l_int|18
comma
op_minus
l_int|17
comma
op_minus
l_int|16
comma
op_minus
l_int|16
comma
op_minus
l_int|15
comma
op_minus
l_int|15
comma
op_minus
l_int|14
comma
op_minus
l_int|14
comma
op_minus
l_int|13
comma
op_minus
l_int|13
comma
op_minus
l_int|12
comma
op_minus
l_int|12
comma
op_minus
l_int|11
comma
op_minus
l_int|11
comma
op_minus
l_int|10
comma
op_minus
l_int|10
comma
op_minus
l_int|9
comma
op_minus
l_int|9
comma
op_minus
l_int|8
comma
op_minus
l_int|8
comma
op_minus
l_int|8
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|0
comma
l_int|125
comma
l_int|121
comma
l_int|117
comma
l_int|113
comma
l_int|109
comma
l_int|105
comma
l_int|101
comma
l_int|97
comma
l_int|93
comma
l_int|89
comma
l_int|85
comma
l_int|81
comma
l_int|77
comma
l_int|73
comma
l_int|69
comma
l_int|65
comma
l_int|62
comma
l_int|60
comma
l_int|58
comma
l_int|56
comma
l_int|54
comma
l_int|52
comma
l_int|50
comma
l_int|48
comma
l_int|46
comma
l_int|44
comma
l_int|42
comma
l_int|40
comma
l_int|38
comma
l_int|36
comma
l_int|34
comma
l_int|32
comma
l_int|30
comma
l_int|29
comma
l_int|28
comma
l_int|27
comma
l_int|26
comma
l_int|25
comma
l_int|24
comma
l_int|23
comma
l_int|22
comma
l_int|21
comma
l_int|20
comma
l_int|19
comma
l_int|18
comma
l_int|17
comma
l_int|16
comma
l_int|15
comma
l_int|15
comma
l_int|14
comma
l_int|14
comma
l_int|13
comma
l_int|13
comma
l_int|12
comma
l_int|12
comma
l_int|11
comma
l_int|11
comma
l_int|10
comma
l_int|10
comma
l_int|9
comma
l_int|9
comma
l_int|8
comma
l_int|8
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* 8 bit A-law */
DECL|variable|alaw2dma8
r_static
r_char
id|alaw2dma8
(braket
)braket
op_assign
(brace
op_minus
l_int|22
comma
op_minus
l_int|21
comma
op_minus
l_int|24
comma
op_minus
l_int|23
comma
op_minus
l_int|18
comma
op_minus
l_int|17
comma
op_minus
l_int|20
comma
op_minus
l_int|19
comma
op_minus
l_int|30
comma
op_minus
l_int|29
comma
op_minus
l_int|32
comma
op_minus
l_int|31
comma
op_minus
l_int|26
comma
op_minus
l_int|25
comma
op_minus
l_int|28
comma
op_minus
l_int|27
comma
op_minus
l_int|11
comma
op_minus
l_int|11
comma
op_minus
l_int|12
comma
op_minus
l_int|12
comma
op_minus
l_int|9
comma
op_minus
l_int|9
comma
op_minus
l_int|10
comma
op_minus
l_int|10
comma
op_minus
l_int|15
comma
op_minus
l_int|15
comma
op_minus
l_int|16
comma
op_minus
l_int|16
comma
op_minus
l_int|13
comma
op_minus
l_int|13
comma
op_minus
l_int|14
comma
op_minus
l_int|14
comma
op_minus
l_int|86
comma
op_minus
l_int|82
comma
op_minus
l_int|94
comma
op_minus
l_int|90
comma
op_minus
l_int|70
comma
op_minus
l_int|66
comma
op_minus
l_int|78
comma
op_minus
l_int|74
comma
op_minus
l_int|118
comma
op_minus
l_int|114
comma
op_minus
l_int|126
comma
op_minus
l_int|122
comma
op_minus
l_int|102
comma
op_minus
l_int|98
comma
op_minus
l_int|110
comma
op_minus
l_int|106
comma
op_minus
l_int|43
comma
op_minus
l_int|41
comma
op_minus
l_int|47
comma
op_minus
l_int|45
comma
op_minus
l_int|35
comma
op_minus
l_int|33
comma
op_minus
l_int|39
comma
op_minus
l_int|37
comma
op_minus
l_int|59
comma
op_minus
l_int|57
comma
op_minus
l_int|63
comma
op_minus
l_int|61
comma
op_minus
l_int|51
comma
op_minus
l_int|49
comma
op_minus
l_int|55
comma
op_minus
l_int|53
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|2
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|6
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|5
comma
op_minus
l_int|8
comma
op_minus
l_int|8
comma
op_minus
l_int|8
comma
op_minus
l_int|8
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|7
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|3
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
op_minus
l_int|4
comma
l_int|21
comma
l_int|20
comma
l_int|23
comma
l_int|22
comma
l_int|17
comma
l_int|16
comma
l_int|19
comma
l_int|18
comma
l_int|29
comma
l_int|28
comma
l_int|31
comma
l_int|30
comma
l_int|25
comma
l_int|24
comma
l_int|27
comma
l_int|26
comma
l_int|10
comma
l_int|10
comma
l_int|11
comma
l_int|11
comma
l_int|8
comma
l_int|8
comma
l_int|9
comma
l_int|9
comma
l_int|14
comma
l_int|14
comma
l_int|15
comma
l_int|15
comma
l_int|12
comma
l_int|12
comma
l_int|13
comma
l_int|13
comma
l_int|86
comma
l_int|82
comma
l_int|94
comma
l_int|90
comma
l_int|70
comma
l_int|66
comma
l_int|78
comma
l_int|74
comma
l_int|118
comma
l_int|114
comma
l_int|126
comma
l_int|122
comma
l_int|102
comma
l_int|98
comma
l_int|110
comma
l_int|106
comma
l_int|43
comma
l_int|41
comma
l_int|47
comma
l_int|45
comma
l_int|35
comma
l_int|33
comma
l_int|39
comma
l_int|37
comma
l_int|59
comma
l_int|57
comma
l_int|63
comma
l_int|61
comma
l_int|51
comma
l_int|49
comma
l_int|55
comma
l_int|53
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
)brace
suffix:semicolon
macro_line|#endif /* HAS_8BIT_TABLES */
macro_line|#ifdef HAS_16BIT_TABLES
multiline_comment|/* 16 bit mu-law */
DECL|variable|ulaw2dma16
r_static
r_int
id|ulaw2dma16
(braket
)braket
op_assign
(brace
op_minus
l_int|32124
comma
op_minus
l_int|31100
comma
op_minus
l_int|30076
comma
op_minus
l_int|29052
comma
op_minus
l_int|28028
comma
op_minus
l_int|27004
comma
op_minus
l_int|25980
comma
op_minus
l_int|24956
comma
op_minus
l_int|23932
comma
op_minus
l_int|22908
comma
op_minus
l_int|21884
comma
op_minus
l_int|20860
comma
op_minus
l_int|19836
comma
op_minus
l_int|18812
comma
op_minus
l_int|17788
comma
op_minus
l_int|16764
comma
op_minus
l_int|15996
comma
op_minus
l_int|15484
comma
op_minus
l_int|14972
comma
op_minus
l_int|14460
comma
op_minus
l_int|13948
comma
op_minus
l_int|13436
comma
op_minus
l_int|12924
comma
op_minus
l_int|12412
comma
op_minus
l_int|11900
comma
op_minus
l_int|11388
comma
op_minus
l_int|10876
comma
op_minus
l_int|10364
comma
op_minus
l_int|9852
comma
op_minus
l_int|9340
comma
op_minus
l_int|8828
comma
op_minus
l_int|8316
comma
op_minus
l_int|7932
comma
op_minus
l_int|7676
comma
op_minus
l_int|7420
comma
op_minus
l_int|7164
comma
op_minus
l_int|6908
comma
op_minus
l_int|6652
comma
op_minus
l_int|6396
comma
op_minus
l_int|6140
comma
op_minus
l_int|5884
comma
op_minus
l_int|5628
comma
op_minus
l_int|5372
comma
op_minus
l_int|5116
comma
op_minus
l_int|4860
comma
op_minus
l_int|4604
comma
op_minus
l_int|4348
comma
op_minus
l_int|4092
comma
op_minus
l_int|3900
comma
op_minus
l_int|3772
comma
op_minus
l_int|3644
comma
op_minus
l_int|3516
comma
op_minus
l_int|3388
comma
op_minus
l_int|3260
comma
op_minus
l_int|3132
comma
op_minus
l_int|3004
comma
op_minus
l_int|2876
comma
op_minus
l_int|2748
comma
op_minus
l_int|2620
comma
op_minus
l_int|2492
comma
op_minus
l_int|2364
comma
op_minus
l_int|2236
comma
op_minus
l_int|2108
comma
op_minus
l_int|1980
comma
op_minus
l_int|1884
comma
op_minus
l_int|1820
comma
op_minus
l_int|1756
comma
op_minus
l_int|1692
comma
op_minus
l_int|1628
comma
op_minus
l_int|1564
comma
op_minus
l_int|1500
comma
op_minus
l_int|1436
comma
op_minus
l_int|1372
comma
op_minus
l_int|1308
comma
op_minus
l_int|1244
comma
op_minus
l_int|1180
comma
op_minus
l_int|1116
comma
op_minus
l_int|1052
comma
op_minus
l_int|988
comma
op_minus
l_int|924
comma
op_minus
l_int|876
comma
op_minus
l_int|844
comma
op_minus
l_int|812
comma
op_minus
l_int|780
comma
op_minus
l_int|748
comma
op_minus
l_int|716
comma
op_minus
l_int|684
comma
op_minus
l_int|652
comma
op_minus
l_int|620
comma
op_minus
l_int|588
comma
op_minus
l_int|556
comma
op_minus
l_int|524
comma
op_minus
l_int|492
comma
op_minus
l_int|460
comma
op_minus
l_int|428
comma
op_minus
l_int|396
comma
op_minus
l_int|372
comma
op_minus
l_int|356
comma
op_minus
l_int|340
comma
op_minus
l_int|324
comma
op_minus
l_int|308
comma
op_minus
l_int|292
comma
op_minus
l_int|276
comma
op_minus
l_int|260
comma
op_minus
l_int|244
comma
op_minus
l_int|228
comma
op_minus
l_int|212
comma
op_minus
l_int|196
comma
op_minus
l_int|180
comma
op_minus
l_int|164
comma
op_minus
l_int|148
comma
op_minus
l_int|132
comma
op_minus
l_int|120
comma
op_minus
l_int|112
comma
op_minus
l_int|104
comma
op_minus
l_int|96
comma
op_minus
l_int|88
comma
op_minus
l_int|80
comma
op_minus
l_int|72
comma
op_minus
l_int|64
comma
op_minus
l_int|56
comma
op_minus
l_int|48
comma
op_minus
l_int|40
comma
op_minus
l_int|32
comma
op_minus
l_int|24
comma
op_minus
l_int|16
comma
op_minus
l_int|8
comma
l_int|0
comma
l_int|32124
comma
l_int|31100
comma
l_int|30076
comma
l_int|29052
comma
l_int|28028
comma
l_int|27004
comma
l_int|25980
comma
l_int|24956
comma
l_int|23932
comma
l_int|22908
comma
l_int|21884
comma
l_int|20860
comma
l_int|19836
comma
l_int|18812
comma
l_int|17788
comma
l_int|16764
comma
l_int|15996
comma
l_int|15484
comma
l_int|14972
comma
l_int|14460
comma
l_int|13948
comma
l_int|13436
comma
l_int|12924
comma
l_int|12412
comma
l_int|11900
comma
l_int|11388
comma
l_int|10876
comma
l_int|10364
comma
l_int|9852
comma
l_int|9340
comma
l_int|8828
comma
l_int|8316
comma
l_int|7932
comma
l_int|7676
comma
l_int|7420
comma
l_int|7164
comma
l_int|6908
comma
l_int|6652
comma
l_int|6396
comma
l_int|6140
comma
l_int|5884
comma
l_int|5628
comma
l_int|5372
comma
l_int|5116
comma
l_int|4860
comma
l_int|4604
comma
l_int|4348
comma
l_int|4092
comma
l_int|3900
comma
l_int|3772
comma
l_int|3644
comma
l_int|3516
comma
l_int|3388
comma
l_int|3260
comma
l_int|3132
comma
l_int|3004
comma
l_int|2876
comma
l_int|2748
comma
l_int|2620
comma
l_int|2492
comma
l_int|2364
comma
l_int|2236
comma
l_int|2108
comma
l_int|1980
comma
l_int|1884
comma
l_int|1820
comma
l_int|1756
comma
l_int|1692
comma
l_int|1628
comma
l_int|1564
comma
l_int|1500
comma
l_int|1436
comma
l_int|1372
comma
l_int|1308
comma
l_int|1244
comma
l_int|1180
comma
l_int|1116
comma
l_int|1052
comma
l_int|988
comma
l_int|924
comma
l_int|876
comma
l_int|844
comma
l_int|812
comma
l_int|780
comma
l_int|748
comma
l_int|716
comma
l_int|684
comma
l_int|652
comma
l_int|620
comma
l_int|588
comma
l_int|556
comma
l_int|524
comma
l_int|492
comma
l_int|460
comma
l_int|428
comma
l_int|396
comma
l_int|372
comma
l_int|356
comma
l_int|340
comma
l_int|324
comma
l_int|308
comma
l_int|292
comma
l_int|276
comma
l_int|260
comma
l_int|244
comma
l_int|228
comma
l_int|212
comma
l_int|196
comma
l_int|180
comma
l_int|164
comma
l_int|148
comma
l_int|132
comma
l_int|120
comma
l_int|112
comma
l_int|104
comma
l_int|96
comma
l_int|88
comma
l_int|80
comma
l_int|72
comma
l_int|64
comma
l_int|56
comma
l_int|48
comma
l_int|40
comma
l_int|32
comma
l_int|24
comma
l_int|16
comma
l_int|8
comma
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* 16 bit A-law */
DECL|variable|alaw2dma16
r_static
r_int
id|alaw2dma16
(braket
)braket
op_assign
(brace
op_minus
l_int|5504
comma
op_minus
l_int|5248
comma
op_minus
l_int|6016
comma
op_minus
l_int|5760
comma
op_minus
l_int|4480
comma
op_minus
l_int|4224
comma
op_minus
l_int|4992
comma
op_minus
l_int|4736
comma
op_minus
l_int|7552
comma
op_minus
l_int|7296
comma
op_minus
l_int|8064
comma
op_minus
l_int|7808
comma
op_minus
l_int|6528
comma
op_minus
l_int|6272
comma
op_minus
l_int|7040
comma
op_minus
l_int|6784
comma
op_minus
l_int|2752
comma
op_minus
l_int|2624
comma
op_minus
l_int|3008
comma
op_minus
l_int|2880
comma
op_minus
l_int|2240
comma
op_minus
l_int|2112
comma
op_minus
l_int|2496
comma
op_minus
l_int|2368
comma
op_minus
l_int|3776
comma
op_minus
l_int|3648
comma
op_minus
l_int|4032
comma
op_minus
l_int|3904
comma
op_minus
l_int|3264
comma
op_minus
l_int|3136
comma
op_minus
l_int|3520
comma
op_minus
l_int|3392
comma
op_minus
l_int|22016
comma
op_minus
l_int|20992
comma
op_minus
l_int|24064
comma
op_minus
l_int|23040
comma
op_minus
l_int|17920
comma
op_minus
l_int|16896
comma
op_minus
l_int|19968
comma
op_minus
l_int|18944
comma
op_minus
l_int|30208
comma
op_minus
l_int|29184
comma
op_minus
l_int|32256
comma
op_minus
l_int|31232
comma
op_minus
l_int|26112
comma
op_minus
l_int|25088
comma
op_minus
l_int|28160
comma
op_minus
l_int|27136
comma
op_minus
l_int|11008
comma
op_minus
l_int|10496
comma
op_minus
l_int|12032
comma
op_minus
l_int|11520
comma
op_minus
l_int|8960
comma
op_minus
l_int|8448
comma
op_minus
l_int|9984
comma
op_minus
l_int|9472
comma
op_minus
l_int|15104
comma
op_minus
l_int|14592
comma
op_minus
l_int|16128
comma
op_minus
l_int|15616
comma
op_minus
l_int|13056
comma
op_minus
l_int|12544
comma
op_minus
l_int|14080
comma
op_minus
l_int|13568
comma
op_minus
l_int|344
comma
op_minus
l_int|328
comma
op_minus
l_int|376
comma
op_minus
l_int|360
comma
op_minus
l_int|280
comma
op_minus
l_int|264
comma
op_minus
l_int|312
comma
op_minus
l_int|296
comma
op_minus
l_int|472
comma
op_minus
l_int|456
comma
op_minus
l_int|504
comma
op_minus
l_int|488
comma
op_minus
l_int|408
comma
op_minus
l_int|392
comma
op_minus
l_int|440
comma
op_minus
l_int|424
comma
op_minus
l_int|88
comma
op_minus
l_int|72
comma
op_minus
l_int|120
comma
op_minus
l_int|104
comma
op_minus
l_int|24
comma
op_minus
l_int|8
comma
op_minus
l_int|56
comma
op_minus
l_int|40
comma
op_minus
l_int|216
comma
op_minus
l_int|200
comma
op_minus
l_int|248
comma
op_minus
l_int|232
comma
op_minus
l_int|152
comma
op_minus
l_int|136
comma
op_minus
l_int|184
comma
op_minus
l_int|168
comma
op_minus
l_int|1376
comma
op_minus
l_int|1312
comma
op_minus
l_int|1504
comma
op_minus
l_int|1440
comma
op_minus
l_int|1120
comma
op_minus
l_int|1056
comma
op_minus
l_int|1248
comma
op_minus
l_int|1184
comma
op_minus
l_int|1888
comma
op_minus
l_int|1824
comma
op_minus
l_int|2016
comma
op_minus
l_int|1952
comma
op_minus
l_int|1632
comma
op_minus
l_int|1568
comma
op_minus
l_int|1760
comma
op_minus
l_int|1696
comma
op_minus
l_int|688
comma
op_minus
l_int|656
comma
op_minus
l_int|752
comma
op_minus
l_int|720
comma
op_minus
l_int|560
comma
op_minus
l_int|528
comma
op_minus
l_int|624
comma
op_minus
l_int|592
comma
op_minus
l_int|944
comma
op_minus
l_int|912
comma
op_minus
l_int|1008
comma
op_minus
l_int|976
comma
op_minus
l_int|816
comma
op_minus
l_int|784
comma
op_minus
l_int|880
comma
op_minus
l_int|848
comma
l_int|5504
comma
l_int|5248
comma
l_int|6016
comma
l_int|5760
comma
l_int|4480
comma
l_int|4224
comma
l_int|4992
comma
l_int|4736
comma
l_int|7552
comma
l_int|7296
comma
l_int|8064
comma
l_int|7808
comma
l_int|6528
comma
l_int|6272
comma
l_int|7040
comma
l_int|6784
comma
l_int|2752
comma
l_int|2624
comma
l_int|3008
comma
l_int|2880
comma
l_int|2240
comma
l_int|2112
comma
l_int|2496
comma
l_int|2368
comma
l_int|3776
comma
l_int|3648
comma
l_int|4032
comma
l_int|3904
comma
l_int|3264
comma
l_int|3136
comma
l_int|3520
comma
l_int|3392
comma
l_int|22016
comma
l_int|20992
comma
l_int|24064
comma
l_int|23040
comma
l_int|17920
comma
l_int|16896
comma
l_int|19968
comma
l_int|18944
comma
l_int|30208
comma
l_int|29184
comma
l_int|32256
comma
l_int|31232
comma
l_int|26112
comma
l_int|25088
comma
l_int|28160
comma
l_int|27136
comma
l_int|11008
comma
l_int|10496
comma
l_int|12032
comma
l_int|11520
comma
l_int|8960
comma
l_int|8448
comma
l_int|9984
comma
l_int|9472
comma
l_int|15104
comma
l_int|14592
comma
l_int|16128
comma
l_int|15616
comma
l_int|13056
comma
l_int|12544
comma
l_int|14080
comma
l_int|13568
comma
l_int|344
comma
l_int|328
comma
l_int|376
comma
l_int|360
comma
l_int|280
comma
l_int|264
comma
l_int|312
comma
l_int|296
comma
l_int|472
comma
l_int|456
comma
l_int|504
comma
l_int|488
comma
l_int|408
comma
l_int|392
comma
l_int|440
comma
l_int|424
comma
l_int|88
comma
l_int|72
comma
l_int|120
comma
l_int|104
comma
l_int|24
comma
l_int|8
comma
l_int|56
comma
l_int|40
comma
l_int|216
comma
l_int|200
comma
l_int|248
comma
l_int|232
comma
l_int|152
comma
l_int|136
comma
l_int|184
comma
l_int|168
comma
l_int|1376
comma
l_int|1312
comma
l_int|1504
comma
l_int|1440
comma
l_int|1120
comma
l_int|1056
comma
l_int|1248
comma
l_int|1184
comma
l_int|1888
comma
l_int|1824
comma
l_int|2016
comma
l_int|1952
comma
l_int|1632
comma
l_int|1568
comma
l_int|1760
comma
l_int|1696
comma
l_int|688
comma
l_int|656
comma
l_int|752
comma
l_int|720
comma
l_int|560
comma
l_int|528
comma
l_int|624
comma
l_int|592
comma
l_int|944
comma
l_int|912
comma
l_int|1008
comma
l_int|976
comma
l_int|816
comma
l_int|784
comma
l_int|880
comma
l_int|848
comma
)brace
suffix:semicolon
macro_line|#endif /* HAS_16BIT_TABLES */
macro_line|#ifdef HAS_14BIT_TABLES
multiline_comment|/* 14 bit mu-law (LSB) */
DECL|variable|alaw2dma14l
r_static
r_char
id|alaw2dma14l
(braket
)braket
op_assign
(brace
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|33
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|49
comma
l_int|17
comma
l_int|41
comma
l_int|57
comma
l_int|9
comma
l_int|25
comma
l_int|41
comma
l_int|57
comma
l_int|9
comma
l_int|25
comma
l_int|41
comma
l_int|57
comma
l_int|9
comma
l_int|25
comma
l_int|41
comma
l_int|57
comma
l_int|9
comma
l_int|25
comma
l_int|37
comma
l_int|45
comma
l_int|53
comma
l_int|61
comma
l_int|5
comma
l_int|13
comma
l_int|21
comma
l_int|29
comma
l_int|37
comma
l_int|45
comma
l_int|53
comma
l_int|61
comma
l_int|5
comma
l_int|13
comma
l_int|21
comma
l_int|29
comma
l_int|35
comma
l_int|39
comma
l_int|43
comma
l_int|47
comma
l_int|51
comma
l_int|55
comma
l_int|59
comma
l_int|63
comma
l_int|3
comma
l_int|7
comma
l_int|11
comma
l_int|15
comma
l_int|19
comma
l_int|23
comma
l_int|27
comma
l_int|31
comma
l_int|34
comma
l_int|36
comma
l_int|38
comma
l_int|40
comma
l_int|42
comma
l_int|44
comma
l_int|46
comma
l_int|48
comma
l_int|50
comma
l_int|52
comma
l_int|54
comma
l_int|56
comma
l_int|58
comma
l_int|60
comma
l_int|62
comma
l_int|0
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|31
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|63
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|15
comma
l_int|47
comma
l_int|23
comma
l_int|7
comma
l_int|55
comma
l_int|39
comma
l_int|23
comma
l_int|7
comma
l_int|55
comma
l_int|39
comma
l_int|23
comma
l_int|7
comma
l_int|55
comma
l_int|39
comma
l_int|23
comma
l_int|7
comma
l_int|55
comma
l_int|39
comma
l_int|27
comma
l_int|19
comma
l_int|11
comma
l_int|3
comma
l_int|59
comma
l_int|51
comma
l_int|43
comma
l_int|35
comma
l_int|27
comma
l_int|19
comma
l_int|11
comma
l_int|3
comma
l_int|59
comma
l_int|51
comma
l_int|43
comma
l_int|35
comma
l_int|29
comma
l_int|25
comma
l_int|21
comma
l_int|17
comma
l_int|13
comma
l_int|9
comma
l_int|5
comma
l_int|1
comma
l_int|61
comma
l_int|57
comma
l_int|53
comma
l_int|49
comma
l_int|45
comma
l_int|41
comma
l_int|37
comma
l_int|33
comma
l_int|30
comma
l_int|28
comma
l_int|26
comma
l_int|24
comma
l_int|22
comma
l_int|20
comma
l_int|18
comma
l_int|16
comma
l_int|14
comma
l_int|12
comma
l_int|10
comma
l_int|8
comma
l_int|6
comma
l_int|4
comma
l_int|2
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* 14 bit A-law (LSB) */
DECL|variable|alaw2dma14l
r_static
r_char
id|alaw2dma14l
(braket
)braket
op_assign
(brace
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|42
comma
l_int|46
comma
l_int|34
comma
l_int|38
comma
l_int|58
comma
l_int|62
comma
l_int|50
comma
l_int|54
comma
l_int|10
comma
l_int|14
comma
l_int|2
comma
l_int|6
comma
l_int|26
comma
l_int|30
comma
l_int|18
comma
l_int|22
comma
l_int|42
comma
l_int|46
comma
l_int|34
comma
l_int|38
comma
l_int|58
comma
l_int|62
comma
l_int|50
comma
l_int|54
comma
l_int|10
comma
l_int|14
comma
l_int|2
comma
l_int|6
comma
l_int|26
comma
l_int|30
comma
l_int|18
comma
l_int|22
comma
l_int|40
comma
l_int|56
comma
l_int|8
comma
l_int|24
comma
l_int|40
comma
l_int|56
comma
l_int|8
comma
l_int|24
comma
l_int|40
comma
l_int|56
comma
l_int|8
comma
l_int|24
comma
l_int|40
comma
l_int|56
comma
l_int|8
comma
l_int|24
comma
l_int|20
comma
l_int|28
comma
l_int|4
comma
l_int|12
comma
l_int|52
comma
l_int|60
comma
l_int|36
comma
l_int|44
comma
l_int|20
comma
l_int|28
comma
l_int|4
comma
l_int|12
comma
l_int|52
comma
l_int|60
comma
l_int|36
comma
l_int|44
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|32
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|48
comma
l_int|16
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|22
comma
l_int|18
comma
l_int|30
comma
l_int|26
comma
l_int|6
comma
l_int|2
comma
l_int|14
comma
l_int|10
comma
l_int|54
comma
l_int|50
comma
l_int|62
comma
l_int|58
comma
l_int|38
comma
l_int|34
comma
l_int|46
comma
l_int|42
comma
l_int|22
comma
l_int|18
comma
l_int|30
comma
l_int|26
comma
l_int|6
comma
l_int|2
comma
l_int|14
comma
l_int|10
comma
l_int|54
comma
l_int|50
comma
l_int|62
comma
l_int|58
comma
l_int|38
comma
l_int|34
comma
l_int|46
comma
l_int|42
comma
l_int|24
comma
l_int|8
comma
l_int|56
comma
l_int|40
comma
l_int|24
comma
l_int|8
comma
l_int|56
comma
l_int|40
comma
l_int|24
comma
l_int|8
comma
l_int|56
comma
l_int|40
comma
l_int|24
comma
l_int|8
comma
l_int|56
comma
l_int|40
comma
l_int|44
comma
l_int|36
comma
l_int|60
comma
l_int|52
comma
l_int|12
comma
l_int|4
comma
l_int|28
comma
l_int|20
comma
l_int|44
comma
l_int|36
comma
l_int|60
comma
l_int|52
comma
l_int|12
comma
l_int|4
comma
l_int|28
comma
l_int|20
)brace
suffix:semicolon
macro_line|#endif /* HAS_14BIT_TABLES */
multiline_comment|/*** Translations ************************************************************/
macro_line|#ifdef CONFIG_ATARI
r_static
id|ssize_t
id|ata_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ct_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ata_ctx_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_static
id|ssize_t
id|ami_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ami_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ami_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ami_ct_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ami_ct_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ami_ct_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|ami_ct_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
r_static
id|ssize_t
id|pmac_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ct_s16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ct_u16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ctx_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ctx_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ctx_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ctx_s16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
r_static
id|ssize_t
id|pmac_ctx_u16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC */
multiline_comment|/*** Machine definitions *****************************************************/
r_typedef
r_struct
(brace
DECL|member|type
r_int
id|type
suffix:semicolon
DECL|member|dma_alloc
r_void
op_star
(paren
op_star
id|dma_alloc
)paren
(paren
r_int
r_int
comma
r_int
)paren
suffix:semicolon
DECL|member|dma_free
r_void
(paren
op_star
id|dma_free
)paren
(paren
r_void
op_star
comma
r_int
r_int
)paren
suffix:semicolon
DECL|member|irqinit
r_int
(paren
op_star
id|irqinit
)paren
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef MODULE
DECL|member|irqcleanup
r_void
(paren
op_star
id|irqcleanup
)paren
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
DECL|member|init
r_void
(paren
op_star
id|init
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|member|silence
r_void
(paren
op_star
id|silence
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|member|setFormat
r_int
(paren
op_star
id|setFormat
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|member|setVolume
r_int
(paren
op_star
id|setVolume
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|member|setBass
r_int
(paren
op_star
id|setBass
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|member|setTreble
r_int
(paren
op_star
id|setTreble
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|member|setGain
r_int
(paren
op_star
id|setGain
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|member|play
r_void
(paren
op_star
id|play
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|typedef|MACHINE
)brace
id|MACHINE
suffix:semicolon
multiline_comment|/*** Low level stuff *********************************************************/
r_typedef
r_struct
(brace
DECL|member|format
r_int
id|format
suffix:semicolon
multiline_comment|/* AFMT_* */
DECL|member|stereo
r_int
id|stereo
suffix:semicolon
multiline_comment|/* 0 = mono, 1 = stereo */
DECL|member|size
r_int
id|size
suffix:semicolon
multiline_comment|/* 8/16 bit*/
DECL|member|speed
r_int
id|speed
suffix:semicolon
multiline_comment|/* speed */
DECL|typedef|SETTINGS
)brace
id|SETTINGS
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|ct_ulaw
id|ssize_t
(paren
op_star
id|ct_ulaw
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
id|ssize_t
op_star
comma
id|ssize_t
)paren
suffix:semicolon
DECL|member|ct_alaw
id|ssize_t
(paren
op_star
id|ct_alaw
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
id|ssize_t
op_star
comma
id|ssize_t
)paren
suffix:semicolon
DECL|member|ct_s8
id|ssize_t
(paren
op_star
id|ct_s8
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
id|ssize_t
op_star
comma
id|ssize_t
)paren
suffix:semicolon
DECL|member|ct_u8
id|ssize_t
(paren
op_star
id|ct_u8
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
id|ssize_t
op_star
comma
id|ssize_t
)paren
suffix:semicolon
DECL|member|ct_s16be
id|ssize_t
(paren
op_star
id|ct_s16be
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
id|ssize_t
op_star
comma
id|ssize_t
)paren
suffix:semicolon
DECL|member|ct_u16be
id|ssize_t
(paren
op_star
id|ct_u16be
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
id|ssize_t
op_star
comma
id|ssize_t
)paren
suffix:semicolon
DECL|member|ct_s16le
id|ssize_t
(paren
op_star
id|ct_s16le
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
id|ssize_t
op_star
comma
id|ssize_t
)paren
suffix:semicolon
DECL|member|ct_u16le
id|ssize_t
(paren
op_star
id|ct_u16le
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
id|ssize_t
op_star
comma
id|ssize_t
)paren
suffix:semicolon
DECL|typedef|TRANS
)brace
id|TRANS
suffix:semicolon
DECL|struct|sound_settings
r_struct
id|sound_settings
(brace
DECL|member|mach
id|MACHINE
id|mach
suffix:semicolon
multiline_comment|/* machine dependent things */
DECL|member|hard
id|SETTINGS
id|hard
suffix:semicolon
multiline_comment|/* hardware settings */
DECL|member|soft
id|SETTINGS
id|soft
suffix:semicolon
multiline_comment|/* software settings */
DECL|member|dsp
id|SETTINGS
id|dsp
suffix:semicolon
multiline_comment|/* /dev/dsp default settings */
DECL|member|trans
id|TRANS
op_star
id|trans
suffix:semicolon
multiline_comment|/* supported translations */
DECL|member|volume_left
r_int
id|volume_left
suffix:semicolon
multiline_comment|/* volume (range is machine dependent) */
DECL|member|volume_right
r_int
id|volume_right
suffix:semicolon
DECL|member|bass
r_int
id|bass
suffix:semicolon
multiline_comment|/* tone (range is machine dependent) */
DECL|member|treble
r_int
id|treble
suffix:semicolon
DECL|member|gain
r_int
id|gain
suffix:semicolon
DECL|member|minDev
r_int
id|minDev
suffix:semicolon
multiline_comment|/* minor device number currently open */
macro_line|#if defined(CONFIG_ATARI) || defined(CONFIG_PMAC)
DECL|member|bal
r_int
id|bal
suffix:semicolon
multiline_comment|/* balance factor for expanding (not volume!) */
DECL|member|data
id|u_long
id|data
suffix:semicolon
multiline_comment|/* data for expanding */
macro_line|#endif /* CONFIG_ATARI */
)brace
suffix:semicolon
DECL|variable|sound
r_static
r_struct
id|sound_settings
id|sound
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
r_static
r_void
op_star
id|AtaAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
id|__init
suffix:semicolon
r_static
r_void
id|AtaFree
c_func
(paren
r_void
op_star
comma
r_int
r_int
id|size
)paren
id|__init
suffix:semicolon
r_static
r_int
id|AtaIrqInit
c_func
(paren
r_void
)paren
id|__init
suffix:semicolon
macro_line|#ifdef MODULE
r_static
r_void
id|AtaIrqCleanUp
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
r_static
r_int
id|AtaSetBass
c_func
(paren
r_int
id|bass
)paren
suffix:semicolon
r_static
r_int
id|AtaSetTreble
c_func
(paren
r_int
id|treble
)paren
suffix:semicolon
r_static
r_void
id|TTSilence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|TTInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|TTSetFormat
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|TTSetVolume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
r_static
r_int
id|TTSetGain
c_func
(paren
r_int
id|gain
)paren
suffix:semicolon
r_static
r_void
id|FalconSilence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|FalconInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|FalconSetFormat
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|FalconSetVolume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
r_static
r_void
id|ata_sq_play_next_frame
c_func
(paren
r_int
id|index
)paren
suffix:semicolon
r_static
r_void
id|AtaPlay
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ata_sq_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_static
r_void
op_star
id|AmiAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
id|__init
suffix:semicolon
r_static
r_void
id|AmiFree
c_func
(paren
r_void
op_star
comma
r_int
r_int
)paren
id|__init
suffix:semicolon
r_static
r_int
id|AmiIrqInit
c_func
(paren
r_void
)paren
id|__init
suffix:semicolon
macro_line|#ifdef MODULE
r_static
r_void
id|AmiIrqCleanUp
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
r_static
r_void
id|AmiSilence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|AmiInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|AmiSetFormat
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|AmiSetVolume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
r_static
r_int
id|AmiSetTreble
c_func
(paren
r_int
id|treble
)paren
suffix:semicolon
r_static
r_void
id|ami_sq_play_next_frame
c_func
(paren
r_int
id|index
)paren
suffix:semicolon
r_static
r_void
id|AmiPlay
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ami_sq_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
r_static
r_void
op_star
id|PMacAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
id|__init
suffix:semicolon
r_static
r_void
id|PMacFree
c_func
(paren
r_void
op_star
id|ptr
comma
r_int
r_int
id|size
)paren
id|__init
suffix:semicolon
r_static
r_int
id|PMacIrqInit
c_func
(paren
r_void
)paren
id|__init
suffix:semicolon
macro_line|#ifdef MODULE
r_static
r_void
id|PMacIrqCleanup
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
r_static
r_void
id|PMacSilence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|PMacInit
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|PMacPlay
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|PMacSetFormat
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|PMacSetVolume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
r_static
r_void
id|pmac_awacs_tx_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|pmac_awacs_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|awacs_write
c_func
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
id|awacs_get_volume
c_func
(paren
r_int
id|reg
comma
r_int
id|lshift
)paren
suffix:semicolon
r_static
r_int
id|awacs_volume_setter
c_func
(paren
r_int
id|volume
comma
r_int
id|n
comma
r_int
id|mute
comma
r_int
id|lshift
)paren
suffix:semicolon
r_static
r_void
id|awacs_mksound
c_func
(paren
r_int
r_int
id|hz
comma
r_int
r_int
id|ticks
)paren
suffix:semicolon
r_static
r_void
id|awacs_nosound
c_func
(paren
r_int
r_int
id|xx
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC */
multiline_comment|/*** Mid level stuff *********************************************************/
r_static
r_void
id|sound_silence
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|sound_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|sound_set_format
c_func
(paren
r_int
id|format
)paren
suffix:semicolon
r_static
r_int
id|sound_set_speed
c_func
(paren
r_int
id|speed
)paren
suffix:semicolon
r_static
r_int
id|sound_set_stereo
c_func
(paren
r_int
id|stereo
)paren
suffix:semicolon
r_static
r_int
id|sound_set_volume
c_func
(paren
r_int
id|volume
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
r_static
r_int
id|sound_set_bass
c_func
(paren
r_int
id|bass
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#if defined(CONFIG_ATARI) || defined(CONFIG_AMIGA)
r_static
r_int
id|sound_set_treble
c_func
(paren
r_int
id|treble
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI || CONFIG_AMIGA */
r_static
id|ssize_t
id|sound_copy_translate
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
suffix:semicolon
multiline_comment|/*&n; * /dev/mixer abstraction&n; */
DECL|struct|sound_mixer
r_struct
id|sound_mixer
(brace
DECL|member|busy
r_int
id|busy
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|mixer
r_static
r_struct
id|sound_mixer
id|mixer
suffix:semicolon
multiline_comment|/*&n; * Sound queue stuff, the heart of the driver&n; */
DECL|struct|sound_queue
r_struct
id|sound_queue
(brace
DECL|member|max_count
DECL|member|block_size
r_int
id|max_count
comma
id|block_size
suffix:semicolon
DECL|member|buffers
r_char
op_star
op_star
id|buffers
suffix:semicolon
DECL|member|max_active
r_int
id|max_active
suffix:semicolon
multiline_comment|/* it shouldn&squot;t be necessary to declare any of these volatile */
DECL|member|front
DECL|member|rear
DECL|member|count
r_int
id|front
comma
id|rear
comma
id|count
suffix:semicolon
DECL|member|rear_size
r_int
id|rear_size
suffix:semicolon
multiline_comment|/*&n;&t; *&t;The use of the playing field depends on the hardware&n;&t; *&n;&t; *&t;Atari, PMac: The number of frames that are loaded/playing&n;&t; *&n;&t; *&t;Amiga: Bit 0 is set: a frame is loaded&n;&t; *&t;       Bit 1 is set: a frame is playing&n;&t; */
DECL|member|playing
r_int
id|playing
suffix:semicolon
DECL|member|write_queue
DECL|member|open_queue
DECL|member|sync_queue
r_struct
id|wait_queue
op_star
id|write_queue
comma
op_star
id|open_queue
comma
op_star
id|sync_queue
suffix:semicolon
DECL|member|open_mode
r_int
id|open_mode
suffix:semicolon
DECL|member|busy
DECL|member|syncing
r_int
id|busy
comma
id|syncing
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
DECL|member|ignore_int
r_int
id|ignore_int
suffix:semicolon
multiline_comment|/* ++TeSche: used for Falcon */
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
DECL|member|block_size_half
DECL|member|block_size_quarter
r_int
id|block_size_half
comma
id|block_size_quarter
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
suffix:semicolon
DECL|variable|sq
r_static
r_struct
id|sound_queue
id|sq
suffix:semicolon
DECL|macro|sq_block_address
mdefine_line|#define sq_block_address(i)&t;(sq.buffers[i])
DECL|macro|SIGNAL_RECEIVED
mdefine_line|#define SIGNAL_RECEIVED&t;(signal_pending(current))
DECL|macro|NON_BLOCKING
mdefine_line|#define NON_BLOCKING(open_mode)&t;(open_mode &amp; O_NONBLOCK)
DECL|macro|ONE_SECOND
mdefine_line|#define ONE_SECOND&t;HZ&t;/* in jiffies (100ths of a second) */
DECL|macro|NO_TIME_LIMIT
mdefine_line|#define NO_TIME_LIMIT&t;0xffffffff
DECL|macro|SLEEP
mdefine_line|#define SLEEP(queue, time_limit) &bslash;&n;&t;current-&gt;timeout = jiffies+(time_limit); &bslash;&n;&t;interruptible_sleep_on(&amp;queue);
DECL|macro|WAKE_UP
mdefine_line|#define WAKE_UP(queue)&t;(wake_up_interruptible(&amp;queue))
multiline_comment|/*&n; * /dev/sndstat&n; */
DECL|struct|sound_state
r_struct
id|sound_state
(brace
DECL|member|busy
r_int
id|busy
suffix:semicolon
DECL|member|buf
r_char
id|buf
(braket
l_int|512
)braket
suffix:semicolon
DECL|member|len
DECL|member|ptr
r_int
id|len
comma
id|ptr
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|state
r_static
r_struct
id|sound_state
id|state
suffix:semicolon
multiline_comment|/*** Common stuff ********************************************************/
r_static
r_int
r_int
id|sound_lseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|offset
comma
r_int
id|orig
)paren
suffix:semicolon
DECL|function|ioctl_return
r_static
r_inline
r_int
id|ioctl_return
c_func
(paren
r_int
op_star
id|addr
comma
r_int
id|value
)paren
(brace
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
r_return
id|value
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|value
comma
id|addr
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/*** Config &amp; Setup **********************************************************/
r_void
id|dmasound_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|dmasound_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
suffix:semicolon
multiline_comment|/*** Translations ************************************************************/
multiline_comment|/* ++TeSche: radically changed for new expanding purposes...&n; *&n; * These two routines now deal with copying/expanding/translating the samples&n; * from user space into our buffer at the right frequency. They take care about&n; * how much data there&squot;s actually to read, how much buffer space there is and&n; * to convert samples into the right frequency/encoding. They will only work on&n; * complete samples so it may happen they leave some bytes in the input stream&n; * if the user didn&squot;t write a multiple of the current sample size. They both&n; * return the number of bytes they&squot;ve used from both streams so you may detect&n; * such a situation. Luckily all programs should be able to cope with that.&n; *&n; * I think I&squot;ve optimized anything as far as one can do in plain C, all&n; * variables should fit in registers and the loops are really short. There&squot;s&n; * one loop for every possible situation. Writing a more generalized and thus&n; * parameterized loop would only produce slower code. Feel free to optimize&n; * this in assembler if you like. :)&n; *&n; * I think these routines belong here because they&squot;re not yet really hardware&n; * independent, especially the fact that the Falcon can play 16bit samples&n; * only in stereo is hardcoded in both of them!&n; *&n; * ++geert: split in even more functions (one per format)&n; */
macro_line|#ifdef CONFIG_ATARI
DECL|function|ata_ct_law
r_static
id|ssize_t
id|ata_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_char
op_star
id|table
op_assign
id|sound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|ulaw2dma8
suffix:colon
id|alaw2dma8
suffix:semicolon
id|ssize_t
id|count
comma
id|used
suffix:semicolon
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound.soft.stereo
)paren
id|count
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|table
(braket
id|data
)braket
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_s8
r_static
id|ssize_t
id|ata_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_void
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound.soft.stereo
)paren
id|count
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|p
comma
id|userPtr
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_u8
r_static
id|ssize_t
id|ata_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
op_xor
l_int|0x80
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
op_xor
l_int|0x8080
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_s16be
r_static
id|ssize_t
id|ata_ct_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
r_void
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|p
comma
id|userPtr
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_u16be
r_static
id|ssize_t
id|ata_ct_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x8000
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
op_xor
l_int|0x80008000
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_s16le
r_static
id|ssize_t
id|ata_ct_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
id|count
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ct_u16le
r_static
id|ssize_t
id|ata_ct_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
id|count
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_long
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
op_xor
l_int|0x80008000
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
)brace
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_law
r_static
id|ssize_t
id|ata_ctx_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_char
op_star
id|table
op_assign
id|sound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|ulaw2dma8
suffix:colon
id|alaw2dma8
suffix:semicolon
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_char
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
id|u_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|userCount
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|table
(braket
id|c
)braket
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|2
)paren
(brace
id|u_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|table
(braket
id|c
)braket
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_or_assign
id|table
(braket
id|c
)braket
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_s8
r_static
id|ssize_t
id|ata_ctx_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_char
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|userCount
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_u8
r_static
id|ssize_t
id|ata_ctx_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_char
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|userCount
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x80
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x8080
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_s16be
r_static
id|ssize_t
id|ata_ctx_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_u16be
r_static
id|ssize_t
id|ata_ctx_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x8000
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x80008000
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_s16le
r_static
id|ssize_t
id|ata_ctx_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ata_ctx_u16le
r_static
id|ssize_t
id|ata_ctx_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
multiline_comment|/* this should help gcc to stuff everything into registers */
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
id|ssize_t
id|used
comma
id|usedf
suffix:semicolon
id|used
op_assign
id|userCount
suffix:semicolon
id|usedf
op_assign
id|frameLeft
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_short
op_star
id|p
op_assign
(paren
id|u_short
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_short
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|2
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
id|userCount
op_sub_assign
l_int|2
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
r_else
(brace
id|u_long
op_star
id|p
op_assign
(paren
id|u_long
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|u_long
id|data
op_assign
id|sound.data
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
op_ge
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
OL
l_int|4
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_int
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16dbl
c_func
(paren
id|data
)paren
op_xor
l_int|0x80008000
suffix:semicolon
id|userCount
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_sub_assign
l_int|4
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.data
op_assign
id|data
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|used
op_sub_assign
id|userCount
suffix:semicolon
op_star
id|frameUsed
op_add_assign
id|usedf
op_minus
id|frameLeft
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
DECL|function|ami_ct_law
r_static
id|ssize_t
id|ami_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_char
op_star
id|table
op_assign
id|sound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|ulaw2dma8
suffix:colon
id|alaw2dma8
suffix:semicolon
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|table
(braket
id|data
)braket
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|left
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|right
op_assign
id|left
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|left
op_increment
op_assign
id|table
(braket
id|data
)braket
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|right
op_increment
op_assign
id|table
(braket
id|data
)braket
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_s8
r_static
id|ssize_t
id|ami_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
r_void
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|p
comma
id|userPtr
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
id|u_char
op_star
id|left
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|right
op_assign
id|left
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
op_star
id|left
op_increment
comma
id|userPtr
op_increment
)paren
op_logical_or
id|get_user
c_func
(paren
op_star
id|right
op_increment
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_u8
r_static
id|ssize_t
id|ami_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
r_char
op_star
id|p
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|data
op_xor
l_int|0x80
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|left
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|right
op_assign
id|left
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|left
op_increment
op_assign
id|data
op_xor
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|right
op_increment
op_assign
id|data
op_xor
l_int|0x80
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_s16be
r_static
id|ssize_t
id|ami_ct_s16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|high
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|low
op_assign
id|high
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|high
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|low
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|lefth
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|2
)braket
suffix:semicolon
id|u_char
op_star
id|leftl
op_assign
id|lefth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|u_char
op_star
id|righth
op_assign
id|lefth
op_plus
id|sq.block_size_half
suffix:semicolon
id|u_char
op_star
id|rightl
op_assign
id|righth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|lefth
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|leftl
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|righth
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|rightl
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_u16be
r_static
id|ssize_t
id|ami_ct_u16be
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|high
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|low
op_assign
id|high
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x8000
suffix:semicolon
op_star
id|high
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|low
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|lefth
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|2
)braket
suffix:semicolon
id|u_char
op_star
id|leftl
op_assign
id|lefth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|u_char
op_star
id|righth
op_assign
id|lefth
op_plus
id|sq.block_size_half
suffix:semicolon
id|u_char
op_star
id|rightl
op_assign
id|righth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x8000
suffix:semicolon
op_star
id|lefth
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|leftl
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
l_int|0x8000
suffix:semicolon
op_star
id|righth
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|rightl
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_s16le
r_static
id|ssize_t
id|ami_ct_s16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|high
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|low
op_assign
id|high
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|high
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|low
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|lefth
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|2
)braket
suffix:semicolon
id|u_char
op_star
id|leftl
op_assign
id|lefth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|u_char
op_star
id|righth
op_assign
id|lefth
op_plus
id|sq.block_size_half
suffix:semicolon
id|u_char
op_star
id|rightl
op_assign
id|righth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|lefth
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|leftl
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
suffix:semicolon
op_star
id|righth
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|rightl
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
DECL|function|ami_ct_u16le
r_static
id|ssize_t
id|ami_ct_u16le
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
id|u_short
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.soft.stereo
)paren
(brace
id|u_char
op_star
id|high
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|1
)braket
suffix:semicolon
id|u_char
op_star
id|low
op_assign
id|high
op_plus
id|sq.block_size_half
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|1
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|high
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|low
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|u_char
op_star
id|lefth
op_assign
op_amp
id|frame
(braket
op_star
id|frameUsed
op_rshift
l_int|2
)braket
suffix:semicolon
id|u_char
op_star
id|leftl
op_assign
id|lefth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|u_char
op_star
id|righth
op_assign
id|lefth
op_plus
id|sq.block_size_half
suffix:semicolon
id|u_char
op_star
id|rightl
op_assign
id|righth
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
op_rshift
l_int|2
op_amp
op_complement
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_star
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|lefth
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|leftl
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
(paren
(paren
id|u_short
op_star
)paren
id|userPtr
)paren
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|le2be16
c_func
(paren
id|data
)paren
op_xor
l_int|0x8000
suffix:semicolon
op_star
id|righth
op_increment
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
op_star
id|rightl
op_increment
op_assign
(paren
id|data
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
op_star
id|frameUsed
op_add_assign
id|used
suffix:semicolon
r_return
id|used
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
DECL|function|pmac_ct_law
r_static
id|ssize_t
id|pmac_ct_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
op_star
id|table
op_assign
id|sound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|ulaw2dma16
suffix:colon
id|alaw2dma16
suffix:semicolon
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
op_star
id|p
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
id|val
comma
id|stereo
op_assign
id|sound.soft.stereo
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|table
(braket
id|data
)braket
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|table
(braket
id|data
)braket
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|2
suffix:colon
id|used
suffix:semicolon
)brace
DECL|function|pmac_ct_s8
r_static
id|ssize_t
id|pmac_ct_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
op_star
id|p
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
id|val
comma
id|stereo
op_assign
id|sound.soft.stereo
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|data
op_lshift
l_int|8
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
id|data
op_lshift
l_int|8
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|2
suffix:colon
id|used
suffix:semicolon
)brace
DECL|function|pmac_ct_u8
r_static
id|ssize_t
id|pmac_ct_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
op_star
id|p
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
id|val
comma
id|stereo
op_assign
id|sound.soft.stereo
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u_char
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
(paren
id|data
op_xor
l_int|0x80
)paren
op_lshift
l_int|8
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|val
op_assign
(paren
id|data
op_xor
l_int|0x80
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|val
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|2
suffix:colon
id|used
suffix:semicolon
)brace
DECL|function|pmac_ct_s16
r_static
id|ssize_t
id|pmac_ct_s16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
id|stereo
op_assign
id|sound.soft.stereo
suffix:semicolon
r_int
op_star
id|fp
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
id|userCount
op_rshift_assign
(paren
id|stereo
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|stereo
)paren
(brace
r_int
op_star
id|up
op_assign
(paren
r_int
op_star
)paren
id|userPtr
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_int
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|fp
op_increment
op_assign
id|data
suffix:semicolon
op_star
id|fp
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|fp
comma
id|userPtr
comma
id|count
op_star
l_int|4
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|4
suffix:colon
id|used
op_star
l_int|2
suffix:semicolon
)brace
DECL|function|pmac_ct_u16
r_static
id|ssize_t
id|pmac_ct_u16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
id|count
comma
id|used
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|sound.soft.format
op_eq
id|AFMT_U16_LE
ques
c_cond
l_int|0x0080
suffix:colon
l_int|0x8000
)paren
suffix:semicolon
r_int
id|stereo
op_assign
id|sound.soft.stereo
suffix:semicolon
r_int
op_star
id|fp
op_assign
(paren
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
op_star
id|up
op_assign
(paren
r_int
op_star
)paren
id|userPtr
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
id|userCount
op_rshift_assign
(paren
id|stereo
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|used
op_assign
id|count
op_assign
id|min
c_func
(paren
id|userCount
comma
id|frameLeft
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
r_int
id|data
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
id|mask
suffix:semicolon
op_star
id|fp
op_increment
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
id|mask
suffix:semicolon
)brace
op_star
id|fp
op_increment
op_assign
id|data
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
op_star
id|frameUsed
op_add_assign
id|used
op_star
l_int|4
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|used
op_star
l_int|4
suffix:colon
id|used
op_star
l_int|2
suffix:semicolon
)brace
DECL|function|pmac_ctx_law
r_static
id|ssize_t
id|pmac_ctx_law
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
r_int
op_star
id|table
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|sound.soft.format
op_eq
id|AFMT_MU_LAW
ques
c_cond
id|ulaw2dma16
suffix:colon
id|alaw2dma16
)paren
suffix:semicolon
r_int
r_int
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|utotal
comma
id|ftotal
suffix:semicolon
r_int
id|stereo
op_assign
id|sound.soft.stereo
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|ftotal
op_assign
id|frameLeft
suffix:semicolon
id|utotal
op_assign
id|userCount
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
id|u_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|table
(braket
id|c
)braket
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|table
(braket
id|c
)braket
suffix:semicolon
)brace
r_else
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
op_star
id|frameUsed
op_add_assign
(paren
id|ftotal
op_minus
id|frameLeft
)paren
op_star
l_int|4
suffix:semicolon
id|utotal
op_sub_assign
id|userCount
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|utotal
op_star
l_int|2
suffix:colon
id|utotal
suffix:semicolon
)brace
DECL|function|pmac_ctx_s8
r_static
id|ssize_t
id|pmac_ctx_s8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
r_int
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|stereo
op_assign
id|sound.soft.stereo
suffix:semicolon
r_int
id|utotal
comma
id|ftotal
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|ftotal
op_assign
id|frameLeft
suffix:semicolon
id|utotal
op_assign
id|userCount
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
id|u_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
id|c
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
(paren
id|c
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
op_star
id|frameUsed
op_add_assign
(paren
id|ftotal
op_minus
id|frameLeft
)paren
op_star
l_int|4
suffix:semicolon
id|utotal
op_sub_assign
id|userCount
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|utotal
op_star
l_int|2
suffix:colon
id|utotal
suffix:semicolon
)brace
DECL|function|pmac_ctx_u8
r_static
id|ssize_t
id|pmac_ctx_u8
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
r_int
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|stereo
op_assign
id|sound.soft.stereo
suffix:semicolon
r_int
id|utotal
comma
id|ftotal
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|ftotal
op_assign
id|frameLeft
suffix:semicolon
id|utotal
op_assign
id|userCount
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
id|u_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|c
op_xor
l_int|0x80
)paren
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|userPtr
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
(paren
(paren
id|c
op_xor
l_int|0x80
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
op_star
id|frameUsed
op_add_assign
(paren
id|ftotal
op_minus
id|frameLeft
)paren
op_star
l_int|4
suffix:semicolon
id|utotal
op_sub_assign
id|userCount
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|utotal
op_star
l_int|2
suffix:colon
id|utotal
suffix:semicolon
)brace
DECL|function|pmac_ctx_s16
r_static
id|ssize_t
id|pmac_ctx_s16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
r_int
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
r_int
op_star
id|up
op_assign
(paren
r_int
r_int
op_star
)paren
id|userPtr
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|stereo
op_assign
id|sound.soft.stereo
suffix:semicolon
r_int
id|utotal
comma
id|ftotal
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|ftotal
op_assign
id|frameLeft
suffix:semicolon
id|utotal
op_assign
id|userCount
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_int
r_int
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|c
suffix:semicolon
)brace
r_else
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
op_star
id|frameUsed
op_add_assign
(paren
id|ftotal
op_minus
id|frameLeft
)paren
op_star
l_int|4
suffix:semicolon
id|utotal
op_sub_assign
id|userCount
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|utotal
op_star
l_int|4
suffix:colon
id|utotal
op_star
l_int|2
suffix:semicolon
)brace
DECL|function|pmac_ctx_u16
r_static
id|ssize_t
id|pmac_ctx_u16
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
r_int
id|mask
op_assign
(paren
id|sound.soft.format
op_eq
id|AFMT_U16_LE
ques
c_cond
l_int|0x0080
suffix:colon
l_int|0x8000
)paren
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|frame
(braket
op_star
id|frameUsed
)braket
suffix:semicolon
r_int
r_int
id|data
op_assign
id|sound.data
suffix:semicolon
r_int
r_int
op_star
id|up
op_assign
(paren
r_int
r_int
op_star
)paren
id|userPtr
suffix:semicolon
r_int
id|bal
op_assign
id|sound.bal
suffix:semicolon
r_int
id|hSpeed
op_assign
id|sound.hard.speed
comma
id|sSpeed
op_assign
id|sound.soft.speed
suffix:semicolon
r_int
id|stereo
op_assign
id|sound.soft.stereo
suffix:semicolon
r_int
id|utotal
comma
id|ftotal
suffix:semicolon
id|frameLeft
op_rshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|userCount
op_rshift_assign
l_int|1
suffix:semicolon
id|ftotal
op_assign
id|frameLeft
suffix:semicolon
id|utotal
op_assign
id|userCount
suffix:semicolon
r_while
c_loop
(paren
id|frameLeft
)paren
(brace
r_int
r_int
id|c
suffix:semicolon
r_if
c_cond
(paren
id|bal
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|userCount
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|data
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_xor_assign
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|c
comma
id|up
op_increment
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
(paren
id|c
op_xor
id|mask
)paren
suffix:semicolon
)brace
r_else
id|data
op_assign
(paren
id|data
op_lshift
l_int|16
)paren
op_plus
id|data
suffix:semicolon
id|userCount
op_decrement
suffix:semicolon
id|bal
op_add_assign
id|hSpeed
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|data
suffix:semicolon
id|frameLeft
op_decrement
suffix:semicolon
id|bal
op_sub_assign
id|sSpeed
suffix:semicolon
)brace
id|sound.bal
op_assign
id|bal
suffix:semicolon
id|sound.data
op_assign
id|data
suffix:semicolon
op_star
id|frameUsed
op_add_assign
(paren
id|ftotal
op_minus
id|frameLeft
)paren
op_star
l_int|4
suffix:semicolon
id|utotal
op_sub_assign
id|userCount
suffix:semicolon
r_return
id|stereo
ques
c_cond
id|utotal
op_star
l_int|4
suffix:colon
id|utotal
op_star
l_int|2
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PMAC */
macro_line|#ifdef CONFIG_ATARI
DECL|variable|transTTNormal
r_static
id|TRANS
id|transTTNormal
op_assign
(brace
id|ata_ct_law
comma
id|ata_ct_law
comma
id|ata_ct_s8
comma
id|ata_ct_u8
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|transTTExpanding
r_static
id|TRANS
id|transTTExpanding
op_assign
(brace
id|ata_ctx_law
comma
id|ata_ctx_law
comma
id|ata_ctx_s8
comma
id|ata_ctx_u8
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|transFalconNormal
r_static
id|TRANS
id|transFalconNormal
op_assign
(brace
id|ata_ct_law
comma
id|ata_ct_law
comma
id|ata_ct_s8
comma
id|ata_ct_u8
comma
id|ata_ct_s16be
comma
id|ata_ct_u16be
comma
id|ata_ct_s16le
comma
id|ata_ct_u16le
)brace
suffix:semicolon
DECL|variable|transFalconExpanding
r_static
id|TRANS
id|transFalconExpanding
op_assign
(brace
id|ata_ctx_law
comma
id|ata_ctx_law
comma
id|ata_ctx_s8
comma
id|ata_ctx_u8
comma
id|ata_ctx_s16be
comma
id|ata_ctx_u16be
comma
id|ata_ctx_s16le
comma
id|ata_ctx_u16le
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
DECL|variable|transAmiga
r_static
id|TRANS
id|transAmiga
op_assign
(brace
id|ami_ct_law
comma
id|ami_ct_law
comma
id|ami_ct_s8
comma
id|ami_ct_u8
comma
id|ami_ct_s16be
comma
id|ami_ct_u16be
comma
id|ami_ct_s16le
comma
id|ami_ct_u16le
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
DECL|variable|transAwacsNormal
r_static
id|TRANS
id|transAwacsNormal
op_assign
(brace
id|pmac_ct_law
comma
id|pmac_ct_law
comma
id|pmac_ct_s8
comma
id|pmac_ct_u8
comma
id|pmac_ct_s16
comma
id|pmac_ct_u16
comma
id|pmac_ct_s16
comma
id|pmac_ct_u16
)brace
suffix:semicolon
DECL|variable|transAwacsExpand
r_static
id|TRANS
id|transAwacsExpand
op_assign
(brace
id|pmac_ctx_law
comma
id|pmac_ctx_law
comma
id|pmac_ctx_s8
comma
id|pmac_ctx_u8
comma
id|pmac_ctx_s16
comma
id|pmac_ctx_u16
comma
id|pmac_ctx_s16
comma
id|pmac_ctx_u16
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC */
multiline_comment|/*** Low level stuff *********************************************************/
macro_line|#ifdef CONFIG_ATARI
multiline_comment|/*&n; * Atari (TT/Falcon)&n; */
DECL|function|AtaAlloc
r_static
r_void
op_star
id|AtaAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_return
id|atari_stram_alloc
c_func
(paren
id|size
comma
l_int|NULL
comma
l_string|&quot;dmasound&quot;
)paren
suffix:semicolon
)brace
DECL|function|AtaFree
r_static
r_void
id|AtaFree
c_func
(paren
r_void
op_star
id|obj
comma
r_int
r_int
id|size
)paren
(brace
id|atari_stram_free
c_func
(paren
id|obj
)paren
suffix:semicolon
)brace
DECL|function|AtaIrqInit
r_static
r_int
id|AtaIrqInit
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Set up timer A. Timer A&n;&t;   will receive a signal upon end of playing from the sound&n;&t;   hardware. Furthermore Timer A is able to count events&n;&t;   and will cause an interrupt after a programmed number&n;&t;   of events. So all we need to keep the music playing is&n;&t;   to provide the sound hardware with new data upon&n;&t;   an interrupt from timer A. */
id|mfp.tim_ct_a
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ++roman: Stop timer before programming! */
id|mfp.tim_dt_a
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Cause interrupt after first event. */
id|mfp.tim_ct_a
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* Turn on event counting. */
multiline_comment|/* Register interrupt handler. */
id|request_irq
c_func
(paren
id|IRQ_MFP_TIMA
comma
id|ata_sq_interrupt
comma
id|IRQ_TYPE_SLOW
comma
l_string|&quot;DMA sound&quot;
comma
id|ata_sq_interrupt
)paren
suffix:semicolon
id|mfp.int_en_a
op_or_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* Turn interrupt on. */
id|mfp.int_mk_a
op_or_assign
l_int|0x20
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|AtaIrqCleanUp
r_static
r_void
id|AtaIrqCleanUp
c_func
(paren
r_void
)paren
(brace
id|mfp.tim_ct_a
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* stop timer */
id|mfp.int_en_a
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
multiline_comment|/* turn interrupt off */
id|free_irq
c_func
(paren
id|IRQ_MFP_TIMA
comma
id|ata_sq_interrupt
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
DECL|macro|TONE_VOXWARE_TO_DB
mdefine_line|#define TONE_VOXWARE_TO_DB(v) &bslash;&n;&t;(((v) &lt; 0) ? -12 : ((v) &gt; 100) ? 12 : ((v) - 50) * 6 / 25)
DECL|macro|TONE_DB_TO_VOXWARE
mdefine_line|#define TONE_DB_TO_VOXWARE(v) (((v) * 25 + ((v) &gt; 0 ? 5 : -5)) / 6 + 50)
DECL|function|AtaSetBass
r_static
r_int
id|AtaSetBass
c_func
(paren
r_int
id|bass
)paren
(brace
id|sound.bass
op_assign
id|TONE_VOXWARE_TO_DB
c_func
(paren
id|bass
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BASS
c_func
(paren
id|sound.bass
)paren
)paren
suffix:semicolon
r_return
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|sound.bass
)paren
suffix:semicolon
)brace
DECL|function|AtaSetTreble
r_static
r_int
id|AtaSetTreble
c_func
(paren
r_int
id|treble
)paren
(brace
id|sound.treble
op_assign
id|TONE_VOXWARE_TO_DB
c_func
(paren
id|treble
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_TREBLE
c_func
(paren
id|sound.treble
)paren
)paren
suffix:semicolon
r_return
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|sound.treble
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * TT&n; */
DECL|function|TTSilence
r_static
r_void
id|TTSilence
c_func
(paren
r_void
)paren
(brace
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_OFF
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_PSG_HIGH
)paren
suffix:semicolon
multiline_comment|/* mix in PSG signal 1:1 */
)brace
DECL|function|TTInit
r_static
r_void
id|TTInit
c_func
(paren
r_void
)paren
(brace
r_int
id|mode
comma
id|i
comma
id|idx
suffix:semicolon
r_const
r_int
id|freq
(braket
l_int|4
)braket
op_assign
(brace
l_int|50066
comma
l_int|25033
comma
l_int|12517
comma
l_int|6258
)brace
suffix:semicolon
multiline_comment|/* search a frequency that fits into the allowed error range */
id|idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|arraysize
c_func
(paren
id|freq
)paren
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* this isn&squot;t as much useful for a TT than for a Falcon, but&n;&t;&t; * then it doesn&squot;t hurt very much to implement it for a TT too.&n;&t;&t; */
r_if
c_cond
(paren
(paren
l_int|100
op_star
id|abs
c_func
(paren
id|sound.soft.speed
op_minus
id|freq
(braket
id|i
)braket
)paren
op_div
id|freq
(braket
id|i
)braket
)paren
OL
id|catchRadius
)paren
id|idx
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|idx
OG
op_minus
l_int|1
)paren
(brace
id|sound.soft.speed
op_assign
id|freq
(braket
id|idx
)braket
suffix:semicolon
id|sound.trans
op_assign
op_amp
id|transTTNormal
suffix:semicolon
)brace
r_else
id|sound.trans
op_assign
op_amp
id|transTTExpanding
suffix:semicolon
id|TTSilence
c_func
(paren
)paren
suffix:semicolon
id|sound.hard
op_assign
id|sound.soft
suffix:semicolon
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|50066
)paren
(brace
multiline_comment|/* we would need to squeeze the sound, but we won&squot;t do that */
id|sound.hard.speed
op_assign
l_int|50066
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_50KHZ
suffix:semicolon
id|sound.trans
op_assign
op_amp
id|transTTNormal
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|25033
)paren
(brace
id|sound.hard.speed
op_assign
l_int|50066
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_50KHZ
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|12517
)paren
(brace
id|sound.hard.speed
op_assign
l_int|25033
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_25KHZ
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|6258
)paren
(brace
id|sound.hard.speed
op_assign
l_int|12517
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_12KHZ
suffix:semicolon
)brace
r_else
(brace
id|sound.hard.speed
op_assign
l_int|6258
suffix:semicolon
id|mode
op_assign
id|DMASND_MODE_6KHZ
suffix:semicolon
)brace
id|tt_dmasnd.mode
op_assign
(paren
id|sound.hard.stereo
ques
c_cond
id|DMASND_MODE_STEREO
suffix:colon
id|DMASND_MODE_MONO
)paren
op_or
id|DMASND_MODE_8BIT
op_or
id|mode
suffix:semicolon
id|sound.bal
op_assign
op_minus
id|sound.soft.speed
suffix:semicolon
)brace
DECL|function|TTSetFormat
r_static
r_int
id|TTSetFormat
c_func
(paren
r_int
id|format
)paren
(brace
multiline_comment|/* TT sound DMA supports only 8bit modes */
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|AFMT_QUERY
suffix:colon
r_return
id|sound.soft.format
suffix:semicolon
r_case
id|AFMT_MU_LAW
suffix:colon
r_case
id|AFMT_A_LAW
suffix:colon
r_case
id|AFMT_S8
suffix:colon
r_case
id|AFMT_U8
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|format
op_assign
id|AFMT_S8
suffix:semicolon
)brace
id|sound.soft.format
op_assign
id|format
suffix:semicolon
id|sound.soft.size
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
(brace
id|sound.dsp.format
op_assign
id|format
suffix:semicolon
id|sound.dsp.size
op_assign
l_int|8
suffix:semicolon
)brace
id|TTInit
c_func
(paren
)paren
suffix:semicolon
r_return
id|format
suffix:semicolon
)brace
DECL|macro|VOLUME_VOXWARE_TO_DB
mdefine_line|#define VOLUME_VOXWARE_TO_DB(v) &bslash;&n;&t;(((v) &lt; 0) ? -40 : ((v) &gt; 100) ? 0 : ((v) * 2) / 5 - 40)
DECL|macro|VOLUME_DB_TO_VOXWARE
mdefine_line|#define VOLUME_DB_TO_VOXWARE(v) ((((v) + 40) * 5 + 1) / 2)
DECL|function|TTSetVolume
r_static
r_int
id|TTSetVolume
c_func
(paren
r_int
id|volume
)paren
(brace
id|sound.volume_left
op_assign
id|VOLUME_VOXWARE_TO_DB
c_func
(paren
id|volume
op_amp
l_int|0xff
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALLEFT
c_func
(paren
id|sound.volume_left
)paren
)paren
suffix:semicolon
id|sound.volume_right
op_assign
id|VOLUME_VOXWARE_TO_DB
c_func
(paren
(paren
id|volume
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALRIGHT
c_func
(paren
id|sound.volume_right
)paren
)paren
suffix:semicolon
r_return
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
(paren
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|macro|GAIN_VOXWARE_TO_DB
mdefine_line|#define GAIN_VOXWARE_TO_DB(v) &bslash;&n;&t;(((v) &lt; 0) ? -80 : ((v) &gt; 100) ? 0 : ((v) * 4) / 5 - 80)
DECL|macro|GAIN_DB_TO_VOXWARE
mdefine_line|#define GAIN_DB_TO_VOXWARE(v) ((((v) + 80) * 5 + 1) / 4)
DECL|function|TTSetGain
r_static
r_int
id|TTSetGain
c_func
(paren
r_int
id|gain
)paren
(brace
id|sound.gain
op_assign
id|GAIN_VOXWARE_TO_DB
c_func
(paren
id|gain
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_VOLUME
c_func
(paren
id|sound.gain
)paren
)paren
suffix:semicolon
r_return
id|GAIN_DB_TO_VOXWARE
c_func
(paren
id|sound.gain
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Falcon&n; */
DECL|function|FalconSilence
r_static
r_void
id|FalconSilence
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* stop playback, set sample rate 50kHz for PSG sound */
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_OFF
suffix:semicolon
id|tt_dmasnd.mode
op_assign
id|DMASND_MODE_50KHZ
op_or
id|DMASND_MODE_STEREO
op_or
id|DMASND_MODE_8BIT
suffix:semicolon
id|tt_dmasnd.int_div
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* STE compatible divider */
id|tt_dmasnd.int_ctrl
op_assign
l_int|0x0
suffix:semicolon
id|tt_dmasnd.cbar_src
op_assign
l_int|0x0000
suffix:semicolon
multiline_comment|/* no matrix inputs */
id|tt_dmasnd.cbar_dst
op_assign
l_int|0x0000
suffix:semicolon
multiline_comment|/* no matrix outputs */
id|tt_dmasnd.dac_src
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* connect ADC to DAC, disconnect matrix */
id|tt_dmasnd.adc_src
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* ADC Input = PSG */
)brace
DECL|function|FalconInit
r_static
r_void
id|FalconInit
c_func
(paren
r_void
)paren
(brace
r_int
id|divider
comma
id|i
comma
id|idx
suffix:semicolon
r_const
r_int
id|freq
(braket
l_int|8
)braket
op_assign
(brace
l_int|49170
comma
l_int|32780
comma
l_int|24585
comma
l_int|19668
comma
l_int|16390
comma
l_int|12292
comma
l_int|9834
comma
l_int|8195
)brace
suffix:semicolon
multiline_comment|/* search a frequency that fits into the allowed error range */
id|idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|arraysize
c_func
(paren
id|freq
)paren
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* if we will tolerate 3% error 8000Hz-&gt;8195Hz (2.38%) would&n;&t;&t; * be playable without expanding, but that now a kernel runtime&n;&t;&t; * option&n;&t;&t; */
r_if
c_cond
(paren
(paren
l_int|100
op_star
id|abs
c_func
(paren
id|sound.soft.speed
op_minus
id|freq
(braket
id|i
)braket
)paren
op_div
id|freq
(braket
id|i
)braket
)paren
OL
id|catchRadius
)paren
id|idx
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|idx
OG
op_minus
l_int|1
)paren
(brace
id|sound.soft.speed
op_assign
id|freq
(braket
id|idx
)braket
suffix:semicolon
id|sound.trans
op_assign
op_amp
id|transFalconNormal
suffix:semicolon
)brace
r_else
id|sound.trans
op_assign
op_amp
id|transFalconExpanding
suffix:semicolon
id|FalconSilence
c_func
(paren
)paren
suffix:semicolon
id|sound.hard
op_assign
id|sound.soft
suffix:semicolon
r_if
c_cond
(paren
id|sound.hard.size
op_eq
l_int|16
)paren
(brace
multiline_comment|/* the Falcon can play 16bit samples only in stereo */
id|sound.hard.stereo
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|49170
)paren
(brace
multiline_comment|/* we would need to squeeze the sound, but we won&squot;t do that */
id|sound.hard.speed
op_assign
l_int|49170
suffix:semicolon
id|divider
op_assign
l_int|1
suffix:semicolon
id|sound.trans
op_assign
op_amp
id|transFalconNormal
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|32780
)paren
(brace
id|sound.hard.speed
op_assign
l_int|49170
suffix:semicolon
id|divider
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|24585
)paren
(brace
id|sound.hard.speed
op_assign
l_int|32780
suffix:semicolon
id|divider
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|19668
)paren
(brace
id|sound.hard.speed
op_assign
l_int|24585
suffix:semicolon
id|divider
op_assign
l_int|3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|16390
)paren
(brace
id|sound.hard.speed
op_assign
l_int|19668
suffix:semicolon
id|divider
op_assign
l_int|4
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|12292
)paren
(brace
id|sound.hard.speed
op_assign
l_int|16390
suffix:semicolon
id|divider
op_assign
l_int|5
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|9834
)paren
(brace
id|sound.hard.speed
op_assign
l_int|12292
suffix:semicolon
id|divider
op_assign
l_int|7
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sound.hard.speed
OG
l_int|8195
)paren
(brace
id|sound.hard.speed
op_assign
l_int|9834
suffix:semicolon
id|divider
op_assign
l_int|9
suffix:semicolon
)brace
r_else
(brace
id|sound.hard.speed
op_assign
l_int|8195
suffix:semicolon
id|divider
op_assign
l_int|11
suffix:semicolon
)brace
id|tt_dmasnd.int_div
op_assign
id|divider
suffix:semicolon
multiline_comment|/* Setup Falcon sound DMA for playback */
id|tt_dmasnd.int_ctrl
op_assign
l_int|0x4
suffix:semicolon
multiline_comment|/* Timer A int at play end */
id|tt_dmasnd.track_select
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* play 1 track, track 1 */
id|tt_dmasnd.cbar_src
op_assign
l_int|0x0001
suffix:semicolon
multiline_comment|/* DMA(25MHz) --&gt; DAC */
id|tt_dmasnd.cbar_dst
op_assign
l_int|0x0000
suffix:semicolon
id|tt_dmasnd.rec_track_select
op_assign
l_int|0
suffix:semicolon
id|tt_dmasnd.dac_src
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* connect matrix to DAC */
id|tt_dmasnd.adc_src
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ADC Input = Mic */
id|tt_dmasnd.mode
op_assign
(paren
id|sound.hard.stereo
ques
c_cond
id|DMASND_MODE_STEREO
suffix:colon
id|DMASND_MODE_MONO
)paren
op_or
(paren
(paren
id|sound.hard.size
op_eq
l_int|8
)paren
ques
c_cond
id|DMASND_MODE_8BIT
suffix:colon
id|DMASND_MODE_16BIT
)paren
op_or
id|DMASND_MODE_6KHZ
suffix:semicolon
id|sound.bal
op_assign
op_minus
id|sound.soft.speed
suffix:semicolon
)brace
DECL|function|FalconSetFormat
r_static
r_int
id|FalconSetFormat
c_func
(paren
r_int
id|format
)paren
(brace
r_int
id|size
suffix:semicolon
multiline_comment|/* Falcon sound DMA supports 8bit and 16bit modes */
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|AFMT_QUERY
suffix:colon
r_return
id|sound.soft.format
suffix:semicolon
r_case
id|AFMT_MU_LAW
suffix:colon
r_case
id|AFMT_A_LAW
suffix:colon
r_case
id|AFMT_U8
suffix:colon
r_case
id|AFMT_S8
suffix:colon
id|size
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
r_case
id|AFMT_U16_BE
suffix:colon
r_case
id|AFMT_S16_LE
suffix:colon
r_case
id|AFMT_U16_LE
suffix:colon
id|size
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* :-) */
id|size
op_assign
l_int|8
suffix:semicolon
id|format
op_assign
id|AFMT_S8
suffix:semicolon
)brace
id|sound.soft.format
op_assign
id|format
suffix:semicolon
id|sound.soft.size
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
(brace
id|sound.dsp.format
op_assign
id|format
suffix:semicolon
id|sound.dsp.size
op_assign
id|sound.soft.size
suffix:semicolon
)brace
id|FalconInit
c_func
(paren
)paren
suffix:semicolon
r_return
id|format
suffix:semicolon
)brace
multiline_comment|/* This is for the Falcon output *attenuation* in 1.5dB steps,&n; * i.e. output level from 0 to -22.5dB in -1.5dB steps.&n; */
DECL|macro|VOLUME_VOXWARE_TO_ATT
mdefine_line|#define VOLUME_VOXWARE_TO_ATT(v) &bslash;&n;&t;((v) &lt; 0 ? 15 : (v) &gt; 100 ? 0 : 15 - (v) * 3 / 20)
DECL|macro|VOLUME_ATT_TO_VOXWARE
mdefine_line|#define VOLUME_ATT_TO_VOXWARE(v) (100 - (v) * 20 / 3)
DECL|function|FalconSetVolume
r_static
r_int
id|FalconSetVolume
c_func
(paren
r_int
id|volume
)paren
(brace
id|sound.volume_left
op_assign
id|VOLUME_VOXWARE_TO_ATT
c_func
(paren
id|volume
op_amp
l_int|0xff
)paren
suffix:semicolon
id|sound.volume_right
op_assign
id|VOLUME_VOXWARE_TO_ATT
c_func
(paren
(paren
id|volume
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|tt_dmasnd.output_atten
op_assign
id|sound.volume_left
op_lshift
l_int|8
op_or
id|sound.volume_right
op_lshift
l_int|4
suffix:semicolon
r_return
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
DECL|function|ata_sq_play_next_frame
r_static
r_void
id|ata_sq_play_next_frame
c_func
(paren
r_int
id|index
)paren
(brace
r_char
op_star
id|start
comma
op_star
id|end
suffix:semicolon
multiline_comment|/* used by AtaPlay() if all doubts whether there really is something&n;&t; * to be played are already wiped out.&n;&t; */
id|start
op_assign
id|sq_block_address
c_func
(paren
id|sq.front
)paren
suffix:semicolon
id|end
op_assign
id|start
op_plus
(paren
(paren
id|sq.count
op_eq
id|index
)paren
ques
c_cond
id|sq.rear_size
suffix:colon
id|sq.block_size
)paren
suffix:semicolon
multiline_comment|/* end might not be a legal virtual address. */
id|DMASNDSetEnd
c_func
(paren
id|VTOP
c_func
(paren
id|end
op_minus
l_int|1
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|DMASNDSetBase
c_func
(paren
id|VTOP
c_func
(paren
id|start
)paren
)paren
suffix:semicolon
multiline_comment|/* Since only an even number of samples per frame can&n;&t;   be played, we might lose one byte here. (TO DO) */
id|sq.front
op_assign
(paren
id|sq.front
op_plus
l_int|1
)paren
op_mod
id|sq.max_count
suffix:semicolon
id|sq.playing
op_increment
suffix:semicolon
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_ON
op_or
id|DMASND_CTRL_REPEAT
suffix:semicolon
)brace
DECL|function|AtaPlay
r_static
r_void
id|AtaPlay
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* ++TeSche: Note that sq.playing is no longer just a flag but holds&n;&t; * the number of frames the DMA is currently programmed for instead,&n;&t; * may be 0, 1 (currently being played) or 2 (pre-programmed).&n;&t; *&n;&t; * Changes done to sq.count and sq.playing are a bit more subtle again&n;&t; * so now I must admit I also prefer disabling the irq here rather&n;&t; * than considering all possible situations. But the point is that&n;&t; * disabling the irq doesn&squot;t have any bad influence on this version of&n;&t; * the driver as we benefit from having pre-programmed the DMA&n;&t; * wherever possible: There&squot;s no need to reload the DMA at the exact&n;&t; * time of an interrupt but only at some time while the pre-programmed&n;&t; * frame is playing!&n;&t; */
id|atari_disable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sq.playing
op_eq
l_int|2
op_logical_or
multiline_comment|/* DMA is &squot;full&squot; */
id|sq.count
op_le
l_int|0
)paren
(brace
multiline_comment|/* nothing to do */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.playing
op_eq
l_int|0
)paren
(brace
multiline_comment|/* looks like there&squot;s nothing &squot;in&squot; the DMA yet, so try&n;&t;&t; * to put two frames into it (at least one is available).&n;&t;&t; */
r_if
c_cond
(paren
id|sq.count
op_eq
l_int|1
op_logical_and
id|sq.rear_size
OL
id|sq.block_size
op_logical_and
op_logical_neg
id|sq.syncing
)paren
(brace
multiline_comment|/* hmmm, the only existing frame is not&n;&t;&t;&t; * yet filled and we&squot;re not syncing?&n;&t;&t;&t; */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ata_sq_play_next_frame
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sq.count
op_eq
l_int|1
)paren
(brace
multiline_comment|/* no more frames */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.count
op_eq
l_int|2
op_logical_and
id|sq.rear_size
OL
id|sq.block_size
op_logical_and
op_logical_neg
id|sq.syncing
)paren
(brace
multiline_comment|/* hmmm, there were two frames, but the second&n;&t;&t;&t; * one is not yet filled and we&squot;re not syncing?&n;&t;&t;&t; */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ata_sq_play_next_frame
c_func
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* there&squot;s already a frame being played so we may only stuff&n;&t;&t; * one new into the DMA, but even if this may be the last&n;&t;&t; * frame existing the previous one is still on sq.count.&n;&t;&t; */
r_if
c_cond
(paren
id|sq.count
op_eq
l_int|2
op_logical_and
id|sq.rear_size
OL
id|sq.block_size
op_logical_and
op_logical_neg
id|sq.syncing
)paren
(brace
multiline_comment|/* hmmm, the only existing frame is not&n;&t;&t;&t; * yet filled and we&squot;re not syncing?&n;&t;&t;&t; */
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ata_sq_play_next_frame
c_func
(paren
l_int|2
)paren
suffix:semicolon
)brace
id|atari_enable_irq
c_func
(paren
id|IRQ_MFP_TIMA
)paren
suffix:semicolon
)brace
DECL|function|ata_sq_interrupt
r_static
r_void
id|ata_sq_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
macro_line|#if 0
multiline_comment|/* ++TeSche: if you should want to test this... */
r_static
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sq.playing
op_eq
l_int|2
)paren
r_if
c_cond
(paren
op_increment
id|cnt
op_eq
l_int|10
)paren
(brace
multiline_comment|/* simulate losing an interrupt */
id|cnt
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sq.ignore_int
op_logical_and
(paren
id|sound.mach.type
op_eq
id|DMASND_FALCON
)paren
)paren
(brace
multiline_comment|/* ++TeSche: Falcon only: ignore first irq because it comes&n;&t;&t; * immediately after starting a frame. after that, irqs come&n;&t;&t; * (almost) like on the TT.&n;&t;&t; */
id|sq.ignore_int
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
(brace
multiline_comment|/* playing was interrupted and sq_reset() has already cleared&n;&t;&t; * the sq variables, so better don&squot;t do anything here.&n;&t;&t; */
id|WAKE_UP
c_func
(paren
id|sq.sync_queue
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Probably ;) one frame is finished. Well, in fact it may be that a&n;&t; * pre-programmed one is also finished because there has been a long&n;&t; * delay in interrupt delivery and we&squot;ve completely lost one, but&n;&t; * there&squot;s no way to detect such a situation. In such a case the last&n;&t; * frame will be played more than once and the situation will recover&n;&t; * as soon as the irq gets through.&n;&t; */
id|sq.count
op_decrement
suffix:semicolon
id|sq.playing
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
(brace
id|tt_dmasnd.ctrl
op_assign
id|DMASND_CTRL_OFF
suffix:semicolon
id|sq.ignore_int
op_assign
l_int|1
suffix:semicolon
)brace
id|WAKE_UP
c_func
(paren
id|sq.write_queue
)paren
suffix:semicolon
multiline_comment|/* At least one block of the queue is free now&n;&t;   so wake up a writing process blocked because&n;&t;   of a full queue. */
r_if
c_cond
(paren
(paren
id|sq.playing
op_ne
l_int|1
)paren
op_logical_or
(paren
id|sq.count
op_ne
l_int|1
)paren
)paren
multiline_comment|/* We must be a bit carefully here: sq.count indicates the&n;&t;&t; * number of buffers used and not the number of frames to&n;&t;&t; * be played. If sq.count==1 and sq.playing==1 that means&n;&t;&t; * the only remaining frame was already programmed earlier&n;&t;&t; * (and is currently running) so we mustn&squot;t call AtaPlay()&n;&t;&t; * here, otherwise we&squot;ll play one frame too much.&n;&t;&t; */
id|AtaPlay
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
id|WAKE_UP
c_func
(paren
id|sq.sync_queue
)paren
suffix:semicolon
multiline_comment|/* We are not playing after AtaPlay(), so there&n;&t;   is nothing to play any more. Wake up a process&n;&t;   waiting for audio output to drain. */
)brace
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
multiline_comment|/*&n; * Amiga&n; */
DECL|function|AmiAlloc
r_static
r_void
op_star
id|AmiAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_return
id|amiga_chip_alloc
c_func
(paren
(paren
r_int
)paren
id|size
)paren
suffix:semicolon
)brace
DECL|function|AmiFree
r_static
r_void
id|AmiFree
c_func
(paren
r_void
op_star
id|obj
comma
r_int
r_int
id|size
)paren
(brace
id|amiga_chip_free
(paren
id|obj
)paren
suffix:semicolon
)brace
DECL|function|AmiIrqInit
r_static
r_int
id|AmiIrqInit
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* turn off DMA for audio channels */
id|custom.dmacon
op_assign
id|AMI_AUDIO_OFF
suffix:semicolon
multiline_comment|/* Register interrupt handler. */
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|IRQ_AMIGA_AUD0
comma
id|ami_sq_interrupt
comma
l_int|0
comma
l_string|&quot;DMA sound&quot;
comma
id|ami_sq_interrupt
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|AmiIrqCleanUp
r_static
r_void
id|AmiIrqCleanUp
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* turn off DMA for audio channels */
id|custom.dmacon
op_assign
id|AMI_AUDIO_OFF
suffix:semicolon
multiline_comment|/* release the interrupt */
id|free_irq
c_func
(paren
id|IRQ_AMIGA_AUD0
comma
id|ami_sq_interrupt
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
DECL|function|AmiSilence
r_static
r_void
id|AmiSilence
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* turn off DMA for audio channels */
id|custom.dmacon
op_assign
id|AMI_AUDIO_OFF
suffix:semicolon
)brace
DECL|function|AmiInit
r_static
r_void
id|AmiInit
c_func
(paren
r_void
)paren
(brace
r_int
id|period
comma
id|i
suffix:semicolon
id|AmiSilence
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound.soft.speed
)paren
id|period
op_assign
id|amiga_colorclock
op_div
id|sound.soft.speed
op_minus
l_int|1
suffix:semicolon
r_else
id|period
op_assign
id|amiga_audio_min_period
suffix:semicolon
id|sound.hard
op_assign
id|sound.soft
suffix:semicolon
id|sound.trans
op_assign
op_amp
id|transAmiga
suffix:semicolon
r_if
c_cond
(paren
id|period
OL
id|amiga_audio_min_period
)paren
(brace
multiline_comment|/* we would need to squeeze the sound, but we won&squot;t do that */
id|period
op_assign
id|amiga_audio_min_period
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|period
OG
l_int|65535
)paren
(brace
id|period
op_assign
l_int|65535
suffix:semicolon
)brace
id|sound.hard.speed
op_assign
id|amiga_colorclock
op_div
(paren
id|period
op_plus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|custom.aud
(braket
id|i
)braket
dot
id|audper
op_assign
id|period
suffix:semicolon
id|amiga_audio_period
op_assign
id|period
suffix:semicolon
id|AmiSetTreble
c_func
(paren
l_int|50
)paren
suffix:semicolon
multiline_comment|/* recommended for newer amiga models */
)brace
DECL|function|AmiSetFormat
r_static
r_int
id|AmiSetFormat
c_func
(paren
r_int
id|format
)paren
(brace
r_int
id|size
suffix:semicolon
multiline_comment|/* Amiga sound DMA supports 8bit and 16bit (pseudo 14 bit) modes */
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|AFMT_QUERY
suffix:colon
r_return
id|sound.soft.format
suffix:semicolon
r_case
id|AFMT_MU_LAW
suffix:colon
r_case
id|AFMT_A_LAW
suffix:colon
r_case
id|AFMT_U8
suffix:colon
r_case
id|AFMT_S8
suffix:colon
id|size
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
r_case
id|AFMT_U16_BE
suffix:colon
r_case
id|AFMT_S16_LE
suffix:colon
r_case
id|AFMT_U16_LE
suffix:colon
id|size
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* :-) */
id|size
op_assign
l_int|8
suffix:semicolon
id|format
op_assign
id|AFMT_S8
suffix:semicolon
)brace
id|sound.soft.format
op_assign
id|format
suffix:semicolon
id|sound.soft.size
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
(brace
id|sound.dsp.format
op_assign
id|format
suffix:semicolon
id|sound.dsp.size
op_assign
id|sound.soft.size
suffix:semicolon
)brace
id|AmiInit
c_func
(paren
)paren
suffix:semicolon
r_return
id|format
suffix:semicolon
)brace
DECL|macro|VOLUME_VOXWARE_TO_AMI
mdefine_line|#define VOLUME_VOXWARE_TO_AMI(v) &bslash;&n;&t;(((v) &lt; 0) ? 0 : ((v) &gt; 100) ? 64 : ((v) * 64)/100)
DECL|macro|VOLUME_AMI_TO_VOXWARE
mdefine_line|#define VOLUME_AMI_TO_VOXWARE(v) ((v)*100/64)
DECL|function|AmiSetVolume
r_static
r_int
id|AmiSetVolume
c_func
(paren
r_int
id|volume
)paren
(brace
id|sound.volume_left
op_assign
id|VOLUME_VOXWARE_TO_AMI
c_func
(paren
id|volume
op_amp
l_int|0xff
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|0
)braket
dot
id|audvol
op_assign
id|sound.volume_left
suffix:semicolon
id|sound.volume_right
op_assign
id|VOLUME_VOXWARE_TO_AMI
c_func
(paren
(paren
id|volume
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|1
)braket
dot
id|audvol
op_assign
id|sound.volume_right
suffix:semicolon
r_return
id|VOLUME_AMI_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
(paren
id|VOLUME_AMI_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|function|AmiSetTreble
r_static
r_int
id|AmiSetTreble
c_func
(paren
r_int
id|treble
)paren
(brace
id|sound.treble
op_assign
id|treble
suffix:semicolon
r_if
c_cond
(paren
id|treble
OL
l_int|50
)paren
id|ciaa.pra
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
r_else
id|ciaa.pra
op_or_assign
l_int|0x02
suffix:semicolon
r_return
id|treble
suffix:semicolon
)brace
DECL|macro|AMI_PLAY_LOADED
mdefine_line|#define AMI_PLAY_LOADED&t;&t;1
DECL|macro|AMI_PLAY_PLAYING
mdefine_line|#define AMI_PLAY_PLAYING&t;2
DECL|macro|AMI_PLAY_MASK
mdefine_line|#define AMI_PLAY_MASK&t;&t;3
DECL|function|ami_sq_play_next_frame
r_static
r_void
id|ami_sq_play_next_frame
c_func
(paren
r_int
id|index
)paren
(brace
id|u_char
op_star
id|start
comma
op_star
id|ch0
comma
op_star
id|ch1
comma
op_star
id|ch2
comma
op_star
id|ch3
suffix:semicolon
id|u_long
id|size
suffix:semicolon
multiline_comment|/* used by AmiPlay() if all doubts whether there really is something&n;&t; * to be played are already wiped out.&n;&t; */
id|start
op_assign
id|sq_block_address
c_func
(paren
id|sq.front
)paren
suffix:semicolon
id|size
op_assign
(paren
id|sq.count
op_eq
id|index
ques
c_cond
id|sq.rear_size
suffix:colon
id|sq.block_size
)paren
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sound.hard.stereo
)paren
(brace
id|ch0
op_assign
id|start
suffix:semicolon
id|ch1
op_assign
id|start
op_plus
id|sq.block_size_half
suffix:semicolon
id|size
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|ch0
op_assign
id|start
suffix:semicolon
id|ch1
op_assign
id|start
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sound.hard.size
op_eq
l_int|8
)paren
(brace
id|custom.aud
(braket
l_int|0
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch0
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|0
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
id|custom.aud
(braket
l_int|1
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch1
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|1
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
id|custom.dmacon
op_assign
id|AMI_AUDIO_8
suffix:semicolon
)brace
r_else
(brace
id|size
op_rshift_assign
l_int|1
suffix:semicolon
id|custom.aud
(braket
l_int|0
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch0
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|0
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
id|custom.aud
(braket
l_int|1
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch1
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|1
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sound.volume_left
op_eq
l_int|64
op_logical_and
id|sound.volume_right
op_eq
l_int|64
)paren
(brace
multiline_comment|/* We can play pseudo 14-bit only with the maximum volume */
id|ch3
op_assign
id|ch0
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|ch2
op_assign
id|ch1
op_plus
id|sq.block_size_quarter
suffix:semicolon
id|custom.aud
(braket
l_int|2
)braket
dot
id|audvol
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* we are being affected by the beeps */
id|custom.aud
(braket
l_int|3
)braket
dot
id|audvol
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* restoring volume here helps a bit */
id|custom.aud
(braket
l_int|2
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch2
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|2
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
id|custom.aud
(braket
l_int|3
)braket
dot
id|audlc
op_assign
(paren
id|u_short
op_star
)paren
id|ZTWO_PADDR
c_func
(paren
id|ch3
)paren
suffix:semicolon
id|custom.aud
(braket
l_int|3
)braket
dot
id|audlen
op_assign
id|size
suffix:semicolon
id|custom.dmacon
op_assign
id|AMI_AUDIO_14
suffix:semicolon
)brace
r_else
id|custom.dmacon
op_assign
id|AMI_AUDIO_8
suffix:semicolon
)brace
id|sq.front
op_assign
(paren
id|sq.front
op_plus
l_int|1
)paren
op_mod
id|sq.max_count
suffix:semicolon
id|sq.playing
op_or_assign
id|AMI_PLAY_LOADED
suffix:semicolon
)brace
DECL|function|AmiPlay
r_static
r_void
id|AmiPlay
c_func
(paren
r_void
)paren
(brace
r_int
id|minframes
op_assign
l_int|1
suffix:semicolon
id|custom.intena
op_assign
id|IF_AUD0
suffix:semicolon
r_if
c_cond
(paren
id|sq.playing
op_amp
id|AMI_PLAY_LOADED
)paren
(brace
multiline_comment|/* There&squot;s already a frame loaded */
id|custom.intena
op_assign
id|IF_SETCLR
op_or
id|IF_AUD0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.playing
op_amp
id|AMI_PLAY_PLAYING
)paren
multiline_comment|/* Increase threshold: frame 1 is already being played */
id|minframes
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|sq.count
OL
id|minframes
)paren
(brace
multiline_comment|/* Nothing to do */
id|custom.intena
op_assign
id|IF_SETCLR
op_or
id|IF_AUD0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.count
op_le
id|minframes
op_logical_and
id|sq.rear_size
OL
id|sq.block_size
op_logical_and
op_logical_neg
id|sq.syncing
)paren
(brace
multiline_comment|/* hmmm, the only existing frame is not&n;&t;&t; * yet filled and we&squot;re not syncing?&n;&t;&t; */
id|custom.intena
op_assign
id|IF_SETCLR
op_or
id|IF_AUD0
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ami_sq_play_next_frame
c_func
(paren
id|minframes
)paren
suffix:semicolon
id|custom.intena
op_assign
id|IF_SETCLR
op_or
id|IF_AUD0
suffix:semicolon
)brace
DECL|function|ami_sq_interrupt
r_static
r_void
id|ami_sq_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
r_int
id|minframes
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
(brace
multiline_comment|/* Playing was interrupted and sq_reset() has already cleared&n;&t;&t; * the sq variables, so better don&squot;t do anything here.&n;&t;&t; */
id|WAKE_UP
c_func
(paren
id|sq.sync_queue
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.playing
op_amp
id|AMI_PLAY_PLAYING
)paren
(brace
multiline_comment|/* We&squot;ve just finished a frame */
id|sq.count
op_decrement
suffix:semicolon
id|WAKE_UP
c_func
(paren
id|sq.write_queue
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sq.playing
op_amp
id|AMI_PLAY_LOADED
)paren
multiline_comment|/* Increase threshold: frame 1 is already being played */
id|minframes
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Shift the flags */
id|sq.playing
op_assign
(paren
id|sq.playing
op_lshift
l_int|1
)paren
op_amp
id|AMI_PLAY_MASK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
multiline_comment|/* No frame is playing, disable audio DMA */
id|custom.dmacon
op_assign
id|AMI_AUDIO_OFF
suffix:semicolon
r_if
c_cond
(paren
id|sq.count
op_ge
id|minframes
)paren
multiline_comment|/* Try to play the next frame */
id|AmiPlay
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
multiline_comment|/* Nothing to play anymore.&n;&t;&t;   Wake up a process waiting for audio output to drain. */
id|WAKE_UP
c_func
(paren
id|sq.sync_queue
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
multiline_comment|/*&n; * PCI PowerMac, with AWACS and DBDMA.&n; */
DECL|function|PMacAlloc
r_static
r_void
op_star
id|PMacAlloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_return
id|kmalloc
c_func
(paren
id|size
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|PMacFree
r_static
r_void
id|PMacFree
c_func
(paren
r_void
op_star
id|ptr
comma
r_int
r_int
id|size
)paren
(brace
id|kfree
c_func
(paren
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|PMacIrqInit
r_static
r_int
id|PMacIrqInit
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|awacs_irq
comma
id|pmac_awacs_intr
comma
l_int|0
comma
l_string|&quot;AWACS&quot;
comma
l_int|0
)paren
op_logical_or
id|request_irq
c_func
(paren
id|awacs_tx_irq
comma
id|pmac_awacs_tx_intr
comma
l_int|0
comma
l_string|&quot;AWACS out&quot;
comma
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|PMacIrqCleanup
r_static
r_void
id|PMacIrqCleanup
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* turn off output dma */
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
id|RUN
op_lshift
l_int|16
)paren
suffix:semicolon
multiline_comment|/* disable interrupts from awacs interface */
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;control
)paren
op_amp
l_int|0xfff
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|awacs_irq
comma
id|pmac_awacs_intr
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|awacs_tx_irq
comma
id|pmac_awacs_tx_intr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|awacs_tx_cmd_space
)paren
suffix:semicolon
r_if
c_cond
(paren
id|beep_buf
)paren
id|kfree
c_func
(paren
id|beep_buf
)paren
suffix:semicolon
id|kd_mksound
op_assign
id|orig_mksound
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
DECL|function|PMacSilence
r_static
r_void
id|PMacSilence
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* turn off output dma */
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
id|RUN
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
DECL|variable|awacs_freqs
r_static
r_int
id|awacs_freqs
(braket
l_int|8
)braket
op_assign
(brace
l_int|44100
comma
l_int|29400
comma
l_int|22050
comma
l_int|17640
comma
l_int|14700
comma
l_int|11025
comma
l_int|8820
comma
l_int|7350
)brace
suffix:semicolon
DECL|function|PMacInit
r_static
r_void
id|PMacInit
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|tolerance
suffix:semicolon
r_switch
c_cond
(paren
id|sound.soft.format
)paren
(brace
r_case
id|AFMT_S16_LE
suffix:colon
r_case
id|AFMT_U16_LE
suffix:colon
id|sound.hard.format
op_assign
id|AFMT_S16_LE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sound.hard.format
op_assign
id|AFMT_S16_BE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sound.hard.stereo
op_assign
l_int|1
suffix:semicolon
id|sound.hard.size
op_assign
l_int|16
suffix:semicolon
multiline_comment|/*&n;&t; * If we have a sample rate which is within catchRadius percent&n;&t; * of the requested value, we don&squot;t have to expand the samples.&n;&t; * Otherwise choose the next higher rate.&n;&t; */
id|i
op_assign
l_int|8
suffix:semicolon
r_do
(brace
id|tolerance
op_assign
id|catchRadius
op_star
id|awacs_freqs
(braket
op_decrement
id|i
)braket
op_div
l_int|100
suffix:semicolon
)brace
r_while
c_loop
(paren
id|sound.soft.speed
OG
id|awacs_freqs
(braket
id|i
)braket
op_plus
id|tolerance
op_logical_and
id|i
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound.soft.speed
op_ge
id|awacs_freqs
(braket
id|i
)braket
op_minus
id|tolerance
)paren
id|sound.trans
op_assign
op_amp
id|transAwacsNormal
suffix:semicolon
r_else
id|sound.trans
op_assign
op_amp
id|transAwacsExpand
suffix:semicolon
id|sound.hard.speed
op_assign
id|awacs_freqs
(braket
id|i
)braket
suffix:semicolon
id|awacs_rate_index
op_assign
id|i
suffix:semicolon
id|PMacSilence
c_func
(paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
id|MASK_IEPC
op_or
id|MASK_IEE
op_or
(paren
id|i
op_lshift
l_int|8
)paren
op_or
l_int|0x11
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|1
)braket
op_assign
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_amp
op_complement
id|MASK_SAMPLERATE
)paren
op_or
(paren
id|i
op_lshift
l_int|3
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_or
id|MASK_ADDR1
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;byteswap
comma
id|sound.hard.format
op_ne
id|AFMT_S16_BE
)paren
suffix:semicolon
id|sound.bal
op_assign
op_minus
id|sound.soft.speed
suffix:semicolon
)brace
DECL|function|PMacSetFormat
r_static
r_int
id|PMacSetFormat
c_func
(paren
r_int
id|format
)paren
(brace
r_int
id|size
suffix:semicolon
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|AFMT_QUERY
suffix:colon
r_return
id|sound.soft.format
suffix:semicolon
r_case
id|AFMT_MU_LAW
suffix:colon
r_case
id|AFMT_A_LAW
suffix:colon
r_case
id|AFMT_U8
suffix:colon
r_case
id|AFMT_S8
suffix:colon
id|size
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
r_case
id|AFMT_U16_BE
suffix:colon
r_case
id|AFMT_S16_LE
suffix:colon
r_case
id|AFMT_U16_LE
suffix:colon
id|size
op_assign
l_int|16
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* :-) */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dmasound: unknown format 0x%x, using AFMT_U8&bslash;n&quot;
comma
id|format
)paren
suffix:semicolon
id|size
op_assign
l_int|8
suffix:semicolon
id|format
op_assign
id|AFMT_U8
suffix:semicolon
)brace
id|sound.soft.format
op_assign
id|format
suffix:semicolon
id|sound.soft.size
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
(brace
id|sound.dsp.format
op_assign
id|format
suffix:semicolon
id|sound.dsp.size
op_assign
id|size
suffix:semicolon
)brace
id|PMacInit
c_func
(paren
)paren
suffix:semicolon
r_return
id|format
suffix:semicolon
)brace
DECL|macro|AWACS_VOLUME_TO_MASK
mdefine_line|#define AWACS_VOLUME_TO_MASK(x)&t;(15 - ((((x) - 1) * 15) / 99))
DECL|macro|AWACS_MASK_TO_VOLUME
mdefine_line|#define AWACS_MASK_TO_VOLUME(y)&t;(100 - ((y) * 99 / 15))
DECL|function|awacs_get_volume
r_static
r_int
id|awacs_get_volume
c_func
(paren
r_int
id|reg
comma
r_int
id|lshift
)paren
(brace
r_int
id|volume
suffix:semicolon
id|volume
op_assign
id|AWACS_MASK_TO_VOLUME
c_func
(paren
(paren
id|reg
op_rshift
id|lshift
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
id|volume
op_or_assign
id|AWACS_MASK_TO_VOLUME
c_func
(paren
id|reg
op_amp
l_int|0xf
)paren
op_lshift
l_int|8
suffix:semicolon
r_return
id|volume
suffix:semicolon
)brace
DECL|function|awacs_volume_setter
r_static
r_int
id|awacs_volume_setter
c_func
(paren
r_int
id|volume
comma
r_int
id|n
comma
r_int
id|mute
comma
r_int
id|lshift
)paren
(brace
r_int
id|r1
comma
id|rn
suffix:semicolon
r_if
c_cond
(paren
id|mute
op_logical_and
id|volume
op_eq
l_int|0
)paren
(brace
id|r1
op_assign
id|awacs_reg
(braket
l_int|1
)braket
op_or
id|mute
suffix:semicolon
)brace
r_else
(brace
id|r1
op_assign
id|awacs_reg
(braket
l_int|1
)braket
op_amp
op_complement
id|mute
suffix:semicolon
id|rn
op_assign
id|awacs_reg
(braket
id|n
)braket
op_amp
op_complement
(paren
l_int|0xf
op_or
(paren
l_int|0xf
op_lshift
id|lshift
)paren
)paren
suffix:semicolon
id|rn
op_or_assign
(paren
(paren
id|AWACS_VOLUME_TO_MASK
c_func
(paren
id|volume
op_amp
l_int|0xff
)paren
op_amp
l_int|0xf
)paren
op_lshift
id|lshift
)paren
suffix:semicolon
id|rn
op_or_assign
id|AWACS_VOLUME_TO_MASK
c_func
(paren
(paren
id|volume
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_amp
l_int|0xf
suffix:semicolon
id|awacs_reg
(braket
id|n
)braket
op_assign
id|rn
suffix:semicolon
id|awacs_write
c_func
(paren
(paren
id|n
op_lshift
l_int|12
)paren
op_or
id|rn
)paren
suffix:semicolon
id|volume
op_assign
id|awacs_get_volume
c_func
(paren
id|rn
comma
id|lshift
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r1
op_ne
id|awacs_reg
(braket
l_int|1
)braket
)paren
(brace
id|awacs_reg
(braket
l_int|1
)braket
op_assign
id|r1
suffix:semicolon
id|awacs_write
c_func
(paren
id|r1
op_or
id|MASK_ADDR1
)paren
suffix:semicolon
)brace
r_return
id|volume
suffix:semicolon
)brace
DECL|function|PMacSetVolume
r_static
r_int
id|PMacSetVolume
c_func
(paren
r_int
id|volume
)paren
(brace
r_return
id|awacs_volume_setter
c_func
(paren
id|volume
comma
l_int|2
comma
id|MASK_AMUTE
comma
l_int|6
)paren
suffix:semicolon
)brace
DECL|function|PMacPlay
r_static
r_void
id|PMacPlay
c_func
(paren
r_void
)paren
(brace
r_volatile
r_struct
id|dbdma_cmd
op_star
id|cp
suffix:semicolon
r_int
id|i
comma
id|count
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|beep_playing
)paren
(brace
multiline_comment|/* sound takes precedence over beeps */
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
(paren
id|RUN
op_or
id|PAUSE
op_or
id|FLUSH
op_or
id|WAKE
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;control
)paren
op_amp
op_complement
l_int|0x1f00
)paren
op_logical_or
(paren
id|awacs_rate_index
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;byteswap
comma
id|sound.hard.format
op_ne
id|AFMT_S16_BE
)paren
suffix:semicolon
id|beep_playing
op_assign
l_int|0
suffix:semicolon
)brace
id|i
op_assign
id|sq.front
op_plus
id|sq.playing
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|sq.max_count
)paren
id|i
op_sub_assign
id|sq.max_count
suffix:semicolon
r_while
c_loop
(paren
id|sq.playing
OL
l_int|2
op_logical_and
id|sq.playing
OL
id|sq.count
)paren
(brace
id|count
op_assign
(paren
id|sq.count
op_eq
id|sq.playing
op_plus
l_int|1
)paren
ques
c_cond
id|sq.rear_size
suffix:colon
id|sq.block_size
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|sq.block_size
op_logical_and
op_logical_neg
id|sq.syncing
)paren
multiline_comment|/* last block not yet filled, and we&squot;re not syncing. */
r_break
suffix:semicolon
id|cp
op_assign
op_amp
id|awacs_tx_cmds
(braket
id|i
)braket
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;req_count
comma
id|count
)paren
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;xfer_status
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|i
op_ge
id|sq.max_count
)paren
id|i
op_assign
l_int|0
suffix:semicolon
id|out_le16
c_func
(paren
op_amp
id|awacs_tx_cmds
(braket
id|i
)braket
dot
id|command
comma
id|DBDMA_STOP
)paren
suffix:semicolon
id|out_le16
c_func
(paren
op_amp
id|cp-&gt;command
comma
id|OUTPUT_MORE
op_plus
id|INTR_ALWAYS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sq.playing
op_eq
l_int|0
)paren
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;cmdptr
comma
id|virt_to_bus
c_func
(paren
id|cp
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
(paren
(paren
id|RUN
op_or
id|WAKE
)paren
op_lshift
l_int|16
)paren
op_plus
(paren
id|RUN
op_or
id|WAKE
)paren
)paren
suffix:semicolon
op_increment
id|sq.playing
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|pmac_awacs_tx_intr
id|pmac_awacs_tx_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|i
op_assign
id|sq.front
suffix:semicolon
r_int
id|stat
suffix:semicolon
r_volatile
r_struct
id|dbdma_cmd
op_star
id|cp
suffix:semicolon
r_while
c_loop
(paren
id|sq.playing
OG
l_int|0
)paren
(brace
id|cp
op_assign
op_amp
id|awacs_tx_cmds
(braket
id|i
)braket
suffix:semicolon
id|stat
op_assign
id|ld_le16
c_func
(paren
op_amp
id|cp-&gt;xfer_status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|ACTIVE
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
multiline_comment|/* this frame is still going */
op_decrement
id|sq.count
suffix:semicolon
op_decrement
id|sq.playing
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|i
op_ge
id|sq.max_count
)paren
id|i
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ne
id|sq.front
)paren
id|WAKE_UP
c_func
(paren
id|sq.write_queue
)paren
suffix:semicolon
id|sq.front
op_assign
id|i
suffix:semicolon
id|PMacPlay
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sq.playing
)paren
id|WAKE_UP
c_func
(paren
id|sq.sync_queue
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|pmac_awacs_intr
id|pmac_awacs_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|ctrl
op_assign
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;control
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctrl
op_amp
id|MASK_PORTCHG
)paren
(brace
multiline_comment|/* do something when headphone is plugged/unplugged? */
)brace
r_if
c_cond
(paren
id|ctrl
op_amp
id|MASK_CNTLERR
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AWACS: error, status = %x&bslash;n&quot;
comma
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_stat
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Writing 1s to the CNTLERR and PORTCHG bits clears them... */
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
id|ctrl
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awacs_write
id|awacs_write
c_func
(paren
r_int
id|val
)paren
(brace
r_while
c_loop
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
)paren
op_amp
id|MASK_NEWECMD
)paren
suffix:semicolon
multiline_comment|/* XXX should have timeout */
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;codec_ctrl
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|awacs_nosound
r_static
r_void
id|awacs_nosound
c_func
(paren
r_int
r_int
id|xx
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|beep_playing
)paren
(brace
id|st_le16
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;command
comma
id|DBDMA_STOP
)paren
suffix:semicolon
id|beep_playing
op_assign
l_int|0
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|beep_timer
r_static
r_struct
id|timer_list
id|beep_timer
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
id|awacs_nosound
)brace
suffix:semicolon
DECL|function|awacs_mksound
r_static
r_void
id|awacs_mksound
c_func
(paren
r_int
r_int
id|hz
comma
r_int
r_int
id|ticks
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|srate
op_assign
id|awacs_freqs
(braket
id|BEEP_SPEED
)braket
suffix:semicolon
r_int
id|period
comma
id|ncycles
comma
id|nsamples
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|f
suffix:semicolon
r_int
op_star
id|p
suffix:semicolon
r_static
r_int
id|beep_hz_cache
suffix:semicolon
r_static
r_int
id|beep_nsamples_cache
suffix:semicolon
r_static
r_int
id|beep_volume_cache
suffix:semicolon
r_if
c_cond
(paren
id|hz
op_le
id|srate
op_div
id|BEEP_BUFLEN
op_logical_or
id|hz
OG
id|srate
op_div
l_int|2
)paren
(brace
macro_line|#if 1
multiline_comment|/* this is a hack for broken X server code */
id|hz
op_assign
l_int|750
suffix:semicolon
id|ticks
op_assign
l_int|12
suffix:semicolon
macro_line|#else
multiline_comment|/* cancel beep currently playing */
id|awacs_nosound
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
macro_line|#endif
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|beep_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ticks
)paren
(brace
id|beep_timer.expires
op_assign
id|jiffies
op_plus
id|ticks
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|beep_timer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|beep_playing
op_logical_or
id|sq.playing
op_logical_or
id|beep_buf
op_eq
l_int|NULL
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* too hard, sorry :-( */
)brace
id|beep_playing
op_assign
l_int|1
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;command
comma
id|OUTPUT_MORE
op_plus
id|BR_ALWAYS
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hz
op_eq
id|beep_hz_cache
op_logical_and
id|beep_volume
op_eq
id|beep_volume_cache
)paren
(brace
id|nsamples
op_assign
id|beep_nsamples_cache
suffix:semicolon
)brace
r_else
(brace
id|period
op_assign
id|srate
op_star
l_int|256
op_div
id|hz
suffix:semicolon
multiline_comment|/* fixed point */
id|ncycles
op_assign
id|BEEP_BUFLEN
op_star
l_int|256
op_div
id|period
suffix:semicolon
id|nsamples
op_assign
(paren
id|period
op_star
id|ncycles
)paren
op_rshift
l_int|8
suffix:semicolon
id|f
op_assign
id|ncycles
op_star
l_int|65536
op_div
id|nsamples
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
id|p
op_assign
id|beep_buf
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nsamples
suffix:semicolon
op_increment
id|i
comma
id|p
op_add_assign
l_int|2
)paren
(brace
id|p
(braket
l_int|0
)braket
op_assign
id|p
(braket
l_int|1
)braket
op_assign
id|beep_wform
(braket
id|j
op_rshift
l_int|8
)braket
op_star
id|beep_volume
suffix:semicolon
id|j
op_assign
(paren
id|j
op_plus
id|f
)paren
op_amp
l_int|0xffff
suffix:semicolon
)brace
id|beep_hz_cache
op_assign
id|hz
suffix:semicolon
id|beep_volume_cache
op_assign
id|beep_volume
suffix:semicolon
id|beep_nsamples_cache
op_assign
id|nsamples
suffix:semicolon
)brace
id|st_le16
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;req_count
comma
id|nsamples
op_star
l_int|4
)paren
suffix:semicolon
id|st_le16
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;xfer_status
comma
l_int|0
)paren
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;cmd_dep
comma
id|virt_to_bus
c_func
(paren
id|beep_dbdma_cmd
)paren
)paren
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|beep_dbdma_cmd-&gt;phy_addr
comma
id|virt_to_bus
c_func
(paren
id|beep_buf
)paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|beep_playing
)paren
(brace
multiline_comment|/* i.e. haven&squot;t been terminated already */
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
(paren
id|RUN
op_or
id|WAKE
op_or
id|FLUSH
op_or
id|PAUSE
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
(paren
id|in_le32
c_func
(paren
op_amp
id|awacs-&gt;control
)paren
op_amp
op_complement
l_int|0x1f00
)paren
op_or
(paren
id|BEEP_SPEED
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;byteswap
comma
l_int|0
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;cmdptr
comma
id|virt_to_bus
c_func
(paren
id|beep_dbdma_cmd
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
id|RUN
op_or
(paren
id|RUN
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PMAC_PBOOK
multiline_comment|/*&n; * Save state when going to sleep, restore it afterwards.&n; */
DECL|function|awacs_sleep_notify
r_static
r_int
id|awacs_sleep_notify
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|code
comma
r_void
op_star
id|x
)paren
(brace
r_switch
c_cond
(paren
id|code
)paren
(brace
r_case
id|PBOOK_SLEEP
suffix:colon
multiline_comment|/* XXX we should stop any dma in progress when going to sleep&n;&t;&t;   and restart it when we wake. */
id|PMacSilence
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PBOOK_WAKE
suffix:colon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
id|MASK_IEPC
op_or
id|MASK_IEE
op_or
(paren
id|awacs_rate_index
op_lshift
l_int|8
)paren
op_or
l_int|0x11
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_or
id|MASK_ADDR0
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_or
id|MASK_ADDR1
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|2
)braket
op_or
id|MASK_ADDR2
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|4
)braket
op_or
id|MASK_ADDR4
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;byteswap
comma
id|sound.hard.format
op_ne
id|AFMT_S16_BE
)paren
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PMAC_PBOOK */
macro_line|#endif /* CONFIG_PMAC */
multiline_comment|/*** Machine definitions *****************************************************/
macro_line|#ifdef CONFIG_ATARI
DECL|variable|machTT
r_static
id|MACHINE
id|machTT
op_assign
(brace
id|DMASND_TT
comma
id|AtaAlloc
comma
id|AtaFree
comma
id|AtaIrqInit
comma
macro_line|#ifdef MODULE
id|AtaIrqCleanUp
comma
macro_line|#endif /* MODULE */
id|TTInit
comma
id|TTSilence
comma
id|TTSetFormat
comma
id|TTSetVolume
comma
id|AtaSetBass
comma
id|AtaSetTreble
comma
id|TTSetGain
comma
id|AtaPlay
)brace
suffix:semicolon
DECL|variable|machFalcon
r_static
id|MACHINE
id|machFalcon
op_assign
(brace
id|DMASND_FALCON
comma
id|AtaAlloc
comma
id|AtaFree
comma
id|AtaIrqInit
comma
macro_line|#ifdef MODULE
id|AtaIrqCleanUp
comma
macro_line|#endif /* MODULE */
id|FalconInit
comma
id|FalconSilence
comma
id|FalconSetFormat
comma
id|FalconSetVolume
comma
id|AtaSetBass
comma
id|AtaSetTreble
comma
l_int|NULL
comma
id|AtaPlay
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
DECL|variable|machAmiga
r_static
id|MACHINE
id|machAmiga
op_assign
(brace
id|DMASND_AMIGA
comma
id|AmiAlloc
comma
id|AmiFree
comma
id|AmiIrqInit
comma
macro_line|#ifdef MODULE
id|AmiIrqCleanUp
comma
macro_line|#endif /* MODULE */
id|AmiInit
comma
id|AmiSilence
comma
id|AmiSetFormat
comma
id|AmiSetVolume
comma
l_int|NULL
comma
id|AmiSetTreble
comma
l_int|NULL
comma
id|AmiPlay
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
DECL|variable|machPMac
r_static
id|MACHINE
id|machPMac
op_assign
(brace
id|DMASND_AWACS
comma
id|PMacAlloc
comma
id|PMacFree
comma
id|PMacIrqInit
comma
macro_line|#ifdef MODULE
id|PMacIrqCleanup
comma
macro_line|#endif /* MODULE */
id|PMacInit
comma
id|PMacSilence
comma
id|PMacSetFormat
comma
id|PMacSetVolume
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
multiline_comment|/* bass, treble, gain */
id|PMacPlay
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
multiline_comment|/*** Mid level stuff *********************************************************/
DECL|function|sound_silence
r_static
r_void
id|sound_silence
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* update hardware settings one more */
(paren
op_star
id|sound.mach.init
)paren
(paren
)paren
suffix:semicolon
(paren
op_star
id|sound.mach.silence
)paren
(paren
)paren
suffix:semicolon
)brace
DECL|function|sound_init
r_static
r_void
id|sound_init
c_func
(paren
r_void
)paren
(brace
(paren
op_star
id|sound.mach.init
)paren
(paren
)paren
suffix:semicolon
)brace
DECL|function|sound_set_format
r_static
r_int
id|sound_set_format
c_func
(paren
r_int
id|format
)paren
(brace
r_return
(paren
op_star
id|sound.mach.setFormat
)paren
(paren
id|format
)paren
suffix:semicolon
)brace
DECL|function|sound_set_speed
r_static
r_int
id|sound_set_speed
c_func
(paren
r_int
id|speed
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|0
)paren
r_return
id|sound.soft.speed
suffix:semicolon
id|sound.soft.speed
op_assign
id|speed
suffix:semicolon
(paren
op_star
id|sound.mach.init
)paren
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
id|sound.dsp.speed
op_assign
id|sound.soft.speed
suffix:semicolon
r_return
id|sound.soft.speed
suffix:semicolon
)brace
DECL|function|sound_set_stereo
r_static
r_int
id|sound_set_stereo
c_func
(paren
r_int
id|stereo
)paren
(brace
r_if
c_cond
(paren
id|stereo
OL
l_int|0
)paren
r_return
id|sound.soft.stereo
suffix:semicolon
id|stereo
op_assign
op_logical_neg
op_logical_neg
id|stereo
suffix:semicolon
multiline_comment|/* should be 0 or 1 now */
id|sound.soft.stereo
op_assign
id|stereo
suffix:semicolon
r_if
c_cond
(paren
id|sound.minDev
op_eq
id|SND_DEV_DSP
)paren
id|sound.dsp.stereo
op_assign
id|stereo
suffix:semicolon
(paren
op_star
id|sound.mach.init
)paren
(paren
)paren
suffix:semicolon
r_return
id|stereo
suffix:semicolon
)brace
DECL|function|sound_set_volume
r_static
r_int
id|sound_set_volume
c_func
(paren
r_int
id|volume
)paren
(brace
r_return
(paren
op_star
id|sound.mach.setVolume
)paren
(paren
id|volume
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ATARI
DECL|function|sound_set_bass
r_static
r_int
id|sound_set_bass
c_func
(paren
r_int
id|bass
)paren
(brace
r_return
id|sound.mach.setBass
ques
c_cond
(paren
op_star
id|sound.mach.setBass
)paren
(paren
id|bass
)paren
suffix:colon
l_int|50
suffix:semicolon
)brace
DECL|function|sound_set_gain
r_static
r_int
id|sound_set_gain
c_func
(paren
r_int
id|gain
)paren
(brace
r_return
id|sound.mach.setGain
ques
c_cond
id|sound.mach
dot
id|setGain
c_func
(paren
id|gain
)paren
suffix:colon
l_int|100
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ATARI */
macro_line|#if defined(CONFIG_ATARI) || defined(CONFIG_AMIGA)
DECL|function|sound_set_treble
r_static
r_int
id|sound_set_treble
c_func
(paren
r_int
id|treble
)paren
(brace
r_return
id|sound.mach.setTreble
ques
c_cond
(paren
op_star
id|sound.mach.setTreble
)paren
(paren
id|treble
)paren
suffix:colon
l_int|50
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ATARI || CONFIG_AMIGA */
DECL|function|sound_copy_translate
r_static
id|ssize_t
id|sound_copy_translate
c_func
(paren
r_const
id|u_char
op_star
id|userPtr
comma
r_int
id|userCount
comma
id|u_char
id|frame
(braket
)braket
comma
id|ssize_t
op_star
id|frameUsed
comma
id|ssize_t
id|frameLeft
)paren
(brace
id|ssize_t
(paren
op_star
id|ct_func
)paren
(paren
r_const
id|u_char
op_star
comma
r_int
comma
id|u_char
op_star
comma
id|ssize_t
op_star
comma
id|ssize_t
)paren
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|sound.soft.format
)paren
(brace
r_case
id|AFMT_MU_LAW
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_ulaw
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_A_LAW
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_alaw
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S8
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_s8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U8
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_u8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_s16be
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U16_BE
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_u16be
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_LE
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_s16le
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U16_LE
suffix:colon
id|ct_func
op_assign
id|sound.trans-&gt;ct_u16le
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ct_func
)paren
r_return
id|ct_func
c_func
(paren
id|userPtr
comma
id|userCount
comma
id|frame
comma
id|frameUsed
comma
id|frameLeft
)paren
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * /dev/mixer abstraction&n; */
DECL|macro|RECLEVEL_VOXWARE_TO_GAIN
mdefine_line|#define RECLEVEL_VOXWARE_TO_GAIN(v) &bslash;&n;&t;((v) &lt; 0 ? 0 : (v) &gt; 100 ? 15 : (v) * 3 / 20)
DECL|macro|RECLEVEL_GAIN_TO_VOXWARE
mdefine_line|#define RECLEVEL_GAIN_TO_VOXWARE(v) (((v) * 20 + 2) / 3)
DECL|function|mixer_open
r_static
r_int
id|mixer_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
id|mixer.busy
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixer_release
r_static
r_int
id|mixer_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|mixer.busy
op_assign
l_int|0
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixer_ioctl
r_static
r_int
id|mixer_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
r_int
id|data
suffix:semicolon
r_switch
c_cond
(paren
id|sound.mach.type
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|DMASND_FALCON
suffix:colon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_SPEAKER
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_MIC
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_MIC
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_CAPS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_CAP_EXCL_INPUT
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
id|VOLUME_ATT_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_MIC
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|tt_dmasnd.input_gain
op_assign
id|RECLEVEL_VOXWARE_TO_GAIN
c_func
(paren
id|data
op_amp
l_int|0xff
)paren
op_lshift
l_int|4
op_or
id|RECLEVEL_VOXWARE_TO_GAIN
c_func
(paren
id|data
op_rshift
l_int|8
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* fall thru, return set value */
r_case
id|SOUND_MIXER_READ_MIC
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|RECLEVEL_GAIN_TO_VOXWARE
c_func
(paren
id|tt_dmasnd.input_gain
op_rshift
l_int|4
op_amp
l_int|0xf
)paren
op_or
id|RECLEVEL_GAIN_TO_VOXWARE
c_func
(paren
id|tt_dmasnd.input_gain
op_amp
l_int|0xf
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_SPEAKER
suffix:colon
(brace
r_int
id|porta
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sound_ym.rd_data_reg_sel
op_assign
l_int|14
suffix:semicolon
id|porta
op_assign
id|sound_ym.rd_data_reg_sel
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|porta
op_amp
l_int|0x40
ques
c_cond
l_int|0
suffix:colon
l_int|100
)paren
suffix:semicolon
)brace
r_case
id|SOUND_MIXER_WRITE_VOLUME
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_volume
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_SPEAKER
suffix:colon
(brace
r_int
id|porta
suffix:semicolon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sound_ym.rd_data_reg_sel
op_assign
l_int|14
suffix:semicolon
id|porta
op_assign
(paren
id|sound_ym.rd_data_reg_sel
op_amp
op_complement
l_int|0x40
)paren
op_or
(paren
id|data
OL
l_int|50
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
suffix:semicolon
id|sound_ym.wd_data
op_assign
id|porta
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|porta
op_amp
l_int|0x40
ques
c_cond
l_int|0
suffix:colon
l_int|100
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|DMASND_TT
suffix:colon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_TREBLE
op_or
id|SOUND_MASK_BASS
op_or
(paren
id|MACH_IS_TT
ques
c_cond
id|SOUND_MASK_SPEAKER
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
l_int|0
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
(paren
id|VOLUME_DB_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_BASS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|sound.bass
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_TREBLE
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|TONE_DB_TO_VOXWARE
c_func
(paren
id|sound.treble
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_OGAIN
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|GAIN_DB_TO_VOXWARE
c_func
(paren
id|sound.gain
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_SPEAKER
suffix:colon
(brace
r_int
id|porta
suffix:semicolon
r_if
c_cond
(paren
id|MACH_IS_TT
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sound_ym.rd_data_reg_sel
op_assign
l_int|14
suffix:semicolon
id|porta
op_assign
id|sound_ym.rd_data_reg_sel
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|porta
op_amp
l_int|0x40
ques
c_cond
l_int|0
suffix:colon
l_int|100
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_VOLUME
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_volume
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_BASS
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_bass
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_TREBLE
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_treble
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_OGAIN
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_gain
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_SPEAKER
suffix:colon
r_if
c_cond
(paren
id|MACH_IS_TT
)paren
(brace
r_int
id|porta
suffix:semicolon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sound_ym.rd_data_reg_sel
op_assign
l_int|14
suffix:semicolon
id|porta
op_assign
(paren
id|sound_ym.rd_data_reg_sel
op_amp
op_complement
l_int|0x40
)paren
op_or
(paren
id|data
OL
l_int|50
ques
c_cond
l_int|0x40
suffix:colon
l_int|0
)paren
suffix:semicolon
id|sound_ym.wd_data
op_assign
id|porta
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|porta
op_amp
l_int|0x40
ques
c_cond
l_int|0
suffix:colon
l_int|100
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|DMASND_AMIGA
suffix:colon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_TREBLE
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
l_int|0
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|SOUND_MASK_VOLUME
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|VOLUME_AMI_TO_VOXWARE
c_func
(paren
id|sound.volume_left
)paren
op_or
id|VOLUME_AMI_TO_VOXWARE
c_func
(paren
id|sound.volume_right
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_VOLUME
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_volume
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_TREBLE
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound.treble
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_TREBLE
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_treble
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
r_case
id|DMASND_AWACS
suffix:colon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_READ_DEVMASK
suffix:colon
id|data
op_assign
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_SPEAKER
op_or
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_CD
op_or
id|SOUND_MASK_RECLEV
op_or
id|SOUND_MASK_ALTPCM
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECMASK
suffix:colon
id|data
op_assign
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_CD
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECSRC
suffix:colon
id|data
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_AUDIN
)paren
id|data
op_or_assign
id|SOUND_MASK_LINE
suffix:semicolon
r_if
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_MIC
)paren
id|data
op_or_assign
id|SOUND_MASK_MIC
suffix:semicolon
r_if
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_CD
)paren
id|data
op_or_assign
id|SOUND_MASK_CD
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_RECSRC
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|data
op_and_assign
(paren
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_CD
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_and_assign
op_complement
(paren
id|MASK_MUX_CD
op_or
id|MASK_MUX_MIC
op_or
id|MASK_MUX_AUDIN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SOUND_MASK_LINE
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_AUDIN
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SOUND_MASK_MIC
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_MIC
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SOUND_MASK_CD
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_CD
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_or
id|MASK_ADDR0
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_STEREODEVS
suffix:colon
id|data
op_assign
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_SPEAKER
op_or
id|SOUND_MASK_RECLEV
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_CAPS
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
l_int|0
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_VOLUME
suffix:colon
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_amp
id|MASK_AMUTE
)paren
ques
c_cond
l_int|0
suffix:colon
id|awacs_get_volume
c_func
(paren
id|awacs_reg
(braket
l_int|2
)braket
comma
l_int|6
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_VOLUME
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_volume
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_SPEAKER
suffix:colon
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_amp
id|MASK_CMUTE
)paren
ques
c_cond
l_int|0
suffix:colon
id|awacs_get_volume
c_func
(paren
id|awacs_reg
(braket
l_int|4
)braket
comma
l_int|6
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_SPEAKER
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|data
op_assign
id|awacs_volume_setter
c_func
(paren
id|data
comma
l_int|4
comma
id|MASK_CMUTE
comma
l_int|6
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_ALTPCM
suffix:colon
multiline_comment|/* really bell volume */
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|beep_volume
op_assign
id|data
op_amp
l_int|0xff
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_ALTPCM
suffix:colon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|beep_volume
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_LINE
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_and_assign
op_complement
id|MASK_MUX_AUDIN
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data
op_amp
l_int|0xff
)paren
op_ge
l_int|50
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_AUDIN
suffix:semicolon
id|awacs_write
c_func
(paren
id|MASK_ADDR0
op_or
id|awacs_reg
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_LINE
suffix:colon
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_AUDIN
)paren
ques
c_cond
l_int|100
suffix:colon
l_int|0
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_MIC
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|data
op_and_assign
l_int|0xff
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_and_assign
op_complement
(paren
id|MASK_MUX_MIC
op_or
id|MASK_GAINLINE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_ge
l_int|25
)paren
(brace
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_MIC
suffix:semicolon
r_if
c_cond
(paren
id|data
op_ge
l_int|75
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_GAINLINE
suffix:semicolon
)brace
id|awacs_write
c_func
(paren
id|MASK_ADDR0
op_or
id|awacs_reg
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_MIC
suffix:colon
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_MIC
)paren
ques
c_cond
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_GAINLINE
ques
c_cond
l_int|100
suffix:colon
l_int|50
)paren
suffix:colon
l_int|0
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_CD
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_and_assign
op_complement
id|MASK_MUX_CD
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data
op_amp
l_int|0xff
)paren
op_ge
l_int|50
)paren
id|awacs_reg
(braket
l_int|0
)braket
op_or_assign
id|MASK_MUX_CD
suffix:semicolon
id|awacs_write
c_func
(paren
id|MASK_ADDR0
op_or
id|awacs_reg
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|SOUND_MIXER_READ_CD
suffix:colon
id|data
op_assign
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_MUX_CD
)paren
ques
c_cond
l_int|100
suffix:colon
l_int|0
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_WRITE_RECLEV
suffix:colon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
id|data
op_assign
id|awacs_volume_setter
c_func
(paren
id|data
comma
l_int|0
comma
l_int|0
comma
l_int|4
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_READ_RECLEV
suffix:colon
id|data
op_assign
id|awacs_get_volume
c_func
(paren
id|awacs_reg
(braket
l_int|0
)braket
comma
l_int|4
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|mixer_fops
r_static
r_struct
id|file_operations
id|mixer_fops
op_assign
(brace
id|sound_lseek
comma
l_int|NULL
comma
multiline_comment|/* mixer_read */
l_int|NULL
comma
multiline_comment|/* mixer_write */
l_int|NULL
comma
multiline_comment|/* mixer_readdir */
l_int|NULL
comma
multiline_comment|/* mixer_poll */
id|mixer_ioctl
comma
l_int|NULL
comma
multiline_comment|/* mixer_mmap */
id|mixer_open
comma
id|mixer_release
comma
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|mixer_init
c_func
(paren
r_void
)paren
)paren
(brace
macro_line|#ifndef MODULE
r_int
id|mixer_unit
suffix:semicolon
macro_line|#endif
id|mixer_unit
op_assign
id|register_sound_mixer
c_func
(paren
op_amp
id|mixer_fops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mixer_unit
OL
l_int|0
)paren
r_return
suffix:semicolon
id|mixer.busy
op_assign
l_int|0
suffix:semicolon
id|sound.treble
op_assign
l_int|0
suffix:semicolon
id|sound.bass
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|sound.mach.type
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|DMASND_TT
suffix:colon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_VOLUME
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|sound.volume_left
op_assign
l_int|0
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALLEFT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|sound.volume_right
op_assign
l_int|0
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BALRIGHT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_TREBLE
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|atari_microwire_cmd
c_func
(paren
id|MW_LM1992_BASS
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMASND_FALCON
suffix:colon
id|sound.volume_left
op_assign
(paren
id|tt_dmasnd.output_atten
op_amp
l_int|0xf00
)paren
op_rshift
l_int|8
suffix:semicolon
id|sound.volume_right
op_assign
(paren
id|tt_dmasnd.output_atten
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|DMASND_AMIGA
suffix:colon
id|sound.volume_left
op_assign
l_int|64
suffix:semicolon
id|sound.volume_right
op_assign
l_int|64
suffix:semicolon
id|custom.aud
(braket
l_int|0
)braket
dot
id|audvol
op_assign
id|sound.volume_left
suffix:semicolon
id|custom.aud
(braket
l_int|3
)braket
dot
id|audvol
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* For pseudo 14bit */
id|custom.aud
(braket
l_int|1
)braket
dot
id|audvol
op_assign
id|sound.volume_right
suffix:semicolon
id|custom.aud
(braket
l_int|2
)braket
dot
id|audvol
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* For pseudo 14bit */
id|sound.treble
op_assign
l_int|50
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
)brace
multiline_comment|/*&n; * Sound queue stuff, the heart of the driver&n; */
DECL|function|sq_setup
r_static
r_void
id|sq_setup
c_func
(paren
r_int
id|numBufs
comma
r_int
id|bufSize
comma
r_char
op_star
op_star
id|buffers
)paren
(brace
macro_line|#ifdef CONFIG_PMAC
r_int
id|i
suffix:semicolon
r_volatile
r_struct
id|dbdma_cmd
op_star
id|cp
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC */
id|sq.max_count
op_assign
id|numBufs
suffix:semicolon
id|sq.max_active
op_assign
id|numBufs
suffix:semicolon
id|sq.block_size
op_assign
id|bufSize
suffix:semicolon
id|sq.buffers
op_assign
id|buffers
suffix:semicolon
id|sq.front
op_assign
id|sq.count
op_assign
l_int|0
suffix:semicolon
id|sq.rear
op_assign
op_minus
l_int|1
suffix:semicolon
id|sq.write_queue
op_assign
id|sq.open_queue
op_assign
id|sq.sync_queue
op_assign
l_int|0
suffix:semicolon
id|sq.busy
op_assign
l_int|0
suffix:semicolon
id|sq.syncing
op_assign
l_int|0
suffix:semicolon
id|sq.playing
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
id|sq.ignore_int
op_assign
l_int|0
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
id|sq.block_size_half
op_assign
id|sq.block_size
op_rshift
l_int|1
suffix:semicolon
id|sq.block_size_quarter
op_assign
id|sq.block_size_half
op_rshift
l_int|1
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
id|cp
op_assign
id|awacs_tx_cmds
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|cp
comma
l_int|0
comma
(paren
id|numBufs
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|dbdma_cmd
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numBufs
suffix:semicolon
op_increment
id|i
comma
op_increment
id|cp
)paren
(brace
id|st_le32
c_func
(paren
op_amp
id|cp-&gt;phy_addr
comma
id|virt_to_bus
c_func
(paren
id|buffers
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
id|st_le16
c_func
(paren
op_amp
id|cp-&gt;command
comma
id|DBDMA_NOP
op_plus
id|BR_ALWAYS
)paren
suffix:semicolon
id|st_le32
c_func
(paren
op_amp
id|cp-&gt;cmd_dep
comma
id|virt_to_bus
c_func
(paren
id|awacs_tx_cmds
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;control
comma
(paren
id|RUN
op_or
id|PAUSE
op_or
id|FLUSH
op_or
id|WAKE
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs_txdma-&gt;cmdptr
comma
id|virt_to_bus
c_func
(paren
id|awacs_tx_cmds
)paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC */
)brace
DECL|function|sq_play
r_static
r_void
id|sq_play
c_func
(paren
r_void
)paren
(brace
(paren
op_star
id|sound.mach.play
)paren
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ++TeSche: radically changed this one too */
DECL|function|sq_write
r_static
id|ssize_t
id|sq_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|src
comma
r_int
id|uLeft
comma
id|loff_t
op_star
id|ppos
)paren
(brace
id|ssize_t
id|uWritten
op_assign
l_int|0
suffix:semicolon
id|u_char
op_star
id|dest
suffix:semicolon
id|ssize_t
id|uUsed
comma
id|bUsed
comma
id|bLeft
suffix:semicolon
multiline_comment|/* ++TeSche: Is something like this necessary?&n;&t; * Hey, that&squot;s an honest question! Or does any other part of the&n;&t; * filesystem already checks this situation? I really don&squot;t know.&n;&t; */
r_if
c_cond
(paren
id|uLeft
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* The interrupt doesn&squot;t start to play the last, incomplete frame.&n;&t; * Thus we can append to it without disabling the interrupts! (Note&n;&t; * also that sq.rear isn&squot;t affected by the interrupt.)&n;&t; */
r_if
c_cond
(paren
id|sq.count
OG
l_int|0
op_logical_and
(paren
id|bLeft
op_assign
id|sq.block_size
op_minus
id|sq.rear_size
)paren
OG
l_int|0
)paren
(brace
id|dest
op_assign
id|sq_block_address
c_func
(paren
id|sq.rear
)paren
suffix:semicolon
id|bUsed
op_assign
id|sq.rear_size
suffix:semicolon
id|uUsed
op_assign
id|sound_copy_translate
c_func
(paren
id|src
comma
id|uLeft
comma
id|dest
comma
op_amp
id|bUsed
comma
id|bLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uUsed
op_le
l_int|0
)paren
r_return
id|uUsed
suffix:semicolon
id|src
op_add_assign
id|uUsed
suffix:semicolon
id|uWritten
op_add_assign
id|uUsed
suffix:semicolon
id|uLeft
op_sub_assign
id|uUsed
suffix:semicolon
id|sq.rear_size
op_assign
id|bUsed
suffix:semicolon
)brace
r_do
(brace
r_while
c_loop
(paren
id|sq.count
op_eq
id|sq.max_active
)paren
(brace
id|sq_play
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NON_BLOCKING
c_func
(paren
id|sq.open_mode
)paren
)paren
r_return
id|uWritten
OG
l_int|0
ques
c_cond
id|uWritten
suffix:colon
op_minus
id|EAGAIN
suffix:semicolon
id|SLEEP
c_func
(paren
id|sq.write_queue
comma
id|ONE_SECOND
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SIGNAL_RECEIVED
)paren
r_return
id|uWritten
OG
l_int|0
ques
c_cond
id|uWritten
suffix:colon
op_minus
id|EINTR
suffix:semicolon
)brace
multiline_comment|/* Here, we can avoid disabling the interrupt by first&n;&t;&t; * copying and translating the data, and then updating&n;&t;&t; * the sq variables. Until this is done, the interrupt&n;&t;&t; * won&squot;t see the new frame and we can work on it&n;&t;&t; * undisturbed.&n;&t;&t; */
id|dest
op_assign
id|sq_block_address
c_func
(paren
(paren
id|sq.rear
op_plus
l_int|1
)paren
op_mod
id|sq.max_count
)paren
suffix:semicolon
id|bUsed
op_assign
l_int|0
suffix:semicolon
id|bLeft
op_assign
id|sq.block_size
suffix:semicolon
id|uUsed
op_assign
id|sound_copy_translate
c_func
(paren
id|src
comma
id|uLeft
comma
id|dest
comma
op_amp
id|bUsed
comma
id|bLeft
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uUsed
op_le
l_int|0
)paren
r_break
suffix:semicolon
id|src
op_add_assign
id|uUsed
suffix:semicolon
id|uWritten
op_add_assign
id|uUsed
suffix:semicolon
id|uLeft
op_sub_assign
id|uUsed
suffix:semicolon
r_if
c_cond
(paren
id|bUsed
)paren
(brace
id|sq.rear
op_assign
(paren
id|sq.rear
op_plus
l_int|1
)paren
op_mod
id|sq.max_count
suffix:semicolon
id|sq.rear_size
op_assign
id|bUsed
suffix:semicolon
id|sq.count
op_increment
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|bUsed
)paren
suffix:semicolon
multiline_comment|/* uUsed may have been 0 */
id|sq_play
c_func
(paren
)paren
suffix:semicolon
r_return
id|uUsed
OL
l_int|0
ques
c_cond
id|uUsed
suffix:colon
id|uWritten
suffix:semicolon
)brace
DECL|function|sq_open
r_static
r_int
id|sq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
id|sq.busy
)paren
(brace
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|NON_BLOCKING
c_func
(paren
id|file-&gt;f_flags
)paren
)paren
r_goto
id|err_out
suffix:semicolon
id|rc
op_assign
op_minus
id|EINTR
suffix:semicolon
r_while
c_loop
(paren
id|sq.busy
)paren
(brace
id|SLEEP
c_func
(paren
id|sq.open_queue
comma
id|ONE_SECOND
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SIGNAL_RECEIVED
)paren
r_goto
id|err_out
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
id|sq_setup
c_func
(paren
id|numBufs
comma
id|bufSize
op_lshift
l_int|10
comma
id|sound_buffers
)paren
suffix:semicolon
id|sq.open_mode
op_assign
id|file-&gt;f_flags
suffix:semicolon
id|sq.busy
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_ATARI
id|sq.ignore_int
op_assign
l_int|1
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
id|sound.minDev
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|sound.soft
op_assign
id|sound.dsp
suffix:semicolon
id|sound.hard
op_assign
id|sound.dsp
suffix:semicolon
id|sound_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_amp
l_int|0x0f
)paren
op_eq
id|SND_DEV_AUDIO
)paren
(brace
id|sound_set_speed
c_func
(paren
l_int|8000
)paren
suffix:semicolon
id|sound_set_stereo
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|sound_set_format
c_func
(paren
id|AFMT_MU_LAW
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|err_out
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|sq_reset
r_static
r_void
id|sq_reset
c_func
(paren
r_void
)paren
(brace
id|sound_silence
c_func
(paren
)paren
suffix:semicolon
id|sq.playing
op_assign
l_int|0
suffix:semicolon
id|sq.count
op_assign
l_int|0
suffix:semicolon
id|sq.front
op_assign
(paren
id|sq.rear
op_plus
l_int|1
)paren
op_mod
id|sq.max_count
suffix:semicolon
)brace
DECL|function|sq_fsync
r_static
r_int
id|sq_fsync
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|sq.syncing
op_assign
l_int|1
suffix:semicolon
id|sq_play
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* there may be an incomplete frame waiting */
r_while
c_loop
(paren
id|sq.playing
)paren
(brace
id|SLEEP
c_func
(paren
id|sq.sync_queue
comma
id|ONE_SECOND
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SIGNAL_RECEIVED
)paren
(brace
multiline_comment|/* While waiting for audio output to drain, an&n;&t;&t;&t; * interrupt occurred.  Stop audio output immediately&n;&t;&t;&t; * and clear the queue. */
id|sq_reset
c_func
(paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINTR
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|sq.syncing
op_assign
l_int|0
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|sq_release
r_static
r_int
id|sq_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sq.busy
)paren
(brace
id|rc
op_assign
id|sq_fsync
c_func
(paren
id|file
comma
id|file-&gt;f_dentry
)paren
suffix:semicolon
id|sq.busy
op_assign
l_int|0
suffix:semicolon
id|WAKE_UP
c_func
(paren
id|sq.open_queue
)paren
suffix:semicolon
multiline_comment|/* Wake up a process waiting for the queue being released.&n;&t;&t; * Note: There may be several processes waiting for a call&n;&t;&t; * to open() returning. */
)brace
id|sound.soft
op_assign
id|sound.dsp
suffix:semicolon
id|sound.hard
op_assign
id|sound.dsp
suffix:semicolon
id|sound_silence
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|sq_ioctl
r_static
r_int
id|sq_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
id|u_long
id|fmt
suffix:semicolon
r_int
id|data
suffix:semicolon
r_int
id|size
comma
id|nbufs
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDCTL_DSP_RESET
suffix:colon
id|sq_reset
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_POST
suffix:colon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
r_return
id|sq_fsync
c_func
(paren
id|file
comma
id|file-&gt;f_dentry
)paren
suffix:semicolon
multiline_comment|/* ++TeSche: before changing any of these it&squot;s&n;&t;&t; * probably wise to wait until sound playing has&n;&t;&t; * settled down. */
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
id|sq_fsync
c_func
(paren
id|file
comma
id|file-&gt;f_dentry
)paren
suffix:semicolon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_speed
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
id|sq_fsync
c_func
(paren
id|file
comma
id|file-&gt;f_dentry
)paren
suffix:semicolon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_stereo
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SOUND_PCM_WRITE_CHANNELS
suffix:colon
id|sq_fsync
c_func
(paren
id|file
comma
id|file-&gt;f_dentry
)paren
suffix:semicolon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_stereo
c_func
(paren
id|data
op_minus
l_int|1
)paren
op_plus
l_int|1
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFMT
suffix:colon
id|sq_fsync
c_func
(paren
id|file
comma
id|file-&gt;f_dentry
)paren
suffix:semicolon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|data
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|sound_set_format
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETFMTS
suffix:colon
id|fmt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans
)paren
(brace
r_if
c_cond
(paren
id|sound.trans-&gt;ct_ulaw
)paren
id|fmt
op_or_assign
id|AFMT_MU_LAW
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_alaw
)paren
id|fmt
op_or_assign
id|AFMT_A_LAW
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_s8
)paren
id|fmt
op_or_assign
id|AFMT_S8
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_u8
)paren
id|fmt
op_or_assign
id|AFMT_U8
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_s16be
)paren
id|fmt
op_or_assign
id|AFMT_S16_BE
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_u16be
)paren
id|fmt
op_or_assign
id|AFMT_U16_BE
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_s16le
)paren
id|fmt
op_or_assign
id|AFMT_S16_LE
suffix:semicolon
r_if
c_cond
(paren
id|sound.trans-&gt;ct_u16le
)paren
id|fmt
op_or_assign
id|AFMT_U16_LE
suffix:semicolon
)brace
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|fmt
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
id|size
op_assign
id|sq.block_size
op_star
id|sound.soft.size
op_star
(paren
id|sound.soft.stereo
op_plus
l_int|1
)paren
op_div
(paren
id|sound.hard.size
op_star
(paren
id|sound.hard.stereo
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_return
id|IOCTL_OUT
c_func
(paren
id|arg
comma
id|size
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
r_if
c_cond
(paren
id|sq.count
op_logical_or
id|sq.playing
op_logical_or
id|sq.syncing
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|IOCTL_IN
c_func
(paren
id|arg
comma
id|size
)paren
suffix:semicolon
id|nbufs
op_assign
id|size
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|nbufs
template_param
id|numBufs
)paren
id|nbufs
op_assign
id|numBufs
suffix:semicolon
id|size
op_and_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ge
l_int|8
op_logical_and
id|size
op_le
l_int|30
)paren
(brace
id|size
op_assign
l_int|1
op_lshift
id|size
suffix:semicolon
id|size
op_mul_assign
id|sound.hard.size
op_star
(paren
id|sound.hard.stereo
op_plus
l_int|1
)paren
suffix:semicolon
id|size
op_div_assign
id|sound.soft.size
op_star
(paren
id|sound.soft.stereo
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
(paren
id|bufSize
op_lshift
l_int|10
)paren
)paren
id|size
op_assign
id|bufSize
op_lshift
l_int|10
suffix:semicolon
)brace
r_else
id|size
op_assign
id|bufSize
op_lshift
l_int|10
suffix:semicolon
id|sq_setup
c_func
(paren
id|numBufs
comma
id|size
comma
id|sound_buffers
)paren
suffix:semicolon
id|sq.max_active
op_assign
id|nbufs
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
id|mixer_ioctl
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|sq_fops
r_static
r_struct
id|file_operations
id|sq_fops
op_assign
(brace
id|sound_lseek
comma
l_int|NULL
comma
multiline_comment|/* sq_read */
id|sq_write
comma
l_int|NULL
comma
multiline_comment|/* sq_readdir */
l_int|NULL
comma
multiline_comment|/* sq_poll */
id|sq_ioctl
comma
l_int|NULL
comma
multiline_comment|/* sq_mmap */
id|sq_open
comma
id|sq_release
comma
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|sq_init
c_func
(paren
r_void
)paren
)paren
(brace
macro_line|#ifndef MODULE
r_int
id|sq_unit
suffix:semicolon
macro_line|#endif
id|sq_unit
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|sq_fops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sq_unit
OL
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* whatever you like as startup mode for /dev/dsp,&n;&t; * (/dev/audio hasn&squot;t got a startup mode). note that&n;&t; * once changed a new open() will *not* restore these!&n;&t; */
id|sound.dsp.format
op_assign
id|AFMT_U8
suffix:semicolon
id|sound.dsp.stereo
op_assign
l_int|0
suffix:semicolon
id|sound.dsp.size
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* set minimum rate possible without expanding */
r_switch
c_cond
(paren
id|sound.mach.type
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|DMASND_TT
suffix:colon
id|sound.dsp.speed
op_assign
l_int|6258
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMASND_FALCON
suffix:colon
id|sound.dsp.speed
op_assign
l_int|8195
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|DMASND_AMIGA
suffix:colon
id|sound.dsp.speed
op_assign
l_int|8000
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
r_case
id|DMASND_AWACS
suffix:colon
id|sound.dsp.speed
op_assign
l_int|8000
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC */
)brace
multiline_comment|/* before the first open to /dev/dsp this wouldn&squot;t be set */
id|sound.soft
op_assign
id|sound.dsp
suffix:semicolon
id|sound.hard
op_assign
id|sound.dsp
suffix:semicolon
id|sound_silence
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * /dev/sndstat&n; */
multiline_comment|/* state.buf should not overflow! */
DECL|function|state_open
r_static
r_int
id|state_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_char
op_star
id|buffer
op_assign
id|state.buf
comma
op_star
id|mach
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|state.busy
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|state.ptr
op_assign
l_int|0
suffix:semicolon
id|state.busy
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|sound.mach.type
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|DMASND_TT
suffix:colon
r_case
id|DMASND_FALCON
suffix:colon
id|mach
op_assign
l_string|&quot;Atari &quot;
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|DMASND_AMIGA
suffix:colon
id|mach
op_assign
l_string|&quot;Amiga &quot;
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_PMAC
r_case
id|DMASND_AWACS
suffix:colon
id|mach
op_assign
l_string|&quot;PowerMac &quot;
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC */
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%sDMA sound driver:&bslash;n&quot;
comma
id|mach
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.format = 0x%x&quot;
comma
id|sound.soft.format
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sound.soft.format
)paren
(brace
r_case
id|AFMT_MU_LAW
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (mu-law)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_A_LAW
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (A-law)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U8
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (unsigned 8 bit)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S8
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (signed 8 bit)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_BE
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (signed 16 bit big)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U16_BE
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (unsigned 16 bit big)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_S16_LE
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (signed 16 bit little)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AFMT_U16_LE
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; (unsigned 16 bit little)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.speed = %dHz (phys. %dHz)&bslash;n&quot;
comma
id|sound.soft.speed
comma
id|sound.hard.speed
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.stereo = 0x%x (%s)&bslash;n&quot;
comma
id|sound.soft.stereo
comma
id|sound.soft.stereo
ques
c_cond
l_string|&quot;stereo&quot;
suffix:colon
l_string|&quot;mono&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sound.mach.type
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|DMASND_TT
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_left = %ddB [-40...0]&bslash;n&quot;
comma
id|sound.volume_left
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_right = %ddB [-40...0]&bslash;n&quot;
comma
id|sound.volume_right
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.bass = %ddB [-12...+12]&bslash;n&quot;
comma
id|sound.bass
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.treble = %ddB [-12...+12]&bslash;n&quot;
comma
id|sound.treble
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMASND_FALCON
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_left = %ddB [-22.5...0]&bslash;n&quot;
comma
id|sound.volume_left
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_right = %ddB [-22.5...0]&bslash;n&quot;
comma
id|sound.volume_right
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|DMASND_AMIGA
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_left = %d [0...64]&bslash;n&quot;
comma
id|sound.volume_left
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsound.volume_right = %d [0...64]&bslash;n&quot;
comma
id|sound.volume_right
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsq.block_size = %d sq.max_count = %d&quot;
l_string|&quot; sq.max_active = %d&bslash;n&quot;
comma
id|sq.block_size
comma
id|sq.max_count
comma
id|sq.max_active
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsq.count = %d sq.rear_size = %d&bslash;n&quot;
comma
id|sq.count
comma
id|sq.rear_size
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tsq.playing = %d sq.syncing = %d&bslash;n&quot;
comma
id|sq.playing
comma
id|sq.syncing
)paren
suffix:semicolon
id|state.len
op_assign
id|len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|state_release
r_static
r_int
id|state_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|state.busy
op_assign
l_int|0
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|state_read
r_static
id|ssize_t
id|state_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_int
id|n
op_assign
id|state.len
op_minus
id|state.ptr
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
id|count
)paren
id|n
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|n
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
op_amp
id|state.buf
(braket
id|state.ptr
)braket
comma
id|n
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|state.ptr
op_add_assign
id|n
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
DECL|variable|state_fops
r_static
r_struct
id|file_operations
id|state_fops
op_assign
(brace
id|sound_lseek
comma
id|state_read
comma
l_int|NULL
comma
multiline_comment|/* state_write */
l_int|NULL
comma
multiline_comment|/* state_readdir */
l_int|NULL
comma
multiline_comment|/* state_poll */
l_int|NULL
comma
multiline_comment|/* state_ioctl */
l_int|NULL
comma
multiline_comment|/* state_mmap */
id|state_open
comma
id|state_release
comma
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|state_init
c_func
(paren
r_void
)paren
)paren
(brace
macro_line|#ifndef MODULE
r_int
id|state_unit
suffix:semicolon
macro_line|#endif
id|state_unit
op_assign
id|register_sound_special
c_func
(paren
op_amp
id|state_fops
comma
id|SND_DEV_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state_unit
OL
l_int|0
)paren
r_return
suffix:semicolon
id|state.busy
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*** Common stuff ********************************************************/
DECL|function|sound_lseek
r_static
r_int
r_int
id|sound_lseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|offset
comma
r_int
id|orig
)paren
(brace
r_return
op_minus
id|ESPIPE
suffix:semicolon
)brace
multiline_comment|/*** Config &amp; Setup **********************************************************/
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|dmasound_init
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|has_sound
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC
r_struct
id|device_node
op_star
id|np
suffix:semicolon
macro_line|#endif
macro_line|#ifdef __mc68000__
r_switch
c_cond
(paren
id|m68k_machtype
)paren
(brace
macro_line|#ifdef CONFIG_ATARI
r_case
id|MACH_ATARI
suffix:colon
r_if
c_cond
(paren
id|ATARIHW_PRESENT
c_func
(paren
id|PCM_8BIT
)paren
)paren
(brace
r_if
c_cond
(paren
id|ATARIHW_PRESENT
c_func
(paren
id|CODEC
)paren
)paren
id|sound.mach
op_assign
id|machFalcon
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ATARIHW_PRESENT
c_func
(paren
id|MICROWIRE
)paren
)paren
id|sound.mach
op_assign
id|machTT
suffix:semicolon
r_else
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mfp.int_en_a
op_amp
id|mfp.int_mk_a
op_amp
l_int|0x20
)paren
op_eq
l_int|0
)paren
id|has_sound
op_assign
l_int|1
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;DMA sound driver: Timer A interrupt already in use&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_ATARI */
macro_line|#ifdef CONFIG_AMIGA
r_case
id|MACH_AMIGA
suffix:colon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|AMI_AUDIO
)paren
)paren
(brace
id|sound.mach
op_assign
id|machAmiga
suffix:semicolon
id|has_sound
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_AMIGA */
)brace
macro_line|#endif /* __mc68000__ */
macro_line|#ifdef CONFIG_PMAC
id|awacs_subframe
op_assign
l_int|0
suffix:semicolon
id|np
op_assign
id|find_devices
c_func
(paren
l_string|&quot;awacs&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * powermac G3 models have a node called &quot;davbus&quot;&n;&t;&t; * with a child called &quot;sound&quot;.&n;&t;&t; */
r_struct
id|device_node
op_star
id|sound
suffix:semicolon
id|np
op_assign
id|find_devices
c_func
(paren
l_string|&quot;davbus&quot;
)paren
suffix:semicolon
id|sound
op_assign
id|find_devices
c_func
(paren
l_string|&quot;sound&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sound
op_ne
l_int|0
op_logical_and
id|sound-&gt;parent
op_eq
id|np
)paren
(brace
r_int
op_star
id|sfprop
suffix:semicolon
id|sfprop
op_assign
(paren
r_int
op_star
)paren
id|get_property
c_func
(paren
id|sound
comma
l_string|&quot;sub-frame&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sfprop
op_ne
l_int|0
op_logical_and
op_star
id|sfprop
op_ge
l_int|0
op_logical_and
op_star
id|sfprop
OL
l_int|16
)paren
id|awacs_subframe
op_assign
op_star
id|sfprop
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|np
op_ne
l_int|NULL
op_logical_and
id|np-&gt;n_addrs
op_ge
l_int|3
op_logical_and
id|np-&gt;n_intrs
op_ge
l_int|3
)paren
(brace
r_int
id|vol
suffix:semicolon
id|sound.mach
op_assign
id|machPMac
suffix:semicolon
id|has_sound
op_assign
l_int|1
suffix:semicolon
id|awacs
op_assign
(paren
r_volatile
r_struct
id|awacs_regs
op_star
)paren
id|ioremap
c_func
(paren
id|np-&gt;addrs
(braket
l_int|0
)braket
dot
id|address
comma
l_int|0x80
)paren
suffix:semicolon
id|awacs_txdma
op_assign
(paren
r_volatile
r_struct
id|dbdma_regs
op_star
)paren
id|ioremap
c_func
(paren
id|np-&gt;addrs
(braket
l_int|1
)braket
dot
id|address
comma
l_int|0x100
)paren
suffix:semicolon
id|awacs_rxdma
op_assign
(paren
r_volatile
r_struct
id|dbdma_regs
op_star
)paren
id|ioremap
c_func
(paren
id|np-&gt;addrs
(braket
l_int|2
)braket
dot
id|address
comma
l_int|0x100
)paren
suffix:semicolon
id|awacs_irq
op_assign
id|np-&gt;intrs
(braket
l_int|0
)braket
dot
id|line
suffix:semicolon
id|awacs_tx_irq
op_assign
id|np-&gt;intrs
(braket
l_int|1
)braket
dot
id|line
suffix:semicolon
id|awacs_rx_irq
op_assign
id|np-&gt;intrs
(braket
l_int|2
)braket
dot
id|line
suffix:semicolon
id|awacs_tx_cmd_space
op_assign
id|kmalloc
c_func
(paren
(paren
id|numBufs
op_plus
l_int|4
)paren
op_star
r_sizeof
(paren
r_struct
id|dbdma_cmd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awacs_tx_cmd_space
op_eq
l_int|NULL
)paren
r_goto
id|out_of_memory
suffix:semicolon
id|awacs_tx_cmds
op_assign
(paren
r_volatile
r_struct
id|dbdma_cmd
op_star
)paren
id|DBDMA_ALIGN
c_func
(paren
id|awacs_tx_cmd_space
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|0
)braket
op_assign
id|MASK_MUX_CD
suffix:semicolon
id|awacs_reg
(braket
l_int|1
)braket
op_assign
id|MASK_LOOPTHRU
op_or
id|MASK_PAROUT
suffix:semicolon
multiline_comment|/* get default volume from nvram */
id|vol
op_assign
(paren
op_complement
id|nvram_read_byte
c_func
(paren
l_int|0x1308
)paren
op_amp
l_int|7
)paren
op_lshift
l_int|1
suffix:semicolon
id|awacs_reg
(braket
l_int|2
)braket
op_assign
id|vol
op_plus
(paren
id|vol
op_lshift
l_int|6
)paren
suffix:semicolon
id|awacs_reg
(braket
l_int|4
)braket
op_assign
id|vol
op_plus
(paren
id|vol
op_lshift
l_int|6
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|awacs-&gt;control
comma
l_int|0x11
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|0
)braket
op_plus
id|MASK_ADDR0
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|1
)braket
op_plus
id|MASK_ADDR1
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|2
)braket
op_plus
id|MASK_ADDR2
)paren
suffix:semicolon
id|awacs_write
c_func
(paren
id|awacs_reg
(braket
l_int|4
)braket
op_plus
id|MASK_ADDR4
)paren
suffix:semicolon
multiline_comment|/* Initialize beep stuff */
id|beep_dbdma_cmd
op_assign
id|awacs_tx_cmds
op_plus
(paren
id|numBufs
op_plus
l_int|1
)paren
suffix:semicolon
id|orig_mksound
op_assign
id|kd_mksound
suffix:semicolon
id|kd_mksound
op_assign
id|awacs_mksound
suffix:semicolon
id|beep_buf
op_assign
(paren
r_int
op_star
)paren
id|kmalloc
c_func
(paren
id|BEEP_BUFLEN
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|beep_buf
op_eq
l_int|NULL
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;dmasound: no memory for &quot;
l_string|&quot;beep buffer&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
id|notifier_chain_register
c_func
(paren
op_amp
id|sleep_notifier_list
comma
op_amp
id|awacs_sleep_notifier
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PMAC_PBOOK */
)brace
macro_line|#endif /* CONFIG_PMAC */
r_if
c_cond
(paren
op_logical_neg
id|has_sound
)paren
r_return
suffix:semicolon
multiline_comment|/* Set up sound queue, /dev/audio and /dev/dsp. */
id|sound_buffers
op_assign
id|kmalloc
(paren
id|numBufs
op_star
r_sizeof
(paren
r_char
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound_buffers
)paren
(brace
id|out_of_memory
suffix:colon
id|printk
c_func
(paren
l_string|&quot;DMA sound driver: Not enough buffer memory, driver disabled!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numBufs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sound_buffers
(braket
id|i
)braket
op_assign
id|sound.mach.dma_alloc
(paren
id|bufSize
op_lshift
l_int|10
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound_buffers
(braket
id|i
)braket
)paren
(brace
r_while
c_loop
(paren
id|i
op_decrement
)paren
id|sound.mach.dma_free
(paren
id|sound_buffers
(braket
id|i
)braket
comma
id|bufSize
op_lshift
l_int|10
)paren
suffix:semicolon
id|kfree
(paren
id|sound_buffers
)paren
suffix:semicolon
id|sound_buffers
op_assign
l_int|0
suffix:semicolon
r_goto
id|out_of_memory
suffix:semicolon
)brace
)brace
id|sq_setup
c_func
(paren
id|numBufs
comma
id|bufSize
op_lshift
l_int|10
comma
id|sound_buffers
)paren
suffix:semicolon
multiline_comment|/* Set default settings. */
id|sq_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Set up /dev/sndstat. */
id|state_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Set up /dev/mixer. */
id|mixer_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sound.mach
dot
id|irqinit
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DMA sound driver: Interrupt initialization failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|irq_installed
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;DMA sound driver installed, using %d buffers of %dk.&bslash;n&quot;
comma
id|numBufs
comma
id|bufSize
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|macro|MAXARGS
mdefine_line|#define MAXARGS&t;&t;8&t;/* Should be sufficient for now */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|dmasound_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
)paren
(brace
multiline_comment|/* check the bootstrap parameter for &quot;dmasound=&quot; */
r_switch
c_cond
(paren
id|ints
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|3
suffix:colon
r_if
c_cond
(paren
(paren
id|ints
(braket
l_int|3
)braket
OL
l_int|0
)paren
op_logical_or
(paren
id|ints
(braket
l_int|3
)braket
OG
id|MAX_CATCH_RADIUS
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;dmasound_setup: illegal catch radius, using default = %d&bslash;n&quot;
comma
id|catchRadius
)paren
suffix:semicolon
r_else
id|catchRadius
op_assign
id|ints
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* fall through */
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|1
)braket
OL
id|MIN_BUFFERS
)paren
id|printk
c_func
(paren
l_string|&quot;dmasound_setup: illegal number of buffers, using default = %d&bslash;n&quot;
comma
id|numBufs
)paren
suffix:semicolon
r_else
id|numBufs
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ints
(braket
l_int|2
)braket
template_param
id|MAX_BUFSIZE
)paren
id|printk
c_func
(paren
l_string|&quot;dmasound_setup: illegal buffer size, using default = %d&bslash;n&quot;
comma
id|bufSize
)paren
suffix:semicolon
r_else
id|bufSize
op_assign
id|ints
(braket
l_int|2
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;dmasound_setup: illegal number of arguments&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
id|dmasound_init
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|irq_installed
)paren
(brace
id|sound_silence
c_func
(paren
)paren
suffix:semicolon
id|sound.mach
dot
id|irqcleanup
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sound_buffers
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numBufs
suffix:semicolon
id|i
op_increment
)paren
id|sound.mach
dot
id|dma_free
c_func
(paren
id|sound_buffers
(braket
id|i
)braket
comma
id|bufSize
op_lshift
l_int|10
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sound_buffers
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mixer_unit
op_ge
l_int|0
)paren
id|unregister_sound_mixer
c_func
(paren
id|mixer_unit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state_unit
op_ge
l_int|0
)paren
id|unregister_sound_special
c_func
(paren
id|state_unit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sq_unit
op_ge
l_int|0
)paren
id|unregister_sound_dsp
c_func
(paren
id|sq_unit
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
eof
