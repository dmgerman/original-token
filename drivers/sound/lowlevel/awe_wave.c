multiline_comment|/*================================================================&n; * awe_wave.c -- driver for AWE32 wave table synth&n; *&t;version 0.2.0; Oct. 16, 1996&n; *&t;copyright (c) 1996  by Takashi Iwai&n; *================================================================*/
multiline_comment|/* if you&squot;re using obsolete VoxWare 3.0.x on Linux 1.2.x (or FreeBSD),&n; * uncomment the following line&n; */
multiline_comment|/* #define AWE_OBSOLETE_VOXWARE */
macro_line|#include &quot;lowlevel.h&quot;
macro_line|#ifdef AWE_OBSOLETE_VOXWARE
macro_line|#include &quot;sound_config.h&quot;
macro_line|#if !defined(EXCLUDE_AWE32)
DECL|macro|CONFIG_AWE32_SYNTH
mdefine_line|#define CONFIG_AWE32_SYNTH
macro_line|#endif
macro_line|#else /* AWE_OBSOLETE_VOXWARE */
macro_line|#include &quot;../sound_config.h&quot;
macro_line|#endif /* AWE_OBSOLETE_VOXWARE */
multiline_comment|/*----------------------------------------------------------------*&n; * compile condition&n; *----------------------------------------------------------------*/
multiline_comment|/* initialize FM passthrough even without extended RAM */
multiline_comment|/*#define AWE_ALWAYS_INIT_FM*/
multiline_comment|/* debug on */
DECL|macro|AWE_DEBUG_ON
mdefine_line|#define AWE_DEBUG_ON
multiline_comment|/* verify checksum for uploading samples */
DECL|macro|AWE_CHECKSUM_DATA
mdefine_line|#define AWE_CHECKSUM_DATA
DECL|macro|AWE_CHECKSUM_MEMORY
mdefine_line|#define AWE_CHECKSUM_MEMORY
multiline_comment|/* disable interruption during sequencer operation */
multiline_comment|/*#define AWE_NEED_DISABLE_INTR*/
multiline_comment|/*----------------------------------------------------------------*/
macro_line|#ifdef CONFIG_AWE32_SYNTH
macro_line|#include &quot;awe_hw.h&quot;
macro_line|#include &quot;awe_voice.h&quot;
macro_line|#ifdef AWE_OBSOLETE_VOXWARE
macro_line|#include &quot;tuning.h&quot;
macro_line|#else
macro_line|#include &quot;../tuning.h&quot;
macro_line|#endif
macro_line|#ifdef linux
macro_line|#  include &lt;linux/ultrasound.h&gt;
macro_line|#elif defined(__FreeBSD__)
macro_line|#  include &lt;machine/ultrasound.h&gt;
macro_line|#endif
multiline_comment|/*----------------------------------------------------------------&n; * debug message&n; *----------------------------------------------------------------*/
macro_line|#ifdef AWE_DEBUG_ON
DECL|variable|debug_mode
r_static
r_int
id|debug_mode
op_assign
l_int|0
suffix:semicolon
DECL|macro|DEBUG
mdefine_line|#define DEBUG(LVL,XXX)&t;{if (debug_mode &gt; LVL) { XXX; }}
DECL|macro|ERRMSG
mdefine_line|#define ERRMSG(XXX)&t;{if (debug_mode) { XXX; }}
DECL|macro|FATALERR
mdefine_line|#define FATALERR(XXX)&t;XXX
macro_line|#else
DECL|macro|DEBUG
mdefine_line|#define DEBUG(LVL,XXX) /**/
DECL|macro|ERRMSG
mdefine_line|#define ERRMSG(XXX)&t;XXX
DECL|macro|FATALERR
mdefine_line|#define FATALERR(XXX)&t;XXX
macro_line|#endif
multiline_comment|/*----------------------------------------------------------------&n; * bank and voice record&n; *----------------------------------------------------------------*/
multiline_comment|/* bank record */
DECL|struct|_awe_voice_list
r_typedef
r_struct
id|_awe_voice_list
(brace
DECL|member|bank
DECL|member|instr
r_int
r_char
id|bank
comma
id|instr
suffix:semicolon
DECL|member|v
id|awe_voice_info
id|v
suffix:semicolon
DECL|member|next_instr
r_struct
id|_awe_voice_list
op_star
id|next_instr
suffix:semicolon
DECL|member|next_bank
r_struct
id|_awe_voice_list
op_star
id|next_bank
suffix:semicolon
DECL|typedef|awe_voice_list
)brace
id|awe_voice_list
suffix:semicolon
multiline_comment|/* sample and information table */
DECL|variable|samples
r_static
id|awe_sample_info
op_star
id|samples
suffix:semicolon
DECL|variable|infos
r_static
id|awe_voice_list
op_star
id|infos
suffix:semicolon
DECL|macro|AWE_MAX_PRESETS
mdefine_line|#define AWE_MAX_PRESETS&t;&t;256
DECL|macro|AWE_DEFAULT_BANK
mdefine_line|#define AWE_DEFAULT_BANK&t;0
multiline_comment|/* preset table index */
DECL|variable|preset_table
r_static
id|awe_voice_list
op_star
id|preset_table
(braket
id|AWE_MAX_PRESETS
)braket
suffix:semicolon
multiline_comment|/*----------------------------------------------------------------&n; * voice table&n; *----------------------------------------------------------------*/
DECL|macro|AWE_FX_BYTES
mdefine_line|#define AWE_FX_BYTES&t;((AWE_FX_END+7)/8)
DECL|struct|_voice_info
r_typedef
r_struct
id|_voice_info
(brace
DECL|member|state
r_int
id|state
suffix:semicolon
multiline_comment|/* status (on = 1, off = 0) */
DECL|member|note
r_int
id|note
suffix:semicolon
multiline_comment|/* midi key (0-127) */
DECL|member|velocity
r_int
id|velocity
suffix:semicolon
multiline_comment|/* midi velocity (0-127) */
DECL|member|bender
r_int
id|bender
suffix:semicolon
multiline_comment|/* midi pitchbend (-8192 - 8192) */
DECL|member|bender_range
r_int
id|bender_range
suffix:semicolon
multiline_comment|/* midi bender range (x100) */
DECL|member|panning
r_int
id|panning
suffix:semicolon
multiline_comment|/* panning (0-127) */
DECL|member|main_vol
r_int
id|main_vol
suffix:semicolon
multiline_comment|/* channel volume (0-127) */
DECL|member|expression_vol
r_int
id|expression_vol
suffix:semicolon
multiline_comment|/* midi expression (0-127) */
multiline_comment|/* EMU8000 parameters */
DECL|member|apitch
r_int
id|apitch
suffix:semicolon
multiline_comment|/* pitch parameter */
DECL|member|avol
r_int
id|avol
suffix:semicolon
multiline_comment|/* volume parameter */
multiline_comment|/* instrument parameters */
DECL|member|bank
r_int
id|bank
suffix:semicolon
multiline_comment|/* current tone bank */
DECL|member|instr
r_int
id|instr
suffix:semicolon
multiline_comment|/* current program */
DECL|member|vrec
id|awe_voice_list
op_star
id|vrec
suffix:semicolon
DECL|member|sample
id|awe_voice_info
op_star
id|sample
suffix:semicolon
multiline_comment|/* channel effects */
DECL|member|fx_flags
r_int
r_char
id|fx_flags
(braket
id|AWE_FX_BYTES
)braket
suffix:semicolon
DECL|member|fx
r_int
id|fx
(braket
id|AWE_FX_END
)braket
suffix:semicolon
DECL|typedef|voice_info
)brace
id|voice_info
suffix:semicolon
DECL|variable|voices
r_static
id|voice_info
id|voices
(braket
id|AWE_MAX_VOICES
)braket
suffix:semicolon
multiline_comment|/*----------------------------------------------------------------&n; * global variables&n; *----------------------------------------------------------------*/
multiline_comment|/* awe32 base address (overwritten at initialization) */
DECL|variable|awe_base
r_static
r_int
id|awe_base
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* memory byte size (overwritten at initialization) */
DECL|variable|awe_mem_size
r_static
r_int
id|awe_mem_size
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* maximum channels for playing */
DECL|variable|awe_max_voices
r_static
r_int
id|awe_max_voices
op_assign
id|AWE_MAX_VOICES
suffix:semicolon
DECL|variable|free_mem_ptr
r_static
r_int
id|free_mem_ptr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* free word byte size */
DECL|variable|free_info
r_static
r_int
id|free_info
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* free info tables */
DECL|variable|last_info
r_static
r_int
id|last_info
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* last loaded info index */
DECL|variable|free_sample
r_static
r_int
id|free_sample
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* free sample tables */
DECL|variable|last_sample
r_static
r_int
id|last_sample
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* last loaded sample index */
DECL|variable|loaded_once
r_static
r_int
id|loaded_once
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* samples are loaded after init? */
DECL|variable|current_sf_id
r_static
r_int
r_int
id|current_sf_id
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* internal id */
DECL|variable|reverb_mode
r_static
r_int
id|reverb_mode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reverb mode */
DECL|variable|chorus_mode
r_static
r_int
id|chorus_mode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* chorus mode */
DECL|variable|init_atten
r_static
r_int
r_int
id|init_atten
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* 12dB */
DECL|variable|awe_present
r_static
r_int
id|awe_present
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* awe device present? */
DECL|variable|awe_busy
r_static
r_int
id|awe_busy
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* awe device opened? */
DECL|variable|awe_gus_bank
r_static
r_int
id|awe_gus_bank
op_assign
id|AWE_DEFAULT_BANK
suffix:semicolon
multiline_comment|/* GUS default bank number */
DECL|variable|awe_info
r_static
r_struct
id|synth_info
id|awe_info
op_assign
(brace
l_string|&quot;AWE32 Synth&quot;
comma
multiline_comment|/* name */
l_int|0
comma
multiline_comment|/* device */
id|SYNTH_TYPE_SAMPLE
comma
multiline_comment|/* synth_type */
id|SAMPLE_TYPE_AWE32
comma
multiline_comment|/* synth_subtype */
l_int|0
comma
multiline_comment|/* perc_mode (obsolete) */
id|AWE_MAX_VOICES
comma
multiline_comment|/* nr_voices */
l_int|0
comma
multiline_comment|/* nr_drums (obsolete) */
id|AWE_MAX_INFOS
multiline_comment|/* instr_bank_size */
)brace
suffix:semicolon
DECL|variable|voice_alloc
r_static
r_struct
id|voice_alloc_info
op_star
id|voice_alloc
suffix:semicolon
multiline_comment|/* set at initialization */
multiline_comment|/*----------------------------------------------------------------&n; * function prototypes&n; *----------------------------------------------------------------*/
macro_line|#ifndef AWE_OBSOLETE_VOXWARE
r_static
r_int
id|awe_check_port
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_request_region
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_release_region
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|awe_reset_samples
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* emu8000 chip i/o access */
r_static
r_void
id|awe_poke
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
comma
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|awe_poke_dw
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
comma
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_int
r_int
id|awe_peek
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
)paren
suffix:semicolon
r_static
r_int
r_int
id|awe_peek_dw
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
)paren
suffix:semicolon
r_static
r_void
id|awe_wait
c_func
(paren
r_int
r_int
id|delay
)paren
suffix:semicolon
multiline_comment|/* initialize emu8000 chip */
r_static
r_void
id|awe_initialize
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* set voice parameters */
r_static
r_void
id|awe_init_voice_info
c_func
(paren
id|awe_voice_info
op_star
id|vp
)paren
suffix:semicolon
r_static
r_void
id|awe_init_voice_parm
c_func
(paren
id|awe_voice_parm
op_star
id|pp
)paren
suffix:semicolon
r_static
r_int
id|freq_to_note
c_func
(paren
r_int
id|freq
)paren
suffix:semicolon
r_static
r_int
id|calc_rate_offset
c_func
(paren
r_int
id|Hz
)paren
suffix:semicolon
multiline_comment|/*static int calc_parm_delay(int msec);*/
r_static
r_int
id|calc_parm_hold
c_func
(paren
r_int
id|msec
)paren
suffix:semicolon
r_static
r_int
id|calc_parm_attack
c_func
(paren
r_int
id|msec
)paren
suffix:semicolon
r_static
r_int
id|calc_parm_decay
c_func
(paren
r_int
id|msec
)paren
suffix:semicolon
r_static
r_int
id|calc_parm_search
c_func
(paren
r_int
id|msec
comma
r_int
op_star
id|table
)paren
suffix:semicolon
multiline_comment|/* turn on/off note */
r_static
r_void
id|awe_note_on
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_note_off
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_terminate
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_exclusive_off
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
multiline_comment|/* calculate voice parameters */
r_static
r_void
id|awe_set_pitch
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_set_volume
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_set_pan
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
suffix:semicolon
r_static
r_void
id|awe_fx_fmmod
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_fx_tremfrq
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_fx_fm2frq2
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_fx_cutoff
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_fx_initpitch
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_calc_pitch
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_calc_pitch_from_freq
c_func
(paren
r_int
id|voice
comma
r_int
id|freq
)paren
suffix:semicolon
r_static
r_void
id|awe_calc_volume
c_func
(paren
r_int
id|voice
)paren
suffix:semicolon
r_static
r_void
id|awe_voice_init
c_func
(paren
r_int
id|voice
comma
r_int
id|inst_only
)paren
suffix:semicolon
multiline_comment|/* sequencer interface */
r_static
r_int
id|awe_open
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
suffix:semicolon
r_static
r_void
id|awe_close
c_func
(paren
r_int
id|dev
)paren
suffix:semicolon
r_static
r_int
id|awe_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
suffix:semicolon
r_static
r_int
id|awe_kill_note
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|note
comma
r_int
id|velocity
)paren
suffix:semicolon
r_static
r_int
id|awe_start_note
c_func
(paren
r_int
id|dev
comma
r_int
id|v
comma
r_int
id|note_num
comma
r_int
id|volume
)paren
suffix:semicolon
r_static
r_int
id|awe_set_instr
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|instr_no
)paren
suffix:semicolon
r_static
r_void
id|awe_reset
c_func
(paren
r_int
id|dev
)paren
suffix:semicolon
r_static
r_void
id|awe_hw_control
c_func
(paren
r_int
id|dev
comma
r_int
r_char
op_star
id|event
)paren
suffix:semicolon
r_static
r_int
id|awe_load_patch
c_func
(paren
r_int
id|dev
comma
r_int
id|format
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|offs
comma
r_int
id|count
comma
r_int
id|pmgr_flag
)paren
suffix:semicolon
r_static
r_void
id|awe_aftertouch
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|pressure
)paren
suffix:semicolon
r_static
r_void
id|awe_controller
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|ctrl_num
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|awe_panning
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|awe_volume_method
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
suffix:semicolon
r_static
r_void
id|awe_bender
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_int
id|awe_alloc
c_func
(paren
r_int
id|dev
comma
r_int
id|chn
comma
r_int
id|note
comma
r_struct
id|voice_alloc_info
op_star
id|alloc
)paren
suffix:semicolon
r_static
r_void
id|awe_setup_voice
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|chn
)paren
suffix:semicolon
multiline_comment|/* hardware controls */
r_static
r_void
id|awe_hw_gus_control
c_func
(paren
r_int
id|dev
comma
r_int
id|cmd
comma
r_int
r_char
op_star
id|event
)paren
suffix:semicolon
r_static
r_void
id|awe_hw_awe_control
c_func
(paren
r_int
id|dev
comma
r_int
id|cmd
comma
r_int
r_char
op_star
id|event
)paren
suffix:semicolon
multiline_comment|/* voice search */
r_static
id|awe_voice_info
op_star
id|awe_search_voice
c_func
(paren
r_int
id|voice
comma
r_int
id|note
)paren
suffix:semicolon
r_static
id|awe_voice_list
op_star
id|awe_search_instr
c_func
(paren
r_int
id|bank
comma
r_int
id|preset
)paren
suffix:semicolon
multiline_comment|/* load / remove patches */
r_static
r_void
id|awe_check_loaded
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|awe_load_info
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
)paren
suffix:semicolon
r_static
r_int
id|awe_load_data
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
)paren
suffix:semicolon
r_static
r_int
id|awe_load_guspatch
c_func
(paren
r_const
r_char
op_star
id|addr
comma
r_int
id|offs
comma
r_int
id|size
comma
r_int
id|pmgr_flag
)paren
suffix:semicolon
r_static
r_int
id|awe_write_wave_data
c_func
(paren
r_const
r_char
op_star
id|addr
comma
r_int
id|offset
comma
r_int
id|size
)paren
suffix:semicolon
r_static
id|awe_voice_list
op_star
id|awe_get_removed_list
c_func
(paren
id|awe_voice_list
op_star
id|curp
)paren
suffix:semicolon
r_static
r_void
id|awe_remove_samples
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|awe_set_sample
c_func
(paren
id|awe_voice_info
op_star
id|vp
)paren
suffix:semicolon
multiline_comment|/* lowlevel functions */
r_static
r_void
id|awe_init_audio
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_init_dma
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_init_array
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_send_array
c_func
(paren
r_int
r_int
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|awe_tweak
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_init_fm
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|awe_open_dram_for_write
c_func
(paren
r_int
id|offset
)paren
suffix:semicolon
r_static
r_int
id|awe_open_dram_for_read
c_func
(paren
r_int
id|offset
)paren
suffix:semicolon
r_static
r_void
id|awe_open_dram_for_check
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_close_dram
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_close_dram_for_read
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_write_dram
c_func
(paren
r_int
r_int
id|c
)paren
suffix:semicolon
r_static
r_int
id|awe_detect
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|awe_check_dram
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|awe_set_chorus_mode
c_func
(paren
r_int
id|mode
)paren
suffix:semicolon
r_static
r_void
id|awe_set_reverb_mode
c_func
(paren
r_int
id|mode
)paren
suffix:semicolon
macro_line|#ifdef AWE_OBSOLETE_VOXWARE
DECL|macro|awe_check_port
mdefine_line|#define awe_check_port()&t;0&t;/* always false */
DECL|macro|awe_request_region
mdefine_line|#define awe_request_region()&t;/* nothing */
DECL|macro|awe_release_region
mdefine_line|#define awe_release_region()&t;/* nothing */
macro_line|#else /* AWE_OBSOLETE_VOXWARE */
multiline_comment|/* the following macros are osbolete */
DECL|macro|PERMANENT_MALLOC
mdefine_line|#define PERMANENT_MALLOC(type,var,size,memptr) &bslash;&n;&t;var = (type)(sound_mem_blocks[sound_nblocks++] = vmalloc(size))
DECL|macro|RET_ERROR
mdefine_line|#define RET_ERROR(err)&t;&t;&t;-err
macro_line|#endif /* AWE_OBSOLETE_VOXWARE */
macro_line|#ifdef AWE_NEED_DISABLE_INTR
DECL|macro|DECL_INTR_FLAGS
mdefine_line|#define DECL_INTR_FLAGS(x)&t;unsigned long x
macro_line|#else
DECL|macro|DISABLE_INTR
macro_line|#undef DISABLE_INTR
DECL|macro|RESTORE_INTR
macro_line|#undef RESTORE_INTR
DECL|macro|DECL_INTR_FLAGS
mdefine_line|#define DECL_INTR_FLAGS(x) /**/
DECL|macro|DISABLE_INTR
mdefine_line|#define DISABLE_INTR(x) /**/
DECL|macro|RESTORE_INTR
mdefine_line|#define RESTORE_INTR(x) /**/
macro_line|#endif
multiline_comment|/* macros for Linux and FreeBSD compatibility */
DECL|macro|OUTW
macro_line|#undef OUTW
DECL|macro|COPY_FROM_USER
macro_line|#undef COPY_FROM_USER
DECL|macro|GET_BYTE_FROM_USER
macro_line|#undef GET_BYTE_FROM_USER
DECL|macro|GET_SHORT_FROM_USER
macro_line|#undef GET_SHORT_FROM_USER
DECL|macro|IOCTL_TO_USER
macro_line|#undef IOCTL_TO_USER
macro_line|#ifdef linux
DECL|macro|NO_DATA_ERR
macro_line|#  define NO_DATA_ERR                 ENODATA
DECL|macro|OUTW
macro_line|#  define OUTW(data, addr)            outw(data, addr)
DECL|macro|COPY_FROM_USER
macro_line|#  define COPY_FROM_USER(target, source, offs, count) &bslash;&n;              copy_from_user( ((caddr_t)(target)),(source)+(offs),(count) )
DECL|macro|GET_BYTE_FROM_USER
macro_line|#  define GET_BYTE_FROM_USER(target, addr, offs)      &bslash;&n;&t;&t;get_user(target, (unsigned char*)&amp;((addr)[offs]))
DECL|macro|GET_SHORT_FROM_USER
macro_line|#  define GET_SHORT_FROM_USER(target, addr, offs)     &bslash;&n;&t;&t;get_user(target, (unsigned short*)&amp;((addr)[offs]))
DECL|macro|IOCTL_TO_USER
macro_line|#  define IOCTL_TO_USER(target, offs, source, count)  &bslash;&n;              copy_to_user  ( ((caddr_t)(target)),(source)+(offs),(count) )
DECL|macro|BZERO
macro_line|#  define BZERO(target,len)                           &bslash;&n;              memset( (caddr_t)target, &squot;&bslash;0&squot;, len )
macro_line|#elif defined(__FreeBSD__)
DECL|macro|NO_DATA_ERR
macro_line|#  define NO_DATA_ERR                 EINVAL
DECL|macro|OUTW
macro_line|#  define OUTW(data, addr)            outw(addr, data)
DECL|macro|COPY_FROM_USER
macro_line|#  define COPY_FROM_USER(target, source, offs, count) &bslash;&n;              uiomove( ((caddr_t)(target)),(count),((struct uio *)(source)) )
DECL|macro|GET_BYTE_FROM_USER
macro_line|#  define GET_BYTE_FROM_USER(target, addr, offs)      &bslash;&n;              uiomove( ((char*)&amp;(target)), 1, ((struct uio *)(addr)) )
DECL|macro|GET_SHORT_FROM_USER
macro_line|#  define GET_SHORT_FROM_USER(target, addr, offs)     &bslash;&n;              uiomove( ((char*)&amp;(target)), 2, ((struct uio *)(addr)) )
DECL|macro|IOCTL_TO_USER
macro_line|#  define IOCTL_TO_USER(target, offs, source, count)  &bslash;&n;              memcpy( &amp;((target)[offs]), (source), (count) )
DECL|macro|BZERO
macro_line|#  define BZERO(target,len)                           &bslash;&n;              bzero( (caddr_t)target, len )
macro_line|#endif
multiline_comment|/*----------------------------------------------------------------&n; * synth operation table&n; *----------------------------------------------------------------*/
DECL|variable|awe_operations
r_static
r_struct
id|synth_operations
id|awe_operations
op_assign
(brace
op_amp
id|awe_info
comma
l_int|0
comma
id|SYNTH_TYPE_SAMPLE
comma
id|SAMPLE_TYPE_AWE32
comma
id|awe_open
comma
id|awe_close
comma
id|awe_ioctl
comma
id|awe_kill_note
comma
id|awe_start_note
comma
id|awe_set_instr
comma
id|awe_reset
comma
id|awe_hw_control
comma
id|awe_load_patch
comma
id|awe_aftertouch
comma
id|awe_controller
comma
id|awe_panning
comma
id|awe_volume_method
comma
id|awe_bender
comma
id|awe_alloc
comma
id|awe_setup_voice
)brace
suffix:semicolon
multiline_comment|/*================================================================&n; * attach / unload interface&n; *================================================================*/
macro_line|#ifdef AWE_OBSOLETE_VOXWARE
DECL|function|attach_awe_obsolete
r_int
id|attach_awe_obsolete
c_func
(paren
r_int
id|mem_start
comma
r_struct
id|address_info
op_star
id|hw_config
)paren
macro_line|#else
r_int
id|attach_awe
c_func
(paren
r_void
)paren
macro_line|#endif
(brace
multiline_comment|/* check presence of AWE32 card */
r_if
c_cond
(paren
op_logical_neg
id|awe_detect
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AWE32: not detected&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* check AWE32 ports are available */
r_if
c_cond
(paren
id|awe_check_port
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AWE32: I/O area already used.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* allocate sample tables */
id|PERMANENT_MALLOC
c_func
(paren
id|awe_sample_info
op_star
comma
id|samples
comma
id|AWE_MAX_SAMPLES
op_star
r_sizeof
(paren
id|awe_sample_info
)paren
comma
id|mem_start
)paren
suffix:semicolon
id|PERMANENT_MALLOC
c_func
(paren
id|awe_voice_list
op_star
comma
id|infos
comma
id|AWE_MAX_INFOS
op_star
r_sizeof
(paren
id|awe_voice_list
)paren
comma
id|mem_start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|samples
op_eq
l_int|NULL
op_logical_or
id|infos
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AWE32: can&squot;t allocate sample tables&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|num_synths
op_ge
id|MAX_SYNTH_DEV
)paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: too many synthesizers&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|voice_alloc
op_assign
op_amp
id|awe_operations.alloc
suffix:semicolon
id|voice_alloc-&gt;max_voice
op_assign
id|awe_max_voices
suffix:semicolon
id|synth_devs
(braket
id|num_synths
op_increment
)braket
op_assign
op_amp
id|awe_operations
suffix:semicolon
)brace
multiline_comment|/* reserve I/O ports for awedrv */
id|awe_request_region
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* clear all samples */
id|awe_reset_samples
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* intialize AWE32 hardware */
id|awe_initialize
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&lt;AWE32 SynthCard (%dk)&gt;&bslash;n&quot;
comma
(paren
r_int
)paren
id|awe_mem_size
op_div
l_int|1024
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|awe_info.name
comma
l_string|&quot;AWE32 Synth (%dk)&quot;
comma
(paren
r_int
)paren
id|awe_mem_size
op_div
l_int|1024
)paren
suffix:semicolon
multiline_comment|/* set reverb &amp; chorus modes */
id|awe_set_reverb_mode
c_func
(paren
id|reverb_mode
)paren
suffix:semicolon
id|awe_set_chorus_mode
c_func
(paren
id|chorus_mode
)paren
suffix:semicolon
id|awe_present
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef AWE_OBSOLETE_VOXWARE
r_return
id|mem_start
suffix:semicolon
macro_line|#else
r_return
l_int|1
suffix:semicolon
macro_line|#endif
)brace
DECL|function|unload_awe
r_void
id|unload_awe
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|awe_present
)paren
(brace
id|awe_reset_samples
c_func
(paren
)paren
suffix:semicolon
id|awe_release_region
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef AWE_OBSOLETE_VOXWARE
DECL|function|probe_awe_obsolete
r_int
id|probe_awe_obsolete
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_return
l_int|1
suffix:semicolon
multiline_comment|/*return awe_detect();*/
)brace
macro_line|#endif
multiline_comment|/*================================================================&n; * clear sample tables &n; *================================================================*/
r_static
r_void
DECL|function|awe_reset_samples
id|awe_reset_samples
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* free all bank tables */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_PRESETS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|preset_table
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
id|free_mem_ptr
op_assign
l_int|0
suffix:semicolon
id|last_sample
op_assign
id|free_sample
op_assign
l_int|0
suffix:semicolon
id|last_info
op_assign
id|free_info
op_assign
l_int|0
suffix:semicolon
id|current_sf_id
op_assign
l_int|0
suffix:semicolon
id|loaded_once
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*================================================================&n; * EMU register access&n; *================================================================*/
multiline_comment|/* select a given AWE32 pointer */
DECL|macro|awe_set_cmd
mdefine_line|#define awe_set_cmd(cmd)&t;OUTW(cmd, awe_base + 0x802)
DECL|macro|awe_port
mdefine_line|#define awe_port(port)&t;&t;(awe_base - 0x620 + port)
multiline_comment|/* write 16bit data */
r_static
r_void
DECL|function|awe_poke
id|awe_poke
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
comma
r_int
r_int
id|data
)paren
(brace
id|awe_set_cmd
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|OUTW
c_func
(paren
id|data
comma
id|awe_port
c_func
(paren
id|port
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* write 32bit data */
r_static
r_void
DECL|function|awe_poke_dw
id|awe_poke_dw
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
comma
r_int
r_int
id|data
)paren
(brace
id|awe_set_cmd
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|OUTW
c_func
(paren
id|data
comma
id|awe_port
c_func
(paren
id|port
)paren
)paren
suffix:semicolon
multiline_comment|/* write lower 16 bits */
id|OUTW
c_func
(paren
id|data
op_rshift
l_int|16
comma
id|awe_port
c_func
(paren
id|port
)paren
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* write higher 16 bits */
)brace
multiline_comment|/* read 16bit data */
r_static
r_int
r_int
DECL|function|awe_peek
id|awe_peek
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
)paren
(brace
r_int
r_int
id|k
suffix:semicolon
id|awe_set_cmd
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|k
op_assign
id|inw
c_func
(paren
id|awe_port
c_func
(paren
id|port
)paren
)paren
suffix:semicolon
r_return
id|k
suffix:semicolon
)brace
multiline_comment|/* read 32bit data */
r_static
r_int
r_int
DECL|function|awe_peek_dw
id|awe_peek_dw
c_func
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|port
)paren
(brace
r_int
r_int
id|k1
comma
id|k2
suffix:semicolon
id|awe_set_cmd
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|k1
op_assign
id|inw
c_func
(paren
id|awe_port
c_func
(paren
id|port
)paren
)paren
suffix:semicolon
id|k2
op_assign
id|inw
c_func
(paren
id|awe_port
c_func
(paren
id|port
)paren
op_plus
l_int|2
)paren
suffix:semicolon
id|k1
op_or_assign
id|k2
op_lshift
l_int|16
suffix:semicolon
r_return
id|k1
suffix:semicolon
)brace
multiline_comment|/* wait delay number of AWE32 44100Hz clocks */
r_static
r_void
DECL|function|awe_wait
id|awe_wait
c_func
(paren
r_int
r_int
id|delay
)paren
(brace
r_int
r_int
id|clock
comma
id|target
suffix:semicolon
r_int
r_int
id|port
op_assign
id|awe_port
c_func
(paren
id|AWE_WC_Port
)paren
suffix:semicolon
r_int
id|counter
suffix:semicolon
multiline_comment|/* sample counter */
id|awe_set_cmd
c_func
(paren
id|AWE_WC_Cmd
)paren
suffix:semicolon
id|clock
op_assign
(paren
r_int
r_int
)paren
id|inw
c_func
(paren
id|port
)paren
suffix:semicolon
id|target
op_assign
id|clock
op_plus
id|delay
suffix:semicolon
id|counter
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|target
OL
id|clock
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
(paren
r_int
r_int
)paren
id|inw
c_func
(paren
id|port
)paren
OG
id|target
suffix:semicolon
id|counter
op_increment
)paren
r_if
c_cond
(paren
id|counter
OG
l_int|65536
)paren
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
(paren
r_int
r_int
)paren
id|inw
c_func
(paren
id|port
)paren
OL
id|target
suffix:semicolon
id|counter
op_increment
)paren
r_if
c_cond
(paren
id|counter
OG
l_int|65536
)paren
r_break
suffix:semicolon
)brace
macro_line|#ifndef AWE_OBSOLETE_VOXWARE
multiline_comment|/*================================================================&n; * port check / request&n; *  0x620-622, 0xA20-A22, 0xE20-E22&n; *================================================================*/
r_static
r_int
DECL|function|awe_check_port
id|awe_check_port
c_func
(paren
r_void
)paren
(brace
r_return
(paren
id|check_region
c_func
(paren
id|awe_port
c_func
(paren
id|Data0
)paren
comma
l_int|3
)paren
op_logical_or
id|check_region
c_func
(paren
id|awe_port
c_func
(paren
id|Data1
)paren
comma
l_int|3
)paren
op_logical_or
id|check_region
c_func
(paren
id|awe_port
c_func
(paren
id|Data3
)paren
comma
l_int|3
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_request_region
id|awe_request_region
c_func
(paren
r_void
)paren
(brace
id|request_region
c_func
(paren
id|awe_port
c_func
(paren
id|Data0
)paren
comma
l_int|3
comma
l_string|&quot;sound driver (AWE32)&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
id|awe_port
c_func
(paren
id|Data1
)paren
comma
l_int|3
comma
l_string|&quot;sound driver (AWE32)&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
id|awe_port
c_func
(paren
id|Data3
)paren
comma
l_int|3
comma
l_string|&quot;sound driver (AWE32)&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_release_region
id|awe_release_region
c_func
(paren
r_void
)paren
(brace
id|release_region
c_func
(paren
id|awe_port
c_func
(paren
id|Data0
)paren
comma
l_int|3
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|awe_port
c_func
(paren
id|Data1
)paren
comma
l_int|3
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|awe_port
c_func
(paren
id|Data3
)paren
comma
l_int|3
)paren
suffix:semicolon
)brace
macro_line|#endif /* !AWE_OBSOLETE_VOXWARE */
multiline_comment|/*================================================================&n; * AWE32 initialization&n; *================================================================*/
r_static
r_void
DECL|function|awe_initialize
id|awe_initialize
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: initializing..&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* check for an error condition */
id|data
op_assign
id|awe_peek
c_func
(paren
id|AWE_U1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_amp
l_int|0x000F
)paren
op_eq
l_int|0x000C
)paren
(brace
id|FATALERR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32: can&squot;t initialize AWE32&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* initialize hardware configuration */
id|awe_poke
c_func
(paren
id|AWE_HWCF1
comma
l_int|0x0059
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_HWCF2
comma
l_int|0x0020
)paren
suffix:semicolon
multiline_comment|/* disable audio output */
id|awe_poke
c_func
(paren
id|AWE_HWCF3
comma
l_int|0x0000
)paren
suffix:semicolon
multiline_comment|/* initialize audio channels */
id|awe_init_audio
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* initialize init array */
id|awe_init_dma
c_func
(paren
)paren
suffix:semicolon
id|awe_init_array
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* check DRAM memory size */
id|awe_mem_size
op_assign
id|awe_check_dram
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* initialize the FM section of the AWE32 */
id|awe_init_fm
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set up voice envelopes */
id|awe_tweak
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* enable audio */
id|awe_poke
c_func
(paren
id|AWE_HWCF3
comma
l_int|0x0004
)paren
suffix:semicolon
id|data
op_assign
id|awe_peek
c_func
(paren
id|AWE_HWCF2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_complement
id|data
op_amp
l_int|0x40
)paren
(brace
id|FATALERR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32: Unable to initialize AWE32.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*================================================================&n; * AWE32 voice parameters&n; *================================================================*/
multiline_comment|/* initialize voice_info record */
r_static
r_void
DECL|function|awe_init_voice_info
id|awe_init_voice_info
c_func
(paren
id|awe_voice_info
op_star
id|vp
)paren
(brace
id|vp-&gt;sf_id
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;sample
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;rate_offset
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;start
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;end
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;loopstart
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;loopend
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;mode
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;root
op_assign
l_int|60
suffix:semicolon
id|vp-&gt;tune
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;low
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;high
op_assign
l_int|127
suffix:semicolon
id|vp-&gt;vellow
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;velhigh
op_assign
l_int|127
suffix:semicolon
id|vp-&gt;fixkey
op_assign
op_minus
l_int|1
suffix:semicolon
id|vp-&gt;fixvel
op_assign
op_minus
l_int|1
suffix:semicolon
id|vp-&gt;fixpan
op_assign
op_minus
l_int|1
suffix:semicolon
id|vp-&gt;pan
op_assign
op_minus
l_int|1
suffix:semicolon
id|vp-&gt;exclusiveClass
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;amplitude
op_assign
l_int|127
suffix:semicolon
id|vp-&gt;attenuation
op_assign
l_int|0
suffix:semicolon
id|vp-&gt;scaleTuning
op_assign
l_int|100
suffix:semicolon
id|awe_init_voice_parm
c_func
(paren
op_amp
id|vp-&gt;parm
)paren
suffix:semicolon
)brace
multiline_comment|/* initialize voice_parm record:&n; * Env1/2: delay=0, attack=0, hold=0, sustain=0, decay=0, release=0.&n; * Vibrato and Tremolo effects are zero.&n; * Cutoff is maximum.&n; * Chorus and Reverb effects are zero.&n; */
r_static
r_void
DECL|function|awe_init_voice_parm
id|awe_init_voice_parm
c_func
(paren
id|awe_voice_parm
op_star
id|pp
)paren
(brace
id|pp-&gt;moddelay
op_assign
l_int|0x8000
suffix:semicolon
id|pp-&gt;modatkhld
op_assign
l_int|0x7f7f
suffix:semicolon
id|pp-&gt;moddcysus
op_assign
l_int|0x7f7f
suffix:semicolon
id|pp-&gt;modrelease
op_assign
l_int|0x807f
suffix:semicolon
id|pp-&gt;modkeyhold
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;modkeydecay
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;voldelay
op_assign
l_int|0x8000
suffix:semicolon
id|pp-&gt;volatkhld
op_assign
l_int|0x7f7f
suffix:semicolon
id|pp-&gt;voldcysus
op_assign
l_int|0x7f7f
suffix:semicolon
id|pp-&gt;volrelease
op_assign
l_int|0x807f
suffix:semicolon
id|pp-&gt;volkeyhold
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;volkeydecay
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;lfo1delay
op_assign
l_int|0x8000
suffix:semicolon
id|pp-&gt;lfo2delay
op_assign
l_int|0x8000
suffix:semicolon
id|pp-&gt;pefe
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;fmmod
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;tremfrq
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;fm2frq2
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;cutoff
op_assign
l_int|0xff
suffix:semicolon
id|pp-&gt;filterQ
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;chorus
op_assign
l_int|0
suffix:semicolon
id|pp-&gt;reverb
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* convert frequency mHz to abstract cents (= midi key * 100) */
r_static
r_int
DECL|function|freq_to_note
id|freq_to_note
c_func
(paren
r_int
id|mHz
)paren
(brace
multiline_comment|/* abscents = log(mHz/8176) / log(2) * 1200 */
r_int
r_int
id|max_val
op_assign
(paren
r_int
r_int
)paren
l_int|0xffffffff
op_div
l_int|10000
suffix:semicolon
r_int
id|i
comma
id|times
suffix:semicolon
r_int
r_int
id|base
suffix:semicolon
r_int
r_int
id|freq
suffix:semicolon
r_int
id|note
comma
id|tune
suffix:semicolon
r_if
c_cond
(paren
id|mHz
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mHz
OL
l_int|0
)paren
r_return
l_int|12799
suffix:semicolon
multiline_comment|/* maximum */
id|freq
op_assign
id|mHz
suffix:semicolon
id|note
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|base
op_assign
l_int|8176
op_star
l_int|2
suffix:semicolon
id|freq
op_ge
id|base
suffix:semicolon
id|base
op_mul_assign
l_int|2
)paren
(brace
id|note
op_add_assign
l_int|12
suffix:semicolon
r_if
c_cond
(paren
id|note
op_ge
l_int|128
)paren
multiline_comment|/* over maximum */
r_return
l_int|12799
suffix:semicolon
)brace
id|base
op_div_assign
l_int|2
suffix:semicolon
multiline_comment|/* to avoid overflow... */
id|times
op_assign
l_int|10000
suffix:semicolon
r_while
c_loop
(paren
id|freq
OG
id|max_val
)paren
(brace
id|max_val
op_mul_assign
l_int|10
suffix:semicolon
id|times
op_div_assign
l_int|10
suffix:semicolon
id|base
op_div_assign
l_int|10
suffix:semicolon
)brace
id|freq
op_assign
id|freq
op_star
id|times
op_div
id|base
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|12
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|freq
OL
id|semitone_tuning
(braket
id|i
op_plus
l_int|1
)braket
)paren
r_break
suffix:semicolon
id|note
op_increment
suffix:semicolon
)brace
id|tune
op_assign
l_int|0
suffix:semicolon
id|freq
op_assign
id|freq
op_star
l_int|10000
op_div
id|semitone_tuning
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|freq
OL
id|cent_tuning
(braket
id|i
op_plus
l_int|1
)braket
)paren
r_break
suffix:semicolon
id|tune
op_increment
suffix:semicolon
)brace
r_return
id|note
op_star
l_int|100
op_plus
id|tune
suffix:semicolon
)brace
multiline_comment|/* convert Hz to AWE32 rate offset:&n; * sample pitch offset for the specified sample rate&n; * rate=44100 is no offset, each 4096 is 1 octave (twice).&n; * eg, when rate is 22050, this offset becomes -4096.&n; */
r_static
r_int
DECL|function|calc_rate_offset
id|calc_rate_offset
c_func
(paren
r_int
id|Hz
)paren
(brace
multiline_comment|/* offset = log(Hz / 44100) / log(2) * 4096 */
r_int
id|freq
comma
id|base
comma
id|i
suffix:semicolon
multiline_comment|/* maybe smaller than max (44100Hz) */
r_if
c_cond
(paren
id|Hz
op_le
l_int|0
op_logical_or
id|Hz
op_ge
l_int|44100
)paren
r_return
l_int|0
suffix:semicolon
id|base
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|freq
op_assign
id|Hz
op_star
l_int|2
suffix:semicolon
id|freq
OL
l_int|44100
suffix:semicolon
id|freq
op_mul_assign
l_int|2
)paren
id|base
op_increment
suffix:semicolon
id|base
op_mul_assign
l_int|1200
suffix:semicolon
id|freq
op_assign
l_int|44100
op_star
l_int|10000
op_div
(paren
id|freq
op_div
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|12
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|freq
OL
id|semitone_tuning
(braket
id|i
op_plus
l_int|1
)braket
)paren
r_break
suffix:semicolon
id|base
op_add_assign
l_int|100
suffix:semicolon
)brace
id|freq
op_assign
id|freq
op_star
l_int|10000
op_div
id|semitone_tuning
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|freq
OL
id|cent_tuning
(braket
id|i
op_plus
l_int|1
)braket
)paren
r_break
suffix:semicolon
id|base
op_increment
suffix:semicolon
)brace
r_return
op_minus
id|base
op_star
l_int|4096
op_div
l_int|1200
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------&n; * convert envelope time parameter to AWE32 raw parameter&n; *----------------------------------------------------------------*/
multiline_comment|/* attack &amp; decay/release time table (mHz) */
DECL|variable|attack_time_tbl
r_static
r_int
id|attack_time_tbl
(braket
l_int|128
)braket
op_assign
(brace
l_int|32767
comma
l_int|5939
comma
l_int|3959
comma
l_int|2969
comma
l_int|2375
comma
l_int|1979
comma
l_int|1696
comma
l_int|1484
comma
l_int|1319
comma
l_int|1187
comma
l_int|1079
comma
l_int|989
comma
l_int|913
comma
l_int|848
comma
l_int|791
comma
l_int|742
comma
l_int|698
comma
l_int|659
comma
l_int|625
comma
l_int|593
comma
l_int|565
comma
l_int|539
comma
l_int|516
comma
l_int|494
comma
l_int|475
comma
l_int|456
comma
l_int|439
comma
l_int|424
comma
l_int|409
comma
l_int|395
comma
l_int|383
comma
l_int|371
comma
l_int|359
comma
l_int|344
comma
l_int|330
comma
l_int|316
comma
l_int|302
comma
l_int|290
comma
l_int|277
comma
l_int|266
comma
l_int|255
comma
l_int|244
comma
l_int|233
comma
l_int|224
comma
l_int|214
comma
l_int|205
comma
l_int|196
comma
l_int|188
comma
l_int|180
comma
l_int|173
comma
l_int|165
comma
l_int|158
comma
l_int|152
comma
l_int|145
comma
l_int|139
comma
l_int|133
comma
l_int|127
comma
l_int|122
comma
l_int|117
comma
l_int|112
comma
l_int|107
comma
l_int|103
comma
l_int|98
comma
l_int|94
comma
l_int|90
comma
l_int|86
comma
l_int|83
comma
l_int|79
comma
l_int|76
comma
l_int|73
comma
l_int|69
comma
l_int|67
comma
l_int|64
comma
l_int|61
comma
l_int|58
comma
l_int|56
comma
l_int|54
comma
l_int|51
comma
l_int|49
comma
l_int|47
comma
l_int|45
comma
l_int|43
comma
l_int|41
comma
l_int|39
comma
l_int|38
comma
l_int|36
comma
l_int|35
comma
l_int|33
comma
l_int|32
comma
l_int|30
comma
l_int|29
comma
l_int|28
comma
l_int|27
comma
l_int|25
comma
l_int|24
comma
l_int|23
comma
l_int|22
comma
l_int|21
comma
l_int|20
comma
l_int|20
comma
l_int|19
comma
l_int|18
comma
l_int|17
comma
l_int|16
comma
l_int|16
comma
l_int|15
comma
l_int|14
comma
l_int|14
comma
l_int|13
comma
l_int|13
comma
l_int|12
comma
l_int|11
comma
l_int|11
comma
l_int|10
comma
l_int|10
comma
l_int|10
comma
l_int|9
comma
l_int|9
comma
l_int|8
comma
l_int|8
comma
l_int|8
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|decay_time_tbl
r_static
r_int
id|decay_time_tbl
(braket
l_int|128
)braket
op_assign
(brace
l_int|32767
comma
l_int|3651
comma
l_int|3508
comma
l_int|3371
comma
l_int|3239
comma
l_int|3113
comma
l_int|2991
comma
l_int|2874
comma
l_int|2761
comma
l_int|2653
comma
l_int|2550
comma
l_int|2450
comma
l_int|2354
comma
l_int|2262
comma
l_int|2174
comma
l_int|2089
comma
l_int|2007
comma
l_int|1928
comma
l_int|1853
comma
l_int|1781
comma
l_int|1711
comma
l_int|1644
comma
l_int|1580
comma
l_int|1518
comma
l_int|1459
comma
l_int|1401
comma
l_int|1347
comma
l_int|1294
comma
l_int|1243
comma
l_int|1195
comma
l_int|1148
comma
l_int|1103
comma
l_int|1060
comma
l_int|1018
comma
l_int|979
comma
l_int|940
comma
l_int|904
comma
l_int|868
comma
l_int|834
comma
l_int|802
comma
l_int|770
comma
l_int|740
comma
l_int|711
comma
l_int|683
comma
l_int|657
comma
l_int|631
comma
l_int|606
comma
l_int|582
comma
l_int|560
comma
l_int|538
comma
l_int|517
comma
l_int|496
comma
l_int|477
comma
l_int|458
comma
l_int|440
comma
l_int|423
comma
l_int|407
comma
l_int|391
comma
l_int|375
comma
l_int|361
comma
l_int|347
comma
l_int|333
comma
l_int|320
comma
l_int|307
comma
l_int|295
comma
l_int|284
comma
l_int|273
comma
l_int|262
comma
l_int|252
comma
l_int|242
comma
l_int|232
comma
l_int|223
comma
l_int|215
comma
l_int|206
comma
l_int|198
comma
l_int|190
comma
l_int|183
comma
l_int|176
comma
l_int|169
comma
l_int|162
comma
l_int|156
comma
l_int|150
comma
l_int|144
comma
l_int|138
comma
l_int|133
comma
l_int|128
comma
l_int|123
comma
l_int|118
comma
l_int|113
comma
l_int|109
comma
l_int|104
comma
l_int|100
comma
l_int|96
comma
l_int|93
comma
l_int|89
comma
l_int|85
comma
l_int|82
comma
l_int|79
comma
l_int|76
comma
l_int|73
comma
l_int|70
comma
l_int|67
comma
l_int|64
comma
l_int|62
comma
l_int|60
comma
l_int|57
comma
l_int|55
comma
l_int|53
comma
l_int|51
comma
l_int|49
comma
l_int|47
comma
l_int|45
comma
l_int|43
comma
l_int|41
comma
l_int|40
comma
l_int|38
comma
l_int|37
comma
l_int|35
comma
l_int|34
comma
l_int|32
comma
l_int|31
comma
l_int|30
comma
l_int|29
comma
l_int|28
comma
l_int|27
comma
l_int|25
comma
l_int|24
comma
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n;static int&n;calc_parm_delay(int msec)&n;{&n;&t;return (0x8000 - msec * 1000 / 725);&n;}&n;*/
r_static
r_int
DECL|function|calc_parm_hold
id|calc_parm_hold
c_func
(paren
r_int
id|msec
)paren
(brace
r_int
id|val
op_assign
l_int|0x7f
op_minus
(paren
r_int
r_char
)paren
(paren
id|msec
op_div
l_int|92
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
l_int|1
)paren
id|val
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
l_int|127
)paren
id|val
op_assign
l_int|127
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
r_static
r_int
DECL|function|calc_parm_attack
id|calc_parm_attack
c_func
(paren
r_int
id|msec
)paren
(brace
r_return
id|calc_parm_search
c_func
(paren
id|msec
comma
id|attack_time_tbl
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|calc_parm_decay
id|calc_parm_decay
c_func
(paren
r_int
id|msec
)paren
(brace
r_return
id|calc_parm_search
c_func
(paren
id|msec
comma
id|decay_time_tbl
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|calc_parm_search
id|calc_parm_search
c_func
(paren
r_int
id|msec
comma
r_int
op_star
id|table
)paren
(brace
r_int
id|left
op_assign
l_int|0
comma
id|right
op_assign
l_int|127
comma
id|mid
suffix:semicolon
r_while
c_loop
(paren
id|left
OL
id|right
)paren
(brace
id|mid
op_assign
(paren
id|left
op_plus
id|right
)paren
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|msec
OL
(paren
r_int
)paren
id|table
(braket
id|mid
)braket
)paren
id|left
op_assign
id|mid
op_plus
l_int|1
suffix:semicolon
r_else
id|right
op_assign
id|mid
suffix:semicolon
)brace
r_return
id|left
suffix:semicolon
)brace
multiline_comment|/*================================================================&n; * effects table&n; *================================================================*/
multiline_comment|/* set an effect value */
DECL|macro|FX_SET
mdefine_line|#define FX_SET(v,type,value) &bslash;&n;(voices[v].fx_flags[(type)/8] |= (1&lt;&lt;((type)%8)),&bslash;&n; voices[v].fx[type] = (value))
multiline_comment|/* check the effect value is set */
DECL|macro|FX_ON
mdefine_line|#define FX_ON(v,type)&t;(voices[v].fx_flags[(type)/8] &amp; (1&lt;&lt;((type)%8)))
macro_line|#if 0
mdefine_line|#define FX_BYTE(v,type,value)&bslash;&n;&t;(FX_ON(v,type) ? (unsigned char)voices[v].fx[type] :&bslash;&n;&t; (unsigned char)(value))
mdefine_line|#define FX_WORD(v,type,value)&bslash;&n;&t;(FX_ON(v,type) ? (unsigned short)voices[v].fx[type] :&bslash;&n;&t; (unsigned short)(value))
macro_line|#else
multiline_comment|/* get byte effect value */
DECL|function|FX_BYTE
r_static
r_int
r_char
id|FX_BYTE
c_func
(paren
r_int
id|v
comma
r_int
id|type
comma
r_int
r_char
id|value
)paren
(brace
r_int
r_char
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|v
comma
id|type
)paren
)paren
id|tmp
op_assign
(paren
r_int
r_char
)paren
id|voices
(braket
id|v
)braket
dot
id|fx
(braket
id|type
)braket
suffix:semicolon
r_else
id|tmp
op_assign
id|value
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- byte(%d) = %x]&bslash;n&quot;
comma
id|type
comma
id|tmp
)paren
)paren
suffix:semicolon
r_return
id|tmp
suffix:semicolon
)brace
multiline_comment|/* get word effect value */
DECL|function|FX_WORD
r_static
r_int
r_int
id|FX_WORD
c_func
(paren
r_int
id|v
comma
r_int
id|type
comma
r_int
r_int
id|value
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|v
comma
id|type
)paren
)paren
id|tmp
op_assign
(paren
r_int
r_int
)paren
id|voices
(braket
id|v
)braket
dot
id|fx
(braket
id|type
)braket
suffix:semicolon
r_else
id|tmp
op_assign
id|value
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- word(%d) = %x]&bslash;n&quot;
comma
id|type
comma
id|tmp
)paren
)paren
suffix:semicolon
r_return
id|tmp
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* get word (upper=type1/lower=type2) effect value */
DECL|function|FX_COMB
r_static
r_int
r_int
id|FX_COMB
c_func
(paren
r_int
id|v
comma
r_int
id|type1
comma
r_int
id|type2
comma
r_int
r_int
id|value
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|v
comma
id|type1
)paren
)paren
id|tmp
op_assign
(paren
r_int
r_int
)paren
(paren
id|voices
(braket
id|v
)braket
dot
id|fx
(braket
id|type1
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
r_else
id|tmp
op_assign
id|value
op_amp
l_int|0xff00
suffix:semicolon
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|v
comma
id|type2
)paren
)paren
id|tmp
op_or_assign
(paren
r_int
r_int
)paren
(paren
id|voices
(braket
id|v
)braket
dot
id|fx
(braket
id|type2
)braket
)paren
op_amp
l_int|0xff
suffix:semicolon
r_else
id|tmp
op_or_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- comb(%d/%d) = %x]&bslash;n&quot;
comma
id|type1
comma
id|type2
comma
id|tmp
)paren
)paren
suffix:semicolon
r_return
id|tmp
suffix:semicolon
)brace
multiline_comment|/* address offset */
r_static
r_int
DECL|function|FX_OFFSET
id|FX_OFFSET
c_func
(paren
r_int
id|voice
comma
r_int
id|lo
comma
r_int
id|hi
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
r_int
id|addr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|addr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|voice
comma
id|hi
)paren
)paren
(brace
id|addr
op_assign
(paren
r_int
)paren
id|voices
(braket
id|voice
)braket
dot
id|fx
(braket
id|hi
)braket
suffix:semicolon
id|addr
op_assign
id|addr
op_lshift
l_int|15
suffix:semicolon
)brace
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|voice
comma
id|lo
)paren
)paren
id|addr
op_add_assign
(paren
r_int
)paren
id|voices
(braket
id|voice
)braket
dot
id|fx
(braket
id|lo
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|vp-&gt;mode
op_amp
(paren
id|AWE_SAMPLE_8BITS
op_lshift
l_int|6
)paren
)paren
)paren
id|addr
op_div_assign
l_int|2
suffix:semicolon
r_return
id|addr
suffix:semicolon
)brace
DECL|typedef|fx_affect_func
r_typedef
r_void
(paren
op_star
id|fx_affect_func
)paren
(paren
r_int
id|voice
)paren
suffix:semicolon
DECL|variable|fx_realtime
r_static
id|fx_affect_func
id|fx_realtime
(braket
)braket
op_assign
(brace
multiline_comment|/* env1: delay, attack, hold, decay, release, sustain, pitch, cutoff*/
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
multiline_comment|/* env2: delay, attack, hold, decay, release, sustain */
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
multiline_comment|/* lfo1: delay, freq, volume, pitch, cutoff */
l_int|NULL
comma
id|awe_fx_tremfrq
comma
id|awe_fx_tremfrq
comma
id|awe_fx_fmmod
comma
id|awe_fx_fmmod
comma
multiline_comment|/* lfo2: delay, freq, pitch */
l_int|NULL
comma
id|awe_fx_fm2frq2
comma
id|awe_fx_fm2frq2
comma
multiline_comment|/* global: initpitch, chorus, reverb, cutoff, filterQ */
id|awe_fx_initpitch
comma
l_int|NULL
comma
l_int|NULL
comma
id|awe_fx_cutoff
comma
l_int|NULL
comma
multiline_comment|/* sample: start, loopstart, loopend */
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
)brace
suffix:semicolon
multiline_comment|/*================================================================&n; * turn on/off sample&n; *================================================================*/
r_static
r_void
DECL|function|awe_note_on
id|awe_note_on
c_func
(paren
r_int
id|voice
)paren
(brace
r_int
r_int
id|temp
suffix:semicolon
r_int
id|addr
suffix:semicolon
r_int
r_int
id|tmp2
suffix:semicolon
id|awe_voice_info
op_star
id|vp
suffix:semicolon
multiline_comment|/* A voice sample must assigned before calling */
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
OL
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* channel to be silent and idle */
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|voice
)paren
comma
l_int|0x0080
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|voice
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|voice
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|voice
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_CPF
c_func
(paren
id|voice
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* modulation &amp; volume envelope */
id|awe_poke
c_func
(paren
id|AWE_ENVVAL
c_func
(paren
id|voice
)paren
comma
id|FX_WORD
c_func
(paren
id|voice
comma
id|AWE_FX_ENV1_DELAY
comma
id|vp-&gt;parm.moddelay
)paren
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ATKHLD
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_ENV1_ATTACK
comma
id|AWE_FX_ENV1_HOLD
comma
id|vp-&gt;parm.modatkhld
)paren
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUS
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_ENV1_SUSTAIN
comma
id|AWE_FX_ENV1_DECAY
comma
id|vp-&gt;parm.moddcysus
)paren
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ENVVOL
c_func
(paren
id|voice
)paren
comma
id|FX_WORD
c_func
(paren
id|voice
comma
id|AWE_FX_ENV2_DELAY
comma
id|vp-&gt;parm.voldelay
)paren
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ATKHLDV
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_ENV2_ATTACK
comma
id|AWE_FX_ENV2_HOLD
comma
id|vp-&gt;parm.volatkhld
)paren
)paren
suffix:semicolon
multiline_comment|/* decay/sustain parameter for volume envelope must be set at last */
multiline_comment|/* pitch offset */
id|awe_poke
c_func
(paren
id|AWE_IP
c_func
(paren
id|voice
)paren
comma
id|voices
(braket
id|voice
)braket
dot
id|apitch
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- pitch=%x]&bslash;n&quot;
comma
id|voices
(braket
id|voice
)braket
dot
id|apitch
)paren
)paren
suffix:semicolon
multiline_comment|/* cutoff and volume */
id|tmp2
op_assign
id|FX_BYTE
c_func
(paren
id|voice
comma
id|AWE_FX_CUTOFF
comma
id|vp-&gt;parm.cutoff
)paren
suffix:semicolon
id|tmp2
op_assign
(paren
id|tmp2
op_lshift
l_int|8
)paren
op_or
id|voices
(braket
id|voice
)braket
dot
id|avol
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IFATN
c_func
(paren
id|voice
)paren
comma
id|tmp2
)paren
suffix:semicolon
multiline_comment|/* modulation envelope heights */
id|awe_poke
c_func
(paren
id|AWE_PEFE
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_ENV1_PITCH
comma
id|AWE_FX_ENV1_CUTOFF
comma
id|vp-&gt;parm.pefe
)paren
)paren
suffix:semicolon
multiline_comment|/* lfo1/2 delay */
id|awe_poke
c_func
(paren
id|AWE_LFO1VAL
c_func
(paren
id|voice
)paren
comma
id|FX_WORD
c_func
(paren
id|voice
comma
id|AWE_FX_LFO1_DELAY
comma
id|vp-&gt;parm.lfo1delay
)paren
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_LFO2VAL
c_func
(paren
id|voice
)paren
comma
id|FX_WORD
c_func
(paren
id|voice
comma
id|AWE_FX_LFO2_DELAY
comma
id|vp-&gt;parm.lfo2delay
)paren
)paren
suffix:semicolon
multiline_comment|/* lfo1 pitch &amp; cutoff shift */
id|awe_poke
c_func
(paren
id|AWE_FMMOD
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_LFO1_PITCH
comma
id|AWE_FX_LFO1_CUTOFF
comma
id|vp-&gt;parm.fmmod
)paren
)paren
suffix:semicolon
multiline_comment|/* lfo1 volume &amp; freq */
id|awe_poke
c_func
(paren
id|AWE_TREMFRQ
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_LFO1_VOLUME
comma
id|AWE_FX_LFO1_FREQ
comma
id|vp-&gt;parm.tremfrq
)paren
)paren
suffix:semicolon
multiline_comment|/* lfo2 pitch &amp; freq */
id|awe_poke
c_func
(paren
id|AWE_FM2FRQ2
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_LFO2_PITCH
comma
id|AWE_FX_LFO2_FREQ
comma
id|vp-&gt;parm.fm2frq2
)paren
)paren
suffix:semicolon
multiline_comment|/* pan &amp; loop start */
id|awe_set_pan
c_func
(paren
id|voice
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* chorus &amp; loop end (chorus 8bit, MSB) */
id|addr
op_assign
id|vp-&gt;loopend
op_minus
l_int|1
suffix:semicolon
id|addr
op_add_assign
id|FX_OFFSET
c_func
(paren
id|voice
comma
id|AWE_FX_LOOP_END
comma
id|AWE_FX_COARSE_LOOP_END
)paren
suffix:semicolon
id|temp
op_assign
id|FX_BYTE
c_func
(paren
id|voice
comma
id|AWE_FX_CHORUS
comma
id|vp-&gt;parm.chorus
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_lshift
l_int|24
)paren
op_or
(paren
r_int
r_int
)paren
id|addr
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
id|voice
)paren
comma
id|temp
)paren
suffix:semicolon
multiline_comment|/* Q &amp; current address (Q 4bit value, MSB) */
id|addr
op_assign
id|vp-&gt;start
op_minus
l_int|1
suffix:semicolon
id|addr
op_add_assign
id|FX_OFFSET
c_func
(paren
id|voice
comma
id|AWE_FX_SAMPLE_START
comma
id|AWE_FX_COARSE_SAMPLE_START
)paren
suffix:semicolon
id|temp
op_assign
id|FX_BYTE
c_func
(paren
id|voice
comma
id|AWE_FX_FILTERQ
comma
id|vp-&gt;parm.filterQ
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_lshift
l_int|28
)paren
op_or
(paren
r_int
r_int
)paren
id|addr
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|voice
)paren
comma
id|temp
)paren
suffix:semicolon
multiline_comment|/* reset volume */
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|voice
)paren
comma
l_int|0x0000FFFF
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|voice
)paren
comma
l_int|0x0000FFFF
)paren
suffix:semicolon
multiline_comment|/* turn on envelope */
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_ENV2_SUSTAIN
comma
id|AWE_FX_ENV2_DECAY
comma
id|vp-&gt;parm.voldcysus
)paren
)paren
suffix:semicolon
multiline_comment|/* set chorus */
id|temp
op_assign
id|FX_BYTE
c_func
(paren
id|voice
comma
id|AWE_FX_REVERB
comma
id|vp-&gt;parm.reverb
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|awe_peek_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|voice
)paren
)paren
op_amp
l_int|0xffff0000
)paren
op_or
(paren
id|temp
op_lshift
l_int|8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|voice
)paren
comma
id|temp
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
id|voice
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- start=%x loop=%x]&bslash;n&quot;
comma
(paren
r_int
)paren
id|vp-&gt;start
comma
(paren
r_int
)paren
id|vp-&gt;loopstart
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* turn off the voice */
r_static
r_void
DECL|function|awe_note_off
id|awe_note_off
c_func
(paren
r_int
id|voice
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
op_logical_neg
id|voices
(braket
id|voice
)braket
dot
id|state
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|voice
comma
id|AWE_FX_ENV1_RELEASE
)paren
)paren
id|tmp
op_assign
l_int|0x8000
op_or
id|voices
(braket
id|voice
)braket
dot
id|fx
(braket
id|AWE_FX_ENV1_RELEASE
)braket
suffix:semicolon
r_else
id|tmp
op_assign
id|vp-&gt;parm.modrelease
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUS
c_func
(paren
id|voice
)paren
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|voice
comma
id|AWE_FX_ENV2_RELEASE
)paren
)paren
id|tmp
op_assign
l_int|0x8000
op_or
id|voices
(braket
id|voice
)braket
dot
id|fx
(braket
id|AWE_FX_ENV2_RELEASE
)braket
suffix:semicolon
r_else
id|tmp
op_assign
id|vp-&gt;parm.volrelease
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|voice
)paren
comma
id|tmp
)paren
suffix:semicolon
)brace
multiline_comment|/* force to terminate the voice (no releasing echo) */
r_static
r_void
DECL|function|awe_terminate
id|awe_terminate
c_func
(paren
r_int
id|voice
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|voice
)paren
comma
l_int|0x807F
)paren
suffix:semicolon
)brace
multiline_comment|/* turn off other voices with the same exclusive class (for drums) */
r_static
r_void
DECL|function|awe_exclusive_off
id|awe_exclusive_off
c_func
(paren
r_int
id|voice
)paren
(brace
r_int
id|i
comma
id|excls
suffix:semicolon
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|sample
op_eq
l_int|NULL
)paren
multiline_comment|/* no sample */
r_return
suffix:semicolon
id|excls
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample-&gt;exclusiveClass
suffix:semicolon
r_if
c_cond
(paren
id|excls
op_eq
l_int|0
)paren
multiline_comment|/* not exclusive */
r_return
suffix:semicolon
multiline_comment|/* turn off voices with the same class */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|awe_max_voices
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_ne
id|voice
op_logical_and
id|voices
(braket
id|voice
)braket
dot
id|state
op_logical_and
id|voices
(braket
id|i
)braket
dot
id|sample
op_logical_and
id|voices
(braket
id|i
)braket
dot
id|sample-&gt;exclusiveClass
op_eq
id|excls
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [exoff(%d)]&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
id|awe_note_off
c_func
(paren
id|i
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|i
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*================================================================&n; * change the parameters of an audible voice&n; *================================================================*/
multiline_comment|/* change pitch */
r_static
r_void
DECL|function|awe_set_pitch
id|awe_set_pitch
c_func
(paren
r_int
id|voice
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|voices
(braket
id|voice
)braket
dot
id|state
)paren
r_return
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IP
c_func
(paren
id|voice
)paren
comma
id|voices
(braket
id|voice
)braket
dot
id|apitch
)paren
suffix:semicolon
)brace
multiline_comment|/* change volume */
r_static
r_void
DECL|function|awe_set_volume
id|awe_set_volume
c_func
(paren
r_int
id|voice
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
r_int
r_int
id|tmp2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voices
(braket
id|voice
)braket
dot
id|state
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
OL
l_int|0
)paren
r_return
suffix:semicolon
id|tmp2
op_assign
id|FX_BYTE
c_func
(paren
id|voice
comma
id|AWE_FX_CUTOFF
comma
id|vp-&gt;parm.cutoff
)paren
suffix:semicolon
id|tmp2
op_assign
(paren
id|tmp2
op_lshift
l_int|8
)paren
op_or
id|voices
(braket
id|voice
)braket
dot
id|avol
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IFATN
c_func
(paren
id|voice
)paren
comma
id|tmp2
)paren
suffix:semicolon
)brace
multiline_comment|/* change pan; this could make a click noise.. */
r_static
r_void
DECL|function|awe_set_pan
id|awe_set_pan
c_func
(paren
r_int
id|voice
comma
r_int
id|forced
)paren
(brace
r_int
r_int
id|temp
suffix:semicolon
r_int
id|addr
suffix:semicolon
id|awe_voice_info
op_star
id|vp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voices
(braket
id|voice
)braket
dot
id|state
op_logical_and
op_logical_neg
id|forced
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
OL
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* pan &amp; loop start (pan 8bit, MSB, 0:right, 0xff:left) */
r_if
c_cond
(paren
id|vp-&gt;fixpan
OG
l_int|0
)paren
multiline_comment|/* 0-127 */
id|temp
op_assign
l_int|255
op_minus
(paren
r_int
)paren
id|vp-&gt;fixpan
op_star
l_int|2
suffix:semicolon
r_else
(brace
r_int
id|pos
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;pan
op_ge
l_int|0
)paren
multiline_comment|/* 0-127 */
id|pos
op_assign
(paren
r_int
)paren
id|vp-&gt;pan
op_star
l_int|2
op_minus
l_int|128
suffix:semicolon
id|pos
op_add_assign
id|voices
(braket
id|voice
)braket
dot
id|panning
suffix:semicolon
multiline_comment|/* -128 - 127 */
id|pos
op_assign
l_int|127
op_minus
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
l_int|0
)paren
id|temp
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pos
OG
l_int|255
)paren
id|temp
op_assign
l_int|255
suffix:semicolon
r_else
id|temp
op_assign
id|pos
suffix:semicolon
)brace
id|addr
op_assign
id|vp-&gt;loopstart
op_minus
l_int|1
suffix:semicolon
id|addr
op_add_assign
id|FX_OFFSET
c_func
(paren
id|voice
comma
id|AWE_FX_LOOP_START
comma
id|AWE_FX_COARSE_LOOP_START
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_lshift
l_int|24
)paren
op_or
(paren
r_int
r_int
)paren
id|addr
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
id|voice
)paren
comma
id|temp
)paren
suffix:semicolon
)brace
multiline_comment|/* effects change during playing */
r_static
r_void
DECL|function|awe_fx_fmmod
id|awe_fx_fmmod
c_func
(paren
r_int
id|voice
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voices
(braket
id|voice
)braket
dot
id|state
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
OL
l_int|0
)paren
r_return
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FMMOD
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_LFO1_PITCH
comma
id|AWE_FX_LFO1_CUTOFF
comma
id|vp-&gt;parm.fmmod
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_fx_tremfrq
id|awe_fx_tremfrq
c_func
(paren
r_int
id|voice
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voices
(braket
id|voice
)braket
dot
id|state
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
OL
l_int|0
)paren
r_return
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_TREMFRQ
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_LFO1_VOLUME
comma
id|AWE_FX_LFO1_FREQ
comma
id|vp-&gt;parm.tremfrq
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_fx_fm2frq2
id|awe_fx_fm2frq2
c_func
(paren
r_int
id|voice
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voices
(braket
id|voice
)braket
dot
id|state
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
OL
l_int|0
)paren
r_return
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FM2FRQ2
c_func
(paren
id|voice
)paren
comma
id|FX_COMB
c_func
(paren
id|voice
comma
id|AWE_FX_LFO2_PITCH
comma
id|AWE_FX_LFO2_FREQ
comma
id|vp-&gt;parm.fm2frq2
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_fx_cutoff
id|awe_fx_cutoff
c_func
(paren
r_int
id|voice
)paren
(brace
r_int
r_int
id|tmp2
suffix:semicolon
id|awe_voice_info
op_star
id|vp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voices
(braket
id|voice
)braket
dot
id|state
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
op_logical_or
id|vp-&gt;index
OL
l_int|0
)paren
r_return
suffix:semicolon
id|tmp2
op_assign
id|FX_BYTE
c_func
(paren
id|voice
comma
id|AWE_FX_CUTOFF
comma
id|vp-&gt;parm.cutoff
)paren
suffix:semicolon
id|tmp2
op_assign
(paren
id|tmp2
op_lshift
l_int|8
)paren
op_or
id|voices
(braket
id|voice
)braket
dot
id|avol
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IFATN
c_func
(paren
id|voice
)paren
comma
id|tmp2
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_fx_initpitch
id|awe_fx_initpitch
c_func
(paren
r_int
id|voice
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|voices
(braket
id|voice
)braket
dot
id|state
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|voice
comma
id|AWE_FX_INIT_PITCH
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: initpitch ok&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: BAD initpitch %d&bslash;n&quot;
comma
id|AWE_FX_INIT_PITCH
)paren
)paren
suffix:semicolon
)brace
id|awe_calc_pitch
c_func
(paren
id|voice
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IP
c_func
(paren
id|voice
)paren
comma
id|voices
(braket
id|voice
)braket
dot
id|apitch
)paren
suffix:semicolon
)brace
multiline_comment|/*================================================================&n; * calculate pitch offset&n; *----------------------------------------------------------------&n; * 0xE000 is no pitch offset at 44100Hz sample.&n; * Every 4096 is one octave.&n; *================================================================*/
r_static
r_void
DECL|function|awe_calc_pitch
id|awe_calc_pitch
c_func
(paren
r_int
id|voice
)paren
(brace
id|voice_info
op_star
id|vp
op_assign
op_amp
id|voices
(braket
id|voice
)braket
suffix:semicolon
id|awe_voice_info
op_star
id|ap
suffix:semicolon
r_int
id|offset
suffix:semicolon
multiline_comment|/* search voice information */
r_if
c_cond
(paren
(paren
id|ap
op_assign
id|vp-&gt;sample
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;index
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|awe_set_sample
c_func
(paren
id|ap
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* calculate offset */
r_if
c_cond
(paren
id|ap-&gt;fixkey
op_ge
l_int|0
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; fixkey(%d) tune(%d)&bslash;n&quot;
comma
id|ap-&gt;fixkey
comma
id|ap-&gt;tune
)paren
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|ap-&gt;fixkey
op_minus
id|ap-&gt;root
)paren
op_star
l_int|4096
op_div
l_int|12
suffix:semicolon
)brace
r_else
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p(%d)-&gt; root(%d) tune(%d)&bslash;n&quot;
comma
id|vp-&gt;note
comma
id|ap-&gt;root
comma
id|ap-&gt;tune
)paren
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|vp-&gt;note
op_minus
id|ap-&gt;root
)paren
op_star
l_int|4096
op_div
l_int|12
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; ofs=%d&bslash;n&quot;
comma
id|offset
)paren
)paren
suffix:semicolon
)brace
id|offset
op_add_assign
id|ap-&gt;tune
op_star
l_int|4096
op_div
l_int|1200
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; tune+ ofs=%d&bslash;n&quot;
comma
id|offset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;bender
op_ne
l_int|0
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; bend(%d) %d&bslash;n&quot;
comma
id|voice
comma
id|vp-&gt;bender
)paren
)paren
suffix:semicolon
multiline_comment|/* (819200: 1 semitone) ==&gt; (4096: 12 semitones) */
id|offset
op_add_assign
id|vp-&gt;bender
op_star
id|vp-&gt;bender_range
op_div
l_int|2400
suffix:semicolon
)brace
id|offset
op_assign
(paren
id|offset
op_star
id|ap-&gt;scaleTuning
)paren
op_div
l_int|100
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; scale* ofs=%d&bslash;n&quot;
comma
id|offset
)paren
)paren
suffix:semicolon
multiline_comment|/* add initial pitch correction */
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|voice
comma
id|AWE_FX_INIT_PITCH
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: fx_pitch(%d) %d&bslash;n&quot;
comma
id|voice
comma
id|vp-&gt;fx
(braket
id|AWE_FX_INIT_PITCH
)braket
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
id|vp-&gt;fx
(braket
id|AWE_FX_INIT_PITCH
)braket
suffix:semicolon
)brace
multiline_comment|/* 0xe000: root pitch */
id|vp-&gt;apitch
op_assign
l_int|0xe000
op_plus
id|ap-&gt;rate_offset
op_plus
id|offset
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: p-&gt; sum aofs=%x, rate_ofs=%d&bslash;n&quot;
comma
id|vp-&gt;apitch
comma
id|ap-&gt;rate_offset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;apitch
OG
l_int|0xffff
)paren
id|vp-&gt;apitch
op_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;apitch
OL
l_int|0
)paren
id|vp-&gt;apitch
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|awe_calc_pitch_from_freq
id|awe_calc_pitch_from_freq
c_func
(paren
r_int
id|voice
comma
r_int
id|freq
)paren
(brace
id|voice_info
op_star
id|vp
op_assign
op_amp
id|voices
(braket
id|voice
)braket
suffix:semicolon
id|awe_voice_info
op_star
id|ap
suffix:semicolon
r_int
id|offset
suffix:semicolon
r_int
id|note
suffix:semicolon
multiline_comment|/* search voice information */
r_if
c_cond
(paren
(paren
id|ap
op_assign
id|vp-&gt;sample
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;index
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|awe_set_sample
c_func
(paren
id|ap
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
)brace
id|note
op_assign
id|freq_to_note
c_func
(paren
id|freq
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|note
op_minus
id|ap-&gt;root
op_star
l_int|100
op_plus
id|ap-&gt;tune
)paren
op_star
l_int|4096
op_div
l_int|1200
suffix:semicolon
id|offset
op_assign
(paren
id|offset
op_star
id|ap-&gt;scaleTuning
)paren
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|FX_ON
c_func
(paren
id|voice
comma
id|AWE_FX_INIT_PITCH
)paren
)paren
id|offset
op_add_assign
id|vp-&gt;fx
(braket
id|AWE_FX_INIT_PITCH
)braket
suffix:semicolon
id|vp-&gt;apitch
op_assign
l_int|0xe000
op_plus
id|ap-&gt;rate_offset
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;apitch
OG
l_int|0xffff
)paren
id|vp-&gt;apitch
op_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;apitch
OL
l_int|0
)paren
id|vp-&gt;apitch
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*================================================================&n; * calculate volume attenuation&n; *----------------------------------------------------------------&n; * Voice volume is controlled by volume attenuation parameter.&n; * So volume becomes maximum when avol is 0 (no attenuation), and&n; * minimum when 255 (-96dB or silence).&n; *================================================================*/
DECL|variable|vol_table
r_static
r_int
id|vol_table
(braket
l_int|128
)braket
op_assign
(brace
l_int|255
comma
l_int|111
comma
l_int|95
comma
l_int|86
comma
l_int|79
comma
l_int|74
comma
l_int|70
comma
l_int|66
comma
l_int|63
comma
l_int|61
comma
l_int|58
comma
l_int|56
comma
l_int|54
comma
l_int|52
comma
l_int|50
comma
l_int|49
comma
l_int|47
comma
l_int|46
comma
l_int|45
comma
l_int|43
comma
l_int|42
comma
l_int|41
comma
l_int|40
comma
l_int|39
comma
l_int|38
comma
l_int|37
comma
l_int|36
comma
l_int|35
comma
l_int|34
comma
l_int|34
comma
l_int|33
comma
l_int|32
comma
l_int|31
comma
l_int|31
comma
l_int|30
comma
l_int|29
comma
l_int|29
comma
l_int|28
comma
l_int|27
comma
l_int|27
comma
l_int|26
comma
l_int|26
comma
l_int|25
comma
l_int|24
comma
l_int|24
comma
l_int|23
comma
l_int|23
comma
l_int|22
comma
l_int|22
comma
l_int|21
comma
l_int|21
comma
l_int|21
comma
l_int|20
comma
l_int|20
comma
l_int|19
comma
l_int|19
comma
l_int|18
comma
l_int|18
comma
l_int|18
comma
l_int|17
comma
l_int|17
comma
l_int|16
comma
l_int|16
comma
l_int|16
comma
l_int|15
comma
l_int|15
comma
l_int|15
comma
l_int|14
comma
l_int|14
comma
l_int|14
comma
l_int|13
comma
l_int|13
comma
l_int|13
comma
l_int|12
comma
l_int|12
comma
l_int|12
comma
l_int|11
comma
l_int|11
comma
l_int|11
comma
l_int|10
comma
l_int|10
comma
l_int|10
comma
l_int|10
comma
l_int|9
comma
l_int|9
comma
l_int|9
comma
l_int|8
comma
l_int|8
comma
l_int|8
comma
l_int|8
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|7
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|6
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
suffix:semicolon
r_static
r_void
DECL|function|awe_calc_volume
id|awe_calc_volume
c_func
(paren
r_int
id|voice
)paren
(brace
id|voice_info
op_star
id|vp
op_assign
op_amp
id|voices
(braket
id|voice
)braket
suffix:semicolon
id|awe_voice_info
op_star
id|ap
suffix:semicolon
r_int
id|vol
suffix:semicolon
multiline_comment|/* search voice information */
r_if
c_cond
(paren
(paren
id|ap
op_assign
id|vp-&gt;sample
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|ap
op_assign
id|vp-&gt;sample
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;index
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|awe_set_sample
c_func
(paren
id|ap
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vp-&gt;velocity
OL
id|ap-&gt;vellow
)paren
id|vp-&gt;velocity
op_assign
id|ap-&gt;vellow
suffix:semicolon
r_else
r_if
c_cond
(paren
id|vp-&gt;velocity
OG
id|ap-&gt;velhigh
)paren
id|vp-&gt;velocity
op_assign
id|ap-&gt;velhigh
suffix:semicolon
multiline_comment|/* 0 - 127 */
id|vol
op_assign
(paren
id|vp-&gt;velocity
op_star
id|vp-&gt;main_vol
op_star
id|vp-&gt;expression_vol
)paren
op_div
(paren
l_int|127
op_star
l_int|127
)paren
suffix:semicolon
id|vol
op_assign
id|vol
op_star
id|ap-&gt;amplitude
op_div
l_int|127
suffix:semicolon
r_if
c_cond
(paren
id|vol
OL
l_int|0
)paren
id|vol
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vol
OG
l_int|127
)paren
id|vol
op_assign
l_int|127
suffix:semicolon
multiline_comment|/* calc to attenuation */
id|vol
op_assign
id|vol_table
(braket
id|vol
)braket
suffix:semicolon
id|vol
op_assign
id|vol
op_plus
(paren
r_int
)paren
id|ap-&gt;attenuation
op_plus
id|init_atten
suffix:semicolon
r_if
c_cond
(paren
id|vol
OG
l_int|255
)paren
id|vol
op_assign
l_int|255
suffix:semicolon
id|vp-&gt;avol
op_assign
id|vol
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- voice(%d) vol=%x]&bslash;n&quot;
comma
id|voice
comma
id|vol
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*================================================================&n; * synth operation routines&n; *================================================================*/
multiline_comment|/* initialize the voice */
r_static
r_void
DECL|function|awe_voice_init
id|awe_voice_init
c_func
(paren
r_int
id|voice
comma
r_int
id|inst_only
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|inst_only
)paren
(brace
multiline_comment|/* clear voice parameters */
id|voices
(braket
id|voice
)braket
dot
id|note
op_assign
op_minus
l_int|1
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|velocity
op_assign
l_int|0
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|panning
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* zero center */
id|voices
(braket
id|voice
)braket
dot
id|bender
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* zero tune skew */
id|voices
(braket
id|voice
)braket
dot
id|bender_range
op_assign
l_int|200
suffix:semicolon
multiline_comment|/* sense * 100 */
id|voices
(braket
id|voice
)braket
dot
id|main_vol
op_assign
l_int|127
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|expression_vol
op_assign
l_int|127
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|bank
op_assign
id|AWE_DEFAULT_BANK
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|instr
op_assign
op_minus
l_int|1
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|vrec
op_assign
l_int|NULL
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|sample
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* clear voice mapping */
id|voices
(braket
id|voice
)braket
dot
id|state
op_assign
l_int|0
suffix:semicolon
id|voice_alloc-&gt;map
(braket
id|voice
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* emu8000 parameters */
id|voices
(braket
id|voice
)braket
dot
id|apitch
op_assign
l_int|0
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|avol
op_assign
l_int|255
suffix:semicolon
multiline_comment|/* clear effects */
id|BZERO
c_func
(paren
id|voices
(braket
id|voice
)braket
dot
id|fx_flags
comma
r_sizeof
(paren
id|voices
(braket
id|voice
)braket
dot
id|fx_flags
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------&n; * device open / close&n; *----------------------------------------------------------------*/
multiline_comment|/* open device:&n; *   reset status of all voices, and clear sample position flag&n; */
r_static
r_int
DECL|function|awe_open
id|awe_open
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
(brace
r_if
c_cond
(paren
id|awe_busy
)paren
r_return
id|RET_ERROR
c_func
(paren
id|EBUSY
)paren
suffix:semicolon
id|awe_busy
op_assign
l_int|1
suffix:semicolon
id|awe_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* clear sample position flag */
id|loaded_once
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set GUS bank to default */
id|awe_gus_bank
op_assign
id|AWE_DEFAULT_BANK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* close device:&n; *   reset all voices again (terminate sounds)&n; */
r_static
r_void
DECL|function|awe_close
id|awe_close
c_func
(paren
r_int
id|dev
)paren
(brace
id|awe_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|awe_busy
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* sequencer I/O control:&n; */
r_static
r_int
DECL|function|awe_ioctl
id|awe_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDCTL_SYNTH_INFO
suffix:colon
id|awe_info.nr_voices
op_assign
id|awe_max_voices
suffix:semicolon
id|IOCTL_TO_USER
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
comma
l_int|0
comma
op_amp
id|awe_info
comma
r_sizeof
(paren
id|awe_info
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_SEQ_RESETSAMPLES
suffix:colon
id|awe_reset_samples
c_func
(paren
)paren
suffix:semicolon
id|awe_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* better to reset emu8k chip... */
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_SEQ_PERCMODE
suffix:colon
multiline_comment|/* what&squot;s this? */
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_SYNTH_MEMAVL
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [ioctl memavl = %d]&bslash;n&quot;
comma
(paren
r_int
)paren
id|free_mem_ptr
)paren
)paren
suffix:semicolon
r_return
id|awe_mem_size
op_minus
id|free_mem_ptr
op_star
l_int|2
suffix:semicolon
r_default
suffix:colon
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32: unsupported ioctl %d&bslash;n&quot;
comma
id|cmd
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* kill a voice:&n; *   not terminate, just release the voice.&n; */
r_static
r_int
DECL|function|awe_kill_note
id|awe_kill_note
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|note
comma
r_int
id|velocity
)paren
(brace
id|awe_voice_info
op_star
id|vp
suffix:semicolon
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [off(%d)]&bslash;n&quot;
comma
id|voice
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|awe_max_voices
)paren
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vp
op_assign
id|voices
(braket
id|voice
)braket
dot
id|sample
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|vp-&gt;mode
op_amp
id|AWE_MODE_NORELEASE
)paren
)paren
(brace
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_note_off
c_func
(paren
id|voice
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|awe_voice_init
c_func
(paren
id|voice
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* search the note with the specified key range */
r_static
id|awe_voice_info
op_star
DECL|function|awe_search_voice
id|awe_search_voice
c_func
(paren
r_int
id|voice
comma
r_int
id|note
)paren
(brace
id|awe_voice_list
op_star
id|rec
suffix:semicolon
r_int
id|maxc
suffix:semicolon
r_for
c_loop
(paren
id|rec
op_assign
id|voices
(braket
id|voice
)braket
dot
id|vrec
comma
id|maxc
op_assign
id|AWE_MAX_INFOS
suffix:semicolon
id|rec
op_logical_and
id|maxc
suffix:semicolon
id|rec
op_assign
id|rec-&gt;next_instr
comma
id|maxc
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|rec-&gt;v.low
op_le
id|note
op_logical_and
id|note
op_le
id|rec-&gt;v.high
)paren
r_return
op_amp
id|rec-&gt;v
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* start a voice:&n; *   if note is 255, identical with aftertouch function.&n; *   Otherwise, start a voice with specified not and volume.&n; */
r_static
r_int
DECL|function|awe_start_note
id|awe_start_note
c_func
(paren
r_int
id|dev
comma
r_int
id|v
comma
r_int
id|note_num
comma
r_int
id|volume
)paren
(brace
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [on(%d) nt=%d vl=%d]&bslash;n&quot;
comma
id|v
comma
id|note_num
comma
id|volume
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
OL
l_int|0
op_logical_or
id|v
op_ge
id|awe_max_voices
)paren
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
multiline_comment|/* an instrument must be set before starting a note */
r_if
c_cond
(paren
id|voices
(braket
id|v
)braket
dot
id|vrec
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- vrec is null]&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|note_num
op_eq
l_int|255
)paren
(brace
multiline_comment|/* dynamic volume change; sample is already assigned */
r_if
c_cond
(paren
op_logical_neg
id|voices
(braket
id|v
)braket
dot
id|state
op_logical_or
id|voices
(braket
id|v
)braket
dot
id|sample
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* calculate volume parameter */
id|voices
(braket
id|v
)braket
dot
id|velocity
op_assign
id|volume
suffix:semicolon
id|awe_calc_volume
c_func
(paren
id|v
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_set_volume
c_func
(paren
id|v
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* assign a sample with the corresponding note */
r_if
c_cond
(paren
(paren
id|voices
(braket
id|v
)braket
dot
id|sample
op_assign
id|awe_search_voice
c_func
(paren
id|v
comma
id|note_num
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [-- sample is null]&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* calculate pitch &amp; volume parameters */
id|voices
(braket
id|v
)braket
dot
id|note
op_assign
id|note_num
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|velocity
op_assign
id|volume
suffix:semicolon
id|awe_calc_pitch
c_func
(paren
id|v
)paren
suffix:semicolon
id|awe_calc_volume
c_func
(paren
id|v
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* turn off other voices (for drums) */
id|awe_exclusive_off
c_func
(paren
id|v
)paren
suffix:semicolon
multiline_comment|/* turn on the voice */
id|awe_note_on
c_func
(paren
id|v
)paren
suffix:semicolon
id|voices
(braket
id|v
)braket
dot
id|state
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* flag up */
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* search instrument from preset table with the specified bank */
r_static
id|awe_voice_list
op_star
DECL|function|awe_search_instr
id|awe_search_instr
c_func
(paren
r_int
id|bank
comma
r_int
id|preset
)paren
(brace
id|awe_voice_list
op_star
id|p
suffix:semicolon
r_int
id|maxc
suffix:semicolon
r_for
c_loop
(paren
id|maxc
op_assign
id|AWE_MAX_INFOS
comma
id|p
op_assign
id|preset_table
(braket
id|preset
)braket
suffix:semicolon
id|p
op_logical_and
id|maxc
suffix:semicolon
id|p
op_assign
id|p-&gt;next_bank
comma
id|maxc
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;bank
op_eq
id|bank
)paren
r_return
id|p
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* assign the instrument to a voice */
r_static
r_int
DECL|function|awe_set_instr
id|awe_set_instr
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|instr_no
)paren
(brace
id|awe_voice_list
op_star
id|rec
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|awe_max_voices
)paren
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|instr_no
OL
l_int|0
op_logical_or
id|instr_no
op_ge
id|AWE_MAX_PRESETS
)paren
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rec
op_assign
id|awe_search_instr
c_func
(paren
id|voices
(braket
id|voice
)braket
dot
id|bank
comma
id|instr_no
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* if bank is not defined, use the default bank 0 */
r_if
c_cond
(paren
id|voices
(braket
id|voice
)braket
dot
id|bank
op_ne
id|AWE_DEFAULT_BANK
op_logical_and
(paren
id|rec
op_assign
id|awe_search_instr
c_func
(paren
id|AWE_DEFAULT_BANK
comma
id|instr_no
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
id|printk
c_func
(paren
l_string|&quot;AWE32 Warning: can&squot;t find instrument %d&bslash;n&quot;
comma
id|instr_no
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|voices
(braket
id|voice
)braket
dot
id|instr
op_assign
id|instr_no
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|vrec
op_assign
id|rec
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|sample
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* not set yet */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* reset all voices; terminate sounds and initialize parameters */
r_static
r_void
DECL|function|awe_reset
id|awe_reset
c_func
(paren
r_int
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* don&squot;t turn off voice 31 and 32.  they are used also for FM voices */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|awe_terminate
c_func
(paren
id|i
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|i
comma
l_int|0
)paren
suffix:semicolon
)brace
id|awe_init_fm
c_func
(paren
)paren
suffix:semicolon
id|awe_tweak
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* hardware specific control:&n; *   GUS specific and AWE32 specific controls are available.&n; */
r_static
r_void
DECL|function|awe_hw_control
id|awe_hw_control
c_func
(paren
r_int
id|dev
comma
r_int
r_char
op_star
id|event
)paren
(brace
r_int
id|cmd
op_assign
id|event
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_amp
id|_AWE_MODE_FLAG
)paren
id|awe_hw_awe_control
c_func
(paren
id|dev
comma
id|cmd
op_amp
id|_AWE_MODE_VALUE_MASK
comma
id|event
)paren
suffix:semicolon
r_else
id|awe_hw_gus_control
c_func
(paren
id|dev
comma
id|cmd
op_amp
id|_AWE_MODE_VALUE_MASK
comma
id|event
)paren
suffix:semicolon
)brace
multiline_comment|/* GUS compatible controls */
r_static
r_void
DECL|function|awe_hw_gus_control
id|awe_hw_gus_control
c_func
(paren
r_int
id|dev
comma
r_int
id|cmd
comma
r_int
r_char
op_star
id|event
)paren
(brace
r_int
id|voice
suffix:semicolon
r_int
r_int
id|p1
suffix:semicolon
r_int
id|p2
suffix:semicolon
r_int
id|plong
suffix:semicolon
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
id|voice
op_assign
id|event
(braket
l_int|3
)braket
suffix:semicolon
id|p1
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|4
)braket
suffix:semicolon
id|p2
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|6
)braket
suffix:semicolon
id|plong
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|4
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|_GUS_NUMVOICES
suffix:colon
r_if
c_cond
(paren
id|p1
op_ge
id|awe_max_voices
)paren
id|printk
c_func
(paren
l_string|&quot;AWE32: num_voices: voices out of range %d&bslash;n&quot;
comma
id|p1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_GUS_VOICESAMPLE
suffix:colon
r_if
c_cond
(paren
id|voice
OL
id|awe_max_voices
)paren
id|awe_set_instr
c_func
(paren
id|dev
comma
id|voice
comma
id|p1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_GUS_VOICEON
suffix:colon
r_if
c_cond
(paren
id|voice
OL
id|awe_max_voices
)paren
(brace
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_note_on
c_func
(paren
id|voice
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_GUS_VOICEOFF
suffix:colon
r_if
c_cond
(paren
id|voice
OL
id|awe_max_voices
)paren
(brace
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_note_off
c_func
(paren
id|voice
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_GUS_VOICEMODE
suffix:colon
multiline_comment|/* not supported */
r_break
suffix:semicolon
r_case
id|_GUS_VOICEBALA
suffix:colon
multiline_comment|/* -128 to 127 */
r_if
c_cond
(paren
id|voice
OL
id|awe_max_voices
)paren
id|awe_panning
c_func
(paren
id|dev
comma
id|voice
comma
(paren
r_int
)paren
id|p1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_GUS_VOICEFREQ
suffix:colon
r_if
c_cond
(paren
id|voice
OL
id|awe_max_voices
)paren
id|awe_calc_pitch_from_freq
c_func
(paren
id|voice
comma
id|plong
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_GUS_VOICEVOL
suffix:colon
r_case
id|_GUS_VOICEVOL2
suffix:colon
multiline_comment|/* not supported yet */
r_break
suffix:semicolon
r_case
id|_GUS_RAMPRANGE
suffix:colon
r_case
id|_GUS_RAMPRATE
suffix:colon
r_case
id|_GUS_RAMPMODE
suffix:colon
r_case
id|_GUS_RAMPON
suffix:colon
r_case
id|_GUS_RAMPOFF
suffix:colon
multiline_comment|/* volume ramping not supported */
r_break
suffix:semicolon
r_case
id|_GUS_VOLUME_SCALE
suffix:colon
r_break
suffix:semicolon
r_case
id|_GUS_VOICE_POS
suffix:colon
r_if
c_cond
(paren
id|voice
OL
id|awe_max_voices
)paren
(brace
id|FX_SET
c_func
(paren
id|voice
comma
id|AWE_FX_SAMPLE_START
comma
(paren
r_int
)paren
(paren
id|plong
op_amp
l_int|0x7fff
)paren
)paren
suffix:semicolon
id|FX_SET
c_func
(paren
id|voice
comma
id|AWE_FX_COARSE_SAMPLE_START
comma
(paren
id|plong
op_rshift
l_int|15
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* AWE32 specific controls */
r_static
r_void
DECL|function|awe_hw_awe_control
id|awe_hw_awe_control
c_func
(paren
r_int
id|dev
comma
r_int
id|cmd
comma
r_int
r_char
op_star
id|event
)paren
(brace
r_int
id|voice
suffix:semicolon
r_int
r_int
id|p1
suffix:semicolon
r_int
id|p2
suffix:semicolon
r_int
id|chn
suffix:semicolon
id|chn
op_assign
id|event
(braket
l_int|1
)braket
suffix:semicolon
id|voice
op_assign
id|event
(braket
l_int|3
)braket
suffix:semicolon
id|p1
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|4
)braket
suffix:semicolon
id|p2
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|event
(braket
l_int|6
)braket
suffix:semicolon
macro_line|#ifdef AWE_DEBUG_ON
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|_AWE_DEBUG_MODE
suffix:colon
id|debug_mode
op_assign
id|p1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;AWE32: debug mode = %d&bslash;n&quot;
comma
id|debug_mode
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|_AWE_REVERB_MODE
suffix:colon
r_if
c_cond
(paren
id|p1
op_le
l_int|7
)paren
(brace
id|reverb_mode
op_assign
id|p1
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: reverb mode %d&bslash;n&quot;
comma
id|reverb_mode
)paren
)paren
suffix:semicolon
id|awe_set_reverb_mode
c_func
(paren
id|reverb_mode
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_AWE_CHORUS_MODE
suffix:colon
r_if
c_cond
(paren
id|p1
op_le
l_int|7
)paren
(brace
id|chorus_mode
op_assign
id|p1
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: chorus mode %d&bslash;n&quot;
comma
id|chorus_mode
)paren
)paren
suffix:semicolon
id|awe_set_chorus_mode
c_func
(paren
id|chorus_mode
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_AWE_REMOVE_LAST_SAMPLES
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: remove last samples&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|awe_remove_samples
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_INITIALIZE_CHIP
suffix:colon
id|awe_initialize
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_SEND_EFFECT
suffix:colon
r_if
c_cond
(paren
id|voice
OL
id|awe_max_voices
op_logical_and
id|p1
OL
id|AWE_FX_END
)paren
(brace
id|FX_SET
c_func
(paren
id|voice
comma
id|p1
comma
id|p2
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: effects (%d) %d %d&bslash;n&quot;
comma
id|voice
comma
id|p1
comma
id|voices
(braket
id|voice
)braket
dot
id|fx
(braket
id|p1
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fx_realtime
(braket
id|p1
)braket
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: fx_realtime (%d)&bslash;n&quot;
comma
id|voice
)paren
)paren
suffix:semicolon
id|fx_realtime
(braket
id|p1
)braket
(paren
id|voice
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|_AWE_TERMINATE_CHANNEL
suffix:colon
r_if
c_cond
(paren
id|voice
OL
id|awe_max_voices
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: terminate (%d)&bslash;n&quot;
comma
id|voice
)paren
)paren
suffix:semicolon
id|awe_terminate
c_func
(paren
id|voice
)paren
suffix:semicolon
id|awe_voice_init
c_func
(paren
id|voice
comma
l_int|1
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_AWE_TERMINATE_ALL
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: terminate all&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|awe_reset
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_INITIAL_VOLUME
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: init attenuation %d&bslash;n&quot;
comma
id|p1
)paren
)paren
suffix:semicolon
id|init_atten
op_assign
id|p1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_AWE_SET_GUS_BANK
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: set gus bank %d&bslash;n&quot;
comma
id|p1
)paren
)paren
suffix:semicolon
id|awe_gus_bank
op_assign
id|p1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: hw control cmd=%d voice=%d&bslash;n&quot;
comma
id|cmd
comma
id|voice
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*----------------------------------------------------------------&n; * load a sound patch:&n; *   three types of patches are accepted: AWE, GUS, and SYSEX.&n; *----------------------------------------------------------------*/
r_static
r_int
DECL|function|awe_load_patch
id|awe_load_patch
c_func
(paren
r_int
id|dev
comma
r_int
id|format
comma
r_const
r_char
op_star
id|addr
comma
r_int
id|offs
comma
r_int
id|count
comma
r_int
id|pmgr_flag
)paren
(brace
id|awe_patch_info
id|patch
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|format
op_eq
id|GUS_PATCH
)paren
(brace
r_return
id|awe_load_guspatch
c_func
(paren
id|addr
comma
id|offs
comma
id|count
comma
id|pmgr_flag
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|format
op_eq
id|SYSEX_PATCH
)paren
(brace
multiline_comment|/* no system exclusive message supported yet */
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|format
op_ne
id|AWE_PATCH
)paren
(brace
id|FATALERR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: Invalid patch format (key) 0x%x&bslash;n&quot;
comma
id|format
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OL
r_sizeof
(paren
id|awe_patch_info
)paren
)paren
(brace
id|FATALERR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: Patch header too short&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|COPY_FROM_USER
c_func
(paren
(paren
(paren
r_char
op_star
)paren
op_amp
id|patch
)paren
op_plus
id|offs
comma
id|addr
comma
id|offs
comma
r_sizeof
(paren
id|awe_patch_info
)paren
op_minus
id|offs
)paren
suffix:semicolon
id|count
op_sub_assign
r_sizeof
(paren
id|awe_patch_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|patch.len
)paren
(brace
id|FATALERR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Warning: Patch record too short (%d&lt;%d)&bslash;n&quot;
comma
id|count
comma
(paren
r_int
)paren
id|patch.len
)paren
)paren
suffix:semicolon
id|patch.len
op_assign
id|count
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|patch.type
)paren
(brace
r_case
id|AWE_LOAD_INFO
suffix:colon
id|rc
op_assign
id|awe_load_info
c_func
(paren
op_amp
id|patch
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AWE_LOAD_DATA
suffix:colon
id|rc
op_assign
id|awe_load_data
c_func
(paren
op_amp
id|patch
comma
id|addr
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;if (!pmgr_flag &amp;&amp; rc == 0)&n;&t;&t;&t;pmgr_inform(dev, PM_E_PATCH_LOADED, instr, free_sample, 0, 0);&n;&t;&t;*/
r_break
suffix:semicolon
r_default
suffix:colon
id|FATALERR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: unknown patch format type %d&bslash;n&quot;
comma
id|patch.type
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* load voice information data */
r_static
r_int
DECL|function|awe_load_info
id|awe_load_info
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
)paren
(brace
id|awe_voice_list
op_star
id|rec
comma
op_star
id|curp
suffix:semicolon
r_int
id|offset
suffix:semicolon
r_int
id|i
comma
id|nvoices
suffix:semicolon
r_int
r_char
id|bank
comma
id|instr
suffix:semicolon
r_int
id|total_size
suffix:semicolon
r_if
c_cond
(paren
id|patch-&gt;len
OL
r_sizeof
(paren
id|awe_voice_rec
)paren
)paren
(brace
id|FATALERR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: invalid patch info length&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|offset
op_assign
r_sizeof
(paren
id|awe_patch_info
)paren
suffix:semicolon
id|GET_BYTE_FROM_USER
c_func
(paren
id|bank
comma
id|addr
comma
id|offset
)paren
suffix:semicolon
id|offset
op_increment
suffix:semicolon
id|GET_BYTE_FROM_USER
c_func
(paren
id|instr
comma
id|addr
comma
id|offset
)paren
suffix:semicolon
id|offset
op_increment
suffix:semicolon
id|GET_SHORT_FROM_USER
c_func
(paren
id|nvoices
comma
id|addr
comma
id|offset
)paren
suffix:semicolon
id|offset
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|nvoices
op_le
l_int|0
op_logical_or
id|nvoices
op_ge
l_int|100
)paren
(brace
id|FATALERR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: Illegal voice number %d&bslash;n&quot;
comma
id|nvoices
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|free_info
op_plus
id|nvoices
OG
id|AWE_MAX_INFOS
)paren
(brace
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: Too many voice informations&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|ENOSPC
)paren
suffix:semicolon
)brace
id|total_size
op_assign
r_sizeof
(paren
id|awe_voice_rec
)paren
op_plus
r_sizeof
(paren
id|awe_voice_info
)paren
op_star
id|nvoices
suffix:semicolon
r_if
c_cond
(paren
id|patch-&gt;len
OL
id|total_size
)paren
(brace
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: patch length(%d) is smaller than nvoices(%d)&bslash;n&quot;
comma
(paren
r_int
)paren
id|patch-&gt;len
comma
id|nvoices
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|curp
op_assign
id|awe_search_instr
c_func
(paren
id|bank
comma
id|instr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nvoices
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rec
op_assign
op_amp
id|infos
(braket
id|free_info
op_plus
id|i
)braket
suffix:semicolon
id|rec-&gt;bank
op_assign
id|bank
suffix:semicolon
id|rec-&gt;instr
op_assign
id|instr
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|nvoices
op_minus
l_int|1
)paren
id|rec-&gt;next_instr
op_assign
id|rec
op_plus
l_int|1
suffix:semicolon
r_else
id|rec-&gt;next_instr
op_assign
id|curp
suffix:semicolon
id|rec-&gt;next_bank
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* copy awe_voice_info parameters */
id|COPY_FROM_USER
c_func
(paren
op_amp
id|rec-&gt;v
comma
id|addr
comma
id|offset
comma
r_sizeof
(paren
id|awe_voice_info
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
r_sizeof
(paren
id|awe_voice_info
)paren
suffix:semicolon
id|rec-&gt;v.sf_id
op_assign
id|current_sf_id
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;v.mode
op_amp
id|AWE_MODE_INIT_PARM
)paren
id|awe_init_voice_parm
c_func
(paren
op_amp
id|rec-&gt;v.parm
)paren
suffix:semicolon
id|awe_set_sample
c_func
(paren
op_amp
id|rec-&gt;v
)paren
suffix:semicolon
)brace
multiline_comment|/* prepend to top of the list */
id|infos
(braket
id|free_info
)braket
dot
id|next_bank
op_assign
id|preset_table
(braket
id|instr
)braket
suffix:semicolon
id|preset_table
(braket
id|instr
)braket
op_assign
op_amp
id|infos
(braket
id|free_info
)braket
suffix:semicolon
id|free_info
op_add_assign
id|nvoices
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* load wave sample data */
r_static
r_int
DECL|function|awe_load_data
id|awe_load_data
c_func
(paren
id|awe_patch_info
op_star
id|patch
comma
r_const
r_char
op_star
id|addr
)paren
(brace
r_int
id|offset
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|free_sample
op_ge
id|AWE_MAX_SAMPLES
)paren
(brace
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: Sample table full&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|ENOSPC
)paren
suffix:semicolon
)brace
id|size
op_assign
(paren
id|patch-&gt;len
op_minus
r_sizeof
(paren
id|awe_sample_info
)paren
)paren
op_div
l_int|2
suffix:semicolon
id|offset
op_assign
r_sizeof
(paren
id|awe_patch_info
)paren
suffix:semicolon
id|COPY_FROM_USER
c_func
(paren
op_amp
id|samples
(braket
id|free_sample
)braket
comma
id|addr
comma
id|offset
comma
r_sizeof
(paren
id|awe_sample_info
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
r_sizeof
(paren
id|awe_sample_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ne
id|samples
(braket
id|free_sample
)braket
dot
id|size
)paren
(brace
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Warning: sample size differed (%d != %d)&bslash;n&quot;
comma
(paren
r_int
)paren
id|samples
(braket
id|free_sample
)braket
dot
id|size
comma
(paren
r_int
)paren
id|size
)paren
)paren
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|size
op_assign
id|size
suffix:semicolon
)brace
r_if
c_cond
(paren
id|samples
(braket
id|free_sample
)braket
dot
id|size
OG
l_int|0
)paren
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|awe_write_wave_data
c_func
(paren
id|addr
comma
id|offset
comma
id|size
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|rc
suffix:semicolon
id|awe_check_loaded
c_func
(paren
)paren
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|sf_id
op_assign
id|current_sf_id
suffix:semicolon
id|free_sample
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* check the other samples are already loaded */
r_static
r_void
DECL|function|awe_check_loaded
id|awe_check_loaded
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|loaded_once
)paren
(brace
multiline_comment|/* it&squot;s the first time */
id|last_sample
op_assign
id|free_sample
suffix:semicolon
id|last_info
op_assign
id|free_info
suffix:semicolon
id|current_sf_id
op_increment
suffix:semicolon
id|loaded_once
op_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|macro|BLANK_LOOP_START
mdefine_line|#define BLANK_LOOP_START&t;8
DECL|macro|BLANK_LOOP_END
mdefine_line|#define BLANK_LOOP_END&t;&t;40
DECL|macro|BLANK_LOOP_SIZE
mdefine_line|#define BLANK_LOOP_SIZE&t;&t;48
multiline_comment|/* loading onto memory */
r_static
r_int
DECL|function|awe_write_wave_data
id|awe_write_wave_data
c_func
(paren
r_const
r_char
op_star
id|addr
comma
r_int
id|offset
comma
r_int
id|size
)paren
(brace
id|awe_sample_info
op_star
id|sp
op_assign
op_amp
id|samples
(braket
id|free_sample
)braket
suffix:semicolon
r_int
id|i
comma
id|truesize
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_int
r_int
id|csum1
comma
id|csum2
suffix:semicolon
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* be sure loop points start &lt; end */
r_if
c_cond
(paren
id|sp-&gt;loopstart
OG
id|sp-&gt;loopend
)paren
(brace
r_int
id|tmp
op_assign
id|sp-&gt;loopstart
suffix:semicolon
id|sp-&gt;loopstart
op_assign
id|sp-&gt;loopend
suffix:semicolon
id|sp-&gt;loopend
op_assign
id|tmp
suffix:semicolon
)brace
multiline_comment|/* compute true data size to be loaded */
id|truesize
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_BIDIR_LOOP
)paren
id|truesize
op_add_assign
id|sp-&gt;loopend
op_minus
id|sp-&gt;loopstart
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_NO_BLANK
)paren
id|truesize
op_add_assign
id|BLANK_LOOP_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|0
op_logical_and
id|free_mem_ptr
op_plus
id|truesize
op_ge
id|awe_mem_size
op_div
l_int|2
)paren
(brace
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: Sample memory full&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|ENOSPC
)paren
suffix:semicolon
)brace
multiline_comment|/* recalculate address offset */
id|sp-&gt;end
op_sub_assign
id|sp-&gt;start
suffix:semicolon
id|sp-&gt;loopstart
op_sub_assign
id|sp-&gt;start
suffix:semicolon
id|sp-&gt;loopend
op_sub_assign
id|sp-&gt;start
suffix:semicolon
id|sp-&gt;size
op_assign
id|truesize
suffix:semicolon
id|sp-&gt;start
op_assign
id|free_mem_ptr
op_plus
id|AWE_DRAM_OFFSET
suffix:semicolon
id|sp-&gt;end
op_add_assign
id|free_mem_ptr
op_plus
id|AWE_DRAM_OFFSET
suffix:semicolon
id|sp-&gt;loopstart
op_add_assign
id|free_mem_ptr
op_plus
id|AWE_DRAM_OFFSET
suffix:semicolon
id|sp-&gt;loopend
op_add_assign
id|free_mem_ptr
op_plus
id|AWE_DRAM_OFFSET
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|awe_open_dram_for_write
c_func
(paren
id|free_mem_ptr
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|csum1
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|cc
suffix:semicolon
r_int
r_int
id|c
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_8BITS
)paren
(brace
id|GET_BYTE_FROM_USER
c_func
(paren
id|cc
comma
id|addr
comma
id|offset
)paren
suffix:semicolon
id|offset
op_increment
suffix:semicolon
id|c
op_assign
id|cc
op_lshift
l_int|8
suffix:semicolon
multiline_comment|/* convert 8bit -&gt; 16bit */
)brace
r_else
(brace
id|GET_SHORT_FROM_USER
c_func
(paren
id|c
comma
id|addr
comma
id|offset
)paren
suffix:semicolon
id|offset
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_UNSIGNED
)paren
id|c
op_xor_assign
l_int|0x8000
suffix:semicolon
multiline_comment|/* unsigned -&gt; signed */
id|csum1
op_add_assign
id|c
suffix:semicolon
id|awe_write_dram
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|sp-&gt;loopend
op_logical_and
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_BIDIR_LOOP
)paren
)paren
(brace
r_int
id|looplen
op_assign
id|sp-&gt;loopend
op_minus
id|sp-&gt;loopstart
suffix:semicolon
multiline_comment|/* copy reverse loop */
r_int
id|k
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|looplen
suffix:semicolon
id|k
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_8BITS
)paren
(brace
id|GET_BYTE_FROM_USER
c_func
(paren
id|cc
comma
id|addr
comma
id|offset
op_minus
id|k
)paren
suffix:semicolon
id|c
op_assign
id|cc
op_lshift
l_int|8
suffix:semicolon
)brace
r_else
(brace
id|GET_SHORT_FROM_USER
c_func
(paren
id|c
comma
id|addr
comma
id|offset
op_minus
id|k
op_star
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_UNSIGNED
)paren
id|c
op_xor_assign
l_int|0x8000
suffix:semicolon
id|awe_write_dram
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* if no blank loop is attached in the sample, add it */
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_NO_BLANK
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|BLANK_LOOP_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|awe_write_dram
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;mode_flags
op_amp
id|AWE_SAMPLE_SINGLESHOT
)paren
(brace
id|sp-&gt;loopstart
op_assign
id|sp-&gt;end
op_plus
id|BLANK_LOOP_START
suffix:semicolon
id|sp-&gt;loopend
op_assign
id|sp-&gt;end
op_plus
id|BLANK_LOOP_END
suffix:semicolon
)brace
id|sp-&gt;size
op_add_assign
id|BLANK_LOOP_SIZE
suffix:semicolon
)brace
id|awe_close_dram
c_func
(paren
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;checksum_flag
)paren
(brace
macro_line|#ifdef AWE_CHECKSUM_DATA
r_if
c_cond
(paren
id|sp-&gt;checksum_flag
op_ne
l_int|2
op_logical_and
id|csum1
op_ne
id|sp-&gt;checksum
)paren
(brace
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32: [%d] checksum mismatch on data %x:%x&bslash;n&quot;
comma
id|free_sample
comma
(paren
r_int
)paren
id|samples
(braket
id|free_sample
)braket
dot
id|checksum
comma
(paren
r_int
)paren
id|csum1
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|NO_DATA_ERR
)paren
suffix:semicolon
)brace
macro_line|#endif /* AWE_CHECKSUM_DATA */
macro_line|#ifdef AWE_CHECKSUM_MEMORY
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|awe_open_dram_for_read
c_func
(paren
id|free_mem_ptr
)paren
op_eq
l_int|0
)paren
(brace
id|csum2
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|c
suffix:semicolon
id|c
op_assign
id|awe_peek
c_func
(paren
id|AWE_SMLD
)paren
suffix:semicolon
id|csum2
op_add_assign
id|c
suffix:semicolon
)brace
id|awe_close_dram_for_read
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csum2
op_ne
id|samples
(braket
id|free_sample
)braket
dot
id|checksum
)paren
(brace
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32: [%d] checksum mismatch on DRAM %x:%x&bslash;n&quot;
comma
id|free_sample
comma
(paren
r_int
)paren
id|samples
(braket
id|free_sample
)braket
dot
id|checksum
comma
(paren
r_int
)paren
id|csum2
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|NO_DATA_ERR
)paren
suffix:semicolon
)brace
)brace
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#endif /* AWE_CHECKSUM_MEMORY */
)brace
id|free_mem_ptr
op_add_assign
id|sp-&gt;size
suffix:semicolon
multiline_comment|/* re-initialize FM passthrough */
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_init_fm
c_func
(paren
)paren
suffix:semicolon
id|awe_tweak
c_func
(paren
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* calculate GUS envelope time:&n; * is this correct?  i have no idea..&n; */
r_static
r_int
DECL|function|calc_gus_envelope_time
id|calc_gus_envelope_time
c_func
(paren
r_int
id|rate
comma
r_int
id|start
comma
r_int
id|end
)paren
(brace
r_int
id|r
comma
id|p
comma
id|t
suffix:semicolon
id|r
op_assign
(paren
l_int|3
op_minus
(paren
(paren
id|rate
op_rshift
l_int|6
)paren
op_amp
l_int|3
)paren
)paren
op_star
l_int|3
suffix:semicolon
id|p
op_assign
id|rate
op_amp
l_int|0x3f
suffix:semicolon
id|t
op_assign
id|end
op_minus
id|start
suffix:semicolon
r_if
c_cond
(paren
id|t
OL
l_int|0
)paren
id|t
op_assign
op_minus
id|t
suffix:semicolon
r_if
c_cond
(paren
l_int|13
OG
id|r
)paren
id|t
op_assign
id|t
op_lshift
(paren
l_int|13
op_minus
id|r
)paren
suffix:semicolon
r_else
id|t
op_assign
id|t
op_rshift
(paren
id|r
op_minus
l_int|13
)paren
suffix:semicolon
r_return
(paren
id|t
op_star
l_int|10
)paren
op_div
(paren
id|p
op_star
l_int|441
)paren
suffix:semicolon
)brace
DECL|macro|calc_gus_sustain
mdefine_line|#define calc_gus_sustain(val)  (0x7f - vol_table[(val)/2])
DECL|macro|calc_gus_attenuation
mdefine_line|#define calc_gus_attenuation(val)&t;vol_table[(val)/2]
multiline_comment|/* load GUS patch */
r_static
r_int
DECL|function|awe_load_guspatch
id|awe_load_guspatch
c_func
(paren
r_const
r_char
op_star
id|addr
comma
r_int
id|offs
comma
r_int
id|size
comma
r_int
id|pmgr_flag
)paren
(brace
r_struct
id|patch_info
id|patch
suffix:semicolon
id|awe_voice_list
op_star
id|rec
comma
op_star
id|curp
suffix:semicolon
r_int
id|sizeof_patch
suffix:semicolon
r_int
id|note
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|sizeof_patch
op_assign
(paren
r_int
)paren
op_amp
id|patch.data
(braket
l_int|0
)braket
op_minus
(paren
r_int
)paren
op_amp
id|patch
suffix:semicolon
multiline_comment|/* header size */
r_if
c_cond
(paren
id|free_sample
op_ge
id|AWE_MAX_SAMPLES
)paren
(brace
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: Sample table full&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|ENOSPC
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|free_info
op_ge
id|AWE_MAX_INFOS
)paren
(brace
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: Too many voice informations&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|ENOSPC
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
OL
id|sizeof_patch
)paren
(brace
id|ERRMSG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Error: Patch header too short&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|COPY_FROM_USER
c_func
(paren
(paren
(paren
r_char
op_star
)paren
op_amp
id|patch
)paren
op_plus
id|offs
comma
id|addr
comma
id|offs
comma
id|sizeof_patch
op_minus
id|offs
)paren
suffix:semicolon
id|size
op_sub_assign
id|sizeof_patch
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
id|patch.len
)paren
(brace
id|FATALERR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 Warning: Patch record too short (%d&lt;%d)&bslash;n&quot;
comma
id|size
comma
(paren
r_int
)paren
id|patch.len
)paren
)paren
suffix:semicolon
id|patch.len
op_assign
id|size
suffix:semicolon
)brace
id|samples
(braket
id|free_sample
)braket
dot
id|sf_id
op_assign
l_int|0
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|sample
op_assign
id|free_sample
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|start
op_assign
l_int|0
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|end
op_assign
id|patch.len
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|loopstart
op_assign
id|patch.loop_start
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|loopend
op_assign
id|patch.loop_end
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|size
op_assign
id|patch.len
suffix:semicolon
multiline_comment|/* set up mode flags */
id|samples
(braket
id|free_sample
)braket
dot
id|mode_flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|patch.mode
op_amp
id|WAVE_16_BITS
)paren
)paren
id|samples
(braket
id|free_sample
)braket
dot
id|mode_flags
op_or_assign
id|AWE_SAMPLE_8BITS
suffix:semicolon
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_UNSIGNED
)paren
id|samples
(braket
id|free_sample
)braket
dot
id|mode_flags
op_or_assign
id|AWE_SAMPLE_UNSIGNED
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|mode_flags
op_or_assign
id|AWE_SAMPLE_NO_BLANK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|patch.mode
op_amp
(paren
id|WAVE_LOOPING
op_or
id|WAVE_BIDIR_LOOP
)paren
)paren
)paren
id|samples
(braket
id|free_sample
)braket
dot
id|mode_flags
op_or_assign
id|AWE_SAMPLE_SINGLESHOT
suffix:semicolon
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_BIDIR_LOOP
)paren
id|samples
(braket
id|free_sample
)braket
dot
id|mode_flags
op_or_assign
id|AWE_SAMPLE_BIDIR_LOOP
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [sample %d mode %x]&bslash;n&quot;
comma
id|patch.instr_no
comma
id|samples
(braket
id|free_sample
)braket
dot
id|mode_flags
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_16_BITS
)paren
(brace
multiline_comment|/* convert to word offsets */
id|samples
(braket
id|free_sample
)braket
dot
id|size
op_div_assign
l_int|2
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|end
op_div_assign
l_int|2
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|loopstart
op_div_assign
l_int|2
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|loopend
op_div_assign
l_int|2
suffix:semicolon
)brace
id|samples
(braket
id|free_sample
)braket
dot
id|checksum_flag
op_assign
l_int|0
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|checksum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|awe_write_wave_data
c_func
(paren
id|addr
comma
id|sizeof_patch
comma
id|samples
(braket
id|free_sample
)braket
dot
id|size
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|rc
suffix:semicolon
id|awe_check_loaded
c_func
(paren
)paren
suffix:semicolon
id|samples
(braket
id|free_sample
)braket
dot
id|sf_id
op_assign
id|current_sf_id
suffix:semicolon
id|free_sample
op_increment
suffix:semicolon
multiline_comment|/* set up voice info */
id|rec
op_assign
op_amp
id|infos
(braket
id|free_info
)braket
suffix:semicolon
id|awe_init_voice_info
c_func
(paren
op_amp
id|rec-&gt;v
)paren
suffix:semicolon
id|rec-&gt;v.sf_id
op_assign
id|current_sf_id
suffix:semicolon
id|rec-&gt;v.sample
op_assign
id|free_sample
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* the last sample */
id|rec-&gt;v.rate_offset
op_assign
id|calc_rate_offset
c_func
(paren
id|patch.base_freq
)paren
suffix:semicolon
id|note
op_assign
id|freq_to_note
c_func
(paren
id|patch.base_note
)paren
suffix:semicolon
id|rec-&gt;v.root
op_assign
id|note
op_div
l_int|100
suffix:semicolon
id|rec-&gt;v.tune
op_assign
op_minus
(paren
id|note
op_mod
l_int|100
)paren
suffix:semicolon
id|rec-&gt;v.low
op_assign
id|freq_to_note
c_func
(paren
id|patch.low_note
)paren
op_div
l_int|100
suffix:semicolon
id|rec-&gt;v.high
op_assign
id|freq_to_note
c_func
(paren
id|patch.high_note
)paren
op_div
l_int|100
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [gus base offset=%d, note=%d, range=%d-%d(%d-%d)]&bslash;n&quot;
comma
id|rec-&gt;v.rate_offset
comma
id|note
comma
id|rec-&gt;v.low
comma
id|rec-&gt;v.high
comma
id|patch.low_note
comma
id|patch.high_note
)paren
)paren
suffix:semicolon
multiline_comment|/* panning position; -128 - 127 =&gt; 0-127 */
id|rec-&gt;v.pan
op_assign
(paren
id|patch.panning
op_plus
l_int|128
)paren
op_div
l_int|2
suffix:semicolon
multiline_comment|/* detuning is ignored */
multiline_comment|/* 6points volume envelope */
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_ENVELOPES
)paren
(brace
r_int
id|attack
comma
id|hold
comma
id|decay
comma
id|release
suffix:semicolon
id|attack
op_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|0
)braket
comma
l_int|0
comma
id|patch.env_offset
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|hold
op_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|1
)braket
comma
id|patch.env_offset
(braket
l_int|0
)braket
comma
id|patch.env_offset
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|decay
op_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|2
)braket
comma
id|patch.env_offset
(braket
l_int|1
)braket
comma
id|patch.env_offset
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|release
op_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|3
)braket
comma
id|patch.env_offset
(braket
l_int|1
)braket
comma
id|patch.env_offset
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|release
op_add_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|4
)braket
comma
id|patch.env_offset
(braket
l_int|3
)braket
comma
id|patch.env_offset
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|release
op_add_assign
id|calc_gus_envelope_time
(paren
id|patch.env_rate
(braket
l_int|5
)braket
comma
id|patch.env_offset
(braket
l_int|4
)braket
comma
id|patch.env_offset
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|rec-&gt;v.parm.volatkhld
op_assign
(paren
id|calc_parm_attack
c_func
(paren
id|attack
)paren
op_lshift
l_int|8
)paren
op_or
id|calc_parm_hold
c_func
(paren
id|hold
)paren
suffix:semicolon
id|rec-&gt;v.parm.voldcysus
op_assign
(paren
id|calc_gus_sustain
c_func
(paren
id|patch.env_offset
(braket
l_int|2
)braket
)paren
op_lshift
l_int|8
)paren
op_or
id|calc_parm_decay
c_func
(paren
id|decay
)paren
suffix:semicolon
id|rec-&gt;v.parm.volrelease
op_assign
l_int|0x8000
op_or
id|calc_parm_decay
c_func
(paren
id|release
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [gusenv atk=%d, hld=%d, dcy=%d, rel=%d]&bslash;n&quot;
comma
id|attack
comma
id|hold
comma
id|decay
comma
id|release
)paren
)paren
suffix:semicolon
id|rec-&gt;v.attenuation
op_assign
id|calc_gus_attenuation
c_func
(paren
id|patch.env_offset
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* tremolo effect */
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_TREMOLO
)paren
(brace
r_int
id|rate
op_assign
(paren
id|patch.tremolo_rate
op_star
l_int|1000
op_div
l_int|38
)paren
op_div
l_int|42
suffix:semicolon
id|rec-&gt;v.parm.tremfrq
op_assign
(paren
(paren
id|patch.tremolo_depth
op_div
l_int|2
)paren
op_lshift
l_int|8
)paren
op_or
id|rate
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [gusenv tremolo rate=%d, dep=%d, tremfrq=%x]&bslash;n&quot;
comma
id|patch.tremolo_rate
comma
id|patch.tremolo_depth
comma
id|rec-&gt;v.parm.tremfrq
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* vibrato effect */
r_if
c_cond
(paren
id|patch.mode
op_amp
id|WAVE_VIBRATO
)paren
(brace
r_int
id|rate
op_assign
(paren
id|patch.vibrato_rate
op_star
l_int|1000
op_div
l_int|38
)paren
op_div
l_int|42
suffix:semicolon
id|rec-&gt;v.parm.fm2frq2
op_assign
(paren
(paren
id|patch.vibrato_depth
op_div
l_int|6
)paren
op_lshift
l_int|8
)paren
op_or
id|rate
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [gusenv vibrato rate=%d, dep=%d, tremfrq=%x]&bslash;n&quot;
comma
id|patch.tremolo_rate
comma
id|patch.tremolo_depth
comma
id|rec-&gt;v.parm.tremfrq
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* scale_freq, scale_factor, volume, and fractions not implemented */
multiline_comment|/* set the voice index */
id|awe_set_sample
c_func
(paren
op_amp
id|rec-&gt;v
)paren
suffix:semicolon
multiline_comment|/* prepend to top of the list */
id|curp
op_assign
id|awe_search_instr
c_func
(paren
id|awe_gus_bank
comma
id|patch.instr_no
)paren
suffix:semicolon
id|rec-&gt;bank
op_assign
id|awe_gus_bank
suffix:semicolon
id|rec-&gt;instr
op_assign
id|patch.instr_no
suffix:semicolon
id|rec-&gt;next_instr
op_assign
id|curp
suffix:semicolon
id|rec-&gt;next_bank
op_assign
id|preset_table
(braket
id|rec-&gt;instr
)braket
suffix:semicolon
id|preset_table
(braket
id|rec-&gt;instr
)braket
op_assign
id|rec
suffix:semicolon
id|free_info
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* remove samples with current sf_id from instrument list */
r_static
id|awe_voice_list
op_star
DECL|function|awe_get_removed_list
id|awe_get_removed_list
c_func
(paren
id|awe_voice_list
op_star
id|curp
)paren
(brace
id|awe_voice_list
op_star
id|lastp
comma
op_star
op_star
id|prevp
suffix:semicolon
r_int
id|maxc
suffix:semicolon
id|lastp
op_assign
id|curp
suffix:semicolon
id|prevp
op_assign
op_amp
id|lastp
suffix:semicolon
r_for
c_loop
(paren
id|maxc
op_assign
id|AWE_MAX_INFOS
suffix:semicolon
id|curp
op_logical_and
id|maxc
suffix:semicolon
id|curp
op_assign
id|curp-&gt;next_instr
comma
id|maxc
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|curp-&gt;v.sf_id
op_eq
id|current_sf_id
)paren
op_star
id|prevp
op_assign
id|curp-&gt;next_instr
suffix:semicolon
r_else
id|prevp
op_assign
op_amp
id|curp-&gt;next_instr
suffix:semicolon
)brace
r_return
id|lastp
suffix:semicolon
)brace
multiline_comment|/* remove last loaded samples */
r_static
r_void
DECL|function|awe_remove_samples
id|awe_remove_samples
c_func
(paren
r_void
)paren
(brace
id|awe_voice_list
op_star
op_star
id|prevp
comma
op_star
id|p
comma
op_star
id|nextp
suffix:semicolon
r_int
id|maxc
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|last_sample
op_eq
id|free_sample
op_logical_and
id|last_info
op_eq
id|free_info
)paren
r_return
suffix:semicolon
multiline_comment|/* remove the records from preset table */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_PRESETS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|prevp
op_assign
op_amp
id|preset_table
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|maxc
op_assign
id|AWE_MAX_INFOS
comma
id|p
op_assign
id|preset_table
(braket
id|i
)braket
suffix:semicolon
id|p
op_logical_and
id|maxc
suffix:semicolon
id|p
op_assign
id|nextp
comma
id|maxc
op_decrement
)paren
(brace
id|nextp
op_assign
id|p-&gt;next_bank
suffix:semicolon
id|p
op_assign
id|awe_get_removed_list
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
op_star
id|prevp
op_assign
id|nextp
suffix:semicolon
r_else
(brace
op_star
id|prevp
op_assign
id|p
suffix:semicolon
id|prevp
op_assign
op_amp
id|p-&gt;next_bank
suffix:semicolon
)brace
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
id|last_sample
suffix:semicolon
id|i
OL
id|free_sample
suffix:semicolon
id|i
op_increment
)paren
id|free_mem_ptr
op_sub_assign
id|samples
(braket
id|i
)braket
dot
id|size
suffix:semicolon
id|free_sample
op_assign
id|last_sample
suffix:semicolon
id|free_info
op_assign
id|last_info
suffix:semicolon
id|current_sf_id
op_decrement
suffix:semicolon
id|loaded_once
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* search the specified sample */
r_static
r_int
DECL|function|awe_set_sample
id|awe_set_sample
c_func
(paren
id|awe_voice_info
op_star
id|vp
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|free_sample
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|samples
(braket
id|i
)braket
dot
id|sf_id
op_eq
id|vp-&gt;sf_id
op_logical_and
id|samples
(braket
id|i
)braket
dot
id|sample
op_eq
id|vp-&gt;sample
)paren
(brace
multiline_comment|/* set the actual sample offsets */
id|vp-&gt;start
op_add_assign
id|samples
(braket
id|i
)braket
dot
id|start
suffix:semicolon
id|vp-&gt;end
op_add_assign
id|samples
(braket
id|i
)braket
dot
id|end
suffix:semicolon
id|vp-&gt;loopstart
op_add_assign
id|samples
(braket
id|i
)braket
dot
id|loopstart
suffix:semicolon
id|vp-&gt;loopend
op_add_assign
id|samples
(braket
id|i
)braket
dot
id|loopend
suffix:semicolon
multiline_comment|/* copy mode flags */
id|vp-&gt;mode
op_or_assign
(paren
id|samples
(braket
id|i
)braket
dot
id|mode_flags
op_lshift
l_int|6
)paren
suffix:semicolon
multiline_comment|/* set index */
id|vp-&gt;index
op_assign
id|i
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* voice pressure change */
r_static
r_void
DECL|function|awe_aftertouch
id|awe_aftertouch
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|pressure
)paren
(brace
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [after(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|pressure
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|awe_max_voices
)paren
r_return
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|velocity
op_assign
id|pressure
suffix:semicolon
id|awe_calc_volume
c_func
(paren
id|voice
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_set_volume
c_func
(paren
id|voice
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* voice control change */
r_static
r_void
DECL|function|awe_controller
id|awe_controller
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|ctrl_num
comma
r_int
id|value
)paren
(brace
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|awe_max_voices
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|ctrl_num
)paren
(brace
r_case
id|CTL_BANK_SELECT
suffix:colon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [bank(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|bank
op_assign
id|value
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTRL_PITCH_BENDER
suffix:colon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [bend(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* zero centered */
id|voices
(braket
id|voice
)braket
dot
id|bender
op_assign
id|value
suffix:semicolon
id|awe_calc_pitch
c_func
(paren
id|voice
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_set_pitch
c_func
(paren
id|voice
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTRL_PITCH_BENDER_RANGE
suffix:colon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [range(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* sense x 100 */
id|voices
(braket
id|voice
)braket
dot
id|bender_range
op_assign
id|value
suffix:semicolon
multiline_comment|/* no audible pitch change yet.. */
r_break
suffix:semicolon
r_case
id|CTL_EXPRESSION
suffix:colon
id|value
op_div_assign
l_int|128
suffix:semicolon
r_case
id|CTRL_EXPRESSION
suffix:colon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [expr(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* 0 - 127 */
id|voices
(braket
id|voice
)braket
dot
id|expression_vol
op_assign
id|value
suffix:semicolon
id|awe_calc_volume
c_func
(paren
id|voice
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_set_volume
c_func
(paren
id|voice
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_PAN
suffix:colon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [pan(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* (0-127) -&gt; signed 8bit */
id|voices
(braket
id|voice
)braket
dot
id|panning
op_assign
id|value
op_star
l_int|2
op_minus
l_int|128
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_set_pan
c_func
(paren
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_MAIN_VOLUME
suffix:colon
id|value
op_assign
(paren
id|value
op_star
l_int|127
)paren
op_div
l_int|16383
suffix:semicolon
r_case
id|CTRL_MAIN_VOLUME
suffix:colon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [mainvol(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
multiline_comment|/* 0 - 127 */
id|voices
(braket
id|voice
)braket
dot
id|main_vol
op_assign
id|value
suffix:semicolon
id|awe_calc_volume
c_func
(paren
id|voice
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_set_volume
c_func
(paren
id|voice
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_EXT_EFF_DEPTH
suffix:colon
multiline_comment|/* reverb effects: 0-127 */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [reverb(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
id|FX_SET
c_func
(paren
id|voice
comma
id|AWE_FX_REVERB
comma
id|value
op_star
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CTL_CHORUS_DEPTH
suffix:colon
multiline_comment|/* chorus effects: 0-127 */
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [chorus(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|value
)paren
)paren
suffix:semicolon
id|FX_SET
c_func
(paren
id|voice
comma
id|AWE_FX_CHORUS
comma
id|value
op_star
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [control(%d) ctrl=%d val=%d]&bslash;n&quot;
comma
id|voice
comma
id|ctrl_num
comma
id|value
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* voice pan change (value = -128 - 127) */
r_static
r_void
DECL|function|awe_panning
id|awe_panning
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|value
)paren
(brace
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice
op_ge
l_int|0
op_logical_or
id|voice
OL
id|awe_max_voices
)paren
(brace
id|voices
(braket
id|voice
)braket
dot
id|panning
op_assign
id|value
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [pan(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|voices
(braket
id|voice
)braket
dot
id|panning
)paren
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_set_pan
c_func
(paren
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* volume mode change */
r_static
r_void
DECL|function|awe_volume_method
id|awe_volume_method
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
(brace
multiline_comment|/* not impremented */
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [volmethod mode=%d]&bslash;n&quot;
comma
id|mode
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* pitch wheel change: 0-16384 */
r_static
r_void
DECL|function|awe_bender
id|awe_bender
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|value
)paren
(brace
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|awe_max_voices
)paren
r_return
suffix:semicolon
multiline_comment|/* convert to zero centered value */
id|voices
(braket
id|voice
)braket
dot
id|bender
op_assign
id|value
op_minus
l_int|8192
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [bend(%d) %d]&bslash;n&quot;
comma
id|voice
comma
id|voices
(braket
id|voice
)braket
dot
id|bender
)paren
)paren
suffix:semicolon
id|awe_calc_pitch
c_func
(paren
id|voice
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
id|awe_set_pitch
c_func
(paren
id|voice
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* search an empty voice; used by sequencer2 */
r_static
r_int
DECL|function|awe_alloc
id|awe_alloc
c_func
(paren
r_int
id|dev
comma
r_int
id|chn
comma
r_int
id|note
comma
r_struct
id|voice_alloc_info
op_star
id|alloc
)paren
(brace
r_int
id|i
comma
id|p
comma
id|best
op_assign
op_minus
l_int|1
comma
id|best_time
op_assign
l_int|0x7fffffff
suffix:semicolon
id|p
op_assign
id|alloc-&gt;ptr
suffix:semicolon
multiline_comment|/* First look for a completely stopped voice */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|alloc-&gt;max_voice
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|alloc-&gt;map
(braket
id|p
)braket
op_eq
l_int|0
)paren
(brace
id|alloc-&gt;ptr
op_assign
id|p
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_if
c_cond
(paren
id|alloc-&gt;alloc_times
(braket
id|p
)braket
OL
id|best_time
)paren
(brace
id|best
op_assign
id|p
suffix:semicolon
id|best_time
op_assign
id|alloc-&gt;alloc_times
(braket
id|p
)braket
suffix:semicolon
)brace
id|p
op_assign
(paren
id|p
op_plus
l_int|1
)paren
op_mod
id|alloc-&gt;max_voice
suffix:semicolon
)brace
multiline_comment|/* Then look for a releasing voice */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|alloc-&gt;max_voice
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|alloc-&gt;map
(braket
id|p
)braket
op_eq
l_int|0xffff
)paren
(brace
id|alloc-&gt;ptr
op_assign
id|p
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
id|p
op_assign
(paren
id|p
op_plus
l_int|1
)paren
op_mod
id|alloc-&gt;max_voice
suffix:semicolon
)brace
r_if
c_cond
(paren
id|best
op_ge
l_int|0
)paren
id|p
op_assign
id|best
suffix:semicolon
multiline_comment|/* terminate the voice */
r_if
c_cond
(paren
id|voices
(braket
id|p
)braket
dot
id|state
)paren
id|awe_terminate
c_func
(paren
id|p
)paren
suffix:semicolon
id|alloc-&gt;ptr
op_assign
id|p
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
multiline_comment|/* set up voice; used by sequencer2 */
r_static
r_void
DECL|function|awe_setup_voice
id|awe_setup_voice
c_func
(paren
r_int
id|dev
comma
r_int
id|voice
comma
r_int
id|chn
)paren
(brace
r_struct
id|channel_info
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
id|synth_devs
(braket
id|dev
)braket
op_eq
l_int|NULL
op_logical_or
(paren
id|info
op_assign
op_amp
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|chn_info
(braket
id|chn
)braket
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|voice
OL
l_int|0
op_logical_or
id|voice
op_ge
id|awe_max_voices
)paren
r_return
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: [setup(%d) ch=%d]&bslash;n&quot;
comma
id|voice
comma
id|chn
)paren
)paren
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|expression_vol
op_assign
id|info-&gt;controllers
(braket
id|CTL_EXPRESSION
)braket
suffix:semicolon
id|voices
(braket
id|voice
)braket
dot
id|main_vol
op_assign
(paren
id|info-&gt;controllers
(braket
id|CTL_MAIN_VOLUME
)braket
op_star
l_int|100
)paren
op_div
l_int|128
suffix:semicolon
multiline_comment|/* 0 - 127 */
id|voices
(braket
id|voice
)braket
dot
id|panning
op_assign
id|info-&gt;controllers
(braket
id|CTL_PAN
)braket
op_star
l_int|2
op_minus
l_int|128
suffix:semicolon
multiline_comment|/* signed 8bit */
id|voices
(braket
id|voice
)braket
dot
id|bender
op_assign
id|info-&gt;bender_value
suffix:semicolon
multiline_comment|/* zero center */
id|voices
(braket
id|voice
)braket
dot
id|bank
op_assign
id|info-&gt;controllers
(braket
id|CTL_BANK_SELECT
)braket
suffix:semicolon
id|awe_set_instr
c_func
(paren
id|dev
comma
id|voice
comma
id|info-&gt;pgm_num
)paren
suffix:semicolon
)brace
multiline_comment|/*================================================================&n; * initialization of AWE32&n; *================================================================*/
multiline_comment|/* intiailize audio channels */
r_static
r_void
DECL|function|awe_init_audio
id|awe_init_audio
c_func
(paren
r_void
)paren
(brace
r_int
id|ch
suffix:semicolon
multiline_comment|/* turn off envelope engines */
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|ch
)paren
comma
l_int|0x0080
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_ENVVOL
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ENVVAL
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUS
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ATKHLDV
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_LFO1VAL
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ATKHLD
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_LFO2VAL
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IP
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IFATN
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_PEFE
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FMMOD
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_TREMFRQ
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FM2FRQ2
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* initialize DMA address */
r_static
r_void
DECL|function|awe_init_dma
id|awe_init_dma
c_func
(paren
r_void
)paren
(brace
id|awe_poke_dw
c_func
(paren
id|AWE_SMALR
comma
l_int|0x00000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_SMARR
comma
l_int|0x00000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_SMALW
comma
l_int|0x00000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_SMARW
comma
l_int|0x00000000
)paren
suffix:semicolon
)brace
multiline_comment|/* initialization arrays */
DECL|variable|init1
r_static
r_int
r_int
id|init1
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x03ff
comma
l_int|0x0030
comma
l_int|0x07ff
comma
l_int|0x0130
comma
l_int|0x0bff
comma
l_int|0x0230
comma
l_int|0x0fff
comma
l_int|0x0330
comma
l_int|0x13ff
comma
l_int|0x0430
comma
l_int|0x17ff
comma
l_int|0x0530
comma
l_int|0x1bff
comma
l_int|0x0630
comma
l_int|0x1fff
comma
l_int|0x0730
comma
l_int|0x23ff
comma
l_int|0x0830
comma
l_int|0x27ff
comma
l_int|0x0930
comma
l_int|0x2bff
comma
l_int|0x0a30
comma
l_int|0x2fff
comma
l_int|0x0b30
comma
l_int|0x33ff
comma
l_int|0x0c30
comma
l_int|0x37ff
comma
l_int|0x0d30
comma
l_int|0x3bff
comma
l_int|0x0e30
comma
l_int|0x3fff
comma
l_int|0x0f30
comma
l_int|0x43ff
comma
l_int|0x0030
comma
l_int|0x47ff
comma
l_int|0x0130
comma
l_int|0x4bff
comma
l_int|0x0230
comma
l_int|0x4fff
comma
l_int|0x0330
comma
l_int|0x53ff
comma
l_int|0x0430
comma
l_int|0x57ff
comma
l_int|0x0530
comma
l_int|0x5bff
comma
l_int|0x0630
comma
l_int|0x5fff
comma
l_int|0x0730
comma
l_int|0x63ff
comma
l_int|0x0830
comma
l_int|0x67ff
comma
l_int|0x0930
comma
l_int|0x6bff
comma
l_int|0x0a30
comma
l_int|0x6fff
comma
l_int|0x0b30
comma
l_int|0x73ff
comma
l_int|0x0c30
comma
l_int|0x77ff
comma
l_int|0x0d30
comma
l_int|0x7bff
comma
l_int|0x0e30
comma
l_int|0x7fff
comma
l_int|0x0f30
comma
l_int|0x83ff
comma
l_int|0x0030
comma
l_int|0x87ff
comma
l_int|0x0130
comma
l_int|0x8bff
comma
l_int|0x0230
comma
l_int|0x8fff
comma
l_int|0x0330
comma
l_int|0x93ff
comma
l_int|0x0430
comma
l_int|0x97ff
comma
l_int|0x0530
comma
l_int|0x9bff
comma
l_int|0x0630
comma
l_int|0x9fff
comma
l_int|0x0730
comma
l_int|0xa3ff
comma
l_int|0x0830
comma
l_int|0xa7ff
comma
l_int|0x0930
comma
l_int|0xabff
comma
l_int|0x0a30
comma
l_int|0xafff
comma
l_int|0x0b30
comma
l_int|0xb3ff
comma
l_int|0x0c30
comma
l_int|0xb7ff
comma
l_int|0x0d30
comma
l_int|0xbbff
comma
l_int|0x0e30
comma
l_int|0xbfff
comma
l_int|0x0f30
comma
l_int|0xc3ff
comma
l_int|0x0030
comma
l_int|0xc7ff
comma
l_int|0x0130
comma
l_int|0xcbff
comma
l_int|0x0230
comma
l_int|0xcfff
comma
l_int|0x0330
comma
l_int|0xd3ff
comma
l_int|0x0430
comma
l_int|0xd7ff
comma
l_int|0x0530
comma
l_int|0xdbff
comma
l_int|0x0630
comma
l_int|0xdfff
comma
l_int|0x0730
comma
l_int|0xe3ff
comma
l_int|0x0830
comma
l_int|0xe7ff
comma
l_int|0x0930
comma
l_int|0xebff
comma
l_int|0x0a30
comma
l_int|0xefff
comma
l_int|0x0b30
comma
l_int|0xf3ff
comma
l_int|0x0c30
comma
l_int|0xf7ff
comma
l_int|0x0d30
comma
l_int|0xfbff
comma
l_int|0x0e30
comma
l_int|0xffff
comma
l_int|0x0f30
comma
)brace
suffix:semicolon
DECL|variable|init2
r_static
r_int
r_int
id|init2
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x03ff
comma
l_int|0x8030
comma
l_int|0x07ff
comma
l_int|0x8130
comma
l_int|0x0bff
comma
l_int|0x8230
comma
l_int|0x0fff
comma
l_int|0x8330
comma
l_int|0x13ff
comma
l_int|0x8430
comma
l_int|0x17ff
comma
l_int|0x8530
comma
l_int|0x1bff
comma
l_int|0x8630
comma
l_int|0x1fff
comma
l_int|0x8730
comma
l_int|0x23ff
comma
l_int|0x8830
comma
l_int|0x27ff
comma
l_int|0x8930
comma
l_int|0x2bff
comma
l_int|0x8a30
comma
l_int|0x2fff
comma
l_int|0x8b30
comma
l_int|0x33ff
comma
l_int|0x8c30
comma
l_int|0x37ff
comma
l_int|0x8d30
comma
l_int|0x3bff
comma
l_int|0x8e30
comma
l_int|0x3fff
comma
l_int|0x8f30
comma
l_int|0x43ff
comma
l_int|0x8030
comma
l_int|0x47ff
comma
l_int|0x8130
comma
l_int|0x4bff
comma
l_int|0x8230
comma
l_int|0x4fff
comma
l_int|0x8330
comma
l_int|0x53ff
comma
l_int|0x8430
comma
l_int|0x57ff
comma
l_int|0x8530
comma
l_int|0x5bff
comma
l_int|0x8630
comma
l_int|0x5fff
comma
l_int|0x8730
comma
l_int|0x63ff
comma
l_int|0x8830
comma
l_int|0x67ff
comma
l_int|0x8930
comma
l_int|0x6bff
comma
l_int|0x8a30
comma
l_int|0x6fff
comma
l_int|0x8b30
comma
l_int|0x73ff
comma
l_int|0x8c30
comma
l_int|0x77ff
comma
l_int|0x8d30
comma
l_int|0x7bff
comma
l_int|0x8e30
comma
l_int|0x7fff
comma
l_int|0x8f30
comma
l_int|0x83ff
comma
l_int|0x8030
comma
l_int|0x87ff
comma
l_int|0x8130
comma
l_int|0x8bff
comma
l_int|0x8230
comma
l_int|0x8fff
comma
l_int|0x8330
comma
l_int|0x93ff
comma
l_int|0x8430
comma
l_int|0x97ff
comma
l_int|0x8530
comma
l_int|0x9bff
comma
l_int|0x8630
comma
l_int|0x9fff
comma
l_int|0x8730
comma
l_int|0xa3ff
comma
l_int|0x8830
comma
l_int|0xa7ff
comma
l_int|0x8930
comma
l_int|0xabff
comma
l_int|0x8a30
comma
l_int|0xafff
comma
l_int|0x8b30
comma
l_int|0xb3ff
comma
l_int|0x8c30
comma
l_int|0xb7ff
comma
l_int|0x8d30
comma
l_int|0xbbff
comma
l_int|0x8e30
comma
l_int|0xbfff
comma
l_int|0x8f30
comma
l_int|0xc3ff
comma
l_int|0x8030
comma
l_int|0xc7ff
comma
l_int|0x8130
comma
l_int|0xcbff
comma
l_int|0x8230
comma
l_int|0xcfff
comma
l_int|0x8330
comma
l_int|0xd3ff
comma
l_int|0x8430
comma
l_int|0xd7ff
comma
l_int|0x8530
comma
l_int|0xdbff
comma
l_int|0x8630
comma
l_int|0xdfff
comma
l_int|0x8730
comma
l_int|0xe3ff
comma
l_int|0x8830
comma
l_int|0xe7ff
comma
l_int|0x8930
comma
l_int|0xebff
comma
l_int|0x8a30
comma
l_int|0xefff
comma
l_int|0x8b30
comma
l_int|0xf3ff
comma
l_int|0x8c30
comma
l_int|0xf7ff
comma
l_int|0x8d30
comma
l_int|0xfbff
comma
l_int|0x8e30
comma
l_int|0xffff
comma
l_int|0x8f30
comma
)brace
suffix:semicolon
DECL|variable|init3
r_static
r_int
r_int
id|init3
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x0C10
comma
l_int|0x8470
comma
l_int|0x14FE
comma
l_int|0xB488
comma
l_int|0x167F
comma
l_int|0xA470
comma
l_int|0x18E7
comma
l_int|0x84B5
comma
l_int|0x1B6E
comma
l_int|0x842A
comma
l_int|0x1F1D
comma
l_int|0x852A
comma
l_int|0x0DA3
comma
l_int|0x8F7C
comma
l_int|0x167E
comma
l_int|0xF254
comma
l_int|0x0000
comma
l_int|0x842A
comma
l_int|0x0001
comma
l_int|0x852A
comma
l_int|0x18E6
comma
l_int|0x8BAA
comma
l_int|0x1B6D
comma
l_int|0xF234
comma
l_int|0x229F
comma
l_int|0x8429
comma
l_int|0x2746
comma
l_int|0x8529
comma
l_int|0x1F1C
comma
l_int|0x86E7
comma
l_int|0x229E
comma
l_int|0xF224
comma
l_int|0x0DA4
comma
l_int|0x8429
comma
l_int|0x2C29
comma
l_int|0x8529
comma
l_int|0x2745
comma
l_int|0x87F6
comma
l_int|0x2C28
comma
l_int|0xF254
comma
l_int|0x383B
comma
l_int|0x8428
comma
l_int|0x320F
comma
l_int|0x8528
comma
l_int|0x320E
comma
l_int|0x8F02
comma
l_int|0x1341
comma
l_int|0xF264
comma
l_int|0x3EB6
comma
l_int|0x8428
comma
l_int|0x3EB9
comma
l_int|0x8528
comma
l_int|0x383A
comma
l_int|0x8FA9
comma
l_int|0x3EB5
comma
l_int|0xF294
comma
l_int|0x3EB7
comma
l_int|0x8474
comma
l_int|0x3EBA
comma
l_int|0x8575
comma
l_int|0x3EB8
comma
l_int|0xC4C3
comma
l_int|0x3EBB
comma
l_int|0xC5C3
comma
l_int|0x0000
comma
l_int|0xA404
comma
l_int|0x0001
comma
l_int|0xA504
comma
l_int|0x141F
comma
l_int|0x8671
comma
l_int|0x14FD
comma
l_int|0x8287
comma
l_int|0x3EBC
comma
l_int|0xE610
comma
l_int|0x3EC8
comma
l_int|0x8C7B
comma
l_int|0x031A
comma
l_int|0x87E6
comma
l_int|0x3EC8
comma
l_int|0x86F7
comma
l_int|0x3EC0
comma
l_int|0x821E
comma
l_int|0x3EBE
comma
l_int|0xD208
comma
l_int|0x3EBD
comma
l_int|0x821F
comma
l_int|0x3ECA
comma
l_int|0x8386
comma
l_int|0x3EC1
comma
l_int|0x8C03
comma
l_int|0x3EC9
comma
l_int|0x831E
comma
l_int|0x3ECA
comma
l_int|0x8C4C
comma
l_int|0x3EBF
comma
l_int|0x8C55
comma
l_int|0x3EC9
comma
l_int|0xC208
comma
l_int|0x3EC4
comma
l_int|0xBC84
comma
l_int|0x3EC8
comma
l_int|0x8EAD
comma
l_int|0x3EC8
comma
l_int|0xD308
comma
l_int|0x3EC2
comma
l_int|0x8F7E
comma
l_int|0x3ECB
comma
l_int|0x8219
comma
l_int|0x3ECB
comma
l_int|0xD26E
comma
l_int|0x3EC5
comma
l_int|0x831F
comma
l_int|0x3EC6
comma
l_int|0xC308
comma
l_int|0x3EC3
comma
l_int|0xB2FF
comma
l_int|0x3EC9
comma
l_int|0x8265
comma
l_int|0x3EC9
comma
l_int|0x8319
comma
l_int|0x1342
comma
l_int|0xD36E
comma
l_int|0x3EC7
comma
l_int|0xB3FF
comma
l_int|0x0000
comma
l_int|0x8365
comma
l_int|0x1420
comma
l_int|0x9570
comma
)brace
suffix:semicolon
DECL|variable|init4
r_static
r_int
r_int
id|init4
(braket
l_int|128
)braket
op_assign
(brace
l_int|0x0C10
comma
l_int|0x8470
comma
l_int|0x14FE
comma
l_int|0xB488
comma
l_int|0x167F
comma
l_int|0xA470
comma
l_int|0x18E7
comma
l_int|0x84B5
comma
l_int|0x1B6E
comma
l_int|0x842A
comma
l_int|0x1F1D
comma
l_int|0x852A
comma
l_int|0x0DA3
comma
l_int|0x0F7C
comma
l_int|0x167E
comma
l_int|0x7254
comma
l_int|0x0000
comma
l_int|0x842A
comma
l_int|0x0001
comma
l_int|0x852A
comma
l_int|0x18E6
comma
l_int|0x0BAA
comma
l_int|0x1B6D
comma
l_int|0x7234
comma
l_int|0x229F
comma
l_int|0x8429
comma
l_int|0x2746
comma
l_int|0x8529
comma
l_int|0x1F1C
comma
l_int|0x06E7
comma
l_int|0x229E
comma
l_int|0x7224
comma
l_int|0x0DA4
comma
l_int|0x8429
comma
l_int|0x2C29
comma
l_int|0x8529
comma
l_int|0x2745
comma
l_int|0x07F6
comma
l_int|0x2C28
comma
l_int|0x7254
comma
l_int|0x383B
comma
l_int|0x8428
comma
l_int|0x320F
comma
l_int|0x8528
comma
l_int|0x320E
comma
l_int|0x0F02
comma
l_int|0x1341
comma
l_int|0x7264
comma
l_int|0x3EB6
comma
l_int|0x8428
comma
l_int|0x3EB9
comma
l_int|0x8528
comma
l_int|0x383A
comma
l_int|0x0FA9
comma
l_int|0x3EB5
comma
l_int|0x7294
comma
l_int|0x3EB7
comma
l_int|0x8474
comma
l_int|0x3EBA
comma
l_int|0x8575
comma
l_int|0x3EB8
comma
l_int|0x44C3
comma
l_int|0x3EBB
comma
l_int|0x45C3
comma
l_int|0x0000
comma
l_int|0xA404
comma
l_int|0x0001
comma
l_int|0xA504
comma
l_int|0x141F
comma
l_int|0x0671
comma
l_int|0x14FD
comma
l_int|0x0287
comma
l_int|0x3EBC
comma
l_int|0xE610
comma
l_int|0x3EC8
comma
l_int|0x0C7B
comma
l_int|0x031A
comma
l_int|0x07E6
comma
l_int|0x3EC8
comma
l_int|0x86F7
comma
l_int|0x3EC0
comma
l_int|0x821E
comma
l_int|0x3EBE
comma
l_int|0xD208
comma
l_int|0x3EBD
comma
l_int|0x021F
comma
l_int|0x3ECA
comma
l_int|0x0386
comma
l_int|0x3EC1
comma
l_int|0x0C03
comma
l_int|0x3EC9
comma
l_int|0x031E
comma
l_int|0x3ECA
comma
l_int|0x8C4C
comma
l_int|0x3EBF
comma
l_int|0x0C55
comma
l_int|0x3EC9
comma
l_int|0xC208
comma
l_int|0x3EC4
comma
l_int|0xBC84
comma
l_int|0x3EC8
comma
l_int|0x0EAD
comma
l_int|0x3EC8
comma
l_int|0xD308
comma
l_int|0x3EC2
comma
l_int|0x8F7E
comma
l_int|0x3ECB
comma
l_int|0x0219
comma
l_int|0x3ECB
comma
l_int|0xD26E
comma
l_int|0x3EC5
comma
l_int|0x031F
comma
l_int|0x3EC6
comma
l_int|0xC308
comma
l_int|0x3EC3
comma
l_int|0x32FF
comma
l_int|0x3EC9
comma
l_int|0x0265
comma
l_int|0x3EC9
comma
l_int|0x8319
comma
l_int|0x1342
comma
l_int|0xD36E
comma
l_int|0x3EC7
comma
l_int|0x33FF
comma
l_int|0x0000
comma
l_int|0x8365
comma
l_int|0x1420
comma
l_int|0x9570
comma
)brace
suffix:semicolon
multiline_comment|/* send initialization arrays to start up */
r_static
r_void
DECL|function|awe_init_array
id|awe_init_array
c_func
(paren
r_void
)paren
(brace
id|awe_send_array
c_func
(paren
id|init1
)paren
suffix:semicolon
id|awe_wait
c_func
(paren
l_int|1024
)paren
suffix:semicolon
id|awe_send_array
c_func
(paren
id|init2
)paren
suffix:semicolon
id|awe_send_array
c_func
(paren
id|init3
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_HWCF4
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_HWCF5
comma
l_int|0x83
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_HWCF6
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_send_array
c_func
(paren
id|init4
)paren
suffix:semicolon
)brace
multiline_comment|/* send an initialization array */
r_static
r_void
DECL|function|awe_send_array
id|awe_send_array
c_func
(paren
r_int
r_int
op_star
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
op_star
id|p
suffix:semicolon
id|p
op_assign
id|data
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|awe_poke
c_func
(paren
id|AWE_INIT1
c_func
(paren
id|i
)paren
comma
op_star
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|awe_poke
c_func
(paren
id|AWE_INIT2
c_func
(paren
id|i
)paren
comma
op_star
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|awe_poke
c_func
(paren
id|AWE_INIT3
c_func
(paren
id|i
)paren
comma
op_star
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|awe_poke
c_func
(paren
id|AWE_INIT4
c_func
(paren
id|i
)paren
comma
op_star
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * set up awe32 channels to some known state.&n; */
r_static
r_void
DECL|function|awe_tweak
id|awe_tweak
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Set the envelope engine parameters to the &quot;default&quot; values for&n;&t;   simply playing back unarticulated audio at 44.1kHz.  Set all&n;&t;   of the channels: */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_MAX_VOICES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_ENVVOL
c_func
(paren
id|i
)paren
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ENVVAL
c_func
(paren
id|i
)paren
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUS
c_func
(paren
id|i
)paren
comma
l_int|0x7F7F
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ATKHLDV
c_func
(paren
id|i
)paren
comma
l_int|0x7F7F
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_LFO1VAL
c_func
(paren
id|i
)paren
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_ATKHLD
c_func
(paren
id|i
)paren
comma
l_int|0x7F7F
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_LFO2VAL
c_func
(paren
id|i
)paren
comma
l_int|0x8000
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IP
c_func
(paren
id|i
)paren
comma
l_int|0xE000
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IFATN
c_func
(paren
id|i
)paren
comma
l_int|0xFF00
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_PEFE
c_func
(paren
id|i
)paren
comma
l_int|0x0000
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FMMOD
c_func
(paren
id|i
)paren
comma
l_int|0x0000
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_TREMFRQ
c_func
(paren
id|i
)paren
comma
l_int|0x0010
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_FM2FRQ2
c_func
(paren
id|i
)paren
comma
l_int|0x0010
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  initializes the FM section of AWE32&n; */
r_static
r_void
DECL|function|awe_init_fm
id|awe_init_fm
c_func
(paren
r_void
)paren
(brace
macro_line|#ifndef AWE_ALWAYS_INIT_FM
multiline_comment|/* if no extended memory is on board.. */
r_if
c_cond
(paren
id|awe_mem_size
op_le
l_int|0
)paren
r_return
suffix:semicolon
macro_line|#endif
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: initializing FM&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* Initialize the last two channels for DRAM refresh and producing&n;&t;   the reverb and chorus effects for Yamaha OPL-3 synthesizer */
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
l_int|30
)paren
comma
l_int|0x0080
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
l_int|30
)paren
comma
l_int|0xFFFFFFE0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
l_int|30
)paren
comma
l_int|0xFFFFFFE8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
l_int|30
)paren
comma
l_int|0x00FFFF00
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
l_int|30
)paren
comma
l_int|0x00000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
l_int|30
)paren
comma
l_int|0x00FFFFE3
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
l_int|31
)paren
comma
l_int|0x0080
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
l_int|31
)paren
comma
l_int|0x00FFFFE0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
l_int|31
)paren
comma
l_int|0xFFFFFFE8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
l_int|31
)paren
comma
l_int|0x00FFFF00
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
l_int|31
)paren
comma
l_int|0x00000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
l_int|31
)paren
comma
l_int|0x00FFFFE3
)paren
suffix:semicolon
multiline_comment|/* Timing loop */
multiline_comment|/* PTRX is 32 bit long but do not write to the MS byte */
id|awe_poke
c_func
(paren
id|AWE_PTRX
c_func
(paren
l_int|30
)paren
comma
l_int|0x0000
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|awe_base
op_minus
l_int|0x620
op_plus
id|Pointer
)paren
op_amp
l_int|0x1000
)paren
)paren
(brace
suffix:semicolon
)brace
r_while
c_loop
(paren
id|inw
c_func
(paren
id|awe_base
op_minus
l_int|0x620
op_plus
id|Pointer
)paren
op_amp
l_int|0x1000
)paren
(brace
suffix:semicolon
)brace
multiline_comment|/* now write the MS byte of PTRX */
id|OUTW
c_func
(paren
l_int|0x4828
comma
id|awe_base
op_minus
l_int|0x620
op_plus
id|Data0
op_plus
l_int|0x002
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_IFATN
c_func
(paren
l_int|28
)paren
comma
l_int|0x0000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
l_int|30
)paren
comma
l_int|0x8000FFFF
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
l_int|31
)paren
comma
l_int|0x8000FFFF
)paren
suffix:semicolon
multiline_comment|/* change maximum channels to 30 */
id|awe_max_voices
op_assign
id|AWE_NORMAL_VOICES
suffix:semicolon
id|awe_info.nr_voices
op_assign
id|awe_max_voices
suffix:semicolon
id|voice_alloc-&gt;max_voice
op_assign
id|awe_max_voices
suffix:semicolon
)brace
multiline_comment|/*&n; *  AWE32 DRAM access routines&n; */
multiline_comment|/* open DRAM write accessing mode */
r_static
r_int
DECL|function|awe_open_dram_for_write
id|awe_open_dram_for_write
c_func
(paren
r_int
id|offset
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* use all channels for DMA transfer */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|i
)paren
comma
l_int|0x80
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|i
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
id|i
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|i
)paren
comma
l_int|0x06000000
)paren
suffix:semicolon
)brace
multiline_comment|/* point channels 31 &amp; 32 to ROM samples for DRAM refresh */
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
l_int|30
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
l_int|30
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
l_int|30
)paren
comma
l_int|0x1e0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
l_int|30
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
l_int|31
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
l_int|31
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
l_int|31
)paren
comma
l_int|0x1e0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
l_int|31
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
multiline_comment|/* if full bit is on, not ready to write on */
r_if
c_cond
(paren
id|awe_peek_dw
c_func
(paren
id|AWE_SMALW
)paren
op_amp
l_int|0x80000000
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|i
op_increment
)paren
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|ENOSPC
)paren
suffix:semicolon
)brace
multiline_comment|/* set address to write */
id|awe_poke_dw
c_func
(paren
id|AWE_SMALW
comma
id|offset
op_plus
id|AWE_DRAM_OFFSET
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* open DRAM for RAM size detection */
r_static
r_void
DECL|function|awe_open_dram_for_check
id|awe_open_dram_for_check
c_func
(paren
r_void
)paren
(brace
r_int
id|k
suffix:semicolon
r_int
r_int
id|scratch
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_HWCF2
comma
l_int|0x0020
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|k
op_increment
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|k
)paren
comma
l_int|0x0080
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|k
)paren
comma
l_int|0x00000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|k
)paren
comma
l_int|0x00000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|k
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
id|k
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
id|k
)paren
comma
l_int|0x00000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
id|k
)paren
comma
l_int|0x00000000
)paren
suffix:semicolon
id|scratch
op_assign
(paren
(paren
(paren
id|k
op_amp
l_int|1
)paren
op_lshift
l_int|9
)paren
op_plus
l_int|0x400
)paren
suffix:semicolon
id|scratch
op_assign
id|scratch
op_lshift
l_int|16
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|k
)paren
comma
id|scratch
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* close dram access */
r_static
r_void
DECL|function|awe_close_dram
id|awe_close_dram
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* wait until FULL bit in SMAxW register be false */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|awe_peek_dw
c_func
(paren
id|AWE_SMALW
)paren
op_amp
l_int|0x80000000
)paren
)paren
r_break
suffix:semicolon
id|awe_wait
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|i
)paren
comma
l_int|0x807F
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef AWE_CHECKSUM_MEMORY
multiline_comment|/* open DRAM read accessing mode */
r_static
r_int
DECL|function|awe_open_dram_for_read
id|awe_open_dram_for_read
c_func
(paren
r_int
id|offset
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* use all channels for DMA transfer */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|i
)paren
comma
l_int|0x80
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CVCF
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PTRX
c_func
(paren
id|i
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CPF
c_func
(paren
id|i
)paren
comma
l_int|0x40000000
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|i
)paren
comma
l_int|0x04000000
)paren
suffix:semicolon
)brace
multiline_comment|/* point channels 31 &amp; 32 to ROM samples for DRAM refresh */
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
l_int|30
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
l_int|30
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
l_int|30
)paren
comma
l_int|0x1e0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
l_int|30
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_VTFT
c_func
(paren
l_int|31
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_PSST
c_func
(paren
l_int|31
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CSL
c_func
(paren
l_int|31
)paren
comma
l_int|0x1e0
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
l_int|31
)paren
comma
l_int|0x1d8
)paren
suffix:semicolon
multiline_comment|/* if empty flag is on, not ready to read */
r_if
c_cond
(paren
id|awe_peek_dw
c_func
(paren
id|AWE_SMALR
)paren
op_amp
l_int|0x80000000
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|i
op_increment
)paren
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
id|RET_ERROR
c_func
(paren
id|ENOSPC
)paren
suffix:semicolon
)brace
multiline_comment|/* set address to read */
id|awe_poke_dw
c_func
(paren
id|AWE_SMALR
comma
id|offset
op_plus
id|AWE_DRAM_OFFSET
)paren
suffix:semicolon
multiline_comment|/* drop stale data */
id|awe_peek
c_func
(paren
id|AWE_SMLD
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* close dram access for read */
r_static
r_void
DECL|function|awe_close_dram_for_read
id|awe_close_dram_for_read
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* wait until FULL bit in SMAxW register be false */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|awe_peek_dw
c_func
(paren
id|AWE_SMALR
)paren
op_amp
l_int|0x80000000
)paren
)paren
r_break
suffix:semicolon
id|awe_wait
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AWE_NORMAL_VOICES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|awe_poke_dw
c_func
(paren
id|AWE_CCCA
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_DCYSUSV
c_func
(paren
id|i
)paren
comma
l_int|0x807F
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* AWE_CHECKSUM_MEMORY */
multiline_comment|/* write a word data */
r_static
r_void
DECL|function|awe_write_dram
id|awe_write_dram
c_func
(paren
r_int
r_int
id|c
)paren
(brace
r_int
id|k
suffix:semicolon
multiline_comment|/* wait until FULL bit in SMAxW register be false */
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|10000
suffix:semicolon
id|k
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|awe_peek_dw
c_func
(paren
id|AWE_SMALW
)paren
op_amp
l_int|0x80000000
)paren
)paren
r_break
suffix:semicolon
id|awe_wait
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|awe_poke
c_func
(paren
id|AWE_SMLD
comma
id|c
)paren
suffix:semicolon
)brace
multiline_comment|/*================================================================&n; * detect presence of AWE32 and check memory size&n; *================================================================*/
r_static
r_int
DECL|function|awe_detect
id|awe_detect
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef AWE_DEFAULT_BASE_ADDR
id|awe_base
op_assign
id|AWE_DEFAULT_BASE_ADDR
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|awe_peek
c_func
(paren
id|AWE_U1
)paren
op_amp
l_int|0x000F
)paren
op_eq
l_int|0x000C
)paren
op_logical_and
(paren
(paren
id|awe_peek
c_func
(paren
id|AWE_HWCF1
)paren
op_amp
l_int|0x007E
)paren
op_eq
l_int|0x0058
)paren
op_logical_and
(paren
(paren
id|awe_peek
c_func
(paren
id|AWE_HWCF2
)paren
op_amp
l_int|0x0003
)paren
op_eq
l_int|0x0003
)paren
)paren
r_return
l_int|1
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|awe_base
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|awe_base
op_assign
l_int|0x620
suffix:semicolon
id|awe_base
op_le
l_int|0x680
suffix:semicolon
id|awe_base
op_add_assign
l_int|0x20
)paren
(brace
r_if
c_cond
(paren
(paren
id|awe_peek
c_func
(paren
id|AWE_U1
)paren
op_amp
l_int|0x000F
)paren
op_ne
l_int|0x000C
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|awe_peek
c_func
(paren
id|AWE_HWCF1
)paren
op_amp
l_int|0x007E
)paren
op_ne
l_int|0x0058
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|awe_peek
c_func
(paren
id|AWE_HWCF2
)paren
op_amp
l_int|0x0003
)paren
op_ne
l_int|0x0003
)paren
r_continue
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32 found at %x&bslash;n&quot;
comma
id|awe_base
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
id|FATALERR
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;AWE32 not found&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|awe_base
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*================================================================&n; * check dram size on AWE board&n; *================================================================*/
r_static
r_int
DECL|function|awe_check_dram
id|awe_check_dram
c_func
(paren
r_void
)paren
(brace
id|awe_open_dram_for_check
c_func
(paren
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_SMALW
comma
l_int|0x00200000
)paren
suffix:semicolon
multiline_comment|/* DRAM start address */
id|awe_poke
c_func
(paren
id|AWE_SMLD
comma
l_int|0x1234
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_SMLD
comma
l_int|0x7777
)paren
suffix:semicolon
id|awe_mem_size
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|awe_mem_size
OL
l_int|28
op_star
l_int|1024
)paren
(brace
multiline_comment|/* 28 MB is max onboard memory */
id|awe_wait
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|awe_poke_dw
c_func
(paren
id|AWE_SMALR
comma
l_int|0x00200000
)paren
suffix:semicolon
multiline_comment|/* Address for reading */
id|awe_peek
c_func
(paren
id|AWE_SMLD
)paren
suffix:semicolon
multiline_comment|/* Discard stale data  */
r_if
c_cond
(paren
id|awe_peek
c_func
(paren
id|AWE_SMLD
)paren
op_ne
l_int|0x1234
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|awe_peek
c_func
(paren
id|AWE_SMLD
)paren
op_ne
l_int|0x7777
)paren
r_break
suffix:semicolon
id|awe_mem_size
op_add_assign
l_int|32
suffix:semicolon
multiline_comment|/* Address for writing */
id|awe_poke_dw
c_func
(paren
id|AWE_SMALW
comma
l_int|0x00200000
op_plus
id|awe_mem_size
op_star
l_int|512L
)paren
suffix:semicolon
id|awe_poke
c_func
(paren
id|AWE_SMLD
comma
l_int|0xFFFF
)paren
suffix:semicolon
)brace
id|awe_close_dram
c_func
(paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|printk
c_func
(paren
l_string|&quot;AWE32: %d Kbytes memory detected&bslash;n&quot;
comma
(paren
r_int
)paren
id|awe_mem_size
)paren
)paren
suffix:semicolon
macro_line|#ifdef AWE_DEFAULT_MEM_SIZE
r_if
c_cond
(paren
id|awe_mem_size
op_eq
l_int|0
)paren
id|awe_mem_size
op_assign
id|AWE_DEFAULT_MEM_SIZE
suffix:semicolon
macro_line|#endif
multiline_comment|/* convert to Kbytes */
id|awe_mem_size
op_mul_assign
l_int|1024
suffix:semicolon
r_return
id|awe_mem_size
suffix:semicolon
)brace
multiline_comment|/*================================================================&n; * chorus and reverb controls&n; *================================================================*/
DECL|variable|ChorusEffects
r_static
r_int
r_int
id|ChorusEffects
(braket
l_int|24
)braket
op_assign
(brace
l_int|0xE600
comma
l_int|0x03F6
comma
l_int|0xBC2C
comma
l_int|0xE608
comma
l_int|0x031A
comma
l_int|0xBC6E
comma
l_int|0xE610
comma
l_int|0x031A
comma
l_int|0xBC84
comma
l_int|0xE620
comma
l_int|0x0269
comma
l_int|0xBC6E
comma
l_int|0xE680
comma
l_int|0x04D3
comma
l_int|0xBCA6
comma
l_int|0xE6E0
comma
l_int|0x044E
comma
l_int|0xBC37
comma
l_int|0xE600
comma
l_int|0x0B06
comma
l_int|0xBC00
comma
l_int|0xE6C0
comma
l_int|0x0B06
comma
l_int|0xBC00
)brace
suffix:semicolon
DECL|variable|ChorusEffects2
r_static
r_int
r_int
id|ChorusEffects2
(braket
)braket
op_assign
(brace
l_int|0x0000
comma
l_int|0x006D
comma
l_int|0x8000
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x017C
comma
l_int|0x8000
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x0083
comma
l_int|0x8000
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x017C
comma
l_int|0x8000
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x005B
comma
l_int|0x8000
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x0026
comma
l_int|0x8000
comma
l_int|0x0000
comma
l_int|0x6E000
comma
l_int|0x0083
comma
l_int|0x8000
comma
l_int|0x0000
comma
l_int|0x6E000
comma
l_int|0x0083
comma
l_int|0x8000
comma
l_int|0x0000
)brace
suffix:semicolon
DECL|variable|ChorusCommand
r_static
r_int
r_int
id|ChorusCommand
(braket
l_int|14
)braket
op_assign
(brace
l_int|0x69
comma
l_int|0xA20
comma
l_int|0x6C
comma
l_int|0xA20
comma
l_int|0x63
comma
l_int|0xA22
comma
l_int|0x29
comma
l_int|0xA20
comma
l_int|0x2A
comma
l_int|0xA20
comma
l_int|0x2D
comma
l_int|0xA20
comma
l_int|0x2E
comma
l_int|0xA20
)brace
suffix:semicolon
DECL|variable|ReverbEffects
r_static
r_int
r_int
id|ReverbEffects
(braket
l_int|224
)braket
op_assign
(brace
multiline_comment|/* Room 1 */
l_int|0xB488
comma
l_int|0xA450
comma
l_int|0x9550
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x72F4
comma
l_int|0x72A4
comma
l_int|0x7254
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x4416
comma
l_int|0x4516
comma
l_int|0xA490
comma
l_int|0xA590
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
multiline_comment|/* Room 2 */
l_int|0xB488
comma
l_int|0xA458
comma
l_int|0x9558
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7284
comma
l_int|0x7254
comma
l_int|0x7224
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7284
comma
l_int|0x4448
comma
l_int|0x4548
comma
l_int|0xA440
comma
l_int|0xA540
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
multiline_comment|/* Room 3 */
l_int|0xB488
comma
l_int|0xA460
comma
l_int|0x9560
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7284
comma
l_int|0x7254
comma
l_int|0x7224
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7284
comma
l_int|0x4416
comma
l_int|0x4516
comma
l_int|0xA490
comma
l_int|0xA590
comma
l_int|0x842C
comma
l_int|0x852C
comma
l_int|0x842C
comma
l_int|0x852C
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
multiline_comment|/* Hall 1 */
l_int|0xB488
comma
l_int|0xA470
comma
l_int|0x9570
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7284
comma
l_int|0x7254
comma
l_int|0x7224
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7284
comma
l_int|0x4448
comma
l_int|0x4548
comma
l_int|0xA440
comma
l_int|0xA540
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
multiline_comment|/* Hall 2 */
l_int|0xB488
comma
l_int|0xA470
comma
l_int|0x9570
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7254
comma
l_int|0x7234
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7264
comma
l_int|0x7294
comma
l_int|0x44C3
comma
l_int|0x45C3
comma
l_int|0xA404
comma
l_int|0xA504
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
multiline_comment|/* Plate */
l_int|0xB4FF
comma
l_int|0xA470
comma
l_int|0x9570
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x4448
comma
l_int|0x4548
comma
l_int|0xA440
comma
l_int|0xA540
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
multiline_comment|/* Delay */
l_int|0xB4FF
comma
l_int|0xA470
comma
l_int|0x9500
comma
l_int|0x84B5
comma
l_int|0x333A
comma
l_int|0x39B5
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x72F4
comma
l_int|0x4400
comma
l_int|0x4500
comma
l_int|0xA4FF
comma
l_int|0xA5FF
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
multiline_comment|/* Panning Delay */
l_int|0xB4FF
comma
l_int|0xA490
comma
l_int|0x9590
comma
l_int|0x8474
comma
l_int|0x333A
comma
l_int|0x39B5
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x72F4
comma
l_int|0x4400
comma
l_int|0x4500
comma
l_int|0xA4FF
comma
l_int|0xA5FF
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
)brace
suffix:semicolon
DECL|variable|ReverbCommand
r_static
r_int
r_int
id|ReverbCommand
(braket
l_int|56
)braket
op_assign
(brace
l_int|0x43
comma
l_int|0xA20
comma
l_int|0x45
comma
l_int|0xA20
comma
l_int|0x7F
comma
l_int|0xA22
comma
l_int|0x47
comma
l_int|0xA20
comma
l_int|0x54
comma
l_int|0xA22
comma
l_int|0x56
comma
l_int|0xA22
comma
l_int|0x4F
comma
l_int|0xA20
comma
l_int|0x57
comma
l_int|0xA20
comma
l_int|0x5F
comma
l_int|0xA20
comma
l_int|0x47
comma
l_int|0xA22
comma
l_int|0x4F
comma
l_int|0xA22
comma
l_int|0x57
comma
l_int|0xA22
comma
l_int|0x5D
comma
l_int|0xA22
comma
l_int|0x5F
comma
l_int|0xA22
comma
l_int|0x61
comma
l_int|0xA20
comma
l_int|0x63
comma
l_int|0xA20
comma
l_int|0x49
comma
l_int|0xA20
comma
l_int|0x4B
comma
l_int|0xA20
comma
l_int|0x51
comma
l_int|0xA20
comma
l_int|0x53
comma
l_int|0xA20
comma
l_int|0x59
comma
l_int|0xA20
comma
l_int|0x5B
comma
l_int|0xA20
comma
l_int|0x41
comma
l_int|0xA22
comma
l_int|0x43
comma
l_int|0xA22
comma
l_int|0x49
comma
l_int|0xA22
comma
l_int|0x4B
comma
l_int|0xA22
comma
l_int|0x51
comma
l_int|0xA22
comma
l_int|0x53
comma
l_int|0xA22
)brace
suffix:semicolon
DECL|function|awe_set_chorus_mode
r_static
r_void
id|awe_set_chorus_mode
c_func
(paren
r_int
id|effect
)paren
(brace
r_int
id|k
suffix:semicolon
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|3
suffix:semicolon
id|k
op_increment
)paren
id|awe_poke
c_func
(paren
id|ChorusCommand
(braket
id|k
op_star
l_int|2
)braket
comma
id|ChorusCommand
(braket
id|k
op_star
l_int|2
op_plus
l_int|1
)braket
comma
id|ChorusEffects
(braket
id|k
op_plus
id|effect
op_star
l_int|3
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|4
suffix:semicolon
id|k
op_increment
)paren
id|awe_poke_dw
c_func
(paren
id|ChorusCommand
(braket
l_int|6
op_plus
id|k
op_star
l_int|2
)braket
comma
id|ChorusCommand
(braket
l_int|6
op_plus
id|k
op_star
l_int|2
op_plus
l_int|1
)braket
comma
id|ChorusEffects2
(braket
id|k
op_plus
id|effect
op_star
l_int|4
)braket
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|awe_set_reverb_mode
r_static
r_void
id|awe_set_reverb_mode
c_func
(paren
r_int
id|effect
)paren
(brace
r_int
id|k
suffix:semicolon
id|DECL_INTR_FLAGS
c_func
(paren
id|flags
)paren
suffix:semicolon
id|DISABLE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|28
suffix:semicolon
id|k
op_increment
)paren
id|awe_poke
c_func
(paren
id|ReverbCommand
(braket
id|k
op_star
l_int|2
)braket
comma
id|ReverbCommand
(braket
id|k
op_star
l_int|2
op_plus
l_int|1
)braket
comma
id|ReverbEffects
(braket
id|k
op_plus
id|effect
op_star
l_int|28
)braket
)paren
suffix:semicolon
id|RESTORE_INTR
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AWE32_SYNTH */
eof
