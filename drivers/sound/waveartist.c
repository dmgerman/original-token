multiline_comment|/*&n; * linux/drivers/sound/waveartist.c&n; *&n; * The low level driver for the RWA010 Rockwell Wave Artist&n; * codec chip used in the Rebel.com NetWinder.&n; *&n; * Cleaned up and integrated into 2.1 by Russell King (rmk@arm.linux.org.uk)&n; * and Pat Beirne (patb@corel.ca)&n; *&n; *&n; * Copyright (C) by Rebel.com 1998-1999&n; *&n; * RWA010 specs received under NDA from Rockwell&n; *&n; * Copyright (C) by Hannu Savolainen 1993-1997&n; *&n; * OSS/Free for Linux is distributed under the GNU GENERAL PUBLIC LICENSE (GPL)&n; * Version 2 (June 1991). See the &quot;COPYING&quot; file distributed with this software&n; * for more info.&n; *&n; * Changes:&n; * 11-10-2000&t;Bartlomiej Zolnierkiewicz &lt;bkz@linux-ide.org&gt;&n; *&t;&t;Added __init to waveartist_init()&n; */
multiline_comment|/* Debugging */
DECL|macro|DEBUG_CMD
mdefine_line|#define DEBUG_CMD&t;1
DECL|macro|DEBUG_OUT
mdefine_line|#define DEBUG_OUT&t;2
DECL|macro|DEBUG_IN
mdefine_line|#define DEBUG_IN&t;4
DECL|macro|DEBUG_INTR
mdefine_line|#define DEBUG_INTR&t;8
DECL|macro|DEBUG_MIXER
mdefine_line|#define DEBUG_MIXER&t;16
DECL|macro|DEBUG_TRIGGER
mdefine_line|#define DEBUG_TRIGGER&t;32
DECL|macro|debug_flg
mdefine_line|#define debug_flg (0)
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/mach-types.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &quot;sound_config.h&quot;
macro_line|#include &quot;waveartist.h&quot;
macro_line|#ifndef _ISA_DMA
DECL|macro|_ISA_DMA
mdefine_line|#define _ISA_DMA(x) (x)
macro_line|#endif
macro_line|#ifndef _ISA_IRQ
DECL|macro|_ISA_IRQ
mdefine_line|#define _ISA_IRQ(x) (x)
macro_line|#endif
DECL|macro|POSSIBLE_RECORDING_DEVICES
mdefine_line|#define POSSIBLE_RECORDING_DEVICES&t;(SOUND_MASK_LINE       |&bslash;&n;&t;&t;&t;&t;&t; SOUND_MASK_MIC&t;       |&bslash;&n;&t;&t;&t;&t;&t; SOUND_MASK_LINE1)
DECL|macro|SUPPORTED_MIXER_DEVICES
mdefine_line|#define SUPPORTED_MIXER_DEVICES&t;&t;(SOUND_MASK_SYNTH      |&bslash;&n;&t;&t;&t;&t;&t; SOUND_MASK_PCM        |&bslash;&n;&t;&t;&t;&t;&t; SOUND_MASK_LINE       |&bslash;&n;&t;&t;&t;&t;&t; SOUND_MASK_MIC        |&bslash;&n;&t;&t;&t;&t;&t; SOUND_MASK_LINE1      |&bslash;&n;&t;&t;&t;&t;&t; SOUND_MASK_RECLEV     |&bslash;&n;&t;&t;&t;&t;&t; SOUND_MASK_VOLUME     |&bslash;&n;&t;&t;&t;&t;&t; SOUND_MASK_IMIX)
DECL|variable|levels
r_static
r_int
r_int
id|levels
(braket
id|SOUND_MIXER_NRDEVICES
)braket
op_assign
(brace
l_int|0x5555
comma
multiline_comment|/* Master Volume&t; */
l_int|0x0000
comma
multiline_comment|/* Bass&t;&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Treble&t;&t; */
l_int|0x2323
comma
multiline_comment|/* Synth (FM)&t;&t; */
l_int|0x4b4b
comma
multiline_comment|/* PCM&t;&t;&t; */
l_int|0x0000
comma
multiline_comment|/* PC Speaker&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Ext Line&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Mic&t;&t;&t; */
l_int|0x0000
comma
multiline_comment|/* CD&t;&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Recording monitor&t; */
l_int|0x0000
comma
multiline_comment|/* SB PCM (ALT PCM)&t; */
l_int|0x0000
comma
multiline_comment|/* Recording level&t; */
l_int|0x0000
comma
multiline_comment|/* Input gain&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Output gain&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Line1 (Aux1)&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Line2 (Aux2)&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Line3 (Aux3)&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Digital1&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Digital2&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Digital3&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Phone In&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Phone Out&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Video&t;&t; */
l_int|0x0000
comma
multiline_comment|/* Radio&t;&t; */
l_int|0x0000
multiline_comment|/* Monitor&t;&t; */
)brace
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|hw
r_struct
id|address_info
id|hw
suffix:semicolon
multiline_comment|/* hardware */
DECL|member|chip_name
r_char
op_star
id|chip_name
suffix:semicolon
DECL|member|xfer_count
r_int
id|xfer_count
suffix:semicolon
DECL|member|audio_mode
r_int
id|audio_mode
suffix:semicolon
DECL|member|open_mode
r_int
id|open_mode
suffix:semicolon
DECL|member|audio_flags
r_int
id|audio_flags
suffix:semicolon
DECL|member|record_dev
r_int
id|record_dev
suffix:semicolon
DECL|member|playback_dev
r_int
id|playback_dev
suffix:semicolon
DECL|member|dev_no
r_int
id|dev_no
suffix:semicolon
multiline_comment|/* Mixer parameters */
DECL|member|levels
r_int
r_int
op_star
id|levels
suffix:semicolon
multiline_comment|/* cache of volume settings   */
DECL|member|recmask
r_int
id|recmask
suffix:semicolon
multiline_comment|/* currently enabled recording device! */
DECL|member|supported_devices
r_int
id|supported_devices
suffix:semicolon
multiline_comment|/* SUPPORTED_MIXER_DEVICES    */
DECL|member|rec_devices
r_int
id|rec_devices
suffix:semicolon
multiline_comment|/* POSSIBLE_RECORDING_DEVICES */
macro_line|#ifdef CONFIG_ARCH_NETWINDER
DECL|member|slider_vol
r_int
r_int
id|slider_vol
suffix:semicolon
multiline_comment|/* hardware slider volume     */
DECL|member|handset_detect
r_int
r_int
id|handset_detect
suffix:colon
l_int|1
suffix:semicolon
DECL|member|telephone_detect
r_int
r_int
id|telephone_detect
suffix:colon
l_int|1
suffix:semicolon
DECL|member|no_autoselect
r_int
r_int
id|no_autoselect
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* handset/telephone autoselects a path */
DECL|member|spkr_mute_state
r_int
r_int
id|spkr_mute_state
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* set by ioctl or autoselect */
DECL|member|line_mute_state
r_int
r_int
id|line_mute_state
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* set by ioctl or autoselect */
DECL|member|use_slider
r_int
r_int
id|use_slider
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* use slider setting for o/p vol */
macro_line|#endif
DECL|typedef|wavnc_info
)brace
id|wavnc_info
suffix:semicolon
DECL|struct|wavnc_port_info
r_typedef
r_struct
id|wavnc_port_info
(brace
DECL|member|open_mode
r_int
id|open_mode
suffix:semicolon
DECL|member|speed
r_int
id|speed
suffix:semicolon
DECL|member|channels
r_int
id|channels
suffix:semicolon
DECL|member|audio_format
r_int
id|audio_format
suffix:semicolon
DECL|typedef|wavnc_port_info
)brace
id|wavnc_port_info
suffix:semicolon
DECL|variable|nr_waveartist_devs
r_static
r_int
id|nr_waveartist_devs
suffix:semicolon
DECL|variable|adev_info
r_static
id|wavnc_info
id|adev_info
(braket
id|MAX_AUDIO_DEV
)braket
suffix:semicolon
DECL|variable|waveartist_lock
r_static
id|spinlock_t
id|waveartist_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
macro_line|#ifndef machine_is_netwinder
DECL|macro|machine_is_netwinder
mdefine_line|#define machine_is_netwinder() 0
macro_line|#endif
DECL|variable|vnc_timer
r_static
r_struct
id|timer_list
id|vnc_timer
suffix:semicolon
r_static
r_void
id|vnc_configure_mixer
c_func
(paren
id|wavnc_info
op_star
id|devc
)paren
suffix:semicolon
r_static
r_int
id|vnc_private_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
suffix:semicolon
r_static
r_void
id|vnc_slider_tick
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_inline
r_void
DECL|function|waveartist_set_ctlr
id|waveartist_set_ctlr
c_func
(paren
r_struct
id|address_info
op_star
id|hw
comma
r_int
r_char
id|clear
comma
r_int
r_char
id|set
)paren
(brace
r_int
r_int
id|ctlr_port
op_assign
id|hw-&gt;io_base
op_plus
id|CTLR
suffix:semicolon
id|clear
op_assign
op_complement
id|clear
op_amp
id|inb
c_func
(paren
id|ctlr_port
)paren
suffix:semicolon
id|outb
c_func
(paren
id|clear
op_or
id|set
comma
id|ctlr_port
)paren
suffix:semicolon
)brace
multiline_comment|/* Toggle IRQ acknowledge line&n; */
r_static
r_inline
r_void
DECL|function|waveartist_iack
id|waveartist_iack
c_func
(paren
id|wavnc_info
op_star
id|devc
)paren
(brace
r_int
r_int
id|ctlr_port
op_assign
id|devc-&gt;hw.io_base
op_plus
id|CTLR
suffix:semicolon
r_int
id|old_ctlr
suffix:semicolon
id|old_ctlr
op_assign
id|inb
c_func
(paren
id|ctlr_port
)paren
op_amp
op_complement
id|IRQ_ACK
suffix:semicolon
id|outb
c_func
(paren
id|old_ctlr
op_or
id|IRQ_ACK
comma
id|ctlr_port
)paren
suffix:semicolon
id|outb
c_func
(paren
id|old_ctlr
comma
id|ctlr_port
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|waveartist_sleep
id|waveartist_sleep
c_func
(paren
r_int
id|timeout_ms
)paren
(brace
r_int
r_int
id|timeout
op_assign
id|timeout_ms
op_star
l_int|10
op_star
id|HZ
op_div
l_int|100
suffix:semicolon
r_do
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|timeout
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|waveartist_reset
id|waveartist_reset
c_func
(paren
id|wavnc_info
op_star
id|devc
)paren
(brace
r_struct
id|address_info
op_star
id|hw
op_assign
op_amp
id|devc-&gt;hw
suffix:semicolon
r_int
r_int
id|timeout
comma
id|res
op_assign
op_minus
l_int|1
suffix:semicolon
id|waveartist_set_ctlr
c_func
(paren
id|hw
comma
op_minus
l_int|1
comma
id|RESET
)paren
suffix:semicolon
id|waveartist_sleep
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|waveartist_set_ctlr
c_func
(paren
id|hw
comma
id|RESET
comma
l_int|0
)paren
suffix:semicolon
id|timeout
op_assign
l_int|500
suffix:semicolon
r_do
(brace
id|mdelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|hw-&gt;io_base
op_plus
id|STATR
)paren
op_amp
id|CMD_RF
)paren
(brace
id|res
op_assign
id|inw
c_func
(paren
id|hw-&gt;io_base
op_plus
id|CMDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_eq
l_int|0x55aa
)paren
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_decrement
id|timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timeout
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;WaveArtist: reset timeout &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_ne
(paren
r_int
r_int
)paren
op_minus
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;(res=%04X)&quot;
comma
id|res
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Helper function to send and receive words&n; * from WaveArtist.  It handles all the handshaking&n; * and can send or receive multiple words.&n; */
r_static
r_int
DECL|function|waveartist_cmd
id|waveartist_cmd
c_func
(paren
id|wavnc_info
op_star
id|devc
comma
r_int
id|nr_cmd
comma
r_int
r_int
op_star
id|cmd
comma
r_int
id|nr_resp
comma
r_int
r_int
op_star
id|resp
)paren
(brace
r_int
r_int
id|io_base
op_assign
id|devc-&gt;hw.io_base
suffix:semicolon
r_int
r_int
id|timed_out
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_CMD
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;waveartist_cmd: cmd=&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_cmd
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%04X &quot;
comma
id|cmd
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inb
c_func
(paren
id|io_base
op_plus
id|STATR
)paren
op_amp
id|CMD_RF
)paren
(brace
r_int
id|old_data
suffix:semicolon
multiline_comment|/* flush the port&n;&t;&t; */
id|old_data
op_assign
id|inw
c_func
(paren
id|io_base
op_plus
id|CMDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_CMD
)paren
id|printk
c_func
(paren
l_string|&quot;flushed %04X...&quot;
comma
id|old_data
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|timed_out
op_logical_and
id|i
OL
id|nr_cmd
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|5000
suffix:semicolon
id|count
suffix:semicolon
id|count
op_decrement
)paren
r_if
c_cond
(paren
id|inb
c_func
(paren
id|io_base
op_plus
id|STATR
)paren
op_amp
id|CMD_WE
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
id|timed_out
op_assign
l_int|1
suffix:semicolon
r_else
id|outw
c_func
(paren
id|cmd
(braket
id|i
)braket
comma
id|io_base
op_plus
id|CMDR
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|timed_out
op_logical_and
id|i
OL
id|nr_resp
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|5000
suffix:semicolon
id|count
suffix:semicolon
id|count
op_decrement
)paren
r_if
c_cond
(paren
id|inb
c_func
(paren
id|io_base
op_plus
id|STATR
)paren
op_amp
id|CMD_RF
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
id|timed_out
op_assign
l_int|1
suffix:semicolon
r_else
id|resp
(braket
id|i
)braket
op_assign
id|inw
c_func
(paren
id|io_base
op_plus
id|CMDR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_CMD
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|timed_out
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;waveartist_cmd: resp=&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_resp
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%04X &quot;
comma
id|resp
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;waveartist_cmd: timed out&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|timed_out
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Send one command word&n; */
r_static
r_inline
r_int
DECL|function|waveartist_cmd1
id|waveartist_cmd1
c_func
(paren
id|wavnc_info
op_star
id|devc
comma
r_int
r_int
id|cmd
)paren
(brace
r_return
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|1
comma
op_amp
id|cmd
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Send one command, receive one word&n; */
r_static
r_inline
r_int
r_int
DECL|function|waveartist_cmd1_r
id|waveartist_cmd1_r
c_func
(paren
id|wavnc_info
op_star
id|devc
comma
r_int
r_int
id|cmd
)paren
(brace
r_int
r_int
id|ret
suffix:semicolon
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|1
comma
op_amp
id|cmd
comma
l_int|1
comma
op_amp
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * Send a double command, receive one&n; * word (and throw it away)&n; */
r_static
r_inline
r_int
DECL|function|waveartist_cmd2
id|waveartist_cmd2
c_func
(paren
id|wavnc_info
op_star
id|devc
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
r_int
id|vals
(braket
l_int|2
)braket
suffix:semicolon
id|vals
(braket
l_int|0
)braket
op_assign
id|cmd
suffix:semicolon
id|vals
(braket
l_int|1
)braket
op_assign
id|arg
suffix:semicolon
r_return
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|2
comma
id|vals
comma
l_int|1
comma
id|vals
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Send a triple command&n; */
r_static
r_inline
r_int
DECL|function|waveartist_cmd3
id|waveartist_cmd3
c_func
(paren
id|wavnc_info
op_star
id|devc
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg1
comma
r_int
r_int
id|arg2
)paren
(brace
r_int
r_int
id|vals
(braket
l_int|3
)braket
suffix:semicolon
id|vals
(braket
l_int|0
)braket
op_assign
id|cmd
suffix:semicolon
id|vals
(braket
l_int|1
)braket
op_assign
id|arg1
suffix:semicolon
id|vals
(braket
l_int|2
)braket
op_assign
id|arg2
suffix:semicolon
r_return
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|3
comma
id|vals
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|waveartist_getrev
id|waveartist_getrev
c_func
(paren
id|wavnc_info
op_star
id|devc
comma
r_char
op_star
id|rev
)paren
(brace
r_int
r_int
id|temp
(braket
l_int|2
)braket
suffix:semicolon
r_int
r_int
id|cmd
op_assign
id|WACMD_GETREV
suffix:semicolon
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|1
comma
op_amp
id|cmd
comma
l_int|2
comma
id|temp
)paren
suffix:semicolon
id|rev
(braket
l_int|0
)braket
op_assign
id|temp
(braket
l_int|0
)braket
op_rshift
l_int|8
suffix:semicolon
id|rev
(braket
l_int|1
)braket
op_assign
id|temp
(braket
l_int|0
)braket
op_amp
l_int|255
suffix:semicolon
id|rev
(braket
l_int|2
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
id|temp
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_static
r_void
id|waveartist_halt_output
c_func
(paren
r_int
id|dev
)paren
suffix:semicolon
r_static
r_void
id|waveartist_halt_input
c_func
(paren
r_int
id|dev
)paren
suffix:semicolon
r_static
r_void
id|waveartist_halt
c_func
(paren
r_int
id|dev
)paren
suffix:semicolon
r_static
r_void
id|waveartist_trigger
c_func
(paren
r_int
id|dev
comma
r_int
id|state
)paren
suffix:semicolon
r_static
r_int
DECL|function|waveartist_open
id|waveartist_open
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
(brace
id|wavnc_info
op_star
id|devc
suffix:semicolon
id|wavnc_port_info
op_star
id|portc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|dev
OL
l_int|0
op_logical_or
id|dev
op_ge
id|num_audiodevs
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|portc-&gt;open_mode
op_logical_or
(paren
id|devc-&gt;open_mode
op_amp
id|mode
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|devc-&gt;audio_mode
op_assign
l_int|0
suffix:semicolon
id|devc-&gt;open_mode
op_or_assign
id|mode
suffix:semicolon
id|portc-&gt;open_mode
op_assign
id|mode
suffix:semicolon
id|waveartist_trigger
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|OPEN_READ
)paren
id|devc-&gt;record_dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|OPEN_WRITE
)paren
id|devc-&gt;playback_dev
op_assign
id|dev
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|waveartist_close
id|waveartist_close
c_func
(paren
r_int
id|dev
)paren
(brace
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|wavnc_port_info
op_star
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
id|waveartist_halt
c_func
(paren
id|dev
)paren
suffix:semicolon
id|devc-&gt;audio_mode
op_assign
l_int|0
suffix:semicolon
id|devc-&gt;open_mode
op_and_assign
op_complement
id|portc-&gt;open_mode
suffix:semicolon
id|portc-&gt;open_mode
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|waveartist_output_block
id|waveartist_output_block
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|__count
comma
r_int
id|intrflag
)paren
(brace
id|wavnc_port_info
op_star
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|count
op_assign
id|__count
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_OUT
)paren
id|printk
c_func
(paren
l_string|&quot;waveartist: output block, buf=0x%lx, count=0x%x...&bslash;n&quot;
comma
id|buf
comma
id|count
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * 16 bit data&n;&t; */
r_if
c_cond
(paren
id|portc-&gt;audio_format
op_amp
(paren
id|AFMT_S16_LE
op_or
id|AFMT_S16_BE
)paren
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|portc-&gt;channels
OG
l_int|1
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_sub_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;audio_mode
op_amp
id|PCM_ENABLE_OUTPUT
op_logical_and
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|flags
op_amp
id|DMA_AUTOMODE
op_logical_and
id|intrflag
op_logical_and
id|count
op_eq
id|devc-&gt;xfer_count
)paren
(brace
id|devc-&gt;audio_mode
op_or_assign
id|PCM_ENABLE_OUTPUT
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Auto DMA mode on. No need to react&n;&t;&t;&t; */
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * set sample count&n;&t; */
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_OUTPUTSIZE
comma
id|count
)paren
suffix:semicolon
id|devc-&gt;xfer_count
op_assign
id|count
suffix:semicolon
id|devc-&gt;audio_mode
op_or_assign
id|PCM_ENABLE_OUTPUT
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|waveartist_start_input
id|waveartist_start_input
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|__count
comma
r_int
id|intrflag
)paren
(brace
id|wavnc_port_info
op_star
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|count
op_assign
id|__count
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_IN
)paren
id|printk
c_func
(paren
l_string|&quot;waveartist: start input, buf=0x%lx, count=0x%x...&bslash;n&quot;
comma
id|buf
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|portc-&gt;audio_format
op_amp
(paren
id|AFMT_S16_LE
op_or
id|AFMT_S16_BE
)paren
)paren
multiline_comment|/* 16 bit data */
id|count
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|portc-&gt;channels
OG
l_int|1
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_sub_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;audio_mode
op_amp
id|PCM_ENABLE_INPUT
op_logical_and
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|flags
op_amp
id|DMA_AUTOMODE
op_logical_and
id|intrflag
op_logical_and
id|count
op_eq
id|devc-&gt;xfer_count
)paren
(brace
id|devc-&gt;audio_mode
op_or_assign
id|PCM_ENABLE_INPUT
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Auto DMA mode on. No need to react&n;&t;&t;&t; */
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * set sample count&n;&t; */
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_INPUTSIZE
comma
id|count
)paren
suffix:semicolon
id|devc-&gt;xfer_count
op_assign
id|count
suffix:semicolon
id|devc-&gt;audio_mode
op_or_assign
id|PCM_ENABLE_INPUT
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|waveartist_ioctl
id|waveartist_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|waveartist_get_speed
id|waveartist_get_speed
c_func
(paren
id|wavnc_port_info
op_star
id|portc
)paren
(brace
r_int
r_int
id|speed
suffix:semicolon
multiline_comment|/*&n;&t; * program the speed, channels, bits&n;&t; */
r_if
c_cond
(paren
id|portc-&gt;speed
op_eq
l_int|8000
)paren
id|speed
op_assign
l_int|0x2E71
suffix:semicolon
r_else
r_if
c_cond
(paren
id|portc-&gt;speed
op_eq
l_int|11025
)paren
id|speed
op_assign
l_int|0x4000
suffix:semicolon
r_else
r_if
c_cond
(paren
id|portc-&gt;speed
op_eq
l_int|22050
)paren
id|speed
op_assign
l_int|0x8000
suffix:semicolon
r_else
r_if
c_cond
(paren
id|portc-&gt;speed
op_eq
l_int|44100
)paren
id|speed
op_assign
l_int|0x0
suffix:semicolon
r_else
(brace
multiline_comment|/*&n;&t;&t; * non-standard - just calculate&n;&t;&t; */
id|speed
op_assign
id|portc-&gt;speed
op_lshift
l_int|16
suffix:semicolon
id|speed
op_assign
(paren
id|speed
op_div
l_int|44100
)paren
op_amp
l_int|65535
suffix:semicolon
)brace
r_return
id|speed
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|waveartist_get_bits
id|waveartist_get_bits
c_func
(paren
id|wavnc_port_info
op_star
id|portc
)paren
(brace
r_int
r_int
id|bits
suffix:semicolon
r_if
c_cond
(paren
id|portc-&gt;audio_format
op_eq
id|AFMT_S16_LE
)paren
id|bits
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|portc-&gt;audio_format
op_eq
id|AFMT_S8
)paren
id|bits
op_assign
l_int|0
suffix:semicolon
r_else
id|bits
op_assign
l_int|2
suffix:semicolon
singleline_comment|//default AFMT_U8
r_return
id|bits
suffix:semicolon
)brace
r_static
r_int
DECL|function|waveartist_prepare_for_input
id|waveartist_prepare_for_input
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|wavnc_port_info
op_star
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
r_int
r_int
id|speed
comma
id|bits
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;audio_mode
)paren
r_return
l_int|0
suffix:semicolon
id|speed
op_assign
id|waveartist_get_speed
c_func
(paren
id|portc
)paren
suffix:semicolon
id|bits
op_assign
id|waveartist_get_bits
c_func
(paren
id|portc
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_INPUTFORMAT
comma
id|bits
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: error setting the &quot;
l_string|&quot;record format to %d&bslash;n&quot;
comma
id|portc-&gt;audio_format
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_INPUTCHANNELS
comma
id|portc-&gt;channels
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: error setting record &quot;
l_string|&quot;to %d channels&bslash;n&quot;
comma
id|portc-&gt;channels
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * write cmd SetSampleSpeedTimeConstant&n;&t; */
r_if
c_cond
(paren
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_INPUTSPEED
comma
id|speed
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: error setting the record &quot;
l_string|&quot;speed to %dHz.&bslash;n&quot;
comma
id|portc-&gt;speed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_INPUTDMA
comma
l_int|1
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: error setting the record &quot;
l_string|&quot;data path to 0x%X&bslash;n&quot;
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_INPUTFORMAT
comma
id|bits
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: error setting the record &quot;
l_string|&quot;format to %d&bslash;n&quot;
comma
id|portc-&gt;audio_format
)paren
suffix:semicolon
id|devc-&gt;xfer_count
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
id|waveartist_halt_input
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_INTR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;WA CTLR reg: 0x%02X.&bslash;n&quot;
comma
id|inb
c_func
(paren
id|devc-&gt;hw.io_base
op_plus
id|CTLR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;WA STAT reg: 0x%02X.&bslash;n&quot;
comma
id|inb
c_func
(paren
id|devc-&gt;hw.io_base
op_plus
id|STATR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;WA IRQS reg: 0x%02X.&bslash;n&quot;
comma
id|inb
c_func
(paren
id|devc-&gt;hw.io_base
op_plus
id|IRQSTAT
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|waveartist_prepare_for_output
id|waveartist_prepare_for_output
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|wavnc_port_info
op_star
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
r_int
r_int
id|speed
comma
id|bits
suffix:semicolon
multiline_comment|/*&n;&t; * program the speed, channels, bits&n;&t; */
id|speed
op_assign
id|waveartist_get_speed
c_func
(paren
id|portc
)paren
suffix:semicolon
id|bits
op_assign
id|waveartist_get_bits
c_func
(paren
id|portc
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_OUTPUTSPEED
comma
id|speed
)paren
op_logical_and
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_OUTPUTSPEED
comma
id|speed
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: error setting the playback &quot;
l_string|&quot;speed to %dHz.&bslash;n&quot;
comma
id|portc-&gt;speed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_OUTPUTCHANNELS
comma
id|portc-&gt;channels
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: error setting the playback &quot;
l_string|&quot;to %d channels&bslash;n&quot;
comma
id|portc-&gt;channels
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_OUTPUTDMA
comma
l_int|0
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: error setting the playback &quot;
l_string|&quot;data path to 0x%X&bslash;n&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waveartist_cmd2
c_func
(paren
id|devc
comma
id|WACMD_OUTPUTFORMAT
comma
id|bits
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: error setting the playback &quot;
l_string|&quot;format to %d&bslash;n&quot;
comma
id|portc-&gt;audio_format
)paren
suffix:semicolon
id|devc-&gt;xfer_count
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
id|waveartist_halt_output
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_INTR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;WA CTLR reg: 0x%02X.&bslash;n&quot;
comma
id|inb
c_func
(paren
id|devc-&gt;hw.io_base
op_plus
id|CTLR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;WA STAT reg: 0x%02X.&bslash;n&quot;
comma
id|inb
c_func
(paren
id|devc-&gt;hw.io_base
op_plus
id|STATR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;WA IRQS reg: 0x%02X.&bslash;n&quot;
comma
id|inb
c_func
(paren
id|devc-&gt;hw.io_base
op_plus
id|IRQSTAT
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|waveartist_halt
id|waveartist_halt
c_func
(paren
r_int
id|dev
)paren
(brace
id|wavnc_port_info
op_star
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
id|wavnc_info
op_star
id|devc
suffix:semicolon
r_if
c_cond
(paren
id|portc-&gt;open_mode
op_amp
id|OPEN_WRITE
)paren
id|waveartist_halt_output
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|portc-&gt;open_mode
op_amp
id|OPEN_READ
)paren
id|waveartist_halt_input
c_func
(paren
id|dev
)paren
suffix:semicolon
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|devc-&gt;audio_mode
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|waveartist_halt_input
id|waveartist_halt_input
c_func
(paren
r_int
id|dev
)paren
(brace
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Stop capture&n;&t; */
id|waveartist_cmd1
c_func
(paren
id|devc
comma
id|WACMD_INPUTSTOP
)paren
suffix:semicolon
id|devc-&gt;audio_mode
op_and_assign
op_complement
id|PCM_ENABLE_INPUT
suffix:semicolon
multiline_comment|/*&n;&t; * Clear interrupt by toggling&n;&t; * the IRQ_ACK bit in CTRL&n;&t; */
r_if
c_cond
(paren
id|inb
c_func
(paren
id|devc-&gt;hw.io_base
op_plus
id|STATR
)paren
op_amp
id|IRQ_REQ
)paren
id|waveartist_iack
c_func
(paren
id|devc
)paren
suffix:semicolon
singleline_comment|//&t;devc-&gt;audio_mode &amp;= ~PCM_ENABLE_INPUT;
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|waveartist_halt_output
id|waveartist_halt_output
c_func
(paren
r_int
id|dev
)paren
(brace
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
id|waveartist_cmd1
c_func
(paren
id|devc
comma
id|WACMD_OUTPUTSTOP
)paren
suffix:semicolon
id|devc-&gt;audio_mode
op_and_assign
op_complement
id|PCM_ENABLE_OUTPUT
suffix:semicolon
multiline_comment|/*&n;&t; * Clear interrupt by toggling&n;&t; * the IRQ_ACK bit in CTRL&n;&t; */
r_if
c_cond
(paren
id|inb
c_func
(paren
id|devc-&gt;hw.io_base
op_plus
id|STATR
)paren
op_amp
id|IRQ_REQ
)paren
id|waveartist_iack
c_func
(paren
id|devc
)paren
suffix:semicolon
singleline_comment|//&t;devc-&gt;audio_mode &amp;= ~PCM_ENABLE_OUTPUT;
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|waveartist_trigger
id|waveartist_trigger
c_func
(paren
r_int
id|dev
comma
r_int
id|state
)paren
(brace
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|wavnc_port_info
op_star
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_TRIGGER
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;wavnc: audio trigger &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_amp
id|PCM_ENABLE_INPUT
)paren
id|printk
c_func
(paren
l_string|&quot;in &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_amp
id|PCM_ENABLE_OUTPUT
)paren
id|printk
c_func
(paren
l_string|&quot;out&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
id|state
op_and_assign
id|devc-&gt;audio_mode
suffix:semicolon
r_if
c_cond
(paren
id|portc-&gt;open_mode
op_amp
id|OPEN_READ
op_logical_and
id|state
op_amp
id|PCM_ENABLE_INPUT
)paren
multiline_comment|/*&n;&t;&t; * enable ADC Data Transfer to PC&n;&t;&t; */
id|waveartist_cmd1
c_func
(paren
id|devc
comma
id|WACMD_INPUTSTART
)paren
suffix:semicolon
r_if
c_cond
(paren
id|portc-&gt;open_mode
op_amp
id|OPEN_WRITE
op_logical_and
id|state
op_amp
id|PCM_ENABLE_OUTPUT
)paren
multiline_comment|/*&n;&t;&t; * enable DAC data transfer from PC&n;&t;&t; */
id|waveartist_cmd1
c_func
(paren
id|devc
comma
id|WACMD_OUTPUTSTART
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|waveartist_set_speed
id|waveartist_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|arg
)paren
(brace
id|wavnc_port_info
op_star
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
r_if
c_cond
(paren
id|arg
op_le
l_int|0
)paren
r_return
id|portc-&gt;speed
suffix:semicolon
r_if
c_cond
(paren
id|arg
OL
l_int|5000
)paren
id|arg
op_assign
l_int|5000
suffix:semicolon
r_if
c_cond
(paren
id|arg
OG
l_int|44100
)paren
id|arg
op_assign
l_int|44100
suffix:semicolon
id|portc-&gt;speed
op_assign
id|arg
suffix:semicolon
r_return
id|portc-&gt;speed
suffix:semicolon
)brace
r_static
r_int
DECL|function|waveartist_set_channels
id|waveartist_set_channels
c_func
(paren
r_int
id|dev
comma
r_int
id|arg
)paren
(brace
id|wavnc_port_info
op_star
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
r_if
c_cond
(paren
id|arg
op_ne
l_int|1
op_logical_and
id|arg
op_ne
l_int|2
)paren
r_return
id|portc-&gt;channels
suffix:semicolon
id|portc-&gt;channels
op_assign
id|arg
suffix:semicolon
r_return
id|arg
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|waveartist_set_bits
id|waveartist_set_bits
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|arg
)paren
(brace
id|wavnc_port_info
op_star
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|portc
suffix:semicolon
r_if
c_cond
(paren
id|arg
op_eq
l_int|0
)paren
r_return
id|portc-&gt;audio_format
suffix:semicolon
r_if
c_cond
(paren
(paren
id|arg
op_ne
id|AFMT_U8
)paren
op_logical_and
(paren
id|arg
op_ne
id|AFMT_S16_LE
)paren
op_logical_and
(paren
id|arg
op_ne
id|AFMT_S8
)paren
)paren
id|arg
op_assign
id|AFMT_U8
suffix:semicolon
id|portc-&gt;audio_format
op_assign
id|arg
suffix:semicolon
r_return
id|arg
suffix:semicolon
)brace
DECL|variable|waveartist_audio_driver
r_static
r_struct
id|audio_driver
id|waveartist_audio_driver
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|open
suffix:colon
id|waveartist_open
comma
id|close
suffix:colon
id|waveartist_close
comma
id|output_block
suffix:colon
id|waveartist_output_block
comma
id|start_input
suffix:colon
id|waveartist_start_input
comma
id|ioctl
suffix:colon
id|waveartist_ioctl
comma
id|prepare_for_input
suffix:colon
id|waveartist_prepare_for_input
comma
id|prepare_for_output
suffix:colon
id|waveartist_prepare_for_output
comma
id|halt_io
suffix:colon
id|waveartist_halt
comma
id|halt_input
suffix:colon
id|waveartist_halt_input
comma
id|halt_output
suffix:colon
id|waveartist_halt_output
comma
id|trigger
suffix:colon
id|waveartist_trigger
comma
id|set_speed
suffix:colon
id|waveartist_set_speed
comma
id|set_bits
suffix:colon
id|waveartist_set_bits
comma
id|set_channels
suffix:colon
id|waveartist_set_channels
)brace
suffix:semicolon
r_static
r_void
DECL|function|waveartist_intr
id|waveartist_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|dev_id
suffix:semicolon
r_int
id|irqstatus
comma
id|status
suffix:semicolon
id|irqstatus
op_assign
id|inb
c_func
(paren
id|devc-&gt;hw.io_base
op_plus
id|IRQSTAT
)paren
suffix:semicolon
id|status
op_assign
id|inb
c_func
(paren
id|devc-&gt;hw.io_base
op_plus
id|STATR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_INTR
)paren
id|printk
c_func
(paren
l_string|&quot;waveartist_intr: stat=%02x, irqstat=%02x&bslash;n&quot;
comma
id|status
comma
id|irqstatus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|IRQ_REQ
)paren
multiline_comment|/* Clear interrupt */
id|waveartist_iack
c_func
(paren
id|devc
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: unexpected interrupt&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irqstatus
op_amp
l_int|0x01
)paren
(brace
r_int
id|temp
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* PCM buffer done&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|status
op_amp
id|DMA0
)paren
op_logical_and
(paren
id|devc-&gt;audio_mode
op_amp
id|PCM_ENABLE_OUTPUT
)paren
)paren
(brace
id|DMAbuf_outputintr
c_func
(paren
id|devc-&gt;playback_dev
comma
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|DMA1
)paren
op_logical_and
(paren
id|devc-&gt;audio_mode
op_amp
id|PCM_ENABLE_INPUT
)paren
)paren
(brace
id|DMAbuf_inputintr
c_func
(paren
id|devc-&gt;record_dev
)paren
suffix:semicolon
id|temp
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp
)paren
singleline_comment|//default:
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: Unknown interrupt&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irqstatus
op_amp
l_int|0x2
)paren
singleline_comment|// We do not use SB mode natively...
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: Unexpected SB interrupt...&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* -------------------------------------------------------------------------&n; * Mixer stuff&n; */
r_static
r_void
DECL|function|waveartist_mixer_update
id|waveartist_mixer_update
c_func
(paren
id|wavnc_info
op_star
id|devc
comma
r_int
id|whichDev
)paren
(brace
r_int
r_int
id|mask
comma
id|reg_l
comma
id|reg_r
suffix:semicolon
r_int
r_int
id|lev_left
comma
id|lev_right
suffix:semicolon
r_int
r_int
id|vals
(braket
l_int|3
)braket
suffix:semicolon
id|lev_left
op_assign
id|devc-&gt;levels
(braket
id|whichDev
)braket
op_amp
l_int|0xff
suffix:semicolon
id|lev_right
op_assign
id|devc-&gt;levels
(braket
id|whichDev
)braket
op_rshift
l_int|8
suffix:semicolon
DECL|macro|SCALE
mdefine_line|#define SCALE(lev,max)&t;((lev) * (max) / 100)
r_if
c_cond
(paren
id|machine_is_netwinder
c_func
(paren
)paren
op_logical_and
id|whichDev
op_eq
id|SOUND_MIXER_PHONEOUT
)paren
id|whichDev
op_assign
id|SOUND_MIXER_VOLUME
suffix:semicolon
r_switch
c_cond
(paren
id|whichDev
)paren
(brace
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
id|mask
op_assign
l_int|0x000e
suffix:semicolon
id|reg_l
op_assign
l_int|0x200
suffix:semicolon
id|reg_r
op_assign
l_int|0x600
suffix:semicolon
id|lev_left
op_assign
id|SCALE
c_func
(paren
id|lev_left
comma
l_int|7
)paren
op_lshift
l_int|1
suffix:semicolon
id|lev_right
op_assign
id|SCALE
c_func
(paren
id|lev_right
comma
l_int|7
)paren
op_lshift
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_LINE
suffix:colon
r_if
c_cond
(paren
(paren
id|devc-&gt;recmask
op_amp
id|SOUND_MASK_LINE
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|mask
op_assign
l_int|0x07c0
suffix:semicolon
id|reg_l
op_assign
l_int|0x000
suffix:semicolon
id|reg_r
op_assign
l_int|0x400
suffix:semicolon
id|lev_left
op_assign
id|SCALE
c_func
(paren
id|lev_left
comma
l_int|31
)paren
op_lshift
l_int|6
suffix:semicolon
id|lev_right
op_assign
id|SCALE
c_func
(paren
id|lev_right
comma
l_int|31
)paren
op_lshift
l_int|6
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_MIC
suffix:colon
r_if
c_cond
(paren
(paren
id|devc-&gt;recmask
op_amp
id|SOUND_MASK_MIC
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|mask
op_assign
l_int|0x0030
suffix:semicolon
id|reg_l
op_assign
l_int|0x200
suffix:semicolon
id|reg_r
op_assign
l_int|0x600
suffix:semicolon
id|lev_left
op_assign
id|SCALE
c_func
(paren
id|lev_left
comma
l_int|3
)paren
op_lshift
l_int|4
suffix:semicolon
id|lev_right
op_assign
id|SCALE
c_func
(paren
id|lev_right
comma
l_int|3
)paren
op_lshift
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_RECLEV
suffix:colon
id|mask
op_assign
l_int|0x000f
suffix:semicolon
id|reg_l
op_assign
l_int|0x300
suffix:semicolon
id|reg_r
op_assign
l_int|0x700
suffix:semicolon
id|lev_left
op_assign
id|SCALE
c_func
(paren
id|lev_left
comma
l_int|10
)paren
suffix:semicolon
id|lev_right
op_assign
id|SCALE
c_func
(paren
id|lev_right
comma
l_int|10
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_LINE1
suffix:colon
r_if
c_cond
(paren
(paren
id|devc-&gt;recmask
op_amp
id|SOUND_MASK_LINE1
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|mask
op_assign
l_int|0x003e
suffix:semicolon
id|reg_l
op_assign
l_int|0x000
suffix:semicolon
id|reg_r
op_assign
l_int|0x400
suffix:semicolon
id|lev_left
op_assign
id|SCALE
c_func
(paren
id|lev_left
comma
l_int|31
)paren
op_lshift
l_int|1
suffix:semicolon
id|lev_right
op_assign
id|SCALE
c_func
(paren
id|lev_right
comma
l_int|31
)paren
op_lshift
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_PCM
suffix:colon
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_LEVEL
comma
id|SCALE
c_func
(paren
id|lev_left
comma
l_int|32767
)paren
comma
id|SCALE
c_func
(paren
id|lev_right
comma
l_int|32767
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|SOUND_MIXER_SYNTH
suffix:colon
id|waveartist_cmd3
c_func
(paren
id|devc
comma
l_int|0x0100
op_or
id|WACMD_SET_LEVEL
comma
id|SCALE
c_func
(paren
id|lev_left
comma
l_int|32767
)paren
comma
id|SCALE
c_func
(paren
id|lev_right
comma
l_int|32767
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
multiline_comment|/* read left setting */
id|vals
(braket
l_int|0
)braket
op_assign
id|reg_l
op_plus
id|WACMD_GET_LEVEL
suffix:semicolon
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|1
comma
id|vals
comma
l_int|1
comma
id|vals
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* read right setting */
id|vals
(braket
l_int|0
)braket
op_assign
id|reg_r
op_plus
l_int|0x30
suffix:semicolon
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|1
comma
id|vals
comma
l_int|1
comma
id|vals
op_plus
l_int|2
)paren
suffix:semicolon
id|vals
(braket
l_int|1
)braket
op_assign
(paren
id|vals
(braket
l_int|1
)braket
op_amp
op_complement
id|mask
)paren
op_or
(paren
id|lev_left
op_amp
id|mask
)paren
suffix:semicolon
id|vals
(braket
l_int|2
)braket
op_assign
(paren
id|vals
(braket
l_int|2
)braket
op_amp
op_complement
id|mask
)paren
op_or
(paren
id|lev_right
op_amp
id|mask
)paren
suffix:semicolon
multiline_comment|/* write left,right back */
id|vals
(braket
l_int|0
)braket
op_assign
id|WACMD_SET_MIXER
suffix:semicolon
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|3
comma
id|vals
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|waveartist_select_input
id|waveartist_select_input
c_func
(paren
id|wavnc_info
op_star
id|devc
comma
r_int
r_int
id|input
)paren
(brace
r_int
r_int
id|vals
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/*&n;&t; * Get reg 9&n;&t; */
id|vals
(braket
l_int|0
)braket
op_assign
l_int|0x0830
suffix:semicolon
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|1
comma
id|vals
comma
l_int|1
comma
id|vals
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Get reg 10, only so that we can write it back.&n;&t; */
id|vals
(braket
l_int|0
)braket
op_assign
l_int|0x0930
suffix:semicolon
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|1
comma
id|vals
comma
l_int|1
comma
id|vals
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_MIXER
)paren
id|printk
c_func
(paren
l_string|&quot;RECSRC: old left: 0x%04X, old right: 0x%04X.&bslash;n&quot;
comma
id|vals
(braket
l_int|1
)braket
op_amp
l_int|0x07
comma
(paren
id|vals
(braket
l_int|1
)braket
op_rshift
l_int|3
)paren
op_amp
l_int|0x07
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * kill current left/right mux input select&n;&t; */
id|vals
(braket
l_int|1
)braket
op_and_assign
op_complement
l_int|0x03F
suffix:semicolon
r_switch
c_cond
(paren
id|input
)paren
(brace
r_case
id|SOUND_MASK_MIC
suffix:colon
multiline_comment|/*&n;&t;&t; * right=mic, left=mic&n;&t;&t; */
id|vals
(braket
l_int|1
)braket
op_or_assign
l_int|0x002D
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MASK_LINE1
suffix:colon
multiline_comment|/*&n;&t;&t; * right=none, left=Aux1;&n;&t;&t; */
id|vals
(braket
l_int|1
)braket
op_or_assign
l_int|0x0004
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MASK_LINE
suffix:colon
multiline_comment|/*&n;&t;&t; * right=Line, left=Line;&n;&t;&t; */
id|vals
(braket
l_int|1
)braket
op_or_assign
l_int|0x0012
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_MIXER
)paren
id|printk
c_func
(paren
l_string|&quot;RECSRC %d: left=0x%04X, right=0x%04X.&bslash;n&quot;
comma
id|input
comma
id|vals
(braket
l_int|1
)braket
op_amp
l_int|0x07
comma
(paren
id|vals
(braket
l_int|1
)braket
op_rshift
l_int|3
)paren
op_amp
l_int|0x07
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * and finally - write the reg pair back....&n;&t; */
id|vals
(braket
l_int|0
)braket
op_assign
id|WACMD_SET_MIXER
suffix:semicolon
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|3
comma
id|vals
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|waveartist_mixer_set
id|waveartist_mixer_set
c_func
(paren
id|wavnc_info
op_star
id|devc
comma
r_int
id|whichDev
comma
r_int
r_int
id|level
)paren
(brace
r_int
r_int
id|lev_left
op_assign
id|level
op_amp
l_int|0x007f
suffix:semicolon
r_int
r_int
id|lev_right
op_assign
(paren
id|level
op_amp
l_int|0x7f00
)paren
op_rshift
l_int|8
suffix:semicolon
r_int
id|left
comma
id|right
comma
id|devmask
suffix:semicolon
id|left
op_assign
id|level
op_amp
l_int|0x7f
suffix:semicolon
id|right
op_assign
(paren
id|level
op_amp
l_int|0x7f00
)paren
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_MIXER
)paren
id|printk
c_func
(paren
l_string|&quot;wa_mixer_set(dev=%d, level=%X)&bslash;n&quot;
comma
id|whichDev
comma
id|level
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|whichDev
)paren
(brace
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
multiline_comment|/* master volume (0-7)       */
r_case
id|SOUND_MIXER_LINE
suffix:colon
multiline_comment|/* external line (0-31)      */
r_case
id|SOUND_MIXER_MIC
suffix:colon
multiline_comment|/* mono mic (0-3)            */
r_case
id|SOUND_MIXER_RECLEV
suffix:colon
multiline_comment|/* recording level (0-7)     */
r_case
id|SOUND_MIXER_LINE1
suffix:colon
multiline_comment|/* mono external aux1 (0-31) */
r_case
id|SOUND_MIXER_PCM
suffix:colon
multiline_comment|/* Waveartist PCM (0-32767)  */
r_case
id|SOUND_MIXER_SYNTH
suffix:colon
multiline_comment|/* internal synth (0-31)     */
r_case
id|SOUND_MIXER_IMIX
suffix:colon
multiline_comment|/* recording feedback        */
id|devc-&gt;levels
(braket
id|whichDev
)braket
op_assign
id|lev_left
op_or
id|lev_right
op_lshift
l_int|8
suffix:semicolon
id|waveartist_mixer_update
c_func
(paren
id|devc
comma
id|whichDev
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Select recording input source&n;&t; */
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
id|devmask
op_assign
id|level
op_amp
id|devc-&gt;rec_devices
suffix:semicolon
macro_line|#ifdef CONFIG_ARCH_NETWINDER
r_if
c_cond
(paren
id|machine_is_netwinder
c_func
(paren
)paren
)paren
id|vnc_configure_mixer
c_func
(paren
id|devc
)paren
suffix:semicolon
r_else
macro_line|#endif
(brace
id|waveartist_select_input
c_func
(paren
id|devc
comma
id|level
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * if record monitoring is on, make sure the bit is set&n;&t;&t;&t; */
r_if
c_cond
(paren
id|devc-&gt;levels
(braket
id|SOUND_MIXER_IMIX
)braket
)paren
id|waveartist_mixer_update
c_func
(paren
id|devc
comma
id|SOUND_MIXER_IMIX
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * do not save in &quot;levels&quot;, return current setting&n;&t;&t; */
r_return
id|devc-&gt;recmask
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|devc-&gt;levels
(braket
id|whichDev
)braket
suffix:semicolon
)brace
r_static
r_void
DECL|function|waveartist_mixer_reset
id|waveartist_mixer_reset
c_func
(paren
id|wavnc_info
op_star
id|devc
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_MIXER
)paren
id|printk
c_func
(paren
l_string|&quot;%s: mixer_reset&bslash;n&quot;
comma
id|devc-&gt;hw.name
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * reset mixer cmd&n;&t; */
id|waveartist_cmd1
c_func
(paren
id|devc
comma
id|WACMD_RST_MIXER
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * set input for ADC to come from &squot;quiet&squot;&n;&t; * turn on default modes&n;&t; */
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_MIXER
comma
l_int|0x9800
comma
l_int|0xa836
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * set mixer input select to none, RX filter gains 0 db&n;&t; */
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_MIXER
comma
l_int|0x4c00
comma
l_int|0x8c00
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * set bit 0 reg 2 to 1 - unmute MonoOut&n;&t; */
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_MIXER
comma
l_int|0x2801
comma
l_int|0x6800
)paren
suffix:semicolon
multiline_comment|/* set default input device = internal mic&n;&t; * current recording device = none&n;&t; */
id|devc-&gt;recmask
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
id|waveartist_mixer_update
c_func
(paren
id|devc
comma
id|i
)paren
suffix:semicolon
id|devc-&gt;supported_devices
op_assign
id|SUPPORTED_MIXER_DEVICES
suffix:semicolon
id|devc-&gt;rec_devices
op_assign
id|POSSIBLE_RECORDING_DEVICES
suffix:semicolon
r_if
c_cond
(paren
id|machine_is_netwinder
c_func
(paren
)paren
)paren
(brace
id|devc-&gt;supported_devices
op_or_assign
id|SOUND_MASK_PHONEIN
op_or
id|SOUND_MASK_PHONEOUT
suffix:semicolon
id|devc-&gt;rec_devices
op_or_assign
id|SOUND_MASK_PHONEIN
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|waveartist_mixer_ioctl
id|waveartist_mixer_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|ret
suffix:semicolon
macro_line|#ifdef CONFIG_ARCH_NETWINDER
r_if
c_cond
(paren
id|machine_is_netwinder
c_func
(paren
)paren
)paren
(brace
id|ret
op_assign
id|vnc_private_ioctl
c_func
(paren
id|dev
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
op_minus
id|ENOIOCTLCMD
)paren
r_return
id|ret
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
(paren
id|cmd
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_eq
l_char|&squot;M&squot;
)paren
(brace
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_amp
id|_SIOC_WRITE
)paren
(brace
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|waveartist_mixer_set
c_func
(paren
id|devc
comma
id|cmd
op_amp
l_int|0xff
comma
id|val
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t; * Return parameters&n;&t;&t;&t; */
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
id|ret
op_assign
id|devc-&gt;recmask
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
id|ret
op_assign
id|devc-&gt;supported_devices
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
id|ret
op_assign
id|devc-&gt;supported_devices
op_amp
op_complement
(paren
id|SOUND_MASK_SPEAKER
op_or
id|SOUND_MASK_IMIX
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
id|ret
op_assign
id|devc-&gt;rec_devices
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
id|ret
op_assign
id|SOUND_CAP_EXCL_INPUT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|cmd
op_amp
l_int|0xff
)paren
OL
id|SOUND_MIXER_NRDEVICES
)paren
id|ret
op_assign
id|devc-&gt;levels
(braket
id|cmd
op_amp
l_int|0xff
)braket
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|ret
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
DECL|variable|waveartist_mixer_operations
r_static
r_struct
id|mixer_operations
id|waveartist_mixer_operations
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|id
suffix:colon
l_string|&quot;WaveArtist&quot;
comma
id|name
suffix:colon
l_string|&quot;WaveArtist NetWinder&quot;
comma
id|ioctl
suffix:colon
id|waveartist_mixer_ioctl
)brace
suffix:semicolon
DECL|function|waveartist_init
r_static
r_int
id|__init
id|waveartist_init
c_func
(paren
id|wavnc_info
op_star
id|devc
)paren
(brace
id|wavnc_port_info
op_star
id|portc
suffix:semicolon
r_char
id|rev
(braket
l_int|3
)braket
comma
id|dev_name
(braket
l_int|64
)braket
suffix:semicolon
r_int
id|my_dev
suffix:semicolon
r_if
c_cond
(paren
id|waveartist_reset
c_func
(paren
id|devc
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|sprintf
c_func
(paren
id|dev_name
comma
l_string|&quot;%s (%s&quot;
comma
id|devc-&gt;hw.name
comma
id|devc-&gt;chip_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waveartist_getrev
c_func
(paren
id|devc
comma
id|rev
)paren
)paren
(brace
id|strcat
c_func
(paren
id|dev_name
comma
l_string|&quot; rev. &quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|dev_name
comma
id|rev
)paren
suffix:semicolon
)brace
id|strcat
c_func
(paren
id|dev_name
comma
l_string|&quot;)&quot;
)paren
suffix:semicolon
id|conf_printf2
c_func
(paren
id|dev_name
comma
id|devc-&gt;hw.io_base
comma
id|devc-&gt;hw.irq
comma
id|devc-&gt;hw.dma
comma
id|devc-&gt;hw.dma2
)paren
suffix:semicolon
id|portc
op_assign
(paren
id|wavnc_port_info
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|wavnc_port_info
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|portc
op_eq
l_int|NULL
)paren
r_goto
id|nomem
suffix:semicolon
id|memset
c_func
(paren
id|portc
comma
l_int|0
comma
r_sizeof
(paren
id|wavnc_port_info
)paren
)paren
suffix:semicolon
id|my_dev
op_assign
id|sound_install_audiodrv
c_func
(paren
id|AUDIO_DRIVER_VERSION
comma
id|dev_name
comma
op_amp
id|waveartist_audio_driver
comma
r_sizeof
(paren
r_struct
id|audio_driver
)paren
comma
id|devc-&gt;audio_flags
comma
id|AFMT_U8
op_or
id|AFMT_S16_LE
op_or
id|AFMT_S8
comma
id|devc
comma
id|devc-&gt;hw.dma
comma
id|devc-&gt;hw.dma2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|my_dev
OL
l_int|0
)paren
r_goto
id|free
suffix:semicolon
id|audio_devs
(braket
id|my_dev
)braket
op_member_access_from_pointer
id|portc
op_assign
id|portc
suffix:semicolon
id|waveartist_mixer_reset
c_func
(paren
id|devc
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * clear any pending interrupt&n;&t; */
id|waveartist_iack
c_func
(paren
id|devc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|devc-&gt;hw.irq
comma
id|waveartist_intr
comma
l_int|0
comma
id|devc-&gt;hw.name
comma
id|devc
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: IRQ %d in use&bslash;n&quot;
comma
id|devc-&gt;hw.name
comma
id|devc-&gt;hw.irq
)paren
suffix:semicolon
r_goto
id|uninstall
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sound_alloc_dma
c_func
(paren
id|devc-&gt;hw.dma
comma
id|devc-&gt;hw.name
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Can&squot;t allocate DMA%d&bslash;n&quot;
comma
id|devc-&gt;hw.name
comma
id|devc-&gt;hw.dma
)paren
suffix:semicolon
r_goto
id|uninstall_irq
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devc-&gt;hw.dma
op_ne
id|devc-&gt;hw.dma2
op_logical_and
id|devc-&gt;hw.dma2
op_ne
id|NO_DMA
)paren
r_if
c_cond
(paren
id|sound_alloc_dma
c_func
(paren
id|devc-&gt;hw.dma2
comma
id|devc-&gt;hw.name
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: can&squot;t allocate DMA%d&bslash;n&quot;
comma
id|devc-&gt;hw.name
comma
id|devc-&gt;hw.dma2
)paren
suffix:semicolon
r_goto
id|uninstall_dma
suffix:semicolon
)brace
id|waveartist_set_ctlr
c_func
(paren
op_amp
id|devc-&gt;hw
comma
l_int|0
comma
id|DMA1_IE
op_or
id|DMA0_IE
)paren
suffix:semicolon
id|audio_devs
(braket
id|my_dev
)braket
op_member_access_from_pointer
id|mixer_dev
op_assign
id|sound_install_mixer
c_func
(paren
id|MIXER_DRIVER_VERSION
comma
id|dev_name
comma
op_amp
id|waveartist_mixer_operations
comma
r_sizeof
(paren
r_struct
id|mixer_operations
)paren
comma
id|devc
)paren
suffix:semicolon
r_return
id|my_dev
suffix:semicolon
id|uninstall_dma
suffix:colon
id|sound_free_dma
c_func
(paren
id|devc-&gt;hw.dma
)paren
suffix:semicolon
id|uninstall_irq
suffix:colon
id|free_irq
c_func
(paren
id|devc-&gt;hw.irq
comma
id|devc
)paren
suffix:semicolon
id|uninstall
suffix:colon
id|sound_unload_audiodev
c_func
(paren
id|my_dev
)paren
suffix:semicolon
id|free
suffix:colon
id|kfree
c_func
(paren
id|portc
)paren
suffix:semicolon
id|nomem
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|probe_waveartist
r_static
r_int
id|__init
id|probe_waveartist
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|wavnc_info
op_star
id|devc
op_assign
op_amp
id|adev_info
(braket
id|nr_waveartist_devs
)braket
suffix:semicolon
r_if
c_cond
(paren
id|nr_waveartist_devs
op_ge
id|MAX_AUDIO_DEV
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: too many audio devices&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|hw_config-&gt;io_base
comma
l_int|15
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;WaveArtist: I/O port conflict&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw_config-&gt;irq
OG
id|_ISA_IRQ
c_func
(paren
l_int|15
)paren
op_logical_or
id|hw_config-&gt;irq
OL
id|_ISA_IRQ
c_func
(paren
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;WaveArtist: Bad IRQ %d&bslash;n&quot;
comma
id|hw_config-&gt;irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw_config-&gt;dma
op_ne
id|_ISA_DMA
c_func
(paren
l_int|3
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;WaveArtist: Bad DMA %d&bslash;n&quot;
comma
id|hw_config-&gt;dma
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|hw_config-&gt;name
op_assign
l_string|&quot;WaveArtist&quot;
suffix:semicolon
id|devc-&gt;hw
op_assign
op_star
id|hw_config
suffix:semicolon
id|devc-&gt;open_mode
op_assign
l_int|0
suffix:semicolon
id|devc-&gt;chip_name
op_assign
l_string|&quot;RWA-010&quot;
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|attach_waveartist
r_static
r_void
id|__init
id|attach_waveartist
c_func
(paren
r_struct
id|address_info
op_star
id|hw
)paren
(brace
id|wavnc_info
op_star
id|devc
op_assign
op_amp
id|adev_info
(braket
id|nr_waveartist_devs
)braket
suffix:semicolon
multiline_comment|/*&n;&t; * NOTE! If irq &lt; 0, there is another driver which has allocated the&n;&t; *   IRQ so that this driver doesn&squot;t need to allocate/deallocate it.&n;&t; *   The actually used IRQ is ABS(irq).&n;&t; */
id|devc-&gt;hw
op_assign
op_star
id|hw
suffix:semicolon
id|devc-&gt;hw.irq
op_assign
(paren
id|hw-&gt;irq
OG
l_int|0
)paren
ques
c_cond
id|hw-&gt;irq
suffix:colon
l_int|0
suffix:semicolon
id|devc-&gt;open_mode
op_assign
l_int|0
suffix:semicolon
id|devc-&gt;playback_dev
op_assign
l_int|0
suffix:semicolon
id|devc-&gt;record_dev
op_assign
l_int|0
suffix:semicolon
id|devc-&gt;audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|devc-&gt;levels
op_assign
id|levels
suffix:semicolon
r_if
c_cond
(paren
id|hw-&gt;dma
op_ne
id|hw-&gt;dma2
op_logical_and
id|hw-&gt;dma2
op_ne
id|NO_DMA
)paren
id|devc-&gt;audio_flags
op_or_assign
id|DMA_DUPLEX
suffix:semicolon
id|request_region
c_func
(paren
id|hw-&gt;io_base
comma
l_int|15
comma
id|devc-&gt;hw.name
)paren
suffix:semicolon
id|devc-&gt;dev_no
op_assign
id|waveartist_init
c_func
(paren
id|devc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dev_no
OL
l_int|0
)paren
id|release_region
c_func
(paren
id|hw-&gt;io_base
comma
l_int|15
)paren
suffix:semicolon
r_else
(brace
macro_line|#ifdef CONFIG_ARCH_NETWINDER
r_if
c_cond
(paren
id|machine_is_netwinder
c_func
(paren
)paren
)paren
(brace
id|init_timer
c_func
(paren
op_amp
id|vnc_timer
)paren
suffix:semicolon
id|vnc_timer.function
op_assign
id|vnc_slider_tick
suffix:semicolon
id|vnc_timer.expires
op_assign
id|jiffies
suffix:semicolon
id|vnc_timer.data
op_assign
id|nr_waveartist_devs
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|vnc_timer
)paren
suffix:semicolon
id|vnc_configure_mixer
c_func
(paren
id|devc
)paren
suffix:semicolon
)brace
macro_line|#endif
id|nr_waveartist_devs
op_add_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|unload_waveartist
r_static
r_void
id|__exit
id|unload_waveartist
c_func
(paren
r_struct
id|address_info
op_star
id|hw
)paren
(brace
id|wavnc_info
op_star
id|devc
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_waveartist_devs
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|hw-&gt;io_base
op_eq
id|adev_info
(braket
id|i
)braket
dot
id|hw.io_base
)paren
(brace
id|devc
op_assign
id|adev_info
op_plus
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devc
op_ne
l_int|NULL
)paren
(brace
r_int
id|mixer
suffix:semicolon
macro_line|#ifdef CONFIG_ARCH_NETWINDER
r_if
c_cond
(paren
id|machine_is_netwinder
c_func
(paren
)paren
)paren
id|del_timer
c_func
(paren
op_amp
id|vnc_timer
)paren
suffix:semicolon
macro_line|#endif
id|release_region
c_func
(paren
id|devc-&gt;hw.io_base
comma
l_int|15
)paren
suffix:semicolon
id|waveartist_set_ctlr
c_func
(paren
op_amp
id|devc-&gt;hw
comma
id|DMA1_IE
op_or
id|DMA0_IE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;hw.irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|devc-&gt;hw.irq
comma
id|devc
)paren
suffix:semicolon
id|sound_free_dma
c_func
(paren
id|devc-&gt;hw.dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;hw.dma
op_ne
id|devc-&gt;hw.dma2
op_logical_and
id|devc-&gt;hw.dma2
op_ne
id|NO_DMA
)paren
id|sound_free_dma
c_func
(paren
id|devc-&gt;hw.dma2
)paren
suffix:semicolon
id|mixer
op_assign
id|audio_devs
(braket
id|devc-&gt;dev_no
)braket
op_member_access_from_pointer
id|mixer_dev
suffix:semicolon
r_if
c_cond
(paren
id|mixer
op_ge
l_int|0
)paren
id|sound_unload_mixerdev
c_func
(paren
id|mixer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dev_no
op_ge
l_int|0
)paren
id|sound_unload_audiodev
c_func
(paren
id|devc-&gt;dev_no
)paren
suffix:semicolon
id|nr_waveartist_devs
op_sub_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|nr_waveartist_devs
suffix:semicolon
id|i
op_increment
)paren
id|adev_info
(braket
id|i
)braket
op_assign
id|adev_info
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;waveartist: can&squot;t find device &quot;
l_string|&quot;to unload&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Rebel.com Netwinder specifics...&n; */
DECL|macro|VNC_TIMER_PERIOD
mdefine_line|#define&t;VNC_TIMER_PERIOD (HZ/4)&t;
singleline_comment|//check slider 4 times/sec
DECL|macro|MIXER_PRIVATE3_RESET
mdefine_line|#define&t;MIXER_PRIVATE3_RESET&t;0x53570000
DECL|macro|MIXER_PRIVATE3_READ
mdefine_line|#define&t;MIXER_PRIVATE3_READ&t;0x53570001
DECL|macro|MIXER_PRIVATE3_WRITE
mdefine_line|#define&t;MIXER_PRIVATE3_WRITE&t;0x53570002
DECL|macro|VNC_MUTE_INTERNAL_SPKR
mdefine_line|#define&t;VNC_MUTE_INTERNAL_SPKR&t;0x01&t;
singleline_comment|//the sw mute on/off control bit
DECL|macro|VNC_MUTE_LINE_OUT
mdefine_line|#define&t;VNC_MUTE_LINE_OUT&t;0x10
DECL|macro|VNC_PHONE_DETECT
mdefine_line|#define VNC_PHONE_DETECT&t;0x20
DECL|macro|VNC_HANDSET_DETECT
mdefine_line|#define VNC_HANDSET_DETECT&t;0x40
DECL|macro|VNC_DISABLE_AUTOSWITCH
mdefine_line|#define VNC_DISABLE_AUTOSWITCH&t;0x80
r_extern
id|spinlock_t
id|gpio_lock
suffix:semicolon
r_static
r_inline
r_void
DECL|function|vnc_update_spkr_mute
id|vnc_update_spkr_mute
c_func
(paren
id|wavnc_info
op_star
id|devc
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gpio_lock
comma
id|flags
)paren
suffix:semicolon
id|cpld_modify
c_func
(paren
id|CPLD_UNMUTE
comma
id|devc-&gt;spkr_mute_state
ques
c_cond
l_int|0
suffix:colon
id|CPLD_UNMUTE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gpio_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vnc_mute_lout
id|vnc_mute_lout
c_func
(paren
id|wavnc_info
op_star
id|devc
comma
r_int
id|mute
)paren
(brace
)brace
r_static
r_int
DECL|function|vnc_volume_slider
id|vnc_volume_slider
c_func
(paren
id|wavnc_info
op_star
id|devc
)paren
(brace
r_static
r_int
r_int
id|old_slider_volume
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|volume
op_assign
l_int|255
suffix:semicolon
op_star
id|CSR_TIMER1_LOAD
op_assign
l_int|0x00ffffff
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xFF
comma
l_int|0x201
)paren
suffix:semicolon
op_star
id|CSR_TIMER1_CNTL
op_assign
id|TIMER_CNTL_ENABLE
op_or
id|TIMER_CNTL_DIV1
suffix:semicolon
r_while
c_loop
(paren
id|volume
op_logical_and
(paren
id|inb
c_func
(paren
l_int|0x201
)paren
op_amp
l_int|0x01
)paren
)paren
id|volume
op_decrement
suffix:semicolon
op_star
id|CSR_TIMER1_CNTL
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|volume
op_assign
l_int|0x00ffffff
op_minus
op_star
id|CSR_TIMER1_VALUE
suffix:semicolon
macro_line|#ifndef REVERSE
id|volume
op_assign
l_int|150
op_minus
(paren
id|volume
op_rshift
l_int|5
)paren
suffix:semicolon
macro_line|#else
id|volume
op_assign
(paren
id|volume
op_rshift
l_int|6
)paren
op_minus
l_int|25
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|volume
OL
l_int|0
)paren
id|volume
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|volume
OG
l_int|100
)paren
id|volume
op_assign
l_int|100
suffix:semicolon
multiline_comment|/*&n;&t; * slider quite often reads +-8, so debounce this random noise&n;&t; */
r_if
c_cond
(paren
id|abs
c_func
(paren
id|volume
op_minus
id|old_slider_volume
)paren
OG
l_int|7
)paren
(brace
id|old_slider_volume
op_assign
id|volume
suffix:semicolon
r_if
c_cond
(paren
id|debug_flg
op_amp
id|DEBUG_MIXER
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Slider volume: %d.&bslash;n&quot;
comma
id|volume
)paren
suffix:semicolon
)brace
r_return
id|old_slider_volume
suffix:semicolon
)brace
r_static
r_void
DECL|function|vnc_configure_mixer
id|vnc_configure_mixer
c_func
(paren
id|wavnc_info
op_star
id|devc
)paren
(brace
id|u_int
id|vals
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devc-&gt;no_autoselect
)paren
(brace
r_if
c_cond
(paren
id|devc-&gt;handset_detect
)paren
(brace
id|devc-&gt;recmask
op_assign
id|SOUND_MASK_LINE1
suffix:semicolon
id|devc-&gt;spkr_mute_state
op_assign
id|devc-&gt;line_mute_state
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|devc-&gt;telephone_detect
)paren
(brace
id|devc-&gt;recmask
op_assign
id|SOUND_MASK_PHONEIN
suffix:semicolon
id|devc-&gt;spkr_mute_state
op_assign
id|devc-&gt;line_mute_state
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* unless someone has asked for LINE-IN,&n;&t;&t;&t; * we default to MIC&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|devc-&gt;recmask
op_amp
id|SOUND_MASK_LINE
)paren
op_eq
l_int|0
)paren
id|devc-&gt;recmask
op_assign
id|SOUND_MASK_MIC
suffix:semicolon
id|devc-&gt;spkr_mute_state
op_assign
id|devc-&gt;line_mute_state
op_assign
l_int|0
suffix:semicolon
)brace
id|vnc_update_spkr_mute
c_func
(paren
id|devc
)paren
suffix:semicolon
id|vnc_mute_lout
c_func
(paren
id|devc
comma
id|devc-&gt;spkr_mute_state
)paren
suffix:semicolon
)brace
multiline_comment|/* Ok.  At this point, we have done the autoswitch logic, or we&n;&t; * have had a command from an ioctl.  We have a valid devc-&gt;recmask.&n;&t; * Now we have to connect up the hardware to reflect the recmask.&n;&t; */
id|vals
(braket
l_int|1
)braket
op_assign
id|waveartist_cmd1_r
c_func
(paren
id|devc
comma
id|WACMD_GET_LEVEL
op_or
l_int|0x800
)paren
suffix:semicolon
id|vals
(braket
l_int|2
)braket
op_assign
id|waveartist_cmd1_r
c_func
(paren
id|devc
comma
id|WACMD_GET_LEVEL
op_or
l_int|0x900
)paren
suffix:semicolon
id|vals
(braket
l_int|1
)braket
op_and_assign
op_complement
l_int|0x3f
suffix:semicolon
r_switch
c_cond
(paren
id|devc-&gt;recmask
)paren
(brace
r_case
id|SOUND_MASK_MIC
suffix:colon
multiline_comment|/* builtin mic */
id|waveartist_cmd1
c_func
(paren
id|devc
comma
id|WACMD_SET_MONO
op_or
l_int|0x100
)paren
suffix:semicolon
multiline_comment|/* right */
id|vals
(braket
l_int|1
)braket
op_or_assign
l_int|0x28
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MASK_LINE1
suffix:colon
multiline_comment|/* out handset */
id|waveartist_cmd1
c_func
(paren
id|devc
comma
id|WACMD_SET_MONO
)paren
suffix:semicolon
multiline_comment|/* left */
id|vals
(braket
l_int|1
)braket
op_or_assign
l_int|0x05
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MASK_PHONEIN
suffix:colon
multiline_comment|/* our telephone mic */
id|waveartist_cmd1
c_func
(paren
id|devc
comma
id|WACMD_SET_MONO
)paren
suffix:semicolon
multiline_comment|/* left */
id|vals
(braket
l_int|1
)braket
op_or_assign
l_int|0x04
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MASK_LINE
suffix:colon
multiline_comment|/* stereo line in */
id|vals
(braket
l_int|1
)braket
op_or_assign
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
id|vals
(braket
l_int|0
)braket
op_assign
id|WACMD_SET_MIXER
suffix:semicolon
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|3
comma
id|vals
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|waveartist_mixer_update
c_func
(paren
id|devc
comma
id|SOUND_MIXER_IMIX
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|vnc_slider
id|vnc_slider
c_func
(paren
id|wavnc_info
op_star
id|devc
)paren
(brace
r_int
r_int
id|slider_volume
suffix:semicolon
r_int
r_int
id|temp
comma
id|old_hs
comma
id|old_td
suffix:semicolon
multiline_comment|/*&n;&t; * read the &quot;buttons&quot; state.&n;&t; *  Bit 4 = handset present,&n;&t; *  Bit 5 = offhook&n;&t; */
id|temp
op_assign
id|inb
c_func
(paren
l_int|0x201
)paren
op_amp
l_int|0x30
suffix:semicolon
id|old_hs
op_assign
id|devc-&gt;handset_detect
suffix:semicolon
id|old_td
op_assign
id|devc-&gt;telephone_detect
suffix:semicolon
id|devc-&gt;handset_detect
op_assign
op_logical_neg
(paren
id|temp
op_amp
l_int|0x10
)paren
suffix:semicolon
id|devc-&gt;telephone_detect
op_assign
op_logical_neg
op_logical_neg
(paren
id|temp
op_amp
l_int|0x20
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devc-&gt;no_autoselect
op_logical_and
(paren
id|old_hs
op_ne
id|devc-&gt;handset_detect
op_logical_or
id|old_td
op_ne
id|devc-&gt;telephone_detect
)paren
)paren
id|vnc_configure_mixer
c_func
(paren
id|devc
)paren
suffix:semicolon
id|slider_volume
op_assign
id|vnc_volume_slider
c_func
(paren
id|devc
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If we&squot;re using software controlled volume, and&n;&t; * the slider moves by more than 20%, then we&n;&t; * switch back to slider controlled volume.&n;&t; */
r_if
c_cond
(paren
id|abs
c_func
(paren
id|devc-&gt;slider_vol
op_minus
id|slider_volume
)paren
OG
l_int|20
)paren
id|devc-&gt;use_slider
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * use only left channel&n;&t; */
id|temp
op_assign
id|levels
(braket
id|SOUND_MIXER_VOLUME
)braket
op_amp
l_int|0xFF
suffix:semicolon
r_if
c_cond
(paren
id|slider_volume
op_ne
id|temp
op_logical_and
id|devc-&gt;use_slider
)paren
(brace
id|devc-&gt;slider_vol
op_assign
id|slider_volume
suffix:semicolon
id|waveartist_mixer_set
c_func
(paren
id|devc
comma
id|SOUND_MIXER_VOLUME
comma
id|slider_volume
op_or
id|slider_volume
op_lshift
l_int|8
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|vnc_slider_tick
id|vnc_slider_tick
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_int
id|next_timeout
suffix:semicolon
r_if
c_cond
(paren
id|vnc_slider
c_func
(paren
id|adev_info
op_plus
id|data
)paren
)paren
id|next_timeout
op_assign
l_int|5
suffix:semicolon
singleline_comment|// mixer reported change
r_else
id|next_timeout
op_assign
id|VNC_TIMER_PERIOD
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|vnc_timer
comma
id|jiffies
op_plus
id|next_timeout
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|vnc_private_ioctl
id|vnc_private_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
id|wavnc_info
op_star
id|devc
op_assign
(paren
id|wavnc_info
op_star
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|val
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOUND_MIXER_PRIVATE1
suffix:colon
(brace
id|u_int
id|prev_spkr_mute
comma
id|prev_line_mute
comma
id|prev_auto_state
suffix:semicolon
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* check if parameter is logical */
r_if
c_cond
(paren
id|val
op_amp
op_complement
(paren
id|VNC_MUTE_INTERNAL_SPKR
op_or
id|VNC_MUTE_LINE_OUT
op_or
id|VNC_DISABLE_AUTOSWITCH
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|prev_auto_state
op_assign
id|devc-&gt;no_autoselect
suffix:semicolon
id|prev_spkr_mute
op_assign
id|devc-&gt;spkr_mute_state
suffix:semicolon
id|prev_line_mute
op_assign
id|devc-&gt;line_mute_state
suffix:semicolon
id|devc-&gt;no_autoselect
op_assign
(paren
id|val
op_amp
id|VNC_DISABLE_AUTOSWITCH
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|devc-&gt;spkr_mute_state
op_assign
(paren
id|val
op_amp
id|VNC_MUTE_INTERNAL_SPKR
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|devc-&gt;line_mute_state
op_assign
(paren
id|val
op_amp
id|VNC_MUTE_LINE_OUT
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|prev_spkr_mute
op_ne
id|devc-&gt;spkr_mute_state
)paren
id|vnc_update_spkr_mute
c_func
(paren
id|devc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prev_line_mute
op_ne
id|devc-&gt;line_mute_state
)paren
id|vnc_mute_lout
c_func
(paren
id|devc
comma
id|devc-&gt;line_mute_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prev_auto_state
op_ne
id|devc-&gt;no_autoselect
)paren
id|vnc_configure_mixer
c_func
(paren
id|devc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SOUND_MIXER_PRIVATE2
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
DECL|macro|VNC_SOUND_PAUSE
mdefine_line|#define VNC_SOUND_PAUSE         0x53    
singleline_comment|//to pause the DSP
DECL|macro|VNC_SOUND_RESUME
mdefine_line|#define VNC_SOUND_RESUME        0x57    
singleline_comment|//to unpause the DSP
r_case
id|VNC_SOUND_PAUSE
suffix:colon
id|waveartist_cmd1
c_func
(paren
id|devc
comma
l_int|0x16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VNC_SOUND_RESUME
suffix:colon
id|waveartist_cmd1
c_func
(paren
id|devc
comma
l_int|0x18
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/* private ioctl to allow bulk access to waveartist */
r_case
id|SOUND_MIXER_PRIVATE3
suffix:colon
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|mixer_reg
(braket
l_int|15
)braket
comma
id|i
comma
id|val
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|mixer_reg
comma
(paren
r_void
op_star
)paren
id|val
comma
r_sizeof
(paren
id|mixer_reg
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|mixer_reg
(braket
l_int|14
)braket
)paren
(brace
r_case
id|MIXER_PRIVATE3_RESET
suffix:colon
id|waveartist_mixer_reset
c_func
(paren
id|devc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MIXER_PRIVATE3_WRITE
suffix:colon
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_MIXER
comma
id|mixer_reg
(braket
l_int|0
)braket
comma
id|mixer_reg
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_MIXER
comma
id|mixer_reg
(braket
l_int|1
)braket
comma
id|mixer_reg
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_MIXER
comma
id|mixer_reg
(braket
l_int|2
)braket
comma
id|mixer_reg
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_MIXER
comma
id|mixer_reg
(braket
l_int|3
)braket
comma
id|mixer_reg
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_MIXER
comma
id|mixer_reg
(braket
l_int|8
)braket
comma
id|mixer_reg
(braket
l_int|9
)braket
)paren
suffix:semicolon
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_LEVEL
comma
id|mixer_reg
(braket
l_int|10
)braket
comma
id|mixer_reg
(braket
l_int|11
)braket
)paren
suffix:semicolon
id|waveartist_cmd3
c_func
(paren
id|devc
comma
id|WACMD_SET_LEVEL
comma
id|mixer_reg
(braket
l_int|12
)braket
comma
id|mixer_reg
(braket
l_int|13
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MIXER_PRIVATE3_READ
suffix:colon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x30
suffix:semicolon
id|i
OL
l_int|14
op_lshift
l_int|8
suffix:semicolon
id|i
op_add_assign
l_int|1
op_lshift
l_int|8
)paren
id|waveartist_cmd
c_func
(paren
id|devc
comma
l_int|1
comma
op_amp
id|i
comma
l_int|1
comma
id|mixer_reg
op_plus
(paren
id|i
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|waveartist_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|val
comma
id|mixer_reg
comma
r_sizeof
(paren
id|mixer_reg
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* read back the state from PRIVATE1 */
r_case
id|SOUND_MIXER_PRIVATE4
suffix:colon
id|val
op_assign
(paren
id|devc-&gt;spkr_mute_state
ques
c_cond
id|VNC_MUTE_INTERNAL_SPKR
suffix:colon
l_int|0
)paren
op_or
(paren
id|devc-&gt;line_mute_state
ques
c_cond
id|VNC_MUTE_LINE_OUT
suffix:colon
l_int|0
)paren
op_or
(paren
id|devc-&gt;handset_detect
ques
c_cond
id|VNC_HANDSET_DETECT
suffix:colon
l_int|0
)paren
op_or
(paren
id|devc-&gt;telephone_detect
ques
c_cond
id|VNC_PHONE_DETECT
suffix:colon
l_int|0
)paren
op_or
(paren
id|devc-&gt;no_autoselect
ques
c_cond
id|VNC_DISABLE_AUTOSWITCH
suffix:colon
l_int|0
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|cmd
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_eq
l_char|&squot;M&squot;
)paren
(brace
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_amp
id|_SIOC_WRITE
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * special case for master volume: if we&n;&t;&t;&t; * received this call - switch from hw&n;&t;&t;&t; * volume control to a software volume&n;&t;&t;&t; * control, till the hw volume is modified&n;&t;&t;&t; * to signal that user wants to be back in&n;&t;&t;&t; * hardware...&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|cmd
op_amp
l_int|0xff
)paren
op_eq
id|SOUND_MIXER_VOLUME
)paren
id|devc-&gt;use_slider
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|cmd
op_amp
l_int|0xff
)paren
op_eq
id|SOUND_MIXER_STEREODEVS
)paren
(brace
id|val
op_assign
id|devc-&gt;supported_devices
op_amp
op_complement
(paren
id|SOUND_MASK_IMIX
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_LINE1
op_or
id|SOUND_MASK_PHONEIN
op_or
id|SOUND_MASK_PHONEOUT
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
DECL|variable|cfg
r_static
r_struct
id|address_info
id|cfg
suffix:semicolon
DECL|variable|attached
r_static
r_int
id|attached
suffix:semicolon
DECL|variable|io
r_static
r_int
id|__initdata
id|io
op_assign
l_int|0
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|__initdata
id|irq
op_assign
l_int|0
suffix:semicolon
DECL|variable|dma
r_static
r_int
id|__initdata
id|dma
op_assign
l_int|0
suffix:semicolon
DECL|variable|dma2
r_static
r_int
id|__initdata
id|dma2
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* IO base */
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* IRQ */
id|MODULE_PARM
c_func
(paren
id|dma
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* DMA */
id|MODULE_PARM
c_func
(paren
id|dma2
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* DMA2 */
DECL|function|init_waveartist
r_static
r_int
id|__init
id|init_waveartist
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|io
op_logical_and
id|machine_is_netwinder
c_func
(paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * The NetWinder WaveArtist is at a fixed address.&n;&t;&t; * If the user does not supply an address, use the&n;&t;&t; * well-known parameters.&n;&t;&t; */
id|io
op_assign
l_int|0x250
suffix:semicolon
id|irq
op_assign
l_int|12
suffix:semicolon
id|dma
op_assign
l_int|3
suffix:semicolon
id|dma2
op_assign
l_int|7
suffix:semicolon
)brace
id|cfg.io_base
op_assign
id|io
suffix:semicolon
id|cfg.irq
op_assign
id|irq
suffix:semicolon
id|cfg.dma
op_assign
id|dma
suffix:semicolon
id|cfg.dma2
op_assign
id|dma2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|probe_waveartist
c_func
(paren
op_amp
id|cfg
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|attach_waveartist
c_func
(paren
op_amp
id|cfg
)paren
suffix:semicolon
id|attached
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_waveartist
r_static
r_void
id|__exit
id|cleanup_waveartist
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|attached
)paren
id|unload_waveartist
c_func
(paren
op_amp
id|cfg
)paren
suffix:semicolon
)brace
DECL|variable|init_waveartist
id|module_init
c_func
(paren
id|init_waveartist
)paren
suffix:semicolon
DECL|variable|cleanup_waveartist
id|module_exit
c_func
(paren
id|cleanup_waveartist
)paren
suffix:semicolon
macro_line|#ifndef MODULE
DECL|function|setup_waveartist
r_static
r_int
id|__init
id|setup_waveartist
c_func
(paren
r_char
op_star
id|str
)paren
(brace
multiline_comment|/* io, irq, dma, dma2 */
r_int
id|ints
(braket
l_int|5
)braket
suffix:semicolon
id|str
op_assign
id|get_options
c_func
(paren
id|str
comma
id|ARRAY_SIZE
c_func
(paren
id|ints
)paren
comma
id|ints
)paren
suffix:semicolon
id|io
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
id|irq
op_assign
id|ints
(braket
l_int|2
)braket
suffix:semicolon
id|dma
op_assign
id|ints
(braket
l_int|3
)braket
suffix:semicolon
id|dma16
op_assign
id|ints
(braket
l_int|4
)braket
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;waveartist=&quot;
comma
id|setup_waveartist
)paren
suffix:semicolon
macro_line|#endif
eof
