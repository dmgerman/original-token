multiline_comment|/*&n; * Support for VIA 82Cxxx Audio Codecs&n; * Copyright 1999,2000 Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt;&n; *&n; * Distributed under the GNU GENERAL PUBLIC LICENSE (GPL) Version 2.&n; * See the &quot;COPYING&quot; file distributed with this software for more info.&n; *&n; * Documentation for this driver available as&n; * linux/Documentation/sound/via82cxxx.txt.&n; *&n; * Since the mixer is called from the OSS glue the kernel lock is always held&n; * on our AC97 mixing&n; */
DECL|macro|VIA_VERSION
mdefine_line|#define VIA_VERSION&t;&quot;1.1.2.1&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;sound_config.h&quot;
macro_line|#include &quot;soundmodule.h&quot;
macro_line|#include &quot;sb.h&quot;
macro_line|#include &quot;ac97.h&quot;
macro_line|#include &quot;mpu401.h&quot;
macro_line|#ifndef SOUND_LOCK
DECL|macro|SOUND_LOCK
mdefine_line|#define SOUND_LOCK do {} while (0)
DECL|macro|SOUND_LOCK_END
mdefine_line|#define SOUND_LOCK_END do {} while (0)
macro_line|#endif
DECL|macro|VIA_DEBUG
mdefine_line|#define VIA_DEBUG 0&t;/* define to 1 to enable debugging output and checks */
macro_line|#if VIA_DEBUG
multiline_comment|/* note: prints function name for you */
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(fmt, args...)
macro_line|#endif
DECL|macro|VIA_NDEBUG
mdefine_line|#define VIA_NDEBUG 0&t;/* define to 1 to disable lightweight runtime checks */
macro_line|#if VIA_NDEBUG
DECL|macro|assert
mdefine_line|#define assert(expr)
macro_line|#else
DECL|macro|assert
mdefine_line|#define assert(expr) &bslash;&n;        if(!(expr)) {&t;&t;&t;&t;&t;&bslash;&n;        printk( &quot;Assertion failed! %s,%s,%s,line=%d&bslash;n&quot;,&t;&bslash;&n;        #expr,__FILE__,__FUNCTION__,__LINE__);&t;&t;&bslash;&n;        }
macro_line|#endif
DECL|macro|arraysize
mdefine_line|#define arraysize(x)            (sizeof(x)/sizeof(*(x)))
DECL|macro|MAX_CARDS
mdefine_line|#define MAX_CARDS&t;2
DECL|macro|LINE_SIZE
mdefine_line|#define&t;LINE_SIZE&t;10
DECL|macro|VIA_CARD_NAME
mdefine_line|#define VIA_CARD_NAME&t;&quot;VIA 82Cxxx Audio driver &quot; VIA_VERSION
DECL|macro|VIA_MODULE_NAME
mdefine_line|#define VIA_MODULE_NAME &quot;via_audio&quot;
DECL|macro|PFX
mdefine_line|#define PFX&t;&t;VIA_MODULE_NAME &quot;: &quot;
DECL|macro|VIA_COUNTER_LIMIT
mdefine_line|#define VIA_COUNTER_LIMIT&t;100000
multiline_comment|/* 82C686 function 5 (audio codec) PCI configuration registers */
DECL|macro|VIA_FUNC_ENABLE
mdefine_line|#define VIA_FUNC_ENABLE&t;&t;0x42
DECL|macro|VIA_PNP_CONTROL
mdefine_line|#define VIA_PNP_CONTROL&t;&t;0x43
DECL|macro|VIA_AC97_CTRL
mdefine_line|#define VIA_AC97_CTRL&t;&t;0x80
multiline_comment|/* PCI configuration register bits and masks */
DECL|macro|VIA_CR40_AC97_READY
mdefine_line|#define VIA_CR40_AC97_READY&t;0x01
DECL|macro|VIA_CR40_AC97_LOW_POWER
mdefine_line|#define VIA_CR40_AC97_LOW_POWER&t;0x02
DECL|macro|VIA_CR40_SECONDARY_READY
mdefine_line|#define VIA_CR40_SECONDARY_READY 0x04
DECL|macro|VIA_CR41_ACLINK_ENABLE
mdefine_line|#define VIA_CR41_ACLINK_ENABLE&t;0x80
DECL|macro|VIA_CR42_SB_ENABLE
mdefine_line|#define VIA_CR42_SB_ENABLE&t;0x01
DECL|macro|VIA_CR42_MIDI_ENABLE
mdefine_line|#define VIA_CR42_MIDI_ENABLE&t;0x02
DECL|macro|VIA_CR42_FM_ENABLE
mdefine_line|#define VIA_CR42_FM_ENABLE&t;0x04
DECL|macro|VIA_CR42_GAME_ENABLE
mdefine_line|#define VIA_CR42_GAME_ENABLE&t;0x08
DECL|macro|VIA_CR44_SECOND_CODEC_SUPPORT
mdefine_line|#define VIA_CR44_SECOND_CODEC_SUPPORT&t;(1 &lt;&lt; 6)
DECL|macro|VIA_CR44_AC_LINK_ACCESS
mdefine_line|#define VIA_CR44_AC_LINK_ACCESS&t;&t;(1 &lt;&lt; 7)
DECL|macro|VIA_CR80_FIRST_CODEC
mdefine_line|#define VIA_CR80_FIRST_CODEC&t;&t;0
DECL|macro|VIA_CR80_SECOND_CODEC
mdefine_line|#define VIA_CR80_SECOND_CODEC&t;&t;(1 &lt;&lt; 30)
DECL|macro|VIA_CR80_FIRST_CODEC_VALID
mdefine_line|#define VIA_CR80_FIRST_CODEC_VALID&t;(1 &lt;&lt; 25)
DECL|macro|VIA_CR80_SECOND_CODEC_VALID
mdefine_line|#define VIA_CR80_SECOND_CODEC_VALID&t;(1 &lt;&lt; 27)
DECL|macro|VIA_CR80_BUSY
mdefine_line|#define VIA_CR80_BUSY&t;&t;&t;(1 &lt;&lt; 24)
DECL|macro|VIA_CR80_READ_MODE
mdefine_line|#define VIA_CR80_READ_MODE&t;&t;(1 &lt;&lt; 23)
DECL|macro|VIA_CR80_WRITE_MODE
mdefine_line|#define VIA_CR80_WRITE_MODE&t;&t;0
DECL|macro|VIA_CR80_REG_IDX
mdefine_line|#define VIA_CR80_REG_IDX(idx)&t;&t;(((idx) &amp; 0x7E) &lt;&lt; 16)
DECL|struct|via_info
r_struct
id|via_info
(brace
DECL|member|sb_data
r_struct
id|address_info
id|sb_data
suffix:semicolon
DECL|member|opl3_data
r_struct
id|address_info
id|opl3_data
suffix:semicolon
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|ac97
r_struct
id|ac97_hwint
id|ac97
suffix:semicolon
DECL|member|mixer_oss_dev
r_int
id|mixer_oss_dev
suffix:semicolon
DECL|member|have_ac97
r_int
id|have_ac97
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|cards
r_static
r_struct
id|via_info
id|cards
(braket
id|MAX_CARDS
)braket
suffix:semicolon
DECL|variable|num_cards
r_static
r_int
id|num_cards
op_assign
l_int|0
suffix:semicolon
r_static
r_const
r_struct
(brace
DECL|member|revision
r_int
id|revision
suffix:semicolon
DECL|member|rev_name
r_const
r_char
op_star
id|rev_name
suffix:semicolon
DECL|variable|__initdata
)brace
id|via_chip_revs
(braket
)braket
id|__initdata
op_assign
(brace
(brace
l_int|0x10
comma
l_string|&quot;A&quot;
)brace
comma
(brace
l_int|0x11
comma
l_string|&quot;B&quot;
)brace
comma
(brace
l_int|0x12
comma
l_string|&quot;C&quot;
)brace
comma
(brace
l_int|0x13
comma
l_string|&quot;D&quot;
)brace
comma
(brace
l_int|0x14
comma
l_string|&quot;E&quot;
)brace
comma
(brace
l_int|0x20
comma
l_string|&quot;H&quot;
)brace
comma
)brace
suffix:semicolon
DECL|function|via_ac97_write32
r_static
r_inline
r_void
id|via_ac97_write32
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_int
id|port
comma
id|u32
id|data
)paren
(brace
r_struct
id|resource
op_star
id|rsrc
op_assign
op_amp
id|pdev-&gt;resource
(braket
l_int|0
)braket
suffix:semicolon
id|outw
(paren
(paren
id|u16
)paren
id|data
comma
id|rsrc-&gt;start
op_plus
id|port
)paren
suffix:semicolon
id|outw
(paren
(paren
id|u16
)paren
(paren
id|data
op_rshift
l_int|16
)paren
comma
id|rsrc-&gt;start
op_plus
id|port
op_plus
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|via_ac97_read32
r_static
r_inline
id|u32
id|via_ac97_read32
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_int
id|port
)paren
(brace
r_struct
id|resource
op_star
id|rsrc
op_assign
op_amp
id|pdev-&gt;resource
(braket
l_int|0
)braket
suffix:semicolon
r_return
(paren
(paren
id|u32
)paren
id|inw
(paren
id|rsrc-&gt;start
op_plus
id|port
)paren
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|inw
(paren
id|rsrc-&gt;start
op_plus
id|port
op_plus
l_int|2
)paren
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************&n; *&n; * Intel Audio Codec &squot;97 interface&n; *&n; *&n; */
DECL|function|via_ac97_wait_idle
r_static
r_inline
r_void
id|via_ac97_wait_idle
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
id|u32
id|tmp
suffix:semicolon
r_int
id|counter
op_assign
id|VIA_COUNTER_LIMIT
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|pdev
op_ne
l_int|NULL
)paren
suffix:semicolon
r_do
(brace
id|tmp
op_assign
id|via_ac97_read32
(paren
id|pdev
comma
id|VIA_AC97_CTRL
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|tmp
op_amp
id|VIA_CR80_BUSY
)paren
op_logical_and
(paren
id|counter
op_decrement
OG
l_int|0
)paren
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT%s&bslash;n&quot;
comma
id|counter
OG
l_int|0
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;, counter limit reached&quot;
)paren
suffix:semicolon
)brace
DECL|function|via_ac97_read_reg
r_static
r_int
id|via_ac97_read_reg
(paren
r_struct
id|ac97_hwint
op_star
id|dev
comma
id|u8
id|reg
)paren
(brace
id|u32
id|data
suffix:semicolon
r_struct
id|via_info
op_star
id|card
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|dev-&gt;driver_private
op_ne
l_int|NULL
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|via_info
op_star
)paren
id|dev-&gt;driver_private
suffix:semicolon
id|pdev
op_assign
id|card-&gt;pdev
suffix:semicolon
m_assert
(paren
id|pdev
op_ne
l_int|NULL
)paren
suffix:semicolon
id|via_ac97_wait_idle
(paren
id|pdev
)paren
suffix:semicolon
id|data
op_assign
id|VIA_CR80_FIRST_CODEC
op_or
id|VIA_CR80_FIRST_CODEC_VALID
op_or
id|VIA_CR80_READ_MODE
op_or
id|VIA_CR80_REG_IDX
c_func
(paren
id|reg
)paren
suffix:semicolon
id|via_ac97_write32
(paren
id|pdev
comma
id|VIA_AC97_CTRL
comma
id|data
)paren
suffix:semicolon
id|via_ac97_wait_idle
(paren
id|pdev
)paren
suffix:semicolon
id|data
op_assign
id|via_ac97_read32
(paren
id|pdev
comma
id|VIA_AC97_CTRL
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_amp
id|VIA_CR80_FIRST_CODEC_VALID
)paren
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;EXIT, first codec not valid, returning -1&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|DPRINTK
(paren
l_string|&quot;EXIT, returning %d&bslash;n&quot;
comma
id|data
op_amp
l_int|0xFFFF
)paren
suffix:semicolon
r_return
id|data
op_amp
l_int|0xFFFF
suffix:semicolon
)brace
DECL|function|via_ac97_write_reg
r_static
r_int
id|via_ac97_write_reg
(paren
r_struct
id|ac97_hwint
op_star
id|dev
comma
id|u8
id|reg
comma
id|u16
id|value
)paren
(brace
id|u32
id|data
suffix:semicolon
r_struct
id|via_info
op_star
id|card
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|dev-&gt;driver_private
op_ne
l_int|NULL
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|via_info
op_star
)paren
id|dev-&gt;driver_private
suffix:semicolon
id|pdev
op_assign
id|card-&gt;pdev
suffix:semicolon
m_assert
(paren
id|pdev
op_ne
l_int|NULL
)paren
suffix:semicolon
id|via_ac97_wait_idle
(paren
id|pdev
)paren
suffix:semicolon
id|data
op_assign
id|VIA_CR80_FIRST_CODEC
op_or
id|VIA_CR80_FIRST_CODEC_VALID
op_or
id|VIA_CR80_WRITE_MODE
op_or
id|VIA_CR80_REG_IDX
c_func
(paren
id|reg
)paren
op_or
id|value
suffix:semicolon
id|via_ac97_write32
(paren
id|pdev
comma
id|VIA_AC97_CTRL
comma
id|data
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_amp
id|VIA_CR80_FIRST_CODEC_VALID
)paren
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;EXIT, first codec invalid, returning -1&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
id|DPRINTK
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|via_ac97_reset
r_static
r_int
id|via_ac97_reset
(paren
r_struct
id|ac97_hwint
op_star
id|dev
)paren
(brace
r_struct
id|via_info
op_star
id|card
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|dev-&gt;driver_private
op_ne
l_int|NULL
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|via_info
op_star
)paren
id|dev-&gt;driver_private
suffix:semicolon
id|pdev
op_assign
id|card-&gt;pdev
suffix:semicolon
m_assert
(paren
id|pdev
op_ne
l_int|NULL
)paren
suffix:semicolon
id|pci_write_config_word
(paren
id|pdev
comma
id|PCI_COMMAND
comma
id|PCI_COMMAND_IO
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|via_ac97_find_card_for_mixer
r_static
r_struct
id|via_info
op_star
id|via_ac97_find_card_for_mixer
(paren
r_int
id|dev
)paren
(brace
r_int
id|x
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0
suffix:semicolon
id|x
OL
id|num_cards
suffix:semicolon
id|x
op_increment
)paren
r_if
c_cond
(paren
id|cards
(braket
id|x
)braket
dot
id|mixer_oss_dev
op_eq
id|dev
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;EXIT, returning %p&bslash;n&quot;
comma
id|cards
op_plus
id|x
)paren
suffix:semicolon
r_return
id|cards
op_plus
id|x
suffix:semicolon
)brace
id|DPRINTK
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_int
DECL|function|via_ac97_default_mixer_ioctl
id|via_ac97_default_mixer_ioctl
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|via_info
op_star
id|card
op_assign
id|via_ac97_find_card_for_mixer
(paren
id|dev
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_ne
l_int|NULL
)paren
(brace
id|rc
op_assign
id|ac97_mixer_ioctl
(paren
op_amp
id|card-&gt;ac97
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT, returning %d&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|DPRINTK
(paren
l_string|&quot;EXIT, returning -ENODEV&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|variable|via_ac97_mixer_operations
r_static
r_struct
id|mixer_operations
id|via_ac97_mixer_operations
op_assign
(brace
l_string|&quot;VIA82Cxxx&quot;
comma
l_string|&quot;via82cxxxAC97Mixer&quot;
comma
id|via_ac97_default_mixer_ioctl
)brace
suffix:semicolon
DECL|function|via_attach_ac97
r_static
r_int
id|__init
id|via_attach_ac97
(paren
r_struct
id|via_info
op_star
id|card
)paren
(brace
r_int
id|mixer
suffix:semicolon
r_struct
id|ac97_hwint
op_star
id|mdev
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|card
op_ne
l_int|NULL
)paren
suffix:semicolon
id|mdev
op_assign
op_amp
id|card-&gt;ac97
suffix:semicolon
id|memset
(paren
id|mdev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|mdev
)paren
)paren
suffix:semicolon
id|mdev-&gt;reset_device
op_assign
id|via_ac97_reset
suffix:semicolon
id|mdev-&gt;read_reg
op_assign
id|via_ac97_read_reg
suffix:semicolon
id|mdev-&gt;write_reg
op_assign
id|via_ac97_write_reg
suffix:semicolon
id|mdev-&gt;driver_private
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
r_if
c_cond
(paren
id|ac97_init
(paren
id|mdev
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Unable to init AC97&bslash;n&quot;
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT, returning -1&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|mixer
op_assign
id|sound_alloc_mixerdev
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mixer
OL
l_int|0
op_logical_or
id|num_mixers
op_ge
id|MAX_MIXER_DEV
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Unable to alloc mixerdev&bslash;n&quot;
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT, returning -1&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|mixer_devs
(braket
id|mixer
)braket
op_assign
op_amp
id|via_ac97_mixer_operations
suffix:semicolon
id|card-&gt;mixer_oss_dev
op_assign
id|mixer
suffix:semicolon
multiline_comment|/* Some reasonable default values.  */
id|ac97_set_mixer
(paren
id|mdev
comma
id|SOUND_MIXER_VOLUME
comma
(paren
l_int|85
op_lshift
l_int|8
)paren
op_or
l_int|85
)paren
suffix:semicolon
id|ac97_set_mixer
(paren
id|mdev
comma
id|SOUND_MIXER_SPEAKER
comma
l_int|100
)paren
suffix:semicolon
id|ac97_set_mixer
(paren
id|mdev
comma
id|SOUND_MIXER_PCM
comma
(paren
l_int|65
op_lshift
l_int|8
)paren
op_or
l_int|65
)paren
suffix:semicolon
id|ac97_set_mixer
(paren
id|mdev
comma
id|SOUND_MIXER_CD
comma
(paren
l_int|65
op_lshift
l_int|8
)paren
op_or
l_int|65
)paren
suffix:semicolon
id|printk
(paren
id|KERN_INFO
id|PFX
l_string|&quot;Initialized AC97 mixer&bslash;n&quot;
)paren
suffix:semicolon
id|card-&gt;have_ac97
op_assign
id|mixer
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|via_unload_ac97
r_static
r_void
id|via_unload_ac97
(paren
r_struct
id|via_info
op_star
id|card
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
m_assert
(paren
id|card
op_ne
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;have_ac97
op_ge
l_int|0
)paren
id|sound_unload_mixerdev
(paren
id|card-&gt;have_ac97
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
multiline_comment|/****************************************************************&n; *&n; * /proc/driver/via82cxxx/info&n; *&n; *&n; */
DECL|function|via_info_read_proc
r_static
r_int
id|via_info_read_proc
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
DECL|macro|YN
mdefine_line|#define YN(val,bit) (((val) &amp; (bit)) ? &quot;yes&quot; : &quot;no&quot;)
r_int
id|len
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|u8
id|r40
comma
id|r41
comma
id|r42
comma
id|r44
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
id|VIA_CARD_NAME
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_cards
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pci_read_config_byte
(paren
id|cards
(braket
id|i
)braket
dot
id|pdev
comma
l_int|0x40
comma
op_amp
id|r40
)paren
suffix:semicolon
id|pci_read_config_byte
(paren
id|cards
(braket
id|i
)braket
dot
id|pdev
comma
l_int|0x42
comma
op_amp
id|r41
)paren
suffix:semicolon
id|pci_read_config_byte
(paren
id|cards
(braket
id|i
)braket
dot
id|pdev
comma
l_int|0x42
comma
op_amp
id|r42
)paren
suffix:semicolon
id|pci_read_config_byte
(paren
id|cards
(braket
id|i
)braket
dot
id|pdev
comma
l_int|0x44
comma
op_amp
id|r44
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;40  AC97 Codec Ready: %s&bslash;n&quot;
l_string|&quot;    AC97 Codec Low-power: %s&bslash;n&quot;
l_string|&quot;    Secondary Codec Ready: %s&bslash;n&quot;
l_string|&quot;41  AC-Link Interface Enable: %s&bslash;n&quot;
l_string|&quot;42  Game port enabled: %s&bslash;n&quot;
l_string|&quot;    SoundBlaster enabled: %s&bslash;n&quot;
l_string|&quot;    FM enabled: %s&bslash;n&quot;
l_string|&quot;    MIDI enabled: %s&bslash;n&quot;
l_string|&quot;44  AC-Link Interface Access: %s&bslash;n&quot;
l_string|&quot;    Secondary Codec Support: %s&bslash;n&quot;
l_string|&quot;&bslash;n&quot;
comma
id|YN
(paren
id|r40
comma
id|VIA_CR40_AC97_READY
)paren
comma
id|YN
(paren
id|r40
comma
id|VIA_CR40_AC97_LOW_POWER
)paren
comma
id|YN
(paren
id|r40
comma
id|VIA_CR40_SECONDARY_READY
)paren
comma
id|YN
(paren
id|r41
comma
id|VIA_CR41_ACLINK_ENABLE
)paren
comma
id|YN
(paren
id|r42
comma
id|VIA_CR42_GAME_ENABLE
)paren
comma
id|YN
(paren
id|r42
comma
id|VIA_CR42_SB_ENABLE
)paren
comma
id|YN
(paren
id|r42
comma
id|VIA_CR42_FM_ENABLE
)paren
comma
id|YN
(paren
id|r42
comma
id|VIA_CR42_MIDI_ENABLE
)paren
comma
id|YN
(paren
id|r44
comma
id|VIA_CR44_AC_LINK_ACCESS
)paren
comma
id|YN
(paren
id|r44
comma
id|VIA_CR44_SECOND_CODEC_SUPPORT
)paren
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT, returning %d&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
DECL|macro|YN
macro_line|#undef YN
)brace
multiline_comment|/****************************************************************&n; *&n; * /proc/driver/via82cxxx&n; *&n; *&n; */
DECL|function|via_init_proc
r_static
r_int
id|__init
id|via_init_proc
(paren
r_void
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|proc_mkdir
(paren
l_string|&quot;driver/via_audio&quot;
comma
l_int|0
)paren
suffix:semicolon
id|create_proc_read_entry
(paren
l_string|&quot;driver/via_audio/info&quot;
comma
l_int|0
comma
l_int|0
comma
id|via_info_read_proc
comma
l_int|NULL
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|via_cleanup_proc
r_static
r_void
id|__exit
id|via_cleanup_proc
(paren
r_void
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|remove_proc_entry
(paren
l_string|&quot;driver/via_audio/info&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|remove_proc_entry
(paren
l_string|&quot;driver/via_audio&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|via_init_proc
r_static
r_inline
r_int
id|via_init_proc
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|via_cleanup_proc
r_static
r_inline
r_void
id|via_cleanup_proc
(paren
r_void
)paren
(brace
)brace
macro_line|#endif /* CONFIG_PROC_FS */
multiline_comment|/****************************************************************&n; *&n; * Legacy SoundBlaster Pro, FM support via OSS&n; *&n; *&n; */
DECL|function|via_attach_sb
r_static
r_void
id|__init
id|via_attach_sb
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_init
c_func
(paren
id|hw_config
)paren
)paren
(brace
id|hw_config-&gt;slots
(braket
l_int|0
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|via_probe_sb
r_static
r_int
id|__init
id|via_probe_sb
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|hw_config-&gt;io_base
comma
l_int|16
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
id|PFX
l_string|&quot;SBPro port 0x%x is already in use&bslash;n&quot;
comma
id|hw_config-&gt;io_base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT after sb_dsp_detect&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|sb_dsp_detect
c_func
(paren
id|hw_config
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|via_unload_sb
r_static
r_void
id|__exit
id|via_unload_sb
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hw_config-&gt;slots
(braket
l_int|0
)braket
op_ne
op_minus
l_int|1
)paren
(brace
id|sb_dsp_unload
c_func
(paren
id|hw_config
comma
l_int|1
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_const
r_struct
(brace
DECL|member|sb_irq
r_int
id|sb_irq
comma
DECL|member|sb_dma
id|sb_dma
comma
DECL|member|midi_base
id|midi_base
comma
DECL|member|sb_io_base
id|sb_io_base
suffix:semicolon
DECL|variable|__initdata
)brace
id|via_pnp_data
(braket
)braket
id|__initdata
op_assign
(brace
(brace
l_int|5
comma
l_int|0
comma
l_int|0x300
comma
l_int|0x220
)brace
comma
(brace
l_int|7
comma
l_int|1
comma
l_int|0x310
comma
l_int|0x240
)brace
comma
(brace
l_int|9
comma
l_int|2
comma
l_int|0x320
comma
l_int|0x260
)brace
comma
(brace
l_int|10
comma
l_int|3
comma
l_int|0x330
comma
l_int|0x280
)brace
comma
)brace
suffix:semicolon
multiline_comment|/****************************************************************&n; *&n; * Chip setup and kernel registration&n; *&n; *&n; */
DECL|function|via82cxxx_install
r_static
r_int
id|__init
id|via82cxxx_install
(paren
r_struct
id|pci_dev
op_star
id|pcidev
)paren
(brace
r_int
id|sb_io_base
suffix:semicolon
r_int
id|sb_irq
suffix:semicolon
r_int
id|sb_dma
suffix:semicolon
r_int
id|midi_base
comma
id|rc
suffix:semicolon
id|u8
id|tmp8
suffix:semicolon
r_struct
id|via_info
op_star
id|card
op_assign
op_amp
id|cards
(braket
id|num_cards
)braket
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|card-&gt;pdev
op_assign
id|pcidev
suffix:semicolon
id|card-&gt;have_ac97
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* turn off legacy features, if not already */
id|pci_read_config_byte
(paren
id|pcidev
comma
id|VIA_FUNC_ENABLE
comma
op_amp
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_and_assign
op_complement
(paren
id|VIA_CR42_SB_ENABLE
op_or
id|VIA_CR42_MIDI_ENABLE
op_or
id|VIA_CR42_FM_ENABLE
)paren
suffix:semicolon
id|pci_write_config_byte
(paren
id|pcidev
comma
id|VIA_FUNC_ENABLE
comma
id|tmp8
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * try to init AC97 mixer device&n;&t; */
id|rc
op_assign
id|via_attach_ac97
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;AC97 init failed, SB legacy mode only&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* turn on legacy features */
id|pci_read_config_byte
(paren
id|pcidev
comma
id|VIA_FUNC_ENABLE
comma
op_amp
id|tmp8
)paren
suffix:semicolon
id|tmp8
op_or_assign
id|VIA_CR42_SB_ENABLE
op_or
id|VIA_CR42_MIDI_ENABLE
op_or
id|VIA_CR42_FM_ENABLE
suffix:semicolon
id|pci_write_config_byte
(paren
id|pcidev
comma
id|VIA_FUNC_ENABLE
comma
id|tmp8
)paren
suffix:semicolon
multiline_comment|/* read legacy PNP info byte */
id|pci_read_config_byte
(paren
id|pcidev
comma
id|VIA_PNP_CONTROL
comma
op_amp
id|tmp8
)paren
suffix:semicolon
id|pci_write_config_byte
(paren
id|pcidev
comma
id|VIA_PNP_CONTROL
comma
id|tmp8
)paren
suffix:semicolon
id|sb_irq
op_assign
id|via_pnp_data
(braket
(paren
(paren
id|tmp8
op_rshift
l_int|6
)paren
op_amp
l_int|0x03
)paren
)braket
dot
id|sb_irq
suffix:semicolon
id|sb_dma
op_assign
id|via_pnp_data
(braket
(paren
(paren
id|tmp8
op_rshift
l_int|4
)paren
op_amp
l_int|0x03
)paren
)braket
dot
id|sb_dma
suffix:semicolon
id|midi_base
op_assign
id|via_pnp_data
(braket
(paren
(paren
id|tmp8
op_rshift
l_int|2
)paren
op_amp
l_int|0x03
)paren
)braket
dot
id|midi_base
suffix:semicolon
id|sb_io_base
op_assign
id|via_pnp_data
(braket
(paren
id|tmp8
op_amp
l_int|0x03
)paren
)braket
dot
id|sb_io_base
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;legacy &quot;
l_string|&quot;MIDI: 0x%X, SB: 0x%X / %d IRQ / %d DMA&bslash;n&quot;
comma
id|midi_base
comma
id|sb_io_base
comma
id|sb_irq
comma
id|sb_dma
)paren
suffix:semicolon
id|card-&gt;sb_data.name
op_assign
id|VIA_CARD_NAME
suffix:semicolon
id|card-&gt;sb_data.card_subtype
op_assign
id|MDL_SBPRO
suffix:semicolon
id|card-&gt;sb_data.io_base
op_assign
id|sb_io_base
suffix:semicolon
id|card-&gt;sb_data.irq
op_assign
id|sb_irq
suffix:semicolon
id|card-&gt;sb_data.dma
op_assign
id|sb_dma
suffix:semicolon
multiline_comment|/* register legacy SoundBlaster Pro */
r_if
c_cond
(paren
op_logical_neg
id|via_probe_sb
(paren
op_amp
id|card-&gt;sb_data
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;SB probe @ 0x%X failed, aborting&bslash;n&quot;
comma
id|sb_io_base
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT, returning -1&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|via_attach_sb
(paren
op_amp
id|card-&gt;sb_data
)paren
suffix:semicolon
id|card-&gt;opl3_data.name
op_assign
id|card-&gt;sb_data.name
suffix:semicolon
id|card-&gt;opl3_data.io_base
op_assign
id|midi_base
suffix:semicolon
id|card-&gt;opl3_data.irq
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* register legacy MIDI */
r_if
c_cond
(paren
op_logical_neg
id|probe_uart401
(paren
op_amp
id|card-&gt;opl3_data
)paren
)paren
(brace
id|printk
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;MIDI probe @ 0x%X failed, continuing&bslash;n&quot;
comma
id|midi_base
)paren
suffix:semicolon
id|card-&gt;opl3_data.io_base
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|attach_uart401
(paren
op_amp
id|card-&gt;opl3_data
)paren
suffix:semicolon
)brace
id|num_cards
op_increment
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * &t;This loop walks the PCI configuration database and finds where&n; *&t;the sound cards are.&n; *&n; *&t;Note - only a single PCI scan occurs, eliminating possibility&n; *&t;of multiple audio chips&n; *&n; */
DECL|function|probe_via82cxxx
r_static
r_int
id|__init
id|probe_via82cxxx
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pcidev
op_assign
l_int|NULL
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|pcidev
op_assign
id|pci_find_device
(paren
id|PCI_VENDOR_ID_VIA
comma
id|PCI_DEVICE_ID_VIA_82C686_5
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcidev
op_logical_or
id|via82cxxx_install
(paren
id|pcidev
)paren
op_ne
l_int|0
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;audio init failed&bslash;n&quot;
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT, returning -1&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|DPRINTK
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This function is called when the user or kernel loads the &n; *&t;module into memory.&n; */
DECL|function|init_via82cxxx_module
r_static
r_int
id|__init
id|init_via82cxxx_module
c_func
(paren
r_void
)paren
(brace
id|u8
id|tmp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_const
r_char
op_star
id|rev
op_assign
l_string|&quot;unknown!&quot;
suffix:semicolon
id|memset
(paren
id|cards
comma
l_int|0
comma
r_sizeof
(paren
id|cards
)paren
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_present
(paren
)paren
)paren
(brace
id|printk
(paren
id|KERN_DEBUG
id|PFX
l_string|&quot;PCI not present, exiting&bslash;n&quot;
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT, returning -ENODEV&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|probe_via82cxxx
c_func
(paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;probe failed, aborting&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* XXX unload cards registered so far, if any */
id|DPRINTK
(paren
l_string|&quot;EXIT, returning -ENODEV&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|pci_read_config_byte
(paren
id|cards
(braket
l_int|0
)braket
dot
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|arraysize
c_func
(paren
id|via_chip_revs
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|via_chip_revs
(braket
id|i
)braket
dot
id|revision
op_eq
id|tmp
)paren
(brace
id|rev
op_assign
id|via_chip_revs
(braket
id|i
)braket
dot
id|rev_name
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
(paren
id|KERN_INFO
id|PFX
id|VIA_CARD_NAME
l_string|&quot; loaded&bslash;n&quot;
)paren
suffix:semicolon
id|printk
(paren
id|KERN_INFO
id|PFX
l_string|&quot;Chip rev %s.  Features: SBPro compat%s%s&bslash;n&quot;
comma
id|rev
comma
id|cards
(braket
l_int|0
)braket
dot
id|opl3_data.io_base
op_eq
l_int|0
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;, MPU-401 MIDI&quot;
comma
id|cards
(braket
l_int|0
)braket
dot
id|have_ac97
op_eq
op_minus
l_int|1
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;, AC97 mixer&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|via_init_proc
(paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;Unable to init experimental /proc, ignoring&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Binds us to the sound subsystem&t;&n;&t; */
id|SOUND_LOCK
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;EXIT, returning 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This is called when it is removed. It will only be removed &n; *&t;when its use count is 0. For sound the SOUND_LOCK/SOUND_UNLOCK&n; *&t;macros hide the entire work for this.&n; */
DECL|function|cleanup_via82cxxx_module
r_static
r_void
id|__exit
id|cleanup_via82cxxx_module
c_func
(paren
r_void
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ENTER&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cards
(braket
l_int|0
)braket
dot
id|opl3_data.io_base
)paren
id|unload_uart401
(paren
op_amp
id|cards
(braket
l_int|0
)braket
dot
id|opl3_data
)paren
suffix:semicolon
id|via_unload_sb
(paren
op_amp
id|cards
(braket
l_int|0
)braket
dot
id|sb_data
)paren
suffix:semicolon
id|via_unload_ac97
(paren
op_amp
id|cards
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|via_cleanup_proc
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Final clean up with the sound layer&n;&t; */
id|SOUND_LOCK_END
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;EXIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|init_via82cxxx_module
id|module_init
c_func
(paren
id|init_via82cxxx_module
)paren
suffix:semicolon
DECL|variable|cleanup_via82cxxx_module
id|module_exit
c_func
(paren
id|cleanup_via82cxxx_module
)paren
suffix:semicolon
eof
