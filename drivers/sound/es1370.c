multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *      es1370.c  --  Ensoniq ES1370/Asahi Kasei AK4531 audio driver.&n; *&n; *      Copyright (C) 1998-2000  Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *&n; *      This program is free software; you can redistribute it and/or modify&n; *      it under the terms of the GNU General Public License as published by&n; *      the Free Software Foundation; either version 2 of the License, or&n; *      (at your option) any later version.&n; *&n; *      This program is distributed in the hope that it will be useful,&n; *      but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *      GNU General Public License for more details.&n; *&n; *      You should have received a copy of the GNU General Public License&n; *      along with this program; if not, write to the Free Software&n; *      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * Special thanks to David C. Niemi&n; *&n; *&n; * Module command line parameters:&n; *   joystick if 1 enables the joystick interface on the card; but it still&n; *            needs a driver for joysticks connected to a standard IBM-PC&n; *&t;      joyport. It is tested with the joy-analog driver. This &n; *&t;      module must be loaded before the joystick driver. Kmod will&n; *&t;      not ensure that.&n; *   lineout  if 1 the LINE jack is used as an output instead of an input.&n; *            LINE then contains the unmixed dsp output. This can be used&n; *            to make the card a four channel one: use dsp to output two&n; *            channels to LINE and dac to output the other two channels to&n; *            SPKR. Set the mixer to only output synth to SPKR.&n; *   micbias  sets the +5V bias to the mic if using an electretmic.&n; *            &n; *&n; *  Note: sync mode is not yet supported (i.e. running dsp and dac from the same&n; *  clock source)&n; *&n; *  Supported devices:&n; *  /dev/dsp    standard /dev/dsp device, (mostly) OSS compatible&n; *  /dev/mixer  standard /dev/mixer device, (mostly) OSS compatible&n; *  /dev/dsp1   additional DAC, like /dev/dsp, but output only,&n; *              only 5512, 11025, 22050 and 44100 samples/s,&n; *              outputs to mixer &quot;SYNTH&quot; setting&n; *  /dev/midi   simple MIDI UART interface, no ioctl&n; *&n; *  NOTE: the card does not have any FM/Wavetable synthesizer, it is supposed&n; *  to be done in software. That is what /dev/dac is for. By now (Q2 1998)&n; *  there are several MIDI to PCM (WAV) packages, one of them is timidity.&n; *&n; *  Revision history&n; *    26.03.1998   0.1   Initial release&n; *    31.03.1998   0.2   Fix bug in GETOSPACE&n; *    04.04.1998   0.3   Make it work (again) under 2.0.33&n; *                       Fix mixer write operation not returning the actual&n; *                       settings&n; *    05.04.1998   0.4   First attempt at using the new PCI stuff&n; *    29.04.1998   0.5   Fix hang when ^C is pressed on amp&n; *    07.05.1998   0.6   Don&squot;t double lock around stop_*() in *_release()&n; *    10.05.1998   0.7   First stab at a simple midi interface (no bells&amp;whistles)&n; *    14.05.1998   0.8   Don&squot;t allow excessive interrupt rates&n; *    08.06.1998   0.9   First release using Alan Cox&squot; soundcore instead of&n; *                       miscdevice&n; *    05.07.1998   0.10  Fixed the driver to correctly maintin OSS style volume&n; *                       settings (not sure if this should be standard)&n; *                       Fixed many references: f_flags should be f_mode&n; *                       -- Gerald Britton &lt;gbritton@mit.edu&gt;&n; *    03.08.1998   0.11  Now mixer behaviour can basically be selected between&n; *                       &quot;OSS documented&quot; and &quot;OSS actual&quot; behaviour&n; *                       Fixed mixer table thanks to Hakan.Lennestal@lu.erisoft.se&n; *                       On module startup, set DAC2 to 11kSPS instead of 5.5kSPS,&n; *                       as it produces an annoying ssssh in the lower sampling rate&n; *                       Do not include modversions.h&n; *    22.08.1998   0.12  Mixer registers actually have 5 instead of 4 bits&n; *                       pointed out by Itai Nahshon&n; *    31.08.1998   0.13  Fix realplayer problems - dac.count issues&n; *    08.10.1998   0.14  Joystick support fixed&n; *&t;&t;         -- Oliver Neukum &lt;c188@org.chemie.uni-muenchen.de&gt;&n; *    10.12.1998   0.15  Fix drain_dac trying to wait on not yet initialized DMA&n; *    16.12.1998   0.16  Don&squot;t wake up app until there are fragsize bytes to read/write&n; *    06.01.1999   0.17  remove the silly SA_INTERRUPT flag.&n; *                       hopefully killed the egcs section type conflict&n; *    12.03.1999   0.18  cinfo.blocks should be reset after GETxPTR ioctl.&n; *                       reported by Johan Maes &lt;joma@telindus.be&gt;&n; *    22.03.1999   0.19  return EAGAIN instead of EBUSY when O_NONBLOCK&n; *                       read/write cannot be executed&n; *    07.04.1999   0.20  implemented the following ioctl&squot;s: SOUND_PCM_READ_RATE, &n; *                       SOUND_PCM_READ_CHANNELS, SOUND_PCM_READ_BITS; &n; *                       Alpha fixes reported by Peter Jones &lt;pjones@redhat.com&gt;&n; *                       Note: joystick address handling might still be wrong on archs&n; *                       other than i386&n; *    10.05.1999   0.21  Added support for an electret mic for SB PCI64&n; *                       to the Linux kernel sound driver. This mod also straighten&n; *                       out the question marks around the mic impedance setting&n; *                       (micz). From Kim.Berts@fisub.mail.abb.com&n; *    11.05.1999   0.22  Implemented the IMIX call to mute recording monitor.&n; *                       Guenter Geiger &lt;geiger@epy.co.at&gt;&n; *    15.06.1999   0.23  Fix bad allocation bug.&n; *                       Thanks to Deti Fliegl &lt;fliegl@in.tum.de&gt;&n; *    28.06.1999   0.24  Add pci_set_master&n; *    02.08.1999   0.25  Added workaround for the &quot;phantom write&quot; bug first&n; *                       documented by Dave Sharpless from Anchor Games&n; *    03.08.1999   0.26  adapt to Linus&squot; new __setup/__initcall&n; *                       added kernel command line option &quot;es1370=joystick[,lineout[,micbias]]&quot;&n; *                       removed CONFIG_SOUND_ES1370_JOYPORT_BOOT kludge&n; *    12.08.1999   0.27  module_init/__setup fixes&n; *    19.08.1999   0.28  SOUND_MIXER_IMIX fixes, reported by Gianluca &lt;gialluca@mail.tiscalinet.it&gt;&n; *    31.08.1999   0.29  add spin_lock_init&n; *                       replaced current-&gt;state = x with set_current_state(x)&n; *    03.09.1999   0.30  change read semantics for MIDI to match&n; *                       OSS more closely; remove possible wakeup race&n; *    28.10.1999   0.31  More waitqueue races fixed&n; *    08.01.2000   0.32  Prevent some ioctl&squot;s from returning bad count values on underrun/overrun;&n; *                       Tim Janik&squot;s BSE (Bedevilled Sound Engine) found this&n; *    07.02.2000   0.33  Use pci_alloc_consistent and pci_register_driver&n; *    21.11.2000   0.34  Initialize dma buffers in poll, otherwise poll may return a bogus mask&n; *&n; * some important things missing in Ensoniq documentation:&n; *&n; * Experimental PCLKDIV results:  play the same waveforms on both DAC1 and DAC2&n; * and vary PCLKDIV to obtain zero beat.&n; *  5512sps:  254&n; * 44100sps:   30&n; * seems to be fs = 1411200/(PCLKDIV+2)&n; *&n; * should find out when curr_sample_ct is cleared and&n; * where exactly the CCB fetches data&n; *&n; * The card uses a 22.5792 MHz crystal.&n; * The LINEIN jack may be converted to an AOUT jack by&n; * setting pin 47 (XCTL0) of the ES1370 to high.&n; * Pin 48 (XCTL1) of the ES1370 sets the +5V bias for an electretmic&n; * &n; *&n; */
multiline_comment|/*****************************************************************************/
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/sound.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/wrapper.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/hardirq.h&gt;
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|OSS_DOCUMENTED_MIXER_SEMANTICS
macro_line|#undef OSS_DOCUMENTED_MIXER_SEMANTICS
DECL|macro|DBG
mdefine_line|#define DBG(x) {}
multiline_comment|/*#define DBG(x) {x}*/
multiline_comment|/* --------------------------------------------------------------------- */
macro_line|#ifndef PCI_VENDOR_ID_ENSONIQ
DECL|macro|PCI_VENDOR_ID_ENSONIQ
mdefine_line|#define PCI_VENDOR_ID_ENSONIQ        0x1274    
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_ENSONIQ_ES1370
DECL|macro|PCI_DEVICE_ID_ENSONIQ_ES1370
mdefine_line|#define PCI_DEVICE_ID_ENSONIQ_ES1370 0x5000
macro_line|#endif
DECL|macro|ES1370_MAGIC
mdefine_line|#define ES1370_MAGIC  ((PCI_VENDOR_ID_ENSONIQ&lt;&lt;16)|PCI_DEVICE_ID_ENSONIQ_ES1370)
DECL|macro|ES1370_EXTENT
mdefine_line|#define ES1370_EXTENT             0x40
DECL|macro|JOY_EXTENT
mdefine_line|#define JOY_EXTENT                8
DECL|macro|ES1370_REG_CONTROL
mdefine_line|#define ES1370_REG_CONTROL        0x00
DECL|macro|ES1370_REG_STATUS
mdefine_line|#define ES1370_REG_STATUS         0x04
DECL|macro|ES1370_REG_UART_DATA
mdefine_line|#define ES1370_REG_UART_DATA      0x08
DECL|macro|ES1370_REG_UART_STATUS
mdefine_line|#define ES1370_REG_UART_STATUS    0x09
DECL|macro|ES1370_REG_UART_CONTROL
mdefine_line|#define ES1370_REG_UART_CONTROL   0x09
DECL|macro|ES1370_REG_UART_TEST
mdefine_line|#define ES1370_REG_UART_TEST      0x0a
DECL|macro|ES1370_REG_MEMPAGE
mdefine_line|#define ES1370_REG_MEMPAGE        0x0c
DECL|macro|ES1370_REG_CODEC
mdefine_line|#define ES1370_REG_CODEC          0x10
DECL|macro|ES1370_REG_SERIAL_CONTROL
mdefine_line|#define ES1370_REG_SERIAL_CONTROL 0x20
DECL|macro|ES1370_REG_DAC1_SCOUNT
mdefine_line|#define ES1370_REG_DAC1_SCOUNT    0x24
DECL|macro|ES1370_REG_DAC2_SCOUNT
mdefine_line|#define ES1370_REG_DAC2_SCOUNT    0x28
DECL|macro|ES1370_REG_ADC_SCOUNT
mdefine_line|#define ES1370_REG_ADC_SCOUNT     0x2c
DECL|macro|ES1370_REG_DAC1_FRAMEADR
mdefine_line|#define ES1370_REG_DAC1_FRAMEADR    0xc30
DECL|macro|ES1370_REG_DAC1_FRAMECNT
mdefine_line|#define ES1370_REG_DAC1_FRAMECNT    0xc34
DECL|macro|ES1370_REG_DAC2_FRAMEADR
mdefine_line|#define ES1370_REG_DAC2_FRAMEADR    0xc38
DECL|macro|ES1370_REG_DAC2_FRAMECNT
mdefine_line|#define ES1370_REG_DAC2_FRAMECNT    0xc3c
DECL|macro|ES1370_REG_ADC_FRAMEADR
mdefine_line|#define ES1370_REG_ADC_FRAMEADR     0xd30
DECL|macro|ES1370_REG_ADC_FRAMECNT
mdefine_line|#define ES1370_REG_ADC_FRAMECNT     0xd34
DECL|macro|ES1370_REG_PHANTOM_FRAMEADR
mdefine_line|#define ES1370_REG_PHANTOM_FRAMEADR 0xd38
DECL|macro|ES1370_REG_PHANTOM_FRAMECNT
mdefine_line|#define ES1370_REG_PHANTOM_FRAMECNT 0xd3c
DECL|macro|ES1370_FMT_U8_MONO
mdefine_line|#define ES1370_FMT_U8_MONO     0
DECL|macro|ES1370_FMT_U8_STEREO
mdefine_line|#define ES1370_FMT_U8_STEREO   1
DECL|macro|ES1370_FMT_S16_MONO
mdefine_line|#define ES1370_FMT_S16_MONO    2
DECL|macro|ES1370_FMT_S16_STEREO
mdefine_line|#define ES1370_FMT_S16_STEREO  3
DECL|macro|ES1370_FMT_STEREO
mdefine_line|#define ES1370_FMT_STEREO      1
DECL|macro|ES1370_FMT_S16
mdefine_line|#define ES1370_FMT_S16         2
DECL|macro|ES1370_FMT_MASK
mdefine_line|#define ES1370_FMT_MASK        3
DECL|variable|sample_size
r_static
r_const
r_int
id|sample_size
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|2
comma
l_int|4
)brace
suffix:semicolon
DECL|variable|sample_shift
r_static
r_const
r_int
id|sample_shift
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|2
)brace
suffix:semicolon
DECL|variable|dac1_samplerate
r_static
r_const
r_int
id|dac1_samplerate
(braket
)braket
op_assign
(brace
l_int|5512
comma
l_int|11025
comma
l_int|22050
comma
l_int|44100
)brace
suffix:semicolon
DECL|macro|DAC2_SRTODIV
mdefine_line|#define DAC2_SRTODIV(x) (((1411200+(x)/2)/(x))-2)
DECL|macro|DAC2_DIVTOSR
mdefine_line|#define DAC2_DIVTOSR(x) (1411200/((x)+2))
DECL|macro|CTRL_ADC_STOP
mdefine_line|#define CTRL_ADC_STOP   0x80000000  /* 1 = ADC stopped */
DECL|macro|CTRL_XCTL1
mdefine_line|#define CTRL_XCTL1      0x40000000  /* electret mic bias */
DECL|macro|CTRL_OPEN
mdefine_line|#define CTRL_OPEN       0x20000000  /* no function, can be read and written */
DECL|macro|CTRL_PCLKDIV
mdefine_line|#define CTRL_PCLKDIV    0x1fff0000  /* ADC/DAC2 clock divider */
DECL|macro|CTRL_SH_PCLKDIV
mdefine_line|#define CTRL_SH_PCLKDIV 16
DECL|macro|CTRL_MSFMTSEL
mdefine_line|#define CTRL_MSFMTSEL   0x00008000  /* MPEG serial data fmt: 0 = Sony, 1 = I2S */
DECL|macro|CTRL_M_SBB
mdefine_line|#define CTRL_M_SBB      0x00004000  /* DAC2 clock: 0 = PCLKDIV, 1 = MPEG */
DECL|macro|CTRL_WTSRSEL
mdefine_line|#define CTRL_WTSRSEL    0x00003000  /* DAC1 clock freq: 0=5512, 1=11025, 2=22050, 3=44100 */
DECL|macro|CTRL_SH_WTSRSEL
mdefine_line|#define CTRL_SH_WTSRSEL 12
DECL|macro|CTRL_DAC_SYNC
mdefine_line|#define CTRL_DAC_SYNC   0x00000800  /* 1 = DAC2 runs off DAC1 clock */
DECL|macro|CTRL_CCB_INTRM
mdefine_line|#define CTRL_CCB_INTRM  0x00000400  /* 1 = CCB &quot;voice&quot; ints enabled */
DECL|macro|CTRL_M_CB
mdefine_line|#define CTRL_M_CB       0x00000200  /* recording source: 0 = ADC, 1 = MPEG */
DECL|macro|CTRL_XCTL0
mdefine_line|#define CTRL_XCTL0      0x00000100  /* 0 = Line in, 1 = Line out */
DECL|macro|CTRL_BREQ
mdefine_line|#define CTRL_BREQ       0x00000080  /* 1 = test mode (internal mem test) */
DECL|macro|CTRL_DAC1_EN
mdefine_line|#define CTRL_DAC1_EN    0x00000040  /* enable DAC1 */
DECL|macro|CTRL_DAC2_EN
mdefine_line|#define CTRL_DAC2_EN    0x00000020  /* enable DAC2 */
DECL|macro|CTRL_ADC_EN
mdefine_line|#define CTRL_ADC_EN     0x00000010  /* enable ADC */
DECL|macro|CTRL_UART_EN
mdefine_line|#define CTRL_UART_EN    0x00000008  /* enable MIDI uart */
DECL|macro|CTRL_JYSTK_EN
mdefine_line|#define CTRL_JYSTK_EN   0x00000004  /* enable Joystick port (presumably at address 0x200) */
DECL|macro|CTRL_CDC_EN
mdefine_line|#define CTRL_CDC_EN     0x00000002  /* enable serial (CODEC) interface */
DECL|macro|CTRL_SERR_DIS
mdefine_line|#define CTRL_SERR_DIS   0x00000001  /* 1 = disable PCI SERR signal */
DECL|macro|STAT_INTR
mdefine_line|#define STAT_INTR       0x80000000  /* wired or of all interrupt bits */
DECL|macro|STAT_CSTAT
mdefine_line|#define STAT_CSTAT      0x00000400  /* 1 = codec busy or codec write in progress */
DECL|macro|STAT_CBUSY
mdefine_line|#define STAT_CBUSY      0x00000200  /* 1 = codec busy */
DECL|macro|STAT_CWRIP
mdefine_line|#define STAT_CWRIP      0x00000100  /* 1 = codec write in progress */
DECL|macro|STAT_VC
mdefine_line|#define STAT_VC         0x00000060  /* CCB int source, 0=DAC1, 1=DAC2, 2=ADC, 3=undef */
DECL|macro|STAT_SH_VC
mdefine_line|#define STAT_SH_VC      5
DECL|macro|STAT_MCCB
mdefine_line|#define STAT_MCCB       0x00000010  /* CCB int pending */
DECL|macro|STAT_UART
mdefine_line|#define STAT_UART       0x00000008  /* UART int pending */
DECL|macro|STAT_DAC1
mdefine_line|#define STAT_DAC1       0x00000004  /* DAC1 int pending */
DECL|macro|STAT_DAC2
mdefine_line|#define STAT_DAC2       0x00000002  /* DAC2 int pending */
DECL|macro|STAT_ADC
mdefine_line|#define STAT_ADC        0x00000001  /* ADC int pending */
DECL|macro|USTAT_RXINT
mdefine_line|#define USTAT_RXINT     0x80        /* UART rx int pending */
DECL|macro|USTAT_TXINT
mdefine_line|#define USTAT_TXINT     0x04        /* UART tx int pending */
DECL|macro|USTAT_TXRDY
mdefine_line|#define USTAT_TXRDY     0x02        /* UART tx ready */
DECL|macro|USTAT_RXRDY
mdefine_line|#define USTAT_RXRDY     0x01        /* UART rx ready */
DECL|macro|UCTRL_RXINTEN
mdefine_line|#define UCTRL_RXINTEN   0x80        /* 1 = enable RX ints */
DECL|macro|UCTRL_TXINTEN
mdefine_line|#define UCTRL_TXINTEN   0x60        /* TX int enable field mask */
DECL|macro|UCTRL_ENA_TXINT
mdefine_line|#define UCTRL_ENA_TXINT 0x20        /* enable TX int */
DECL|macro|UCTRL_CNTRL
mdefine_line|#define UCTRL_CNTRL     0x03        /* control field */
DECL|macro|UCTRL_CNTRL_SWR
mdefine_line|#define UCTRL_CNTRL_SWR 0x03        /* software reset command */
DECL|macro|SCTRL_P2ENDINC
mdefine_line|#define SCTRL_P2ENDINC    0x00380000  /*  */
DECL|macro|SCTRL_SH_P2ENDINC
mdefine_line|#define SCTRL_SH_P2ENDINC 19
DECL|macro|SCTRL_P2STINC
mdefine_line|#define SCTRL_P2STINC     0x00070000  /*  */
DECL|macro|SCTRL_SH_P2STINC
mdefine_line|#define SCTRL_SH_P2STINC  16
DECL|macro|SCTRL_R1LOOPSEL
mdefine_line|#define SCTRL_R1LOOPSEL   0x00008000  /* 0 = loop mode */
DECL|macro|SCTRL_P2LOOPSEL
mdefine_line|#define SCTRL_P2LOOPSEL   0x00004000  /* 0 = loop mode */
DECL|macro|SCTRL_P1LOOPSEL
mdefine_line|#define SCTRL_P1LOOPSEL   0x00002000  /* 0 = loop mode */
DECL|macro|SCTRL_P2PAUSE
mdefine_line|#define SCTRL_P2PAUSE     0x00001000  /* 1 = pause mode */
DECL|macro|SCTRL_P1PAUSE
mdefine_line|#define SCTRL_P1PAUSE     0x00000800  /* 1 = pause mode */
DECL|macro|SCTRL_R1INTEN
mdefine_line|#define SCTRL_R1INTEN     0x00000400  /* enable interrupt */
DECL|macro|SCTRL_P2INTEN
mdefine_line|#define SCTRL_P2INTEN     0x00000200  /* enable interrupt */
DECL|macro|SCTRL_P1INTEN
mdefine_line|#define SCTRL_P1INTEN     0x00000100  /* enable interrupt */
DECL|macro|SCTRL_P1SCTRLD
mdefine_line|#define SCTRL_P1SCTRLD    0x00000080  /* reload sample count register for DAC1 */
DECL|macro|SCTRL_P2DACSEN
mdefine_line|#define SCTRL_P2DACSEN    0x00000040  /* 1 = DAC2 play back last sample when disabled */
DECL|macro|SCTRL_R1SEB
mdefine_line|#define SCTRL_R1SEB       0x00000020  /* 1 = 16bit */
DECL|macro|SCTRL_R1SMB
mdefine_line|#define SCTRL_R1SMB       0x00000010  /* 1 = stereo */
DECL|macro|SCTRL_R1FMT
mdefine_line|#define SCTRL_R1FMT       0x00000030  /* format mask */
DECL|macro|SCTRL_SH_R1FMT
mdefine_line|#define SCTRL_SH_R1FMT    4
DECL|macro|SCTRL_P2SEB
mdefine_line|#define SCTRL_P2SEB       0x00000008  /* 1 = 16bit */
DECL|macro|SCTRL_P2SMB
mdefine_line|#define SCTRL_P2SMB       0x00000004  /* 1 = stereo */
DECL|macro|SCTRL_P2FMT
mdefine_line|#define SCTRL_P2FMT       0x0000000c  /* format mask */
DECL|macro|SCTRL_SH_P2FMT
mdefine_line|#define SCTRL_SH_P2FMT    2
DECL|macro|SCTRL_P1SEB
mdefine_line|#define SCTRL_P1SEB       0x00000002  /* 1 = 16bit */
DECL|macro|SCTRL_P1SMB
mdefine_line|#define SCTRL_P1SMB       0x00000001  /* 1 = stereo */
DECL|macro|SCTRL_P1FMT
mdefine_line|#define SCTRL_P1FMT       0x00000003  /* format mask */
DECL|macro|SCTRL_SH_P1FMT
mdefine_line|#define SCTRL_SH_P1FMT    0
multiline_comment|/* misc stuff */
DECL|macro|FMODE_DAC
mdefine_line|#define FMODE_DAC         4           /* slight misuse of mode_t */
multiline_comment|/* MIDI buffer sizes */
DECL|macro|MIDIINBUF
mdefine_line|#define MIDIINBUF  256
DECL|macro|MIDIOUTBUF
mdefine_line|#define MIDIOUTBUF 256
DECL|macro|FMODE_MIDI_SHIFT
mdefine_line|#define FMODE_MIDI_SHIFT 3
DECL|macro|FMODE_MIDI_READ
mdefine_line|#define FMODE_MIDI_READ  (FMODE_READ &lt;&lt; FMODE_MIDI_SHIFT)
DECL|macro|FMODE_MIDI_WRITE
mdefine_line|#define FMODE_MIDI_WRITE (FMODE_WRITE &lt;&lt; FMODE_MIDI_SHIFT)
multiline_comment|/* --------------------------------------------------------------------- */
DECL|struct|es1370_state
r_struct
id|es1370_state
(brace
multiline_comment|/* magic */
DECL|member|magic
r_int
r_int
id|magic
suffix:semicolon
multiline_comment|/* list of es1370 devices */
DECL|member|devs
r_struct
id|list_head
id|devs
suffix:semicolon
multiline_comment|/* the corresponding pci_dev structure */
DECL|member|dev
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
multiline_comment|/* soundcore stuff */
DECL|member|dev_audio
r_int
id|dev_audio
suffix:semicolon
DECL|member|dev_mixer
r_int
id|dev_mixer
suffix:semicolon
DECL|member|dev_dac
r_int
id|dev_dac
suffix:semicolon
DECL|member|dev_midi
r_int
id|dev_midi
suffix:semicolon
multiline_comment|/* hardware resources */
DECL|member|io
r_int
r_int
id|io
suffix:semicolon
multiline_comment|/* long for SPARC */
DECL|member|irq
r_int
r_int
id|irq
suffix:semicolon
multiline_comment|/* mixer registers; there is no HW readback */
r_struct
(brace
DECL|member|vol
r_int
r_int
id|vol
(braket
l_int|10
)braket
suffix:semicolon
DECL|member|recsrc
r_int
r_int
id|recsrc
suffix:semicolon
DECL|member|modcnt
r_int
r_int
id|modcnt
suffix:semicolon
DECL|member|micpreamp
r_int
r_int
id|micpreamp
suffix:semicolon
DECL|member|imix
r_int
r_int
id|imix
suffix:semicolon
DECL|member|mix
)brace
id|mix
suffix:semicolon
multiline_comment|/* wave stuff */
DECL|member|ctrl
r_int
id|ctrl
suffix:semicolon
DECL|member|sctrl
r_int
id|sctrl
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|open_sem
r_struct
id|semaphore
id|open_sem
suffix:semicolon
DECL|member|open_mode
id|mode_t
id|open_mode
suffix:semicolon
DECL|member|open_wait
id|wait_queue_head_t
id|open_wait
suffix:semicolon
DECL|struct|dmabuf
r_struct
id|dmabuf
(brace
DECL|member|rawbuf
r_void
op_star
id|rawbuf
suffix:semicolon
DECL|member|dmaaddr
id|dma_addr_t
id|dmaaddr
suffix:semicolon
DECL|member|buforder
r_int
id|buforder
suffix:semicolon
DECL|member|numfrag
r_int
id|numfrag
suffix:semicolon
DECL|member|fragshift
r_int
id|fragshift
suffix:semicolon
DECL|member|hwptr
DECL|member|swptr
r_int
id|hwptr
comma
id|swptr
suffix:semicolon
DECL|member|total_bytes
r_int
id|total_bytes
suffix:semicolon
DECL|member|count
r_int
id|count
suffix:semicolon
DECL|member|error
r_int
id|error
suffix:semicolon
multiline_comment|/* over/underrun */
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
multiline_comment|/* redundant, but makes calculations easier */
DECL|member|fragsize
r_int
id|fragsize
suffix:semicolon
DECL|member|dmasize
r_int
id|dmasize
suffix:semicolon
DECL|member|fragsamples
r_int
id|fragsamples
suffix:semicolon
multiline_comment|/* OSS stuff */
DECL|member|mapped
r_int
id|mapped
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ready
r_int
id|ready
suffix:colon
l_int|1
suffix:semicolon
DECL|member|endcleared
r_int
id|endcleared
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ossfragshift
r_int
id|ossfragshift
suffix:semicolon
DECL|member|ossmaxfrags
r_int
id|ossmaxfrags
suffix:semicolon
DECL|member|subdivision
r_int
id|subdivision
suffix:semicolon
DECL|member|dma_dac1
DECL|member|dma_dac2
DECL|member|dma_adc
)brace
id|dma_dac1
comma
id|dma_dac2
comma
id|dma_adc
suffix:semicolon
multiline_comment|/* midi stuff */
r_struct
(brace
DECL|member|ird
DECL|member|iwr
DECL|member|icnt
r_int
id|ird
comma
id|iwr
comma
id|icnt
suffix:semicolon
DECL|member|ord
DECL|member|owr
DECL|member|ocnt
r_int
id|ord
comma
id|owr
comma
id|ocnt
suffix:semicolon
DECL|member|iwait
id|wait_queue_head_t
id|iwait
suffix:semicolon
DECL|member|owait
id|wait_queue_head_t
id|owait
suffix:semicolon
DECL|member|ibuf
r_int
r_char
id|ibuf
(braket
id|MIDIINBUF
)braket
suffix:semicolon
DECL|member|obuf
r_int
r_char
id|obuf
(braket
id|MIDIOUTBUF
)braket
suffix:semicolon
DECL|member|midi
)brace
id|midi
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
r_static
id|LIST_HEAD
c_func
(paren
id|devs
)paren
suffix:semicolon
multiline_comment|/*&n; * The following buffer is used to point the phantom write channel to,&n; * so that it cannot wreak havoc. The attribute makes sure it doesn&squot;t&n; * cross a page boundary and ensures dword alignment for the DMA engine&n; */
DECL|variable|bugbuf
r_static
r_int
r_char
id|bugbuf
(braket
l_int|16
)braket
id|__attribute__
(paren
(paren
id|aligned
(paren
l_int|16
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|ld2
r_extern
r_inline
r_int
id|ld2
c_func
(paren
r_int
r_int
id|x
)paren
(brace
r_int
id|r
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x
op_ge
l_int|0x10000
)paren
(brace
id|x
op_rshift_assign
l_int|16
suffix:semicolon
id|r
op_add_assign
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|0x100
)paren
(brace
id|x
op_rshift_assign
l_int|8
suffix:semicolon
id|r
op_add_assign
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|0x10
)paren
(brace
id|x
op_rshift_assign
l_int|4
suffix:semicolon
id|r
op_add_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|4
)paren
(brace
id|x
op_rshift_assign
l_int|2
suffix:semicolon
id|r
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|2
)paren
id|r
op_increment
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|wrcodec
r_static
r_void
id|wrcodec
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
comma
r_int
r_char
id|idx
comma
r_int
r_char
id|data
)paren
(brace
r_int
r_int
id|tmo
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|10
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inl
c_func
(paren
id|s-&gt;io
op_plus
id|ES1370_REG_STATUS
)paren
op_amp
id|STAT_CSTAT
)paren
)paren
(brace
id|outw
c_func
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|idx
)paren
op_lshift
l_int|8
)paren
op_or
id|data
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CODEC
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
r_int
)paren
(paren
id|tmo
op_minus
id|jiffies
)paren
OG
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;es1370: write to codec register timeout&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|stop_adc
r_extern
r_inline
r_void
id|stop_adc
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;ctrl
op_and_assign
op_complement
id|CTRL_ADC_EN
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|stop_dac1
r_extern
r_inline
r_void
id|stop_dac1
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;ctrl
op_and_assign
op_complement
id|CTRL_DAC1_EN
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|stop_dac2
r_extern
r_inline
r_void
id|stop_dac2
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;ctrl
op_and_assign
op_complement
id|CTRL_DAC2_EN
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|start_dac1
r_static
r_void
id|start_dac1
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|fragremain
comma
id|fshift
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_DAC1_EN
)paren
op_logical_and
(paren
id|s-&gt;dma_dac1.mapped
op_logical_or
id|s-&gt;dma_dac1.count
OG
l_int|0
)paren
op_logical_and
id|s-&gt;dma_dac1.ready
)paren
(brace
id|s-&gt;ctrl
op_or_assign
id|CTRL_DAC1_EN
suffix:semicolon
id|s-&gt;sctrl
op_assign
(paren
id|s-&gt;sctrl
op_amp
op_complement
(paren
id|SCTRL_P1LOOPSEL
op_or
id|SCTRL_P1PAUSE
op_or
id|SCTRL_P1SCTRLD
)paren
)paren
op_or
id|SCTRL_P1INTEN
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|fragremain
op_assign
(paren
(paren
op_minus
id|s-&gt;dma_dac1.hwptr
)paren
op_amp
(paren
id|s-&gt;dma_dac1.fragsize
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|fshift
op_assign
id|sample_shift
(braket
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P1FMT
)paren
op_rshift
id|SCTRL_SH_P1FMT
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fragremain
OL
l_int|2
op_star
id|fshift
)paren
id|fragremain
op_assign
id|s-&gt;dma_dac1.fragsize
suffix:semicolon
id|outl
c_func
(paren
(paren
id|fragremain
op_rshift
id|fshift
)paren
op_minus
l_int|1
comma
id|s-&gt;io
op_plus
id|ES1370_REG_DAC1_SCOUNT
)paren
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|s-&gt;dma_dac1.fragsize
op_rshift
id|fshift
)paren
op_minus
l_int|1
comma
id|s-&gt;io
op_plus
id|ES1370_REG_DAC1_SCOUNT
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|start_dac2
r_static
r_void
id|start_dac2
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|fragremain
comma
id|fshift
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_DAC2_EN
)paren
op_logical_and
(paren
id|s-&gt;dma_dac2.mapped
op_logical_or
id|s-&gt;dma_dac2.count
OG
l_int|0
)paren
op_logical_and
id|s-&gt;dma_dac2.ready
)paren
(brace
id|s-&gt;ctrl
op_or_assign
id|CTRL_DAC2_EN
suffix:semicolon
id|s-&gt;sctrl
op_assign
(paren
id|s-&gt;sctrl
op_amp
op_complement
(paren
id|SCTRL_P2LOOPSEL
op_or
id|SCTRL_P2PAUSE
op_or
id|SCTRL_P2DACSEN
op_or
id|SCTRL_P2ENDINC
op_or
id|SCTRL_P2STINC
)paren
)paren
op_or
id|SCTRL_P2INTEN
op_or
(paren
(paren
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P2FMT
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
op_lshift
id|SCTRL_SH_P2ENDINC
)paren
op_or
(paren
l_int|0
op_lshift
id|SCTRL_SH_P2STINC
)paren
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|fragremain
op_assign
(paren
(paren
op_minus
id|s-&gt;dma_dac2.hwptr
)paren
op_amp
(paren
id|s-&gt;dma_dac2.fragsize
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|fshift
op_assign
id|sample_shift
(braket
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P2FMT
)paren
op_rshift
id|SCTRL_SH_P2FMT
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fragremain
OL
l_int|2
op_star
id|fshift
)paren
id|fragremain
op_assign
id|s-&gt;dma_dac2.fragsize
suffix:semicolon
id|outl
c_func
(paren
(paren
id|fragremain
op_rshift
id|fshift
)paren
op_minus
l_int|1
comma
id|s-&gt;io
op_plus
id|ES1370_REG_DAC2_SCOUNT
)paren
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|s-&gt;dma_dac2.fragsize
op_rshift
id|fshift
)paren
op_minus
l_int|1
comma
id|s-&gt;io
op_plus
id|ES1370_REG_DAC2_SCOUNT
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|start_adc
r_static
r_void
id|start_adc
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|fragremain
comma
id|fshift
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_ADC_EN
)paren
op_logical_and
(paren
id|s-&gt;dma_adc.mapped
op_logical_or
id|s-&gt;dma_adc.count
OL
(paren
r_int
)paren
(paren
id|s-&gt;dma_adc.dmasize
op_minus
l_int|2
op_star
id|s-&gt;dma_adc.fragsize
)paren
)paren
op_logical_and
id|s-&gt;dma_adc.ready
)paren
(brace
id|s-&gt;ctrl
op_or_assign
id|CTRL_ADC_EN
suffix:semicolon
id|s-&gt;sctrl
op_assign
(paren
id|s-&gt;sctrl
op_amp
op_complement
id|SCTRL_R1LOOPSEL
)paren
op_or
id|SCTRL_R1INTEN
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|fragremain
op_assign
(paren
(paren
op_minus
id|s-&gt;dma_adc.hwptr
)paren
op_amp
(paren
id|s-&gt;dma_adc.fragsize
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|fshift
op_assign
id|sample_shift
(braket
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_R1FMT
)paren
op_rshift
id|SCTRL_SH_R1FMT
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fragremain
OL
l_int|2
op_star
id|fshift
)paren
id|fragremain
op_assign
id|s-&gt;dma_adc.fragsize
suffix:semicolon
id|outl
c_func
(paren
(paren
id|fragremain
op_rshift
id|fshift
)paren
op_minus
l_int|1
comma
id|s-&gt;io
op_plus
id|ES1370_REG_ADC_SCOUNT
)paren
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|s-&gt;dma_adc.fragsize
op_rshift
id|fshift
)paren
op_minus
l_int|1
comma
id|s-&gt;io
op_plus
id|ES1370_REG_ADC_SCOUNT
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|DMABUF_DEFAULTORDER
mdefine_line|#define DMABUF_DEFAULTORDER (17-PAGE_SHIFT)
DECL|macro|DMABUF_MINORDER
mdefine_line|#define DMABUF_MINORDER 1
DECL|function|dealloc_dmabuf
r_extern
r_inline
r_void
id|dealloc_dmabuf
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
comma
r_struct
id|dmabuf
op_star
id|db
)paren
(brace
r_struct
id|page
op_star
id|page
comma
op_star
id|pend
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;rawbuf
)paren
(brace
multiline_comment|/* undo marking the pages as reserved */
id|pend
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|page
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
)paren
suffix:semicolon
id|page
op_le
id|pend
suffix:semicolon
id|page
op_increment
)paren
id|mem_map_unreserve
c_func
(paren
id|page
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|s-&gt;dev
comma
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
comma
id|db-&gt;rawbuf
comma
id|db-&gt;dmaaddr
)paren
suffix:semicolon
)brace
id|db-&gt;rawbuf
op_assign
l_int|NULL
suffix:semicolon
id|db-&gt;mapped
op_assign
id|db-&gt;ready
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|prog_dmabuf
r_static
r_int
id|prog_dmabuf
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
comma
r_struct
id|dmabuf
op_star
id|db
comma
r_int
id|rate
comma
r_int
id|fmt
comma
r_int
id|reg
)paren
(brace
r_int
id|order
suffix:semicolon
r_int
id|bytepersec
suffix:semicolon
r_int
id|bufs
suffix:semicolon
r_struct
id|page
op_star
id|page
comma
op_star
id|pend
suffix:semicolon
id|db-&gt;hwptr
op_assign
id|db-&gt;swptr
op_assign
id|db-&gt;total_bytes
op_assign
id|db-&gt;count
op_assign
id|db-&gt;error
op_assign
id|db-&gt;endcleared
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;rawbuf
)paren
(brace
id|db-&gt;ready
op_assign
id|db-&gt;mapped
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
id|DMABUF_DEFAULTORDER
suffix:semicolon
id|order
op_ge
id|DMABUF_MINORDER
suffix:semicolon
id|order
op_decrement
)paren
r_if
c_cond
(paren
(paren
id|db-&gt;rawbuf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|s-&gt;dev
comma
id|PAGE_SIZE
op_lshift
id|order
comma
op_amp
id|db-&gt;dmaaddr
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;rawbuf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|db-&gt;buforder
op_assign
id|order
suffix:semicolon
multiline_comment|/* now mark the pages as reserved; otherwise remap_page_range doesn&squot;t do what we want */
id|pend
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|page
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
)paren
suffix:semicolon
id|page
op_le
id|pend
suffix:semicolon
id|page
op_increment
)paren
id|mem_map_reserve
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
id|fmt
op_and_assign
id|ES1370_FMT_MASK
suffix:semicolon
id|bytepersec
op_assign
id|rate
op_lshift
id|sample_shift
(braket
id|fmt
)braket
suffix:semicolon
id|bufs
op_assign
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;ossfragshift
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|1000
op_lshift
id|db-&gt;ossfragshift
)paren
OL
id|bytepersec
)paren
id|db-&gt;fragshift
op_assign
id|ld2
c_func
(paren
id|bytepersec
op_div
l_int|1000
)paren
suffix:semicolon
r_else
id|db-&gt;fragshift
op_assign
id|db-&gt;ossfragshift
suffix:semicolon
)brace
r_else
(brace
id|db-&gt;fragshift
op_assign
id|ld2
c_func
(paren
id|bytepersec
op_div
l_int|100
op_div
(paren
id|db-&gt;subdivision
ques
c_cond
id|db-&gt;subdivision
suffix:colon
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;fragshift
OL
l_int|3
)paren
id|db-&gt;fragshift
op_assign
l_int|3
suffix:semicolon
)brace
id|db-&gt;numfrag
op_assign
id|bufs
op_rshift
id|db-&gt;fragshift
suffix:semicolon
r_while
c_loop
(paren
id|db-&gt;numfrag
template_param
l_int|3
)paren
(brace
id|db-&gt;fragshift
op_decrement
suffix:semicolon
id|db-&gt;numfrag
op_assign
id|bufs
op_rshift
id|db-&gt;fragshift
suffix:semicolon
)brace
id|db-&gt;fragsize
op_assign
l_int|1
op_lshift
id|db-&gt;fragshift
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;ossmaxfrags
op_ge
l_int|4
op_logical_and
id|db-&gt;ossmaxfrags
OL
id|db-&gt;numfrag
)paren
id|db-&gt;numfrag
op_assign
id|db-&gt;ossmaxfrags
suffix:semicolon
id|db-&gt;fragsamples
op_assign
id|db-&gt;fragsize
op_rshift
id|sample_shift
(braket
id|fmt
)braket
suffix:semicolon
id|db-&gt;dmasize
op_assign
id|db-&gt;numfrag
op_lshift
id|db-&gt;fragshift
suffix:semicolon
id|memset
c_func
(paren
id|db-&gt;rawbuf
comma
(paren
id|fmt
op_amp
id|ES1370_FMT_S16
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|0x80
comma
id|db-&gt;dmasize
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|reg
op_rshift
l_int|8
)paren
op_amp
l_int|15
comma
id|s-&gt;io
op_plus
id|ES1370_REG_MEMPAGE
)paren
suffix:semicolon
id|outl
c_func
(paren
id|db-&gt;dmaaddr
comma
id|s-&gt;io
op_plus
(paren
id|reg
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|db-&gt;dmasize
op_rshift
l_int|2
)paren
op_minus
l_int|1
comma
id|s-&gt;io
op_plus
(paren
(paren
id|reg
op_plus
l_int|4
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|db-&gt;ready
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prog_dmabuf_adc
r_extern
r_inline
r_int
id|prog_dmabuf_adc
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|prog_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_adc
comma
id|DAC2_DIVTOSR
c_func
(paren
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_PCLKDIV
)paren
op_rshift
id|CTRL_SH_PCLKDIV
)paren
comma
(paren
id|s-&gt;sctrl
op_rshift
id|SCTRL_SH_R1FMT
)paren
op_amp
id|ES1370_FMT_MASK
comma
id|ES1370_REG_ADC_FRAMEADR
)paren
suffix:semicolon
)brace
DECL|function|prog_dmabuf_dac2
r_extern
r_inline
r_int
id|prog_dmabuf_dac2
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
id|stop_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|prog_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_dac2
comma
id|DAC2_DIVTOSR
c_func
(paren
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_PCLKDIV
)paren
op_rshift
id|CTRL_SH_PCLKDIV
)paren
comma
(paren
id|s-&gt;sctrl
op_rshift
id|SCTRL_SH_P2FMT
)paren
op_amp
id|ES1370_FMT_MASK
comma
id|ES1370_REG_DAC2_FRAMEADR
)paren
suffix:semicolon
)brace
DECL|function|prog_dmabuf_dac1
r_extern
r_inline
r_int
id|prog_dmabuf_dac1
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
id|stop_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|prog_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_dac1
comma
id|dac1_samplerate
(braket
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_WTSRSEL
)paren
op_rshift
id|CTRL_SH_WTSRSEL
)braket
comma
(paren
id|s-&gt;sctrl
op_rshift
id|SCTRL_SH_P1FMT
)paren
op_amp
id|ES1370_FMT_MASK
comma
id|ES1370_REG_DAC1_FRAMEADR
)paren
suffix:semicolon
)brace
DECL|function|get_hwptr
r_extern
r_inline
r_int
id|get_hwptr
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
comma
r_struct
id|dmabuf
op_star
id|db
comma
r_int
id|reg
)paren
(brace
r_int
id|hwptr
comma
id|diff
suffix:semicolon
id|outl
c_func
(paren
(paren
id|reg
op_rshift
l_int|8
)paren
op_amp
l_int|15
comma
id|s-&gt;io
op_plus
id|ES1370_REG_MEMPAGE
)paren
suffix:semicolon
id|hwptr
op_assign
(paren
id|inl
c_func
(paren
id|s-&gt;io
op_plus
(paren
id|reg
op_amp
l_int|0xff
)paren
)paren
op_rshift
l_int|14
)paren
op_amp
l_int|0x3fffc
suffix:semicolon
id|diff
op_assign
(paren
id|db-&gt;dmasize
op_plus
id|hwptr
op_minus
id|db-&gt;hwptr
)paren
op_mod
id|db-&gt;dmasize
suffix:semicolon
id|db-&gt;hwptr
op_assign
id|hwptr
suffix:semicolon
r_return
id|diff
suffix:semicolon
)brace
DECL|function|clear_advance
r_extern
r_inline
r_void
id|clear_advance
c_func
(paren
r_void
op_star
id|buf
comma
r_int
id|bsize
comma
r_int
id|bptr
comma
r_int
id|len
comma
r_int
r_char
id|c
)paren
(brace
r_if
c_cond
(paren
id|bptr
op_plus
id|len
OG
id|bsize
)paren
(brace
r_int
id|x
op_assign
id|bsize
op_minus
id|bptr
suffix:semicolon
id|memset
c_func
(paren
(paren
(paren
r_char
op_star
)paren
id|buf
)paren
op_plus
id|bptr
comma
id|c
comma
id|x
)paren
suffix:semicolon
id|bptr
op_assign
l_int|0
suffix:semicolon
id|len
op_sub_assign
id|x
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
(paren
r_char
op_star
)paren
id|buf
)paren
op_plus
id|bptr
comma
id|c
comma
id|len
)paren
suffix:semicolon
)brace
multiline_comment|/* call with spinlock held! */
DECL|function|es1370_update_ptr
r_static
r_void
id|es1370_update_ptr
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
r_int
id|diff
suffix:semicolon
multiline_comment|/* update ADC pointer */
r_if
c_cond
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_ADC_EN
)paren
(brace
id|diff
op_assign
id|get_hwptr
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_adc
comma
id|ES1370_REG_ADC_FRAMECNT
)paren
suffix:semicolon
id|s-&gt;dma_adc.total_bytes
op_add_assign
id|diff
suffix:semicolon
id|s-&gt;dma_adc.count
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_adc.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.mapped
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
OG
(paren
r_int
)paren
(paren
id|s-&gt;dma_adc.dmasize
op_minus
(paren
(paren
l_int|3
op_star
id|s-&gt;dma_adc.fragsize
)paren
op_rshift
l_int|1
)paren
)paren
)paren
(brace
id|s-&gt;ctrl
op_and_assign
op_complement
id|CTRL_ADC_EN
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|s-&gt;dma_adc.error
op_increment
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* update DAC1 pointer */
r_if
c_cond
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_DAC1_EN
)paren
(brace
id|diff
op_assign
id|get_hwptr
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_dac1
comma
id|ES1370_REG_DAC1_FRAMECNT
)paren
suffix:semicolon
id|s-&gt;dma_dac1.total_bytes
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.mapped
)paren
(brace
id|s-&gt;dma_dac1.count
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_dac1.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_dac1.wait
)paren
suffix:semicolon
)brace
r_else
(brace
id|s-&gt;dma_dac1.count
op_sub_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.count
op_le
l_int|0
)paren
(brace
id|s-&gt;ctrl
op_and_assign
op_complement
id|CTRL_DAC1_EN
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|s-&gt;dma_dac1.error
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;dma_dac1.count
op_le
(paren
r_int
)paren
id|s-&gt;dma_dac1.fragsize
op_logical_and
op_logical_neg
id|s-&gt;dma_dac1.endcleared
)paren
(brace
id|clear_advance
c_func
(paren
id|s-&gt;dma_dac1.rawbuf
comma
id|s-&gt;dma_dac1.dmasize
comma
id|s-&gt;dma_dac1.swptr
comma
id|s-&gt;dma_dac1.fragsize
comma
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P1SEB
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|0x80
)paren
suffix:semicolon
id|s-&gt;dma_dac1.endcleared
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;dma_dac1.count
op_plus
(paren
r_int
)paren
id|s-&gt;dma_dac1.fragsize
op_le
(paren
r_int
)paren
id|s-&gt;dma_dac1.dmasize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_dac1.wait
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* update DAC2 pointer */
r_if
c_cond
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_DAC2_EN
)paren
(brace
id|diff
op_assign
id|get_hwptr
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_dac2
comma
id|ES1370_REG_DAC2_FRAMECNT
)paren
suffix:semicolon
id|s-&gt;dma_dac2.total_bytes
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.mapped
)paren
(brace
id|s-&gt;dma_dac2.count
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_dac2.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_dac2.wait
)paren
suffix:semicolon
)brace
r_else
(brace
id|s-&gt;dma_dac2.count
op_sub_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.count
op_le
l_int|0
)paren
(brace
id|s-&gt;ctrl
op_and_assign
op_complement
id|CTRL_DAC2_EN
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|s-&gt;dma_dac2.error
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;dma_dac2.count
op_le
(paren
r_int
)paren
id|s-&gt;dma_dac2.fragsize
op_logical_and
op_logical_neg
id|s-&gt;dma_dac2.endcleared
)paren
(brace
id|clear_advance
c_func
(paren
id|s-&gt;dma_dac2.rawbuf
comma
id|s-&gt;dma_dac2.dmasize
comma
id|s-&gt;dma_dac2.swptr
comma
id|s-&gt;dma_dac2.fragsize
comma
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P2SEB
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|0x80
)paren
suffix:semicolon
id|s-&gt;dma_dac2.endcleared
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;dma_dac2.count
op_plus
(paren
r_int
)paren
id|s-&gt;dma_dac2.fragsize
op_le
(paren
r_int
)paren
id|s-&gt;dma_dac2.dmasize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_dac2.wait
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* hold spinlock for the following! */
DECL|function|es1370_handle_midi
r_static
r_void
id|es1370_handle_midi
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
)paren
(brace
r_int
r_char
id|ch
suffix:semicolon
r_int
id|wake
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_UART_EN
)paren
)paren
r_return
suffix:semicolon
id|wake
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|inb
c_func
(paren
id|s-&gt;io
op_plus
id|ES1370_REG_UART_STATUS
)paren
op_amp
id|USTAT_RXRDY
)paren
(brace
id|ch
op_assign
id|inb
c_func
(paren
id|s-&gt;io
op_plus
id|ES1370_REG_UART_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.icnt
OL
id|MIDIINBUF
)paren
(brace
id|s-&gt;midi.ibuf
(braket
id|s-&gt;midi.iwr
)braket
op_assign
id|ch
suffix:semicolon
id|s-&gt;midi.iwr
op_assign
(paren
id|s-&gt;midi.iwr
op_plus
l_int|1
)paren
op_mod
id|MIDIINBUF
suffix:semicolon
id|s-&gt;midi.icnt
op_increment
suffix:semicolon
)brace
id|wake
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wake
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;midi.iwait
)paren
suffix:semicolon
id|wake
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|s-&gt;io
op_plus
id|ES1370_REG_UART_STATUS
)paren
op_amp
id|USTAT_TXRDY
)paren
op_logical_and
id|s-&gt;midi.ocnt
OG
l_int|0
)paren
(brace
id|outb
c_func
(paren
id|s-&gt;midi.obuf
(braket
id|s-&gt;midi.ord
)braket
comma
id|s-&gt;io
op_plus
id|ES1370_REG_UART_DATA
)paren
suffix:semicolon
id|s-&gt;midi.ord
op_assign
(paren
id|s-&gt;midi.ord
op_plus
l_int|1
)paren
op_mod
id|MIDIOUTBUF
suffix:semicolon
id|s-&gt;midi.ocnt
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.ocnt
OL
id|MIDIOUTBUF
op_minus
l_int|16
)paren
id|wake
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wake
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;midi.owait
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|s-&gt;midi.ocnt
OG
l_int|0
)paren
ques
c_cond
id|UCTRL_RXINTEN
op_or
id|UCTRL_ENA_TXINT
suffix:colon
id|UCTRL_RXINTEN
comma
id|s-&gt;io
op_plus
id|ES1370_REG_UART_CONTROL
)paren
suffix:semicolon
)brace
DECL|function|es1370_interrupt
r_static
r_void
id|es1370_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|dev_id
suffix:semicolon
r_int
r_int
id|intsrc
comma
id|sctl
suffix:semicolon
multiline_comment|/* fastpath out, to ease interrupt sharing */
id|intsrc
op_assign
id|inl
c_func
(paren
id|s-&gt;io
op_plus
id|ES1370_REG_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|intsrc
op_amp
l_int|0x80000000
)paren
)paren
r_return
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* clear audio interrupts first */
id|sctl
op_assign
id|s-&gt;sctrl
suffix:semicolon
r_if
c_cond
(paren
id|intsrc
op_amp
id|STAT_ADC
)paren
id|sctl
op_and_assign
op_complement
id|SCTRL_R1INTEN
suffix:semicolon
r_if
c_cond
(paren
id|intsrc
op_amp
id|STAT_DAC1
)paren
id|sctl
op_and_assign
op_complement
id|SCTRL_P1INTEN
suffix:semicolon
r_if
c_cond
(paren
id|intsrc
op_amp
id|STAT_DAC2
)paren
id|sctl
op_and_assign
op_complement
id|SCTRL_P2INTEN
suffix:semicolon
id|outl
c_func
(paren
id|sctl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|es1370_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|invalid_magic
r_static
r_const
r_char
id|invalid_magic
(braket
)braket
op_assign
id|KERN_CRIT
l_string|&quot;es1370: invalid magic value&bslash;n&quot;
suffix:semicolon
DECL|macro|VALIDATE_STATE
mdefine_line|#define VALIDATE_STATE(s)                         &bslash;&n;({                                                &bslash;&n;&t;if (!(s) || (s)-&gt;magic != ES1370_MAGIC) { &bslash;&n;&t;&t;printk(invalid_magic);            &bslash;&n;&t;&t;return -ENXIO;                    &bslash;&n;&t;}                                         &bslash;&n;})
multiline_comment|/* --------------------------------------------------------------------- */
r_static
r_const
r_struct
(brace
DECL|member|volidx
r_int
id|volidx
suffix:colon
l_int|4
suffix:semicolon
DECL|member|left
r_int
id|left
suffix:colon
l_int|4
suffix:semicolon
DECL|member|right
r_int
id|right
suffix:colon
l_int|4
suffix:semicolon
DECL|member|stereo
r_int
id|stereo
suffix:colon
l_int|1
suffix:semicolon
DECL|member|recmask
r_int
id|recmask
suffix:colon
l_int|13
suffix:semicolon
DECL|member|avail
r_int
id|avail
suffix:colon
l_int|1
suffix:semicolon
DECL|variable|mixtable
)brace
id|mixtable
(braket
id|SOUND_MIXER_NRDEVICES
)braket
op_assign
(brace
(braket
id|SOUND_MIXER_VOLUME
)braket
op_assign
(brace
l_int|0
comma
l_int|0x0
comma
l_int|0x1
comma
l_int|1
comma
l_int|0x0000
comma
l_int|1
)brace
comma
multiline_comment|/* master */
(braket
id|SOUND_MIXER_PCM
)braket
op_assign
(brace
l_int|1
comma
l_int|0x2
comma
l_int|0x3
comma
l_int|1
comma
l_int|0x0400
comma
l_int|1
)brace
comma
multiline_comment|/* voice */
(braket
id|SOUND_MIXER_SYNTH
)braket
op_assign
(brace
l_int|2
comma
l_int|0x4
comma
l_int|0x5
comma
l_int|1
comma
l_int|0x0060
comma
l_int|1
)brace
comma
multiline_comment|/* FM */
(braket
id|SOUND_MIXER_CD
)braket
op_assign
(brace
l_int|3
comma
l_int|0x6
comma
l_int|0x7
comma
l_int|1
comma
l_int|0x0006
comma
l_int|1
)brace
comma
multiline_comment|/* CD */
(braket
id|SOUND_MIXER_LINE
)braket
op_assign
(brace
l_int|4
comma
l_int|0x8
comma
l_int|0x9
comma
l_int|1
comma
l_int|0x0018
comma
l_int|1
)brace
comma
multiline_comment|/* Line */
(braket
id|SOUND_MIXER_LINE1
)braket
op_assign
(brace
l_int|5
comma
l_int|0xa
comma
l_int|0xb
comma
l_int|1
comma
l_int|0x1800
comma
l_int|1
)brace
comma
multiline_comment|/* AUX */
(braket
id|SOUND_MIXER_LINE2
)braket
op_assign
(brace
l_int|6
comma
l_int|0xc
comma
l_int|0x0
comma
l_int|0
comma
l_int|0x0100
comma
l_int|1
)brace
comma
multiline_comment|/* Mono1 */
(braket
id|SOUND_MIXER_LINE3
)braket
op_assign
(brace
l_int|7
comma
l_int|0xd
comma
l_int|0x0
comma
l_int|0
comma
l_int|0x0200
comma
l_int|1
)brace
comma
multiline_comment|/* Mono2 */
(braket
id|SOUND_MIXER_MIC
)braket
op_assign
(brace
l_int|8
comma
l_int|0xe
comma
l_int|0x0
comma
l_int|0
comma
l_int|0x0001
comma
l_int|1
)brace
comma
multiline_comment|/* Mic */
(braket
id|SOUND_MIXER_OGAIN
)braket
op_assign
(brace
l_int|9
comma
l_int|0xf
comma
l_int|0x0
comma
l_int|0
comma
l_int|0x0000
comma
l_int|1
)brace
multiline_comment|/* mono out */
)brace
suffix:semicolon
DECL|function|set_recsrc
r_static
r_void
id|set_recsrc
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mixtable
(braket
id|i
)braket
dot
id|recmask
)paren
(brace
id|val
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|j
op_or_assign
id|mixtable
(braket
id|i
)braket
dot
id|recmask
suffix:semicolon
)brace
id|s-&gt;mix.recsrc
op_assign
id|val
suffix:semicolon
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x12
comma
id|j
op_amp
l_int|0xd5
)paren
suffix:semicolon
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x13
comma
id|j
op_amp
l_int|0xaa
)paren
suffix:semicolon
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x14
comma
(paren
id|j
op_rshift
l_int|8
)paren
op_amp
l_int|0x17
)paren
suffix:semicolon
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x15
comma
(paren
id|j
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|i
op_assign
(paren
id|j
op_amp
l_int|0x37f
)paren
op_or
(paren
(paren
id|j
op_lshift
l_int|1
)paren
op_amp
l_int|0x3000
)paren
op_or
l_int|0xc60
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;mix.imix
)paren
(brace
id|i
op_and_assign
l_int|0xff60
suffix:semicolon
multiline_comment|/* mute record and line monitor */
)brace
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x10
comma
id|i
)paren
suffix:semicolon
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x11
comma
id|i
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|function|mixer_ioctl
r_static
r_int
id|mixer_ioctl
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|val
suffix:semicolon
r_int
r_char
id|l
comma
id|r
comma
id|rl
comma
id|rr
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_PRIVATE1
)paren
(brace
multiline_comment|/* enable/disable/query mixer preamp */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
op_minus
l_int|1
)paren
(brace
id|s-&gt;mix.micpreamp
op_assign
op_logical_neg
op_logical_neg
id|val
suffix:semicolon
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x19
comma
id|s-&gt;mix.micpreamp
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.micpreamp
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_PRIVATE2
)paren
(brace
multiline_comment|/* enable/disable/query use of linein as second lineout */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
op_minus
l_int|1
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|s-&gt;ctrl
op_or_assign
id|CTRL_XCTL0
suffix:semicolon
r_else
id|s-&gt;ctrl
op_and_assign
op_complement
id|CTRL_XCTL0
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_XCTL0
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_PRIVATE3
)paren
(brace
multiline_comment|/* enable/disable/query microphone impedance setting */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
op_minus
l_int|1
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|s-&gt;ctrl
op_or_assign
id|CTRL_XCTL1
suffix:semicolon
r_else
id|s-&gt;ctrl
op_and_assign
op_complement
id|CTRL_XCTL1
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_XCTL1
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_INFO
)paren
(brace
id|mixer_info
id|info
suffix:semicolon
id|strncpy
c_func
(paren
id|info.id
comma
l_string|&quot;ES1370&quot;
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|info.name
comma
l_string|&quot;Ensoniq ES1370&quot;
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
id|info.modify_counter
op_assign
id|s-&gt;mix.modcnt
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_OLD_MIXER_INFO
)paren
(brace
id|_old_mixer_info
id|info
suffix:semicolon
id|strncpy
c_func
(paren
id|info.id
comma
l_string|&quot;ES1370&quot;
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|info.name
comma
l_string|&quot;Ensoniq ES1370&quot;
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|OSS_GETVERSION
)paren
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_IOC_TYPE
c_func
(paren
id|cmd
)paren
op_ne
l_char|&squot;M&squot;
op_logical_or
id|_SIOC_SIZE
c_func
(paren
id|cmd
)paren
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_eq
id|_SIOC_READ
)paren
(brace
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.recsrc
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported device */
id|val
op_assign
id|SOUND_MASK_IMIX
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|avail
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported recording source */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|recmask
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
multiline_comment|/* Mixer channels supporting stereo */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|stereo
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
r_return
id|put_user
c_func
(paren
l_int|0
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_IMIX
suffix:colon
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.imix
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|SOUND_MIXER_NRDEVICES
op_logical_or
op_logical_neg
id|mixtable
(braket
id|i
)braket
dot
id|avail
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
id|mixtable
(braket
id|i
)braket
dot
id|volidx
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_ne
(paren
id|_SIOC_READ
op_or
id|_SIOC_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s-&gt;mix.modcnt
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_IMIX
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|s-&gt;mix.imix
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_recsrc
c_func
(paren
id|s
comma
id|s-&gt;mix.recsrc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_recsrc
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|SOUND_MIXER_NRDEVICES
op_logical_or
op_logical_neg
id|mixtable
(braket
id|i
)braket
dot
id|avail
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|l
op_assign
id|val
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|100
)paren
id|l
op_assign
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|stereo
)paren
(brace
id|r
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|r
OG
l_int|100
)paren
id|r
op_assign
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|l
OL
l_int|7
)paren
(brace
id|rl
op_assign
l_int|0x80
suffix:semicolon
id|l
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|rl
op_assign
l_int|31
op_minus
(paren
(paren
id|l
op_minus
l_int|7
)paren
op_div
l_int|3
)paren
suffix:semicolon
id|l
op_assign
(paren
l_int|31
op_minus
id|rl
)paren
op_star
l_int|3
op_plus
l_int|7
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r
OL
l_int|7
)paren
(brace
id|rr
op_assign
l_int|0x80
suffix:semicolon
id|r
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|rr
op_assign
l_int|31
op_minus
(paren
(paren
id|r
op_minus
l_int|7
)paren
op_div
l_int|3
)paren
suffix:semicolon
id|r
op_assign
(paren
l_int|31
op_minus
id|rr
)paren
op_star
l_int|3
op_plus
l_int|7
suffix:semicolon
)brace
id|wrcodec
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|right
comma
id|rr
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|left
op_eq
l_int|15
)paren
(brace
r_if
c_cond
(paren
id|l
OL
l_int|2
)paren
(brace
id|rr
op_assign
id|rl
op_assign
l_int|0x80
suffix:semicolon
id|r
op_assign
id|l
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|rl
op_assign
l_int|7
op_minus
(paren
(paren
id|l
op_minus
l_int|2
)paren
op_div
l_int|14
)paren
suffix:semicolon
id|r
op_assign
id|l
op_assign
(paren
l_int|7
op_minus
id|rl
)paren
op_star
l_int|14
op_plus
l_int|2
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|l
OL
l_int|7
)paren
(brace
id|rl
op_assign
l_int|0x80
suffix:semicolon
id|r
op_assign
id|l
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|rl
op_assign
l_int|31
op_minus
(paren
(paren
id|l
op_minus
l_int|7
)paren
op_div
l_int|3
)paren
suffix:semicolon
id|r
op_assign
id|l
op_assign
(paren
l_int|31
op_minus
id|rl
)paren
op_star
l_int|3
op_plus
l_int|7
suffix:semicolon
)brace
)brace
)brace
id|wrcodec
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
comma
id|rl
)paren
suffix:semicolon
macro_line|#ifdef OSS_DOCUMENTED_MIXER_SEMANTICS
id|s-&gt;mix.vol
(braket
id|mixtable
(braket
id|i
)braket
dot
id|volidx
)braket
op_assign
(paren
(paren
r_int
r_int
)paren
id|r
op_lshift
l_int|8
)paren
op_or
id|l
suffix:semicolon
macro_line|#else
id|s-&gt;mix.vol
(braket
id|mixtable
(braket
id|i
)braket
dot
id|volidx
)braket
op_assign
id|val
suffix:semicolon
macro_line|#endif
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
id|mixtable
(braket
id|i
)braket
dot
id|volidx
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|es1370_llseek
r_static
id|loff_t
id|es1370_llseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|loff_t
id|offset
comma
r_int
id|origin
)paren
(brace
r_return
op_minus
id|ESPIPE
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|es1370_open_mixdev
r_static
r_int
id|es1370_open_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|es1370_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|es1370_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dev_mixer
op_eq
id|minor
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|es1370_release_mixdev
r_static
r_int
id|es1370_release_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|es1370_ioctl_mixdev
r_static
r_int
id|es1370_ioctl_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|mixer_ioctl
c_func
(paren
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|variable|es1370_mixer_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|es1370_mixer_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|es1370_llseek
comma
id|ioctl
suffix:colon
id|es1370_ioctl_mixdev
comma
id|open
suffix:colon
id|es1370_open_mixdev
comma
id|release
suffix:colon
id|es1370_release_mixdev
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|drain_dac1
r_static
r_int
id|drain_dac1
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
comma
r_int
id|nonblock
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
comma
id|tmo
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.mapped
op_logical_or
op_logical_neg
id|s-&gt;dma_dac1.ready
)paren
r_return
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac1.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac1.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|nonblock
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac1.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|tmo
op_assign
l_int|3
op_star
id|HZ
op_star
(paren
id|count
op_plus
id|s-&gt;dma_dac1.fragsize
)paren
op_div
l_int|2
op_div
id|dac1_samplerate
(braket
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_WTSRSEL
)paren
op_rshift
id|CTRL_SH_WTSRSEL
)braket
suffix:semicolon
id|tmo
op_rshift_assign
id|sample_shift
(braket
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P1FMT
)paren
op_rshift
id|SCTRL_SH_P1FMT
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|tmo
op_plus
l_int|1
)paren
)paren
id|DBG
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;es1370: dma timed out??&bslash;n&quot;
)paren
suffix:semicolon
)paren
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac1.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|drain_dac2
r_static
r_int
id|drain_dac2
c_func
(paren
r_struct
id|es1370_state
op_star
id|s
comma
r_int
id|nonblock
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
comma
id|tmo
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.mapped
op_logical_or
op_logical_neg
id|s-&gt;dma_dac2.ready
)paren
r_return
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac2.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac2.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|nonblock
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac2.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|tmo
op_assign
l_int|3
op_star
id|HZ
op_star
(paren
id|count
op_plus
id|s-&gt;dma_dac2.fragsize
)paren
op_div
l_int|2
op_div
id|DAC2_DIVTOSR
c_func
(paren
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_PCLKDIV
)paren
op_rshift
id|CTRL_SH_PCLKDIV
)paren
suffix:semicolon
id|tmo
op_rshift_assign
id|sample_shift
(braket
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P2FMT
)paren
op_rshift
id|SCTRL_SH_P2FMT
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|tmo
op_plus
l_int|1
)paren
)paren
id|DBG
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;es1370: dma timed out??&bslash;n&quot;
)paren
suffix:semicolon
)paren
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac2.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|es1370_read
r_static
id|ssize_t
id|es1370_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|swptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|swptr
op_assign
id|s-&gt;dma_adc.swptr
suffix:semicolon
id|cnt
op_assign
id|s-&gt;dma_adc.dmasize
op_minus
id|swptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
OL
id|cnt
)paren
id|cnt
op_assign
id|s-&gt;dma_adc.count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|s-&gt;dma_adc.rawbuf
op_plus
id|swptr
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_adc.dmasize
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;dma_adc.swptr
op_assign
id|swptr
suffix:semicolon
id|s-&gt;dma_adc.count
op_sub_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|es1370_write
r_static
id|ssize_t
id|es1370_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|swptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac2.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac2
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac2.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.count
OL
l_int|0
)paren
(brace
id|s-&gt;dma_dac2.count
op_assign
l_int|0
suffix:semicolon
id|s-&gt;dma_dac2.swptr
op_assign
id|s-&gt;dma_dac2.hwptr
suffix:semicolon
)brace
id|swptr
op_assign
id|s-&gt;dma_dac2.swptr
suffix:semicolon
id|cnt
op_assign
id|s-&gt;dma_dac2.dmasize
op_minus
id|swptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.count
op_plus
id|cnt
OG
id|s-&gt;dma_dac2.dmasize
)paren
id|cnt
op_assign
id|s-&gt;dma_dac2.dmasize
op_minus
id|s-&gt;dma_dac2.count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
id|start_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|s-&gt;dma_dac2.rawbuf
op_plus
id|swptr
comma
id|buffer
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_dac2.dmasize
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;dma_dac2.swptr
op_assign
id|swptr
suffix:semicolon
id|s-&gt;dma_dac2.count
op_add_assign
id|cnt
suffix:semicolon
id|s-&gt;dma_dac2.endcleared
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
id|start_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac2.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* No kernel lock - we have our own spinlock */
DECL|function|es1370_poll
r_static
r_int
r_int
id|es1370_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac2.ready
op_logical_and
id|prog_dmabuf_dac2
c_func
(paren
id|s
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;dma_dac2.wait
comma
id|wait
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;dma_adc.wait
comma
id|wait
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_adc.fragsize
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac2.mapped
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac2.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_dac2.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|s-&gt;dma_dac2.dmasize
op_ge
id|s-&gt;dma_dac2.count
op_plus
(paren
r_int
)paren
id|s-&gt;dma_dac2.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|es1370_mmap
r_static
r_int
id|es1370_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmabuf
op_star
id|db
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf_dac2
c_func
(paren
id|s
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|db
op_assign
op_amp
id|s-&gt;dma_dac2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_READ
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|db
op_assign
op_amp
id|s-&gt;dma_adc
suffix:semicolon
)brace
r_else
(brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
op_ne
l_int|0
)paren
(brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
)paren
(brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|vma-&gt;vm_start
comma
id|virt_to_phys
c_func
(paren
id|db-&gt;rawbuf
)paren
comma
id|size
comma
id|vma-&gt;vm_page_prot
)paren
)paren
(brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|db-&gt;mapped
op_assign
l_int|1
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|es1370_ioctl
r_static
r_int
id|es1370_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|audio_buf_info
id|abinfo
suffix:semicolon
id|count_info
id|cinfo
suffix:semicolon
r_int
id|count
suffix:semicolon
r_int
id|val
comma
id|mapped
comma
id|ret
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|mapped
op_assign
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
op_logical_and
id|s-&gt;dma_dac2.mapped
)paren
op_logical_or
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
op_logical_and
id|s-&gt;dma_adc.mapped
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|OSS_GETVERSION
suffix:colon
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
r_return
id|drain_dac2
c_func
(paren
id|s
comma
l_int|0
multiline_comment|/*file-&gt;f_flags &amp; O_NONBLOCK*/
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SETDUPLEX
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETCAPS
suffix:colon
r_return
id|put_user
c_func
(paren
id|DSP_CAP_DUPLEX
op_or
id|DSP_CAP_REALTIME
op_or
id|DSP_CAP_TRIGGER
op_or
id|DSP_CAP_MMAP
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_RESET
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|s-&gt;dma_dac2.swptr
op_assign
id|s-&gt;dma_dac2.hwptr
op_assign
id|s-&gt;dma_dac2.count
op_assign
id|s-&gt;dma_dac2.total_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|s-&gt;dma_adc.swptr
op_assign
id|s-&gt;dma_adc.hwptr
op_assign
id|s-&gt;dma_adc.count
op_assign
id|s-&gt;dma_adc.total_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;open_mode
op_amp
(paren
op_complement
id|file-&gt;f_mode
)paren
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
l_int|4000
)paren
id|val
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
l_int|50000
)paren
id|val
op_assign
l_int|50000
suffix:semicolon
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|stop_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
id|s-&gt;dma_dac2.ready
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;ctrl
op_assign
(paren
id|s-&gt;ctrl
op_amp
op_complement
id|CTRL_PCLKDIV
)paren
op_or
(paren
id|DAC2_SRTODIV
c_func
(paren
id|val
)paren
op_lshift
id|CTRL_SH_PCLKDIV
)paren
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|DAC2_DIVTOSR
c_func
(paren
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_PCLKDIV
)paren
op_rshift
id|CTRL_SH_PCLKDIV
)paren
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|s-&gt;sctrl
op_or_assign
id|SCTRL_R1SMB
suffix:semicolon
r_else
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_R1SMB
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac2.ready
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|s-&gt;sctrl
op_or_assign
id|SCTRL_P2SMB
suffix:semicolon
r_else
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_P2SMB
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_CHANNELS
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|2
)paren
id|s-&gt;sctrl
op_or_assign
id|SCTRL_R1SMB
suffix:semicolon
r_else
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_R1SMB
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac2.ready
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|2
)paren
id|s-&gt;sctrl
op_or_assign
id|SCTRL_P2SMB
suffix:semicolon
r_else
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_P2SMB
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;sctrl
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|SCTRL_R1SMB
suffix:colon
id|SCTRL_P2SMB
)paren
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETFMTS
suffix:colon
multiline_comment|/* Returns a mask */
r_return
id|put_user
c_func
(paren
id|AFMT_S16_LE
op_or
id|AFMT_U8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFMT
suffix:colon
multiline_comment|/* Selects ONE fmt*/
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|AFMT_QUERY
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_S16_LE
)paren
id|s-&gt;sctrl
op_or_assign
id|SCTRL_R1SEB
suffix:semicolon
r_else
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_R1SEB
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac2.ready
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_S16_LE
)paren
id|s-&gt;sctrl
op_or_assign
id|SCTRL_P2SEB
suffix:semicolon
r_else
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_P2SEB
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;sctrl
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|SCTRL_R1SEB
suffix:colon
id|SCTRL_P2SEB
)paren
)paren
ques
c_cond
id|AFMT_S16_LE
suffix:colon
id|AFMT_U8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_POST
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETTRIGGER
suffix:colon
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
id|s-&gt;ctrl
op_amp
id|CTRL_ADC_EN
)paren
id|val
op_or_assign
id|PCM_ENABLE_INPUT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
id|s-&gt;ctrl
op_amp
id|CTRL_DAC2_EN
)paren
id|val
op_or_assign
id|PCM_ENABLE_OUTPUT
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETTRIGGER
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_INPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_else
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_OUTPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac2.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac2
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|start_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_else
id|stop_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOSPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac2.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac2
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|s-&gt;dma_dac2.fragsize
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac2.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|abinfo.bytes
op_assign
id|s-&gt;dma_dac2.dmasize
op_minus
id|count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|s-&gt;dma_dac2.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|s-&gt;dma_dac2.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETISPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|s-&gt;dma_adc.fragsize
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_adc.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|abinfo.bytes
op_assign
id|count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|s-&gt;dma_adc.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|s-&gt;dma_adc.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_NONBLOCK
suffix:colon
id|file-&gt;f_flags
op_or_assign
id|O_NONBLOCK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETODELAY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac2.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac2
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac2.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|count
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETIPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|s-&gt;dma_adc.total_bytes
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_adc.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|cinfo.blocks
op_assign
id|count
op_rshift
id|s-&gt;dma_adc.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|s-&gt;dma_adc.hwptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
id|s-&gt;dma_adc.count
op_and_assign
id|s-&gt;dma_adc.fragsize
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac2.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac2
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|s-&gt;dma_dac2.total_bytes
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac2.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|cinfo.blocks
op_assign
id|count
op_rshift
id|s-&gt;dma_dac2.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|s-&gt;dma_dac2.hwptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.mapped
)paren
id|s-&gt;dma_dac2.count
op_and_assign
id|s-&gt;dma_dac2.fragsize
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf_dac2
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;dma_dac2.fragsize
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;dma_adc.fragsize
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|s-&gt;dma_adc.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|s-&gt;dma_adc.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossfragshift
OL
l_int|4
)paren
id|s-&gt;dma_adc.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossfragshift
OG
l_int|15
)paren
id|s-&gt;dma_adc.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossmaxfrags
OL
l_int|4
)paren
id|s-&gt;dma_adc.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|s-&gt;dma_dac2.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|s-&gt;dma_dac2.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.ossfragshift
OL
l_int|4
)paren
id|s-&gt;dma_dac2.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.ossfragshift
OG
l_int|15
)paren
id|s-&gt;dma_dac2.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac2.ossmaxfrags
OL
l_int|4
)paren
id|s-&gt;dma_dac2.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
r_if
c_cond
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
id|s-&gt;dma_adc.subdivision
)paren
op_logical_or
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
id|s-&gt;dma_dac2.subdivision
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|1
op_logical_and
id|val
op_ne
l_int|2
op_logical_and
id|val
op_ne
l_int|4
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|s-&gt;dma_adc.subdivision
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|s-&gt;dma_dac2.subdivision
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_PCM_READ_RATE
suffix:colon
r_return
id|put_user
c_func
(paren
id|DAC2_DIVTOSR
c_func
(paren
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_PCLKDIV
)paren
op_rshift
id|CTRL_SH_PCLKDIV
)paren
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_CHANNELS
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;sctrl
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|SCTRL_R1SMB
suffix:colon
id|SCTRL_P2SMB
)paren
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_BITS
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;sctrl
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|SCTRL_R1SEB
suffix:colon
id|SCTRL_P2SEB
)paren
)paren
ques
c_cond
l_int|16
suffix:colon
l_int|8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_WRITE_FILTER
suffix:colon
r_case
id|SNDCTL_DSP_SETSYNCRO
suffix:colon
r_case
id|SOUND_PCM_READ_FILTER
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|mixer_ioctl
c_func
(paren
id|s
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|es1370_open
r_static
r_int
id|es1370_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|es1370_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|es1370_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|s-&gt;dev_audio
op_xor
id|minor
)paren
op_amp
op_complement
l_int|0xf
)paren
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
multiline_comment|/* wait for device to become free */
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;open_mode
op_amp
id|file-&gt;f_mode
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;open_mode
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
)paren
)paren
id|s-&gt;ctrl
op_assign
(paren
id|s-&gt;ctrl
op_amp
op_complement
id|CTRL_PCLKDIV
)paren
op_or
(paren
id|DAC2_SRTODIV
c_func
(paren
l_int|8000
)paren
op_lshift
id|CTRL_SH_PCLKDIV
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|s-&gt;dma_adc.ossfragshift
op_assign
id|s-&gt;dma_adc.ossmaxfrags
op_assign
id|s-&gt;dma_adc.subdivision
op_assign
l_int|0
suffix:semicolon
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_R1FMT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|minor
op_amp
l_int|0xf
)paren
op_eq
id|SND_DEV_DSP16
)paren
id|s-&gt;sctrl
op_or_assign
id|ES1370_FMT_S16_MONO
op_lshift
id|SCTRL_SH_R1FMT
suffix:semicolon
r_else
id|s-&gt;sctrl
op_or_assign
id|ES1370_FMT_U8_MONO
op_lshift
id|SCTRL_SH_R1FMT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|s-&gt;dma_dac2.ossfragshift
op_assign
id|s-&gt;dma_dac2.ossmaxfrags
op_assign
id|s-&gt;dma_dac2.subdivision
op_assign
l_int|0
suffix:semicolon
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_P2FMT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|minor
op_amp
l_int|0xf
)paren
op_eq
id|SND_DEV_DSP16
)paren
id|s-&gt;sctrl
op_or_assign
id|ES1370_FMT_S16_MONO
op_lshift
id|SCTRL_SH_P2FMT
suffix:semicolon
r_else
id|s-&gt;sctrl
op_or_assign
id|ES1370_FMT_U8_MONO
op_lshift
id|SCTRL_SH_P2FMT
suffix:semicolon
)brace
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;open_mode
op_or_assign
id|file-&gt;f_mode
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|es1370_release
r_static
r_int
id|es1370_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|drain_dac2
c_func
(paren
id|s
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac2
c_func
(paren
id|s
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|dealloc_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_dac2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|dealloc_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_adc
)paren
suffix:semicolon
)brace
id|s-&gt;open_mode
op_and_assign
(paren
op_complement
id|file-&gt;f_mode
)paren
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|es1370_audio_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|es1370_audio_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|es1370_llseek
comma
id|read
suffix:colon
id|es1370_read
comma
id|write
suffix:colon
id|es1370_write
comma
id|poll
suffix:colon
id|es1370_poll
comma
id|ioctl
suffix:colon
id|es1370_ioctl
comma
id|mmap
suffix:colon
id|es1370_mmap
comma
id|open
suffix:colon
id|es1370_open
comma
id|release
suffix:colon
id|es1370_release
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|es1370_write_dac
r_static
id|ssize_t
id|es1370_write_dac
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|swptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac1.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac1
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac1.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.count
OL
l_int|0
)paren
(brace
id|s-&gt;dma_dac1.count
op_assign
l_int|0
suffix:semicolon
id|s-&gt;dma_dac1.swptr
op_assign
id|s-&gt;dma_dac1.hwptr
suffix:semicolon
)brace
id|swptr
op_assign
id|s-&gt;dma_dac1.swptr
suffix:semicolon
id|cnt
op_assign
id|s-&gt;dma_dac1.dmasize
op_minus
id|swptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.count
op_plus
id|cnt
OG
id|s-&gt;dma_dac1.dmasize
)paren
id|cnt
op_assign
id|s-&gt;dma_dac1.dmasize
op_minus
id|s-&gt;dma_dac1.count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
id|start_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|s-&gt;dma_dac1.rawbuf
op_plus
id|swptr
comma
id|buffer
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_dac1.dmasize
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;dma_dac1.swptr
op_assign
id|swptr
suffix:semicolon
id|s-&gt;dma_dac1.count
op_add_assign
id|cnt
suffix:semicolon
id|s-&gt;dma_dac1.endcleared
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
id|start_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac1.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* No kernel lock - we have our own spinlock */
DECL|function|es1370_poll_dac
r_static
r_int
r_int
id|es1370_poll_dac
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac1.ready
op_logical_and
id|prog_dmabuf_dac1
c_func
(paren
id|s
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;dma_dac1.wait
comma
id|wait
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.mapped
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac1.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_dac1.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|s-&gt;dma_dac1.dmasize
op_ge
id|s-&gt;dma_dac1.count
op_plus
(paren
r_int
)paren
id|s-&gt;dma_dac1.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|es1370_mmap_dac
r_static
r_int
id|es1370_mmap_dac
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf_dac1
c_func
(paren
id|s
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
(paren
id|PAGE_SIZE
op_lshift
id|s-&gt;dma_dac1.buforder
)paren
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|vma-&gt;vm_start
comma
id|virt_to_phys
c_func
(paren
id|s-&gt;dma_dac1.rawbuf
)paren
comma
id|size
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_goto
id|out
suffix:semicolon
id|s-&gt;dma_dac1.mapped
op_assign
l_int|1
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|es1370_ioctl_dac
r_static
r_int
id|es1370_ioctl_dac
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|audio_buf_info
id|abinfo
suffix:semicolon
id|count_info
id|cinfo
suffix:semicolon
r_int
id|count
suffix:semicolon
r_int
id|ctrl
suffix:semicolon
r_int
id|val
comma
id|ret
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|OSS_GETVERSION
suffix:colon
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
r_return
id|drain_dac1
c_func
(paren
id|s
comma
l_int|0
multiline_comment|/*file-&gt;f_flags &amp; O_NONBLOCK*/
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETDUPLEX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SNDCTL_DSP_GETCAPS
suffix:colon
r_return
id|put_user
c_func
(paren
id|DSP_CAP_REALTIME
op_or
id|DSP_CAP_TRIGGER
op_or
id|DSP_CAP_MMAP
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_RESET
suffix:colon
id|stop_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|s-&gt;dma_dac1.swptr
op_assign
id|s-&gt;dma_dac1.hwptr
op_assign
id|s-&gt;dma_dac1.count
op_assign
id|s-&gt;dma_dac1.total_bytes
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|0
)paren
(brace
id|stop_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac1.ready
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|ctrl
op_assign
l_int|0
suffix:semicolon
id|ctrl
op_le
l_int|2
suffix:semicolon
id|ctrl
op_increment
)paren
r_if
c_cond
(paren
id|val
OL
(paren
id|dac1_samplerate
(braket
id|ctrl
)braket
op_plus
id|dac1_samplerate
(braket
id|ctrl
op_plus
l_int|1
)braket
)paren
op_div
l_int|2
)paren
r_break
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;ctrl
op_assign
(paren
id|s-&gt;ctrl
op_amp
op_complement
id|CTRL_WTSRSEL
)paren
op_or
(paren
id|ctrl
op_lshift
id|CTRL_SH_WTSRSEL
)paren
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|dac1_samplerate
(braket
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_WTSRSEL
)paren
op_rshift
id|CTRL_SH_WTSRSEL
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|stop_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac1.ready
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|s-&gt;sctrl
op_or_assign
id|SCTRL_P1SMB
suffix:semicolon
r_else
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_P1SMB
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_CHANNELS
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac1.mapped
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|stop_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac1.ready
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|2
)paren
id|s-&gt;sctrl
op_or_assign
id|SCTRL_P1SMB
suffix:semicolon
r_else
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_P1SMB
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P1SMB
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETFMTS
suffix:colon
multiline_comment|/* Returns a mask */
r_return
id|put_user
c_func
(paren
id|AFMT_S16_LE
op_or
id|AFMT_U8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFMT
suffix:colon
multiline_comment|/* Selects ONE fmt*/
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|AFMT_QUERY
)paren
(brace
id|stop_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac1.ready
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_S16_LE
)paren
id|s-&gt;sctrl
op_or_assign
id|SCTRL_P1SEB
suffix:semicolon
r_else
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_P1SEB
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P1SEB
)paren
ques
c_cond
id|AFMT_S16_LE
suffix:colon
id|AFMT_U8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_POST
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETTRIGGER
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_DAC1_EN
)paren
ques
c_cond
id|PCM_ENABLE_OUTPUT
suffix:colon
l_int|0
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETTRIGGER
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_OUTPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac1.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac1
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|start_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_else
id|stop_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOSPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_DAC1_EN
)paren
op_logical_and
(paren
id|val
op_assign
id|prog_dmabuf_dac1
c_func
(paren
id|s
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|s-&gt;dma_dac1.fragsize
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac1.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|abinfo.bytes
op_assign
id|s-&gt;dma_dac1.dmasize
op_minus
id|count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|s-&gt;dma_dac1.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|s-&gt;dma_dac1.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_NONBLOCK
suffix:colon
id|file-&gt;f_flags
op_or_assign
id|O_NONBLOCK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETODELAY
suffix:colon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac1.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|count
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|s-&gt;dma_dac1.total_bytes
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac1.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|cinfo.blocks
op_assign
id|count
op_rshift
id|s-&gt;dma_dac1.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|s-&gt;dma_dac1.hwptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.mapped
)paren
id|s-&gt;dma_dac1.count
op_and_assign
id|s-&gt;dma_dac1.fragsize
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf_dac1
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;dma_dac1.fragsize
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|s-&gt;dma_dac1.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|s-&gt;dma_dac1.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.ossfragshift
OL
l_int|4
)paren
id|s-&gt;dma_dac1.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.ossfragshift
OG
l_int|15
)paren
id|s-&gt;dma_dac1.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.ossmaxfrags
OL
l_int|4
)paren
id|s-&gt;dma_dac1.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
r_if
c_cond
(paren
id|s-&gt;dma_dac1.subdivision
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|1
op_logical_and
id|val
op_ne
l_int|2
op_logical_and
id|val
op_ne
l_int|4
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s-&gt;dma_dac1.subdivision
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_PCM_READ_RATE
suffix:colon
r_return
id|put_user
c_func
(paren
id|dac1_samplerate
(braket
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_WTSRSEL
)paren
op_rshift
id|CTRL_SH_WTSRSEL
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_CHANNELS
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P1SMB
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_BITS
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;sctrl
op_amp
id|SCTRL_P1SEB
)paren
ques
c_cond
l_int|16
suffix:colon
l_int|8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_WRITE_FILTER
suffix:colon
r_case
id|SNDCTL_DSP_SETSYNCRO
suffix:colon
r_case
id|SOUND_PCM_READ_FILTER
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|mixer_ioctl
c_func
(paren
id|s
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|es1370_open_dac
r_static
r_int
id|es1370_open_dac
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|es1370_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|es1370_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|s-&gt;dev_dac
op_xor
id|minor
)paren
op_amp
op_complement
l_int|0xf
)paren
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
multiline_comment|/* we allow opening with O_RDWR, most programs do it although they will only write */
macro_line|#if 0
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
multiline_comment|/* wait for device to become free */
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;open_mode
op_amp
id|FMODE_DAC
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
)brace
id|s-&gt;dma_dac1.ossfragshift
op_assign
id|s-&gt;dma_dac1.ossmaxfrags
op_assign
id|s-&gt;dma_dac1.subdivision
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;ctrl
op_assign
(paren
id|s-&gt;ctrl
op_amp
op_complement
id|CTRL_WTSRSEL
)paren
op_or
(paren
l_int|1
op_lshift
id|CTRL_SH_WTSRSEL
)paren
suffix:semicolon
id|s-&gt;sctrl
op_and_assign
op_complement
id|SCTRL_P1FMT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|minor
op_amp
l_int|0xf
)paren
op_eq
id|SND_DEV_DSP16
)paren
id|s-&gt;sctrl
op_or_assign
id|ES1370_FMT_S16_MONO
op_lshift
id|SCTRL_SH_P1FMT
suffix:semicolon
r_else
id|s-&gt;sctrl
op_or_assign
id|ES1370_FMT_U8_MONO
op_lshift
id|SCTRL_SH_P1FMT
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;open_mode
op_or_assign
id|FMODE_DAC
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|es1370_release_dac
r_static
r_int
id|es1370_release_dac
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|drain_dac1
c_func
(paren
id|s
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|stop_dac1
c_func
(paren
id|s
)paren
suffix:semicolon
id|dealloc_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_dac1
)paren
suffix:semicolon
id|s-&gt;open_mode
op_and_assign
op_complement
id|FMODE_DAC
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|es1370_dac_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|es1370_dac_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|es1370_llseek
comma
id|write
suffix:colon
id|es1370_write_dac
comma
id|poll
suffix:colon
id|es1370_poll_dac
comma
id|ioctl
suffix:colon
id|es1370_ioctl_dac
comma
id|mmap
suffix:colon
id|es1370_mmap_dac
comma
id|open
suffix:colon
id|es1370_open_dac
comma
id|release
suffix:colon
id|es1370_release_dac
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|es1370_midi_read
r_static
id|ssize_t
id|es1370_midi_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.iwait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ptr
op_assign
id|s-&gt;midi.ird
suffix:semicolon
id|cnt
op_assign
id|MIDIINBUF
op_minus
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.icnt
OL
id|cnt
)paren
id|cnt
op_assign
id|s-&gt;midi.icnt
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|s-&gt;midi.ibuf
op_plus
id|ptr
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ptr
op_assign
(paren
id|ptr
op_plus
id|cnt
)paren
op_mod
id|MIDIINBUF
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;midi.ird
op_assign
id|ptr
suffix:semicolon
id|s-&gt;midi.icnt
op_sub_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
r_break
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.iwait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|es1370_midi_write
r_static
id|ssize_t
id|es1370_midi_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ptr
op_assign
id|s-&gt;midi.owr
suffix:semicolon
id|cnt
op_assign
id|MIDIOUTBUF
op_minus
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.ocnt
op_plus
id|cnt
OG
id|MIDIOUTBUF
)paren
id|cnt
op_assign
id|MIDIOUTBUF
op_minus
id|s-&gt;midi.ocnt
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|es1370_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|s-&gt;midi.obuf
op_plus
id|ptr
comma
id|buffer
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ptr
op_assign
(paren
id|ptr
op_plus
id|cnt
)paren
op_mod
id|MIDIOUTBUF
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;midi.owr
op_assign
id|ptr
suffix:semicolon
id|s-&gt;midi.ocnt
op_add_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|es1370_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* No kernel lock - we have our own spinlock */
DECL|function|es1370_midi_poll
r_static
r_int
r_int
id|es1370_midi_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;midi.owait
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;midi.iwait
comma
id|wait
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;midi.icnt
OG
l_int|0
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;midi.ocnt
OL
id|MIDIOUTBUF
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|es1370_midi_open
r_static
r_int
id|es1370_midi_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|es1370_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|es1370_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dev_midi
op_eq
id|minor
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
multiline_comment|/* wait for device to become free */
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;open_mode
op_amp
(paren
id|file-&gt;f_mode
op_lshift
id|FMODE_MIDI_SHIFT
)paren
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;open_mode
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
)paren
)paren
(brace
id|s-&gt;midi.ird
op_assign
id|s-&gt;midi.iwr
op_assign
id|s-&gt;midi.icnt
op_assign
l_int|0
suffix:semicolon
id|s-&gt;midi.ord
op_assign
id|s-&gt;midi.owr
op_assign
id|s-&gt;midi.ocnt
op_assign
l_int|0
suffix:semicolon
id|outb
c_func
(paren
id|UCTRL_CNTRL_SWR
comma
id|s-&gt;io
op_plus
id|ES1370_REG_UART_CONTROL
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;io
op_plus
id|ES1370_REG_UART_CONTROL
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;io
op_plus
id|ES1370_REG_UART_TEST
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|s-&gt;midi.ird
op_assign
id|s-&gt;midi.iwr
op_assign
id|s-&gt;midi.icnt
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|s-&gt;midi.ord
op_assign
id|s-&gt;midi.owr
op_assign
id|s-&gt;midi.ocnt
op_assign
l_int|0
suffix:semicolon
)brace
id|s-&gt;ctrl
op_or_assign
id|CTRL_UART_EN
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|es1370_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;open_mode
op_or_assign
(paren
id|file-&gt;f_mode
op_lshift
id|FMODE_MIDI_SHIFT
)paren
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|es1370_midi_release
r_static
r_int
id|es1370_midi_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
(paren
r_struct
id|es1370_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
comma
id|tmo
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;midi.ocnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|tmo
op_assign
(paren
id|count
op_star
id|HZ
)paren
op_div
l_int|3100
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|tmo
ques
c_cond
suffix:colon
l_int|1
)paren
op_logical_and
id|tmo
)paren
id|DBG
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;es1370: midi timed out??&bslash;n&quot;
)paren
suffix:semicolon
)paren
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|s-&gt;open_mode
op_and_assign
(paren
op_complement
(paren
id|file-&gt;f_mode
op_lshift
id|FMODE_MIDI_SHIFT
)paren
)paren
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;open_mode
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
)paren
)paren
(brace
id|s-&gt;ctrl
op_and_assign
op_complement
id|CTRL_UART_EN
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|es1370_midi_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|es1370_midi_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|es1370_llseek
comma
id|read
suffix:colon
id|es1370_midi_read
comma
id|write
suffix:colon
id|es1370_midi_write
comma
id|poll
suffix:colon
id|es1370_midi_poll
comma
id|open
suffix:colon
id|es1370_midi_open
comma
id|release
suffix:colon
id|es1370_midi_release
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/* maximum number of devices; only used for command line params */
DECL|macro|NR_DEVICE
mdefine_line|#define NR_DEVICE 5
DECL|variable|joystick
r_static
r_int
id|joystick
(braket
id|NR_DEVICE
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|lineout
r_static
r_int
id|lineout
(braket
id|NR_DEVICE
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|micbias
r_static
r_int
id|micbias
(braket
id|NR_DEVICE
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|devindex
r_static
r_int
r_int
id|devindex
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|joystick
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_DEVICE
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|joystick
comma
l_string|&quot;if 1 enables joystick interface (still need separate driver)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|lineout
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_DEVICE
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|lineout
comma
l_string|&quot;if 1 the LINE input is converted to LINE out&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|micbias
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|NR_DEVICE
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|micbias
comma
l_string|&quot;sets the +5V bias for an electret microphone&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Thomas M. Sailer, sailer@ife.ee.ethz.ch, hb9jnx@hb9w.che.eu&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ES1370 AudioPCI Driver&quot;
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|struct|initvol
r_static
r_struct
id|initvol
(brace
DECL|member|mixch
r_int
id|mixch
suffix:semicolon
DECL|member|vol
r_int
id|vol
suffix:semicolon
DECL|variable|__initdata
)brace
id|initvol
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|SOUND_MIXER_WRITE_VOLUME
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_PCM
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_SYNTH
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_CD
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE1
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE2
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE3
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_MIC
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_OGAIN
comma
l_int|0x4040
)brace
)brace
suffix:semicolon
DECL|macro|RSRCISIOREGION
mdefine_line|#define RSRCISIOREGION(dev,num) (pci_resource_start((dev), (num)) != 0 &amp;&amp; &bslash;&n;&t;&t;&t;&t; pci_resource_flags((dev), (num)) &amp; IORESOURCE_IO)
DECL|function|es1370_probe
r_static
r_int
id|__devinit
id|es1370_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pcidev
comma
r_const
r_struct
id|pci_device_id
op_star
id|pciid
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
suffix:semicolon
id|mm_segment_t
id|fs
suffix:semicolon
r_int
id|i
comma
id|val
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
l_int|0
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pcidev-&gt;irq
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_dma_supported
c_func
(paren
id|pcidev
comma
l_int|0xffffffff
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;es1370: architecture does not support 32bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|es1370_state
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;es1370: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|es1370_state
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;dma_dac1.wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;dma_dac2.wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;midi.iwait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;midi.owait
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
id|s-&gt;magic
op_assign
id|ES1370_MAGIC
suffix:semicolon
id|s-&gt;dev
op_assign
id|pcidev
suffix:semicolon
id|s-&gt;io
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;irq
op_assign
id|pcidev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;io
comma
id|ES1370_EXTENT
comma
l_string|&quot;es1370&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;es1370: io ports %#lx-%#lx in use&bslash;n&quot;
comma
id|s-&gt;io
comma
id|s-&gt;io
op_plus
id|ES1370_EXTENT
op_minus
l_int|1
)paren
suffix:semicolon
r_goto
id|err_region
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pcidev
)paren
)paren
r_goto
id|err_irq
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|s-&gt;irq
comma
id|es1370_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;es1370&quot;
comma
id|s
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;es1370: irq %u in use&bslash;n&quot;
comma
id|s-&gt;irq
)paren
suffix:semicolon
r_goto
id|err_irq
suffix:semicolon
)brace
multiline_comment|/* initialize codec registers */
multiline_comment|/* note: setting CTRL_SERR_DIS is reported to break&n;&t; * mic bias setting (by Kim.Berts@fisub.mail.abb.com) */
id|s-&gt;ctrl
op_assign
id|CTRL_CDC_EN
op_or
(paren
id|DAC2_SRTODIV
c_func
(paren
l_int|8000
)paren
op_lshift
id|CTRL_SH_PCLKDIV
)paren
op_or
(paren
l_int|1
op_lshift
id|CTRL_SH_WTSRSEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|joystick
(braket
id|devindex
)braket
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
l_int|0x200
comma
id|JOY_EXTENT
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;es1370: io port 0x200 in use&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|s-&gt;ctrl
op_or_assign
id|CTRL_JYSTK_EN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lineout
(braket
id|devindex
)braket
)paren
id|s-&gt;ctrl
op_or_assign
id|CTRL_XCTL0
suffix:semicolon
r_if
c_cond
(paren
id|micbias
(braket
id|devindex
)braket
)paren
id|s-&gt;ctrl
op_or_assign
id|CTRL_XCTL1
suffix:semicolon
id|s-&gt;sctrl
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;es1370: found adapter at io %#lx irq %u&bslash;n&quot;
id|KERN_INFO
l_string|&quot;es1370: features: joystick %s, line %s, mic impedance %s&bslash;n&quot;
comma
id|s-&gt;io
comma
id|s-&gt;irq
comma
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_JYSTK_EN
)paren
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
comma
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_XCTL0
)paren
ques
c_cond
l_string|&quot;out&quot;
suffix:colon
l_string|&quot;in&quot;
comma
(paren
id|s-&gt;ctrl
op_amp
id|CTRL_XCTL1
)paren
ques
c_cond
l_string|&quot;1&quot;
suffix:colon
l_string|&quot;0&quot;
)paren
suffix:semicolon
multiline_comment|/* register devices */
r_if
c_cond
(paren
(paren
id|s-&gt;dev_audio
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|es1370_audio_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dev_mixer
op_assign
id|register_sound_mixer
c_func
(paren
op_amp
id|es1370_mixer_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dev_dac
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|es1370_dac_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dev_midi
op_assign
id|register_sound_midi
c_func
(paren
op_amp
id|es1370_midi_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev4
suffix:semicolon
multiline_comment|/* initialize the chips */
id|outl
c_func
(paren
id|s-&gt;ctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
id|outl
c_func
(paren
id|s-&gt;sctrl
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
multiline_comment|/* point phantom write channel to &quot;bugbuf&quot; */
id|outl
c_func
(paren
(paren
id|ES1370_REG_PHANTOM_FRAMEADR
op_rshift
l_int|8
)paren
op_amp
l_int|15
comma
id|s-&gt;io
op_plus
id|ES1370_REG_MEMPAGE
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|bugbuf
)paren
comma
id|s-&gt;io
op_plus
(paren
id|ES1370_REG_PHANTOM_FRAMEADR
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|s-&gt;io
op_plus
(paren
id|ES1370_REG_PHANTOM_FRAMECNT
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pcidev
)paren
suffix:semicolon
multiline_comment|/* enable bus mastering */
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x16
comma
l_int|3
)paren
suffix:semicolon
multiline_comment|/* no RST, PD */
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x17
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* CODEC ADC and CODEC DAC use {LR,B}CLK2 and run off the LRCLK2 PLL; program DAC_SYNC=0!!  */
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x18
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* recording source is mixer */
id|wrcodec
c_func
(paren
id|s
comma
l_int|0x19
comma
id|s-&gt;mix.micpreamp
op_assign
l_int|1
)paren
suffix:semicolon
multiline_comment|/* turn on MIC preamp */
id|s-&gt;mix.imix
op_assign
l_int|1
suffix:semicolon
id|fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|val
op_assign
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_SYNTH
op_or
id|SOUND_MASK_CD
suffix:semicolon
id|mixer_ioctl
c_func
(paren
id|s
comma
id|SOUND_MIXER_WRITE_RECSRC
comma
(paren
r_int
r_int
)paren
op_amp
id|val
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|initvol
)paren
op_div
r_sizeof
(paren
id|initvol
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|initvol
(braket
id|i
)braket
dot
id|vol
suffix:semicolon
id|mixer_ioctl
c_func
(paren
id|s
comma
id|initvol
(braket
id|i
)braket
dot
id|mixch
comma
(paren
r_int
r_int
)paren
op_amp
id|val
)paren
suffix:semicolon
)brace
id|set_fs
c_func
(paren
id|fs
)paren
suffix:semicolon
multiline_comment|/* store it in the driver field */
id|pci_set_drvdata
c_func
(paren
id|pcidev
comma
id|s
)paren
suffix:semicolon
id|pcidev-&gt;dma_mask
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* put it into driver list */
id|list_add_tail
c_func
(paren
op_amp
id|s-&gt;devs
comma
op_amp
id|devs
)paren
suffix:semicolon
multiline_comment|/* increment devindex */
r_if
c_cond
(paren
id|devindex
OL
id|NR_DEVICE
op_minus
l_int|1
)paren
id|devindex
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_dev4
suffix:colon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_dac
)paren
suffix:semicolon
id|err_dev3
suffix:colon
id|unregister_sound_mixer
c_func
(paren
id|s-&gt;dev_mixer
)paren
suffix:semicolon
id|err_dev2
suffix:colon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_audio
)paren
suffix:semicolon
id|err_dev1
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;es1370: cannot register misc device&bslash;n&quot;
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|s-&gt;irq
comma
id|s
)paren
suffix:semicolon
id|err_irq
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;io
comma
id|ES1370_EXTENT
)paren
suffix:semicolon
id|err_region
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|es1370_remove
r_static
r_void
id|__devinit
id|es1370_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|es1370_state
op_star
id|s
op_assign
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_return
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|s-&gt;devs
)paren
suffix:semicolon
id|outl
c_func
(paren
id|CTRL_SERR_DIS
op_or
(paren
l_int|1
op_lshift
id|CTRL_SH_WTSRSEL
)paren
comma
id|s-&gt;io
op_plus
id|ES1370_REG_CONTROL
)paren
suffix:semicolon
multiline_comment|/* switch everything off */
id|outl
c_func
(paren
l_int|0
comma
id|s-&gt;io
op_plus
id|ES1370_REG_SERIAL_CONTROL
)paren
suffix:semicolon
multiline_comment|/* clear serial interrupts */
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|s-&gt;irq
comma
id|s
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;io
comma
id|ES1370_EXTENT
)paren
suffix:semicolon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_audio
)paren
suffix:semicolon
id|unregister_sound_mixer
c_func
(paren
id|s-&gt;dev_mixer
)paren
suffix:semicolon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_dac
)paren
suffix:semicolon
id|unregister_sound_midi
c_func
(paren
id|s-&gt;dev_midi
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|id_table
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_ENSONIQ
comma
id|PCI_DEVICE_ID_ENSONIQ_ES1370
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|id_table
)paren
suffix:semicolon
DECL|variable|es1370_driver
r_static
r_struct
id|pci_driver
id|es1370_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;es1370&quot;
comma
id|id_table
suffix:colon
id|id_table
comma
id|probe
suffix:colon
id|es1370_probe
comma
id|remove
suffix:colon
id|es1370_remove
)brace
suffix:semicolon
DECL|function|init_es1370
r_static
r_int
id|__init
id|init_es1370
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
multiline_comment|/* No PCI bus in this machine! */
r_return
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;es1370: version v0.34 time &quot;
id|__TIME__
l_string|&quot; &quot;
id|__DATE__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|pci_module_init
c_func
(paren
op_amp
id|es1370_driver
)paren
suffix:semicolon
)brace
DECL|function|cleanup_es1370
r_static
r_void
id|__exit
id|cleanup_es1370
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;es1370: unloading&bslash;n&quot;
)paren
suffix:semicolon
id|pci_unregister_driver
c_func
(paren
op_amp
id|es1370_driver
)paren
suffix:semicolon
)brace
DECL|variable|init_es1370
id|module_init
c_func
(paren
id|init_es1370
)paren
suffix:semicolon
DECL|variable|cleanup_es1370
id|module_exit
c_func
(paren
id|cleanup_es1370
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
macro_line|#ifndef MODULE
multiline_comment|/* format is: es1370=[joystick[,lineout[,micbias]]] */
DECL|function|es1370_setup
r_static
r_int
id|__init
id|es1370_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|NR_DEVICE
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|joystick
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
op_logical_and
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|lineout
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|micbias
(braket
id|nr_dev
)braket
)paren
)paren
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;es1370=&quot;
comma
id|es1370_setup
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
eof
