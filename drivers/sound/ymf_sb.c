multiline_comment|/*&n;  Legacy audio driver for YMF724, 740, 744, 754 series.&n;  Copyright 2000 Daisuke Nagano &lt;breeze.nagano@nifty.ne.jp&gt;&n;&n;  Based on the VIA 82Cxxx driver by Jeff Garzik &lt;jgarzik@pobox.com&gt;&n;  And ported to 2.3.x by Jeff Garzik too :)  My it is a small world.&n;&n;  Distribued under the GNU PUBLIC LICENSE (GPL) Version 2.&n;  See the &quot;COPYING&quot; file distributed with kernel source tree for more info.&n;&n;  -------------------------------------------------------------------------&n;&n;  It only supports SBPro compatible function of YMF7xx series s.t.&n;    * 22.05kHz, 8-bit and stereo sample&n;    * OPL3-compatible FM synthesizer&n;    * MPU-401 compatible &quot;external&quot; MIDI interface&n;&n;  -------------------------------------------------------------------------&n;&n;  Revision history&n;&n;   Tue May 14 19:00:00 2000   0.0.1&n;   * initial release&n;&n;   Tue May 16 19:29:29 2000   0.0.2&n;&n;   * add a little delays for reset devices.&n;   * fixed addressing bug.&n;&n;   Sun May 21 15:14:37 2000   0.0.3&n;&n;   * Add &squot;master_vol&squot; module parameter to change &squot;PCM out Vol&squot; of AC&squot;97.&n;   * remove native UART401 support. External MIDI port should be supported &n;     by sb_midi driver.&n;   * add support for SPDIF OUT. Module parameter &squot;spdif_out&squot; is now available.&n;&n;   Wed May 31 00:13:57 2000   0.0.4&n;&n;   * remove entries in Hwmcode.h. Now YMF744 / YMF754 sets instructions &n;     in 724hwmcode.h.&n;   * fixed wrong legacy_io setting on YMF744/YMF754 .&n;&n;   Thu Sep 21 05:32:51 BRT 2000 0.0.5&n;   * got rid of attach_uart401 and attach_sbmpu&n;     Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ac97_codec.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;sound_config.h&quot;
macro_line|#include &quot;sb.h&quot;
macro_line|#include &quot;724hwmcode.h&quot;
DECL|macro|YMF_DEBUG
macro_line|#undef YMF_DEBUG
DECL|macro|SUPPORT_UART401_MIDI
mdefine_line|#define SUPPORT_UART401_MIDI 1
multiline_comment|/* ---------------------------------------------------------------------- */
macro_line|#ifndef PCI_VENDOR_ID_YAMAHA
DECL|macro|PCI_VENDOR_ID_YAMAHA
mdefine_line|#define PCI_VENDOR_ID_YAMAHA  0x1073
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_YMF724
DECL|macro|PCI_DEVICE_ID_YMF724
mdefine_line|#define PCI_DEVICE_ID_YMF724  0x0004
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_YMF740
DECL|macro|PCI_DEVICE_ID_YMF740
mdefine_line|#define PCI_DEVICE_ID_YMF740  0x000A
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_YMF740C
DECL|macro|PCI_DEVICE_ID_YMF740C
mdefine_line|#define PCI_DEVICE_ID_YMF740C 0x000C
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_YMF724F
DECL|macro|PCI_DEVICE_ID_YMF724F
mdefine_line|#define PCI_DEVICE_ID_YMF724F 0x000D
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_YMF744
DECL|macro|PCI_DEVICE_ID_YMF744
mdefine_line|#define PCI_DEVICE_ID_YMF744  0x0010
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_YMF754
DECL|macro|PCI_DEVICE_ID_YMF754
mdefine_line|#define PCI_DEVICE_ID_YMF754  0x0012
macro_line|#endif
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|macro|YMFSB_RESET_DELAY
mdefine_line|#define YMFSB_RESET_DELAY               5
DECL|macro|YMFSB_REGSIZE
mdefine_line|#define YMFSB_REGSIZE                   0x8000
DECL|macro|YMFSB_AC97TIMEOUT
mdefine_line|#define YMFSB_AC97TIMEOUT               2000
DECL|macro|YMFSB_WORKBITTIMEOUT
mdefine_line|#define&t;YMFSB_WORKBITTIMEOUT            250000
DECL|macro|YMFSB_DSPLENGTH
mdefine_line|#define&t;YMFSB_DSPLENGTH                 0x0080
DECL|macro|YMFSB_CTRLLENGTH
mdefine_line|#define&t;YMFSB_CTRLLENGTH                0x3000
DECL|macro|YMFSB_PCIR_VENDORID
mdefine_line|#define YMFSB_PCIR_VENDORID             0x00
DECL|macro|YMFSB_PCIR_DEVICEID
mdefine_line|#define YMFSB_PCIR_DEVICEID             0x02
DECL|macro|YMFSB_PCIR_CMD
mdefine_line|#define YMFSB_PCIR_CMD                  0x04
DECL|macro|YMFSB_PCIR_REVISIONID
mdefine_line|#define YMFSB_PCIR_REVISIONID           0x08
DECL|macro|YMFSB_PCIR_BASEADDR
mdefine_line|#define YMFSB_PCIR_BASEADDR             0x10
DECL|macro|YMFSB_PCIR_IRQ
mdefine_line|#define YMFSB_PCIR_IRQ                  0x3c
DECL|macro|YMFSB_PCIR_LEGCTRL
mdefine_line|#define&t;YMFSB_PCIR_LEGCTRL              0x40
DECL|macro|YMFSB_PCIR_ELEGCTRL
mdefine_line|#define&t;YMFSB_PCIR_ELEGCTRL             0x42
DECL|macro|YMFSB_PCIR_DSXGCTRL
mdefine_line|#define&t;YMFSB_PCIR_DSXGCTRL             0x48
DECL|macro|YMFSB_PCIR_OPLADR
mdefine_line|#define YMFSB_PCIR_OPLADR               0x60
DECL|macro|YMFSB_PCIR_SBADR
mdefine_line|#define YMFSB_PCIR_SBADR                0x62
DECL|macro|YMFSB_PCIR_MPUADR
mdefine_line|#define YMFSB_PCIR_MPUADR               0x64
DECL|macro|YMFSB_INTFLAG
mdefine_line|#define&t;YMFSB_INTFLAG                   0x0004
DECL|macro|YMFSB_ACTIVITY
mdefine_line|#define&t;YMFSB_ACTIVITY                  0x0006
DECL|macro|YMFSB_GLOBALCTRL
mdefine_line|#define&t;YMFSB_GLOBALCTRL                0x0008
DECL|macro|YMFSB_ZVCTRL
mdefine_line|#define&t;YMFSB_ZVCTRL                    0x000A
DECL|macro|YMFSB_TIMERCTRL
mdefine_line|#define&t;YMFSB_TIMERCTRL                 0x0010
DECL|macro|YMFSB_TIMERCOUNT
mdefine_line|#define&t;YMFSB_TIMERCOUNT                0x0012
DECL|macro|YMFSB_SPDIFOUTCTRL
mdefine_line|#define&t;YMFSB_SPDIFOUTCTRL              0x0018
DECL|macro|YMFSB_SPDIFOUTSTATUS
mdefine_line|#define&t;YMFSB_SPDIFOUTSTATUS            0x001C
DECL|macro|YMFSB_EEPROMCTRL
mdefine_line|#define&t;YMFSB_EEPROMCTRL                0x0020
DECL|macro|YMFSB_SPDIFINCTRL
mdefine_line|#define&t;YMFSB_SPDIFINCTRL               0x0034
DECL|macro|YMFSB_SPDIFINSTATUS
mdefine_line|#define&t;YMFSB_SPDIFINSTATUS             0x0038
DECL|macro|YMFSB_DSPPROGRAMDL
mdefine_line|#define&t;YMFSB_DSPPROGRAMDL              0x0048
DECL|macro|YMFSB_DLCNTRL
mdefine_line|#define&t;YMFSB_DLCNTRL                   0x004C
DECL|macro|YMFSB_GPIOININTFLAG
mdefine_line|#define&t;YMFSB_GPIOININTFLAG             0x0050
DECL|macro|YMFSB_GPIOININTENABLE
mdefine_line|#define&t;YMFSB_GPIOININTENABLE           0x0052
DECL|macro|YMFSB_GPIOINSTATUS
mdefine_line|#define&t;YMFSB_GPIOINSTATUS              0x0054
DECL|macro|YMFSB_GPIOOUTCTRL
mdefine_line|#define&t;YMFSB_GPIOOUTCTRL               0x0056
DECL|macro|YMFSB_GPIOFUNCENABLE
mdefine_line|#define&t;YMFSB_GPIOFUNCENABLE            0x0058
DECL|macro|YMFSB_GPIOTYPECONFIG
mdefine_line|#define&t;YMFSB_GPIOTYPECONFIG            0x005A
DECL|macro|YMFSB_AC97CMDDATA
mdefine_line|#define&t;YMFSB_AC97CMDDATA               0x0060
DECL|macro|YMFSB_AC97CMDADR
mdefine_line|#define&t;YMFSB_AC97CMDADR                0x0062
DECL|macro|YMFSB_PRISTATUSDATA
mdefine_line|#define&t;YMFSB_PRISTATUSDATA             0x0064
DECL|macro|YMFSB_PRISTATUSADR
mdefine_line|#define&t;YMFSB_PRISTATUSADR              0x0066
DECL|macro|YMFSB_SECSTATUSDATA
mdefine_line|#define&t;YMFSB_SECSTATUSDATA             0x0068
DECL|macro|YMFSB_SECSTATUSADR
mdefine_line|#define&t;YMFSB_SECSTATUSADR              0x006A
DECL|macro|YMFSB_SECCONFIG
mdefine_line|#define&t;YMFSB_SECCONFIG                 0x0070
DECL|macro|YMFSB_LEGACYOUTVOL
mdefine_line|#define&t;YMFSB_LEGACYOUTVOL              0x0080
DECL|macro|YMFSB_LEGACYOUTVOLL
mdefine_line|#define&t;YMFSB_LEGACYOUTVOLL             0x0080
DECL|macro|YMFSB_LEGACYOUTVOLR
mdefine_line|#define&t;YMFSB_LEGACYOUTVOLR             0x0082
DECL|macro|YMFSB_NATIVEDACOUTVOL
mdefine_line|#define&t;YMFSB_NATIVEDACOUTVOL           0x0084
DECL|macro|YMFSB_NATIVEDACOUTVOLL
mdefine_line|#define&t;YMFSB_NATIVEDACOUTVOLL          0x0084
DECL|macro|YMFSB_NATIVEDACOUTVOLR
mdefine_line|#define&t;YMFSB_NATIVEDACOUTVOLR          0x0086
DECL|macro|YMFSB_SPDIFOUTVOL
mdefine_line|#define&t;YMFSB_SPDIFOUTVOL               0x0088
DECL|macro|YMFSB_SPDIFOUTVOLL
mdefine_line|#define&t;YMFSB_SPDIFOUTVOLL              0x0088
DECL|macro|YMFSB_SPDIFOUTVOLR
mdefine_line|#define&t;YMFSB_SPDIFOUTVOLR              0x008A
DECL|macro|YMFSB_AC3OUTVOL
mdefine_line|#define&t;YMFSB_AC3OUTVOL                 0x008C
DECL|macro|YMFSB_AC3OUTVOLL
mdefine_line|#define&t;YMFSB_AC3OUTVOLL                0x008C
DECL|macro|YMFSB_AC3OUTVOLR
mdefine_line|#define&t;YMFSB_AC3OUTVOLR                0x008E
DECL|macro|YMFSB_PRIADCOUTVOL
mdefine_line|#define&t;YMFSB_PRIADCOUTVOL              0x0090
DECL|macro|YMFSB_PRIADCOUTVOLL
mdefine_line|#define&t;YMFSB_PRIADCOUTVOLL             0x0090
DECL|macro|YMFSB_PRIADCOUTVOLR
mdefine_line|#define&t;YMFSB_PRIADCOUTVOLR             0x0092
DECL|macro|YMFSB_LEGACYLOOPVOL
mdefine_line|#define&t;YMFSB_LEGACYLOOPVOL             0x0094
DECL|macro|YMFSB_LEGACYLOOPVOLL
mdefine_line|#define&t;YMFSB_LEGACYLOOPVOLL            0x0094
DECL|macro|YMFSB_LEGACYLOOPVOLR
mdefine_line|#define&t;YMFSB_LEGACYLOOPVOLR            0x0096
DECL|macro|YMFSB_NATIVEDACLOOPVOL
mdefine_line|#define&t;YMFSB_NATIVEDACLOOPVOL          0x0098
DECL|macro|YMFSB_NATIVEDACLOOPVOLL
mdefine_line|#define&t;YMFSB_NATIVEDACLOOPVOLL         0x0098
DECL|macro|YMFSB_NATIVEDACLOOPVOLR
mdefine_line|#define&t;YMFSB_NATIVEDACLOOPVOLR         0x009A
DECL|macro|YMFSB_SPDIFLOOPVOL
mdefine_line|#define&t;YMFSB_SPDIFLOOPVOL              0x009C
DECL|macro|YMFSB_SPDIFLOOPVOLL
mdefine_line|#define&t;YMFSB_SPDIFLOOPVOLL             0x009E
DECL|macro|YMFSB_SPDIFLOOPVOLR
mdefine_line|#define&t;YMFSB_SPDIFLOOPVOLR             0x009E
DECL|macro|YMFSB_AC3LOOPVOL
mdefine_line|#define&t;YMFSB_AC3LOOPVOL                0x00A0
DECL|macro|YMFSB_AC3LOOPVOLL
mdefine_line|#define&t;YMFSB_AC3LOOPVOLL               0x00A0
DECL|macro|YMFSB_AC3LOOPVOLR
mdefine_line|#define&t;YMFSB_AC3LOOPVOLR               0x00A2
DECL|macro|YMFSB_PRIADCLOOPVOL
mdefine_line|#define&t;YMFSB_PRIADCLOOPVOL             0x00A4
DECL|macro|YMFSB_PRIADCLOOPVOLL
mdefine_line|#define&t;YMFSB_PRIADCLOOPVOLL            0x00A4
DECL|macro|YMFSB_PRIADCLOOPVOLR
mdefine_line|#define&t;YMFSB_PRIADCLOOPVOLR            0x00A6
DECL|macro|YMFSB_NATIVEADCINVOL
mdefine_line|#define&t;YMFSB_NATIVEADCINVOL            0x00A8
DECL|macro|YMFSB_NATIVEADCINVOLL
mdefine_line|#define&t;YMFSB_NATIVEADCINVOLL           0x00A8
DECL|macro|YMFSB_NATIVEADCINVOLR
mdefine_line|#define&t;YMFSB_NATIVEADCINVOLR           0x00AA
DECL|macro|YMFSB_NATIVEDACINVOL
mdefine_line|#define&t;YMFSB_NATIVEDACINVOL            0x00AC
DECL|macro|YMFSB_NATIVEDACINVOLL
mdefine_line|#define&t;YMFSB_NATIVEDACINVOLL           0x00AC
DECL|macro|YMFSB_NATIVEDACINVOLR
mdefine_line|#define&t;YMFSB_NATIVEDACINVOLR           0x00AE
DECL|macro|YMFSB_BUF441OUTVOL
mdefine_line|#define&t;YMFSB_BUF441OUTVOL              0x00B0
DECL|macro|YMFSB_BUF441OUTVOLL
mdefine_line|#define&t;YMFSB_BUF441OUTVOLL             0x00B0
DECL|macro|YMFSB_BUF441OUTVOLR
mdefine_line|#define&t;YMFSB_BUF441OUTVOLR             0x00B2
DECL|macro|YMFSB_BUF441LOOPVOL
mdefine_line|#define&t;YMFSB_BUF441LOOPVOL             0x00B4
DECL|macro|YMFSB_BUF441LOOPVOLL
mdefine_line|#define&t;YMFSB_BUF441LOOPVOLL            0x00B4
DECL|macro|YMFSB_BUF441LOOPVOLR
mdefine_line|#define&t;YMFSB_BUF441LOOPVOLR            0x00B6
DECL|macro|YMFSB_SPDIFOUTVOL2
mdefine_line|#define&t;YMFSB_SPDIFOUTVOL2              0x00B8
DECL|macro|YMFSB_SPDIFOUTVOL2L
mdefine_line|#define&t;YMFSB_SPDIFOUTVOL2L             0x00B8
DECL|macro|YMFSB_SPDIFOUTVOL2R
mdefine_line|#define&t;YMFSB_SPDIFOUTVOL2R             0x00BA
DECL|macro|YMFSB_SPDIFLOOPVOL2
mdefine_line|#define&t;YMFSB_SPDIFLOOPVOL2             0x00BC
DECL|macro|YMFSB_SPDIFLOOPVOL2L
mdefine_line|#define&t;YMFSB_SPDIFLOOPVOL2L            0x00BC
DECL|macro|YMFSB_SPDIFLOOPVOL2R
mdefine_line|#define&t;YMFSB_SPDIFLOOPVOL2R            0x00BE
DECL|macro|YMFSB_ADCSLOTSR
mdefine_line|#define&t;YMFSB_ADCSLOTSR                 0x00C0
DECL|macro|YMFSB_RECSLOTSR
mdefine_line|#define&t;YMFSB_RECSLOTSR                 0x00C4
DECL|macro|YMFSB_ADCFORMAT
mdefine_line|#define&t;YMFSB_ADCFORMAT                 0x00C8
DECL|macro|YMFSB_RECFORMAT
mdefine_line|#define&t;YMFSB_RECFORMAT                 0x00CC
DECL|macro|YMFSB_P44SLOTSR
mdefine_line|#define&t;YMFSB_P44SLOTSR                 0x00D0
DECL|macro|YMFSB_STATUS
mdefine_line|#define&t;YMFSB_STATUS                    0x0100
DECL|macro|YMFSB_CTRLSELECT
mdefine_line|#define&t;YMFSB_CTRLSELECT                0x0104
DECL|macro|YMFSB_MODE
mdefine_line|#define&t;YMFSB_MODE                      0x0108
DECL|macro|YMFSB_SAMPLECOUNT
mdefine_line|#define&t;YMFSB_SAMPLECOUNT               0x010C
DECL|macro|YMFSB_NUMOFSAMPLES
mdefine_line|#define&t;YMFSB_NUMOFSAMPLES              0x0110
DECL|macro|YMFSB_CONFIG
mdefine_line|#define&t;YMFSB_CONFIG                    0x0114
DECL|macro|YMFSB_PLAYCTRLSIZE
mdefine_line|#define&t;YMFSB_PLAYCTRLSIZE              0x0140
DECL|macro|YMFSB_RECCTRLSIZE
mdefine_line|#define&t;YMFSB_RECCTRLSIZE               0x0144
DECL|macro|YMFSB_EFFCTRLSIZE
mdefine_line|#define&t;YMFSB_EFFCTRLSIZE               0x0148
DECL|macro|YMFSB_WORKSIZE
mdefine_line|#define&t;YMFSB_WORKSIZE                  0x014C
DECL|macro|YMFSB_MAPOFREC
mdefine_line|#define&t;YMFSB_MAPOFREC                  0x0150
DECL|macro|YMFSB_MAPOFEFFECT
mdefine_line|#define&t;YMFSB_MAPOFEFFECT               0x0154
DECL|macro|YMFSB_PLAYCTRLBASE
mdefine_line|#define&t;YMFSB_PLAYCTRLBASE              0x0158
DECL|macro|YMFSB_RECCTRLBASE
mdefine_line|#define&t;YMFSB_RECCTRLBASE               0x015C
DECL|macro|YMFSB_EFFCTRLBASE
mdefine_line|#define&t;YMFSB_EFFCTRLBASE               0x0160
DECL|macro|YMFSB_WORKBASE
mdefine_line|#define&t;YMFSB_WORKBASE                  0x0164
DECL|macro|YMFSB_DSPINSTRAM
mdefine_line|#define&t;YMFSB_DSPINSTRAM                0x1000
DECL|macro|YMFSB_CTRLINSTRAM
mdefine_line|#define&t;YMFSB_CTRLINSTRAM               0x4000
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|macro|MAX_CARDS
mdefine_line|#define MAX_CARDS&t;4
DECL|macro|PFX
mdefine_line|#define PFX&t;&t;&quot;ymf_sb: &quot;
DECL|macro|YMFSB_VERSION
mdefine_line|#define YMFSB_VERSION&t;&quot;0.0.6&quot;
DECL|macro|YMFSB_CARD_NAME
mdefine_line|#define YMFSB_CARD_NAME&t;&quot;YMF7xx Legacy Audio driver &quot; YMFSB_VERSION
macro_line|#ifdef SUPPORT_UART401_MIDI
macro_line|#if 0
macro_line|# define ymf7xxsb_probe_midi probe_uart401
macro_line|# define ymf7xxsb_unload_midi unload_uart401
macro_line|#else
DECL|macro|ymf7xxsb_probe_midi
macro_line|# define ymf7xxsb_probe_midi probe_sbmpu
DECL|macro|ymf7xxsb_unload_midi
macro_line|# define ymf7xxsb_unload_midi unload_sbmpu
macro_line|#endif
macro_line|#endif
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|variable|sb_data
r_static
r_struct
id|address_info
id|sb_data
(braket
id|MAX_CARDS
)braket
suffix:semicolon
DECL|variable|opl3_data
r_static
r_struct
id|address_info
id|opl3_data
(braket
id|MAX_CARDS
)braket
suffix:semicolon
macro_line|#ifdef SUPPORT_UART401_MIDI
DECL|variable|mpu_data
r_static
r_struct
id|address_info
id|mpu_data
(braket
id|MAX_CARDS
)braket
suffix:semicolon
macro_line|#endif
DECL|variable|cards
r_static
r_int
id|cards
op_assign
l_int|0
suffix:semicolon
DECL|variable|ymfbase
r_static
r_int
r_int
op_star
id|ymfbase
(braket
id|MAX_CARDS
)braket
suffix:semicolon
multiline_comment|/* ---------------------------------------------------------------------- */
macro_line|#ifdef MODULE
macro_line|#ifdef SUPPORT_UART401_MIDI
DECL|variable|mpu_io
r_static
r_int
id|mpu_io
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|variable|synth_io
r_static
r_int
id|synth_io
op_assign
l_int|0
suffix:semicolon
DECL|variable|io
r_static
r_int
id|io
op_assign
l_int|0
suffix:semicolon
DECL|variable|dma
r_static
r_int
id|dma
op_assign
l_int|0
suffix:semicolon
DECL|variable|master_vol
r_static
r_int
id|master_vol
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|spdif_out
r_static
r_int
id|spdif_out
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef SUPPORT_UART401_MIDI
id|MODULE_PARM
c_func
(paren
id|mpu_io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
id|MODULE_PARM
c_func
(paren
id|synth_io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dma
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|master_vol
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|spdif_out
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#else
macro_line|#ifdef SUPPORT_UART401_MIDI
DECL|variable|mpu_io
r_static
r_int
id|mpu_io
op_assign
l_int|0x330
suffix:semicolon
macro_line|#endif
DECL|variable|synth_io
r_static
r_int
id|synth_io
op_assign
l_int|0x388
suffix:semicolon
DECL|variable|io
r_static
r_int
id|io
op_assign
l_int|0x220
suffix:semicolon
DECL|variable|dma
r_static
r_int
id|dma
op_assign
l_int|1
suffix:semicolon
DECL|variable|master_vol
r_static
r_int
id|master_vol
op_assign
l_int|80
suffix:semicolon
DECL|variable|spdif_out
r_static
r_int
id|spdif_out
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|readRegWord
r_static
r_int
id|readRegWord
c_func
(paren
r_int
id|adr
)paren
(brace
r_if
c_cond
(paren
id|ymfbase
(braket
id|cards
)braket
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|readw
c_func
(paren
id|ymfbase
(braket
id|cards
)braket
op_plus
id|adr
op_div
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|writeRegWord
r_static
r_void
id|writeRegWord
c_func
(paren
r_int
id|adr
comma
r_int
id|val
)paren
(brace
r_if
c_cond
(paren
id|ymfbase
(braket
id|cards
)braket
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|writew
c_func
(paren
(paren
r_int
r_int
)paren
(paren
id|val
op_amp
l_int|0xffff
)paren
comma
id|ymfbase
(braket
id|cards
)braket
op_plus
id|adr
op_div
l_int|2
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|readRegDWord
r_static
r_int
id|readRegDWord
c_func
(paren
r_int
id|adr
)paren
(brace
r_if
c_cond
(paren
id|ymfbase
(braket
id|cards
)braket
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
(paren
id|readl
c_func
(paren
id|ymfbase
(braket
id|cards
)braket
op_plus
id|adr
op_div
l_int|2
)paren
)paren
suffix:semicolon
)brace
DECL|function|writeRegDWord
r_static
r_void
id|writeRegDWord
c_func
(paren
r_int
id|adr
comma
r_int
id|val
)paren
(brace
r_if
c_cond
(paren
id|ymfbase
(braket
id|cards
)braket
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|writel
c_func
(paren
(paren
r_int
r_int
)paren
(paren
id|val
op_amp
l_int|0xffffffff
)paren
comma
id|ymfbase
(braket
id|cards
)braket
op_plus
id|adr
op_div
l_int|2
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|checkPrimaryBusy
r_static
r_int
id|checkPrimaryBusy
c_func
(paren
r_void
)paren
(brace
r_int
id|timeout
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_increment
OL
id|YMFSB_AC97TIMEOUT
)paren
(brace
r_if
c_cond
(paren
(paren
id|readRegWord
c_func
(paren
id|YMFSB_PRISTATUSADR
)paren
op_amp
l_int|0x8000
)paren
op_eq
l_int|0x0000
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|writeAc97
r_static
r_int
id|writeAc97
c_func
(paren
r_int
id|adr
comma
r_int
r_int
id|val
)paren
(brace
r_if
c_cond
(paren
id|adr
OG
l_int|0x7f
op_logical_or
id|adr
OL
l_int|0x00
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|checkPrimaryBusy
c_func
(paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;AC97 0x%0x = 0x%0x&bslash;n&quot;
comma
id|adr
comma
id|val
)paren
suffix:semicolon
macro_line|#endif
id|writeRegWord
c_func
(paren
id|YMFSB_AC97CMDADR
comma
l_int|0x0000
op_or
id|adr
)paren
suffix:semicolon
id|writeRegWord
c_func
(paren
id|YMFSB_AC97CMDDATA
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|checkCodec
r_static
r_int
id|__init
id|checkCodec
c_func
(paren
r_struct
id|pci_dev
op_star
id|pcidev
)paren
(brace
id|u8
id|tmp8
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_DSXGCTRL
comma
op_amp
id|tmp8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp8
op_amp
l_int|0x03
)paren
(brace
id|pci_write_config_byte
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_DSXGCTRL
comma
id|tmp8
op_amp
l_int|0xfc
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|YMFSB_RESET_DELAY
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_DSXGCTRL
comma
id|tmp8
op_or
l_int|0x03
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|YMFSB_RESET_DELAY
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_DSXGCTRL
comma
id|tmp8
op_amp
l_int|0xfc
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|YMFSB_RESET_DELAY
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|checkPrimaryBusy
c_func
(paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|setupLegacyIO
r_static
r_int
id|__init
id|setupLegacyIO
c_func
(paren
r_struct
id|pci_dev
op_star
id|pcidev
)paren
(brace
r_int
id|v
suffix:semicolon
r_int
id|sbio
op_assign
l_int|0
comma
id|mpuio
op_assign
l_int|0
comma
id|oplio
op_assign
l_int|0
comma
id|dma
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|sb_data
(braket
id|cards
)braket
dot
id|io_base
)paren
(brace
r_case
l_int|0x220
suffix:colon
id|sbio
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x240
suffix:colon
id|sbio
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x260
suffix:colon
id|sbio
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x280
suffix:colon
id|sbio
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|PFX
l_string|&quot;set SBPro I/O at 0x%x&bslash;n&quot;
comma
id|sb_data
(braket
id|cards
)braket
dot
id|io_base
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef SUPPORT_UART401_MIDI
r_switch
c_cond
(paren
id|mpu_data
(braket
id|cards
)braket
dot
id|io_base
)paren
(brace
r_case
l_int|0x330
suffix:colon
id|mpuio
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x300
suffix:colon
id|mpuio
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x332
suffix:colon
id|mpuio
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x334
suffix:colon
id|mpuio
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|mpuio
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|# ifdef YMF_DEBUG
id|printk
c_func
(paren
id|PFX
l_string|&quot;set MPU401 I/O at 0x%x&bslash;n&quot;
comma
id|mpu_data
(braket
id|cards
)braket
dot
id|io_base
)paren
suffix:semicolon
macro_line|# endif
macro_line|#endif
r_switch
c_cond
(paren
id|opl3_data
(braket
id|cards
)braket
dot
id|io_base
)paren
(brace
r_case
l_int|0x388
suffix:colon
id|oplio
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x398
suffix:colon
id|oplio
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3a0
suffix:colon
id|oplio
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3a8
suffix:colon
id|oplio
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|PFX
l_string|&quot;set OPL3 I/O at 0x%x&bslash;n&quot;
comma
id|opl3_data
(braket
id|cards
)braket
dot
id|io_base
)paren
suffix:semicolon
macro_line|#endif
id|dma
op_assign
id|sb_data
(braket
id|cards
)braket
dot
id|dma
suffix:semicolon
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|PFX
l_string|&quot;set DMA address at 0x%x&bslash;n&quot;
comma
id|sb_data
(braket
id|cards
)braket
dot
id|dma
)paren
suffix:semicolon
macro_line|#endif
id|v
op_assign
l_int|0x0000
op_or
(paren
(paren
id|dma
op_amp
l_int|0x03
)paren
op_lshift
l_int|6
)paren
op_or
l_int|0x003f
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_LEGCTRL
comma
id|v
)paren
suffix:semicolon
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|PFX
l_string|&quot;LEGCTRL: 0x%x&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|pcidev-&gt;device
)paren
(brace
r_case
id|PCI_DEVICE_ID_YMF724
suffix:colon
r_case
id|PCI_DEVICE_ID_YMF740
suffix:colon
r_case
id|PCI_DEVICE_ID_YMF724F
suffix:colon
r_case
id|PCI_DEVICE_ID_YMF740C
suffix:colon
id|v
op_assign
l_int|0x8800
op_or
(paren
(paren
id|mpuio
op_amp
l_int|0x03
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|sbio
op_amp
l_int|0x03
)paren
op_lshift
l_int|2
)paren
op_or
(paren
id|oplio
op_amp
l_int|0x03
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_ELEGCTRL
comma
id|v
)paren
suffix:semicolon
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|PFX
l_string|&quot;ELEGCTRL: 0x%x&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_YMF744
suffix:colon
r_case
id|PCI_DEVICE_ID_YMF754
suffix:colon
id|v
op_assign
l_int|0x8800
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_ELEGCTRL
comma
id|v
)paren
suffix:semicolon
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|PFX
l_string|&quot;ELEGCTRL: 0x%x&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
macro_line|#endif
id|pci_write_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_OPLADR
comma
id|opl3_data
(braket
id|cards
)braket
dot
id|io_base
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_SBADR
comma
id|sb_data
(braket
id|cards
)braket
dot
id|io_base
)paren
suffix:semicolon
macro_line|#ifdef SUPPORT_UART401_MIDI
id|pci_write_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_MPUADR
comma
id|mpu_data
(braket
id|cards
)braket
dot
id|io_base
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Invalid device ID: %d&bslash;n&quot;
comma
id|pcidev-&gt;device
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|enableDSP
r_static
r_void
id|enableDSP
c_func
(paren
r_void
)paren
(brace
id|writeRegDWord
c_func
(paren
id|YMFSB_CONFIG
comma
l_int|0x00000001
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|disableDSP
r_static
r_void
id|disableDSP
c_func
(paren
r_void
)paren
(brace
r_int
id|val
suffix:semicolon
r_int
id|i
suffix:semicolon
id|val
op_assign
id|readRegDWord
c_func
(paren
id|YMFSB_CONFIG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
(brace
id|writeRegDWord
c_func
(paren
id|YMFSB_CONFIG
comma
l_int|0
)paren
suffix:semicolon
)brace
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_increment
id|i
OL
id|YMFSB_WORKBITTIMEOUT
)paren
(brace
id|val
op_assign
id|readRegDWord
c_func
(paren
id|YMFSB_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
l_int|0x00000002
)paren
op_eq
l_int|0x00000000
)paren
r_break
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|setupInstruction
r_static
r_int
id|__init
id|setupInstruction
c_func
(paren
r_struct
id|pci_dev
op_star
id|pcidev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|val
suffix:semicolon
id|writeRegDWord
c_func
(paren
id|YMFSB_NATIVEDACOUTVOL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* mute dac */
id|disableDSP
c_func
(paren
)paren
suffix:semicolon
id|writeRegDWord
c_func
(paren
id|YMFSB_MODE
comma
l_int|0x00010000
)paren
suffix:semicolon
multiline_comment|/* DS-XG Software Reset */
id|writeRegDWord
c_func
(paren
id|YMFSB_MODE
comma
l_int|0x00000000
)paren
suffix:semicolon
id|writeRegDWord
c_func
(paren
id|YMFSB_MAPOFREC
comma
l_int|0x00000000
)paren
suffix:semicolon
id|writeRegDWord
c_func
(paren
id|YMFSB_MAPOFEFFECT
comma
l_int|0x00000000
)paren
suffix:semicolon
id|writeRegDWord
c_func
(paren
id|YMFSB_PLAYCTRLBASE
comma
l_int|0x00000000
)paren
suffix:semicolon
id|writeRegDWord
c_func
(paren
id|YMFSB_RECCTRLBASE
comma
l_int|0x00000000
)paren
suffix:semicolon
id|writeRegDWord
c_func
(paren
id|YMFSB_EFFCTRLBASE
comma
l_int|0x00000000
)paren
suffix:semicolon
id|val
op_assign
id|readRegWord
c_func
(paren
id|YMFSB_GLOBALCTRL
)paren
suffix:semicolon
id|writeRegWord
c_func
(paren
id|YMFSB_GLOBALCTRL
comma
(paren
id|val
op_amp
op_complement
l_int|0x0007
)paren
)paren
suffix:semicolon
multiline_comment|/* setup DSP instruction code */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|YMFSB_DSPLENGTH
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|writeRegDWord
c_func
(paren
id|YMFSB_DSPINSTRAM
op_plus
id|i
comma
id|DspInst
(braket
id|i
op_rshift
l_int|2
)braket
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|pcidev-&gt;device
)paren
(brace
r_case
id|PCI_DEVICE_ID_YMF724
suffix:colon
r_case
id|PCI_DEVICE_ID_YMF740
suffix:colon
multiline_comment|/* setup Control instruction code */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|YMFSB_CTRLLENGTH
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|writeRegDWord
c_func
(paren
id|YMFSB_CTRLINSTRAM
op_plus
id|i
comma
id|CntrlInst
(braket
id|i
op_rshift
l_int|2
)braket
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_YMF724F
suffix:colon
r_case
id|PCI_DEVICE_ID_YMF740C
suffix:colon
r_case
id|PCI_DEVICE_ID_YMF744
suffix:colon
r_case
id|PCI_DEVICE_ID_YMF754
suffix:colon
multiline_comment|/* setup Control instruction code */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|YMFSB_CTRLLENGTH
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|writeRegDWord
c_func
(paren
id|YMFSB_CTRLINSTRAM
op_plus
id|i
comma
id|CntrlInst1E
(braket
id|i
op_rshift
l_int|2
)braket
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|enableDSP
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|ymf7xx_init
r_static
r_int
id|__init
id|ymf7xx_init
c_func
(paren
r_struct
id|pci_dev
op_star
id|pcidev
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
multiline_comment|/* Read hardware information */
macro_line|#ifdef YMF_DEBUG
r_int
r_int
id|dv
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_VENDORID
comma
op_amp
id|v
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;Vendor ID = 0x%x&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_DEVICEID
comma
op_amp
id|v
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;Device ID = 0x%x&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_REVISIONID
comma
op_amp
id|v
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;Revision ID = 0x%x&bslash;n&quot;
comma
id|v
op_amp
l_int|0xff
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_BASEADDR
comma
op_amp
id|dv
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;Base address = 0x%x&bslash;n&quot;
comma
id|dv
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_IRQ
comma
op_amp
id|v
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;IRQ line = 0x%x&bslash;n&quot;
comma
id|v
op_amp
l_int|0xff
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* enables memory space access / bus mastering */
id|pci_read_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_CMD
comma
op_amp
id|v
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pcidev
comma
id|YMFSB_PCIR_CMD
comma
id|v
op_or
l_int|0x06
)paren
suffix:semicolon
multiline_comment|/* check codec */
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;check codec...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|checkCodec
c_func
(paren
id|pcidev
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* setup legacy I/O */
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;setup legacy I/O...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|setupLegacyIO
c_func
(paren
id|pcidev
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* setup instruction code */
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;setup instructions...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|setupInstruction
c_func
(paren
id|pcidev
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* AC&squot;97 setup */
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;setup AC&squot;97...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|writeAc97
c_func
(paren
id|AC97_RESET
comma
l_int|0x0000
)paren
)paren
multiline_comment|/* Reset */
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|writeAc97
c_func
(paren
id|AC97_MASTER_VOL_STEREO
comma
l_int|0x0000
)paren
)paren
multiline_comment|/* Master Volume */
r_return
op_minus
l_int|1
suffix:semicolon
id|v
op_assign
l_int|31
op_star
(paren
l_int|100
op_minus
id|master_vol
)paren
op_div
l_int|100
suffix:semicolon
id|v
op_assign
(paren
id|v
op_lshift
l_int|8
op_or
id|v
)paren
op_amp
l_int|0x7fff
suffix:semicolon
r_if
c_cond
(paren
id|writeAc97
c_func
(paren
id|AC97_PCMOUT_VOL
comma
id|v
)paren
)paren
multiline_comment|/* PCM out Volume */
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;setup Legacy Volume...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Legacy Audio Output Volume L &amp; R ch */
id|writeRegDWord
c_func
(paren
id|YMFSB_LEGACYOUTVOL
comma
l_int|0x3fff3fff
)paren
suffix:semicolon
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;setup SPDIF output control...&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* SPDIF Output control */
id|v
op_assign
id|spdif_out
op_ne
l_int|0
ques
c_cond
l_int|0x0001
suffix:colon
l_int|0x0000
suffix:semicolon
id|writeRegWord
c_func
(paren
id|YMFSB_SPDIFOUTCTRL
comma
id|v
)paren
suffix:semicolon
multiline_comment|/* no copyright protection, &n;&t;   sample-rate converted,&n;&t;   re-recorded software comercially available (the 1st generation),&n;&t;   original */
id|writeRegWord
c_func
(paren
id|YMFSB_SPDIFOUTSTATUS
comma
l_int|0x9a04
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|ymf7xxsb_attach_sb
r_static
r_void
id|__init
id|ymf7xxsb_attach_sb
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_init
c_func
(paren
id|hw_config
comma
id|THIS_MODULE
)paren
)paren
(brace
id|hw_config-&gt;slots
(braket
l_int|0
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|ymf7xxsb_probe_sb
r_static
r_int
id|__init
id|ymf7xxsb_probe_sb
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|hw_config-&gt;io_base
comma
l_int|16
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
id|PFX
l_string|&quot;SBPro port 0x%x is already in use&bslash;n&quot;
comma
id|hw_config-&gt;io_base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|sb_dsp_detect
c_func
(paren
id|hw_config
comma
id|SB_PCI_YAMAHA
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|ymf7xxsb_unload_sb
r_static
r_void
id|ymf7xxsb_unload_sb
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
comma
r_int
id|unload_mpu
)paren
(brace
r_if
c_cond
(paren
id|hw_config-&gt;slots
(braket
l_int|0
)braket
op_ne
op_minus
l_int|1
)paren
(brace
id|sb_dsp_unload
c_func
(paren
id|hw_config
comma
id|unload_mpu
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|enum|chip_types
r_enum
id|chip_types
(brace
DECL|enumerator|CH_YMF724
id|CH_YMF724
op_assign
l_int|0
comma
DECL|enumerator|CH_YMF724F
id|CH_YMF724F
comma
DECL|enumerator|CH_YMF740
id|CH_YMF740
comma
DECL|enumerator|CH_YMF740C
id|CH_YMF740C
comma
DECL|enumerator|CH_YMF744
id|CH_YMF744
comma
DECL|enumerator|CH_YMF754
id|CH_YMF754
comma
)brace
suffix:semicolon
multiline_comment|/* directly indexed by chip_types enum above */
multiline_comment|/* note we keep this a struct to ease adding&n; * other per-board or per-chip info here */
r_struct
(brace
DECL|member|devicename
r_const
r_char
op_star
id|devicename
suffix:semicolon
DECL|variable|__initdata
)brace
id|devicetable
(braket
)braket
id|__initdata
op_assign
(brace
(brace
l_string|&quot;YMF724A-E&quot;
)brace
comma
(brace
l_string|&quot;YMF724F&quot;
)brace
comma
(brace
l_string|&quot;YMF740A-B&quot;
)brace
comma
(brace
l_string|&quot;YMF740C&quot;
)brace
comma
(brace
l_string|&quot;YMF744&quot;
)brace
comma
(brace
l_string|&quot;YMF754&quot;
)brace
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|pci_device_id
id|ymf7xxsb_pci_tbl
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_YAMAHA
comma
id|PCI_DEVICE_ID_YMF724
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_YMF724
)brace
comma
(brace
id|PCI_VENDOR_ID_YAMAHA
comma
id|PCI_DEVICE_ID_YMF724F
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_YMF724F
)brace
comma
(brace
id|PCI_VENDOR_ID_YAMAHA
comma
id|PCI_DEVICE_ID_YMF740
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_YMF740
)brace
comma
(brace
id|PCI_VENDOR_ID_YAMAHA
comma
id|PCI_DEVICE_ID_YMF740C
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_YMF740C
)brace
comma
(brace
id|PCI_VENDOR_ID_YAMAHA
comma
id|PCI_DEVICE_ID_YMF744
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_YMF744
)brace
comma
(brace
id|PCI_VENDOR_ID_YAMAHA
comma
id|PCI_DEVICE_ID_YMF754
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_YMF754
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|ymf7xxsb_pci_tbl
)paren
suffix:semicolon
DECL|function|ymf7xxsb_init_one
r_static
r_int
id|__init
id|ymf7xxsb_init_one
(paren
r_struct
id|pci_dev
op_star
id|pcidev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_const
r_char
op_star
id|devicename
suffix:semicolon
r_int
r_int
id|iobase
suffix:semicolon
r_if
c_cond
(paren
id|cards
op_eq
id|MAX_CARDS
)paren
(brace
id|printk
(paren
id|KERN_DEBUG
id|PFX
l_string|&quot;maximum number of cards reached&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pcidev-&gt;irq
op_eq
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|iobase
op_assign
id|pci_resource_start
(paren
id|pcidev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iobase
op_eq
l_int|0x00000000
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|devicename
op_assign
id|devicetable
(braket
id|ent-&gt;driver_data
)braket
dot
id|devicename
suffix:semicolon
multiline_comment|/* remap memory mapped I/O onto kernel virtual memory */
r_if
c_cond
(paren
(paren
id|ymfbase
(braket
id|cards
)braket
op_assign
id|ioremap_nocache
c_func
(paren
id|iobase
comma
id|YMFSB_REGSIZE
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;ioremap (0x%lx) returns zero&bslash;n&quot;
comma
id|iobase
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;found %s at 0x%lx&bslash;n&quot;
comma
id|devicename
comma
id|iobase
)paren
suffix:semicolon
macro_line|#ifdef YMF_DEBUG
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;remappling to 0x%p&bslash;n&quot;
comma
id|ymfbase
(braket
id|cards
)braket
)paren
suffix:semicolon
macro_line|#endif
id|memset
(paren
op_amp
id|sb_data
(braket
id|cards
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|address_info
)paren
)paren
suffix:semicolon
id|memset
(paren
op_amp
id|opl3_data
(braket
id|cards
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|address_info
)paren
)paren
suffix:semicolon
macro_line|#ifdef SUPPORT_UART401_MIDI
id|memset
(paren
op_amp
id|mpu_data
(braket
id|cards
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|address_info
)paren
)paren
suffix:semicolon
macro_line|#endif
id|sb_data
(braket
id|cards
)braket
dot
id|name
op_assign
id|YMFSB_CARD_NAME
suffix:semicolon
id|opl3_data
(braket
id|cards
)braket
dot
id|name
op_assign
id|YMFSB_CARD_NAME
suffix:semicolon
macro_line|#ifdef SUPPORT_UART401_MIDI
id|mpu_data
(braket
id|cards
)braket
dot
id|name
op_assign
id|YMFSB_CARD_NAME
suffix:semicolon
macro_line|#endif
id|sb_data
(braket
id|cards
)braket
dot
id|card_subtype
op_assign
id|MDL_YMPCI
suffix:semicolon
r_if
c_cond
(paren
id|io
op_eq
l_int|0
)paren
id|io
op_assign
l_int|0x220
suffix:semicolon
id|sb_data
(braket
id|cards
)braket
dot
id|io_base
op_assign
id|io
suffix:semicolon
id|sb_data
(braket
id|cards
)braket
dot
id|irq
op_assign
id|pcidev-&gt;irq
suffix:semicolon
id|sb_data
(braket
id|cards
)braket
dot
id|dma
op_assign
id|dma
suffix:semicolon
r_if
c_cond
(paren
id|synth_io
op_eq
l_int|0
)paren
id|synth_io
op_assign
l_int|0x388
suffix:semicolon
id|opl3_data
(braket
id|cards
)braket
dot
id|io_base
op_assign
id|synth_io
suffix:semicolon
id|opl3_data
(braket
id|cards
)braket
dot
id|irq
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#ifdef SUPPORT_UART401_MIDI
r_if
c_cond
(paren
id|mpu_io
op_eq
l_int|0
)paren
id|mpu_io
op_assign
l_int|0x330
suffix:semicolon
id|mpu_data
(braket
id|cards
)braket
dot
id|io_base
op_assign
id|mpu_io
suffix:semicolon
id|mpu_data
(braket
id|cards
)braket
dot
id|irq
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ymf7xx_init
c_func
(paren
id|pcidev
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot initialize %s, aborting&bslash;n&quot;
comma
id|devicename
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* register legacy SoundBlaster Pro */
r_if
c_cond
(paren
op_logical_neg
id|ymf7xxsb_probe_sb
c_func
(paren
op_amp
id|sb_data
(braket
id|cards
)braket
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;SB probe at 0x%X failed, aborting&bslash;n&quot;
comma
id|io
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ymf7xxsb_attach_sb
(paren
op_amp
id|sb_data
(braket
id|cards
)braket
)paren
suffix:semicolon
macro_line|#ifdef SUPPORT_UART401_MIDI
multiline_comment|/* register legacy MIDI */
r_if
c_cond
(paren
id|mpu_io
OG
l_int|0
op_logical_and
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ymf7xxsb_probe_midi
(paren
op_amp
id|mpu_data
(braket
id|cards
)braket
comma
id|THIS_MODULE
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;MIDI probe @ 0x%X failed, aborting&bslash;n&quot;
comma
id|mpu_io
)paren
suffix:semicolon
id|ymf7xxsb_unload_sb
(paren
op_amp
id|sb_data
(braket
id|cards
)braket
comma
l_int|0
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* register legacy OPL3 */
id|cards
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ymf7xxsb_driver
r_static
r_struct
id|pci_driver
id|ymf7xxsb_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;ymf7xxsb&quot;
comma
id|id_table
suffix:colon
id|ymf7xxsb_pci_tbl
comma
id|probe
suffix:colon
id|ymf7xxsb_init_one
comma
)brace
suffix:semicolon
DECL|function|init_ymf7xxsb_module
r_static
r_int
id|__init
id|init_ymf7xxsb_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|master_vol
OL
l_int|0
)paren
id|master_vol
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|master_vol
OG
l_int|100
)paren
id|master_vol
op_assign
l_int|100
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_CARDS
suffix:semicolon
id|i
op_increment
)paren
id|ymfbase
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|i
op_assign
id|pci_module_init
(paren
op_amp
id|ymf7xxsb_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
id|i
suffix:semicolon
id|printk
(paren
id|KERN_INFO
id|PFX
id|YMFSB_CARD_NAME
l_string|&quot; loaded&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|free_iomaps
r_static
r_void
id|__exit
id|free_iomaps
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_CARDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ymfbase
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
id|iounmap
c_func
(paren
id|ymfbase
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|cleanup_ymf7xxsb_module
r_static
r_void
id|__exit
id|cleanup_ymf7xxsb_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cards
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef SUPPORT_UART401_MIDI
id|ymf7xxsb_unload_sb
(paren
op_amp
id|sb_data
(braket
id|i
)braket
comma
l_int|0
)paren
suffix:semicolon
id|ymf7xxsb_unload_midi
(paren
op_amp
id|mpu_data
(braket
id|i
)braket
)paren
suffix:semicolon
macro_line|#else
id|ymf7xxsb_unload_sb
(paren
op_amp
id|sb_data
(braket
id|i
)braket
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
)brace
id|free_iomaps
c_func
(paren
)paren
suffix:semicolon
id|pci_unregister_driver
c_func
(paren
op_amp
id|ymf7xxsb_driver
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Daisuke Nagano, breeze.nagano@nifty.ne.jp&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;YMF7xx Legacy Audio Driver&quot;
)paren
suffix:semicolon
DECL|variable|init_ymf7xxsb_module
id|module_init
c_func
(paren
id|init_ymf7xxsb_module
)paren
suffix:semicolon
DECL|variable|cleanup_ymf7xxsb_module
id|module_exit
c_func
(paren
id|cleanup_ymf7xxsb_module
)paren
suffix:semicolon
eof
