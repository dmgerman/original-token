multiline_comment|/*&n; * sound/sound_pnp.c&n; *&n; * PnP soundcard support (Linux spesific)&n; */
multiline_comment|/*&n; * Copyright (C) by Hannu Savolainen 1993-1997&n; *&n; * OSS/Free for Linux is distributed under the GNU GENERAL PUBLIC LICENSE (GPL)&n; * Version 2 (June 1991). See the &quot;COPYING&quot; file distributed with this software&n; * for more info.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &quot;sound_config.h&quot;
macro_line|#if defined(CONFIG_SPNP)
DECL|variable|maui_sleeper
r_static
r_struct
id|wait_queue
op_star
id|maui_sleeper
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|maui_sleep_flag
r_static
r_volatile
r_struct
id|snd_wait
id|maui_sleep_flag
op_assign
(brace
l_int|0
)brace
suffix:semicolon
r_extern
r_int
r_int
id|init_pnp
(paren
r_int
r_int
comma
r_int
op_star
)paren
suffix:semicolon
macro_line|#include &quot;pnp.h&quot;
r_extern
r_int
op_star
id|sound_osp
suffix:semicolon
r_extern
r_int
(paren
op_star
id|pnp_ioctl
)paren
(paren
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
suffix:semicolon
r_extern
r_int
id|sound_pnp_port
suffix:semicolon
DECL|variable|disabled_devices
r_static
r_int
id|disabled_devices
(braket
)braket
op_assign
(brace
id|PNP_DEVID
(paren
l_char|&squot;G&squot;
comma
l_char|&squot;R&squot;
comma
l_char|&squot;V&squot;
comma
l_int|0x0003
)paren
comma
multiline_comment|/* GUS SB emulation */
id|PNP_DEVID
(paren
l_char|&squot;G&squot;
comma
l_char|&squot;R&squot;
comma
l_char|&squot;V&squot;
comma
l_int|0x0004
)paren
comma
multiline_comment|/* GUS MPU emulation */
l_int|0
)brace
suffix:semicolon
DECL|variable|special_devices
r_static
r_int
id|special_devices
(braket
)braket
op_assign
(brace
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;S&squot;
comma
l_char|&squot;C&squot;
comma
l_int|0x0010
)paren
comma
multiline_comment|/* CS4232/6 control port */
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;S&squot;
comma
l_char|&squot;C&squot;
comma
l_int|0x0002
)paren
comma
multiline_comment|/* CS4232/6 control port */
l_int|0
)brace
suffix:semicolon
DECL|variable|pnp_sig
r_static
r_int
id|pnp_sig
op_assign
l_int|0
suffix:semicolon
r_static
r_void
DECL|function|pnp_delay
id|pnp_delay
(paren
r_int
id|t
)paren
(brace
id|t
op_assign
(paren
id|t
op_star
id|HZ
)paren
op_div
l_int|1000000
suffix:semicolon
multiline_comment|/* Convert to jiffies */
(brace
r_int
r_int
id|tlimit
suffix:semicolon
r_if
c_cond
(paren
id|t
)paren
id|current-&gt;timeout
op_assign
id|tlimit
op_assign
id|jiffies
op_plus
(paren
id|t
)paren
suffix:semicolon
r_else
id|tlimit
op_assign
(paren
r_int
r_int
)paren
op_minus
l_int|1
suffix:semicolon
id|maui_sleep_flag.opts
op_assign
id|WK_SLEEP
suffix:semicolon
id|interruptible_sleep_on
(paren
op_amp
id|maui_sleeper
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|maui_sleep_flag.opts
op_amp
id|WK_WAKEUP
)paren
)paren
(brace
r_if
c_cond
(paren
id|jiffies
op_ge
id|tlimit
)paren
id|maui_sleep_flag.opts
op_or_assign
id|WK_TIMEOUT
suffix:semicolon
)brace
id|maui_sleep_flag.opts
op_and_assign
op_complement
id|WK_SLEEP
suffix:semicolon
)brace
suffix:semicolon
)brace
r_void
DECL|function|cs4232_pnp
id|cs4232_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|old_num_mixers
op_assign
id|num_mixers
suffix:semicolon
r_int
id|is_4232
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* CS4232 (not CS4236 or something better) */
r_int
id|portmask
op_assign
l_int|0xff
suffix:semicolon
r_int
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|opl3_driver
comma
id|wss_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;CS4232/6 driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card-&gt;key
op_eq
(paren
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;S&squot;
comma
l_char|&squot;C&squot;
comma
l_int|0x4232
)paren
)paren
)paren
id|is_4232
op_assign
l_int|1
suffix:semicolon
macro_line|#ifndef USE_HOT_PNP_INIT
r_if
c_cond
(paren
id|is_4232
)paren
multiline_comment|/* CS4232 may cause lockups */
r_if
c_cond
(paren
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
op_eq
id|NO_PORT
op_logical_or
id|pnp_get_port
(paren
id|dev
comma
l_int|1
)paren
op_eq
id|NO_PORT
op_logical_or
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
op_eq
id|NO_IRQ
op_logical_or
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
op_eq
id|NO_DMA
)paren
(brace
id|printk
(paren
l_string|&quot;Sound: CS4232 in PnP mode requires prior initialization by PnP BIOS&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;PnP WSS&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wss_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;AD1848&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* MSS */
r_else
id|printk
(paren
l_string|&quot;Sound: PnP MSS/WSS device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opl3_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;OPL3&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* OPL3 */
r_else
id|printk
(paren
l_string|&quot;Sound: PnP OPL3/4 device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* printk (&quot;WSS driver %d, OPL3 driver %d&bslash;n&quot;, wss_driver, opl3_driver); */
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_4232
)paren
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|wss_base
comma
id|opl3_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
id|dma1
comma
id|dma2
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|wss_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|opl3_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma1
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma2
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|pnp_delay
(paren
l_int|1000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
(brace
id|printk
(paren
l_string|&quot;I/O0 %03x&bslash;n&quot;
comma
id|wss_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;I/O1 %03x&bslash;n&quot;
comma
id|opl3_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA0 %d&bslash;n&quot;
comma
id|dma1
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA1 %d&bslash;n&quot;
comma
id|dma2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opl3_base
op_logical_and
id|opl3_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|opl3_base
suffix:semicolon
id|hw_config.irq
op_assign
l_int|0
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|opl3_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wss_base
op_logical_and
id|wss_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|wss_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
id|dma1
suffix:semicolon
id|hw_config.dma2
op_assign
(paren
id|dma2
op_eq
id|NO_DMA
)paren
ques
c_cond
id|dma1
suffix:colon
id|dma2
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|wss_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
r_if
c_cond
(paren
id|num_mixers
OG
id|old_num_mixers
)paren
(brace
multiline_comment|/* Assume the mixer map is as suggested in the CS4232 spec */
id|AD1848_REROUTE
(paren
id|SOUND_MIXER_LINE1
comma
id|SOUND_MIXER_LINE
)paren
suffix:semicolon
id|AD1848_REROUTE
(paren
id|SOUND_MIXER_LINE2
comma
id|SOUND_MIXER_CD
)paren
suffix:semicolon
id|AD1848_REROUTE
(paren
id|SOUND_MIXER_LINE3
comma
id|SOUND_MIXER_SYNTH
)paren
suffix:semicolon
multiline_comment|/* FM */
)brace
)brace
)brace
)brace
r_void
DECL|function|opti82C924_pnp
id|opti82C924_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0xff
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|opl3_driver
comma
id|wss_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;OPTi 82C924 driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;PnP WSS&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wss_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;AD1848&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* MSS */
r_else
id|printk
(paren
l_string|&quot;Sound: PnP MSS/WSS device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opl3_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;OPL3&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* OPL3 */
r_else
id|printk
(paren
l_string|&quot;Sound: PnP OPL3/4 device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* printk (&quot;WSS driver %d, OPL3 driver %d&bslash;n&quot;, wss_driver, opl3_driver); */
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|wss_base
comma
id|opl3_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
id|dma1
comma
id|dma2
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|wss_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|opl3_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|2
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma1
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma2
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|pnp_delay
(paren
l_int|2000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
(brace
id|printk
(paren
l_string|&quot;I/O0 %03x&bslash;n&quot;
comma
id|wss_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;I/O1 %03x&bslash;n&quot;
comma
id|opl3_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA0 %d&bslash;n&quot;
comma
id|dma1
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA1 %d&bslash;n&quot;
comma
id|dma2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opl3_base
op_logical_and
id|opl3_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|opl3_base
op_plus
l_int|8
suffix:semicolon
id|hw_config.irq
op_assign
l_int|0
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|opl3_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wss_base
op_logical_and
id|wss_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|wss_base
op_plus
l_int|4
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
id|dma1
suffix:semicolon
id|hw_config.dma2
op_assign
(paren
id|dma2
op_eq
id|NO_DMA
)paren
ques
c_cond
id|dma1
suffix:colon
id|dma2
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|wss_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|opl3sa2_pnp
id|opl3sa2_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0x00
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|opl3_driver
comma
id|wss_driver
comma
id|mpu_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;OPL3-SA2 driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;PnP WSS&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wss_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;AD1848&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* MSS */
r_else
id|printk
(paren
l_string|&quot;Sound: PnP MSS/WSS device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opl3_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;OPL3&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* OPL3 */
r_else
id|printk
(paren
l_string|&quot;Sound: PnP OPL3/4 device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mpu_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;UART401&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x08
suffix:semicolon
multiline_comment|/* OPL3 */
r_else
id|printk
(paren
l_string|&quot;Sound: PnP UART401 device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* printk (&quot;WSS driver %d, OPL3 driver %d&bslash;n&quot;, wss_driver, opl3_driver); */
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|wss_base
comma
id|opl3_base
comma
id|mpu_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
id|dma1
comma
id|dma2
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|wss_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|opl3_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|2
)paren
suffix:semicolon
id|mpu_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|3
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma1
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma2
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|pnp_delay
(paren
l_int|1000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
(brace
id|printk
(paren
l_string|&quot;I/O0 %03x&bslash;n&quot;
comma
id|wss_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;I/O1 %03x&bslash;n&quot;
comma
id|opl3_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;I/O3 %03x&bslash;n&quot;
comma
id|mpu_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA0 %d&bslash;n&quot;
comma
id|dma1
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA1 %d&bslash;n&quot;
comma
id|dma2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opl3_base
op_logical_and
id|opl3_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|opl3_base
suffix:semicolon
id|hw_config.irq
op_assign
l_int|0
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|opl3_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wss_base
op_logical_and
id|wss_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|wss_base
op_plus
l_int|4
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
id|dma1
suffix:semicolon
id|hw_config.dma2
op_assign
(paren
id|dma2
op_eq
id|NO_DMA
)paren
ques
c_cond
id|dma1
suffix:colon
id|dma2
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|wss_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mpu_base
op_logical_and
id|mpu_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|mpu_base
suffix:semicolon
id|hw_config.irq
op_assign
l_int|0
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|mpu_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
r_int
r_char
DECL|function|C931_read
id|C931_read
(paren
r_int
id|base
comma
r_int
id|reg
)paren
(brace
r_int
r_char
id|data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|outb
(paren
(paren
l_int|0xE4
)paren
comma
id|base
)paren
suffix:semicolon
id|outb
(paren
(paren
id|reg
)paren
comma
id|base
op_plus
l_int|2
)paren
suffix:semicolon
id|data
op_assign
id|inb
(paren
id|base
op_plus
l_int|3
)paren
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
r_static
r_void
DECL|function|C931_write
id|C931_write
(paren
r_int
id|base
comma
r_int
id|reg
comma
r_int
r_char
id|data
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|outb
(paren
(paren
l_int|0xE4
)paren
comma
id|base
)paren
suffix:semicolon
id|outb
(paren
(paren
id|reg
)paren
comma
id|base
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
(paren
(paren
id|data
)paren
comma
id|base
op_plus
l_int|3
)paren
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
)brace
r_void
DECL|function|opti82C931_pnp
id|opti82C931_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0xff
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|opl3_driver
comma
id|wss_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;OPTi 82C931 driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;PnP WSS&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wss_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;AD1848&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* MSS */
r_else
id|printk
(paren
l_string|&quot;Sound: PnP MSS/WSS device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opl3_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;OPL3&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* OPL3 */
r_else
id|printk
(paren
l_string|&quot;Sound: PnP OPL3/4 device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* printk (&quot;WSS driver %d, OPL3 driver %d&bslash;n&quot;, wss_driver, opl3_driver); */
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|wss_base
comma
id|opl3_base
comma
id|master_ctl
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
id|dma1
comma
id|dma2
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|wss_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|opl3_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|master_ctl
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|3
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma1
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma2
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
(paren
l_string|&quot;I/O0 %03x&bslash;n&quot;
comma
id|wss_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;I/O1 %03x&bslash;n&quot;
comma
id|opl3_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;Master control port %x&bslash;n&quot;
comma
id|master_ctl
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|printk
(paren
l_string|&quot;Port %x = %x&bslash;n&quot;
comma
id|master_ctl
op_plus
id|i
comma
id|inb
(paren
id|master_ctl
op_plus
id|i
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA0 %d&bslash;n&quot;
comma
id|dma1
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA1 %d&bslash;n&quot;
comma
id|dma2
)paren
suffix:semicolon
)brace
(brace
r_int
r_char
id|tmp
suffix:semicolon
id|tmp
op_assign
id|C931_read
(paren
id|master_ctl
comma
l_int|5
)paren
op_or
l_int|0x20
suffix:semicolon
multiline_comment|/* Enable codec registers I16 to I31 */
id|C931_write
(paren
id|master_ctl
comma
l_int|5
comma
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
l_int|0x82
suffix:semicolon
multiline_comment|/* MPU and WSS enabled, SB disabled */
id|C931_write
(paren
id|master_ctl
comma
l_int|6
comma
id|tmp
)paren
suffix:semicolon
)brace
id|pnp_delay
(paren
l_int|2000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opl3_base
op_logical_and
id|opl3_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|opl3_base
op_plus
l_int|8
suffix:semicolon
id|hw_config.irq
op_assign
l_int|0
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|opl3_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wss_base
op_logical_and
id|wss_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|wss_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
id|dma1
suffix:semicolon
id|hw_config.dma2
op_assign
(paren
id|dma2
op_eq
id|NO_DMA
)paren
ques
c_cond
id|dma1
suffix:colon
id|dma2
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|wss_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
id|ad1848_control
(paren
id|AD1848_SET_C930_PWD
comma
id|master_ctl
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|opti82C924mpu_pnp
id|opti82C924mpu_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0xff
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|mpu_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;OPTi 82C924/C925/C931 MPU driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;PnP MPU&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mpu_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;UART401&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* MPU401 */
r_else
id|printk
(paren
l_string|&quot;Sound: PnP MPU device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* printk (&quot;MPU driver %d&bslash;n&quot;, mpu_driver); */
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|mpu_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|mpu_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|pnp_delay
(paren
l_int|1000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
(brace
id|printk
(paren
l_string|&quot;I/O %03x&bslash;n&quot;
comma
id|mpu_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mpu_base
op_logical_and
id|mpu_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|mpu_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|mpu_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|cs4236mpu_pnp
id|cs4236mpu_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0xff
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|mpu_driver
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card-&gt;key
op_eq
(paren
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;S&squot;
comma
l_char|&squot;C&squot;
comma
l_int|0x4232
)paren
)paren
)paren
multiline_comment|/* CS4232 */
r_return
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;CS4236 MPU driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;PnP MPU&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mpu_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;UART401&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* MPU401 */
r_else
id|printk
(paren
l_string|&quot;Sound: CS4236 PnP MPU device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* printk (&quot;MPU driver %d&bslash;n&quot;, mpu_driver); */
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|mpu_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|mpu_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|pnp_delay
(paren
l_int|1500000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
(brace
id|printk
(paren
l_string|&quot;I/O %03x&bslash;n&quot;
comma
id|mpu_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mpu_base
op_logical_and
id|mpu_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|mpu_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|mpu_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|soundscape_pnp
id|soundscape_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0xff
comma
id|irqmask
op_assign
l_int|0x03
comma
id|dmamask
op_assign
l_int|0x01
suffix:semicolon
r_int
id|sscape_driver
comma
id|wss_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Soundscape PnP driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;SoundScape PnP&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sscape_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;SSCAPE&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* MPU401 */
r_else
id|printk
(paren
l_string|&quot;Sound: Soundscape PnP device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* printk (&quot;Soundscape driver %d&bslash;n&quot;, sscape_driver); */
r_if
c_cond
(paren
(paren
id|wss_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;SSCAPEMSS&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: Soundscape codec device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|sscape_base
suffix:semicolon
r_int
id|irq
comma
id|irq2
comma
id|dma
comma
id|dma2
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|sscape_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|irq2
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|dma
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma2
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|pnp_delay
(paren
l_int|1000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
(brace
id|printk
(paren
l_string|&quot;I/O %03x&bslash;n&quot;
comma
id|sscape_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;IRQ2 %d&bslash;n&quot;
comma
id|irq2
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA %d&bslash;n&quot;
comma
id|dma
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA2 %d&bslash;n&quot;
comma
id|dma2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sscape_base
op_logical_and
id|sscape_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|sscape_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
id|dma
suffix:semicolon
id|hw_config.dma2
op_assign
id|dma2
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0x12345678
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|sscape_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sscape_base
op_logical_and
id|wss_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|sscape_base
op_plus
l_int|8
suffix:semicolon
multiline_comment|/* The codec base */
id|hw_config.irq
op_assign
id|irq2
suffix:semicolon
id|hw_config.dma
op_assign
id|dma
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|wss_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
id|ad1848_control
(paren
id|AD1848_SET_XTAL
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* 14.3 MHz is used */
)brace
)brace
)brace
r_void
DECL|function|soundscape_vivo
id|soundscape_vivo
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0x07
comma
id|irqmask
op_assign
l_int|0x03
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|mpu_driver
comma
id|wss_driver
comma
id|vivo_driver
suffix:semicolon
r_int
id|is_vivo_classic
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Soundscape VIVO driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card-&gt;key
op_eq
(paren
id|PNP_DEVID
(paren
l_char|&squot;E&squot;
comma
l_char|&squot;N&squot;
comma
l_char|&squot;S&squot;
comma
l_int|0x4080
)paren
)paren
)paren
id|is_vivo_classic
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;SoundScape VIVO&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mpu_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;UART401&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* MPU401 */
multiline_comment|/* printk (&quot;MPU driver %d&bslash;n&quot;, mpu_driver); */
r_if
c_cond
(paren
(paren
id|wss_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;AD1848&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x02
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: Soundscape codec device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vivo_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;VIVO&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x07
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: Soundscape VIVO/OTTO device detected but no driver installed&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|mpu_base
comma
id|mss_base
comma
id|otto_base
suffix:semicolon
r_int
id|irq
comma
id|irq2
comma
id|dma
comma
id|dma2
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|mpu_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|mss_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|otto_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|2
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|irq2
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|dma
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma2
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma2
op_eq
id|NO_DMA
)paren
id|dma2
op_assign
id|dma
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
(brace
id|printk
(paren
l_string|&quot;I/O %03x&bslash;n&quot;
comma
id|mpu_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;MSS I/O %03x&bslash;n&quot;
comma
id|mss_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;OTTO I/O %03x&bslash;n&quot;
comma
id|otto_base
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;IRQ2 %d&bslash;n&quot;
comma
id|irq2
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA %d&bslash;n&quot;
comma
id|dma
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DMA2 %d&bslash;n&quot;
comma
id|dma2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mss_base
op_logical_and
id|wss_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|mss_base
op_plus
l_int|4
suffix:semicolon
multiline_comment|/* The codec base */
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
id|dma
suffix:semicolon
id|hw_config.dma2
op_assign
id|dma2
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|wss_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|otto_base
op_logical_and
id|vivo_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|otto_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq2
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
id|mpu_base
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|vivo_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_vivo_classic
)paren
(brace
multiline_comment|/*&n;&t;       * The original VIVO uses XCTL0 pin of AD1845 as a synth (un)mute bit. Turn it&n;&t;       * on _after_ the synth is initialized. Btw, XCTL1 controls 30 dB mic boost&n;&t;       * circuit.&n;&t;       */
id|ad1848_control
(paren
id|AD1848_SET_XCTL0
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Unmute */
)brace
id|AD1848_REROUTE
(paren
id|SOUND_MIXER_LINE1
comma
id|SOUND_MIXER_SYNTH
)paren
suffix:semicolon
multiline_comment|/* AUX1 is OTTO input */
id|AD1848_REROUTE
(paren
id|SOUND_MIXER_LINE3
comma
id|SOUND_MIXER_LINE
)paren
suffix:semicolon
multiline_comment|/* Line in */
)brace
)brace
)brace
r_void
DECL|function|gus_pnp
id|gus_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0x00
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|gus_driver
comma
id|wss_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;GUS PnP driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;Ultrasound PnP&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|gus_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;GUSPNP&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x07
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: GUS PnP device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wss_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;AD1848&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* MAX */
r_else
id|printk
(paren
l_string|&quot;Sound: GUS PnP codec device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|gus_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
id|dma1
comma
id|dma2
suffix:semicolon
id|gus_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma1
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma2
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK (P%x I%d D%d d%d)&bslash;n&quot;
comma
id|gus_base
comma
id|irq
comma
id|dma1
comma
id|dma2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gus_base
op_logical_and
id|gus_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|gus_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
id|dma1
suffix:semicolon
id|hw_config.dma2
op_assign
(paren
id|dma2
op_eq
id|NO_DMA
)paren
ques
c_cond
id|dma1
suffix:colon
id|dma2
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|gus_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|sb_pnp
id|sb_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0x00
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|sb_driver
comma
id|mpu_driver
comma
id|opl3_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;SB PnP driver waking up&bslash;n&quot;
)paren
suffix:semicolon
id|pnp_delay
(paren
l_int|1000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;SoundBlaster PnP&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sb_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;SBPNP&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: SB PnP device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mpu_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;SBMPU&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x02
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: SB PnP device detected but SB MPU driver not enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opl3_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;OPL3&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x04
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: SB PnP device detected but OPL3 driver not enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|sb_base
comma
id|mpu_base
comma
id|opl3_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
id|dma1
comma
id|dma2
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|sb_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|mpu_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|opl3_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|2
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma1
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma2
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_base
op_logical_and
id|sb_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|sb_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
id|dma1
suffix:semicolon
id|hw_config.dma2
op_assign
(paren
id|dma2
op_eq
id|NO_DMA
)paren
ques
c_cond
id|dma1
suffix:colon
id|dma2
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|sb_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opl3_base
op_logical_and
id|opl3_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|opl3_base
suffix:semicolon
id|hw_config.irq
op_assign
l_int|0
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|opl3_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mpu_base
op_logical_and
id|mpu_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|mpu_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|mpu_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|als_pnp
id|als_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0x00
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|sb_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;ALS### PnP driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;SB16 clone&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sb_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;SBPNP&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: ALS PnP device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|sb_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
id|dma1
comma
id|dma2
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|sb_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma1
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|dma2
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_base
op_logical_and
id|sb_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|sb_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
id|dma1
suffix:semicolon
id|hw_config.dma2
op_assign
id|dma2
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|sb_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|als_pnp_mpu
id|als_pnp_mpu
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0x00
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|mpu_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;ALS### PnP MPU driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;SB16 clone&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mpu_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;UART401&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: ALS PnP device detected but no MPU driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|mpu_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|mpu_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpu_base
op_logical_and
id|mpu_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|mpu_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|mpu_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|als_pnp_opl
id|als_pnp_opl
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0x00
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|opl3_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;ALS### PnP OPL3 driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;SB16 clone&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opl3_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;OPL3&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: ALS PnP device detected but no OPL3 driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|opl3_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|opl3_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opl3_base
op_logical_and
id|opl3_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|opl3_base
suffix:semicolon
id|hw_config.irq
op_assign
l_int|0
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
id|sound_osp
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|opl3_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|ess_pnp
id|ess_pnp
(paren
r_void
op_star
id|parm
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
(paren
r_struct
id|pnp_dev
op_star
)paren
id|parm
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|portmask
op_assign
l_int|0x03
comma
id|irqmask
op_assign
l_int|0x01
comma
id|dmamask
op_assign
l_int|0x03
suffix:semicolon
r_int
id|sb_driver
comma
id|mpu_driver
comma
id|opl3_driver
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;ESS PnP driver waking up&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
(brace
id|printk
(paren
l_string|&quot;ESS1868: IRQB,IRQA = %x&bslash;n&quot;
comma
id|pnp_readreg
(paren
id|dev
comma
l_int|0x20
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;ESS1868: IRQD,IRQC = %x&bslash;n&quot;
comma
id|pnp_readreg
(paren
id|dev
comma
l_int|0x21
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;ESS1868: IRQF,IRQE = %x&bslash;n&quot;
comma
id|pnp_readreg
(paren
id|dev
comma
l_int|0x22
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;ESS1868: DRQB,DRQA = %x&bslash;n&quot;
comma
id|pnp_readreg
(paren
id|dev
comma
l_int|0x23
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;ESS1868: DRQD,DRQC = %x&bslash;n&quot;
comma
id|pnp_readreg
(paren
id|dev
comma
l_int|0x24
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;ESS1868: Configuration ROM Header 0 = %x&bslash;n&quot;
comma
id|pnp_readreg
(paren
id|dev
comma
l_int|0x25
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;ESS1868: Configuration ROM Header 1 = %x&bslash;n&quot;
comma
id|pnp_readreg
(paren
id|dev
comma
l_int|0x26
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;ESS1868: HW Volume IRQ = %x&bslash;n&quot;
comma
id|pnp_readreg
(paren
id|dev
comma
l_int|0x27
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;ESS1868: MPU401 IRQ = %x&bslash;n&quot;
comma
id|pnp_readreg
(paren
id|dev
comma
l_int|0x28
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pnp_readreg
(paren
id|dev
comma
l_int|0x27
)paren
op_amp
l_int|0x01
)paren
multiline_comment|/* MPU401 is at logical device #3 */
id|printk
(paren
l_string|&quot;Nonstandard ESS1868 implementation - contact support@4front-tech.com&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;card
op_logical_and
id|dev-&gt;card-&gt;name
)paren
id|name
op_assign
id|dev-&gt;card-&gt;name
suffix:semicolon
r_else
id|name
op_assign
l_string|&quot;ESS AudioDrive PnP&quot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sb_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;SBLAST&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x01
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: SB PnP device detected but no driver enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mpu_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;SBMPU&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x02
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: SB PnP device detected but SB MPU driver not enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opl3_driver
op_assign
id|sndtable_identify_card
(paren
l_string|&quot;OPL3&quot;
)paren
)paren
)paren
id|portmask
op_or_assign
l_int|0x04
suffix:semicolon
r_else
id|printk
(paren
l_string|&quot;Sound: SB PnP device detected but OPL3 driver not enabled&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|portmask
)paren
multiline_comment|/* No drivers available */
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnp_allocate_device
(paren
id|pnp_sig
comma
id|dev
comma
id|portmask
comma
id|irqmask
comma
id|dmamask
comma
l_int|0x00
)paren
)paren
id|printk
(paren
l_string|&quot;sound_pnp: Failed to find free resources&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|address_info
id|hw_config
suffix:semicolon
r_int
id|sb_base
comma
id|mpu_base
comma
id|opl3_base
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
id|dma1
comma
id|dma2
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;Device activation OK&bslash;n&quot;
)paren
suffix:semicolon
id|sb_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|opl3_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|mpu_base
op_assign
id|pnp_get_port
(paren
id|dev
comma
l_int|2
)paren
suffix:semicolon
id|irq
op_assign
id|pnp_get_irq
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dma1
op_assign
id|pnp_get_dma
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* dma2 = pnp_get_dma (dev, 1); */
id|dma2
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pnp_trace
)paren
(brace
id|printk
(paren
l_string|&quot;ESS PnP at %x/%x/%x, %d, %d/%d&bslash;n&quot;
comma
id|sb_base
comma
id|mpu_base
comma
id|opl3_base
comma
id|irq
comma
id|dma1
comma
id|dma2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sb_base
op_logical_and
id|sb_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|sb_base
suffix:semicolon
id|hw_config.irq
op_assign
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
id|dma1
suffix:semicolon
id|hw_config.dma2
op_assign
(paren
id|dma2
op_eq
id|NO_DMA
)paren
ques
c_cond
id|dma1
suffix:colon
id|dma2
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
id|name
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
l_int|NULL
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|sb_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opl3_base
op_logical_and
id|opl3_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|opl3_base
suffix:semicolon
id|hw_config.irq
op_assign
l_int|0
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
l_int|NULL
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|opl3_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mpu_base
op_logical_and
id|mpu_driver
)paren
(brace
id|hw_config.io_base
op_assign
id|mpu_base
suffix:semicolon
id|hw_config.irq
op_assign
op_minus
id|irq
suffix:semicolon
id|hw_config.dma
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config.always_detect
op_assign
l_int|0
suffix:semicolon
id|hw_config.name
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|hw_config.driver_use_1
op_assign
l_int|0
suffix:semicolon
id|hw_config.driver_use_2
op_assign
l_int|0
suffix:semicolon
id|hw_config.osp
op_assign
l_int|NULL
suffix:semicolon
id|hw_config.card_subtype
op_assign
l_int|0
suffix:semicolon
id|sndtable_start_card
(paren
id|mpu_driver
comma
op_amp
id|hw_config
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|variable|pnp_devs
r_static
r_struct
id|pnp_sounddev
id|pnp_devs
(braket
)braket
op_assign
(brace
(brace
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;S&squot;
comma
l_char|&squot;C&squot;
comma
l_int|0x0000
)paren
comma
id|cs4232_pnp
comma
l_string|&quot;CS4232&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;S&squot;
comma
l_char|&squot;C&squot;
comma
l_int|0x0003
)paren
comma
id|cs4236mpu_pnp
comma
l_string|&quot;CS4236MPU&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;G&squot;
comma
l_char|&squot;R&squot;
comma
l_char|&squot;V&squot;
comma
l_int|0x0000
)paren
comma
id|gus_pnp
comma
l_string|&quot;GUS&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;R&squot;
comma
l_char|&squot;V&squot;
comma
l_char|&squot;L&squot;
comma
l_int|0x0010
)paren
comma
id|gus_pnp
comma
l_string|&quot;WAVXTREME&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;A&squot;
comma
l_char|&squot;D&squot;
comma
l_char|&squot;V&squot;
comma
l_int|0x0010
)paren
comma
id|gus_pnp
comma
l_string|&quot;IWAVE&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;D&squot;
comma
l_char|&squot;X&squot;
comma
l_char|&squot;P&squot;
comma
l_int|0x0010
)paren
comma
id|gus_pnp
comma
l_string|&quot;IWAVE&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;Y&squot;
comma
l_char|&squot;M&squot;
comma
l_char|&squot;H&squot;
comma
l_int|0x0021
)paren
comma
id|opl3sa2_pnp
comma
l_string|&quot;OPL3SA2&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;O&squot;
comma
l_char|&squot;P&squot;
comma
l_char|&squot;T&squot;
comma
l_int|0x0000
)paren
comma
id|opti82C924_pnp
comma
l_string|&quot;82C924&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;O&squot;
comma
l_char|&squot;P&squot;
comma
l_char|&squot;T&squot;
comma
l_int|0x9250
)paren
comma
id|opti82C924_pnp
comma
l_string|&quot;82C925&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;O&squot;
comma
l_char|&squot;P&squot;
comma
l_char|&squot;T&squot;
comma
l_int|0x9310
)paren
comma
id|opti82C931_pnp
comma
l_string|&quot;82C931&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;O&squot;
comma
l_char|&squot;P&squot;
comma
l_char|&squot;T&squot;
comma
l_int|0x0002
)paren
comma
id|opti82C924mpu_pnp
comma
l_string|&quot;82C924MPU&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;E&squot;
comma
l_char|&squot;N&squot;
comma
l_char|&squot;S&squot;
comma
l_int|0x0000
)paren
comma
id|soundscape_pnp
comma
l_string|&quot;SSCAPE&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;N&squot;
comma
l_char|&squot;E&squot;
comma
l_char|&squot;C&squot;
comma
l_int|0x0000
)paren
comma
id|soundscape_pnp
comma
l_string|&quot;NEC&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;E&squot;
comma
l_char|&squot;N&squot;
comma
l_char|&squot;S&squot;
comma
l_int|0x1010
)paren
comma
id|soundscape_vivo
comma
l_string|&quot;SSCAPE&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;E&squot;
comma
l_char|&squot;N&squot;
comma
l_char|&squot;S&squot;
comma
l_int|0x1011
)paren
comma
id|soundscape_vivo
comma
l_string|&quot;SSCAPE&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;T&squot;
comma
l_char|&squot;L&squot;
comma
l_int|0x0031
)paren
comma
id|sb_pnp
comma
l_string|&quot;SB&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;T&squot;
comma
l_char|&squot;L&squot;
comma
l_int|0x0001
)paren
comma
id|sb_pnp
comma
l_string|&quot;SB&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;T&squot;
comma
l_char|&squot;L&squot;
comma
l_int|0x0041
)paren
comma
id|sb_pnp
comma
l_string|&quot;SB&quot;
)brace
comma
multiline_comment|/* SB32 (new revision) */
(brace
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;T&squot;
comma
l_char|&squot;L&squot;
comma
l_int|0x0042
)paren
comma
id|sb_pnp
comma
l_string|&quot;SB&quot;
)brace
comma
multiline_comment|/* SB64 */
(brace
id|PNP_DEVID
(paren
l_char|&squot;C&squot;
comma
l_char|&squot;T&squot;
comma
l_char|&squot;L&squot;
comma
l_int|0x0044
)paren
comma
id|sb_pnp
comma
l_string|&quot;SB&quot;
)brace
comma
multiline_comment|/* SB64 Gold */
(brace
id|PNP_DEVID
(paren
l_char|&squot;@&squot;
comma
l_char|&squot;@&squot;
comma
l_char|&squot;@&squot;
comma
l_int|0x0001
)paren
comma
id|als_pnp
comma
l_string|&quot;SB&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;@&squot;
comma
l_char|&squot;X&squot;
comma
l_char|&squot;@&squot;
comma
l_int|0x0001
)paren
comma
id|als_pnp_mpu
comma
l_string|&quot;SB&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;@&squot;
comma
l_char|&squot;H&squot;
comma
l_char|&squot;@&squot;
comma
l_int|0x0001
)paren
comma
id|als_pnp_opl
comma
l_string|&quot;SB&quot;
)brace
comma
(brace
id|PNP_DEVID
(paren
l_char|&squot;E&squot;
comma
l_char|&squot;S&squot;
comma
l_char|&squot;S&squot;
comma
l_int|0x1868
)paren
comma
id|ess_pnp
comma
l_string|&quot;ESS&quot;
)brace
)brace
suffix:semicolon
DECL|variable|nr_pnpdevs
r_static
r_int
id|nr_pnpdevs
op_assign
r_sizeof
(paren
id|pnp_devs
)paren
op_div
r_sizeof
(paren
r_struct
id|pnp_sounddev
)paren
suffix:semicolon
r_static
r_int
DECL|function|pnp_activate
id|pnp_activate
(paren
r_int
id|id
comma
r_struct
id|pnp_dev
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_pnpdevs
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|pnp_devs
(braket
id|i
)braket
dot
id|id
op_eq
id|id
)paren
(brace
r_if
c_cond
(paren
id|pnp_trace
)paren
id|printk
(paren
l_string|&quot;PnP dev: %08x, %s&bslash;n&quot;
comma
id|id
comma
id|pnp_devid2asc
(paren
id|id
)paren
)paren
suffix:semicolon
id|pnp_devs
(braket
id|i
)braket
dot
id|setup
(paren
(paren
r_void
op_star
)paren
id|dev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|cs423x_special
id|cs423x_special
(paren
r_struct
id|pnp_dev
op_star
id|dev
)paren
(brace
)brace
r_void
DECL|function|sound_pnp_init
id|sound_pnp_init
(paren
r_int
op_star
id|osp
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|pnp_sig
op_eq
l_int|0
)paren
id|init_pnp
(paren
l_int|0
comma
id|osp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pnp_sig
op_eq
l_int|0
)paren
r_if
c_cond
(paren
(paren
id|pnp_sig
op_assign
id|pnp_connect
(paren
l_string|&quot;sound&quot;
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
(paren
l_string|&quot;Sound: Can&squot;t connect to kernel PnP services.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * First handle some special configuration ports.&n; */
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|dev
op_assign
id|pnp_get_next_device
(paren
id|pnp_sig
comma
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|special_devices
(braket
id|i
)braket
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|special_devices
(braket
id|i
)braket
op_eq
id|dev-&gt;key
)paren
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
l_int|1
suffix:colon
id|cs423x_special
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Next disable some unused sound devices so that they don&squot;t consume&n; * valuable IRQ and DMA resources.&n; */
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|dev
op_assign
id|pnp_get_next_device
(paren
id|pnp_sig
comma
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|disabled_devices
(braket
id|i
)braket
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|disabled_devices
(braket
id|i
)braket
op_eq
id|dev-&gt;key
)paren
id|pnp_enable_device
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Disable it */
)brace
multiline_comment|/*&n; * Then initialize drivers for known PnP devices.&n; */
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|dev
op_assign
id|pnp_get_next_device
(paren
id|pnp_sig
comma
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pnp_activate
(paren
id|dev-&gt;key
comma
id|dev
)paren
)paren
(brace
multiline_comment|/* Scan all compatible devices */
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;ncompat
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|pnp_activate
(paren
id|dev-&gt;compat_keys
(braket
id|i
)braket
comma
id|dev
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|sound_pnp_disconnect
id|sound_pnp_disconnect
(paren
r_void
)paren
(brace
id|pnp_disconnect
(paren
id|pnp_sig
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
