multiline_comment|/*&n; *&t;drivers/sound/vidc.c&n; *&n; *&t;Detection routine for the VIDC.&n; *&n; *&t;Copyright (C) 1997 by Russell King &lt;rmk@arm.uk.linux.org&gt;&n; */
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &quot;sound_config.h&quot;
macro_line|#include &quot;vidc.h&quot;
DECL|variable|vidc_busy
r_int
id|vidc_busy
suffix:semicolon
DECL|function|vidc_update_filler
r_void
id|vidc_update_filler
c_func
(paren
r_int
id|bits
comma
r_int
id|channels
)paren
(brace
r_int
id|filltype
suffix:semicolon
id|filltype
op_assign
id|bits
op_plus
id|channels
suffix:semicolon
r_switch
c_cond
(paren
id|filltype
)paren
(brace
r_default
suffix:colon
r_case
l_int|9
suffix:colon
id|vidc_filler
op_assign
id|vidc_fill_1x8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|vidc_filler
op_assign
id|vidc_fill_2x8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|17
suffix:colon
id|vidc_filler
op_assign
id|vidc_fill_1x16
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|18
suffix:colon
id|vidc_filler
op_assign
id|vidc_fill_2x16
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|attach_vidc
r_void
id|attach_vidc
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
r_char
id|name
(braket
l_int|32
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;VIDC %d-bit sound&quot;
comma
id|hw_config-&gt;card_subtype
)paren
suffix:semicolon
id|conf_printf
c_func
(paren
id|name
comma
id|hw_config
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dma_buf
(braket
id|i
)braket
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
id|dma_pbuf
(braket
id|i
)braket
op_assign
id|virt_to_phys
c_func
(paren
id|dma_buf
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sound_alloc_dma
c_func
(paren
id|hw_config-&gt;dma
comma
l_string|&quot;VIDCsound&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;VIDCsound: can&squot;t allocate virtual DMA channel&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|hw_config-&gt;irq
comma
id|vidc_sound_dma_irq
comma
l_int|0
comma
l_string|&quot;VIDCsound&quot;
comma
l_int|NULL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;VIDCsound: can&squot;t allocate DMA interrupt&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|vidc_synth_init
c_func
(paren
id|hw_config
)paren
suffix:semicolon
id|vidc_audio_init
c_func
(paren
id|hw_config
)paren
suffix:semicolon
id|vidc_mixer_init
c_func
(paren
id|hw_config
)paren
suffix:semicolon
)brace
DECL|function|probe_vidc
r_int
id|probe_vidc
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|hw_config-&gt;irq
op_assign
id|IRQ_DMAS0
suffix:semicolon
id|hw_config-&gt;dma
op_assign
id|DMA_VIRTUAL_SOUND
suffix:semicolon
id|hw_config-&gt;dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|hw_config-&gt;card_subtype
op_assign
l_int|16
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|unload_vidc
r_void
id|unload_vidc
c_func
(paren
r_struct
id|address_info
op_star
id|hw_config
)paren
(brace
id|free_irq
c_func
(paren
id|hw_config-&gt;irq
comma
l_int|NULL
)paren
suffix:semicolon
id|sound_free_dma
c_func
(paren
id|hw_config-&gt;dma
)paren
suffix:semicolon
)brace
eof
