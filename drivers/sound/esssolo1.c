multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *      esssolo1.c  --  ESS Technology Solo1 (ES1946) audio driver.&n; *&n; *      Copyright (C) 1998-2000  Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *&n; *      This program is free software; you can redistribute it and/or modify&n; *      it under the terms of the GNU General Public License as published by&n; *      the Free Software Foundation; either version 2 of the License, or&n; *      (at your option) any later version.&n; *&n; *      This program is distributed in the hope that it will be useful,&n; *      but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *      GNU General Public License for more details.&n; *&n; *      You should have received a copy of the GNU General Public License&n; *      along with this program; if not, write to the Free Software&n; *      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * Module command line parameters:&n; *   none so far&n; *&n; *  Supported devices:&n; *  /dev/dsp    standard /dev/dsp device, (mostly) OSS compatible&n; *  /dev/mixer  standard /dev/mixer device, (mostly) OSS compatible&n; *  /dev/midi   simple MIDI UART interface, no ioctl&n; *&n; *  Revision history&n; *    10.11.1998   0.1   Initial release (without any hardware)&n; *    22.03.1999   0.2   cinfo.blocks should be reset after GETxPTR ioctl.&n; *                       reported by Johan Maes &lt;joma@telindus.be&gt;&n; *                       return EAGAIN instead of EBUSY when O_NONBLOCK&n; *                       read/write cannot be executed&n; *    07.04.1999   0.3   implemented the following ioctl&squot;s: SOUND_PCM_READ_RATE, &n; *                       SOUND_PCM_READ_CHANNELS, SOUND_PCM_READ_BITS; &n; *                       Alpha fixes reported by Peter Jones &lt;pjones@redhat.com&gt;&n; *    15.06.1999   0.4   Fix bad allocation bug.&n; *                       Thanks to Deti Fliegl &lt;fliegl@in.tum.de&gt;&n; *    28.06.1999   0.5   Add pci_set_master&n; *    12.08.1999   0.6   Fix MIDI UART crashing the driver&n; *                       Changed mixer semantics from OSS documented&n; *                       behaviour to OSS &quot;code behaviour&quot;.&n; *                       Recording might actually work now.&n; *                       The real DDMA controller address register is at PCI config&n; *                       0x60, while the register at 0x18 is used as a placeholder&n; *                       register for BIOS address allocation. This register&n; *                       is supposed to be copied into 0x60, according&n; *                       to the Solo1 datasheet. When I do that, I can access&n; *                       the DDMA registers except the mask bit, which&n; *                       is stuck at 1. When I copy the contents of 0x18 +0x10&n; *                       to the DDMA base register, everything seems to work.&n; *                       The fun part is that the Windows Solo1 driver doesn&squot;t&n; *                       seem to do these tricks.&n; *                       Bugs remaining: plops and clicks when starting/stopping playback&n; *    31.08.1999   0.7   add spin_lock_init&n; *                       replaced current-&gt;state = x with set_current_state(x)&n; *    03.09.1999   0.8   change read semantics for MIDI to match&n; *                       OSS more closely; remove possible wakeup race&n; *    07.10.1999   0.9   Fix initialization; complain if sequencer writes time out&n; *                       Revised resource grabbing for the FM synthesizer&n; *    28.10.1999   0.10  More waitqueue races fixed&n; *    09.12.1999   0.11  Work around stupid Alpha port issue (virt_to_bus(kmalloc(GFP_DMA)) &gt; 16M)&n; *                       Disabling recording on Alpha&n; *    12.01.2000   0.12  Prevent some ioctl&squot;s from returning bad count values on underrun/overrun;&n; *                       Tim Janik&squot;s BSE (Bedevilled Sound Engine) found this&n; *                       Integrated (aka redid 8-)) APM support patch by Zach Brown&n; *    07.02.2000   0.13  Use pci_alloc_consistent and pci_register_driver&n; *    19.02.2000   0.14  Use pci_dma_supported to determine if recording should be disabled&n; *    13.03.2000   0.15  Reintroduce initialization of a couple of PCI config space registers&n; *    21.11.2000   0.16  Initialize dma buffers in poll, otherwise poll may return a bogus mask&n; */
multiline_comment|/*****************************************************************************/
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/sound.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/wrapper.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/hardirq.h&gt;
macro_line|#include &quot;dm.h&quot;
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|OSS_DOCUMENTED_MIXER_SEMANTICS
macro_line|#undef OSS_DOCUMENTED_MIXER_SEMANTICS
multiline_comment|/* --------------------------------------------------------------------- */
macro_line|#ifndef PCI_VENDOR_ID_ESS
DECL|macro|PCI_VENDOR_ID_ESS
mdefine_line|#define PCI_VENDOR_ID_ESS         0x125d
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_ESS_SOLO1
DECL|macro|PCI_DEVICE_ID_ESS_SOLO1
mdefine_line|#define PCI_DEVICE_ID_ESS_SOLO1   0x1969
macro_line|#endif
DECL|macro|SOLO1_MAGIC
mdefine_line|#define SOLO1_MAGIC  ((PCI_VENDOR_ID_ESS&lt;&lt;16)|PCI_DEVICE_ID_ESS_SOLO1)
DECL|macro|DDMABASE_OFFSET
mdefine_line|#define DDMABASE_OFFSET           0    /* chip bug workaround kludge */
DECL|macro|DDMABASE_EXTENT
mdefine_line|#define DDMABASE_EXTENT           16
DECL|macro|IOBASE_EXTENT
mdefine_line|#define IOBASE_EXTENT             16
DECL|macro|SBBASE_EXTENT
mdefine_line|#define SBBASE_EXTENT             16
DECL|macro|VCBASE_EXTENT
mdefine_line|#define VCBASE_EXTENT             (DDMABASE_EXTENT+DDMABASE_OFFSET)
DECL|macro|MPUBASE_EXTENT
mdefine_line|#define MPUBASE_EXTENT            4
DECL|macro|GPBASE_EXTENT
mdefine_line|#define GPBASE_EXTENT             4
DECL|macro|FMSYNTH_EXTENT
mdefine_line|#define FMSYNTH_EXTENT            4
multiline_comment|/* MIDI buffer sizes */
DECL|macro|MIDIINBUF
mdefine_line|#define MIDIINBUF  256
DECL|macro|MIDIOUTBUF
mdefine_line|#define MIDIOUTBUF 256
DECL|macro|FMODE_MIDI_SHIFT
mdefine_line|#define FMODE_MIDI_SHIFT 3
DECL|macro|FMODE_MIDI_READ
mdefine_line|#define FMODE_MIDI_READ  (FMODE_READ &lt;&lt; FMODE_MIDI_SHIFT)
DECL|macro|FMODE_MIDI_WRITE
mdefine_line|#define FMODE_MIDI_WRITE (FMODE_WRITE &lt;&lt; FMODE_MIDI_SHIFT)
DECL|macro|FMODE_DMFM
mdefine_line|#define FMODE_DMFM 0x10
multiline_comment|/* --------------------------------------------------------------------- */
DECL|struct|solo1_state
r_struct
id|solo1_state
(brace
multiline_comment|/* magic */
DECL|member|magic
r_int
r_int
id|magic
suffix:semicolon
multiline_comment|/* list of esssolo1 devices */
DECL|member|devs
r_struct
id|list_head
id|devs
suffix:semicolon
multiline_comment|/* the corresponding pci_dev structure */
DECL|member|dev
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
multiline_comment|/* soundcore stuff */
DECL|member|dev_audio
r_int
id|dev_audio
suffix:semicolon
DECL|member|dev_mixer
r_int
id|dev_mixer
suffix:semicolon
DECL|member|dev_midi
r_int
id|dev_midi
suffix:semicolon
DECL|member|dev_dmfm
r_int
id|dev_dmfm
suffix:semicolon
multiline_comment|/* hardware resources */
DECL|member|iobase
DECL|member|sbbase
DECL|member|vcbase
DECL|member|ddmabase
DECL|member|mpubase
DECL|member|gpbase
r_int
r_int
id|iobase
comma
id|sbbase
comma
id|vcbase
comma
id|ddmabase
comma
id|mpubase
comma
id|gpbase
suffix:semicolon
multiline_comment|/* long for SPARC */
DECL|member|irq
r_int
r_int
id|irq
suffix:semicolon
multiline_comment|/* mixer registers */
r_struct
(brace
DECL|member|vol
r_int
r_int
id|vol
(braket
l_int|10
)braket
suffix:semicolon
DECL|member|recsrc
r_int
r_int
id|recsrc
suffix:semicolon
DECL|member|modcnt
r_int
r_int
id|modcnt
suffix:semicolon
DECL|member|micpreamp
r_int
r_int
id|micpreamp
suffix:semicolon
DECL|member|mix
)brace
id|mix
suffix:semicolon
multiline_comment|/* wave stuff */
DECL|member|fmt
r_int
id|fmt
suffix:semicolon
DECL|member|channels
r_int
id|channels
suffix:semicolon
DECL|member|rate
r_int
id|rate
suffix:semicolon
DECL|member|clkdiv
r_int
r_char
id|clkdiv
suffix:semicolon
DECL|member|ena
r_int
id|ena
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|open_sem
r_struct
id|semaphore
id|open_sem
suffix:semicolon
DECL|member|open_mode
id|mode_t
id|open_mode
suffix:semicolon
DECL|member|open_wait
id|wait_queue_head_t
id|open_wait
suffix:semicolon
DECL|struct|dmabuf
r_struct
id|dmabuf
(brace
DECL|member|rawbuf
r_void
op_star
id|rawbuf
suffix:semicolon
DECL|member|dmaaddr
id|dma_addr_t
id|dmaaddr
suffix:semicolon
DECL|member|buforder
r_int
id|buforder
suffix:semicolon
DECL|member|numfrag
r_int
id|numfrag
suffix:semicolon
DECL|member|fragshift
r_int
id|fragshift
suffix:semicolon
DECL|member|hwptr
DECL|member|swptr
r_int
id|hwptr
comma
id|swptr
suffix:semicolon
DECL|member|total_bytes
r_int
id|total_bytes
suffix:semicolon
DECL|member|count
r_int
id|count
suffix:semicolon
DECL|member|error
r_int
id|error
suffix:semicolon
multiline_comment|/* over/underrun */
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
multiline_comment|/* redundant, but makes calculations easier */
DECL|member|fragsize
r_int
id|fragsize
suffix:semicolon
DECL|member|dmasize
r_int
id|dmasize
suffix:semicolon
DECL|member|fragsamples
r_int
id|fragsamples
suffix:semicolon
multiline_comment|/* OSS stuff */
DECL|member|mapped
r_int
id|mapped
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ready
r_int
id|ready
suffix:colon
l_int|1
suffix:semicolon
DECL|member|endcleared
r_int
id|endcleared
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ossfragshift
r_int
id|ossfragshift
suffix:semicolon
DECL|member|ossmaxfrags
r_int
id|ossmaxfrags
suffix:semicolon
DECL|member|subdivision
r_int
id|subdivision
suffix:semicolon
DECL|member|dma_dac
DECL|member|dma_adc
)brace
id|dma_dac
comma
id|dma_adc
suffix:semicolon
multiline_comment|/* midi stuff */
r_struct
(brace
DECL|member|ird
DECL|member|iwr
DECL|member|icnt
r_int
id|ird
comma
id|iwr
comma
id|icnt
suffix:semicolon
DECL|member|ord
DECL|member|owr
DECL|member|ocnt
r_int
id|ord
comma
id|owr
comma
id|ocnt
suffix:semicolon
DECL|member|iwait
id|wait_queue_head_t
id|iwait
suffix:semicolon
DECL|member|owait
id|wait_queue_head_t
id|owait
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
DECL|member|ibuf
r_int
r_char
id|ibuf
(braket
id|MIDIINBUF
)braket
suffix:semicolon
DECL|member|obuf
r_int
r_char
id|obuf
(braket
id|MIDIOUTBUF
)braket
suffix:semicolon
DECL|member|midi
)brace
id|midi
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
r_static
id|LIST_HEAD
c_func
(paren
id|devs
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|write_seq
r_extern
r_inline
r_void
id|write_seq
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
comma
r_int
r_char
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* the __cli stunt is to send the data within the command window */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0xffff
suffix:semicolon
id|i
op_increment
)paren
(brace
id|__save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xc
)paren
op_amp
l_int|0x80
)paren
)paren
(brace
id|outb
c_func
(paren
id|data
comma
id|s-&gt;sbbase
op_plus
l_int|0xc
)paren
suffix:semicolon
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;esssolo1: write_seq timeout&bslash;n&quot;
)paren
suffix:semicolon
id|outb
c_func
(paren
id|data
comma
id|s-&gt;sbbase
op_plus
l_int|0xc
)paren
suffix:semicolon
)brace
DECL|function|read_seq
r_extern
r_inline
r_int
id|read_seq
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
comma
r_int
r_char
op_star
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0xffff
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xe
)paren
op_amp
l_int|0x80
)paren
(brace
op_star
id|data
op_assign
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xa
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;esssolo1: read_seq timeout&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|reset_ctrl
r_static
r_int
r_inline
id|reset_ctrl
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
id|outb
c_func
(paren
l_int|3
comma
id|s-&gt;sbbase
op_plus
l_int|6
)paren
suffix:semicolon
multiline_comment|/* clear sequencer and FIFO */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;sbbase
op_plus
l_int|6
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0xffff
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xe
)paren
op_amp
l_int|0x80
)paren
r_if
c_cond
(paren
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xa
)paren
op_eq
l_int|0xaa
)paren
(brace
id|write_seq
c_func
(paren
id|s
comma
l_int|0xc6
)paren
suffix:semicolon
multiline_comment|/* enter enhanced mode */
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|write_ctrl
r_static
r_void
id|write_ctrl
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|data
)paren
(brace
id|write_seq
c_func
(paren
id|s
comma
id|reg
)paren
suffix:semicolon
id|write_seq
c_func
(paren
id|s
comma
id|data
)paren
suffix:semicolon
)brace
macro_line|#if 0 /* unused */
r_static
r_int
r_char
id|read_ctrl
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
comma
r_int
r_char
id|reg
)paren
(brace
r_int
r_char
id|r
suffix:semicolon
id|write_seq
c_func
(paren
id|s
comma
l_int|0xc0
)paren
suffix:semicolon
id|write_seq
c_func
(paren
id|s
comma
id|reg
)paren
suffix:semicolon
id|read_seq
c_func
(paren
id|s
comma
op_amp
id|r
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
macro_line|#endif /* unused */
DECL|function|write_mixer
r_static
r_void
id|write_mixer
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|data
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|s-&gt;sbbase
op_plus
l_int|4
)paren
suffix:semicolon
id|outb
c_func
(paren
id|data
comma
id|s-&gt;sbbase
op_plus
l_int|5
)paren
suffix:semicolon
)brace
DECL|function|read_mixer
r_static
r_int
r_char
id|read_mixer
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
comma
r_int
r_char
id|reg
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|s-&gt;sbbase
op_plus
l_int|4
)paren
suffix:semicolon
r_return
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|5
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|ld2
r_extern
r_inline
r_int
id|ld2
c_func
(paren
r_int
r_int
id|x
)paren
(brace
r_int
id|r
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x
op_ge
l_int|0x10000
)paren
(brace
id|x
op_rshift_assign
l_int|16
suffix:semicolon
id|r
op_add_assign
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|0x100
)paren
(brace
id|x
op_rshift_assign
l_int|8
suffix:semicolon
id|r
op_add_assign
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|0x10
)paren
(brace
id|x
op_rshift_assign
l_int|4
suffix:semicolon
id|r
op_add_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|4
)paren
(brace
id|x
op_rshift_assign
l_int|2
suffix:semicolon
id|r
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_ge
l_int|2
)paren
id|r
op_increment
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|stop_dac
r_extern
r_inline
r_void
id|stop_dac
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;ena
op_and_assign
op_complement
id|FMODE_WRITE
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x78
comma
l_int|0x10
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|start_dac
r_static
r_void
id|start_dac
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;ena
op_amp
id|FMODE_WRITE
)paren
op_logical_and
(paren
id|s-&gt;dma_dac.mapped
op_logical_or
id|s-&gt;dma_dac.count
OG
l_int|0
)paren
op_logical_and
id|s-&gt;dma_dac.ready
)paren
(brace
id|s-&gt;ena
op_or_assign
id|FMODE_WRITE
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x78
comma
l_int|0x12
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x78
comma
l_int|0x13
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|stop_adc
r_extern
r_inline
r_void
id|stop_adc
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;ena
op_and_assign
op_complement
id|FMODE_READ
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xb8
comma
l_int|0xe
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|start_adc
r_static
r_void
id|start_adc
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;ena
op_amp
id|FMODE_READ
)paren
op_logical_and
(paren
id|s-&gt;dma_adc.mapped
op_logical_or
id|s-&gt;dma_adc.count
OL
(paren
r_int
)paren
(paren
id|s-&gt;dma_adc.dmasize
op_minus
l_int|2
op_star
id|s-&gt;dma_adc.fragsize
)paren
)paren
op_logical_and
id|s-&gt;dma_adc.ready
)paren
(brace
id|s-&gt;ena
op_or_assign
id|FMODE_READ
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xb8
comma
l_int|0xf
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: DMAbuffer: 0x%08lx&bslash;n&quot;
comma
(paren
r_int
)paren
id|s-&gt;dma_adc.rawbuf
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: DMA: mask: 0x%02x cnt: 0x%04x addr: 0x%08x  stat: 0x%02x&bslash;n&quot;
comma
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|0xf
)paren
comma
id|inw
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|4
)paren
comma
id|inl
c_func
(paren
id|s-&gt;ddmabase
)paren
comma
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|8
)paren
)paren
suffix:semicolon
macro_line|#endif
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;ddmabase
op_plus
l_int|0xd
)paren
suffix:semicolon
multiline_comment|/* master reset */
id|outb
c_func
(paren
l_int|1
comma
id|s-&gt;ddmabase
op_plus
l_int|0xf
)paren
suffix:semicolon
multiline_comment|/* mask */
id|outb
c_func
(paren
l_int|0x54
multiline_comment|/*0x14*/
comma
id|s-&gt;ddmabase
op_plus
l_int|0xb
)paren
suffix:semicolon
multiline_comment|/* DMA_MODE_READ | DMA_MODE_AUTOINIT */
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|s-&gt;dma_adc.rawbuf
)paren
comma
id|s-&gt;ddmabase
)paren
suffix:semicolon
id|outw
c_func
(paren
id|s-&gt;dma_adc.dmasize
op_minus
l_int|1
comma
id|s-&gt;ddmabase
op_plus
l_int|4
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;ddmabase
op_plus
l_int|0xf
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: start DMA: reg B8: 0x%02x  SBstat: 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;solo1: DMA: stat: 0x%02x  cnt: 0x%04x  mask: 0x%02x&bslash;n&quot;
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb8
)paren
comma
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xc
)paren
comma
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|8
)paren
comma
id|inw
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|4
)paren
comma
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|0xf
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: A1: 0x%02x  A2: 0x%02x  A4: 0x%02x  A5: 0x%02x  A8: 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;solo1: B1: 0x%02x  B2: 0x%02x  B4: 0x%02x  B7: 0x%02x  B8: 0x%02x  B9: 0x%02x&bslash;n&quot;
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa1
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa2
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa4
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa5
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa8
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb1
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb2
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb4
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb7
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb8
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb9
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|DMABUF_DEFAULTORDER
mdefine_line|#define DMABUF_DEFAULTORDER (15-PAGE_SHIFT)
DECL|macro|DMABUF_MINORDER
mdefine_line|#define DMABUF_MINORDER 1
DECL|function|dealloc_dmabuf
r_extern
r_inline
r_void
id|dealloc_dmabuf
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
comma
r_struct
id|dmabuf
op_star
id|db
)paren
(brace
r_struct
id|page
op_star
id|page
comma
op_star
id|pend
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;rawbuf
)paren
(brace
multiline_comment|/* undo marking the pages as reserved */
id|pend
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|page
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
)paren
suffix:semicolon
id|page
op_le
id|pend
suffix:semicolon
id|page
op_increment
)paren
id|mem_map_unreserve
c_func
(paren
id|page
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|s-&gt;dev
comma
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
comma
id|db-&gt;rawbuf
comma
id|db-&gt;dmaaddr
)paren
suffix:semicolon
)brace
id|db-&gt;rawbuf
op_assign
l_int|NULL
suffix:semicolon
id|db-&gt;mapped
op_assign
id|db-&gt;ready
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|prog_dmabuf
r_static
r_int
id|prog_dmabuf
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
comma
r_struct
id|dmabuf
op_star
id|db
)paren
(brace
r_int
id|order
suffix:semicolon
r_int
id|bytespersec
suffix:semicolon
r_int
id|bufs
comma
id|sample_shift
op_assign
l_int|0
suffix:semicolon
r_struct
id|page
op_star
id|page
comma
op_star
id|pend
suffix:semicolon
id|db-&gt;hwptr
op_assign
id|db-&gt;swptr
op_assign
id|db-&gt;total_bytes
op_assign
id|db-&gt;count
op_assign
id|db-&gt;error
op_assign
id|db-&gt;endcleared
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;rawbuf
)paren
(brace
id|db-&gt;ready
op_assign
id|db-&gt;mapped
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
id|DMABUF_DEFAULTORDER
suffix:semicolon
id|order
op_ge
id|DMABUF_MINORDER
suffix:semicolon
id|order
op_decrement
)paren
r_if
c_cond
(paren
(paren
id|db-&gt;rawbuf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|s-&gt;dev
comma
id|PAGE_SIZE
op_lshift
id|order
comma
op_amp
id|db-&gt;dmaaddr
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;rawbuf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|db-&gt;buforder
op_assign
id|order
suffix:semicolon
multiline_comment|/* now mark the pages as reserved; otherwise remap_page_range doesn&squot;t do what we want */
id|pend
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|page
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
)paren
suffix:semicolon
id|page
op_le
id|pend
suffix:semicolon
id|page
op_increment
)paren
id|mem_map_reserve
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;fmt
op_amp
(paren
id|AFMT_S16_LE
op_or
id|AFMT_U16_LE
)paren
)paren
id|sample_shift
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;channels
OG
l_int|1
)paren
id|sample_shift
op_increment
suffix:semicolon
id|bytespersec
op_assign
id|s-&gt;rate
op_lshift
id|sample_shift
suffix:semicolon
id|bufs
op_assign
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;ossfragshift
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|1000
op_lshift
id|db-&gt;ossfragshift
)paren
OL
id|bytespersec
)paren
id|db-&gt;fragshift
op_assign
id|ld2
c_func
(paren
id|bytespersec
op_div
l_int|1000
)paren
suffix:semicolon
r_else
id|db-&gt;fragshift
op_assign
id|db-&gt;ossfragshift
suffix:semicolon
)brace
r_else
(brace
id|db-&gt;fragshift
op_assign
id|ld2
c_func
(paren
id|bytespersec
op_div
l_int|100
op_div
(paren
id|db-&gt;subdivision
ques
c_cond
id|db-&gt;subdivision
suffix:colon
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;fragshift
OL
l_int|3
)paren
id|db-&gt;fragshift
op_assign
l_int|3
suffix:semicolon
)brace
id|db-&gt;numfrag
op_assign
id|bufs
op_rshift
id|db-&gt;fragshift
suffix:semicolon
r_while
c_loop
(paren
id|db-&gt;numfrag
template_param
l_int|3
)paren
(brace
id|db-&gt;fragshift
op_decrement
suffix:semicolon
id|db-&gt;numfrag
op_assign
id|bufs
op_rshift
id|db-&gt;fragshift
suffix:semicolon
)brace
id|db-&gt;fragsize
op_assign
l_int|1
op_lshift
id|db-&gt;fragshift
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;ossmaxfrags
op_ge
l_int|4
op_logical_and
id|db-&gt;ossmaxfrags
OL
id|db-&gt;numfrag
)paren
id|db-&gt;numfrag
op_assign
id|db-&gt;ossmaxfrags
suffix:semicolon
id|db-&gt;fragsamples
op_assign
id|db-&gt;fragsize
op_rshift
id|sample_shift
suffix:semicolon
id|db-&gt;dmasize
op_assign
id|db-&gt;numfrag
op_lshift
id|db-&gt;fragshift
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prog_dmabuf_adc
r_extern
r_inline
r_int
id|prog_dmabuf_adc
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_int
r_int
id|va
suffix:semicolon
r_int
id|c
suffix:semicolon
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
multiline_comment|/* check if PCI implementation supports 24bit busmaster DMA */
r_if
c_cond
(paren
id|s-&gt;dev-&gt;dma_mask
OG
l_int|0xffffff
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_adc
)paren
)paren
)paren
r_return
id|c
suffix:semicolon
id|va
op_assign
id|s-&gt;dma_adc.dmaaddr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|va
op_amp
op_complement
(paren
(paren
l_int|1
op_lshift
l_int|24
)paren
op_minus
l_int|1
)paren
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;solo1: buffer above 16M boundary&quot;
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;ddmabase
op_plus
l_int|0xd
)paren
suffix:semicolon
multiline_comment|/* clear */
id|outb
c_func
(paren
l_int|1
comma
id|s-&gt;ddmabase
op_plus
l_int|0xf
)paren
suffix:semicolon
multiline_comment|/* mask */
multiline_comment|/*outb(0, s-&gt;ddmabase+8);*/
multiline_comment|/* enable (enable is active low!) */
id|outb
c_func
(paren
l_int|0x54
comma
id|s-&gt;ddmabase
op_plus
l_int|0xb
)paren
suffix:semicolon
multiline_comment|/* DMA_MODE_READ | DMA_MODE_AUTOINIT */
id|outl
c_func
(paren
id|va
comma
id|s-&gt;ddmabase
)paren
suffix:semicolon
id|outw
c_func
(paren
id|s-&gt;dma_adc.dmasize
op_minus
l_int|1
comma
id|s-&gt;ddmabase
op_plus
l_int|4
)paren
suffix:semicolon
id|c
op_assign
op_minus
id|s-&gt;dma_adc.fragsamples
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xa4
comma
id|c
)paren
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xa5
comma
id|c
op_rshift
l_int|8
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;ddmabase
op_plus
l_int|0xf
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prog_dmabuf_dac
r_extern
r_inline
r_int
id|prog_dmabuf_dac
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_int
r_int
id|va
suffix:semicolon
r_int
id|c
suffix:semicolon
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_dac
)paren
)paren
)paren
r_return
id|c
suffix:semicolon
id|memset
c_func
(paren
id|s-&gt;dma_dac.rawbuf
comma
(paren
id|s-&gt;fmt
op_amp
(paren
id|AFMT_U8
op_or
id|AFMT_U16_LE
)paren
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|0x80
comma
id|s-&gt;dma_dac.dmasize
)paren
suffix:semicolon
multiline_comment|/* almost correct for U16 */
id|va
op_assign
id|s-&gt;dma_dac.dmaaddr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|va
op_xor
(paren
id|va
op_plus
id|s-&gt;dma_dac.dmasize
op_minus
l_int|1
)paren
)paren
op_amp
op_complement
(paren
(paren
l_int|1
op_lshift
l_int|20
)paren
op_minus
l_int|1
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;solo1: buffer crosses 1M boundary&quot;
)paren
suffix:semicolon
id|outl
c_func
(paren
id|va
comma
id|s-&gt;iobase
)paren
suffix:semicolon
multiline_comment|/* warning: s-&gt;dma_dac.dmasize &amp; 0xffff must not be zero! i.e. this limits us to a 32k buffer */
id|outw
c_func
(paren
id|s-&gt;dma_dac.dmasize
comma
id|s-&gt;iobase
op_plus
l_int|4
)paren
suffix:semicolon
id|c
op_assign
op_minus
id|s-&gt;dma_dac.fragsamples
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x74
comma
id|c
)paren
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x76
comma
id|c
op_rshift
l_int|8
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xa
comma
id|s-&gt;iobase
op_plus
l_int|6
)paren
suffix:semicolon
id|s-&gt;dma_dac.ready
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|clear_advance
r_extern
r_inline
r_void
id|clear_advance
c_func
(paren
r_void
op_star
id|buf
comma
r_int
id|bsize
comma
r_int
id|bptr
comma
r_int
id|len
comma
r_int
r_char
id|c
)paren
(brace
r_if
c_cond
(paren
id|bptr
op_plus
id|len
OG
id|bsize
)paren
(brace
r_int
id|x
op_assign
id|bsize
op_minus
id|bptr
suffix:semicolon
id|memset
c_func
(paren
(paren
(paren
r_char
op_star
)paren
id|buf
)paren
op_plus
id|bptr
comma
id|c
comma
id|x
)paren
suffix:semicolon
id|bptr
op_assign
l_int|0
suffix:semicolon
id|len
op_sub_assign
id|x
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
(paren
r_char
op_star
)paren
id|buf
)paren
op_plus
id|bptr
comma
id|c
comma
id|len
)paren
suffix:semicolon
)brace
multiline_comment|/* call with spinlock held! */
DECL|function|solo1_update_ptr
r_static
r_void
id|solo1_update_ptr
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_int
id|diff
suffix:semicolon
r_int
id|hwptr
suffix:semicolon
multiline_comment|/* update ADC pointer */
r_if
c_cond
(paren
id|s-&gt;ena
op_amp
id|FMODE_READ
)paren
(brace
id|hwptr
op_assign
(paren
id|s-&gt;dma_adc.dmasize
op_minus
l_int|1
op_minus
id|inw
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|4
)paren
)paren
op_mod
id|s-&gt;dma_adc.dmasize
suffix:semicolon
id|diff
op_assign
(paren
id|s-&gt;dma_adc.dmasize
op_plus
id|hwptr
op_minus
id|s-&gt;dma_adc.hwptr
)paren
op_mod
id|s-&gt;dma_adc.dmasize
suffix:semicolon
id|s-&gt;dma_adc.hwptr
op_assign
id|hwptr
suffix:semicolon
id|s-&gt;dma_adc.total_bytes
op_add_assign
id|diff
suffix:semicolon
id|s-&gt;dma_adc.count
op_add_assign
id|diff
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: rd: hwptr %u swptr %u dmasize %u count %u&bslash;n&quot;
comma
id|s-&gt;dma_adc.hwptr
comma
id|s-&gt;dma_adc.swptr
comma
id|s-&gt;dma_adc.dmasize
comma
id|s-&gt;dma_adc.count
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_adc.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
OG
(paren
r_int
)paren
(paren
id|s-&gt;dma_adc.dmasize
op_minus
(paren
(paren
l_int|3
op_star
id|s-&gt;dma_adc.fragsize
)paren
op_rshift
l_int|1
)paren
)paren
)paren
(brace
id|s-&gt;ena
op_and_assign
op_complement
id|FMODE_READ
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xb8
comma
l_int|0xe
)paren
suffix:semicolon
id|s-&gt;dma_adc.error
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
OG
l_int|0
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* update DAC pointer */
r_if
c_cond
(paren
id|s-&gt;ena
op_amp
id|FMODE_WRITE
)paren
(brace
id|hwptr
op_assign
(paren
id|s-&gt;dma_dac.dmasize
op_minus
id|inw
c_func
(paren
id|s-&gt;iobase
op_plus
l_int|4
)paren
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
id|diff
op_assign
(paren
id|s-&gt;dma_dac.dmasize
op_plus
id|hwptr
op_minus
id|s-&gt;dma_dac.hwptr
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
id|s-&gt;dma_dac.hwptr
op_assign
id|hwptr
suffix:semicolon
id|s-&gt;dma_dac.total_bytes
op_add_assign
id|diff
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: wr: hwptr %u swptr %u dmasize %u count %u&bslash;n&quot;
comma
id|s-&gt;dma_dac.hwptr
comma
id|s-&gt;dma_dac.swptr
comma
id|s-&gt;dma_dac.dmasize
comma
id|s-&gt;dma_dac.count
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
(brace
id|s-&gt;dma_dac.count
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
)paren
suffix:semicolon
)brace
r_else
(brace
id|s-&gt;dma_dac.count
op_sub_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_le
l_int|0
)paren
(brace
id|s-&gt;ena
op_and_assign
op_complement
id|FMODE_WRITE
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x78
comma
l_int|0x12
)paren
suffix:semicolon
id|s-&gt;dma_dac.error
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_le
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
op_logical_and
op_logical_neg
id|s-&gt;dma_dac.endcleared
)paren
(brace
id|clear_advance
c_func
(paren
id|s-&gt;dma_dac.rawbuf
comma
id|s-&gt;dma_dac.dmasize
comma
id|s-&gt;dma_dac.swptr
comma
id|s-&gt;dma_dac.fragsize
comma
(paren
id|s-&gt;fmt
op_amp
(paren
id|AFMT_U8
op_or
id|AFMT_U16_LE
)paren
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|0x80
)paren
suffix:semicolon
id|s-&gt;dma_dac.endcleared
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
OL
(paren
r_int
)paren
id|s-&gt;dma_dac.dmasize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|prog_codec
r_static
r_void
id|prog_codec
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|fdiv
comma
id|filter
suffix:semicolon
r_int
r_char
id|c
suffix:semicolon
id|reset_ctrl
c_func
(paren
id|s
)paren
suffix:semicolon
id|write_seq
c_func
(paren
id|s
comma
l_int|0xd3
)paren
suffix:semicolon
multiline_comment|/* program sampling rates */
id|filter
op_assign
id|s-&gt;rate
op_star
l_int|9
op_div
l_int|20
suffix:semicolon
multiline_comment|/* Set filter roll-off to 90% of rate/2 */
id|fdiv
op_assign
l_int|256
op_minus
l_int|7160000
op_div
(paren
id|filter
op_star
l_int|82
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xa1
comma
id|s-&gt;clkdiv
)paren
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xa2
comma
id|fdiv
)paren
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x70
comma
id|s-&gt;clkdiv
)paren
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x72
comma
id|fdiv
)paren
suffix:semicolon
multiline_comment|/* program ADC parameters */
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xb8
comma
l_int|0xe
)paren
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xb9
comma
multiline_comment|/*0x1*/
l_int|0
)paren
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xa8
comma
(paren
id|s-&gt;channels
OG
l_int|1
)paren
ques
c_cond
l_int|0x11
suffix:colon
l_int|0x12
)paren
suffix:semicolon
id|c
op_assign
l_int|0xd0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;fmt
op_amp
(paren
id|AFMT_S16_LE
op_or
id|AFMT_U16_LE
)paren
)paren
id|c
op_or_assign
l_int|0x04
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;fmt
op_amp
(paren
id|AFMT_S16_LE
op_or
id|AFMT_S8
)paren
)paren
id|c
op_or_assign
l_int|0x20
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;channels
OG
l_int|1
)paren
id|c
op_xor_assign
l_int|0x48
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xb7
comma
(paren
id|c
op_amp
l_int|0x70
)paren
op_or
l_int|1
)paren
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xb7
comma
id|c
)paren
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xb1
comma
l_int|0x50
)paren
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xb2
comma
l_int|0x50
)paren
suffix:semicolon
multiline_comment|/* program DAC parameters */
id|c
op_assign
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;fmt
op_amp
(paren
id|AFMT_S16_LE
op_or
id|AFMT_U16_LE
)paren
)paren
id|c
op_or_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;fmt
op_amp
(paren
id|AFMT_S16_LE
op_or
id|AFMT_S8
)paren
)paren
id|c
op_or_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;channels
OG
l_int|1
)paren
id|c
op_or_assign
l_int|2
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x7a
comma
id|c
)paren
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x78
comma
l_int|0x10
)paren
suffix:semicolon
id|s-&gt;ena
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|invalid_magic
r_static
r_const
r_char
id|invalid_magic
(braket
)braket
op_assign
id|KERN_CRIT
l_string|&quot;solo1: invalid magic value&bslash;n&quot;
suffix:semicolon
DECL|macro|VALIDATE_STATE
mdefine_line|#define VALIDATE_STATE(s)                         &bslash;&n;({                                                &bslash;&n;&t;if (!(s) || (s)-&gt;magic != SOLO1_MAGIC) { &bslash;&n;&t;&t;printk(invalid_magic);            &bslash;&n;&t;&t;return -ENXIO;                    &bslash;&n;&t;}                                         &bslash;&n;})
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|mixer_ioctl
r_static
r_int
id|mixer_ioctl
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_static
r_const
r_int
r_int
id|mixer_src
(braket
l_int|8
)braket
op_assign
(brace
id|SOUND_MASK_MIC
comma
id|SOUND_MASK_MIC
comma
id|SOUND_MASK_CD
comma
id|SOUND_MASK_VOLUME
comma
id|SOUND_MASK_MIC
comma
l_int|0
comma
id|SOUND_MASK_LINE
comma
l_int|0
)brace
suffix:semicolon
r_static
r_const
r_int
r_char
id|mixtable1
(braket
id|SOUND_MIXER_NRDEVICES
)braket
op_assign
(brace
(braket
id|SOUND_MIXER_PCM
)braket
op_assign
l_int|1
comma
multiline_comment|/* voice */
(braket
id|SOUND_MIXER_SYNTH
)braket
op_assign
l_int|2
comma
multiline_comment|/* FM */
(braket
id|SOUND_MIXER_CD
)braket
op_assign
l_int|3
comma
multiline_comment|/* CD */
(braket
id|SOUND_MIXER_LINE
)braket
op_assign
l_int|4
comma
multiline_comment|/* Line */
(braket
id|SOUND_MIXER_LINE1
)braket
op_assign
l_int|5
comma
multiline_comment|/* AUX */
(braket
id|SOUND_MIXER_MIC
)braket
op_assign
l_int|6
comma
multiline_comment|/* Mic */
(braket
id|SOUND_MIXER_LINE2
)braket
op_assign
l_int|7
comma
multiline_comment|/* Mono in */
(braket
id|SOUND_MIXER_SPEAKER
)braket
op_assign
l_int|8
comma
multiline_comment|/* Speaker */
(braket
id|SOUND_MIXER_RECLEV
)braket
op_assign
l_int|9
comma
multiline_comment|/* Recording level */
(braket
id|SOUND_MIXER_VOLUME
)braket
op_assign
l_int|10
multiline_comment|/* Master Volume */
)brace
suffix:semicolon
r_static
r_const
r_int
r_char
id|mixreg
(braket
)braket
op_assign
(brace
l_int|0x7c
comma
multiline_comment|/* voice */
l_int|0x36
comma
multiline_comment|/* FM */
l_int|0x38
comma
multiline_comment|/* CD */
l_int|0x3e
comma
multiline_comment|/* Line */
l_int|0x3a
comma
multiline_comment|/* AUX */
l_int|0x1a
comma
multiline_comment|/* Mic */
l_int|0x6d
multiline_comment|/* Mono in */
)brace
suffix:semicolon
r_int
r_char
id|l
comma
id|r
comma
id|rl
comma
id|rr
comma
id|vidx
suffix:semicolon
r_int
id|i
comma
id|val
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_PRIVATE1
)paren
(brace
multiline_comment|/* enable/disable/query mixer preamp */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
op_minus
l_int|1
)paren
(brace
id|val
op_assign
id|val
ques
c_cond
l_int|0xff
suffix:colon
l_int|0xf7
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x7d
comma
(paren
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x7d
)paren
op_or
l_int|0x08
)paren
op_amp
id|val
)paren
suffix:semicolon
)brace
id|val
op_assign
(paren
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x7d
)paren
op_amp
l_int|0x08
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_PRIVATE2
)paren
(brace
multiline_comment|/* enable/disable/query spatializer */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
op_minus
l_int|1
)paren
(brace
id|val
op_and_assign
l_int|0x3f
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x52
comma
id|val
)paren
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x50
comma
id|val
ques
c_cond
l_int|0x08
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x52
)paren
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_INFO
)paren
(brace
id|mixer_info
id|info
suffix:semicolon
id|strncpy
c_func
(paren
id|info.id
comma
l_string|&quot;Solo1&quot;
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|info.name
comma
l_string|&quot;ESS Solo1&quot;
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
id|info.modify_counter
op_assign
id|s-&gt;mix.modcnt
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_OLD_MIXER_INFO
)paren
(brace
id|_old_mixer_info
id|info
suffix:semicolon
id|strncpy
c_func
(paren
id|info.id
comma
l_string|&quot;Solo1&quot;
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|info.name
comma
l_string|&quot;ESS Solo1&quot;
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|OSS_GETVERSION
)paren
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_IOC_TYPE
c_func
(paren
id|cmd
)paren
op_ne
l_char|&squot;M&squot;
op_logical_or
id|_SIOC_SIZE
c_func
(paren
id|cmd
)paren
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_eq
id|_SIOC_READ
)paren
(brace
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
r_return
id|put_user
c_func
(paren
id|mixer_src
(braket
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x1c
)paren
op_amp
l_int|7
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported device */
r_return
id|put_user
c_func
(paren
id|SOUND_MASK_PCM
op_or
id|SOUND_MASK_SYNTH
op_or
id|SOUND_MASK_CD
op_or
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_LINE1
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_LINE2
op_or
id|SOUND_MASK_RECLEV
op_or
id|SOUND_MASK_SPEAKER
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported recording source */
r_return
id|put_user
c_func
(paren
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_CD
op_or
id|SOUND_MASK_VOLUME
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
multiline_comment|/* Mixer channels supporting stereo */
r_return
id|put_user
c_func
(paren
id|SOUND_MASK_PCM
op_or
id|SOUND_MASK_SYNTH
op_or
id|SOUND_MASK_CD
op_or
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_LINE1
op_or
id|SOUND_MASK_MIC
op_or
id|SOUND_MASK_VOLUME
op_or
id|SOUND_MASK_LINE2
op_or
id|SOUND_MASK_RECLEV
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
r_return
id|put_user
c_func
(paren
id|SOUND_CAP_EXCL_INPUT
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|SOUND_MIXER_NRDEVICES
op_logical_or
op_logical_neg
(paren
id|vidx
op_assign
id|mixtable1
(braket
id|i
)braket
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
id|vidx
op_minus
l_int|1
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_ne
(paren
id|_SIOC_READ
op_or
id|_SIOC_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s-&gt;mix.modcnt
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
macro_line|#if 0
(brace
r_static
r_const
r_int
r_char
id|regs
(braket
)braket
op_assign
(brace
l_int|0x1c
comma
l_int|0x1a
comma
l_int|0x36
comma
l_int|0x38
comma
l_int|0x3a
comma
l_int|0x3c
comma
l_int|0x3e
comma
l_int|0x60
comma
l_int|0x62
comma
l_int|0x6d
comma
l_int|0x7c
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|regs
)paren
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: mixer reg 0x%02x: 0x%02x&bslash;n&quot;
comma
id|regs
(braket
id|i
)braket
comma
id|read_mixer
c_func
(paren
id|s
comma
id|regs
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: ctrl reg 0x%02x: 0x%02x&bslash;n&quot;
comma
l_int|0xb4
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb4
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|i
op_assign
id|hweight32
c_func
(paren
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|i
OG
l_int|1
)paren
id|val
op_and_assign
op_complement
id|mixer_src
(braket
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x1c
)paren
op_amp
l_int|7
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|mixer_src
(braket
id|i
)braket
op_amp
id|val
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OG
l_int|7
)paren
r_return
l_int|0
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x1c
comma
id|i
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_VOLUME
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|l
op_assign
id|val
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|100
)paren
id|l
op_assign
l_int|100
suffix:semicolon
id|r
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|r
OG
l_int|100
)paren
id|r
op_assign
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|l
OL
l_int|6
)paren
(brace
id|rl
op_assign
l_int|0x40
suffix:semicolon
id|l
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|rl
op_assign
(paren
id|l
op_star
l_int|2
op_minus
l_int|11
)paren
op_div
l_int|3
suffix:semicolon
id|l
op_assign
(paren
id|rl
op_star
l_int|3
op_plus
l_int|11
)paren
op_div
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r
OL
l_int|6
)paren
(brace
id|rr
op_assign
l_int|0x40
suffix:semicolon
id|r
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|rr
op_assign
(paren
id|r
op_star
l_int|2
op_minus
l_int|11
)paren
op_div
l_int|3
suffix:semicolon
id|r
op_assign
(paren
id|rr
op_star
l_int|3
op_plus
l_int|11
)paren
op_div
l_int|2
suffix:semicolon
)brace
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x60
comma
id|rl
)paren
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x62
comma
id|rr
)paren
suffix:semicolon
macro_line|#ifdef OSS_DOCUMENTED_MIXER_SEMANTICS
id|s-&gt;mix.vol
(braket
l_int|9
)braket
op_assign
(paren
(paren
r_int
r_int
)paren
id|r
op_lshift
l_int|8
)paren
op_or
id|l
suffix:semicolon
macro_line|#else
id|s-&gt;mix.vol
(braket
l_int|9
)braket
op_assign
id|val
suffix:semicolon
macro_line|#endif
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
l_int|9
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_SPEAKER
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|l
op_assign
id|val
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|100
)paren
id|l
op_assign
l_int|100
suffix:semicolon
r_else
r_if
c_cond
(paren
id|l
OL
l_int|2
)paren
id|l
op_assign
l_int|2
suffix:semicolon
id|rl
op_assign
(paren
id|l
op_minus
l_int|2
)paren
op_div
l_int|14
suffix:semicolon
id|l
op_assign
id|rl
op_star
l_int|14
op_plus
l_int|2
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x3c
comma
id|rl
)paren
suffix:semicolon
macro_line|#ifdef OSS_DOCUMENTED_MIXER_SEMANTICS
id|s-&gt;mix.vol
(braket
l_int|7
)braket
op_assign
id|l
op_star
l_int|0x101
suffix:semicolon
macro_line|#else
id|s-&gt;mix.vol
(braket
l_int|7
)braket
op_assign
id|val
suffix:semicolon
macro_line|#endif
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
l_int|7
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_RECLEV
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|l
op_assign
(paren
id|val
op_lshift
l_int|1
)paren
op_amp
l_int|0x1fe
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|200
)paren
id|l
op_assign
l_int|200
suffix:semicolon
r_else
r_if
c_cond
(paren
id|l
OL
l_int|5
)paren
id|l
op_assign
l_int|5
suffix:semicolon
id|r
op_assign
(paren
id|val
op_rshift
l_int|7
)paren
op_amp
l_int|0x1fe
suffix:semicolon
r_if
c_cond
(paren
id|r
OG
l_int|200
)paren
id|r
op_assign
l_int|200
suffix:semicolon
r_else
r_if
c_cond
(paren
id|r
OL
l_int|5
)paren
id|r
op_assign
l_int|5
suffix:semicolon
id|rl
op_assign
(paren
id|l
op_minus
l_int|5
)paren
op_div
l_int|13
suffix:semicolon
id|rr
op_assign
(paren
id|r
op_minus
l_int|5
)paren
op_div
l_int|13
suffix:semicolon
id|r
op_assign
(paren
id|rl
op_star
l_int|13
op_plus
l_int|5
)paren
op_div
l_int|2
suffix:semicolon
id|l
op_assign
(paren
id|rr
op_star
l_int|13
op_plus
l_int|5
)paren
op_div
l_int|2
suffix:semicolon
id|write_ctrl
c_func
(paren
id|s
comma
l_int|0xb4
comma
(paren
id|rl
op_lshift
l_int|4
)paren
op_or
id|rr
)paren
suffix:semicolon
macro_line|#ifdef OSS_DOCUMENTED_MIXER_SEMANTICS
id|s-&gt;mix.vol
(braket
l_int|8
)braket
op_assign
(paren
(paren
r_int
r_int
)paren
id|r
op_lshift
l_int|8
)paren
op_or
id|l
suffix:semicolon
macro_line|#else
id|s-&gt;mix.vol
(braket
l_int|8
)braket
op_assign
id|val
suffix:semicolon
macro_line|#endif
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
l_int|8
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|SOUND_MIXER_NRDEVICES
op_logical_or
op_logical_neg
(paren
id|vidx
op_assign
id|mixtable1
(braket
id|i
)braket
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|l
op_assign
(paren
id|val
op_lshift
l_int|1
)paren
op_amp
l_int|0x1fe
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|200
)paren
id|l
op_assign
l_int|200
suffix:semicolon
r_else
r_if
c_cond
(paren
id|l
OL
l_int|5
)paren
id|l
op_assign
l_int|5
suffix:semicolon
id|r
op_assign
(paren
id|val
op_rshift
l_int|7
)paren
op_amp
l_int|0x1fe
suffix:semicolon
r_if
c_cond
(paren
id|r
OG
l_int|200
)paren
id|r
op_assign
l_int|200
suffix:semicolon
r_else
r_if
c_cond
(paren
id|r
OL
l_int|5
)paren
id|r
op_assign
l_int|5
suffix:semicolon
id|rl
op_assign
(paren
id|l
op_minus
l_int|5
)paren
op_div
l_int|13
suffix:semicolon
id|rr
op_assign
(paren
id|r
op_minus
l_int|5
)paren
op_div
l_int|13
suffix:semicolon
id|r
op_assign
(paren
id|rl
op_star
l_int|13
op_plus
l_int|5
)paren
op_div
l_int|2
suffix:semicolon
id|l
op_assign
(paren
id|rr
op_star
l_int|13
op_plus
l_int|5
)paren
op_div
l_int|2
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
id|mixreg
(braket
id|vidx
op_minus
l_int|1
)braket
comma
(paren
id|rl
op_lshift
l_int|4
)paren
op_or
id|rr
)paren
suffix:semicolon
macro_line|#ifdef OSS_DOCUMENTED_MIXER_SEMANTICS
id|s-&gt;mix.vol
(braket
id|vidx
op_minus
l_int|1
)braket
op_assign
(paren
(paren
r_int
r_int
)paren
id|r
op_lshift
l_int|8
)paren
op_or
id|l
suffix:semicolon
macro_line|#else
id|s-&gt;mix.vol
(braket
id|vidx
op_minus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
macro_line|#endif
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
id|vidx
op_minus
l_int|1
)braket
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|solo1_llseek
r_static
id|loff_t
id|solo1_llseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|loff_t
id|offset
comma
r_int
id|origin
)paren
(brace
r_return
op_minus
id|ESPIPE
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|solo1_open_mixdev
r_static
r_int
id|solo1_open_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|solo1_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|solo1_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dev_mixer
op_eq
id|minor
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|solo1_release_mixdev
r_static
r_int
id|solo1_release_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|solo1_ioctl_mixdev
r_static
r_int
id|solo1_ioctl_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|mixer_ioctl
c_func
(paren
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|variable|solo1_mixer_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|solo1_mixer_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|solo1_llseek
comma
id|ioctl
suffix:colon
id|solo1_ioctl_mixdev
comma
id|open
suffix:colon
id|solo1_open_mixdev
comma
id|release
suffix:colon
id|solo1_release_mixdev
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|drain_dac
r_static
r_int
id|drain_dac
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
comma
r_int
id|nonblock
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
suffix:semicolon
r_int
id|tmo
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
r_return
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|nonblock
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|tmo
op_assign
l_int|3
op_star
id|HZ
op_star
(paren
id|count
op_plus
id|s-&gt;dma_dac.fragsize
)paren
op_div
l_int|2
op_div
id|s-&gt;rate
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;fmt
op_amp
(paren
id|AFMT_S16_LE
op_or
id|AFMT_U16_LE
)paren
)paren
id|tmo
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;channels
OG
l_int|1
)paren
id|tmo
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|tmo
op_plus
l_int|1
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: dma timed out??&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|solo1_read
r_static
id|ssize_t
id|solo1_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|swptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|swptr
op_assign
id|s-&gt;dma_adc.swptr
suffix:semicolon
id|cnt
op_assign
id|s-&gt;dma_adc.dmasize
op_minus
id|swptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
OL
id|cnt
)paren
id|cnt
op_assign
id|s-&gt;dma_adc.count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
macro_line|#ifdef DEBUGREC
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1_read: reg B8: 0x%02x  DMAstat: 0x%02x  DMAcnt: 0x%04x  SBstat: 0x%02x  cnt: %u&bslash;n&quot;
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb8
)paren
comma
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|8
)paren
comma
id|inw
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|4
)paren
comma
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xc
)paren
comma
id|cnt
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
macro_line|#ifdef DEBUGREC
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1_read: regs: A1: 0x%02x  A2: 0x%02x  A4: 0x%02x  A5: 0x%02x  A8: 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;solo1_read: regs: B1: 0x%02x  B2: 0x%02x  B7: 0x%02x  B8: 0x%02x  B9: 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;solo1_read: DMA: addr: 0x%08x cnt: 0x%04x stat: 0x%02x mask: 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;solo1_read: SBstat: 0x%02x  cnt: %u&bslash;n&quot;
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa1
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa2
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa4
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa5
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa8
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb1
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb2
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb7
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb8
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb9
)paren
comma
id|inl
c_func
(paren
id|s-&gt;ddmabase
)paren
comma
id|inw
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|4
)paren
comma
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|8
)paren
comma
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|15
)paren
comma
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xc
)paren
comma
id|cnt
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|15
)paren
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;solo1: cannot start recording, DDMA mask bit stuck at 1&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef DEBUGREC
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1_read: regs: A1: 0x%02x  A2: 0x%02x  A4: 0x%02x  A5: 0x%02x  A8: 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;solo1_read: regs: B1: 0x%02x  B2: 0x%02x  B7: 0x%02x  B8: 0x%02x  B9: 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;solo1_read: DMA: addr: 0x%08x cnt: 0x%04x stat: 0x%02x mask: 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;solo1_read: SBstat: 0x%02x  cnt: %u&bslash;n&quot;
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa1
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa2
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa4
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa5
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xa8
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb1
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb2
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb7
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb8
)paren
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb9
)paren
comma
id|inl
c_func
(paren
id|s-&gt;ddmabase
)paren
comma
id|inw
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|4
)paren
comma
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|8
)paren
comma
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|15
)paren
comma
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xc
)paren
comma
id|cnt
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|s-&gt;dma_adc.rawbuf
op_plus
id|swptr
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_adc.dmasize
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;dma_adc.swptr
op_assign
id|swptr
suffix:semicolon
id|s-&gt;dma_adc.count
op_sub_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
macro_line|#ifdef DEBUGREC
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1_read: reg B8: 0x%02x  DMAstat: 0x%02x  DMAcnt: 0x%04x  SBstat: 0x%02x&bslash;n&quot;
comma
id|read_ctrl
c_func
(paren
id|s
comma
l_int|0xb8
)paren
comma
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|8
)paren
comma
id|inw
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|4
)paren
comma
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solo1_write
r_static
id|ssize_t
id|solo1_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|swptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1_write: reg 70: 0x%02x  71: 0x%02x  72: 0x%02x  74: 0x%02x  76: 0x%02x  78: 0x%02x  7A: 0x%02x&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;solo1_write: DMA: addr: 0x%08x  cnt: 0x%04x  stat: 0x%02x  SBstat: 0x%02x&bslash;n&quot;
comma
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x70
)paren
comma
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x71
)paren
comma
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x72
)paren
comma
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x74
)paren
comma
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x76
)paren
comma
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x78
)paren
comma
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x7a
)paren
comma
id|inl
c_func
(paren
id|s-&gt;iobase
)paren
comma
id|inw
c_func
(paren
id|s-&gt;iobase
op_plus
l_int|4
)paren
comma
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
l_int|6
)paren
comma
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1_write: reg 78: 0x%02x  reg 7A: 0x%02x  DMAcnt: 0x%04x  DMAstat: 0x%02x  SBstat: 0x%02x&bslash;n&quot;
comma
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x78
)paren
comma
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x7a
)paren
comma
id|inw
c_func
(paren
id|s-&gt;iobase
op_plus
l_int|4
)paren
comma
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
l_int|6
)paren
comma
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
macro_line|#endif
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
OL
l_int|0
)paren
(brace
id|s-&gt;dma_dac.count
op_assign
l_int|0
suffix:semicolon
id|s-&gt;dma_dac.swptr
op_assign
id|s-&gt;dma_dac.hwptr
suffix:semicolon
)brace
id|swptr
op_assign
id|s-&gt;dma_dac.swptr
suffix:semicolon
id|cnt
op_assign
id|s-&gt;dma_dac.dmasize
op_minus
id|swptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_plus
id|cnt
OG
id|s-&gt;dma_dac.dmasize
)paren
id|cnt
op_assign
id|s-&gt;dma_dac.dmasize
op_minus
id|s-&gt;dma_dac.count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
id|start_dac
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|s-&gt;dma_dac.rawbuf
op_plus
id|swptr
comma
id|buffer
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;dma_dac.swptr
op_assign
id|swptr
suffix:semicolon
id|s-&gt;dma_dac.count
op_add_assign
id|cnt
suffix:semicolon
id|s-&gt;dma_dac.endcleared
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
id|start_dac
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* No kernel lock - we have our own spinlock */
DECL|function|solo1_poll
r_static
r_int
r_int
id|solo1_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
id|prog_dmabuf_dac
c_func
(paren
id|s
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;dma_dac.wait
comma
id|wait
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;dma_adc.wait
comma
id|wait
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|solo1_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_adc.fragsize
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
OG
l_int|0
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|s-&gt;dma_dac.dmasize
OG
id|s-&gt;dma_dac.count
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|solo1_mmap
r_static
r_int
id|solo1_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmabuf
op_star
id|db
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf_dac
c_func
(paren
id|s
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|db
op_assign
op_amp
id|s-&gt;dma_dac
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_READ
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|db
op_assign
op_amp
id|s-&gt;dma_adc
suffix:semicolon
)brace
r_else
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|vma-&gt;vm_start
comma
id|virt_to_phys
c_func
(paren
id|db-&gt;rawbuf
)paren
comma
id|size
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_goto
id|out
suffix:semicolon
id|db-&gt;mapped
op_assign
l_int|1
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solo1_ioctl
r_static
r_int
id|solo1_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|audio_buf_info
id|abinfo
suffix:semicolon
id|count_info
id|cinfo
suffix:semicolon
r_int
id|val
comma
id|mapped
comma
id|ret
comma
id|count
suffix:semicolon
r_int
id|div1
comma
id|div2
suffix:semicolon
r_int
id|rate1
comma
id|rate2
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|mapped
op_assign
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
op_logical_and
id|s-&gt;dma_dac.mapped
)paren
op_logical_or
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
op_logical_and
id|s-&gt;dma_adc.mapped
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|OSS_GETVERSION
suffix:colon
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
r_return
id|drain_dac
c_func
(paren
id|s
comma
l_int|0
multiline_comment|/*file-&gt;f_flags &amp; O_NONBLOCK*/
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SETDUPLEX
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETCAPS
suffix:colon
r_return
id|put_user
c_func
(paren
id|DSP_CAP_DUPLEX
op_or
id|DSP_CAP_REALTIME
op_or
id|DSP_CAP_TRIGGER
op_or
id|DSP_CAP_MMAP
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_RESET
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|s-&gt;dma_dac.swptr
op_assign
id|s-&gt;dma_dac.hwptr
op_assign
id|s-&gt;dma_dac.count
op_assign
id|s-&gt;dma_dac.total_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|s-&gt;dma_adc.swptr
op_assign
id|s-&gt;dma_adc.hwptr
op_assign
id|s-&gt;dma_adc.count
op_assign
id|s-&gt;dma_adc.total_bytes
op_assign
l_int|0
suffix:semicolon
)brace
id|prog_codec
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|0
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* program sampling rates */
r_if
c_cond
(paren
id|val
OG
l_int|48000
)paren
id|val
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
l_int|6300
)paren
id|val
op_assign
l_int|6300
suffix:semicolon
id|div1
op_assign
(paren
l_int|768000
op_plus
id|val
op_div
l_int|2
)paren
op_div
id|val
suffix:semicolon
id|rate1
op_assign
(paren
l_int|768000
op_plus
id|div1
op_div
l_int|2
)paren
op_div
id|div1
suffix:semicolon
id|div1
op_assign
op_minus
id|div1
suffix:semicolon
id|div2
op_assign
(paren
l_int|793800
op_plus
id|val
op_div
l_int|2
)paren
op_div
id|val
suffix:semicolon
id|rate2
op_assign
(paren
l_int|793800
op_plus
id|div2
op_div
l_int|2
)paren
op_div
id|div2
suffix:semicolon
id|div2
op_assign
(paren
op_minus
id|div2
)paren
op_amp
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|abs
c_func
(paren
id|val
op_minus
id|rate2
)paren
OL
id|abs
c_func
(paren
id|val
op_minus
id|rate1
)paren
)paren
(brace
id|rate1
op_assign
id|rate2
suffix:semicolon
id|div1
op_assign
id|div2
suffix:semicolon
)brace
id|s-&gt;rate
op_assign
id|rate1
suffix:semicolon
id|s-&gt;clkdiv
op_assign
id|div1
suffix:semicolon
id|prog_codec
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|s-&gt;rate
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* program channels */
id|s-&gt;channels
op_assign
id|val
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
id|prog_codec
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_CHANNELS
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|0
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* program channels */
id|s-&gt;channels
op_assign
(paren
id|val
op_ge
l_int|2
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
id|prog_codec
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|s-&gt;channels
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETFMTS
suffix:colon
multiline_comment|/* Returns a mask */
r_return
id|put_user
c_func
(paren
id|AFMT_S16_LE
op_or
id|AFMT_U16_LE
op_or
id|AFMT_S8
op_or
id|AFMT_U8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFMT
suffix:colon
multiline_comment|/* Selects ONE fmt*/
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|AFMT_QUERY
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* program format */
r_if
c_cond
(paren
id|val
op_ne
id|AFMT_S16_LE
op_logical_and
id|val
op_ne
id|AFMT_U16_LE
op_logical_and
id|val
op_ne
id|AFMT_S8
op_logical_and
id|val
op_ne
id|AFMT_U8
)paren
id|val
op_assign
id|AFMT_U8
suffix:semicolon
id|s-&gt;fmt
op_assign
id|val
suffix:semicolon
id|prog_codec
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|s-&gt;fmt
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_POST
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETTRIGGER
suffix:colon
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|s-&gt;ena
op_amp
id|FMODE_READ
)paren
id|val
op_or_assign
id|PCM_ENABLE_INPUT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|s-&gt;ena
op_amp
id|FMODE_WRITE
)paren
id|val
op_or_assign
id|PCM_ENABLE_OUTPUT
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETTRIGGER
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_INPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|s-&gt;ddmabase
op_plus
l_int|15
)paren
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;solo1: cannot start recording, DDMA mask bit stuck at 1&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_OUTPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|start_dac
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_else
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOSPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|solo1_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|s-&gt;dma_dac.fragsize
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|abinfo.bytes
op_assign
id|s-&gt;dma_dac.dmasize
op_minus
id|count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|s-&gt;dma_dac.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|s-&gt;dma_dac.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETISPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|solo1_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|s-&gt;dma_adc.fragsize
suffix:semicolon
id|abinfo.bytes
op_assign
id|s-&gt;dma_adc.count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|s-&gt;dma_adc.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|s-&gt;dma_adc.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_NONBLOCK
suffix:colon
id|file-&gt;f_flags
op_or_assign
id|O_NONBLOCK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETODELAY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|solo1_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|count
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETIPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|solo1_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|s-&gt;dma_adc.total_bytes
suffix:semicolon
id|cinfo.blocks
op_assign
id|s-&gt;dma_adc.count
op_rshift
id|s-&gt;dma_adc.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|s-&gt;dma_adc.hwptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
id|s-&gt;dma_adc.count
op_and_assign
id|s-&gt;dma_adc.fragsize
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf_dac
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|solo1_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|s-&gt;dma_dac.total_bytes
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
id|count
op_assign
l_int|0
suffix:semicolon
id|cinfo.blocks
op_assign
id|count
op_rshift
id|s-&gt;dma_dac.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|s-&gt;dma_dac.hwptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
id|s-&gt;dma_dac.count
op_and_assign
id|s-&gt;dma_dac.fragsize
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;esssolo1: GETOPTR: bytes %u blocks %u ptr %u, buforder %u numfrag %u fragshift %u&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;esssolo1: swptr %u count %u fragsize %u dmasize %u fragsamples %u&bslash;n&quot;
comma
id|cinfo.bytes
comma
id|cinfo.blocks
comma
id|cinfo.ptr
comma
id|s-&gt;dma_dac.buforder
comma
id|s-&gt;dma_dac.numfrag
comma
id|s-&gt;dma_dac.fragshift
comma
id|s-&gt;dma_dac.swptr
comma
id|s-&gt;dma_dac.count
comma
id|s-&gt;dma_dac.fragsize
comma
id|s-&gt;dma_dac.dmasize
comma
id|s-&gt;dma_dac.fragsamples
)paren
suffix:semicolon
macro_line|#endif
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf_dac
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;dma_dac.fragsize
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf_adc
c_func
(paren
id|s
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;dma_adc.fragsize
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|s-&gt;dma_adc.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|s-&gt;dma_adc.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossfragshift
OL
l_int|4
)paren
id|s-&gt;dma_adc.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossfragshift
OG
l_int|15
)paren
id|s-&gt;dma_adc.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossmaxfrags
OL
l_int|4
)paren
id|s-&gt;dma_adc.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|s-&gt;dma_dac.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|s-&gt;dma_dac.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.ossfragshift
OL
l_int|4
)paren
id|s-&gt;dma_dac.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.ossfragshift
OG
l_int|15
)paren
id|s-&gt;dma_dac.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.ossmaxfrags
OL
l_int|4
)paren
id|s-&gt;dma_dac.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
r_if
c_cond
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
id|s-&gt;dma_adc.subdivision
)paren
op_logical_or
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
id|s-&gt;dma_dac.subdivision
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|1
op_logical_and
id|val
op_ne
l_int|2
op_logical_and
id|val
op_ne
l_int|4
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|s-&gt;dma_adc.subdivision
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|s-&gt;dma_dac.subdivision
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_PCM_READ_RATE
suffix:colon
r_return
id|put_user
c_func
(paren
id|s-&gt;rate
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_CHANNELS
suffix:colon
r_return
id|put_user
c_func
(paren
id|s-&gt;channels
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_BITS
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;fmt
op_amp
(paren
id|AFMT_S8
op_or
id|AFMT_U8
)paren
)paren
ques
c_cond
l_int|8
suffix:colon
l_int|16
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_WRITE_FILTER
suffix:colon
r_case
id|SNDCTL_DSP_SETSYNCRO
suffix:colon
r_case
id|SOUND_PCM_READ_FILTER
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|mixer_ioctl
c_func
(paren
id|s
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|solo1_release
r_static
r_int
id|solo1_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|drain_dac
c_func
(paren
id|s
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iobase
op_plus
l_int|6
)paren
suffix:semicolon
multiline_comment|/* disable DMA */
id|dealloc_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_dac
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
id|s-&gt;ddmabase
op_plus
l_int|0xf
)paren
suffix:semicolon
multiline_comment|/* mask DMA channel */
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;ddmabase
op_plus
l_int|0xd
)paren
suffix:semicolon
multiline_comment|/* DMA master clear */
id|dealloc_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_adc
)paren
suffix:semicolon
)brace
id|s-&gt;open_mode
op_and_assign
op_complement
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|solo1_open
r_static
r_int
id|solo1_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|solo1_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|solo1_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|s-&gt;dev_audio
op_xor
id|minor
)paren
op_amp
op_complement
l_int|0xf
)paren
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
multiline_comment|/* wait for device to become free */
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;open_mode
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
)brace
id|s-&gt;fmt
op_assign
id|AFMT_U8
suffix:semicolon
id|s-&gt;channels
op_assign
l_int|1
suffix:semicolon
id|s-&gt;rate
op_assign
l_int|8000
suffix:semicolon
id|s-&gt;clkdiv
op_assign
l_int|96
op_or
l_int|0x80
suffix:semicolon
id|s-&gt;ena
op_assign
l_int|0
suffix:semicolon
id|s-&gt;dma_adc.ossfragshift
op_assign
id|s-&gt;dma_adc.ossmaxfrags
op_assign
id|s-&gt;dma_adc.subdivision
op_assign
l_int|0
suffix:semicolon
id|s-&gt;dma_dac.ossfragshift
op_assign
id|s-&gt;dma_dac.ossmaxfrags
op_assign
id|s-&gt;dma_dac.subdivision
op_assign
l_int|0
suffix:semicolon
id|s-&gt;open_mode
op_or_assign
id|file-&gt;f_mode
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|prog_codec
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|solo1_audio_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|solo1_audio_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|solo1_llseek
comma
id|read
suffix:colon
id|solo1_read
comma
id|write
suffix:colon
id|solo1_write
comma
id|poll
suffix:colon
id|solo1_poll
comma
id|ioctl
suffix:colon
id|solo1_ioctl
comma
id|mmap
suffix:colon
id|solo1_mmap
comma
id|open
suffix:colon
id|solo1_open
comma
id|release
suffix:colon
id|solo1_release
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
multiline_comment|/* hold spinlock for the following! */
DECL|function|solo1_handle_midi
r_static
r_void
id|solo1_handle_midi
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_int
r_char
id|ch
suffix:semicolon
r_int
id|wake
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;mpubase
)paren
)paren
r_return
suffix:semicolon
id|wake
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|s-&gt;mpubase
op_plus
l_int|1
)paren
op_amp
l_int|0x80
)paren
)paren
(brace
id|ch
op_assign
id|inb
c_func
(paren
id|s-&gt;mpubase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.icnt
OL
id|MIDIINBUF
)paren
(brace
id|s-&gt;midi.ibuf
(braket
id|s-&gt;midi.iwr
)braket
op_assign
id|ch
suffix:semicolon
id|s-&gt;midi.iwr
op_assign
(paren
id|s-&gt;midi.iwr
op_plus
l_int|1
)paren
op_mod
id|MIDIINBUF
suffix:semicolon
id|s-&gt;midi.icnt
op_increment
suffix:semicolon
)brace
id|wake
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wake
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;midi.iwait
)paren
suffix:semicolon
id|wake
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|s-&gt;mpubase
op_plus
l_int|1
)paren
op_amp
l_int|0x40
)paren
op_logical_and
id|s-&gt;midi.ocnt
OG
l_int|0
)paren
(brace
id|outb
c_func
(paren
id|s-&gt;midi.obuf
(braket
id|s-&gt;midi.ord
)braket
comma
id|s-&gt;mpubase
)paren
suffix:semicolon
id|s-&gt;midi.ord
op_assign
(paren
id|s-&gt;midi.ord
op_plus
l_int|1
)paren
op_mod
id|MIDIOUTBUF
suffix:semicolon
id|s-&gt;midi.ocnt
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.ocnt
OL
id|MIDIOUTBUF
op_minus
l_int|16
)paren
id|wake
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wake
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;midi.owait
)paren
suffix:semicolon
)brace
DECL|function|solo1_interrupt
r_static
r_void
id|solo1_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|dev_id
suffix:semicolon
r_int
r_int
id|intsrc
suffix:semicolon
multiline_comment|/* fastpath out, to ease interrupt sharing */
id|intsrc
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* get interrupt source(s) */
r_if
c_cond
(paren
op_logical_neg
id|intsrc
)paren
r_return
suffix:semicolon
(paren
r_void
)paren
id|inb
c_func
(paren
id|s-&gt;sbbase
op_plus
l_int|0xe
)paren
suffix:semicolon
multiline_comment|/* clear interrupt */
id|spin_lock
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* clear audio interrupts first */
r_if
c_cond
(paren
id|intsrc
op_amp
l_int|0x20
)paren
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x7a
comma
id|read_mixer
c_func
(paren
id|s
comma
l_int|0x7a
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|solo1_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|solo1_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|solo1_midi_timer
r_static
r_void
id|solo1_midi_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|solo1_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;midi.timer.expires
op_assign
id|jiffies
op_plus
l_int|1
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|s-&gt;midi.timer
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|solo1_midi_read
r_static
id|ssize_t
id|solo1_midi_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.iwait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ptr
op_assign
id|s-&gt;midi.ird
suffix:semicolon
id|cnt
op_assign
id|MIDIINBUF
op_minus
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.icnt
OL
id|cnt
)paren
id|cnt
op_assign
id|s-&gt;midi.icnt
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|s-&gt;midi.ibuf
op_plus
id|ptr
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ptr
op_assign
(paren
id|ptr
op_plus
id|cnt
)paren
op_mod
id|MIDIINBUF
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;midi.ird
op_assign
id|ptr
suffix:semicolon
id|s-&gt;midi.icnt
op_sub_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
r_break
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.iwait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solo1_midi_write
r_static
id|ssize_t
id|solo1_midi_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ptr
op_assign
id|s-&gt;midi.owr
suffix:semicolon
id|cnt
op_assign
id|MIDIOUTBUF
op_minus
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;midi.ocnt
op_plus
id|cnt
OG
id|MIDIOUTBUF
)paren
id|cnt
op_assign
id|MIDIOUTBUF
op_minus
id|s-&gt;midi.ocnt
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|solo1_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|s-&gt;midi.obuf
op_plus
id|ptr
comma
id|buffer
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ptr
op_assign
(paren
id|ptr
op_plus
id|cnt
)paren
op_mod
id|MIDIOUTBUF
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;midi.owr
op_assign
id|ptr
suffix:semicolon
id|s-&gt;midi.ocnt
op_add_assign
id|cnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|solo1_handle_midi
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* No kernel lock - we have our own spinlock */
DECL|function|solo1_midi_poll
r_static
r_int
r_int
id|solo1_midi_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|FMODE_WRITE
)paren
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;midi.owait
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|FMODE_READ
)paren
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;midi.iwait
comma
id|wait
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;midi.icnt
OG
l_int|0
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;midi.ocnt
OL
id|MIDIOUTBUF
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|solo1_midi_open
r_static
r_int
id|solo1_midi_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|solo1_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|solo1_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dev_midi
op_eq
id|minor
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
multiline_comment|/* wait for device to become free */
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;open_mode
op_amp
(paren
id|file-&gt;f_mode
op_lshift
id|FMODE_MIDI_SHIFT
)paren
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;open_mode
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
)paren
)paren
(brace
id|s-&gt;midi.ird
op_assign
id|s-&gt;midi.iwr
op_assign
id|s-&gt;midi.icnt
op_assign
l_int|0
suffix:semicolon
id|s-&gt;midi.ord
op_assign
id|s-&gt;midi.owr
op_assign
id|s-&gt;midi.ocnt
op_assign
l_int|0
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|s-&gt;mpubase
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* reset command */
id|outb
c_func
(paren
l_int|0x3f
comma
id|s-&gt;mpubase
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* uart command */
r_if
c_cond
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|s-&gt;mpubase
op_plus
l_int|1
)paren
op_amp
l_int|0x80
)paren
)paren
id|inb
c_func
(paren
id|s-&gt;mpubase
)paren
suffix:semicolon
id|s-&gt;midi.ird
op_assign
id|s-&gt;midi.iwr
op_assign
id|s-&gt;midi.icnt
op_assign
l_int|0
suffix:semicolon
id|outb
c_func
(paren
l_int|0xb0
comma
id|s-&gt;iobase
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* enable A1, A2, MPU irq&squot;s */
id|init_timer
c_func
(paren
op_amp
id|s-&gt;midi.timer
)paren
suffix:semicolon
id|s-&gt;midi.timer.expires
op_assign
id|jiffies
op_plus
l_int|1
suffix:semicolon
id|s-&gt;midi.timer.data
op_assign
(paren
r_int
r_int
)paren
id|s
suffix:semicolon
id|s-&gt;midi.timer.function
op_assign
id|solo1_midi_timer
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|s-&gt;midi.timer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|s-&gt;midi.ird
op_assign
id|s-&gt;midi.iwr
op_assign
id|s-&gt;midi.icnt
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|s-&gt;midi.ord
op_assign
id|s-&gt;midi.owr
op_assign
id|s-&gt;midi.ocnt
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;open_mode
op_or_assign
(paren
id|file-&gt;f_mode
op_lshift
id|FMODE_MIDI_SHIFT
)paren
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|solo1_midi_release
r_static
r_int
id|solo1_midi_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
comma
id|tmo
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;midi.ocnt
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|tmo
op_assign
(paren
id|count
op_star
id|HZ
)paren
op_div
l_int|3100
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|tmo
ques
c_cond
suffix:colon
l_int|1
)paren
op_logical_and
id|tmo
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: midi timed out??&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;midi.owait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|s-&gt;open_mode
op_and_assign
(paren
op_complement
(paren
id|file-&gt;f_mode
op_lshift
id|FMODE_MIDI_SHIFT
)paren
)paren
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;open_mode
op_amp
(paren
id|FMODE_MIDI_READ
op_or
id|FMODE_MIDI_WRITE
)paren
)paren
)paren
(brace
id|outb
c_func
(paren
l_int|0x30
comma
id|s-&gt;iobase
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* enable A1, A2 irq&squot;s */
id|del_timer
c_func
(paren
op_amp
id|s-&gt;midi.timer
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|solo1_midi_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|solo1_midi_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|solo1_llseek
comma
id|read
suffix:colon
id|solo1_midi_read
comma
id|write
suffix:colon
id|solo1_midi_write
comma
id|poll
suffix:colon
id|solo1_midi_poll
comma
id|open
suffix:colon
id|solo1_midi_open
comma
id|release
suffix:colon
id|solo1_midi_release
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|solo1_dmfm_ioctl
r_static
r_int
id|solo1_dmfm_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_static
r_const
r_int
r_char
id|op_offset
(braket
l_int|18
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x08
comma
l_int|0x09
comma
l_int|0x0A
comma
l_int|0x0B
comma
l_int|0x0C
comma
l_int|0x0D
comma
l_int|0x10
comma
l_int|0x11
comma
l_int|0x12
comma
l_int|0x13
comma
l_int|0x14
comma
l_int|0x15
)brace
suffix:semicolon
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dm_fm_voice
id|v
suffix:semicolon
r_struct
id|dm_fm_note
id|n
suffix:semicolon
r_struct
id|dm_fm_params
id|p
suffix:semicolon
r_int
r_int
id|io
suffix:semicolon
r_int
r_int
id|regb
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FM_IOCTL_RESET
suffix:colon
r_for
c_loop
(paren
id|regb
op_assign
l_int|0xb0
suffix:semicolon
id|regb
OL
l_int|0xb9
suffix:semicolon
id|regb
op_increment
)paren
(brace
id|outb
c_func
(paren
id|regb
comma
id|s-&gt;sbbase
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;sbbase
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
id|regb
comma
id|s-&gt;sbbase
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;sbbase
op_plus
l_int|3
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|FM_IOCTL_PLAY_NOTE
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|n
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|n
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|n.voice
op_ge
l_int|18
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|n.voice
op_ge
l_int|9
)paren
(brace
id|regb
op_assign
id|n.voice
op_minus
l_int|9
suffix:semicolon
id|io
op_assign
id|s-&gt;sbbase
op_plus
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|regb
op_assign
id|n.voice
suffix:semicolon
id|io
op_assign
id|s-&gt;sbbase
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0xa0
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
id|n.fnum
op_amp
l_int|0xff
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xb0
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|n.fnum
op_rshift
l_int|8
)paren
op_amp
l_int|3
)paren
op_or
(paren
(paren
id|n.octave
op_amp
l_int|7
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|n.key_on
op_amp
l_int|1
)paren
op_lshift
l_int|5
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FM_IOCTL_SET_VOICE
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|v.voice
op_ge
l_int|18
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|regb
op_assign
id|op_offset
(braket
id|v.voice
)braket
suffix:semicolon
id|io
op_assign
id|s-&gt;sbbase
op_plus
(paren
(paren
id|v.op
op_amp
l_int|1
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|v.am
op_amp
l_int|1
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|v.vibrato
op_amp
l_int|1
)paren
op_lshift
l_int|6
)paren
op_or
(paren
(paren
id|v.do_sustain
op_amp
l_int|1
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|v.kbd_scale
op_amp
l_int|1
)paren
op_lshift
l_int|4
)paren
op_or
(paren
id|v.harmonic
op_amp
l_int|0xf
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x40
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|v.scale_level
op_amp
l_int|0x3
)paren
op_lshift
l_int|6
)paren
op_or
(paren
id|v.volume
op_amp
l_int|0x3f
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x60
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|v.attack
op_amp
l_int|0xf
)paren
op_lshift
l_int|4
)paren
op_or
(paren
id|v.decay
op_amp
l_int|0xf
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x80
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|v.sustain
op_amp
l_int|0xf
)paren
op_lshift
l_int|4
)paren
op_or
(paren
id|v.release
op_amp
l_int|0xf
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xe0
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
id|v.waveform
op_amp
l_int|0x7
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n.voice
op_ge
l_int|9
)paren
(brace
id|regb
op_assign
id|n.voice
op_minus
l_int|9
suffix:semicolon
id|io
op_assign
id|s-&gt;sbbase
op_plus
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|regb
op_assign
id|n.voice
suffix:semicolon
id|io
op_assign
id|s-&gt;sbbase
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0xc0
op_plus
id|regb
comma
id|io
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|v.right
op_amp
l_int|1
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|v.left
op_amp
l_int|1
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|v.feedback
op_amp
l_int|7
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|v.connection
op_amp
l_int|1
)paren
comma
id|io
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FM_IOCTL_SET_PARAMS
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|p
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|outb
c_func
(paren
l_int|0x08
comma
id|s-&gt;sbbase
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|p.kbd_split
op_amp
l_int|1
)paren
op_lshift
l_int|6
comma
id|s-&gt;sbbase
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xbd
comma
id|s-&gt;sbbase
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|p.am_depth
op_amp
l_int|1
)paren
op_lshift
l_int|7
)paren
op_or
(paren
(paren
id|p.vib_depth
op_amp
l_int|1
)paren
op_lshift
l_int|6
)paren
op_or
(paren
(paren
id|p.rhythm
op_amp
l_int|1
)paren
op_lshift
l_int|5
)paren
op_or
(paren
(paren
id|p.bass
op_amp
l_int|1
)paren
op_lshift
l_int|4
)paren
op_or
(paren
(paren
id|p.snare
op_amp
l_int|1
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|p.tomtom
op_amp
l_int|1
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|p.cymbal
op_amp
l_int|1
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|p.hihat
op_amp
l_int|1
)paren
comma
id|s-&gt;sbbase
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FM_IOCTL_SET_OPL
suffix:colon
id|outb
c_func
(paren
l_int|4
comma
id|s-&gt;sbbase
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
id|arg
comma
id|s-&gt;sbbase
op_plus
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FM_IOCTL_SET_MODE
suffix:colon
id|outb
c_func
(paren
l_int|5
comma
id|s-&gt;sbbase
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
id|arg
op_amp
l_int|1
comma
id|s-&gt;sbbase
op_plus
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|function|solo1_dmfm_open
r_static
r_int
id|solo1_dmfm_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|solo1_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|solo1_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dev_dmfm
op_eq
id|minor
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
multiline_comment|/* wait for device to become free */
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;open_mode
op_amp
id|FMODE_DMFM
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;sbbase
comma
id|FMSYNTH_EXTENT
comma
l_string|&quot;ESS Solo1&quot;
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;solo1: FM synth io ports in use, opl3 loaded?&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/* init the stuff */
id|outb
c_func
(paren
l_int|1
comma
id|s-&gt;sbbase
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|s-&gt;sbbase
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* enable waveforms */
id|outb
c_func
(paren
l_int|4
comma
id|s-&gt;sbbase
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;sbbase
op_plus
l_int|3
)paren
suffix:semicolon
multiline_comment|/* no 4op enabled */
id|outb
c_func
(paren
l_int|5
comma
id|s-&gt;sbbase
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
id|s-&gt;sbbase
op_plus
l_int|3
)paren
suffix:semicolon
multiline_comment|/* enable OPL3 */
id|s-&gt;open_mode
op_or_assign
id|FMODE_DMFM
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|solo1_dmfm_release
r_static
r_int
id|solo1_dmfm_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|regb
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|s-&gt;open_mode
op_and_assign
op_complement
id|FMODE_DMFM
suffix:semicolon
r_for
c_loop
(paren
id|regb
op_assign
l_int|0xb0
suffix:semicolon
id|regb
OL
l_int|0xb9
suffix:semicolon
id|regb
op_increment
)paren
(brace
id|outb
c_func
(paren
id|regb
comma
id|s-&gt;sbbase
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;sbbase
op_plus
l_int|1
)paren
suffix:semicolon
id|outb
c_func
(paren
id|regb
comma
id|s-&gt;sbbase
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;sbbase
op_plus
l_int|3
)paren
suffix:semicolon
)brace
id|release_region
c_func
(paren
id|s-&gt;sbbase
comma
id|FMSYNTH_EXTENT
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|solo1_dmfm_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|solo1_dmfm_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|solo1_llseek
comma
id|ioctl
suffix:colon
id|solo1_dmfm_ioctl
comma
id|open
suffix:colon
id|solo1_dmfm_open
comma
id|release
suffix:colon
id|solo1_dmfm_release
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|struct|initvol
r_static
r_struct
id|initvol
(brace
DECL|member|mixch
r_int
id|mixch
suffix:semicolon
DECL|member|vol
r_int
id|vol
suffix:semicolon
DECL|variable|__initdata
)brace
id|initvol
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|SOUND_MIXER_WRITE_VOLUME
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_PCM
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_SYNTH
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_CD
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE1
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE2
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_RECLEV
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_SPEAKER
comma
l_int|0x4040
)brace
comma
(brace
id|SOUND_MIXER_WRITE_MIC
comma
l_int|0x4040
)brace
)brace
suffix:semicolon
DECL|function|setup_solo1
r_static
r_int
id|setup_solo1
c_func
(paren
r_struct
id|solo1_state
op_star
id|s
)paren
(brace
r_struct
id|pci_dev
op_star
id|pcidev
op_assign
id|s-&gt;dev
suffix:semicolon
id|mm_segment_t
id|fs
suffix:semicolon
r_int
id|i
comma
id|val
suffix:semicolon
multiline_comment|/* initialize DDMA base address */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;solo1: ddma base address: 0x%lx&bslash;n&quot;
comma
id|s-&gt;ddmabase
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pcidev
comma
l_int|0x60
comma
(paren
id|s-&gt;ddmabase
op_amp
(paren
op_complement
l_int|0xf
)paren
)paren
op_or
l_int|1
)paren
suffix:semicolon
multiline_comment|/* set DMA policy to DDMA, IRQ emulation off (CLKRUN disabled for now) */
id|pci_write_config_dword
c_func
(paren
id|pcidev
comma
l_int|0x50
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable legacy audio address decode */
id|pci_write_config_word
c_func
(paren
id|pcidev
comma
l_int|0x40
comma
l_int|0x907f
)paren
suffix:semicolon
multiline_comment|/* initialize the chips */
r_if
c_cond
(paren
op_logical_neg
id|reset_ctrl
c_func
(paren
id|s
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;esssolo1: cannot reset controller&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0xb0
comma
id|s-&gt;iobase
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* enable A1, A2, MPU irq&squot;s */
multiline_comment|/* initialize mixer regs */
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x7f
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable music digital recording */
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x7d
comma
l_int|0x0c
)paren
suffix:semicolon
multiline_comment|/* enable mic preamp, MONO_OUT is 2nd DAC right channel */
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x64
comma
l_int|0x45
)paren
suffix:semicolon
multiline_comment|/* volume control */
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x48
comma
l_int|0x10
)paren
suffix:semicolon
multiline_comment|/* enable music DAC/ES6xx interface */
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x50
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable spatializer */
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x52
comma
l_int|0
)paren
suffix:semicolon
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x14
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* DAC1 minimum volume */
id|write_mixer
c_func
(paren
id|s
comma
l_int|0x71
comma
l_int|0x20
)paren
suffix:semicolon
multiline_comment|/* enable new 0xA1 reg format */
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;ddmabase
op_plus
l_int|0xd
)paren
suffix:semicolon
multiline_comment|/* DMA master clear */
id|outb
c_func
(paren
l_int|1
comma
id|s-&gt;ddmabase
op_plus
l_int|0xf
)paren
suffix:semicolon
multiline_comment|/* mask channel */
multiline_comment|/*outb(0, s-&gt;ddmabase+0x8);*/
multiline_comment|/* enable controller (enable is low active!!) */
id|pci_set_master
c_func
(paren
id|pcidev
)paren
suffix:semicolon
multiline_comment|/* enable bus mastering */
id|fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|val
op_assign
id|SOUND_MASK_LINE
suffix:semicolon
id|mixer_ioctl
c_func
(paren
id|s
comma
id|SOUND_MIXER_WRITE_RECSRC
comma
(paren
r_int
r_int
)paren
op_amp
id|val
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|initvol
)paren
op_div
r_sizeof
(paren
id|initvol
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|initvol
(braket
id|i
)braket
dot
id|vol
suffix:semicolon
id|mixer_ioctl
c_func
(paren
id|s
comma
id|initvol
(braket
id|i
)braket
dot
id|mixch
comma
(paren
r_int
r_int
)paren
op_amp
id|val
)paren
suffix:semicolon
)brace
id|val
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* enable mic preamp */
id|mixer_ioctl
c_func
(paren
id|s
comma
id|SOUND_MIXER_PRIVATE1
comma
(paren
r_int
r_int
)paren
op_amp
id|val
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|fs
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|solo1_pm_callback
r_static
r_int
id|solo1_pm_callback
c_func
(paren
r_struct
id|pm_dev
op_star
id|dev
comma
id|pm_request_t
id|rqst
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
(paren
r_struct
id|solo1_state
op_star
)paren
id|dev-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|s
)paren
(brace
r_switch
c_cond
(paren
id|rqst
)paren
(brace
r_case
id|PM_RESUME
suffix:colon
id|setup_solo1
c_func
(paren
id|s
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM_SUSPEND
suffix:colon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iobase
op_plus
l_int|6
)paren
suffix:semicolon
multiline_comment|/* DMA master clear */
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;ddmabase
op_plus
l_int|0xd
)paren
suffix:semicolon
multiline_comment|/* reset sequencer and FIFO */
id|outb
c_func
(paren
l_int|3
comma
id|s-&gt;sbbase
op_plus
l_int|6
)paren
suffix:semicolon
multiline_comment|/* turn off DDMA controller address space */
id|pci_write_config_word
c_func
(paren
id|s-&gt;dev
comma
l_int|0x60
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|RSRCISIOREGION
mdefine_line|#define RSRCISIOREGION(dev,num) (pci_resource_start((dev), (num)) != 0 &amp;&amp; &bslash;&n;&t;&t;&t;&t; (pci_resource_flags((dev), (num)) &amp; IORESOURCE_IO))
DECL|function|solo1_probe
r_static
r_int
id|__devinit
id|solo1_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pcidev
comma
r_const
r_struct
id|pci_device_id
op_star
id|pciid
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
suffix:semicolon
r_struct
id|pm_dev
op_star
id|pmdev
suffix:semicolon
id|dma_addr_t
id|dma_mask
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
l_int|0
)paren
op_logical_or
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
l_int|1
)paren
op_logical_or
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
l_int|2
)paren
op_logical_or
op_logical_neg
id|RSRCISIOREGION
c_func
(paren
id|pcidev
comma
l_int|3
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pcidev-&gt;irq
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pci_dma_supported
c_func
(paren
id|pcidev
comma
l_int|0x00ffffff
)paren
)paren
(brace
id|dma_mask
op_assign
l_int|0x00ffffff
suffix:semicolon
multiline_comment|/* this enables playback and recording */
)brace
r_else
r_if
c_cond
(paren
id|pci_dma_supported
c_func
(paren
id|pcidev
comma
l_int|0xffffffff
)paren
)paren
(brace
id|dma_mask
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* this enables only playback, as the recording BMDMA can handle only 24bits  */
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;solo1: architecture does not support 24bit or 32bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|solo1_state
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;solo1: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|solo1_state
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;midi.iwait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;midi.owait
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
id|s-&gt;magic
op_assign
id|SOLO1_MAGIC
suffix:semicolon
id|s-&gt;dev
op_assign
id|pcidev
suffix:semicolon
id|s-&gt;iobase
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;sbbase
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
l_int|1
)paren
suffix:semicolon
id|s-&gt;vcbase
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
l_int|2
)paren
suffix:semicolon
id|s-&gt;ddmabase
op_assign
id|s-&gt;vcbase
op_plus
id|DDMABASE_OFFSET
suffix:semicolon
id|s-&gt;mpubase
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
l_int|3
)paren
suffix:semicolon
id|s-&gt;gpbase
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
l_int|4
)paren
suffix:semicolon
id|s-&gt;irq
op_assign
id|pcidev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;iobase
comma
id|IOBASE_EXTENT
comma
l_string|&quot;ESS Solo1&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;solo1: io ports in use&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_region1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;sbbase
op_plus
id|FMSYNTH_EXTENT
comma
id|SBBASE_EXTENT
op_minus
id|FMSYNTH_EXTENT
comma
l_string|&quot;ESS Solo1&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;solo1: io ports in use&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_region2
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;ddmabase
comma
id|DDMABASE_EXTENT
comma
l_string|&quot;ESS Solo1&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;solo1: io ports in use&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_region3
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;mpubase
comma
id|MPUBASE_EXTENT
comma
l_string|&quot;ESS Solo1&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;solo1: io ports in use&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_region4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|s-&gt;irq
comma
id|solo1_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;ESS Solo1&quot;
comma
id|s
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;solo1: irq %u in use&bslash;n&quot;
comma
id|s-&gt;irq
)paren
suffix:semicolon
r_goto
id|err_irq
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pcidev
)paren
)paren
r_goto
id|err_irq
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;solo1: joystick port at %#lx&bslash;n&quot;
comma
id|s-&gt;gpbase
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* register devices */
r_if
c_cond
(paren
(paren
id|s-&gt;dev_audio
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|solo1_audio_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dev_mixer
op_assign
id|register_sound_mixer
c_func
(paren
op_amp
id|solo1_mixer_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dev_midi
op_assign
id|register_sound_midi
c_func
(paren
op_amp
id|solo1_midi_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;dev_dmfm
op_assign
id|register_sound_special
c_func
(paren
op_amp
id|solo1_dmfm_fops
comma
l_int|15
multiline_comment|/* ?? */
)paren
)paren
OL
l_int|0
)paren
r_goto
id|err_dev4
suffix:semicolon
r_if
c_cond
(paren
id|setup_solo1
c_func
(paren
id|s
)paren
)paren
r_goto
id|err
suffix:semicolon
multiline_comment|/* store it in the driver field */
id|pci_set_drvdata
c_func
(paren
id|pcidev
comma
id|s
)paren
suffix:semicolon
id|pcidev-&gt;dma_mask
op_assign
id|dma_mask
suffix:semicolon
multiline_comment|/* put it into driver list */
id|list_add_tail
c_func
(paren
op_amp
id|s-&gt;devs
comma
op_amp
id|devs
)paren
suffix:semicolon
id|pmdev
op_assign
id|pm_register
c_func
(paren
id|PM_PCI_DEV
comma
id|PM_PCI_ID
c_func
(paren
id|pcidev
)paren
comma
id|solo1_pm_callback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmdev
)paren
id|pmdev-&gt;data
op_assign
id|s
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err
suffix:colon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_dmfm
)paren
suffix:semicolon
id|err_dev4
suffix:colon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_midi
)paren
suffix:semicolon
id|err_dev3
suffix:colon
id|unregister_sound_mixer
c_func
(paren
id|s-&gt;dev_mixer
)paren
suffix:semicolon
id|err_dev2
suffix:colon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_audio
)paren
suffix:semicolon
id|err_dev1
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;solo1: initialisation error&bslash;n&quot;
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|s-&gt;irq
comma
id|s
)paren
suffix:semicolon
id|err_irq
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;iobase
comma
id|IOBASE_EXTENT
)paren
suffix:semicolon
id|err_region4
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;sbbase
op_plus
id|FMSYNTH_EXTENT
comma
id|SBBASE_EXTENT
op_minus
id|FMSYNTH_EXTENT
)paren
suffix:semicolon
id|err_region3
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;ddmabase
comma
id|DDMABASE_EXTENT
)paren
suffix:semicolon
id|err_region2
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;mpubase
comma
id|MPUBASE_EXTENT
)paren
suffix:semicolon
id|err_region1
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|solo1_remove
r_static
r_void
id|__devinit
id|solo1_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|solo1_state
op_star
id|s
op_assign
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_return
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|s-&gt;devs
)paren
suffix:semicolon
multiline_comment|/* stop DMA controller */
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iobase
op_plus
l_int|6
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;ddmabase
op_plus
l_int|0xd
)paren
suffix:semicolon
multiline_comment|/* DMA master clear */
id|outb
c_func
(paren
l_int|3
comma
id|s-&gt;sbbase
op_plus
l_int|6
)paren
suffix:semicolon
multiline_comment|/* reset sequencer and FIFO */
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|s-&gt;dev
comma
l_int|0x60
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* turn off DDMA controller address space */
id|free_irq
c_func
(paren
id|s-&gt;irq
comma
id|s
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;iobase
comma
id|IOBASE_EXTENT
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;sbbase
op_plus
id|FMSYNTH_EXTENT
comma
id|SBBASE_EXTENT
op_minus
id|FMSYNTH_EXTENT
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;ddmabase
comma
id|DDMABASE_EXTENT
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;mpubase
comma
id|MPUBASE_EXTENT
)paren
suffix:semicolon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_audio
)paren
suffix:semicolon
id|unregister_sound_mixer
c_func
(paren
id|s-&gt;dev_mixer
)paren
suffix:semicolon
id|unregister_sound_midi
c_func
(paren
id|s-&gt;dev_midi
)paren
suffix:semicolon
id|unregister_sound_special
c_func
(paren
id|s-&gt;dev_dmfm
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|id_table
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_ESS
comma
id|PCI_DEVICE_ID_ESS_SOLO1
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|id_table
)paren
suffix:semicolon
DECL|variable|solo1_driver
r_static
r_struct
id|pci_driver
id|solo1_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;ESS Solo1&quot;
comma
id|id_table
suffix:colon
id|id_table
comma
id|probe
suffix:colon
id|solo1_probe
comma
id|remove
suffix:colon
id|solo1_remove
)brace
suffix:semicolon
DECL|function|init_solo1
r_static
r_int
id|__init
id|init_solo1
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
multiline_comment|/* No PCI bus in this machine! */
r_return
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;solo1: version v0.16 time &quot;
id|__TIME__
l_string|&quot; &quot;
id|__DATE__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_register_driver
c_func
(paren
op_amp
id|solo1_driver
)paren
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|solo1_driver
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Thomas M. Sailer, sailer@ife.ee.ethz.ch, hb9jnx@hb9w.che.eu&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ESS Solo1 Driver&quot;
)paren
suffix:semicolon
DECL|function|cleanup_solo1
r_static
r_void
id|__exit
id|cleanup_solo1
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;solo1: unloading&bslash;n&quot;
)paren
suffix:semicolon
id|pci_unregister_driver
c_func
(paren
op_amp
id|solo1_driver
)paren
suffix:semicolon
id|pm_unregister_all
c_func
(paren
id|solo1_pm_callback
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|init_solo1
id|module_init
c_func
(paren
id|init_solo1
)paren
suffix:semicolon
DECL|variable|cleanup_solo1
id|module_exit
c_func
(paren
id|cleanup_solo1
)paren
suffix:semicolon
eof
