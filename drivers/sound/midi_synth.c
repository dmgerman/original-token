multiline_comment|/*&n; * sound/midi_synth.c&n; *&n; * High level midi sequencer manager for dumb MIDI interfaces.&n; *&n; * Copyright by Hannu Savolainen 1993&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions are&n; * met: 1. Redistributions of source code must retain the above copyright&n; * notice, this list of conditions and the following disclaimer. 2.&n; * Redistributions in binary form must reproduce the above copyright notice,&n; * this list of conditions and the following disclaimer in the documentation&n; * and/or other materials provided with the distribution.&n; *&n; * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&squot;&squot; AND ANY&n; * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED&n; * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE&n; * DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR&n; * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR&n; * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER&n; * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT&n; * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY&n; * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF&n; * SUCH DAMAGE.&n; *&n; */
macro_line|#include &quot;sound_config.h&quot;
macro_line|#if defined(CONFIGURE_SOUNDCARD) &amp;&amp; !defined(EXCLUDE_MIDI)
DECL|macro|_MIDI_SYNTH_C_
mdefine_line|#define _MIDI_SYNTH_C_
id|DEFINE_WAIT_QUEUE
(paren
id|sysex_sleeper
comma
id|sysex_sleep_flag
)paren
suffix:semicolon
macro_line|#include &quot;midi_synth.h&quot;
DECL|variable|midi2synth
r_static
r_int
id|midi2synth
(braket
id|MAX_MIDI_DEV
)braket
suffix:semicolon
DECL|variable|prev_out_status
r_static
r_int
r_char
id|prev_out_status
(braket
id|MAX_MIDI_DEV
)braket
suffix:semicolon
r_static
r_void
DECL|function|midi_outc
id|midi_outc
(paren
r_int
id|midi_dev
comma
r_int
id|data
)paren
(brace
r_int
id|timeout
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|0
suffix:semicolon
id|timeout
OL
l_int|32000
suffix:semicolon
id|timeout
op_increment
)paren
r_if
c_cond
(paren
id|midi_devs
(braket
id|midi_dev
)braket
op_member_access_from_pointer
id|putc
(paren
id|midi_dev
comma
(paren
r_int
r_char
)paren
(paren
id|data
op_amp
l_int|0xff
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|data
op_amp
l_int|0x80
)paren
multiline_comment|/*&n;&t;&t;&t;&t; * Status byte&n;&t;&t;&t;&t; */
id|prev_out_status
(braket
id|midi_dev
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
id|data
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t;&t; * Store for running status&n;&t;&t;&t;&t;&t;&t; */
r_return
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * Mission complete&n;&t;&t;&t;&t; */
)brace
multiline_comment|/*&n;   * Sorry! No space on buffers.&n;   */
id|printk
(paren
l_string|&quot;Midi send timed out&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|prefix_cmd
id|prefix_cmd
(paren
r_int
id|midi_dev
comma
r_int
r_char
id|status
)paren
(brace
r_if
c_cond
(paren
id|midi_devs
(braket
id|midi_dev
)braket
op_member_access_from_pointer
id|prefix_cmd
op_eq
l_int|NULL
)paren
r_return
l_int|1
suffix:semicolon
r_return
id|midi_devs
(braket
id|midi_dev
)braket
op_member_access_from_pointer
id|prefix_cmd
(paren
id|midi_dev
comma
id|status
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|midi_synth_input
id|midi_synth_input
(paren
r_int
id|dev
comma
r_int
r_char
id|data
)paren
(brace
r_int
id|orig_dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
template_param
id|num_synths
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
l_int|0xfe
)paren
multiline_comment|/* Ignore active sensing */
r_return
suffix:semicolon
id|orig_dev
op_assign
id|midi2synth
(braket
id|dev
)braket
suffix:semicolon
)brace
r_static
r_void
DECL|function|midi_synth_output
id|midi_synth_output
(paren
r_int
id|dev
)paren
(brace
multiline_comment|/*&n;   * Currently NOP&n;   */
)brace
r_int
DECL|function|midi_synth_ioctl
id|midi_synth_ioctl
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
multiline_comment|/*&n;   * int orig_dev = synth_devs[dev]-&gt;midi_dev;&n;   */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDCTL_SYNTH_INFO
suffix:colon
id|IOCTL_TO_USER
(paren
(paren
r_char
op_star
)paren
id|arg
comma
l_int|0
comma
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|info
comma
r_sizeof
(paren
r_struct
id|synth_info
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_SYNTH_MEMAVL
suffix:colon
r_return
l_int|0x7fffffff
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|RET_ERROR
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
)brace
r_int
DECL|function|midi_synth_kill_note
id|midi_synth_kill_note
(paren
r_int
id|dev
comma
r_int
id|channel
comma
r_int
id|note
comma
r_int
id|velocity
)paren
(brace
r_int
id|orig_dev
op_assign
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|midi_dev
suffix:semicolon
r_int
id|msg
comma
id|chn
suffix:semicolon
r_if
c_cond
(paren
id|note
template_param
l_int|127
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|channel
template_param
l_int|15
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|velocity
OL
l_int|0
)paren
id|velocity
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|velocity
OG
l_int|127
)paren
id|velocity
op_assign
l_int|127
suffix:semicolon
id|msg
op_assign
id|prev_out_status
(braket
id|orig_dev
)braket
op_amp
l_int|0xf0
suffix:semicolon
id|chn
op_assign
id|prev_out_status
(braket
id|orig_dev
)braket
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|chn
op_eq
id|channel
op_logical_and
(paren
(paren
id|msg
op_eq
l_int|0x90
op_logical_and
id|velocity
op_eq
l_int|64
)paren
op_logical_or
id|msg
op_eq
l_int|0x80
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Use running status&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
id|note
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
id|note
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg
op_eq
l_int|0x90
)paren
multiline_comment|/*&n;&t;&t;&t;&t; * Running status = Note on&n;&t;&t;&t;&t; */
id|midi_outc
(paren
id|orig_dev
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Note on with velocity 0 == note&n;&t;&t;&t;&t;&t; * off&n;&t;&t;&t;&t;&t; */
r_else
id|midi_outc
(paren
id|orig_dev
comma
id|velocity
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|velocity
op_eq
l_int|64
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
l_int|0x90
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
l_int|0x90
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t;&t;&t;&t; * Note on&n;&t;&t;&t;&t;&t;&t;&t;&t; */
id|midi_outc
(paren
id|orig_dev
comma
id|note
)paren
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Zero G&n;&t;&t;&t;&t;&t; */
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
l_int|0x80
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
l_int|0x80
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t;&t;&t;&t; * Note off&n;&t;&t;&t;&t;&t;&t;&t;&t; */
id|midi_outc
(paren
id|orig_dev
comma
id|note
)paren
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
id|velocity
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|midi_synth_set_instr
id|midi_synth_set_instr
(paren
r_int
id|dev
comma
r_int
id|channel
comma
r_int
id|instr_no
)paren
(brace
r_int
id|orig_dev
op_assign
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|midi_dev
suffix:semicolon
r_if
c_cond
(paren
id|instr_no
template_param
l_int|127
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|channel
template_param
l_int|15
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
l_int|0xc0
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
l_int|0xc0
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t;&t;&t; * Program change&n;&t;&t;&t;&t;&t;&t;&t; */
id|midi_outc
(paren
id|orig_dev
comma
id|instr_no
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|midi_synth_start_note
id|midi_synth_start_note
(paren
r_int
id|dev
comma
r_int
id|channel
comma
r_int
id|note
comma
r_int
id|velocity
)paren
(brace
r_int
id|orig_dev
op_assign
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|midi_dev
suffix:semicolon
r_int
id|msg
comma
id|chn
suffix:semicolon
r_if
c_cond
(paren
id|note
template_param
l_int|127
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|channel
template_param
l_int|15
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|velocity
OL
l_int|0
)paren
id|velocity
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|velocity
OG
l_int|127
)paren
id|velocity
op_assign
l_int|127
suffix:semicolon
id|msg
op_assign
id|prev_out_status
(braket
id|orig_dev
)braket
op_amp
l_int|0xf0
suffix:semicolon
id|chn
op_assign
id|prev_out_status
(braket
id|orig_dev
)braket
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|chn
op_eq
id|channel
op_logical_and
id|msg
op_eq
l_int|0x90
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Use running status&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
id|note
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
id|note
)paren
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
id|velocity
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
l_int|0x90
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
l_int|0x90
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t;&t;&t; * Note on&n;&t;&t;&t;&t;&t;&t;&t; */
id|midi_outc
(paren
id|orig_dev
comma
id|note
)paren
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
id|velocity
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|midi_synth_reset
id|midi_synth_reset
(paren
r_int
id|dev
)paren
(brace
)brace
r_int
DECL|function|midi_synth_open
id|midi_synth_open
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
(brace
r_int
id|orig_dev
op_assign
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|midi_dev
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|orig_dev
template_param
id|num_midis
)paren
r_return
id|RET_ERROR
(paren
id|ENXIO
)paren
suffix:semicolon
id|midi2synth
(braket
id|orig_dev
)braket
op_assign
id|dev
suffix:semicolon
id|prev_out_status
(braket
id|orig_dev
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|midi_devs
(braket
id|orig_dev
)braket
op_member_access_from_pointer
id|open
(paren
id|orig_dev
comma
id|mode
comma
id|midi_synth_input
comma
id|midi_synth_output
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_void
DECL|function|midi_synth_close
id|midi_synth_close
(paren
r_int
id|dev
)paren
(brace
r_int
id|orig_dev
op_assign
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|midi_dev
suffix:semicolon
multiline_comment|/*&n; * Shut up the synths by sending just single active sensing message.&n; */
id|midi_devs
(braket
id|orig_dev
)braket
op_member_access_from_pointer
id|putc
(paren
id|orig_dev
comma
l_int|0xfe
)paren
suffix:semicolon
id|midi_devs
(braket
id|orig_dev
)braket
op_member_access_from_pointer
id|close
(paren
id|orig_dev
)paren
suffix:semicolon
)brace
r_void
DECL|function|midi_synth_hw_control
id|midi_synth_hw_control
(paren
r_int
id|dev
comma
r_int
r_char
op_star
id|event
)paren
(brace
)brace
r_int
DECL|function|midi_synth_load_patch
id|midi_synth_load_patch
(paren
r_int
id|dev
comma
r_int
id|format
comma
id|snd_rw_buf
op_star
id|addr
comma
r_int
id|offs
comma
r_int
id|count
comma
r_int
id|pmgr_flag
)paren
(brace
r_int
id|orig_dev
op_assign
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|midi_dev
suffix:semicolon
r_struct
id|sysex_info
id|sysex
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|left
comma
id|src_offs
comma
id|eox_seen
op_assign
l_int|0
suffix:semicolon
r_int
id|first_byte
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
l_int|0xf0
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|format
op_ne
id|SYSEX_PATCH
)paren
(brace
id|printk
(paren
l_string|&quot;MIDI Error: Invalid patch format (key) 0x%x&bslash;n&quot;
comma
id|format
)paren
suffix:semicolon
r_return
id|RET_ERROR
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OL
r_sizeof
(paren
r_struct
id|sysex_info
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;MIDI Error: Patch header too short&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|RET_ERROR
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
id|count
op_sub_assign
r_sizeof
(paren
r_struct
id|sysex_info
)paren
suffix:semicolon
multiline_comment|/*&n;   * Copy the header from user space but ignore the first bytes which have&n;   * been transferred already.&n;   */
id|COPY_FROM_USER
(paren
op_amp
(paren
(paren
r_char
op_star
)paren
op_amp
id|sysex
)paren
(braket
id|offs
)braket
comma
id|addr
comma
id|offs
comma
r_sizeof
(paren
r_struct
id|sysex_info
)paren
op_minus
id|offs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|sysex.len
)paren
(brace
id|printk
(paren
l_string|&quot;MIDI Warning: Sysex record too short (%d&lt;%d)&bslash;n&quot;
comma
id|count
comma
(paren
r_int
)paren
id|sysex.len
)paren
suffix:semicolon
id|sysex.len
op_assign
id|count
suffix:semicolon
)brace
id|left
op_assign
id|sysex.len
suffix:semicolon
id|src_offs
op_assign
l_int|0
suffix:semicolon
id|RESET_WAIT_QUEUE
(paren
id|sysex_sleeper
comma
id|sysex_sleep_flag
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|left
op_logical_and
op_logical_neg
id|PROCESS_ABORTING
(paren
id|sysex_sleeper
comma
id|sysex_sleep_flag
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|data
suffix:semicolon
id|GET_BYTE_FROM_USER
(paren
id|data
comma
id|addr
comma
r_sizeof
(paren
r_struct
id|sysex_info
)paren
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|first_byte
op_logical_and
id|data
op_ne
l_int|0xf0
)paren
id|midi_outc
(paren
id|orig_dev
comma
l_int|0xf0
)paren
suffix:semicolon
multiline_comment|/* Sysex start */
id|eox_seen
op_assign
(paren
id|data
op_eq
l_int|0xf7
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Last byte was end of sysex&n;&t;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|data
op_ne
l_int|0xf0
)paren
multiline_comment|/*&n;&t;&t;&t;&t; * Sysex start&n;&t;&t;&t;&t; */
r_return
id|RET_ERROR
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|midi_devs
(braket
id|orig_dev
)braket
op_member_access_from_pointer
id|putc
(paren
id|orig_dev
comma
(paren
r_int
r_char
)paren
(paren
id|data
op_amp
l_int|0xff
)paren
)paren
op_logical_and
op_logical_neg
id|PROCESS_ABORTING
(paren
id|sysex_sleeper
comma
id|sysex_sleep_flag
)paren
)paren
id|DO_SLEEP
(paren
id|sysex_sleeper
comma
id|sysex_sleep_flag
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Wait for timeout */
r_if
c_cond
(paren
op_logical_neg
id|first_byte
op_logical_and
id|data
op_amp
l_int|0x80
)paren
r_return
l_int|0
suffix:semicolon
id|first_byte
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|eox_seen
)paren
id|midi_outc
(paren
id|orig_dev
comma
l_int|0xf7
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|midi_synth_panning
id|midi_synth_panning
(paren
r_int
id|dev
comma
r_int
id|channel
comma
r_int
id|pressure
)paren
(brace
)brace
r_void
DECL|function|midi_synth_aftertouch
id|midi_synth_aftertouch
(paren
r_int
id|dev
comma
r_int
id|channel
comma
r_int
id|pressure
)paren
(brace
r_int
id|orig_dev
op_assign
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|midi_dev
suffix:semicolon
r_int
id|msg
comma
id|chn
suffix:semicolon
r_if
c_cond
(paren
id|pressure
template_param
l_int|127
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|channel
template_param
l_int|15
)paren
r_return
suffix:semicolon
id|msg
op_assign
id|prev_out_status
(braket
id|orig_dev
)braket
op_amp
l_int|0xf0
suffix:semicolon
id|chn
op_assign
id|prev_out_status
(braket
id|orig_dev
)braket
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|msg
op_ne
l_int|0xd0
op_logical_or
id|chn
op_ne
id|channel
)paren
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Test for running status&n;&t;&t;&t;&t;&t; */
(brace
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
l_int|0xd0
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
)paren
r_return
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
l_int|0xd0
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t;&t;&t; * Channel pressure&n;&t;&t;&t;&t;&t;&t;&t; */
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
id|pressure
)paren
)paren
r_return
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
id|pressure
)paren
suffix:semicolon
)brace
r_void
DECL|function|midi_synth_controller
id|midi_synth_controller
(paren
r_int
id|dev
comma
r_int
id|channel
comma
r_int
id|ctrl_num
comma
r_int
id|value
)paren
(brace
r_int
id|orig_dev
op_assign
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|midi_dev
suffix:semicolon
r_int
id|chn
comma
id|msg
suffix:semicolon
r_if
c_cond
(paren
id|ctrl_num
template_param
l_int|127
)paren
r_return
suffix:semicolon
multiline_comment|/* NOTE! Controller # 0 ignored */
r_if
c_cond
(paren
id|channel
template_param
l_int|15
)paren
r_return
suffix:semicolon
id|msg
op_assign
id|prev_out_status
(braket
id|orig_dev
)braket
op_amp
l_int|0xf0
suffix:semicolon
id|chn
op_assign
id|prev_out_status
(braket
id|orig_dev
)braket
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|msg
op_ne
l_int|0xb0
op_logical_or
id|chn
op_ne
id|channel
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
l_int|0xb0
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
)paren
r_return
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
l_int|0xb0
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
id|ctrl_num
)paren
)paren
r_return
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
id|ctrl_num
)paren
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
id|value
op_amp
l_int|0x7f
)paren
suffix:semicolon
)brace
r_int
DECL|function|midi_synth_patchmgr
id|midi_synth_patchmgr
(paren
r_int
id|dev
comma
r_struct
id|patmgr_info
op_star
id|rec
)paren
(brace
r_return
id|RET_ERROR
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_void
DECL|function|midi_synth_bender
id|midi_synth_bender
(paren
r_int
id|dev
comma
r_int
id|channel
comma
r_int
id|value
)paren
(brace
r_int
id|orig_dev
op_assign
id|synth_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|midi_dev
suffix:semicolon
r_int
id|msg
comma
id|prev_chn
suffix:semicolon
r_if
c_cond
(paren
id|channel
template_param
l_int|15
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|value
template_param
l_int|16383
)paren
r_return
suffix:semicolon
id|msg
op_assign
id|prev_out_status
(braket
id|orig_dev
)braket
op_amp
l_int|0xf0
suffix:semicolon
id|prev_chn
op_assign
id|prev_out_status
(braket
id|orig_dev
)braket
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|msg
op_ne
l_int|0xd0
op_logical_or
id|prev_chn
op_ne
id|channel
)paren
multiline_comment|/*&n;&t;&t;&t;&t;&t;&t; * * Test for running status  */
(brace
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
l_int|0xe0
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
)paren
r_return
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
l_int|0xe0
op_or
(paren
id|channel
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|prefix_cmd
(paren
id|orig_dev
comma
id|value
op_amp
l_int|0x7f
)paren
)paren
r_return
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
id|value
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|midi_outc
(paren
id|orig_dev
comma
(paren
id|value
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
