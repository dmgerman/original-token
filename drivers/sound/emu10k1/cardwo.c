multiline_comment|/*&n; **********************************************************************&n; *     cardwo.c - PCM output HAL for emu10k1 driver&n; *     Copyright 1999, 2000 Creative Labs, Inc.&n; *&n; **********************************************************************&n; *&n; *     Date                 Author          Summary of changes&n; *     ----                 ------          ------------------&n; *     October 20, 1999     Bertrand Lee    base code release&n; *&n; **********************************************************************&n; *&n; *     This program is free software; you can redistribute it and/or&n; *     modify it under the terms of the GNU General Public License as&n; *     published by the Free Software Foundation; either version 2 of&n; *     the License, or (at your option) any later version.&n; *&n; *     This program is distributed in the hope that it will be useful,&n; *     but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *     GNU General Public License for more details.&n; *&n; *     You should have received a copy of the GNU General Public&n; *     License along with this program; if not, write to the Free&n; *     Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,&n; *     USA.&n; *&n; **********************************************************************&n; */
macro_line|#include &quot;hwaccess.h&quot;
macro_line|#include &quot;cardwo.h&quot;
macro_line|#include &quot;audio.h&quot;
multiline_comment|/* Volume calcs */
DECL|function|set_volume_instance
r_static
r_int
id|set_volume_instance
c_func
(paren
r_struct
id|emu10k1_waveout
op_star
id|card_waveout
comma
r_struct
id|wave_out
op_star
id|wave_out
comma
r_struct
id|voice_param
op_star
id|left
)paren
(brace
multiline_comment|/* only applicable for playback */
id|u32
id|volL
comma
id|volR
comma
id|vol
op_assign
l_int|0
suffix:semicolon
id|volL
op_assign
(paren
id|wave_out-&gt;localvol
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|volR
op_assign
(paren
(paren
id|wave_out-&gt;localvol
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;globalvolFactor
)paren
(brace
id|volL
op_assign
(paren
(paren
id|u32
)paren
(paren
(paren
(paren
id|u16
)paren
id|card_waveout-&gt;globalvol
op_amp
l_int|0xffff
)paren
op_star
(paren
id|u16
)paren
id|volL
)paren
)paren
op_div
l_int|0xffff
suffix:semicolon
id|volR
op_assign
(paren
(paren
id|u32
)paren
(paren
(paren
(paren
id|u16
)paren
(paren
id|card_waveout-&gt;globalvol
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
)paren
op_star
(paren
(paren
id|u16
)paren
id|volR
)paren
)paren
)paren
op_div
l_int|0xffff
suffix:semicolon
)brace
multiline_comment|/* BIG ASSUMPTION HERE THAT DEFAULT WAVE PAN/AUX IS 0xff/0xff */
multiline_comment|/* New volume and pan */
r_if
c_cond
(paren
id|volL
op_eq
id|volR
)paren
(brace
id|vol
op_assign
id|volL
suffix:semicolon
id|left-&gt;send_c
op_assign
l_int|0xff
suffix:semicolon
id|left-&gt;send_b
op_assign
l_int|0xff
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|volL
OG
id|volR
)paren
(brace
id|vol
op_assign
id|volL
suffix:semicolon
id|left-&gt;send_c
op_assign
l_int|0xff
suffix:semicolon
id|left-&gt;send_b
op_assign
(paren
r_char
)paren
(paren
(paren
id|volR
op_star
l_int|255
)paren
op_div
id|vol
)paren
suffix:semicolon
)brace
r_else
(brace
id|vol
op_assign
id|volR
suffix:semicolon
id|left-&gt;send_b
op_assign
l_int|0xff
suffix:semicolon
id|left-&gt;send_c
op_assign
(paren
r_char
)paren
(paren
(paren
id|volL
op_star
l_int|255
)paren
op_div
id|vol
)paren
suffix:semicolon
)brace
)brace
id|left-&gt;initial_attn
op_assign
l_int|0xff
op_amp
id|sumVolumeToAttenuation
c_func
(paren
id|vol
op_star
l_int|2
)paren
suffix:semicolon
r_return
id|vol
suffix:semicolon
)brace
DECL|function|query_format
r_static
r_void
id|query_format
c_func
(paren
r_struct
id|wave_format
op_star
id|wave_fmt
)paren
(brace
r_if
c_cond
(paren
(paren
id|wave_fmt-&gt;channels
op_ne
l_int|1
)paren
op_logical_and
(paren
id|wave_fmt-&gt;channels
op_ne
l_int|2
)paren
)paren
id|wave_fmt-&gt;channels
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|wave_fmt-&gt;samplingrate
op_ge
l_int|0x2EE00
)paren
id|wave_fmt-&gt;samplingrate
op_assign
l_int|0x2EE00
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wave_fmt-&gt;bitsperchannel
op_ne
l_int|8
)paren
op_logical_and
(paren
id|wave_fmt-&gt;bitsperchannel
op_ne
l_int|16
)paren
)paren
id|wave_fmt-&gt;bitsperchannel
op_assign
l_int|16
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|alloc_xferbuffer
r_static
r_int
id|alloc_xferbuffer
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
comma
r_struct
id|wave_out
op_star
id|wave_out
comma
id|u32
op_star
id|size
comma
r_void
op_star
op_star
op_star
id|buffer
)paren
(brace
id|u32
id|numpages
comma
id|reqsize
comma
id|pageindex
comma
id|pagecount
suffix:semicolon
r_struct
id|wave_xferbuf
op_star
id|wavexferbuf
op_assign
id|wave_out-&gt;wavexferbuf
suffix:semicolon
r_int
r_int
id|busaddx
suffix:semicolon
r_int
id|i
suffix:semicolon
id|reqsize
op_assign
op_star
id|size
suffix:semicolon
id|numpages
op_assign
id|reqsize
op_div
id|PAGE_SIZE
suffix:semicolon
multiline_comment|/* If size is not a multiple of PAGE_SIZE then we need to round up */
r_if
c_cond
(paren
id|reqsize
op_mod
id|PAGE_SIZE
)paren
id|numpages
op_add_assign
l_int|1
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;requested pages is: %d&bslash;n&quot;
comma
id|numpages
)paren
suffix:semicolon
id|wavexferbuf-&gt;numpages
op_assign
id|numpages
suffix:semicolon
multiline_comment|/* Only for playback, request for emu address space */
multiline_comment|/* Support non page-aligned buffer, don&squot;t need interpolation page */
r_if
c_cond
(paren
(paren
id|wave_out-&gt;emupageindex
op_assign
id|emu10k1_addxmgr_alloc
c_func
(paren
id|numpages
op_star
id|PAGE_SIZE
comma
id|card
)paren
)paren
OL
l_int|0
)paren
r_return
id|CTSTATUS_ERROR
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wave_out-&gt;pagetable
op_assign
(paren
r_void
op_star
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_void
op_star
)paren
op_star
id|numpages
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|CTSTATUS_ERROR
suffix:semicolon
multiline_comment|/* Fill in virtual memory table */
r_for
c_loop
(paren
id|pagecount
op_assign
l_int|0
suffix:semicolon
id|pagecount
OL
id|numpages
suffix:semicolon
id|pagecount
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|wave_out-&gt;pagetable
(braket
id|pagecount
)braket
op_assign
(paren
r_void
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|wavexferbuf-&gt;numpages
op_assign
id|pagecount
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;Virtual Addx: %p&bslash;n&quot;
comma
id|wave_out-&gt;pagetable
(braket
id|pagecount
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PAGE_SIZE
op_div
id|EMUPAGESIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|busaddx
op_assign
id|virt_to_bus
c_func
(paren
(paren
id|u8
op_star
)paren
id|wave_out-&gt;pagetable
(braket
id|pagecount
)braket
op_plus
id|i
op_star
id|EMUPAGESIZE
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|3
comma
l_string|&quot;Bus Addx: %lx&bslash;n&quot;
comma
id|busaddx
)paren
suffix:semicolon
id|pageindex
op_assign
id|wave_out-&gt;emupageindex
op_plus
id|pagecount
op_star
id|PAGE_SIZE
op_div
id|EMUPAGESIZE
op_plus
id|i
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|card-&gt;virtualpagetable-&gt;virtaddx
)paren
(braket
id|pageindex
)braket
op_assign
(paren
(paren
id|u32
)paren
id|busaddx
op_star
l_int|2
)paren
op_or
id|pageindex
suffix:semicolon
)brace
)brace
op_star
id|buffer
op_assign
id|wave_out-&gt;pagetable
suffix:semicolon
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
DECL|function|get_xferbuffer
r_static
r_int
id|get_xferbuffer
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
comma
r_struct
id|wave_out
op_star
id|wave_out
comma
id|u32
op_star
id|size
)paren
(brace
r_struct
id|wave_xferbuf
op_star
id|wavexferbuf
op_assign
id|wave_out-&gt;wavexferbuf
suffix:semicolon
r_void
op_star
op_star
id|buffer
suffix:semicolon
id|wavexferbuf-&gt;xferpos
op_assign
l_int|0
suffix:semicolon
id|wavexferbuf-&gt;silence_xferpos
op_assign
l_int|0
suffix:semicolon
id|wavexferbuf-&gt;stopposition
op_assign
l_int|0
suffix:semicolon
id|wavexferbuf-&gt;is_stereo
op_assign
(paren
id|wave_out-&gt;wave_fmt.channels
op_eq
l_int|2
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|wavexferbuf-&gt;is_16bit
op_assign
(paren
id|wave_out-&gt;wave_fmt.bitsperchannel
op_eq
l_int|16
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|wavexferbuf-&gt;bytespersample
op_assign
(paren
id|wavexferbuf-&gt;is_stereo
op_plus
l_int|1
)paren
op_star
(paren
id|wavexferbuf-&gt;is_16bit
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|alloc_xferbuffer
c_func
(paren
id|card
comma
id|wave_out
comma
id|size
comma
op_amp
id|buffer
)paren
op_ne
id|CTSTATUS_SUCCESS
)paren
r_return
id|CTSTATUS_ERROR
suffix:semicolon
multiline_comment|/* xferbufsize contains actual transfer buffer size */
id|wavexferbuf-&gt;xferbufsize
op_assign
op_star
id|size
suffix:semicolon
id|wavexferbuf-&gt;xferbuffer
op_assign
id|buffer
suffix:semicolon
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
DECL|function|dealloc_xferbuffer
r_static
r_void
id|dealloc_xferbuffer
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
comma
r_struct
id|wave_out
op_star
id|wave_out
)paren
(brace
id|u32
id|pagecount
comma
id|pageindex
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;pagetable
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|pagecount
op_assign
l_int|0
suffix:semicolon
id|pagecount
OL
id|wave_out-&gt;wavexferbuf-&gt;numpages
suffix:semicolon
id|pagecount
op_increment
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|wave_out-&gt;pagetable
(braket
id|pagecount
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PAGE_SIZE
op_div
id|EMUPAGESIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pageindex
op_assign
id|wave_out-&gt;emupageindex
op_plus
id|pagecount
op_star
id|PAGE_SIZE
op_div
id|EMUPAGESIZE
op_plus
id|i
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|card-&gt;virtualpagetable-&gt;virtaddx
)paren
(braket
id|pageindex
)braket
op_assign
(paren
id|card-&gt;silentpage-&gt;busaddx
op_star
l_int|2
)paren
op_or
id|pageindex
suffix:semicolon
)brace
)brace
id|kfree
c_func
(paren
id|wave_out-&gt;pagetable
)paren
suffix:semicolon
)brace
id|emu10k1_addxmgr_free
c_func
(paren
id|card
comma
id|wave_out-&gt;emupageindex
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|get_voice
r_static
r_int
id|get_voice
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
comma
r_struct
id|wave_out
op_star
id|wave_out
comma
r_int
id|device
)paren
(brace
r_struct
id|emu10k1_waveout
op_star
id|card_waveout
op_assign
id|card-&gt;waveout
suffix:semicolon
r_struct
id|wave_xferbuf
op_star
id|wavexferbuf
op_assign
id|wave_out-&gt;wavexferbuf
suffix:semicolon
r_struct
id|voice_allocdesc
id|voice_allocdesc
suffix:semicolon
r_struct
id|voice_param
op_star
id|left
comma
op_star
id|right
suffix:semicolon
id|u32
id|size
suffix:semicolon
multiline_comment|/* Allocate voices here, if no voices available, return error.&n;&t; * Init voice_allocdesc first.*/
id|voice_allocdesc.usage
op_assign
id|VOICEMGR_USAGE_PLAYBACK
suffix:semicolon
id|voice_allocdesc.flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|device
op_eq
l_int|1
)paren
id|voice_allocdesc.flags
op_or_assign
id|VOICEMGR_FLAGS_FXRT2
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;wave_fmt.channels
op_eq
l_int|1
)paren
id|voice_allocdesc.flags
op_or_assign
id|VOICEMGR_FLAGS_MONO
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;wave_fmt.bitsperchannel
op_eq
l_int|16
)paren
id|voice_allocdesc.flags
op_or_assign
id|VOICEMGR_FLAGS_16BIT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wave_out-&gt;voice
op_assign
id|emu10k1_voice_alloc
c_func
(paren
op_amp
id|card-&gt;voicemgr
comma
op_amp
id|voice_allocdesc
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|CTSTATUS_ERROR
suffix:semicolon
multiline_comment|/* voice initialization */
id|left
op_assign
op_amp
id|wave_out-&gt;voice-&gt;params
suffix:semicolon
multiline_comment|/* Calculate pitch */
id|left-&gt;initial_pitch
op_assign
(paren
id|u16
)paren
(paren
id|srToPitch
c_func
(paren
id|wave_out-&gt;wave_fmt.samplingrate
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;Initial pitch --&gt; %x&bslash;n&quot;
comma
id|left-&gt;initial_pitch
)paren
suffix:semicolon
multiline_comment|/* Easy way out.. gotta calculate value */
id|left-&gt;pitch_target
op_assign
l_int|0
suffix:semicolon
id|left-&gt;volume_target
op_assign
l_int|0
suffix:semicolon
id|left-&gt;FC_target
op_assign
l_int|0
suffix:semicolon
id|left-&gt;byampl_env_sustain
op_assign
l_int|0x7f
suffix:semicolon
id|left-&gt;byampl_env_decay
op_assign
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;globalreverbFactor
)paren
(brace
id|u8
id|t
op_assign
(paren
id|card_waveout-&gt;globalreverb
op_amp
l_int|0xff
)paren
op_plus
(paren
id|wave_out-&gt;localreverb
op_amp
l_int|0xff
)paren
suffix:semicolon
id|left-&gt;send_a
op_assign
(paren
id|t
OG
l_int|255
)paren
ques
c_cond
l_int|255
suffix:colon
id|t
suffix:semicolon
)brace
r_else
(brace
id|left-&gt;send_a
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wave_out-&gt;globalchorusFactor
)paren
(brace
id|u8
id|t
op_assign
(paren
id|card_waveout-&gt;globalchorus
op_amp
l_int|0xff
)paren
op_plus
(paren
id|wave_out-&gt;localchorus
op_amp
l_int|0xff
)paren
suffix:semicolon
id|left-&gt;send_d
op_assign
(paren
id|t
OG
l_int|255
)paren
ques
c_cond
l_int|255
suffix:colon
id|t
suffix:semicolon
)brace
r_else
(brace
id|left-&gt;send_d
op_assign
l_int|0
suffix:semicolon
)brace
id|set_volume_instance
c_func
(paren
id|card_waveout
comma
id|wave_out
comma
id|left
)paren
suffix:semicolon
id|left-&gt;pan_target
op_assign
id|left-&gt;send_c
suffix:semicolon
id|left-&gt;aux_target
op_assign
id|left-&gt;send_b
suffix:semicolon
id|size
op_assign
id|wavexferbuf-&gt;xferbufsize
op_div
id|wavexferbuf-&gt;bytespersample
suffix:semicolon
id|left-&gt;start
op_assign
l_int|2
op_star
(paren
id|wave_out-&gt;emupageindex
op_lshift
l_int|11
)paren
op_div
id|wavexferbuf-&gt;bytespersample
suffix:semicolon
id|left-&gt;end
op_assign
id|left-&gt;start
op_plus
id|size
suffix:semicolon
id|left-&gt;startloop
op_assign
id|left-&gt;start
suffix:semicolon
id|left-&gt;endloop
op_assign
id|left-&gt;end
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;voice-&gt;linked_voice
)paren
(brace
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;is stereo&bslash;n&quot;
)paren
suffix:semicolon
id|right
op_assign
op_amp
id|wave_out-&gt;voice-&gt;linked_voice-&gt;params
suffix:semicolon
id|right-&gt;initial_pitch
op_assign
id|left-&gt;initial_pitch
suffix:semicolon
multiline_comment|/* Easy way out.. gotta calculate value */
id|right-&gt;pitch_target
op_assign
l_int|0
suffix:semicolon
id|right-&gt;volume_target
op_assign
l_int|0
suffix:semicolon
id|right-&gt;FC_target
op_assign
l_int|0
suffix:semicolon
id|right-&gt;byampl_env_sustain
op_assign
l_int|0x7f
suffix:semicolon
id|right-&gt;byampl_env_decay
op_assign
l_int|0x7f
suffix:semicolon
id|right-&gt;send_d
op_assign
id|left-&gt;send_d
suffix:semicolon
id|right-&gt;send_a
op_assign
id|left-&gt;send_a
suffix:semicolon
multiline_comment|/* Left output of right channel is always zero */
id|right-&gt;send_c
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Update right channel aux */
id|right-&gt;pan_target
op_assign
l_int|0
suffix:semicolon
id|right-&gt;send_b
op_assign
id|left-&gt;send_b
suffix:semicolon
id|right-&gt;aux_target
op_assign
id|right-&gt;send_b
suffix:semicolon
multiline_comment|/* Zero out right output of left channel */
id|left-&gt;send_b
op_assign
l_int|0
suffix:semicolon
id|left-&gt;aux_target
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Update right channel attenuation */
id|right-&gt;initial_attn
op_assign
id|left-&gt;initial_attn
suffix:semicolon
id|right-&gt;start
op_assign
id|left-&gt;start
suffix:semicolon
id|right-&gt;end
op_assign
id|left-&gt;end
suffix:semicolon
id|right-&gt;startloop
op_assign
id|left-&gt;startloop
suffix:semicolon
id|right-&gt;endloop
op_assign
id|left-&gt;endloop
suffix:semicolon
)brace
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;voice: start=%x, end=%x, startloop=%x, endloop=%x&bslash;n&quot;
comma
id|left-&gt;start
comma
id|left-&gt;end
comma
id|left-&gt;startloop
comma
id|left-&gt;endloop
)paren
suffix:semicolon
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
DECL|function|emu10k1_waveout_open
r_int
id|emu10k1_waveout_open
c_func
(paren
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|wave_dev-&gt;card
suffix:semicolon
r_struct
id|woinst
op_star
id|woinst
op_assign
id|wave_dev-&gt;woinst
suffix:semicolon
r_struct
id|wave_out
op_star
id|wave_out
suffix:semicolon
id|u32
id|bytespersec
comma
id|delay
suffix:semicolon
id|u32
id|buffsize
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_waveout_open()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wave_out
op_assign
(paren
r_struct
id|wave_out
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|wave_out
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
id|emu10k1_waveout_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|woinst-&gt;wave_out
op_assign
id|wave_out
suffix:semicolon
multiline_comment|/* Init channel object */
id|wave_out-&gt;state
op_assign
id|CARDWAVE_STATE_STOPPED
suffix:semicolon
id|wave_out-&gt;wave_fmt
op_assign
id|woinst-&gt;wave_fmt
suffix:semicolon
id|wave_out-&gt;voice
op_assign
l_int|NULL
suffix:semicolon
id|wave_out-&gt;emupageindex
op_assign
op_minus
l_int|1
suffix:semicolon
id|wave_out-&gt;wavexferbuf
op_assign
l_int|NULL
suffix:semicolon
id|wave_out-&gt;pagetable
op_assign
l_int|NULL
suffix:semicolon
id|wave_out-&gt;timer
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Assign default local volume */
multiline_comment|/* FIXME: Should we be maxing the initial values like this? */
id|wave_out-&gt;localvol
op_assign
l_int|0xffffffff
suffix:semicolon
id|wave_out-&gt;localreverb
op_assign
l_int|0xffffffff
suffix:semicolon
id|wave_out-&gt;localchorus
op_assign
l_int|0xffffffff
suffix:semicolon
id|wave_out-&gt;globalvolFactor
op_assign
l_int|0xffff
suffix:semicolon
id|wave_out-&gt;globalreverbFactor
op_assign
l_int|0xffff
suffix:semicolon
id|wave_out-&gt;globalchorusFactor
op_assign
l_int|0xffff
suffix:semicolon
id|wave_out-&gt;setpos
op_assign
l_int|0
suffix:semicolon
id|wave_out-&gt;position
op_assign
l_int|0
suffix:semicolon
id|wave_out-&gt;fill_silence
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wave_out-&gt;wavexferbuf
op_assign
(paren
r_struct
id|wave_xferbuf
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|wave_xferbuf
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
id|emu10k1_waveout_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|buffsize
op_assign
id|woinst-&gt;fragment_size
op_star
id|woinst-&gt;numfrags
suffix:semicolon
r_if
c_cond
(paren
id|get_xferbuffer
c_func
(paren
id|card
comma
id|wave_out
comma
op_amp
id|buffsize
)paren
op_ne
id|CTSTATUS_SUCCESS
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
id|emu10k1_waveout_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|woinst-&gt;fragment_size
op_assign
id|buffsize
op_div
id|woinst-&gt;numfrags
suffix:semicolon
id|wave_out-&gt;callbacksize
op_assign
id|woinst-&gt;fragment_size
suffix:semicolon
r_if
c_cond
(paren
id|get_voice
c_func
(paren
id|card
comma
id|wave_out
comma
id|woinst-&gt;device
)paren
op_ne
id|CTSTATUS_SUCCESS
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
id|emu10k1_waveout_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|bytespersec
op_assign
id|wave_out-&gt;wave_fmt.channels
op_star
(paren
id|wave_out-&gt;wave_fmt.bitsperchannel
op_rshift
l_int|3
)paren
op_star
(paren
id|wave_out-&gt;wave_fmt.samplingrate
)paren
suffix:semicolon
id|delay
op_assign
(paren
l_int|48000
op_star
id|wave_out-&gt;callbacksize
)paren
op_div
id|bytespersec
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wave_out-&gt;timer
op_assign
id|emu10k1_timer_install
c_func
(paren
id|card
comma
id|emu10k1_waveout_bh
comma
(paren
r_int
r_int
)paren
id|wave_dev
comma
id|delay
op_div
l_int|2
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
id|emu10k1_waveout_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
DECL|function|emu10k1_waveout_close
r_void
id|emu10k1_waveout_close
c_func
(paren
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|wave_dev-&gt;card
suffix:semicolon
r_struct
id|wave_out
op_star
id|wave_out
op_assign
id|wave_dev-&gt;woinst-&gt;wave_out
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_waveout_close()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;state
op_ne
id|CARDWAVE_STATE_STOPPED
)paren
id|emu10k1_waveout_stop
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;timer
op_ne
l_int|NULL
)paren
id|emu10k1_timer_uninstall
c_func
(paren
id|card
comma
id|wave_out-&gt;timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;voice
op_ne
l_int|NULL
)paren
id|emu10k1_voice_free
c_func
(paren
op_amp
id|card-&gt;voicemgr
comma
id|wave_out-&gt;voice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;emupageindex
op_ge
l_int|0
)paren
id|dealloc_xferbuffer
c_func
(paren
id|card
comma
id|wave_out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;wavexferbuf
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|wave_out-&gt;wavexferbuf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|wave_out
)paren
suffix:semicolon
id|wave_dev-&gt;woinst-&gt;wave_out
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_waveout_start
r_int
id|emu10k1_waveout_start
c_func
(paren
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|wave_dev-&gt;card
suffix:semicolon
r_struct
id|wave_out
op_star
id|wave_out
op_assign
id|wave_dev-&gt;woinst-&gt;wave_out
suffix:semicolon
id|u32
id|start
comma
id|startPosition
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_waveout_start()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* If already started, return success */
r_if
c_cond
(paren
id|wave_out-&gt;state
op_eq
id|CARDWAVE_STATE_STARTED
)paren
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;state
op_eq
id|CARDWAVE_STATE_STOPPED
op_logical_and
id|wave_out-&gt;setpos
)paren
id|startPosition
op_assign
id|wave_out-&gt;position
op_div
(paren
id|wave_out-&gt;wavexferbuf-&gt;bytespersample
)paren
suffix:semicolon
r_else
id|startPosition
op_assign
id|wave_out-&gt;wavexferbuf-&gt;stopposition
suffix:semicolon
id|start
op_assign
id|wave_out-&gt;voice-&gt;params.start
suffix:semicolon
id|wave_out-&gt;voice-&gt;params.start
op_add_assign
id|startPosition
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;CA is %x&bslash;n&quot;
comma
id|wave_out-&gt;voice-&gt;params.start
)paren
suffix:semicolon
id|emu10k1_voice_playback_setup
c_func
(paren
id|wave_out-&gt;voice
)paren
suffix:semicolon
id|wave_out-&gt;voice-&gt;params.start
op_assign
id|start
suffix:semicolon
multiline_comment|/* Actual start */
id|emu10k1_voice_start
c_func
(paren
id|wave_out-&gt;voice
)paren
suffix:semicolon
id|wave_out-&gt;state
op_assign
id|CARDWAVE_STATE_STARTED
suffix:semicolon
id|wave_out-&gt;setpos
op_assign
l_int|0
suffix:semicolon
id|emu10k1_timer_enable
c_func
(paren
id|card
comma
id|wave_out-&gt;timer
)paren
suffix:semicolon
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
DECL|function|emu10k1_waveout_setformat
r_int
id|emu10k1_waveout_setformat
c_func
(paren
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|wave_dev-&gt;card
suffix:semicolon
r_struct
id|woinst
op_star
id|woinst
op_assign
id|wave_dev-&gt;woinst
suffix:semicolon
r_struct
id|wave_out
op_star
id|wave_out
op_assign
id|woinst-&gt;wave_out
suffix:semicolon
id|u32
id|bytespersec
comma
id|delay
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_waveout_setformat()&bslash;n&quot;
)paren
suffix:semicolon
id|query_format
c_func
(paren
op_amp
id|woinst-&gt;wave_fmt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wave_out
op_eq
l_int|NULL
)paren
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;state
op_eq
id|CARDWAVE_STATE_STARTED
)paren
(brace
id|woinst-&gt;wave_fmt
op_assign
id|wave_out-&gt;wave_fmt
suffix:semicolon
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|wave_out-&gt;wave_fmt.samplingrate
op_ne
id|woinst-&gt;wave_fmt.samplingrate
)paren
op_logical_or
(paren
id|wave_out-&gt;wave_fmt.bitsperchannel
op_ne
id|woinst-&gt;wave_fmt.bitsperchannel
)paren
op_logical_or
(paren
id|wave_out-&gt;wave_fmt.channels
op_ne
id|woinst-&gt;wave_fmt.channels
)paren
)paren
(brace
r_struct
id|wave_xferbuf
op_star
id|wavexferbuf
op_assign
id|wave_out-&gt;wavexferbuf
suffix:semicolon
id|emu10k1_timer_uninstall
c_func
(paren
id|card
comma
id|wave_out-&gt;timer
)paren
suffix:semicolon
id|emu10k1_voice_free
c_func
(paren
op_amp
id|card-&gt;voicemgr
comma
id|wave_out-&gt;voice
)paren
suffix:semicolon
id|wave_out-&gt;wave_fmt
op_assign
id|woinst-&gt;wave_fmt
suffix:semicolon
id|wave_out-&gt;timer
op_assign
l_int|NULL
suffix:semicolon
id|wavexferbuf-&gt;xferpos
op_assign
l_int|0
suffix:semicolon
id|wavexferbuf-&gt;silence_xferpos
op_assign
l_int|0
suffix:semicolon
id|wavexferbuf-&gt;stopposition
op_assign
l_int|0
suffix:semicolon
id|wavexferbuf-&gt;is_stereo
op_assign
(paren
id|wave_out-&gt;wave_fmt.channels
op_eq
l_int|2
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|wavexferbuf-&gt;is_16bit
op_assign
(paren
id|wave_out-&gt;wave_fmt.bitsperchannel
op_eq
l_int|16
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|wavexferbuf-&gt;bytespersample
op_assign
(paren
id|wavexferbuf-&gt;is_stereo
op_plus
l_int|1
)paren
op_star
(paren
id|wavexferbuf-&gt;is_16bit
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_voice
c_func
(paren
id|card
comma
id|wave_out
comma
id|woinst-&gt;device
)paren
op_ne
id|CTSTATUS_SUCCESS
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
id|emu10k1_waveout_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|bytespersec
op_assign
id|wave_out-&gt;wave_fmt.channels
op_star
(paren
id|wave_out-&gt;wave_fmt.bitsperchannel
op_rshift
l_int|3
)paren
op_star
(paren
id|wave_out-&gt;wave_fmt.samplingrate
)paren
suffix:semicolon
id|delay
op_assign
(paren
l_int|48000
op_star
id|wave_out-&gt;callbacksize
)paren
op_div
id|bytespersec
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wave_out-&gt;timer
op_assign
id|emu10k1_timer_install
c_func
(paren
id|card
comma
id|emu10k1_waveout_bh
comma
(paren
r_int
r_int
)paren
id|wave_dev
comma
id|delay
op_div
l_int|2
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
id|emu10k1_waveout_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
)brace
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
DECL|function|emu10k1_waveout_stop
r_void
id|emu10k1_waveout_stop
c_func
(paren
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|wave_dev-&gt;card
suffix:semicolon
r_struct
id|wave_out
op_star
id|wave_out
op_assign
id|wave_dev-&gt;woinst-&gt;wave_out
suffix:semicolon
r_struct
id|wave_xferbuf
op_star
id|wavexferbuf
op_assign
id|wave_out-&gt;wavexferbuf
suffix:semicolon
id|u32
id|samples
op_assign
l_int|32
suffix:semicolon
id|u32
id|position
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_waveout_stop()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;state
op_eq
id|CARDWAVE_STATE_STOPPED
)paren
r_return
suffix:semicolon
id|emu10k1_timer_disable
c_func
(paren
id|card
comma
id|wave_out-&gt;timer
)paren
suffix:semicolon
multiline_comment|/* Stop actual voice */
id|emu10k1_voice_stop
c_func
(paren
id|wave_out-&gt;voice
)paren
suffix:semicolon
multiline_comment|/* Save the stop position */
id|emu10k1_voice_getcontrol
c_func
(paren
id|wave_out-&gt;voice
comma
id|CCCA_CURRADDR
comma
op_amp
id|wavexferbuf-&gt;stopposition
)paren
suffix:semicolon
id|wavexferbuf-&gt;stopposition
op_sub_assign
id|wave_out-&gt;voice-&gt;params.start
suffix:semicolon
multiline_comment|/* Refer to voicemgr.c, CA is not started at zero.  We need to take this into account. */
id|position
op_assign
id|wavexferbuf-&gt;stopposition
op_star
id|wavexferbuf-&gt;bytespersample
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wavexferbuf-&gt;is_16bit
)paren
id|samples
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|wavexferbuf-&gt;is_stereo
)paren
id|samples
op_lshift_assign
l_int|1
suffix:semicolon
id|samples
op_sub_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|position
op_ge
id|samples
op_star
(paren
id|wavexferbuf-&gt;is_16bit
op_plus
l_int|1
)paren
)paren
id|position
op_sub_assign
id|samples
op_star
(paren
id|wavexferbuf-&gt;is_16bit
op_plus
l_int|1
)paren
suffix:semicolon
r_else
id|position
op_add_assign
id|wavexferbuf-&gt;xferbufsize
op_minus
id|samples
op_star
(paren
id|wavexferbuf-&gt;is_16bit
op_plus
l_int|1
)paren
suffix:semicolon
id|wavexferbuf-&gt;stopposition
op_assign
id|position
op_div
id|wavexferbuf-&gt;bytespersample
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;position is %x&bslash;n&quot;
comma
id|wavexferbuf-&gt;stopposition
)paren
suffix:semicolon
id|wave_out-&gt;state
op_assign
id|CARDWAVE_STATE_STOPPED
suffix:semicolon
id|wave_out-&gt;setpos
op_assign
l_int|0
suffix:semicolon
id|wave_out-&gt;position
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_waveout_getxfersize
r_void
id|emu10k1_waveout_getxfersize
c_func
(paren
r_struct
id|wave_out
op_star
id|wave_out
comma
id|u32
op_star
id|size
comma
id|u32
op_star
id|pending
comma
id|u32
op_star
id|curpos
)paren
(brace
r_struct
id|wave_xferbuf
op_star
id|wavexferbuf
op_assign
id|wave_out-&gt;wavexferbuf
suffix:semicolon
multiline_comment|/* Get position of current address, this is in no. of bytes in play buffer */
id|emu10k1_waveout_getcontrol
c_func
(paren
id|wave_out
comma
id|WAVECURPOS
comma
id|curpos
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|curpos
OG
id|wavexferbuf-&gt;silence_xferpos
)paren
op_logical_or
(paren
(paren
op_star
id|curpos
op_eq
id|wavexferbuf-&gt;silence_xferpos
)paren
op_logical_and
(paren
id|wave_out-&gt;state
op_eq
id|CARDWAVE_STATE_STARTED
)paren
)paren
op_logical_or
(paren
(paren
op_star
id|curpos
op_eq
id|wavexferbuf-&gt;silence_xferpos
)paren
op_logical_and
(paren
id|wavexferbuf-&gt;silence_xferpos
op_ne
l_int|0
)paren
op_logical_and
(paren
id|wave_out-&gt;state
op_eq
id|CARDWAVE_STATE_STOPPED
)paren
)paren
)paren
(brace
op_star
id|size
op_assign
op_star
id|curpos
op_minus
id|wavexferbuf-&gt;silence_xferpos
suffix:semicolon
op_star
id|pending
op_assign
id|wavexferbuf-&gt;xferbufsize
op_minus
op_star
id|size
suffix:semicolon
)brace
r_else
(brace
op_star
id|pending
op_assign
id|wavexferbuf-&gt;silence_xferpos
op_minus
op_star
id|curpos
suffix:semicolon
op_star
id|size
op_assign
id|wavexferbuf-&gt;xferbufsize
op_minus
op_star
id|pending
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wavexferbuf-&gt;silence_xferpos
op_ne
id|wavexferbuf-&gt;xferpos
)paren
(brace
r_if
c_cond
(paren
op_star
id|pending
OL
id|wave_out-&gt;callbacksize
)paren
(brace
id|wave_out-&gt;fill_silence
op_assign
l_int|2
suffix:semicolon
op_star
id|pending
op_assign
l_int|0
suffix:semicolon
op_star
id|size
op_assign
id|wavexferbuf-&gt;xferbufsize
suffix:semicolon
id|wavexferbuf-&gt;xferpos
op_assign
op_star
id|curpos
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|wave_out-&gt;fill_silence
op_eq
l_int|2
)paren
(brace
op_star
id|pending
op_assign
l_int|0
suffix:semicolon
op_star
id|size
op_assign
id|wavexferbuf-&gt;xferbufsize
suffix:semicolon
id|wavexferbuf-&gt;xferpos
op_assign
op_star
id|curpos
suffix:semicolon
)brace
r_else
(brace
op_star
id|pending
op_sub_assign
id|wave_out-&gt;callbacksize
suffix:semicolon
op_star
id|size
op_add_assign
id|wave_out-&gt;callbacksize
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_star
id|pending
OL
id|wave_out-&gt;callbacksize
)paren
id|wave_out-&gt;fill_silence
op_assign
l_int|1
suffix:semicolon
r_else
id|wave_out-&gt;fill_silence
op_assign
l_int|0
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|copy_block
r_static
r_void
id|copy_block
c_func
(paren
id|u32
id|dst
comma
id|u8
op_star
id|src
comma
id|u32
id|len
comma
r_void
op_star
op_star
id|pt
)paren
(brace
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
id|i
op_assign
id|dst
op_div
id|PAGE_SIZE
suffix:semicolon
id|j
op_assign
id|dst
op_mod
id|PAGE_SIZE
suffix:semicolon
id|k
op_assign
(paren
id|len
OG
id|PAGE_SIZE
op_minus
id|j
)paren
ques
c_cond
id|PAGE_SIZE
op_minus
id|j
suffix:colon
id|len
suffix:semicolon
id|copy_from_user
c_func
(paren
id|pt
(braket
id|i
)braket
op_plus
id|j
comma
id|src
comma
id|k
)paren
suffix:semicolon
id|len
op_sub_assign
id|k
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ge
id|PAGE_SIZE
)paren
(brace
id|copy_from_user
c_func
(paren
id|pt
(braket
op_increment
id|i
)braket
comma
id|src
op_plus
id|k
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|k
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|len
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|copy_from_user
c_func
(paren
id|pt
(braket
op_increment
id|i
)braket
comma
id|src
op_plus
id|k
comma
id|len
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|fill_block
r_static
r_void
id|fill_block
c_func
(paren
id|u32
id|dst
comma
id|u8
id|val
comma
id|u32
id|len
comma
r_void
op_star
op_star
id|pt
)paren
(brace
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
id|i
op_assign
id|dst
op_div
id|PAGE_SIZE
suffix:semicolon
id|j
op_assign
id|dst
op_mod
id|PAGE_SIZE
suffix:semicolon
id|k
op_assign
(paren
id|len
OG
id|PAGE_SIZE
op_minus
id|j
)paren
ques
c_cond
id|PAGE_SIZE
op_minus
id|j
suffix:colon
id|len
suffix:semicolon
id|memset
c_func
(paren
id|pt
(braket
id|i
)braket
op_plus
id|j
comma
id|val
comma
id|k
)paren
suffix:semicolon
id|len
op_sub_assign
id|k
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ge
id|PAGE_SIZE
)paren
(brace
id|memset
c_func
(paren
id|pt
(braket
op_increment
id|i
)braket
comma
id|val
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|len
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|memset
c_func
(paren
id|pt
(braket
op_increment
id|i
)braket
comma
id|val
comma
id|len
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_waveout_xferdata
r_void
id|emu10k1_waveout_xferdata
c_func
(paren
r_struct
id|woinst
op_star
id|woinst
comma
id|u8
op_star
id|data
comma
id|u32
op_star
id|size
)paren
(brace
r_struct
id|wave_out
op_star
id|wave_out
op_assign
id|woinst-&gt;wave_out
suffix:semicolon
r_struct
id|wave_xferbuf
op_star
id|wavexferbuf
op_assign
id|wave_out-&gt;wavexferbuf
suffix:semicolon
id|u32
id|sizetocopy
comma
id|sizetocopy_now
comma
id|start
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|sizetocopy
op_assign
id|min
c_func
(paren
id|wavexferbuf-&gt;xferbufsize
comma
op_star
id|size
)paren
suffix:semicolon
op_star
id|size
op_assign
id|sizetocopy
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sizetocopy
)paren
r_return
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sizetocopy_now
op_assign
id|wavexferbuf-&gt;xferbufsize
op_minus
id|wavexferbuf-&gt;xferpos
suffix:semicolon
id|start
op_assign
id|wavexferbuf-&gt;xferpos
suffix:semicolon
r_if
c_cond
(paren
id|sizetocopy
OG
id|sizetocopy_now
)paren
(brace
id|sizetocopy
op_sub_assign
id|sizetocopy_now
suffix:semicolon
id|wavexferbuf-&gt;xferpos
op_assign
id|sizetocopy
suffix:semicolon
id|wavexferbuf-&gt;silence_xferpos
op_assign
id|wavexferbuf-&gt;xferpos
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|copy_block
c_func
(paren
id|start
comma
id|data
comma
id|sizetocopy_now
comma
id|wavexferbuf-&gt;xferbuffer
)paren
suffix:semicolon
id|copy_block
c_func
(paren
l_int|0
comma
id|data
op_plus
id|sizetocopy_now
comma
id|sizetocopy
comma
id|wavexferbuf-&gt;xferbuffer
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sizetocopy
op_eq
id|sizetocopy_now
)paren
id|wavexferbuf-&gt;xferpos
op_assign
l_int|0
suffix:semicolon
r_else
id|wavexferbuf-&gt;xferpos
op_add_assign
id|sizetocopy
suffix:semicolon
id|wavexferbuf-&gt;silence_xferpos
op_assign
id|wavexferbuf-&gt;xferpos
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|copy_block
c_func
(paren
id|start
comma
id|data
comma
id|sizetocopy
comma
id|wavexferbuf-&gt;xferbuffer
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_waveout_fillsilence
r_void
id|emu10k1_waveout_fillsilence
c_func
(paren
r_struct
id|woinst
op_star
id|woinst
)paren
(brace
r_struct
id|wave_out
op_star
id|wave_out
op_assign
id|woinst-&gt;wave_out
suffix:semicolon
r_struct
id|wave_xferbuf
op_star
id|wavexferbuf
op_assign
id|wave_out-&gt;wavexferbuf
suffix:semicolon
id|u16
id|filldata
suffix:semicolon
id|u32
id|sizetocopy
comma
id|sizetocopy_now
comma
id|start
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|sizetocopy
op_assign
id|wave_out-&gt;callbacksize
suffix:semicolon
r_if
c_cond
(paren
id|wave_out-&gt;wave_fmt.bitsperchannel
op_eq
l_int|8
)paren
id|filldata
op_assign
l_int|0x8080
suffix:semicolon
r_else
id|filldata
op_assign
l_int|0x0000
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sizetocopy_now
op_assign
id|wavexferbuf-&gt;xferbufsize
op_minus
id|wavexferbuf-&gt;silence_xferpos
suffix:semicolon
id|start
op_assign
id|wavexferbuf-&gt;silence_xferpos
suffix:semicolon
r_if
c_cond
(paren
id|sizetocopy
OG
id|sizetocopy_now
)paren
(brace
id|sizetocopy
op_sub_assign
id|sizetocopy_now
suffix:semicolon
id|wavexferbuf-&gt;silence_xferpos
op_assign
id|sizetocopy
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|fill_block
c_func
(paren
id|start
comma
id|filldata
comma
id|sizetocopy_now
comma
id|wavexferbuf-&gt;xferbuffer
)paren
suffix:semicolon
id|fill_block
c_func
(paren
l_int|0
comma
id|filldata
comma
id|sizetocopy
comma
id|wavexferbuf-&gt;xferbuffer
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sizetocopy
op_eq
id|sizetocopy_now
)paren
id|wavexferbuf-&gt;silence_xferpos
op_assign
l_int|0
suffix:semicolon
r_else
id|wavexferbuf-&gt;silence_xferpos
op_add_assign
id|sizetocopy
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|fill_block
c_func
(paren
id|start
comma
id|filldata
comma
id|sizetocopy
comma
id|wavexferbuf-&gt;xferbuffer
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* get the specified control value of the wave device. */
DECL|function|emu10k1_waveout_getcontrol
r_int
id|emu10k1_waveout_getcontrol
c_func
(paren
r_struct
id|wave_out
op_star
id|wave_out
comma
id|u32
id|ctrl_id
comma
id|u32
op_star
id|value
)paren
(brace
r_switch
c_cond
(paren
id|ctrl_id
)paren
(brace
r_case
id|WAVECURPOS
suffix:colon
multiline_comment|/* There is no actual start yet */
r_if
c_cond
(paren
id|wave_out-&gt;state
op_eq
id|CARDWAVE_STATE_STOPPED
)paren
(brace
r_if
c_cond
(paren
id|wave_out-&gt;setpos
)paren
op_star
id|value
op_assign
id|wave_out-&gt;position
suffix:semicolon
r_else
op_star
id|value
op_assign
id|wave_out-&gt;wavexferbuf-&gt;stopposition
op_star
id|wave_out-&gt;wavexferbuf-&gt;bytespersample
suffix:semicolon
)brace
r_else
(brace
id|emu10k1_voice_getcontrol
c_func
(paren
id|wave_out-&gt;voice
comma
id|CCCA_CURRADDR
comma
id|value
)paren
suffix:semicolon
op_star
id|value
op_sub_assign
id|wave_out-&gt;voice-&gt;params.start
suffix:semicolon
multiline_comment|/* Get number of bytes in play buffer per channel.&n;&t;&t;&t; * If 8 bit mode is enabled, this needs to be changed. */
(brace
id|u32
id|samples
op_assign
l_int|64
op_star
(paren
id|wave_out-&gt;wavexferbuf-&gt;is_stereo
op_plus
l_int|1
)paren
suffix:semicolon
op_star
id|value
op_mul_assign
id|wave_out-&gt;wavexferbuf-&gt;bytespersample
suffix:semicolon
multiline_comment|/* Refer to voicemgr.c, CA is not started at zero.&n;&t;&t;&t;&t; * We need to take this into account. */
id|samples
op_sub_assign
l_int|4
op_star
(paren
id|wave_out-&gt;wavexferbuf-&gt;is_16bit
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
op_ge
id|samples
)paren
op_star
id|value
op_sub_assign
id|samples
suffix:semicolon
r_else
op_star
id|value
op_add_assign
id|wave_out-&gt;wavexferbuf-&gt;xferbufsize
op_minus
id|samples
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
eof
