multiline_comment|/*&n; **********************************************************************&n; *     main.c - Creative EMU10K1 audio driver&n; *     Copyright 1999, 2000 Creative Labs, Inc.&n; *&n; **********************************************************************&n; *&n; *     Date                 Author          Summary of changes&n; *     ----                 ------          ------------------&n; *     October 20, 1999     Bertrand Lee    base code release&n; *     November 2, 1999     Alan Cox        cleaned up stuff&n; *&n; **********************************************************************&n; *&n; *     This program is free software; you can redistribute it and/or&n; *     modify it under the terms of the GNU General Public License as&n; *     published by the Free Software Foundation; either version 2 of&n; *     the License, or (at your option) any later version.&n; *&n; *     This program is distributed in the hope that it will be useful,&n; *     but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *     GNU General Public License for more details.&n; *&n; *     You should have received a copy of the GNU General Public&n; *     License along with this program; if not, write to the Free&n; *     Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,&n; *     USA.&n; *&n; **********************************************************************&n; *&n; *      Supported devices:&n; *      /dev/dsp:     Standard /dev/dsp device, OSS-compatible&n; *      /dev/mixer:   Standard /dev/mixer device, OSS-compatible&n; *      /dev/midi:    Raw MIDI UART device, mostly OSS-compatible&n; *&n; *      Revision history:&n; *      0.1 beta Initial release&n; *      0.2 Lowered initial mixer vol. Improved on stuttering wave playback. Added MIDI UART support.&n; *      0.3 Fixed mixer routing bug, added APS, joystick support.&n; *      0.4 Added rear-channel, SPDIF support.&n; *&t;0.5 Source cleanup, SMP fixes, multiopen support, 64 bit arch fixes,&n; *&t;    moved bh&squot;s to tasklets, moved to the new PCI driver initialization style.&n; **********************************************************************&n; */
multiline_comment|/* These are only included once per module */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;hwaccess.h&quot;
macro_line|#include &quot;efxmgr.h&quot;
macro_line|#include &quot;cardwo.h&quot;
macro_line|#include &quot;cardwi.h&quot;
macro_line|#include &quot;cardmo.h&quot;
macro_line|#include &quot;cardmi.h&quot;
macro_line|#include &quot;recmgr.h&quot;
DECL|macro|DRIVER_VERSION
mdefine_line|#define DRIVER_VERSION &quot;0.5&quot;
multiline_comment|/* FIXME: is this right? */
DECL|macro|EMU10K1_DMA_MASK
mdefine_line|#define EMU10K1_DMA_MASK                0xffffffff&t;/* DMA buffer mask for pci_alloc_consist */
macro_line|#ifndef PCI_VENDOR_ID_CREATIVE
DECL|macro|PCI_VENDOR_ID_CREATIVE
mdefine_line|#define PCI_VENDOR_ID_CREATIVE 0x1102
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_CREATIVE_EMU10K1
DECL|macro|PCI_DEVICE_ID_CREATIVE_EMU10K1
mdefine_line|#define PCI_DEVICE_ID_CREATIVE_EMU10K1 0x0002
macro_line|#endif
DECL|macro|EMU10K1_EXTENT
mdefine_line|#define EMU10K1_EXTENT&t;0x20&t;/* 32 byte I/O space */
r_enum
(brace
DECL|enumerator|EMU10K1
id|EMU10K1
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_char
op_star
id|card_names
(braket
)braket
id|__devinitdata
op_assign
(brace
l_string|&quot;EMU10K1&quot;
comma
)brace
suffix:semicolon
DECL|variable|emu10k1_pci_tbl
r_static
r_struct
id|pci_device_id
id|emu10k1_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_CREATIVE
comma
id|PCI_DEVICE_ID_CREATIVE_EMU10K1
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|EMU10K1
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|emu10k1_pci_tbl
)paren
suffix:semicolon
multiline_comment|/* Global var instantiation */
DECL|variable|emu10k1_devs
id|LIST_HEAD
c_func
(paren
id|emu10k1_devs
)paren
suffix:semicolon
r_extern
r_struct
id|file_operations
id|emu10k1_audio_fops
suffix:semicolon
r_extern
r_struct
id|file_operations
id|emu10k1_mixer_fops
suffix:semicolon
r_extern
r_struct
id|file_operations
id|emu10k1_midi_fops
suffix:semicolon
r_extern
r_void
id|emu10k1_interrupt
c_func
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
id|s
)paren
suffix:semicolon
r_extern
r_int
id|emu10k1_mixer_wrch
c_func
(paren
r_struct
id|emu10k1_card
op_star
comma
r_int
r_int
comma
r_int
)paren
suffix:semicolon
DECL|function|audio_init
r_static
r_int
id|__devinit
id|audio_init
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
r_if
c_cond
(paren
(paren
id|card-&gt;waveout
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|emu10k1_waveout
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;emu10k1: Unable to allocate emu10k1_waveout: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;waveout
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|emu10k1_waveout
)paren
)paren
suffix:semicolon
multiline_comment|/* Assign default global volume, reverb, chorus */
id|card-&gt;waveout-&gt;globalvol
op_assign
l_int|0xffffffff
suffix:semicolon
id|card-&gt;waveout-&gt;left
op_assign
l_int|0xffff
suffix:semicolon
id|card-&gt;waveout-&gt;right
op_assign
l_int|0xffff
suffix:semicolon
id|card-&gt;waveout-&gt;mute
op_assign
l_int|0
suffix:semicolon
id|card-&gt;waveout-&gt;globalreverb
op_assign
l_int|0xffffffff
suffix:semicolon
id|card-&gt;waveout-&gt;globalchorus
op_assign
l_int|0xffffffff
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;wavein
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|emu10k1_wavein
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;emu10k1: Unable to allocate emu10k1_wavein: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;wavein
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|emu10k1_wavein
)paren
)paren
suffix:semicolon
id|card-&gt;wavein-&gt;recsrc
op_assign
id|WAVERECORD_AC97
suffix:semicolon
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
DECL|function|mixer_init
r_static
r_void
id|__devinit
id|mixer_init
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
r_int
id|count
suffix:semicolon
r_struct
id|initvol
(brace
r_int
id|mixch
suffix:semicolon
r_int
id|vol
suffix:semicolon
)brace
id|initvol
(braket
)braket
op_assign
(brace
(brace
id|SOUND_MIXER_VOLUME
comma
l_int|0x5050
)brace
comma
(brace
id|SOUND_MIXER_OGAIN
comma
l_int|0x3232
)brace
comma
(brace
id|SOUND_MIXER_SPEAKER
comma
l_int|0x3232
)brace
comma
(brace
id|SOUND_MIXER_PHONEIN
comma
l_int|0x3232
)brace
comma
(brace
id|SOUND_MIXER_MIC
comma
l_int|0x0000
)brace
comma
(brace
id|SOUND_MIXER_LINE
comma
l_int|0x0000
)brace
comma
(brace
id|SOUND_MIXER_CD
comma
l_int|0x3232
)brace
comma
(brace
id|SOUND_MIXER_LINE1
comma
l_int|0x3232
)brace
comma
(brace
id|SOUND_MIXER_LINE3
comma
l_int|0x3232
)brace
comma
(brace
id|SOUND_MIXER_DIGITAL1
comma
l_int|0x6464
)brace
comma
(brace
id|SOUND_MIXER_DIGITAL2
comma
l_int|0x6464
)brace
comma
(brace
id|SOUND_MIXER_PCM
comma
l_int|0x6464
)brace
comma
(brace
id|SOUND_MIXER_RECLEV
comma
l_int|0x3232
)brace
comma
(brace
id|SOUND_MIXER_TREBLE
comma
l_int|0x3232
)brace
comma
(brace
id|SOUND_MIXER_BASS
comma
l_int|0x3232
)brace
comma
(brace
id|SOUND_MIXER_LINE2
comma
l_int|0x4b4b
)brace
)brace
suffix:semicolon
r_int
id|initdig
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|2
comma
l_int|3
comma
l_int|6
comma
l_int|7
comma
l_int|16
comma
l_int|17
comma
l_int|18
comma
l_int|19
comma
l_int|22
comma
l_int|23
comma
l_int|64
comma
l_int|65
comma
l_int|66
comma
l_int|67
comma
l_int|70
comma
l_int|71
comma
l_int|84
comma
l_int|85
)brace
suffix:semicolon
multiline_comment|/* Reset */
id|sblive_writeac97
c_func
(paren
id|card
comma
id|AC97_RESET
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* Check status word */
(brace
id|u16
id|reg
suffix:semicolon
id|sblive_readac97
c_func
(paren
id|card
comma
id|AC97_RESET
comma
op_amp
id|reg
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;RESET 0x%x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
id|sblive_readac97
c_func
(paren
id|card
comma
id|AC97_MASTERTONE
comma
op_amp
id|reg
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;MASTER_TONE 0x%x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Set default recording source to mic in */
id|sblive_writeac97
c_func
(paren
id|card
comma
id|AC97_RECORDSELECT
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Set default AC97 &quot;PCM&quot; volume to acceptable max */
singleline_comment|//sblive_writeac97(card, AC97_PCMOUTVOLUME, 0);
singleline_comment|//sblive_writeac97(card, AC97_LINE2, 0);
multiline_comment|/* Set default volumes for all mixer channels */
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
r_sizeof
(paren
id|card-&gt;digmix
)paren
op_div
r_sizeof
(paren
id|card-&gt;digmix
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|count
op_increment
)paren
(brace
id|card-&gt;digmix
(braket
id|count
)braket
op_assign
l_int|0x80000000
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXGPREGBASE
op_plus
l_int|0x10
op_plus
id|count
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
r_sizeof
(paren
id|initdig
)paren
op_div
r_sizeof
(paren
id|initdig
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|count
op_increment
)paren
(brace
id|card-&gt;digmix
(braket
id|initdig
(braket
id|count
)braket
)braket
op_assign
l_int|0x7fffffff
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXGPREGBASE
op_plus
l_int|0x10
op_plus
id|initdig
(braket
id|count
)braket
comma
l_int|0
comma
l_int|0x7fffffff
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
r_sizeof
(paren
id|initvol
)paren
op_div
r_sizeof
(paren
id|initvol
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|count
op_increment
)paren
(brace
id|emu10k1_mixer_wrch
c_func
(paren
id|card
comma
id|initvol
(braket
id|count
)braket
dot
id|mixch
comma
id|initvol
(braket
id|count
)braket
dot
id|vol
)paren
suffix:semicolon
)brace
id|card-&gt;modcnt
op_assign
l_int|0
suffix:semicolon
singleline_comment|// Should this be here or in open() ?
r_return
suffix:semicolon
)brace
DECL|function|midi_init
r_static
r_int
id|__devinit
id|midi_init
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
r_if
c_cond
(paren
(paren
id|card-&gt;mpuout
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|emu10k1_mpuout
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;emu10k1: Unable to allocate emu10k1_mpuout: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;mpuout
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|emu10k1_mpuout
)paren
)paren
suffix:semicolon
id|card-&gt;mpuout-&gt;intr
op_assign
l_int|1
suffix:semicolon
id|card-&gt;mpuout-&gt;status
op_assign
id|FLAGS_AVAILABLE
suffix:semicolon
id|card-&gt;mpuout-&gt;state
op_assign
id|CARDMIDIOUT_STATE_DEFAULT
suffix:semicolon
id|tasklet_init
c_func
(paren
op_amp
id|card-&gt;mpuout-&gt;tasklet
comma
id|emu10k1_mpuout_bh
comma
(paren
r_int
r_int
)paren
id|card
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;mpuout-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;mpuin
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|emu10k1_mpuin
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|card-&gt;mpuout
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;emu10k1: Unable to allocate emu10k1_mpuin: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;mpuin
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|emu10k1_mpuin
)paren
)paren
suffix:semicolon
id|card-&gt;mpuin-&gt;status
op_assign
id|FLAGS_AVAILABLE
suffix:semicolon
id|tasklet_init
c_func
(paren
op_amp
id|card-&gt;mpuin-&gt;tasklet
comma
id|emu10k1_mpuin_bh
comma
(paren
r_int
r_int
)paren
id|card-&gt;mpuin
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;mpuin-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Reset the MPU port */
r_if
c_cond
(paren
id|emu10k1_mpu_reset
c_func
(paren
id|card
)paren
op_ne
id|CTSTATUS_SUCCESS
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
DECL|function|voice_init
r_static
r_void
id|__devinit
id|voice_init
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
r_struct
id|voice_manager
op_star
id|voicemgr
op_assign
op_amp
id|card-&gt;voicemgr
suffix:semicolon
r_struct
id|emu_voice
op_star
id|voice
suffix:semicolon
r_int
id|i
suffix:semicolon
id|voicemgr-&gt;card
op_assign
id|card
suffix:semicolon
id|voicemgr-&gt;lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|voice
op_assign
id|voicemgr-&gt;voice
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_G
suffix:semicolon
id|i
op_increment
)paren
(brace
id|voice-&gt;card
op_assign
id|card
suffix:semicolon
id|voice-&gt;usage
op_assign
id|VOICEMGR_USAGE_FREE
suffix:semicolon
id|voice-&gt;num
op_assign
id|i
suffix:semicolon
id|voice-&gt;linked_voice
op_assign
l_int|NULL
suffix:semicolon
id|voice
op_increment
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|timer_init
r_static
r_void
id|__devinit
id|timer_init
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|card-&gt;timers
)paren
suffix:semicolon
id|card-&gt;timer_delay
op_assign
id|TIMER_STOPPED
suffix:semicolon
id|card-&gt;timer_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|addxmgr_init
r_static
r_void
id|__devinit
id|addxmgr_init
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
id|u32
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|MAXPAGES
suffix:semicolon
id|count
op_increment
)paren
id|card-&gt;emupagetable
(braket
id|count
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Mark first page as used */
multiline_comment|/* This page is reserved by the driver */
id|card-&gt;emupagetable
(braket
l_int|0
)braket
op_assign
l_int|0x8001
suffix:semicolon
id|card-&gt;emupagetable
(braket
l_int|1
)braket
op_assign
id|MAXPAGES
op_minus
id|RESERVED
op_minus
l_int|1
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|fx_init
r_static
r_void
id|__devinit
id|fx_init
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
r_int
id|i
comma
id|j
comma
id|k
comma
id|l
suffix:semicolon
id|u32
id|pc
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|512
suffix:semicolon
id|i
op_increment
)paren
id|OP
c_func
(paren
l_int|6
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXGPREGBASE
op_plus
id|i
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|pc
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|2
suffix:semicolon
id|j
op_increment
)paren
(brace
id|OP
c_func
(paren
l_int|4
comma
l_int|0x100
comma
l_int|0x40
comma
id|j
comma
l_int|0x44
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|4
comma
l_int|0x101
comma
l_int|0x40
comma
id|j
op_plus
l_int|2
comma
l_int|0x44
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|k
op_assign
id|i
op_star
l_int|16
op_plus
id|j
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
l_int|0x102
comma
l_int|0x40
comma
l_int|0x110
op_plus
id|k
comma
l_int|0x100
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
l_int|0x102
comma
l_int|0x102
comma
l_int|0x112
op_plus
id|k
comma
l_int|0x101
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
l_int|0x102
comma
l_int|0x102
comma
l_int|0x114
op_plus
id|k
comma
l_int|0x10
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
l_int|0x102
comma
l_int|0x102
comma
l_int|0x116
op_plus
id|k
comma
l_int|0x12
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
l_int|0x102
comma
l_int|0x102
comma
l_int|0x118
op_plus
id|k
comma
l_int|0x14
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
l_int|0x102
comma
l_int|0x102
comma
l_int|0x11a
op_plus
id|k
comma
l_int|0x16
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
l_int|0x102
comma
l_int|0x102
comma
l_int|0x11c
op_plus
id|k
comma
l_int|0x18
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
l_int|0x102
comma
l_int|0x102
comma
l_int|0x11e
op_plus
id|k
comma
l_int|0x1a
op_plus
id|j
)paren
suffix:semicolon
id|k
op_assign
l_int|0x190
op_plus
id|i
op_star
l_int|8
op_plus
id|j
op_star
l_int|4
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x102
comma
l_int|0x170
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|7
comma
id|k
op_plus
l_int|1
comma
id|k
comma
id|k
op_plus
l_int|1
comma
l_int|0x174
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|7
comma
id|k
comma
l_int|0x102
comma
id|k
comma
l_int|0x172
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|7
comma
id|k
op_plus
l_int|3
comma
id|k
op_plus
l_int|2
comma
id|k
op_plus
l_int|3
comma
l_int|0x178
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
id|k
op_plus
l_int|2
comma
l_int|0x56
comma
id|k
op_plus
l_int|2
comma
l_int|0x176
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|6
comma
id|k
op_plus
l_int|2
comma
id|k
op_plus
l_int|2
comma
id|k
op_plus
l_int|2
comma
l_int|0x40
)paren
suffix:semicolon
id|l
op_assign
l_int|0x1c0
op_plus
id|i
op_star
l_int|8
op_plus
id|j
op_star
l_int|4
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
l_int|0x40
comma
l_int|0x40
comma
id|k
op_plus
l_int|2
comma
l_int|0x180
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|7
comma
id|l
op_plus
l_int|1
comma
id|l
comma
id|l
op_plus
l_int|1
comma
l_int|0x184
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|7
comma
id|l
comma
id|k
op_plus
l_int|2
comma
id|l
comma
l_int|0x182
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|7
comma
id|l
op_plus
l_int|3
comma
id|l
op_plus
l_int|2
comma
id|l
op_plus
l_int|3
comma
l_int|0x188
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|0
comma
id|l
op_plus
l_int|2
comma
l_int|0x56
comma
id|l
op_plus
l_int|2
comma
l_int|0x186
op_plus
id|j
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|4
comma
id|l
op_plus
l_int|2
comma
l_int|0x40
comma
id|l
op_plus
l_int|2
comma
l_int|0x46
)paren
suffix:semicolon
id|OP
c_func
(paren
l_int|6
comma
l_int|0x20
op_plus
(paren
id|i
op_star
l_int|2
)paren
op_plus
id|j
comma
id|l
op_plus
l_int|2
comma
l_int|0x40
comma
l_int|0x40
)paren
suffix:semicolon
)brace
)brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DBG
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|hw_init
r_static
r_int
id|__devinit
id|hw_init
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
r_int
id|nCh
suffix:semicolon
macro_line|#ifdef TANKMEM
id|u32
id|size
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|u32
id|sizeIdx
op_assign
l_int|0
suffix:semicolon
id|u32
id|pagecount
comma
id|tmp
suffix:semicolon
multiline_comment|/* Disable audio and lock cache */
id|sblive_writefn0
c_func
(paren
id|card
comma
id|HCFG
comma
id|HCFG_LOCKSOUNDCACHE
op_or
id|HCFG_LOCKTANKCACHE
op_or
id|HCFG_MUTEBUTTONENABLE
)paren
suffix:semicolon
multiline_comment|/* Reset recording buffers */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|MICBS
comma
l_int|0
comma
id|ADCBS_BUFSIZE_NONE
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|MICBA
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXBS
comma
l_int|0
comma
id|ADCBS_BUFSIZE_NONE
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXBA
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ADCBS
comma
l_int|0
comma
id|ADCBS_BUFSIZE_NONE
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ADCBA
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Disable channel interrupt */
id|sblive_writefn0
c_func
(paren
id|card
comma
id|INTE
comma
id|DISABLE
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CLIEL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CLIEH
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|SOLEL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|SOLEH
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Init envelope engine */
r_for
c_loop
(paren
id|nCh
op_assign
l_int|0
suffix:semicolon
id|nCh
OL
id|NUM_G
suffix:semicolon
id|nCh
op_increment
)paren
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DCYSUSV
comma
id|nCh
comma
id|ENV_OFF
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|IP
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|VTFT
comma
id|nCh
comma
l_int|0xffff
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CVCF
comma
id|nCh
comma
l_int|0xffff
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTRX
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PSST
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DSL
comma
id|nCh
comma
l_int|0x10
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCCA
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|Z1
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|Z2
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXRT
comma
id|nCh
comma
l_int|0xd01c0000
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ATKHLDM
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DCYSUSM
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|IFATN
comma
id|nCh
comma
l_int|0xffff
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PEFE
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FMMOD
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|TREMFRQ
comma
id|nCh
comma
l_int|24
)paren
suffix:semicolon
multiline_comment|/* 1 Hz */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FM2FRQ2
comma
id|nCh
comma
l_int|24
)paren
suffix:semicolon
multiline_comment|/* 1 Hz */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|TEMPENV
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*** These are last so OFF prevents writing ***/
id|sblive_writeptr
c_func
(paren
id|card
comma
id|LFOVAL2
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|LFOVAL1
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ATKHLDV
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ENVVOL
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ENVVAL
comma
id|nCh
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; ** Init to 0x02109204 :&n;&t; ** Clock accuracy    = 0     (1000ppm)&n;&t; ** Sample Rate       = 2     (48kHz)&n;&t; ** Audio Channel     = 1     (Left of 2)&n;&t; ** Source Number     = 0     (Unspecified)&n;&t; ** Generation Status = 1     (Original for Cat Code 12)&n;&t; ** Cat Code          = 12    (Digital Signal Mixer)&n;&t; ** Mode              = 0     (Mode 0)&n;&t; ** Emphasis          = 0     (None)&n;&t; ** CP                = 1     (Copyright unasserted)&n;&t; ** AN                = 0     (Digital audio)&n;&t; ** P                 = 0     (Consumer)&n;&t; */
multiline_comment|/* SPDIF0 */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|SPCS0
comma
l_int|0
comma
id|SPCS_CLKACCY_1000PPM
op_or
l_int|0x002000000
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
multiline_comment|/* SPDIF1 */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|SPCS1
comma
l_int|0
comma
id|SPCS_CLKACCY_1000PPM
op_or
l_int|0x002000000
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
multiline_comment|/* SPDIF2 &amp; SPDIF3 */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|SPCS2
comma
l_int|0
comma
id|SPCS_CLKACCY_1000PPM
op_or
l_int|0x002000000
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
id|fx_init
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* initialize effects engine */
id|card-&gt;tankmem
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef TANKMEM
id|size
op_assign
id|TMEMSIZE
suffix:semicolon
id|sizeIdx
op_assign
id|TMEMSIZEREG
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|16384
)paren
(brace
r_if
c_cond
(paren
(paren
id|card-&gt;tankmem
op_assign
id|emu10k1_alloc_memphysical
c_func
(paren
id|size
)paren
)paren
op_ne
l_int|NULL
)paren
r_break
suffix:semicolon
id|size
op_div_assign
l_int|2
suffix:semicolon
id|sizeIdx
op_sub_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;tankmem
op_eq
l_int|NULL
)paren
(brace
id|card-&gt;tmemsize
op_assign
l_int|0
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
id|card-&gt;tmemsize
op_assign
id|size
suffix:semicolon
macro_line|#else&t;&t;&t;&t;/* !TANKMEM */
id|card-&gt;tmemsize
op_assign
l_int|0
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* TANKMEM */
r_if
c_cond
(paren
(paren
id|card-&gt;virtualpagetable
op_assign
id|emu10k1_alloc_memphysical
c_func
(paren
(paren
id|MAXPAGES
op_minus
id|RESERVED
)paren
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
id|emu10k1_free_memphysical
c_func
(paren
id|card-&gt;tankmem
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|card-&gt;silentpage
op_assign
id|emu10k1_alloc_memphysical
c_func
(paren
id|EMUPAGESIZE
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
id|emu10k1_free_memphysical
c_func
(paren
id|card-&gt;tankmem
)paren
suffix:semicolon
id|emu10k1_free_memphysical
c_func
(paren
id|card-&gt;virtualpagetable
)paren
suffix:semicolon
r_return
id|CTSTATUS_ERROR
suffix:semicolon
)brace
r_else
id|memset
c_func
(paren
id|card-&gt;silentpage-&gt;virtaddx
comma
l_int|0
comma
id|EMUPAGESIZE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pagecount
op_assign
l_int|0
suffix:semicolon
id|pagecount
OL
(paren
id|MAXPAGES
op_minus
id|RESERVED
)paren
suffix:semicolon
id|pagecount
op_increment
)paren
(paren
(paren
id|u32
op_star
)paren
id|card-&gt;virtualpagetable-&gt;virtaddx
)paren
(braket
id|pagecount
)braket
op_assign
(paren
id|card-&gt;silentpage-&gt;busaddx
op_star
l_int|2
)paren
op_or
id|pagecount
suffix:semicolon
multiline_comment|/* Init page table &amp; tank memory base register */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTB
comma
l_int|0
comma
id|card-&gt;virtualpagetable-&gt;busaddx
)paren
suffix:semicolon
macro_line|#ifdef TANKMEM
id|sblive_writeptr
c_func
(paren
id|card
comma
id|TCB
comma
l_int|0
comma
id|card-&gt;tankmem-&gt;busaddx
)paren
suffix:semicolon
macro_line|#else
id|sblive_writeptr
c_func
(paren
id|card
comma
id|TCB
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|sblive_writeptr
c_func
(paren
id|card
comma
id|TCBS
comma
l_int|0
comma
id|sizeIdx
)paren
suffix:semicolon
r_for
c_loop
(paren
id|nCh
op_assign
l_int|0
suffix:semicolon
id|nCh
OL
id|NUM_G
suffix:semicolon
id|nCh
op_increment
)paren
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|MAPA
comma
id|nCh
comma
id|MAP_PTI_MASK
op_or
(paren
id|card-&gt;silentpage-&gt;busaddx
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|MAPB
comma
id|nCh
comma
id|MAP_PTI_MASK
op_or
(paren
id|card-&gt;silentpage-&gt;busaddx
op_star
l_int|2
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Hokay, now enable the AUD bit */
multiline_comment|/* Enable Audio = 1 */
multiline_comment|/* Mute Disable Audio = 0 */
multiline_comment|/* Lock Tank Memory = 1 */
multiline_comment|/* Lock Sound Memory = 0 */
multiline_comment|/* Auto Mute = 1 */
id|sblive_rmwac97
c_func
(paren
id|card
comma
id|AC97_MASTERVOLUME
comma
l_int|0x8000
comma
l_int|0x8000
)paren
suffix:semicolon
id|sblive_writeac97
c_func
(paren
id|card
comma
id|AC97_MASTERVOLUME
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeac97
c_func
(paren
id|card
comma
id|AC97_PCMOUTVOLUME
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writefn0
c_func
(paren
id|card
comma
id|HCFG
comma
id|HCFG_AUDIOENABLE
op_or
id|HCFG_LOCKTANKCACHE
op_or
id|HCFG_AUTOMUTE
op_or
id|HCFG_JOYENABLE
)paren
suffix:semicolon
multiline_comment|/* TOSLink detection */
id|card-&gt;has_toslink
op_assign
l_int|0
suffix:semicolon
id|tmp
op_assign
id|sblive_readfn0
c_func
(paren
id|card
comma
id|HCFG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
(paren
id|HCFG_GPINPUT0
op_or
id|HCFG_GPINPUT1
)paren
)paren
(brace
id|sblive_writefn0
c_func
(paren
id|card
comma
id|HCFG
comma
id|tmp
op_or
l_int|0x800
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|512
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
(paren
id|sblive_readfn0
c_func
(paren
id|card
comma
id|HCFG
)paren
op_amp
op_complement
l_int|0x800
)paren
)paren
(brace
id|card-&gt;has_toslink
op_assign
l_int|1
suffix:semicolon
id|sblive_writefn0
c_func
(paren
id|card
comma
id|HCFG
comma
id|tmp
)paren
suffix:semicolon
)brace
)brace
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
DECL|function|emu10k1_init
r_static
r_int
id|__devinit
id|emu10k1_init
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
multiline_comment|/* Init Card */
r_if
c_cond
(paren
id|hw_init
c_func
(paren
id|card
)paren
op_ne
id|CTSTATUS_SUCCESS
)paren
r_return
id|CTSTATUS_ERROR
suffix:semicolon
id|voice_init
c_func
(paren
id|card
)paren
suffix:semicolon
id|timer_init
c_func
(paren
id|card
)paren
suffix:semicolon
id|addxmgr_init
c_func
(paren
id|card
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;  hw control register -&gt; %x&bslash;n&quot;
comma
id|sblive_readfn0
c_func
(paren
id|card
comma
id|HCFG
)paren
)paren
suffix:semicolon
r_return
id|CTSTATUS_SUCCESS
suffix:semicolon
)brace
DECL|function|audio_exit
r_static
r_void
id|__devexit
id|audio_exit
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
id|kfree
c_func
(paren
id|card-&gt;waveout
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;wavein
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|midi_exit
r_static
r_void
id|__devexit
id|midi_exit
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
id|tasklet_unlock_wait
c_func
(paren
op_amp
id|card-&gt;mpuout-&gt;tasklet
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;mpuout
)paren
suffix:semicolon
id|tasklet_unlock_wait
c_func
(paren
op_amp
id|card-&gt;mpuin-&gt;tasklet
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;mpuin
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_exit
r_static
r_void
id|__devexit
id|emu10k1_exit
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
)paren
(brace
r_int
id|ch
suffix:semicolon
id|sblive_writefn0
c_func
(paren
id|card
comma
id|INTE
comma
id|DISABLE
)paren
suffix:semicolon
multiline_comment|/** Shutdown the chip **/
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|NUM_G
suffix:semicolon
id|ch
op_increment
)paren
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DCYSUSV
comma
id|ch
comma
id|ENV_OFF
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|NUM_G
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|VTFT
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CVCF
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTRX
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Reset recording buffers */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|MICBS
comma
l_int|0
comma
id|ADCBS_BUFSIZE_NONE
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|MICBA
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXBS
comma
l_int|0
comma
id|ADCBS_BUFSIZE_NONE
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXBA
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXWC
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ADCBS
comma
l_int|0
comma
id|ADCBS_BUFSIZE_NONE
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ADCBA
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|TCBS
comma
l_int|0
comma
id|TCBS_BUFFSIZE_16K
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|TCB
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DBG
comma
l_int|0
comma
l_int|0x8000
)paren
suffix:semicolon
multiline_comment|/* Disable channel interrupt */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CLIEL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CLIEH
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|SOLEL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|SOLEH
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Disable audio and lock cache */
id|sblive_writefn0
c_func
(paren
id|card
comma
id|HCFG
comma
id|HCFG_LOCKSOUNDCACHE
op_or
id|HCFG_LOCKTANKCACHE
op_or
id|HCFG_MUTEBUTTONENABLE
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTB
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|emu10k1_free_memphysical
c_func
(paren
id|card-&gt;silentpage
)paren
suffix:semicolon
id|emu10k1_free_memphysical
c_func
(paren
id|card-&gt;virtualpagetable
)paren
suffix:semicolon
macro_line|#ifdef TANKMEM
id|emu10k1_free_memphysical
c_func
(paren
id|card-&gt;tankmem
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
multiline_comment|/* Driver initialization routine */
DECL|function|emu10k1_probe
r_static
r_int
id|__devinit
id|emu10k1_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|emu10k1_card
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|emu10k1_card
)paren
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; 0x020320
r_if
c_cond
(paren
op_logical_neg
id|pci_dma_supported
c_func
(paren
id|pci_dev
comma
id|EMU10K1_DMA_MASK
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: architecture does not support 32bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pci_dev
)paren
)paren
(brace
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|card-&gt;iobase
op_assign
id|pci_dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
id|request_region
c_func
(paren
id|card-&gt;iobase
comma
id|EMU10K1_EXTENT
comma
id|card_names
(braket
id|pci_id-&gt;driver_data
)braket
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: IO space in use&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|pci_dev-&gt;driver_data
op_assign
id|card
suffix:semicolon
id|pci_dev-&gt;dma_mask
op_assign
id|EMU10K1_DMA_MASK
suffix:semicolon
macro_line|#else
id|pci_set_master
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|card-&gt;iobase
op_assign
id|pci_dev-&gt;base_address
(braket
l_int|0
)braket
op_amp
id|PCI_BASE_ADDRESS_IO_MASK
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|card-&gt;iobase
comma
id|EMU10K1_EXTENT
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: IO space in use&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|request_region
c_func
(paren
id|card-&gt;iobase
comma
id|EMU10K1_EXTENT
comma
id|card_names
(braket
id|pci_id-&gt;driver_data
)braket
)paren
suffix:semicolon
macro_line|#endif
id|card-&gt;irq
op_assign
id|pci_dev-&gt;irq
suffix:semicolon
id|card-&gt;pci_dev
op_assign
id|pci_dev
suffix:semicolon
multiline_comment|/* Reserve IRQ Line */
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|card-&gt;irq
comma
id|emu10k1_interrupt
comma
id|SA_SHIRQ
comma
id|card_names
(braket
id|pci_id-&gt;driver_data
)braket
comma
id|card
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: IRQ in use&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_irq
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
id|PCI_REVISION_ID
comma
op_amp
id|card-&gt;chiprev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;emu10k1: %s rev %d found at IO 0x%04lx, IRQ %d&bslash;n&quot;
comma
id|card_names
(braket
id|pci_id-&gt;driver_data
)braket
comma
id|card-&gt;chiprev
comma
id|card-&gt;iobase
comma
id|card-&gt;irq
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;lock
)paren
suffix:semicolon
id|card-&gt;mixeraddx
op_assign
id|card-&gt;iobase
op_plus
id|AC97DATA
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|card-&gt;open_sem
)paren
suffix:semicolon
id|card-&gt;open_mode
op_assign
l_int|0
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|card-&gt;open_wait
)paren
suffix:semicolon
multiline_comment|/* Register devices */
r_if
c_cond
(paren
(paren
id|card-&gt;audio1_num
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|emu10k1_audio_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: cannot register first audio device!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_dev0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|card-&gt;audio2_num
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|emu10k1_audio_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: cannot register second audio device!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_dev1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|card-&gt;mixer_num
op_assign
id|register_sound_mixer
c_func
(paren
op_amp
id|emu10k1_mixer_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: cannot register mixer device!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_dev2
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|card-&gt;midi_num
op_assign
id|register_sound_midi
c_func
(paren
op_amp
id|emu10k1_midi_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: cannot register midi device!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_dev3
suffix:semicolon
)brace
r_if
c_cond
(paren
id|emu10k1_init
c_func
(paren
id|card
)paren
op_ne
id|CTSTATUS_SUCCESS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: cannot initialize device!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_emu10k1_init
suffix:semicolon
)brace
r_if
c_cond
(paren
id|audio_init
c_func
(paren
id|card
)paren
op_ne
id|CTSTATUS_SUCCESS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: cannot initialize audio!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_audio_init
suffix:semicolon
)brace
r_if
c_cond
(paren
id|midi_init
c_func
(paren
id|card
)paren
op_ne
id|CTSTATUS_SUCCESS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1: cannot initialize midi!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_midi_init
suffix:semicolon
)brace
id|mixer_init
c_func
(paren
id|card
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;Hardware initialized. TRAM allocated: %u bytes&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|card-&gt;tmemsize
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|card-&gt;list
comma
op_amp
id|emu10k1_devs
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_midi_init
suffix:colon
id|audio_exit
c_func
(paren
id|card
)paren
suffix:semicolon
id|err_audio_init
suffix:colon
id|emu10k1_exit
c_func
(paren
id|card
)paren
suffix:semicolon
id|err_emu10k1_init
suffix:colon
id|unregister_sound_midi
c_func
(paren
id|card-&gt;midi_num
)paren
suffix:semicolon
id|err_dev3
suffix:colon
id|unregister_sound_mixer
c_func
(paren
id|card-&gt;mixer_num
)paren
suffix:semicolon
id|err_dev2
suffix:colon
id|unregister_sound_dsp
c_func
(paren
id|card-&gt;audio2_num
)paren
suffix:semicolon
id|err_dev1
suffix:colon
id|unregister_sound_dsp
c_func
(paren
id|card-&gt;audio1_num
)paren
suffix:semicolon
id|err_dev0
suffix:colon
id|free_irq
c_func
(paren
id|card-&gt;irq
comma
id|card
)paren
suffix:semicolon
id|err_irq
suffix:colon
id|release_region
c_func
(paren
id|card-&gt;iobase
comma
id|EMU10K1_EXTENT
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|emu10k1_remove
r_static
r_void
id|__devexit
id|emu10k1_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt; 0x020320
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|pci_dev-&gt;driver_data
suffix:semicolon
macro_line|#else
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|list_entry
c_func
(paren
id|emu10k1_devs.next
comma
r_struct
id|emu10k1_card
comma
id|list
)paren
suffix:semicolon
macro_line|#endif
id|midi_exit
c_func
(paren
id|card
)paren
suffix:semicolon
id|audio_exit
c_func
(paren
id|card
)paren
suffix:semicolon
id|emu10k1_exit
c_func
(paren
id|card
)paren
suffix:semicolon
id|unregister_sound_midi
c_func
(paren
id|card-&gt;midi_num
)paren
suffix:semicolon
id|unregister_sound_mixer
c_func
(paren
id|card-&gt;mixer_num
)paren
suffix:semicolon
id|unregister_sound_dsp
c_func
(paren
id|card-&gt;audio2_num
)paren
suffix:semicolon
id|unregister_sound_dsp
c_func
(paren
id|card-&gt;audio1_num
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|card-&gt;irq
comma
id|card
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|card-&gt;iobase
comma
id|EMU10K1_EXTENT
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|card-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Bertrand Lee, Cai Ying. (Email to: emu10k1-devel@opensource.creative.com)&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Creative EMU10K1 PCI Audio Driver v&quot;
id|DRIVER_VERSION
l_string|&quot;&bslash;nCopyright (C) 1999 Creative Technology Ltd.&quot;
)paren
suffix:semicolon
DECL|variable|emu10k1_pci_driver
r_static
r_struct
id|pci_driver
id|emu10k1_pci_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;emu10k1&quot;
comma
id|id_table
suffix:colon
id|emu10k1_pci_tbl
comma
id|probe
suffix:colon
id|emu10k1_probe
comma
id|remove
suffix:colon
id|emu10k1_remove
comma
)brace
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt; 0x020320
DECL|function|emu10k1_init_module
r_static
r_int
id|__init
id|emu10k1_init_module
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Creative EMU10K1 PCI Audio Driver, version &quot;
id|DRIVER_VERSION
l_string|&quot;, &quot;
id|__TIME__
l_string|&quot; &quot;
id|__DATE__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|pci_module_init
c_func
(paren
op_amp
id|emu10k1_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|emu10k1_cleanup_module
r_static
r_void
id|__exit
id|emu10k1_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|emu10k1_pci_driver
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#else
DECL|function|emu10k1_init_module
r_static
r_int
id|__init
id|emu10k1_init_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
op_assign
id|emu10k1_pci_driver.id_table
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Creative EMU10K1 PCI Audio Driver, version &quot;
id|DRIVER_VERSION
l_string|&quot;, &quot;
id|__TIME__
l_string|&quot; &quot;
id|__DATE__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_while
c_loop
(paren
id|pci_id-&gt;vendor
)paren
(brace
r_while
c_loop
(paren
(paren
id|dev
op_assign
id|pci_find_device
c_func
(paren
id|pci_id-&gt;vendor
comma
id|pci_id-&gt;device
comma
id|dev
)paren
)paren
)paren
id|emu10k1_probe
c_func
(paren
id|dev
comma
id|pci_id
)paren
suffix:semicolon
id|pci_id
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu10k1_cleanup_module
r_static
r_void
id|__exit
id|emu10k1_cleanup_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|emu10k1_devs
)paren
)paren
(brace
id|card
op_assign
id|list_entry
c_func
(paren
id|emu10k1_devs.next
comma
r_struct
id|emu10k1_card
comma
id|list
)paren
suffix:semicolon
id|emu10k1_remove
c_func
(paren
id|card-&gt;pci_dev
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|emu10k1_init_module
id|module_init
c_func
(paren
id|emu10k1_init_module
)paren
suffix:semicolon
DECL|variable|emu10k1_cleanup_module
id|module_exit
c_func
(paren
id|emu10k1_cleanup_module
)paren
suffix:semicolon
eof
