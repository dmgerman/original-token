multiline_comment|/*&n; **********************************************************************&n; *     irqmgr.c - IRQ manager for emu10k1 driver&n; *     Copyright 1999, 2000 Creative Labs, Inc.&n; *&n; **********************************************************************&n; *&n; *     Date                 Author          Summary of changes&n; *     ----                 ------          ------------------&n; *     October 20, 1999     Bertrand Lee    base code release&n; *&n; **********************************************************************&n; *&n; *     This program is free software; you can redistribute it and/or&n; *     modify it under the terms of the GNU General Public License as&n; *     published by the Free Software Foundation; either version 2 of&n; *     the License, or (at your option) any later version.&n; *&n; *     This program is distributed in the hope that it will be useful,&n; *     but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *     GNU General Public License for more details.&n; *&n; *     You should have received a copy of the GNU General Public&n; *     License along with this program; if not, write to the Free&n; *     Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,&n; *     USA.&n; *&n; **********************************************************************&n; */
macro_line|#include &quot;hwaccess.h&quot;
macro_line|#include &quot;8010.h&quot;
macro_line|#include &quot;cardmi.h&quot;
macro_line|#include &quot;cardmo.h&quot;
macro_line|#include &quot;irqmgr.h&quot;
multiline_comment|/* Interrupt handler */
DECL|function|emu10k1_interrupt
r_void
id|emu10k1_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
(paren
r_struct
id|emu10k1_card
op_star
)paren
id|dev_id
suffix:semicolon
id|u32
id|irqstatus
comma
id|tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|irqstatus
op_assign
id|emu10k1_readfn0
c_func
(paren
id|card
comma
id|IPR
)paren
)paren
)paren
r_return
suffix:semicolon
id|DPD
c_func
(paren
l_int|4
comma
l_string|&quot;emu10k1_interrupt called, irq =  %u&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
multiline_comment|/*&n;&t; ** NOTE :&n;&t; ** We do a &squot;while loop&squot; here cos on certain machines, with both&n;&t; ** playback and recording going on at the same time, IRQs will&n;&t; ** stop coming in after a while. Checking IPND indeed shows that&n;&t; ** there are interrupts pending but the PIC says no IRQs pending.&n;&t; ** I suspect that some boards need edge-triggered IRQs but are not&n;&t; ** getting that condition if we don&squot;t completely clear the IPND&n;&t; ** (make sure no more interrupts are pending).&n;&t; ** - Eric&n;&t; */
r_do
(brace
id|DPD
c_func
(paren
l_int|4
comma
l_string|&quot;irq status %x&bslash;n&quot;
comma
id|irqstatus
)paren
suffix:semicolon
id|tmp
op_assign
id|irqstatus
suffix:semicolon
r_if
c_cond
(paren
id|irqstatus
op_amp
id|IRQTYPE_TIMER
)paren
(brace
id|emu10k1_timer_irqhandler
c_func
(paren
id|card
)paren
suffix:semicolon
id|irqstatus
op_and_assign
op_complement
id|IRQTYPE_TIMER
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irqstatus
op_amp
id|IRQTYPE_MPUIN
)paren
(brace
id|emu10k1_mpuin_irqhandler
c_func
(paren
id|card
)paren
suffix:semicolon
id|irqstatus
op_and_assign
op_complement
id|IRQTYPE_MPUIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irqstatus
op_amp
id|IRQTYPE_MPUOUT
)paren
(brace
id|emu10k1_mpuout_irqhandler
c_func
(paren
id|card
)paren
suffix:semicolon
id|irqstatus
op_and_assign
op_complement
id|IRQTYPE_MPUOUT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irqstatus
)paren
id|emu10k1_irq_disable
c_func
(paren
id|card
comma
id|irqstatus
)paren
suffix:semicolon
id|emu10k1_writefn0
c_func
(paren
id|card
comma
id|IPR
comma
id|tmp
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|irqstatus
op_assign
id|emu10k1_readfn0
c_func
(paren
id|card
comma
id|IPR
)paren
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
