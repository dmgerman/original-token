multiline_comment|/*&n; **********************************************************************&n; *     audio.c -- /dev/dsp interface for emu10k1 driver&n; *     Copyright 1999, 2000 Creative Labs, Inc.&n; *&n; **********************************************************************&n; *&n; *     Date                 Author          Summary of changes&n; *     ----                 ------          ------------------&n; *     October 20, 1999     Bertrand Lee    base code release&n; *     November 2, 1999&t;    Alan Cox        cleaned up types/leaks&n; *&n; **********************************************************************&n; *&n; *     This program is free software; you can redistribute it and/or&n; *     modify it under the terms of the GNU General Public License as&n; *     published by the Free Software Foundation; either version 2 of&n; *     the License, or (at your option) any later version.&n; *&n; *     This program is distributed in the hope that it will be useful,&n; *     but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *     GNU General Public License for more details.&n; *&n; *     You should have received a copy of the GNU General Public&n; *     License along with this program; if not, write to the Free&n; *     Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,&n; *     USA.&n; *&n; **********************************************************************&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/wrapper.h&gt;
macro_line|#include &quot;hwaccess.h&quot;
macro_line|#include &quot;cardwo.h&quot;
macro_line|#include &quot;cardwi.h&quot;
macro_line|#include &quot;recmgr.h&quot;
macro_line|#include &quot;irqmgr.h&quot;
macro_line|#include &quot;audio.h&quot;
r_static
r_void
id|calculate_ofrag
c_func
(paren
r_struct
id|woinst
op_star
)paren
suffix:semicolon
r_static
r_void
id|calculate_ifrag
c_func
(paren
r_struct
id|wiinst
op_star
)paren
suffix:semicolon
multiline_comment|/* Audio file operations */
DECL|function|emu10k1_audio_llseek
r_static
id|loff_t
id|emu10k1_audio_llseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|loff_t
id|offset
comma
r_int
id|origin
)paren
(brace
r_return
op_minus
id|ESPIPE
suffix:semicolon
)brace
DECL|function|emu10k1_audio_read
r_static
id|ssize_t
id|emu10k1_audio_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
op_assign
(paren
r_struct
id|emu10k1_wavedevice
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|wiinst
op_star
id|wiinst
op_assign
id|wave_dev-&gt;wiinst
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DPD
c_func
(paren
l_int|3
comma
l_string|&quot;emu10k1_audio_read(), buffer=%p, count=%d&bslash;n&quot;
comma
id|buffer
comma
(paren
id|u32
)paren
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wiinst-&gt;mmapped
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wiinst-&gt;state
op_eq
id|WAVE_STATE_CLOSED
)paren
(brace
id|calculate_ifrag
c_func
(paren
id|wiinst
)paren
suffix:semicolon
r_while
c_loop
(paren
id|emu10k1_wavein_open
c_func
(paren
id|wave_dev
)paren
OL
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|wave_dev-&gt;card-&gt;open_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u32
id|bytestocopy
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_STARTED
)paren
op_logical_and
(paren
id|wave_dev-&gt;enablebits
op_amp
id|PCM_ENABLE_INPUT
)paren
)paren
id|emu10k1_wavein_start
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
id|emu10k1_wavein_update
c_func
(paren
id|wave_dev-&gt;card
comma
id|wiinst
)paren
suffix:semicolon
id|emu10k1_wavein_getxfersize
c_func
(paren
id|wiinst
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|3
comma
l_string|&quot;bytestocopy --&gt; %d&bslash;n&quot;
comma
id|bytestocopy
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bytestocopy
op_ge
id|wiinst-&gt;buffer.fragment_size
)paren
op_logical_or
(paren
id|bytestocopy
op_ge
id|count
)paren
)paren
(brace
id|bytestocopy
op_assign
id|min
c_func
(paren
id|bytestocopy
comma
id|count
)paren
suffix:semicolon
id|emu10k1_wavein_xferdata
c_func
(paren
id|wiinst
comma
(paren
id|u8
op_star
)paren
id|buffer
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
id|count
op_sub_assign
id|bytestocopy
suffix:semicolon
id|buffer
op_add_assign
id|bytestocopy
suffix:semicolon
id|ret
op_add_assign
id|bytestocopy
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
op_logical_or
(paren
op_logical_neg
(paren
id|wave_dev-&gt;enablebits
op_amp
id|PCM_ENABLE_INPUT
)paren
)paren
)paren
r_return
(paren
id|ret
ques
c_cond
id|ret
suffix:colon
op_minus
id|EAGAIN
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|wiinst-&gt;wait_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
(paren
id|ret
ques
c_cond
id|ret
suffix:colon
op_minus
id|ERESTARTSYS
)paren
suffix:semicolon
)brace
)brace
id|DPD
c_func
(paren
l_int|3
comma
l_string|&quot;bytes copied -&gt; %d&bslash;n&quot;
comma
(paren
id|u32
)paren
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|emu10k1_audio_write
r_static
id|ssize_t
id|emu10k1_audio_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
op_assign
(paren
r_struct
id|emu10k1_wavedevice
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|woinst
op_star
id|woinst
op_assign
id|wave_dev-&gt;woinst
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DPD
c_func
(paren
l_int|3
comma
l_string|&quot;emu10k1_audio_write(), buffer=%p, count=%d&bslash;n&quot;
comma
id|buffer
comma
(paren
id|u32
)paren
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppos
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;mmapped
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|woinst-&gt;state
op_eq
id|WAVE_STATE_CLOSED
)paren
(brace
id|calculate_ofrag
c_func
(paren
id|woinst
)paren
suffix:semicolon
r_while
c_loop
(paren
id|emu10k1_waveout_open
c_func
(paren
id|wave_dev
)paren
OL
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|wave_dev-&gt;card-&gt;open_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|u32
id|bytestocopy
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|emu10k1_waveout_update
c_func
(paren
id|woinst
)paren
suffix:semicolon
id|emu10k1_waveout_getxfersize
c_func
(paren
id|woinst
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|3
comma
l_string|&quot;bytestocopy --&gt; %d&bslash;n&quot;
comma
id|bytestocopy
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bytestocopy
op_ge
id|woinst-&gt;buffer.fragment_size
)paren
op_logical_or
(paren
id|bytestocopy
op_ge
id|count
)paren
)paren
(brace
id|bytestocopy
op_assign
id|min
c_func
(paren
id|bytestocopy
comma
id|count
)paren
suffix:semicolon
id|emu10k1_waveout_xferdata
c_func
(paren
id|woinst
comma
(paren
id|u8
op_star
)paren
id|buffer
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
id|count
op_sub_assign
id|bytestocopy
suffix:semicolon
id|buffer
op_add_assign
id|bytestocopy
suffix:semicolon
id|ret
op_add_assign
id|bytestocopy
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|woinst-&gt;total_copied
op_add_assign
id|bytestocopy
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_STARTED
)paren
op_logical_and
(paren
id|wave_dev-&gt;enablebits
op_amp
id|PCM_ENABLE_OUTPUT
)paren
op_logical_and
(paren
id|woinst-&gt;total_copied
op_ge
id|woinst-&gt;buffer.fragment_size
)paren
)paren
id|emu10k1_waveout_start
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
op_logical_or
(paren
op_logical_neg
(paren
id|wave_dev-&gt;enablebits
op_amp
id|PCM_ENABLE_OUTPUT
)paren
)paren
)paren
r_return
(paren
id|ret
ques
c_cond
id|ret
suffix:colon
op_minus
id|EAGAIN
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|woinst-&gt;wait_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
(paren
id|ret
ques
c_cond
id|ret
suffix:colon
op_minus
id|ERESTARTSYS
)paren
suffix:semicolon
)brace
)brace
id|DPD
c_func
(paren
l_int|3
comma
l_string|&quot;bytes copied -&gt; %d&bslash;n&quot;
comma
(paren
id|u32
)paren
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|emu10k1_audio_ioctl
r_static
r_int
id|emu10k1_audio_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
op_assign
(paren
r_struct
id|emu10k1_wavedevice
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|woinst
op_star
id|woinst
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|wiinst
op_star
id|wiinst
op_assign
l_int|NULL
suffix:semicolon
r_int
id|val
op_assign
l_int|0
suffix:semicolon
id|u32
id|bytestocopy
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DPF
c_func
(paren
l_int|4
comma
l_string|&quot;emu10k1_audio_ioctl()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|woinst
op_assign
id|wave_dev-&gt;woinst
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|wiinst
op_assign
id|wave_dev-&gt;wiinst
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|OSS_GETVERSION
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;OSS_GETVERSION:&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_RESET
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_RESET:&bslash;n&quot;
)paren
suffix:semicolon
id|wave_dev-&gt;enablebits
op_assign
id|PCM_ENABLE_OUTPUT
op_or
id|PCM_ENABLE_INPUT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
(brace
r_if
c_cond
(paren
id|woinst-&gt;mmapped
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Undo marking the pages as reserved */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|woinst-&gt;buffer.pages
suffix:semicolon
id|i
op_increment
)paren
id|mem_map_reserve
c_func
(paren
id|virt_to_page
c_func
(paren
id|woinst-&gt;buffer.addr
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
id|emu10k1_waveout_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
)brace
id|woinst-&gt;mmapped
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;total_copied
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;total_played
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;blocks
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
id|emu10k1_wavein_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
id|wiinst-&gt;mmapped
op_assign
l_int|0
suffix:semicolon
id|wiinst-&gt;total_recorded
op_assign
l_int|0
suffix:semicolon
id|wiinst-&gt;blocks
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_SYNC:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
(brace
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_STARTED
)paren
r_while
c_loop
(paren
(paren
id|woinst-&gt;total_played
OL
id|woinst-&gt;total_copied
)paren
op_logical_and
op_logical_neg
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|woinst-&gt;wait_queue
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|woinst-&gt;mmapped
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Undo marking the pages as reserved */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|woinst-&gt;buffer.pages
suffix:semicolon
id|i
op_increment
)paren
id|mem_map_reserve
c_func
(paren
id|virt_to_page
c_func
(paren
id|woinst-&gt;buffer.addr
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
id|emu10k1_waveout_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
)brace
id|woinst-&gt;mmapped
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;total_copied
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;total_played
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;blocks
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
id|emu10k1_wavein_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
id|wiinst-&gt;mmapped
op_assign
l_int|0
suffix:semicolon
id|wiinst-&gt;total_recorded
op_assign
l_int|0
suffix:semicolon
id|wiinst-&gt;blocks
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_SETDUPLEX
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_SETDUPLEX:&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_GETCAPS
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_GETCAPS:&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|DSP_CAP_DUPLEX
op_or
id|DSP_CAP_REALTIME
op_or
id|DSP_CAP_TRIGGER
op_or
id|DSP_CAP_MMAP
op_or
id|DSP_CAP_COPROC
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_SPEED:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;val is %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_struct
id|wave_format
id|format
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|format
op_assign
id|wiinst-&gt;format
suffix:semicolon
id|format.samplingrate
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|emu10k1_wavein_setformat
c_func
(paren
id|wave_dev
comma
op_amp
id|format
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
id|wiinst-&gt;format.samplingrate
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;set recording sampling rate -&gt; %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_struct
id|wave_format
id|format
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|format
op_assign
id|woinst-&gt;format
suffix:semicolon
id|format.samplingrate
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|emu10k1_waveout_setformat
c_func
(paren
id|wave_dev
comma
op_amp
id|format
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
id|woinst-&gt;format.samplingrate
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;set playback sampling rate -&gt; %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|val
op_assign
id|wiinst-&gt;format.samplingrate
suffix:semicolon
r_else
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|val
op_assign
id|woinst-&gt;format.samplingrate
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_STEREO:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; val is %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_struct
id|wave_format
id|format
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|format
op_assign
id|wiinst-&gt;format
suffix:semicolon
id|format.channels
op_assign
id|val
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|emu10k1_wavein_setformat
c_func
(paren
id|wave_dev
comma
op_amp
id|format
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
id|wiinst-&gt;format.channels
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;set recording stereo -&gt; %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_struct
id|wave_format
id|format
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|format
op_assign
id|woinst-&gt;format
suffix:semicolon
id|format.channels
op_assign
id|val
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|emu10k1_waveout_setformat
c_func
(paren
id|wave_dev
comma
op_amp
id|format
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
id|woinst-&gt;format.channels
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;set playback stereo -&gt; %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_CHANNELS
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_CHANNELS:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; val is %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_struct
id|wave_format
id|format
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|format
op_assign
id|wiinst-&gt;format
suffix:semicolon
id|format.channels
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|emu10k1_wavein_setformat
c_func
(paren
id|wave_dev
comma
op_amp
id|format
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
id|wiinst-&gt;format.channels
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;set recording number of channels -&gt; %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_struct
id|wave_format
id|format
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|format
op_assign
id|woinst-&gt;format
suffix:semicolon
id|format.channels
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|emu10k1_waveout_setformat
c_func
(paren
id|wave_dev
comma
op_amp
id|format
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
id|woinst-&gt;format.channels
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;set playback number of channels -&gt; %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|val
op_assign
id|wiinst-&gt;format.channels
suffix:semicolon
r_else
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|val
op_assign
id|woinst-&gt;format.channels
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_GETFMTS
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_GETFMTS:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|val
op_assign
id|AFMT_S16_LE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|val
op_assign
id|AFMT_S16_LE
op_or
id|AFMT_U8
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFMT
suffix:colon
multiline_comment|/* Same as SNDCTL_DSP_SAMPLESIZE */
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_SETFMT:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; val is %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|AFMT_QUERY
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_struct
id|wave_format
id|format
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|format
op_assign
id|wiinst-&gt;format
suffix:semicolon
id|format.bitsperchannel
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|emu10k1_wavein_setformat
c_func
(paren
id|wave_dev
comma
op_amp
id|format
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
id|wiinst-&gt;format.bitsperchannel
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;set recording sample size -&gt; %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_struct
id|wave_format
id|format
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|format
op_assign
id|woinst-&gt;format
suffix:semicolon
id|format.bitsperchannel
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|emu10k1_waveout_setformat
c_func
(paren
id|wave_dev
comma
op_amp
id|format
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
id|woinst-&gt;format.bitsperchannel
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;set playback sample size -&gt; %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
(paren
id|val
op_eq
l_int|16
)paren
ques
c_cond
id|AFMT_S16_LE
suffix:colon
id|AFMT_U8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|val
op_assign
id|wiinst-&gt;format.bitsperchannel
suffix:semicolon
r_else
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|val
op_assign
id|woinst-&gt;format.bitsperchannel
suffix:semicolon
r_return
id|put_user
c_func
(paren
(paren
id|val
op_eq
l_int|16
)paren
ques
c_cond
id|AFMT_S16_LE
suffix:colon
id|AFMT_U8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SOUND_PCM_READ_BITS
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|val
op_assign
id|wiinst-&gt;format.bitsperchannel
suffix:semicolon
r_else
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|val
op_assign
id|woinst-&gt;format.bitsperchannel
suffix:semicolon
r_return
id|put_user
c_func
(paren
(paren
id|val
op_eq
l_int|16
)paren
ques
c_cond
id|AFMT_S16_LE
suffix:colon
id|AFMT_U8
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_RATE
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|val
op_assign
id|wiinst-&gt;format.samplingrate
suffix:semicolon
r_else
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|val
op_assign
id|woinst-&gt;format.samplingrate
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_CHANNELS
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|val
op_assign
id|wiinst-&gt;format.channels
suffix:semicolon
r_else
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|val
op_assign
id|woinst-&gt;format.channels
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SOUND_PCM_WRITE_FILTER
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SOUND_PCM_WRITE_FILTER: not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_PCM_READ_FILTER
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SOUND_PCM_READ_FILTER: not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_SETSYNCRO
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_SETSYNCRO: not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_GETTRIGGER
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_GETTRIGGER:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
(paren
id|wave_dev-&gt;enablebits
op_amp
id|PCM_ENABLE_OUTPUT
)paren
)paren
id|val
op_or_assign
id|PCM_ENABLE_OUTPUT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
(paren
id|wave_dev-&gt;enablebits
op_amp
id|PCM_ENABLE_INPUT
)paren
)paren
id|val
op_or_assign
id|PCM_ENABLE_INPUT
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETTRIGGER
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_SETTRIGGER:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_OUTPUT
)paren
(brace
id|wave_dev-&gt;enablebits
op_or_assign
id|PCM_ENABLE_OUTPUT
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
id|emu10k1_waveout_start
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|wave_dev-&gt;enablebits
op_and_assign
op_complement
id|PCM_ENABLE_OUTPUT
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_STARTED
)paren
id|emu10k1_waveout_stop
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_INPUT
)paren
(brace
id|wave_dev-&gt;enablebits
op_or_assign
id|PCM_ENABLE_INPUT
suffix:semicolon
r_if
c_cond
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
id|emu10k1_wavein_start
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|wave_dev-&gt;enablebits
op_and_assign
op_complement
id|PCM_ENABLE_INPUT
suffix:semicolon
r_if
c_cond
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_STARTED
)paren
id|emu10k1_wavein_stop
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOSPACE
suffix:colon
(brace
id|audio_buf_info
id|info
suffix:semicolon
id|DPF
c_func
(paren
l_int|4
comma
l_string|&quot;SNDCTL_DSP_GETOSPACE:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
(brace
id|emu10k1_waveout_update
c_func
(paren
id|woinst
)paren
suffix:semicolon
id|emu10k1_waveout_getxfersize
c_func
(paren
id|woinst
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
id|info.bytes
op_assign
id|bytestocopy
suffix:semicolon
)brace
r_else
(brace
id|calculate_ofrag
c_func
(paren
id|woinst
)paren
suffix:semicolon
id|info.bytes
op_assign
id|woinst-&gt;buffer.size
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|info.fragstotal
op_assign
id|woinst-&gt;buffer.numfrags
suffix:semicolon
id|info.fragments
op_assign
id|info.bytes
op_div
id|woinst-&gt;buffer.fragment_size
suffix:semicolon
id|info.fragsize
op_assign
id|woinst-&gt;buffer.fragment_size
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_int
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_GETISPACE
suffix:colon
(brace
id|audio_buf_info
id|info
suffix:semicolon
id|DPF
c_func
(paren
l_int|4
comma
l_string|&quot;SNDCTL_DSP_GETISPACE:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
(brace
id|emu10k1_wavein_update
c_func
(paren
id|wave_dev-&gt;card
comma
id|wiinst
)paren
suffix:semicolon
id|emu10k1_wavein_getxfersize
c_func
(paren
id|wiinst
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
id|info.bytes
op_assign
id|bytestocopy
suffix:semicolon
)brace
r_else
(brace
id|calculate_ifrag
c_func
(paren
id|wiinst
)paren
suffix:semicolon
id|info.bytes
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|info.fragstotal
op_assign
id|wiinst-&gt;buffer.numfrags
suffix:semicolon
id|info.fragments
op_assign
id|info.bytes
op_div
id|wiinst-&gt;buffer.fragment_size
suffix:semicolon
id|info.fragsize
op_assign
id|wiinst-&gt;buffer.fragment_size
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_int
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_NONBLOCK
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_NONBLOCK:&bslash;n&quot;
)paren
suffix:semicolon
id|file-&gt;f_flags
op_or_assign
id|O_NONBLOCK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_GETODELAY
suffix:colon
id|DPF
c_func
(paren
l_int|4
comma
l_string|&quot;SNDCTL_DSP_GETODELAY:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
(brace
id|emu10k1_waveout_update
c_func
(paren
id|woinst
)paren
suffix:semicolon
id|emu10k1_waveout_getxfersize
c_func
(paren
id|woinst
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
id|val
op_assign
id|woinst-&gt;buffer.size
op_minus
id|bytestocopy
suffix:semicolon
)brace
r_else
id|val
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETIPTR
suffix:colon
(brace
id|count_info
id|cinfo
suffix:semicolon
id|DPF
c_func
(paren
l_int|4
comma
l_string|&quot;SNDCTL_DSP_GETIPTR: &bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
(brace
id|emu10k1_wavein_update
c_func
(paren
id|wave_dev-&gt;card
comma
id|wiinst
)paren
suffix:semicolon
id|cinfo.ptr
op_assign
id|wiinst-&gt;buffer.hw_pos
suffix:semicolon
id|cinfo.bytes
op_assign
id|cinfo.ptr
op_plus
id|wiinst-&gt;total_recorded
op_minus
id|wiinst-&gt;total_recorded
op_mod
id|wiinst-&gt;buffer.size
suffix:semicolon
id|cinfo.blocks
op_assign
id|cinfo.bytes
op_div
id|wiinst-&gt;buffer.fragment_size
op_minus
id|wiinst-&gt;blocks
suffix:semicolon
id|wiinst-&gt;blocks
op_assign
id|cinfo.bytes
op_div
id|wiinst-&gt;buffer.fragment_size
suffix:semicolon
)brace
r_else
(brace
id|cinfo.ptr
op_assign
l_int|0
suffix:semicolon
id|cinfo.bytes
op_assign
l_int|0
suffix:semicolon
id|cinfo.blocks
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOPTR
suffix:colon
(brace
id|count_info
id|cinfo
suffix:semicolon
id|DPF
c_func
(paren
l_int|4
comma
l_string|&quot;SNDCTL_DSP_GETOPTR:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
(brace
id|emu10k1_waveout_update
c_func
(paren
id|woinst
)paren
suffix:semicolon
id|cinfo.ptr
op_assign
id|woinst-&gt;buffer.hw_pos
suffix:semicolon
id|cinfo.bytes
op_assign
id|cinfo.ptr
op_plus
id|woinst-&gt;total_played
op_minus
id|woinst-&gt;total_played
op_mod
id|woinst-&gt;buffer.size
suffix:semicolon
id|cinfo.blocks
op_assign
id|cinfo.bytes
op_div
id|woinst-&gt;buffer.fragment_size
op_minus
id|woinst-&gt;blocks
suffix:semicolon
id|woinst-&gt;blocks
op_assign
id|cinfo.bytes
op_div
id|woinst-&gt;buffer.fragment_size
suffix:semicolon
)brace
r_else
(brace
id|cinfo.ptr
op_assign
l_int|0
suffix:semicolon
id|cinfo.bytes
op_assign
l_int|0
suffix:semicolon
id|cinfo.blocks
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|woinst-&gt;mmapped
)paren
(brace
id|woinst-&gt;buffer.bytestocopy
op_mod_assign
id|woinst-&gt;buffer.fragment_size
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_GETBLKSIZE:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|calculate_ofrag
c_func
(paren
id|woinst
)paren
suffix:semicolon
id|val
op_assign
id|woinst-&gt;buffer.fragment_size
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|calculate_ifrag
c_func
(paren
id|wiinst
)paren
suffix:semicolon
id|val
op_assign
id|wiinst-&gt;buffer.fragment_size
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_POST
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_STARTED
)paren
op_logical_and
(paren
id|wave_dev-&gt;enablebits
op_amp
id|PCM_ENABLE_OUTPUT
)paren
op_logical_and
(paren
id|woinst-&gt;total_copied
OG
l_int|0
)paren
)paren
id|emu10k1_waveout_start
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_SUBDIVIDE: not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_DSP_SETFRAGMENT:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;val is 0x%x&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* too late to change */
id|woinst-&gt;buffer.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|woinst-&gt;buffer.numfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* too late to change */
id|wiinst-&gt;buffer.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|wiinst-&gt;buffer.numfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDCTL_COPR_LOAD
suffix:colon
(brace
id|copr_buffer
id|buf
suffix:semicolon
id|u32
id|i
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;SNDCTL_COPR_LOAD:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|buf
comma
(paren
id|copr_buffer
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|buf
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buf.command
op_ne
l_int|1
)paren
op_logical_and
(paren
id|buf.command
op_ne
l_int|2
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buf.offs
OL
l_int|0x100
)paren
op_logical_or
(paren
id|buf.offs
OL
l_int|0x000
)paren
op_logical_or
(paren
id|buf.offs
op_plus
id|buf.len
OG
l_int|0x800
)paren
op_logical_or
(paren
id|buf.len
OG
l_int|1000
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|buf.command
op_eq
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|buf.len
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u32
op_star
)paren
id|buf.data
)paren
(braket
id|i
)braket
op_assign
id|sblive_readptr
c_func
(paren
id|wave_dev-&gt;card
comma
id|buf.offs
op_plus
id|i
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
id|copr_buffer
op_star
)paren
id|arg
comma
op_amp
id|buf
comma
r_sizeof
(paren
id|buf
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|buf.len
suffix:semicolon
id|i
op_increment
)paren
id|sblive_writeptr
c_func
(paren
id|wave_dev-&gt;card
comma
id|buf.offs
op_plus
id|i
comma
l_int|0
comma
(paren
(paren
id|u32
op_star
)paren
id|buf.data
)paren
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_default
suffix:colon
multiline_comment|/* Default is unrecognized command */
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;default: 0x%x&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu10k1_audio_mmap
r_static
r_int
id|emu10k1_audio_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
op_assign
(paren
r_struct
id|emu10k1_wavedevice
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_audio_mmap()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma_get_pgoff
c_func
(paren
id|vma
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
(brace
r_struct
id|woinst
op_star
id|woinst
op_assign
id|wave_dev-&gt;woinst
suffix:semicolon
id|u32
id|size
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;state
op_eq
id|WAVE_STATE_CLOSED
)paren
(brace
id|calculate_ofrag
c_func
(paren
id|woinst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|emu10k1_waveout_open
c_func
(paren
id|wave_dev
)paren
OL
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ERROR
c_func
(paren
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Now mark the pages as reserved, otherwise remap_page_range doesn&squot;t do what we want */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|woinst-&gt;buffer.pages
suffix:semicolon
id|i
op_increment
)paren
id|mem_map_reserve
c_func
(paren
id|virt_to_page
c_func
(paren
id|woinst-&gt;buffer.addr
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
(paren
id|PAGE_SIZE
op_star
id|woinst-&gt;buffer.pages
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|woinst-&gt;buffer.pages
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|vma-&gt;vm_start
op_plus
(paren
id|i
op_star
id|PAGE_SIZE
)paren
comma
id|virt_to_phys
c_func
(paren
id|woinst-&gt;buffer.addr
(braket
id|i
)braket
)paren
comma
id|PAGE_SIZE
comma
id|vma-&gt;vm_page_prot
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
id|woinst-&gt;mmapped
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_READ
)paren
(brace
r_struct
id|wiinst
op_star
id|wiinst
op_assign
id|wave_dev-&gt;wiinst
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wiinst-&gt;mmapped
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu10k1_audio_open
r_static
r_int
id|emu10k1_audio_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_struct
id|emu10k1_card
op_star
id|card
suffix:semicolon
r_struct
id|list_head
op_star
id|entry
suffix:semicolon
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_audio_open()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Check for correct device to open */
id|list_for_each
c_func
(paren
id|entry
comma
op_amp
id|emu10k1_devs
)paren
(brace
id|card
op_assign
id|list_entry
c_func
(paren
id|entry
comma
r_struct
id|emu10k1_card
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|card-&gt;audio_num
op_xor
id|minor
)paren
op_amp
op_complement
l_int|0xf
)paren
op_logical_or
op_logical_neg
(paren
(paren
id|card-&gt;audio1_num
op_xor
id|minor
)paren
op_amp
op_complement
l_int|0xf
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry
op_eq
op_amp
id|emu10k1_devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wave_dev
op_assign
(paren
r_struct
id|emu10k1_wavedevice
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|emu10k1_wavedevice
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|wave_dev-&gt;card
op_assign
id|card
suffix:semicolon
id|wave_dev-&gt;wiinst
op_assign
l_int|NULL
suffix:semicolon
id|wave_dev-&gt;woinst
op_assign
l_int|NULL
suffix:semicolon
id|wave_dev-&gt;enablebits
op_assign
id|PCM_ENABLE_OUTPUT
op_or
id|PCM_ENABLE_INPUT
suffix:semicolon
multiline_comment|/* Default */
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
multiline_comment|/* Recording */
r_struct
id|wiinst
op_star
id|wiinst
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wiinst
op_assign
(paren
r_struct
id|wiinst
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|wiinst
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|wiinst-&gt;recsrc
op_assign
id|card-&gt;wavein.recsrc
suffix:semicolon
id|wiinst-&gt;fxwc
op_assign
id|card-&gt;wavein.fxwc
suffix:semicolon
r_switch
c_cond
(paren
id|wiinst-&gt;recsrc
)paren
(brace
r_case
id|WAVERECORD_AC97
suffix:colon
id|wiinst-&gt;format.samplingrate
op_assign
l_int|8000
suffix:semicolon
id|wiinst-&gt;format.bitsperchannel
op_assign
l_int|16
suffix:semicolon
id|wiinst-&gt;format.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WAVERECORD_MIC
suffix:colon
id|wiinst-&gt;format.samplingrate
op_assign
l_int|8000
suffix:semicolon
id|wiinst-&gt;format.bitsperchannel
op_assign
l_int|16
suffix:semicolon
id|wiinst-&gt;format.channels
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WAVERECORD_FX
suffix:colon
id|wiinst-&gt;format.samplingrate
op_assign
l_int|48000
suffix:semicolon
id|wiinst-&gt;format.bitsperchannel
op_assign
l_int|16
suffix:semicolon
id|wiinst-&gt;format.channels
op_assign
id|hweight32
c_func
(paren
id|wiinst-&gt;fxwc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|wiinst-&gt;state
op_assign
id|WAVE_STATE_CLOSED
suffix:semicolon
id|wiinst-&gt;buffer.ossfragshift
op_assign
l_int|0
suffix:semicolon
id|wiinst-&gt;buffer.fragment_size
op_assign
l_int|0
suffix:semicolon
id|wiinst-&gt;buffer.numfrags
op_assign
l_int|0
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|wiinst-&gt;wait_queue
)paren
suffix:semicolon
id|wiinst-&gt;mmapped
op_assign
l_int|0
suffix:semicolon
id|wiinst-&gt;total_recorded
op_assign
l_int|0
suffix:semicolon
id|wiinst-&gt;blocks
op_assign
l_int|0
suffix:semicolon
id|wiinst-&gt;lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|tasklet_init
c_func
(paren
op_amp
id|wiinst-&gt;timer.tasklet
comma
id|emu10k1_wavein_bh
comma
(paren
r_int
r_int
)paren
id|wave_dev
)paren
suffix:semicolon
id|wave_dev-&gt;wiinst
op_assign
id|wiinst
suffix:semicolon
id|emu10k1_wavein_setformat
c_func
(paren
id|wave_dev
comma
op_amp
id|wiinst-&gt;format
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_struct
id|woinst
op_star
id|woinst
suffix:semicolon
r_if
c_cond
(paren
(paren
id|woinst
op_assign
(paren
r_struct
id|woinst
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|woinst
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ERROR
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wave_dev-&gt;wiinst
op_ne
l_int|NULL
)paren
(brace
id|woinst-&gt;format
op_assign
id|wave_dev-&gt;wiinst-&gt;format
suffix:semicolon
)brace
r_else
(brace
id|woinst-&gt;format.samplingrate
op_assign
l_int|8000
suffix:semicolon
id|woinst-&gt;format.bitsperchannel
op_assign
l_int|8
suffix:semicolon
id|woinst-&gt;format.channels
op_assign
l_int|1
suffix:semicolon
)brace
id|woinst-&gt;state
op_assign
id|WAVE_STATE_CLOSED
suffix:semicolon
id|woinst-&gt;buffer.fragment_size
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;buffer.ossfragshift
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;buffer.numfrags
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;device
op_assign
(paren
id|card-&gt;audio1_num
op_eq
id|minor
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|woinst-&gt;wait_queue
)paren
suffix:semicolon
id|woinst-&gt;mmapped
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;total_copied
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;total_played
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;blocks
op_assign
l_int|0
suffix:semicolon
id|woinst-&gt;lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|tasklet_init
c_func
(paren
op_amp
id|woinst-&gt;timer.tasklet
comma
id|emu10k1_waveout_bh
comma
(paren
r_int
r_int
)paren
id|wave_dev
)paren
suffix:semicolon
id|wave_dev-&gt;woinst
op_assign
id|woinst
suffix:semicolon
id|emu10k1_waveout_setformat
c_func
(paren
id|wave_dev
comma
op_amp
id|woinst-&gt;format
)paren
suffix:semicolon
macro_line|#ifdef PRIVATE_PCM_VOLUME
(brace
r_int
id|i
suffix:semicolon
r_int
id|j
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * find out if we&squot;ve already been in this table&n;&t;&t;&t; * xmms reopens dsp on every move of slider&n;&t;&t;&t; * this way we keep the same local pcm for such&n;&t;&t;&t; * process&n;&t;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_PCM_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|files
op_eq
id|current-&gt;files
)paren
r_break
suffix:semicolon
singleline_comment|// here we should select last used memeber
singleline_comment|// improve me in case its not sufficient
r_if
c_cond
(paren
id|j
OL
l_int|0
op_logical_and
op_logical_neg
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|opened
)paren
id|j
op_assign
id|i
suffix:semicolon
)brace
singleline_comment|// current task not found
r_if
c_cond
(paren
id|i
op_eq
id|MAX_PCM_CHANNELS
)paren
(brace
singleline_comment|// add new entry
r_if
c_cond
(paren
id|j
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;emu10k1: too many writters!&bslash;n&quot;
)paren
suffix:semicolon
id|i
op_assign
(paren
id|j
op_ge
l_int|0
)paren
ques
c_cond
id|j
suffix:colon
l_int|0
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;new pcm private %p&bslash;n&quot;
comma
id|current-&gt;files
)paren
suffix:semicolon
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|files
op_assign
id|current-&gt;files
suffix:semicolon
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|mixer
op_assign
id|pcm_last_mixer
suffix:semicolon
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|attn_l
op_assign
l_int|0
suffix:semicolon
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|attn_r
op_assign
l_int|0
suffix:semicolon
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|channel_l
op_assign
id|NUM_G
suffix:semicolon
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|channel_r
op_assign
id|NUM_G
suffix:semicolon
)brace
r_else
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;old pcm private %p  0x%x&bslash;n&quot;
comma
id|current-&gt;files
comma
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|mixer
)paren
suffix:semicolon
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|opened
op_increment
suffix:semicolon
)brace
macro_line|#endif
)brace
id|file-&gt;private_data
op_assign
(paren
r_void
op_star
)paren
id|wave_dev
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu10k1_audio_release
r_static
r_int
id|emu10k1_audio_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
op_assign
(paren
r_struct
id|emu10k1_wavedevice
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|emu10k1_card
op_star
id|card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|card
op_assign
id|wave_dev-&gt;card
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_audio_release()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_struct
id|woinst
op_star
id|woinst
op_assign
id|wave_dev-&gt;woinst
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
(brace
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_STARTED
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|signal_pending
c_func
(paren
id|current
)paren
op_logical_and
(paren
id|woinst-&gt;total_played
OL
id|woinst-&gt;total_copied
)paren
)paren
(brace
id|DPF
c_func
(paren
l_int|4
comma
l_string|&quot;Buffer hasn&squot;t been totally played, sleep....&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|woinst-&gt;wait_queue
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|woinst-&gt;mmapped
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Undo marking the pages as reserved */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|woinst-&gt;buffer.pages
suffix:semicolon
id|i
op_increment
)paren
id|mem_map_reserve
c_func
(paren
id|virt_to_page
c_func
(paren
id|woinst-&gt;buffer.addr
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
id|emu10k1_waveout_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
)brace
macro_line|#ifdef PRIVATE_PCM_VOLUME
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* mark as closed&n;&t;&t;&t; * NOTE: structure remains unchanged for next reopen */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_PCM_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|files
op_eq
id|current-&gt;files
)paren
(brace
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|opened
op_decrement
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* wait for the tasklet (bottom-half) to finish */
id|tasklet_unlock_wait
c_func
(paren
op_amp
id|woinst-&gt;timer.tasklet
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|wave_dev-&gt;woinst
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_struct
id|wiinst
op_star
id|wiinst
op_assign
id|wave_dev-&gt;wiinst
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
id|emu10k1_wavein_close
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tasklet_unlock_wait
c_func
(paren
op_amp
id|wiinst-&gt;timer.tasklet
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|wave_dev-&gt;wiinst
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|card-&gt;open_wait
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu10k1_audio_poll
r_static
r_int
r_int
id|emu10k1_audio_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
op_assign
(paren
r_struct
id|emu10k1_wavedevice
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|woinst
op_star
id|woinst
op_assign
id|wave_dev-&gt;woinst
suffix:semicolon
r_struct
id|wiinst
op_star
id|wiinst
op_assign
id|wave_dev-&gt;wiinst
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|u32
id|bytestocopy
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DPF
c_func
(paren
l_int|4
comma
l_string|&quot;emu10k1_audio_poll()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|woinst-&gt;wait_queue
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|wiinst-&gt;wait_queue
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_OPEN
)paren
(brace
id|emu10k1_waveout_update
c_func
(paren
id|woinst
)paren
suffix:semicolon
id|emu10k1_waveout_getxfersize
c_func
(paren
id|woinst
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytestocopy
op_ge
id|woinst-&gt;buffer.fragment_size
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
r_else
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;mmapped
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wiinst-&gt;state
op_eq
id|WAVE_STATE_CLOSED
)paren
(brace
id|calculate_ifrag
c_func
(paren
id|wiinst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|emu10k1_wavein_open
c_func
(paren
id|wave_dev
)paren
OL
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
id|mask
op_or_assign
id|POLLERR
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_STARTED
)paren
)paren
(brace
id|wave_dev-&gt;enablebits
op_or_assign
id|PCM_ENABLE_INPUT
suffix:semicolon
id|emu10k1_wavein_start
c_func
(paren
id|wave_dev
)paren
suffix:semicolon
)brace
id|emu10k1_wavein_update
c_func
(paren
id|wave_dev-&gt;card
comma
id|wiinst
)paren
suffix:semicolon
id|emu10k1_wavein_getxfersize
c_func
(paren
id|wiinst
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytestocopy
op_ge
id|wiinst-&gt;buffer.fragment_size
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|mask
suffix:semicolon
)brace
DECL|function|calculate_ofrag
r_static
r_void
id|calculate_ofrag
c_func
(paren
r_struct
id|woinst
op_star
id|woinst
)paren
(brace
r_struct
id|waveout_buffer
op_star
id|buffer
op_assign
op_amp
id|woinst-&gt;buffer
suffix:semicolon
id|u32
id|fragsize
suffix:semicolon
r_if
c_cond
(paren
id|buffer-&gt;fragment_size
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer-&gt;ossfragshift
)paren
(brace
id|fragsize
op_assign
(paren
id|woinst-&gt;format.bytespersec
op_star
id|WAVEOUT_DEFAULTFRAGLEN
)paren
op_div
l_int|1000
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|fragsize
)paren
(brace
id|fragsize
op_rshift_assign
l_int|1
suffix:semicolon
id|buffer-&gt;ossfragshift
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|buffer-&gt;ossfragshift
OL
id|WAVEOUT_MINFRAGSHIFT
)paren
id|buffer-&gt;ossfragshift
op_assign
id|WAVEOUT_MINFRAGSHIFT
suffix:semicolon
id|buffer-&gt;fragment_size
op_assign
l_int|1
op_lshift
id|buffer-&gt;ossfragshift
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer-&gt;numfrags
)paren
(brace
id|u32
id|numfrags
suffix:semicolon
id|numfrags
op_assign
(paren
id|woinst-&gt;format.bytespersec
op_star
id|WAVEOUT_DEFAULTBUFLEN
)paren
op_div
(paren
id|buffer-&gt;fragment_size
op_star
l_int|1000
)paren
op_minus
l_int|1
suffix:semicolon
id|buffer-&gt;numfrags
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|numfrags
)paren
(brace
id|numfrags
op_rshift_assign
l_int|1
suffix:semicolon
id|buffer-&gt;numfrags
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|buffer-&gt;numfrags
OL
id|MINFRAGS
)paren
id|buffer-&gt;numfrags
op_assign
id|MINFRAGS
suffix:semicolon
r_if
c_cond
(paren
id|buffer-&gt;numfrags
op_star
id|buffer-&gt;fragment_size
OG
id|WAVEOUT_MAXBUFSIZE
)paren
(brace
id|buffer-&gt;numfrags
op_assign
id|WAVEOUT_MAXBUFSIZE
op_div
id|buffer-&gt;fragment_size
suffix:semicolon
r_if
c_cond
(paren
id|buffer-&gt;numfrags
OL
id|MINFRAGS
)paren
(brace
id|buffer-&gt;numfrags
op_assign
id|MINFRAGS
suffix:semicolon
id|buffer-&gt;fragment_size
op_assign
id|WAVEOUT_MAXBUFSIZE
op_div
id|MINFRAGS
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|buffer-&gt;numfrags
op_star
id|buffer-&gt;fragment_size
OL
id|WAVEOUT_MINBUFSIZE
)paren
id|buffer-&gt;numfrags
op_assign
id|WAVEOUT_MINBUFSIZE
op_div
id|buffer-&gt;fragment_size
suffix:semicolon
id|buffer-&gt;size
op_assign
id|buffer-&gt;fragment_size
op_star
id|buffer-&gt;numfrags
suffix:semicolon
id|buffer-&gt;pages
op_assign
id|buffer-&gt;size
op_div
id|PAGE_SIZE
op_plus
(paren
(paren
id|buffer-&gt;size
op_mod
id|PAGE_SIZE
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; calculated playback fragment_size -&gt; %d&bslash;n&quot;
comma
id|buffer-&gt;fragment_size
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; calculated playback numfrags -&gt; %d&bslash;n&quot;
comma
id|buffer-&gt;numfrags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|calculate_ifrag
r_static
r_void
id|calculate_ifrag
c_func
(paren
r_struct
id|wiinst
op_star
id|wiinst
)paren
(brace
r_struct
id|wavein_buffer
op_star
id|buffer
op_assign
op_amp
id|wiinst-&gt;buffer
suffix:semicolon
id|u32
id|fragsize
comma
id|bufsize
comma
id|size
(braket
l_int|4
)braket
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
id|buffer-&gt;fragment_size
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer-&gt;ossfragshift
)paren
(brace
id|fragsize
op_assign
(paren
id|wiinst-&gt;format.bytespersec
op_star
id|WAVEIN_DEFAULTFRAGLEN
)paren
op_div
l_int|1000
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|fragsize
)paren
(brace
id|fragsize
op_rshift_assign
l_int|1
suffix:semicolon
id|buffer-&gt;ossfragshift
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|buffer-&gt;ossfragshift
OL
id|WAVEIN_MINFRAGSHIFT
)paren
id|buffer-&gt;ossfragshift
op_assign
id|WAVEIN_MINFRAGSHIFT
suffix:semicolon
id|buffer-&gt;fragment_size
op_assign
l_int|1
op_lshift
id|buffer-&gt;ossfragshift
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer-&gt;numfrags
)paren
id|buffer-&gt;numfrags
op_assign
(paren
id|wiinst-&gt;format.bytespersec
op_star
id|WAVEIN_DEFAULTBUFLEN
)paren
op_div
(paren
id|buffer-&gt;fragment_size
op_star
l_int|1000
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|buffer-&gt;numfrags
OL
id|MINFRAGS
)paren
id|buffer-&gt;numfrags
op_assign
id|MINFRAGS
suffix:semicolon
r_if
c_cond
(paren
id|buffer-&gt;numfrags
op_star
id|buffer-&gt;fragment_size
OG
id|WAVEIN_MAXBUFSIZE
)paren
(brace
id|buffer-&gt;numfrags
op_assign
id|WAVEIN_MAXBUFSIZE
op_div
id|buffer-&gt;fragment_size
suffix:semicolon
r_if
c_cond
(paren
id|buffer-&gt;numfrags
OL
id|MINFRAGS
)paren
(brace
id|buffer-&gt;numfrags
op_assign
id|MINFRAGS
suffix:semicolon
id|buffer-&gt;fragment_size
op_assign
id|WAVEIN_MAXBUFSIZE
op_div
id|MINFRAGS
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|buffer-&gt;numfrags
op_star
id|buffer-&gt;fragment_size
OL
id|WAVEIN_MINBUFSIZE
)paren
id|buffer-&gt;numfrags
op_assign
id|WAVEIN_MINBUFSIZE
op_div
id|buffer-&gt;fragment_size
suffix:semicolon
id|bufsize
op_assign
id|buffer-&gt;fragment_size
op_star
id|buffer-&gt;numfrags
suffix:semicolon
r_if
c_cond
(paren
id|bufsize
op_ge
l_int|0x10000
)paren
(brace
id|buffer-&gt;size
op_assign
l_int|0x10000
suffix:semicolon
id|buffer-&gt;sizeregval
op_assign
l_int|0x1f
suffix:semicolon
)brace
r_else
(brace
id|buffer-&gt;size
op_assign
l_int|0
suffix:semicolon
id|size
(braket
l_int|0
)braket
op_assign
l_int|384
suffix:semicolon
id|size
(braket
l_int|1
)braket
op_assign
l_int|448
suffix:semicolon
id|size
(braket
l_int|2
)braket
op_assign
l_int|512
suffix:semicolon
id|size
(braket
l_int|3
)braket
op_assign
l_int|640
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|bufsize
op_ge
id|size
(braket
id|j
)braket
)paren
(brace
id|buffer-&gt;size
op_assign
id|size
(braket
id|j
)braket
suffix:semicolon
id|size
(braket
id|j
)braket
op_mul_assign
l_int|2
suffix:semicolon
id|buffer-&gt;sizeregval
op_assign
id|i
op_star
l_int|4
op_plus
id|j
op_plus
l_int|1
suffix:semicolon
)brace
r_else
r_goto
id|exitloop
suffix:semicolon
id|exitloop
suffix:colon
r_if
c_cond
(paren
id|buffer-&gt;size
op_eq
l_int|0
)paren
(brace
id|buffer-&gt;size
op_assign
l_int|384
suffix:semicolon
id|buffer-&gt;sizeregval
op_assign
l_int|0x01
suffix:semicolon
)brace
)brace
id|buffer-&gt;numfrags
op_assign
id|buffer-&gt;size
op_div
id|buffer-&gt;fragment_size
suffix:semicolon
r_if
c_cond
(paren
id|buffer-&gt;size
op_mod
id|buffer-&gt;fragment_size
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; calculated recording fragment_size -&gt; %d&bslash;n&quot;
comma
id|buffer-&gt;fragment_size
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; calculated recording numfrags -&gt; %d&bslash;n&quot;
comma
id|buffer-&gt;numfrags
)paren
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; buffer size register -&gt; 0x%2x&bslash;n&quot;
comma
id|buffer-&gt;sizeregval
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_wavein_bh
r_void
id|emu10k1_wavein_bh
c_func
(paren
r_int
r_int
id|refdata
)paren
(brace
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
op_assign
(paren
r_struct
id|emu10k1_wavedevice
op_star
)paren
id|refdata
suffix:semicolon
r_struct
id|wiinst
op_star
id|wiinst
op_assign
id|wave_dev-&gt;wiinst
suffix:semicolon
id|u32
id|bytestocopy
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|wiinst-&gt;state
op_amp
id|WAVE_STATE_STARTED
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|emu10k1_wavein_update
c_func
(paren
id|wave_dev-&gt;card
comma
id|wiinst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wiinst-&gt;mmapped
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|emu10k1_wavein_getxfersize
c_func
(paren
id|wiinst
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|wiinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytestocopy
op_ge
id|wiinst-&gt;buffer.fragment_size
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|wiinst-&gt;wait_queue
)paren
suffix:semicolon
r_else
id|DPD
c_func
(paren
l_int|3
comma
l_string|&quot;Not enough transfer size, %d&bslash;n&quot;
comma
id|bytestocopy
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_waveout_bh
r_void
id|emu10k1_waveout_bh
c_func
(paren
r_int
r_int
id|refdata
)paren
(brace
r_struct
id|emu10k1_wavedevice
op_star
id|wave_dev
op_assign
(paren
r_struct
id|emu10k1_wavedevice
op_star
)paren
id|refdata
suffix:semicolon
r_struct
id|woinst
op_star
id|woinst
op_assign
id|wave_dev-&gt;woinst
suffix:semicolon
id|u32
id|bytestocopy
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|woinst-&gt;state
op_amp
id|WAVE_STATE_STARTED
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|emu10k1_waveout_update
c_func
(paren
id|woinst
)paren
suffix:semicolon
id|emu10k1_waveout_getxfersize
c_func
(paren
id|woinst
comma
op_amp
id|bytestocopy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|woinst-&gt;buffer.fill_silence
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|emu10k1_waveout_fillsilence
c_func
(paren
id|woinst
)paren
suffix:semicolon
)brace
r_else
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|woinst-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytestocopy
op_ge
id|woinst-&gt;buffer.fragment_size
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|woinst-&gt;wait_queue
)paren
suffix:semicolon
r_else
id|DPD
c_func
(paren
l_int|3
comma
l_string|&quot;Not enough transfer size -&gt; %d&bslash;n&quot;
comma
id|bytestocopy
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|emu10k1_audio_fops
r_struct
id|file_operations
id|emu10k1_audio_fops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|llseek
suffix:colon
id|emu10k1_audio_llseek
comma
id|read
suffix:colon
id|emu10k1_audio_read
comma
id|write
suffix:colon
id|emu10k1_audio_write
comma
id|poll
suffix:colon
id|emu10k1_audio_poll
comma
id|ioctl
suffix:colon
id|emu10k1_audio_ioctl
comma
id|mmap
suffix:colon
id|emu10k1_audio_mmap
comma
id|open
suffix:colon
id|emu10k1_audio_open
comma
id|release
suffix:colon
id|emu10k1_audio_release
comma
)brace
suffix:semicolon
eof
