multiline_comment|/*&n; **********************************************************************&n; *     voicemgr.c - Voice manager for emu10k1 driver&n; *     Copyright 1999, 2000 Creative Labs, Inc.&n; *&n; **********************************************************************&n; *&n; *     Date                 Author          Summary of changes&n; *     ----                 ------          ------------------&n; *     October 20, 1999     Bertrand Lee    base code release&n; *&n; **********************************************************************&n; *&n; *     This program is free software; you can redistribute it and/or&n; *     modify it under the terms of the GNU General Public License as&n; *     published by the Free Software Foundation; either version 2 of&n; *     the License, or (at your option) any later version.&n; *&n; *     This program is distributed in the hope that it will be useful,&n; *     but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *     GNU General Public License for more details.&n; *&n; *     You should have received a copy of the GNU General Public&n; *     License along with this program; if not, write to the Free&n; *     Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,&n; *     USA.&n; *&n; **********************************************************************&n; */
macro_line|#include &quot;hwaccess.h&quot;
DECL|function|emu10k1_voice_alloc
r_struct
id|emu_voice
op_star
id|emu10k1_voice_alloc
c_func
(paren
r_struct
id|voice_manager
op_star
id|voicemgr
comma
r_struct
id|voice_allocdesc
op_star
id|voiceallocdesc
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|voicemgr-&gt;card
suffix:semicolon
r_struct
id|emu_voice
op_star
id|voice_tmp
op_assign
id|voicemgr-&gt;voice
suffix:semicolon
r_struct
id|emu_voice
op_star
id|voice
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_voice_alloc()&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|voicemgr-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voiceallocdesc-&gt;flags
op_amp
id|VOICEMGR_FLAGS_MONO
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_G
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|voice_tmp
(braket
id|i
)braket
dot
id|usage
op_eq
id|VOICEMGR_USAGE_FREE
)paren
(brace
id|voice_tmp
(braket
id|i
)braket
dot
id|flags
op_assign
id|VOICEMGR_FLAGS_VOICEMASTER
op_or
id|voiceallocdesc-&gt;flags
suffix:semicolon
id|voice_tmp
(braket
id|i
)braket
dot
id|usage
op_assign
id|voiceallocdesc-&gt;usage
suffix:semicolon
id|voice
op_assign
op_amp
id|voice_tmp
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_G
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
r_if
c_cond
(paren
(paren
id|voice_tmp
(braket
id|i
)braket
dot
id|usage
op_eq
id|VOICEMGR_USAGE_FREE
)paren
op_logical_and
(paren
id|voice_tmp
(braket
id|i
op_plus
l_int|1
)braket
dot
id|usage
op_eq
id|VOICEMGR_USAGE_FREE
)paren
)paren
(brace
id|voice_tmp
(braket
id|i
)braket
dot
id|linked_voice
op_assign
op_amp
id|voice_tmp
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|voice_tmp
(braket
id|i
)braket
dot
id|flags
op_assign
id|VOICEMGR_FLAGS_VOICEMASTER
op_or
id|voiceallocdesc-&gt;flags
suffix:semicolon
id|voice_tmp
(braket
id|i
)braket
dot
id|usage
op_assign
id|voiceallocdesc-&gt;usage
suffix:semicolon
id|voice_tmp
(braket
id|i
op_plus
l_int|1
)braket
dot
id|flags
op_assign
id|VOICEMGR_FLAGS_STEREOSLAVE
op_or
id|voiceallocdesc-&gt;flags
suffix:semicolon
id|voice_tmp
(braket
id|i
op_plus
l_int|1
)braket
dot
id|usage
op_assign
id|voiceallocdesc-&gt;usage
suffix:semicolon
id|voice
op_assign
op_amp
id|voice_tmp
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|voicemgr-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|voice_tmp
op_assign
id|voice
suffix:semicolon
r_while
c_loop
(paren
id|voice_tmp
op_ne
l_int|NULL
)paren
(brace
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; voice allocated -&gt; %d&bslash;n&quot;
comma
id|voice_tmp-&gt;num
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|IFATN
comma
id|voice_tmp-&gt;num
comma
l_int|0xffff
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DCYSUSV
comma
id|voice_tmp-&gt;num
comma
id|ENV_OFF
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|VTFT
comma
id|voice_tmp-&gt;num
comma
l_int|0xffff
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTRX
comma
id|voice_tmp-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|voice_tmp
op_assign
id|voice_tmp-&gt;linked_voice
suffix:semicolon
)brace
r_return
id|voice
suffix:semicolon
)brace
DECL|function|emu10k1_voice_free
r_void
id|emu10k1_voice_free
c_func
(paren
r_struct
id|voice_manager
op_star
id|voicemgr
comma
r_struct
id|emu_voice
op_star
id|voice
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|voice-&gt;card
suffix:semicolon
r_struct
id|emu_voice
op_star
id|voice_tmp
suffix:semicolon
r_int
id|dcysusv
suffix:semicolon
id|u32
id|cra
comma
id|sample
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_voice_free()&bslash;n&quot;
)paren
suffix:semicolon
id|voice_tmp
op_assign
id|voice
suffix:semicolon
r_while
c_loop
(paren
id|voice_tmp
op_ne
l_int|NULL
)paren
(brace
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; voice freed -&gt; %d&bslash;n&quot;
comma
id|voice_tmp-&gt;num
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|IFATN
comma
id|voice_tmp-&gt;num
comma
id|IFATN_FILTERCUTOFF_MASK
op_or
id|IFATN_ATTENUATION_MASK
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|IP
comma
id|voice_tmp-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|dcysusv
op_assign
id|sblive_readptr
c_func
(paren
id|card
comma
id|DCYSUSV
comma
id|voice_tmp-&gt;num
)paren
op_amp
(paren
id|DCYSUSV_PHASE1_MASK
op_or
id|DCYSUSV_SUSTAINLEVEL_MASK
op_or
id|DCYSUSV_DECAYTIME_MASK
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DCYSUSV
comma
id|voice_tmp-&gt;num
comma
id|dcysusv
op_or
id|ENV_OFF
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|VTFT
comma
id|voice_tmp-&gt;num
comma
id|VTFT_FILTERTARGET_MASK
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTRX_PITCHTARGET
comma
id|voice_tmp-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CVCF
comma
id|voice_tmp-&gt;num
comma
id|CVCF_CURRENTFILTER_MASK
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF
comma
id|voice_tmp-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|sample
op_assign
(paren
id|voice_tmp-&gt;flags
op_amp
id|VOICEMGR_FLAGS_16BIT
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|0x80808080
suffix:semicolon
id|cra
op_assign
id|sblive_readptr
c_func
(paren
id|card
comma
id|CCR
comma
id|voice_tmp-&gt;num
)paren
op_amp
id|CCR_READADDRESS_MASK
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR
comma
id|voice_tmp-&gt;num
comma
id|cra
)paren
suffix:semicolon
id|cra
op_assign
(paren
id|cra
op_rshift
l_int|18
)paren
op_amp
l_int|0xf
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CD0
op_plus
id|cra
comma
id|voice_tmp-&gt;num
comma
id|sample
)paren
suffix:semicolon
id|cra
op_assign
(paren
id|cra
op_plus
l_int|0x1
)paren
op_amp
l_int|0xf
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CD0
op_plus
id|cra
comma
id|voice_tmp-&gt;num
comma
id|sample
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_FXSENDS
suffix:semicolon
id|i
op_increment
)paren
id|voice_tmp-&gt;sendhandle
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|voice_tmp-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|voicemgr-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|voice_tmp-&gt;usage
op_assign
id|VOICEMGR_USAGE_FREE
suffix:semicolon
id|voice_tmp
op_assign
id|voice_tmp-&gt;linked_voice
suffix:semicolon
id|voice-&gt;linked_voice
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|voicemgr-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*       Sets up a voices for Wave Playback */
DECL|function|emu10k1_voice_playback_setup
r_void
id|emu10k1_voice_playback_setup
c_func
(paren
r_struct
id|emu_voice
op_star
id|voice
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|voice-&gt;card
suffix:semicolon
id|u32
id|sample
comma
id|cra
op_assign
l_int|0
comma
id|start
op_assign
l_int|0
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_voice_playback_setup()&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|voice
op_ne
l_int|NULL
)paren
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DCYSUSV
comma
id|voice-&gt;num
comma
id|ENV_OFF
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|VTFT
comma
id|voice-&gt;num
comma
id|VTFT_FILTERTARGET_MASK
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CVCF
comma
id|voice-&gt;num
comma
id|CVCF_CURRENTFILTER_MASK
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXRT
comma
id|voice-&gt;num
comma
(paren
id|voice-&gt;flags
op_amp
id|VOICEMGR_FLAGS_FXRT2
)paren
ques
c_cond
l_int|0xd23c0000
suffix:colon
l_int|0xd01c0000
)paren
suffix:semicolon
multiline_comment|/* Stop CA */
multiline_comment|/* Assumption that PT is alreadt 0 so no harm overwriting */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTRX
comma
id|voice-&gt;num
comma
(paren
id|voice-&gt;params.send_a
op_lshift
l_int|8
)paren
op_or
id|voice-&gt;params.send_b
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICEMGR_FLAGS_VOICEMASTER
)paren
(brace
r_if
c_cond
(paren
id|voice-&gt;linked_voice
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* Set stereo bit */
id|cra
op_assign
l_int|64
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF
comma
id|voice-&gt;num
comma
id|CPF_STEREO_MASK
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF
comma
id|voice-&gt;num
op_plus
l_int|1
comma
id|CPF_STEREO_MASK
)paren
suffix:semicolon
)brace
r_else
(brace
id|cra
op_assign
l_int|32
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICEMGR_FLAGS_16BIT
)paren
id|sample
op_assign
l_int|0
suffix:semicolon
r_else
(brace
id|cra
op_assign
id|cra
op_star
l_int|2
suffix:semicolon
id|sample
op_assign
l_int|0x80808080
suffix:semicolon
)brace
id|cra
op_sub_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;linked_voice
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* CCR_READADDRESS_MASK */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR
comma
id|voice-&gt;num
comma
l_int|0x3c
op_lshift
l_int|16
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR
comma
id|voice-&gt;num
op_plus
l_int|1
comma
id|cra
op_lshift
l_int|16
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CDE
comma
id|voice-&gt;num
op_plus
l_int|1
comma
id|sample
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CDF
comma
id|voice-&gt;num
op_plus
l_int|1
comma
id|sample
)paren
suffix:semicolon
id|start
op_assign
id|voice-&gt;params.start
op_plus
id|cra
op_div
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR
comma
id|voice-&gt;num
comma
l_int|0x1c
op_lshift
l_int|16
)paren
suffix:semicolon
multiline_comment|/* FIXME: Is 0x1c correct? */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CDE
comma
id|voice-&gt;num
comma
id|sample
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CDF
comma
id|voice-&gt;num
comma
id|sample
)paren
suffix:semicolon
id|start
op_assign
id|voice-&gt;params.start
op_plus
id|cra
suffix:semicolon
)brace
r_if
c_cond
(paren
id|start
OG
id|voice-&gt;params.endloop
)paren
(brace
id|start
op_sub_assign
id|voice-&gt;params.endloop
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;linked_voice
op_ne
l_int|NULL
)paren
id|cra
op_assign
(paren
id|cra
op_lshift
l_int|25
)paren
op_or
l_int|0x1bc0000
op_or
(paren
(paren
id|cra
op_minus
id|start
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
r_else
id|cra
op_assign
(paren
id|cra
op_lshift
l_int|25
)paren
op_or
l_int|0x11c0000
op_or
(paren
(paren
id|cra
op_minus
id|start
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
id|start
op_add_assign
id|voice-&gt;params.startloop
suffix:semicolon
r_if
c_cond
(paren
id|start
op_ge
id|voice-&gt;params.endloop
)paren
id|start
op_assign
id|voice-&gt;params.endloop
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|voice-&gt;linked_voice
op_ne
l_int|NULL
)paren
id|cra
op_assign
(paren
id|cra
op_lshift
l_int|25
)paren
op_or
(paren
l_int|0x3c
op_lshift
l_int|16
)paren
suffix:semicolon
r_else
id|cra
op_assign
(paren
id|cra
op_lshift
l_int|25
)paren
op_or
(paren
l_int|0x1c
op_lshift
l_int|16
)paren
suffix:semicolon
id|start
op_or_assign
id|CCCA_INTERPROM_0
suffix:semicolon
)brace
multiline_comment|/* CSL, ST, CA */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DSL
comma
id|voice-&gt;num
comma
id|voice-&gt;params.endloop
op_or
(paren
id|voice-&gt;params.send_d
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PSST
comma
id|voice-&gt;num
comma
id|voice-&gt;params.startloop
op_or
(paren
id|voice-&gt;params.send_c
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICEMGR_FLAGS_16BIT
)paren
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCCA
comma
id|voice-&gt;num
comma
id|start
)paren
suffix:semicolon
r_else
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCCA
comma
id|voice-&gt;num
comma
id|start
op_or
id|CCCA_8BITSELECT
)paren
suffix:semicolon
multiline_comment|/* Clear filter delay memory */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|Z1
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|Z2
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Invalidate maps */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|MAPA
comma
id|voice-&gt;num
comma
id|MAP_PTI_MASK
op_or
(paren
id|card-&gt;silentpage-&gt;busaddx
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|MAPB
comma
id|voice-&gt;num
comma
id|MAP_PTI_MASK
op_or
(paren
id|card-&gt;silentpage-&gt;busaddx
op_star
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* Fill cache */
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICEMGR_FLAGS_VOICEMASTER
)paren
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR
comma
id|voice-&gt;num
comma
id|cra
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ATKHLDV
comma
id|voice-&gt;num
comma
id|ATKHLDV_HOLDTIME_MASK
op_or
id|ATKHLDV_ATTACKTIME_MASK
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|LFOVAL1
comma
id|voice-&gt;num
comma
l_int|0x8000
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ATKHLDM
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DCYSUSM
comma
id|voice-&gt;num
comma
id|DCYSUSM_DECAYTIME_MASK
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|LFOVAL2
comma
id|voice-&gt;num
comma
l_int|0x8000
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|IP
comma
id|voice-&gt;num
comma
id|voice-&gt;params.initial_pitch
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PEFE
comma
id|voice-&gt;num
comma
l_int|0x7f
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FMMOD
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|TREMFRQ
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FM2FRQ2
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ENVVAL
comma
id|voice-&gt;num
comma
l_int|0xbfff
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|ENVVOL
comma
id|voice-&gt;num
comma
l_int|0xbfff
)paren
suffix:semicolon
macro_line|#ifdef PRIVATE_PCM_VOLUME
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_PCM_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|channel_l
op_eq
id|voice-&gt;num
)paren
(brace
id|voice-&gt;params.initial_attn
op_assign
(paren
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|channel_r
OL
id|NUM_G
)paren
ques
c_cond
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|attn_l
suffix:colon
singleline_comment|// test for mono channel (reverse logic is correct here!)
(paren
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|attn_r
OG
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|attn_l
)paren
ques
c_cond
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|attn_l
suffix:colon
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|attn_r
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;set left volume  %d&bslash;n&quot;
comma
id|voice-&gt;params.initial_attn
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|channel_r
op_eq
id|voice-&gt;num
)paren
(brace
id|voice-&gt;params.initial_attn
op_assign
id|sblive_pcm_volume
(braket
id|i
)braket
dot
id|attn_r
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;set right volume  %d&bslash;n&quot;
comma
id|voice-&gt;params.initial_attn
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
id|sblive_writeptr
c_func
(paren
id|card
comma
id|IFATN
comma
id|voice-&gt;num
comma
id|IFATN_FILTERCUTOFF_MASK
op_or
id|voice-&gt;params.initial_attn
)paren
suffix:semicolon
id|voice-&gt;params.FC_target
op_assign
l_int|0xffff
suffix:semicolon
id|voice-&gt;params.pitch_target
op_assign
(paren
id|u16
)paren
(paren
id|IP_TO_CP
c_func
(paren
id|voice-&gt;params.initial_pitch
)paren
op_rshift
l_int|16
)paren
suffix:semicolon
id|voice
op_assign
id|voice-&gt;linked_voice
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_voice_start
r_void
id|emu10k1_voice_start
c_func
(paren
r_struct
id|emu_voice
op_star
id|voice
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|voice-&gt;card
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_voice_start()&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|voice
op_ne
l_int|NULL
)paren
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTRX_PITCHTARGET
comma
id|voice-&gt;num
comma
id|voice-&gt;params.pitch_target
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICEMGR_FLAGS_VOICEMASTER
)paren
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF_CURRENTPITCH
comma
id|voice-&gt;num
comma
id|voice-&gt;params.pitch_target
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|VTFT
comma
id|voice-&gt;num
comma
(paren
(paren
id|u32
)paren
id|voice-&gt;params.volume_target
op_lshift
l_int|16
)paren
op_or
id|voice-&gt;params.FC_target
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CVCF
comma
id|voice-&gt;num
comma
(paren
(paren
id|u32
)paren
id|voice-&gt;params.volume_target
op_lshift
l_int|16
)paren
op_or
id|voice-&gt;params.FC_target
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|DCYSUSV
comma
id|voice-&gt;num
comma
(paren
id|voice-&gt;params.byampl_env_sustain
op_lshift
l_int|8
)paren
op_or
id|ENV_ON
op_or
id|voice-&gt;params.byampl_env_decay
)paren
suffix:semicolon
multiline_comment|/* Using StopOnLoop for MIDI stops the playback&n;&t;&t;   too early, which may cause a DC level to be played&n;&t;&t;   until the note is released. */
r_if
c_cond
(paren
id|voice-&gt;usage
op_eq
id|VOICEMGR_USAGE_MIDI
)paren
id|emu10k1_clear_stop_on_loop
c_func
(paren
id|card
comma
id|voice-&gt;num
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|voice-&gt;params.startloop
OG
id|voice-&gt;params.end
)paren
id|emu10k1_set_stop_on_loop
c_func
(paren
id|card
comma
id|voice-&gt;num
)paren
suffix:semicolon
r_else
id|emu10k1_clear_stop_on_loop
c_func
(paren
id|card
comma
id|voice-&gt;num
)paren
suffix:semicolon
)brace
id|voice
op_assign
id|voice-&gt;linked_voice
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_voice_stop
r_void
id|emu10k1_voice_stop
c_func
(paren
r_struct
id|emu_voice
op_star
id|voice
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|voice-&gt;card
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_voice_stop()&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|voice
op_ne
l_int|NULL
)paren
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|IFATN
comma
id|voice-&gt;num
comma
l_int|0xffff
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|IP
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|VTFT
comma
id|voice-&gt;num
comma
l_int|0xffff
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTRX_PITCHTARGET
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
id|voice
op_assign
id|voice-&gt;linked_voice
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_voice_setcontrol
r_void
id|emu10k1_voice_setcontrol
c_func
(paren
r_struct
id|emu_voice
op_star
id|voice
comma
r_struct
id|voice_cntlset
op_star
id|setting
comma
id|u32
id|numparam
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|voice-&gt;card
suffix:semicolon
r_int
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|numparam
suffix:semicolon
id|count
op_increment
)paren
id|sblive_writeptr
c_func
(paren
id|card
comma
id|setting
(braket
id|count
)braket
dot
id|paramID
comma
id|voice-&gt;num
comma
id|setting
(braket
id|count
)braket
dot
id|value
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|emu10k1_voice_getcontrol
r_void
id|emu10k1_voice_getcontrol
c_func
(paren
r_struct
id|emu_voice
op_star
id|voice
comma
id|u32
id|controlid
comma
id|u32
op_star
id|value
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|voice-&gt;card
suffix:semicolon
op_star
id|value
op_assign
id|sblive_readptr
c_func
(paren
id|card
comma
id|controlid
comma
id|voice-&gt;num
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
