multiline_comment|/*&n; * sound/sb_audio.c&n; *&n; * Audio routines for Sound Blaster compatible cards.&n; *&n; *&n; * Copyright (C) by Hannu Savolainen 1993-1997&n; *&n; * OSS/Free for Linux is distributed under the GNU GENERAL PUBLIC LICENSE (GPL)&n; * Version 2 (June 1991). See the &quot;COPYING&quot; file distributed with this software&n; * for more info.&n; *&n; * Changes&n; *&t;Alan Cox&t;:&t;Formatting and clean ups&n; *&n; * Status&n; *&t;Mostly working. Weird uart bug causing irq storms&n; *&n; * Daniel J. Rodriksson: Changes to make sb16 work full duplex.&n; *                       Maybe other 16 bit cards in this code could behave&n; *                       the same.&n; */
macro_line|#include &quot;sound_config.h&quot;
macro_line|#include &quot;sb_mixer.h&quot;
macro_line|#include &quot;sb.h&quot;
macro_line|#include &quot;sb_ess.h&quot;
DECL|function|sb_audio_open
r_int
id|sb_audio_open
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|devc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound Blaster: incomplete initialization.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devc-&gt;caps
op_amp
id|SB_NO_RECORDING
op_logical_and
id|mode
op_amp
id|OPEN_READ
)paren
(brace
r_if
c_cond
(paren
id|mode
op_eq
id|OPEN_READ
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;opened
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ne
op_minus
l_int|1
op_logical_and
id|devc-&gt;dma16
op_ne
id|devc-&gt;dma8
op_logical_and
op_logical_neg
id|devc-&gt;duplex
)paren
(brace
r_if
c_cond
(paren
id|sound_open_dma
c_func
(paren
id|devc-&gt;dma16
comma
l_string|&quot;Sound Blaster 16 bit&quot;
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
id|devc-&gt;opened
op_assign
id|mode
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_NONE
suffix:semicolon
id|devc-&gt;irq_mode_16
op_assign
id|IMODE_NONE
suffix:semicolon
id|devc-&gt;fullduplex
op_assign
id|devc-&gt;duplex
op_logical_and
(paren
(paren
id|mode
op_amp
id|OPEN_READ
)paren
op_logical_and
(paren
id|mode
op_amp
id|OPEN_WRITE
)paren
)paren
suffix:semicolon
id|sb_dsp_reset
c_func
(paren
id|devc
)paren
suffix:semicolon
multiline_comment|/* At first glance this check isn&squot;t enough, some ESS chips might not &n;&t; * have a RECLEV. However if they don&squot;t common_mixer_set will refuse &n;&t; * cause devc-&gt;iomap has no register mapping for RECLEV&n;&t; */
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_ESS
)paren
id|ess_mixer_reload
(paren
id|devc
comma
id|SOUND_MIXER_RECLEV
)paren
suffix:semicolon
multiline_comment|/* The ALS007 seems to require that the DSP be removed from the output */
multiline_comment|/* in order for recording to be activated properly.  This is done by   */
multiline_comment|/* setting the appropriate bits of the output control register 4ch to  */
multiline_comment|/* zero.  This code assumes that the output control registers are not  */
multiline_comment|/* used anywhere else and therefore the DSP bits are *always* ON for   */
multiline_comment|/* output and OFF for sampling.                                        */
r_if
c_cond
(paren
id|devc-&gt;submodel
op_eq
id|SUBMDL_ALS007
)paren
(brace
r_if
c_cond
(paren
id|mode
op_amp
id|OPEN_READ
)paren
id|sb_setmixer
c_func
(paren
id|devc
comma
id|ALS007_OUTPUT_CTRL2
comma
id|sb_getmixer
c_func
(paren
id|devc
comma
id|ALS007_OUTPUT_CTRL2
)paren
op_amp
l_int|0xf9
)paren
suffix:semicolon
r_else
id|sb_setmixer
c_func
(paren
id|devc
comma
id|ALS007_OUTPUT_CTRL2
comma
id|sb_getmixer
c_func
(paren
id|devc
comma
id|ALS007_OUTPUT_CTRL2
)paren
op_or
l_int|0x06
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sb_audio_close
r_void
id|sb_audio_close
c_func
(paren
r_int
id|dev
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
multiline_comment|/* fix things if mmap turned off fullduplex */
r_if
c_cond
(paren
id|devc-&gt;duplex
op_logical_and
op_logical_neg
id|devc-&gt;fullduplex
op_logical_and
(paren
id|devc-&gt;opened
op_amp
id|OPEN_READ
)paren
op_logical_and
(paren
id|devc-&gt;opened
op_amp
id|OPEN_WRITE
)paren
)paren
(brace
r_struct
id|dma_buffparms
op_star
id|dmap_temp
suffix:semicolon
id|dmap_temp
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in
op_assign
id|dmap_temp
suffix:semicolon
)brace
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|devc-&gt;dma8
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
(paren
id|devc-&gt;duplex
)paren
ques
c_cond
id|devc-&gt;dma16
suffix:colon
id|devc-&gt;dma8
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ne
op_minus
l_int|1
op_logical_and
id|devc-&gt;dma16
op_ne
id|devc-&gt;dma8
op_logical_and
op_logical_neg
id|devc-&gt;duplex
)paren
id|sound_close_dma
c_func
(paren
id|devc-&gt;dma16
)paren
suffix:semicolon
multiline_comment|/* For ALS007, turn DSP output back on if closing the device for read */
r_if
c_cond
(paren
(paren
id|devc-&gt;submodel
op_eq
id|SUBMDL_ALS007
)paren
op_logical_and
(paren
id|devc-&gt;opened
op_amp
id|OPEN_READ
)paren
)paren
(brace
id|sb_setmixer
c_func
(paren
id|devc
comma
id|ALS007_OUTPUT_CTRL2
comma
id|sb_getmixer
c_func
(paren
id|devc
comma
id|ALS007_OUTPUT_CTRL2
)paren
op_or
l_int|0x06
)paren
suffix:semicolon
)brace
id|devc-&gt;opened
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|sb_set_output_parms
r_static
r_void
id|sb_set_output_parms
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devc-&gt;fullduplex
op_logical_or
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
(brace
id|devc-&gt;trg_buf
op_assign
id|buf
suffix:semicolon
id|devc-&gt;trg_bytes
op_assign
id|nr_bytes
suffix:semicolon
id|devc-&gt;trg_intrflag
op_assign
id|intrflag
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_OUTPUT
suffix:semicolon
)brace
r_else
(brace
id|devc-&gt;trg_buf_16
op_assign
id|buf
suffix:semicolon
id|devc-&gt;trg_bytes_16
op_assign
id|nr_bytes
suffix:semicolon
id|devc-&gt;trg_intrflag_16
op_assign
id|intrflag
suffix:semicolon
id|devc-&gt;irq_mode_16
op_assign
id|IMODE_OUTPUT
suffix:semicolon
)brace
)brace
DECL|function|sb_set_input_parms
r_static
r_void
id|sb_set_input_parms
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|count
comma
r_int
id|intrflag
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devc-&gt;fullduplex
op_logical_or
id|devc-&gt;bits
op_ne
id|AFMT_S16_LE
)paren
(brace
id|devc-&gt;trg_buf
op_assign
id|buf
suffix:semicolon
id|devc-&gt;trg_bytes
op_assign
id|count
suffix:semicolon
id|devc-&gt;trg_intrflag
op_assign
id|intrflag
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_INPUT
suffix:semicolon
)brace
r_else
(brace
id|devc-&gt;trg_buf_16
op_assign
id|buf
suffix:semicolon
id|devc-&gt;trg_bytes_16
op_assign
id|count
suffix:semicolon
id|devc-&gt;trg_intrflag_16
op_assign
id|intrflag
suffix:semicolon
id|devc-&gt;irq_mode_16
op_assign
id|IMODE_INPUT
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * SB1.x compatible routines &n; */
DECL|function|sb1_audio_output_block
r_static
r_void
id|sb1_audio_output_block
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
op_assign
id|nr_bytes
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_WRITE); */
r_if
c_cond
(paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
OG
l_int|3
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_OUTPUT
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x14
)paren
)paren
multiline_comment|/* 8 bit DAC using DMA */
(brace
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|count
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|count
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Sound Blaster:  unable to start DAC.&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|sb1_audio_start_input
r_static
r_void
id|sb1_audio_start_input
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
op_assign
id|nr_bytes
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
multiline_comment|/*&n;&t; * Start a DMA input to the buffer pointed by dmaqtail&n;&t; */
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_READ); */
r_if
c_cond
(paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
OG
l_int|3
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_INPUT
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x24
)paren
)paren
multiline_comment|/* 8 bit ADC using DMA */
(brace
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|count
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|count
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound Blaster:  unable to start ADC.&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|sb1_audio_trigger
r_static
r_void
id|sb1_audio_trigger
c_func
(paren
r_int
id|dev
comma
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|bits
op_and_assign
id|devc-&gt;irq_mode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bits
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xd0
)paren
suffix:semicolon
multiline_comment|/* Halt DMA */
r_else
(brace
r_switch
c_cond
(paren
id|devc-&gt;irq_mode
)paren
(brace
r_case
id|IMODE_INPUT
suffix:colon
id|sb1_audio_start_input
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMODE_OUTPUT
suffix:colon
id|sb1_audio_output_block
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|devc-&gt;trigger_bits
op_assign
id|bits
suffix:semicolon
)brace
DECL|function|sb1_audio_prepare_for_input
r_static
r_int
id|sb1_audio_prepare_for_input
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x40
)paren
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|devc-&gt;tconst
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|DSP_CMD_SPKOFF
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sb1_audio_prepare_for_output
r_static
r_int
id|sb1_audio_prepare_for_output
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x40
)paren
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|devc-&gt;tconst
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|DSP_CMD_SPKON
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sb1_audio_set_speed
r_static
r_int
id|sb1_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
r_int
id|max_speed
op_assign
l_int|23000
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;opened
op_amp
id|OPEN_READ
)paren
id|max_speed
op_assign
l_int|13000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|4000
)paren
id|speed
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
id|max_speed
)paren
id|speed
op_assign
id|max_speed
suffix:semicolon
id|devc-&gt;tconst
op_assign
(paren
l_int|256
op_minus
(paren
(paren
l_int|1000000
op_plus
id|speed
op_div
l_int|2
)paren
op_div
id|speed
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
id|tmp
op_assign
l_int|256
op_minus
id|devc-&gt;tconst
suffix:semicolon
id|speed
op_assign
(paren
l_int|1000000
op_plus
id|tmp
op_div
l_int|2
)paren
op_div
id|tmp
suffix:semicolon
id|devc-&gt;speed
op_assign
id|speed
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
DECL|function|sb1_audio_set_channels
r_static
r_int
id|sb1_audio_set_channels
c_func
(paren
r_int
id|dev
comma
r_int
id|channels
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_return
id|devc-&gt;channels
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|sb1_audio_set_bits
r_static
r_int
r_int
id|sb1_audio_set_bits
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_return
id|devc-&gt;bits
op_assign
l_int|8
suffix:semicolon
)brace
DECL|function|sb1_audio_halt_xfer
r_static
r_void
id|sb1_audio_halt_xfer
c_func
(paren
r_int
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sb_dsp_reset
c_func
(paren
id|devc
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * SB 2.0 and SB 2.01 compatible routines&n; */
DECL|function|sb20_audio_output_block
r_static
r_void
id|sb20_audio_output_block
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
op_assign
id|nr_bytes
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_char
id|cmd
suffix:semicolon
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_WRITE); */
r_if
c_cond
(paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
OG
l_int|3
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_OUTPUT
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x48
)paren
)paren
multiline_comment|/* DSP Block size */
(brace
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|count
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|count
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;speed
op_star
id|devc-&gt;channels
op_le
l_int|23000
)paren
id|cmd
op_assign
l_int|0x1c
suffix:semicolon
multiline_comment|/* 8 bit PCM output */
r_else
id|cmd
op_assign
l_int|0x90
suffix:semicolon
multiline_comment|/* 8 bit high speed PCM output (SB2.01/Pro) */
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|cmd
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound Blaster:  unable to start DAC.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound Blaster: unable to start DAC.&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|sb20_audio_start_input
r_static
r_void
id|sb20_audio_start_input
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
op_assign
id|nr_bytes
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_char
id|cmd
suffix:semicolon
multiline_comment|/*&n;&t; * Start a DMA input to the buffer pointed by dmaqtail&n;&t; */
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_READ); */
r_if
c_cond
(paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
OG
l_int|3
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_INPUT
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x48
)paren
)paren
multiline_comment|/* DSP Block size */
(brace
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|count
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|count
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;speed
op_star
id|devc-&gt;channels
op_le
(paren
id|devc-&gt;major
op_eq
l_int|3
ques
c_cond
l_int|23000
suffix:colon
l_int|13000
)paren
)paren
id|cmd
op_assign
l_int|0x2c
suffix:semicolon
multiline_comment|/* 8 bit PCM input */
r_else
id|cmd
op_assign
l_int|0x98
suffix:semicolon
multiline_comment|/* 8 bit high speed PCM input (SB2.01/Pro) */
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|cmd
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound Blaster:  unable to start ADC.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound Blaster:  unable to start ADC.&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|sb20_audio_trigger
r_static
r_void
id|sb20_audio_trigger
c_func
(paren
r_int
id|dev
comma
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|bits
op_and_assign
id|devc-&gt;irq_mode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bits
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xd0
)paren
suffix:semicolon
multiline_comment|/* Halt DMA */
r_else
(brace
r_switch
c_cond
(paren
id|devc-&gt;irq_mode
)paren
(brace
r_case
id|IMODE_INPUT
suffix:colon
id|sb20_audio_start_input
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMODE_OUTPUT
suffix:colon
id|sb20_audio_output_block
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|devc-&gt;trigger_bits
op_assign
id|bits
suffix:semicolon
)brace
multiline_comment|/*&n; * SB2.01 specific speed setup&n; */
DECL|function|sb201_audio_set_speed
r_static
r_int
id|sb201_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
id|s
op_assign
id|speed
op_star
id|devc-&gt;channels
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|4000
)paren
id|speed
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|44100
)paren
id|speed
op_assign
l_int|44100
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;opened
op_amp
id|OPEN_READ
op_logical_and
id|speed
OG
l_int|15000
)paren
id|speed
op_assign
l_int|15000
suffix:semicolon
id|devc-&gt;tconst
op_assign
(paren
l_int|256
op_minus
(paren
(paren
l_int|1000000
op_plus
id|s
op_div
l_int|2
)paren
op_div
id|s
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
id|tmp
op_assign
l_int|256
op_minus
id|devc-&gt;tconst
suffix:semicolon
id|speed
op_assign
(paren
(paren
l_int|1000000
op_plus
id|tmp
op_div
l_int|2
)paren
op_div
id|tmp
)paren
op_div
id|devc-&gt;channels
suffix:semicolon
id|devc-&gt;speed
op_assign
id|speed
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
multiline_comment|/*&n; * SB Pro specific routines&n; */
DECL|function|sbpro_audio_prepare_for_input
r_static
r_int
id|sbpro_audio_prepare_for_input
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
multiline_comment|/* For SB Pro and Jazz16 */
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|bits
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ge
l_int|0
op_logical_and
id|devc-&gt;dma16
op_ne
id|devc-&gt;dma8
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;bits
op_eq
l_int|16
ques
c_cond
id|devc-&gt;dma16
suffix:colon
id|devc-&gt;dma8
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_JAZZ
op_logical_or
id|devc-&gt;model
op_eq
id|MDL_SMW
)paren
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
id|bits
op_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* 16 bit mode */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x40
)paren
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|devc-&gt;tconst
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|DSP_CMD_SPKOFF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;channels
op_eq
l_int|1
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xa0
op_or
id|bits
)paren
suffix:semicolon
multiline_comment|/* Mono input */
r_else
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xa8
op_or
id|bits
)paren
suffix:semicolon
multiline_comment|/* Stereo input */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sbpro_audio_prepare_for_output
r_static
r_int
id|sbpro_audio_prepare_for_output
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
multiline_comment|/* For SB Pro and Jazz16 */
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|tmp
suffix:semicolon
r_int
r_char
id|bits
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ge
l_int|0
op_logical_and
id|devc-&gt;dma16
op_ne
id|devc-&gt;dma8
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;bits
op_eq
l_int|16
ques
c_cond
id|devc-&gt;dma16
suffix:colon
id|devc-&gt;dma8
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_SBPRO
)paren
id|sb_mixer_set_stereo
c_func
(paren
id|devc
comma
id|devc-&gt;channels
op_eq
l_int|2
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x40
)paren
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|devc-&gt;tconst
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|DSP_CMD_SPKON
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_JAZZ
op_logical_or
id|devc-&gt;model
op_eq
id|MDL_SMW
)paren
(brace
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
id|bits
op_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* 16 bit mode */
r_if
c_cond
(paren
id|devc-&gt;channels
op_eq
l_int|1
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xa0
op_or
id|bits
)paren
suffix:semicolon
multiline_comment|/* Mono output */
r_else
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xa8
op_or
id|bits
)paren
suffix:semicolon
multiline_comment|/* Stereo output */
)brace
r_else
(brace
id|tmp
op_assign
id|sb_getmixer
c_func
(paren
id|devc
comma
l_int|0x0e
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;channels
op_eq
l_int|1
)paren
id|tmp
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
r_else
id|tmp
op_or_assign
l_int|0x02
suffix:semicolon
id|sb_setmixer
c_func
(paren
id|devc
comma
l_int|0x0e
comma
id|tmp
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sbpro_audio_set_speed
r_static
r_int
id|sbpro_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|4000
)paren
id|speed
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|44100
)paren
id|speed
op_assign
l_int|44100
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;channels
OG
l_int|1
op_logical_and
id|speed
OG
l_int|22050
)paren
id|speed
op_assign
l_int|22050
suffix:semicolon
id|sb201_audio_set_speed
c_func
(paren
id|dev
comma
id|speed
)paren
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
DECL|function|sbpro_audio_set_channels
r_static
r_int
id|sbpro_audio_set_channels
c_func
(paren
r_int
id|dev
comma
r_int
id|channels
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
id|channels
op_eq
l_int|1
op_logical_or
id|channels
op_eq
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|channels
op_ne
id|devc-&gt;channels
)paren
(brace
id|devc-&gt;channels
op_assign
id|channels
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_SBPRO
op_logical_and
id|devc-&gt;channels
op_eq
l_int|2
)paren
id|sbpro_audio_set_speed
c_func
(paren
id|dev
comma
id|devc-&gt;speed
)paren
suffix:semicolon
)brace
)brace
r_return
id|devc-&gt;channels
suffix:semicolon
)brace
DECL|function|jazz16_audio_set_speed
r_static
r_int
id|jazz16_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_int
id|tmp
suffix:semicolon
r_int
id|s
op_assign
id|speed
op_star
id|devc-&gt;channels
suffix:semicolon
r_if
c_cond
(paren
id|speed
OL
l_int|5000
)paren
id|speed
op_assign
l_int|5000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|44100
)paren
id|speed
op_assign
l_int|44100
suffix:semicolon
id|devc-&gt;tconst
op_assign
(paren
l_int|256
op_minus
(paren
(paren
l_int|1000000
op_plus
id|s
op_div
l_int|2
)paren
op_div
id|s
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
id|tmp
op_assign
l_int|256
op_minus
id|devc-&gt;tconst
suffix:semicolon
id|speed
op_assign
(paren
(paren
l_int|1000000
op_plus
id|tmp
op_div
l_int|2
)paren
op_div
id|tmp
)paren
op_div
id|devc-&gt;channels
suffix:semicolon
id|devc-&gt;speed
op_assign
id|speed
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
multiline_comment|/*&n; * SB16 specific routines&n; */
DECL|function|sb16_audio_set_speed
r_static
r_int
id|sb16_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|max_speed
op_assign
id|devc-&gt;submodel
op_eq
id|SUBMDL_ALS100
ques
c_cond
l_int|48000
suffix:colon
l_int|44100
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|5000
)paren
multiline_comment|/* which of these */
id|speed
op_assign
l_int|4000
suffix:semicolon
multiline_comment|/* is correct ??? */
r_if
c_cond
(paren
id|speed
OG
id|max_speed
)paren
id|speed
op_assign
id|max_speed
suffix:semicolon
id|devc-&gt;speed
op_assign
id|speed
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
DECL|function|sb16_audio_set_bits
r_static
r_int
r_int
id|sb16_audio_set_bits
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
id|bits
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|bits
op_eq
id|AFMT_U8
op_logical_or
id|bits
op_eq
id|AFMT_S16_LE
)paren
id|devc-&gt;bits
op_assign
id|bits
suffix:semicolon
r_else
id|devc-&gt;bits
op_assign
id|AFMT_U8
suffix:semicolon
)brace
r_return
id|devc-&gt;bits
suffix:semicolon
)brace
DECL|function|sb16_audio_prepare_for_input
r_static
r_int
id|sb16_audio_prepare_for_input
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devc-&gt;fullduplex
)paren
(brace
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
id|devc-&gt;dma16
suffix:colon
id|devc-&gt;dma8
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
(brace
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|devc-&gt;dma8
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;dma16
suffix:semicolon
)brace
r_else
(brace
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|devc-&gt;dma16
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;dma8
suffix:semicolon
)brace
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sb16_audio_prepare_for_output
r_static
r_int
id|sb16_audio_prepare_for_output
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devc-&gt;fullduplex
)paren
(brace
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
id|devc-&gt;dma16
suffix:colon
id|devc-&gt;dma8
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
(brace
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|devc-&gt;dma8
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;dma16
suffix:semicolon
)brace
r_else
(brace
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|devc-&gt;dma16
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;dma8
suffix:semicolon
)brace
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sb16_audio_output_block
r_static
r_void
id|sb16_audio_output_block
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|count
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
comma
id|cnt
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|bits
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devc-&gt;fullduplex
op_logical_or
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
(brace
id|devc-&gt;irq_mode
op_assign
id|IMODE_OUTPUT
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|devc-&gt;irq_mode_16
op_assign
id|IMODE_OUTPUT
suffix:semicolon
id|devc-&gt;intr_active_16
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* save value */
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
(paren
)paren
suffix:semicolon
id|bits
op_assign
id|devc-&gt;bits
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;fullduplex
)paren
id|devc-&gt;bits
op_assign
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
ques
c_cond
id|AFMT_U8
suffix:colon
id|AFMT_S16_LE
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
id|cnt
op_rshift_assign
l_int|1
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_WRITE); */
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x41
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|devc-&gt;speed
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|devc-&gt;speed
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
l_int|0xb6
suffix:colon
l_int|0xc6
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
(paren
id|devc-&gt;channels
op_eq
l_int|2
ques
c_cond
l_int|0x20
suffix:colon
l_int|0
)paren
op_plus
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
l_int|0x10
suffix:colon
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|cnt
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|cnt
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
multiline_comment|/* restore real value after all programming */
id|devc-&gt;bits
op_assign
id|bits
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This fails on the Cyrix MediaGX. If you don&squot;t have the DMA enabled&n; *&t;before the first sample arrives it locks up. However even if you&n; *&t;do enable the DMA in time you just get DMA timeouts and missing&n; *&t;interrupts and stuff, so for now I&squot;ve not bothered fixing this either.&n; */
DECL|function|sb16_audio_start_input
r_static
r_void
id|sb16_audio_start_input
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|count
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
comma
id|cnt
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|devc-&gt;fullduplex
op_logical_or
id|devc-&gt;bits
op_ne
id|AFMT_S16_LE
)paren
(brace
id|devc-&gt;irq_mode
op_assign
id|IMODE_INPUT
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|devc-&gt;irq_mode_16
op_assign
id|IMODE_INPUT
suffix:semicolon
id|devc-&gt;intr_active_16
op_assign
l_int|1
suffix:semicolon
)brace
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
id|cnt
op_rshift_assign
l_int|1
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_READ); */
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x42
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|devc-&gt;speed
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|devc-&gt;speed
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
l_int|0xbe
suffix:colon
l_int|0xce
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
(paren
id|devc-&gt;channels
op_eq
l_int|2
ques
c_cond
l_int|0x20
suffix:colon
l_int|0
)paren
op_plus
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
l_int|0x10
suffix:colon
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|cnt
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|cnt
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sb16_audio_trigger
r_static
r_void
id|sb16_audio_trigger
c_func
(paren
r_int
id|dev
comma
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|bits_16
op_assign
id|bits
op_amp
id|devc-&gt;irq_mode_16
suffix:semicolon
id|bits
op_and_assign
id|devc-&gt;irq_mode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bits
op_logical_and
op_logical_neg
id|bits_16
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xd0
)paren
suffix:semicolon
multiline_comment|/* Halt DMA */
r_else
(brace
r_if
c_cond
(paren
id|bits
)paren
(brace
r_switch
c_cond
(paren
id|devc-&gt;irq_mode
)paren
(brace
r_case
id|IMODE_INPUT
suffix:colon
id|sb16_audio_start_input
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMODE_OUTPUT
suffix:colon
id|sb16_audio_output_block
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|bits_16
)paren
(brace
r_switch
c_cond
(paren
id|devc-&gt;irq_mode_16
)paren
(brace
r_case
id|IMODE_INPUT
suffix:colon
id|sb16_audio_start_input
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf_16
comma
id|devc-&gt;trg_bytes_16
comma
id|devc-&gt;trg_intrflag_16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMODE_OUTPUT
suffix:colon
id|sb16_audio_output_block
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf_16
comma
id|devc-&gt;trg_bytes_16
comma
id|devc-&gt;trg_intrflag_16
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
id|devc-&gt;trigger_bits
op_assign
id|bits
op_or
id|bits_16
suffix:semicolon
)brace
DECL|variable|lbuf8
r_static
r_int
r_char
id|lbuf8
(braket
l_int|2048
)braket
suffix:semicolon
DECL|variable|lbuf16
r_static
r_int
r_int
op_star
id|lbuf16
op_assign
(paren
r_int
r_int
op_star
)paren
id|lbuf8
suffix:semicolon
DECL|macro|LBUFCOPYSIZE
mdefine_line|#define LBUFCOPYSIZE 1024
r_static
r_void
DECL|function|sb16_copy_from_user
id|sb16_copy_from_user
c_func
(paren
r_int
id|dev
comma
r_char
op_star
id|localbuf
comma
r_int
id|localoffs
comma
r_const
r_char
op_star
id|userbuf
comma
r_int
id|useroffs
comma
r_int
id|max_in
comma
r_int
id|max_out
comma
r_int
op_star
id|used
comma
r_int
op_star
id|returned
comma
r_int
id|len
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|i
comma
id|c
comma
id|p
comma
id|locallen
suffix:semicolon
r_int
r_char
op_star
id|buf8
suffix:semicolon
r_int
r_int
op_star
id|buf16
suffix:semicolon
multiline_comment|/* if not duplex no conversion */
r_if
c_cond
(paren
op_logical_neg
id|devc-&gt;fullduplex
)paren
(brace
id|copy_from_user
(paren
id|localbuf
op_plus
id|localoffs
comma
id|userbuf
op_plus
id|useroffs
comma
id|len
)paren
suffix:semicolon
op_star
id|used
op_assign
id|len
suffix:semicolon
op_star
id|returned
op_assign
id|len
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
(brace
multiline_comment|/* 16 -&gt; 8 */
multiline_comment|/* max_in &gt;&gt; 1, max number of samples in ( 16 bits ) */
multiline_comment|/* max_out, max number of samples out ( 8 bits ) */
multiline_comment|/* len, number of samples that will be taken ( 16 bits )*/
multiline_comment|/* c, count of samples remaining in buffer ( 16 bits )*/
multiline_comment|/* p, count of samples already processed ( 16 bits )*/
id|len
op_assign
(paren
(paren
id|max_in
op_rshift
l_int|1
)paren
OG
id|max_out
)paren
ques
c_cond
id|max_out
suffix:colon
(paren
id|max_in
op_rshift
l_int|1
)paren
suffix:semicolon
id|c
op_assign
id|len
suffix:semicolon
id|p
op_assign
l_int|0
suffix:semicolon
id|buf8
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
id|localbuf
op_plus
id|localoffs
)paren
suffix:semicolon
r_while
c_loop
(paren
id|c
)paren
(brace
id|locallen
op_assign
(paren
id|c
op_ge
id|LBUFCOPYSIZE
ques
c_cond
id|LBUFCOPYSIZE
suffix:colon
id|c
)paren
suffix:semicolon
multiline_comment|/* &lt;&lt; 1 in order to get 16 bit samples */
id|copy_from_user
(paren
id|lbuf16
comma
id|userbuf
op_plus
id|useroffs
op_plus
(paren
id|p
op_lshift
l_int|1
)paren
comma
id|locallen
op_lshift
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|locallen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buf8
(braket
id|p
op_plus
id|i
)braket
op_assign
op_complement
(paren
(paren
id|lbuf16
(braket
id|i
)braket
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_xor
l_int|0x80
suffix:semicolon
)brace
id|c
op_sub_assign
id|locallen
suffix:semicolon
id|p
op_add_assign
id|locallen
suffix:semicolon
)brace
multiline_comment|/* used = ( samples * 16 bits size ) */
op_star
id|used
op_assign
id|len
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* returned = ( samples * 8 bits size ) */
op_star
id|returned
op_assign
id|len
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 8 -&gt; 16 */
multiline_comment|/* max_in, max number of samples in ( 8 bits ) */
multiline_comment|/* max_out &gt;&gt; 1, max number of samples out ( 16 bits ) */
multiline_comment|/* len, number of samples that will be taken ( 8 bits )*/
multiline_comment|/* c, count of samples remaining in buffer ( 8 bits )*/
multiline_comment|/* p, count of samples already processed ( 8 bits )*/
id|len
op_assign
id|max_in
OG
(paren
id|max_out
op_rshift
l_int|1
)paren
ques
c_cond
(paren
id|max_out
op_rshift
l_int|1
)paren
suffix:colon
id|max_in
suffix:semicolon
id|c
op_assign
id|len
suffix:semicolon
id|p
op_assign
l_int|0
suffix:semicolon
id|buf16
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|localbuf
op_plus
id|localoffs
)paren
suffix:semicolon
r_while
c_loop
(paren
id|c
)paren
(brace
id|locallen
op_assign
(paren
id|c
op_ge
id|LBUFCOPYSIZE
ques
c_cond
id|LBUFCOPYSIZE
suffix:colon
id|c
)paren
suffix:semicolon
id|copy_from_user
(paren
id|lbuf8
comma
id|userbuf
op_plus
id|useroffs
op_plus
id|p
comma
id|locallen
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|locallen
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buf16
(braket
id|p
op_plus
id|i
)braket
op_assign
(paren
op_complement
id|lbuf8
(braket
id|i
)braket
op_xor
l_int|0x80
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
id|c
op_sub_assign
id|locallen
suffix:semicolon
id|p
op_add_assign
id|locallen
suffix:semicolon
)brace
multiline_comment|/* used = ( samples * 8 bits size ) */
op_star
id|used
op_assign
id|len
suffix:semicolon
multiline_comment|/* returned = ( samples * 16 bits size ) */
op_star
id|returned
op_assign
id|len
op_lshift
l_int|1
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|sb16_audio_mmap
id|sb16_audio_mmap
c_func
(paren
r_int
id|dev
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|devc-&gt;fullduplex
op_assign
l_int|0
suffix:semicolon
)brace
DECL|variable|sb1_audio_driver
r_static
r_struct
id|audio_driver
id|sb1_audio_driver
op_assign
multiline_comment|/* SB1.x */
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|open
suffix:colon
id|sb_audio_open
comma
id|close
suffix:colon
id|sb_audio_close
comma
id|output_block
suffix:colon
id|sb_set_output_parms
comma
id|start_input
suffix:colon
id|sb_set_input_parms
comma
id|prepare_for_input
suffix:colon
id|sb1_audio_prepare_for_input
comma
id|prepare_for_output
suffix:colon
id|sb1_audio_prepare_for_output
comma
id|halt_io
suffix:colon
id|sb1_audio_halt_xfer
comma
id|trigger
suffix:colon
id|sb1_audio_trigger
comma
id|set_speed
suffix:colon
id|sb1_audio_set_speed
comma
id|set_bits
suffix:colon
id|sb1_audio_set_bits
comma
id|set_channels
suffix:colon
id|sb1_audio_set_channels
)brace
suffix:semicolon
DECL|variable|sb20_audio_driver
r_static
r_struct
id|audio_driver
id|sb20_audio_driver
op_assign
multiline_comment|/* SB2.0 */
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|open
suffix:colon
id|sb_audio_open
comma
id|close
suffix:colon
id|sb_audio_close
comma
id|output_block
suffix:colon
id|sb_set_output_parms
comma
id|start_input
suffix:colon
id|sb_set_input_parms
comma
id|prepare_for_input
suffix:colon
id|sb1_audio_prepare_for_input
comma
id|prepare_for_output
suffix:colon
id|sb1_audio_prepare_for_output
comma
id|halt_io
suffix:colon
id|sb1_audio_halt_xfer
comma
id|trigger
suffix:colon
id|sb20_audio_trigger
comma
id|set_speed
suffix:colon
id|sb1_audio_set_speed
comma
id|set_bits
suffix:colon
id|sb1_audio_set_bits
comma
id|set_channels
suffix:colon
id|sb1_audio_set_channels
)brace
suffix:semicolon
DECL|variable|sb201_audio_driver
r_static
r_struct
id|audio_driver
id|sb201_audio_driver
op_assign
multiline_comment|/* SB2.01 */
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|open
suffix:colon
id|sb_audio_open
comma
id|close
suffix:colon
id|sb_audio_close
comma
id|output_block
suffix:colon
id|sb_set_output_parms
comma
id|start_input
suffix:colon
id|sb_set_input_parms
comma
id|prepare_for_input
suffix:colon
id|sb1_audio_prepare_for_input
comma
id|prepare_for_output
suffix:colon
id|sb1_audio_prepare_for_output
comma
id|halt_io
suffix:colon
id|sb1_audio_halt_xfer
comma
id|trigger
suffix:colon
id|sb20_audio_trigger
comma
id|set_speed
suffix:colon
id|sb201_audio_set_speed
comma
id|set_bits
suffix:colon
id|sb1_audio_set_bits
comma
id|set_channels
suffix:colon
id|sb1_audio_set_channels
)brace
suffix:semicolon
DECL|variable|sbpro_audio_driver
r_static
r_struct
id|audio_driver
id|sbpro_audio_driver
op_assign
multiline_comment|/* SB Pro */
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|open
suffix:colon
id|sb_audio_open
comma
id|close
suffix:colon
id|sb_audio_close
comma
id|output_block
suffix:colon
id|sb_set_output_parms
comma
id|start_input
suffix:colon
id|sb_set_input_parms
comma
id|prepare_for_input
suffix:colon
id|sbpro_audio_prepare_for_input
comma
id|prepare_for_output
suffix:colon
id|sbpro_audio_prepare_for_output
comma
id|halt_io
suffix:colon
id|sb1_audio_halt_xfer
comma
id|trigger
suffix:colon
id|sb20_audio_trigger
comma
id|set_speed
suffix:colon
id|sbpro_audio_set_speed
comma
id|set_bits
suffix:colon
id|sb1_audio_set_bits
comma
id|set_channels
suffix:colon
id|sbpro_audio_set_channels
)brace
suffix:semicolon
DECL|variable|jazz16_audio_driver
r_static
r_struct
id|audio_driver
id|jazz16_audio_driver
op_assign
multiline_comment|/* Jazz16 and SM Wave */
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|open
suffix:colon
id|sb_audio_open
comma
id|close
suffix:colon
id|sb_audio_close
comma
id|output_block
suffix:colon
id|sb_set_output_parms
comma
id|start_input
suffix:colon
id|sb_set_input_parms
comma
id|prepare_for_input
suffix:colon
id|sbpro_audio_prepare_for_input
comma
id|prepare_for_output
suffix:colon
id|sbpro_audio_prepare_for_output
comma
id|halt_io
suffix:colon
id|sb1_audio_halt_xfer
comma
id|trigger
suffix:colon
id|sb20_audio_trigger
comma
id|set_speed
suffix:colon
id|jazz16_audio_set_speed
comma
id|set_bits
suffix:colon
id|sb16_audio_set_bits
comma
id|set_channels
suffix:colon
id|sbpro_audio_set_channels
)brace
suffix:semicolon
DECL|variable|sb16_audio_driver
r_static
r_struct
id|audio_driver
id|sb16_audio_driver
op_assign
multiline_comment|/* SB16 */
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|open
suffix:colon
id|sb_audio_open
comma
id|close
suffix:colon
id|sb_audio_close
comma
id|output_block
suffix:colon
id|sb_set_output_parms
comma
id|start_input
suffix:colon
id|sb_set_input_parms
comma
id|prepare_for_input
suffix:colon
id|sb16_audio_prepare_for_input
comma
id|prepare_for_output
suffix:colon
id|sb16_audio_prepare_for_output
comma
id|halt_io
suffix:colon
id|sb1_audio_halt_xfer
comma
id|copy_user
suffix:colon
id|sb16_copy_from_user
comma
id|trigger
suffix:colon
id|sb16_audio_trigger
comma
id|set_speed
suffix:colon
id|sb16_audio_set_speed
comma
id|set_bits
suffix:colon
id|sb16_audio_set_bits
comma
id|set_channels
suffix:colon
id|sbpro_audio_set_channels
comma
id|mmap
suffix:colon
id|sb16_audio_mmap
)brace
suffix:semicolon
DECL|function|sb_audio_init
r_void
id|sb_audio_init
c_func
(paren
id|sb_devc
op_star
id|devc
comma
r_char
op_star
id|name
comma
r_struct
id|module
op_star
id|owner
)paren
(brace
r_int
id|audio_flags
op_assign
l_int|0
suffix:semicolon
r_int
id|format_mask
op_assign
id|AFMT_U8
suffix:semicolon
r_struct
id|audio_driver
op_star
id|driver
op_assign
op_amp
id|sb1_audio_driver
suffix:semicolon
r_switch
c_cond
(paren
id|devc-&gt;model
)paren
(brace
r_case
id|MDL_SB1
suffix:colon
multiline_comment|/* SB1.0 or SB 1.5 */
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use standard SB1.x driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_HARDSTOP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_SB2
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use SB2.0 driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|driver
op_assign
op_amp
id|sb20_audio_driver
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_SB201
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use SB2.01 (high speed) driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|driver
op_assign
op_amp
id|sb201_audio_driver
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_JAZZ
suffix:colon
r_case
id|MDL_SMW
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use Jazz16 driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|format_mask
op_or_assign
id|AFMT_S16_LE
suffix:semicolon
id|driver
op_assign
op_amp
id|jazz16_audio_driver
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_ESS
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use ESS ES688/1688 driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|driver
op_assign
id|ess_audio_init
(paren
id|devc
comma
op_amp
id|audio_flags
comma
op_amp
id|format_mask
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_SB16
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use SB16 driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|format_mask
op_or_assign
id|AFMT_S16_LE
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dma8
op_ne
id|devc-&gt;dma16
op_logical_and
id|devc-&gt;dma16
op_ne
op_minus
l_int|1
)paren
(brace
id|audio_flags
op_or_assign
id|DMA_DUPLEX
suffix:semicolon
id|devc-&gt;duplex
op_assign
l_int|1
suffix:semicolon
)brace
id|driver
op_assign
op_amp
id|sb16_audio_driver
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use SB Pro driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|driver
op_assign
op_amp
id|sbpro_audio_driver
suffix:semicolon
)brace
r_if
c_cond
(paren
id|owner
)paren
id|driver-&gt;owner
op_assign
id|owner
suffix:semicolon
r_if
c_cond
(paren
(paren
id|devc-&gt;dev
op_assign
id|sound_install_audiodrv
c_func
(paren
id|AUDIO_DRIVER_VERSION
comma
id|name
comma
id|driver
comma
r_sizeof
(paren
r_struct
id|audio_driver
)paren
comma
id|audio_flags
comma
id|format_mask
comma
id|devc
comma
id|devc-&gt;dma8
comma
id|devc-&gt;duplex
ques
c_cond
id|devc-&gt;dma16
suffix:colon
id|devc-&gt;dma8
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Sound Blaster:  unable to install audio.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|audio_devs
(braket
id|devc-&gt;dev
)braket
op_member_access_from_pointer
id|mixer_dev
op_assign
id|devc-&gt;my_mixerdev
suffix:semicolon
id|audio_devs
(braket
id|devc-&gt;dev
)braket
op_member_access_from_pointer
id|min_fragment
op_assign
l_int|5
suffix:semicolon
)brace
eof
