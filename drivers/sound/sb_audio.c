multiline_comment|/*&n; * sound/sb_audio.c&n; *&n; * Audio routines for Sound Blaster compatible cards.&n; */
multiline_comment|/*&n; * Copyright (C) by Hannu Savolainen 1993-1997&n; *&n; * OSS/Free for Linux is distributed under the GNU GENERAL PUBLIC LICENSE (GPL)&n; * Version 2 (June 1991). See the &quot;COPYING&quot; file distributed with this software&n; * for more info.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &quot;sound_config.h&quot;
macro_line|#if defined(CONFIG_SBDSP) || defined(MODULE)
macro_line|#include &quot;sb_mixer.h&quot;
macro_line|#include &quot;sb.h&quot;
r_static
r_int
DECL|function|sb_audio_open
id|sb_audio_open
c_func
(paren
r_int
id|dev
comma
r_int
id|mode
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|devc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;SB: Incomplete initialization&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devc-&gt;caps
op_amp
id|SB_NO_RECORDING
op_logical_and
id|mode
op_amp
id|OPEN_READ
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Notice: Recording is not possible with /dev/dsp%d&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|OPEN_READ
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;opened
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ne
op_minus
l_int|1
op_logical_and
id|devc-&gt;dma16
op_ne
id|devc-&gt;dma8
)paren
(brace
r_if
c_cond
(paren
id|sound_open_dma
c_func
(paren
id|devc-&gt;dma16
comma
l_string|&quot;Sound Blaster 16 bit&quot;
)paren
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
id|devc-&gt;opened
op_assign
id|mode
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_NONE
suffix:semicolon
id|sb_dsp_reset
c_func
(paren
id|devc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|sb_audio_close
id|sb_audio_close
c_func
(paren
r_int
id|dev
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|devc-&gt;dma8
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ne
op_minus
l_int|1
op_logical_and
id|devc-&gt;dma16
op_ne
id|devc-&gt;dma8
)paren
id|sound_close_dma
c_func
(paren
id|devc-&gt;dma16
)paren
suffix:semicolon
id|devc-&gt;opened
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|sb_set_output_parms
id|sb_set_output_parms
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|devc-&gt;trg_buf
op_assign
id|buf
suffix:semicolon
id|devc-&gt;trg_bytes
op_assign
id|nr_bytes
suffix:semicolon
id|devc-&gt;trg_intrflag
op_assign
id|intrflag
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_OUTPUT
suffix:semicolon
)brace
r_static
r_void
DECL|function|sb_set_input_parms
id|sb_set_input_parms
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|count
comma
r_int
id|intrflag
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|devc-&gt;trg_buf
op_assign
id|buf
suffix:semicolon
id|devc-&gt;trg_bytes
op_assign
id|count
suffix:semicolon
id|devc-&gt;trg_intrflag
op_assign
id|intrflag
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_INPUT
suffix:semicolon
)brace
multiline_comment|/*&n; * SB1.x compatible routines &n; */
r_static
r_void
DECL|function|sb1_audio_output_block
id|sb1_audio_output_block
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
op_assign
id|nr_bytes
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_WRITE); */
r_if
c_cond
(paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
OG
l_int|3
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_OUTPUT
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x14
)paren
)paren
multiline_comment|/* 8 bit DAC using DMA */
(brace
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|count
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|count
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;SB: Unable to start DAC&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|sb1_audio_start_input
id|sb1_audio_start_input
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
op_assign
id|nr_bytes
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
multiline_comment|/*&n;&t; * Start a DMA input to the buffer pointed by dmaqtail&n;&t; */
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_READ); */
r_if
c_cond
(paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
OG
l_int|3
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_INPUT
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x24
)paren
)paren
multiline_comment|/* 8 bit ADC using DMA */
(brace
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|count
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|count
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;SB Error: Unable to start ADC&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|sb1_audio_trigger
id|sb1_audio_trigger
c_func
(paren
r_int
id|dev
comma
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|bits
op_and_assign
id|devc-&gt;irq_mode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bits
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xd0
)paren
suffix:semicolon
multiline_comment|/* Halt DMA */
r_else
(brace
r_switch
c_cond
(paren
id|devc-&gt;irq_mode
)paren
(brace
r_case
id|IMODE_INPUT
suffix:colon
id|sb1_audio_start_input
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMODE_OUTPUT
suffix:colon
id|sb1_audio_output_block
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|devc-&gt;trigger_bits
op_assign
id|bits
suffix:semicolon
)brace
r_static
r_int
DECL|function|sb1_audio_prepare_for_input
id|sb1_audio_prepare_for_input
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x40
)paren
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|devc-&gt;tconst
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|DSP_CMD_SPKOFF
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sb1_audio_prepare_for_output
id|sb1_audio_prepare_for_output
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x40
)paren
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|devc-&gt;tconst
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|DSP_CMD_SPKON
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sb1_audio_set_speed
id|sb1_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
r_int
id|max_speed
op_assign
l_int|23000
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;opened
op_amp
id|OPEN_READ
)paren
id|max_speed
op_assign
l_int|13000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|4000
)paren
id|speed
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
id|max_speed
)paren
id|speed
op_assign
id|max_speed
suffix:semicolon
id|devc-&gt;tconst
op_assign
(paren
l_int|256
op_minus
(paren
(paren
l_int|1000000
op_plus
id|speed
op_div
l_int|2
)paren
op_div
id|speed
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
id|tmp
op_assign
l_int|256
op_minus
id|devc-&gt;tconst
suffix:semicolon
id|speed
op_assign
(paren
l_int|1000000
op_plus
id|tmp
op_div
l_int|2
)paren
op_div
id|tmp
suffix:semicolon
id|devc-&gt;speed
op_assign
id|speed
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
r_static
r_int
DECL|function|sb1_audio_set_channels
id|sb1_audio_set_channels
c_func
(paren
r_int
id|dev
comma
r_int
id|channels
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_return
id|devc-&gt;channels
op_assign
l_int|1
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|sb1_audio_set_bits
id|sb1_audio_set_bits
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_return
id|devc-&gt;bits
op_assign
l_int|8
suffix:semicolon
)brace
r_static
r_void
DECL|function|sb1_audio_halt_xfer
id|sb1_audio_halt_xfer
c_func
(paren
r_int
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sb_dsp_reset
c_func
(paren
id|devc
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * SB 2.0 and SB 2.01 compatible routines&n; */
r_static
r_void
DECL|function|sb20_audio_output_block
id|sb20_audio_output_block
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
op_assign
id|nr_bytes
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_char
id|cmd
suffix:semicolon
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_WRITE); */
r_if
c_cond
(paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
OG
l_int|3
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_OUTPUT
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x48
)paren
)paren
multiline_comment|/* DSP Block size */
(brace
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|count
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|count
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;speed
op_star
id|devc-&gt;channels
op_le
l_int|23000
)paren
id|cmd
op_assign
l_int|0x1c
suffix:semicolon
multiline_comment|/* 8 bit PCM output */
r_else
id|cmd
op_assign
l_int|0x90
suffix:semicolon
multiline_comment|/* 8 bit high speed PCM output (SB2.01/Pro) */
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|cmd
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;SB: Unable to start DAC&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;SB: Unable to start DAC&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|sb20_audio_start_input
id|sb20_audio_start_input
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
op_assign
id|nr_bytes
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_char
id|cmd
suffix:semicolon
multiline_comment|/*&n;&t; * Start a DMA input to the buffer pointed by dmaqtail&n;&t; */
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_READ); */
r_if
c_cond
(paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
OG
l_int|3
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_INPUT
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x48
)paren
)paren
multiline_comment|/* DSP Block size */
(brace
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|count
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|count
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;speed
op_star
id|devc-&gt;channels
op_le
(paren
id|devc-&gt;major
op_eq
l_int|3
ques
c_cond
l_int|23000
suffix:colon
l_int|13000
)paren
)paren
id|cmd
op_assign
l_int|0x2c
suffix:semicolon
multiline_comment|/* 8 bit PCM input */
r_else
id|cmd
op_assign
l_int|0x98
suffix:semicolon
multiline_comment|/* 8 bit high speed PCM input (SB2.01/Pro) */
r_if
c_cond
(paren
op_logical_neg
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|cmd
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;SB: Unable to start ADC&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;SB Error: Unable to start ADC&bslash;n&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|sb20_audio_trigger
id|sb20_audio_trigger
c_func
(paren
r_int
id|dev
comma
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|bits
op_and_assign
id|devc-&gt;irq_mode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bits
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xd0
)paren
suffix:semicolon
multiline_comment|/* Halt DMA */
r_else
(brace
r_switch
c_cond
(paren
id|devc-&gt;irq_mode
)paren
(brace
r_case
id|IMODE_INPUT
suffix:colon
id|sb20_audio_start_input
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMODE_OUTPUT
suffix:colon
id|sb20_audio_output_block
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|devc-&gt;trigger_bits
op_assign
id|bits
suffix:semicolon
)brace
multiline_comment|/*&n; * SB2.01 specific speed setup&n; */
r_static
r_int
DECL|function|sb201_audio_set_speed
id|sb201_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
id|s
op_assign
id|speed
op_star
id|devc-&gt;channels
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|4000
)paren
id|speed
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|44100
)paren
id|speed
op_assign
l_int|44100
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;opened
op_amp
id|OPEN_READ
op_logical_and
id|speed
OG
l_int|15000
)paren
id|speed
op_assign
l_int|15000
suffix:semicolon
id|devc-&gt;tconst
op_assign
(paren
(paren
l_int|65536
op_minus
(paren
(paren
l_int|256000000
op_plus
id|s
op_div
l_int|2
)paren
op_div
id|s
)paren
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|tmp
op_assign
l_int|256
op_minus
id|devc-&gt;tconst
suffix:semicolon
id|speed
op_assign
(paren
(paren
l_int|1000000
op_plus
id|tmp
op_div
l_int|2
)paren
op_div
id|tmp
)paren
op_div
id|devc-&gt;channels
suffix:semicolon
id|devc-&gt;speed
op_assign
id|speed
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
multiline_comment|/*&n; * SB Pro specific routines&n; */
r_static
r_int
DECL|function|sbpro_audio_prepare_for_input
id|sbpro_audio_prepare_for_input
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
multiline_comment|/* For SB Pro and Jazz16 */
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|bits
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ge
l_int|0
op_logical_and
id|devc-&gt;dma16
op_ne
id|devc-&gt;dma8
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;bits
op_eq
l_int|16
ques
c_cond
id|devc-&gt;dma16
suffix:colon
id|devc-&gt;dma8
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_JAZZ
op_logical_or
id|devc-&gt;model
op_eq
id|MDL_SMW
)paren
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
id|bits
op_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* 16 bit mode */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x40
)paren
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|devc-&gt;tconst
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|DSP_CMD_SPKOFF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;channels
op_eq
l_int|1
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xa0
op_or
id|bits
)paren
suffix:semicolon
multiline_comment|/* Mono input */
r_else
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xa8
op_or
id|bits
)paren
suffix:semicolon
multiline_comment|/* Stereo input */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sbpro_audio_prepare_for_output
id|sbpro_audio_prepare_for_output
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
multiline_comment|/* For SB Pro and Jazz16 */
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|tmp
suffix:semicolon
r_int
r_char
id|bits
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;dma16
op_ge
l_int|0
op_logical_and
id|devc-&gt;dma16
op_ne
id|devc-&gt;dma8
)paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;bits
op_eq
l_int|16
ques
c_cond
id|devc-&gt;dma16
suffix:colon
id|devc-&gt;dma8
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_SBPRO
)paren
id|sb_mixer_set_stereo
c_func
(paren
id|devc
comma
id|devc-&gt;channels
op_eq
l_int|2
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x40
)paren
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|devc-&gt;tconst
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|DSP_CMD_SPKON
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_JAZZ
op_logical_or
id|devc-&gt;model
op_eq
id|MDL_SMW
)paren
(brace
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
id|bits
op_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* 16 bit mode */
r_if
c_cond
(paren
id|devc-&gt;channels
op_eq
l_int|1
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xa0
op_or
id|bits
)paren
suffix:semicolon
multiline_comment|/* Mono output */
r_else
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xa8
op_or
id|bits
)paren
suffix:semicolon
multiline_comment|/* Stereo output */
)brace
r_else
(brace
id|tmp
op_assign
id|sb_getmixer
c_func
(paren
id|devc
comma
l_int|0x0e
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;channels
op_eq
l_int|1
)paren
id|tmp
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
r_else
id|tmp
op_or_assign
l_int|0x02
suffix:semicolon
id|sb_setmixer
c_func
(paren
id|devc
comma
l_int|0x0e
comma
id|tmp
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sbpro_audio_set_speed
id|sbpro_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|4000
)paren
id|speed
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|44100
)paren
id|speed
op_assign
l_int|44100
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;channels
OG
l_int|1
op_logical_and
id|speed
OG
l_int|22050
)paren
id|speed
op_assign
l_int|22050
suffix:semicolon
id|sb201_audio_set_speed
c_func
(paren
id|dev
comma
id|speed
)paren
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
r_static
r_int
DECL|function|sbpro_audio_set_channels
id|sbpro_audio_set_channels
c_func
(paren
r_int
id|dev
comma
r_int
id|channels
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
id|channels
op_eq
l_int|1
op_logical_or
id|channels
op_eq
l_int|2
)paren
r_if
c_cond
(paren
id|channels
op_ne
id|devc-&gt;channels
)paren
(brace
id|devc-&gt;channels
op_assign
id|channels
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;model
op_eq
id|MDL_SBPRO
op_logical_and
id|devc-&gt;channels
op_eq
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|devc-&gt;speed
OG
l_int|22050
)paren
id|printk
c_func
(paren
l_string|&quot;OSS: Application error. Wrong ioctl call order.&bslash;n&quot;
)paren
suffix:semicolon
id|sbpro_audio_set_speed
c_func
(paren
id|dev
comma
id|devc-&gt;speed
)paren
suffix:semicolon
)brace
)brace
r_return
id|devc-&gt;channels
suffix:semicolon
)brace
r_static
r_int
DECL|function|jazz16_audio_set_speed
id|jazz16_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_int
id|tmp
suffix:semicolon
r_int
id|s
op_assign
id|speed
op_star
id|devc-&gt;channels
suffix:semicolon
r_if
c_cond
(paren
id|speed
OL
l_int|5000
)paren
id|speed
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|44100
)paren
id|speed
op_assign
l_int|44100
suffix:semicolon
id|devc-&gt;tconst
op_assign
(paren
(paren
l_int|65536
op_minus
(paren
(paren
l_int|256000000
op_plus
id|s
op_div
l_int|2
)paren
op_div
id|s
)paren
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|tmp
op_assign
l_int|256
op_minus
id|devc-&gt;tconst
suffix:semicolon
id|speed
op_assign
(paren
(paren
l_int|1000000
op_plus
id|tmp
op_div
l_int|2
)paren
op_div
id|tmp
)paren
op_div
id|devc-&gt;channels
suffix:semicolon
id|devc-&gt;speed
op_assign
id|speed
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
multiline_comment|/*&n; * ESS specific routines&n; */
r_static
r_int
DECL|function|ess_audio_set_speed
id|ess_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|divider
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|5000
)paren
id|speed
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|48000
)paren
id|speed
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|22000
)paren
(brace
id|divider
op_assign
(paren
l_int|795500
op_plus
id|speed
op_div
l_int|2
)paren
op_div
id|speed
suffix:semicolon
id|speed
op_assign
(paren
l_int|795500
op_plus
id|divider
op_div
l_int|2
)paren
op_div
id|divider
suffix:semicolon
)brace
r_else
(brace
id|divider
op_assign
(paren
l_int|397700
op_plus
id|speed
op_div
l_int|2
)paren
op_div
id|speed
suffix:semicolon
id|speed
op_assign
(paren
l_int|397700
op_plus
id|divider
op_div
l_int|2
)paren
op_div
id|divider
suffix:semicolon
)brace
id|devc-&gt;speed
op_assign
id|speed
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
r_static
r_void
DECL|function|ess_speed
id|ess_speed
c_func
(paren
id|sb_devc
op_star
id|devc
)paren
(brace
r_int
id|divider
suffix:semicolon
r_int
r_char
id|bits
op_assign
l_int|0
suffix:semicolon
r_int
id|speed
op_assign
id|devc-&gt;speed
suffix:semicolon
r_if
c_cond
(paren
id|speed
OL
l_int|4000
)paren
id|speed
op_assign
l_int|4000
suffix:semicolon
r_else
r_if
c_cond
(paren
id|speed
OG
l_int|48000
)paren
id|speed
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|22000
)paren
(brace
id|bits
op_assign
l_int|0x80
suffix:semicolon
id|divider
op_assign
l_int|256
op_minus
(paren
l_int|795500
op_plus
id|speed
op_div
l_int|2
)paren
op_div
id|speed
suffix:semicolon
)brace
r_else
(brace
id|divider
op_assign
l_int|128
op_minus
(paren
l_int|397700
op_plus
id|speed
op_div
l_int|2
)paren
op_div
id|speed
suffix:semicolon
)brace
id|bits
op_or_assign
(paren
r_int
r_char
)paren
id|divider
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xa1
comma
id|bits
)paren
suffix:semicolon
multiline_comment|/*&n; * Set filter divider register&n; */
id|speed
op_assign
(paren
id|speed
op_star
l_int|9
)paren
op_div
l_int|20
suffix:semicolon
multiline_comment|/* Set filter roll-off to 90% of speed/2 */
id|divider
op_assign
l_int|256
op_minus
l_int|7160000
op_div
(paren
id|speed
op_star
l_int|82
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xa2
comma
id|divider
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|ess_audio_prepare_for_input
id|ess_audio_prepare_for_input
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|ess_speed
c_func
(paren
id|devc
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|DSP_CMD_SPKOFF
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb8
comma
l_int|0x0e
)paren
suffix:semicolon
multiline_comment|/* Auto init DMA mode */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xa8
comma
(paren
id|ess_read
c_func
(paren
id|devc
comma
l_int|0xa8
)paren
op_amp
op_complement
l_int|0x03
)paren
op_or
(paren
l_int|3
op_minus
id|devc-&gt;channels
)paren
)paren
suffix:semicolon
multiline_comment|/* Mono/stereo */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb9
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Demand mode (4 bytes/DMA request) */
r_if
c_cond
(paren
id|devc-&gt;channels
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_U8
)paren
(brace
multiline_comment|/* 8 bit mono */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0x51
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0xd0
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 16 bit mono */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0x71
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0xf4
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Stereo */
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_U8
)paren
(brace
multiline_comment|/* 8 bit stereo */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0x51
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0x98
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 16 bit stereo */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0x71
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0xbc
)paren
suffix:semicolon
)brace
)brace
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb1
comma
(paren
id|ess_read
c_func
(paren
id|devc
comma
l_int|0xb1
)paren
op_amp
l_int|0x0f
)paren
op_or
l_int|0x50
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb2
comma
(paren
id|ess_read
c_func
(paren
id|devc
comma
l_int|0xb2
)paren
op_amp
l_int|0x0f
)paren
op_or
l_int|0x50
)paren
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ess_audio_prepare_for_output
r_static
r_int
id|ess_audio_prepare_for_output
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|sb_dsp_reset
c_func
(paren
id|devc
)paren
suffix:semicolon
id|ess_speed
c_func
(paren
id|devc
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb8
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Auto init DMA mode */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xa8
comma
(paren
id|ess_read
c_func
(paren
id|devc
comma
l_int|0xa8
)paren
op_amp
op_complement
l_int|0x03
)paren
op_or
(paren
l_int|3
op_minus
id|devc-&gt;channels
)paren
)paren
suffix:semicolon
multiline_comment|/* Mono/stereo */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb9
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Demand mode (4 bytes/request) */
r_if
c_cond
(paren
id|devc-&gt;channels
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_U8
)paren
(brace
multiline_comment|/* 8 bit mono */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb6
comma
l_int|0x80
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0x51
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0xd0
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 16 bit mono */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb6
comma
l_int|0x00
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0x71
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0xf4
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Stereo */
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_U8
)paren
(brace
multiline_comment|/* 8 bit stereo */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb6
comma
l_int|0x80
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0x51
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0x98
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 16 bit stereo */
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb6
comma
l_int|0x00
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0x71
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb7
comma
l_int|0xbc
)paren
suffix:semicolon
)brace
)brace
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb1
comma
(paren
id|ess_read
c_func
(paren
id|devc
comma
l_int|0xb1
)paren
op_amp
l_int|0x0f
)paren
op_or
l_int|0x50
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb2
comma
(paren
id|ess_read
c_func
(paren
id|devc
comma
l_int|0xb2
)paren
op_amp
l_int|0x0f
)paren
op_or
l_int|0x50
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
id|DSP_CMD_SPKON
)paren
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ess_audio_output_block
r_static
r_void
id|ess_audio_output_block
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
r_int
id|count
op_assign
id|nr_bytes
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|c
op_assign
op_minus
id|nr_bytes
suffix:semicolon
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_WRITE); */
r_if
c_cond
(paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
OG
l_int|3
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_OUTPUT
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xa4
comma
(paren
r_int
r_char
)paren
(paren
(paren
r_int
r_int
)paren
id|c
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xa5
comma
(paren
r_int
r_char
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|c
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb8
comma
id|ess_read
c_func
(paren
id|devc
comma
l_int|0xb8
)paren
op_or
l_int|0x05
)paren
suffix:semicolon
multiline_comment|/* Go */
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|ess_audio_start_input
r_static
r_void
id|ess_audio_start_input
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|nr_bytes
comma
r_int
id|intrflag
)paren
(brace
r_int
id|count
op_assign
id|nr_bytes
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_int
id|c
op_assign
op_minus
id|nr_bytes
suffix:semicolon
multiline_comment|/*&n;&t; * Start a DMA input to the buffer pointed by dmaqtail&n;&t; */
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_READ); */
r_if
c_cond
(paren
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
OG
l_int|3
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_INPUT
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xa4
comma
(paren
r_int
r_char
)paren
(paren
(paren
r_int
r_int
)paren
id|c
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xa5
comma
(paren
r_int
r_char
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|c
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|ess_write
c_func
(paren
id|devc
comma
l_int|0xb8
comma
id|ess_read
c_func
(paren
id|devc
comma
l_int|0xb8
)paren
op_or
l_int|0x0f
)paren
suffix:semicolon
multiline_comment|/* Go */
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|ess_audio_trigger
r_static
r_void
id|ess_audio_trigger
c_func
(paren
r_int
id|dev
comma
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|bits
op_and_assign
id|devc-&gt;irq_mode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bits
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xd0
)paren
suffix:semicolon
multiline_comment|/* Halt DMA */
r_else
(brace
r_switch
c_cond
(paren
id|devc-&gt;irq_mode
)paren
(brace
r_case
id|IMODE_INPUT
suffix:colon
id|ess_audio_start_input
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMODE_OUTPUT
suffix:colon
id|ess_audio_output_block
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|devc-&gt;trigger_bits
op_assign
id|bits
suffix:semicolon
)brace
multiline_comment|/*&n; * SB16 specific routines&n; */
DECL|function|sb16_audio_set_speed
r_static
r_int
id|sb16_audio_set_speed
c_func
(paren
r_int
id|dev
comma
r_int
id|speed
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|speed
OL
l_int|5000
)paren
id|speed
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|speed
OG
l_int|44100
)paren
id|speed
op_assign
l_int|44100
suffix:semicolon
id|devc-&gt;speed
op_assign
id|speed
suffix:semicolon
)brace
r_return
id|devc-&gt;speed
suffix:semicolon
)brace
DECL|function|sb16_audio_set_bits
r_static
r_int
r_int
id|sb16_audio_set_bits
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
r_if
c_cond
(paren
id|bits
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|bits
op_eq
id|AFMT_U8
op_logical_or
id|bits
op_eq
id|AFMT_S16_LE
)paren
id|devc-&gt;bits
op_assign
id|bits
suffix:semicolon
r_else
id|devc-&gt;bits
op_assign
id|AFMT_U8
suffix:semicolon
)brace
r_return
id|devc-&gt;bits
suffix:semicolon
)brace
DECL|function|sb16_audio_prepare_for_input
r_static
r_int
id|sb16_audio_prepare_for_input
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
id|devc-&gt;dma16
suffix:colon
id|devc-&gt;dma8
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sb16_audio_prepare_for_output
r_static
r_int
id|sb16_audio_prepare_for_output
c_func
(paren
r_int
id|dev
comma
r_int
id|bsize
comma
r_int
id|bcount
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_out-&gt;dma
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|dmap_in-&gt;dma
op_assign
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
id|devc-&gt;dma16
suffix:colon
id|devc-&gt;dma8
suffix:semicolon
id|devc-&gt;trigger_bits
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sb16_audio_output_block
r_static
r_void
id|sb16_audio_output_block
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|count
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
comma
id|cnt
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_OUTPUT
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
id|cnt
op_rshift_assign
l_int|1
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_WRITE); */
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x41
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|devc-&gt;speed
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|devc-&gt;speed
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
l_int|0xb6
suffix:colon
l_int|0xc6
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
(paren
id|devc-&gt;channels
op_eq
l_int|2
ques
c_cond
l_int|0x20
suffix:colon
l_int|0
)paren
op_plus
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
l_int|0x10
suffix:colon
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|cnt
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|cnt
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sb16_audio_start_input
r_static
r_void
id|sb16_audio_start_input
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|buf
comma
r_int
id|count
comma
r_int
id|intrflag
)paren
(brace
r_int
r_int
id|flags
comma
id|cnt
suffix:semicolon
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|devc-&gt;irq_mode
op_assign
id|IMODE_INPUT
suffix:semicolon
id|devc-&gt;intr_active
op_assign
l_int|1
suffix:semicolon
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
)paren
id|cnt
op_rshift_assign
l_int|1
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* DMAbuf_start_dma (dev, buf, count, DMA_MODE_READ); */
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0x42
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|devc-&gt;speed
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|devc-&gt;speed
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
l_int|0xbe
suffix:colon
l_int|0xce
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
(paren
id|devc-&gt;channels
op_eq
l_int|2
ques
c_cond
l_int|0x20
suffix:colon
l_int|0
)paren
op_plus
(paren
id|devc-&gt;bits
op_eq
id|AFMT_S16_LE
ques
c_cond
l_int|0x10
suffix:colon
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|cnt
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|sb_dsp_command
c_func
(paren
id|devc
comma
(paren
r_int
r_char
)paren
(paren
id|cnt
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sb16_audio_trigger
r_static
r_void
id|sb16_audio_trigger
c_func
(paren
r_int
id|dev
comma
r_int
id|bits
)paren
(brace
id|sb_devc
op_star
id|devc
op_assign
id|audio_devs
(braket
id|dev
)braket
op_member_access_from_pointer
id|devc
suffix:semicolon
id|bits
op_and_assign
id|devc-&gt;irq_mode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bits
)paren
id|sb_dsp_command
c_func
(paren
id|devc
comma
l_int|0xd0
)paren
suffix:semicolon
multiline_comment|/* Halt DMA */
r_else
(brace
r_switch
c_cond
(paren
id|devc-&gt;irq_mode
)paren
(brace
r_case
id|IMODE_INPUT
suffix:colon
id|sb16_audio_start_input
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IMODE_OUTPUT
suffix:colon
id|sb16_audio_output_block
c_func
(paren
id|dev
comma
id|devc-&gt;trg_buf
comma
id|devc-&gt;trg_bytes
comma
id|devc-&gt;trg_intrflag
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|devc-&gt;trigger_bits
op_assign
id|bits
suffix:semicolon
)brace
DECL|function|sb_audio_ioctl
r_static
r_int
id|sb_audio_ioctl
c_func
(paren
r_int
id|dev
comma
r_int
r_int
id|cmd
comma
id|caddr_t
id|arg
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|sb1_audio_driver
r_static
r_struct
id|audio_driver
id|sb1_audio_driver
op_assign
multiline_comment|/* SB1.x */
(brace
id|sb_audio_open
comma
id|sb_audio_close
comma
id|sb_set_output_parms
comma
id|sb_set_input_parms
comma
id|sb_audio_ioctl
comma
id|sb1_audio_prepare_for_input
comma
id|sb1_audio_prepare_for_output
comma
id|sb1_audio_halt_xfer
comma
l_int|NULL
comma
multiline_comment|/* local_qlen */
l_int|NULL
comma
multiline_comment|/* copy_from_user */
l_int|NULL
comma
l_int|NULL
comma
id|sb1_audio_trigger
comma
id|sb1_audio_set_speed
comma
id|sb1_audio_set_bits
comma
id|sb1_audio_set_channels
)brace
suffix:semicolon
DECL|variable|sb20_audio_driver
r_static
r_struct
id|audio_driver
id|sb20_audio_driver
op_assign
multiline_comment|/* SB2.0 */
(brace
id|sb_audio_open
comma
id|sb_audio_close
comma
id|sb_set_output_parms
comma
id|sb_set_input_parms
comma
id|sb_audio_ioctl
comma
id|sb1_audio_prepare_for_input
comma
id|sb1_audio_prepare_for_output
comma
id|sb1_audio_halt_xfer
comma
l_int|NULL
comma
multiline_comment|/* local_qlen */
l_int|NULL
comma
multiline_comment|/* copy_from_user */
l_int|NULL
comma
l_int|NULL
comma
id|sb20_audio_trigger
comma
id|sb1_audio_set_speed
comma
id|sb1_audio_set_bits
comma
id|sb1_audio_set_channels
)brace
suffix:semicolon
DECL|variable|sb201_audio_driver
r_static
r_struct
id|audio_driver
id|sb201_audio_driver
op_assign
multiline_comment|/* SB2.01 */
(brace
id|sb_audio_open
comma
id|sb_audio_close
comma
id|sb_set_output_parms
comma
id|sb_set_input_parms
comma
id|sb_audio_ioctl
comma
id|sb1_audio_prepare_for_input
comma
id|sb1_audio_prepare_for_output
comma
id|sb1_audio_halt_xfer
comma
l_int|NULL
comma
multiline_comment|/* local_qlen */
l_int|NULL
comma
multiline_comment|/* copy_from_user */
l_int|NULL
comma
l_int|NULL
comma
id|sb20_audio_trigger
comma
id|sb201_audio_set_speed
comma
id|sb1_audio_set_bits
comma
id|sb1_audio_set_channels
)brace
suffix:semicolon
DECL|variable|sbpro_audio_driver
r_static
r_struct
id|audio_driver
id|sbpro_audio_driver
op_assign
multiline_comment|/* SB Pro */
(brace
id|sb_audio_open
comma
id|sb_audio_close
comma
id|sb_set_output_parms
comma
id|sb_set_input_parms
comma
id|sb_audio_ioctl
comma
id|sbpro_audio_prepare_for_input
comma
id|sbpro_audio_prepare_for_output
comma
id|sb1_audio_halt_xfer
comma
l_int|NULL
comma
multiline_comment|/* local_qlen */
l_int|NULL
comma
multiline_comment|/* copy_from_user */
l_int|NULL
comma
l_int|NULL
comma
id|sb20_audio_trigger
comma
id|sbpro_audio_set_speed
comma
id|sb1_audio_set_bits
comma
id|sbpro_audio_set_channels
)brace
suffix:semicolon
DECL|variable|jazz16_audio_driver
r_static
r_struct
id|audio_driver
id|jazz16_audio_driver
op_assign
multiline_comment|/* Jazz16 and SM Wave */
(brace
id|sb_audio_open
comma
id|sb_audio_close
comma
id|sb_set_output_parms
comma
id|sb_set_input_parms
comma
id|sb_audio_ioctl
comma
id|sbpro_audio_prepare_for_input
comma
id|sbpro_audio_prepare_for_output
comma
id|sb1_audio_halt_xfer
comma
l_int|NULL
comma
multiline_comment|/* local_qlen */
l_int|NULL
comma
multiline_comment|/* copy_from_user */
l_int|NULL
comma
l_int|NULL
comma
id|sb20_audio_trigger
comma
id|jazz16_audio_set_speed
comma
id|sb16_audio_set_bits
comma
id|sbpro_audio_set_channels
)brace
suffix:semicolon
DECL|variable|sb16_audio_driver
r_static
r_struct
id|audio_driver
id|sb16_audio_driver
op_assign
multiline_comment|/* SB16 */
(brace
id|sb_audio_open
comma
id|sb_audio_close
comma
id|sb_set_output_parms
comma
id|sb_set_input_parms
comma
id|sb_audio_ioctl
comma
id|sb16_audio_prepare_for_input
comma
id|sb16_audio_prepare_for_output
comma
id|sb1_audio_halt_xfer
comma
l_int|NULL
comma
multiline_comment|/* local_qlen */
l_int|NULL
comma
multiline_comment|/* copy_from_user */
l_int|NULL
comma
l_int|NULL
comma
id|sb16_audio_trigger
comma
id|sb16_audio_set_speed
comma
id|sb16_audio_set_bits
comma
id|sbpro_audio_set_channels
)brace
suffix:semicolon
DECL|variable|ess_audio_driver
r_static
r_struct
id|audio_driver
id|ess_audio_driver
op_assign
multiline_comment|/* ESS ES688/1688 */
(brace
id|sb_audio_open
comma
id|sb_audio_close
comma
id|sb_set_output_parms
comma
id|sb_set_input_parms
comma
id|sb_audio_ioctl
comma
id|ess_audio_prepare_for_input
comma
id|ess_audio_prepare_for_output
comma
id|sb1_audio_halt_xfer
comma
l_int|NULL
comma
multiline_comment|/* local_qlen */
l_int|NULL
comma
multiline_comment|/* copy_from_user */
l_int|NULL
comma
l_int|NULL
comma
id|ess_audio_trigger
comma
id|ess_audio_set_speed
comma
id|sb16_audio_set_bits
comma
id|sbpro_audio_set_channels
)brace
suffix:semicolon
DECL|function|sb_audio_init
r_void
id|sb_audio_init
c_func
(paren
id|sb_devc
op_star
id|devc
comma
r_char
op_star
id|name
)paren
(brace
r_int
id|audio_flags
op_assign
l_int|0
suffix:semicolon
r_int
id|format_mask
op_assign
id|AFMT_U8
suffix:semicolon
r_struct
id|audio_driver
op_star
id|driver
op_assign
op_amp
id|sb1_audio_driver
suffix:semicolon
r_switch
c_cond
(paren
id|devc-&gt;model
)paren
(brace
r_case
id|MDL_SB1
suffix:colon
multiline_comment|/* SB1.0 or SB 1.5 */
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use standard SB1.x driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_HARDSTOP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_SB2
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use SB2.0 driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|driver
op_assign
op_amp
id|sb20_audio_driver
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_SB201
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use SB2.01 (high speed) driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|driver
op_assign
op_amp
id|sb201_audio_driver
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_JAZZ
suffix:colon
r_case
id|MDL_SMW
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use Jazz16 driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|format_mask
op_or_assign
id|AFMT_S16_LE
suffix:semicolon
id|driver
op_assign
op_amp
id|jazz16_audio_driver
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_ESS
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use ESS ES688/1688 driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|format_mask
op_or_assign
id|AFMT_S16_LE
suffix:semicolon
id|driver
op_assign
op_amp
id|ess_audio_driver
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MDL_SB16
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use SB16 driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|format_mask
op_or_assign
id|AFMT_S16_LE
suffix:semicolon
id|driver
op_assign
op_amp
id|sb16_audio_driver
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DDB
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;Will use SB Pro driver&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|audio_flags
op_assign
id|DMA_AUTOMODE
suffix:semicolon
id|driver
op_assign
op_amp
id|sbpro_audio_driver
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|devc-&gt;my_dev
op_assign
id|sound_install_audiodrv
c_func
(paren
id|AUDIO_DRIVER_VERSION
comma
id|name
comma
id|driver
comma
r_sizeof
(paren
r_struct
id|audio_driver
)paren
comma
id|audio_flags
comma
id|format_mask
comma
id|devc
comma
id|devc-&gt;dma8
comma
id|devc-&gt;dma8
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sb: unable to install audio.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|audio_devs
(braket
id|devc-&gt;my_dev
)braket
op_member_access_from_pointer
id|mixer_dev
op_assign
id|devc-&gt;my_mixerdev
suffix:semicolon
id|audio_devs
(braket
id|devc-&gt;my_dev
)braket
op_member_access_from_pointer
id|min_fragment
op_assign
l_int|5
suffix:semicolon
)brace
macro_line|#endif
eof
