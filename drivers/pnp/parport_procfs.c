multiline_comment|/* $Id: parport_procfs.c,v 1.3.2.6 1997/04/16 21:30:38 phil Exp $&n; * Parallel port /proc interface code.&n; * &n; * Authors: David Campbell &lt;campbell@tirian.che.curtin.edu.au&gt;&n; *          Tim Waugh &lt;tmw20@cam.ac.uk&gt;&n; *&n; * based on work by Grant Guenther &lt;grant@torque.net&gt;&n; *              and Philip Blundell &lt;Philip.Blundell@pobox.com&gt;&n; */
macro_line|#include &lt;linux/tasks.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/parport.h&gt;
macro_line|#include &quot;parport_ll_io.h&quot;
DECL|macro|PARPORT_INCLUDE_BENCH
macro_line|#undef PARPORT_INCLUDE_BENCH
DECL|variable|base
r_struct
id|proc_dir_entry
op_star
id|base
op_assign
l_int|NULL
suffix:semicolon
r_void
id|parport_null_intr_func
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
DECL|function|irq_write_proc
r_static
r_int
id|irq_write_proc
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|newirq
suffix:semicolon
r_struct
id|parport
op_star
id|pp
op_assign
(paren
r_struct
id|parport
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|4
)paren
multiline_comment|/* more than 4 digits for a irq 0x?? 0?? ??  */
r_return
op_minus
id|EOVERFLOW
suffix:semicolon
r_if
c_cond
(paren
id|buffer
(braket
l_int|0
)braket
OL
l_int|32
op_logical_or
op_logical_neg
id|strncmp
c_func
(paren
id|buffer
comma
l_string|&quot;none&quot;
comma
l_int|4
)paren
)paren
(brace
id|newirq
op_assign
id|PARPORT_IRQ_NONE
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|buffer
(braket
l_int|0
)braket
op_eq
l_char|&squot;0&squot;
)paren
(brace
r_if
c_cond
(paren
id|buffer
(braket
l_int|1
)braket
op_eq
l_char|&squot;x&squot;
)paren
(brace
id|newirq
op_assign
id|simple_strtoul
c_func
(paren
op_amp
id|buffer
(braket
l_int|2
)braket
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
)brace
r_else
id|newirq
op_assign
id|simple_strtoul
c_func
(paren
op_amp
id|buffer
(braket
l_int|1
)braket
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
)brace
r_else
(brace
id|newirq
op_assign
id|simple_strtoul
c_func
(paren
id|buffer
comma
l_int|0
comma
l_int|10
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pp-&gt;irq
op_ne
id|PARPORT_IRQ_NONE
op_logical_and
op_logical_neg
(paren
id|pp-&gt;flags
op_amp
id|PARPORT_FLAG_COMA
)paren
)paren
id|free_irq
c_func
(paren
id|pp-&gt;irq
comma
id|pp
)paren
suffix:semicolon
id|pp-&gt;irq
op_assign
id|newirq
suffix:semicolon
r_if
c_cond
(paren
id|pp-&gt;irq
op_ne
id|PARPORT_IRQ_NONE
op_logical_and
op_logical_neg
(paren
id|pp-&gt;flags
op_amp
id|PARPORT_FLAG_COMA
)paren
)paren
(brace
r_struct
id|ppd
op_star
id|pd
op_assign
id|pp-&gt;cad
suffix:semicolon
r_if
c_cond
(paren
id|pd
op_eq
l_int|NULL
)paren
(brace
id|pd
op_assign
id|pp-&gt;devices
suffix:semicolon
r_if
c_cond
(paren
id|pd
op_ne
l_int|NULL
)paren
id|request_irq
c_func
(paren
id|pp-&gt;irq
comma
id|pd-&gt;irq_func
ques
c_cond
id|pd-&gt;irq_func
suffix:colon
id|parport_null_intr_func
comma
id|SA_INTERRUPT
comma
id|pd-&gt;name
comma
id|pd-&gt;port
)paren
suffix:semicolon
)brace
r_else
(brace
id|request_irq
c_func
(paren
id|pp-&gt;irq
comma
id|pd-&gt;irq_func
ques
c_cond
id|pd-&gt;irq_func
suffix:colon
id|parport_null_intr_func
comma
id|SA_INTERRUPT
comma
id|pp-&gt;name
comma
id|pd-&gt;port
)paren
suffix:semicolon
)brace
)brace
r_return
id|count
suffix:semicolon
)brace
DECL|function|irq_read_proc
r_static
r_int
id|irq_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|parport
op_star
id|pp
op_assign
(paren
r_struct
id|parport
op_star
)paren
id|data
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pp-&gt;irq
op_eq
id|PARPORT_IRQ_NONE
)paren
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;none&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|len
op_assign
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|pp-&gt;irq
)paren
suffix:semicolon
op_star
id|start
op_assign
l_int|0
suffix:semicolon
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|devices_read_proc
r_static
r_int
id|devices_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|parport
op_star
id|pp
op_assign
(paren
r_struct
id|parport
op_star
)paren
id|data
suffix:semicolon
r_struct
id|ppd
op_star
id|pd1
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|pd1
op_assign
id|pp-&gt;devices
suffix:semicolon
id|pd1
suffix:semicolon
id|pd1
op_assign
id|pd1-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pd1
op_eq
id|pp-&gt;cad
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;+&quot;
)paren
suffix:semicolon
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot; &quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;%s&quot;
comma
id|pd1-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pd1
op_eq
id|pp-&gt;lurker
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot; LURK&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
op_star
id|start
op_assign
l_int|0
suffix:semicolon
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|hardware_read_proc
r_static
r_int
id|hardware_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|parport
op_star
id|pp
op_assign
(paren
r_struct
id|parport
op_star
)paren
id|data
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;base:&bslash;t0x%x&bslash;n&quot;
comma
id|pp-&gt;base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pp-&gt;irq
op_eq
id|PARPORT_IRQ_NONE
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;irq:&bslash;tnone&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;irq:&bslash;t%d&bslash;n&quot;
comma
id|pp-&gt;irq
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;dma:&bslash;t%d&bslash;n&quot;
comma
id|pp-&gt;dma
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;modes:&bslash;t&quot;
)paren
suffix:semicolon
(brace
DECL|macro|printmode
mdefine_line|#define printmode(x) {if(pp-&gt;modes&amp;PARPORT_MODE_##x){len+=sprintf(page+len,&quot;%s%s&quot;,f?&quot;,&quot;:&quot;&quot;,#x);f++;}}
r_int
id|f
op_assign
l_int|0
suffix:semicolon
id|printmode
c_func
(paren
id|SPP
)paren
suffix:semicolon
id|printmode
c_func
(paren
id|PS2
)paren
suffix:semicolon
id|printmode
c_func
(paren
id|EPP
)paren
suffix:semicolon
id|printmode
c_func
(paren
id|ECP
)paren
suffix:semicolon
id|printmode
c_func
(paren
id|ECPEPP
)paren
suffix:semicolon
id|printmode
c_func
(paren
id|ECPPS2
)paren
suffix:semicolon
DECL|macro|printmode
macro_line|#undef printmode
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;mode:&bslash;t&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pp-&gt;modes
op_amp
id|PARPORT_MODE_ECR
)paren
(brace
r_switch
c_cond
(paren
id|r_ecr
c_func
(paren
id|pp
)paren
op_rshift
l_int|5
)paren
(brace
r_case
l_int|0
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;SPP&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pp-&gt;modes
op_amp
id|PARPORT_MODE_PS2
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;,PS2&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pp-&gt;modes
op_amp
id|PARPORT_MODE_EPP
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;,EPP&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;ECPPS2&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;DATAFIFO&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;ECP&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;ECPEPP&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Reserved?&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;TEST&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Configuration&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;SPP&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pp-&gt;modes
op_amp
id|PARPORT_MODE_PS2
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;,PS2&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pp-&gt;modes
op_amp
id|PARPORT_MODE_EPP
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;,EPP&quot;
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* Now no detection, please fix with an external function */
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;chipset:&bslash;tunknown&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef PARPORT_INCLUDE_BENCHMARK
r_if
c_cond
(paren
id|pp-&gt;speed
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;bench:&bslash;t%d Bytes/s&bslash;n&quot;
comma
id|pp-&gt;speed
)paren
suffix:semicolon
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
id|len
comma
l_string|&quot;bench:&bslash;tunknown&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
op_star
id|start
op_assign
l_int|0
suffix:semicolon
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|new_proc_entry
r_static
r_struct
id|proc_dir_entry
op_star
id|new_proc_entry
c_func
(paren
r_const
r_char
op_star
id|name
comma
id|mode_t
id|mode
comma
r_struct
id|proc_dir_entry
op_star
id|parent
comma
r_int
r_int
id|ino
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|ent
suffix:semicolon
id|ent
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|proc_dir_entry
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ent
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|ent
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|proc_dir_entry
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|S_IFDIR
)paren
id|mode
op_or_assign
id|S_IRUGO
op_or
id|S_IXUGO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|mode
op_eq
l_int|0
)paren
id|mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
suffix:semicolon
id|ent-&gt;low_ino
op_assign
id|ino
suffix:semicolon
id|ent-&gt;name
op_assign
id|name
suffix:semicolon
id|ent-&gt;namelen
op_assign
id|strlen
c_func
(paren
id|name
)paren
suffix:semicolon
id|ent-&gt;mode
op_assign
id|mode
suffix:semicolon
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|mode
)paren
)paren
id|ent-&gt;nlink
op_assign
l_int|2
suffix:semicolon
r_else
id|ent-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|proc_register
c_func
(paren
id|parent
comma
id|ent
)paren
suffix:semicolon
r_return
id|ent
suffix:semicolon
)brace
DECL|function|parport_proc_init
r_int
id|parport_proc_init
c_func
(paren
)paren
(brace
id|base
op_assign
id|new_proc_entry
c_func
(paren
l_string|&quot;parport&quot;
comma
id|S_IFDIR
comma
op_amp
id|proc_root
comma
id|PROC_PARPORT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|base
)paren
r_return
l_int|1
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;parport: Error creating proc entry /proc/parport&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|parport_proc_cleanup
r_int
id|parport_proc_cleanup
c_func
(paren
)paren
(brace
r_if
c_cond
(paren
id|base
)paren
id|proc_unregister
c_func
(paren
op_amp
id|proc_root
comma
id|base-&gt;low_ino
)paren
suffix:semicolon
id|base
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|parport_proc_register
r_int
id|parport_proc_register
c_func
(paren
r_struct
id|parport
op_star
id|pp
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|ent
suffix:semicolon
r_static
r_int
id|conta
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|pp-&gt;pdir
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|parport_dir
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|base
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;parport: Error entry /proc/parport, not generated?&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|name
op_assign
id|pp-&gt;pdir.name
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;%d&quot;
comma
id|conta
op_increment
)paren
suffix:semicolon
id|ent
op_assign
id|new_proc_entry
c_func
(paren
id|name
comma
id|S_IFDIR
comma
id|base
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ent
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;parport: Error registering proc_entry /proc/%s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|pp-&gt;pdir.entry
op_assign
id|ent
suffix:semicolon
id|ent
op_assign
id|new_proc_entry
c_func
(paren
l_string|&quot;irq&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|pp-&gt;pdir.entry
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ent
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;parport: Error registering proc_entry /proc/%s/irq&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|ent-&gt;read_proc
op_assign
id|irq_read_proc
suffix:semicolon
id|ent-&gt;write_proc
op_assign
id|irq_write_proc
suffix:semicolon
id|ent-&gt;data
op_assign
id|pp
suffix:semicolon
id|pp-&gt;pdir.irq
op_assign
id|ent
suffix:semicolon
id|ent
op_assign
id|new_proc_entry
c_func
(paren
l_string|&quot;devices&quot;
comma
l_int|0
comma
id|pp-&gt;pdir.entry
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ent
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;parport: Error registering proc_entry /proc/%s/devices&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|ent-&gt;read_proc
op_assign
id|devices_read_proc
suffix:semicolon
id|ent-&gt;data
op_assign
id|pp
suffix:semicolon
id|pp-&gt;pdir.devices
op_assign
id|ent
suffix:semicolon
id|ent
op_assign
id|new_proc_entry
c_func
(paren
l_string|&quot;hardware&quot;
comma
l_int|0
comma
id|pp-&gt;pdir.entry
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ent
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;parport: Error registering proc_entry /proc/%s/hardware&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|ent-&gt;read_proc
op_assign
id|hardware_read_proc
suffix:semicolon
id|ent-&gt;data
op_assign
id|pp
suffix:semicolon
id|pp-&gt;pdir.hardware
op_assign
id|ent
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|parport_proc_unregister
r_int
id|parport_proc_unregister
c_func
(paren
r_struct
id|parport
op_star
id|pp
)paren
(brace
r_if
c_cond
(paren
id|pp-&gt;pdir.entry
)paren
(brace
r_if
c_cond
(paren
id|pp-&gt;pdir.irq
)paren
(brace
id|proc_unregister
c_func
(paren
id|pp-&gt;pdir.entry
comma
id|pp-&gt;pdir.irq-&gt;low_ino
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pp-&gt;pdir.irq
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pp-&gt;pdir.devices
)paren
(brace
id|proc_unregister
c_func
(paren
id|pp-&gt;pdir.entry
comma
id|pp-&gt;pdir.devices-&gt;low_ino
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pp-&gt;pdir.devices
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pp-&gt;pdir.hardware
)paren
(brace
id|proc_unregister
c_func
(paren
id|pp-&gt;pdir.entry
comma
id|pp-&gt;pdir.hardware-&gt;low_ino
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pp-&gt;pdir.hardware
)paren
suffix:semicolon
)brace
id|proc_unregister
c_func
(paren
id|base
comma
id|pp-&gt;pdir.entry-&gt;low_ino
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pp-&gt;pdir.entry
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
