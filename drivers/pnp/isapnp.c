multiline_comment|/*&n; *  ISA Plug &amp; Play support&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *  Changelog:&n; *  2000-01-01&t;Added quirks handling for buggy hardware&n; *&t;&t;Peter Denison &lt;peterd@pnd-pc.demon.co.uk&gt;&n; *  2000-06-14&t;Added isapnp_probe_devs() and isapnp_activate_dev()&n; *&t;&t;Christoph Hellwig &lt;hch@caldera.de&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/isapnp.h&gt;
DECL|variable|isapnp_cards
id|LIST_HEAD
c_func
(paren
id|isapnp_cards
)paren
suffix:semicolon
DECL|variable|isapnp_devices
id|LIST_HEAD
c_func
(paren
id|isapnp_devices
)paren
suffix:semicolon
macro_line|#if 0
mdefine_line|#define ISAPNP_REGION_OK
macro_line|#endif
macro_line|#if 0
mdefine_line|#define ISAPNP_DEBUG
macro_line|#endif
DECL|variable|pidxr_res
r_struct
id|resource
op_star
id|pidxr_res
suffix:semicolon
DECL|variable|pnpwrp_res
r_struct
id|resource
op_star
id|pnpwrp_res
suffix:semicolon
DECL|variable|isapnp_rdp_res
r_struct
id|resource
op_star
id|isapnp_rdp_res
suffix:semicolon
DECL|variable|isapnp_disable
r_int
id|isapnp_disable
suffix:semicolon
multiline_comment|/* Disable ISA PnP */
DECL|variable|isapnp_rdp
r_int
id|isapnp_rdp
suffix:semicolon
multiline_comment|/* Read Data Port */
DECL|variable|isapnp_reset
r_int
id|isapnp_reset
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* reset all PnP cards (deactivate) */
DECL|variable|isapnp_skip_pci_scan
r_int
id|isapnp_skip_pci_scan
suffix:semicolon
multiline_comment|/* skip PCI resource scanning */
DECL|variable|isapnp_verbose
r_int
id|isapnp_verbose
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* verbose mode */
DECL|variable|isapnp_reserve_irq
r_int
id|isapnp_reserve_irq
(braket
l_int|16
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
l_int|15
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* reserve (don&squot;t use) some IRQ */
DECL|variable|isapnp_reserve_dma
r_int
id|isapnp_reserve_dma
(braket
l_int|8
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
l_int|7
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* reserve (don&squot;t use) some DMA */
DECL|variable|isapnp_reserve_io
r_int
id|isapnp_reserve_io
(braket
l_int|16
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
l_int|15
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* reserve (don&squot;t use) some I/O region */
DECL|variable|isapnp_reserve_mem
r_int
id|isapnp_reserve_mem
(braket
l_int|16
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
l_int|15
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* reserve (don&squot;t use) some memory region */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Generic ISA Plug &amp; Play support&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|isapnp_disable
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_disable
comma
l_string|&quot;ISA Plug &amp; Play disable&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|isapnp_rdp
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_rdp
comma
l_string|&quot;ISA Plug &amp; Play read data port&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|isapnp_reset
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_reset
comma
l_string|&quot;ISA Plug &amp; Play reset all cards&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|isapnp_skip_pci_scan
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_skip_pci_scan
comma
l_string|&quot;ISA Plug &amp; Play skip PCI resource scanning&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|isapnp_verbose
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_verbose
comma
l_string|&quot;ISA Plug &amp; Play verbose mode&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|isapnp_reserve_irq
comma
l_string|&quot;1-16i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_reserve_irq
comma
l_string|&quot;ISA Plug &amp; Play - reserve IRQ line(s)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|isapnp_reserve_dma
comma
l_string|&quot;1-8i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_reserve_dma
comma
l_string|&quot;ISA Plug &amp; Play - reserve DMA channel(s)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|isapnp_reserve_io
comma
l_string|&quot;1-16i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_reserve_io
comma
l_string|&quot;ISA Plug &amp; Play - reserve I/O region(s) - port,size&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|isapnp_reserve_mem
comma
l_string|&quot;1-16i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_reserve_mem
comma
l_string|&quot;ISA Plug &amp; Play - reserve memory region(s) - address,size&quot;
)paren
suffix:semicolon
DECL|macro|_PIDXR
mdefine_line|#define _PIDXR&t;&t;0x279
DECL|macro|_PNPWRP
mdefine_line|#define _PNPWRP&t;&t;0xa79
multiline_comment|/* short tags */
DECL|macro|_STAG_PNPVERNO
mdefine_line|#define _STAG_PNPVERNO&t;&t;0x01
DECL|macro|_STAG_LOGDEVID
mdefine_line|#define _STAG_LOGDEVID&t;&t;0x02
DECL|macro|_STAG_COMPATDEVID
mdefine_line|#define _STAG_COMPATDEVID&t;0x03
DECL|macro|_STAG_IRQ
mdefine_line|#define _STAG_IRQ&t;&t;0x04
DECL|macro|_STAG_DMA
mdefine_line|#define _STAG_DMA&t;&t;0x05
DECL|macro|_STAG_STARTDEP
mdefine_line|#define _STAG_STARTDEP&t;&t;0x06
DECL|macro|_STAG_ENDDEP
mdefine_line|#define _STAG_ENDDEP&t;&t;0x07
DECL|macro|_STAG_IOPORT
mdefine_line|#define _STAG_IOPORT&t;&t;0x08
DECL|macro|_STAG_FIXEDIO
mdefine_line|#define _STAG_FIXEDIO&t;&t;0x09
DECL|macro|_STAG_VENDOR
mdefine_line|#define _STAG_VENDOR&t;&t;0x0e
DECL|macro|_STAG_END
mdefine_line|#define _STAG_END&t;&t;0x0f
multiline_comment|/* long tags */
DECL|macro|_LTAG_MEMRANGE
mdefine_line|#define _LTAG_MEMRANGE&t;&t;0x81
DECL|macro|_LTAG_ANSISTR
mdefine_line|#define _LTAG_ANSISTR&t;&t;0x82
DECL|macro|_LTAG_UNICODESTR
mdefine_line|#define _LTAG_UNICODESTR&t;0x83
DECL|macro|_LTAG_VENDOR
mdefine_line|#define _LTAG_VENDOR&t;&t;0x84
DECL|macro|_LTAG_MEM32RANGE
mdefine_line|#define _LTAG_MEM32RANGE&t;0x85
DECL|macro|_LTAG_FIXEDMEM32RANGE
mdefine_line|#define _LTAG_FIXEDMEM32RANGE&t;0x86
DECL|variable|isapnp_checksum_value
r_static
r_int
r_char
id|isapnp_checksum_value
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|isapnp_cfg_mutex
)paren
suffix:semicolon
DECL|variable|isapnp_detected
r_static
r_int
id|isapnp_detected
suffix:semicolon
multiline_comment|/* some prototypes */
r_static
r_int
id|isapnp_config_prepare
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|isapnp_config_activate
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|isapnp_config_deactivate
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
suffix:semicolon
DECL|function|write_data
r_static
r_inline
r_void
id|write_data
c_func
(paren
r_int
r_char
id|x
)paren
(brace
id|outb
c_func
(paren
id|x
comma
id|_PNPWRP
)paren
suffix:semicolon
)brace
DECL|function|write_address
r_static
r_inline
r_void
id|write_address
c_func
(paren
r_int
r_char
id|x
)paren
(brace
id|outb
c_func
(paren
id|x
comma
id|_PIDXR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
DECL|function|read_data
r_static
r_inline
r_int
r_char
id|read_data
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|val
op_assign
id|inb
c_func
(paren
id|isapnp_rdp
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|isapnp_read_byte
r_int
r_char
id|isapnp_read_byte
c_func
(paren
r_int
r_char
id|idx
)paren
(brace
id|write_address
c_func
(paren
id|idx
)paren
suffix:semicolon
r_return
id|read_data
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|isapnp_read_word
r_int
r_int
id|isapnp_read_word
c_func
(paren
r_int
r_char
id|idx
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|isapnp_read_byte
c_func
(paren
id|idx
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_plus
id|isapnp_read_byte
c_func
(paren
id|idx
op_plus
l_int|1
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|isapnp_read_dword
r_int
r_int
id|isapnp_read_dword
c_func
(paren
r_int
r_char
id|idx
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|isapnp_read_byte
c_func
(paren
id|idx
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_plus
id|isapnp_read_byte
c_func
(paren
id|idx
op_plus
l_int|1
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_plus
id|isapnp_read_byte
c_func
(paren
id|idx
op_plus
l_int|2
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_plus
id|isapnp_read_byte
c_func
(paren
id|idx
op_plus
l_int|3
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|isapnp_write_byte
r_void
id|isapnp_write_byte
c_func
(paren
r_int
r_char
id|idx
comma
r_int
r_char
id|val
)paren
(brace
id|write_address
c_func
(paren
id|idx
)paren
suffix:semicolon
id|write_data
c_func
(paren
id|val
)paren
suffix:semicolon
)brace
DECL|function|isapnp_write_word
r_void
id|isapnp_write_word
c_func
(paren
r_int
r_char
id|idx
comma
r_int
r_int
id|val
)paren
(brace
id|isapnp_write_byte
c_func
(paren
id|idx
comma
id|val
op_rshift
l_int|8
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|idx
op_plus
l_int|1
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|isapnp_write_dword
r_void
id|isapnp_write_dword
c_func
(paren
r_int
r_char
id|idx
comma
r_int
r_int
id|val
)paren
(brace
id|isapnp_write_byte
c_func
(paren
id|idx
comma
id|val
op_rshift
l_int|24
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|idx
op_plus
l_int|1
comma
id|val
op_rshift
l_int|16
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|idx
op_plus
l_int|2
comma
id|val
op_rshift
l_int|8
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|idx
op_plus
l_int|3
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|isapnp_alloc
r_void
op_star
id|isapnp_alloc
c_func
(paren
r_int
id|size
)paren
(brace
r_void
op_star
id|result
suffix:semicolon
id|result
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|result
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|result
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|isapnp_key
r_static
r_void
id|isapnp_key
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|code
op_assign
l_int|0x6a
comma
id|msb
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|write_address
c_func
(paren
l_int|0x00
)paren
suffix:semicolon
id|write_address
c_func
(paren
l_int|0x00
)paren
suffix:semicolon
id|write_address
c_func
(paren
id|code
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|msb
op_assign
(paren
(paren
id|code
op_amp
l_int|0x01
)paren
op_xor
(paren
(paren
id|code
op_amp
l_int|0x02
)paren
op_rshift
l_int|1
)paren
)paren
op_lshift
l_int|7
suffix:semicolon
id|code
op_assign
(paren
id|code
op_rshift
l_int|1
)paren
op_or
id|msb
suffix:semicolon
id|write_address
c_func
(paren
id|code
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* place all pnp cards in wait-for-key state */
DECL|function|isapnp_wait
r_static
r_void
id|isapnp_wait
c_func
(paren
r_void
)paren
(brace
id|isapnp_write_byte
c_func
(paren
l_int|0x02
comma
l_int|0x02
)paren
suffix:semicolon
)brace
DECL|function|isapnp_wake
r_void
id|isapnp_wake
c_func
(paren
r_int
r_char
id|csn
)paren
(brace
id|isapnp_write_byte
c_func
(paren
l_int|0x03
comma
id|csn
)paren
suffix:semicolon
)brace
DECL|function|isapnp_device
r_void
id|isapnp_device
c_func
(paren
r_int
r_char
id|logdev
)paren
(brace
id|isapnp_write_byte
c_func
(paren
l_int|0x07
comma
id|logdev
)paren
suffix:semicolon
)brace
DECL|function|isapnp_activate
r_void
id|isapnp_activate
c_func
(paren
r_int
r_char
id|logdev
)paren
(brace
id|isapnp_device
c_func
(paren
id|logdev
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|ISAPNP_CFG_ACTIVATE
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
)brace
DECL|function|isapnp_deactivate
r_void
id|isapnp_deactivate
c_func
(paren
r_int
r_char
id|logdev
)paren
(brace
id|isapnp_device
c_func
(paren
id|logdev
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|ISAPNP_CFG_ACTIVATE
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
)brace
DECL|function|isapnp_peek
r_static
r_void
id|__init
id|isapnp_peek
c_func
(paren
r_int
r_char
op_star
id|data
comma
r_int
id|bytes
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_char
id|d
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|bytes
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|20
suffix:semicolon
id|j
op_increment
)paren
(brace
id|d
op_assign
id|isapnp_read_byte
c_func
(paren
l_int|0x05
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
op_amp
l_int|1
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|d
op_amp
l_int|1
)paren
)paren
(brace
r_if
c_cond
(paren
id|data
op_ne
l_int|NULL
)paren
op_star
id|data
op_increment
op_assign
l_int|0xff
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|d
op_assign
id|isapnp_read_byte
c_func
(paren
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* PRESDI */
id|isapnp_checksum_value
op_add_assign
id|d
suffix:semicolon
r_if
c_cond
(paren
id|data
op_ne
l_int|NULL
)paren
op_star
id|data
op_increment
op_assign
id|d
suffix:semicolon
)brace
)brace
DECL|macro|RDP_STEP
mdefine_line|#define RDP_STEP&t;32&t;/* minimum is 4 */
DECL|function|isapnp_next_rdp
r_static
r_int
id|isapnp_next_rdp
c_func
(paren
r_void
)paren
(brace
r_int
id|rdp
op_assign
id|isapnp_rdp
suffix:semicolon
r_while
c_loop
(paren
id|rdp
op_le
l_int|0x3ff
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;We cannot use NE2000 probe spaces for ISAPnP or we&n;&t;&t; *&t;will lock up machines.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|rdp
template_param
l_int|0x380
)paren
op_logical_and
op_logical_neg
id|check_region
c_func
(paren
id|rdp
comma
l_int|1
)paren
)paren
(brace
id|isapnp_rdp
op_assign
id|rdp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rdp
op_add_assign
id|RDP_STEP
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Set read port address */
DECL|function|isapnp_set_rdp
r_static
r_inline
r_void
id|isapnp_set_rdp
c_func
(paren
r_void
)paren
(brace
id|isapnp_write_byte
c_func
(paren
l_int|0x00
comma
id|isapnp_rdp
op_rshift
l_int|2
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Perform an isolation. The port selection code now tries to avoid&n; *&t;&quot;dangerous to read&quot; ports.&n; */
DECL|function|isapnp_isolate_rdp_select
r_static
r_int
id|__init
id|isapnp_isolate_rdp_select
c_func
(paren
r_void
)paren
(brace
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|isapnp_key
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Control: reset CSN and conditionally everything else too */
id|isapnp_write_byte
c_func
(paren
l_int|0x02
comma
id|isapnp_reset
ques
c_cond
l_int|0x05
suffix:colon
l_int|0x04
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|isapnp_key
c_func
(paren
)paren
suffix:semicolon
id|isapnp_wake
c_func
(paren
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_next_rdp
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|isapnp_set_rdp
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_address
c_func
(paren
l_int|0x01
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Isolate (assign uniqued CSN) to all ISA PnP devices.&n; */
DECL|function|isapnp_isolate
r_static
r_int
id|__init
id|isapnp_isolate
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|checksum
op_assign
l_int|0x6a
suffix:semicolon
r_int
r_char
id|chksum
op_assign
l_int|0x00
suffix:semicolon
r_int
r_char
id|bit
op_assign
l_int|0x00
suffix:semicolon
r_int
id|data
suffix:semicolon
r_int
id|csn
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|iteration
op_assign
l_int|1
suffix:semicolon
id|isapnp_rdp
op_assign
l_int|0x213
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_isolate_rdp_select
c_func
(paren
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|64
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data
op_assign
id|read_data
c_func
(paren
)paren
op_lshift
l_int|8
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
id|data
op_assign
id|data
op_or
id|read_data
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
l_int|0x55aa
)paren
id|bit
op_assign
l_int|0x01
suffix:semicolon
id|checksum
op_assign
(paren
(paren
(paren
(paren
id|checksum
op_xor
(paren
id|checksum
op_rshift
l_int|1
)paren
)paren
op_amp
l_int|0x01
)paren
op_xor
id|bit
)paren
op_lshift
l_int|7
)paren
op_or
(paren
id|checksum
op_rshift
l_int|1
)paren
suffix:semicolon
id|bit
op_assign
l_int|0x00
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|65
suffix:semicolon
id|i
op_le
l_int|72
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data
op_assign
id|read_data
c_func
(paren
)paren
op_lshift
l_int|8
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
id|data
op_assign
id|data
op_or
id|read_data
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
l_int|0x55aa
)paren
id|chksum
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|i
op_minus
l_int|65
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|checksum
op_ne
l_int|0x00
op_logical_and
id|checksum
op_eq
id|chksum
)paren
(brace
id|csn
op_increment
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
l_int|0x06
comma
id|csn
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
id|iteration
op_increment
suffix:semicolon
id|isapnp_wake
c_func
(paren
l_int|0x00
)paren
suffix:semicolon
id|isapnp_set_rdp
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_address
c_func
(paren
l_int|0x01
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_goto
id|__next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iteration
op_eq
l_int|1
)paren
(brace
id|isapnp_rdp
op_add_assign
id|RDP_STEP
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_isolate_rdp_select
c_func
(paren
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|iteration
OG
l_int|1
)paren
(brace
r_break
suffix:semicolon
)brace
id|__next
suffix:colon
id|checksum
op_assign
l_int|0x6a
suffix:semicolon
id|chksum
op_assign
l_int|0x00
suffix:semicolon
id|bit
op_assign
l_int|0x00
suffix:semicolon
)brace
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
r_return
id|csn
suffix:semicolon
)brace
multiline_comment|/*&n; *  Read one tag from stream.&n; */
DECL|function|isapnp_read_tag
r_static
r_int
id|__init
id|isapnp_read_tag
c_func
(paren
r_int
r_char
op_star
id|type
comma
r_int
r_int
op_star
id|size
)paren
(brace
r_int
r_char
id|tag
comma
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
id|isapnp_peek
c_func
(paren
op_amp
id|tag
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tag
op_eq
l_int|0
)paren
multiline_comment|/* invalid tag */
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tag
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* large item */
op_star
id|type
op_assign
id|tag
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
l_int|2
)paren
suffix:semicolon
op_star
id|size
op_assign
(paren
id|tmp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
op_star
id|type
op_assign
(paren
id|tag
op_rshift
l_int|3
)paren
op_amp
l_int|0x0f
suffix:semicolon
op_star
id|size
op_assign
id|tag
op_amp
l_int|0x07
suffix:semicolon
)brace
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;tag = 0x%x, type = 0x%x, size = %i&bslash;n&quot;
comma
id|tag
comma
op_star
id|type
comma
op_star
id|size
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|type
op_eq
l_int|0
)paren
multiline_comment|/* wrong type */
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_star
id|type
op_eq
l_int|0xff
op_logical_and
op_star
id|size
op_eq
l_int|0xffff
)paren
multiline_comment|/* probably invalid data */
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Skip specified number of bytes from stream.&n; */
DECL|function|isapnp_skip_bytes
r_static
r_void
id|__init
id|isapnp_skip_bytes
c_func
(paren
r_int
id|count
)paren
(brace
id|isapnp_peek
c_func
(paren
l_int|NULL
comma
id|count
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Parse logical device tag.&n; */
DECL|function|isapnp_parse_device
r_static
r_struct
id|pci_dev
op_star
id|__init
id|isapnp_parse_device
c_func
(paren
r_struct
id|pci_bus
op_star
id|card
comma
r_int
id|size
comma
r_int
id|number
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|6
)braket
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|dev
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pci_dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|dev-&gt;dma_mask
op_assign
l_int|0x00ffffff
suffix:semicolon
id|dev-&gt;devfn
op_assign
id|number
suffix:semicolon
id|dev-&gt;vendor
op_assign
(paren
id|tmp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|dev-&gt;device
op_assign
(paren
id|tmp
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
id|dev-&gt;regs
op_assign
id|tmp
(braket
l_int|4
)braket
suffix:semicolon
id|dev-&gt;bus
op_assign
id|card
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|5
)paren
id|dev-&gt;regs
op_or_assign
id|tmp
(braket
l_int|5
)braket
op_lshift
l_int|8
suffix:semicolon
id|dev-&gt;prepare
op_assign
id|isapnp_config_prepare
suffix:semicolon
id|dev-&gt;activate
op_assign
id|isapnp_config_activate
suffix:semicolon
id|dev-&gt;deactivate
op_assign
id|isapnp_config_deactivate
suffix:semicolon
r_return
id|dev
suffix:semicolon
)brace
multiline_comment|/*&n; *  Build new resources structure&n; */
DECL|function|isapnp_build_resources
r_static
r_struct
id|isapnp_resources
op_star
id|__init
id|isapnp_build_resources
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|dependent
)paren
(brace
r_struct
id|isapnp_resources
op_star
id|res
comma
op_star
id|ptr
comma
op_star
id|ptra
suffix:semicolon
id|res
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|isapnp_resources
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
l_int|NULL
suffix:semicolon
id|res-&gt;dev
op_assign
id|dev
suffix:semicolon
id|ptr
op_assign
(paren
r_struct
id|isapnp_resources
op_star
)paren
id|dev-&gt;sysdata
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_logical_and
id|ptr-&gt;dependent
op_logical_and
id|dependent
)paren
(brace
multiline_comment|/* add to another list */
id|ptra
op_assign
id|ptr-&gt;alt
suffix:semicolon
r_while
c_loop
(paren
id|ptra
op_logical_and
id|ptra-&gt;alt
)paren
id|ptra
op_assign
id|ptra-&gt;alt
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ptra
)paren
id|ptr-&gt;alt
op_assign
id|res
suffix:semicolon
r_else
id|ptra-&gt;alt
op_assign
id|res
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|ptr
)paren
id|dev-&gt;sysdata
op_assign
id|res
suffix:semicolon
r_else
id|ptr-&gt;next
op_assign
id|res
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dependent
)paren
(brace
id|res-&gt;priority
op_assign
id|dependent
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|res-&gt;priority
OG
id|ISAPNP_RES_PRIORITY_FUNCTIONAL
)paren
id|res-&gt;priority
op_assign
id|ISAPNP_RES_PRIORITY_INVALID
suffix:semicolon
id|res-&gt;dependent
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|res-&gt;priority
op_assign
id|ISAPNP_RES_PRIORITY_PREFERRED
suffix:semicolon
id|res-&gt;dependent
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add IRQ resource to resources list.&n; */
DECL|function|isapnp_add_irq_resource
r_static
r_void
id|__init
id|isapnp_add_irq_resource
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|isapnp_resources
op_star
op_star
id|res
comma
r_int
id|dependent
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|isapnp_irq
op_star
id|irq
comma
op_star
id|ptr
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|irq
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|isapnp_irq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
op_star
id|res
op_assign
id|isapnp_build_resources
c_func
(paren
id|dev
comma
id|dependent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|irq-&gt;map
op_assign
(paren
id|tmp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|2
)paren
id|irq-&gt;flags
op_assign
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
r_else
id|irq-&gt;flags
op_assign
id|IORESOURCE_IRQ_HIGHEDGE
suffix:semicolon
id|irq-&gt;res
op_assign
op_star
id|res
suffix:semicolon
id|ptr
op_assign
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|irq
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|irq
suffix:semicolon
r_else
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|irq
op_assign
id|irq
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|irq-&gt;map
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|pcibios_penalize_isa_irq
c_func
(paren
id|i
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; *  Add DMA resource to resources list.&n; */
DECL|function|isapnp_add_dma_resource
r_static
r_void
id|__init
id|isapnp_add_dma_resource
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|isapnp_resources
op_star
op_star
id|res
comma
r_int
id|dependent
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|isapnp_dma
op_star
id|dma
comma
op_star
id|ptr
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|dma
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|isapnp_dma
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
op_star
id|res
op_assign
id|isapnp_build_resources
c_func
(paren
id|dev
comma
id|dependent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|dma
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|dma-&gt;map
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|dma-&gt;flags
op_assign
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|dma-&gt;res
op_assign
op_star
id|res
suffix:semicolon
id|ptr
op_assign
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|dma
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|dma
suffix:semicolon
r_else
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|dma
op_assign
id|dma
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add port resource to resources list.&n; */
DECL|function|isapnp_add_port_resource
r_static
r_void
id|__init
id|isapnp_add_port_resource
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|isapnp_resources
op_star
op_star
id|res
comma
r_int
id|dependent
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|isapnp_port
op_star
id|port
comma
op_star
id|ptr
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|port
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|isapnp_port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
op_star
id|res
op_assign
id|isapnp_build_resources
c_func
(paren
id|dev
comma
id|dependent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|port-&gt;min
op_assign
(paren
id|tmp
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|port-&gt;max
op_assign
(paren
id|tmp
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|3
)braket
suffix:semicolon
id|port-&gt;align
op_assign
id|tmp
(braket
l_int|5
)braket
suffix:semicolon
id|port-&gt;size
op_assign
id|tmp
(braket
l_int|6
)braket
suffix:semicolon
id|port-&gt;flags
op_assign
id|tmp
(braket
l_int|0
)braket
ques
c_cond
id|ISAPNP_PORT_FLAG_16BITADDR
suffix:colon
l_int|0
suffix:semicolon
id|port-&gt;res
op_assign
op_star
id|res
suffix:semicolon
id|ptr
op_assign
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|port
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|port
suffix:semicolon
r_else
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|port
op_assign
id|port
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add fixed port resource to resources list.&n; */
DECL|function|isapnp_add_fixed_port_resource
r_static
r_void
id|__init
id|isapnp_add_fixed_port_resource
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|isapnp_resources
op_star
op_star
id|res
comma
r_int
id|dependent
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|isapnp_port
op_star
id|port
comma
op_star
id|ptr
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|port
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|isapnp_port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
op_star
id|res
op_assign
id|isapnp_build_resources
c_func
(paren
id|dev
comma
id|dependent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|port-&gt;min
op_assign
id|port-&gt;max
op_assign
(paren
id|tmp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|port-&gt;size
op_assign
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
id|port-&gt;align
op_assign
l_int|0
suffix:semicolon
id|port-&gt;flags
op_assign
id|ISAPNP_PORT_FLAG_FIXED
suffix:semicolon
id|port-&gt;res
op_assign
op_star
id|res
suffix:semicolon
id|ptr
op_assign
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|port
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|port
suffix:semicolon
r_else
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|port
op_assign
id|port
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add memory resource to resources list.&n; */
DECL|function|isapnp_add_mem_resource
r_static
r_void
id|__init
id|isapnp_add_mem_resource
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|isapnp_resources
op_star
op_star
id|res
comma
r_int
id|dependent
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|9
)braket
suffix:semicolon
r_struct
id|isapnp_mem
op_star
id|mem
comma
op_star
id|ptr
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|mem
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|isapnp_mem
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
op_star
id|res
op_assign
id|isapnp_build_resources
c_func
(paren
id|dev
comma
id|dependent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|mem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|mem-&gt;min
op_assign
(paren
(paren
id|tmp
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|1
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
id|mem-&gt;max
op_assign
(paren
(paren
id|tmp
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|3
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
id|mem-&gt;align
op_assign
(paren
id|tmp
(braket
l_int|6
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|5
)braket
suffix:semicolon
id|mem-&gt;size
op_assign
(paren
(paren
id|tmp
(braket
l_int|8
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|7
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
id|mem-&gt;flags
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|mem-&gt;res
op_assign
op_star
id|res
suffix:semicolon
id|ptr
op_assign
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|mem
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|mem
suffix:semicolon
r_else
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|mem
op_assign
id|mem
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add 32-bit memory resource to resources list.&n; */
DECL|function|isapnp_add_mem32_resource
r_static
r_void
id|__init
id|isapnp_add_mem32_resource
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|isapnp_resources
op_star
op_star
id|res
comma
r_int
id|dependent
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|17
)braket
suffix:semicolon
r_struct
id|isapnp_mem32
op_star
id|mem32
comma
op_star
id|ptr
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|mem32
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|isapnp_mem32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem32
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
op_star
id|res
op_assign
id|isapnp_build_resources
c_func
(paren
id|dev
comma
id|dependent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|mem32
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|memcpy
c_func
(paren
id|mem32-&gt;data
comma
id|tmp
comma
l_int|17
)paren
suffix:semicolon
id|mem32-&gt;res
op_assign
op_star
id|res
suffix:semicolon
id|ptr
op_assign
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|mem32
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|mem32
suffix:semicolon
r_else
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|mem32
op_assign
id|mem32
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add 32-bit fixed memory resource to resources list.&n; */
DECL|function|isapnp_add_fixed_mem32_resource
r_static
r_void
id|__init
id|isapnp_add_fixed_mem32_resource
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|isapnp_resources
op_star
op_star
id|res
comma
r_int
id|dependent
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|17
)braket
suffix:semicolon
r_struct
id|isapnp_mem32
op_star
id|mem32
comma
op_star
id|ptr
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|mem32
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|isapnp_mem32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem32
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
op_star
id|res
op_assign
id|isapnp_build_resources
c_func
(paren
id|dev
comma
id|dependent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|res
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|mem32
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|memcpy
c_func
(paren
id|mem32-&gt;data
comma
id|tmp
comma
l_int|17
)paren
suffix:semicolon
id|mem32-&gt;res
op_assign
op_star
id|res
suffix:semicolon
id|ptr
op_assign
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|mem32
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|mem32
suffix:semicolon
r_else
(paren
op_star
id|res
)paren
op_member_access_from_pointer
id|mem32
op_assign
id|mem32
suffix:semicolon
)brace
multiline_comment|/*&n; *  Parse card name for ISA PnP device.&n; */
r_static
r_void
id|__init
DECL|function|isapnp_parse_name
id|isapnp_parse_name
c_func
(paren
r_char
op_star
id|name
comma
r_int
r_int
id|name_max
comma
r_int
r_int
op_star
id|size
)paren
(brace
r_if
c_cond
(paren
id|name
(braket
l_int|0
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
(brace
r_int
r_int
id|size1
op_assign
op_star
id|size
op_ge
id|name_max
ques
c_cond
(paren
id|name_max
op_minus
l_int|1
)paren
suffix:colon
op_star
id|size
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|name
comma
id|size1
)paren
suffix:semicolon
id|name
(braket
id|size1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
op_star
id|size
op_sub_assign
id|size1
suffix:semicolon
multiline_comment|/* clean whitespace from end of string */
r_while
c_loop
(paren
id|size1
OG
l_int|0
op_logical_and
id|name
(braket
op_decrement
id|size1
)braket
op_eq
l_char|&squot; &squot;
)paren
id|name
(braket
id|size1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  Parse resource map for logical device.&n; */
DECL|function|isapnp_create_device
r_static
r_int
id|__init
id|isapnp_create_device
c_func
(paren
r_struct
id|pci_bus
op_star
id|card
comma
r_int
r_int
id|size
)paren
(brace
r_int
id|number
op_assign
l_int|0
comma
id|skip
op_assign
l_int|0
comma
id|dependent
op_assign
l_int|0
comma
id|compat
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|type
comma
id|tmp
(braket
l_int|17
)braket
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_struct
id|isapnp_resources
op_star
id|res
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|isapnp_parse_device
c_func
(paren
id|card
comma
id|size
comma
id|number
op_increment
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|1
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|dev-&gt;bus_list
comma
op_amp
id|card-&gt;devices
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|dev-&gt;global_list
comma
op_amp
id|isapnp_devices
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|isapnp_read_tag
c_func
(paren
op_amp
id|type
comma
op_amp
id|size
)paren
OL
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|skip
op_logical_and
id|type
op_ne
id|_STAG_LOGDEVID
op_logical_and
id|type
op_ne
id|_STAG_END
)paren
r_goto
id|__skip
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|_STAG_LOGDEVID
suffix:colon
r_if
c_cond
(paren
id|size
op_ge
l_int|5
op_logical_and
id|size
op_le
l_int|6
)paren
(brace
id|isapnp_config_prepare
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|isapnp_parse_device
c_func
(paren
id|card
comma
id|size
comma
id|number
op_increment
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|1
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|dev-&gt;bus_list
comma
op_amp
id|card-&gt;devices
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|dev-&gt;global_list
comma
op_amp
id|isapnp_devices
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
id|skip
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|skip
op_assign
l_int|1
suffix:semicolon
)brace
id|res
op_assign
l_int|NULL
suffix:semicolon
id|dependent
op_assign
l_int|0
suffix:semicolon
id|compat
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_COMPATDEVID
suffix:colon
r_if
c_cond
(paren
id|size
op_eq
l_int|4
op_logical_and
id|compat
OL
id|DEVICE_COUNT_COMPATIBLE
)paren
(brace
id|isapnp_peek
c_func
(paren
id|tmp
comma
l_int|4
)paren
suffix:semicolon
id|dev-&gt;vendor_compatible
(braket
id|compat
)braket
op_assign
(paren
id|tmp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|dev-&gt;device_compatible
(braket
id|compat
)braket
op_assign
(paren
id|tmp
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
id|compat
op_increment
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_STAG_IRQ
suffix:colon
r_if
c_cond
(paren
id|size
template_param
l_int|3
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_add_irq_resource
c_func
(paren
id|dev
comma
op_amp
id|res
comma
id|dependent
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_DMA
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|2
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_add_dma_resource
c_func
(paren
id|dev
comma
op_amp
id|res
comma
id|dependent
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_STARTDEP
suffix:colon
r_if
c_cond
(paren
id|size
OG
l_int|1
)paren
r_goto
id|__skip
suffix:semicolon
id|res
op_assign
l_int|NULL
suffix:semicolon
id|dependent
op_assign
l_int|0x100
op_or
id|ISAPNP_RES_PRIORITY_ACCEPTABLE
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
(brace
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|dependent
op_assign
l_int|0x100
op_or
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_STAG_ENDDEP
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|0
)paren
r_goto
id|__skip
suffix:semicolon
id|res
op_assign
l_int|NULL
suffix:semicolon
id|dependent
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_IOPORT
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|7
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_add_port_resource
c_func
(paren
id|dev
comma
op_amp
id|res
comma
id|dependent
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_FIXEDIO
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|3
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_add_fixed_port_resource
c_func
(paren
id|dev
comma
op_amp
id|res
comma
id|dependent
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_VENDOR
suffix:colon
r_break
suffix:semicolon
r_case
id|_LTAG_MEMRANGE
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|9
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_add_mem_resource
c_func
(paren
id|dev
comma
op_amp
id|res
comma
id|dependent
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_LTAG_ANSISTR
suffix:colon
id|isapnp_parse_name
c_func
(paren
id|dev-&gt;name
comma
r_sizeof
(paren
id|dev-&gt;name
)paren
comma
op_amp
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_LTAG_UNICODESTR
suffix:colon
multiline_comment|/* silently ignore */
multiline_comment|/* who use unicode for hardware identification? */
r_break
suffix:semicolon
r_case
id|_LTAG_VENDOR
suffix:colon
r_break
suffix:semicolon
r_case
id|_LTAG_MEM32RANGE
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|17
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_add_mem32_resource
c_func
(paren
id|dev
comma
op_amp
id|res
comma
id|dependent
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_LTAG_FIXEDMEM32RANGE
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|17
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_add_fixed_mem32_resource
c_func
(paren
id|dev
comma
op_amp
id|res
comma
id|dependent
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_END
suffix:colon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
id|isapnp_skip_bytes
c_func
(paren
id|size
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;isapnp: unexpected or unknown tag type 0x%x for logical device %i (device %i), ignored&bslash;n&quot;
comma
id|type
comma
id|dev-&gt;devfn
comma
id|card-&gt;number
)paren
suffix:semicolon
)brace
id|__skip
suffix:colon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
id|isapnp_skip_bytes
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
id|isapnp_config_prepare
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Parse resource map for ISA PnP card.&n; */
DECL|function|isapnp_parse_resource_map
r_static
r_void
id|__init
id|isapnp_parse_resource_map
c_func
(paren
r_struct
id|pci_bus
op_star
id|card
)paren
(brace
r_int
r_char
id|type
comma
id|tmp
(braket
l_int|17
)braket
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|isapnp_read_tag
c_func
(paren
op_amp
id|type
comma
op_amp
id|size
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|_STAG_PNPVERNO
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|2
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
l_int|2
)paren
suffix:semicolon
id|card-&gt;pnpver
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|card-&gt;productver
op_assign
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_LOGDEVID
suffix:colon
r_if
c_cond
(paren
id|size
op_ge
l_int|5
op_logical_and
id|size
op_le
l_int|6
)paren
(brace
r_if
c_cond
(paren
id|isapnp_create_device
c_func
(paren
id|card
comma
id|size
)paren
op_eq
l_int|1
)paren
r_return
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_STAG_VENDOR
suffix:colon
r_break
suffix:semicolon
r_case
id|_LTAG_ANSISTR
suffix:colon
id|isapnp_parse_name
c_func
(paren
id|card-&gt;name
comma
r_sizeof
(paren
id|card-&gt;name
)paren
comma
op_amp
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_LTAG_UNICODESTR
suffix:colon
multiline_comment|/* silently ignore */
multiline_comment|/* who use unicode for hardware identification? */
r_break
suffix:semicolon
r_case
id|_LTAG_VENDOR
suffix:colon
r_break
suffix:semicolon
r_case
id|_STAG_END
suffix:colon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
id|isapnp_skip_bytes
c_func
(paren
id|size
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;isapnp: unexpected or unknown tag type 0x%x for device %i, ignored&bslash;n&quot;
comma
id|type
comma
id|card-&gt;number
)paren
suffix:semicolon
)brace
id|__skip
suffix:colon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
id|isapnp_skip_bytes
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  Compute ISA PnP checksum for first eight bytes.&n; */
DECL|function|isapnp_checksum
r_static
r_int
r_char
id|__init
id|isapnp_checksum
c_func
(paren
r_int
r_char
op_star
id|data
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_char
id|checksum
op_assign
l_int|0x6a
comma
id|bit
comma
id|b
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|b
op_assign
id|data
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|bit
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|b
op_amp
(paren
l_int|1
op_lshift
id|j
)paren
)paren
id|bit
op_assign
l_int|1
suffix:semicolon
id|checksum
op_assign
(paren
(paren
(paren
(paren
id|checksum
op_xor
(paren
id|checksum
op_rshift
l_int|1
)paren
)paren
op_amp
l_int|0x01
)paren
op_xor
id|bit
)paren
op_lshift
l_int|7
)paren
op_or
(paren
id|checksum
op_rshift
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_return
id|checksum
suffix:semicolon
)brace
multiline_comment|/*&n; *  Build device list for all present ISA PnP devices.&n; */
DECL|function|isapnp_build_device_list
r_static
r_int
id|__init
id|isapnp_build_device_list
c_func
(paren
r_void
)paren
(brace
r_int
id|csn
suffix:semicolon
r_int
r_char
id|header
(braket
l_int|9
)braket
comma
id|checksum
suffix:semicolon
r_struct
id|pci_bus
op_star
id|card
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|isapnp_key
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|csn
op_assign
l_int|1
suffix:semicolon
id|csn
op_le
l_int|10
suffix:semicolon
id|csn
op_increment
)paren
(brace
id|isapnp_wake
c_func
(paren
id|csn
)paren
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|header
comma
l_int|9
)paren
suffix:semicolon
id|checksum
op_assign
id|isapnp_checksum
c_func
(paren
id|header
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;vendor: %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|header
(braket
l_int|0
)braket
comma
id|header
(braket
l_int|1
)braket
comma
id|header
(braket
l_int|2
)braket
comma
id|header
(braket
l_int|3
)braket
comma
id|header
(braket
l_int|4
)braket
comma
id|header
(braket
l_int|5
)braket
comma
id|header
(braket
l_int|6
)braket
comma
id|header
(braket
l_int|7
)braket
comma
id|header
(braket
l_int|8
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;checksum = 0x%x&bslash;n&quot;
comma
id|checksum
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|checksum
op_eq
l_int|0x00
op_logical_or
id|checksum
op_ne
id|header
(braket
l_int|8
)braket
)paren
multiline_comment|/* not valid CSN */
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pci_bus
)paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|card-&gt;number
op_assign
id|csn
suffix:semicolon
id|card-&gt;vendor
op_assign
(paren
id|header
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|header
(braket
l_int|0
)braket
suffix:semicolon
id|card-&gt;device
op_assign
(paren
id|header
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_or
id|header
(braket
l_int|2
)braket
suffix:semicolon
id|card-&gt;serial
op_assign
(paren
id|header
(braket
l_int|7
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|header
(braket
l_int|6
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|header
(braket
l_int|5
)braket
op_lshift
l_int|8
)paren
op_or
id|header
(braket
l_int|4
)braket
suffix:semicolon
id|isapnp_checksum_value
op_assign
l_int|0x00
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|card-&gt;children
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|card-&gt;devices
)paren
suffix:semicolon
id|isapnp_parse_resource_map
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_checksum_value
op_ne
l_int|0x00
)paren
id|printk
c_func
(paren
l_string|&quot;isapnp: checksum for device %i is not valid (0x%x)&bslash;n&quot;
comma
id|csn
comma
id|isapnp_checksum_value
)paren
suffix:semicolon
id|card-&gt;checksum
op_assign
id|isapnp_checksum_value
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|card-&gt;node
comma
op_amp
id|isapnp_cards
)paren
suffix:semicolon
)brace
id|isapnp_for_each_dev
c_func
(paren
id|dev
)paren
(brace
id|isapnp_fixup_device
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Basic configuration routines.&n; */
DECL|function|isapnp_present
r_int
id|isapnp_present
c_func
(paren
r_void
)paren
(brace
r_return
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|isapnp_devices
)paren
suffix:semicolon
)brace
DECL|function|isapnp_cfg_begin
r_int
id|isapnp_cfg_begin
c_func
(paren
r_int
id|csn
comma
r_int
id|logdev
)paren
(brace
r_if
c_cond
(paren
id|csn
template_param
l_int|10
op_logical_or
id|logdev
OG
l_int|10
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|down
c_func
(paren
op_amp
id|isapnp_cfg_mutex
)paren
suffix:semicolon
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|isapnp_key
c_func
(paren
)paren
suffix:semicolon
id|isapnp_wake
c_func
(paren
id|csn
)paren
suffix:semicolon
macro_line|#if 1&t;/* to avoid malfunction when the isapnptools package is used */
id|isapnp_set_rdp
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* delay 1000us */
id|write_address
c_func
(paren
l_int|0x01
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* delay 1000us */
macro_line|#endif
r_if
c_cond
(paren
id|logdev
op_ge
l_int|0
)paren
id|isapnp_device
c_func
(paren
id|logdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_cfg_end
r_int
id|isapnp_cfg_end
c_func
(paren
r_void
)paren
(brace
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|isapnp_cfg_mutex
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Resource manager.&n; */
DECL|function|isapnp_find_port
r_static
r_struct
id|isapnp_port
op_star
id|isapnp_find_port
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|index
)paren
(brace
r_struct
id|isapnp_resources
op_star
id|res
suffix:semicolon
r_struct
id|isapnp_port
op_star
id|port
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
id|index
template_param
l_int|7
)paren
r_return
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|res
op_assign
(paren
r_struct
id|isapnp_resources
op_star
)paren
id|dev-&gt;sysdata
suffix:semicolon
id|res
suffix:semicolon
id|res
op_assign
id|res-&gt;next
)paren
(brace
r_for
c_loop
(paren
id|port
op_assign
id|res-&gt;port
suffix:semicolon
id|port
suffix:semicolon
id|port
op_assign
id|port-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|index
)paren
r_return
id|port
suffix:semicolon
id|index
op_decrement
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|isapnp_find_irq
r_struct
id|isapnp_irq
op_star
id|isapnp_find_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|index
)paren
(brace
r_struct
id|isapnp_resources
op_star
id|res
comma
op_star
id|resa
suffix:semicolon
r_struct
id|isapnp_irq
op_star
id|irq
suffix:semicolon
r_int
id|index1
comma
id|index2
comma
id|index3
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
id|index
template_param
l_int|7
)paren
r_return
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|res
op_assign
(paren
r_struct
id|isapnp_resources
op_star
)paren
id|dev-&gt;sysdata
suffix:semicolon
id|res
suffix:semicolon
id|res
op_assign
id|res-&gt;next
)paren
(brace
id|index3
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|resa
op_assign
id|res
suffix:semicolon
id|resa
suffix:semicolon
id|resa
op_assign
id|resa-&gt;alt
)paren
(brace
id|index1
op_assign
id|index
suffix:semicolon
id|index2
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|irq
op_assign
id|resa-&gt;irq
suffix:semicolon
id|irq
suffix:semicolon
id|irq
op_assign
id|irq-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|index1
)paren
r_return
id|irq
suffix:semicolon
id|index1
op_decrement
suffix:semicolon
id|index2
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|index3
OL
id|index2
)paren
id|index3
op_assign
id|index2
suffix:semicolon
)brace
id|index
op_sub_assign
id|index3
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|isapnp_find_dma
r_struct
id|isapnp_dma
op_star
id|isapnp_find_dma
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|index
)paren
(brace
r_struct
id|isapnp_resources
op_star
id|res
suffix:semicolon
r_struct
id|isapnp_dma
op_star
id|dma
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
id|index
template_param
l_int|7
)paren
r_return
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|res
op_assign
(paren
r_struct
id|isapnp_resources
op_star
)paren
id|dev-&gt;sysdata
suffix:semicolon
id|res
suffix:semicolon
id|res
op_assign
id|res-&gt;next
)paren
(brace
r_for
c_loop
(paren
id|dma
op_assign
id|res-&gt;dma
suffix:semicolon
id|dma
suffix:semicolon
id|dma
op_assign
id|dma-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|index
)paren
r_return
id|dma
suffix:semicolon
id|index
op_decrement
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|isapnp_find_mem
r_struct
id|isapnp_mem
op_star
id|isapnp_find_mem
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|index
)paren
(brace
r_struct
id|isapnp_resources
op_star
id|res
suffix:semicolon
r_struct
id|isapnp_mem
op_star
id|mem
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
id|index
template_param
l_int|7
)paren
r_return
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|res
op_assign
(paren
r_struct
id|isapnp_resources
op_star
)paren
id|dev-&gt;sysdata
suffix:semicolon
id|res
suffix:semicolon
id|res
op_assign
id|res-&gt;next
)paren
(brace
r_for
c_loop
(paren
id|mem
op_assign
id|res-&gt;mem
suffix:semicolon
id|mem
suffix:semicolon
id|mem
op_assign
id|mem-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|index
)paren
r_return
id|mem
suffix:semicolon
id|index
op_decrement
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|isapnp_find_mem32
r_struct
id|isapnp_mem32
op_star
id|isapnp_find_mem32
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|index
)paren
(brace
r_struct
id|isapnp_resources
op_star
id|res
suffix:semicolon
r_struct
id|isapnp_mem32
op_star
id|mem32
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
id|index
template_param
l_int|7
)paren
r_return
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|res
op_assign
(paren
r_struct
id|isapnp_resources
op_star
)paren
id|dev-&gt;sysdata
suffix:semicolon
id|res
suffix:semicolon
id|res
op_assign
id|res-&gt;next
)paren
(brace
r_for
c_loop
(paren
id|mem32
op_assign
id|res-&gt;mem32
suffix:semicolon
id|mem32
suffix:semicolon
id|mem32
op_assign
id|mem32-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|index
)paren
r_return
id|mem32
suffix:semicolon
id|index
op_decrement
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *  Device manager.&n; */
DECL|function|isapnp_find_card
r_struct
id|pci_bus
op_star
id|isapnp_find_card
c_func
(paren
r_int
r_int
id|vendor
comma
r_int
r_int
id|device
comma
r_struct
id|pci_bus
op_star
id|from
)paren
(brace
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|list
op_assign
id|isapnp_cards.next
suffix:semicolon
r_if
c_cond
(paren
id|from
)paren
id|list
op_assign
id|from-&gt;node.next
suffix:semicolon
r_while
c_loop
(paren
id|list
op_ne
op_amp
id|isapnp_cards
)paren
(brace
r_struct
id|pci_bus
op_star
id|card
op_assign
id|pci_bus_b
c_func
(paren
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;vendor
op_eq
id|vendor
op_logical_and
id|card-&gt;device
op_eq
id|device
)paren
r_return
id|card
suffix:semicolon
id|list
op_assign
id|list-&gt;next
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|isapnp_find_dev
r_struct
id|pci_dev
op_star
id|isapnp_find_dev
c_func
(paren
r_struct
id|pci_bus
op_star
id|card
comma
r_int
r_int
id|vendor
comma
r_int
r_int
id|function
comma
r_struct
id|pci_dev
op_star
id|from
)paren
(brace
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* look for a logical device from all cards */
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|list
op_assign
id|isapnp_devices.next
suffix:semicolon
r_if
c_cond
(paren
id|from
)paren
id|list
op_assign
id|from-&gt;global_list.next
suffix:semicolon
r_while
c_loop
(paren
id|list
op_ne
op_amp
id|isapnp_devices
)paren
(brace
r_int
id|idx
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|pci_dev_g
c_func
(paren
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;vendor
op_eq
id|vendor
op_logical_and
id|dev-&gt;device
op_eq
id|function
)paren
r_return
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_COMPATIBLE
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;vendor_compatible
(braket
id|idx
)braket
op_eq
id|vendor
op_logical_and
id|dev-&gt;device_compatible
(braket
id|idx
)braket
op_eq
id|function
)paren
r_return
id|dev
suffix:semicolon
id|list
op_assign
id|list-&gt;next
suffix:semicolon
)brace
)brace
r_else
(brace
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|list
op_assign
id|card-&gt;devices.next
suffix:semicolon
r_if
c_cond
(paren
id|from
)paren
(brace
id|list
op_assign
id|from-&gt;bus_list.next
suffix:semicolon
r_if
c_cond
(paren
id|from-&gt;bus
op_ne
id|card
)paren
multiline_comment|/* something is wrong */
r_return
l_int|NULL
suffix:semicolon
)brace
r_while
c_loop
(paren
id|list
op_ne
op_amp
id|card-&gt;devices
)paren
(brace
r_int
id|idx
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|pci_dev_b
c_func
(paren
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;vendor
op_eq
id|vendor
op_logical_and
id|dev-&gt;device
op_eq
id|function
)paren
r_return
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_COMPATIBLE
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;vendor_compatible
(braket
id|idx
)braket
op_eq
id|vendor
op_logical_and
id|dev-&gt;device_compatible
(braket
id|idx
)braket
op_eq
id|function
)paren
r_return
id|dev
suffix:semicolon
id|list
op_assign
id|list-&gt;next
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_const
r_struct
id|isapnp_card_id
op_star
DECL|function|isapnp_match_card
id|isapnp_match_card
c_func
(paren
r_const
r_struct
id|isapnp_card_id
op_star
id|ids
comma
r_struct
id|pci_bus
op_star
id|card
)paren
(brace
r_int
id|idx
suffix:semicolon
r_while
c_loop
(paren
id|ids-&gt;card_vendor
op_logical_or
id|ids-&gt;card_device
)paren
(brace
r_if
c_cond
(paren
(paren
id|ids-&gt;card_vendor
op_eq
id|ISAPNP_ANY_ID
op_logical_or
id|ids-&gt;card_vendor
op_eq
id|card-&gt;vendor
)paren
op_logical_and
(paren
id|ids-&gt;card_device
op_eq
id|ISAPNP_ANY_ID
op_logical_or
id|ids-&gt;card_device
op_eq
id|card-&gt;device
)paren
)paren
(brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|ISAPNP_CARD_DEVS
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ids-&gt;devs
(braket
id|idx
)braket
dot
id|vendor
op_eq
l_int|0
op_logical_and
id|ids-&gt;devs
(braket
id|idx
)braket
dot
id|function
op_eq
l_int|0
)paren
r_return
id|ids
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_find_dev
c_func
(paren
id|card
comma
id|ids-&gt;devs
(braket
id|idx
)braket
dot
id|vendor
comma
id|ids-&gt;devs
(braket
id|idx
)braket
dot
id|function
comma
l_int|NULL
)paren
op_eq
l_int|NULL
)paren
r_goto
id|__next
suffix:semicolon
)brace
r_return
id|ids
suffix:semicolon
)brace
id|__next
suffix:colon
id|ids
op_increment
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|isapnp_probe_cards
r_int
id|isapnp_probe_cards
c_func
(paren
r_const
r_struct
id|isapnp_card_id
op_star
id|ids
comma
r_int
(paren
op_star
id|probe
)paren
(paren
r_struct
id|pci_bus
op_star
id|_card
comma
r_const
r_struct
id|isapnp_card_id
op_star
id|_id
)paren
)paren
(brace
r_struct
id|pci_bus
op_star
id|card
suffix:semicolon
r_const
r_struct
id|isapnp_card_id
op_star
id|id
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ids
op_eq
l_int|NULL
op_logical_or
id|probe
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|isapnp_for_each_card
c_func
(paren
id|card
)paren
(brace
id|id
op_assign
id|isapnp_match_card
c_func
(paren
id|ids
comma
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_ne
l_int|NULL
op_logical_and
id|probe
c_func
(paren
id|card
comma
id|id
)paren
op_ge
l_int|0
)paren
id|count
op_increment
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
r_const
r_struct
id|isapnp_device_id
op_star
DECL|function|isapnp_match_dev
id|isapnp_match_dev
c_func
(paren
r_const
r_struct
id|isapnp_device_id
op_star
id|ids
comma
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_while
c_loop
(paren
id|ids-&gt;card_vendor
op_logical_or
id|ids-&gt;card_device
)paren
(brace
r_if
c_cond
(paren
(paren
id|ids-&gt;card_vendor
op_eq
id|ISAPNP_ANY_ID
op_logical_or
id|ids-&gt;card_vendor
op_eq
id|dev-&gt;bus-&gt;vendor
)paren
op_logical_and
(paren
id|ids-&gt;card_device
op_eq
id|ISAPNP_ANY_ID
op_logical_or
id|ids-&gt;card_device
op_eq
id|dev-&gt;bus-&gt;device
)paren
op_logical_and
(paren
id|ids-&gt;vendor
op_eq
id|ISAPNP_ANY_ID
op_logical_or
id|ids-&gt;vendor
op_eq
id|dev-&gt;vendor
)paren
op_logical_and
(paren
id|ids-&gt;function
op_eq
id|ISAPNP_ANY_ID
op_logical_or
id|ids-&gt;function
op_eq
id|dev-&gt;device
)paren
)paren
r_return
id|ids
suffix:semicolon
id|ids
op_increment
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|isapnp_probe_devs
r_int
id|isapnp_probe_devs
c_func
(paren
r_const
r_struct
id|isapnp_device_id
op_star
id|ids
comma
r_int
(paren
op_star
id|probe
)paren
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|isapnp_device_id
op_star
id|id
)paren
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_const
r_struct
id|isapnp_device_id
op_star
id|id
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ids
op_eq
l_int|NULL
op_logical_or
id|probe
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|isapnp_for_each_dev
c_func
(paren
id|dev
)paren
(brace
id|id
op_assign
id|isapnp_match_dev
c_func
(paren
id|ids
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_ne
l_int|NULL
op_logical_and
id|probe
c_func
(paren
id|dev
comma
id|id
)paren
op_ge
l_int|0
)paren
id|count
op_increment
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
DECL|function|isapnp_activate_dev
r_int
id|isapnp_activate_dev
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_char
op_star
id|name
)paren
(brace
r_int
id|err
suffix:semicolon
multiline_comment|/* Device already active? Let&squot;s use it and inform the caller */
r_if
c_cond
(paren
id|dev-&gt;active
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dev
op_member_access_from_pointer
id|activate
c_func
(paren
id|dev
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isapnp: config of %s failed (out of resources?)[%d]&bslash;n&quot;
comma
id|name
comma
id|err
)paren
suffix:semicolon
id|dev
op_member_access_from_pointer
id|deactivate
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_dma_resource_flags
r_static
r_int
r_int
id|isapnp_dma_resource_flags
c_func
(paren
r_struct
id|isapnp_dma
op_star
id|dma
)paren
(brace
r_return
id|dma-&gt;flags
op_or
id|IORESOURCE_DMA
op_or
id|IORESOURCE_AUTO
suffix:semicolon
)brace
DECL|function|isapnp_mem_resource_flags
r_static
r_int
r_int
id|isapnp_mem_resource_flags
c_func
(paren
r_struct
id|isapnp_mem
op_star
id|mem
)paren
(brace
r_int
r_int
id|result
suffix:semicolon
id|result
op_assign
id|mem-&gt;flags
op_or
id|IORESOURCE_MEM
op_or
id|IORESOURCE_AUTO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mem-&gt;flags
op_amp
id|IORESOURCE_MEM_WRITEABLE
)paren
)paren
id|result
op_or_assign
id|IORESOURCE_READONLY
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|IORESOURCE_MEM_CACHEABLE
)paren
id|result
op_or_assign
id|IORESOURCE_CACHEABLE
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|IORESOURCE_MEM_RANGELENGTH
)paren
id|result
op_or_assign
id|IORESOURCE_RANGELENGTH
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|IORESOURCE_MEM_SHADOWABLE
)paren
id|result
op_or_assign
id|IORESOURCE_SHADOWABLE
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|isapnp_irq_resource_flags
r_static
r_int
r_int
id|isapnp_irq_resource_flags
c_func
(paren
r_struct
id|isapnp_irq
op_star
id|irq
)paren
(brace
r_return
id|irq-&gt;flags
op_or
id|IORESOURCE_IRQ
op_or
id|IORESOURCE_AUTO
suffix:semicolon
)brace
DECL|function|isapnp_port_resource_flags
r_static
r_int
r_int
id|isapnp_port_resource_flags
c_func
(paren
r_struct
id|isapnp_port
op_star
id|port
)paren
(brace
r_return
id|port-&gt;flags
op_or
id|IORESOURCE_IO
op_or
id|IORESOURCE_AUTO
suffix:semicolon
)brace
DECL|function|isapnp_config_prepare
r_static
r_int
id|isapnp_config_prepare
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|isapnp_resources
op_star
id|res
comma
op_star
id|resa
suffix:semicolon
r_struct
id|isapnp_port
op_star
id|port
suffix:semicolon
r_struct
id|isapnp_irq
op_star
id|irq
suffix:semicolon
r_struct
id|isapnp_dma
op_star
id|dma
suffix:semicolon
r_struct
id|isapnp_mem
op_star
id|mem
suffix:semicolon
r_int
id|port_count
comma
id|port_count1
suffix:semicolon
r_int
id|irq_count
comma
id|irq_count1
suffix:semicolon
r_int
id|dma_count
comma
id|dma_count1
suffix:semicolon
r_int
id|mem_count
comma
id|mem_count1
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;active
op_logical_or
id|dev-&gt;ro
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_IRQ
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|dev-&gt;irq_resource
(braket
id|idx
)braket
dot
id|name
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;irq_resource
(braket
id|idx
)braket
dot
id|start
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;irq_resource
(braket
id|idx
)braket
dot
id|end
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;irq_resource
(braket
id|idx
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_DMA
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|dev-&gt;dma_resource
(braket
id|idx
)braket
dot
id|name
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;dma_resource
(braket
id|idx
)braket
dot
id|start
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;dma_resource
(braket
id|idx
)braket
dot
id|end
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;dma_resource
(braket
id|idx
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_RESOURCE
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|dev-&gt;resource
(braket
id|idx
)braket
dot
id|name
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;resource
(braket
id|idx
)braket
dot
id|start
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;resource
(braket
id|idx
)braket
dot
id|end
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;resource
(braket
id|idx
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
)brace
id|port_count
op_assign
id|irq_count
op_assign
id|dma_count
op_assign
id|mem_count
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|res
op_assign
(paren
r_struct
id|isapnp_resources
op_star
)paren
id|dev-&gt;sysdata
suffix:semicolon
id|res
suffix:semicolon
id|res
op_assign
id|res-&gt;next
)paren
(brace
id|port_count1
op_assign
id|irq_count1
op_assign
id|dma_count1
op_assign
id|mem_count1
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|resa
op_assign
id|res
suffix:semicolon
id|resa
suffix:semicolon
id|resa
op_assign
id|resa-&gt;alt
)paren
(brace
r_for
c_loop
(paren
id|port
op_assign
id|resa-&gt;port
comma
id|idx
op_assign
l_int|0
suffix:semicolon
id|port
suffix:semicolon
id|port
op_assign
id|port-&gt;next
comma
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|port_count
op_plus
id|idx
)braket
dot
id|flags
op_eq
l_int|0
)paren
(brace
id|dev-&gt;resource
(braket
id|port_count
op_plus
id|idx
)braket
dot
id|flags
op_assign
id|isapnp_port_resource_flags
c_func
(paren
id|port
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
id|port_count
op_plus
id|idx
)braket
dot
id|end
op_assign
id|port-&gt;size
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|port_count1
OL
id|idx
)paren
id|port_count1
op_assign
id|idx
suffix:semicolon
r_for
c_loop
(paren
id|irq
op_assign
id|resa-&gt;irq
comma
id|idx
op_assign
l_int|0
suffix:semicolon
id|irq
suffix:semicolon
id|irq
op_assign
id|irq-&gt;next
comma
id|idx
op_increment
)paren
(brace
r_int
id|count
op_assign
id|irq_count
op_plus
id|idx
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|DEVICE_COUNT_IRQ
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;irq_resource
(braket
id|count
)braket
dot
id|flags
op_eq
l_int|0
)paren
(brace
id|dev-&gt;irq_resource
(braket
id|count
)braket
dot
id|flags
op_assign
id|isapnp_irq_resource_flags
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|irq_count1
OL
id|idx
)paren
id|irq_count1
op_assign
id|idx
suffix:semicolon
r_for
c_loop
(paren
id|dma
op_assign
id|resa-&gt;dma
comma
id|idx
op_assign
l_int|0
suffix:semicolon
id|dma
suffix:semicolon
id|dma
op_assign
id|dma-&gt;next
comma
id|idx
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;dma_resource
(braket
id|idx
)braket
dot
id|flags
op_eq
l_int|0
)paren
(brace
id|dev-&gt;dma_resource
(braket
id|idx
)braket
dot
id|flags
op_assign
id|isapnp_dma_resource_flags
c_func
(paren
id|dma
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma_count1
OL
id|idx
)paren
id|dma_count1
op_assign
id|idx
suffix:semicolon
r_for
c_loop
(paren
id|mem
op_assign
id|resa-&gt;mem
comma
id|idx
op_assign
l_int|0
suffix:semicolon
id|mem
suffix:semicolon
id|mem
op_assign
id|mem-&gt;next
comma
id|idx
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|mem_count
op_plus
id|idx
op_plus
l_int|8
)braket
dot
id|flags
op_eq
l_int|0
)paren
(brace
id|dev-&gt;resource
(braket
id|mem_count
op_plus
id|idx
op_plus
l_int|8
)braket
dot
id|flags
op_assign
id|isapnp_mem_resource_flags
c_func
(paren
id|mem
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mem_count1
OL
id|idx
)paren
id|mem_count1
op_assign
id|idx
suffix:semicolon
)brace
id|port_count
op_add_assign
id|port_count1
suffix:semicolon
id|irq_count
op_add_assign
id|irq_count1
suffix:semicolon
id|dma_count
op_add_assign
id|dma_count1
suffix:semicolon
id|mem_count
op_add_assign
id|mem_count1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|isapnp_cfgtmp
r_struct
id|isapnp_cfgtmp
(brace
DECL|member|port
r_struct
id|isapnp_port
op_star
id|port
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|irq
r_struct
id|isapnp_irq
op_star
id|irq
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|dma
r_struct
id|isapnp_dma
op_star
id|dma
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|mem
r_struct
id|isapnp_mem
op_star
id|mem
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|request
r_struct
id|pci_dev
op_star
id|request
suffix:semicolon
DECL|member|result
r_struct
id|pci_dev
id|result
suffix:semicolon
)brace
suffix:semicolon
DECL|function|isapnp_alternative_switch
r_static
r_int
id|isapnp_alternative_switch
c_func
(paren
r_struct
id|isapnp_cfgtmp
op_star
id|cfg
comma
r_struct
id|isapnp_resources
op_star
id|from
comma
r_struct
id|isapnp_resources
op_star
id|to
)paren
(brace
r_int
id|tmp
comma
id|tmp1
suffix:semicolon
r_struct
id|isapnp_port
op_star
id|port
suffix:semicolon
r_struct
id|isapnp_irq
op_star
id|irq
suffix:semicolon
r_struct
id|isapnp_dma
op_star
id|dma
suffix:semicolon
r_struct
id|isapnp_mem
op_star
id|mem
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* process port settings */
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|8
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfg-&gt;request-&gt;resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* don&squot;t touch */
id|port
op_assign
id|cfg-&gt;port
(braket
id|tmp
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
(brace
id|cfg-&gt;port
(braket
id|tmp
)braket
op_assign
id|port
op_assign
id|isapnp_find_port
c_func
(paren
id|cfg-&gt;request
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|from
op_logical_and
id|port-&gt;res
op_eq
id|from
)paren
(brace
r_while
c_loop
(paren
id|port-&gt;res
op_ne
id|to
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|port-&gt;res-&gt;alt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|port
op_assign
id|port-&gt;res-&gt;alt-&gt;port
suffix:semicolon
r_for
c_loop
(paren
id|tmp1
op_assign
id|tmp
suffix:semicolon
id|tmp1
OG
l_int|0
op_logical_and
id|port
suffix:semicolon
id|tmp1
op_decrement
)paren
id|port
op_assign
id|port-&gt;next
suffix:semicolon
id|cfg-&gt;port
(braket
id|tmp
)braket
op_assign
id|port
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|cfg-&gt;result.resource
(braket
id|tmp
)braket
dot
id|flags
op_assign
id|isapnp_port_resource_flags
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* process irq settings */
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|2
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfg-&gt;request-&gt;irq_resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* don&squot;t touch */
id|irq
op_assign
id|cfg-&gt;irq
(braket
id|tmp
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
(brace
id|cfg-&gt;irq
(braket
id|tmp
)braket
op_assign
id|irq
op_assign
id|isapnp_find_irq
c_func
(paren
id|cfg-&gt;request
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|from
op_logical_and
id|irq-&gt;res
op_eq
id|from
)paren
(brace
r_while
c_loop
(paren
id|irq-&gt;res
op_ne
id|to
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|irq-&gt;res-&gt;alt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|irq
op_assign
id|irq-&gt;res-&gt;alt-&gt;irq
suffix:semicolon
r_for
c_loop
(paren
id|tmp1
op_assign
id|tmp
suffix:semicolon
id|tmp1
OG
l_int|0
op_logical_and
id|irq
suffix:semicolon
id|tmp1
op_decrement
)paren
id|irq
op_assign
id|irq-&gt;next
suffix:semicolon
id|cfg-&gt;irq
(braket
id|tmp
)braket
op_assign
id|irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|cfg-&gt;result.irq_resource
(braket
id|tmp
)braket
dot
id|flags
op_assign
id|isapnp_irq_resource_flags
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* process dma settings */
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|2
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfg-&gt;request-&gt;dma_resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* don&squot;t touch */
id|dma
op_assign
id|cfg-&gt;dma
(braket
id|tmp
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma
)paren
(brace
id|cfg-&gt;dma
(braket
id|tmp
)braket
op_assign
id|dma
op_assign
id|isapnp_find_dma
c_func
(paren
id|cfg-&gt;request
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|from
op_logical_and
id|dma-&gt;res
op_eq
id|from
)paren
(brace
r_while
c_loop
(paren
id|dma-&gt;res
op_ne
id|to
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dma-&gt;res-&gt;alt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dma
op_assign
id|dma-&gt;res-&gt;alt-&gt;dma
suffix:semicolon
r_for
c_loop
(paren
id|tmp1
op_assign
id|tmp
suffix:semicolon
id|tmp1
OG
l_int|0
op_logical_and
id|dma
suffix:semicolon
id|tmp1
op_decrement
)paren
id|dma
op_assign
id|dma-&gt;next
suffix:semicolon
id|cfg-&gt;dma
(braket
id|tmp
)braket
op_assign
id|dma
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|cfg-&gt;result.dma_resource
(braket
id|tmp
)braket
dot
id|flags
op_assign
id|isapnp_dma_resource_flags
c_func
(paren
id|dma
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* process memory settings */
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|4
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfg-&gt;request-&gt;resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* don&squot;t touch */
id|mem
op_assign
id|cfg-&gt;mem
(braket
id|tmp
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
(brace
id|cfg-&gt;mem
(braket
id|tmp
)braket
op_assign
id|mem
op_assign
id|isapnp_find_mem
c_func
(paren
id|cfg-&gt;request
comma
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|from
op_logical_and
id|mem-&gt;res
op_eq
id|from
)paren
(brace
r_while
c_loop
(paren
id|mem-&gt;res
op_ne
id|to
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|mem-&gt;res-&gt;alt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|mem
op_assign
id|mem-&gt;res-&gt;alt-&gt;mem
suffix:semicolon
r_for
c_loop
(paren
id|tmp1
op_assign
id|tmp
suffix:semicolon
id|tmp1
OG
l_int|0
op_logical_and
id|mem
suffix:semicolon
id|tmp1
op_decrement
)paren
id|mem
op_assign
id|mem-&gt;next
suffix:semicolon
id|cfg-&gt;mem
(braket
id|tmp
)braket
op_assign
id|mem
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|cfg-&gt;result.resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|flags
op_assign
id|isapnp_mem_resource_flags
c_func
(paren
id|mem
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_check_port
r_static
r_int
id|isapnp_check_port
c_func
(paren
r_struct
id|isapnp_cfgtmp
op_star
id|cfg
comma
r_int
id|port
comma
r_int
id|size
comma
r_int
id|idx
)paren
(brace
r_int
id|i
comma
id|tmp
comma
id|rport
comma
id|rsize
suffix:semicolon
r_struct
id|isapnp_port
op_star
id|xport
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|port
comma
id|size
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rport
op_assign
id|isapnp_reserve_io
(braket
id|i
op_lshift
l_int|1
)braket
suffix:semicolon
id|rsize
op_assign
id|isapnp_reserve_io
(braket
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|port
op_ge
id|rport
op_logical_and
id|port
OL
id|rport
op_plus
id|rsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|port
op_plus
id|size
OG
id|rport
op_logical_and
id|port
op_plus
id|size
OL
(paren
id|rport
op_plus
id|rsize
)paren
op_minus
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|isapnp_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;active
)paren
(brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|8
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|flags
)paren
(brace
id|rport
op_assign
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|start
suffix:semicolon
id|rsize
op_assign
(paren
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|end
op_minus
id|rport
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|port
op_ge
id|rport
op_logical_and
id|port
OL
id|rport
op_plus
id|rsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|port
op_plus
id|size
OG
id|rport
op_logical_and
id|port
op_plus
id|size
OL
(paren
id|rport
op_plus
id|rsize
)paren
op_minus
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|idx
)paren
r_continue
suffix:semicolon
id|flags
op_assign
id|cfg-&gt;request-&gt;resource
(braket
id|i
)braket
dot
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flags
)paren
r_continue
suffix:semicolon
id|tmp
op_assign
id|cfg-&gt;request-&gt;resource
(braket
id|i
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
(brace
multiline_comment|/* auto */
id|xport
op_assign
id|cfg-&gt;port
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|xport
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;result.resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
r_continue
suffix:semicolon
id|tmp
op_assign
id|cfg-&gt;result.resource
(braket
id|i
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_plus
id|xport-&gt;size
op_ge
id|port
op_logical_and
id|tmp
op_le
id|port
op_plus
id|xport-&gt;size
)paren
r_return
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|port
op_eq
id|tmp
)paren
r_return
l_int|1
suffix:semicolon
id|xport
op_assign
id|isapnp_find_port
c_func
(paren
id|cfg-&gt;request
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|xport
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_plus
id|xport-&gt;size
op_ge
id|port
op_logical_and
id|tmp
op_le
id|port
op_plus
id|xport-&gt;size
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_valid_port
r_static
r_int
id|isapnp_valid_port
c_func
(paren
r_struct
id|isapnp_cfgtmp
op_star
id|cfg
comma
r_int
id|idx
)paren
(brace
r_int
id|err
suffix:semicolon
r_int
r_int
op_star
id|value1
comma
op_star
id|value2
suffix:semicolon
r_struct
id|isapnp_port
op_star
id|port
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfg
op_logical_or
id|idx
template_param
l_int|7
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfg-&gt;result.resource
(braket
id|idx
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
)paren
multiline_comment|/* don&squot;t touch */
r_return
l_int|0
suffix:semicolon
id|__again
suffix:colon
id|port
op_assign
id|cfg-&gt;port
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|value1
op_assign
op_amp
id|cfg-&gt;result.resource
(braket
id|idx
)braket
dot
id|start
suffix:semicolon
id|value2
op_assign
op_amp
id|cfg-&gt;result.resource
(braket
id|idx
)braket
dot
id|end
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;result.resource
(braket
id|idx
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
(brace
id|cfg-&gt;result.resource
(braket
id|idx
)braket
dot
id|flags
op_and_assign
op_complement
id|IORESOURCE_AUTO
suffix:semicolon
op_star
id|value1
op_assign
id|port-&gt;min
suffix:semicolon
op_star
id|value2
op_assign
id|port-&gt;min
op_plus
id|port-&gt;size
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isapnp_check_port
c_func
(paren
id|cfg
comma
op_star
id|value1
comma
id|port-&gt;size
comma
id|idx
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_do
(brace
op_star
id|value1
op_add_assign
id|port-&gt;align
suffix:semicolon
op_star
id|value2
op_assign
op_star
id|value1
op_plus
id|port-&gt;size
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value1
OG
id|port-&gt;max
op_logical_or
op_logical_neg
id|port-&gt;align
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;res
op_logical_and
id|port-&gt;res-&gt;alt
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|isapnp_alternative_switch
c_func
(paren
id|cfg
comma
id|port-&gt;res
comma
id|port-&gt;res-&gt;alt
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_goto
id|__again
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|isapnp_check_port
c_func
(paren
id|cfg
comma
op_star
id|value1
comma
id|port-&gt;size
comma
id|idx
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_test_handler
r_static
r_void
id|isapnp_test_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
)brace
DECL|function|isapnp_check_interrupt
r_static
r_int
id|isapnp_check_interrupt
c_func
(paren
r_struct
id|isapnp_cfgtmp
op_star
id|cfg
comma
r_int
id|irq
comma
r_int
id|idx
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
l_int|15
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|isapnp_reserve_irq
(braket
id|i
)braket
op_eq
id|irq
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|isapnp_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;active
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;irq_resource
(braket
l_int|0
)braket
dot
id|start
op_eq
id|irq
op_logical_or
id|dev-&gt;irq_resource
(braket
l_int|1
)braket
dot
id|start
op_eq
id|irq
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
op_logical_neg
id|isapnp_skip_pci_scan
)paren
(brace
id|pci_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;irq
op_eq
id|irq
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|isapnp_test_handler
comma
id|SA_INTERRUPT
comma
l_string|&quot;isapnp&quot;
comma
l_int|NULL
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|free_irq
c_func
(paren
id|irq
comma
l_int|NULL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DEVICE_COUNT_IRQ
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|idx
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfg-&gt;result.irq_resource
(braket
id|i
)braket
dot
id|flags
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;result.irq_resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;result.irq_resource
(braket
id|i
)braket
dot
id|start
op_eq
id|irq
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_valid_irq
r_static
r_int
id|isapnp_valid_irq
c_func
(paren
r_struct
id|isapnp_cfgtmp
op_star
id|cfg
comma
r_int
id|idx
)paren
(brace
multiline_comment|/* IRQ priority: this table is good for i386 */
r_static
r_int
r_int
id|xtab
(braket
l_int|16
)braket
op_assign
(brace
l_int|5
comma
l_int|10
comma
l_int|11
comma
l_int|12
comma
l_int|9
comma
l_int|14
comma
l_int|15
comma
l_int|7
comma
l_int|3
comma
l_int|4
comma
l_int|13
comma
l_int|0
comma
l_int|1
comma
l_int|6
comma
l_int|8
comma
l_int|2
)brace
suffix:semicolon
r_int
id|err
comma
id|i
suffix:semicolon
r_int
r_int
op_star
id|value1
comma
op_star
id|value2
suffix:semicolon
r_struct
id|isapnp_irq
op_star
id|irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfg
op_logical_or
id|idx
template_param
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfg-&gt;result.irq_resource
(braket
id|idx
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|__again
suffix:colon
id|irq
op_assign
id|cfg-&gt;irq
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|value1
op_assign
op_amp
id|cfg-&gt;result.irq_resource
(braket
id|idx
)braket
dot
id|start
suffix:semicolon
id|value2
op_assign
op_amp
id|cfg-&gt;result.irq_resource
(braket
id|idx
)braket
dot
id|end
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;result.irq_resource
(braket
id|idx
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
op_logical_and
op_logical_neg
(paren
id|irq-&gt;map
op_amp
(paren
l_int|1
op_lshift
id|xtab
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
l_int|16
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|cfg-&gt;result.irq_resource
(braket
id|idx
)braket
dot
id|flags
op_and_assign
op_complement
id|IORESOURCE_AUTO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isapnp_check_interrupt
c_func
(paren
id|cfg
comma
op_star
id|value1
op_assign
op_star
id|value2
op_assign
id|xtab
(braket
id|i
)braket
comma
id|idx
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_do
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
op_logical_and
id|xtab
(braket
id|i
)braket
op_ne
op_star
id|value1
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_increment
suffix:semicolon
id|i
OL
l_int|16
op_logical_and
op_logical_neg
(paren
id|irq-&gt;map
op_amp
(paren
l_int|1
op_lshift
id|xtab
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
l_int|16
)paren
(brace
r_if
c_cond
(paren
id|irq-&gt;res
op_logical_and
id|irq-&gt;res-&gt;alt
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|isapnp_alternative_switch
c_func
(paren
id|cfg
comma
id|irq-&gt;res
comma
id|irq-&gt;res-&gt;alt
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_goto
id|__again
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_else
(brace
op_star
id|value1
op_assign
op_star
id|value2
op_assign
id|xtab
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|isapnp_check_interrupt
c_func
(paren
id|cfg
comma
op_star
id|value1
comma
id|idx
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_check_dma
r_static
r_int
id|isapnp_check_dma
c_func
(paren
r_struct
id|isapnp_cfgtmp
op_star
id|cfg
comma
r_int
id|dma
comma
r_int
id|idx
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
multiline_comment|/* Some machines allow DMA 0, but others don&squot;t. In fact on some &n;&t;   boxes DMA 0 is the memory refresh. Play safe */
r_if
c_cond
(paren
id|dma
template_param
l_int|7
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|isapnp_reserve_dma
(braket
id|i
)braket
op_eq
id|dma
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|isapnp_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;active
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;dma_resource
(braket
l_int|0
)braket
dot
id|start
op_eq
id|dma
op_logical_or
id|dev-&gt;dma_resource
(braket
l_int|1
)braket
dot
id|start
op_eq
id|dma
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|request_dma
c_func
(paren
id|dma
comma
l_string|&quot;isapnp&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|free_dma
c_func
(paren
id|dma
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|idx
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfg-&gt;result.dma_resource
(braket
id|i
)braket
dot
id|flags
op_logical_or
(paren
id|cfg-&gt;result.dma_resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;result.dma_resource
(braket
id|i
)braket
dot
id|start
op_eq
id|dma
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_valid_dma
r_static
r_int
id|isapnp_valid_dma
c_func
(paren
r_struct
id|isapnp_cfgtmp
op_star
id|cfg
comma
r_int
id|idx
)paren
(brace
r_int
id|err
comma
id|i
suffix:semicolon
r_int
r_int
op_star
id|value1
comma
op_star
id|value2
suffix:semicolon
r_struct
id|isapnp_dma
op_star
id|dma
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfg
op_logical_or
id|idx
template_param
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfg-&gt;result.dma_resource
(braket
id|idx
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
)paren
multiline_comment|/* don&squot;t touch */
r_return
l_int|0
suffix:semicolon
id|__again
suffix:colon
id|dma
op_assign
id|cfg-&gt;dma
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|value1
op_assign
op_amp
id|cfg-&gt;result.dma_resource
(braket
id|idx
)braket
dot
id|start
suffix:semicolon
id|value2
op_assign
op_amp
id|cfg-&gt;result.dma_resource
(braket
id|idx
)braket
dot
id|end
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;result.dma_resource
(braket
id|idx
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
op_logical_and
op_logical_neg
(paren
id|dma-&gt;map
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
l_int|8
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|cfg-&gt;result.dma_resource
(braket
id|idx
)braket
dot
id|flags
op_and_assign
op_complement
id|IORESOURCE_AUTO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isapnp_check_dma
c_func
(paren
id|cfg
comma
op_star
id|value1
op_assign
op_star
id|value2
op_assign
id|i
comma
id|idx
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_do
(brace
r_for
c_loop
(paren
id|i
op_assign
op_star
id|value1
op_plus
l_int|1
suffix:semicolon
id|i
OL
l_int|8
op_logical_and
op_logical_neg
(paren
id|dma-&gt;map
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|dma-&gt;res
op_logical_and
id|dma-&gt;res-&gt;alt
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|isapnp_alternative_switch
c_func
(paren
id|cfg
comma
id|dma-&gt;res
comma
id|dma-&gt;res-&gt;alt
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_goto
id|__again
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_else
(brace
op_star
id|value1
op_assign
op_star
id|value2
op_assign
id|i
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|isapnp_check_dma
c_func
(paren
id|cfg
comma
op_star
id|value1
comma
id|idx
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_check_mem
r_static
r_int
id|isapnp_check_mem
c_func
(paren
r_struct
id|isapnp_cfgtmp
op_star
id|cfg
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|size
comma
r_int
id|idx
)paren
(brace
r_int
id|i
comma
id|tmp
suffix:semicolon
r_int
r_int
id|raddr
comma
id|rsize
suffix:semicolon
r_struct
id|isapnp_mem
op_star
id|xmem
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|raddr
op_assign
(paren
r_int
r_int
)paren
id|isapnp_reserve_mem
(braket
id|i
op_lshift
l_int|1
)braket
suffix:semicolon
id|rsize
op_assign
(paren
r_int
r_int
)paren
id|isapnp_reserve_mem
(braket
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_ge
id|raddr
op_logical_and
id|addr
OL
id|raddr
op_plus
id|rsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_plus
id|size
OG
id|raddr
op_logical_and
id|addr
op_plus
id|size
OL
(paren
id|raddr
op_plus
id|rsize
)paren
op_minus
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|__check_region
c_func
(paren
op_amp
id|iomem_resource
comma
id|addr
comma
id|size
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|isapnp_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;active
)paren
(brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|4
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|flags
)paren
(brace
id|raddr
op_assign
id|dev-&gt;resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|start
suffix:semicolon
id|rsize
op_assign
(paren
id|dev-&gt;resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|end
op_minus
id|raddr
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_ge
id|raddr
op_logical_and
id|addr
OL
id|raddr
op_plus
id|rsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_plus
id|size
OG
id|raddr
op_logical_and
id|addr
op_plus
id|size
OL
(paren
id|raddr
op_plus
id|rsize
)paren
op_minus
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|flags
op_assign
id|cfg-&gt;request-&gt;resource
(braket
id|i
op_plus
l_int|8
)braket
dot
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|idx
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flags
)paren
r_continue
suffix:semicolon
id|tmp
op_assign
id|cfg-&gt;result.resource
(braket
id|i
op_plus
l_int|8
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
(brace
multiline_comment|/* auto */
id|xmem
op_assign
id|cfg-&gt;mem
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|xmem
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;result.resource
(braket
id|i
op_plus
l_int|8
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_plus
id|xmem-&gt;size
op_ge
id|addr
op_logical_and
id|tmp
op_le
id|addr
op_plus
id|xmem-&gt;size
)paren
r_return
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr
op_eq
id|tmp
)paren
r_return
l_int|1
suffix:semicolon
id|xmem
op_assign
id|isapnp_find_mem
c_func
(paren
id|cfg-&gt;request
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|xmem
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_plus
id|xmem-&gt;size
op_ge
id|addr
op_logical_and
id|tmp
op_le
id|addr
op_plus
id|xmem-&gt;size
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_valid_mem
r_static
r_int
id|isapnp_valid_mem
c_func
(paren
r_struct
id|isapnp_cfgtmp
op_star
id|cfg
comma
r_int
id|idx
)paren
(brace
r_int
id|err
suffix:semicolon
r_int
r_int
op_star
id|value1
comma
op_star
id|value2
suffix:semicolon
r_struct
id|isapnp_mem
op_star
id|mem
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cfg
op_logical_or
id|idx
template_param
l_int|3
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cfg-&gt;result.resource
(braket
id|idx
op_plus
l_int|8
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
)paren
multiline_comment|/* don&squot;t touch */
r_return
l_int|0
suffix:semicolon
id|__again
suffix:colon
id|mem
op_assign
id|cfg-&gt;mem
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|value1
op_assign
op_amp
id|cfg-&gt;result.resource
(braket
id|idx
op_plus
l_int|8
)braket
dot
id|start
suffix:semicolon
id|value2
op_assign
op_amp
id|cfg-&gt;result.resource
(braket
id|idx
op_plus
l_int|8
)braket
dot
id|end
suffix:semicolon
r_if
c_cond
(paren
id|cfg-&gt;result.resource
(braket
id|idx
op_plus
l_int|8
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
(brace
id|cfg-&gt;result.resource
(braket
id|idx
op_plus
l_int|8
)braket
dot
id|flags
op_and_assign
op_complement
id|IORESOURCE_AUTO
suffix:semicolon
op_star
id|value1
op_assign
id|mem-&gt;min
suffix:semicolon
op_star
id|value2
op_assign
id|mem-&gt;min
op_plus
id|mem-&gt;size
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isapnp_check_mem
c_func
(paren
id|cfg
comma
op_star
id|value1
comma
id|mem-&gt;size
comma
id|idx
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_do
(brace
op_star
id|value1
op_add_assign
id|mem-&gt;align
suffix:semicolon
op_star
id|value2
op_assign
op_star
id|value1
op_plus
id|mem-&gt;size
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value1
OG
id|mem-&gt;max
op_logical_or
op_logical_neg
id|mem-&gt;align
)paren
(brace
r_if
c_cond
(paren
id|mem-&gt;res
op_logical_and
id|mem-&gt;res-&gt;alt
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|isapnp_alternative_switch
c_func
(paren
id|cfg
comma
id|mem-&gt;res
comma
id|mem-&gt;res-&gt;alt
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_goto
id|__again
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|isapnp_check_mem
c_func
(paren
id|cfg
comma
op_star
id|value1
comma
id|mem-&gt;size
comma
id|idx
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_check_valid
r_static
r_int
id|isapnp_check_valid
c_func
(paren
r_struct
id|isapnp_cfgtmp
op_star
id|cfg
)paren
(brace
r_int
id|tmp
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|8
suffix:semicolon
id|tmp
op_increment
)paren
r_if
c_cond
(paren
id|cfg-&gt;result.resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|2
suffix:semicolon
id|tmp
op_increment
)paren
r_if
c_cond
(paren
id|cfg-&gt;result.irq_resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|2
suffix:semicolon
id|tmp
op_increment
)paren
r_if
c_cond
(paren
id|cfg-&gt;result.dma_resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|4
suffix:semicolon
id|tmp
op_increment
)paren
r_if
c_cond
(paren
id|cfg-&gt;result.resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_config_activate
r_static
r_int
id|isapnp_config_activate
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|isapnp_cfgtmp
id|cfg
suffix:semicolon
r_int
id|tmp
comma
id|fauto
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;active
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cfg
comma
l_int|0
comma
r_sizeof
(paren
id|cfg
)paren
)paren
suffix:semicolon
id|cfg.request
op_assign
id|dev
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cfg.result
comma
id|dev
comma
r_sizeof
(paren
r_struct
id|pci_dev
)paren
)paren
suffix:semicolon
multiline_comment|/* check if all values are set, otherwise try auto-configuration */
r_for
c_loop
(paren
id|tmp
op_assign
id|fauto
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|fauto
op_logical_and
id|tmp
OL
l_int|8
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
id|fauto
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|fauto
op_logical_and
id|tmp
OL
l_int|2
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;irq_resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
id|fauto
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|fauto
op_logical_and
id|tmp
OL
l_int|2
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;dma_resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
id|fauto
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|fauto
op_logical_and
id|tmp
OL
l_int|4
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|flags
op_amp
id|IORESOURCE_AUTO
)paren
id|fauto
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|fauto
)paren
r_goto
id|__skip_auto
suffix:semicolon
multiline_comment|/* set variables to initial values */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|isapnp_alternative_switch
c_func
(paren
op_amp
id|cfg
comma
l_int|NULL
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* find first valid configuration */
id|fauto
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|8
op_logical_and
id|cfg.result.resource
(braket
id|tmp
)braket
dot
id|flags
suffix:semicolon
id|tmp
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|isapnp_valid_port
c_func
(paren
op_amp
id|cfg
comma
id|tmp
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|2
op_logical_and
id|cfg.result.irq_resource
(braket
id|tmp
)braket
dot
id|flags
suffix:semicolon
id|tmp
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|isapnp_valid_irq
c_func
(paren
op_amp
id|cfg
comma
id|tmp
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|2
op_logical_and
id|cfg.result.dma_resource
(braket
id|tmp
)braket
dot
id|flags
suffix:semicolon
id|tmp
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|isapnp_valid_dma
c_func
(paren
op_amp
id|cfg
comma
id|tmp
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|4
op_logical_and
id|cfg.result.resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|flags
suffix:semicolon
id|tmp
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|isapnp_valid_mem
c_func
(paren
op_amp
id|cfg
comma
id|tmp
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_while
c_loop
(paren
id|isapnp_check_valid
c_func
(paren
op_amp
id|cfg
)paren
OL
l_int|0
op_logical_and
id|fauto
op_increment
OL
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fauto
op_ge
l_int|20
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|__skip_auto
suffix:colon
multiline_comment|/* we have valid configuration, try configure hardware */
id|isapnp_cfg_begin
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
)paren
suffix:semicolon
id|dev-&gt;active
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;irq_resource
(braket
l_int|0
)braket
op_assign
id|cfg.result.irq_resource
(braket
l_int|0
)braket
suffix:semicolon
id|dev-&gt;irq_resource
(braket
l_int|1
)braket
op_assign
id|cfg.result.irq_resource
(braket
l_int|1
)braket
suffix:semicolon
id|dev-&gt;dma_resource
(braket
l_int|0
)braket
op_assign
id|cfg.result.dma_resource
(braket
l_int|0
)braket
suffix:semicolon
id|dev-&gt;dma_resource
(braket
l_int|1
)braket
op_assign
id|cfg.result.dma_resource
(braket
l_int|1
)braket
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|12
suffix:semicolon
id|tmp
op_increment
)paren
(brace
id|dev-&gt;resource
(braket
id|tmp
)braket
op_assign
id|cfg.result.resource
(braket
id|tmp
)braket
suffix:semicolon
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|8
op_logical_and
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|flags
suffix:semicolon
id|tmp
op_increment
)paren
id|isapnp_write_word
c_func
(paren
id|ISAPNP_CFG_PORT
op_plus
(paren
id|tmp
op_lshift
l_int|1
)paren
comma
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|start
)paren
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|2
op_logical_and
id|dev-&gt;irq_resource
(braket
id|tmp
)braket
dot
id|flags
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_int
id|irq
op_assign
id|dev-&gt;irq_resource
(braket
id|tmp
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
l_int|2
)paren
id|irq
op_assign
l_int|9
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|ISAPNP_CFG_IRQ
op_plus
(paren
id|tmp
op_lshift
l_int|1
)paren
comma
id|irq
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|2
op_logical_and
id|dev-&gt;dma_resource
(braket
id|tmp
)braket
dot
id|flags
suffix:semicolon
id|tmp
op_increment
)paren
id|isapnp_write_byte
c_func
(paren
id|ISAPNP_CFG_DMA
op_plus
id|tmp
comma
id|dev-&gt;dma_resource
(braket
id|tmp
)braket
dot
id|start
)paren
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|4
op_logical_and
id|dev-&gt;resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|flags
suffix:semicolon
id|tmp
op_increment
)paren
id|isapnp_write_word
c_func
(paren
id|ISAPNP_CFG_MEM
op_plus
(paren
id|tmp
op_lshift
l_int|2
)paren
comma
(paren
id|dev-&gt;resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|start
op_rshift
l_int|8
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|isapnp_activate
c_func
(paren
id|dev-&gt;devfn
)paren
suffix:semicolon
id|isapnp_cfg_end
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_config_deactivate
r_static
r_int
id|isapnp_config_deactivate
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|dev-&gt;active
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|isapnp_cfg_begin
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
)paren
suffix:semicolon
id|isapnp_deactivate
c_func
(paren
id|dev-&gt;devfn
)paren
suffix:semicolon
id|dev-&gt;active
op_assign
l_int|0
suffix:semicolon
id|isapnp_cfg_end
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_resource_change
r_void
id|isapnp_resource_change
c_func
(paren
r_struct
id|resource
op_star
id|resource
comma
r_int
r_int
id|start
comma
r_int
r_int
id|size
)paren
(brace
r_if
c_cond
(paren
id|resource
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|resource-&gt;flags
op_and_assign
op_complement
id|IORESOURCE_AUTO
suffix:semicolon
id|resource-&gt;start
op_assign
id|start
suffix:semicolon
id|resource-&gt;end
op_assign
id|start
op_plus
id|size
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *  Inititialization.&n; */
macro_line|#ifdef MODULE
DECL|function|isapnp_free_port
r_static
r_void
id|isapnp_free_port
c_func
(paren
r_struct
id|isapnp_port
op_star
id|port
)paren
(brace
r_struct
id|isapnp_port
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|port
)paren
(brace
id|next
op_assign
id|port-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|port
)paren
suffix:semicolon
id|port
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|isapnp_free_irq
r_static
r_void
id|isapnp_free_irq
c_func
(paren
r_struct
id|isapnp_irq
op_star
id|irq
)paren
(brace
r_struct
id|isapnp_irq
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|irq
)paren
(brace
id|next
op_assign
id|irq-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|irq
)paren
suffix:semicolon
id|irq
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|isapnp_free_dma
r_static
r_void
id|isapnp_free_dma
c_func
(paren
r_struct
id|isapnp_dma
op_star
id|dma
)paren
(brace
r_struct
id|isapnp_dma
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|dma
)paren
(brace
id|next
op_assign
id|dma-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|dma
)paren
suffix:semicolon
id|dma
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|isapnp_free_mem
r_static
r_void
id|isapnp_free_mem
c_func
(paren
r_struct
id|isapnp_mem
op_star
id|mem
)paren
(brace
r_struct
id|isapnp_mem
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|mem
)paren
(brace
id|next
op_assign
id|mem-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|mem
)paren
suffix:semicolon
id|mem
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|isapnp_free_mem32
r_static
r_void
id|isapnp_free_mem32
c_func
(paren
r_struct
id|isapnp_mem32
op_star
id|mem32
)paren
(brace
r_struct
id|isapnp_mem32
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|mem32
)paren
(brace
id|next
op_assign
id|mem32-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|mem32
)paren
suffix:semicolon
id|mem32
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|isapnp_free_resources
r_static
r_void
id|isapnp_free_resources
c_func
(paren
r_struct
id|isapnp_resources
op_star
id|resources
comma
r_int
id|alt
)paren
(brace
r_struct
id|isapnp_resources
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|resources
)paren
(brace
id|next
op_assign
id|alt
ques
c_cond
id|resources-&gt;alt
suffix:colon
id|resources-&gt;next
suffix:semicolon
id|isapnp_free_port
c_func
(paren
id|resources-&gt;port
)paren
suffix:semicolon
id|isapnp_free_irq
c_func
(paren
id|resources-&gt;irq
)paren
suffix:semicolon
id|isapnp_free_dma
c_func
(paren
id|resources-&gt;dma
)paren
suffix:semicolon
id|isapnp_free_mem
c_func
(paren
id|resources-&gt;mem
)paren
suffix:semicolon
id|isapnp_free_mem32
c_func
(paren
id|resources-&gt;mem32
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|alt
op_logical_and
id|resources-&gt;alt
)paren
id|isapnp_free_resources
c_func
(paren
id|resources-&gt;alt
comma
l_int|1
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|resources
)paren
suffix:semicolon
id|resources
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|isapnp_free_card
r_static
r_void
id|isapnp_free_card
c_func
(paren
r_struct
id|pci_bus
op_star
id|card
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|card-&gt;devices
)paren
)paren
(brace
r_struct
id|list_head
op_star
id|list
op_assign
id|card-&gt;devices.next
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|pci_dev_b
c_func
(paren
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
id|list
)paren
suffix:semicolon
id|isapnp_free_resources
c_func
(paren
(paren
r_struct
id|isapnp_resources
op_star
)paren
id|dev-&gt;sysdata
comma
l_int|0
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
DECL|function|isapnp_free_all_resources
r_static
r_void
id|isapnp_free_all_resources
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef ISAPNP_REGION_OK
r_if
c_cond
(paren
id|pidxr_res
)paren
id|release_resource
c_func
(paren
id|pidxr_res
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|pnpwrp_res
)paren
id|release_resource
c_func
(paren
id|pnpwrp_res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_rdp
op_ge
l_int|0x203
op_logical_and
id|isapnp_rdp
op_le
l_int|0x3ff
op_logical_and
id|isapnp_rdp_res
)paren
id|release_resource
c_func
(paren
id|isapnp_rdp_res
)paren
suffix:semicolon
macro_line|#ifdef MODULE
macro_line|#ifdef CONFIG_PROC_FS
id|isapnp_proc_done
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|isapnp_cards
)paren
)paren
(brace
r_struct
id|list_head
op_star
id|list
op_assign
id|isapnp_cards.next
suffix:semicolon
id|list_del
c_func
(paren
id|list
)paren
suffix:semicolon
id|isapnp_free_card
c_func
(paren
id|pci_bus_b
c_func
(paren
id|list
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|variable|isapnp_cards
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_cards
)paren
suffix:semicolon
DECL|variable|isapnp_devices
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_devices
)paren
suffix:semicolon
DECL|variable|isapnp_present
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_present
)paren
suffix:semicolon
DECL|variable|isapnp_cfg_begin
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_cfg_begin
)paren
suffix:semicolon
DECL|variable|isapnp_cfg_end
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_cfg_end
)paren
suffix:semicolon
DECL|variable|isapnp_read_byte
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_read_byte
)paren
suffix:semicolon
DECL|variable|isapnp_read_word
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_read_word
)paren
suffix:semicolon
DECL|variable|isapnp_read_dword
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_read_dword
)paren
suffix:semicolon
DECL|variable|isapnp_write_byte
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_write_byte
)paren
suffix:semicolon
DECL|variable|isapnp_write_word
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_write_word
)paren
suffix:semicolon
DECL|variable|isapnp_write_dword
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_write_dword
)paren
suffix:semicolon
DECL|variable|isapnp_wake
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_wake
)paren
suffix:semicolon
DECL|variable|isapnp_device
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_device
)paren
suffix:semicolon
DECL|variable|isapnp_activate
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_activate
)paren
suffix:semicolon
DECL|variable|isapnp_deactivate
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_deactivate
)paren
suffix:semicolon
DECL|variable|isapnp_find_card
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_find_card
)paren
suffix:semicolon
DECL|variable|isapnp_find_dev
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_find_dev
)paren
suffix:semicolon
DECL|variable|isapnp_probe_cards
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_probe_cards
)paren
suffix:semicolon
DECL|variable|isapnp_probe_devs
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_probe_devs
)paren
suffix:semicolon
DECL|variable|isapnp_activate_dev
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_activate_dev
)paren
suffix:semicolon
DECL|variable|isapnp_resource_change
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_resource_change
)paren
suffix:semicolon
DECL|function|isapnp_init
r_int
id|__init
id|isapnp_init
c_func
(paren
r_void
)paren
(brace
r_int
id|cards
suffix:semicolon
r_struct
id|pci_bus
op_star
id|card
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_disable
)paren
(brace
id|isapnp_detected
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;isapnp: ISA Plug &amp; Play support disabled&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef ISAPNP_REGION_OK
id|pidxr_res
op_assign
id|request_region
c_func
(paren
id|_PIDXR
comma
l_int|1
comma
l_string|&quot;isapnp index&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pidxr_res
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;isapnp: Index Register 0x%x already used&bslash;n&quot;
comma
id|_PIDXR
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
macro_line|#endif
id|pnpwrp_res
op_assign
id|request_region
c_func
(paren
id|_PNPWRP
comma
l_int|1
comma
l_string|&quot;isapnp write&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pnpwrp_res
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;isapnp: Write Data Register 0x%x already used&bslash;n&quot;
comma
id|_PNPWRP
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Print a message. The existing ISAPnP code is hanging machines&n;&t; *&t;so let the user know where.&n;&t; */
id|printk
c_func
(paren
l_string|&quot;isapnp: Scanning for Pnp cards...&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_rdp
op_ge
l_int|0x203
op_logical_and
id|isapnp_rdp
op_le
l_int|0x3ff
)paren
(brace
id|isapnp_rdp
op_or_assign
l_int|3
suffix:semicolon
id|isapnp_rdp_res
op_assign
id|request_region
c_func
(paren
id|isapnp_rdp
comma
l_int|1
comma
l_string|&quot;isapnp read&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isapnp_rdp_res
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;isapnp: Read Data Register 0x%x already used&bslash;n&quot;
comma
id|isapnp_rdp
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|isapnp_set_rdp
c_func
(paren
)paren
suffix:semicolon
)brace
id|isapnp_detected
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_rdp
template_param
l_int|0x3ff
)paren
(brace
id|cards
op_assign
id|isapnp_isolate
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cards
OL
l_int|0
op_logical_or
(paren
id|isapnp_rdp
template_param
l_int|0x3ff
)paren
)paren
(brace
id|isapnp_free_all_resources
c_func
(paren
)paren
suffix:semicolon
id|isapnp_detected
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;isapnp: No Plug &amp; Play device found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|isapnp_rdp_res
op_assign
id|request_region
c_func
(paren
id|isapnp_rdp
comma
l_int|1
comma
l_string|&quot;isapnp read&quot;
)paren
suffix:semicolon
)brace
id|isapnp_build_device_list
c_func
(paren
)paren
suffix:semicolon
id|cards
op_assign
l_int|0
suffix:semicolon
id|isapnp_for_each_card
c_func
(paren
id|card
)paren
(brace
id|cards
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_verbose
)paren
(brace
r_struct
id|list_head
op_star
id|devlist
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;isapnp: Card &squot;%s&squot;&bslash;n&quot;
comma
id|card-&gt;name
(braket
l_int|0
)braket
ques
c_cond
id|card-&gt;name
suffix:colon
l_string|&quot;Unknown&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_verbose
OL
l_int|2
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|devlist
op_assign
id|card-&gt;devices.next
suffix:semicolon
id|devlist
op_ne
op_amp
id|card-&gt;devices
suffix:semicolon
id|devlist
op_assign
id|devlist-&gt;next
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
op_assign
id|pci_dev_b
c_func
(paren
id|devlist
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;isapnp:   Device &squot;%s&squot;&bslash;n&quot;
comma
id|dev-&gt;name
(braket
l_int|0
)braket
ques
c_cond
id|card-&gt;name
suffix:colon
l_string|&quot;Unknown&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|cards
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;isapnp: %i Plug &amp; Play card%s detected total&bslash;n&quot;
comma
id|cards
comma
id|cards
OG
l_int|1
ques
c_cond
l_string|&quot;s&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;isapnp: No Plug &amp; Play card found&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
id|isapnp_proc_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|isapnp_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|isapnp_detected
)paren
id|isapnp_free_all_resources
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
