multiline_comment|/*&n;   * Copyright 1996 The Australian National University.&n;   * Copyright 1996 Fujitsu Laboratories Limited&n;   * &n;   * This software may be distributed under the terms of the Gnu&n;   * Public License version 2 or later&n;  */
multiline_comment|/*&n; * $Id: apfddi.c,v 1.6 1996/12/18 01:45:51 tridge Exp $&n; *&n; * Network interface definitions for AP1000 fddi device.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/if_ether.h&gt;&t;/* For the statistics structure. */
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;asm/ap1000/apservice.h&gt;
macro_line|#include &lt;asm/ap1000/apreg.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &quot;apfddi.h&quot;
macro_line|#include &quot;smt-types.h&quot;
macro_line|#include &quot;mac.h&quot;
macro_line|#include &quot;plc.h&quot;
macro_line|#include &quot;am79c830.h&quot;
macro_line|#include &quot;apfddi-reg.h&quot;
DECL|variable|mac
r_volatile
r_struct
id|formac
op_star
id|mac
suffix:semicolon
DECL|variable|plc
r_volatile
r_struct
id|plc
op_star
id|plc
suffix:semicolon
DECL|variable|csr0
r_volatile
r_int
op_star
id|csr0
suffix:semicolon
DECL|variable|csr1
r_volatile
r_int
op_star
id|csr1
suffix:semicolon
DECL|variable|buffer_mem
r_volatile
r_int
op_star
id|buffer_mem
suffix:semicolon
DECL|variable|fifo
r_volatile
r_int
op_star
id|fifo
suffix:semicolon
DECL|macro|APFDDI_DEBUG
mdefine_line|#define APFDDI_DEBUG 0
DECL|macro|APFDDI_IRQ
mdefine_line|#define APFDDI_IRQ    7
DECL|macro|T
mdefine_line|#define T(x)&t;(-SECS_TO_FDDI_TIME(x))
DECL|variable|plc_info
r_struct
id|plc_info
id|plc_info
op_assign
(brace
id|pt_s
comma
multiline_comment|/* port_type */
id|T
c_func
(paren
l_float|1.6e-3
)paren
comma
multiline_comment|/* c_min */
id|T
c_func
(paren
l_float|50e-6
)paren
comma
multiline_comment|/* tl_min */
id|T
c_func
(paren
l_float|5e-3
)paren
comma
multiline_comment|/* tb_min */
id|T
c_func
(paren
l_float|100e-3
)paren
comma
multiline_comment|/* t_out */
id|T
c_func
(paren
l_float|50e-3
)paren
comma
multiline_comment|/* lc_short */
id|T
c_func
(paren
l_float|500e-3
)paren
comma
multiline_comment|/* lc_medium */
id|T
c_func
(paren
l_float|5.0
)paren
comma
multiline_comment|/* lc_long */
id|T
c_func
(paren
l_float|50.0
)paren
comma
multiline_comment|/* lc_extended */
id|T
c_func
(paren
l_float|3.5e-3
)paren
comma
multiline_comment|/* t_scrub */
id|T
c_func
(paren
l_float|1.3e-3
)paren
comma
multiline_comment|/* ns_max */
)brace
suffix:semicolon
DECL|variable|mac_info
r_struct
id|mac_info
id|mac_info
op_assign
(brace
id|T
c_func
(paren
l_float|165e-3
)paren
comma
multiline_comment|/* tmax */
id|T
c_func
(paren
l_float|3.5e-3
)paren
comma
multiline_comment|/* tvx */
id|T
c_func
(paren
l_float|20e-3
)paren
comma
multiline_comment|/* treq */
(brace
l_int|0x42
comma
l_int|0x59
)brace
comma
multiline_comment|/* s_address */
(brace
l_int|0x42
comma
l_int|0x59
comma
l_int|0x10
comma
l_int|0x76
comma
l_int|0x88
comma
l_int|0x82
)brace
comma
multiline_comment|/* l_address */
(brace
l_int|0
)brace
comma
multiline_comment|/* s_group_adrs */
(brace
l_int|0
)brace
comma
multiline_comment|/* l_group_adrs */
l_int|0
comma
multiline_comment|/* rcv_own_frames */
l_int|1
comma
multiline_comment|/* only_good_frames */
)brace
suffix:semicolon
DECL|variable|fddi_bitrev
id|u_char
id|fddi_bitrev
(braket
l_int|256
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x80
comma
l_int|0x40
comma
l_int|0xc0
comma
l_int|0x20
comma
l_int|0xa0
comma
l_int|0x60
comma
l_int|0xe0
comma
l_int|0x10
comma
l_int|0x90
comma
l_int|0x50
comma
l_int|0xd0
comma
l_int|0x30
comma
l_int|0xb0
comma
l_int|0x70
comma
l_int|0xf0
comma
l_int|0x08
comma
l_int|0x88
comma
l_int|0x48
comma
l_int|0xc8
comma
l_int|0x28
comma
l_int|0xa8
comma
l_int|0x68
comma
l_int|0xe8
comma
l_int|0x18
comma
l_int|0x98
comma
l_int|0x58
comma
l_int|0xd8
comma
l_int|0x38
comma
l_int|0xb8
comma
l_int|0x78
comma
l_int|0xf8
comma
l_int|0x04
comma
l_int|0x84
comma
l_int|0x44
comma
l_int|0xc4
comma
l_int|0x24
comma
l_int|0xa4
comma
l_int|0x64
comma
l_int|0xe4
comma
l_int|0x14
comma
l_int|0x94
comma
l_int|0x54
comma
l_int|0xd4
comma
l_int|0x34
comma
l_int|0xb4
comma
l_int|0x74
comma
l_int|0xf4
comma
l_int|0x0c
comma
l_int|0x8c
comma
l_int|0x4c
comma
l_int|0xcc
comma
l_int|0x2c
comma
l_int|0xac
comma
l_int|0x6c
comma
l_int|0xec
comma
l_int|0x1c
comma
l_int|0x9c
comma
l_int|0x5c
comma
l_int|0xdc
comma
l_int|0x3c
comma
l_int|0xbc
comma
l_int|0x7c
comma
l_int|0xfc
comma
l_int|0x02
comma
l_int|0x82
comma
l_int|0x42
comma
l_int|0xc2
comma
l_int|0x22
comma
l_int|0xa2
comma
l_int|0x62
comma
l_int|0xe2
comma
l_int|0x12
comma
l_int|0x92
comma
l_int|0x52
comma
l_int|0xd2
comma
l_int|0x32
comma
l_int|0xb2
comma
l_int|0x72
comma
l_int|0xf2
comma
l_int|0x0a
comma
l_int|0x8a
comma
l_int|0x4a
comma
l_int|0xca
comma
l_int|0x2a
comma
l_int|0xaa
comma
l_int|0x6a
comma
l_int|0xea
comma
l_int|0x1a
comma
l_int|0x9a
comma
l_int|0x5a
comma
l_int|0xda
comma
l_int|0x3a
comma
l_int|0xba
comma
l_int|0x7a
comma
l_int|0xfa
comma
l_int|0x06
comma
l_int|0x86
comma
l_int|0x46
comma
l_int|0xc6
comma
l_int|0x26
comma
l_int|0xa6
comma
l_int|0x66
comma
l_int|0xe6
comma
l_int|0x16
comma
l_int|0x96
comma
l_int|0x56
comma
l_int|0xd6
comma
l_int|0x36
comma
l_int|0xb6
comma
l_int|0x76
comma
l_int|0xf6
comma
l_int|0x0e
comma
l_int|0x8e
comma
l_int|0x4e
comma
l_int|0xce
comma
l_int|0x2e
comma
l_int|0xae
comma
l_int|0x6e
comma
l_int|0xee
comma
l_int|0x1e
comma
l_int|0x9e
comma
l_int|0x5e
comma
l_int|0xde
comma
l_int|0x3e
comma
l_int|0xbe
comma
l_int|0x7e
comma
l_int|0xfe
comma
l_int|0x01
comma
l_int|0x81
comma
l_int|0x41
comma
l_int|0xc1
comma
l_int|0x21
comma
l_int|0xa1
comma
l_int|0x61
comma
l_int|0xe1
comma
l_int|0x11
comma
l_int|0x91
comma
l_int|0x51
comma
l_int|0xd1
comma
l_int|0x31
comma
l_int|0xb1
comma
l_int|0x71
comma
l_int|0xf1
comma
l_int|0x09
comma
l_int|0x89
comma
l_int|0x49
comma
l_int|0xc9
comma
l_int|0x29
comma
l_int|0xa9
comma
l_int|0x69
comma
l_int|0xe9
comma
l_int|0x19
comma
l_int|0x99
comma
l_int|0x59
comma
l_int|0xd9
comma
l_int|0x39
comma
l_int|0xb9
comma
l_int|0x79
comma
l_int|0xf9
comma
l_int|0x05
comma
l_int|0x85
comma
l_int|0x45
comma
l_int|0xc5
comma
l_int|0x25
comma
l_int|0xa5
comma
l_int|0x65
comma
l_int|0xe5
comma
l_int|0x15
comma
l_int|0x95
comma
l_int|0x55
comma
l_int|0xd5
comma
l_int|0x35
comma
l_int|0xb5
comma
l_int|0x75
comma
l_int|0xf5
comma
l_int|0x0d
comma
l_int|0x8d
comma
l_int|0x4d
comma
l_int|0xcd
comma
l_int|0x2d
comma
l_int|0xad
comma
l_int|0x6d
comma
l_int|0xed
comma
l_int|0x1d
comma
l_int|0x9d
comma
l_int|0x5d
comma
l_int|0xdd
comma
l_int|0x3d
comma
l_int|0xbd
comma
l_int|0x7d
comma
l_int|0xfd
comma
l_int|0x03
comma
l_int|0x83
comma
l_int|0x43
comma
l_int|0xc3
comma
l_int|0x23
comma
l_int|0xa3
comma
l_int|0x63
comma
l_int|0xe3
comma
l_int|0x13
comma
l_int|0x93
comma
l_int|0x53
comma
l_int|0xd3
comma
l_int|0x33
comma
l_int|0xb3
comma
l_int|0x73
comma
l_int|0xf3
comma
l_int|0x0b
comma
l_int|0x8b
comma
l_int|0x4b
comma
l_int|0xcb
comma
l_int|0x2b
comma
l_int|0xab
comma
l_int|0x6b
comma
l_int|0xeb
comma
l_int|0x1b
comma
l_int|0x9b
comma
l_int|0x5b
comma
l_int|0xdb
comma
l_int|0x3b
comma
l_int|0xbb
comma
l_int|0x7b
comma
l_int|0xfb
comma
l_int|0x07
comma
l_int|0x87
comma
l_int|0x47
comma
l_int|0xc7
comma
l_int|0x27
comma
l_int|0xa7
comma
l_int|0x67
comma
l_int|0xe7
comma
l_int|0x17
comma
l_int|0x97
comma
l_int|0x57
comma
l_int|0xd7
comma
l_int|0x37
comma
l_int|0xb7
comma
l_int|0x77
comma
l_int|0xf7
comma
l_int|0x0f
comma
l_int|0x8f
comma
l_int|0x4f
comma
l_int|0xcf
comma
l_int|0x2f
comma
l_int|0xaf
comma
l_int|0x6f
comma
l_int|0xef
comma
l_int|0x1f
comma
l_int|0x9f
comma
l_int|0x5f
comma
l_int|0xdf
comma
l_int|0x3f
comma
l_int|0xbf
comma
l_int|0x7f
comma
l_int|0xff
comma
)brace
suffix:semicolon
multiline_comment|/* XXX our hardware address, canonical bit order */
DECL|variable|apfddi_saddr
r_static
id|u_char
id|apfddi_saddr
(braket
l_int|6
)braket
op_assign
(brace
l_int|0x42
comma
l_int|0x9a
comma
l_int|0x08
comma
l_int|0x6e
comma
l_int|0x11
comma
l_int|0x41
)brace
suffix:semicolon
DECL|variable|apfddi_device
r_struct
id|device
op_star
id|apfddi_device
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|apfddi_stats
r_struct
id|net_device_stats
op_star
id|apfddi_stats
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|apfddi_queue_top
r_volatile
r_struct
id|apfddi_queue
op_star
id|apfddi_queue_top
op_assign
l_int|NULL
suffix:semicolon
DECL|function|map_regs
r_void
id|map_regs
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|reg_base_addr
op_assign
l_int|0xfbf00000
suffix:semicolon
id|mac
op_assign
(paren
r_volatile
r_struct
id|formac
op_star
)paren
(paren
id|reg_base_addr
op_plus
id|FORMAC
)paren
suffix:semicolon
id|plc
op_assign
(paren
r_volatile
r_struct
id|plc
op_star
)paren
(paren
id|reg_base_addr
op_plus
id|PLC
)paren
suffix:semicolon
id|csr0
op_assign
(paren
r_volatile
r_int
op_star
)paren
(paren
id|reg_base_addr
op_plus
id|CSR0
)paren
suffix:semicolon
id|csr1
op_assign
(paren
r_volatile
r_int
op_star
)paren
(paren
id|reg_base_addr
op_plus
id|CSR1
)paren
suffix:semicolon
id|buffer_mem
op_assign
(paren
r_volatile
r_int
op_star
)paren
(paren
id|reg_base_addr
op_plus
id|BUFFER_MEM
)paren
suffix:semicolon
id|fifo
op_assign
(paren
r_volatile
r_int
op_star
)paren
(paren
id|reg_base_addr
op_plus
id|FIFO
)paren
suffix:semicolon
)brace
DECL|variable|ring_op
r_int
id|ring_op
suffix:semicolon
DECL|function|apfddi_startup
r_void
id|apfddi_startup
c_func
(paren
r_void
)paren
(brace
r_int
id|reason
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;In apfddi_startup&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
op_star
id|csr0
op_assign
id|CS0_LED0
suffix:semicolon
id|ring_op
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|csr1
op_amp
l_int|0xf078
)paren
(brace
op_star
id|csr1
op_assign
id|CS1_RESET_MAC
op_or
id|CS1_RESET_FIFO
suffix:semicolon
op_star
id|csr1
op_assign
l_int|0
suffix:semicolon
id|reason
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;resetting after power-on&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|csr1
op_assign
id|CS1_RESET_FIFO
suffix:semicolon
op_star
id|csr1
op_assign
l_int|0
suffix:semicolon
id|reason
op_assign
id|plc_inited
c_func
(paren
op_amp
id|plc_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reason
)paren
id|printk
c_func
(paren
l_string|&quot;resetting: plc reason %d&bslash;n&quot;
comma
id|reason
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|reason
)paren
(brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;Calling plc_init&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|plc_init
c_func
(paren
op_amp
id|plc_info
)paren
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;Calling mac_init&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|mac_init
c_func
(paren
op_amp
id|mac_info
)paren
suffix:semicolon
op_star
id|csr0
op_or_assign
id|CS0_LED1
suffix:semicolon
id|pc_start
c_func
(paren
id|loop_none
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|csr0
op_or_assign
id|CS0_LED2
op_or
id|CS0_LED1
suffix:semicolon
id|reason
op_assign
id|mac_inited
c_func
(paren
op_amp
id|mac_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reason
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;resetting mac: reason %d&bslash;n&quot;
comma
id|reason
)paren
suffix:semicolon
id|mac_init
c_func
(paren
op_amp
id|mac_info
)paren
suffix:semicolon
id|mac_reset
c_func
(paren
id|loop_none
)paren
suffix:semicolon
id|mac_claim
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|ring_op
op_assign
l_int|1
suffix:semicolon
op_star
id|csr0
op_and_assign
op_complement
(paren
id|CS0_LED0
op_or
id|CS0_LED1
op_or
id|CS0_LED2
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|apfddi_off
r_void
id|apfddi_off
c_func
(paren
r_void
)paren
(brace
op_star
id|csr0
op_and_assign
op_complement
id|CS0_LED1
suffix:semicolon
id|pc_stop
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|apfddi_sleep
r_void
id|apfddi_sleep
c_func
(paren
r_void
)paren
(brace
id|mac_sleep
c_func
(paren
)paren
suffix:semicolon
id|plc_sleep
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|apfddi_poll
r_void
id|apfddi_poll
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_star
id|csr0
op_amp
id|CS0_PHY_IRQ
)paren
id|plc_poll
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|csr0
op_amp
id|CS0_MAC_IRQ
)paren
id|mac_poll
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|set_cf_join
r_void
id|set_cf_join
c_func
(paren
r_int
id|on
)paren
(brace
r_if
c_cond
(paren
id|on
)paren
(brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;apfddi: joined the ring!&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|mac_reset
c_func
(paren
id|loop_none
)paren
suffix:semicolon
op_star
id|csr0
op_or_assign
id|CS0_LED2
suffix:semicolon
id|mac_claim
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|mac_disable
c_func
(paren
)paren
suffix:semicolon
id|ring_op
op_assign
l_int|0
suffix:semicolon
op_star
id|csr0
op_assign
(paren
op_star
id|csr0
op_amp
op_complement
id|CS0_LED2
)paren
op_or
id|CS0_LED1
op_or
id|CS0_LED0
suffix:semicolon
)brace
)brace
DECL|function|set_ring_op
r_void
id|set_ring_op
c_func
(paren
r_int
id|up
)paren
(brace
id|ring_op
op_assign
id|up
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;apfddi: ring operational!&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
op_star
id|csr0
op_and_assign
op_complement
(paren
id|CS0_LED2
op_or
id|CS0_LED1
op_or
id|CS0_LED0
)paren
suffix:semicolon
)brace
r_else
op_star
id|csr0
op_or_assign
id|CS0_LED2
op_or
id|CS0_LED1
op_or
id|CS0_LED0
suffix:semicolon
)brace
DECL|function|rmt_event
r_void
id|rmt_event
c_func
(paren
r_int
id|st
)paren
(brace
r_if
c_cond
(paren
id|st
op_amp
(paren
id|S2_BEACON_STATE
op_or
id|S2_MULTIPLE_DA
op_or
id|S2_TOKEN_ERR
op_or
id|S2_DUPL_CLAIM
op_or
id|S2_TRT_EXP_RECOV
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;st2 = %x&bslash;n&quot;
comma
id|st
)paren
suffix:semicolon
)brace
)brace
r_int
id|apfddi_init
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|apfddi_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|apfddi_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_int
id|apfddi_rx
c_func
(paren
r_struct
id|mac_buf
op_star
id|mbuf
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|apfddi_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#if APFDDI_DEBUG
r_void
id|dump_packet
c_func
(paren
r_char
op_star
id|action
comma
r_char
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|seq
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * Create FDDI header for an arbitrary protocol layer&n; *&n; * saddr=NULL means use device source address (always will anyway)&n; * daddr=NULL means leave destination address (eg unresolved arp)&n; */
DECL|function|apfddi_hard_header
r_static
r_int
id|apfddi_hard_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|len
)paren
(brace
r_struct
id|fddi_header
op_star
id|fh
suffix:semicolon
r_struct
id|llc_header
op_star
id|lh
suffix:semicolon
id|u_char
op_star
id|base_header
suffix:semicolon
id|u_char
op_star
id|fd_daddr
op_assign
(paren
id|u_char
op_star
)paren
id|daddr
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;In apfddi_hard_header&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Null skb in apfddi_hard_header... returning...&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|ETH_P_IP
suffix:colon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;apfddi_hard_header: Processing IP packet&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|ETH_P_ARP
suffix:colon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;apfddi_hard_header: Processing ARP packet&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|ETH_P_RARP
suffix:colon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;apfddi_hard_header: Processing RARP packet&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;apfddi_hard_header: I don&squot;t understand protocol %d (0x%x)&bslash;n&quot;
comma
id|type
comma
id|type
)paren
suffix:semicolon
id|apfddi_stats-&gt;tx_errors
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|base_header
op_assign
(paren
id|u_char
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
id|FDDI_HARDHDR_LEN
op_minus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|base_header
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;apfddi_hard_header: Memory squeeze, dropping packet.&bslash;n&quot;
)paren
suffix:semicolon
id|apfddi_stats-&gt;tx_dropped
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|fh
op_assign
(paren
r_struct
id|fddi_header
op_star
)paren
(paren
id|base_header
op_plus
l_int|3
)paren
suffix:semicolon
id|lh
op_assign
(paren
r_struct
id|llc_header
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|fh
op_plus
id|FDDI_HDRLEN
)paren
suffix:semicolon
id|lh-&gt;llc_dsap
op_assign
id|lh-&gt;llc_ssap
op_assign
id|LLC_SNAP_LSAP
suffix:semicolon
id|lh-&gt;snap_control
op_assign
id|LLC_UI
suffix:semicolon
id|lh-&gt;snap_org_code
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|lh-&gt;snap_org_code
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|lh-&gt;snap_org_code
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|lh-&gt;snap_ether_type
op_assign
id|htons
c_func
(paren
id|type
)paren
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;snap_ether_type is %d (0x%x)&bslash;n&quot;
comma
id|lh-&gt;snap_ether_type
comma
id|lh-&gt;snap_ether_type
)paren
suffix:semicolon
macro_line|#endif
id|fh-&gt;fddi_fc
op_assign
id|FDDI_FC_LLC
suffix:semicolon
multiline_comment|/*&n;     * Fill in the source address.&n;     */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|fh-&gt;fddi_shost
(braket
id|i
)braket
op_assign
id|fddi_bitrev
(braket
id|apfddi_saddr
(braket
id|i
)braket
)braket
suffix:semicolon
multiline_comment|/*&n;     * Fill in the destination address.&n;     */
r_if
c_cond
(paren
id|daddr
)paren
(brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;daddr is: &quot;
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fh-&gt;fddi_dhost
(braket
id|i
)braket
op_assign
id|fddi_bitrev
(braket
id|fd_daddr
(braket
id|i
)braket
)braket
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;%x(%x):&quot;
comma
id|fh-&gt;fddi_dhost
(braket
id|i
)braket
comma
id|fd_daddr
(braket
id|i
)braket
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|FDDI_HARDHDR_LEN
op_minus
l_int|4
suffix:semicolon
)brace
r_else
(brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;apfddi_hard_header, daddr was NULL&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
(paren
id|FDDI_HARDHDR_LEN
op_minus
l_int|4
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Rebuild the FDDI header. This is called after an ARP (or in future&n; * other address resolution) has completed on this sk_buff. We now let&n; * ARP fill in the other fields.  &n; */
DECL|function|apfddi_rebuild_header
r_static
r_int
id|apfddi_rebuild_header
c_func
(paren
r_void
op_star
id|buff
comma
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|raddr
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|i
comma
id|status
suffix:semicolon
r_struct
id|fddi_header
op_star
id|fh
op_assign
(paren
r_struct
id|fddi_header
op_star
)paren
(paren
id|buff
op_plus
l_int|3
)paren
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;In apfddi_rebuild_header, dev is %x apfddi_device is %x&bslash;n&quot;
comma
id|dev
comma
id|apfddi_device
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;rebuild header for fc 0x%x&bslash;n&quot;
comma
id|fh-&gt;fddi_fc
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;dest address is:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%x:&quot;
comma
id|fh-&gt;fddi_dhost
(braket
id|i
)braket
)paren
suffix:semicolon
macro_line|#endif
id|status
op_assign
id|arp_find
c_func
(paren
id|raddr
comma
id|skb
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;dest address is now:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%x:&quot;
comma
id|fh-&gt;fddi_dhost
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;status is %d&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Bit reverse the dest_address.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|fh-&gt;fddi_dhost
(braket
id|i
)braket
op_assign
id|fddi_bitrev
(braket
id|fh-&gt;fddi_dhost
(braket
id|i
)braket
)braket
suffix:semicolon
)brace
macro_line|#if APFDDI_DEBUG    
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|status
suffix:semicolon
)brace
DECL|function|apfddi_set_mac_address
r_static
r_int
id|apfddi_set_mac_address
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_void
op_star
id|addr
)paren
(brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;In apfddi_set_mac_address&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|apfddi_set_multicast_list
r_static
r_void
id|apfddi_set_multicast_list
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;In apfddi_set_multicast_list&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|apfddi_do_ioctl
r_static
r_int
id|apfddi_do_ioctl
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;In apfddi_do_ioctl&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|apfddi_set_config
r_static
r_int
id|apfddi_set_config
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
(brace
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;In apfddi_set_config&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Opening the fddi device through ifconfig.&n; */
DECL|function|apfddi_open
r_int
id|apfddi_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_static
r_int
id|already_run
op_assign
l_int|0
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_int
id|res
suffix:semicolon
r_if
c_cond
(paren
id|already_run
)paren
(brace
id|apfddi_startup
c_func
(paren
)paren
suffix:semicolon
op_star
id|csr0
op_or_assign
id|CS0_INT_ENABLE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|already_run
op_assign
l_int|1
suffix:semicolon
id|map_regs
c_func
(paren
)paren
suffix:semicolon
id|apfddi_startup
c_func
(paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|request_irq
c_func
(paren
id|APFDDI_IRQ
comma
id|apfddi_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;apfddi&quot;
comma
id|dev
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Failed to install apfddi handler error=%d&bslash;n&quot;
comma
id|res
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|enable_irq
c_func
(paren
id|APFDDI_IRQ
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;Installed apfddi interrupt handler&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
op_star
id|csr0
op_or_assign
id|CS0_INT_ENABLE
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;Enabled fddi interrupts&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Stop the fddi device through ifconfig.&n; */
DECL|function|apfddi_stop
r_int
id|apfddi_stop
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
op_star
id|csr0
op_and_assign
op_complement
id|CS0_INT_ENABLE
suffix:semicolon
id|apfddi_sleep
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialise fddi network interface.&n; */
DECL|function|apfddi_init
r_int
id|apfddi_init
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;     * Check if this thing has already been initialised.&n;     */
r_if
c_cond
(paren
id|apfddi_device
op_ne
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;apfddi_init(): Initialising fddi interface&bslash;n&quot;
)paren
suffix:semicolon
id|apfddi_device
op_assign
id|dev
suffix:semicolon
id|dev-&gt;open
op_assign
id|apfddi_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|apfddi_stop
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|apfddi_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|apfddi_get_stats
suffix:semicolon
id|dev-&gt;priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|dev-&gt;priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
)paren
suffix:semicolon
id|apfddi_stats
op_assign
(paren
r_struct
id|net_device_stats
op_star
)paren
id|apfddi_device-&gt;priv
suffix:semicolon
multiline_comment|/* Initialise the fddi device structure */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DEV_NUMBUFFS
suffix:semicolon
id|i
op_increment
)paren
id|skb_queue_head_init
c_func
(paren
op_amp
id|dev-&gt;buffs
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev-&gt;hard_header
op_assign
id|apfddi_hard_header
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
id|apfddi_rebuild_header
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
id|apfddi_set_mac_address
suffix:semicolon
id|dev-&gt;header_cache_update
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|apfddi_do_ioctl
suffix:semicolon
id|dev-&gt;set_config
op_assign
id|apfddi_set_config
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|apfddi_set_multicast_list
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
id|FDDI_HARDHDR_LEN
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|FDDIMTU
suffix:semicolon
id|dev-&gt;addr_len
op_assign
l_int|6
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|apfddi_saddr
comma
r_sizeof
(paren
id|apfddi_saddr
)paren
)paren
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
l_int|100
suffix:semicolon
multiline_comment|/* XXX What should this be? */
id|dev-&gt;irq
op_assign
id|APFDDI_IRQ
suffix:semicolon
id|memset
c_func
(paren
id|dev-&gt;broadcast
comma
l_int|0xFF
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|apfddi_interrupt
r_static
r_void
id|apfddi_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
macro_line|#if APFDDI_DEBUG
r_static
r_int
id|times
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;In apfddi_interrupt irq %d dev_id %p times %d&bslash;n&quot;
comma
id|irq
comma
id|dev_id
comma
op_increment
id|times
)paren
suffix:semicolon
macro_line|#endif
id|apfddi_poll
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#if APFDDI_DEBUG
DECL|variable|flagbits
r_static
r_char
op_star
id|flagbits
(braket
l_int|8
)braket
op_assign
(brace
l_string|&quot;fin&quot;
comma
l_string|&quot;syn&quot;
comma
l_string|&quot;rst&quot;
comma
l_string|&quot;push&quot;
comma
l_string|&quot;ack&quot;
comma
l_string|&quot;urg&quot;
comma
l_string|&quot;6&quot;
comma
l_string|&quot;7&quot;
)brace
suffix:semicolon
DECL|function|dump_packet
r_void
id|dump_packet
c_func
(paren
id|action
comma
id|buf
comma
id|len
comma
id|seq
)paren
r_char
op_star
id|action
comma
op_star
id|buf
suffix:semicolon
r_int
id|len
comma
id|seq
suffix:semicolon
(brace
r_int
id|i
comma
id|flags
suffix:semicolon
r_char
op_star
id|sep
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s packet %d of %d bytes at %d:&bslash;n&quot;
comma
id|action
comma
id|seq
comma
id|len
comma
id|jiffies
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  from %x to %x pktid=%d ttl=%d pcol=%d len=%d&bslash;n&quot;
comma
op_star
(paren
r_int
op_star
)paren
(paren
id|buf
op_plus
l_int|12
)paren
comma
op_star
(paren
r_int
op_star
)paren
(paren
id|buf
op_plus
l_int|16
)paren
comma
op_star
(paren
id|u_short
op_star
)paren
(paren
id|buf
op_plus
l_int|4
)paren
comma
op_star
(paren
r_int
r_char
op_star
)paren
(paren
id|buf
op_plus
l_int|8
)paren
comma
id|buf
(braket
l_int|9
)braket
comma
op_star
(paren
id|u_short
op_star
)paren
(paren
id|buf
op_plus
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
l_int|9
)braket
op_eq
l_int|6
op_logical_or
id|buf
(braket
l_int|9
)braket
op_eq
l_int|17
)paren
(brace
multiline_comment|/* TCP or UDP */
id|printk
c_func
(paren
l_string|&quot;  sport=%d dport=%d&quot;
comma
op_star
(paren
id|u_short
op_star
)paren
(paren
id|buf
op_plus
l_int|20
)paren
comma
op_star
(paren
id|u_short
op_star
)paren
(paren
id|buf
op_plus
l_int|22
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
l_int|9
)braket
op_eq
l_int|6
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; seq=%d ack=%d win=%d flags=&lt;&quot;
comma
op_star
(paren
r_int
op_star
)paren
(paren
id|buf
op_plus
l_int|24
)paren
comma
op_star
(paren
r_int
op_star
)paren
(paren
id|buf
op_plus
l_int|28
)paren
comma
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|buf
op_plus
l_int|34
)paren
)paren
suffix:semicolon
id|flags
op_assign
id|buf
(braket
l_int|33
)braket
suffix:semicolon
id|sep
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|7
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
op_decrement
id|i
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s%s&quot;
comma
id|sep
comma
id|flagbits
(braket
id|i
)braket
)paren
suffix:semicolon
id|sep
op_assign
l_string|&quot;+&quot;
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;&gt;&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#if APFDDI_DEBUG
DECL|function|apfddi_print_frame
r_static
r_void
id|apfddi_print_frame
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|llc_header
op_star
id|lh
suffix:semicolon
r_static
r_int
id|seq
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;skb-&gt;len is %d&bslash;n&quot;
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;fc is 0x%x&bslash;n&quot;
comma
op_star
(paren
id|u_char
op_star
)paren
(paren
id|skb-&gt;data
op_plus
l_int|3
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;dest address is:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x:&quot;
comma
id|fddi_bitrev
(braket
op_star
(paren
id|u_char
op_star
)paren
(paren
id|skb-&gt;data
op_plus
l_int|4
op_plus
id|i
)paren
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;source address is:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x:&quot;
comma
id|fddi_bitrev
(braket
op_star
(paren
id|u_char
op_star
)paren
(paren
id|skb-&gt;data
op_plus
l_int|10
op_plus
id|i
)paren
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|lh
op_assign
(paren
r_struct
id|llc_header
op_star
)paren
(paren
id|skb-&gt;data
op_plus
l_int|16
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;llc_dsp %d llc_ssap %d snap_control %d org_code [0]=%d [1]=%d [2]=%d ether_type=%d&bslash;n&quot;
comma
id|lh-&gt;llc_dsap
comma
id|lh-&gt;llc_ssap
comma
id|lh-&gt;snap_control
comma
id|lh-&gt;snap_org_code
(braket
l_int|0
)braket
comma
id|lh-&gt;snap_org_code
(braket
l_int|1
)braket
comma
id|lh-&gt;snap_org_code
(braket
l_int|2
)braket
comma
id|lh-&gt;snap_ether_type
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|lh-&gt;snap_ether_type
op_eq
id|ETH_P_IP
)paren
id|dump_packet
c_func
(paren
l_string|&quot;apfddi_xmit:&quot;
comma
id|skb-&gt;data
op_plus
l_int|24
comma
id|skb-&gt;len
op_minus
l_int|24
comma
id|seq
op_increment
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Transmitting packet over FDDI.&n; */
DECL|function|apfddi_xmit
r_static
r_int
id|apfddi_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;In apfddi_xmit&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;     * Check there is some work to do.&n;     */
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
op_logical_or
id|dev
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#if APFDDI_DEBUG
id|printk
c_func
(paren
l_string|&quot;skb address is for apfddi 0x%x&bslash;n&quot;
comma
id|skb
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;     * Check lock variable.&n;     */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;tbusy
op_ne
l_int|0
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;apfddi_xmit: device busy&bslash;n&quot;
)paren
suffix:semicolon
id|apfddi_stats-&gt;tx_errors
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/*&n;     * Append packet onto send queue.&n;     */
r_if
c_cond
(paren
id|mac_queue_append
c_func
(paren
id|skb
)paren
)paren
(brace
multiline_comment|/*&n;&t; * No memory.&n;&t; */
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;     * Process packet queue.&n;     */
id|mac_process
c_func
(paren
)paren
suffix:semicolon
id|apfddi_stats-&gt;tx_packets
op_increment
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if APFDDI_DEBUG
DECL|function|print_mbuf
r_void
id|print_mbuf
c_func
(paren
r_struct
id|mac_buf
op_star
id|mbuf
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mac %p length=%d ptr=%p wraplen=%d wrapptr=%x fr_start=%d fr_end=%d&bslash;n&quot;
comma
id|mbuf
comma
id|mbuf-&gt;length
comma
id|mbuf-&gt;ptr
comma
id|mbuf-&gt;wraplen
comma
id|mbuf-&gt;wrapptr
comma
id|mbuf-&gt;fr_start
comma
id|mbuf-&gt;fr_end
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Return statistics of fddi driver.&n; */
DECL|function|apfddi_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|apfddi_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_return
(paren
r_struct
id|net_device_stats
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
)brace
eof
