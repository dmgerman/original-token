multiline_comment|/*&n; *  drivers/s390/net/ctc.c &n; *    CTC / ESCON network driver&n; *&n; *  S390 version&n; *    Copyright (C) 1999 IBM Deutschland Entwicklung GmbH, IBM Corporation&n; *    Author(s): Dieter Wellerdiek (wel@de.ibm.com)&n; *&n; *     2.3 Updates Martin Schwidefsky (schwidefsky@de.ibm.com)&n; *                 Denis Joseph Barrow (djbarrow@de.ibm.com,barrow_dj@yahoo.com)&n; *&n; *&n; *  Description of the Kernel Parameter&n; *    Normally the CTC driver selects the channels in order (automatic channel &n; *    selection). If your installation needs to use the channels in a different &n; *    order or doesn&squot;t want to have automatic channel selection on, you can do &n; *    this with the &quot;ctc= kernel keyword&quot;. &n; *&n; *       ctc=0,0xrrrr,0xwwww,ddddd&n; *&n; *     Where:&n; *&n; *       &quot;rrrr&quot; is the read channel address&n; *       &quot;wwww&quot; is the write channel address&n; *       &quot;dddd&quot; is the network device (ctc0 to ctc7 for a parallel channel, escon0&n; *              to escon7 for ESCON channels).&n; *&n; *     To switch the automatic channel selection off use the ctc= keyword with &n; *     parameter &quot;noauto&quot;. This may be necessary if you 3271 devices or other devices &n; *     which use the ctc device type and model, but operate with a different protocol. &n; *     &n; *       ctc=noauto&n; *&n; *  Change History&n; *    0.50  Initial release shipped&n; *    0.51  Bug fixes&n; *          - CTC / ESCON network device can now handle up to 64 channels &n; *          - 3088-61 info message supperssed - CISCO 7206 - CLAW - ESCON &n; *          - 3088-62 info message suppressed - OSA/D   &n; *          - channel: def ffffffed ... error message suppressed &n; *          - CTC / ESCON device was not recoverable after a lost connection with &n; *            IFCONFIG dev DOWN and IFCONFIG dev UP &n; *          - Possibility to switch the automatic selection off&n; *          - Minor bug fixes &n; */
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
singleline_comment|//#define DEBUG 
multiline_comment|/* Redefine message level, so that all messages occur on 3215 console in DEBUG mode */
macro_line|#ifdef DEBUG                
DECL|macro|KERN_INFO
macro_line|#undef  KERN_INFO
DECL|macro|KERN_WARNING
macro_line|#undef  KERN_WARNING
DECL|macro|KERN_DEBUG
macro_line|#undef  KERN_DEBUG
DECL|macro|KERN_INFO
mdefine_line|#define KERN_INFO    KERN_EMERG
DECL|macro|KERN_WARNING
mdefine_line|#define KERN_WARNING KERN_EMERG
DECL|macro|KERN_DEBUG
mdefine_line|#define KERN_DEBUG   KERN_EMERG
macro_line|#endif  
singleline_comment|//#undef DEBUG
DECL|macro|CCW_CMD_WRITE
mdefine_line|#define CCW_CMD_WRITE           0x01
DECL|macro|CCW_CMD_READ
mdefine_line|#define CCW_CMD_READ            0x02
DECL|macro|CCW_CMD_SET_EXTENDED
mdefine_line|#define CCW_CMD_SET_EXTENDED    0xc3
DECL|macro|CCW_CMD_PREPARE
mdefine_line|#define CCW_CMD_PREPARE         0xe3
DECL|macro|MAX_CHANNEL_DEVICES
mdefine_line|#define MAX_CHANNEL_DEVICES     64 
DECL|macro|MAX_ADAPTERS
mdefine_line|#define MAX_ADAPTERS            8
DECL|macro|CTC_DEFAULT_MTU_SIZE
mdefine_line|#define CTC_DEFAULT_MTU_SIZE    1500
DECL|macro|READ
mdefine_line|#define READ                    0
DECL|macro|WRITE
mdefine_line|#define WRITE                   1
DECL|macro|CTC
mdefine_line|#define CTC                     0
DECL|macro|ESCON
mdefine_line|#define ESCON                   1
DECL|macro|CHANNEL_MEDIA
mdefine_line|#define CHANNEL_MEDIA           2
DECL|macro|CTC_BLOCKS
mdefine_line|#define CTC_BLOCKS              8          /* 8 blocks * 2 times * 64k = 1M */
DECL|macro|TB_TX
mdefine_line|#define TB_TX                   0          /* sk buffer handling in process */
DECL|macro|TB_STOP
mdefine_line|#define TB_STOP                 1          /* network device stop in process */
DECL|macro|TB_RETRY
mdefine_line|#define TB_RETRY                2          /* retry in process */
DECL|macro|TB_NOBUFFER
mdefine_line|#define TB_NOBUFFER             3          /* no buffer on free queue */ 
multiline_comment|/* state machine codes used in ctc_irq_handler */
DECL|macro|CTC_STOP
mdefine_line|#define CTC_STOP                0
DECL|macro|CTC_START_HALT_IO
mdefine_line|#define CTC_START_HALT_IO       1
DECL|macro|CTC_START_SET_X_MODE
mdefine_line|#define CTC_START_SET_X_MODE    2
DECL|macro|CTC_START_SELECT
mdefine_line|#define CTC_START_SELECT        4 
DECL|macro|CTC_START_READ_TEST
mdefine_line|#define CTC_START_READ_TEST     32
DECL|macro|CTC_START_READ
mdefine_line|#define CTC_START_READ          33
DECL|macro|CTC_START_WRITE_TEST
mdefine_line|#define CTC_START_WRITE_TEST    64
DECL|macro|CTC_START_WRITE
mdefine_line|#define CTC_START_WRITE         65
r_typedef
r_enum
(brace
DECL|enumerator|channel_type_none
id|channel_type_none
comma
multiline_comment|/* Device is not a channel */
DECL|enumerator|channel_type_undefined
id|channel_type_undefined
comma
multiline_comment|/* Device is a channel but we don&squot;t know anything about it */
DECL|enumerator|channel_type_ctca
id|channel_type_ctca
comma
multiline_comment|/* Device is a CTC/A and we can deal with it */
DECL|enumerator|channel_type_escon
id|channel_type_escon
comma
multiline_comment|/* Device is a ESCON channel and we can deal with it */
DECL|enumerator|channel_type_unsupported
id|channel_type_unsupported
multiline_comment|/* Device is a unsupported model */
DECL|typedef|channel_type_t
)brace
id|channel_type_t
suffix:semicolon
multiline_comment|/* &n; *   Structures needed in the initial phase &n; *&n; */
DECL|variable|channel_tab_initialized
r_static
r_int
id|channel_tab_initialized
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* channel[] structure initialized */
DECL|struct|devicelist
r_struct
id|devicelist
(brace
DECL|member|devno
r_int
r_int
id|devno
suffix:semicolon
DECL|member|flag
id|__u8
id|flag
suffix:semicolon
DECL|macro|CHANNEL_IN_USE
mdefine_line|#define CHANNEL_IN_USE   0x08               /* - Show that channel is in use */
)brace
suffix:semicolon
r_static
r_struct
(brace
DECL|member|list
r_struct
id|devicelist
id|list
(braket
id|MAX_CHANNEL_DEVICES
)braket
suffix:semicolon
DECL|member|count
r_int
id|count
suffix:semicolon
DECL|member|left
r_int
id|left
suffix:semicolon
DECL|variable|channel
)brace
id|channel
(braket
id|CHANNEL_MEDIA
)braket
suffix:semicolon
DECL|variable|ctc_no_auto
r_static
r_int
id|ctc_no_auto
op_assign
l_int|0
suffix:semicolon
DECL|struct|adapterlist
r_struct
id|adapterlist
(brace
DECL|member|devno
r_int
r_int
id|devno
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|protocol
id|__u16
id|protocol
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|ctc_adapter
r_static
r_struct
id|adapterlist
id|ctc_adapter
(braket
id|CHANNEL_MEDIA
)braket
(braket
id|MAX_ADAPTERS
)braket
suffix:semicolon
multiline_comment|/* 0 = CTC  / 1 = ESCON */
multiline_comment|/* &n; *   Structure used after the initial phase &n; *&n; */
DECL|struct|buffer
r_struct
id|buffer
(brace
DECL|member|next
r_struct
id|buffer
op_star
id|next
suffix:semicolon
DECL|member|packets
r_int
id|packets
suffix:semicolon
DECL|member|block
r_struct
id|block
op_star
id|block
suffix:semicolon
)brace
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE&gt;=0x020300
DECL|typedef|net_device
r_typedef
r_struct
id|net_device
id|net_device
suffix:semicolon
macro_line|#else
DECL|typedef|net_device
r_typedef
r_struct
id|device
id|net_device
suffix:semicolon
DECL|typedef|wait_queue_head_t
r_typedef
r_struct
id|wait_queue
op_star
id|wait_queue_head_t
suffix:semicolon
DECL|macro|DECLARE_WAITQUEUE
mdefine_line|#define DECLARE_WAITQUEUE(waitqname,waitqtask) struct wait_queue  waitqname = {waitqtask, NULL }
DECL|macro|init_waitqueue_head
mdefine_line|#define init_waitqueue_head(nothing)
macro_line|#endif
DECL|struct|channel
r_struct
id|channel
(brace
DECL|member|devno
r_int
r_int
id|devno
suffix:semicolon
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|IO_active
r_int
r_int
id|IO_active
suffix:semicolon
DECL|member|ccw
id|ccw1_t
id|ccw
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|state
id|__u32
id|state
suffix:semicolon
DECL|member|buffer_count
r_int
id|buffer_count
suffix:semicolon
DECL|member|free_anchor
r_struct
id|buffer
op_star
id|free_anchor
suffix:semicolon
DECL|member|proc_anchor
r_struct
id|buffer
op_star
id|proc_anchor
suffix:semicolon
DECL|member|devstat
id|devstat_t
op_star
id|devstat
suffix:semicolon
DECL|member|dev
id|net_device
op_star
id|dev
suffix:semicolon
multiline_comment|/* backward pointer to the network device */
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
DECL|member|tq
r_struct
id|tq_struct
id|tq
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
DECL|member|flag_a
r_int
r_int
id|flag_a
suffix:semicolon
multiline_comment|/* atomic flags */
DECL|macro|CTC_BH_ACTIVE
mdefine_line|#define CTC_BH_ACTIVE       0   
DECL|member|last_dstat
id|__u8
id|last_dstat
suffix:semicolon
DECL|member|flag
id|__u8
id|flag
suffix:semicolon
DECL|macro|CTC_WRITE
mdefine_line|#define CTC_WRITE            0x01      /* - Set if this is a write channel */
DECL|macro|CTC_TIMER
mdefine_line|#define CTC_TIMER            0x80      /* - Set if timer made the wake_up  */ 
)brace
suffix:semicolon
DECL|struct|ctc_priv
r_struct
id|ctc_priv
(brace
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE&gt;=0x02032D
DECL|member|tbusy
r_int
id|tbusy
suffix:semicolon
macro_line|#endif
DECL|member|channel
r_struct
id|channel
id|channel
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|protocol
id|__u16
id|protocol
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; *   This structure works as shuttle between two systems &n; *    - A block can contain one or more packets &n; */
DECL|macro|PACKET_HEADER_LENGTH
mdefine_line|#define PACKET_HEADER_LENGTH  6
DECL|struct|packet
r_struct
id|packet
(brace
DECL|member|length
id|__u16
id|length
suffix:semicolon
DECL|member|type
id|__u16
id|type
suffix:semicolon
DECL|member|unused
id|__u16
id|unused
suffix:semicolon
DECL|member|data
id|__u8
id|data
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|BLOCK_HEADER_LENGTH
mdefine_line|#define BLOCK_HEADER_LENGTH   2
DECL|struct|block
r_struct
id|block
(brace
DECL|member|length
id|__u16
id|length
suffix:semicolon
DECL|member|data
r_struct
id|packet
id|data
suffix:semicolon
)brace
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE&gt;=0x02032D
DECL|macro|ctc_protect_busy
mdefine_line|#define ctc_protect_busy(dev) &bslash;&n;s390irq_spin_lock(((struct ctc_priv *)dev-&gt;priv)-&gt;channel[WRITE].irq)
DECL|macro|ctc_unprotect_busy
mdefine_line|#define ctc_unprotect_busy(dev) &bslash;&n;s390irq_spin_unlock(((struct ctc_priv *)dev-&gt;priv)-&gt;channel[WRITE].irq)
DECL|macro|ctc_protect_busy_irqsave
mdefine_line|#define ctc_protect_busy_irqsave(dev,flags) &bslash;&n;s390irq_spin_lock_irqsave(((struct ctc_priv *)dev-&gt;priv)-&gt;channel[WRITE].irq,flags)
DECL|macro|ctc_unprotect_busy_irqrestore
mdefine_line|#define ctc_unprotect_busy_irqrestore(dev,flags) &bslash;&n;s390irq_spin_unlock_irqrestore(((struct ctc_priv *)dev-&gt;priv)-&gt;channel[WRITE].irq,flags)
DECL|function|ctc_set_busy
r_static
id|__inline__
r_void
id|ctc_set_busy
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
(paren
(paren
r_struct
id|ctc_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tbusy
op_assign
l_int|1
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|ctc_clear_busy
r_static
id|__inline__
r_void
id|ctc_clear_busy
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
(paren
(paren
r_struct
id|ctc_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tbusy
op_assign
l_int|0
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|ctc_check_busy
r_static
id|__inline__
r_int
id|ctc_check_busy
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|eieio
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
(paren
r_struct
id|ctc_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tbusy
suffix:semicolon
)brace
DECL|function|ctc_setbit_busy
r_static
id|__inline__
r_void
id|ctc_setbit_busy
c_func
(paren
r_int
id|nr
comma
id|net_device
op_star
id|dev
)paren
(brace
id|set_bit
c_func
(paren
id|nr
comma
op_amp
(paren
(paren
(paren
r_struct
id|ctc_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tbusy
)paren
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|ctc_clearbit_busy
r_static
id|__inline__
r_void
id|ctc_clearbit_busy
c_func
(paren
r_int
id|nr
comma
id|net_device
op_star
id|dev
)paren
(brace
id|clear_bit
c_func
(paren
id|nr
comma
op_amp
(paren
(paren
(paren
r_struct
id|ctc_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tbusy
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
r_struct
id|ctc_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tbusy
op_eq
l_int|0
)paren
(brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|ctc_test_and_setbit_busy
r_static
id|__inline__
r_int
id|ctc_test_and_setbit_busy
c_func
(paren
r_int
id|nr
comma
id|net_device
op_star
id|dev
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|test_and_set_bit
c_func
(paren
id|nr
comma
op_amp
(paren
(paren
r_struct
id|ctc_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tbusy
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|macro|ctc_protect_busy
mdefine_line|#define ctc_protect_busy(dev)
DECL|macro|ctc_unprotect_busy
mdefine_line|#define ctc_unprotect_busy(dev)
DECL|macro|ctc_protect_busy_irqsave
mdefine_line|#define ctc_protect_busy_irqsave(dev,flags)
DECL|macro|ctc_unprotect_busy_irqrestore
mdefine_line|#define ctc_unprotect_busy_irqrestore(dev,flags)
DECL|function|ctc_set_busy
r_static
id|__inline__
r_void
id|ctc_set_busy
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ctc_clear_busy
r_static
id|__inline__
r_void
id|ctc_clear_busy
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|eieio
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ctc_check_busy
r_static
id|__inline__
r_int
id|ctc_check_busy
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|eieio
c_func
(paren
)paren
suffix:semicolon
r_return
id|dev-&gt;tbusy
suffix:semicolon
)brace
DECL|function|ctc_setbit_busy
r_static
id|__inline__
r_void
id|ctc_setbit_busy
c_func
(paren
r_int
id|nr
comma
id|net_device
op_star
id|dev
)paren
(brace
id|set_bit
c_func
(paren
id|nr
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
suffix:semicolon
)brace
DECL|function|ctc_clearbit_busy
r_static
id|__inline__
r_void
id|ctc_clearbit_busy
c_func
(paren
r_int
id|nr
comma
id|net_device
op_star
id|dev
)paren
(brace
id|clear_bit
c_func
(paren
id|nr
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
suffix:semicolon
)brace
DECL|function|ctc_test_and_setbit_busy
r_static
id|__inline__
r_int
id|ctc_test_and_setbit_busy
c_func
(paren
r_int
id|nr
comma
id|net_device
op_star
id|dev
)paren
(brace
r_return
id|test_and_set_bit
c_func
(paren
id|nr
comma
(paren
r_void
op_star
)paren
op_amp
id|dev-&gt;tbusy
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Interrupt handler */
r_static
r_void
id|ctc_irq_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|initparm
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|ctc_irq_bh
c_func
(paren
r_struct
id|channel
op_star
id|ctc
)paren
suffix:semicolon
r_static
r_void
id|ctc_read_retry
(paren
r_struct
id|channel
op_star
id|ctc
)paren
suffix:semicolon
r_static
r_void
id|ctc_write_retry
(paren
r_struct
id|channel
op_star
id|ctc
)paren
suffix:semicolon
multiline_comment|/* Functions for the DEV methods */
r_int
id|ctc_probe
c_func
(paren
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ctc_open
c_func
(paren
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|ctc_timer
(paren
r_struct
id|channel
op_star
id|ctc
)paren
suffix:semicolon
r_static
r_int
id|ctc_release
c_func
(paren
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ctc_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ctc_change_mtu
c_func
(paren
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|ctc_stats
c_func
(paren
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/*&n; *   Channel Routines &n; *&n; */
r_static
r_void
id|channel_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|channel_scan
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|channel_get
c_func
(paren
r_int
id|media
comma
r_int
id|devno
)paren
suffix:semicolon
r_static
r_int
id|channel_get_next
c_func
(paren
r_int
id|media
)paren
suffix:semicolon
r_static
r_int
id|channel_free
c_func
(paren
r_int
id|media
comma
r_int
id|devno
)paren
suffix:semicolon
r_static
id|channel_type_t
id|channel_check_for_type
(paren
id|senseid_t
op_star
id|id
)paren
suffix:semicolon
r_static
r_void
id|channel_sort
c_func
(paren
r_struct
id|devicelist
id|list
(braket
)braket
comma
r_int
id|n
)paren
suffix:semicolon
multiline_comment|/*&n; * initialize the channel[].list &n; */
DECL|function|channel_init
r_static
r_void
id|channel_init
c_func
(paren
r_void
)paren
(brace
r_int
id|m
suffix:semicolon
macro_line|#ifdef DEBUG
r_int
id|c
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|channel_tab_initialized
)paren
)paren
(brace
id|channel_scan
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|m
op_assign
l_int|0
suffix:semicolon
id|m
OL
id|CHANNEL_MEDIA
suffix:semicolon
id|m
op_increment
)paren
(brace
id|channel_sort
(paren
id|channel
(braket
id|m
)braket
dot
id|list
comma
id|MAX_CHANNEL_DEVICES
)paren
suffix:semicolon
id|channel
(braket
id|m
)braket
dot
id|left
op_assign
id|channel
(braket
id|m
)braket
dot
id|count
suffix:semicolon
)brace
r_if
c_cond
(paren
id|channel
(braket
id|CTC
)braket
dot
id|count
op_eq
l_int|0
op_logical_and
id|channel
(braket
id|ESCON
)braket
dot
id|count
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;channel: no Channel devices recognized&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;channel: %d Parallel channel found - %d ESCON channel found&bslash;n&quot;
comma
id|channel
(braket
id|CTC
)braket
dot
id|count
comma
id|channel
(braket
id|ESCON
)braket
dot
id|count
)paren
suffix:semicolon
macro_line|#ifdef DEBUG 
r_for
c_loop
(paren
id|m
op_assign
l_int|0
suffix:semicolon
id|m
OL
id|CHANNEL_MEDIA
suffix:semicolon
id|m
op_increment
)paren
(brace
r_for
c_loop
(paren
id|c
op_assign
l_int|0
suffix:semicolon
id|c
OL
id|MAX_CHANNEL_DEVICES
suffix:semicolon
id|c
op_increment
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;channel: Adapter=%x Entry=%x devno=%04x&bslash;n&quot;
comma
id|m
comma
id|c
comma
id|channel
(braket
id|m
)braket
dot
id|list
(braket
id|c
)braket
dot
id|devno
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
)brace
multiline_comment|/*&n;* scan for all channels and put the device numbers into the channel[].list &n;*/
DECL|function|channel_scan
r_static
r_void
id|channel_scan
c_func
(paren
r_void
)paren
(brace
r_int
id|m
suffix:semicolon
r_int
id|c
suffix:semicolon
r_int
id|irq
suffix:semicolon
id|dev_info_t
id|temp
suffix:semicolon
r_for
c_loop
(paren
id|m
op_assign
l_int|0
suffix:semicolon
id|m
OL
id|CHANNEL_MEDIA
suffix:semicolon
id|m
op_increment
)paren
(brace
r_for
c_loop
(paren
id|c
op_assign
l_int|0
suffix:semicolon
id|c
OL
id|MAX_CHANNEL_DEVICES
suffix:semicolon
id|c
op_increment
)paren
(brace
id|channel
(braket
id|m
)braket
dot
id|list
(braket
id|c
)braket
dot
id|devno
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|irq
op_assign
l_int|0
suffix:semicolon
id|irq
OL
id|NR_IRQS
suffix:semicolon
id|irq
op_increment
)paren
(brace
multiline_comment|/* CTC/A */
r_if
c_cond
(paren
id|channel
(braket
id|CTC
)braket
dot
id|count
OL
id|MAX_CHANNEL_DEVICES
)paren
(brace
r_if
c_cond
(paren
id|get_dev_info
c_func
(paren
id|irq
comma
op_amp
id|temp
)paren
op_eq
l_int|0
op_logical_and
id|channel_check_for_type
c_func
(paren
op_amp
id|temp.sid_data
)paren
op_eq
id|channel_type_ctca
)paren
(brace
id|channel
(braket
id|CTC
)braket
dot
id|list
(braket
id|channel
(braket
id|CTC
)braket
dot
id|count
)braket
dot
id|devno
op_assign
id|temp.devno
suffix:semicolon
id|channel
(braket
id|CTC
)braket
dot
id|count
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/* ESCON */
r_if
c_cond
(paren
id|channel
(braket
id|ESCON
)braket
dot
id|count
OL
id|MAX_CHANNEL_DEVICES
)paren
(brace
r_if
c_cond
(paren
id|get_dev_info
c_func
(paren
id|irq
comma
op_amp
id|temp
)paren
op_eq
l_int|0
op_logical_and
id|channel_check_for_type
c_func
(paren
op_amp
id|temp.sid_data
)paren
op_eq
id|channel_type_escon
)paren
(brace
id|channel
(braket
id|ESCON
)braket
dot
id|list
(braket
id|channel
(braket
id|ESCON
)braket
dot
id|count
)braket
dot
id|devno
op_assign
id|temp.devno
suffix:semicolon
id|channel
(braket
id|ESCON
)braket
dot
id|count
op_increment
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/*&n; * free specific channel from the channel[].list &n; */
DECL|function|channel_free
r_static
r_int
id|channel_free
c_func
(paren
r_int
id|media
comma
r_int
id|devno
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|channel
(braket
id|media
)braket
dot
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|devno
op_eq
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|devno
)paren
op_logical_and
(paren
(paren
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|flag
op_amp
id|CHANNEL_IN_USE
)paren
op_ne
l_int|0x00
)paren
)paren
(brace
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|flag
op_and_assign
op_complement
id|CHANNEL_IN_USE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;channel: dev %04x is not a channel or in use&bslash;n&quot;
comma
id|devno
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n; * get specific channel from the channel[].list &n; */
DECL|function|channel_get
r_static
r_int
id|channel_get
c_func
(paren
r_int
id|media
comma
r_int
id|devno
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|channel
(braket
id|media
)braket
dot
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|devno
op_eq
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|devno
)paren
op_logical_and
(paren
(paren
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|flag
op_amp
id|CHANNEL_IN_USE
)paren
op_eq
l_int|0x00
)paren
)paren
(brace
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|flag
op_or_assign
id|CHANNEL_IN_USE
suffix:semicolon
r_return
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|devno
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;channel: dev %04x is not a channel or in use&bslash;n&quot;
comma
id|devno
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n; * get the next free channel from the channel[].list &n; */
DECL|function|channel_get_next
r_static
r_int
id|channel_get_next
c_func
(paren
r_int
id|media
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|channel
(braket
id|media
)braket
dot
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|flag
op_amp
id|CHANNEL_IN_USE
)paren
op_eq
l_int|0x00
)paren
(brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;channel: picked=%04x&bslash;n&quot;
comma
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|devno
)paren
suffix:semicolon
macro_line|#endif
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|flag
op_or_assign
id|CHANNEL_IN_USE
suffix:semicolon
r_return
id|channel
(braket
id|media
)braket
dot
id|list
(braket
id|i
)braket
dot
id|devno
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n; * picks the next free channel from the channel[].list &n; */
DECL|function|channel_left
r_static
r_int
id|channel_left
c_func
(paren
r_int
id|media
)paren
(brace
r_return
id|channel
(braket
id|media
)braket
dot
id|left
suffix:semicolon
)brace
multiline_comment|/*&n; * defines all devices which are channels&n; */
DECL|function|channel_check_for_type
r_static
id|channel_type_t
id|channel_check_for_type
(paren
id|senseid_t
op_star
id|id
)paren
(brace
id|channel_type_t
id|type
suffix:semicolon
r_switch
c_cond
(paren
id|id-&gt;cu_type
)paren
(brace
r_case
l_int|0x3088
suffix:colon
r_switch
c_cond
(paren
id|id-&gt;cu_model
)paren
(brace
r_case
l_int|0x08
suffix:colon
id|type
op_assign
id|channel_type_ctca
suffix:semicolon
multiline_comment|/* 3088-08  ==&gt; CTCA */
r_break
suffix:semicolon
r_case
l_int|0x1F
suffix:colon
id|type
op_assign
id|channel_type_escon
suffix:semicolon
multiline_comment|/* 3088-1F  ==&gt; ESCON channel */
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
multiline_comment|/* 3088-01  ==&gt; P390 OSA emulation */
r_case
l_int|0x60
suffix:colon
multiline_comment|/* 3088-60  ==&gt; OSA/2 adapter */
r_case
l_int|0x61
suffix:colon
multiline_comment|/* 3088-61  ==&gt; CISCO 7206 CLAW protocol ESCON connected */
r_case
l_int|0x62
suffix:colon
multiline_comment|/* 3088-62  ==&gt; OSA/D device */
id|type
op_assign
id|channel_type_unsupported
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|type
op_assign
id|channel_type_undefined
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;channel: Unknown model found 3088-%02x&bslash;n&quot;
comma
id|id-&gt;cu_model
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|type
op_assign
id|channel_type_none
suffix:semicolon
)brace
r_return
id|type
suffix:semicolon
)brace
multiline_comment|/*&n; *  sort the channel[].list&n; */
DECL|function|channel_sort
r_static
r_void
id|channel_sort
c_func
(paren
r_struct
id|devicelist
id|list
(braket
)braket
comma
r_int
id|n
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|sorted
op_assign
l_int|0
suffix:semicolon
r_struct
id|devicelist
id|tmp
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|sorted
)paren
(brace
id|sorted
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|list
(braket
id|i
)braket
dot
id|devno
OG
id|list
(braket
id|i
op_plus
l_int|1
)braket
dot
id|devno
)paren
(brace
id|tmp
op_assign
id|list
(braket
id|i
)braket
suffix:semicolon
id|list
(braket
id|i
)braket
op_assign
id|list
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|list
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|tmp
suffix:semicolon
id|sorted
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/*&n; *   General routines &n; *&n; */
DECL|function|extract_channel_id
r_static
r_int
r_inline
id|extract_channel_id
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_if
c_cond
(paren
id|name
(braket
l_int|0
)braket
op_eq
l_char|&squot;c&squot;
)paren
r_return
(paren
id|name
(braket
l_int|3
)braket
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
r_else
r_return
(paren
id|name
(braket
l_int|5
)braket
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
)brace
DECL|function|extract_channel_media
r_static
r_int
r_inline
id|extract_channel_media
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_if
c_cond
(paren
id|name
(braket
l_int|0
)braket
op_eq
l_char|&squot;c&squot;
)paren
r_return
id|CTC
suffix:semicolon
r_else
r_return
id|ESCON
suffix:semicolon
)brace
DECL|function|ctc_tab_init
r_static
r_void
id|ctc_tab_init
c_func
(paren
r_void
)paren
(brace
r_int
id|m
suffix:semicolon
r_int
id|i
suffix:semicolon
r_static
r_int
id|t
suffix:semicolon
r_if
c_cond
(paren
id|t
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|m
op_assign
l_int|0
suffix:semicolon
id|m
OL
id|CHANNEL_MEDIA
suffix:semicolon
id|m
op_increment
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_ADAPTERS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|WRITE
)braket
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|READ
)braket
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
id|t
op_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|ctc_buffer_alloc
r_static
r_int
id|ctc_buffer_alloc
c_func
(paren
r_struct
id|channel
op_star
id|ctc
)paren
(brace
r_struct
id|buffer
op_star
id|p
suffix:semicolon
r_struct
id|buffer
op_star
id|q
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|p
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_else
(brace
id|p-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|p-&gt;packets
op_assign
l_int|0
suffix:semicolon
id|p-&gt;block
op_assign
(paren
r_struct
id|block
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
op_plus
id|GFP_DMA
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;block
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ctc-&gt;free_anchor
op_eq
l_int|NULL
)paren
id|ctc-&gt;free_anchor
op_assign
id|p
suffix:semicolon
r_else
(brace
id|q
op_assign
id|ctc-&gt;free_anchor
suffix:semicolon
r_while
c_loop
(paren
id|q-&gt;next
op_ne
l_int|NULL
)paren
id|q
op_assign
id|q-&gt;next
suffix:semicolon
id|q-&gt;next
op_assign
id|p
suffix:semicolon
)brace
id|ctc-&gt;buffer_count
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ctc_buffer_free
r_static
r_int
id|ctc_buffer_free
c_func
(paren
r_struct
id|channel
op_star
id|ctc
)paren
(brace
r_struct
id|buffer
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|ctc-&gt;free_anchor
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|p
op_assign
id|ctc-&gt;free_anchor
suffix:semicolon
id|ctc-&gt;free_anchor
op_assign
id|p-&gt;next
suffix:semicolon
id|free_pages
c_func
(paren
(paren
id|__u32
)paren
id|p-&gt;block
comma
l_int|4
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ctc_buffer_swap
r_static
r_int
r_inline
id|ctc_buffer_swap
c_func
(paren
r_struct
id|buffer
op_star
op_star
id|from
comma
r_struct
id|buffer
op_star
op_star
id|to
)paren
(brace
r_struct
id|buffer
op_star
id|p
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|buffer
op_star
id|q
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_star
id|from
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|p
op_assign
op_star
id|from
suffix:semicolon
op_star
id|from
op_assign
id|p-&gt;next
suffix:semicolon
id|p-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_star
id|to
op_eq
l_int|NULL
)paren
op_star
id|to
op_assign
id|p
suffix:semicolon
r_else
(brace
id|q
op_assign
op_star
id|to
suffix:semicolon
r_while
c_loop
(paren
id|q-&gt;next
op_ne
l_int|NULL
)paren
id|q
op_assign
id|q-&gt;next
suffix:semicolon
id|q-&gt;next
op_assign
id|p
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *   ctc_setup function &n; *     this function is called for each ctc= keyword passed into the kernel &n; *&n; *     valid parameter are: ctc=n,0xnnnn,0xnnnn,ctcx &n; *     where n      is the channel protocol always 0 &n; *           0xnnnn is the cu number  read &n; *           0xnnnn is the cu number  write &n; *           ctcx can be ctc0 to ctc7 or escon0 to escon7 &n; */
macro_line|#if LINUX_VERSION_CODE&gt;=0x020300
DECL|function|ctc_setup
r_static
r_int
id|__init
id|ctc_setup
c_func
(paren
r_char
op_star
id|dev_name
)paren
macro_line|#else
id|__initfunc
c_func
(paren
r_void
id|ctc_setup
c_func
(paren
r_char
op_star
id|dev_name
comma
r_int
op_star
id|ints
)paren
)paren
macro_line|#endif
(brace
r_struct
id|adapterlist
id|tmp
suffix:semicolon
macro_line|#if  LINUX_VERSION_CODE&gt;=0x020300
DECL|macro|CTC_MAX_PARMS
mdefine_line|#define CTC_MAX_PARMS 4
r_int
id|ints
(braket
id|CTC_MAX_PARMS
op_plus
l_int|1
)braket
suffix:semicolon
id|get_options
c_func
(paren
id|dev_name
comma
id|CTC_MAX_PARMS
comma
id|ints
)paren
suffix:semicolon
DECL|macro|ctc_setup_return
mdefine_line|#define ctc_setup_return return(1)
macro_line|#else
mdefine_line|#define ctc_setup_return return
macro_line|#endif
id|ctc_tab_init
c_func
(paren
)paren
suffix:semicolon
id|ctc_no_auto
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|dev_name
comma
l_string|&quot;noauto&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ctc: automatic channel selection deactivated&bslash;n&quot;
)paren
suffix:semicolon
id|ctc_setup_return
suffix:semicolon
)brace
id|tmp.devno
(braket
id|WRITE
)braket
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|tmp.devno
(braket
id|READ
)braket
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_switch
c_cond
(paren
id|ints
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|3
suffix:colon
multiline_comment|/* write channel passed */
id|tmp.devno
(braket
id|WRITE
)braket
op_assign
id|ints
(braket
l_int|3
)braket
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* read channel passed */
id|tmp.devno
(braket
id|READ
)braket
op_assign
id|ints
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|tmp.devno
(braket
id|WRITE
)braket
op_eq
op_minus
id|ENODEV
)paren
id|tmp.devno
(braket
id|WRITE
)braket
op_assign
id|tmp.devno
(braket
id|READ
)braket
op_plus
l_int|1
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* protocol type passed */
id|tmp.protocol
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|tmp.protocol
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: wrong Channel protocol type passed&bslash;n&quot;
comma
id|dev_name
)paren
suffix:semicolon
id|ctc_setup_return
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ctc: wrong number of parameter passed&bslash;n&quot;
)paren
suffix:semicolon
id|ctc_setup_return
suffix:semicolon
)brace
id|ctc_adapter
(braket
id|extract_channel_media
c_func
(paren
id|dev_name
)paren
)braket
(braket
id|extract_channel_id
c_func
(paren
id|dev_name
)paren
)braket
op_assign
id|tmp
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|DEBUG
l_string|&quot;%s: protocol=%x read=%04x write=%04x&bslash;n&quot;
comma
id|dev_name
comma
id|tmp.protocol
comma
id|tmp.devno
(braket
id|READ
)braket
comma
id|tmp.devno
(braket
id|WRITE
)braket
)paren
suffix:semicolon
macro_line|#endif  
id|ctc_setup_return
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE&gt;=0x020300
id|__setup
c_func
(paren
l_string|&quot;ctc=&quot;
comma
id|ctc_setup
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; *   ctc_probe &n; *      this function is called for each channel network device, &n; *      which is defined in the /init/main.c &n; */
DECL|function|ctc_probe
r_int
id|ctc_probe
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|rc
suffix:semicolon
r_int
id|c
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|m
suffix:semicolon
r_struct
id|ctc_priv
op_star
id|privptr
suffix:semicolon
multiline_comment|/* Only the first time the ctc_probe gets control */
r_if
c_cond
(paren
id|channel_tab_initialized
op_eq
l_int|0
)paren
(brace
id|channel_init
c_func
(paren
)paren
suffix:semicolon
)brace
id|ctc_tab_init
c_func
(paren
)paren
suffix:semicolon
id|m
op_assign
id|extract_channel_media
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
id|i
op_assign
id|extract_channel_id
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channel_left
c_func
(paren
id|m
)paren
op_le
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|ctc_no_auto
op_eq
l_int|1
op_logical_and
(paren
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|READ
)braket
op_eq
op_minus
id|ENODEV
op_logical_or
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|WRITE
)braket
op_eq
op_minus
id|ENODEV
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dev-&gt;priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ctc_priv
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|dev-&gt;priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ctc_priv
)paren
)paren
suffix:semicolon
id|privptr
op_assign
(paren
r_struct
id|ctc_priv
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
l_int|0
suffix:semicolon
id|c
OL
l_int|2
suffix:semicolon
id|c
op_increment
)paren
(brace
id|privptr-&gt;channel
(braket
id|c
)braket
dot
id|devstat
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|devstat_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|privptr-&gt;channel
(braket
id|c
)braket
dot
id|devstat
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|WRITE
)paren
id|kfree
c_func
(paren
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|devstat
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|privptr-&gt;channel
(braket
id|c
)braket
dot
id|devstat
comma
l_int|0
comma
r_sizeof
(paren
id|devstat_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctc_no_auto
op_eq
l_int|0
)paren
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|c
)braket
op_assign
id|channel_get_next
c_func
(paren
id|m
)paren
suffix:semicolon
r_else
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|c
)braket
op_assign
id|channel_get
c_func
(paren
id|m
comma
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|c
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|c
)braket
op_ne
op_minus
id|ENODEV
)paren
(brace
id|rc
op_assign
id|request_irq
c_func
(paren
id|get_irq_by_devno
c_func
(paren
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|c
)braket
)paren
comma
(paren
r_void
op_star
)paren
id|ctc_irq_handler
comma
id|SA_INTERRUPT
comma
id|dev-&gt;name
comma
id|privptr-&gt;channel
(braket
id|c
)braket
dot
id|devstat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: requested device busy %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rc
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|i
op_eq
id|WRITE
)paren
(brace
id|free_irq
c_func
(paren
id|get_irq_by_devno
c_func
(paren
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|c
)braket
)paren
comma
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|devstat
)paren
suffix:semicolon
id|channel_free
c_func
(paren
id|m
comma
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|READ
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|devstat
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|devstat
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|devno
op_assign
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|READ
)braket
suffix:semicolon
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|irq
op_assign
id|get_irq_by_devno
c_func
(paren
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|READ
)braket
)paren
suffix:semicolon
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|devno
op_assign
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|WRITE
)braket
suffix:semicolon
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|irq
op_assign
id|get_irq_by_devno
c_func
(paren
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|devno
(braket
id|WRITE
)braket
)paren
suffix:semicolon
id|privptr-&gt;protocol
op_assign
id|ctc_adapter
(braket
id|m
)braket
(braket
id|i
)braket
dot
id|protocol
suffix:semicolon
id|channel
(braket
id|m
)braket
dot
id|left
op_assign
id|channel
(braket
id|m
)braket
dot
id|left
op_minus
l_int|2
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: read dev: %04x irq: %04x - write dev: %04x irq: %04x &bslash;n&quot;
comma
id|dev-&gt;name
comma
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|devno
comma
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|irq
comma
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|devno
comma
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|irq
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|CTC_DEFAULT_MTU_SIZE
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|ctc_tx
suffix:semicolon
id|dev-&gt;open
op_assign
id|ctc_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|ctc_release
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|ctc_stats
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|ctc_change_mtu
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;addr_len
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_SLIP
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
l_int|100
suffix:semicolon
id|dev_init_buffers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;flags
op_assign
id|IFF_POINTOPOINT
op_or
id|IFF_NOARP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *   Interrupt processing &n; *&n; */
DECL|function|ccw_check_return_code
r_static
r_void
r_inline
id|ccw_check_return_code
(paren
id|net_device
op_star
id|dev
comma
r_int
id|return_code
)paren
(brace
r_if
c_cond
(paren
id|return_code
op_ne
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|return_code
)paren
(brace
r_case
op_minus
id|EBUSY
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Busy !&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
op_minus
id|ENODEV
suffix:colon
id|printk
c_func
(paren
id|KERN_EMERG
l_string|&quot;%s: Invalid device called for IO&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
op_minus
id|EIO
suffix:colon
id|printk
c_func
(paren
id|KERN_EMERG
l_string|&quot;%s: Status pending... &bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_EMERG
l_string|&quot;%s: Unknown error in Do_IO %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|return_code
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|ccw_check_unit_check
r_static
r_void
r_inline
id|ccw_check_unit_check
(paren
id|net_device
op_star
id|dev
comma
r_char
id|sense
)paren
(brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Unit Check with sense code: %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|sense
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|sense
op_amp
l_int|0x40
)paren
(brace
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|sense
op_amp
l_int|0x01
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Interface disconnect or Selective reset occurred (remote side)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: System reset occured (remote side)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
id|sense
op_amp
l_int|0x20
)paren
(brace
r_if
c_cond
(paren
id|sense
op_amp
l_int|0x04
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Data-streaming timeout)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Data-transfer parity error&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sense
op_amp
l_int|0x10
)paren
(brace
r_if
c_cond
(paren
id|sense
op_amp
l_int|0x20
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Hardware malfunction (remote side)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Read-data parity error (remote side)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
DECL|function|ctc_irq_handler
r_static
r_void
id|ctc_irq_handler
(paren
r_int
id|irq
comma
r_void
op_star
id|initparm
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|__u32
id|parm
suffix:semicolon
id|__u8
id|flags
op_assign
l_int|0x00
suffix:semicolon
r_struct
id|channel
op_star
id|ctc
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ctc_priv
op_star
id|privptr
op_assign
l_int|NULL
suffix:semicolon
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|ccw1_t
id|ccw_set_x_mode
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|CCW_CMD_SET_EXTENDED
comma
id|CCW_FLAG_SLI
op_or
id|CCW_FLAG_CC
comma
l_int|0
comma
l_int|NULL
)brace
comma
(brace
id|CCW_CMD_NOOP
comma
id|CCW_FLAG_SLI
comma
l_int|0
comma
l_int|NULL
)brace
)brace
suffix:semicolon
id|devstat_t
op_star
id|devstat
op_assign
(paren
(paren
id|devstat_t
op_star
)paren
id|initparm
)paren
suffix:semicolon
multiline_comment|/* Bypass all &squot;unsolited interrupts&squot; */
r_if
c_cond
(paren
id|devstat-&gt;intparm
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ctc: unsolited interrupt for device: %04x received c-%02x d-%02x f-%02x&bslash;n&quot;
comma
id|devstat-&gt;devno
comma
id|devstat-&gt;cstat
comma
id|devstat-&gt;dstat
comma
id|devstat-&gt;flag
)paren
suffix:semicolon
macro_line|#endif 
multiline_comment|/* FIXME - find the related intparm!!! No IO outstanding!!!! */
r_return
suffix:semicolon
)brace
id|ctc
op_assign
(paren
r_struct
id|channel
op_star
)paren
(paren
id|devstat-&gt;intparm
)paren
suffix:semicolon
id|dev
op_assign
(paren
id|net_device
op_star
)paren
id|ctc-&gt;dev
suffix:semicolon
id|privptr
op_assign
id|dev-&gt;priv
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: interrupt for device: %04x received c-%02x d-%02x f-%02x state-%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ctc-&gt;devno
comma
id|devstat-&gt;cstat
comma
id|devstat-&gt;dstat
comma
id|devstat-&gt;flag
comma
id|ctc-&gt;state
)paren
suffix:semicolon
macro_line|#endif 
multiline_comment|/* Check for good subchannel return code, otherwise error message */
r_if
c_cond
(paren
id|devstat-&gt;cstat
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: subchannel check for device: %04x - %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ctc-&gt;devno
comma
id|devstat-&gt;cstat
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Check the reason-code of a unit check */
r_if
c_cond
(paren
id|devstat-&gt;dstat
op_amp
id|DEV_STAT_UNIT_CHECK
)paren
id|ccw_check_unit_check
c_func
(paren
id|dev
comma
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* State machine to bring the connection up / down and to restart */
id|ctc-&gt;last_dstat
op_assign
id|devstat-&gt;dstat
suffix:semicolon
r_switch
c_cond
(paren
id|ctc-&gt;state
)paren
(brace
r_case
id|CTC_STOP
suffix:colon
multiline_comment|/* HALT_IO issued by ctc_release (halt sequence) */
r_if
c_cond
(paren
op_logical_neg
id|devstat-&gt;flag
op_amp
id|DEVSTAT_FINAL_STATUS
)paren
r_return
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|ctc-&gt;wait
)paren
suffix:semicolon
multiline_comment|/* wake up ctc_release */
r_return
suffix:semicolon
r_case
id|CTC_START_HALT_IO
suffix:colon
multiline_comment|/* HALT_IO issued by ctc_open (start sequence) */
r_if
c_cond
(paren
op_logical_neg
id|devstat-&gt;flag
op_amp
id|DEVSTAT_FINAL_STATUS
)paren
r_return
suffix:semicolon
id|ctc-&gt;state
op_assign
id|CTC_START_SET_X_MODE
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|rc
op_assign
id|do_IO
(paren
id|ctc-&gt;irq
comma
op_amp
id|ccw_set_x_mode
(braket
l_int|0
)braket
comma
id|parm
comma
l_int|0xff
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|CTC_START_SET_X_MODE
suffix:colon
r_if
c_cond
(paren
id|devstat-&gt;dstat
op_amp
id|DEV_STAT_UNIT_CHECK
)paren
(brace
r_if
c_cond
(paren
(paren
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_amp
l_int|0x41
)paren
op_ne
l_int|0x41
op_logical_or
(paren
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_amp
l_int|0x40
)paren
op_ne
l_int|0x40
)paren
(brace
id|wake_up
c_func
(paren
op_amp
id|ctc-&gt;wait
)paren
suffix:semicolon
multiline_comment|/* wake up ctc_open (READ or WRITE) */
r_return
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|devstat-&gt;flag
op_amp
id|DEVSTAT_FINAL_STATUS
)paren
r_return
suffix:semicolon
id|ctc-&gt;state
op_assign
id|CTC_START_SELECT
suffix:semicolon
r_case
id|CTC_START_SELECT
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|ctc-&gt;flag
op_amp
id|CTC_WRITE
)paren
(brace
id|ctc-&gt;state
op_assign
id|CTC_START_READ_TEST
suffix:semicolon
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
(paren
r_char
op_star
)paren
id|virt_to_phys
c_func
(paren
id|ctc-&gt;free_anchor-&gt;block
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|rc
op_assign
id|do_IO
(paren
id|ctc-&gt;irq
comma
op_amp
id|ctc-&gt;ccw
(braket
l_int|0
)braket
comma
id|parm
comma
l_int|0xff
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|ctc-&gt;wait
)paren
suffix:semicolon
multiline_comment|/* wake up ctc_open (READ) */
)brace
r_else
(brace
id|ctc-&gt;state
op_assign
id|CTC_START_WRITE_TEST
suffix:semicolon
multiline_comment|/* ADD HERE THE RIGHT PACKET TO ISSUE A ROUND TRIP - PART 1 */
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|count
op_assign
l_int|0
suffix:semicolon
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
(paren
r_char
op_star
)paren
id|virt_to_phys
c_func
(paren
id|ctc-&gt;free_anchor-&gt;block
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|rc
op_assign
id|do_IO
(paren
id|ctc-&gt;irq
comma
op_amp
id|ctc-&gt;ccw
(braket
l_int|0
)braket
comma
id|parm
comma
l_int|0xff
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
id|CTC_START_READ_TEST
suffix:colon
r_if
c_cond
(paren
id|devstat-&gt;dstat
op_amp
id|DEV_STAT_UNIT_CHECK
)paren
(brace
r_if
c_cond
(paren
(paren
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_amp
l_int|0x41
)paren
op_eq
l_int|0x41
op_logical_or
(paren
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_amp
l_int|0x40
)paren
op_eq
l_int|0x40
op_logical_or
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
(brace
id|init_timer
c_func
(paren
op_amp
id|ctc-&gt;timer
)paren
suffix:semicolon
id|ctc-&gt;timer.function
op_assign
(paren
r_void
op_star
)paren
id|ctc_read_retry
suffix:semicolon
id|ctc-&gt;timer.data
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|ctc-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ctc-&gt;timer
)paren
suffix:semicolon
macro_line|#ifdef DEBUG 
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: read connection restarted&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|devstat-&gt;dstat
op_amp
op_complement
(paren
id|DEV_STAT_CHN_END
op_or
id|DEV_STAT_DEV_END
)paren
)paren
op_ne
l_int|0x00
)paren
(brace
r_if
c_cond
(paren
(paren
id|devstat-&gt;dstat
op_amp
id|DEV_STAT_ATTENTION
)paren
op_logical_and
(paren
id|devstat-&gt;dstat
op_amp
id|DEV_STAT_BUSY
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: read channel is connected with the remote side read channel&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|wake_up
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|wait
)paren
suffix:semicolon
multiline_comment|/* wake up ctc_open (WRITE) */
r_return
suffix:semicolon
)brace
id|ctc-&gt;state
op_assign
id|CTC_START_READ
suffix:semicolon
id|set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|ctc-&gt;IO_active
)paren
suffix:semicolon
multiline_comment|/* ADD HERE THE RIGHT PACKET TO ISSUE A ROUND TRIP - PART 2 */
multiline_comment|/* wake_up(&amp;privptr-&gt;channel[WRITE].wait);*/
multiline_comment|/* wake up ctc_open (WRITE) */
r_case
id|CTC_START_READ
suffix:colon
r_if
c_cond
(paren
id|devstat-&gt;dstat
op_amp
id|DEV_STAT_UNIT_CHECK
)paren
(brace
r_if
c_cond
(paren
(paren
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_amp
l_int|0x41
)paren
op_eq
l_int|0x41
op_logical_or
(paren
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_amp
l_int|0x40
)paren
op_eq
l_int|0x40
op_logical_or
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
(brace
id|privptr-&gt;stats.rx_errors
op_increment
suffix:semicolon
multiline_comment|/* Need protection here cos we are in the read irq */
multiline_comment|/*  handler the tbusy is for the write subchannel */
id|ctc_protect_busy
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ctc_setbit_busy
c_func
(paren
id|TB_RETRY
comma
id|dev
)paren
suffix:semicolon
id|ctc_unprotect_busy
c_func
(paren
id|dev
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ctc-&gt;timer
)paren
suffix:semicolon
id|ctc-&gt;timer.function
op_assign
(paren
r_void
op_star
)paren
id|ctc_read_retry
suffix:semicolon
id|ctc-&gt;timer.data
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|ctc-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|30
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ctc-&gt;timer
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: connection restarted!! problem on remote side&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|devstat-&gt;flag
op_amp
id|DEVSTAT_FINAL_STATUS
)paren
(brace
r_return
suffix:semicolon
)brace
id|ctc_protect_busy
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ctc_clearbit_busy
c_func
(paren
id|TB_RETRY
comma
id|dev
)paren
suffix:semicolon
id|ctc_unprotect_busy
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ctc_buffer_swap
c_func
(paren
op_amp
id|ctc-&gt;free_anchor
comma
op_amp
id|ctc-&gt;proc_anchor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctc-&gt;free_anchor
op_ne
l_int|NULL
)paren
(brace
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
(paren
r_char
op_star
)paren
id|virt_to_phys
c_func
(paren
id|ctc-&gt;free_anchor-&gt;block
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|rc
op_assign
id|do_IO
(paren
id|ctc-&gt;irq
comma
op_amp
id|ctc-&gt;ccw
(braket
l_int|0
)braket
comma
id|parm
comma
l_int|0xff
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
)brace
r_else
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|ctc-&gt;IO_active
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: No HOT READ started in IRQ&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|CTC_BH_ACTIVE
comma
(paren
r_void
op_star
)paren
op_amp
id|ctc-&gt;flag_a
)paren
op_eq
l_int|0
)paren
(brace
id|queue_task
c_func
(paren
op_amp
id|ctc-&gt;tq
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
id|CTC_START_WRITE_TEST
suffix:colon
r_if
c_cond
(paren
id|devstat-&gt;dstat
op_amp
id|DEV_STAT_UNIT_CHECK
)paren
(brace
r_if
c_cond
(paren
(paren
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_amp
l_int|0x41
)paren
op_eq
l_int|0x41
op_logical_or
(paren
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_amp
l_int|0x40
)paren
op_eq
l_int|0x40
op_logical_or
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
(brace
id|init_timer
c_func
(paren
op_amp
id|ctc-&gt;timer
)paren
suffix:semicolon
id|ctc-&gt;timer.function
op_assign
(paren
r_void
op_star
)paren
id|ctc_write_retry
suffix:semicolon
id|ctc-&gt;timer.data
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|ctc-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ctc-&gt;timer
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: write connection restarted&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
suffix:semicolon
)brace
id|ctc-&gt;state
op_assign
id|CTC_START_WRITE
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|ctc-&gt;wait
)paren
suffix:semicolon
multiline_comment|/* wake up ctc_open (WRITE) */
r_return
suffix:semicolon
r_case
id|CTC_START_WRITE
suffix:colon
r_if
c_cond
(paren
id|devstat-&gt;dstat
op_amp
id|DEV_STAT_UNIT_CHECK
)paren
(brace
id|privptr-&gt;stats.tx_errors
op_add_assign
id|ctc-&gt;proc_anchor-&gt;packets
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Unit Check on write channel&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|devstat-&gt;flag
op_amp
id|DEVSTAT_FINAL_STATUS
)paren
r_return
suffix:semicolon
id|privptr-&gt;stats.tx_packets
op_add_assign
id|ctc-&gt;proc_anchor-&gt;packets
suffix:semicolon
)brace
id|ctc-&gt;proc_anchor-&gt;block-&gt;length
op_assign
l_int|0
suffix:semicolon
id|ctc_buffer_swap
c_func
(paren
op_amp
id|ctc-&gt;proc_anchor
comma
op_amp
id|ctc-&gt;free_anchor
)paren
suffix:semicolon
id|ctc_clearbit_busy
c_func
(paren
id|TB_NOBUFFER
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctc-&gt;proc_anchor
op_ne
l_int|NULL
)paren
(brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: IRQ early swap buffer&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|count
op_assign
id|ctc-&gt;proc_anchor-&gt;block-&gt;length
suffix:semicolon
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
(paren
r_char
op_star
)paren
id|virt_to_phys
c_func
(paren
id|ctc-&gt;proc_anchor-&gt;block
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|rc
op_assign
id|do_IO
(paren
id|ctc-&gt;irq
comma
op_amp
id|ctc-&gt;ccw
(braket
l_int|0
)braket
comma
id|parm
comma
l_int|0xff
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctc-&gt;free_anchor-&gt;block-&gt;length
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|ctc_test_and_setbit_busy
c_func
(paren
id|TB_TX
comma
id|dev
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* set transmission to busy */
id|ctc_buffer_swap
c_func
(paren
op_amp
id|ctc-&gt;free_anchor
comma
op_amp
id|ctc-&gt;proc_anchor
)paren
suffix:semicolon
id|ctc_clearbit_busy
c_func
(paren
id|TB_TX
comma
id|dev
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: last buffer move in IRQ&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|count
op_assign
id|ctc-&gt;proc_anchor-&gt;block-&gt;length
suffix:semicolon
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
(paren
r_char
op_star
)paren
id|virt_to_phys
c_func
(paren
id|ctc-&gt;proc_anchor-&gt;block
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|rc
op_assign
id|do_IO
(paren
id|ctc-&gt;irq
comma
op_amp
id|ctc-&gt;ccw
(braket
l_int|0
)braket
comma
id|parm
comma
l_int|0xff
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|clear_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|ctc-&gt;IO_active
)paren
suffix:semicolon
multiline_comment|/* set by ctc_tx or ctc_bh */
r_return
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: wrong selection code - irq&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
DECL|function|ctc_irq_bh
r_static
r_void
id|ctc_irq_bh
(paren
r_struct
id|channel
op_star
id|ctc
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|__u16
id|data_len
suffix:semicolon
id|__u32
id|parm
suffix:semicolon
id|__u8
id|flags
op_assign
l_int|0x00
suffix:semicolon
id|__u32
id|saveflags
suffix:semicolon
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|ctc_priv
op_star
id|privptr
suffix:semicolon
r_struct
id|packet
op_star
id|lp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|dev
op_assign
(paren
id|net_device
op_star
)paren
id|ctc-&gt;dev
suffix:semicolon
id|privptr
op_assign
(paren
r_struct
id|ctc_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: bh routine - state-%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ctc-&gt;state
)paren
suffix:semicolon
macro_line|#endif 
r_while
c_loop
(paren
id|ctc-&gt;proc_anchor
op_ne
l_int|NULL
)paren
(brace
id|lp
op_assign
op_amp
id|ctc-&gt;proc_anchor-&gt;block-&gt;data
suffix:semicolon
r_while
c_loop
(paren
(paren
id|__u8
op_star
)paren
id|lp
OL
(paren
id|__u8
op_star
)paren
op_amp
id|ctc-&gt;proc_anchor-&gt;block-&gt;length
op_plus
id|ctc-&gt;proc_anchor-&gt;block-&gt;length
)paren
(brace
id|data_len
op_assign
id|lp-&gt;length
op_minus
id|PACKET_HEADER_LENGTH
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|data_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|data_len
)paren
comma
op_amp
id|lp-&gt;data
comma
id|data_len
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
multiline_comment|/* no UC happened!!! */
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|privptr-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
r_else
(brace
id|privptr-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: is low on memory&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
(paren
id|__u8
op_star
)paren
id|lp
op_add_assign
id|lp-&gt;length
suffix:semicolon
)brace
id|s390irq_spin_lock_irqsave
c_func
(paren
id|ctc-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
id|ctc_buffer_swap
c_func
(paren
op_amp
id|ctc-&gt;proc_anchor
comma
op_amp
id|ctc-&gt;free_anchor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|ctc-&gt;IO_active
)paren
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: HOT READ started in bh routine&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif 
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
(paren
r_char
op_star
)paren
id|virt_to_phys
c_func
(paren
id|ctc-&gt;free_anchor-&gt;block
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|rc
op_assign
id|do_IO
(paren
id|ctc-&gt;irq
comma
op_amp
id|ctc-&gt;ccw
(braket
l_int|0
)braket
comma
id|parm
comma
l_int|0xff
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
)brace
id|s390irq_spin_unlock_irqrestore
c_func
(paren
id|ctc-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|CTC_BH_ACTIVE
comma
(paren
r_void
op_star
)paren
op_amp
id|ctc-&gt;flag_a
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|ctc_read_retry
r_static
r_void
id|ctc_read_retry
(paren
r_struct
id|channel
op_star
id|ctc
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|__u32
id|parm
suffix:semicolon
id|__u8
id|flags
op_assign
l_int|0x00
suffix:semicolon
id|__u32
id|saveflags
suffix:semicolon
id|net_device
op_star
id|dev
suffix:semicolon
id|dev
op_assign
(paren
id|net_device
op_star
)paren
id|ctc-&gt;dev
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: read retry - state-%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ctc-&gt;state
)paren
suffix:semicolon
macro_line|#endif 
id|s390irq_spin_lock_irqsave
c_func
(paren
id|ctc-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
(paren
r_char
op_star
)paren
id|virt_to_phys
c_func
(paren
id|ctc-&gt;free_anchor-&gt;block
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|rc
op_assign
id|do_IO
(paren
id|ctc-&gt;irq
comma
op_amp
id|ctc-&gt;ccw
(braket
l_int|0
)braket
comma
id|parm
comma
l_int|0xff
comma
id|flags
)paren
suffix:semicolon
id|s390irq_spin_unlock_irqrestore
c_func
(paren
id|ctc-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|ctc_write_retry
r_static
r_void
id|ctc_write_retry
(paren
r_struct
id|channel
op_star
id|ctc
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|__u32
id|parm
suffix:semicolon
id|__u8
id|flags
op_assign
l_int|0x00
suffix:semicolon
id|__u32
id|saveflags
suffix:semicolon
id|net_device
op_star
id|dev
suffix:semicolon
id|dev
op_assign
(paren
id|net_device
op_star
)paren
id|ctc-&gt;dev
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: write retry - state-%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ctc-&gt;state
)paren
suffix:semicolon
macro_line|#endif 
id|s390irq_spin_lock_irqsave
c_func
(paren
id|ctc-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|count
op_assign
l_int|0
suffix:semicolon
id|ctc-&gt;ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
(paren
r_char
op_star
)paren
id|virt_to_phys
c_func
(paren
id|ctc-&gt;proc_anchor-&gt;block
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
id|ctc
suffix:semicolon
id|rc
op_assign
id|do_IO
(paren
id|ctc-&gt;irq
comma
op_amp
id|ctc-&gt;ccw
(braket
l_int|0
)braket
comma
id|parm
comma
l_int|0xff
comma
id|flags
)paren
suffix:semicolon
id|s390irq_spin_unlock_irqrestore
c_func
(paren
id|ctc-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *   ctc_open&n; *&n; */
DECL|function|ctc_open
r_static
r_int
id|ctc_open
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|rc
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|j
suffix:semicolon
id|__u8
id|flags
op_assign
l_int|0x00
suffix:semicolon
id|__u32
id|saveflags
suffix:semicolon
id|__u32
id|parm
suffix:semicolon
r_struct
id|ctc_priv
op_star
id|privptr
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|timer_list
id|timer
suffix:semicolon
id|ctc_set_busy
c_func
(paren
id|dev
)paren
suffix:semicolon
id|privptr
op_assign
(paren
r_struct
id|ctc_priv
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|flag
op_assign
l_int|0x00
suffix:semicolon
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|flag
op_assign
id|CTC_WRITE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|CTC_BLOCKS
suffix:semicolon
id|j
op_increment
)paren
(brace
id|rc
op_assign
id|ctc_buffer_alloc
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|init_waitqueue_head
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|wait
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|tq.list
)paren
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|tq.sync
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|tq.routine
op_assign
(paren
r_void
op_star
)paren
(paren
r_void
op_star
)paren
id|ctc_irq_bh
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|tq.data
op_assign
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|dev
op_assign
id|dev
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|flag_a
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|IO_active
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|0
)braket
dot
id|cmd_code
op_assign
id|CCW_CMD_PREPARE
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|0
)braket
dot
id|flags
op_assign
id|CCW_FLAG_SLI
op_or
id|CCW_FLAG_CC
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|0
)braket
dot
id|count
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|0
)braket
dot
id|cda
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|READ
)paren
(brace
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|1
)braket
dot
id|cmd_code
op_assign
id|CCW_CMD_READ
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|1
)braket
dot
id|flags
op_assign
id|CCW_FLAG_SLI
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|1
)braket
dot
id|count
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* MAX size */
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|1
)braket
dot
id|cmd_code
op_assign
id|CCW_CMD_WRITE
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|1
)braket
dot
id|flags
op_assign
id|CCW_FLAG_SLI
op_or
id|CCW_FLAG_CC
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|1
)braket
dot
id|count
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
l_int|NULL
suffix:semicolon
)brace
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|2
)braket
dot
id|cmd_code
op_assign
id|CCW_CMD_NOOP
suffix:semicolon
multiline_comment|/* jointed CE+DE */
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|2
)braket
dot
id|flags
op_assign
id|CCW_FLAG_SLI
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|2
)braket
dot
id|count
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|ccw
(braket
l_int|2
)braket
dot
id|cda
op_assign
l_int|NULL
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|flag
op_and_assign
op_complement
id|CTC_TIMER
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|timer
)paren
suffix:semicolon
id|timer.function
op_assign
(paren
r_void
op_star
)paren
id|ctc_timer
suffix:semicolon
id|timer.data
op_assign
(paren
id|__u32
)paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
suffix:semicolon
id|timer.expires
op_assign
id|jiffies
op_plus
l_int|150
op_star
id|HZ
suffix:semicolon
multiline_comment|/* time to connect with the remote side */
id|add_timer
c_func
(paren
op_amp
id|timer
)paren
suffix:semicolon
id|s390irq_spin_lock_irqsave
c_func
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|irq
comma
id|saveflags
)paren
suffix:semicolon
id|parm
op_assign
(paren
r_int
r_int
)paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|state
op_assign
id|CTC_START_HALT_IO
suffix:semicolon
id|rc
op_assign
id|halt_IO
c_func
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|irq
comma
id|parm
comma
id|flags
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|s390irq_spin_unlock_irqrestore
c_func
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|irq
comma
id|saveflags
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
(brace
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|flag
op_amp
id|CTC_TIMER
)paren
op_eq
l_int|0x00
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|timer
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
(paren
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|last_dstat
op_or
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|last_dstat
)paren
op_amp
op_complement
(paren
id|DEV_STAT_CHN_END
op_or
id|DEV_STAT_DEV_END
)paren
)paren
op_ne
l_int|0x00
)paren
op_logical_or
(paren
(paren
(paren
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|flag
op_or
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|flag
)paren
op_amp
id|CTC_TIMER
)paren
op_ne
l_int|0x00
)paren
)paren
(brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: channel problems during open - read: %02x -  write: %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|last_dstat
comma
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|last_dstat
)paren
suffix:semicolon
macro_line|#endif 
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: remote side is currently not ready&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|s390irq_spin_lock_irqsave
c_func
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|irq
comma
id|saveflags
)paren
suffix:semicolon
id|parm
op_assign
(paren
r_int
r_int
)paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|state
op_assign
id|CTC_STOP
suffix:semicolon
id|rc
op_assign
id|halt_IO
c_func
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|irq
comma
id|parm
comma
id|flags
)paren
suffix:semicolon
id|s390irq_spin_unlock_irqrestore
c_func
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|irq
comma
id|saveflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|CTC_BLOCKS
suffix:semicolon
id|j
op_increment
)paren
id|ctc_buffer_free
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: connected with remote side&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|ctc_clear_busy
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ctc_timer
r_static
r_void
id|ctc_timer
(paren
r_struct
id|channel
op_star
id|ctc
)paren
(brace
macro_line|#ifdef DEBUG
id|net_device
op_star
id|dev
suffix:semicolon
id|dev
op_assign
(paren
id|net_device
op_star
)paren
id|ctc-&gt;dev
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: timer return&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
id|ctc-&gt;flag
op_or_assign
id|CTC_TIMER
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|ctc-&gt;wait
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *   ctc_release &n; *&n; */
DECL|function|ctc_release
r_static
r_int
id|ctc_release
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|rc
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|j
suffix:semicolon
id|__u8
id|flags
op_assign
l_int|0x00
suffix:semicolon
id|__u32
id|saveflags
suffix:semicolon
id|__u32
id|parm
suffix:semicolon
r_struct
id|ctc_priv
op_star
id|privptr
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|privptr
op_assign
(paren
r_struct
id|ctc_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|ctc_protect_busy_irqsave
c_func
(paren
id|dev
comma
id|saveflags
)paren
suffix:semicolon
id|ctc_setbit_busy
c_func
(paren
id|TB_STOP
comma
id|dev
)paren
suffix:semicolon
id|ctc_unprotect_busy_irqrestore
c_func
(paren
id|dev
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|s390irq_spin_lock_irqsave
c_func
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|irq
comma
id|saveflags
)paren
suffix:semicolon
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|state
op_assign
id|CTC_STOP
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
suffix:semicolon
id|rc
op_assign
id|halt_IO
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|irq
comma
id|parm
comma
id|flags
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|s390irq_spin_unlock_irqrestore
c_func
(paren
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|irq
comma
id|saveflags
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
(brace
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|CTC_BLOCKS
suffix:semicolon
id|j
op_increment
)paren
(brace
id|ctc_buffer_swap
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|proc_anchor
comma
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
dot
id|free_anchor
)paren
suffix:semicolon
id|ctc_buffer_free
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|last_dstat
op_or
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|last_dstat
)paren
op_amp
op_complement
(paren
id|DEV_STAT_CHN_END
op_or
id|DEV_STAT_DEV_END
)paren
)paren
op_ne
l_int|0x00
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: channel problems during close - read: %02x -  write: %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|privptr-&gt;channel
(braket
id|READ
)braket
dot
id|last_dstat
comma
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|last_dstat
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *   ctc_tx &n; *&n; *&n; */
DECL|function|ctc_tx
r_static
r_int
id|ctc_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|rc
op_assign
l_int|0
comma
id|rc2
suffix:semicolon
id|__u32
id|parm
suffix:semicolon
id|__u8
id|flags
op_assign
l_int|0x00
suffix:semicolon
id|__u32
id|saveflags
suffix:semicolon
r_struct
id|ctc_priv
op_star
id|privptr
suffix:semicolon
r_struct
id|packet
op_star
id|lp
suffix:semicolon
id|privptr
op_assign
(paren
r_struct
id|ctc_priv
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: NULL pointer as sk_buffer passed&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|privptr-&gt;stats.tx_dropped
op_increment
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|s390irq_spin_lock_irqsave
c_func
(paren
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|irq
comma
id|saveflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctc_check_busy
c_func
(paren
id|dev
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|Done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctc_test_and_setbit_busy
c_func
(paren
id|TB_TX
comma
id|dev
)paren
)paren
(brace
multiline_comment|/* set transmission to busy */
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|Done
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|65535
op_minus
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor-&gt;block-&gt;length
op_minus
id|PACKET_HEADER_LENGTH
op_le
id|skb-&gt;len
op_plus
id|PACKET_HEADER_LENGTH
op_plus
l_int|2
)paren
(brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: early swap&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
id|ctc_buffer_swap
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor
comma
op_amp
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|proc_anchor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor
op_eq
l_int|NULL
)paren
(brace
id|ctc_setbit_busy
c_func
(paren
id|TB_NOBUFFER
comma
id|dev
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|Done2
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor-&gt;block-&gt;length
op_eq
l_int|0
)paren
(brace
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor-&gt;block-&gt;length
op_assign
id|BLOCK_HEADER_LENGTH
suffix:semicolon
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor-&gt;packets
op_assign
l_int|0
suffix:semicolon
)brace
(paren
id|__u8
op_star
)paren
id|lp
op_assign
(paren
id|__u8
op_star
)paren
op_amp
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor-&gt;block-&gt;length
op_plus
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor-&gt;block-&gt;length
suffix:semicolon
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor-&gt;block-&gt;length
op_add_assign
id|skb-&gt;len
op_plus
id|PACKET_HEADER_LENGTH
suffix:semicolon
id|lp-&gt;length
op_assign
id|skb-&gt;len
op_plus
id|PACKET_HEADER_LENGTH
suffix:semicolon
id|lp-&gt;type
op_assign
l_int|0x0800
suffix:semicolon
id|lp-&gt;unused
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|lp-&gt;data
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
(paren
id|__u8
op_star
)paren
id|lp
op_add_assign
id|lp-&gt;length
suffix:semicolon
id|lp-&gt;length
op_assign
l_int|0
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor-&gt;packets
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|IO_active
)paren
op_eq
l_int|0
)paren
(brace
id|ctc_buffer_swap
c_func
(paren
op_amp
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor
comma
op_amp
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|proc_anchor
)paren
suffix:semicolon
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|ccw
(braket
l_int|1
)braket
dot
id|count
op_assign
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|proc_anchor-&gt;block-&gt;length
suffix:semicolon
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|ccw
(braket
l_int|1
)braket
dot
id|cda
op_assign
(paren
r_char
op_star
)paren
id|virt_to_phys
c_func
(paren
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|proc_anchor-&gt;block
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|__u32
)paren
op_amp
id|privptr-&gt;channel
(braket
id|WRITE
)braket
suffix:semicolon
id|rc2
op_assign
id|do_IO
(paren
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|irq
comma
op_amp
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|ccw
(braket
l_int|0
)braket
comma
id|parm
comma
l_int|0xff
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc2
op_ne
l_int|0
)paren
id|ccw_check_return_code
c_func
(paren
id|dev
comma
id|rc2
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
r_if
c_cond
(paren
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|free_anchor
op_eq
l_int|NULL
)paren
id|ctc_setbit_busy
c_func
(paren
id|TB_NOBUFFER
comma
id|dev
)paren
suffix:semicolon
id|Done2
suffix:colon
id|ctc_clearbit_busy
c_func
(paren
id|TB_TX
comma
id|dev
)paren
suffix:semicolon
id|Done
suffix:colon
id|s390irq_spin_unlock_irqrestore
c_func
(paren
id|privptr-&gt;channel
(braket
id|WRITE
)braket
dot
id|irq
comma
id|saveflags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; *   ctc_change_mtu &n; *&n; *   S/390 can handle MTU sizes from 576 to 32760 for VM, VSE&n; *                                   576 to 65527 for OS/390&n; *&n; */
DECL|function|ctc_change_mtu
r_static
r_int
id|ctc_change_mtu
c_func
(paren
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
(paren
id|new_mtu
OL
l_int|576
)paren
op_logical_or
(paren
id|new_mtu
OG
l_int|65528
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *   ctc_stats&n; *&n; */
DECL|function|ctc_stats
r_struct
id|net_device_stats
op_star
id|ctc_stats
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ctc_priv
op_star
id|privptr
suffix:semicolon
id|privptr
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|privptr-&gt;stats
suffix:semicolon
)brace
multiline_comment|/* Module code goes here */
multiline_comment|/*&n;                free_irq(privptr-&gt;channel[i].irq, privptr-&gt;channel[i].devstat);&n;                kfree(privptr-&gt;channel[i].devstat); &n;&n;*/
multiline_comment|/* --- This is the END my friend --- */
eof
