multiline_comment|/* &n; * File...........: linux/drivers/s390/block/dasd_eckd.c&n; * Author(s)......: Holger Smolinski &lt;Holger.Smolinski@de.ibm.com&gt;&n; * Bugreports.to..: &lt;Linux390@de.ibm.com&gt;&n; * (C) IBM Corporation, IBM Deutschland Entwicklung GmbH, 1999,2000&n; */
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#ifdef MODULE
macro_line|#include &lt;linux/module.h&gt;
macro_line|#endif&t;&t;&t;&t;/* MODULE */
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/dasd.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &quot;dasd_types.h&quot;
macro_line|#include &quot;dasd_ccwstuff.h&quot;
macro_line|#ifdef PRINTK_HEADER
DECL|macro|PRINTK_HEADER
macro_line|#undef PRINTK_HEADER
macro_line|#endif&t;&t;&t;&t;/* PRINTK_HEADER */
DECL|macro|PRINTK_HEADER
mdefine_line|#define PRINTK_HEADER &quot;dasd(eckd):&quot;
DECL|macro|ECKD_C0
mdefine_line|#define ECKD_C0(i) (i-&gt;home_bytes)
DECL|macro|ECKD_F
mdefine_line|#define ECKD_F(i) (i -&gt; formula)
DECL|macro|ECKD_F1
mdefine_line|#define ECKD_F1(i) (ECKD_F(i)==0x01?(i-&gt;factors.f_0x01.f1):(i-&gt;factors.f_0x02.f1))
DECL|macro|ECKD_F2
mdefine_line|#define ECKD_F2(i) (ECKD_F(i)==0x01?(i-&gt;factors.f_0x01.f2):(i-&gt;factors.f_0x02.f2))
DECL|macro|ECKD_F3
mdefine_line|#define ECKD_F3(i) (ECKD_F(i)==0x01?(i-&gt;factors.f_0x01.f3):(i-&gt;factors.f_0x02.f3))
DECL|macro|ECKD_F4
mdefine_line|#define ECKD_F4(i) (ECKD_F(i)==0x02?(i-&gt;factors.f_0x02.f4):0)
DECL|macro|ECKD_F5
mdefine_line|#define ECKD_F5(i) (ECKD_F(i)==0x02?(i-&gt;factors.f_0x02.f5):0)
DECL|macro|ECKD_F6
mdefine_line|#define ECKD_F6(i) (i -&gt; factor6)
DECL|macro|ECKD_F7
mdefine_line|#define ECKD_F7(i) (i -&gt; factor7)
DECL|macro|ECKD_F8
mdefine_line|#define ECKD_F8(i) (i -&gt; factor8)
DECL|macro|DASD_ECKD_CCW_LOCATE_RECORD
mdefine_line|#define DASD_ECKD_CCW_LOCATE_RECORD 0x47
DECL|macro|DASD_ECKD_CCW_READ_HOME_ADDRESS
mdefine_line|#define DASD_ECKD_CCW_READ_HOME_ADDRESS 0x0a
DECL|macro|DASD_ECKD_CCW_WRITE_HOME_ADDRESS
mdefine_line|#define DASD_ECKD_CCW_WRITE_HOME_ADDRESS 0x09
DECL|macro|DASD_ECKD_CCW_READ_RECORD_ZERO
mdefine_line|#define DASD_ECKD_CCW_READ_RECORD_ZERO 0x16
DECL|macro|DASD_ECKD_CCW_WRITE_RECORD_ZERO
mdefine_line|#define DASD_ECKD_CCW_WRITE_RECORD_ZERO 0x15
DECL|macro|DASD_ECKD_CCW_READ_COUNT
mdefine_line|#define DASD_ECKD_CCW_READ_COUNT 0x12
DECL|macro|DASD_ECKD_CCW_READ
mdefine_line|#define DASD_ECKD_CCW_READ 0x06
DECL|macro|DASD_ECKD_CCW_READ_MT
mdefine_line|#define DASD_ECKD_CCW_READ_MT 0x86
DECL|macro|DASD_ECKD_CCW_WRITE
mdefine_line|#define DASD_ECKD_CCW_WRITE 0x05
DECL|macro|DASD_ECKD_CCW_WRITE_MT
mdefine_line|#define DASD_ECKD_CCW_WRITE_MT 0x85
DECL|macro|DASD_ECKD_CCW_READ_CKD
mdefine_line|#define DASD_ECKD_CCW_READ_CKD 0x1e
DECL|macro|DASD_ECKD_CCW_READ_CKD_MT
mdefine_line|#define DASD_ECKD_CCW_READ_CKD_MT 0x9e
DECL|macro|DASD_ECKD_CCW_WRITE_CKD
mdefine_line|#define DASD_ECKD_CCW_WRITE_CKD 0x1d
DECL|macro|DASD_ECKD_CCW_WRITE_CKD_MT
mdefine_line|#define DASD_ECKD_CCW_WRITE_CKD_MT 0x9d
r_typedef
r_struct
(brace
DECL|member|cyl
id|__u16
id|cyl
suffix:semicolon
DECL|member|head
id|__u16
id|head
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
DECL|typedef|ch_t
id|ch_t
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|cyl
id|__u16
id|cyl
suffix:semicolon
DECL|member|head
id|__u16
id|head
suffix:semicolon
DECL|member|sector
id|__u32
id|sector
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
DECL|typedef|chs_t
id|chs_t
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|cyl
id|__u16
id|cyl
suffix:semicolon
DECL|member|head
id|__u16
id|head
suffix:semicolon
DECL|member|record
id|__u8
id|record
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
DECL|typedef|chr_t
id|chr_t
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|cyl
id|__u16
id|cyl
suffix:semicolon
DECL|member|head
id|__u16
id|head
suffix:semicolon
DECL|member|sector
id|__u32
id|sector
suffix:semicolon
DECL|typedef|geom_t
)brace
id|geom_t
suffix:semicolon
r_typedef
r_struct
(brace
r_struct
(brace
r_struct
(brace
DECL|member|identifier
r_int
r_char
id|identifier
suffix:colon
l_int|2
suffix:semicolon
DECL|member|token_id
r_int
r_char
id|token_id
suffix:colon
l_int|1
suffix:semicolon
DECL|member|sno_valid
r_int
r_char
id|sno_valid
suffix:colon
l_int|1
suffix:semicolon
DECL|member|subst_sno
r_int
r_char
id|subst_sno
suffix:colon
l_int|1
suffix:semicolon
DECL|member|recNED
r_int
r_char
id|recNED
suffix:colon
l_int|1
suffix:semicolon
DECL|member|emuNED
r_int
r_char
id|emuNED
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
suffix:colon
l_int|1
suffix:semicolon
DECL|member|flags
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|flags
suffix:semicolon
DECL|member|descriptor
id|__u8
id|descriptor
suffix:semicolon
DECL|member|dev_class
id|__u8
id|dev_class
suffix:semicolon
DECL|member|reserved
id|__u8
id|reserved
suffix:semicolon
DECL|member|dev_type
r_int
r_char
id|dev_type
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|dev_model
r_int
r_char
id|dev_model
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|HDA_manufacturer
r_int
r_char
id|HDA_manufacturer
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|HDA_location
r_int
r_char
id|HDA_location
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|HDA_seqno
r_int
r_char
id|HDA_seqno
(braket
l_int|12
)braket
suffix:semicolon
DECL|member|ID
id|__u16
id|ID
suffix:semicolon
DECL|member|ned1
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|ned1
suffix:semicolon
r_struct
(brace
r_struct
(brace
DECL|member|identifier
r_int
r_char
id|identifier
suffix:colon
l_int|2
suffix:semicolon
DECL|member|token_id
r_int
r_char
id|token_id
suffix:colon
l_int|1
suffix:semicolon
DECL|member|sno_valid
r_int
r_char
id|sno_valid
suffix:colon
l_int|1
suffix:semicolon
DECL|member|subst_sno
r_int
r_char
id|subst_sno
suffix:colon
l_int|1
suffix:semicolon
DECL|member|recNED
r_int
r_char
id|recNED
suffix:colon
l_int|1
suffix:semicolon
DECL|member|emuNED
r_int
r_char
id|emuNED
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
suffix:colon
l_int|1
suffix:semicolon
DECL|member|flags
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|flags
suffix:semicolon
DECL|member|descriptor
id|__u8
id|descriptor
suffix:semicolon
DECL|member|reserved
id|__u8
id|reserved
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|dev_type
r_int
r_char
id|dev_type
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|dev_model
r_int
r_char
id|dev_model
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|DASD_manufacturer
r_int
r_char
id|DASD_manufacturer
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|DASD_location
r_int
r_char
id|DASD_location
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|DASD_seqno
r_int
r_char
id|DASD_seqno
(braket
l_int|12
)braket
suffix:semicolon
DECL|member|ID
id|__u16
id|ID
suffix:semicolon
DECL|member|ned2
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|ned2
suffix:semicolon
r_struct
(brace
r_struct
(brace
DECL|member|identifier
r_int
r_char
id|identifier
suffix:colon
l_int|2
suffix:semicolon
DECL|member|token_id
r_int
r_char
id|token_id
suffix:colon
l_int|1
suffix:semicolon
DECL|member|sno_valid
r_int
r_char
id|sno_valid
suffix:colon
l_int|1
suffix:semicolon
DECL|member|subst_sno
r_int
r_char
id|subst_sno
suffix:colon
l_int|1
suffix:semicolon
DECL|member|recNED
r_int
r_char
id|recNED
suffix:colon
l_int|1
suffix:semicolon
DECL|member|emuNED
r_int
r_char
id|emuNED
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
suffix:colon
l_int|1
suffix:semicolon
DECL|member|flags
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|flags
suffix:semicolon
DECL|member|descriptor
id|__u8
id|descriptor
suffix:semicolon
DECL|member|reserved
id|__u8
id|reserved
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|cont_type
r_int
r_char
id|cont_type
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|cont_model
r_int
r_char
id|cont_model
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|cont_manufacturer
r_int
r_char
id|cont_manufacturer
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|cont_location
r_int
r_char
id|cont_location
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|cont_seqno
r_int
r_char
id|cont_seqno
(braket
l_int|12
)braket
suffix:semicolon
DECL|member|ID
id|__u16
id|ID
suffix:semicolon
DECL|member|ned3
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|ned3
suffix:semicolon
r_struct
(brace
r_struct
(brace
DECL|member|identifier
r_int
r_char
id|identifier
suffix:colon
l_int|2
suffix:semicolon
DECL|member|token_id
r_int
r_char
id|token_id
suffix:colon
l_int|1
suffix:semicolon
DECL|member|sno_valid
r_int
r_char
id|sno_valid
suffix:colon
l_int|1
suffix:semicolon
DECL|member|subst_sno
r_int
r_char
id|subst_sno
suffix:colon
l_int|1
suffix:semicolon
DECL|member|recNED
r_int
r_char
id|recNED
suffix:colon
l_int|1
suffix:semicolon
DECL|member|emuNED
r_int
r_char
id|emuNED
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
suffix:colon
l_int|1
suffix:semicolon
DECL|member|flags
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|flags
suffix:semicolon
DECL|member|descriptor
id|__u8
id|descriptor
suffix:semicolon
DECL|member|reserved
id|__u8
id|reserved
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|cont_type
r_int
r_char
id|cont_type
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|empty
r_int
r_char
id|empty
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|cont_manufacturer
r_int
r_char
id|cont_manufacturer
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|cont_location
r_int
r_char
id|cont_location
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|cont_seqno
r_int
r_char
id|cont_seqno
(braket
l_int|12
)braket
suffix:semicolon
DECL|member|ID
id|__u16
id|ID
suffix:semicolon
DECL|member|ned4
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|ned4
suffix:semicolon
DECL|member|ned5
r_int
r_char
id|ned5
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|ned6
r_int
r_char
id|ned6
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|ned7
r_int
r_char
id|ned7
(braket
l_int|32
)braket
suffix:semicolon
r_struct
(brace
r_struct
(brace
DECL|member|identifier
r_int
r_char
id|identifier
suffix:colon
l_int|2
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
suffix:colon
l_int|6
suffix:semicolon
DECL|member|flags
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|flags
suffix:semicolon
DECL|member|selector
id|__u8
id|selector
suffix:semicolon
DECL|member|interfaceID
id|__u16
id|interfaceID
suffix:semicolon
DECL|member|reserved
id|__u32
id|reserved
suffix:semicolon
DECL|member|subsystemID
id|__u16
id|subsystemID
suffix:semicolon
r_struct
(brace
DECL|member|sp0
r_int
r_char
id|sp0
suffix:colon
l_int|1
suffix:semicolon
DECL|member|sp1
r_int
r_char
id|sp1
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
suffix:colon
l_int|5
suffix:semicolon
DECL|member|scluster
r_int
r_char
id|scluster
suffix:colon
l_int|1
suffix:semicolon
DECL|member|spathID
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|spathID
suffix:semicolon
DECL|member|unit_address
id|__u8
id|unit_address
suffix:semicolon
DECL|member|dev_ID
id|__u8
id|dev_ID
suffix:semicolon
DECL|member|dev_address
id|__u8
id|dev_address
suffix:semicolon
DECL|member|adapterID
id|__u8
id|adapterID
suffix:semicolon
DECL|member|link_address
id|__u16
id|link_address
suffix:semicolon
r_struct
(brace
DECL|member|parallel
r_int
r_char
id|parallel
suffix:colon
l_int|1
suffix:semicolon
DECL|member|escon
r_int
r_char
id|escon
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ficon
r_int
r_char
id|ficon
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reserved2
r_int
r_char
id|reserved2
suffix:colon
l_int|4
suffix:semicolon
DECL|member|protocol_type
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|protocol_type
suffix:semicolon
r_struct
(brace
DECL|member|PID_in_236
r_int
r_char
id|PID_in_236
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
suffix:colon
l_int|7
suffix:semicolon
DECL|member|format_flags
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|format_flags
suffix:semicolon
DECL|member|log_dev_address
id|__u8
id|log_dev_address
suffix:semicolon
DECL|member|reserved2
r_int
r_char
id|reserved2
(braket
l_int|12
)braket
suffix:semicolon
DECL|member|neq
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|neq
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
DECL|typedef|eckd_confdata_t
id|eckd_confdata_t
suffix:semicolon
r_typedef
r_struct
(brace
r_struct
(brace
DECL|member|perm
r_int
r_char
id|perm
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* Permissions on this extent */
DECL|member|reserved
r_int
r_char
id|reserved
suffix:colon
l_int|1
suffix:semicolon
DECL|member|seek
r_int
r_char
id|seek
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* Seek control */
DECL|member|auth
r_int
r_char
id|auth
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* Access authorization */
DECL|member|pci
r_int
r_char
id|pci
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* PCI Fetch mode */
DECL|member|mask
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|mask
suffix:semicolon
r_struct
(brace
DECL|member|mode
r_int
r_char
id|mode
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* Architecture mode */
DECL|member|ckd
r_int
r_char
id|ckd
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* CKD Conversion */
DECL|member|operation
r_int
r_char
id|operation
suffix:colon
l_int|3
suffix:semicolon
multiline_comment|/* Operation mode */
DECL|member|cfw
r_int
r_char
id|cfw
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Cache fast write */
DECL|member|dfw
r_int
r_char
id|dfw
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* DASD fast write */
DECL|member|attributes
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|attributes
suffix:semicolon
DECL|member|blk_size
id|__u16
r_int
id|blk_size
suffix:semicolon
multiline_comment|/* Blocksize */
DECL|member|fast_write_id
id|__u16
id|fast_write_id
suffix:semicolon
DECL|member|unused
id|__u8
id|unused
suffix:semicolon
DECL|member|reserved
id|__u8
id|reserved
suffix:semicolon
DECL|member|beg_ext
id|ch_t
id|beg_ext
suffix:semicolon
DECL|member|end_ext
id|ch_t
id|end_ext
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
comma
id|aligned
(paren
l_int|32
)paren
)paren
)paren
DECL|typedef|DE_eckd_data_t
id|DE_eckd_data_t
suffix:semicolon
r_typedef
r_struct
(brace
r_struct
(brace
DECL|member|orientation
r_int
r_char
id|orientation
suffix:colon
l_int|2
suffix:semicolon
DECL|member|operation
r_int
r_char
id|operation
suffix:colon
l_int|6
suffix:semicolon
DECL|member|operation
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|operation
suffix:semicolon
r_struct
(brace
DECL|member|last_bytes_used
r_int
r_char
id|last_bytes_used
suffix:colon
l_int|1
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
suffix:colon
l_int|6
suffix:semicolon
DECL|member|read_count_suffix
r_int
r_char
id|read_count_suffix
suffix:colon
l_int|1
suffix:semicolon
DECL|member|auxiliary
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|auxiliary
suffix:semicolon
DECL|member|unused
id|__u8
id|unused
suffix:semicolon
DECL|member|count
id|__u8
id|count
suffix:semicolon
DECL|member|seek_addr
id|ch_t
id|seek_addr
suffix:semicolon
DECL|member|search_arg
id|chr_t
id|search_arg
suffix:semicolon
DECL|member|sector
id|__u8
id|sector
suffix:semicolon
DECL|member|length
id|__u16
id|length
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
comma
id|aligned
(paren
l_int|32
)paren
)paren
)paren
DECL|typedef|LO_eckd_data_t
id|LO_eckd_data_t
suffix:semicolon
multiline_comment|/* Stuff for handling home addresses */
r_typedef
r_struct
(brace
DECL|member|skip_control
id|__u8
id|skip_control
(braket
l_int|14
)braket
suffix:semicolon
DECL|member|cell_number
id|__u16
id|cell_number
suffix:semicolon
DECL|member|physical_addr
id|__u8
id|physical_addr
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|flag
id|__u8
id|flag
suffix:semicolon
DECL|member|track_addr
id|ch_t
id|track_addr
suffix:semicolon
DECL|member|reserved
id|__u8
id|reserved
suffix:semicolon
DECL|member|key_length
id|__u8
id|key_length
suffix:semicolon
DECL|member|reserved2
id|__u8
id|reserved2
(braket
l_int|2
)braket
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
comma
id|aligned
(paren
l_int|32
)paren
)paren
)paren
DECL|typedef|eckd_home_t
id|eckd_home_t
suffix:semicolon
r_static
r_int
r_int
DECL|function|round_up_multiple
id|round_up_multiple
(paren
r_int
r_int
id|no
comma
r_int
r_int
id|mult
)paren
(brace
r_int
id|rem
op_assign
id|no
op_mod
id|mult
suffix:semicolon
r_return
(paren
id|rem
ques
c_cond
id|no
op_minus
id|rem
op_plus
id|mult
suffix:colon
id|no
)paren
suffix:semicolon
multiline_comment|/*      return (no % mult ? no - (no % mult) + mult : no); */
)brace
r_static
r_int
r_int
DECL|function|ceil_quot
id|ceil_quot
(paren
r_int
r_int
id|d1
comma
r_int
r_int
id|d2
)paren
(brace
r_return
(paren
id|d1
op_plus
(paren
id|d2
op_minus
l_int|1
)paren
)paren
op_div
id|d2
suffix:semicolon
)brace
r_static
r_int
DECL|function|bytes_per_record
id|bytes_per_record
(paren
id|dasd_eckd_characteristics_t
op_star
id|rdc
comma
r_int
id|kl
comma
multiline_comment|/* key length */
r_int
id|dl
multiline_comment|/* data length */
)paren
(brace
r_int
id|bpr
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|rdc-&gt;formula
)paren
(brace
r_case
l_int|0x01
suffix:colon
(brace
r_int
r_int
id|fl1
comma
id|fl2
suffix:semicolon
id|fl1
op_assign
id|round_up_multiple
(paren
id|ECKD_F2
(paren
id|rdc
)paren
op_plus
id|dl
comma
id|ECKD_F1
(paren
id|rdc
)paren
)paren
suffix:semicolon
id|fl2
op_assign
id|round_up_multiple
(paren
id|kl
ques
c_cond
id|ECKD_F2
(paren
id|rdc
)paren
op_plus
id|kl
suffix:colon
l_int|0
comma
id|ECKD_F1
(paren
id|rdc
)paren
)paren
suffix:semicolon
id|bpr
op_assign
id|fl1
op_plus
id|fl2
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
l_int|0x02
suffix:colon
(brace
r_int
r_int
id|fl1
comma
id|fl2
comma
id|int1
comma
id|int2
suffix:semicolon
id|int1
op_assign
id|ceil_quot
(paren
id|dl
op_plus
id|ECKD_F6
(paren
id|rdc
)paren
comma
id|ECKD_F5
(paren
id|rdc
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|int2
op_assign
id|ceil_quot
(paren
id|kl
op_plus
id|ECKD_F6
(paren
id|rdc
)paren
comma
id|ECKD_F5
(paren
id|rdc
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|fl1
op_assign
id|round_up_multiple
(paren
id|ECKD_F1
(paren
id|rdc
)paren
op_star
id|ECKD_F2
(paren
id|rdc
)paren
op_plus
(paren
id|dl
op_plus
id|ECKD_F6
(paren
id|rdc
)paren
op_plus
id|ECKD_F4
(paren
id|rdc
)paren
op_star
id|int1
)paren
comma
id|ECKD_F1
(paren
id|rdc
)paren
)paren
suffix:semicolon
id|fl2
op_assign
id|round_up_multiple
(paren
id|ECKD_F1
(paren
id|rdc
)paren
op_star
id|ECKD_F3
(paren
id|rdc
)paren
op_plus
(paren
id|kl
op_plus
id|ECKD_F6
(paren
id|rdc
)paren
op_plus
id|ECKD_F4
(paren
id|rdc
)paren
op_star
id|int2
)paren
comma
id|ECKD_F1
(paren
id|rdc
)paren
)paren
suffix:semicolon
id|bpr
op_assign
id|fl1
op_plus
id|fl2
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|INTERNAL_ERROR
(paren
l_string|&quot;unknown formula%d&bslash;n&quot;
comma
id|rdc-&gt;formula
)paren
suffix:semicolon
)brace
r_return
id|bpr
suffix:semicolon
)brace
r_static
r_inline
r_int
r_int
DECL|function|bytes_per_track
id|bytes_per_track
(paren
id|dasd_eckd_characteristics_t
op_star
id|rdc
)paren
(brace
r_return
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|rdc-&gt;byte_per_track
)paren
op_rshift
l_int|8
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|recs_per_track
id|recs_per_track
(paren
id|dasd_eckd_characteristics_t
op_star
id|rdc
comma
r_int
r_int
id|kl
comma
r_int
r_int
id|dl
)paren
(brace
r_int
id|rpt
op_assign
l_int|0
suffix:semicolon
r_int
id|dn
suffix:semicolon
r_switch
c_cond
(paren
id|rdc
op_member_access_from_pointer
id|dev_type
)paren
(brace
r_case
l_int|0x3380
suffix:colon
r_if
c_cond
(paren
id|kl
)paren
r_return
l_int|1499
op_div
(paren
l_int|15
op_plus
l_int|7
op_plus
id|ceil_quot
(paren
id|kl
op_plus
l_int|12
comma
l_int|32
)paren
op_plus
id|ceil_quot
(paren
id|dl
op_plus
l_int|12
comma
l_int|32
)paren
)paren
suffix:semicolon
r_else
r_return
l_int|1499
op_div
(paren
l_int|15
op_plus
id|ceil_quot
(paren
id|dl
op_plus
l_int|12
comma
l_int|32
)paren
)paren
suffix:semicolon
r_case
l_int|0x3390
suffix:colon
id|dn
op_assign
id|ceil_quot
(paren
id|dl
op_plus
l_int|6
comma
l_int|232
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|kl
)paren
(brace
r_int
id|kn
op_assign
id|ceil_quot
(paren
id|kl
op_plus
l_int|6
comma
l_int|232
)paren
op_plus
l_int|1
suffix:semicolon
r_return
l_int|1729
op_div
(paren
l_int|10
op_plus
l_int|9
op_plus
id|ceil_quot
(paren
id|kl
op_plus
l_int|6
op_star
id|kn
comma
l_int|34
)paren
op_plus
l_int|9
op_plus
id|ceil_quot
(paren
id|dl
op_plus
l_int|6
op_star
id|dn
comma
l_int|34
)paren
)paren
suffix:semicolon
)brace
r_else
r_return
l_int|1729
op_div
(paren
l_int|10
op_plus
l_int|9
op_plus
id|ceil_quot
(paren
id|dl
op_plus
l_int|6
op_star
id|dn
comma
l_int|34
)paren
)paren
suffix:semicolon
r_case
l_int|0x9345
suffix:colon
id|dn
op_assign
id|ceil_quot
(paren
id|dl
op_plus
l_int|6
comma
l_int|232
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|kl
)paren
(brace
r_int
id|kn
op_assign
id|ceil_quot
(paren
id|kl
op_plus
l_int|6
comma
l_int|232
)paren
op_plus
l_int|1
suffix:semicolon
r_return
l_int|1420
op_div
(paren
l_int|18
op_plus
l_int|7
op_plus
id|ceil_quot
(paren
id|kl
op_plus
l_int|6
op_star
id|kn
comma
l_int|34
)paren
op_plus
id|ceil_quot
(paren
id|dl
op_plus
l_int|6
op_star
id|dn
comma
l_int|34
)paren
)paren
suffix:semicolon
)brace
r_else
r_return
l_int|1420
op_div
(paren
l_int|18
op_plus
l_int|7
op_plus
id|ceil_quot
(paren
id|dl
op_plus
l_int|6
op_star
id|dn
comma
l_int|34
)paren
)paren
suffix:semicolon
)brace
r_return
id|rpt
suffix:semicolon
)brace
r_static
r_void
DECL|function|define_extent
id|define_extent
(paren
id|ccw1_t
op_star
id|de_ccw
comma
id|DE_eckd_data_t
op_star
id|data
comma
r_int
id|trk
comma
r_int
id|totrk
comma
r_int
id|cmd
comma
id|dasd_information_t
op_star
id|info
)paren
(brace
id|ch_t
id|geo
comma
id|beg
comma
id|end
suffix:semicolon
id|geo.cyl
op_assign
id|info-&gt;rdc_data-&gt;eckd.no_cyl
suffix:semicolon
id|geo.head
op_assign
id|info-&gt;rdc_data-&gt;eckd.trk_per_cyl
suffix:semicolon
id|beg.cyl
op_assign
id|trk
op_div
id|geo.head
suffix:semicolon
id|beg.head
op_assign
id|trk
op_mod
id|geo.head
suffix:semicolon
id|end.cyl
op_assign
id|totrk
op_div
id|geo.head
suffix:semicolon
id|end.head
op_assign
id|totrk
op_mod
id|geo.head
suffix:semicolon
id|memset
(paren
id|de_ccw
comma
l_int|0
comma
r_sizeof
(paren
id|ccw1_t
)paren
)paren
suffix:semicolon
id|de_ccw-&gt;cmd_code
op_assign
id|CCW_DEFINE_EXTENT
suffix:semicolon
id|de_ccw-&gt;count
op_assign
l_int|16
suffix:semicolon
id|de_ccw-&gt;cda
op_assign
(paren
r_void
op_star
)paren
id|virt_to_phys
(paren
id|data
)paren
suffix:semicolon
id|memset
(paren
id|data
comma
l_int|0
comma
r_sizeof
(paren
id|DE_eckd_data_t
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|DASD_ECKD_CCW_READ_HOME_ADDRESS
suffix:colon
r_case
id|DASD_ECKD_CCW_READ_RECORD_ZERO
suffix:colon
r_case
id|DASD_ECKD_CCW_READ
suffix:colon
r_case
id|DASD_ECKD_CCW_READ_MT
suffix:colon
r_case
id|DASD_ECKD_CCW_READ_CKD
suffix:colon
multiline_comment|/* Fallthrough */
r_case
id|DASD_ECKD_CCW_READ_CKD_MT
suffix:colon
r_case
id|DASD_ECKD_CCW_READ_COUNT
suffix:colon
id|data-&gt;mask.perm
op_assign
l_int|0x1
suffix:semicolon
id|data-&gt;attributes.operation
op_assign
l_int|0x3
suffix:semicolon
multiline_comment|/* enable seq. caching */
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_WRITE
suffix:colon
r_case
id|DASD_ECKD_CCW_WRITE_MT
suffix:colon
id|data-&gt;attributes.operation
op_assign
l_int|0x3
suffix:semicolon
multiline_comment|/* enable seq. caching */
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_WRITE_CKD
suffix:colon
r_case
id|DASD_ECKD_CCW_WRITE_CKD_MT
suffix:colon
id|data-&gt;attributes.operation
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* format through cache */
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_WRITE_HOME_ADDRESS
suffix:colon
r_case
id|DASD_ECKD_CCW_WRITE_RECORD_ZERO
suffix:colon
id|data-&gt;mask.perm
op_assign
l_int|0x3
suffix:semicolon
id|data-&gt;mask.auth
op_assign
l_int|0x1
suffix:semicolon
id|data-&gt;attributes.operation
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* format through cache */
r_break
suffix:semicolon
r_default
suffix:colon
id|INTERNAL_ERROR
(paren
l_string|&quot;unknown opcode 0x%x&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|data-&gt;attributes.mode
op_assign
l_int|0x3
suffix:semicolon
id|data-&gt;beg_ext.cyl
op_assign
id|beg.cyl
suffix:semicolon
id|data-&gt;beg_ext.head
op_assign
id|beg.head
suffix:semicolon
id|data-&gt;end_ext.cyl
op_assign
id|end.cyl
suffix:semicolon
id|data-&gt;end_ext.head
op_assign
id|end.head
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|locate_record
id|locate_record
(paren
id|ccw1_t
op_star
id|lo_ccw
comma
id|LO_eckd_data_t
op_star
id|data
comma
r_int
id|trk
comma
r_int
id|rec_on_trk
comma
r_int
id|no_rec
comma
r_int
id|cmd
comma
id|dasd_information_t
op_star
id|info
)paren
(brace
id|ch_t
id|geo
op_assign
(brace
id|info-&gt;rdc_data-&gt;eckd.no_cyl
comma
id|info-&gt;rdc_data-&gt;eckd.trk_per_cyl
)brace
suffix:semicolon
id|ch_t
id|seek
op_assign
(brace
id|trk
op_div
(paren
id|geo.head
)paren
comma
id|trk
op_mod
(paren
id|geo.head
)paren
)brace
suffix:semicolon
r_int
id|reclen
op_assign
id|info-&gt;sizes.bp_block
suffix:semicolon
id|memset
(paren
id|lo_ccw
comma
l_int|0
comma
r_sizeof
(paren
id|ccw1_t
)paren
)paren
suffix:semicolon
id|lo_ccw-&gt;cmd_code
op_assign
id|DASD_ECKD_CCW_LOCATE_RECORD
suffix:semicolon
id|lo_ccw-&gt;count
op_assign
l_int|16
suffix:semicolon
id|lo_ccw-&gt;cda
op_assign
(paren
r_void
op_star
)paren
id|virt_to_phys
(paren
id|data
)paren
suffix:semicolon
id|memset
(paren
id|data
comma
l_int|0
comma
r_sizeof
(paren
id|LO_eckd_data_t
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|DASD_ECKD_CCW_WRITE_HOME_ADDRESS
suffix:colon
id|data-&gt;operation.orientation
op_assign
l_int|0x3
suffix:semicolon
id|data-&gt;operation.operation
op_assign
l_int|0x03
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_READ_HOME_ADDRESS
suffix:colon
id|data-&gt;operation.orientation
op_assign
l_int|0x3
suffix:semicolon
id|data-&gt;operation.operation
op_assign
l_int|0x16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_WRITE_RECORD_ZERO
suffix:colon
id|data-&gt;operation.orientation
op_assign
l_int|0x3
suffix:semicolon
id|data-&gt;operation.operation
op_assign
l_int|0x03
suffix:semicolon
id|data-&gt;count
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_READ_RECORD_ZERO
suffix:colon
id|data-&gt;operation.orientation
op_assign
l_int|0x3
suffix:semicolon
id|data-&gt;operation.operation
op_assign
l_int|0x16
suffix:semicolon
id|data-&gt;count
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_WRITE
suffix:colon
r_case
id|DASD_ECKD_CCW_WRITE_MT
suffix:colon
id|data-&gt;auxiliary.last_bytes_used
op_assign
l_int|0x1
suffix:semicolon
id|data-&gt;length
op_assign
id|reclen
suffix:semicolon
id|data-&gt;operation.operation
op_assign
l_int|0x01
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_WRITE_CKD
suffix:colon
r_case
id|DASD_ECKD_CCW_WRITE_CKD_MT
suffix:colon
id|data-&gt;auxiliary.last_bytes_used
op_assign
l_int|0x1
suffix:semicolon
id|data-&gt;length
op_assign
id|reclen
suffix:semicolon
id|data-&gt;operation.operation
op_assign
l_int|0x03
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_READ
suffix:colon
r_case
id|DASD_ECKD_CCW_READ_MT
suffix:colon
id|data-&gt;auxiliary.last_bytes_used
op_assign
l_int|0x1
suffix:semicolon
id|data-&gt;length
op_assign
id|reclen
suffix:semicolon
id|data-&gt;operation.operation
op_assign
l_int|0x06
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_READ_CKD
suffix:colon
r_case
id|DASD_ECKD_CCW_READ_CKD_MT
suffix:colon
id|data-&gt;auxiliary.last_bytes_used
op_assign
l_int|0x1
suffix:semicolon
id|data-&gt;length
op_assign
id|reclen
suffix:semicolon
id|data-&gt;operation.operation
op_assign
l_int|0x16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DASD_ECKD_CCW_READ_COUNT
suffix:colon
id|data-&gt;operation.operation
op_assign
l_int|0x06
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|INTERNAL_ERROR
(paren
l_string|&quot;unknown opcode 0x%x&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
)brace
id|memcpy
(paren
op_amp
(paren
id|data-&gt;seek_addr
)paren
comma
op_amp
id|seek
comma
r_sizeof
(paren
id|ch_t
)paren
)paren
suffix:semicolon
id|memcpy
(paren
op_amp
(paren
id|data-&gt;search_arg
)paren
comma
op_amp
id|seek
comma
r_sizeof
(paren
id|ch_t
)paren
)paren
suffix:semicolon
id|data-&gt;search_arg.record
op_assign
id|rec_on_trk
suffix:semicolon
id|data-&gt;count
op_add_assign
id|no_rec
suffix:semicolon
)brace
r_void
DECL|function|dasd_eckd_print_error
id|dasd_eckd_print_error
(paren
id|devstat_t
op_star
id|stat
)paren
(brace
r_int
id|sct
comma
id|sl
suffix:semicolon
r_char
op_star
id|sense
op_assign
id|stat-&gt;ii.sense.data
suffix:semicolon
id|PRINT_WARN
(paren
l_string|&quot;IRQ on devno %x: with intparm:%x DS:0x%02x CS:0x%02x&bslash;n&quot;
comma
id|stat-&gt;devno
comma
id|stat-&gt;intparm
comma
id|stat-&gt;dstat
comma
id|stat-&gt;cstat
)paren
suffix:semicolon
id|PRINT_WARN
(paren
l_string|&quot;Failing CCW: %p&bslash;n&quot;
comma
(paren
id|ccw1_t
op_star
)paren
id|stat-&gt;cpa
)paren
suffix:semicolon
r_for
c_loop
(paren
id|sl
op_assign
l_int|0
suffix:semicolon
id|sl
OL
l_int|4
suffix:semicolon
id|sl
op_increment
)paren
(brace
id|PRINT_DEBUG
(paren
l_string|&quot;Sense:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|sct
op_assign
l_int|0
suffix:semicolon
id|sct
OL
l_int|8
suffix:semicolon
id|sct
op_increment
)paren
(brace
id|printk
(paren
l_string|&quot; %2d:0x%02x&quot;
comma
l_int|8
op_star
id|sl
op_plus
id|sct
comma
id|sense
(braket
l_int|8
op_star
id|sl
op_plus
id|sct
)braket
)paren
suffix:semicolon
)brace
id|printk
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sense
(braket
l_int|27
)braket
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* 32 Byte Sense Data */
id|PRINT_INFO
(paren
l_string|&quot;Sense Data is 32 Byte information&bslash;n&quot;
)paren
suffix:semicolon
id|PRINT_INFO
(paren
l_string|&quot;Format: %x Exception class %x&bslash;n&quot;
comma
id|sense
(braket
l_int|6
)braket
op_amp
l_int|0x0f
comma
id|sense
(braket
l_int|22
)braket
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 24 Byte Sense Data */
id|PRINT_INFO
(paren
l_string|&quot;Sense Data is 24 Byte information&bslash;n&quot;
)paren
suffix:semicolon
id|PRINT_INFO
(paren
l_string|&quot;FMT: %x MSG %x, %s MSGb to SYSOP&bslash;n&quot;
comma
id|sense
(braket
l_int|7
)braket
op_rshift
l_int|4
comma
id|sense
(braket
l_int|7
)braket
op_amp
l_int|0x0f
comma
id|sense
(braket
l_int|1
)braket
op_amp
l_int|0x10
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
suffix:semicolon
)brace
)brace
r_int
DECL|function|dasd_eckd_format_track
id|dasd_eckd_format_track
(paren
r_int
id|di
comma
r_int
id|trk
comma
r_int
id|bs
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|flags
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* FORMAT_R0 = 0x01, FORMAT_HA = 0x03 */
id|dasd_information_t
op_star
id|info
op_assign
id|dasd_info
(braket
id|di
)braket
suffix:semicolon
id|cqr_t
op_star
id|fcp
suffix:semicolon
id|DE_eckd_data_t
op_star
id|DE_data
suffix:semicolon
id|LO_eckd_data_t
op_star
id|LO_data
suffix:semicolon
id|eckd_count_t
op_star
id|ct_data
suffix:semicolon
id|eckd_count_t
op_star
id|r0_data
suffix:semicolon
id|ccw1_t
op_star
id|last_ccw
suffix:semicolon
r_int
id|retries
op_assign
l_int|5
suffix:semicolon
r_int
id|rpt
op_assign
id|recs_per_track
(paren
op_amp
(paren
id|info-&gt;rdc_data-&gt;eckd
)paren
comma
l_int|0
comma
id|bs
)paren
suffix:semicolon
r_int
id|cyl
op_assign
id|trk
op_div
id|info-&gt;rdc_data-&gt;eckd.trk_per_cyl
suffix:semicolon
r_int
id|head
op_assign
id|trk
op_mod
id|info-&gt;rdc_data-&gt;eckd.trk_per_cyl
suffix:semicolon
id|fcp
op_assign
id|request_cqr
(paren
l_int|2
op_plus
l_int|1
op_plus
id|rpt
comma
r_sizeof
(paren
id|DE_eckd_data_t
)paren
op_plus
r_sizeof
(paren
id|LO_eckd_data_t
)paren
op_plus
(paren
id|rpt
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
id|eckd_count_t
)paren
)paren
suffix:semicolon
id|fcp
op_member_access_from_pointer
id|devindex
op_assign
id|di
suffix:semicolon
id|DE_data
op_assign
(paren
id|DE_eckd_data_t
op_star
)paren
id|fcp-&gt;data
suffix:semicolon
id|LO_data
op_assign
(paren
id|LO_eckd_data_t
op_star
)paren
(paren
(paren
(paren
r_int
)paren
id|DE_data
)paren
op_plus
r_sizeof
(paren
id|DE_eckd_data_t
)paren
)paren
suffix:semicolon
id|r0_data
op_assign
(paren
id|eckd_count_t
op_star
)paren
(paren
(paren
(paren
r_int
)paren
id|LO_data
)paren
op_plus
r_sizeof
(paren
id|LO_eckd_data_t
)paren
)paren
suffix:semicolon
id|ct_data
op_assign
(paren
id|eckd_count_t
op_star
)paren
(paren
(paren
(paren
r_int
)paren
id|r0_data
)paren
op_plus
r_sizeof
(paren
id|eckd_count_t
)paren
)paren
suffix:semicolon
id|last_ccw
op_assign
id|fcp-&gt;cpaddr
suffix:semicolon
r_switch
c_cond
(paren
id|flags
)paren
(brace
r_case
l_int|0x03
suffix:colon
id|define_extent
(paren
id|last_ccw
comma
id|DE_data
comma
id|trk
comma
id|trk
comma
id|DASD_ECKD_CCW_WRITE_HOME_ADDRESS
comma
id|info
)paren
suffix:semicolon
id|last_ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
id|last_ccw
op_increment
suffix:semicolon
id|locate_record
(paren
id|last_ccw
comma
id|LO_data
comma
id|trk
comma
l_int|0
comma
id|rpt
comma
id|DASD_ECKD_CCW_WRITE_HOME_ADDRESS
comma
id|info
)paren
suffix:semicolon
id|last_ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
id|last_ccw
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x01
suffix:colon
id|define_extent
(paren
id|last_ccw
comma
id|DE_data
comma
id|trk
comma
id|trk
comma
id|DASD_ECKD_CCW_WRITE_RECORD_ZERO
comma
id|info
)paren
suffix:semicolon
id|last_ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
id|last_ccw
op_increment
suffix:semicolon
id|locate_record
(paren
id|last_ccw
comma
id|LO_data
comma
id|trk
comma
l_int|0
comma
id|rpt
comma
id|DASD_ECKD_CCW_WRITE_RECORD_ZERO
comma
id|info
)paren
suffix:semicolon
id|last_ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
id|last_ccw
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x00
suffix:colon
id|define_extent
(paren
id|last_ccw
comma
id|DE_data
comma
id|trk
comma
id|trk
comma
id|DASD_ECKD_CCW_WRITE_CKD
comma
id|info
)paren
suffix:semicolon
id|last_ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
id|last_ccw
op_increment
suffix:semicolon
id|locate_record
(paren
id|last_ccw
comma
id|LO_data
comma
id|trk
comma
l_int|0
comma
id|rpt
comma
id|DASD_ECKD_CCW_WRITE_CKD
comma
id|info
)paren
suffix:semicolon
id|LO_data-&gt;length
op_assign
id|bs
suffix:semicolon
id|last_ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
id|last_ccw
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|PRINT_WARN
(paren
l_string|&quot;Unknown format flags...%d&bslash;n&quot;
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
l_int|0x02
)paren
(brace
id|PRINT_WARN
(paren
l_string|&quot;Unsupported format flag...%d&bslash;n&quot;
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
l_int|0x01
)paren
(brace
multiline_comment|/* write record zero */
id|memset
(paren
id|r0_data
comma
l_int|0
comma
r_sizeof
(paren
id|eckd_count_t
)paren
)paren
suffix:semicolon
id|r0_data-&gt;cyl
op_assign
id|cyl
suffix:semicolon
id|r0_data-&gt;head
op_assign
id|head
suffix:semicolon
id|r0_data-&gt;record
op_assign
l_int|0
suffix:semicolon
id|r0_data-&gt;kl
op_assign
l_int|0
suffix:semicolon
id|r0_data-&gt;dl
op_assign
l_int|8
suffix:semicolon
id|last_ccw-&gt;cmd_code
op_assign
l_int|0x03
suffix:semicolon
id|last_ccw-&gt;count
op_assign
l_int|8
suffix:semicolon
id|last_ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
op_or
id|CCW_FLAG_SLI
suffix:semicolon
id|last_ccw-&gt;cda
op_assign
(paren
r_void
op_star
)paren
id|virt_to_phys
(paren
id|r0_data
)paren
suffix:semicolon
id|last_ccw
op_increment
suffix:semicolon
)brace
multiline_comment|/* write remaining records */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rpt
suffix:semicolon
id|i
op_increment
comma
id|last_ccw
op_increment
)paren
(brace
id|memset
(paren
id|ct_data
op_plus
id|i
comma
l_int|0
comma
r_sizeof
(paren
id|eckd_count_t
)paren
)paren
suffix:semicolon
(paren
id|ct_data
op_plus
id|i
)paren
op_member_access_from_pointer
id|cyl
op_assign
id|cyl
suffix:semicolon
(paren
id|ct_data
op_plus
id|i
)paren
op_member_access_from_pointer
id|head
op_assign
id|head
suffix:semicolon
(paren
id|ct_data
op_plus
id|i
)paren
op_member_access_from_pointer
id|record
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
(paren
id|ct_data
op_plus
id|i
)paren
op_member_access_from_pointer
id|kl
op_assign
l_int|0
suffix:semicolon
(paren
id|ct_data
op_plus
id|i
)paren
op_member_access_from_pointer
id|dl
op_assign
id|bs
suffix:semicolon
id|last_ccw-&gt;cmd_code
op_assign
id|DASD_ECKD_CCW_WRITE_CKD
suffix:semicolon
id|last_ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
op_or
id|CCW_FLAG_SLI
suffix:semicolon
id|last_ccw-&gt;count
op_assign
l_int|8
suffix:semicolon
id|last_ccw-&gt;cda
op_assign
(paren
r_void
op_star
)paren
id|virt_to_phys
(paren
id|ct_data
op_plus
id|i
)paren
suffix:semicolon
)brace
(paren
id|last_ccw
op_minus
l_int|1
)paren
op_member_access_from_pointer
id|flags
op_and_assign
op_complement
(paren
id|CCW_FLAG_CC
op_or
id|CCW_FLAG_DC
)paren
suffix:semicolon
id|fcp
op_member_access_from_pointer
id|devindex
op_assign
id|di
suffix:semicolon
id|fcp
op_member_access_from_pointer
id|flags
op_assign
id|DASD_DO_IO_SLEEP
suffix:semicolon
r_do
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
id|cs
suffix:semicolon
id|irq
op_assign
id|dasd_info
(braket
id|fcp-&gt;devindex
)braket
op_member_access_from_pointer
id|info.irq
suffix:semicolon
id|s390irq_spin_lock_irqsave
(paren
id|irq
comma
id|flags
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|fcp-&gt;status
comma
id|CQR_STATUS_QUEUED
)paren
suffix:semicolon
id|rc
op_assign
id|dasd_start_IO
(paren
id|fcp
)paren
suffix:semicolon
id|add_wait_queue
(paren
op_amp
id|dasd_waitq
comma
op_amp
id|wait
)paren
suffix:semicolon
r_do
(brace
id|current-&gt;state
op_assign
id|TASK_UNINTERRUPTIBLE
suffix:semicolon
id|s390irq_spin_unlock_irqrestore
(paren
id|irq
comma
id|flags
)paren
suffix:semicolon
id|schedule
(paren
)paren
suffix:semicolon
id|s390irq_spin_lock_irqsave
(paren
id|irq
comma
id|flags
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
(paren
id|cs
op_assign
id|atomic_read
(paren
op_amp
id|fcp-&gt;status
)paren
)paren
op_ne
id|CQR_STATUS_DONE
)paren
op_logical_and
(paren
id|cs
op_ne
id|CQR_STATUS_ERROR
)paren
)paren
suffix:semicolon
id|remove_wait_queue
(paren
op_amp
id|dasd_waitq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|s390irq_spin_unlock_irqrestore
(paren
id|irq
comma
id|flags
)paren
suffix:semicolon
id|retries
op_decrement
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|rc
op_logical_or
(paren
id|atomic_read
c_func
(paren
op_amp
id|fcp-&gt;status
)paren
op_ne
id|CQR_STATUS_DONE
)paren
)paren
op_logical_and
id|retries
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_logical_or
(paren
id|atomic_read
c_func
(paren
op_amp
id|fcp-&gt;status
)paren
op_ne
id|CQR_STATUS_DONE
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|release_cqr
(paren
id|fcp
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|dasd_eckd_ck_devinfo
id|dasd_eckd_ck_devinfo
(paren
id|dev_info_t
op_star
id|info
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|cqr_t
op_star
DECL|function|dasd_eckd_build_req
id|dasd_eckd_build_req
(paren
r_int
id|devindex
comma
r_struct
id|request
op_star
id|req
)paren
(brace
id|cqr_t
op_star
id|rw_cp
op_assign
l_int|NULL
suffix:semicolon
id|ccw1_t
op_star
id|ccw
suffix:semicolon
id|DE_eckd_data_t
op_star
id|DE_data
suffix:semicolon
id|LO_eckd_data_t
op_star
id|LO_data
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
r_int
id|rw_cmd
suffix:semicolon
id|dasd_information_t
op_star
id|info
op_assign
id|dasd_info
(braket
id|devindex
)braket
suffix:semicolon
r_int
id|blk_per_trk
op_assign
id|recs_per_track
(paren
op_amp
(paren
id|info-&gt;rdc_data-&gt;eckd
)paren
comma
l_int|0
comma
id|info-&gt;sizes.bp_block
)paren
suffix:semicolon
r_int
id|byt_per_blk
op_assign
id|info-&gt;sizes.bp_block
suffix:semicolon
r_int
id|noblk
op_assign
id|req
op_member_access_from_pointer
id|nr_sectors
op_rshift
id|info-&gt;sizes.s2b_shift
suffix:semicolon
r_int
id|btrk
op_assign
(paren
id|req-&gt;sector
op_rshift
id|info-&gt;sizes.s2b_shift
)paren
op_div
id|blk_per_trk
suffix:semicolon
r_int
id|etrk
op_assign
(paren
(paren
id|req-&gt;sector
op_plus
id|req-&gt;nr_sectors
op_minus
l_int|1
)paren
op_rshift
id|info-&gt;sizes.s2b_shift
)paren
op_div
id|blk_per_trk
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|noblk
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;No blocks to write...returning&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|req-&gt;cmd
op_eq
id|READ
)paren
(brace
id|rw_cmd
op_assign
id|DASD_ECKD_CCW_READ_MT
suffix:semicolon
)brace
r_else
macro_line|#if DASD_PARANOIA &gt; 2
r_if
c_cond
(paren
id|req-&gt;cmd
op_eq
id|WRITE
)paren
macro_line|#endif&t;&t;&t;&t;/* DASD_PARANOIA */
(brace
id|rw_cmd
op_assign
id|DASD_ECKD_CCW_WRITE_MT
suffix:semicolon
)brace
macro_line|#if DASD_PARANOIA &gt; 2
r_else
(brace
id|PRINT_ERR
(paren
l_string|&quot;Unknown command %d&bslash;n&quot;
comma
id|req-&gt;cmd
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;&t;/* DASD_PARANOIA */
multiline_comment|/* Build the request */
id|rw_cp
op_assign
id|request_cqr
(paren
l_int|2
op_plus
id|noblk
comma
r_sizeof
(paren
id|DE_eckd_data_t
)paren
op_plus
r_sizeof
(paren
id|LO_eckd_data_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rw_cp
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|DE_data
op_assign
id|rw_cp-&gt;data
suffix:semicolon
id|LO_data
op_assign
id|rw_cp-&gt;data
op_plus
r_sizeof
(paren
id|DE_eckd_data_t
)paren
suffix:semicolon
id|ccw
op_assign
id|rw_cp-&gt;cpaddr
suffix:semicolon
id|define_extent
(paren
id|ccw
comma
id|DE_data
comma
id|btrk
comma
id|etrk
comma
id|rw_cmd
comma
id|info
)paren
suffix:semicolon
id|ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
id|ccw
op_increment
suffix:semicolon
id|locate_record
(paren
id|ccw
comma
id|LO_data
comma
id|btrk
comma
(paren
id|req-&gt;sector
op_rshift
id|info-&gt;sizes.s2b_shift
)paren
op_mod
id|blk_per_trk
op_plus
l_int|1
comma
id|req-&gt;nr_sectors
op_rshift
id|info-&gt;sizes.s2b_shift
comma
id|rw_cmd
comma
id|info
)paren
suffix:semicolon
id|ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
r_for
c_loop
(paren
id|bh
op_assign
id|req-&gt;bh
suffix:semicolon
id|bh
suffix:semicolon
id|bh
op_assign
id|bh-&gt;b_reqnext
)paren
(brace
r_int
id|size
suffix:semicolon
r_for
c_loop
(paren
id|size
op_assign
l_int|0
suffix:semicolon
id|size
OL
id|bh-&gt;b_size
suffix:semicolon
id|size
op_add_assign
id|byt_per_blk
)paren
(brace
id|ccw
op_increment
suffix:semicolon
id|ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
id|ccw-&gt;cmd_code
op_assign
id|rw_cmd
suffix:semicolon
id|ccw-&gt;count
op_assign
id|byt_per_blk
suffix:semicolon
id|ccw-&gt;cda
op_assign
(paren
r_void
op_star
)paren
id|virt_to_phys
(paren
id|bh-&gt;b_data
op_plus
id|size
)paren
suffix:semicolon
)brace
)brace
id|ccw-&gt;flags
op_and_assign
op_complement
(paren
id|CCW_FLAG_DC
op_or
id|CCW_FLAG_CC
)paren
suffix:semicolon
r_return
id|rw_cp
suffix:semicolon
)brace
id|cqr_t
op_star
DECL|function|dasd_eckd_rw_label
id|dasd_eckd_rw_label
(paren
r_int
id|devindex
comma
r_int
id|rw
comma
r_char
op_star
id|buffer
)paren
(brace
r_int
id|cmd_code
op_assign
l_int|0x03
suffix:semicolon
id|dasd_information_t
op_star
id|info
op_assign
id|dasd_info
(braket
id|devindex
)braket
suffix:semicolon
id|cqr_t
op_star
id|cqr
suffix:semicolon
id|ccw1_t
op_star
id|ccw
suffix:semicolon
r_switch
c_cond
(paren
id|rw
)paren
(brace
r_case
id|READ
suffix:colon
id|cmd_code
op_assign
id|DASD_ECKD_CCW_READ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WRITE
suffix:colon
id|cmd_code
op_assign
id|DASD_ECKD_CCW_WRITE
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if DASD_PARANOIA &gt; 2
r_default
suffix:colon
id|INTERNAL_ERROR
(paren
l_string|&quot;unknown cmd %d&quot;
comma
id|rw
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* DASD_PARANOIA */
)brace
id|cqr
op_assign
id|request_cqr
(paren
l_int|3
comma
r_sizeof
(paren
id|DE_eckd_data_t
)paren
op_plus
r_sizeof
(paren
id|LO_eckd_data_t
)paren
)paren
suffix:semicolon
id|ccw
op_assign
id|cqr-&gt;cpaddr
suffix:semicolon
id|define_extent
(paren
id|ccw
comma
id|cqr-&gt;data
comma
l_int|0
comma
l_int|0
comma
id|cmd_code
comma
id|info
)paren
suffix:semicolon
id|ccw-&gt;flags
op_or_assign
id|CCW_FLAG_CC
suffix:semicolon
id|ccw
op_increment
suffix:semicolon
id|locate_record
(paren
id|ccw
comma
id|cqr-&gt;data
op_plus
l_int|1
comma
l_int|0
comma
l_int|2
comma
l_int|1
comma
id|cmd_code
comma
id|info
)paren
suffix:semicolon
id|ccw-&gt;flags
op_or_assign
id|CCW_FLAG_CC
suffix:semicolon
id|ccw
op_increment
suffix:semicolon
id|ccw-&gt;cmd_code
op_assign
id|cmd_code
suffix:semicolon
id|ccw-&gt;flags
op_or_assign
id|CCW_FLAG_SLI
suffix:semicolon
id|ccw-&gt;count
op_assign
r_sizeof
(paren
id|dasd_volume_label_t
)paren
suffix:semicolon
id|ccw-&gt;cda
op_assign
(paren
r_void
op_star
)paren
id|virt_to_phys
(paren
(paren
r_void
op_star
)paren
id|buffer
)paren
suffix:semicolon
r_return
id|cqr
suffix:semicolon
)brace
r_void
DECL|function|dasd_eckd_print_char
id|dasd_eckd_print_char
(paren
id|dasd_characteristics_t
op_star
id|i
)paren
(brace
id|dasd_eckd_characteristics_t
op_star
id|c
op_assign
(paren
id|dasd_eckd_characteristics_t
op_star
)paren
id|i
suffix:semicolon
id|PRINT_INFO
(paren
l_string|&quot;%x/%x (%x/%x) Cyl: %d Head: %d Sec: %d &bslash;n&quot;
comma
id|c-&gt;dev_type
comma
id|c-&gt;dev_model
comma
id|c-&gt;cu_type
comma
id|c-&gt;cu_model.model
comma
id|c-&gt;no_cyl
comma
id|c-&gt;trk_per_cyl
comma
id|c-&gt;sec_per_trk
)paren
suffix:semicolon
id|PRINT_INFO
(paren
l_string|&quot;Estimate: %d Byte/trk %d byte/kByte %d kByte/trk &bslash;n&quot;
comma
id|bytes_per_track
(paren
id|c
)paren
comma
id|bytes_per_record
(paren
id|c
comma
l_int|0
comma
l_int|1024
)paren
comma
id|recs_per_track
(paren
id|c
comma
l_int|0
comma
l_int|1024
)paren
)paren
suffix:semicolon
)brace
suffix:semicolon
r_int
DECL|function|dasd_eckd_ck_char
id|dasd_eckd_ck_char
(paren
id|dasd_characteristics_t
op_star
id|i
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|dasd_eckd_print_char
(paren
id|i
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|dasd_eckd_format
id|dasd_eckd_format
(paren
r_int
id|devindex
comma
id|format_data_t
op_star
id|fdata
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dasd_information_t
op_star
id|info
op_assign
id|dasd_info
(braket
id|devindex
)braket
suffix:semicolon
id|format_data_t
id|fd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fdata
)paren
(brace
id|fd.start_unit
op_assign
l_int|0
suffix:semicolon
id|fd.stop_unit
op_assign
id|info-&gt;rdc_data-&gt;eckd.no_cyl
op_star
id|info-&gt;rdc_data-&gt;eckd.trk_per_cyl
op_minus
l_int|1
suffix:semicolon
id|fd.blksize
op_assign
l_int|4096
suffix:semicolon
)brace
r_else
(brace
id|memcpy
(paren
op_amp
id|fd
comma
id|fdata
comma
r_sizeof
(paren
id|format_data_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fd.stop_unit
op_eq
op_minus
l_int|1
)paren
(brace
id|fd.stop_unit
op_assign
id|info-&gt;rdc_data-&gt;eckd.no_cyl
op_star
id|info-&gt;rdc_data-&gt;eckd.trk_per_cyl
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fd.blksize
op_eq
l_int|0
)paren
(brace
id|fd.blksize
op_assign
l_int|4096
suffix:semicolon
)brace
)brace
id|PRINT_INFO
c_func
(paren
l_string|&quot;Formatting device %d from %d to %d with bs %d&bslash;n&quot;
comma
id|devindex
comma
id|fd.start_unit
comma
id|fd.stop_unit
comma
id|fd.blksize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fd.start_unit
OG
id|fd.stop_unit
)paren
(brace
id|PRINT_WARN
(paren
l_string|&quot;start unit .gt. stop unit&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fd.start_unit
OG
id|info-&gt;rdc_data-&gt;eckd.no_cyl
op_star
id|info-&gt;rdc_data-&gt;eckd.trk_per_cyl
op_minus
l_int|1
)paren
)paren
(brace
id|PRINT_WARN
(paren
l_string|&quot;start unit beyond end of disk&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fd.stop_unit
OG
id|info-&gt;rdc_data-&gt;eckd.no_cyl
op_star
id|info-&gt;rdc_data-&gt;eckd.trk_per_cyl
op_minus
l_int|1
)paren
)paren
(brace
id|PRINT_WARN
(paren
l_string|&quot;stop unit beyond end of disk&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|fd.blksize
)paren
(brace
r_case
l_int|512
suffix:colon
r_case
l_int|1024
suffix:colon
r_case
l_int|2048
suffix:colon
r_case
l_int|4096
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|PRINT_WARN
(paren
l_string|&quot;invalid blocksize&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|fd.start_unit
suffix:semicolon
id|i
op_le
id|fd.stop_unit
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* print 20 messages per disk at all */
r_if
c_cond
(paren
op_logical_neg
(paren
id|i
op_mod
(paren
id|info-&gt;rdc_data-&gt;eckd.trk_per_cyl
op_star
(paren
id|info-&gt;rdc_data-&gt;eckd.no_cyl
op_div
l_int|20
)paren
)paren
)paren
)paren
(brace
id|PRINT_INFO
(paren
l_string|&quot;Format %d Cylinder: %d&bslash;n&quot;
comma
id|devindex
comma
id|i
op_div
id|info-&gt;rdc_data-&gt;eckd.trk_per_cyl
)paren
suffix:semicolon
)brace
id|rc
op_assign
id|dasd_eckd_format_track
(paren
id|devindex
comma
id|i
comma
id|fd.blksize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
(paren
l_string|&quot;Formatting of Track %d failed...exiting&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|PRINT_INFO
c_func
(paren
l_string|&quot;Formated device %d from %d to %d with bs %d&bslash;n&quot;
comma
id|devindex
comma
id|fd.start_unit
comma
id|fd.stop_unit
comma
id|fd.blksize
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|cqr_t
op_star
DECL|function|dasd_eckd_fill_sizes_first
id|dasd_eckd_fill_sizes_first
(paren
r_int
id|di
)paren
(brace
id|cqr_t
op_star
id|rw_cp
op_assign
l_int|NULL
suffix:semicolon
id|ccw1_t
op_star
id|ccw
suffix:semicolon
id|DE_eckd_data_t
op_star
id|DE_data
suffix:semicolon
id|LO_eckd_data_t
op_star
id|LO_data
suffix:semicolon
id|dasd_information_t
op_star
id|info
op_assign
id|dasd_info
(braket
id|di
)braket
suffix:semicolon
id|eckd_count_t
op_star
id|count_data
op_assign
op_amp
(paren
id|info
op_member_access_from_pointer
r_private
dot
id|eckd.count_data
)paren
suffix:semicolon
id|rw_cp
op_assign
id|request_cqr
(paren
l_int|3
comma
r_sizeof
(paren
id|DE_eckd_data_t
)paren
op_plus
r_sizeof
(paren
id|LO_eckd_data_t
)paren
)paren
suffix:semicolon
id|DE_data
op_assign
id|rw_cp-&gt;data
suffix:semicolon
id|LO_data
op_assign
id|rw_cp-&gt;data
op_plus
r_sizeof
(paren
id|DE_eckd_data_t
)paren
suffix:semicolon
id|ccw
op_assign
id|rw_cp-&gt;cpaddr
suffix:semicolon
id|define_extent
(paren
id|ccw
comma
id|DE_data
comma
l_int|0
comma
l_int|0
comma
id|DASD_ECKD_CCW_READ_COUNT
comma
id|info
)paren
suffix:semicolon
id|ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
id|ccw
op_increment
suffix:semicolon
id|locate_record
(paren
id|ccw
comma
id|LO_data
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
id|DASD_ECKD_CCW_READ_COUNT
comma
id|info
)paren
suffix:semicolon
id|ccw-&gt;flags
op_assign
id|CCW_FLAG_CC
suffix:semicolon
id|ccw
op_increment
suffix:semicolon
id|ccw-&gt;cmd_code
op_assign
id|DASD_ECKD_CCW_READ_COUNT
suffix:semicolon
id|ccw-&gt;count
op_assign
l_int|8
suffix:semicolon
id|ccw-&gt;cda
op_assign
(paren
r_void
op_star
)paren
id|__pa
(paren
id|count_data
)paren
suffix:semicolon
id|rw_cp-&gt;devindex
op_assign
id|di
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|rw_cp-&gt;status
comma
id|CQR_STATUS_FILLED
)paren
suffix:semicolon
r_return
id|rw_cp
suffix:semicolon
)brace
DECL|function|dasd_eckd_fill_sizes_last
r_int
id|dasd_eckd_fill_sizes_last
(paren
r_int
id|devindex
)paren
(brace
r_int
id|sb
suffix:semicolon
id|dasd_information_t
op_star
id|in
op_assign
id|dasd_info
(braket
id|devindex
)braket
suffix:semicolon
r_int
id|bs
op_assign
id|in
op_member_access_from_pointer
r_private
dot
id|eckd.count_data.dl
suffix:semicolon
r_if
c_cond
(paren
id|bs
op_le
l_int|0
)paren
(brace
id|PRINT_INFO
c_func
(paren
l_string|&quot;Cannot figure out blocksize. did you format the disk?&bslash;n&quot;
)paren
suffix:semicolon
id|memset
(paren
op_amp
(paren
id|in
op_member_access_from_pointer
id|sizes
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|dasd_sizes_t
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EMEDIUMTYPE
suffix:semicolon
)brace
r_else
(brace
id|in-&gt;sizes.bp_block
op_assign
id|bs
suffix:semicolon
)brace
id|in-&gt;sizes.bp_sector
op_assign
id|in-&gt;sizes.bp_block
suffix:semicolon
id|in-&gt;sizes.b2k_shift
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* bits to shift a block to get 1k */
r_for
c_loop
(paren
id|sb
op_assign
l_int|1024
suffix:semicolon
id|sb
OL
id|bs
suffix:semicolon
id|sb
op_assign
id|sb
op_lshift
l_int|1
)paren
id|in-&gt;sizes.b2k_shift
op_increment
suffix:semicolon
id|in-&gt;sizes.s2b_shift
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* bits to shift 512 to get a block */
r_for
c_loop
(paren
id|sb
op_assign
l_int|512
suffix:semicolon
id|sb
OL
id|bs
suffix:semicolon
id|sb
op_assign
id|sb
op_lshift
l_int|1
)paren
id|in-&gt;sizes.s2b_shift
op_increment
suffix:semicolon
id|in-&gt;sizes.blocks
op_assign
id|in-&gt;rdc_data-&gt;eckd.no_cyl
op_star
id|in-&gt;rdc_data-&gt;eckd.trk_per_cyl
op_star
id|recs_per_track
(paren
op_amp
(paren
id|in-&gt;rdc_data-&gt;eckd
)paren
comma
l_int|0
comma
id|bs
)paren
suffix:semicolon
id|in-&gt;sizes.kbytes
op_assign
id|in-&gt;sizes.blocks
op_lshift
id|in-&gt;sizes.b2k_shift
suffix:semicolon
id|PRINT_INFO
(paren
l_string|&quot;Verified: %d B/trk %d B/Blk(%d B) %d Blks/trk %d kB/trk &bslash;n&quot;
comma
id|bytes_per_track
(paren
op_amp
(paren
id|in-&gt;rdc_data-&gt;eckd
)paren
)paren
comma
id|bytes_per_record
(paren
op_amp
(paren
id|in-&gt;rdc_data-&gt;eckd
)paren
comma
l_int|0
comma
id|in-&gt;sizes.bp_block
)paren
comma
id|in-&gt;sizes.bp_block
comma
id|recs_per_track
(paren
op_amp
(paren
id|in-&gt;rdc_data-&gt;eckd
)paren
comma
l_int|0
comma
id|in-&gt;sizes.bp_block
)paren
comma
(paren
id|recs_per_track
(paren
op_amp
(paren
id|in-&gt;rdc_data-&gt;eckd
)paren
comma
l_int|0
comma
id|in-&gt;sizes.bp_block
)paren
op_lshift
id|in-&gt;sizes.b2k_shift
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|dasd_eckd_operations
id|dasd_operations_t
id|dasd_eckd_operations
op_assign
(brace
id|ck_devinfo
suffix:colon
id|dasd_eckd_ck_devinfo
comma
id|get_req_ccw
suffix:colon
id|dasd_eckd_build_req
comma
id|rw_label
suffix:colon
id|dasd_eckd_rw_label
comma
id|ck_characteristics
suffix:colon
id|dasd_eckd_ck_char
comma
id|fill_sizes_first
suffix:colon
id|dasd_eckd_fill_sizes_first
comma
id|fill_sizes_last
suffix:colon
id|dasd_eckd_fill_sizes_last
comma
id|dasd_format
suffix:colon
id|dasd_eckd_format
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-indent-level: 4 &n; * c-brace-imaginary-offset: 0&n; * c-brace-offset: -4&n; * c-argdecl-indent: 4&n; * c-label-offset: -4&n; * c-continued-statement-offset: 4&n; * c-continued-brace-offset: 0&n; * indent-tabs-mode: nil&n; * tab-width: 8&n; * End:&n; */
eof
