multiline_comment|/*&n;  Structure of the proc filesystem:&n;  /proc/dasd/&n;  /proc/dasd/devices                  # List of devices&n;  /proc/dasd/ddabcd                   # Device node for devno abcd            &n;  /proc/dasd/ddabcd1                  # Device node for partition abcd  &n;  /proc/dasd/abcd                     # Device information for devno abcd&n;*/
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/dasd.h&gt;
macro_line|#include &quot;dasd_types.h&quot;
r_int
id|dasd_proc_read_devices
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
suffix:semicolon
macro_line|#ifdef DASD_PROFILE
r_extern
r_int
id|dasd_proc_read_statistics
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|dasd_proc_read_debug
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
)paren
suffix:semicolon
macro_line|#endif /* DASD_PROFILE */
DECL|variable|dasd_proc_root_entry
r_struct
id|proc_dir_entry
id|dasd_proc_root_entry
op_assign
(brace
l_int|0
comma
l_int|4
comma
l_string|&quot;dasd&quot;
comma
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
op_or
id|S_IWUSR
op_or
id|S_IWGRP
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|dasd_proc_devices_entry
r_struct
id|proc_dir_entry
id|dasd_proc_devices_entry
op_assign
(brace
l_int|0
comma
l_int|7
comma
l_string|&quot;devices&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IXUGO
op_or
id|S_IWUSR
op_or
id|S_IWGRP
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|dasd_proc_read_devices
comma
)brace
suffix:semicolon
macro_line|#ifdef DASD_PROFILE
DECL|variable|dasd_proc_stats_entry
r_struct
id|proc_dir_entry
id|dasd_proc_stats_entry
op_assign
(brace
l_int|0
comma
l_int|10
comma
l_string|&quot;statistics&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IXUGO
op_or
id|S_IWUSR
op_or
id|S_IWGRP
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|dasd_proc_read_statistics
comma
)brace
suffix:semicolon
DECL|variable|dasd_proc_debug_entry
r_struct
id|proc_dir_entry
id|dasd_proc_debug_entry
op_assign
(brace
l_int|0
comma
l_int|5
comma
l_string|&quot;debug&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IXUGO
op_or
id|S_IWUSR
op_or
id|S_IWGRP
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|dasd_proc_read_debug
comma
)brace
suffix:semicolon
macro_line|#endif /* DASD_PROFILE */
DECL|variable|dasd_proc_device_template
r_struct
id|proc_dir_entry
id|dasd_proc_device_template
op_assign
(brace
l_int|0
comma
l_int|6
comma
l_string|&quot;dd????&quot;
comma
id|S_IFBLK
op_or
id|S_IRUGO
op_or
id|S_IWUSR
op_or
id|S_IWGRP
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
)brace
suffix:semicolon
r_void
DECL|function|dasd_proc_init
id|dasd_proc_init
(paren
r_void
)paren
(brace
id|proc_register
c_func
(paren
op_amp
id|proc_root
comma
op_amp
id|dasd_proc_root_entry
)paren
suffix:semicolon
id|proc_register
c_func
(paren
op_amp
id|dasd_proc_root_entry
comma
op_amp
id|dasd_proc_devices_entry
)paren
suffix:semicolon
macro_line|#ifdef DASD_PROFILE
id|proc_register
c_func
(paren
op_amp
id|dasd_proc_root_entry
comma
op_amp
id|dasd_proc_stats_entry
)paren
suffix:semicolon
id|proc_register
c_func
(paren
op_amp
id|dasd_proc_root_entry
comma
op_amp
id|dasd_proc_debug_entry
)paren
suffix:semicolon
macro_line|#endif /* DASD_PROFILE */
)brace
r_int
DECL|function|dasd_proc_read_devices
id|dasd_proc_read_devices
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
id|len
op_assign
id|sprintf
(paren
id|buf
comma
l_string|&quot;dev# MAJ minor node        Format&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DASD_MAX_DEVICES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dasd_information_t
op_star
id|info
op_assign
id|dasd_info
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ge
id|PAGE_SIZE
op_minus
l_int|80
)paren
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;terminated...&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%04X %3d %5d /dev/dasd%c&quot;
comma
id|dasd_info
(braket
id|i
)braket
op_member_access_from_pointer
id|info.devno
comma
id|DASD_MAJOR
comma
id|i
op_lshift
id|PARTN_BITS
comma
l_char|&squot;a&squot;
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;flags
op_eq
id|DASD_INFO_FLAGS_NOT_FORMATTED
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;    n/a&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot; %6d&quot;
comma
id|info-&gt;sizes.bp_block
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
r_void
DECL|function|dasd_proc_add_node
id|dasd_proc_add_node
(paren
r_int
id|di
)paren
(brace
)brace
eof
