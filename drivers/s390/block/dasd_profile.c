macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/dasd.h&gt;
macro_line|#include &quot;dasd_types.h&quot;
DECL|macro|PRINTK_HEADER
mdefine_line|#define PRINTK_HEADER &quot;dasd_profile:&quot;
DECL|variable|dasd_io_reqs
r_static
r_int
id|dasd_io_reqs
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* number of requests processed at all */
DECL|variable|dasd_io_secs
r_static
r_int
id|dasd_io_secs
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* histogram of request&squot;s sizes */
DECL|variable|dasd_io_times
r_static
r_int
id|dasd_io_times
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* histogram of requests&squot;s times */
DECL|variable|dasd_io_timps
r_static
r_int
id|dasd_io_timps
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* histogram of requests&squot;s times per sector */
DECL|variable|dasd_io_time1
r_static
r_int
id|dasd_io_time1
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* histogram of time from build to start */
DECL|variable|dasd_io_time2
r_static
r_int
id|dasd_io_time2
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* histogram of time from start to irq */
DECL|variable|dasd_io_time2ps
r_static
r_int
id|dasd_io_time2ps
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* histogram of time from start to irq */
DECL|variable|dasd_io_time3
r_static
r_int
id|dasd_io_time3
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* histogram of time from irq to end */
r_void
DECL|function|dasd_profile_add
id|dasd_profile_add
(paren
id|cqr_t
op_star
id|cqr
)paren
(brace
r_int
id|ind
suffix:semicolon
r_int
id|strtime
comma
id|irqtime
comma
id|endtime
comma
id|tottime
suffix:semicolon
r_int
id|tottimeps
comma
id|sectors
suffix:semicolon
r_int
id|help
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cqr
op_member_access_from_pointer
id|req
)paren
r_return
suffix:semicolon
id|sectors
op_assign
id|cqr
op_member_access_from_pointer
id|req
op_member_access_from_pointer
id|nr_sectors
suffix:semicolon
id|strtime
op_assign
(paren
(paren
id|cqr-&gt;startclk
op_minus
id|cqr-&gt;buildclk
)paren
op_rshift
l_int|12
)paren
suffix:semicolon
id|irqtime
op_assign
(paren
(paren
id|cqr-&gt;stopclk
op_minus
id|cqr-&gt;startclk
)paren
op_rshift
l_int|12
)paren
suffix:semicolon
id|endtime
op_assign
(paren
(paren
id|cqr-&gt;endclk
op_minus
id|cqr-&gt;stopclk
)paren
op_rshift
l_int|12
)paren
suffix:semicolon
id|tottime
op_assign
(paren
(paren
id|cqr-&gt;endclk
op_minus
id|cqr-&gt;buildclk
)paren
op_rshift
l_int|12
)paren
suffix:semicolon
id|tottimeps
op_assign
id|tottime
op_div
id|sectors
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dasd_io_reqs
op_increment
)paren
(brace
r_for
c_loop
(paren
id|ind
op_assign
l_int|0
suffix:semicolon
id|ind
OL
l_int|16
suffix:semicolon
id|ind
op_increment
)paren
(brace
id|dasd_io_secs
(braket
id|ind
)braket
op_assign
l_int|0
suffix:semicolon
id|dasd_io_times
(braket
id|ind
)braket
op_assign
l_int|0
suffix:semicolon
id|dasd_io_timps
(braket
id|ind
)braket
op_assign
l_int|0
suffix:semicolon
id|dasd_io_time1
(braket
id|ind
)braket
op_assign
l_int|0
suffix:semicolon
id|dasd_io_time2
(braket
id|ind
)braket
op_assign
l_int|0
suffix:semicolon
id|dasd_io_time2ps
(braket
id|ind
)braket
op_assign
l_int|0
suffix:semicolon
id|dasd_io_time3
(braket
id|ind
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
suffix:semicolon
r_for
c_loop
(paren
id|ind
op_assign
l_int|0
comma
id|help
op_assign
id|sectors
op_rshift
l_int|3
suffix:semicolon
id|ind
OL
l_int|15
op_logical_and
id|help
suffix:semicolon
id|help
op_assign
id|help
op_rshift
l_int|1
comma
id|ind
op_increment
)paren
suffix:semicolon
id|dasd_io_secs
(braket
id|ind
)braket
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|ind
op_assign
l_int|0
comma
id|help
op_assign
id|tottime
op_rshift
l_int|3
suffix:semicolon
id|ind
OL
l_int|15
op_logical_and
id|help
suffix:semicolon
id|help
op_assign
id|help
op_rshift
l_int|1
comma
id|ind
op_increment
)paren
suffix:semicolon
id|dasd_io_times
(braket
id|ind
)braket
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|ind
op_assign
l_int|0
comma
id|help
op_assign
id|tottimeps
op_rshift
l_int|3
suffix:semicolon
id|ind
OL
l_int|15
op_logical_and
id|help
suffix:semicolon
id|help
op_assign
id|help
op_rshift
l_int|1
comma
id|ind
op_increment
)paren
suffix:semicolon
id|dasd_io_timps
(braket
id|ind
)braket
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|ind
op_assign
l_int|0
comma
id|help
op_assign
id|strtime
op_rshift
l_int|3
suffix:semicolon
id|ind
OL
l_int|15
op_logical_and
id|help
suffix:semicolon
id|help
op_assign
id|help
op_rshift
l_int|1
comma
id|ind
op_increment
)paren
suffix:semicolon
id|dasd_io_time1
(braket
id|ind
)braket
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|ind
op_assign
l_int|0
comma
id|help
op_assign
id|irqtime
op_rshift
l_int|3
suffix:semicolon
id|ind
OL
l_int|15
op_logical_and
id|help
suffix:semicolon
id|help
op_assign
id|help
op_rshift
l_int|1
comma
id|ind
op_increment
)paren
suffix:semicolon
id|dasd_io_time2
(braket
id|ind
)braket
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|ind
op_assign
l_int|0
comma
id|help
op_assign
(paren
id|irqtime
op_div
id|sectors
)paren
op_rshift
l_int|3
suffix:semicolon
id|ind
OL
l_int|15
op_logical_and
id|help
suffix:semicolon
id|help
op_assign
id|help
op_rshift
l_int|1
comma
id|ind
op_increment
)paren
suffix:semicolon
id|dasd_io_time2ps
(braket
id|ind
)braket
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|ind
op_assign
l_int|0
comma
id|help
op_assign
id|endtime
op_rshift
l_int|3
suffix:semicolon
id|ind
OL
l_int|15
op_logical_and
id|help
suffix:semicolon
id|help
op_assign
id|help
op_rshift
l_int|1
comma
id|ind
op_increment
)paren
suffix:semicolon
id|dasd_io_time3
(braket
id|ind
)braket
op_increment
suffix:semicolon
)brace
r_int
DECL|function|dasd_proc_read_statistics
id|dasd_proc_read_statistics
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|len
comma
r_int
id|d
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|shift
comma
id|help
suffix:semicolon
r_for
c_loop
(paren
id|shift
op_assign
l_int|0
comma
id|help
op_assign
id|dasd_io_reqs
suffix:semicolon
id|help
OG
l_int|8192
suffix:semicolon
id|help
op_assign
id|help
op_rshift
l_int|1
comma
id|shift
op_increment
)paren
suffix:semicolon
id|len
op_assign
id|sprintf
(paren
id|buf
comma
l_string|&quot;%ld dasd I/O requests&bslash;n&quot;
comma
id|dasd_io_reqs
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;__&lt;4 ___8 __16 __32 __64 _128 _256 _512 __1k __2k __4k __8k _16k _32k _64k &gt;64k&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Histogram of sizes (512B secs)&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%4ld &quot;
comma
id|dasd_io_secs
(braket
id|i
)braket
op_rshift
id|shift
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Histogram of I/O times&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%4ld &quot;
comma
id|dasd_io_times
(braket
id|i
)braket
op_rshift
id|shift
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Histogram of I/O times per sector&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%4ld &quot;
comma
id|dasd_io_timps
(braket
id|i
)braket
op_rshift
id|shift
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Histogram of I/O time till ssch&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%4ld &quot;
comma
id|dasd_io_time1
(braket
id|i
)braket
op_rshift
id|shift
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Histogram of I/O time between ssch and irq&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%4ld &quot;
comma
id|dasd_io_time2
(braket
id|i
)braket
op_rshift
id|shift
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Histogram of I/O time between ssch and irq per sector&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%4ld &quot;
comma
id|dasd_io_time2ps
(braket
id|i
)braket
op_rshift
id|shift
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Histogram of I/O time between irq and end&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%4ld &quot;
comma
id|dasd_io_time3
(braket
id|i
)braket
op_rshift
id|shift
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_typedef
r_struct
(brace
r_union
(brace
DECL|member|clock
r_int
r_int
r_int
id|clock
suffix:semicolon
r_struct
(brace
DECL|member|ts1
r_int
r_int
id|ts1
suffix:semicolon
DECL|member|ts2
r_int
r_int
id|ts2
suffix:colon
l_int|20
suffix:semicolon
DECL|member|unused
r_int
r_int
id|unused
suffix:colon
l_int|8
suffix:semicolon
DECL|member|cpu
r_int
r_int
id|cpu
suffix:colon
l_int|4
suffix:semicolon
DECL|member|s
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|s
suffix:semicolon
DECL|member|u
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|u
suffix:semicolon
DECL|member|caller_address
r_int
r_int
id|caller_address
suffix:semicolon
DECL|member|tag
r_int
r_int
id|tag
suffix:semicolon
DECL|typedef|dasd_debug_entry
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|dasd_debug_entry
suffix:semicolon
DECL|variable|dasd_debug_area
r_static
id|dasd_debug_entry
op_star
id|dasd_debug_area
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|dasd_debug_actual
r_static
id|dasd_debug_entry
op_star
id|dasd_debug_actual
suffix:semicolon
DECL|variable|debug_lock
r_static
id|spinlock_t
id|debug_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_void
DECL|function|dasd_debug
id|dasd_debug
(paren
r_int
r_int
id|tag
)paren
(brace
r_int
id|flags
suffix:semicolon
id|dasd_debug_entry
op_star
id|d
suffix:semicolon
multiline_comment|/* initialize in first call ... */
r_if
c_cond
(paren
op_logical_neg
id|dasd_debug_area
)paren
(brace
id|dasd_debug_actual
op_assign
id|dasd_debug_area
op_assign
(paren
id|dasd_debug_entry
op_star
)paren
id|get_free_page
(paren
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dasd_debug_area
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;No debug area allocated&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
(paren
id|dasd_debug_area
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
)brace
multiline_comment|/* renormalize to page */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|debug_lock
comma
id|flags
)paren
suffix:semicolon
id|dasd_debug_actual
op_assign
(paren
id|dasd_debug_entry
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|dasd_debug_area
op_plus
(paren
(paren
(paren
r_int
r_int
)paren
id|dasd_debug_actual
op_minus
(paren
r_int
r_int
)paren
id|dasd_debug_area
)paren
op_mod
id|PAGE_SIZE
)paren
)paren
suffix:semicolon
id|d
op_assign
id|dasd_debug_actual
op_increment
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|debug_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* write CPUID to lowest 12 bits of clock... */
id|__asm__
id|__volatile__
(paren
l_string|&quot;STCK  %0&quot;
suffix:colon
l_string|&quot;=m&quot;
(paren
id|d-&gt;u.clock
)paren
)paren
suffix:semicolon
id|d-&gt;tag
op_assign
id|tag
suffix:semicolon
id|d
op_member_access_from_pointer
id|caller_address
op_assign
(paren
r_int
r_int
)paren
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|d-&gt;u.s.cpu
op_assign
id|smp_processor_id
c_func
(paren
)paren
suffix:semicolon
)brace
r_int
DECL|function|dasd_proc_read_debug
id|dasd_proc_read_debug
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|len
comma
r_int
id|dd
)paren
(brace
id|dasd_debug_entry
op_star
id|d
suffix:semicolon
r_char
id|tag
(braket
l_int|9
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|debug_lock
comma
id|flags
)paren
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|d
op_assign
id|dasd_debug_area
suffix:semicolon
id|len
OL
l_int|4068
suffix:semicolon
id|d
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
(paren
r_char
op_star
)paren
(paren
op_amp
id|d-&gt;tag
)paren
op_eq
l_char|&squot;D&squot;
)paren
(brace
id|memcpy
c_func
(paren
id|tag
comma
op_amp
(paren
id|d-&gt;tag
)paren
comma
l_int|4
)paren
suffix:semicolon
id|tag
(braket
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|tag
comma
l_string|&quot;%08lx&quot;
comma
id|d-&gt;tag
)paren
suffix:semicolon
id|tag
(braket
l_int|8
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%x %08x%05x %08lx (%8s)&bslash;n&quot;
comma
id|d-&gt;u.s.cpu
comma
id|d-&gt;u.s.ts1
comma
id|d-&gt;u.s.ts2
comma
id|d-&gt;caller_address
comma
id|tag
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|debug_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
eof
