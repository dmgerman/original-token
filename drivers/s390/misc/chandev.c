multiline_comment|/*&n; *  drivers/s390/misc/chandev.c&n; *    common channel device layer&n; *&n; *  S390 version&n; *    Copyright (C) 2000 IBM Deutschland Entwicklung GmbH, IBM Corporation&n; *    Author(s): Denis Joseph Barrow (djbarrow@de.ibm.com,barrow_dj@yahoo.com)&n; */
DECL|macro|__KERNEL_SYSCALLS__
mdefine_line|#define __KERNEL_SYSCALLS__
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;asm/queue.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;asm/chandev.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
DECL|variable|chandev_models_head
r_static
id|chandev_model_info
op_star
id|chandev_models_head
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|chandev_head
r_static
id|chandev
op_star
id|chandev_head
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|chandev_noauto_head
r_static
id|chandev_noauto_range
op_star
id|chandev_noauto_head
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|chandev_force_head
r_static
id|chandev_force
op_star
id|chandev_force_head
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|chandev_probelist_head
r_static
id|chandev_probelist
op_star
id|chandev_probelist_head
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|use_devno_names
r_static
r_int
id|use_devno_names
op_assign
id|FALSE
suffix:semicolon
DECL|variable|chandev_conf_read
r_static
r_int
id|chandev_conf_read
op_assign
id|FALSE
suffix:semicolon
DECL|function|chandev_alloc_listmember
r_static
r_void
op_star
id|chandev_alloc_listmember
c_func
(paren
id|list
op_star
op_star
id|listhead
comma
r_int
id|size
)paren
(brace
r_void
op_star
id|newmember
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newmember
)paren
(brace
id|add_to_list
c_func
(paren
id|listhead
comma
id|newmember
)paren
suffix:semicolon
)brace
r_return
id|newmember
suffix:semicolon
)brace
DECL|function|chandev_free_listmember
r_void
id|chandev_free_listmember
c_func
(paren
id|list
op_star
op_star
id|listhead
comma
id|list
op_star
id|member
)paren
(brace
r_if
c_cond
(paren
id|remove_from_list
c_func
(paren
id|listhead
comma
id|member
)paren
)paren
(brace
id|kfree
c_func
(paren
id|member
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;chandev_free_listmember detected nonexistant&quot;
l_string|&quot;listmember listhead=%p member %p&bslash;n&quot;
comma
id|listhead
comma
id|member
)paren
suffix:semicolon
)brace
DECL|function|chandev_free_all
r_void
id|chandev_free_all
c_func
(paren
id|list
op_star
op_star
id|listhead
)paren
(brace
r_while
c_loop
(paren
op_star
id|listhead
)paren
(brace
id|chandev_free_listmember
c_func
(paren
id|listhead
comma
op_star
id|listhead
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_add_model
r_void
id|chandev_add_model
c_func
(paren
id|chandev_type
id|chan_type
comma
id|u16
id|cu_type
comma
id|u8
id|cu_model
comma
id|u8
id|max_port_no
)paren
(brace
id|chandev_model_info
op_star
id|newmodel
suffix:semicolon
r_if
c_cond
(paren
(paren
id|newmodel
op_assign
id|chandev_alloc_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_models_head
comma
r_sizeof
(paren
id|chandev_model_info
)paren
)paren
)paren
)paren
(brace
id|newmodel-&gt;chan_type
op_assign
id|chan_type
suffix:semicolon
id|newmodel-&gt;cu_type
op_assign
id|cu_type
suffix:semicolon
id|newmodel-&gt;cu_model
op_assign
id|cu_model
suffix:semicolon
id|newmodel-&gt;max_port_no
op_assign
id|max_port_no
suffix:semicolon
)brace
)brace
DECL|function|chandev_remove
r_void
id|chandev_remove
c_func
(paren
id|chandev
op_star
id|member
)paren
(brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_head
comma
(paren
id|list
op_star
)paren
id|member
)paren
suffix:semicolon
)brace
DECL|function|chandev_remove_all
r_void
id|chandev_remove_all
c_func
(paren
r_void
)paren
(brace
id|chandev_free_all
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_head
)paren
suffix:semicolon
)brace
DECL|function|chandev_remove_model
r_void
id|chandev_remove_model
c_func
(paren
id|chandev_model_info
op_star
id|model
)paren
(brace
id|chandev
op_star
id|curr_chandev
suffix:semicolon
r_for
c_loop
(paren
id|curr_chandev
op_assign
id|chandev_head
suffix:semicolon
id|curr_chandev
op_ne
l_int|NULL
suffix:semicolon
id|curr_chandev
op_assign
id|curr_chandev-&gt;next
)paren
r_if
c_cond
(paren
id|curr_chandev-&gt;model_info
op_eq
id|model
)paren
(brace
id|chandev_remove
c_func
(paren
id|curr_chandev
)paren
suffix:semicolon
)brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_models_head
comma
(paren
id|list
op_star
)paren
id|model
)paren
suffix:semicolon
)brace
DECL|function|chandev_remove_all_models
r_void
id|chandev_remove_all_models
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
id|chandev_models_head
)paren
(brace
id|chandev_remove_model
c_func
(paren
id|chandev_models_head
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_del_model
r_void
id|chandev_del_model
c_func
(paren
id|u16
id|cu_type
comma
id|u8
id|cu_model
)paren
(brace
id|chandev_model_info
op_star
id|curr_model
suffix:semicolon
r_for
c_loop
(paren
id|curr_model
op_assign
id|chandev_models_head
suffix:semicolon
id|curr_model
op_ne
l_int|NULL
suffix:semicolon
id|curr_model
op_assign
id|curr_model-&gt;next
)paren
r_if
c_cond
(paren
id|curr_model-&gt;cu_type
op_eq
id|cu_type
op_logical_and
id|curr_model-&gt;cu_model
op_eq
id|cu_model
)paren
(brace
id|chandev_remove_model
c_func
(paren
id|curr_model
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_init_default_models
r_static
r_void
id|chandev_init_default_models
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* P390/Planter 3172 emulation assume maximum 16 to be safe. */
id|chandev_add_model
c_func
(paren
id|lcs
comma
l_int|0x3088
comma
l_int|0x1
comma
l_int|15
)paren
suffix:semicolon
multiline_comment|/* 3172/2216 Paralell the 2216 allows 16 ports per card the */
multiline_comment|/* the original 3172 only allows 4 we will assume the max of 16 */
id|chandev_add_model
c_func
(paren
id|lcs
op_or
id|ctc
comma
l_int|0x3088
comma
l_int|0x8
comma
l_int|15
)paren
suffix:semicolon
multiline_comment|/* 3172/2216 Escon serial the 2216 allows 16 ports per card the */
multiline_comment|/* the original 3172 only allows 4 we will assume the max of 16 */
id|chandev_add_model
c_func
(paren
id|lcs
op_or
id|escon
comma
l_int|0x3088
comma
l_int|0x1F
comma
l_int|15
)paren
suffix:semicolon
multiline_comment|/* Only 2 ports allowed on OSA2 cards model 0x60 */
id|chandev_add_model
c_func
(paren
id|lcs
comma
l_int|0x3088
comma
l_int|0x60
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Osa-D we currently aren&squot;t too emotionally involved with this */
id|chandev_add_model
c_func
(paren
id|osad
comma
l_int|0x3088
comma
l_int|0x62
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|chandev_add
r_void
id|chandev_add
c_func
(paren
id|dev_info_t
op_star
id|newdevinfo
comma
id|chandev_model_info
op_star
id|newmodelinfo
)paren
(brace
id|chandev
op_star
id|new_chandev
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_chandev
op_assign
id|chandev_alloc_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_head
comma
r_sizeof
(paren
id|chandev
)paren
)paren
)paren
)paren
(brace
id|new_chandev-&gt;model_info
op_assign
id|newmodelinfo
suffix:semicolon
id|new_chandev-&gt;devno
op_assign
id|newdevinfo-&gt;devno
suffix:semicolon
id|new_chandev-&gt;irq
op_assign
id|newdevinfo-&gt;irq
suffix:semicolon
)brace
)brace
DECL|function|chandev_collect_devices
r_void
id|chandev_collect_devices
c_func
(paren
r_void
)paren
(brace
r_int
id|curr_irq
comma
id|loopcnt
op_assign
l_int|0
comma
id|err
suffix:semicolon
id|dev_info_t
id|curr_devinfo
suffix:semicolon
id|chandev_model_info
op_star
id|curr_model
suffix:semicolon
r_for
c_loop
(paren
id|curr_irq
op_assign
id|get_irq_first
c_func
(paren
)paren
suffix:semicolon
id|curr_irq
op_ge
l_int|0
suffix:semicolon
id|curr_irq
op_assign
id|get_irq_next
c_func
(paren
id|curr_irq
)paren
)paren
(brace
multiline_comment|/* check read chandev&n;&t;&t; * we had to do the cu_model check also because ctc devices&n;&t;&t; * have the same cutype &amp; after asking some people&n;&t;&t; * the model numbers are given out pseudo randomly so&n;&t;&t; * we can&squot;t just take a range of them also the dev_type &amp; models are 0&n;&t;&t; */
id|loopcnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|loopcnt
OG
l_int|0x10000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;chandev_collect_devices detected infinite loop bug in get_irq_next&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|get_dev_info_by_irq
c_func
(paren
id|curr_irq
comma
op_amp
id|curr_devinfo
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_collect_devices get_dev_info_by_irq reported err=%X on irq %d&bslash;n&quot;
l_string|&quot;should not happen&bslash;n&quot;
comma
id|err
comma
id|curr_irq
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_for
c_loop
(paren
id|curr_model
op_assign
id|chandev_models_head
suffix:semicolon
id|curr_model
op_ne
l_int|NULL
suffix:semicolon
id|curr_model
op_assign
id|curr_model-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|curr_model-&gt;cu_type
op_eq
id|curr_devinfo.sid_data.cu_type
)paren
op_logical_and
(paren
id|curr_model-&gt;cu_model
op_eq
id|curr_devinfo.sid_data.cu_model
)paren
op_logical_and
(paren
(paren
id|curr_devinfo.status
op_amp
id|DEVSTAT_DEVICE_OWNED
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|chandev_add
c_func
(paren
op_amp
id|curr_devinfo
comma
id|curr_model
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|chandev_add_force
r_void
id|chandev_add_force
c_func
(paren
id|chandev_type
id|chan_type
comma
id|s32
id|devif_num
comma
id|u16
id|read_devno
comma
id|u16
id|write_devno
comma
id|s16
id|port_no
comma
id|u8
id|do_ip_checksumming
comma
id|u8
id|use_hw_stats
)paren
(brace
id|chandev_force
op_star
id|new_chandev_force
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_chandev_force
op_assign
id|chandev_alloc_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_force_head
comma
r_sizeof
(paren
id|chandev_force
)paren
)paren
)paren
)paren
(brace
id|new_chandev_force-&gt;chan_type
op_assign
id|chan_type
suffix:semicolon
id|new_chandev_force-&gt;devif_num
op_assign
id|devif_num
suffix:semicolon
id|new_chandev_force-&gt;read_devno
op_assign
id|read_devno
suffix:semicolon
id|new_chandev_force-&gt;write_devno
op_assign
id|write_devno
suffix:semicolon
id|new_chandev_force-&gt;port_no
op_assign
id|port_no
suffix:semicolon
id|new_chandev_force-&gt;do_ip_checksumming
op_assign
id|do_ip_checksumming
suffix:semicolon
id|new_chandev_force-&gt;use_hw_stats
op_assign
id|use_hw_stats
suffix:semicolon
)brace
)brace
DECL|function|chandev_del_force
r_void
id|chandev_del_force
c_func
(paren
id|u16
id|read_devno
)paren
(brace
id|chandev_force
op_star
id|curr_force
suffix:semicolon
r_for
c_loop
(paren
id|curr_force
op_assign
id|chandev_force_head
suffix:semicolon
id|curr_force
op_ne
l_int|NULL
suffix:semicolon
id|curr_force
op_assign
id|curr_force-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|curr_force-&gt;read_devno
op_eq
id|read_devno
)paren
(brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_force_head
comma
(paren
id|list
op_star
)paren
id|curr_force
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|chandev_pack_args
r_void
id|chandev_pack_args
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|newstr
op_assign
id|str
suffix:semicolon
r_while
c_loop
(paren
op_star
id|str
)paren
(brace
r_if
c_cond
(paren
id|isspace
c_func
(paren
op_star
id|str
)paren
)paren
(brace
id|str
op_increment
suffix:semicolon
)brace
r_else
op_star
id|newstr
op_increment
op_assign
op_star
id|str
op_increment
suffix:semicolon
)brace
op_star
id|newstr
op_assign
l_int|0
suffix:semicolon
)brace
r_typedef
r_enum
(brace
DECL|enumerator|isnull
id|isnull
op_assign
l_int|0
comma
DECL|enumerator|isstr
id|isstr
op_assign
l_int|1
comma
DECL|enumerator|isnum
id|isnum
op_assign
l_int|2
comma
DECL|enumerator|iscomma
id|iscomma
op_assign
l_int|4
comma
DECL|typedef|chandev_strval
)brace
id|chandev_strval
suffix:semicolon
DECL|function|chandev_strcmp
id|chandev_strval
id|chandev_strcmp
c_func
(paren
r_char
op_star
id|teststr
comma
r_char
op_star
op_star
id|str
comma
r_int
op_star
id|endlong
)paren
(brace
r_char
op_star
id|cur
op_assign
op_star
id|str
suffix:semicolon
id|chandev_strval
id|retval
op_assign
id|isnull
suffix:semicolon
r_int
id|len
op_assign
id|strlen
c_func
(paren
id|teststr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|teststr
comma
op_star
id|str
comma
id|len
)paren
op_eq
l_int|0
)paren
(brace
op_star
id|str
op_add_assign
id|len
suffix:semicolon
id|retval
op_assign
id|isstr
suffix:semicolon
op_star
id|endlong
op_assign
id|simple_strtol
c_func
(paren
id|cur
comma
id|str
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cur
op_ne
op_star
id|str
)paren
(brace
id|retval
op_or_assign
id|isnum
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
op_star
id|str
op_eq
l_char|&squot;,&squot;
)paren
(brace
id|retval
op_or_assign
id|iscomma
suffix:semicolon
)brace
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|variable|argstrs
r_static
r_char
op_star
id|argstrs
(braket
)braket
op_assign
(brace
l_string|&quot;noauto&quot;
comma
l_string|&quot;lcs&quot;
comma
l_string|&quot;ctc&quot;
comma
l_string|&quot;escon&quot;
comma
l_string|&quot;del_force&quot;
comma
l_string|&quot;use_devno_names&quot;
l_string|&quot;dont_use_devno_names&quot;
comma
l_string|&quot;add_model&quot;
l_string|&quot;del_model&quot;
l_string|&quot;del_all_models&quot;
)brace
suffix:semicolon
r_typedef
r_enum
(brace
DECL|enumerator|stridx_mult
id|stridx_mult
op_assign
l_int|16
comma
DECL|enumerator|first_stridx
id|first_stridx
op_assign
l_int|0
comma
DECL|enumerator|noauto_stridx
id|noauto_stridx
op_assign
id|first_stridx
comma
DECL|enumerator|lcs_stridx
id|lcs_stridx
comma
DECL|enumerator|ctc_stridx
id|ctc_stridx
comma
DECL|enumerator|escon_stridx
id|escon_stridx
comma
DECL|enumerator|del_force_stridx
id|del_force_stridx
comma
DECL|enumerator|use_devno_names_stridx
id|use_devno_names_stridx
comma
DECL|enumerator|dont_use_devno_names_stridx
id|dont_use_devno_names_stridx
comma
DECL|enumerator|add_model_stridx
id|add_model_stridx
comma
DECL|enumerator|del_model_stridx
id|del_model_stridx
comma
DECL|enumerator|del_all_models_stridx
id|del_all_models_stridx
comma
DECL|enumerator|last_stridx
id|last_stridx
comma
DECL|typedef|chandev_str_enum
)brace
id|chandev_str_enum
suffix:semicolon
DECL|function|chandev_add_noauto
r_void
id|chandev_add_noauto
c_func
(paren
id|u16
id|lo_devno
comma
id|u16
id|hi_devno
)paren
(brace
id|chandev_noauto_range
op_star
id|new_range
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_range
op_assign
id|chandev_alloc_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_noauto_head
comma
r_sizeof
(paren
id|chandev_noauto_range
)paren
)paren
)paren
)paren
(brace
id|new_range-&gt;lo_devno
op_assign
id|lo_devno
suffix:semicolon
id|new_range-&gt;hi_devno
op_assign
id|hi_devno
suffix:semicolon
)brace
)brace
DECL|variable|chandev_keydescript
r_static
r_char
id|chandev_keydescript
(braket
)braket
op_assign
l_string|&quot;chan_type key bitfield&bslash;nctc=0x1,escon=0x2,lcs=0x4,lcs=0x4,osad=0x8,claw=0x16&bslash;n&quot;
suffix:semicolon
DECL|function|chandev_print_args
r_static
r_void
id|chandev_print_args
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;valid chandev arguments are&quot;
l_string|&quot;&lt;&gt; indicate optional parameters | indicate a choice.&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;noauto,&lt;lo_devno&gt;,&lt;hi_devno&gt;&bslash;n&quot;
l_string|&quot;don&squot;t probe a range of device numbers for channel devices&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;lcs|ctc|escon&lt;devif_num&gt;,read_devno,write_devno,&lt;port_no&gt;,&quot;
l_string|&quot;&lt;do_ip_checksumming&gt;,&lt;use_hw_stats&gt;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;e.g. ctc0,0x7c00,0x7c01,-1,0,0&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;     tells the channel layer to force ctc0 if detected to use&bslash;n&quot;
l_string|&quot;     cuu&squot;s 7c00 &amp; 7c01 port ( rel adapter no ) is invalid for&bslash;n&quot;
l_string|&quot;     ctc&squot;s so use -1 don&squot;t do checksumming on received ip&bslash;n&quot;
l_string|&quot;     packets &amp; as ctc doesn&squot;t have hardware stats ignore this&bslash;n&quot;
l_string|&quot;     parameter&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;del_force read_devno&bslash;n&quot;
l_string|&quot;delete a forced channel device from force list.&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;use_devno_names, tells the channel layer to assign device&bslash;n&quot;
l_string|&quot;names based on the read channel cuu number&bslash;n&quot;
l_string|&quot;e.g. a token ring read channel 0x7c00 would have an interface&quot;
l_string|&quot;called tr0x7c00 this avoids name collisions on devices.&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;add_model chan_type cu_model max_port no&bslash;n&quot;
l_string|&quot;tells the channel layer to probe for the device described&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s use max_port_no of 0 for devices where this field &quot;
l_string|&quot;is invalid.&bslash;n&quot;
comma
id|chandev_keydescript
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;del_model cu_type cu_model&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;del_all_models&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|chandev_setup
r_static
r_int
id|chandev_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|chandev_strval
id|val
op_assign
id|isnull
suffix:semicolon
id|chandev_str_enum
id|stridx
suffix:semicolon
r_int
id|endlong
suffix:semicolon
id|chandev_type
id|chan_type
suffix:semicolon
DECL|macro|CHANDEV_MAX_EXTRA_INTS
mdefine_line|#define CHANDEV_MAX_EXTRA_INTS 5
r_int
id|ints
(braket
id|CHANDEV_MAX_EXTRA_INTS
op_plus
l_int|1
)braket
suffix:semicolon
id|memset
c_func
(paren
id|ints
comma
l_int|0
comma
r_sizeof
(paren
id|ints
)paren
)paren
suffix:semicolon
id|chandev_pack_args
c_func
(paren
id|str
)paren
suffix:semicolon
r_for
c_loop
(paren
id|stridx
op_assign
id|first_stridx
suffix:semicolon
id|stridx
OL
id|last_stridx
suffix:semicolon
id|stridx
op_increment
)paren
r_if
c_cond
(paren
(paren
id|val
op_assign
id|chandev_strcmp
c_func
(paren
id|argstrs
(braket
id|stridx
)braket
comma
op_amp
id|str
comma
op_amp
id|endlong
)paren
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|iscomma
)paren
(brace
id|get_options
c_func
(paren
id|str
comma
id|CHANDEV_MAX_EXTRA_INTS
comma
id|ints
)paren
suffix:semicolon
)brace
r_else
id|ints
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|val
op_assign
(paren
(paren
(paren
id|chandev_strval
)paren
id|stridx
)paren
op_star
id|stridx_mult
)paren
op_plus
(paren
id|val
op_amp
op_complement
id|isstr
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
id|noauto_stridx
op_star
id|stridx_mult
suffix:colon
r_case
(paren
id|noauto_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_switch
c_cond
(paren
id|ints
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
id|chandev_free_all
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_noauto_head
)paren
suffix:semicolon
id|chandev_add_noauto
c_func
(paren
l_int|0
comma
l_int|0xffff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|ints
(braket
l_int|2
)braket
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
r_case
l_int|2
suffix:colon
id|chandev_add_noauto
c_func
(paren
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|ctc_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
r_case
(paren
id|escon_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
r_case
(paren
id|lcs_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
(paren
id|ctc_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
id|chan_type
op_assign
id|ctc
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|escon_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
id|chan_type
op_assign
id|escon
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|lcs_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
id|chan_type
op_assign
id|lcs
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|BadArgs
suffix:semicolon
)brace
id|chandev_add_force
c_func
(paren
id|chan_type
comma
id|endlong
comma
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
comma
id|ints
(braket
l_int|3
)braket
comma
id|ints
(braket
l_int|4
)braket
comma
id|ints
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|del_force_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ne
l_int|1
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
id|chandev_del_force
c_func
(paren
id|ints
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|use_devno_names_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|use_devno_names
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|dont_use_devno_names_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|use_devno_names
op_assign
l_int|0
suffix:semicolon
r_case
(paren
id|add_model_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
OL
l_int|3
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_eq
l_int|3
)paren
(brace
id|ints
(braket
l_int|0
)braket
op_assign
l_int|4
suffix:semicolon
id|ints
(braket
l_int|4
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|chandev_add_model
c_func
(paren
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
comma
id|ints
(braket
l_int|3
)braket
comma
id|ints
(braket
l_int|4
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|del_model_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ne
l_int|2
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
id|chandev_del_model
c_func
(paren
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|del_all_models_stridx
op_star
id|stridx_mult
suffix:colon
id|chandev_remove_all_models
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|BadArgs
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
id|BadArgs
suffix:colon
id|chandev_print_args
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;chandev=&quot;
comma
id|chandev_setup
)paren
suffix:semicolon
DECL|function|chandev_doprobe
r_int
id|chandev_doprobe
c_func
(paren
id|chandev_force
op_star
id|force
comma
id|chandev
op_star
id|read_chandev
comma
id|chandev
op_star
id|write_chandev
)paren
(brace
id|chandev_probelist
op_star
id|probe
suffix:semicolon
id|chandev_model_info
op_star
id|model_info
suffix:semicolon
id|chandev_probeinfo
id|probeinfo
suffix:semicolon
r_int
id|retval
op_assign
op_minus
l_int|1
comma
id|hint
op_assign
op_minus
l_int|1
suffix:semicolon
id|model_info
op_assign
id|read_chandev-&gt;model_info
suffix:semicolon
r_if
c_cond
(paren
id|read_chandev-&gt;model_info
op_ne
id|write_chandev-&gt;model_info
op_logical_or
(paren
id|force
op_logical_and
(paren
(paren
id|force-&gt;chan_type
op_amp
id|model_info-&gt;chan_type
)paren
op_eq
l_int|0
)paren
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* inconsistent */
r_for
c_loop
(paren
id|probe
op_assign
id|chandev_probelist_head
suffix:semicolon
id|probe
op_ne
l_int|NULL
suffix:semicolon
id|probe
op_assign
id|probe-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|probe-&gt;chan_type
op_amp
id|model_info-&gt;chan_type
)paren
(brace
r_if
c_cond
(paren
id|use_devno_names
)paren
(brace
id|probeinfo.devif_num
op_assign
id|read_chandev-&gt;devno
suffix:semicolon
)brace
r_else
id|probeinfo.devif_num
op_assign
op_minus
l_int|1
suffix:semicolon
id|probeinfo.read_irq
op_assign
id|read_chandev-&gt;irq
suffix:semicolon
id|probeinfo.write_irq
op_assign
id|write_chandev-&gt;irq
suffix:semicolon
id|probeinfo.max_port_no
op_assign
id|model_info-&gt;max_port_no
suffix:semicolon
r_if
c_cond
(paren
id|force
)paren
(brace
id|probeinfo.forced_port_no
op_assign
id|force-&gt;port_no
suffix:semicolon
r_if
c_cond
(paren
id|force-&gt;devif_num
op_ne
op_minus
l_int|1
)paren
(brace
id|probeinfo.devif_num
op_assign
id|force-&gt;devif_num
suffix:semicolon
)brace
id|probeinfo.do_ip_checksumming
op_assign
id|force-&gt;do_ip_checksumming
suffix:semicolon
id|probeinfo.use_hw_stats
op_assign
id|force-&gt;use_hw_stats
suffix:semicolon
)brace
r_else
(brace
id|probeinfo.forced_port_no
op_assign
op_minus
l_int|1
suffix:semicolon
id|probeinfo.do_ip_checksumming
op_assign
id|FALSE
suffix:semicolon
id|probeinfo.use_hw_stats
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|probe-&gt;chan_type
op_amp
id|lcs
)paren
(brace
id|hint
op_assign
(paren
id|read_chandev-&gt;devno
op_amp
l_int|0xFF
)paren
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|hint
OG
id|model_info-&gt;max_port_no
)paren
(brace
multiline_comment|/* The card is possibly emulated e.g P/390 */
multiline_comment|/* or possibly configured to use a shared */
multiline_comment|/* port configured by osa-sf. */
id|hint
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
id|probeinfo.hint_port_no
op_assign
id|hint
suffix:semicolon
id|retval
op_assign
id|probe
op_member_access_from_pointer
id|probefunc
c_func
(paren
op_amp
id|probeinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|chandev_probe
r_void
id|chandev_probe
c_func
(paren
r_void
)paren
(brace
id|chandev
op_star
id|read_chandev
comma
op_star
id|write_chandev
comma
op_star
id|curr_chandev
suffix:semicolon
id|chandev_force
op_star
id|curr_force
suffix:semicolon
id|chandev_noauto_range
op_star
id|curr_noauto
suffix:semicolon
id|chandev_collect_devices
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|curr_force
op_assign
id|chandev_force_head
suffix:semicolon
id|curr_force
op_ne
l_int|NULL
suffix:semicolon
id|curr_force
op_assign
id|curr_force-&gt;next
)paren
(brace
r_for
c_loop
(paren
id|read_chandev
op_assign
id|chandev_head
suffix:semicolon
id|read_chandev
op_ne
l_int|NULL
suffix:semicolon
id|read_chandev
op_assign
id|read_chandev-&gt;next
)paren
r_if
c_cond
(paren
id|read_chandev-&gt;devno
op_eq
id|curr_force-&gt;read_devno
)paren
(brace
r_for
c_loop
(paren
id|write_chandev
op_assign
id|chandev_head
suffix:semicolon
id|write_chandev
op_ne
l_int|NULL
suffix:semicolon
id|write_chandev
op_assign
id|write_chandev-&gt;next
)paren
r_if
c_cond
(paren
id|write_chandev-&gt;devno
op_eq
id|curr_force-&gt;write_devno
)paren
(brace
r_if
c_cond
(paren
id|chandev_doprobe
c_func
(paren
id|curr_force
comma
id|read_chandev
comma
id|write_chandev
)paren
op_eq
l_int|0
)paren
(brace
id|chandev_remove
c_func
(paren
id|read_chandev
)paren
suffix:semicolon
id|chandev_remove
c_func
(paren
id|write_chandev
)paren
suffix:semicolon
r_goto
id|chandev_probe_skip
suffix:semicolon
)brace
)brace
)brace
id|chandev_probe_skip
suffix:colon
)brace
r_for
c_loop
(paren
id|curr_chandev
op_assign
id|chandev_head
suffix:semicolon
id|curr_chandev
op_ne
l_int|NULL
suffix:semicolon
id|curr_chandev
op_assign
id|curr_chandev-&gt;next
)paren
(brace
r_for
c_loop
(paren
id|curr_noauto
op_assign
id|chandev_noauto_head
suffix:semicolon
id|curr_noauto
op_ne
l_int|NULL
suffix:semicolon
id|curr_noauto
op_assign
id|curr_noauto-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|curr_chandev-&gt;devno
op_ge
id|curr_noauto-&gt;lo_devno
op_logical_and
id|curr_chandev-&gt;devno
op_le
id|curr_noauto-&gt;hi_devno
)paren
(brace
id|chandev_remove
c_func
(paren
id|curr_chandev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_for
c_loop
(paren
id|curr_chandev
op_assign
id|chandev_head
suffix:semicolon
id|curr_chandev
op_ne
l_int|NULL
suffix:semicolon
id|curr_chandev
op_assign
id|curr_chandev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|curr_chandev-&gt;next
op_logical_and
id|curr_chandev-&gt;model_info
op_eq
id|curr_chandev-&gt;next-&gt;model_info
)paren
(brace
id|chandev_doprobe
c_func
(paren
l_int|NULL
comma
id|curr_chandev
comma
id|curr_chandev-&gt;next
)paren
suffix:semicolon
id|curr_chandev
op_assign
id|curr_chandev-&gt;next
suffix:semicolon
)brace
)brace
id|chandev_remove_all
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_do_setup
r_int
id|chandev_do_setup
c_func
(paren
r_char
op_star
id|buff
comma
r_int
id|size
)paren
(brace
r_int
id|curr
comma
id|startline
op_assign
l_int|0
comma
id|comment
op_assign
id|FALSE
comma
id|newline
op_assign
id|FALSE
comma
id|oldnewline
op_assign
id|TRUE
suffix:semicolon
r_int
id|rc
op_assign
l_int|1
suffix:semicolon
id|buff
(braket
id|size
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|curr
op_assign
l_int|0
suffix:semicolon
id|curr
op_le
id|size
suffix:semicolon
id|curr
op_increment
)paren
(brace
r_if
c_cond
(paren
id|buff
(braket
id|curr
)braket
op_eq
l_char|&squot;#&squot;
)paren
(brace
id|comment
op_assign
id|TRUE
suffix:semicolon
id|newline
op_assign
id|FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|buff
(braket
id|curr
)braket
op_eq
l_int|10
op_logical_or
id|buff
(braket
id|curr
)braket
op_eq
l_int|13
op_logical_or
id|buff
(braket
id|curr
)braket
op_eq
l_int|0
)paren
(brace
id|buff
(braket
id|curr
)braket
op_assign
l_int|0
suffix:semicolon
id|comment
op_assign
id|FALSE
suffix:semicolon
id|newline
op_assign
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|comment
op_eq
id|FALSE
op_logical_and
id|curr
OG
id|startline
op_logical_and
(paren
(paren
id|oldnewline
op_eq
id|TRUE
op_logical_and
id|newline
op_eq
id|FALSE
)paren
op_logical_or
id|curr
op_eq
id|size
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|chandev_setup
c_func
(paren
op_amp
id|buff
(braket
id|startline
)braket
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
id|startline
op_assign
id|curr
op_plus
l_int|1
suffix:semicolon
)brace
id|oldnewline
op_assign
id|newline
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|chandev_read_conf
r_void
id|chandev_read_conf
c_func
(paren
r_void
)paren
(brace
DECL|macro|CHANDEV_FILE
mdefine_line|#define CHANDEV_FILE &quot;/etc/chandev.conf&quot;
r_struct
id|stat
id|statbuf
suffix:semicolon
r_char
op_star
id|buff
suffix:semicolon
r_int
id|curr
comma
id|left
comma
id|len
comma
id|fd
suffix:semicolon
id|chandev_conf_read
op_assign
id|TRUE
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
c_func
(paren
id|CHANDEV_FILE
comma
op_amp
id|statbuf
)paren
op_eq
l_int|0
)paren
(brace
id|set_fs
c_func
(paren
id|USER_DS
)paren
suffix:semicolon
id|buff
op_assign
id|vmalloc
c_func
(paren
id|statbuf.st_size
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buff
)paren
(brace
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fd
op_assign
id|open
c_func
(paren
id|CHANDEV_FILE
comma
id|O_RDONLY
comma
l_int|0
)paren
)paren
op_ne
op_minus
l_int|1
)paren
(brace
id|curr
op_assign
l_int|0
suffix:semicolon
id|left
op_assign
id|statbuf.st_size
suffix:semicolon
r_while
c_loop
(paren
(paren
id|len
op_assign
id|read
c_func
(paren
id|fd
comma
op_amp
id|buff
(braket
id|curr
)braket
comma
id|left
)paren
)paren
OG
l_int|0
)paren
(brace
id|curr
op_add_assign
id|len
suffix:semicolon
id|left
op_sub_assign
id|len
suffix:semicolon
)brace
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
)brace
id|set_fs
c_func
(paren
id|USER_DS
)paren
suffix:semicolon
id|chandev_do_setup
c_func
(paren
id|buff
comma
id|statbuf.st_size
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|buff
)paren
suffix:semicolon
)brace
)brace
id|set_fs
c_func
(paren
id|USER_DS
)paren
suffix:semicolon
)brace
DECL|function|chandev_register_and_probe
r_void
id|chandev_register_and_probe
c_func
(paren
id|chandev_probefunc
id|probefunc
comma
id|chandev_type
id|chan_type
)paren
(brace
id|chandev_probelist
op_star
id|new_probe
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chandev_conf_read
)paren
(brace
id|chandev_read_conf
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|new_probe
op_assign
id|chandev_alloc_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_probelist_head
comma
r_sizeof
(paren
id|chandev_probelist
)paren
)paren
)paren
)paren
(brace
id|new_probe-&gt;probefunc
op_assign
id|probefunc
suffix:semicolon
id|new_probe-&gt;chan_type
op_assign
id|chan_type
suffix:semicolon
id|chandev_probe
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_unregister
r_void
id|chandev_unregister
c_func
(paren
id|chandev_probefunc
id|probefunc
)paren
(brace
id|chandev_probelist
op_star
id|curr_probe
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|curr_probe
op_assign
id|chandev_probelist_head
suffix:semicolon
id|curr_probe
op_ne
l_int|NULL
suffix:semicolon
id|curr_probe
op_assign
id|curr_probe-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|curr_probe-&gt;probefunc
op_eq
id|probefunc
)paren
(brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_probelist_head
comma
(paren
id|list
op_star
)paren
id|curr_probe
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|macro|chandev_printf
mdefine_line|#define chandev_printf(exitchan,args...)     &bslash;&n;splen=sprintf(spbuff,##args);                &bslash;&n;spoffset+=splen;                             &bslash;&n;if(spoffset&gt;offset) {                        &bslash;&n;       spbuff+=splen;                        &bslash;&n;       currlen+=splen;                       &bslash;&n;}                                            &bslash;&n;if(currlen&gt;=length)                          &bslash;&n;       goto exitchan;
DECL|function|chandev_read_proc
r_static
r_int
id|chandev_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_char
op_star
id|spbuff
op_assign
op_star
id|start
op_assign
id|page
suffix:semicolon
r_int
id|currlen
op_assign
l_int|0
comma
id|splen
suffix:semicolon
id|off_t
id|spoffset
op_assign
l_int|0
suffix:semicolon
id|chandev_model_info
op_star
id|curr_model
suffix:semicolon
id|chandev_noauto_range
op_star
id|curr_noauto
suffix:semicolon
id|chandev_force
op_star
id|curr_force
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;Channels enabled for detection&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;chan_type   cu_type       cu_model    max_port_no&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;=================================================&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|curr_model
op_assign
id|chandev_models_head
suffix:semicolon
id|curr_model
op_ne
l_int|NULL
suffix:semicolon
id|curr_model
op_assign
id|curr_model-&gt;next
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;0x%02x       0x%04x         0x%02x        %d&bslash;n&quot;
comma
id|curr_model-&gt;chan_type
comma
(paren
r_int
)paren
id|curr_model-&gt;cu_type
comma
(paren
r_int
)paren
id|curr_model-&gt;cu_model
comma
(paren
r_int
)paren
id|curr_model-&gt;max_port_no
)paren
suffix:semicolon
)brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;%s&quot;
comma
id|chandev_keydescript
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;No auto devno ranges&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;   From        To   &bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;====================&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|curr_noauto
op_assign
id|chandev_noauto_head
suffix:semicolon
id|curr_noauto
op_ne
l_int|NULL
suffix:semicolon
id|curr_noauto
op_assign
id|curr_noauto-&gt;next
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;0x%4x       0x%4x&bslash;n&quot;
comma
id|curr_noauto-&gt;lo_devno
comma
id|curr_noauto-&gt;hi_devno
)paren
suffix:semicolon
)brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;nForced devices&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;chan_type defif_num read_devno write_devno port_no ip_cksum hw_stats&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;====================================================================&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|curr_force
op_assign
id|chandev_force_head
suffix:semicolon
id|curr_force
op_ne
l_int|NULL
suffix:semicolon
id|curr_force
op_assign
id|curr_force-&gt;next
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;0x%2x   %d  0x%4x 0x%4x  %4d    %1d   %1d&bslash;n&quot;
comma
id|curr_force-&gt;chan_type
comma
id|curr_force-&gt;devif_num
comma
id|curr_force-&gt;read_devno
comma
id|curr_force-&gt;write_devno
comma
id|curr_force-&gt;port_no
comma
id|curr_force-&gt;do_ip_checksumming
comma
id|curr_force-&gt;use_hw_stats
)paren
suffix:semicolon
)brace
op_star
id|eof
op_assign
id|TRUE
suffix:semicolon
id|chan_exit
suffix:colon
r_if
c_cond
(paren
id|currlen
OG
id|length
)paren
(brace
multiline_comment|/* rewind to previous printf so that we are correctly&n;&t;&t; * aligned if we get called to print another page.&n;                 */
id|currlen
op_sub_assign
id|splen
suffix:semicolon
)brace
r_return
id|currlen
suffix:semicolon
)brace
DECL|function|chandev_write_proc
r_static
r_int
id|chandev_write_proc
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|rc
suffix:semicolon
r_char
op_star
id|buff
suffix:semicolon
id|buff
op_assign
id|vmalloc
c_func
(paren
id|count
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buff
)paren
(brace
id|rc
op_assign
id|copy_from_user
c_func
(paren
id|buff
comma
id|buffer
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|chandev_write_exit
suffix:semicolon
id|chandev_do_setup
c_func
(paren
id|buff
comma
id|count
)paren
suffix:semicolon
id|rc
op_assign
id|count
suffix:semicolon
id|chandev_write_exit
suffix:colon
id|vfree
c_func
(paren
id|buff
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|chandev_create_proc
r_static
r_void
id|__init
id|chandev_create_proc
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|dir_entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;chandev&quot;
comma
l_int|0644
comma
op_amp
id|proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dir_entry
)paren
(brace
id|dir_entry-&gt;read_proc
op_assign
op_amp
id|chandev_read_proc
suffix:semicolon
id|dir_entry-&gt;write_proc
op_assign
op_amp
id|chandev_write_proc
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|chandev_init
r_static
r_int
id|__init
id|chandev_init
c_func
(paren
r_void
)paren
(brace
id|chandev_init_default_models
c_func
(paren
)paren
suffix:semicolon
macro_line|#if CONFIG_PROC_FS
id|chandev_create_proc
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|chandev_init
id|__initcall
c_func
(paren
id|chandev_init
)paren
suffix:semicolon
eof
