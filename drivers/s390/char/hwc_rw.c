multiline_comment|/*&n; *  drivers/s390/char/hwc_rw.c&n; *     driver: reading from and writing to system console on S/390 via HWC&n; *&n; *  S390 version&n; *    Copyright (C) 1999 IBM Deutschland Entwicklung GmbH, IBM Corporation&n; *    Author(s): Martin Peschke &lt;peschke@fh-brandenburg.de&gt;&n; *&n; *&n; *&n; *&n; *&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;asm/ebcdic.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/types.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#ifndef MIN
DECL|macro|MIN
mdefine_line|#define MIN(a,b) ((a&lt;b) ? a : b)
macro_line|#endif
DECL|macro|HWC_RW_PRINT_HEADER
mdefine_line|#define HWC_RW_PRINT_HEADER &quot;hwc low level driver: &quot;
DECL|macro|USE_VM_DETECTION
mdefine_line|#define  USE_VM_DETECTION
DECL|macro|DEFAULT_CASE_DELIMITER
mdefine_line|#define  DEFAULT_CASE_DELIMITER &squot;%&squot;
DECL|macro|DUMP_HWC_INIT_ERROR
mdefine_line|#define DUMP_HWC_INIT_ERROR
DECL|macro|DUMP_HWC_WRITE_ERROR
mdefine_line|#define DUMP_HWC_WRITE_ERROR
DECL|macro|DUMP_HWC_WRITE_LIST_ERROR
mdefine_line|#define DUMP_HWC_WRITE_LIST_ERROR
DECL|macro|DUMP_HWC_READ_ERROR
mdefine_line|#define DUMP_HWC_READ_ERROR
DECL|macro|DUMP_HWCB_INPUT
macro_line|#undef DUMP_HWCB_INPUT
DECL|macro|BUFFER_STRESS_TEST
macro_line|#undef BUFFER_STRESS_TEST
r_typedef
r_struct
(brace
DECL|member|next
r_int
r_char
op_star
id|next
suffix:semicolon
DECL|member|mto_char_sum
r_int
r_int
r_int
id|mto_char_sum
suffix:semicolon
DECL|member|mto_number
r_int
r_char
id|mto_number
suffix:semicolon
DECL|member|times_lost
r_int
r_char
id|times_lost
suffix:semicolon
DECL|member|mto_number_lost
r_int
r_int
r_int
id|mto_number_lost
suffix:semicolon
DECL|member|mto_char_sum_lost
r_int
r_int
r_int
id|mto_char_sum_lost
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
DECL|typedef|hwcb_list_t
id|hwcb_list_t
suffix:semicolon
DECL|macro|MAX_HWCB_ROOM
mdefine_line|#define MAX_HWCB_ROOM (PAGE_SIZE - sizeof(hwcb_list_t))
DECL|macro|MAX_MESSAGE_SIZE
mdefine_line|#define MAX_MESSAGE_SIZE (MAX_HWCB_ROOM - sizeof(write_hwcb_t))
DECL|macro|BUF_HWCB
mdefine_line|#define BUF_HWCB hwc_data.hwcb_list_tail
DECL|macro|OUT_HWCB
mdefine_line|#define OUT_HWCB hwc_data.hwcb_list_head
DECL|macro|ALL_HWCB_MTO
mdefine_line|#define ALL_HWCB_MTO hwc_data.mto_number
DECL|macro|ALL_HWCB_CHAR
mdefine_line|#define ALL_HWCB_CHAR hwc_data.mto_char_sum
DECL|macro|_LIST
mdefine_line|#define _LIST(hwcb) ((hwcb_list_t*)(&amp;(hwcb)[PAGE_SIZE-sizeof(hwcb_list_t)]))
DECL|macro|_HWCB_CHAR
mdefine_line|#define _HWCB_CHAR(hwcb) (_LIST(hwcb)-&gt;mto_char_sum)
DECL|macro|_HWCB_MTO
mdefine_line|#define _HWCB_MTO(hwcb) (_LIST(hwcb)-&gt;mto_number)
DECL|macro|_HWCB_CHAR_LOST
mdefine_line|#define _HWCB_CHAR_LOST(hwcb) (_LIST(hwcb)-&gt;mto_char_sum_lost)
DECL|macro|_HWCB_MTO_LOST
mdefine_line|#define _HWCB_MTO_LOST(hwcb) (_LIST(hwcb)-&gt;mto_number_lost)
DECL|macro|_HWCB_TIMES_LOST
mdefine_line|#define _HWCB_TIMES_LOST(hwcb) (_LIST(hwcb)-&gt;times_lost)
DECL|macro|_HWCB_NEXT
mdefine_line|#define _HWCB_NEXT(hwcb) (_LIST(hwcb)-&gt;next)
DECL|macro|BUF_HWCB_CHAR
mdefine_line|#define BUF_HWCB_CHAR _HWCB_CHAR(BUF_HWCB)
DECL|macro|BUF_HWCB_MTO
mdefine_line|#define BUF_HWCB_MTO _HWCB_MTO(BUF_HWCB)
DECL|macro|BUF_HWCB_NEXT
mdefine_line|#define BUF_HWCB_NEXT _HWCB_NEXT(BUF_HWCB)
DECL|macro|OUT_HWCB_CHAR
mdefine_line|#define OUT_HWCB_CHAR _HWCB_CHAR(OUT_HWCB)
DECL|macro|OUT_HWCB_MTO
mdefine_line|#define OUT_HWCB_MTO _HWCB_MTO(OUT_HWCB)
DECL|macro|OUT_HWCB_NEXT
mdefine_line|#define OUT_HWCB_NEXT _HWCB_NEXT(OUT_HWCB)
DECL|macro|BUF_HWCB_CHAR_LOST
mdefine_line|#define BUF_HWCB_CHAR_LOST _HWCB_CHAR_LOST(BUF_HWCB)
DECL|macro|BUF_HWCB_MTO_LOST
mdefine_line|#define BUF_HWCB_MTO_LOST _HWCB_MTO_LOST(BUF_HWCB)
DECL|macro|OUT_HWCB_CHAR_LOST
mdefine_line|#define OUT_HWCB_CHAR_LOST _HWCB_CHAR_LOST(OUT_HWCB)
DECL|macro|OUT_HWCB_MTO_LOST
mdefine_line|#define OUT_HWCB_MTO_LOST _HWCB_MTO_LOST(OUT_HWCB)
DECL|macro|BUF_HWCB_TIMES_LOST
mdefine_line|#define BUF_HWCB_TIMES_LOST _HWCB_TIMES_LOST(BUF_HWCB)
macro_line|#include  &quot;hwc.h&quot;
DECL|macro|__HWC_RW_C__
mdefine_line|#define __HWC_RW_C__
macro_line|#include &quot;hwc_rw.h&quot;
DECL|macro|__HWC_RW_C__
macro_line|#undef __HWC_RW_C__
DECL|variable|_obuf
r_static
r_int
r_char
id|_obuf
(braket
id|MAX_HWCB_ROOM
)braket
suffix:semicolon
r_static
r_int
r_char
DECL|variable|_page
id|_page
(braket
id|PAGE_SIZE
)braket
id|__attribute__
(paren
(paren
id|aligned
(paren
id|PAGE_SIZE
)paren
)paren
)paren
suffix:semicolon
DECL|typedef|kmem_pages_t
r_typedef
id|u32
id|kmem_pages_t
suffix:semicolon
DECL|macro|MAX_KMEM_PAGES
mdefine_line|#define MAX_KMEM_PAGES (sizeof(kmem_pages_t) &lt;&lt; 3)
DECL|macro|HWC_TIMER_RUNS
mdefine_line|#define HWC_TIMER_RUNS&t;1
DECL|macro|FLUSH_HWCBS
mdefine_line|#define FLUSH_HWCBS&t;2
r_static
r_struct
(brace
DECL|member|ioctls
id|hwc_ioctls_t
id|ioctls
suffix:semicolon
DECL|member|init_ioctls
id|hwc_ioctls_t
id|init_ioctls
suffix:semicolon
DECL|member|hwcb_list_head
r_int
r_char
op_star
id|hwcb_list_head
suffix:semicolon
DECL|member|hwcb_list_tail
r_int
r_char
op_star
id|hwcb_list_tail
suffix:semicolon
DECL|member|mto_number
r_int
r_int
r_int
id|mto_number
suffix:semicolon
DECL|member|mto_char_sum
r_int
r_int
id|mto_char_sum
suffix:semicolon
DECL|member|hwcb_count
r_int
r_char
id|hwcb_count
suffix:semicolon
DECL|member|kmem_start
r_int
r_int
id|kmem_start
suffix:semicolon
DECL|member|kmem_end
r_int
r_int
id|kmem_end
suffix:semicolon
DECL|member|kmem_pages
id|kmem_pages_t
id|kmem_pages
suffix:semicolon
DECL|member|obuf
r_int
r_char
op_star
id|obuf
suffix:semicolon
DECL|member|obuf_cursor
r_int
r_int
r_int
id|obuf_cursor
suffix:semicolon
DECL|member|obuf_count
r_int
r_int
r_int
id|obuf_count
suffix:semicolon
DECL|member|obuf_start
r_int
r_int
r_int
id|obuf_start
suffix:semicolon
DECL|member|page
r_int
r_char
op_star
id|page
suffix:semicolon
DECL|member|current_servc
id|u32
id|current_servc
suffix:semicolon
DECL|member|current_hwcb
r_int
r_char
op_star
id|current_hwcb
suffix:semicolon
DECL|member|write_nonprio
r_int
r_char
id|write_nonprio
suffix:colon
l_int|1
suffix:semicolon
DECL|member|write_prio
r_int
r_char
id|write_prio
suffix:colon
l_int|1
suffix:semicolon
DECL|member|read_nonprio
r_int
r_char
id|read_nonprio
suffix:colon
l_int|1
suffix:semicolon
DECL|member|read_prio
r_int
r_char
id|read_prio
suffix:colon
l_int|1
suffix:semicolon
DECL|member|flags
r_int
r_char
id|flags
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|write_timer
r_struct
id|timer_list
id|write_timer
suffix:semicolon
DECL|variable|hwc_data
)brace
id|hwc_data
op_assign
(brace
(brace
)brace
comma
(brace
l_int|8
comma
l_int|0
comma
l_int|80
comma
id|CODE_ASCII
comma
l_int|1
comma
l_int|50
comma
id|MAX_KMEM_PAGES
comma
l_int|0
comma
l_int|0x6c
)brace
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|_obuf
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|_page
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|macro|DELAYED_WRITE
mdefine_line|#define DELAYED_WRITE 0
DECL|macro|IMMEDIATE_WRITE
mdefine_line|#define IMMEDIATE_WRITE 1
r_static
r_int
r_int
id|do_hwc_write
(paren
r_int
id|from_user
comma
r_int
r_char
op_star
comma
r_int
r_int
comma
r_int
r_char
comma
r_int
r_char
)paren
suffix:semicolon
r_static
id|asmlinkage
r_int
DECL|function|internal_print
id|internal_print
(paren
r_char
id|write_time
comma
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|512
)braket
suffix:semicolon
id|va_start
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|i
op_assign
id|vsprintf
(paren
id|buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
(paren
id|args
)paren
suffix:semicolon
r_return
id|do_hwc_write
(paren
l_int|0
comma
id|buf
comma
id|i
comma
id|CODE_ASCII
comma
id|write_time
)paren
suffix:semicolon
)brace
r_int
DECL|function|hwc_printk
id|hwc_printk
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|512
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
id|i
op_assign
id|vsprintf
(paren
id|buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
(paren
id|args
)paren
suffix:semicolon
id|retval
op_assign
id|do_hwc_write
(paren
l_int|0
comma
id|buf
comma
id|i
comma
id|CODE_ASCII
comma
id|IMMEDIATE_WRITE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
macro_line|#ifdef DUMP_HWCB_INPUT
r_static
r_void
DECL|function|dump_storage_area
id|dump_storage_area
(paren
r_int
r_char
op_star
id|area
comma
r_int
r_int
r_int
id|count
)paren
(brace
r_int
r_int
r_int
id|index
suffix:semicolon
id|ioctl_nl_t
id|old_final_nl
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|area
op_logical_or
op_logical_neg
id|count
)paren
r_return
suffix:semicolon
id|old_final_nl
op_assign
id|hwc_data.ioctls.final_nl
suffix:semicolon
id|hwc_data.ioctls.final_nl
op_assign
l_int|1
suffix:semicolon
id|internal_print
(paren
id|DELAYED_WRITE
comma
l_string|&quot;&bslash;n%8x   &quot;
comma
id|area
)paren
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|count
suffix:semicolon
id|index
op_increment
)paren
(brace
r_if
c_cond
(paren
id|area
(braket
id|index
)braket
op_le
l_int|0xF
)paren
id|internal_print
(paren
id|DELAYED_WRITE
comma
l_string|&quot;0%x&quot;
comma
id|area
(braket
id|index
)braket
)paren
suffix:semicolon
r_else
id|internal_print
(paren
id|DELAYED_WRITE
comma
l_string|&quot;%x&quot;
comma
id|area
(braket
id|index
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|index
op_amp
l_int|0xF
)paren
op_eq
l_int|0xF
)paren
id|internal_print
(paren
id|DELAYED_WRITE
comma
l_string|&quot;&bslash;n%8x   &quot;
comma
op_amp
id|area
(braket
id|index
op_plus
l_int|1
)braket
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|index
op_amp
l_int|3
)paren
op_eq
l_int|3
)paren
id|internal_print
(paren
id|DELAYED_WRITE
comma
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
id|internal_print
(paren
id|IMMEDIATE_WRITE
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|hwc_data.ioctls.final_nl
op_assign
id|old_final_nl
suffix:semicolon
)brace
macro_line|#endif
r_static
r_inline
id|u32
DECL|function|service_call
id|service_call
(paren
id|u32
id|hwc_command_word
comma
r_int
r_char
id|hwcb
(braket
)braket
)paren
(brace
r_int
r_int
id|condition_code
op_assign
l_int|1
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;L 1, 0(0,%0) &bslash;n&bslash;t&quot;
l_string|&quot;LRA 2, 0(0,%1) &bslash;n&bslash;t&quot;
l_string|&quot;.long 0xB2200012 &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
op_amp
id|hwc_command_word
)paren
comma
l_string|&quot;a&quot;
(paren
id|hwcb
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;IPM %0 &bslash;n&bslash;t&quot;
l_string|&quot;SRL %0, 28 &bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|condition_code
)paren
)paren
suffix:semicolon
r_return
id|condition_code
suffix:semicolon
)brace
r_static
r_inline
r_int
r_char
op_star
DECL|function|ext_int_param
id|ext_int_param
(paren
r_void
)paren
(brace
id|u32
id|param
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;L %0,128(0,0)&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|param
)paren
)paren
suffix:semicolon
r_return
(paren
(paren
r_int
r_char
op_star
)paren
id|param
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|prepare_write_hwcb
id|prepare_write_hwcb
(paren
r_void
)paren
(brace
id|write_hwcb_t
op_star
id|hwcb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|BUF_HWCB
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|BUF_HWCB_MTO
op_assign
l_int|0
suffix:semicolon
id|BUF_HWCB_CHAR
op_assign
l_int|0
suffix:semicolon
id|hwcb
op_assign
(paren
id|write_hwcb_t
op_star
)paren
id|BUF_HWCB
suffix:semicolon
id|memcpy
(paren
id|hwcb
comma
op_amp
id|write_hwcb_template
comma
r_sizeof
(paren
id|write_hwcb_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwc_data.write_nonprio
op_logical_and
id|hwc_data.write_prio
)paren
id|hwcb-&gt;msgbuf.type
op_assign
id|ET_PMsgCmd
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|sane_write_hwcb
id|sane_write_hwcb
(paren
r_void
)paren
(brace
r_int
r_int
r_int
id|lost_msg
suffix:semicolon
r_int
r_int
id|lost_char
suffix:semicolon
r_int
r_char
id|lost_hwcb
suffix:semicolon
r_int
r_char
op_star
id|bad_addr
suffix:semicolon
r_int
r_int
id|page
suffix:semicolon
r_int
id|page_nr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|OUT_HWCB
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|OUT_HWCB
op_amp
l_int|0xFFF
)paren
(brace
id|bad_addr
op_assign
id|OUT_HWCB
suffix:semicolon
macro_line|#ifdef DUMP_HWC_WRITE_LIST_ERROR
id|__asm__
(paren
l_string|&quot;LHI 1,0xe30&bslash;n&bslash;t&quot;
l_string|&quot;LRA 2,0(0,%0) &bslash;n&bslash;t&quot;
l_string|&quot;J .+0 &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
id|bad_addr
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
)paren
suffix:semicolon
macro_line|#endif
id|hwc_data.kmem_pages
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|BUF_HWCB
op_amp
l_int|0xFFF
)paren
(brace
id|lost_hwcb
op_assign
id|hwc_data.hwcb_count
suffix:semicolon
id|lost_msg
op_assign
id|ALL_HWCB_MTO
suffix:semicolon
id|lost_char
op_assign
id|ALL_HWCB_CHAR
suffix:semicolon
id|OUT_HWCB
op_assign
l_int|NULL
suffix:semicolon
id|BUF_HWCB
op_assign
l_int|NULL
suffix:semicolon
id|ALL_HWCB_MTO
op_assign
l_int|0
suffix:semicolon
id|ALL_HWCB_CHAR
op_assign
l_int|0
suffix:semicolon
id|hwc_data.hwcb_count
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|lost_hwcb
op_assign
id|hwc_data.hwcb_count
op_minus
l_int|1
suffix:semicolon
id|lost_msg
op_assign
id|ALL_HWCB_MTO
op_minus
id|BUF_HWCB_MTO
suffix:semicolon
id|lost_char
op_assign
id|ALL_HWCB_CHAR
op_minus
id|BUF_HWCB_CHAR
suffix:semicolon
id|OUT_HWCB
op_assign
id|BUF_HWCB
suffix:semicolon
id|ALL_HWCB_MTO
op_assign
id|BUF_HWCB_MTO
suffix:semicolon
id|ALL_HWCB_CHAR
op_assign
id|BUF_HWCB_CHAR
suffix:semicolon
id|hwc_data.hwcb_count
op_assign
l_int|1
suffix:semicolon
id|page
op_assign
(paren
r_int
r_int
)paren
id|BUF_HWCB
suffix:semicolon
r_if
c_cond
(paren
id|page
op_ge
id|hwc_data.kmem_start
op_logical_and
id|page
OL
id|hwc_data.kmem_end
)paren
(brace
id|page_nr
op_assign
(paren
r_int
)paren
(paren
(paren
id|page
op_minus
id|hwc_data.kmem_start
)paren
op_rshift
l_int|12
)paren
suffix:semicolon
id|set_bit
(paren
id|page_nr
comma
op_amp
id|hwc_data.kmem_pages
)paren
suffix:semicolon
)brace
)brace
id|internal_print
(paren
id|DELAYED_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;found invalid HWCB at address 0x%x. List corrupted. &quot;
l_string|&quot;Lost %i HWCBs with %i characters within up to %i &quot;
l_string|&quot;messages. Saved %i HWCB with last %i characters i&quot;
l_string|&quot;within up to %i messages.&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|bad_addr
comma
id|lost_hwcb
comma
id|lost_char
comma
id|lost_msg
comma
id|hwc_data.hwcb_count
comma
id|ALL_HWCB_CHAR
comma
id|ALL_HWCB_MTO
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|reuse_write_hwcb
id|reuse_write_hwcb
(paren
r_void
)paren
(brace
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.hwcb_count
OL
l_int|2
)paren
macro_line|#ifdef DUMP_HWC_WRITE_LIST_ERROR
id|__asm__
(paren
l_string|&quot;LHI 1,0xe31&bslash;n&bslash;t&quot;
l_string|&quot;LRA 2,0(0,%0)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 3,0(0,%1)&bslash;n&bslash;t&quot;
l_string|&quot;J .+0 &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
id|BUF_HWCB
)paren
comma
l_string|&quot;a&quot;
(paren
id|OUT_HWCB
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#else
r_return
op_minus
id|EPERM
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|hwc_data.current_hwcb
op_eq
id|OUT_HWCB
)paren
(brace
r_if
c_cond
(paren
id|hwc_data.hwcb_count
OG
l_int|2
)paren
(brace
id|BUF_HWCB_NEXT
op_assign
id|OUT_HWCB_NEXT
suffix:semicolon
id|BUF_HWCB
op_assign
id|OUT_HWCB_NEXT
suffix:semicolon
id|OUT_HWCB_NEXT
op_assign
id|BUF_HWCB_NEXT
suffix:semicolon
id|BUF_HWCB_NEXT
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_else
(brace
id|BUF_HWCB_NEXT
op_assign
id|OUT_HWCB
suffix:semicolon
id|BUF_HWCB
op_assign
id|OUT_HWCB
suffix:semicolon
id|OUT_HWCB
op_assign
id|OUT_HWCB_NEXT
suffix:semicolon
id|BUF_HWCB_NEXT
op_assign
l_int|NULL
suffix:semicolon
)brace
id|BUF_HWCB_TIMES_LOST
op_add_assign
l_int|1
suffix:semicolon
id|BUF_HWCB_CHAR_LOST
op_add_assign
id|BUF_HWCB_CHAR
suffix:semicolon
id|BUF_HWCB_MTO_LOST
op_add_assign
id|BUF_HWCB_MTO
suffix:semicolon
id|ALL_HWCB_MTO
op_sub_assign
id|BUF_HWCB_MTO
suffix:semicolon
id|ALL_HWCB_CHAR
op_sub_assign
id|BUF_HWCB_CHAR
suffix:semicolon
id|retval
op_assign
id|prepare_write_hwcb
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.hwcb_count
op_eq
id|hwc_data.ioctls.max_hwcb
)paren
id|internal_print
(paren
id|DELAYED_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;reached my own limit of &quot;
l_string|&quot;allowed buffer space for output (%i HWCBs = %li &quot;
l_string|&quot;bytes), skipped content of oldest HWCB %i time(s) &quot;
l_string|&quot;(%i lines = %i characters)&bslash;n&quot;
comma
id|hwc_data.ioctls.max_hwcb
comma
id|hwc_data.ioctls.max_hwcb
op_star
id|PAGE_SIZE
comma
id|BUF_HWCB_TIMES_LOST
comma
id|BUF_HWCB_MTO_LOST
comma
id|BUF_HWCB_CHAR_LOST
)paren
suffix:semicolon
r_else
id|internal_print
(paren
id|DELAYED_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;page allocation failed, &quot;
l_string|&quot;could not expand buffer for output (currently in &quot;
l_string|&quot;use: %i HWCBs = %li bytes), skipped content of &quot;
l_string|&quot;oldest HWCB %i time(s) (%i lines = %i characters)&bslash;n&quot;
comma
id|hwc_data.hwcb_count
comma
id|hwc_data.hwcb_count
op_star
id|PAGE_SIZE
comma
id|BUF_HWCB_TIMES_LOST
comma
id|BUF_HWCB_MTO_LOST
comma
id|BUF_HWCB_CHAR_LOST
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|allocate_write_hwcb
id|allocate_write_hwcb
(paren
r_void
)paren
(brace
r_int
r_char
op_star
id|page
suffix:semicolon
r_int
id|page_nr
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.hwcb_count
op_eq
id|hwc_data.ioctls.max_hwcb
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|page_nr
op_assign
id|find_first_zero_bit
(paren
op_amp
id|hwc_data.kmem_pages
comma
id|MAX_KMEM_PAGES
)paren
suffix:semicolon
r_if
c_cond
(paren
id|page_nr
OL
id|hwc_data.ioctls.kmem_hwcb
)paren
(brace
id|page
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
id|hwc_data.kmem_start
op_plus
(paren
id|page_nr
op_lshift
l_int|12
)paren
)paren
suffix:semicolon
id|set_bit
(paren
id|page_nr
comma
op_amp
id|hwc_data.kmem_pages
)paren
suffix:semicolon
)brace
r_else
id|page
op_assign
(paren
r_int
r_char
op_star
)paren
id|__get_free_page
(paren
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|OUT_HWCB
)paren
id|OUT_HWCB
op_assign
id|page
suffix:semicolon
r_else
id|BUF_HWCB_NEXT
op_assign
id|page
suffix:semicolon
id|BUF_HWCB
op_assign
id|page
suffix:semicolon
id|BUF_HWCB_NEXT
op_assign
l_int|NULL
suffix:semicolon
id|hwc_data.hwcb_count
op_increment
suffix:semicolon
id|prepare_write_hwcb
(paren
)paren
suffix:semicolon
id|BUF_HWCB_TIMES_LOST
op_assign
l_int|0
suffix:semicolon
id|BUF_HWCB_MTO_LOST
op_assign
l_int|0
suffix:semicolon
id|BUF_HWCB_CHAR_LOST
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef BUFFER_STRESS_TEST
id|internal_print
(paren
id|DELAYED_WRITE
comma
l_string|&quot;*** &quot;
id|HWC_RW_PRINT_HEADER
l_string|&quot;page #%i at 0x%x for buffering allocated. ***&bslash;n&quot;
comma
id|hwc_data.hwcb_count
comma
id|page
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|release_write_hwcb
id|release_write_hwcb
(paren
r_void
)paren
(brace
r_int
r_int
id|page
suffix:semicolon
r_int
id|page_nr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwc_data.hwcb_count
)paren
r_return
op_minus
id|ENODATA
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.hwcb_count
op_eq
l_int|1
)paren
(brace
id|prepare_write_hwcb
(paren
)paren
suffix:semicolon
id|ALL_HWCB_CHAR
op_assign
l_int|0
suffix:semicolon
id|ALL_HWCB_MTO
op_assign
l_int|0
suffix:semicolon
id|BUF_HWCB_TIMES_LOST
op_assign
l_int|0
suffix:semicolon
id|BUF_HWCB_MTO_LOST
op_assign
l_int|0
suffix:semicolon
id|BUF_HWCB_CHAR_LOST
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|page
op_assign
(paren
r_int
r_int
)paren
id|OUT_HWCB
suffix:semicolon
id|ALL_HWCB_MTO
op_sub_assign
id|OUT_HWCB_MTO
suffix:semicolon
id|ALL_HWCB_CHAR
op_sub_assign
id|OUT_HWCB_CHAR
suffix:semicolon
id|hwc_data.hwcb_count
op_decrement
suffix:semicolon
id|OUT_HWCB
op_assign
id|OUT_HWCB_NEXT
suffix:semicolon
r_if
c_cond
(paren
id|page
op_ge
id|hwc_data.kmem_start
op_logical_and
id|page
OL
id|hwc_data.kmem_end
)paren
(brace
id|memset
(paren
(paren
r_void
op_star
)paren
id|page
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|page_nr
op_assign
(paren
r_int
)paren
(paren
(paren
id|page
op_minus
id|hwc_data.kmem_start
)paren
op_rshift
l_int|12
)paren
suffix:semicolon
id|clear_bit
(paren
id|page_nr
comma
op_amp
id|hwc_data.kmem_pages
)paren
suffix:semicolon
)brace
r_else
id|free_page
(paren
id|page
)paren
suffix:semicolon
macro_line|#ifdef BUFFER_STRESS_TEST
id|internal_print
(paren
id|DELAYED_WRITE
comma
l_string|&quot;*** &quot;
id|HWC_RW_PRINT_HEADER
l_string|&quot;page at 0x%x released, %i pages still in use ***&bslash;n&quot;
comma
id|page
comma
id|hwc_data.hwcb_count
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|add_mto
id|add_mto
(paren
r_int
r_char
op_star
id|message
comma
r_int
r_int
r_int
id|count
)paren
(brace
r_int
r_int
r_int
id|mto_size
suffix:semicolon
id|write_hwcb_t
op_star
id|hwcb
suffix:semicolon
id|mto_t
op_star
id|mto
suffix:semicolon
r_void
op_star
id|dest
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|BUF_HWCB
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|BUF_HWCB
op_eq
id|hwc_data.current_hwcb
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|mto_size
op_assign
r_sizeof
(paren
id|mto_t
)paren
op_plus
id|count
suffix:semicolon
id|hwcb
op_assign
(paren
id|write_hwcb_t
op_star
)paren
id|BUF_HWCB
suffix:semicolon
r_if
c_cond
(paren
(paren
id|MAX_HWCB_ROOM
op_minus
id|hwcb-&gt;length
)paren
OL
id|mto_size
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|mto
op_assign
(paren
id|mto_t
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|hwcb
)paren
op_plus
id|hwcb-&gt;length
)paren
suffix:semicolon
id|memcpy
(paren
id|mto
comma
op_amp
id|mto_template
comma
r_sizeof
(paren
id|mto_t
)paren
)paren
suffix:semicolon
id|dest
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|mto
)paren
op_plus
r_sizeof
(paren
id|mto_t
)paren
)paren
suffix:semicolon
id|memcpy
(paren
id|dest
comma
id|message
comma
id|count
)paren
suffix:semicolon
id|mto-&gt;length
op_add_assign
id|count
suffix:semicolon
id|hwcb-&gt;length
op_add_assign
id|mto_size
suffix:semicolon
id|hwcb-&gt;msgbuf.length
op_add_assign
id|mto_size
suffix:semicolon
id|hwcb-&gt;msgbuf.mdb.length
op_add_assign
id|mto_size
suffix:semicolon
id|BUF_HWCB_MTO
op_increment
suffix:semicolon
id|ALL_HWCB_MTO
op_increment
suffix:semicolon
id|BUF_HWCB_CHAR
op_add_assign
id|count
suffix:semicolon
id|ALL_HWCB_CHAR
op_add_assign
id|count
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
r_int
DECL|function|write_event_data_1
id|write_event_data_1
(paren
r_void
)paren
(brace
r_int
r_int
r_int
id|condition_code
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|hwc_data.write_prio
)paren
op_logical_and
(paren
op_logical_neg
id|hwc_data.write_nonprio
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.current_servc
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|retval
op_assign
id|sane_write_hwcb
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_return
id|retval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|OUT_HWCB_MTO
)paren
r_return
op_minus
id|ENODATA
suffix:semicolon
id|condition_code
op_assign
id|service_call
(paren
id|HWC_CMDW_WRITEDATA
comma
id|OUT_HWCB
)paren
suffix:semicolon
macro_line|#ifdef DUMP_HWC_WRITE_ERROR
r_if
c_cond
(paren
id|condition_code
op_ne
id|HWC_COMMAND_INITIATED
)paren
id|__asm__
(paren
l_string|&quot;LHI 1,0xe20&bslash;n&bslash;t&quot;
l_string|&quot;L 2,0(0,%0)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 3,0(0,%1)&bslash;n&bslash;t&quot;
l_string|&quot;J .+0 &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
op_amp
id|condition_code
)paren
comma
l_string|&quot;a&quot;
(paren
id|OUT_HWCB
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|condition_code
)paren
(brace
r_case
id|HWC_COMMAND_INITIATED
suffix:colon
id|hwc_data.current_servc
op_assign
id|HWC_CMDW_WRITEDATA
suffix:semicolon
id|hwc_data.current_hwcb
op_assign
id|OUT_HWCB
suffix:semicolon
id|retval
op_assign
id|condition_code
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HWC_BUSY
suffix:colon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_static
r_void
DECL|function|flush_hwcbs
id|flush_hwcbs
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
id|hwc_data.hwcb_count
OG
l_int|1
)paren
id|release_write_hwcb
(paren
)paren
suffix:semicolon
id|release_write_hwcb
(paren
)paren
suffix:semicolon
id|hwc_data.flags
op_and_assign
op_complement
id|FLUSH_HWCBS
suffix:semicolon
)brace
r_static
r_int
DECL|function|write_event_data_2
id|write_event_data_2
(paren
r_void
)paren
(brace
id|write_hwcb_t
op_star
id|hwcb
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_int
r_char
op_star
id|param
suffix:semicolon
id|param
op_assign
id|ext_int_param
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
op_ne
id|hwc_data.current_hwcb
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|hwcb
op_assign
(paren
id|write_hwcb_t
op_star
)paren
id|OUT_HWCB
suffix:semicolon
macro_line|#ifdef DUMP_HWC_WRITE_ERROR
macro_line|#if 0
r_if
c_cond
(paren
(paren
(paren
r_int
r_char
op_star
)paren
id|hwcb
)paren
op_ne
id|param
)paren
id|__asm__
(paren
l_string|&quot;LHI 1,0xe22&bslash;n&bslash;t&quot;
l_string|&quot;LRA 2,0(0,%0)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 3,0(0,%1)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 4,0(0,%2)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 5,0(0,%3)&bslash;n&bslash;t&quot;
l_string|&quot;J .+0 &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
id|OUT_HWCB
)paren
comma
l_string|&quot;a&quot;
(paren
id|hwc_data.current_hwcb
)paren
comma
l_string|&quot;a&quot;
(paren
id|BUF_HWCB
)paren
comma
l_string|&quot;a&quot;
(paren
id|param
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
comma
l_string|&quot;4&quot;
comma
l_string|&quot;5&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|hwcb-&gt;response_code
op_ne
l_int|0x0020
)paren
macro_line|#if 0
id|internal_print
(paren
id|DELAYED_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;&bslash;n************************ error in write_event_data_2()&bslash;n&quot;
l_string|&quot;OUT_HWCB:                    0x%x&bslash;n&quot;
l_string|&quot;BUF_HWCB:                    0x%x&bslash;n&quot;
l_string|&quot;response_code:               0x%x&bslash;n&quot;
l_string|&quot;hwc_data.hwcb_count:        %d&bslash;n&quot;
l_string|&quot;hwc_data.kmem_pages:        0x%x&bslash;n&quot;
l_string|&quot;hwc_data.ioctls.kmem_hwcb:   %d&bslash;n&quot;
l_string|&quot;hwc_data.ioctls.max_hwcb:    %d&bslash;n&quot;
l_string|&quot;hwc_data.kmem_start:        0x%x&bslash;n&quot;
l_string|&quot;hwc_data.kmem_end:          0x%x&bslash;n&quot;
l_string|&quot;*****************************************************&bslash;n&quot;
comma
id|OUT_HWCB
comma
id|BUF_HWCB
comma
id|hwcb-&gt;response_code
comma
id|hwc_data.hwcb_count
comma
id|hwc_data.kmem_pages
comma
id|hwc_data.ioctls.kmem_hwcb
comma
id|hwc_data.ioctls.max_hwcb
comma
id|hwc_data.kmem_start
comma
id|hwc_data.kmem_end
)paren
suffix:semicolon
macro_line|#endif
id|__asm__
(paren
l_string|&quot;LHI 1,0xe21&bslash;n&bslash;t&quot;
l_string|&quot;LRA 2,0(0,%0)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 3,0(0,%1)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 4,0(0,%2)&bslash;n&bslash;t&quot;
l_string|&quot;LH 5,0(0,%3)&bslash;n&bslash;t&quot;
l_string|&quot;SRL 5,8(0)&bslash;n&bslash;t&quot;
l_string|&quot;J .+0 &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
id|OUT_HWCB
)paren
comma
l_string|&quot;a&quot;
(paren
id|hwc_data.current_hwcb
)paren
comma
l_string|&quot;a&quot;
(paren
id|BUF_HWCB
)paren
comma
l_string|&quot;a&quot;
(paren
op_amp
(paren
id|hwc_data.hwcb_count
)paren
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
comma
l_string|&quot;4&quot;
comma
l_string|&quot;5&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|hwcb-&gt;response_code
op_eq
l_int|0x0020
)paren
(brace
id|retval
op_assign
id|OUT_HWCB_CHAR
suffix:semicolon
id|release_write_hwcb
(paren
)paren
suffix:semicolon
)brace
r_else
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
id|hwc_data.current_servc
op_assign
l_int|0
suffix:semicolon
id|hwc_data.current_hwcb
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.flags
op_amp
id|FLUSH_HWCBS
)paren
id|flush_hwcbs
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_void
DECL|function|do_put_line
id|do_put_line
(paren
r_int
r_char
op_star
id|message
comma
r_int
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|add_mto
(paren
id|message
comma
id|count
)paren
op_ne
id|count
)paren
(brace
r_if
c_cond
(paren
id|allocate_write_hwcb
(paren
)paren
OL
l_int|0
)paren
id|reuse_write_hwcb
(paren
)paren
suffix:semicolon
macro_line|#ifdef DUMP_HWC_WRITE_LIST_ERROR
r_if
c_cond
(paren
id|add_mto
(paren
id|message
comma
id|count
)paren
op_ne
id|count
)paren
id|__asm__
(paren
l_string|&quot;LHI 1,0xe32&bslash;n&bslash;t&quot;
l_string|&quot;LRA 2,0(0,%0)&bslash;n&bslash;t&quot;
l_string|&quot;L 3,0(0,%1)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 4,0(0,%2)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 5,0(0,%3)&bslash;n&bslash;t&quot;
l_string|&quot;J .+0 &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
id|message
)paren
comma
l_string|&quot;a&quot;
(paren
op_amp
id|hwc_data.kmem_pages
)paren
comma
l_string|&quot;a&quot;
(paren
id|BUF_HWCB
)paren
comma
l_string|&quot;a&quot;
(paren
id|OUT_HWCB
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
comma
l_string|&quot;4&quot;
comma
l_string|&quot;5&quot;
)paren
suffix:semicolon
macro_line|#else
id|add_mto
(paren
id|message
comma
id|count
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_static
r_void
DECL|function|put_line
id|put_line
(paren
r_int
r_char
op_star
id|message
comma
r_int
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|hwc_data.obuf_start
)paren
op_logical_and
(paren
id|hwc_data.flags
op_amp
id|HWC_TIMER_RUNS
)paren
)paren
(brace
id|del_timer
(paren
op_amp
id|hwc_data.write_timer
)paren
suffix:semicolon
id|hwc_data.flags
op_and_assign
op_complement
id|HWC_TIMER_RUNS
suffix:semicolon
)brace
id|hwc_data.obuf_start
op_add_assign
id|count
suffix:semicolon
id|do_put_line
(paren
id|message
comma
id|count
)paren
suffix:semicolon
id|hwc_data.obuf_start
op_sub_assign
id|count
suffix:semicolon
)brace
r_static
r_void
DECL|function|set_alarm
id|set_alarm
(paren
r_void
)paren
(brace
id|write_hwcb_t
op_star
id|hwcb
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|BUF_HWCB
)paren
op_logical_or
(paren
id|BUF_HWCB
op_eq
id|hwc_data.current_hwcb
)paren
)paren
id|allocate_write_hwcb
(paren
)paren
suffix:semicolon
id|hwcb
op_assign
(paren
id|write_hwcb_t
op_star
)paren
id|BUF_HWCB
suffix:semicolon
id|hwcb-&gt;msgbuf.mdb.mdb_body.go.general_msg_flags
op_or_assign
id|GMF_SndAlrm
suffix:semicolon
)brace
r_static
r_void
DECL|function|hwc_write_timeout
id|hwc_write_timeout
(paren
r_int
r_int
id|data
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
id|hwc_data.obuf_start
op_assign
id|hwc_data.obuf_count
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.obuf_count
)paren
id|put_line
(paren
id|hwc_data.obuf
comma
id|hwc_data.obuf_count
)paren
suffix:semicolon
id|hwc_data.obuf_start
op_assign
l_int|0
suffix:semicolon
id|hwc_data.obuf_cursor
op_assign
l_int|0
suffix:semicolon
id|hwc_data.obuf_count
op_assign
l_int|0
suffix:semicolon
id|write_event_data_1
(paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|do_hwc_write
id|do_hwc_write
(paren
r_int
id|from_user
comma
r_int
r_char
op_star
id|msg
comma
r_int
r_int
id|count
comma
r_int
r_char
id|code
comma
r_int
r_char
id|write_time
)paren
(brace
r_int
r_int
id|i_msg
op_assign
l_int|0
suffix:semicolon
r_int
r_int
r_int
id|spaces
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|processed_characters
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|ch
comma
id|orig_ch
suffix:semicolon
r_int
r_int
r_int
id|obuf_count
suffix:semicolon
r_int
r_int
r_int
id|obuf_cursor
suffix:semicolon
r_int
r_int
r_int
id|obuf_columns
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.obuf_start
)paren
(brace
id|obuf_cursor
op_assign
l_int|0
suffix:semicolon
id|obuf_count
op_assign
l_int|0
suffix:semicolon
id|obuf_columns
op_assign
id|MIN
(paren
id|hwc_data.ioctls.columns
comma
id|MAX_MESSAGE_SIZE
op_minus
id|hwc_data.obuf_start
)paren
suffix:semicolon
)brace
r_else
(brace
id|obuf_cursor
op_assign
id|hwc_data.obuf_cursor
suffix:semicolon
id|obuf_count
op_assign
id|hwc_data.obuf_count
suffix:semicolon
id|obuf_columns
op_assign
id|hwc_data.ioctls.columns
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i_msg
op_assign
l_int|0
suffix:semicolon
id|i_msg
OL
id|count
suffix:semicolon
id|i_msg
op_increment
)paren
(brace
r_if
c_cond
(paren
id|from_user
)paren
id|get_user
(paren
id|orig_ch
comma
id|msg
op_plus
id|i_msg
)paren
suffix:semicolon
r_else
id|orig_ch
op_assign
id|msg
(braket
id|i_msg
)braket
suffix:semicolon
r_if
c_cond
(paren
id|code
op_eq
id|CODE_EBCDIC
)paren
id|ch
op_assign
id|_ebcasc
(braket
id|orig_ch
)braket
suffix:semicolon
r_else
id|ch
op_assign
id|orig_ch
suffix:semicolon
id|processed_characters
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|obuf_cursor
op_eq
id|obuf_columns
)paren
op_logical_and
(paren
id|ch
op_ne
l_char|&squot;&bslash;n&squot;
)paren
op_logical_and
(paren
id|ch
op_ne
l_char|&squot;&bslash;t&squot;
)paren
)paren
(brace
id|put_line
(paren
op_amp
id|hwc_data.obuf
(braket
id|hwc_data.obuf_start
)braket
comma
id|obuf_columns
)paren
suffix:semicolon
id|obuf_cursor
op_assign
l_int|0
suffix:semicolon
id|obuf_count
op_assign
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ch
)paren
(brace
r_case
l_char|&squot;&bslash;n&squot;
suffix:colon
id|put_line
(paren
op_amp
id|hwc_data.obuf
(braket
id|hwc_data.obuf_start
)braket
comma
id|obuf_count
)paren
suffix:semicolon
id|obuf_cursor
op_assign
l_int|0
suffix:semicolon
id|obuf_count
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;&bslash;a&squot;
suffix:colon
id|hwc_data.obuf_start
op_add_assign
id|obuf_count
suffix:semicolon
id|set_alarm
(paren
)paren
suffix:semicolon
id|hwc_data.obuf_start
op_sub_assign
id|obuf_count
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;&bslash;t&squot;
suffix:colon
r_do
(brace
r_if
c_cond
(paren
id|obuf_cursor
OL
id|obuf_columns
)paren
(brace
id|hwc_data.obuf
(braket
id|hwc_data.obuf_start
op_plus
id|obuf_cursor
)braket
op_assign
l_int|0x20
suffix:semicolon
id|obuf_cursor
op_increment
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|obuf_cursor
op_mod
id|hwc_data.ioctls.width_htab
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;&bslash;f&squot;
suffix:colon
r_case
l_char|&squot;&bslash;v&squot;
suffix:colon
id|spaces
op_assign
id|obuf_cursor
suffix:semicolon
id|put_line
(paren
op_amp
id|hwc_data.obuf
(braket
id|hwc_data.obuf_start
)braket
comma
id|obuf_count
)paren
suffix:semicolon
id|obuf_count
op_assign
id|obuf_cursor
suffix:semicolon
r_while
c_loop
(paren
id|spaces
)paren
(brace
id|hwc_data.obuf
(braket
id|hwc_data.obuf_start
op_plus
id|obuf_cursor
op_minus
id|spaces
)braket
op_assign
l_int|0x20
suffix:semicolon
id|spaces
op_decrement
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_char|&squot;&bslash;b&squot;
suffix:colon
r_if
c_cond
(paren
id|obuf_cursor
)paren
id|obuf_cursor
op_decrement
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;&bslash;r&squot;
suffix:colon
id|obuf_cursor
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x00
suffix:colon
id|put_line
(paren
op_amp
id|hwc_data.obuf
(braket
id|hwc_data.obuf_start
)braket
comma
id|obuf_count
)paren
suffix:semicolon
id|obuf_cursor
op_assign
l_int|0
suffix:semicolon
id|obuf_count
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|isprint
(paren
id|ch
)paren
)paren
id|hwc_data.obuf
(braket
id|hwc_data.obuf_start
op_plus
id|obuf_cursor
op_increment
)braket
op_assign
(paren
id|code
op_eq
id|CODE_ASCII
)paren
ques
c_cond
id|_ascebc
(braket
id|orig_ch
)braket
suffix:colon
id|orig_ch
suffix:semicolon
)brace
r_if
c_cond
(paren
id|obuf_cursor
OG
id|obuf_count
)paren
id|obuf_count
op_assign
id|obuf_cursor
suffix:semicolon
)brace
r_if
c_cond
(paren
id|obuf_cursor
)paren
(brace
r_if
c_cond
(paren
id|hwc_data.obuf_start
op_logical_or
(paren
id|hwc_data.ioctls.final_nl
op_eq
l_int|0
)paren
)paren
(brace
id|put_line
(paren
op_amp
id|hwc_data.obuf
(braket
id|hwc_data.obuf_start
)braket
comma
id|obuf_count
)paren
suffix:semicolon
id|obuf_cursor
op_assign
l_int|0
suffix:semicolon
id|obuf_count
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|hwc_data.ioctls.final_nl
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|hwc_data.flags
op_amp
id|HWC_TIMER_RUNS
)paren
(brace
id|hwc_data.write_timer.expires
op_assign
id|jiffies
op_plus
id|hwc_data.ioctls.final_nl
op_star
id|HZ
op_div
l_int|10
suffix:semicolon
)brace
r_else
(brace
id|init_timer
(paren
op_amp
id|hwc_data.write_timer
)paren
suffix:semicolon
id|hwc_data.write_timer.function
op_assign
id|hwc_write_timeout
suffix:semicolon
id|hwc_data.write_timer.data
op_assign
(paren
r_int
r_int
)paren
l_int|NULL
suffix:semicolon
id|hwc_data.write_timer.expires
op_assign
id|jiffies
op_plus
id|hwc_data.ioctls.final_nl
op_star
id|HZ
op_div
l_int|10
suffix:semicolon
id|add_timer
(paren
op_amp
id|hwc_data.write_timer
)paren
suffix:semicolon
id|hwc_data.flags
op_or_assign
id|HWC_TIMER_RUNS
suffix:semicolon
)brace
)brace
r_else
suffix:semicolon
)brace
)brace
r_else
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|hwc_data.obuf_start
)paren
(brace
id|hwc_data.obuf_cursor
op_assign
id|obuf_cursor
suffix:semicolon
id|hwc_data.obuf_count
op_assign
id|obuf_count
suffix:semicolon
)brace
r_if
c_cond
(paren
id|write_time
op_eq
id|IMMEDIATE_WRITE
)paren
id|write_event_data_1
(paren
)paren
suffix:semicolon
r_return
id|processed_characters
suffix:semicolon
)brace
r_int
r_int
DECL|function|hwc_write
id|hwc_write
(paren
r_int
id|from_user
comma
r_const
r_int
r_char
op_star
id|msg
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
id|retval
op_assign
id|do_hwc_write
(paren
id|from_user
comma
id|msg
comma
id|count
comma
id|hwc_data.ioctls.code
comma
id|IMMEDIATE_WRITE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_int
r_int
DECL|function|hwc_chars_in_buffer
id|hwc_chars_in_buffer
(paren
r_int
r_char
id|flag
)paren
(brace
r_int
r_int
r_int
id|number
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_amp
id|IN_HWCB
)paren
id|number
op_add_assign
id|ALL_HWCB_CHAR
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_amp
id|IN_WRITE_BUF
)paren
id|number
op_add_assign
id|hwc_data.obuf_cursor
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|number
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|nr_setbits
id|nr_setbits
(paren
id|kmem_pages_t
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|nr
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_sizeof
(paren
id|arg
)paren
op_lshift
l_int|3
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|arg
op_amp
l_int|1
)paren
id|nr
op_increment
suffix:semicolon
id|arg
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_return
id|nr
suffix:semicolon
)brace
r_int
r_int
DECL|function|hwc_write_room
id|hwc_write_room
(paren
r_int
r_char
id|flag
)paren
(brace
r_int
r_int
id|number
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|write_hwcb_t
op_star
id|hwcb
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_amp
id|IN_HWCB
)paren
(brace
r_if
c_cond
(paren
id|BUF_HWCB
)paren
(brace
id|hwcb
op_assign
(paren
id|write_hwcb_t
op_star
)paren
id|BUF_HWCB
suffix:semicolon
id|number
op_add_assign
id|MAX_HWCB_ROOM
op_minus
id|hwcb-&gt;length
suffix:semicolon
)brace
id|number
op_add_assign
(paren
id|hwc_data.ioctls.kmem_hwcb
op_minus
id|nr_setbits
(paren
id|hwc_data.kmem_pages
)paren
)paren
op_star
(paren
id|MAX_HWCB_ROOM
op_minus
(paren
r_sizeof
(paren
id|write_hwcb_t
)paren
op_plus
r_sizeof
(paren
id|mto_t
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flag
op_amp
id|IN_WRITE_BUF
)paren
id|number
op_add_assign
id|MAX_HWCB_ROOM
op_minus
id|hwc_data.obuf_cursor
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|number
suffix:semicolon
)brace
r_void
DECL|function|hwc_flush_buffer
id|hwc_flush_buffer
(paren
r_int
r_char
id|flag
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_amp
id|IN_HWCB
)paren
(brace
r_if
c_cond
(paren
id|hwc_data.current_servc
op_ne
id|HWC_CMDW_WRITEDATA
)paren
id|flush_hwcbs
(paren
)paren
suffix:semicolon
r_else
id|hwc_data.flags
op_or_assign
id|FLUSH_HWCBS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flag
op_amp
id|IN_WRITE_BUF
)paren
(brace
id|hwc_data.obuf_cursor
op_assign
l_int|0
suffix:semicolon
id|hwc_data.obuf_count
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_int
r_int
r_int
DECL|function|seperate_cases
id|seperate_cases
(paren
r_int
r_char
op_star
id|buf
comma
r_int
r_int
r_int
id|count
)paren
(brace
r_int
r_int
r_int
id|i_in
suffix:semicolon
r_int
r_int
r_int
id|i_out
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|_case
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i_in
op_assign
l_int|0
suffix:semicolon
id|i_in
OL
id|count
suffix:semicolon
id|i_in
op_increment
)paren
(brace
r_if
c_cond
(paren
id|buf
(braket
id|i_in
)braket
op_eq
id|hwc_data.ioctls.delim
)paren
(brace
r_if
c_cond
(paren
(paren
id|i_in
op_plus
l_int|1
OL
id|count
)paren
op_logical_and
(paren
id|buf
(braket
id|i_in
op_plus
l_int|1
)braket
op_eq
id|hwc_data.ioctls.delim
)paren
)paren
(brace
id|buf
(braket
id|i_out
)braket
op_assign
id|hwc_data.ioctls.delim
suffix:semicolon
id|i_out
op_increment
suffix:semicolon
id|i_in
op_increment
suffix:semicolon
)brace
r_else
id|_case
op_assign
op_complement
id|_case
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|_case
)paren
(brace
r_if
c_cond
(paren
id|hwc_data.ioctls.tolower
)paren
id|buf
(braket
id|i_out
)braket
op_assign
id|_ebc_toupper
(braket
id|buf
(braket
id|i_in
)braket
)braket
suffix:semicolon
r_else
id|buf
(braket
id|i_out
)braket
op_assign
id|_ebc_tolower
(braket
id|buf
(braket
id|i_in
)braket
)braket
suffix:semicolon
)brace
r_else
id|buf
(braket
id|i_out
)braket
op_assign
id|buf
(braket
id|i_in
)braket
suffix:semicolon
id|i_out
op_increment
suffix:semicolon
)brace
)brace
r_return
id|i_out
suffix:semicolon
)brace
macro_line|#ifdef DUMP_HWCB_INPUT
r_static
r_int
DECL|function|gds_vector_name
id|gds_vector_name
(paren
id|u16
id|id
comma
r_int
r_char
id|name
(braket
)braket
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|id
)paren
(brace
r_case
id|GDS_ID_MDSMU
suffix:colon
id|name
op_assign
l_string|&quot;Multiple Domain Support Message Unit&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GDS_ID_MDSRouteInfo
suffix:colon
id|name
op_assign
l_string|&quot;MDS Routing Information&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GDS_ID_AgUnWrkCorr
suffix:colon
id|name
op_assign
l_string|&quot;Agent Unit of Work Correlator&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GDS_ID_SNACondReport
suffix:colon
id|name
op_assign
l_string|&quot;SNA Condition Report&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GDS_ID_CPMSU
suffix:colon
id|name
op_assign
l_string|&quot;CP Management Services Unit&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GDS_ID_RoutTargInstr
suffix:colon
id|name
op_assign
l_string|&quot;Routing and Targeting Instructions&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GDS_ID_OpReq
suffix:colon
id|name
op_assign
l_string|&quot;Operate Request&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GDS_ID_TextCmd
suffix:colon
id|name
op_assign
l_string|&quot;Text Command&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|name
op_assign
l_string|&quot;unknown GDS variable&quot;
suffix:semicolon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
macro_line|#endif
r_inline
r_static
id|gds_vector_t
op_star
DECL|function|find_gds_vector
id|find_gds_vector
(paren
id|gds_vector_t
op_star
id|start
comma
r_void
op_star
id|end
comma
id|u16
id|id
)paren
(brace
id|gds_vector_t
op_star
id|vec
suffix:semicolon
id|gds_vector_t
op_star
id|retval
op_assign
l_int|NULL
suffix:semicolon
id|vec
op_assign
id|start
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
r_void
op_star
)paren
id|vec
)paren
OL
id|end
)paren
(brace
r_if
c_cond
(paren
id|vec-&gt;gds_id
op_eq
id|id
)paren
(brace
macro_line|#ifdef DUMP_HWCB_INPUT
r_int
id|retval_name
suffix:semicolon
r_int
r_char
id|name
(braket
l_int|64
)braket
suffix:semicolon
id|retval_name
op_assign
id|gds_vector_name
(paren
id|id
comma
id|name
)paren
suffix:semicolon
id|internal_print
(paren
id|DELAYED_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;%s at 0x%x up to 0x%x, length: %d&quot;
comma
id|name
comma
(paren
r_int
r_int
)paren
id|vec
comma
(paren
(paren
r_int
r_int
)paren
id|vec
)paren
op_plus
id|vec-&gt;length
op_minus
l_int|1
comma
id|vec-&gt;length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval_name
OL
l_int|0
)paren
id|internal_print
(paren
id|IMMEDIATE_WRITE
comma
l_string|&quot;, id: 0x%x&bslash;n&quot;
comma
id|vec-&gt;gds_id
)paren
suffix:semicolon
r_else
id|internal_print
(paren
id|IMMEDIATE_WRITE
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|retval
op_assign
id|vec
suffix:semicolon
r_break
suffix:semicolon
)brace
id|vec
op_assign
(paren
id|gds_vector_t
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|vec
)paren
op_plus
id|vec-&gt;length
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_inline
r_static
id|gds_subvector_t
op_star
DECL|function|find_gds_subvector
id|find_gds_subvector
(paren
id|gds_subvector_t
op_star
id|start
comma
r_void
op_star
id|end
comma
id|u8
id|key
)paren
(brace
id|gds_subvector_t
op_star
id|subvec
suffix:semicolon
id|gds_subvector_t
op_star
id|retval
op_assign
l_int|NULL
suffix:semicolon
id|subvec
op_assign
id|start
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
r_void
op_star
)paren
id|subvec
)paren
OL
id|end
)paren
(brace
r_if
c_cond
(paren
id|subvec-&gt;key
op_eq
id|key
)paren
(brace
id|retval
op_assign
id|subvec
suffix:semicolon
r_break
suffix:semicolon
)brace
id|subvec
op_assign
(paren
id|gds_subvector_t
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|subvec
)paren
op_plus
id|subvec-&gt;length
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_inline
r_static
r_int
DECL|function|get_input
id|get_input
(paren
r_void
op_star
id|start
comma
r_void
op_star
id|end
)paren
(brace
r_int
id|count
suffix:semicolon
id|count
op_assign
(paren
(paren
r_int
r_int
)paren
id|end
)paren
op_minus
(paren
(paren
r_int
r_int
)paren
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.ioctls.tolower
)paren
id|EBC_TOLOWER
(paren
id|start
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.ioctls.delim
)paren
id|count
op_assign
id|seperate_cases
(paren
id|start
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.ioctls.echo
)paren
id|do_hwc_write
(paren
l_int|0
comma
id|start
comma
id|count
comma
id|CODE_EBCDIC
comma
id|IMMEDIATE_WRITE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.ioctls.code
op_eq
id|CODE_ASCII
)paren
id|EBCASC
(paren
id|start
comma
id|count
)paren
suffix:semicolon
id|store_hwc_input
(paren
id|start
comma
id|count
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_inline
r_static
r_int
DECL|function|eval_selfdeftextmsg
id|eval_selfdeftextmsg
(paren
id|gds_subvector_t
op_star
id|start
comma
r_void
op_star
id|end
)paren
(brace
id|gds_subvector_t
op_star
id|subvec
suffix:semicolon
r_void
op_star
id|subvec_data
suffix:semicolon
r_void
op_star
id|subvec_end
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|subvec
op_assign
id|start
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
r_void
op_star
)paren
id|subvec
)paren
OL
id|end
)paren
(brace
id|subvec
op_assign
id|find_gds_subvector
(paren
id|subvec
comma
id|end
comma
l_int|0x30
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|subvec
)paren
r_break
suffix:semicolon
id|subvec_data
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|subvec
)paren
op_plus
r_sizeof
(paren
id|gds_subvector_t
)paren
)paren
suffix:semicolon
id|subvec_end
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|subvec
)paren
op_plus
id|subvec-&gt;length
)paren
suffix:semicolon
id|retval
op_add_assign
id|get_input
(paren
id|subvec_data
comma
id|subvec_end
)paren
suffix:semicolon
id|subvec
op_assign
(paren
id|gds_subvector_t
op_star
)paren
id|subvec_end
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_inline
r_static
r_int
DECL|function|eval_textcmd
id|eval_textcmd
(paren
id|gds_subvector_t
op_star
id|start
comma
r_void
op_star
id|end
)paren
(brace
id|gds_subvector_t
op_star
id|subvec
suffix:semicolon
id|gds_subvector_t
op_star
id|subvec_data
suffix:semicolon
r_void
op_star
id|subvec_end
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|subvec
op_assign
id|start
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
r_void
op_star
)paren
id|subvec
)paren
OL
id|end
)paren
(brace
id|subvec
op_assign
id|find_gds_subvector
(paren
id|subvec
comma
id|end
comma
id|GDS_KEY_SelfDefTextMsg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|subvec
)paren
r_break
suffix:semicolon
id|subvec_data
op_assign
(paren
id|gds_subvector_t
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|subvec
)paren
op_plus
r_sizeof
(paren
id|gds_subvector_t
)paren
)paren
suffix:semicolon
id|subvec_end
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|subvec
)paren
op_plus
id|subvec-&gt;length
)paren
suffix:semicolon
id|retval
op_add_assign
id|eval_selfdeftextmsg
(paren
id|subvec_data
comma
id|subvec_end
)paren
suffix:semicolon
id|subvec
op_assign
(paren
id|gds_subvector_t
op_star
)paren
id|subvec_end
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_inline
r_static
r_int
DECL|function|eval_cpmsu
id|eval_cpmsu
(paren
id|gds_vector_t
op_star
id|start
comma
r_void
op_star
id|end
)paren
(brace
id|gds_vector_t
op_star
id|vec
suffix:semicolon
id|gds_subvector_t
op_star
id|vec_data
suffix:semicolon
r_void
op_star
id|vec_end
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|vec
op_assign
id|start
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
r_void
op_star
)paren
id|vec
)paren
OL
id|end
)paren
(brace
id|vec
op_assign
id|find_gds_vector
(paren
id|vec
comma
id|end
comma
id|GDS_ID_TextCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vec
)paren
r_break
suffix:semicolon
id|vec_data
op_assign
(paren
id|gds_subvector_t
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|vec
)paren
op_plus
r_sizeof
(paren
id|gds_vector_t
)paren
)paren
suffix:semicolon
id|vec_end
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|vec
)paren
op_plus
id|vec-&gt;length
)paren
suffix:semicolon
id|retval
op_add_assign
id|eval_textcmd
(paren
id|vec_data
comma
id|vec_end
)paren
suffix:semicolon
id|vec
op_assign
(paren
id|gds_vector_t
op_star
)paren
id|vec_end
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_inline
r_static
r_int
DECL|function|eval_mdsmu
id|eval_mdsmu
(paren
id|gds_vector_t
op_star
id|start
comma
r_void
op_star
id|end
)paren
(brace
id|gds_vector_t
op_star
id|vec
suffix:semicolon
id|gds_vector_t
op_star
id|vec_data
suffix:semicolon
r_void
op_star
id|vec_end
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|vec
op_assign
id|find_gds_vector
(paren
id|start
comma
id|end
comma
id|GDS_ID_CPMSU
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vec
)paren
(brace
id|vec_data
op_assign
(paren
id|gds_vector_t
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|vec
)paren
op_plus
r_sizeof
(paren
id|gds_vector_t
)paren
)paren
suffix:semicolon
id|vec_end
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|vec
)paren
op_plus
id|vec-&gt;length
)paren
suffix:semicolon
id|retval
op_assign
id|eval_cpmsu
(paren
id|vec_data
comma
id|vec_end
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_inline
r_static
r_int
DECL|function|eval_evbuf
id|eval_evbuf
(paren
id|gds_vector_t
op_star
id|start
comma
r_void
op_star
id|end
)paren
(brace
id|gds_vector_t
op_star
id|vec
suffix:semicolon
id|gds_vector_t
op_star
id|vec_data
suffix:semicolon
r_void
op_star
id|vec_end
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|vec
op_assign
id|find_gds_vector
(paren
id|start
comma
id|end
comma
id|GDS_ID_MDSMU
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vec
)paren
(brace
id|vec_data
op_assign
(paren
id|gds_vector_t
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|vec
)paren
op_plus
r_sizeof
(paren
id|gds_vector_t
)paren
)paren
suffix:semicolon
id|vec_end
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|vec
)paren
op_plus
id|vec-&gt;length
)paren
suffix:semicolon
id|retval
op_assign
id|eval_mdsmu
(paren
id|vec_data
comma
id|vec_end
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|process_evbufs
id|process_evbufs
(paren
r_void
op_star
id|start
comma
r_void
op_star
id|end
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|evbuf_t
op_star
id|evbuf
suffix:semicolon
r_void
op_star
id|evbuf_end
suffix:semicolon
id|gds_vector_t
op_star
id|evbuf_data
suffix:semicolon
id|evbuf
op_assign
(paren
id|evbuf_t
op_star
)paren
id|start
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
r_void
op_star
)paren
id|evbuf
)paren
OL
id|end
)paren
(brace
id|evbuf_data
op_assign
(paren
id|gds_vector_t
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|evbuf
)paren
op_plus
r_sizeof
(paren
id|evbuf_t
)paren
)paren
suffix:semicolon
id|evbuf_end
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|evbuf
)paren
op_plus
id|evbuf-&gt;length
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|evbuf-&gt;type
)paren
(brace
r_case
id|ET_OpCmd
suffix:colon
r_case
id|ET_CntlProgOpCmd
suffix:colon
r_case
id|ET_PMsgCmd
suffix:colon
macro_line|#ifdef DUMP_HWCB_INPUT
id|internal_print
(paren
id|DELAYED_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;event buffer &quot;
l_string|&quot;at 0x%x up to 0x%x, length: %d&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|evbuf
comma
(paren
r_int
r_int
)paren
(paren
id|evbuf_end
op_minus
l_int|1
)paren
comma
id|evbuf-&gt;length
)paren
suffix:semicolon
id|dump_storage_area
(paren
(paren
r_void
op_star
)paren
id|evbuf
comma
id|evbuf-&gt;length
)paren
suffix:semicolon
macro_line|#endif
id|retval
op_add_assign
id|eval_evbuf
(paren
id|evbuf_data
comma
id|evbuf_end
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ET_StateChange
suffix:colon
id|retval
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
(paren
id|KERN_WARNING
id|HWC_RW_PRINT_HEADER
l_string|&quot;unconditional read: &quot;
l_string|&quot;unknown event buffer found, &quot;
l_string|&quot;type 0x%x&quot;
comma
id|evbuf-&gt;type
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOSYS
suffix:semicolon
)brace
id|evbuf
op_assign
(paren
id|evbuf_t
op_star
)paren
id|evbuf_end
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|unconditional_read_1
id|unconditional_read_1
(paren
r_void
)paren
(brace
r_int
r_int
r_int
id|condition_code
suffix:semicolon
id|read_hwcb_t
op_star
id|hwcb
op_assign
(paren
id|read_hwcb_t
op_star
)paren
id|hwc_data.page
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|hwc_data.read_prio
)paren
op_logical_and
(paren
op_logical_neg
id|hwc_data.read_nonprio
)paren
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|hwc_data.current_servc
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|memset
(paren
id|hwcb
comma
l_int|0x00
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|memcpy
(paren
id|hwcb
comma
op_amp
id|read_hwcb_template
comma
r_sizeof
(paren
id|read_hwcb_t
)paren
)paren
suffix:semicolon
id|condition_code
op_assign
id|service_call
(paren
id|HWC_CMDW_READDATA
comma
id|hwc_data.page
)paren
suffix:semicolon
macro_line|#ifdef DUMP_HWC_READ_ERROR
r_if
c_cond
(paren
id|condition_code
op_eq
id|HWC_NOT_OPERATIONAL
)paren
id|__asm__
(paren
l_string|&quot;LHI 1,0xe40&bslash;n&bslash;t&quot;
l_string|&quot;L 2,0(0,%0)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 3,0(0,%1)&bslash;n&bslash;t&quot;
l_string|&quot;J .+0 &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
op_amp
id|condition_code
)paren
comma
l_string|&quot;a&quot;
(paren
id|hwc_data.page
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|condition_code
)paren
(brace
r_case
id|HWC_COMMAND_INITIATED
suffix:colon
id|hwc_data.current_servc
op_assign
id|HWC_CMDW_READDATA
suffix:semicolon
id|hwc_data.current_hwcb
op_assign
id|hwc_data.page
suffix:semicolon
id|retval
op_assign
id|condition_code
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HWC_BUSY
suffix:colon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|unconditional_read_2
id|unconditional_read_2
(paren
r_void
)paren
(brace
id|read_hwcb_t
op_star
id|hwcb
op_assign
(paren
id|read_hwcb_t
op_star
)paren
id|hwc_data.page
suffix:semicolon
macro_line|#ifdef DUMP_HWC_READ_ERROR
r_if
c_cond
(paren
(paren
id|hwcb-&gt;response_code
op_ne
l_int|0x0020
)paren
op_logical_and
(paren
id|hwcb-&gt;response_code
op_ne
l_int|0x0220
)paren
op_logical_and
(paren
id|hwcb-&gt;response_code
op_ne
l_int|0x60F0
)paren
op_logical_and
(paren
id|hwcb-&gt;response_code
op_ne
l_int|0x62F0
)paren
)paren
id|__asm__
(paren
l_string|&quot;LHI 1,0xe41&bslash;n&bslash;t&quot;
l_string|&quot;LRA 2,0(0,%0)&bslash;n&bslash;t&quot;
l_string|&quot;L 3,0(0,%1)&bslash;n&bslash;t&quot;
l_string|&quot;J .+0&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
id|hwc_data.page
)paren
comma
l_string|&quot;a&quot;
(paren
op_amp
(paren
id|hwcb-&gt;response_code
)paren
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#endif
id|hwc_data.current_servc
op_assign
l_int|0
suffix:semicolon
id|hwc_data.current_hwcb
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|hwcb-&gt;response_code
)paren
(brace
r_case
l_int|0x0020
suffix:colon
r_case
l_int|0x0220
suffix:colon
r_return
id|process_evbufs
(paren
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|hwcb
)paren
op_plus
r_sizeof
(paren
id|read_hwcb_t
)paren
)paren
comma
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|hwcb
)paren
op_plus
id|hwcb-&gt;length
)paren
)paren
suffix:semicolon
r_case
l_int|0x60F0
suffix:colon
r_case
l_int|0x62F0
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
l_int|0x0100
suffix:colon
id|internal_print
(paren
id|IMMEDIATE_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;unconditional read: HWCB boundary violation - this &quot;
l_string|&quot;must not occur in a correct driver, please contact &quot;
l_string|&quot;author&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
r_case
l_int|0x0300
suffix:colon
id|internal_print
(paren
id|IMMEDIATE_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;unconditional read: &quot;
l_string|&quot;insufficient HWCB length - this must not occur in a &quot;
l_string|&quot;correct driver, please contact author&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
r_case
l_int|0x01F0
suffix:colon
id|internal_print
(paren
id|IMMEDIATE_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;unconditional read: &quot;
l_string|&quot;invalid command - this must not occur in a correct &quot;
l_string|&quot;driver, please contact author&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
r_case
l_int|0x40F0
suffix:colon
id|internal_print
(paren
id|IMMEDIATE_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;unconditional read: invalid function code - this &quot;
l_string|&quot;must not occur in a correct driver, please contact &quot;
l_string|&quot;author&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
r_case
l_int|0x70F0
suffix:colon
id|internal_print
(paren
id|IMMEDIATE_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;unconditional read: invalid selection mask - this &quot;
l_string|&quot;must not occur in a correct driver, please contact &quot;
l_string|&quot;author&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
r_case
l_int|0x0040
suffix:colon
id|internal_print
(paren
id|IMMEDIATE_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;unconditional read: HWC equipment check - don&squot;t &quot;
l_string|&quot;know how to handle this case&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
r_default
suffix:colon
id|internal_print
(paren
id|IMMEDIATE_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;unconditional read: invalid response code %x - this &quot;
l_string|&quot;must not occur in a correct driver, please contact &quot;
l_string|&quot;author&bslash;n&quot;
comma
id|hwcb-&gt;response_code
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|write_event_mask_1
id|write_event_mask_1
(paren
r_void
)paren
(brace
r_int
r_int
id|condition_code
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|memcpy
(paren
id|hwc_data.page
comma
op_amp
id|init_hwcb_template
comma
r_sizeof
(paren
id|init_hwcb_t
)paren
)paren
suffix:semicolon
id|condition_code
op_assign
id|service_call
(paren
id|HWC_CMDW_WRITEMASK
comma
id|hwc_data.page
)paren
suffix:semicolon
macro_line|#ifdef DUMP_HWC_INIT_ERROR
r_if
c_cond
(paren
id|condition_code
op_ne
id|HWC_COMMAND_INITIATED
)paren
id|__asm__
(paren
l_string|&quot;LHI 1,0xe10&bslash;n&bslash;t&quot;
l_string|&quot;L 2,0(0,%0)&bslash;n&bslash;t&quot;
l_string|&quot;LRA 3,0(0,%1)&bslash;n&bslash;t&quot;
l_string|&quot;J .+0&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
op_amp
id|condition_code
)paren
comma
l_string|&quot;a&quot;
(paren
id|hwc_data.page
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|condition_code
)paren
(brace
r_case
id|HWC_COMMAND_INITIATED
suffix:colon
id|hwc_data.current_servc
op_assign
id|HWC_CMDW_WRITEMASK
suffix:semicolon
id|hwc_data.current_hwcb
op_assign
id|hwc_data.page
suffix:semicolon
id|retval
op_assign
id|condition_code
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HWC_BUSY
suffix:colon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|write_event_mask_2
id|write_event_mask_2
(paren
r_void
)paren
(brace
id|init_hwcb_t
op_star
id|hwcb
op_assign
(paren
id|init_hwcb_t
op_star
)paren
id|hwc_data.page
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hwcb-&gt;hwc_receive_mask
op_amp
id|ET_Msg_Mask
)paren
id|hwc_data.write_nonprio
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|hwcb-&gt;hwc_receive_mask
op_amp
id|ET_PMsgCmd_Mask
)paren
id|hwc_data.write_prio
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|hwcb-&gt;hwc_send_mask
op_amp
id|ET_OpCmd_Mask
)paren
id|hwc_data.read_nonprio
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|hwcb-&gt;hwc_send_mask
op_amp
id|ET_PMsgCmd_Mask
)paren
id|hwc_data.read_nonprio
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hwcb-&gt;response_code
op_ne
l_int|0x0020
)paren
op_logical_or
(paren
op_logical_neg
id|hwc_data.write_nonprio
)paren
op_logical_or
(paren
(paren
op_logical_neg
id|hwc_data.read_nonprio
)paren
op_logical_and
(paren
op_logical_neg
id|hwc_data.read_prio
)paren
)paren
)paren
macro_line|#ifdef DUMP_HWC_INIT_ERROR
id|__asm__
(paren
l_string|&quot;LHI 1,0xe11&bslash;n&bslash;t&quot;
l_string|&quot;LRA 2,0(0,%0)&bslash;n&bslash;t&quot;
l_string|&quot;L 3,0(0,%1)&bslash;n&bslash;t&quot;
l_string|&quot;J .+0&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;a&quot;
(paren
id|hwcb
)paren
comma
l_string|&quot;a&quot;
(paren
op_amp
(paren
id|hwcb-&gt;response_code
)paren
)paren
suffix:colon
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#else
id|retval
op_assign
op_minus
id|EIO
macro_line|#endif
id|hwc_data.current_servc
op_assign
l_int|0
suffix:semicolon
id|hwc_data.current_hwcb
op_assign
l_int|NULL
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|set_hwc_ioctls
id|set_hwc_ioctls
(paren
id|hwc_ioctls_t
op_star
id|ioctls
comma
r_char
id|correct
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|hwc_ioctls_t
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|ioctls-&gt;width_htab
OG
id|MAX_MESSAGE_SIZE
)paren
(brace
r_if
c_cond
(paren
id|correct
)paren
id|tmp.width_htab
op_assign
id|MAX_MESSAGE_SIZE
suffix:semicolon
r_else
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
id|tmp.width_htab
op_assign
id|ioctls-&gt;width_htab
suffix:semicolon
id|tmp.echo
op_assign
id|ioctls-&gt;echo
suffix:semicolon
r_if
c_cond
(paren
id|ioctls-&gt;columns
OG
id|MAX_MESSAGE_SIZE
)paren
(brace
r_if
c_cond
(paren
id|correct
)paren
id|tmp.columns
op_assign
id|MAX_MESSAGE_SIZE
suffix:semicolon
r_else
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
id|tmp.columns
op_assign
id|ioctls-&gt;columns
suffix:semicolon
r_switch
c_cond
(paren
id|ioctls-&gt;code
)paren
(brace
r_case
id|CODE_EBCDIC
suffix:colon
r_case
id|CODE_ASCII
suffix:colon
id|tmp.code
op_assign
id|ioctls-&gt;code
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|correct
)paren
id|tmp.code
op_assign
id|CODE_ASCII
suffix:semicolon
r_else
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|tmp.final_nl
op_assign
id|ioctls-&gt;final_nl
suffix:semicolon
r_if
c_cond
(paren
id|ioctls-&gt;max_hwcb
OL
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|correct
)paren
id|tmp.max_hwcb
op_assign
l_int|2
suffix:semicolon
r_else
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
id|tmp.max_hwcb
op_assign
id|ioctls-&gt;max_hwcb
suffix:semicolon
id|tmp.tolower
op_assign
id|ioctls-&gt;tolower
suffix:semicolon
r_if
c_cond
(paren
id|ioctls-&gt;kmem_hwcb
OG
id|ioctls-&gt;max_hwcb
)paren
(brace
r_if
c_cond
(paren
id|correct
)paren
id|tmp.kmem_hwcb
op_assign
id|ioctls-&gt;max_hwcb
suffix:semicolon
r_else
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
id|tmp.kmem_hwcb
op_assign
id|ioctls-&gt;kmem_hwcb
suffix:semicolon
r_if
c_cond
(paren
id|ioctls-&gt;kmem_hwcb
OG
id|MAX_KMEM_PAGES
)paren
(brace
r_if
c_cond
(paren
id|correct
)paren
id|ioctls-&gt;kmem_hwcb
op_assign
id|MAX_KMEM_PAGES
suffix:semicolon
r_else
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ioctls-&gt;kmem_hwcb
OL
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|correct
)paren
id|ioctls-&gt;kmem_hwcb
op_assign
l_int|2
suffix:semicolon
r_else
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|tmp.delim
op_assign
id|ioctls-&gt;delim
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|retval
OL
l_int|0
)paren
)paren
id|hwc_data.ioctls
op_assign
id|tmp
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_int
DECL|function|hwc_init
id|hwc_init
(paren
r_void
)paren
(brace
r_int
id|retval
suffix:semicolon
macro_line|#ifdef BUFFER_STRESS_TEST
id|init_hwcb_t
op_star
id|hwcb
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_3215
r_if
c_cond
(paren
id|MACHINE_IS_VM
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif
id|spin_lock_init
(paren
op_amp
id|hwc_data.lock
)paren
suffix:semicolon
id|retval
op_assign
id|write_event_mask_1
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_return
id|retval
suffix:semicolon
macro_line|#ifdef USE_VM_DETECTION
r_if
c_cond
(paren
id|MACHINE_IS_VM
)paren
(brace
r_if
c_cond
(paren
id|hwc_data.init_ioctls.columns
OG
l_int|76
)paren
id|hwc_data.init_ioctls.columns
op_assign
l_int|76
suffix:semicolon
id|hwc_data.init_ioctls.tolower
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwc_data.init_ioctls.delim
)paren
id|hwc_data.init_ioctls.delim
op_assign
id|DEFAULT_CASE_DELIMITER
suffix:semicolon
)brace
r_else
(brace
id|hwc_data.init_ioctls.tolower
op_assign
l_int|0
suffix:semicolon
id|hwc_data.init_ioctls.delim
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
id|retval
op_assign
id|set_hwc_ioctls
(paren
op_amp
id|hwc_data.init_ioctls
comma
l_int|1
)paren
suffix:semicolon
id|hwc_data.kmem_start
op_assign
(paren
r_int
r_int
)paren
id|alloc_bootmem_pages
(paren
id|hwc_data.ioctls.kmem_hwcb
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
id|hwc_data.kmem_end
op_assign
id|hwc_data.kmem_start
op_plus
id|hwc_data.ioctls.kmem_hwcb
op_star
id|PAGE_SIZE
op_minus
l_int|1
suffix:semicolon
id|ctl_set_bit
(paren
l_int|0
comma
l_int|9
)paren
suffix:semicolon
macro_line|#ifdef BUFFER_STRESS_TEST
id|internal_print
(paren
id|DELAYED_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;use %i bytes for buffering.&bslash;n&quot;
comma
id|hwc_data.ioctls.kmem_hwcb
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|500
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hwcb
op_assign
(paren
id|init_hwcb_t
op_star
)paren
id|BUF_HWCB
suffix:semicolon
id|internal_print
(paren
id|DELAYED_WRITE
comma
id|HWC_RW_PRINT_HEADER
l_string|&quot;This is stress test message #%i, free: %i bytes&bslash;n&quot;
comma
id|i
comma
id|MAX_HWCB_ROOM
op_minus
(paren
id|hwcb-&gt;length
op_plus
r_sizeof
(paren
id|mto_t
)paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
id|retval
suffix:semicolon
)brace
r_void
DECL|function|do_hwc_interrupt
id|do_hwc_interrupt
(paren
r_void
)paren
(brace
id|spin_lock
(paren
op_amp
id|hwc_data.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hwc_data.current_servc
)paren
(brace
id|unconditional_read_1
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|hwc_data.current_servc
)paren
(brace
r_case
id|HWC_CMDW_WRITEMASK
suffix:colon
id|write_event_mask_2
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HWC_CMDW_WRITEDATA
suffix:colon
id|write_event_data_2
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HWC_CMDW_READDATA
suffix:colon
id|unconditional_read_2
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|write_event_data_1
(paren
)paren
suffix:semicolon
)brace
id|wake_up_hwc_tty
(paren
)paren
suffix:semicolon
id|spin_unlock
(paren
op_amp
id|hwc_data.lock
)paren
suffix:semicolon
)brace
r_int
DECL|function|hwc_ioctl
id|hwc_ioctl
(paren
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|hwc_ioctls_t
id|tmp
op_assign
id|hwc_data.ioctls
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|obuf
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|TIOCHWCSHTAB
suffix:colon
r_if
c_cond
(paren
id|get_user
(paren
id|tmp.width_htab
comma
(paren
id|ioctl_htab_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCSECHO
suffix:colon
r_if
c_cond
(paren
id|get_user
(paren
id|tmp.echo
comma
(paren
id|ioctl_echo_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCSCOLS
suffix:colon
r_if
c_cond
(paren
id|get_user
(paren
id|tmp.columns
comma
(paren
id|ioctl_cols_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCSCODE
suffix:colon
r_if
c_cond
(paren
id|get_user
(paren
id|tmp.code
comma
(paren
id|ioctl_code_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCSNL
suffix:colon
r_if
c_cond
(paren
id|get_user
(paren
id|tmp.final_nl
comma
(paren
id|ioctl_nl_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCSOBUF
suffix:colon
r_if
c_cond
(paren
id|get_user
(paren
id|obuf
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_if
c_cond
(paren
id|obuf
op_amp
l_int|0xFFF
)paren
id|tmp.max_hwcb
op_assign
(paren
(paren
(paren
id|obuf
op_or
l_int|0xFFF
)paren
op_plus
l_int|1
)paren
op_rshift
l_int|12
)paren
suffix:semicolon
r_else
id|tmp.max_hwcb
op_assign
(paren
id|obuf
op_rshift
l_int|12
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCSCASE
suffix:colon
r_if
c_cond
(paren
id|get_user
(paren
id|tmp.tolower
comma
(paren
id|ioctl_case_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCSDELIM
suffix:colon
r_if
c_cond
(paren
id|get_user
(paren
id|tmp.delim
comma
(paren
id|ioctl_delim_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCSINIT
suffix:colon
id|retval
op_assign
id|set_hwc_ioctls
(paren
op_amp
id|hwc_data.init_ioctls
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCGHTAB
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
id|tmp.width_htab
comma
(paren
id|ioctl_htab_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCGECHO
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
id|tmp.echo
comma
(paren
id|ioctl_echo_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCGCOLS
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
id|tmp.columns
comma
(paren
id|ioctl_cols_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCGCODE
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
id|tmp.code
comma
(paren
id|ioctl_code_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCGNL
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
id|tmp.final_nl
comma
(paren
id|ioctl_nl_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCGOBUF
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
id|tmp.max_hwcb
comma
(paren
id|ioctl_obuf_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCGKBUF
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
id|tmp.kmem_hwcb
comma
(paren
id|ioctl_obuf_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCGCASE
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
id|tmp.tolower
comma
(paren
id|ioctl_case_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCGDELIM
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
id|tmp.delim
comma
(paren
id|ioctl_delim_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|TIOCHWCGINIT
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
op_amp
id|hwc_data.init_ioctls
comma
(paren
id|hwc_ioctls_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TIOCHWCGCURR
suffix:colon
r_if
c_cond
(paren
id|put_user
(paren
op_amp
id|hwc_data.ioctls
comma
(paren
id|hwc_ioctls_t
op_star
)paren
id|arg
)paren
)paren
r_goto
id|fault
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_goto
id|noioctlcmd
suffix:semicolon
)brace
r_if
c_cond
(paren
id|_IOC_DIR
(paren
id|cmd
)paren
op_eq
id|_IOC_WRITE
)paren
id|retval
op_assign
id|set_hwc_ioctls
(paren
op_amp
id|tmp
comma
l_int|0
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|fault
suffix:colon
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|noioctlcmd
suffix:colon
id|retval
op_assign
op_minus
id|ENOIOCTLCMD
suffix:semicolon
id|out
suffix:colon
id|spin_unlock_irqrestore
(paren
op_amp
id|hwc_data.lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
eof
