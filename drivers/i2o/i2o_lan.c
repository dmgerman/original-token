multiline_comment|/*&n; * &t;linux/drivers/i2o/i2o_lan.c&n; *&n; *    &t;I2O LAN CLASS OSM &t;Prototyping, June 4th 1999&n; *&n; *&t;(C) Copyright 1999 &t;University of Helsinki,&n; *&t;&t;&t;&t;Department of Computer Science&n; *&n; *   &t;This code is still under development / test.&n; *&n; *      This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.    &n; *&n; * &t;Authors: &t;Auvo H&#xfffd;kkinen &lt;Auvo.Hakkinen@cs.Helsinki.FI&gt;&n; *&t;&t;&t;Juha Siev&#xfffd;nen &lt;Juha.Sievanen@cs.Helsinki.FI&gt;&n; *&n; *&t;Tested:&t;&t;in FDDI environment (using SysKonnect&squot;s DDM)&n; *&t;&t;&t;in Ethernet environment (using Intel 82558 DDM proto)&n; *&n; *&t;TODO:&t;&t;batch mode networking&n; *&t;&t;&t;- this one assumes that we always get one packet &n; *&t;&t;&t;  in a bucket&n; *&t;&t;&t;- we&squot;ve not been able to test batch replies and &n; *&t;&t;&t;  batch receives&n; *&t;&t;&t;- error checking / timeouts&n; *&t;&t;&t;- code / test for other LAN classes&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/fddidevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/trdevice.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/i2o.h&gt;
macro_line|#include &quot;i2o_lan.h&quot;
singleline_comment|//#define DRIVERDEBUG
macro_line|#ifdef DRIVERDEBUG
DECL|macro|dprintk
mdefine_line|#define dprintk(s, args...) printk(s, ## args) 
macro_line|#else
DECL|macro|dprintk
mdefine_line|#define dprintk(s, args...)
macro_line|#endif
DECL|macro|MAX_LAN_CARDS
mdefine_line|#define MAX_LAN_CARDS 4
DECL|variable|i2o_landevs
r_static
r_struct
id|device
op_star
id|i2o_landevs
(braket
id|MAX_LAN_CARDS
op_plus
l_int|1
)braket
suffix:semicolon
DECL|variable|unit
r_static
r_int
id|unit
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* device unit number */
DECL|struct|i2o_lan_local
r_struct
id|i2o_lan_local
(brace
DECL|member|unit
id|u8
id|unit
suffix:semicolon
DECL|member|i2o_dev
r_struct
id|i2o_device
op_star
id|i2o_dev
suffix:semicolon
DECL|member|reply_flag
r_int
id|reply_flag
suffix:semicolon
multiline_comment|/* needed by scalar/table queries */
DECL|member|packet_tresh
id|u32
id|packet_tresh
suffix:semicolon
multiline_comment|/* treshold for incoming skb&squot;s */
DECL|member|stats
r_struct
id|fddi_statistics
id|stats
suffix:semicolon
multiline_comment|/* see also struct net_device_stats */
DECL|member|type_trans
r_int
r_int
(paren
op_star
id|type_trans
)paren
(paren
r_struct
id|sk_buff
op_star
comma
r_struct
id|device
op_star
)paren
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* function prototypes */
r_static
r_int
id|i2o_lan_receive_post
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|i2o_lan_receive_post_reply
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|i2o_message
op_star
id|m
)paren
suffix:semicolon
multiline_comment|/*&n; * Module params&n; */
DECL|variable|bucketpost
r_static
id|u32
id|bucketpost
op_assign
l_int|64
suffix:semicolon
DECL|variable|bucketthresh
r_static
id|u32
id|bucketthresh
op_assign
l_int|8
suffix:semicolon
DECL|function|i2o_lan_reply
r_static
r_void
id|i2o_lan_reply
c_func
(paren
r_struct
id|i2o_handler
op_star
id|h
comma
r_struct
id|i2o_controller
op_star
id|iop
comma
r_struct
id|i2o_message
op_star
id|m
)paren
(brace
id|u32
op_star
id|msg
op_assign
(paren
id|u32
op_star
)paren
id|m
suffix:semicolon
id|u8
id|unit
op_assign
(paren
id|u8
)paren
(paren
id|msg
(braket
l_int|2
)braket
op_rshift
l_int|16
)paren
suffix:semicolon
singleline_comment|// InitiatorContext
r_struct
id|device
op_star
id|dev
op_assign
id|i2o_landevs
(braket
id|unit
)braket
suffix:semicolon
r_if
c_cond
(paren
id|msg
(braket
l_int|0
)braket
op_amp
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
singleline_comment|// Fail bit is set
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IOP failed to process the msg:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;  Cmd = 0x%02X, InitiatorTid = %d, TargetTid = %d&bslash;n&quot;
comma
(paren
id|msg
(braket
l_int|1
)braket
op_rshift
l_int|24
)paren
op_amp
l_int|0xFF
comma
(paren
id|msg
(braket
l_int|1
)braket
op_rshift
l_int|12
)paren
op_amp
l_int|0xFFF
comma
id|msg
(braket
l_int|1
)braket
op_amp
l_int|0xFFF
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;  FailureCode = 0x%02X&bslash;n  Severity = 0x%02X&bslash;n  &quot;
l_string|&quot;LowestVersion = 0x%02X&bslash;n  HighestVersion = 0x%02X&bslash;n&quot;
comma
id|msg
(braket
l_int|4
)braket
op_rshift
l_int|24
comma
(paren
id|msg
(braket
l_int|4
)braket
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
comma
(paren
id|msg
(braket
l_int|4
)braket
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
comma
id|msg
(braket
l_int|4
)braket
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;  FailingHostUnit = 0x%04X&bslash;n  FailingIOP = 0x%03X&bslash;n&quot;
comma
id|msg
(braket
l_int|5
)braket
op_rshift
l_int|16
comma
id|msg
(braket
l_int|5
)braket
op_amp
l_int|0xFFF
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef DRIVERDEBUG
singleline_comment|//&t;if (msg[4] &gt;&gt; 24) &t;/* ReqStatus != SUCCESS */
id|i2o_report_status
c_func
(paren
id|KERN_INFO
comma
l_string|&quot;i2o_lan&quot;
comma
id|msg
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|msg
(braket
l_int|1
)braket
op_rshift
l_int|24
)paren
(brace
r_case
id|LAN_RECEIVE_POST
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;start
)paren
id|i2o_lan_receive_post_reply
c_func
(paren
id|dev
comma
id|m
)paren
suffix:semicolon
r_else
(brace
singleline_comment|// we are getting unused buckets back
id|u8
id|trl_count
op_assign
id|msg
(braket
l_int|3
)braket
op_amp
l_int|0x000000FF
suffix:semicolon
r_struct
id|i2o_bucket_descriptor
op_star
id|bucket
op_assign
(paren
r_struct
id|i2o_bucket_descriptor
op_star
)paren
op_amp
id|msg
(braket
l_int|6
)braket
suffix:semicolon
r_do
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: Releasing unused bucket&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
(paren
r_struct
id|sk_buff
op_star
)paren
id|bucket-&gt;context
)paren
suffix:semicolon
id|bucket
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|trl_count
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|LAN_PACKET_SEND
suffix:colon
r_case
id|LAN_SDU_SEND
suffix:colon
(brace
id|u8
id|trl_count
op_assign
id|msg
(braket
l_int|3
)braket
op_amp
l_int|0x000000FF
suffix:semicolon
r_if
c_cond
(paren
id|msg
(braket
l_int|4
)braket
op_rshift
l_int|24
)paren
singleline_comment|// ReqStatus != SUCCESS
id|i2o_report_status
c_func
(paren
id|KERN_WARNING
comma
id|dev-&gt;name
comma
id|msg
)paren
suffix:semicolon
r_do
(brace
singleline_comment|// The HDM has handled the outgoing packet
id|dev_kfree_skb
c_func
(paren
(paren
r_struct
id|sk_buff
op_star
)paren
id|msg
(braket
l_int|4
op_plus
id|trl_count
)braket
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Request skb freed (trl_count=%d).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|trl_count
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|trl_count
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
multiline_comment|/* inform upper layers */
)brace
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|msg
(braket
l_int|2
)braket
op_amp
l_int|0x80000000
)paren
singleline_comment|// reply to a UtilParamsGet/Set
(brace
r_int
op_star
id|flag
op_assign
(paren
r_int
op_star
)paren
id|msg
(braket
l_int|3
)braket
suffix:semicolon
singleline_comment|// flag for i2o_post_wait
r_if
c_cond
(paren
id|msg
(braket
l_int|4
)braket
op_rshift
l_int|24
)paren
singleline_comment|// ReqStatus != SUCCESS
(brace
id|i2o_report_status
c_func
(paren
id|KERN_WARNING
comma
id|dev-&gt;name
comma
id|msg
)paren
suffix:semicolon
op_star
id|flag
op_assign
op_minus
(paren
id|msg
(braket
l_int|4
)braket
op_amp
l_int|0xFFFF
)paren
suffix:semicolon
singleline_comment|// DetailedStatus
)brace
r_else
op_star
id|flag
op_assign
id|I2O_POST_WAIT_OK
suffix:semicolon
)brace
)brace
)brace
DECL|variable|i2o_lan_handler
r_static
r_struct
id|i2o_handler
id|i2o_lan_handler
op_assign
(brace
id|i2o_lan_reply
comma
l_string|&quot;I2O Lan OSM&quot;
comma
l_int|0
singleline_comment|// context
)brace
suffix:semicolon
DECL|variable|lan_context
r_static
r_int
id|lan_context
suffix:semicolon
DECL|function|i2o_lan_receive_post_reply
r_static
r_int
id|i2o_lan_receive_post_reply
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|i2o_message
op_star
id|m
)paren
(brace
id|u32
op_star
id|msg
op_assign
(paren
id|u32
op_star
)paren
id|m
suffix:semicolon
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_bucket_descriptor
op_star
id|bucket
op_assign
(paren
r_struct
id|i2o_bucket_descriptor
op_star
)paren
op_amp
id|msg
(braket
l_int|6
)braket
suffix:semicolon
r_struct
id|i2o_packet_info
op_star
id|packet
suffix:semicolon
id|u8
id|trl_count
op_assign
id|msg
(braket
l_int|3
)braket
op_amp
l_int|0x000000FF
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|newskb
suffix:semicolon
macro_line|#if 0
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;TrlFlags = 0x%02X, TrlElementSize = %d, TrlCount = %d&bslash;n&quot;
l_string|&quot;msgsize = %d, buckets_remaining = %d&bslash;n&quot;
comma
id|msg
(braket
l_int|3
)braket
op_rshift
l_int|24
comma
id|msg
(braket
l_int|3
)braket
op_amp
l_int|0x0000FF00
comma
id|trl_count
comma
id|msg
(braket
l_int|0
)braket
op_rshift
l_int|16
comma
id|msg
(braket
l_int|5
)braket
)paren
suffix:semicolon
macro_line|#endif
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;Buckets_remaining = %d&bslash;n&quot;
comma
id|msg
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_do
(brace
id|skb
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
(paren
id|bucket-&gt;context
)paren
suffix:semicolon
id|packet
op_assign
(paren
r_struct
id|i2o_packet_info
op_star
)paren
id|bucket-&gt;packet_info
suffix:semicolon
macro_line|#if 0
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;flags = 0x%02X, offset = 0x%06X, status = 0x%02X, length = %d&bslash;n&quot;
comma
id|packet-&gt;flags
comma
id|packet-&gt;offset
comma
id|packet-&gt;status
comma
id|packet-&gt;len
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|packet-&gt;len
OL
id|priv-&gt;packet_tresh
)paren
(brace
id|newskb
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
id|dev_alloc_skb
c_func
(paren
id|packet-&gt;len
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newskb
)paren
(brace
id|skb_reserve
c_func
(paren
id|newskb
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|newskb
comma
id|packet-&gt;len
)paren
comma
id|skb-&gt;data
comma
id|packet-&gt;len
)paren
suffix:semicolon
id|newskb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|newskb-&gt;protocol
op_assign
id|priv
op_member_access_from_pointer
id|type_trans
c_func
(paren
id|newskb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|newskb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
singleline_comment|// FIXME: reuse this skb? 
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Can&squot;t allocate skb.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
r_else
(brace
id|skb_put
c_func
(paren
id|skb
comma
id|packet-&gt;len
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|priv
op_member_access_from_pointer
id|type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Incoming packet (%d bytes) delivered &quot;
l_string|&quot;to upper level.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|packet-&gt;len
)paren
suffix:semicolon
id|bucket
op_increment
suffix:semicolon
singleline_comment|// to next Packet Descriptor Block
)brace
r_while
c_loop
(paren
op_decrement
id|trl_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg
(braket
l_int|5
)braket
op_le
id|bucketthresh
)paren
singleline_comment|// BucketsRemaining
id|i2o_lan_receive_post
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*  ====================================================&n; *  Interface to i2o:  functions to send lan class request &n; */
multiline_comment|/* &n; * i2o_lan_receive_post(): Post buckets to receive packets.&n; */
DECL|function|i2o_lan_receive_post
r_static
r_int
id|i2o_lan_receive_post
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_dev-&gt;controller
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u32
id|m
suffix:semicolon
id|u32
op_star
id|msg
suffix:semicolon
id|u32
id|bucket_len
op_assign
(paren
id|dev-&gt;mtu
op_plus
id|dev-&gt;hard_header_len
)paren
suffix:semicolon
id|u32
id|bucket_count
suffix:semicolon
r_int
id|n_elems
op_assign
(paren
id|iop-&gt;inbound_size
op_minus
l_int|16
)paren
op_div
l_int|12
suffix:semicolon
multiline_comment|/* msg header + SGLs */
id|u32
id|total
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_while
c_loop
(paren
id|total
OL
id|bucketpost
)paren
(brace
id|m
op_assign
id|I2O_POST_READ32
c_func
(paren
id|iop
)paren
suffix:semicolon
r_if
c_cond
(paren
id|m
op_eq
l_int|0xFFFFFFFF
)paren
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
id|msg
op_assign
id|bus_to_virt
c_func
(paren
id|iop-&gt;mem_offset
op_plus
id|m
)paren
suffix:semicolon
id|bucket_count
op_assign
(paren
id|total
op_plus
id|n_elems
OL
id|bucketpost
)paren
ques
c_cond
id|n_elems
suffix:colon
id|bucketpost
op_minus
id|total
suffix:semicolon
id|msg
(braket
l_int|0
)braket
op_assign
id|I2O_MESSAGE_SIZE
c_func
(paren
l_int|4
op_plus
l_int|3
op_star
id|bucket_count
)paren
op_or
id|SGL_OFFSET_4
suffix:semicolon
id|msg
(braket
l_int|1
)braket
op_assign
id|LAN_RECEIVE_POST
op_lshift
l_int|24
op_or
id|HOST_TID
op_lshift
l_int|12
op_or
id|i2o_dev-&gt;id
suffix:semicolon
id|msg
(braket
l_int|2
)braket
op_assign
id|priv-&gt;unit
op_lshift
l_int|16
op_or
id|lan_context
suffix:semicolon
singleline_comment|// InitiatorContext&t;
id|msg
(braket
l_int|3
)braket
op_assign
id|bucket_count
suffix:semicolon
singleline_comment|// BucketCount
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bucket_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|bucket_len
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|msg
(braket
l_int|4
op_plus
l_int|3
op_star
id|i
)braket
op_assign
l_int|0x51000000
op_or
id|bucket_len
suffix:semicolon
id|msg
(braket
l_int|5
op_plus
l_int|3
op_star
id|i
)braket
op_assign
(paren
id|u32
)paren
id|skb
suffix:semicolon
id|msg
(braket
l_int|6
op_plus
l_int|3
op_star
id|i
)braket
op_assign
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
)brace
id|msg
(braket
l_int|4
op_plus
l_int|3
op_star
id|i
op_minus
l_int|3
)braket
op_or_assign
l_int|0x80000000
suffix:semicolon
singleline_comment|// set LE flag
id|i2o_post_message
c_func
(paren
id|iop
comma
id|m
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Sending %d buckets (size %d) to LAN HDM.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|bucket_count
comma
id|bucket_len
)paren
suffix:semicolon
id|total
op_add_assign
id|bucket_count
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; * i2o_lan_reset(): Reset the LAN adapter into the operational state and &n; * &t;restore it to full operation.&n; */
DECL|function|i2o_lan_reset
r_static
r_int
id|i2o_lan_reset
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_dev-&gt;controller
suffix:semicolon
id|u32
id|msg
(braket
l_int|5
)braket
suffix:semicolon
id|msg
(braket
l_int|0
)braket
op_assign
id|FIVE_WORD_MSG_SIZE
op_or
id|SGL_OFFSET_0
suffix:semicolon
id|msg
(braket
l_int|1
)braket
op_assign
id|LAN_RESET
op_lshift
l_int|24
op_or
id|HOST_TID
op_lshift
l_int|12
op_or
id|i2o_dev-&gt;id
suffix:semicolon
id|msg
(braket
l_int|2
)braket
op_assign
id|priv-&gt;unit
op_lshift
l_int|16
op_or
id|lan_context
suffix:semicolon
singleline_comment|// InitiatorContext
id|msg
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
singleline_comment|// TransactionContext
id|msg
(braket
l_int|4
)braket
op_assign
l_int|1
op_lshift
l_int|16
suffix:semicolon
singleline_comment|// return posted buckets
r_if
c_cond
(paren
id|i2o_post_this
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|msg
comma
r_sizeof
(paren
id|msg
)paren
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; * i2o_lan_suspend(): Put LAN adapter into a safe, non-active state.&n; * &t;Reply to any LAN class message with status error_no_data_transfer &n; *&t;/ suspended.&n; */
DECL|function|i2o_lan_suspend
r_static
r_int
id|i2o_lan_suspend
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_dev-&gt;controller
suffix:semicolon
id|u32
id|msg
(braket
l_int|5
)braket
suffix:semicolon
id|msg
(braket
l_int|0
)braket
op_assign
id|FIVE_WORD_MSG_SIZE
op_or
id|SGL_OFFSET_0
suffix:semicolon
id|msg
(braket
l_int|1
)braket
op_assign
id|LAN_SUSPEND
op_lshift
l_int|24
op_or
id|HOST_TID
op_lshift
l_int|12
op_or
id|i2o_dev-&gt;id
suffix:semicolon
id|msg
(braket
l_int|2
)braket
op_assign
id|priv-&gt;unit
op_lshift
l_int|16
op_or
id|lan_context
suffix:semicolon
singleline_comment|// InitiatorContext
id|msg
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
singleline_comment|// TransactionContext
id|msg
(braket
l_int|4
)braket
op_assign
l_int|1
op_lshift
l_int|16
suffix:semicolon
singleline_comment|// return posted buckets
r_if
c_cond
(paren
id|i2o_post_this
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|msg
comma
r_sizeof
(paren
id|msg
)paren
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Set DDM into batch mode.&n; */
DECL|function|i2o_set_batch_mode
r_static
r_void
id|i2o_set_batch_mode
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
multiline_comment|/* &n; * NOTE: we have not been able to test batch mode&n; * &t; since HDMs we have, don&squot;t implement it &n; */
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_dev-&gt;controller
suffix:semicolon
id|u32
id|val
suffix:semicolon
multiline_comment|/* set LAN_BATCH_CONTROL attributes */
singleline_comment|// enable batch mode, toggle automatically
id|val
op_assign
l_int|0x00000000
suffix:semicolon
singleline_comment|//&t;val = 0x00000001; // turn off batch mode
r_if
c_cond
(paren
id|i2o_set_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0003
comma
l_int|0
comma
op_amp
id|val
comma
l_int|4
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Unable to enter I2O LAN batch mode.&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: I2O LAN batch mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
singleline_comment|//&t;&t;dprintk(KERN_INFO &quot;%s: I2O LAN batch mode disabled.&bslash;n&quot;,dev-&gt;name);
multiline_comment|/*&n;&t; * When PacketOrphanlimit is same as the maximum packet length,&n;&t; * the packets will never be split into two separate buckets&n;&t; */
multiline_comment|/* set LAN_OPERATION attributes */
id|val
op_assign
id|dev-&gt;mtu
op_plus
id|dev-&gt;hard_header_len
suffix:semicolon
singleline_comment|// PacketOrphanLimit
r_if
c_cond
(paren
id|i2o_set_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0004
comma
l_int|2
comma
op_amp
id|val
comma
l_int|4
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;i2o_lan: Unable to set PacketOrphanLimit.&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: PacketOrphanLimit set to %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|val
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* &n; * i2o_lan_open(): Open the device to send/receive packets via &n; * the network device.&t;&n; */
DECL|function|i2o_lan_open
r_static
r_int
id|i2o_lan_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_dev-&gt;controller
suffix:semicolon
r_if
c_cond
(paren
id|i2o_issue_claim
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|1
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unable to claim the I2O LAN device.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: I2O LAN device claimed (tid=%d).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i2o_dev-&gt;id
)paren
suffix:semicolon
id|i2o_lan_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;packet_tresh
op_assign
id|dev-&gt;mtu
op_minus
(paren
id|dev-&gt;mtu
op_rshift
l_int|3
)paren
suffix:semicolon
id|i2o_set_batch_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|i2o_lan_receive_post
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * i2o_lan_close(): End the transfering.&n; */
DECL|function|i2o_lan_close
r_static
r_int
id|i2o_lan_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_dev-&gt;controller
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|0
suffix:semicolon
singleline_comment|// This is the right place for LanSuspend, but it seems to cause 
singleline_comment|// a kernel crash when we are using 82558 HDM proto
id|i2o_lan_suspend
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2o_issue_claim
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unable to unclaim I2O LAN device &quot;
l_string|&quot;(tid=%d)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i2o_dev-&gt;id
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; * i2o_lan_sdu_send(): Send a packet, MAC header added by the HDM.&n; * Must be supported by Fibre Channel, optional for Ethernet/802.3, &n; * Token Ring, FDDI&n; */
DECL|function|i2o_lan_sdu_send
r_static
r_int
id|i2o_lan_sdu_send
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
macro_line|#if 0
multiline_comment|/* not yet tested */
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_dev-&gt;controller
suffix:semicolon
id|u32
id|m
suffix:semicolon
id|u32
op_star
id|msg
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;LanSDUSend called, skb-&gt;len = %d&bslash;n&quot;
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|m
op_assign
id|I2O_POST_READ32
c_func
(paren
id|iop
)paren
suffix:semicolon
r_if
c_cond
(paren
id|m
op_eq
l_int|0xFFFFFFFF
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
)brace
id|msg
op_assign
id|bus_to_virt
c_func
(paren
id|iop-&gt;mem_offset
op_plus
id|m
)paren
suffix:semicolon
id|msg
(braket
l_int|0
)braket
op_assign
id|NINE_WORD_MSG_SIZE
op_or
id|SGL_OFFSET_4
suffix:semicolon
id|msg
(braket
l_int|1
)braket
op_assign
id|LAN_SDU_SEND
op_lshift
l_int|24
op_or
id|HOST_TID
op_lshift
l_int|12
op_or
id|i2o_dev-&gt;id
suffix:semicolon
id|msg
(braket
l_int|2
)braket
op_assign
id|priv-&gt;unit
op_lshift
l_int|16
op_or
id|lan_context
suffix:semicolon
singleline_comment|// IntiatorContext
id|msg
(braket
l_int|3
)braket
op_assign
l_int|1
op_lshift
l_int|4
suffix:semicolon
singleline_comment|// TransmitControlWord: suppress CRC generation
singleline_comment|// create a simple SGL, see fig. 3-26
singleline_comment|// D7 = 1101 0111 = LE eob 0 1 LA dir bc1 bc0
id|msg
(braket
l_int|4
)braket
op_assign
l_int|0xD7000000
op_or
(paren
id|skb-&gt;len
)paren
suffix:semicolon
singleline_comment|// no MAC hdr included     
id|msg
(braket
l_int|5
)braket
op_assign
(paren
id|u32
)paren
id|skb
suffix:semicolon
singleline_comment|// TransactionContext
id|memcpy
c_func
(paren
op_amp
id|msg
(braket
l_int|6
)braket
comma
id|skb-&gt;data
comma
l_int|8
)paren
suffix:semicolon
singleline_comment|// Destination MAC Addr ??
id|msg
(braket
l_int|7
)braket
op_and_assign
l_int|0x0000FFFF
suffix:semicolon
singleline_comment|// followed by two bytes zeros
id|msg
(braket
l_int|8
)braket
op_assign
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|i2o_post_message
c_func
(paren
id|iop
comma
id|m
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Packet (%d bytes) sent to network.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; * i2o_lan_packet_send(): Send a packet as is, including the MAC header.&n; * &n; * Must be supported by Ethernet/802.3, Token Ring, FDDI, optional for &n; * Fibre Channel&n; */
DECL|function|i2o_lan_packet_send
r_static
r_int
id|i2o_lan_packet_send
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_dev-&gt;controller
suffix:semicolon
id|u32
id|m
suffix:semicolon
id|u32
op_star
id|msg
suffix:semicolon
id|m
op_assign
id|I2O_POST_READ32
c_func
(paren
id|iop
)paren
suffix:semicolon
r_if
c_cond
(paren
id|m
op_eq
l_int|0xFFFFFFFF
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
)brace
id|msg
op_assign
id|bus_to_virt
c_func
(paren
id|iop-&gt;mem_offset
op_plus
id|m
)paren
suffix:semicolon
id|msg
(braket
l_int|0
)braket
op_assign
id|SEVEN_WORD_MSG_SIZE
op_or
l_int|1
op_lshift
l_int|12
op_or
id|SGL_OFFSET_4
suffix:semicolon
id|msg
(braket
l_int|1
)braket
op_assign
id|LAN_PACKET_SEND
op_lshift
l_int|24
op_or
id|HOST_TID
op_lshift
l_int|12
op_or
id|i2o_dev-&gt;id
suffix:semicolon
id|msg
(braket
l_int|2
)braket
op_assign
id|priv-&gt;unit
op_lshift
l_int|16
op_or
id|lan_context
suffix:semicolon
singleline_comment|// IntiatorContext
id|msg
(braket
l_int|3
)braket
op_assign
l_int|1
op_lshift
l_int|4
suffix:semicolon
singleline_comment|// TransmitControlWord
singleline_comment|// create a simple SGL, see fig. 3-26
singleline_comment|// D5 = 1101 0101 = LE eob 0 1 LA dir bc1 bc0
id|msg
(braket
l_int|4
)braket
op_assign
l_int|0xD5000000
op_or
id|skb-&gt;len
suffix:semicolon
singleline_comment|// MAC hdr included
id|msg
(braket
l_int|5
)braket
op_assign
(paren
id|u32
)paren
id|skb
suffix:semicolon
singleline_comment|// TransactionContext
id|msg
(braket
l_int|6
)braket
op_assign
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|i2o_post_message
c_func
(paren
id|iop
comma
id|m
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Packet (%d bytes) sent to network.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2o_lan_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|i2o_lan_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_dev-&gt;controller
suffix:semicolon
id|u64
id|val64
(braket
l_int|16
)braket
suffix:semicolon
id|u64
id|supported_group
(braket
l_int|4
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_if
c_cond
(paren
id|i2o_query_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0100
comma
op_minus
l_int|1
comma
id|val64
comma
r_sizeof
(paren
id|val64
)paren
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: Unable to query LAN_HISTORICAL_STATS.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: LAN_HISTORICAL_STATS queried.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;stats.tx_packets
op_assign
id|val64
(braket
l_int|0
)braket
suffix:semicolon
id|priv-&gt;stats.tx_bytes
op_assign
id|val64
(braket
l_int|1
)braket
suffix:semicolon
id|priv-&gt;stats.rx_packets
op_assign
id|val64
(braket
l_int|2
)braket
suffix:semicolon
id|priv-&gt;stats.rx_bytes
op_assign
id|val64
(braket
l_int|3
)braket
suffix:semicolon
id|priv-&gt;stats.tx_errors
op_assign
id|val64
(braket
l_int|4
)braket
suffix:semicolon
id|priv-&gt;stats.rx_errors
op_assign
id|val64
(braket
l_int|5
)braket
suffix:semicolon
id|priv-&gt;stats.rx_dropped
op_assign
id|val64
(braket
l_int|6
)braket
suffix:semicolon
)brace
id|i2o_query_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0180
comma
op_minus
l_int|1
comma
op_amp
id|supported_group
comma
r_sizeof
(paren
id|supported_group
)paren
comma
op_amp
id|priv-&gt;reply_flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|supported_group
(braket
l_int|2
)braket
)paren
(brace
r_if
c_cond
(paren
id|i2o_query_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0183
comma
op_minus
l_int|1
comma
id|val64
comma
r_sizeof
(paren
id|val64
)paren
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: Unable to query LAN_OPTIONAL_RX_HISTORICAL_STATS.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: LAN_OPTIONAL_RX_HISTORICAL_STATS queried.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;stats.multicast
op_assign
id|val64
(braket
l_int|4
)braket
suffix:semicolon
id|priv-&gt;stats.rx_length_errors
op_assign
id|val64
(braket
l_int|10
)braket
suffix:semicolon
id|priv-&gt;stats.rx_crc_errors
op_assign
id|val64
(braket
l_int|0
)braket
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i2o_dev-&gt;subclass
op_eq
id|I2O_LAN_ETHERNET
)paren
(brace
id|u64
id|supported_stats
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i2o_query_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0200
comma
op_minus
l_int|1
comma
id|val64
comma
r_sizeof
(paren
id|val64
)paren
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: Unable to query LAN_802_3_HISTORICAL_STATS.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: LAN_802_3_HISTORICAL_STATS queried.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;stats.transmit_collision
op_assign
id|val64
(braket
l_int|1
)braket
op_plus
id|val64
(braket
l_int|2
)braket
suffix:semicolon
id|priv-&gt;stats.rx_frame_errors
op_assign
id|val64
(braket
l_int|0
)braket
suffix:semicolon
id|priv-&gt;stats.tx_carrier_errors
op_assign
id|val64
(braket
l_int|6
)braket
suffix:semicolon
)brace
id|i2o_query_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0280
comma
op_minus
l_int|1
comma
op_amp
id|supported_stats
comma
l_int|8
comma
op_amp
id|priv-&gt;reply_flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|supported_stats
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|i2o_query_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0281
comma
op_minus
l_int|1
comma
id|val64
comma
r_sizeof
(paren
id|val64
)paren
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: Unable to query LAN_OPTIONLA_802_3_HISTORICAL_STATS.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: LAN_OPTIONAL_802_3_HISTORICAL_STATS queried.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|supported_stats
op_amp
l_int|0x1
)paren
id|priv-&gt;stats.rx_over_errors
op_assign
id|val64
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|supported_stats
op_amp
l_int|0x4
)paren
id|priv-&gt;stats.tx_heartbeat_errors
op_assign
id|val64
(braket
l_int|2
)braket
suffix:semicolon
)brace
)brace
)brace
macro_line|#ifdef CONFIG_TR
r_if
c_cond
(paren
id|i2o_dev-&gt;subclass
op_eq
id|I2O_LAN_TR
)paren
(brace
r_if
c_cond
(paren
id|i2o_query_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0300
comma
op_minus
l_int|1
comma
id|val64
comma
r_sizeof
(paren
id|val64
)paren
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: Unable to query LAN_802_5_HISTORICAL_STATS.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
(brace
r_struct
id|tr_statistics
op_star
id|stats
op_assign
(paren
r_struct
id|tr_statistics
op_star
)paren
op_amp
id|priv-&gt;stats
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: LAN_802_5_HISTORICAL_STATS queried.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|stats-&gt;line_errors
op_assign
id|val64
(braket
l_int|0
)braket
suffix:semicolon
id|stats-&gt;internal_errors
op_assign
id|val64
(braket
l_int|7
)braket
suffix:semicolon
id|stats-&gt;burst_errors
op_assign
id|val64
(braket
l_int|4
)braket
suffix:semicolon
id|stats-&gt;A_C_errors
op_assign
id|val64
(braket
l_int|2
)braket
suffix:semicolon
id|stats-&gt;abort_delimiters
op_assign
id|val64
(braket
l_int|3
)braket
suffix:semicolon
id|stats-&gt;lost_frames
op_assign
id|val64
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/* stats-&gt;recv_congest_count&t;= ?;  FIXME ??*/
id|stats-&gt;frame_copied_errors
op_assign
id|val64
(braket
l_int|5
)braket
suffix:semicolon
id|stats-&gt;frequency_errors
op_assign
id|val64
(braket
l_int|6
)braket
suffix:semicolon
id|stats-&gt;token_errors
op_assign
id|val64
(braket
l_int|9
)braket
suffix:semicolon
)brace
multiline_comment|/* Token Ring optional stats not yet defined */
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FDDI
r_if
c_cond
(paren
id|i2o_dev-&gt;subclass
op_eq
id|I2O_LAN_FDDI
)paren
(brace
r_if
c_cond
(paren
id|i2o_query_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0400
comma
op_minus
l_int|1
comma
id|val64
comma
r_sizeof
(paren
id|val64
)paren
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: Unable to query LAN_FDDI_HISTORICAL_STATS.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: LAN_FDDI_HISTORICAL_STATS queried.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;stats.smt_cf_state
op_assign
id|val64
(braket
l_int|0
)braket
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;stats.mac_upstream_nbr
comma
op_amp
id|val64
(braket
l_int|1
)braket
comma
id|FDDI_K_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;stats.mac_downstream_nbr
comma
op_amp
id|val64
(braket
l_int|2
)braket
comma
id|FDDI_K_ALEN
)paren
suffix:semicolon
id|priv-&gt;stats.mac_error_cts
op_assign
id|val64
(braket
l_int|3
)braket
suffix:semicolon
id|priv-&gt;stats.mac_lost_cts
op_assign
id|val64
(braket
l_int|4
)braket
suffix:semicolon
id|priv-&gt;stats.mac_rmt_state
op_assign
id|val64
(braket
l_int|5
)braket
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;stats.port_lct_fail_cts
comma
op_amp
id|val64
(braket
l_int|6
)braket
comma
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;stats.port_lem_reject_cts
comma
op_amp
id|val64
(braket
l_int|7
)braket
comma
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;stats.port_lem_cts
comma
op_amp
id|val64
(braket
l_int|8
)braket
comma
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;stats.port_pcm_state
comma
op_amp
id|val64
(braket
l_int|9
)braket
comma
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/* FDDI optional stats not yet defined */
)brace
macro_line|#endif
r_return
(paren
r_struct
id|net_device_stats
op_star
)paren
op_amp
id|priv-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n; * i2o_lan_set_multicast_list(): Enable a network device to receive packets&n; *&t;not send to the protocol address.&n; */
DECL|function|i2o_lan_set_multicast_list
r_static
r_void
id|i2o_lan_set_multicast_list
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_dev-&gt;controller
suffix:semicolon
id|u32
id|filter_mask
suffix:semicolon
id|u32
id|work32
(braket
l_int|64
)braket
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Entered i2o_lan_set_multicast_list().&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* FIXME: Why does the next call kill the interrupt handler?&n; * The same works fine in function lan_open(), and in i2o_proc.c&n; *&n; *  *because its trying to sleep in an irq - this must be async - Alan&n; */
r_if
c_cond
(paren
id|i2o_query_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0001
comma
op_minus
l_int|1
comma
op_amp
id|work32
comma
r_sizeof
(paren
id|work32
)paren
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;i2o_lan: Unable to query &quot;
l_string|&quot; LAN_MAC_ADDRESS table.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;capab mask = 0x%08X, filter mask = 0x%08X&bslash;n&quot;
comma
id|work32
(braket
l_int|7
)braket
comma
id|work32
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|filter_mask
op_assign
id|work32
(braket
l_int|6
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|filter_mask
op_or_assign
l_int|0x00000002
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;i2o_lan: Enabling promiscuous mode...&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_or
id|dev-&gt;mc_count
OG
id|work32
(braket
l_int|5
)braket
)paren
(brace
id|filter_mask
op_or_assign
l_int|0x00000000
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;i2o_lan: Enabling all multicast mode...&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
)paren
(brace
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u8
op_star
id|work8
op_assign
(paren
id|u8
op_star
)paren
id|work32
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;i2o_lan: Enabling multicast mode...&bslash;n&quot;
)paren
suffix:semicolon
id|filter_mask
op_assign
l_int|0x00000004
suffix:semicolon
multiline_comment|/* Fill the multicast addresses */
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|work8
comma
id|mclist-&gt;dmi_addr
comma
id|mclist-&gt;dmi_addrlen
)paren
suffix:semicolon
id|work8
op_add_assign
l_int|8
suffix:semicolon
id|mclist
op_assign
id|mclist-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i2o_clear_table
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0002
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: Unable to clear LAN_MULTICAST_MAC_ADDRESS table.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2o_row_add_table
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0002
comma
op_minus
l_int|1
comma
id|work32
comma
id|dev-&gt;mc_count
op_star
l_int|8
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: Unable to set LAN_MULTICAST_MAC_ADDRESS table.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|filter_mask
op_or_assign
l_int|0x00000300
suffix:semicolon
singleline_comment|// Broadcast, Multicast disabled
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;i2o_lan: Enabling unicast mode...&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i2o_set_scalar
c_func
(paren
id|iop
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0001
comma
l_int|3
comma
op_amp
id|filter_mask
comma
l_int|4
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;i2o_lan: Unable to set MAC FilterMask.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|i2o_lan_register_device
r_struct
id|device
op_star
id|i2o_lan_register_device
c_func
(paren
r_struct
id|i2o_device
op_star
id|i2o_dev
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
l_int|NULL
suffix:semicolon
id|u8
id|hw_addr
(braket
l_int|8
)braket
suffix:semicolon
r_int
r_int
(paren
op_star
id|type_trans
)paren
(paren
r_struct
id|sk_buff
op_star
comma
r_struct
id|device
op_star
)paren
suffix:semicolon
r_void
(paren
op_star
id|unregister_dev
)paren
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|i2o_dev-&gt;subclass
)paren
(brace
r_case
id|I2O_LAN_ETHERNET
suffix:colon
id|dev
op_assign
id|init_etherdev
c_func
(paren
l_int|NULL
comma
r_sizeof
(paren
r_struct
id|i2o_lan_local
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|type_trans
op_assign
id|eth_type_trans
suffix:semicolon
id|unregister_dev
op_assign
id|unregister_netdev
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_ANYLAN
r_case
id|I2O_LAN_100VG
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2o_lan: 100base VG not yet supported&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_TR
r_case
id|I2O_LAN_TR
suffix:colon
id|dev
op_assign
id|init_trdev
c_func
(paren
l_int|NULL
comma
r_sizeof
(paren
r_struct
id|i2o_lan_local
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|type_trans
op_assign
id|tr_type_trans
suffix:semicolon
id|unregister_dev
op_assign
id|unregister_trdev
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FDDI
r_case
id|I2O_LAN_FDDI
suffix:colon
(brace
r_int
id|size
op_assign
r_sizeof
(paren
r_struct
id|device
)paren
op_plus
r_sizeof
(paren
r_struct
id|i2o_lan_local
)paren
op_plus
r_sizeof
(paren
l_string|&quot;fddi%d &quot;
)paren
suffix:semicolon
id|dev
op_assign
(paren
r_struct
id|device
op_star
)paren
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|dev
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
(paren
r_void
op_star
)paren
(paren
id|dev
op_plus
l_int|1
)paren
suffix:semicolon
id|dev-&gt;name
op_assign
(paren
r_char
op_star
)paren
(paren
id|dev
op_plus
l_int|1
)paren
op_plus
r_sizeof
(paren
r_struct
id|i2o_lan_local
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_alloc_name
c_func
(paren
id|dev
comma
l_string|&quot;fddi%d&quot;
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;i2o_lan: Too many FDDI devices.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|type_trans
op_assign
id|fddi_type_trans
suffix:semicolon
id|unregister_dev
op_assign
(paren
r_void
op_star
)paren
id|unregister_netdevice
suffix:semicolon
id|fddi_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_FIBRE_CHANNEL
r_case
id|I2O_LAN_FIBRE_CHANNEL
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;i2o_lan: Fibre Channel not yet supported&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|I2O_LAN_UNKNOWN
suffix:colon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2o_lan: LAN type 0x%08X not supported&bslash;n&quot;
comma
id|i2o_dev-&gt;subclass
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|priv-&gt;i2o_dev
op_assign
id|i2o_dev
suffix:semicolon
id|priv-&gt;type_trans
op_assign
id|type_trans
suffix:semicolon
r_if
c_cond
(paren
id|i2o_query_scalar
c_func
(paren
id|i2o_dev-&gt;controller
comma
id|i2o_dev-&gt;id
comma
id|lan_context
comma
l_int|0x0001
comma
l_int|0
comma
op_amp
id|hw_addr
comma
l_int|8
comma
op_amp
id|priv-&gt;reply_flag
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Unable to query hardware address.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|unregister_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;%s: hwaddr = %02X:%02X:%02X:%02X:%02X:%02X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|hw_addr
(braket
l_int|0
)braket
comma
id|hw_addr
(braket
l_int|1
)braket
comma
id|hw_addr
(braket
l_int|2
)braket
comma
id|hw_addr
(braket
l_int|3
)braket
comma
id|hw_addr
(braket
l_int|4
)braket
comma
id|hw_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|dev-&gt;addr_len
op_assign
l_int|6
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|hw_addr
comma
l_int|6
)paren
suffix:semicolon
id|dev-&gt;open
op_assign
id|i2o_lan_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|i2o_lan_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|i2o_lan_packet_send
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|i2o_lan_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|i2o_lan_set_multicast_list
suffix:semicolon
r_return
id|dev
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|macro|i2o_lan_init
mdefine_line|#define i2o_lan_init&t;init_module
macro_line|#endif
DECL|function|i2o_lan_init
id|__init
r_int
id|i2o_lan_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_struct
id|i2o_lan_local
op_star
id|priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|i2o_install_handler
c_func
(paren
op_amp
id|i2o_lan_handler
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to register I2O LAN OSM.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|lan_context
op_assign
id|i2o_lan_handler.context
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_I2O_CONTROLLERS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|i2o_controller
op_star
id|iop
op_assign
id|i2o_find_controller
c_func
(paren
id|i
)paren
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
suffix:semicolon
r_if
c_cond
(paren
id|iop
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|i2o_dev
op_assign
id|iop-&gt;devices
suffix:semicolon
id|i2o_dev
op_ne
l_int|NULL
suffix:semicolon
id|i2o_dev
op_assign
id|i2o_dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|i2o_dev
op_member_access_from_pointer
r_class
op_ne
id|I2O_CLASS_LAN
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|unit
op_eq
id|MAX_LAN_CARDS
)paren
(brace
id|i2o_unlock_controller
c_func
(paren
id|iop
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Too many I2O LAN devices.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dev
op_assign
id|i2o_lan_register_device
c_func
(paren
id|i2o_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to register I2O LAN device&bslash;n&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
singleline_comment|// try next one
)brace
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|unit
op_increment
suffix:semicolon
id|i2o_landevs
(braket
id|unit
)braket
op_assign
id|dev
suffix:semicolon
id|priv-&gt;unit
op_assign
id|unit
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: I2O LAN device registered, tid = %d,&quot;
l_string|&quot; subclass = 0x%08X, unit = %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i2o_dev-&gt;id
comma
id|i2o_dev-&gt;subclass
comma
id|priv-&gt;unit
)paren
suffix:semicolon
)brace
id|i2o_unlock_controller
c_func
(paren
id|iop
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%d I2O LAN devices found and registered.&bslash;n&quot;
comma
id|unit
op_plus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|unit
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
id|i2o_landevs
(braket
id|i
)braket
suffix:semicolon
r_struct
id|i2o_lan_local
op_star
id|priv
op_assign
(paren
r_struct
id|i2o_lan_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i2o_device
op_star
id|i2o_dev
op_assign
id|priv-&gt;i2o_dev
suffix:semicolon
r_switch
c_cond
(paren
id|i2o_dev-&gt;subclass
)paren
(brace
r_case
id|I2O_LAN_ETHERNET
suffix:colon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_FDDI
r_case
id|I2O_LAN_FDDI
suffix:colon
id|unregister_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_TR
r_case
id|I2O_LAN_TR
suffix:colon
id|unregister_trdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;i2o_lan: Spurious I2O LAN subclass 0x%08X.&bslash;n&quot;
comma
id|i2o_dev-&gt;subclass
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: I2O LAN device unregistered.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|i2o_remove_handler
c_func
(paren
op_amp
id|i2o_lan_handler
)paren
suffix:semicolon
)brace
id|EXPORT_NO_SYMBOLS
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Univ of Helsinki, CS Department&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;I2O Lan OSM&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|bucketpost
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
singleline_comment|// Number of buckets to post
id|MODULE_PARM
c_func
(paren
id|bucketthresh
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
singleline_comment|// Bucket post threshold
macro_line|#endif    
eof
