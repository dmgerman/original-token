multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;Definitions for the AF_INET socket handler.&n; *&n; * Version:&t;@(#)sock.h&t;1.0.4&t;05/13/93&n; *&n; * Authors:&t;Ross Biro, &lt;bir7@leland.Stanford.Edu&gt;&n; *&t;&t;Fred N. van Kempen, &lt;waltje@uWalt.NL.Mugnet.ORG&gt;&n; *&t;&t;Corey Minyard &lt;wf-rch!minyard@relay.EU.net&gt;&n; *&t;&t;Florian La Roche &lt;flla@stud.uni-sb.de&gt;&n; *&n; * Fixes:&n; *&t;&t;Alan Cox&t;:&t;Volatiles in skbuff pointers. See&n; *&t;&t;&t;&t;&t;skbuff comments. May be overdone,&n; *&t;&t;&t;&t;&t;better to prove they can be removed&n; *&t;&t;&t;&t;&t;than the reverse.&n; *&t;&t;Alan Cox&t;:&t;Added a zapped field for tcp to note&n; *&t;&t;&t;&t;&t;a socket is reset and must stay shut up&n; *&t;&t;Alan Cox&t;:&t;New fields for options&n; *&t;Pauline Middelink&t;:&t;identd support&n; *&t;&t;Alan Cox&t;:&t;Eliminate low level recv/recvfrom&n; *&t;&t;David S. Miller&t;:&t;New socket lookup architecture.&n; *              Steve Whitehouse:       Default routines for sock_ops&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#ifndef _SOCK_H
DECL|macro|_SOCK_H
mdefine_line|#define _SOCK_H
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/in.h&gt;&t;&t;/* struct sockaddr_in */
macro_line|#if defined(CONFIG_IPV6) || defined (CONFIG_IPV6_MODULE)
macro_line|#include &lt;linux/in6.h&gt;&t;&t;/* struct sockaddr_in6 */
macro_line|#include &lt;linux/ipv6.h&gt;&t;&t;/* dest_cache, inet6_options */
macro_line|#include &lt;linux/icmpv6.h&gt;
macro_line|#include &lt;net/if_inet6.h&gt;&t;/* struct ipv6_mc_socklist */
macro_line|#endif
macro_line|#if defined(CONFIG_INET) || defined (CONFIG_INET_MODULE)
macro_line|#include &lt;linux/icmp.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/tcp.h&gt;&t;&t;/* struct tcphdr */
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;&t;/* struct sk_buff */
macro_line|#include &lt;net/protocol.h&gt;&t;&t;/* struct inet_protocol */
macro_line|#if defined(CONFIG_X25) || defined(CONFIG_X25_MODULE)
macro_line|#include &lt;net/x25.h&gt;
macro_line|#endif
macro_line|#if defined(CONFIG_AX25) || defined(CONFIG_AX25_MODULE)
macro_line|#include &lt;net/ax25.h&gt;
macro_line|#if defined(CONFIG_NETROM) || defined(CONFIG_NETROM_MODULE)
macro_line|#include &lt;net/netrom.h&gt;
macro_line|#endif
macro_line|#if defined(CONFIG_ROSE) || defined(CONFIG_ROSE_MODULE)
macro_line|#include &lt;net/rose.h&gt;
macro_line|#endif
macro_line|#endif
macro_line|#if defined(CONFIG_IPX) || defined(CONFIG_IPX_MODULE)
macro_line|#if defined(CONFIG_SPX) || defined(CONFIG_SPX_MODULE)
macro_line|#include &lt;net/spx.h&gt;
macro_line|#else
macro_line|#include &lt;net/ipx.h&gt;
macro_line|#endif /* CONFIG_SPX */
macro_line|#endif /* CONFIG_IPX */
macro_line|#if defined(CONFIG_ATALK) || defined(CONFIG_ATALK_MODULE)
macro_line|#include &lt;linux/atalk.h&gt;
macro_line|#endif
macro_line|#if defined(CONFIG_DECNET) || defined(CONFIG_DECNET_MODULE)
macro_line|#include &lt;net/dn.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_FILTER
macro_line|#include &lt;linux/filter.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/atomic.h&gt;
DECL|macro|MIN_WRITE_SPACE
mdefine_line|#define MIN_WRITE_SPACE&t;2048
multiline_comment|/* The AF_UNIX specific socket options */
DECL|struct|unix_opt
r_struct
id|unix_opt
(brace
DECL|member|family
r_int
id|family
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|locks
r_int
id|locks
suffix:semicolon
DECL|member|addr
r_struct
id|unix_address
op_star
id|addr
suffix:semicolon
DECL|member|dentry
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
DECL|member|readsem
r_struct
id|semaphore
id|readsem
suffix:semicolon
DECL|member|other
r_struct
id|sock
op_star
id|other
suffix:semicolon
DECL|member|list
r_struct
id|sock
op_star
op_star
id|list
suffix:semicolon
DECL|member|marksweep
r_int
id|marksweep
suffix:semicolon
DECL|macro|MARKED
mdefine_line|#define MARKED&t;&t;&t;1
DECL|member|inflight
r_int
id|inflight
suffix:semicolon
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_NETLINK
r_struct
id|netlink_callback
suffix:semicolon
DECL|struct|netlink_opt
r_struct
id|netlink_opt
(brace
DECL|member|pid
id|pid_t
id|pid
suffix:semicolon
DECL|member|groups
r_int
id|groups
suffix:semicolon
DECL|member|dst_pid
id|pid_t
id|dst_pid
suffix:semicolon
DECL|member|dst_groups
r_int
id|dst_groups
suffix:semicolon
DECL|member|handler
r_int
(paren
op_star
id|handler
)paren
(paren
r_int
id|unit
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
DECL|member|locks
id|atomic_t
id|locks
suffix:semicolon
DECL|member|cb
r_struct
id|netlink_callback
op_star
id|cb
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* Once the IPX ncpd patches are in these are going into protinfo. */
macro_line|#if defined(CONFIG_IPX) || defined(CONFIG_IPX_MODULE)
DECL|struct|ipx_opt
r_struct
id|ipx_opt
(brace
DECL|member|dest_addr
id|ipx_address
id|dest_addr
suffix:semicolon
DECL|member|intrfc
id|ipx_interface
op_star
id|intrfc
suffix:semicolon
DECL|member|port
r_int
r_int
id|port
suffix:semicolon
macro_line|#ifdef CONFIG_IPX_INTERN
DECL|member|node
r_int
r_char
id|node
(braket
id|IPX_NODE_LEN
)braket
suffix:semicolon
macro_line|#endif
DECL|member|type
r_int
r_int
id|type
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_IPV6) || defined (CONFIG_IPV6_MODULE)
DECL|struct|ipv6_pinfo
r_struct
id|ipv6_pinfo
(brace
DECL|member|saddr
r_struct
id|in6_addr
id|saddr
suffix:semicolon
DECL|member|rcv_saddr
r_struct
id|in6_addr
id|rcv_saddr
suffix:semicolon
DECL|member|daddr
r_struct
id|in6_addr
id|daddr
suffix:semicolon
DECL|member|daddr_cache
r_struct
id|in6_addr
op_star
id|daddr_cache
suffix:semicolon
DECL|member|flow_lbl
id|__u32
id|flow_lbl
suffix:semicolon
DECL|member|frag_size
id|__u32
id|frag_size
suffix:semicolon
DECL|member|hop_limit
r_int
id|hop_limit
suffix:semicolon
DECL|member|mcast_hops
r_int
id|mcast_hops
suffix:semicolon
DECL|member|mcast_oif
r_int
id|mcast_oif
suffix:semicolon
DECL|member|priority
id|__u8
id|priority
suffix:semicolon
multiline_comment|/* pktoption flags */
r_union
(brace
r_struct
(brace
DECL|member|srcrt
id|__u8
id|srcrt
suffix:colon
l_int|2
comma
DECL|member|rxinfo
id|rxinfo
suffix:colon
l_int|1
comma
DECL|member|rxhlim
id|rxhlim
suffix:colon
l_int|1
comma
DECL|member|hopopts
id|hopopts
suffix:colon
l_int|1
comma
DECL|member|dstopts
id|dstopts
suffix:colon
l_int|1
comma
DECL|member|authhdr
id|authhdr
suffix:colon
l_int|1
comma
DECL|member|unused
id|unused
suffix:colon
l_int|1
suffix:semicolon
DECL|member|bits
)brace
id|bits
suffix:semicolon
DECL|member|all
id|__u8
id|all
suffix:semicolon
DECL|member|rxopt
)brace
id|rxopt
suffix:semicolon
multiline_comment|/* sockopt flags */
DECL|member|mc_loop
id|__u8
id|mc_loop
suffix:colon
l_int|1
comma
DECL|member|recverr
id|recverr
suffix:colon
l_int|1
comma
DECL|member|pmtudisc
id|pmtudisc
suffix:colon
l_int|2
suffix:semicolon
DECL|member|ipv6_mc_list
r_struct
id|ipv6_mc_socklist
op_star
id|ipv6_mc_list
suffix:semicolon
DECL|member|dst_cookie
id|__u32
id|dst_cookie
suffix:semicolon
DECL|member|opt
r_struct
id|ipv6_txoptions
op_star
id|opt
suffix:semicolon
DECL|member|pktoptions
r_struct
id|sk_buff
op_star
id|pktoptions
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|raw6_opt
r_struct
id|raw6_opt
(brace
DECL|member|checksum
id|__u32
id|checksum
suffix:semicolon
multiline_comment|/* perform checksum */
DECL|member|offset
id|__u32
id|offset
suffix:semicolon
multiline_comment|/* checksum offset  */
DECL|member|filter
r_struct
id|icmp6_filter
id|filter
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif /* IPV6 */
macro_line|#if defined(CONFIG_INET) || defined(CONFIG_INET_MODULE)
DECL|struct|raw_opt
r_struct
id|raw_opt
(brace
DECL|member|filter
r_struct
id|icmp_filter
id|filter
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* This defines a selective acknowledgement block. */
DECL|struct|tcp_sack_block
r_struct
id|tcp_sack_block
(brace
DECL|member|start_seq
id|__u32
id|start_seq
suffix:semicolon
DECL|member|end_seq
id|__u32
id|end_seq
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|tcp_opt
r_struct
id|tcp_opt
(brace
DECL|member|tcp_header_len
r_int
id|tcp_header_len
suffix:semicolon
multiline_comment|/* Bytes of tcp header to send&t;&t;*/
multiline_comment|/*&n; *&t;Header prediction flags&n; *&t;0x5?10 &lt;&lt; 16 + snd_wnd in net byte order&n; */
DECL|member|pred_flags
id|__u32
id|pred_flags
suffix:semicolon
multiline_comment|/*&n; *&t;RFC793 variables by their proper names. This means you can&n; *&t;read the code and the spec side by side (and laugh ...)&n; *&t;See RFC793 and RFC1122. The RFC writes these in capitals.&n; */
DECL|member|rcv_nxt
id|__u32
id|rcv_nxt
suffix:semicolon
multiline_comment|/* What we want to receive next &t;*/
DECL|member|snd_nxt
id|__u32
id|snd_nxt
suffix:semicolon
multiline_comment|/* Next sequence we send&t;&t;*/
DECL|member|snd_una
id|__u32
id|snd_una
suffix:semicolon
multiline_comment|/* First byte we want an ack for&t;*/
DECL|member|rcv_tstamp
id|__u32
id|rcv_tstamp
suffix:semicolon
multiline_comment|/* timestamp of last received packet&t;*/
DECL|member|lrcvtime
id|__u32
id|lrcvtime
suffix:semicolon
multiline_comment|/* timestamp of last received data packet*/
DECL|member|srtt
id|__u32
id|srtt
suffix:semicolon
multiline_comment|/* smothed round trip time &lt;&lt; 3&t;&t;*/
DECL|member|ato
id|__u32
id|ato
suffix:semicolon
multiline_comment|/* delayed ack timeout&t;&t;&t;*/
DECL|member|snd_wl1
id|__u32
id|snd_wl1
suffix:semicolon
multiline_comment|/* Sequence for window update&t;&t;*/
DECL|member|snd_wl2
id|__u32
id|snd_wl2
suffix:semicolon
multiline_comment|/* Ack sequence for update&t;&t;*/
DECL|member|snd_wnd
id|__u32
id|snd_wnd
suffix:semicolon
multiline_comment|/* The window we expect to receive&t;*/
DECL|member|max_window
id|__u32
id|max_window
suffix:semicolon
DECL|member|pmtu_cookie
id|__u32
id|pmtu_cookie
suffix:semicolon
multiline_comment|/* Last pmtu seen by socket&t;&t;*/
DECL|member|mss_cache
id|__u16
id|mss_cache
suffix:semicolon
multiline_comment|/* Cached effective mss, not including SACKS */
DECL|member|mss_clamp
id|__u16
id|mss_clamp
suffix:semicolon
multiline_comment|/* Maximal mss, negotiated at connection setup */
DECL|member|ext_header_len
id|__u16
id|ext_header_len
suffix:semicolon
multiline_comment|/* Dave, do you allow mw to use this hole? 8) --ANK */
DECL|member|pending
id|__u8
id|pending
suffix:semicolon
multiline_comment|/* pending events&t;&t;&t;*/
DECL|member|retransmits
id|__u8
id|retransmits
suffix:semicolon
DECL|member|last_ack_sent
id|__u32
id|last_ack_sent
suffix:semicolon
multiline_comment|/* last ack we sent&t;&t;&t;*/
DECL|member|backoff
id|__u32
id|backoff
suffix:semicolon
multiline_comment|/* backoff&t;&t;&t;&t;*/
DECL|member|mdev
id|__u32
id|mdev
suffix:semicolon
multiline_comment|/* medium deviation&t;&t;&t;*/
DECL|member|snd_cwnd
id|__u32
id|snd_cwnd
suffix:semicolon
multiline_comment|/* Sending congestion window&t;&t;*/
DECL|member|rto
id|__u32
id|rto
suffix:semicolon
multiline_comment|/* retransmit timeout&t;&t;&t;*/
DECL|member|packets_out
id|__u32
id|packets_out
suffix:semicolon
multiline_comment|/* Packets which are &quot;in flight&quot;&t;*/
DECL|member|fackets_out
id|__u32
id|fackets_out
suffix:semicolon
multiline_comment|/* Non-retrans SACK&squot;d packets&t;&t;*/
DECL|member|retrans_out
id|__u32
id|retrans_out
suffix:semicolon
multiline_comment|/* Fast-retransmitted packets out&t;*/
DECL|member|high_seq
id|__u32
id|high_seq
suffix:semicolon
multiline_comment|/* snd_nxt at onset of congestion&t;*/
multiline_comment|/*&n; *&t;Slow start and congestion control (see also Nagle, and Karn &amp; Partridge)&n; */
DECL|member|snd_ssthresh
id|__u32
id|snd_ssthresh
suffix:semicolon
multiline_comment|/* Slow start size threshold&t;&t;*/
DECL|member|snd_cwnd_cnt
id|__u16
id|snd_cwnd_cnt
suffix:semicolon
multiline_comment|/* Linear increase counter&t;&t;*/
DECL|member|dup_acks
id|__u8
id|dup_acks
suffix:semicolon
multiline_comment|/* Consequetive duplicate acks seen from other end */
DECL|member|delayed_acks
id|__u8
id|delayed_acks
suffix:semicolon
DECL|member|user_mss
id|__u16
id|user_mss
suffix:semicolon
multiline_comment|/* mss requested by user in ioctl */
multiline_comment|/* Two commonly used timers in both sender and receiver paths. */
DECL|member|retransmit_timer
r_struct
id|timer_list
id|retransmit_timer
suffix:semicolon
multiline_comment|/* Resend (no ack)&t;*/
DECL|member|delack_timer
r_struct
id|timer_list
id|delack_timer
suffix:semicolon
multiline_comment|/* Ack delay &t;&t;*/
DECL|member|out_of_order_queue
r_struct
id|sk_buff_head
id|out_of_order_queue
suffix:semicolon
multiline_comment|/* Out of order segments go here */
DECL|member|af_specific
r_struct
id|tcp_func
op_star
id|af_specific
suffix:semicolon
multiline_comment|/* Operations which are AF_INET{4,6} specific&t;*/
DECL|member|send_head
r_struct
id|sk_buff
op_star
id|send_head
suffix:semicolon
multiline_comment|/* Front of stuff to transmit&t;&t;&t;*/
DECL|member|retrans_head
r_struct
id|sk_buff
op_star
id|retrans_head
suffix:semicolon
multiline_comment|/* retrans head can be &n;&t;&t;&t;&t;&t;&t; * different to the head of&n;&t;&t;&t;&t;&t;&t; * write queue if we are doing&n;&t;&t;&t;&t;&t;&t; * fast retransmit&n;&t;&t;&t;&t;&t;&t; */
DECL|member|rcv_wnd
id|__u32
id|rcv_wnd
suffix:semicolon
multiline_comment|/* Current receiver window&t;&t;*/
DECL|member|rcv_wup
id|__u32
id|rcv_wup
suffix:semicolon
multiline_comment|/* rcv_nxt on last window update sent&t;*/
DECL|member|write_seq
id|__u32
id|write_seq
suffix:semicolon
DECL|member|copied_seq
id|__u32
id|copied_seq
suffix:semicolon
multiline_comment|/*&n; *      Options received (usually on last packet, some only on SYN packets).&n; */
DECL|member|tstamp_ok
r_char
id|tstamp_ok
comma
multiline_comment|/* TIMESTAMP seen on SYN packet&t;&t;*/
DECL|member|wscale_ok
id|wscale_ok
comma
multiline_comment|/* Wscale seen on SYN packet&t;&t;*/
DECL|member|sack_ok
id|sack_ok
suffix:semicolon
multiline_comment|/* SACK seen on SYN packet&t;&t;*/
DECL|member|saw_tstamp
r_char
id|saw_tstamp
suffix:semicolon
multiline_comment|/* Saw TIMESTAMP on last packet&t;&t;*/
DECL|member|snd_wscale
id|__u8
id|snd_wscale
suffix:semicolon
multiline_comment|/* Window scaling received from sender&t;*/
DECL|member|rcv_wscale
id|__u8
id|rcv_wscale
suffix:semicolon
multiline_comment|/* Window scaling to send to receiver&t;*/
DECL|member|rcv_tsval
id|__u32
id|rcv_tsval
suffix:semicolon
multiline_comment|/* Time stamp value             &t;*/
DECL|member|rcv_tsecr
id|__u32
id|rcv_tsecr
suffix:semicolon
multiline_comment|/* Time stamp echo reply        &t;*/
DECL|member|ts_recent
id|__u32
id|ts_recent
suffix:semicolon
multiline_comment|/* Time stamp to echo next&t;&t;*/
DECL|member|ts_recent_stamp
id|__u32
id|ts_recent_stamp
suffix:semicolon
multiline_comment|/* Time we stored ts_recent (for aging) */
DECL|member|num_sacks
r_int
id|num_sacks
suffix:semicolon
multiline_comment|/* Number of SACK blocks&t;&t;*/
DECL|member|selective_acks
r_struct
id|tcp_sack_block
id|selective_acks
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* The SACKS themselves*/
DECL|member|probe_timer
r_struct
id|timer_list
id|probe_timer
suffix:semicolon
multiline_comment|/* Probes&t;*/
DECL|member|window_clamp
id|__u32
id|window_clamp
suffix:semicolon
multiline_comment|/* XXX Document this... -DaveM&t;&t;*/
DECL|member|probes_out
id|__u32
id|probes_out
suffix:semicolon
multiline_comment|/* unanswered 0 window probes&t;&t;*/
DECL|member|syn_seq
id|__u32
id|syn_seq
suffix:semicolon
DECL|member|fin_seq
id|__u32
id|fin_seq
suffix:semicolon
DECL|member|urg_seq
id|__u32
id|urg_seq
suffix:semicolon
DECL|member|urg_data
id|__u32
id|urg_data
suffix:semicolon
DECL|member|last_seg_size
id|__u32
id|last_seg_size
suffix:semicolon
multiline_comment|/* Size of last incoming segment */
DECL|member|rcv_mss
id|__u32
id|rcv_mss
suffix:semicolon
multiline_comment|/* MSS used for delayed ACK decisions */
DECL|member|syn_wait_queue
r_struct
id|open_request
op_star
id|syn_wait_queue
suffix:semicolon
DECL|member|syn_wait_last
r_struct
id|open_request
op_star
op_star
id|syn_wait_last
suffix:semicolon
DECL|member|syn_backlog
r_int
id|syn_backlog
suffix:semicolon
multiline_comment|/* Backlog of received SYNs */
)brace
suffix:semicolon
multiline_comment|/*&n; * This structure really needs to be cleaned up.&n; * Most of it is for TCP, and not used by any of&n; * the other protocols.&n; */
multiline_comment|/*&n; * The idea is to start moving to a newer struct gradualy&n; * &n; * IMHO the newer struct should have the following format:&n; * &n; *&t;struct sock {&n; *&t;&t;sockmem [mem, proto, callbacks]&n; *&n; *&t;&t;union or struct {&n; *&t;&t;&t;ax25;&n; *&t;&t;} ll_pinfo;&n; *&t;&n; *&t;&t;union {&n; *&t;&t;&t;ipv4;&n; *&t;&t;&t;ipv6;&n; *&t;&t;&t;ipx;&n; *&t;&t;&t;netrom;&n; *&t;&t;&t;rose;&n; * &t;&t;&t;x25;&n; *&t;&t;} net_pinfo;&n; *&n; *&t;&t;union {&n; *&t;&t;&t;tcp;&n; *&t;&t;&t;udp;&n; *&t;&t;&t;spx;&n; *&t;&t;&t;netrom;&n; *&t;&t;} tp_pinfo;&n; *&n; *&t;}&n; */
multiline_comment|/* Define this to get the sk-&gt;debug debugging facility. */
DECL|macro|SOCK_DEBUGGING
mdefine_line|#define SOCK_DEBUGGING
macro_line|#ifdef SOCK_DEBUGGING
DECL|macro|SOCK_DEBUG
mdefine_line|#define SOCK_DEBUG(sk, msg...) do { if((sk) &amp;&amp; ((sk)-&gt;debug)) printk(KERN_DEBUG ## msg); } while (0)
macro_line|#else
DECL|macro|SOCK_DEBUG
mdefine_line|#define SOCK_DEBUG(sk, msg...) do { } while (0)
macro_line|#endif
DECL|struct|sock
r_struct
id|sock
(brace
multiline_comment|/* This must be first. */
DECL|member|sklist_next
r_struct
id|sock
op_star
id|sklist_next
suffix:semicolon
DECL|member|sklist_prev
r_struct
id|sock
op_star
id|sklist_prev
suffix:semicolon
multiline_comment|/* Local port binding hash linkage. */
DECL|member|bind_next
r_struct
id|sock
op_star
id|bind_next
suffix:semicolon
DECL|member|bind_pprev
r_struct
id|sock
op_star
op_star
id|bind_pprev
suffix:semicolon
multiline_comment|/* Socket demultiplex comparisons on incoming packets. */
DECL|member|daddr
id|__u32
id|daddr
suffix:semicolon
multiline_comment|/* Foreign IPv4 addr&t;&t;&t;*/
DECL|member|rcv_saddr
id|__u32
id|rcv_saddr
suffix:semicolon
multiline_comment|/* Bound local IPv4 addr&t;&t;*/
DECL|member|dport
id|__u16
id|dport
suffix:semicolon
multiline_comment|/* Destination port&t;&t;&t;*/
DECL|member|num
r_int
r_int
id|num
suffix:semicolon
multiline_comment|/* Local port&t;&t;&t;&t;*/
DECL|member|bound_dev_if
r_int
id|bound_dev_if
suffix:semicolon
multiline_comment|/* Bound device index if != 0&t;&t;*/
multiline_comment|/* Main hash linkage for various protocol lookup tables. */
DECL|member|next
r_struct
id|sock
op_star
id|next
suffix:semicolon
DECL|member|pprev
r_struct
id|sock
op_star
op_star
id|pprev
suffix:semicolon
DECL|member|state
r_volatile
r_int
r_char
id|state
comma
multiline_comment|/* Connection state&t;&t;&t;*/
DECL|member|zapped
id|zapped
suffix:semicolon
multiline_comment|/* In ax25 &amp; ipx means not linked&t;*/
DECL|member|sport
id|__u16
id|sport
suffix:semicolon
multiline_comment|/* Source port&t;&t;&t;&t;*/
DECL|member|family
r_int
r_int
id|family
suffix:semicolon
multiline_comment|/* Address family&t;&t;&t;*/
DECL|member|reuse
r_int
r_char
id|reuse
comma
multiline_comment|/* SO_REUSEADDR setting&t;&t;&t;*/
DECL|member|nonagle
id|nonagle
suffix:semicolon
multiline_comment|/* Disable Nagle algorithm?&t;&t;*/
DECL|member|sock_readers
id|atomic_t
id|sock_readers
suffix:semicolon
multiline_comment|/* User count&t;&t;&t;&t;*/
DECL|member|rcvbuf
r_int
id|rcvbuf
suffix:semicolon
multiline_comment|/* Size of receive buffer in bytes&t;*/
DECL|member|sleep
r_struct
id|wait_queue
op_star
op_star
id|sleep
suffix:semicolon
multiline_comment|/* Sock wait queue&t;&t;&t;*/
DECL|member|dst_cache
r_struct
id|dst_entry
op_star
id|dst_cache
suffix:semicolon
multiline_comment|/* Destination cache&t;&t;&t;*/
DECL|member|rmem_alloc
id|atomic_t
id|rmem_alloc
suffix:semicolon
multiline_comment|/* Receive queue bytes committed&t;*/
DECL|member|receive_queue
r_struct
id|sk_buff_head
id|receive_queue
suffix:semicolon
multiline_comment|/* Incoming packets&t;&t;&t;*/
DECL|member|wmem_alloc
id|atomic_t
id|wmem_alloc
suffix:semicolon
multiline_comment|/* Transmit queue bytes committed&t;*/
DECL|member|write_queue
r_struct
id|sk_buff_head
id|write_queue
suffix:semicolon
multiline_comment|/* Packet sending queue&t;&t;&t;*/
DECL|member|omem_alloc
id|atomic_t
id|omem_alloc
suffix:semicolon
multiline_comment|/* &quot;o&quot; is &quot;option&quot; or &quot;other&quot; */
DECL|member|saddr
id|__u32
id|saddr
suffix:semicolon
multiline_comment|/* Sending source&t;&t;&t;*/
DECL|member|allocation
r_int
r_int
id|allocation
suffix:semicolon
multiline_comment|/* Allocation mode&t;&t;&t;*/
DECL|member|sndbuf
r_int
id|sndbuf
suffix:semicolon
multiline_comment|/* Size of send buffer in bytes&t;&t;*/
DECL|member|prev
r_struct
id|sock
op_star
id|prev
suffix:semicolon
multiline_comment|/* Not all are volatile, but some are, so we might as well say they all are.&n;&t; * XXX Make this a flag word -DaveM&n;&t; */
DECL|member|dead
r_volatile
r_char
id|dead
comma
DECL|member|done
id|done
comma
DECL|member|urginline
id|urginline
comma
DECL|member|keepopen
id|keepopen
comma
DECL|member|linger
id|linger
comma
DECL|member|destroy
id|destroy
comma
DECL|member|no_check
id|no_check
comma
DECL|member|broadcast
id|broadcast
comma
DECL|member|bsdism
id|bsdism
suffix:semicolon
DECL|member|debug
r_int
r_char
id|debug
suffix:semicolon
DECL|member|proc
r_int
id|proc
suffix:semicolon
DECL|member|lingertime
r_int
r_int
id|lingertime
suffix:semicolon
DECL|member|hashent
r_int
id|hashent
suffix:semicolon
DECL|member|pair
r_struct
id|sock
op_star
id|pair
suffix:semicolon
multiline_comment|/* Error and backlog packet queues, rarely used. */
DECL|member|back_log
r_struct
id|sk_buff_head
id|back_log
comma
DECL|member|error_queue
id|error_queue
suffix:semicolon
DECL|member|prot
r_struct
id|proto
op_star
id|prot
suffix:semicolon
DECL|member|shutdown
r_int
r_int
id|shutdown
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined (CONFIG_IPV6_MODULE)
r_union
(brace
DECL|member|af_inet6
r_struct
id|ipv6_pinfo
id|af_inet6
suffix:semicolon
DECL|member|net_pinfo
)brace
id|net_pinfo
suffix:semicolon
macro_line|#endif
r_union
(brace
DECL|member|af_tcp
r_struct
id|tcp_opt
id|af_tcp
suffix:semicolon
macro_line|#if defined(CONFIG_INET) || defined (CONFIG_INET_MODULE)
DECL|member|tp_raw4
r_struct
id|raw_opt
id|tp_raw4
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_IPV6) || defined (CONFIG_IPV6_MODULE)
DECL|member|tp_raw
r_struct
id|raw6_opt
id|tp_raw
suffix:semicolon
macro_line|#endif /* CONFIG_IPV6 */
macro_line|#if defined(CONFIG_SPX) || defined (CONFIG_SPX_MODULE)
DECL|member|af_spx
r_struct
id|spx_opt
id|af_spx
suffix:semicolon
macro_line|#endif /* CONFIG_SPX */
DECL|member|tp_pinfo
)brace
id|tp_pinfo
suffix:semicolon
DECL|member|err
DECL|member|err_soft
r_int
id|err
comma
id|err_soft
suffix:semicolon
multiline_comment|/* Soft holds errors that don&squot;t&n;&t;&t;&t;&t;&t;&t;   cause failure but are the cause&n;&t;&t;&t;&t;&t;&t;   of a persistent failure not just&n;&t;&t;&t;&t;&t;&t;   &squot;timed out&squot; */
DECL|member|ack_backlog
r_int
r_int
id|ack_backlog
suffix:semicolon
DECL|member|max_ack_backlog
r_int
r_int
id|max_ack_backlog
suffix:semicolon
DECL|member|priority
id|__u32
id|priority
suffix:semicolon
DECL|member|type
r_int
r_int
id|type
suffix:semicolon
DECL|member|localroute
r_int
r_char
id|localroute
suffix:semicolon
multiline_comment|/* Route locally only */
DECL|member|protocol
r_int
r_char
id|protocol
suffix:semicolon
DECL|member|peercred
r_struct
id|ucred
id|peercred
suffix:semicolon
macro_line|#ifdef CONFIG_FILTER
multiline_comment|/* Socket Filtering Instructions */
DECL|member|filter
r_int
id|filter
suffix:semicolon
DECL|member|filter_data
r_struct
id|sock_filter
op_star
id|filter_data
suffix:semicolon
macro_line|#endif /* CONFIG_FILTER */
multiline_comment|/* This is where all the private (optional) areas that don&squot;t&n;&t; * overlap will eventually live. &n;&t; */
r_union
(brace
DECL|member|destruct_hook
r_void
op_star
id|destruct_hook
suffix:semicolon
DECL|member|af_unix
r_struct
id|unix_opt
id|af_unix
suffix:semicolon
macro_line|#if defined(CONFIG_ATALK) || defined(CONFIG_ATALK_MODULE)
DECL|member|af_at
r_struct
id|atalk_sock
id|af_at
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_IPX) || defined(CONFIG_IPX_MODULE)
DECL|member|af_ipx
r_struct
id|ipx_opt
id|af_ipx
suffix:semicolon
macro_line|#endif
macro_line|#if defined (CONFIG_DECNET) || defined(CONFIG_DECNET_MODULE)
DECL|member|dn
r_struct
id|dn_scp
id|dn
suffix:semicolon
macro_line|#endif
macro_line|#if defined (CONFIG_PACKET) || defined(CONFIG_PACKET_MODULE)
DECL|member|af_packet
r_struct
id|packet_opt
op_star
id|af_packet
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_X25) || defined(CONFIG_X25_MODULE)
DECL|member|x25
id|x25_cb
op_star
id|x25
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_AX25) || defined(CONFIG_AX25_MODULE)
DECL|member|ax25
id|ax25_cb
op_star
id|ax25
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_NETROM) || defined(CONFIG_NETROM_MODULE)
DECL|member|nr
id|nr_cb
op_star
id|nr
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ROSE) || defined(CONFIG_ROSE_MODULE)
DECL|member|rose
id|rose_cb
op_star
id|rose
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_NETLINK
DECL|member|af_netlink
r_struct
id|netlink_opt
id|af_netlink
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ECONET) || defined(CONFIG_ECONET_MODULE)
DECL|member|af_econet
r_struct
id|econet_opt
op_star
id|af_econet
suffix:semicolon
macro_line|#endif
DECL|member|protinfo
)brace
id|protinfo
suffix:semicolon
multiline_comment|/* IP &squot;private area&squot; or will be eventually. */
DECL|member|ip_ttl
r_int
id|ip_ttl
suffix:semicolon
multiline_comment|/* TTL setting */
DECL|member|ip_tos
r_int
id|ip_tos
suffix:semicolon
multiline_comment|/* TOS */
DECL|member|ip_cmsg_flags
r_int
id|ip_cmsg_flags
suffix:semicolon
DECL|member|opt
r_struct
id|ip_options
op_star
id|opt
suffix:semicolon
DECL|member|ip_hdrincl
r_int
r_char
id|ip_hdrincl
suffix:semicolon
multiline_comment|/* Include headers ? */
DECL|member|ip_mc_ttl
id|__u8
id|ip_mc_ttl
suffix:semicolon
multiline_comment|/* Multicasting TTL */
DECL|member|ip_mc_loop
id|__u8
id|ip_mc_loop
suffix:semicolon
multiline_comment|/* Loopback */
DECL|member|ip_recverr
id|__u8
id|ip_recverr
suffix:semicolon
DECL|member|ip_pmtudisc
id|__u8
id|ip_pmtudisc
suffix:semicolon
DECL|member|ip_mc_index
r_int
id|ip_mc_index
suffix:semicolon
multiline_comment|/* Multicast device index */
DECL|member|ip_mc_addr
id|__u32
id|ip_mc_addr
suffix:semicolon
DECL|member|ip_mc_list
r_struct
id|ip_mc_socklist
op_star
id|ip_mc_list
suffix:semicolon
multiline_comment|/* Group array */
multiline_comment|/* This part is used for the timeout functions (timer.c). */
DECL|member|timeout
r_int
id|timeout
suffix:semicolon
multiline_comment|/* What are we waiting for? */
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
multiline_comment|/* This is the sock cleanup timer. */
DECL|member|stamp
r_struct
id|timeval
id|stamp
suffix:semicolon
multiline_comment|/* Identd */
DECL|member|socket
r_struct
id|socket
op_star
id|socket
suffix:semicolon
multiline_comment|/* RPC layer private data */
DECL|member|user_data
r_void
op_star
id|user_data
suffix:semicolon
multiline_comment|/* Callbacks */
DECL|member|state_change
r_void
(paren
op_star
id|state_change
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|member|data_ready
r_void
(paren
op_star
id|data_ready
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|bytes
)paren
suffix:semicolon
DECL|member|write_space
r_void
(paren
op_star
id|write_space
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|member|error_report
r_void
(paren
op_star
id|error_report
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|member|backlog_rcv
r_int
(paren
op_star
id|backlog_rcv
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
DECL|member|destruct
r_void
(paren
op_star
id|destruct
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* IP protocol blocks we attach to sockets.&n; * socket layer -&gt; transport layer interface&n; * transport -&gt; network interface is defined by struct inet_proto&n; */
DECL|struct|proto
r_struct
id|proto
(brace
multiline_comment|/* These must be first. */
DECL|member|sklist_next
r_struct
id|sock
op_star
id|sklist_next
suffix:semicolon
DECL|member|sklist_prev
r_struct
id|sock
op_star
id|sklist_prev
suffix:semicolon
DECL|member|close
r_void
(paren
op_star
id|close
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|timeout
)paren
suffix:semicolon
DECL|member|connect
r_int
(paren
op_star
id|connect
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
suffix:semicolon
DECL|member|accept
r_struct
id|sock
op_star
(paren
op_star
id|accept
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|flags
)paren
suffix:semicolon
DECL|member|retransmit
r_void
(paren
op_star
id|retransmit
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|all
)paren
suffix:semicolon
DECL|member|write_wakeup
r_void
(paren
op_star
id|write_wakeup
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|member|read_wakeup
r_void
(paren
op_star
id|read_wakeup
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|member|poll
r_int
r_int
(paren
op_star
id|poll
)paren
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
suffix:semicolon
DECL|member|ioctl
r_int
(paren
op_star
id|ioctl
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
DECL|member|init
r_int
(paren
op_star
id|init
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|member|destroy
r_int
(paren
op_star
id|destroy
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|member|shutdown
r_void
(paren
op_star
id|shutdown
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|how
)paren
suffix:semicolon
DECL|member|setsockopt
r_int
(paren
op_star
id|setsockopt
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
suffix:semicolon
DECL|member|getsockopt
r_int
(paren
op_star
id|getsockopt
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|option
)paren
suffix:semicolon
DECL|member|sendmsg
r_int
(paren
op_star
id|sendmsg
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
)paren
suffix:semicolon
DECL|member|recvmsg
r_int
(paren
op_star
id|recvmsg
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_int
id|noblock
comma
r_int
id|flags
comma
r_int
op_star
id|addr_len
)paren
suffix:semicolon
DECL|member|bind
r_int
(paren
op_star
id|bind
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
suffix:semicolon
DECL|member|backlog_rcv
r_int
(paren
op_star
id|backlog_rcv
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
multiline_comment|/* Keeping track of sk&squot;s, looking them up, and port selection methods. */
DECL|member|hash
r_void
(paren
op_star
id|hash
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|member|unhash
r_void
(paren
op_star
id|unhash
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|member|rehash
r_void
(paren
op_star
id|rehash
)paren
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|member|good_socknum
r_int
r_int
(paren
op_star
id|good_socknum
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|member|verify_bind
r_int
(paren
op_star
id|verify_bind
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|snum
)paren
suffix:semicolon
DECL|member|max_header
r_int
r_int
id|max_header
suffix:semicolon
DECL|member|retransmits
r_int
r_int
id|retransmits
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|inuse
DECL|member|highestinuse
r_int
id|inuse
comma
id|highestinuse
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|TIME_WRITE
mdefine_line|#define TIME_WRITE&t;1&t;/* Not yet used */
DECL|macro|TIME_RETRANS
mdefine_line|#define TIME_RETRANS&t;2&t;/* Retransmit timer */
DECL|macro|TIME_DACK
mdefine_line|#define TIME_DACK&t;3&t;/* Delayed ack timer */
DECL|macro|TIME_CLOSE
mdefine_line|#define TIME_CLOSE&t;4
DECL|macro|TIME_KEEPOPEN
mdefine_line|#define TIME_KEEPOPEN&t;5
DECL|macro|TIME_DESTROY
mdefine_line|#define TIME_DESTROY&t;6
DECL|macro|TIME_DONE
mdefine_line|#define TIME_DONE&t;7&t;/* Used to absorb those last few packets */
DECL|macro|TIME_PROBE0
mdefine_line|#define TIME_PROBE0&t;8
multiline_comment|/* About 10 seconds */
DECL|macro|SOCK_DESTROY_TIME
mdefine_line|#define SOCK_DESTROY_TIME (10*HZ)
multiline_comment|/* Sockets 0-1023 can&squot;t be bound to unless you are superuser */
DECL|macro|PROT_SOCK
mdefine_line|#define PROT_SOCK&t;1024
DECL|macro|SHUTDOWN_MASK
mdefine_line|#define SHUTDOWN_MASK&t;3
DECL|macro|RCV_SHUTDOWN
mdefine_line|#define RCV_SHUTDOWN&t;1
DECL|macro|SEND_SHUTDOWN
mdefine_line|#define SEND_SHUTDOWN&t;2
multiline_comment|/* Per-protocol hash table implementations use this to make sure&n; * nothing changes.&n; */
DECL|macro|SOCKHASH_LOCK
mdefine_line|#define SOCKHASH_LOCK()&t;&t;start_bh_atomic()
DECL|macro|SOCKHASH_UNLOCK
mdefine_line|#define SOCKHASH_UNLOCK()&t;end_bh_atomic()
multiline_comment|/* Some things in the kernel just want to get at a protocols&n; * entire socket list commensurate, thus...&n; */
DECL|function|add_to_prot_sklist
r_static
id|__inline__
r_void
id|add_to_prot_sklist
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|SOCKHASH_LOCK
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;sklist_next
)paren
(brace
r_struct
id|proto
op_star
id|p
op_assign
id|sk-&gt;prot
suffix:semicolon
id|sk-&gt;sklist_prev
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|p
suffix:semicolon
id|sk-&gt;sklist_next
op_assign
id|p-&gt;sklist_next
suffix:semicolon
id|p-&gt;sklist_next-&gt;sklist_prev
op_assign
id|sk
suffix:semicolon
id|p-&gt;sklist_next
op_assign
id|sk
suffix:semicolon
multiline_comment|/* Charge the protocol. */
id|sk-&gt;prot-&gt;inuse
op_add_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;highestinuse
OL
id|sk-&gt;prot-&gt;inuse
)paren
(brace
id|sk-&gt;prot-&gt;highestinuse
op_assign
id|sk-&gt;prot-&gt;inuse
suffix:semicolon
)brace
)brace
id|SOCKHASH_UNLOCK
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|del_from_prot_sklist
r_static
id|__inline__
r_void
id|del_from_prot_sklist
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|SOCKHASH_LOCK
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sklist_next
)paren
(brace
id|sk-&gt;sklist_next-&gt;sklist_prev
op_assign
id|sk-&gt;sklist_prev
suffix:semicolon
id|sk-&gt;sklist_prev-&gt;sklist_next
op_assign
id|sk-&gt;sklist_next
suffix:semicolon
id|sk-&gt;sklist_next
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;prot-&gt;inuse
op_decrement
suffix:semicolon
)brace
id|SOCKHASH_UNLOCK
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Used by processes to &quot;lock&quot; a socket state, so that&n; * interrupts and bottom half handlers won&squot;t change it&n; * from under us. It essentially blocks any incoming&n; * packets, so that we won&squot;t get any new data or any&n; * packets that change the state of the socket.&n; *&n; * Note the &squot;barrier()&squot; calls: gcc may not move a lock&n; * &quot;downwards&quot; or a unlock &quot;upwards&quot; when optimizing.&n; */
r_extern
r_void
id|__release_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|function|lock_sock
r_static
r_inline
r_void
id|lock_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
macro_line|#if 0
multiline_comment|/* debugging code: the test isn&squot;t even 100% correct, but it can catch bugs */
multiline_comment|/* Note that a double lock is ok in theory - it&squot;s just _usually_ a bug */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sock_readers
)paren
)paren
(brace
id|__label__
id|here
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;double lock on socket at %p&bslash;n&quot;
comma
op_logical_and
id|here
)paren
suffix:semicolon
id|here
suffix:colon
)brace
macro_line|#endif
id|atomic_inc
c_func
(paren
op_amp
id|sk-&gt;sock_readers
)paren
suffix:semicolon
id|synchronize_bh
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|release_sock
r_static
r_inline
r_void
id|release_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|sk-&gt;sock_readers
)paren
)paren
id|__release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This might not be the most appropriate place for this two&t; &n; *&t;but since they are used by a lot of the net related code&n; *&t;at least they get declared on a include that is common to all&n; */
DECL|function|min
r_static
id|__inline__
r_int
id|min
c_func
(paren
r_int
r_int
id|a
comma
r_int
r_int
id|b
)paren
(brace
r_if
c_cond
(paren
id|a
OG
id|b
)paren
id|a
op_assign
id|b
suffix:semicolon
r_return
id|a
suffix:semicolon
)brace
DECL|function|max
r_static
id|__inline__
r_int
id|max
c_func
(paren
r_int
r_int
id|a
comma
r_int
r_int
id|b
)paren
(brace
r_if
c_cond
(paren
id|a
OL
id|b
)paren
id|a
op_assign
id|b
suffix:semicolon
r_return
id|a
suffix:semicolon
)brace
r_extern
r_struct
id|sock
op_star
id|sk_alloc
c_func
(paren
r_int
id|family
comma
r_int
id|priority
comma
r_int
id|zero_it
)paren
suffix:semicolon
r_extern
r_void
id|sk_free
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
r_extern
r_void
id|destroy_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
r_extern
r_struct
id|sk_buff
op_star
id|sock_wmalloc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|size
comma
r_int
id|force
comma
r_int
id|priority
)paren
suffix:semicolon
r_extern
r_struct
id|sk_buff
op_star
id|sock_rmalloc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|size
comma
r_int
id|force
comma
r_int
id|priority
)paren
suffix:semicolon
r_extern
r_void
id|sock_wfree
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_extern
r_void
id|sock_rfree
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_extern
r_int
r_int
id|sock_rspace
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
r_extern
r_int
r_int
id|sock_wspace
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
r_extern
r_int
id|sock_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|op
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
suffix:semicolon
r_extern
r_int
id|sock_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|op
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
suffix:semicolon
r_extern
r_struct
id|sk_buff
op_star
id|sock_alloc_send_skb
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|size
comma
r_int
r_int
id|fallback
comma
r_int
id|noblock
comma
r_int
op_star
id|errcode
)paren
suffix:semicolon
r_extern
r_void
op_star
id|sock_kmalloc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|size
comma
r_int
id|priority
)paren
suffix:semicolon
r_extern
r_void
id|sock_kfree_s
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_void
op_star
id|mem
comma
r_int
id|size
)paren
suffix:semicolon
multiline_comment|/*&n; * Functions to fill in entries in struct proto_ops when a protocol&n; * does not implement a particular function.&n; */
r_extern
r_int
id|sock_no_dup
c_func
(paren
r_struct
id|socket
op_star
comma
r_struct
id|socket
op_star
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_release
c_func
(paren
r_struct
id|socket
op_star
comma
r_struct
id|socket
op_star
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_bind
c_func
(paren
r_struct
id|socket
op_star
comma
r_struct
id|sockaddr
op_star
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_connect
c_func
(paren
r_struct
id|socket
op_star
comma
r_struct
id|sockaddr
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_socketpair
c_func
(paren
r_struct
id|socket
op_star
comma
r_struct
id|socket
op_star
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_accept
c_func
(paren
r_struct
id|socket
op_star
comma
r_struct
id|socket
op_star
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_getname
c_func
(paren
r_struct
id|socket
op_star
comma
r_struct
id|sockaddr
op_star
comma
r_int
op_star
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
r_int
id|sock_no_poll
c_func
(paren
r_struct
id|file
op_star
comma
r_struct
id|socket
op_star
comma
r_struct
id|poll_table_struct
op_star
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_ioctl
c_func
(paren
r_struct
id|socket
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_listen
c_func
(paren
r_struct
id|socket
op_star
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_shutdown
c_func
(paren
r_struct
id|socket
op_star
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_getsockopt
c_func
(paren
r_struct
id|socket
op_star
comma
r_int
comma
r_int
comma
r_char
op_star
comma
r_int
op_star
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_setsockopt
c_func
(paren
r_struct
id|socket
op_star
comma
r_int
comma
r_int
comma
r_char
op_star
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_fcntl
c_func
(paren
r_struct
id|socket
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_sendmsg
c_func
(paren
r_struct
id|socket
op_star
comma
r_struct
id|msghdr
op_star
comma
r_int
comma
r_struct
id|scm_cookie
op_star
)paren
suffix:semicolon
r_extern
r_int
id|sock_no_recvmsg
c_func
(paren
r_struct
id|socket
op_star
comma
r_struct
id|msghdr
op_star
comma
r_int
comma
r_struct
id|scm_cookie
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Default socket callbacks and setup code&n; */
r_extern
r_void
id|sock_def_callback1
c_func
(paren
r_struct
id|sock
op_star
)paren
suffix:semicolon
r_extern
r_void
id|sock_def_callback2
c_func
(paren
r_struct
id|sock
op_star
comma
r_int
)paren
suffix:semicolon
r_extern
r_void
id|sock_def_callback3
c_func
(paren
r_struct
id|sock
op_star
)paren
suffix:semicolon
r_extern
r_void
id|sock_def_destruct
c_func
(paren
r_struct
id|sock
op_star
)paren
suffix:semicolon
multiline_comment|/* Initialise core socket variables */
r_extern
r_void
id|sock_init_data
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
r_extern
r_void
id|sklist_remove_socket
c_func
(paren
r_struct
id|sock
op_star
op_star
id|list
comma
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
r_extern
r_void
id|sklist_insert_socket
c_func
(paren
r_struct
id|sock
op_star
op_star
id|list
comma
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
r_extern
r_void
id|sklist_destroy_socket
c_func
(paren
r_struct
id|sock
op_star
op_star
id|list
comma
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FILTER
multiline_comment|/*&n; * Run the filter code and then cut skb-&gt;data to correct size returned by&n; * sk_run_filter. If pkt_len is 0 we toss packet. If skb-&gt;len is smaller&n; * than pkt_len we keep whole skb-&gt;data.&n; */
DECL|function|sk_filter
r_extern
id|__inline__
r_int
id|sk_filter
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sock_filter
op_star
id|filter
comma
r_int
id|flen
)paren
(brace
r_int
id|pkt_len
suffix:semicolon
id|pkt_len
op_assign
id|sk_run_filter
c_func
(paren
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|filter
comma
id|flen
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pkt_len
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Toss Packet */
r_else
id|skb_trim
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FILTER */
multiline_comment|/*&n; * &t;Queue a received datagram if it will fit. Stream and sequenced&n; *&t;protocols can&squot;t normally use this as they need to fit buffers in&n; *&t;and play with them.&n; *&n; * &t;Inlined as it&squot;s very short and called for pretty much every&n; *&t;packet ever received.&n; */
DECL|function|skb_set_owner_w
r_extern
id|__inline__
r_void
id|skb_set_owner_w
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|skb-&gt;sk
op_assign
id|sk
suffix:semicolon
id|skb-&gt;destructor
op_assign
id|sock_wfree
suffix:semicolon
id|atomic_add
c_func
(paren
id|skb-&gt;truesize
comma
op_amp
id|sk-&gt;wmem_alloc
)paren
suffix:semicolon
)brace
DECL|function|skb_set_owner_r
r_extern
id|__inline__
r_void
id|skb_set_owner_r
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|skb-&gt;sk
op_assign
id|sk
suffix:semicolon
id|skb-&gt;destructor
op_assign
id|sock_rfree
suffix:semicolon
id|atomic_add
c_func
(paren
id|skb-&gt;truesize
comma
op_amp
id|sk-&gt;rmem_alloc
)paren
suffix:semicolon
)brace
DECL|function|sock_queue_rcv_skb
r_extern
id|__inline__
r_int
id|sock_queue_rcv_skb
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/* Cast skb-&gt;rcvbuf to unsigned... It&squot;s pointless, but reduces&n;&t;   number of warnings when compiling with -W --ANK&n;&t; */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_plus
id|skb-&gt;truesize
op_ge
(paren
r_int
)paren
id|sk-&gt;rcvbuf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
macro_line|#ifdef CONFIG_FILTER
r_if
c_cond
(paren
id|sk-&gt;filter
)paren
(brace
r_if
c_cond
(paren
id|sk_filter
c_func
(paren
id|skb
comma
id|sk-&gt;filter_data
comma
id|sk-&gt;filter
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
multiline_comment|/* Toss packet */
)brace
macro_line|#endif /* CONFIG_FILTER */
id|skb_set_owner_r
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;receive_queue
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sock_queue_err_skb
r_extern
id|__inline__
r_int
id|sock_queue_err_skb
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/* Cast skb-&gt;rcvbuf to unsigned... It&squot;s pointless, but reduces&n;&t;   number of warnings when compiling with -W --ANK&n;&t; */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_plus
id|skb-&gt;truesize
op_ge
(paren
r_int
)paren
id|sk-&gt;rcvbuf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|skb_set_owner_r
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;error_queue
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Recover an error report and clear atomically&n; */
DECL|function|sock_error
r_extern
id|__inline__
r_int
id|sock_error
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
id|err
op_assign
id|xchg
c_func
(paren
op_amp
id|sk-&gt;err
comma
l_int|0
)paren
suffix:semicolon
r_return
op_minus
id|err
suffix:semicolon
)brace
DECL|function|sock_wspace
r_extern
id|__inline__
r_int
r_int
id|sock_wspace
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
id|amt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sk-&gt;shutdown
op_amp
id|SEND_SHUTDOWN
)paren
)paren
(brace
id|amt
op_assign
id|sk-&gt;sndbuf
op_minus
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amt
OL
l_int|0
)paren
id|amt
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|amt
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Default write policy as shown to user space via poll/select/SIGIO&n; *&t;Kernel internally doesn&squot;t use the MIN_WRITE_SPACE threshold.&n; */
DECL|function|sock_writeable
r_extern
id|__inline__
r_int
id|sock_writeable
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_return
id|sock_wspace
c_func
(paren
id|sk
)paren
op_ge
id|MIN_WRITE_SPACE
suffix:semicolon
)brace
multiline_comment|/* &n; *&t;Declarations from timer.c &n; */
r_extern
r_struct
id|sock
op_star
id|timer_base
suffix:semicolon
r_extern
r_void
id|net_delete_timer
(paren
r_struct
id|sock
op_star
)paren
suffix:semicolon
r_extern
r_void
id|net_reset_timer
(paren
r_struct
id|sock
op_star
comma
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|net_timer
(paren
r_int
r_int
)paren
suffix:semicolon
multiline_comment|/* &n; *&t;Enable debug/info messages &n; */
macro_line|#if 0
mdefine_line|#define NETDEBUG(x)&t;do { } while (0)
macro_line|#else
DECL|macro|NETDEBUG
mdefine_line|#define NETDEBUG(x)&t;do { x; } while (0)
macro_line|#endif
macro_line|#endif&t;/* _SOCK_H */
eof
