macro_line|#ifndef __PPC_SYSTEM_H
DECL|macro|__PPC_SYSTEM_H
mdefine_line|#define __PPC_SYSTEM_H
macro_line|#include &lt;linux/delay.h&gt;
DECL|macro|mb
mdefine_line|#define mb()  __asm__ __volatile__ (&quot;sync&quot; : : : &quot;memory&quot;)
DECL|macro|__save_flags
mdefine_line|#define __save_flags(flags)&t;({&bslash;&n;&t;__asm__ __volatile__ (&quot;mfmsr %0&quot; : &quot;=r&quot; ((flags)) : : &quot;memory&quot;); })
multiline_comment|/* using Paul&squot;s in misc.S now -- Cort */
r_extern
r_void
id|__restore_flags
c_func
(paren
r_int
r_int
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;  #define __sti() _soft_sti(void)&n;  #define __cli() _soft_cli(void)&n; */
r_extern
r_void
id|__sti
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|__cli
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|_hard_sti
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|_hard_cli
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|_soft_sti
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|_soft_cli
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|_disable_interrupts
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|_enable_interrupts
c_func
(paren
r_int
)paren
suffix:semicolon
r_extern
r_void
id|flush_instruction_cache
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|hard_reset_now
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|poweroff_now
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|find_scsi_boot
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|sd_find_target
c_func
(paren
r_void
op_star
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|_get_PVR
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|via_cuda_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|read_rtc_time
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|pmac_find_display
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|giveup_fpu
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|store_cache_range
c_func
(paren
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|cvt_fd
c_func
(paren
r_float
op_star
id|from
comma
r_float
op_star
id|to
)paren
suffix:semicolon
r_extern
r_void
id|cvt_df
c_func
(paren
r_float
op_star
id|from
comma
r_float
op_star
id|to
)paren
suffix:semicolon
r_struct
id|device_node
suffix:semicolon
r_extern
r_void
id|note_scsi_host
c_func
(paren
r_struct
id|device_node
op_star
comma
r_void
op_star
)paren
suffix:semicolon
r_struct
id|task_struct
suffix:semicolon
r_extern
r_void
id|switch_to
c_func
(paren
r_struct
id|task_struct
op_star
id|prev
comma
r_struct
id|task_struct
op_star
id|next
)paren
suffix:semicolon
r_struct
id|thread_struct
suffix:semicolon
r_extern
r_void
id|_switch
c_func
(paren
r_struct
id|thread_struct
op_star
id|prev
comma
r_struct
id|thread_struct
op_star
id|next
comma
r_int
r_int
id|context
)paren
suffix:semicolon
r_struct
id|pt_regs
suffix:semicolon
r_extern
r_int
id|do_signal
c_func
(paren
r_int
r_int
id|oldmask
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_extern
r_void
id|dump_regs
c_func
(paren
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
DECL|macro|cli
mdefine_line|#define cli()&t;__cli()
DECL|macro|sti
mdefine_line|#define sti()&t;__sti()
DECL|macro|save_flags
mdefine_line|#define save_flags(flags)&t;__save_flags(flags)
DECL|macro|restore_flags
mdefine_line|#define restore_flags(flags)&t;__restore_flags(flags)
macro_line|#else
macro_line|#error need global cli/sti etc. defined for SMP
macro_line|#endif
DECL|macro|xchg
mdefine_line|#define xchg(ptr,x) ((__typeof__(*(ptr)))__xchg((unsigned long)(x),(ptr),sizeof(*(ptr))))
multiline_comment|/* this guy lives in arch/ppc/kernel */
r_extern
r_inline
r_int
r_int
op_star
id|xchg_u32
c_func
(paren
r_void
op_star
id|m
comma
r_int
r_int
id|val
)paren
suffix:semicolon
multiline_comment|/*&n; *  these guys don&squot;t exist.&n; *  someone should create them.&n; *              -- Cort&n; */
r_extern
r_void
op_star
id|xchg_u64
c_func
(paren
r_void
op_star
id|ptr
comma
r_int
r_int
id|val
)paren
suffix:semicolon
r_extern
r_int
id|xchg_u8
c_func
(paren
r_char
op_star
id|m
comma
r_char
id|val
)paren
suffix:semicolon
multiline_comment|/*&n; * This function doesn&squot;t exist, so you&squot;ll get a linker error&n; * if something tries to do an invalid xchg().&n; *&n; * This only works if the compiler isn&squot;t horribly bad at optimizing.&n; * gcc-2.5.8 reportedly can&squot;t handle this, but as that doesn&squot;t work&n; * too well on the alpha anyway..&n; */
r_extern
r_void
id|__xchg_called_with_bad_pointer
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|__xchg
r_static
r_inline
r_int
r_int
id|__xchg
c_func
(paren
r_int
r_int
id|x
comma
r_void
op_star
id|ptr
comma
r_int
id|size
)paren
(brace
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
l_int|4
suffix:colon
r_return
(paren
r_int
r_int
)paren
id|xchg_u32
c_func
(paren
id|ptr
comma
id|x
)paren
suffix:semicolon
r_case
l_int|8
suffix:colon
r_return
(paren
r_int
r_int
)paren
id|xchg_u64
c_func
(paren
id|ptr
comma
id|x
)paren
suffix:semicolon
)brace
id|__xchg_called_with_bad_pointer
c_func
(paren
)paren
suffix:semicolon
r_return
id|x
suffix:semicolon
)brace
DECL|function|tas
r_extern
r_inline
r_int
id|tas
c_func
(paren
r_char
op_star
id|m
)paren
(brace
r_return
id|xchg_u8
c_func
(paren
id|m
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|xchg_ptr
r_extern
r_inline
r_void
op_star
id|xchg_ptr
c_func
(paren
r_void
op_star
id|m
comma
r_void
op_star
id|val
)paren
(brace
r_return
(paren
r_void
op_star
)paren
id|xchg_u32
c_func
(paren
id|m
comma
(paren
r_int
r_int
)paren
id|val
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
