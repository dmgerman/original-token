macro_line|#ifndef _PPC_PTRACE_H
DECL|macro|_PPC_PTRACE_H
mdefine_line|#define _PPC_PTRACE_H
multiline_comment|/*&n; * This struct defines the way the registers are stored on the&n; * kernel stack during a system call or other kernel entry.&n; * Note: the &quot;_overhead&quot; and &quot;_underhead&quot; spaces are stack locations&n; * used by called routines.  Because of the way the PowerPC ABI&n; * specifies the function prologue/epilogue, registers can be&n; * saved in stack locations which are below the current stack&n; * pointer (_underhead).  If an interrupt occurs during this&n; * [albeit] small time interval, registers which were saved on&n; * the stack could be trashed by the interrupt save code.  The&n; * &quot;_underhead&quot; leaves a hole just in case this happens.  It also&n; * wastes 80 bytes of stack if it doesn&squot;t!  Similarly, the called&n; * routine stores some information &quot;above&quot; the stack pointer before&n; * if gets adjusted.  This is covered by the &quot;_overhead&quot; field&n; * and [thankfully] is not totally wasted.&n; *&n; */
DECL|struct|pt_regs
r_struct
id|pt_regs
(brace
DECL|member|_overhead
r_int
r_int
id|_overhead
(braket
l_int|14
)braket
suffix:semicolon
multiline_comment|/* Callee&squot;s SP,LR,params */
DECL|member|gpr
r_int
r_int
id|gpr
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|nip
r_int
r_int
id|nip
suffix:semicolon
DECL|member|msr
r_int
r_int
id|msr
suffix:semicolon
DECL|member|ctr
r_int
r_int
id|ctr
suffix:semicolon
DECL|member|link
r_int
r_int
id|link
suffix:semicolon
DECL|member|ccr
r_int
r_int
id|ccr
suffix:semicolon
DECL|member|xer
r_int
r_int
id|xer
suffix:semicolon
DECL|member|dar
r_int
r_int
id|dar
suffix:semicolon
multiline_comment|/* Fault registers */
DECL|member|dsisr
r_int
r_int
id|dsisr
suffix:semicolon
DECL|member|hash1
DECL|member|hash2
r_int
r_int
id|hash1
comma
id|hash2
suffix:semicolon
DECL|member|imiss
DECL|member|dmiss
r_int
r_int
id|imiss
comma
id|dmiss
suffix:semicolon
DECL|member|icmp
DECL|member|dcmp
r_int
r_int
id|icmp
comma
id|dcmp
suffix:semicolon
DECL|member|orig_gpr3
r_int
r_int
id|orig_gpr3
suffix:semicolon
multiline_comment|/* Used for restarting system calls */
DECL|member|result
r_int
r_int
id|result
suffix:semicolon
multiline_comment|/* Result of a system call */
DECL|member|fpr
r_float
id|fpr
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* Caution! Only FP0-FP3 save on interrupts */
DECL|member|fpcsr
r_float
id|fpcsr
suffix:semicolon
DECL|member|trap
r_int
r_int
id|trap
suffix:semicolon
multiline_comment|/* Reason for being here */
DECL|member|marker
r_int
r_int
id|marker
suffix:semicolon
multiline_comment|/* Should have DEADDEAD */
DECL|member|_underhead
r_int
r_int
id|_underhead
(braket
l_int|20
)braket
suffix:semicolon
multiline_comment|/* Callee&squot;s register save area */
DECL|member|edx
r_int
r_int
id|edx
suffix:semicolon
multiline_comment|/* for binfmt_elf.c which wants edx */
)brace
suffix:semicolon
DECL|macro|instruction_pointer
mdefine_line|#define instruction_pointer(regs) ((regs)-&gt;nip)
DECL|macro|user_mode
mdefine_line|#define user_mode(regs) ((regs)-&gt;msr &amp; 0x4000)
r_extern
r_void
id|show_regs
c_func
(paren
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
macro_line|#endif
eof
