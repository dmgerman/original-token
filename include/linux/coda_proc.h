multiline_comment|/*&n; * coda_statis.h&n; * &n; * CODA operation statistics&n; *&n; * (c) March, 1998&n; * by Michihiro Kuramochi, Zhenyu Xia and Zhanyong Wan&n; * zhanyong.wan@yale.edu&n; *&n; */
macro_line|#ifndef _CODA_PROC_H
DECL|macro|_CODA_PROC_H
mdefine_line|#define _CODA_PROC_H
r_void
id|coda_sysctl_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|coda_sysctl_clean
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|coda_upcall_stats
c_func
(paren
r_int
id|opcode
comma
r_int
r_int
id|jiffies
)paren
suffix:semicolon
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#include &lt;linux/coda_fs_i.h&gt;
macro_line|#include &lt;linux/coda.h&gt;
multiline_comment|/* these four files are presented to show the result of the statistics:&n; *&n; *&t;/proc/fs/coda/vfs_stats&n; *&t;&t;      upcall_stats&n; *&t;&t;      permission_stats&n; *&t;&t;      cache_inv_stats&n; *&n; * these four files are presented to reset the statistics to 0:&n; *&n; *&t;/proc/sys/coda/vfs_stats&n; *&t;&t;       upcall_stats&n; *&t;&t;       permission_stats&n; *&t;&t;       cache_inv_stats&n; */
multiline_comment|/* VFS operation statistics */
DECL|struct|coda_vfs_stats
r_struct
id|coda_vfs_stats
(brace
multiline_comment|/* file operations */
DECL|member|open
r_int
id|open
suffix:semicolon
DECL|member|release
r_int
id|release
suffix:semicolon
DECL|member|fsync
r_int
id|fsync
suffix:semicolon
multiline_comment|/* dir operations */
DECL|member|readdir
r_int
id|readdir
suffix:semicolon
multiline_comment|/* inode operations */
DECL|member|create
r_int
id|create
suffix:semicolon
DECL|member|lookup
r_int
id|lookup
suffix:semicolon
DECL|member|link
r_int
id|link
suffix:semicolon
DECL|member|unlink
r_int
id|unlink
suffix:semicolon
DECL|member|symlink
r_int
id|symlink
suffix:semicolon
DECL|member|mkdir
r_int
id|mkdir
suffix:semicolon
DECL|member|rmdir
r_int
id|rmdir
suffix:semicolon
DECL|member|rename
r_int
id|rename
suffix:semicolon
DECL|member|permission
r_int
id|permission
suffix:semicolon
multiline_comment|/* symlink operatoins*/
DECL|member|follow_link
r_int
id|follow_link
suffix:semicolon
DECL|member|readlink
r_int
id|readlink
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|coda_upcall_stats_entry
r_struct
id|coda_upcall_stats_entry
(brace
DECL|member|count
r_int
id|count
suffix:semicolon
DECL|member|time_sum
r_int
r_int
id|time_sum
suffix:semicolon
DECL|member|time_squared_sum
r_int
r_int
id|time_squared_sum
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* cache hits for permissions statistics */
DECL|struct|coda_permission_stats
r_struct
id|coda_permission_stats
(brace
DECL|member|count
r_int
id|count
suffix:semicolon
DECL|member|hit_count
r_int
id|hit_count
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* cache invalidation statistics */
DECL|struct|coda_cache_inv_stats
r_struct
id|coda_cache_inv_stats
(brace
DECL|member|flush
r_int
id|flush
suffix:semicolon
DECL|member|purge_user
r_int
id|purge_user
suffix:semicolon
DECL|member|zap_dir
r_int
id|zap_dir
suffix:semicolon
DECL|member|zap_file
r_int
id|zap_file
suffix:semicolon
DECL|member|zap_vnode
r_int
id|zap_vnode
suffix:semicolon
DECL|member|purge_fid
r_int
id|purge_fid
suffix:semicolon
DECL|member|replace
r_int
id|replace
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* these global variables hold the actual statistics data */
r_extern
r_struct
id|coda_vfs_stats
id|coda_vfs_stat
suffix:semicolon
r_extern
r_struct
id|coda_permission_stats
id|coda_permission_stat
suffix:semicolon
r_extern
r_struct
id|coda_cache_inv_stats
id|coda_cache_inv_stat
suffix:semicolon
r_extern
r_int
id|coda_upcall_timestamping
suffix:semicolon
multiline_comment|/* reset statistics to 0 */
r_void
id|reset_coda_vfs_stats
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|reset_coda_upcall_stats
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|reset_coda_permission_stats
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|reset_coda_cache_inv_stats
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* some utitlities to make it easier for you to do statistics for time */
r_void
id|do_time_stats
c_func
(paren
r_struct
id|coda_upcall_stats_entry
op_star
id|pentry
comma
r_int
r_int
id|jiffy
)paren
suffix:semicolon
multiline_comment|/*&n;double get_time_average( const struct coda_upcall_stats_entry * pentry );&n;double get_time_std_deviation( const struct coda_upcall_stats_entry * pentry );&n;*/
r_int
r_int
id|get_time_average
c_func
(paren
r_const
r_struct
id|coda_upcall_stats_entry
op_star
id|pentry
)paren
suffix:semicolon
r_int
r_int
id|get_time_std_deviation
c_func
(paren
r_const
r_struct
id|coda_upcall_stats_entry
op_star
id|pentry
)paren
suffix:semicolon
multiline_comment|/* like coda_dointvec, these functions are to be registered in the ctl_table&n; * data structure for /proc/sys/... files &n; */
r_int
id|do_reset_coda_vfs_stats
c_func
(paren
id|ctl_table
op_star
id|table
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|lenp
)paren
suffix:semicolon
r_int
id|do_reset_coda_upcall_stats
c_func
(paren
id|ctl_table
op_star
id|table
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|lenp
)paren
suffix:semicolon
r_int
id|do_reset_coda_permission_stats
c_func
(paren
id|ctl_table
op_star
id|table
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|lenp
)paren
suffix:semicolon
r_int
id|do_reset_coda_cache_inv_stats
c_func
(paren
id|ctl_table
op_star
id|table
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|lenp
)paren
suffix:semicolon
multiline_comment|/* these functions are called to form the content of /proc/fs/coda/... files */
r_int
id|coda_vfs_stats_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
suffix:semicolon
r_int
id|coda_upcall_stats_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
suffix:semicolon
r_int
id|coda_permission_stats_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
suffix:semicolon
r_int
id|coda_cache_inv_stats_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
suffix:semicolon
macro_line|#endif /* _CODA_PROC_H */
eof
