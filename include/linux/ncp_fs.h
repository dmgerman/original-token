multiline_comment|/*&n; *  ncp_fs.h&n; *&n; *  Copyright (C) 1995, 1996 by Volker Lendecke&n; *&n; */
macro_line|#ifndef _LINUX_NCP_FS_H
DECL|macro|_LINUX_NCP_FS_H
mdefine_line|#define _LINUX_NCP_FS_H
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/ncp_mount.h&gt;
macro_line|#include &lt;linux/ncp_fs_sb.h&gt;
macro_line|#include &lt;linux/ncp_fs_i.h&gt;
multiline_comment|/*&n; * ioctl commands&n; */
DECL|struct|ncp_ioctl_request
r_struct
id|ncp_ioctl_request
(brace
DECL|member|function
r_int
r_int
id|function
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|data
r_char
op_star
id|data
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ncp_fs_info
r_struct
id|ncp_fs_info
(brace
DECL|member|version
r_int
id|version
suffix:semicolon
DECL|member|addr
r_struct
id|sockaddr_ipx
id|addr
suffix:semicolon
DECL|member|mounted_uid
id|uid_t
id|mounted_uid
suffix:semicolon
DECL|member|connection
r_int
id|connection
suffix:semicolon
multiline_comment|/* Connection number the server assigned us */
DECL|member|buffer_size
r_int
id|buffer_size
suffix:semicolon
multiline_comment|/* The negotiated buffer size, to be&n;&t;&t;&t;&t;   used for read/write requests! */
DECL|member|volume_number
r_int
id|volume_number
suffix:semicolon
DECL|member|directory_id
id|__u32
id|directory_id
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|NCP_IOC_NCPREQUEST
mdefine_line|#define&t;NCP_IOC_NCPREQUEST&t;&t;_IOR(&squot;n&squot;, 1, struct ncp_ioctl_request)
DECL|macro|NCP_IOC_GETMOUNTUID
mdefine_line|#define&t;NCP_IOC_GETMOUNTUID&t;&t;_IOW(&squot;n&squot;, 2, uid_t)
DECL|macro|NCP_IOC_CONN_LOGGED_IN
mdefine_line|#define NCP_IOC_CONN_LOGGED_IN          _IO(&squot;n&squot;, 3)
DECL|macro|NCP_GET_FS_INFO_VERSION
mdefine_line|#define NCP_GET_FS_INFO_VERSION (1)
DECL|macro|NCP_IOC_GET_FS_INFO
mdefine_line|#define NCP_IOC_GET_FS_INFO             _IOWR(&squot;n&squot;, 4, struct ncp_fs_info)
multiline_comment|/*&n; * The packet size to allocate. One page should be enough.&n; */
DECL|macro|NCP_PACKET_SIZE
mdefine_line|#define NCP_PACKET_SIZE 4070
DECL|macro|NCP_MAXPATHLEN
mdefine_line|#define NCP_MAXPATHLEN 255
DECL|macro|NCP_MAXNAMELEN
mdefine_line|#define NCP_MAXNAMELEN 14
macro_line|#ifdef __KERNEL__
DECL|macro|NCPFS_PARANOIA
macro_line|#undef NCPFS_PARANOIA
DECL|macro|DEBUG_NCP
mdefine_line|#define DEBUG_NCP 0
macro_line|#if DEBUG_NCP &gt; 0
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(format, args...) printk(format , ## args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(format, args...)
macro_line|#endif
macro_line|#if DEBUG_NCP &gt; 1
DECL|macro|DDPRINTK
mdefine_line|#define DDPRINTK(format, args...) printk(format , ## args)
macro_line|#else
DECL|macro|DDPRINTK
mdefine_line|#define DDPRINTK(format, args...)
macro_line|#endif
multiline_comment|/* The readdir cache size controls how many directory entries are&n; * cached.&n; */
DECL|macro|NCP_READDIR_CACHE_SIZE
mdefine_line|#define NCP_READDIR_CACHE_SIZE        64
DECL|macro|NCP_MAX_RPC_TIMEOUT
mdefine_line|#define NCP_MAX_RPC_TIMEOUT (6*HZ)
multiline_comment|/*&n; * This is the ncpfs part of the inode structure. This must contain&n; * all the information we need to work with an inode after creation.&n; * (Move to ncp_fs_i.h once it stabilizes, and add a union in fs.h)&n; */
DECL|struct|ncpfs_i
r_struct
id|ncpfs_i
(brace
DECL|member|dirEntNum
id|__u32
id|dirEntNum
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|member|DosDirNum
id|__u32
id|DosDirNum
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|member|volNumber
id|__u32
id|volNumber
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|member|opened
r_int
id|opened
suffix:semicolon
DECL|member|access
r_int
id|access
suffix:semicolon
DECL|member|server_file_handle
id|__u32
id|server_file_handle
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|member|open_create_action
id|__u8
id|open_create_action
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|member|file_handle
id|__u8
id|file_handle
(braket
l_int|6
)braket
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * This is an extension of the nw_file_info structure with&n; * the additional information we need to create an inode.&n; */
DECL|struct|ncpfs_inode_info
r_struct
id|ncpfs_inode_info
(brace
DECL|member|ino
id|ino_t
id|ino
suffix:semicolon
multiline_comment|/* dummy inode number */
DECL|member|nw_info
r_struct
id|nw_file_info
id|nw_info
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Guess, what 0x564c is :-) */
DECL|macro|NCP_SUPER_MAGIC
mdefine_line|#define NCP_SUPER_MAGIC  0x564c
DECL|macro|NCP_SBP
mdefine_line|#define NCP_SBP(sb)          ((struct ncp_server *)((sb)-&gt;u.generic_sbp))
DECL|macro|NCP_SERVER
mdefine_line|#define NCP_SERVER(inode)    NCP_SBP((inode)-&gt;i_sb)
multiline_comment|/* We don&squot;t have an ncpfs union yet, so use smbfs ... */
DECL|macro|NCP_FINFO
mdefine_line|#define NCP_FINFO(inode)     ((struct ncpfs_i *)&amp;((inode)-&gt;u.smbfs_i))
macro_line|#ifdef DEBUG_NCP_MALLOC
macro_line|#include &lt;linux/malloc.h&gt;
r_extern
r_int
id|ncp_malloced
suffix:semicolon
r_extern
r_int
id|ncp_current_malloced
suffix:semicolon
r_static
r_inline
r_void
op_star
DECL|function|ncp_kmalloc
id|ncp_kmalloc
c_func
(paren
r_int
r_int
id|size
comma
r_int
id|priority
)paren
(brace
id|ncp_malloced
op_add_assign
l_int|1
suffix:semicolon
id|ncp_current_malloced
op_add_assign
l_int|1
suffix:semicolon
r_return
id|kmalloc
c_func
(paren
id|size
comma
id|priority
)paren
suffix:semicolon
)brace
DECL|function|ncp_kfree_s
r_static
r_inline
r_void
id|ncp_kfree_s
c_func
(paren
r_void
op_star
id|obj
comma
r_int
id|size
)paren
(brace
id|ncp_current_malloced
op_sub_assign
l_int|1
suffix:semicolon
id|kfree_s
c_func
(paren
id|obj
comma
id|size
)paren
suffix:semicolon
)brace
macro_line|#else&t;&t;&t;&t;/* DEBUG_NCP_MALLOC */
DECL|macro|ncp_kmalloc
mdefine_line|#define ncp_kmalloc(s,p) kmalloc(s,p)
DECL|macro|ncp_kfree_s
mdefine_line|#define ncp_kfree_s(o,s) kfree_s(o,s)
macro_line|#endif&t;&t;&t;&t;/* DEBUG_NCP_MALLOC */
multiline_comment|/* linux/fs/ncpfs/inode.c */
r_struct
id|super_block
op_star
id|ncp_read_super
c_func
(paren
r_struct
id|super_block
op_star
comma
r_void
op_star
comma
r_int
)paren
suffix:semicolon
r_struct
id|inode
op_star
id|ncp_iget
c_func
(paren
r_struct
id|super_block
op_star
comma
r_struct
id|ncpfs_inode_info
op_star
)paren
suffix:semicolon
r_void
id|ncp_update_inode
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|nw_file_info
op_star
)paren
suffix:semicolon
r_extern
r_int
id|init_ncp_fs
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* linux/fs/ncpfs/dir.c */
r_extern
r_struct
id|inode_operations
id|ncp_dir_inode_operations
suffix:semicolon
r_int
id|ncp_conn_logged_in
c_func
(paren
r_struct
id|ncp_server
op_star
)paren
suffix:semicolon
r_void
id|ncp_init_dir_cache
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|ncp_invalid_dir_cache
c_func
(paren
r_struct
id|inode
op_star
)paren
suffix:semicolon
r_void
id|ncp_free_dir_cache
c_func
(paren
r_void
)paren
suffix:semicolon
r_int
id|ncp_date_dos2unix
c_func
(paren
id|__u16
id|time
comma
id|__u16
id|date
)paren
suffix:semicolon
r_void
id|ncp_date_unix2dos
c_func
(paren
r_int
id|unix_date
comma
id|__u16
op_star
id|time
comma
id|__u16
op_star
id|date
)paren
suffix:semicolon
multiline_comment|/* linux/fs/ncpfs/ioctl.c */
r_int
id|ncp_ioctl
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
multiline_comment|/* linux/fs/ncpfs/sock.c */
r_int
id|ncp_request
c_func
(paren
r_struct
id|ncp_server
op_star
id|server
comma
r_int
id|function
)paren
suffix:semicolon
r_int
id|ncp_connect
c_func
(paren
r_struct
id|ncp_server
op_star
id|server
)paren
suffix:semicolon
r_int
id|ncp_disconnect
c_func
(paren
r_struct
id|ncp_server
op_star
id|server
)paren
suffix:semicolon
r_void
id|ncp_lock_server
c_func
(paren
r_struct
id|ncp_server
op_star
id|server
)paren
suffix:semicolon
r_void
id|ncp_unlock_server
c_func
(paren
r_struct
id|ncp_server
op_star
id|server
)paren
suffix:semicolon
multiline_comment|/* linux/fs/ncpfs/file.c */
r_extern
r_struct
id|inode_operations
id|ncp_file_inode_operations
suffix:semicolon
r_int
id|ncp_make_open
c_func
(paren
r_struct
id|inode
op_star
comma
r_int
)paren
suffix:semicolon
multiline_comment|/* linux/fs/ncpfs/mmap.c */
r_int
id|ncp_mmap
c_func
(paren
r_struct
id|file
op_star
comma
r_struct
id|vm_area_struct
op_star
)paren
suffix:semicolon
multiline_comment|/* linux/fs/ncpfs/ncplib_kernel.c */
r_int
id|ncp_make_closed
c_func
(paren
r_struct
id|inode
op_star
)paren
suffix:semicolon
DECL|function|str_upper
r_static
r_inline
r_void
id|str_upper
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_while
c_loop
(paren
op_star
id|name
)paren
(brace
r_if
c_cond
(paren
op_star
id|name
op_ge
l_char|&squot;a&squot;
op_logical_and
op_star
id|name
op_le
l_char|&squot;z&squot;
)paren
(brace
op_star
id|name
op_sub_assign
(paren
l_char|&squot;a&squot;
op_minus
l_char|&squot;A&squot;
)paren
suffix:semicolon
)brace
id|name
op_increment
suffix:semicolon
)brace
)brace
DECL|function|str_lower
r_static
r_inline
r_void
id|str_lower
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_while
c_loop
(paren
op_star
id|name
)paren
(brace
r_if
c_cond
(paren
op_star
id|name
op_ge
l_char|&squot;A&squot;
op_logical_and
op_star
id|name
op_le
l_char|&squot;Z&squot;
)paren
(brace
op_star
id|name
op_add_assign
(paren
l_char|&squot;a&squot;
op_minus
l_char|&squot;A&squot;
)paren
suffix:semicolon
)brace
id|name
op_increment
suffix:semicolon
)brace
)brace
DECL|function|ncp_namespace
r_static
r_inline
r_int
id|ncp_namespace
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_struct
id|ncp_server
op_star
id|server
op_assign
id|NCP_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
id|server-&gt;name_space
(braket
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|volNumber
)braket
suffix:semicolon
)brace
DECL|function|ncp_preserve_case
r_static
r_inline
r_int
id|ncp_preserve_case
c_func
(paren
r_struct
id|inode
op_star
id|i
)paren
(brace
multiline_comment|/* If we can get case-sensitive server lookups working, then&n;&t; *&n;&t; *  return (ncp_namespace(i) == NW_NS_OS2);&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;&t;/* __KERNEL__ */
macro_line|#endif&t;&t;&t;&t;/* _LINUX_NCP_FS_H */
eof
