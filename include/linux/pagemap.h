macro_line|#ifndef _LINUX_PAGEMAP_H
DECL|macro|_LINUX_PAGEMAP_H
mdefine_line|#define _LINUX_PAGEMAP_H
macro_line|#include &lt;asm/system.h&gt;
multiline_comment|/*&n; * Page-mapping primitive inline functions&n; *&n; * Copyright 1995 Linus Torvalds&n; */
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
DECL|function|page_address
r_static
r_inline
r_int
r_int
id|page_address
c_func
(paren
r_struct
id|page
op_star
id|page
)paren
(brace
r_return
id|PAGE_OFFSET
op_plus
(paren
(paren
id|page
op_minus
id|mem_map
)paren
op_lshift
id|PAGE_SHIFT
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * The page cache can done in larger chunks than&n; * one page, because it allows for more efficient&n; * throughput (it can then be mapped into user&n; * space in smaller chunks for same flexibility).&n; *&n; * Or rather, it _will_ be done in larger chunks.&n; */
DECL|macro|PAGE_CACHE_SHIFT
mdefine_line|#define PAGE_CACHE_SHIFT&t;PAGE_SHIFT
DECL|macro|PAGE_CACHE_SIZE
mdefine_line|#define PAGE_CACHE_SIZE&t;&t;PAGE_SIZE
DECL|macro|PAGE_CACHE_MASK
mdefine_line|#define PAGE_CACHE_MASK&t;&t;PAGE_MASK
DECL|macro|PAGE_CACHE_ALIGN
mdefine_line|#define PAGE_CACHE_ALIGN(addr)&t;(((addr)+PAGE_CACHE_SIZE-1)&amp;PAGE_CACHE_MASK)
DECL|macro|page_cache_alloc
mdefine_line|#define page_cache_alloc()&t;__get_free_page(GFP_USER)
DECL|macro|page_cache_free
mdefine_line|#define page_cache_free(x)&t;free_page(x)
DECL|macro|page_cache_release
mdefine_line|#define page_cache_release(x)&t;__free_page(x)
multiline_comment|/*&n; * From a kernel address, get the &quot;struct page *&quot;&n; */
DECL|macro|page_cache_entry
mdefine_line|#define page_cache_entry(x)&t;(mem_map + MAP_NR(x))
DECL|macro|PAGE_HASH_BITS
mdefine_line|#define PAGE_HASH_BITS 16
DECL|macro|PAGE_HASH_SIZE
mdefine_line|#define PAGE_HASH_SIZE (1 &lt;&lt; PAGE_HASH_BITS)
r_extern
id|atomic_t
id|page_cache_size
suffix:semicolon
multiline_comment|/* # of pages currently in the hash table */
r_extern
r_struct
id|page
op_star
id|page_hash_table
(braket
id|PAGE_HASH_SIZE
)braket
suffix:semicolon
multiline_comment|/*&n; * We use a power-of-two hash table to avoid a modulus,&n; * and get a reasonable hash by knowing roughly how the&n; * inode pointer and offsets are distributed (ie, we&n; * roughly know which bits are &quot;significant&quot;)&n; */
DECL|function|_page_hashfn
r_static
r_inline
r_int
r_int
id|_page_hashfn
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
r_int
id|offset
)paren
(brace
DECL|macro|i
mdefine_line|#define i (((unsigned long) inode)/(sizeof(struct inode) &amp; ~ (sizeof(struct inode) - 1)))
DECL|macro|o
mdefine_line|#define o (offset &gt;&gt; PAGE_SHIFT)
DECL|macro|s
mdefine_line|#define s(x) ((x)+((x)&gt;&gt;PAGE_HASH_BITS))
r_return
id|s
c_func
(paren
id|i
op_plus
id|o
)paren
op_amp
(paren
id|PAGE_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
DECL|macro|i
macro_line|#undef i
DECL|macro|o
macro_line|#undef o
DECL|macro|s
macro_line|#undef s
)brace
DECL|macro|page_hash
mdefine_line|#define page_hash(inode,offset) (page_hash_table+_page_hashfn(inode,offset))
r_extern
r_struct
id|page
op_star
id|__find_get_page
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
r_int
id|offset
comma
r_struct
id|page
op_star
id|page
)paren
suffix:semicolon
DECL|macro|find_get_page
mdefine_line|#define find_get_page(inode, offset) &bslash;&n;&t;&t;__find_get_page(inode, offset, *page_hash(inode, offset))
r_extern
r_struct
id|page
op_star
id|__find_lock_page
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
r_int
id|offset
comma
r_struct
id|page
op_star
id|page
)paren
suffix:semicolon
DECL|macro|find_lock_page
mdefine_line|#define find_lock_page(inode, offset) &bslash;&n;&t;&t;__find_lock_page(inode, offset, *page_hash(inode, offset))
r_extern
r_void
id|__add_page_to_hash_queue
c_func
(paren
r_struct
id|page
op_star
id|page
comma
r_struct
id|page
op_star
op_star
id|p
)paren
suffix:semicolon
r_extern
r_int
id|add_to_page_cache_unique
c_func
(paren
r_struct
id|page
op_star
id|page
comma
r_struct
id|inode
op_star
id|inode
comma
r_int
r_int
id|offset
comma
r_struct
id|page
op_star
op_star
id|hash
)paren
suffix:semicolon
DECL|function|add_page_to_hash_queue
r_static
r_inline
r_void
id|add_page_to_hash_queue
c_func
(paren
r_struct
id|page
op_star
id|page
comma
r_struct
id|inode
op_star
id|inode
comma
r_int
r_int
id|offset
)paren
(brace
id|__add_page_to_hash_queue
c_func
(paren
id|page
comma
id|page_hash
c_func
(paren
id|inode
comma
id|offset
)paren
)paren
suffix:semicolon
)brace
DECL|function|remove_page_from_inode_queue
r_static
r_inline
r_void
id|remove_page_from_inode_queue
c_func
(paren
r_struct
id|page
op_star
id|page
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|page-&gt;inode
suffix:semicolon
id|inode-&gt;i_nrpages
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_pages
op_eq
id|page
)paren
id|inode-&gt;i_pages
op_assign
id|page-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|page-&gt;next
)paren
id|page-&gt;next-&gt;prev
op_assign
id|page-&gt;prev
suffix:semicolon
r_if
c_cond
(paren
id|page-&gt;prev
)paren
id|page-&gt;prev-&gt;next
op_assign
id|page-&gt;next
suffix:semicolon
id|page-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|page-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|add_page_to_inode_queue
r_static
r_inline
r_void
id|add_page_to_inode_queue
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|page
op_star
id|page
)paren
(brace
r_struct
id|page
op_star
op_star
id|p
op_assign
op_amp
id|inode-&gt;i_pages
suffix:semicolon
id|inode-&gt;i_nrpages
op_increment
suffix:semicolon
id|page-&gt;inode
op_assign
id|inode
suffix:semicolon
id|page-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|page-&gt;next
op_assign
op_star
id|p
)paren
op_ne
l_int|NULL
)paren
id|page-&gt;next-&gt;prev
op_assign
id|page
suffix:semicolon
op_star
id|p
op_assign
id|page
suffix:semicolon
)brace
r_extern
r_void
id|___wait_on_page
c_func
(paren
r_struct
id|page
op_star
)paren
suffix:semicolon
DECL|function|wait_on_page
r_static
r_inline
r_void
id|wait_on_page
c_func
(paren
r_struct
id|page
op_star
id|page
)paren
(brace
r_if
c_cond
(paren
id|PageLocked
c_func
(paren
id|page
)paren
)paren
id|___wait_on_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_extern
r_void
id|update_vm_cache
c_func
(paren
r_struct
id|inode
op_star
comma
r_int
r_int
comma
r_const
r_char
op_star
comma
r_int
)paren
suffix:semicolon
macro_line|#endif
eof
