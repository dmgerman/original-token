macro_line|#ifndef _LINUX_FS_STRUCT_H
DECL|macro|_LINUX_FS_STRUCT_H
mdefine_line|#define _LINUX_FS_STRUCT_H
macro_line|#ifdef __KERNEL__
DECL|struct|fs_struct
r_struct
id|fs_struct
(brace
DECL|member|count
id|atomic_t
id|count
suffix:semicolon
DECL|member|lock
id|rwlock_t
id|lock
suffix:semicolon
DECL|member|umask
r_int
id|umask
suffix:semicolon
DECL|member|root
DECL|member|pwd
DECL|member|altroot
r_struct
id|dentry
op_star
id|root
comma
op_star
id|pwd
comma
op_star
id|altroot
suffix:semicolon
DECL|member|rootmnt
DECL|member|pwdmnt
DECL|member|altrootmnt
r_struct
id|vfsmount
op_star
id|rootmnt
comma
op_star
id|pwdmnt
comma
op_star
id|altrootmnt
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|INIT_FS
mdefine_line|#define INIT_FS { &bslash;&n;&t;ATOMIC_INIT(1), &bslash;&n;&t;RW_LOCK_UNLOCKED, &bslash;&n;&t;0022, &bslash;&n;&t;NULL, NULL, NULL, NULL, NULL, NULL &bslash;&n;}
r_extern
r_void
id|exit_fs
c_func
(paren
r_struct
id|task_struct
op_star
)paren
suffix:semicolon
r_extern
r_void
id|set_fs_altroot
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; * Replace the fs-&gt;{rootmnt,root} with {mnt,dentry}. Put the old values.&n; * It can block. Requires the big lock held.&n; */
DECL|function|set_fs_root
r_static
r_inline
r_void
id|set_fs_root
c_func
(paren
r_struct
id|fs_struct
op_star
id|fs
comma
r_struct
id|vfsmount
op_star
id|mnt
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|dentry
op_star
id|old_root
suffix:semicolon
r_struct
id|vfsmount
op_star
id|old_rootmnt
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|fs-&gt;lock
)paren
suffix:semicolon
id|old_root
op_assign
id|fs-&gt;root
suffix:semicolon
id|old_rootmnt
op_assign
id|fs-&gt;rootmnt
suffix:semicolon
id|fs-&gt;rootmnt
op_assign
id|mntget
c_func
(paren
id|mnt
)paren
suffix:semicolon
id|fs-&gt;root
op_assign
id|dget
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|fs-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|old_root
)paren
(brace
id|dput
c_func
(paren
id|old_root
)paren
suffix:semicolon
id|mntput
c_func
(paren
id|old_rootmnt
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Replace the fs-&gt;{pwdmnt,pwd} with {mnt,dentry}. Put the old values.&n; * It can block. Requires the big lock held.&n; */
DECL|function|set_fs_pwd
r_static
r_inline
r_void
id|set_fs_pwd
c_func
(paren
r_struct
id|fs_struct
op_star
id|fs
comma
r_struct
id|vfsmount
op_star
id|mnt
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|dentry
op_star
id|old_pwd
suffix:semicolon
r_struct
id|vfsmount
op_star
id|old_pwdmnt
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|fs-&gt;lock
)paren
suffix:semicolon
id|old_pwd
op_assign
id|fs-&gt;pwd
suffix:semicolon
id|old_pwdmnt
op_assign
id|fs-&gt;pwdmnt
suffix:semicolon
id|fs-&gt;pwdmnt
op_assign
id|mntget
c_func
(paren
id|mnt
)paren
suffix:semicolon
id|fs-&gt;pwd
op_assign
id|dget
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|fs-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|old_pwd
)paren
(brace
id|dput
c_func
(paren
id|old_pwd
)paren
suffix:semicolon
id|mntput
c_func
(paren
id|old_pwdmnt
)paren
suffix:semicolon
)brace
)brace
r_struct
id|fs_struct
op_star
id|copy_fs_struct
c_func
(paren
r_struct
id|fs_struct
op_star
id|old
)paren
suffix:semicolon
r_void
id|put_fs_struct
c_func
(paren
r_struct
id|fs_struct
op_star
id|fs
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
eof
