multiline_comment|/*&n; * linux/include/asm-arm/proc-armo/locks.h&n; *&n; * Copyright (C) 2000 Russell King&n; *&n; * Interrupt safe locking assembler.&n; */
macro_line|#ifndef __ASM_PROC_LOCKS_H
DECL|macro|__ASM_PROC_LOCKS_H
mdefine_line|#define __ASM_PROC_LOCKS_H
DECL|macro|__down_op
mdefine_line|#define __down_op(ptr,fail)&t;&t;&t;&bslash;&n;&t;({&t;&t;&t;&t;&t;&bslash;&n;&t;__asm__ __volatile__ (&t;&t;&t;&bslash;&n;&t;&quot;@ atomic down operation&bslash;n&quot;&t;&t;&bslash;&n;&quot;&t;mov&t;r0, pc&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;orr&t;lr, r0, #0x08000000&bslash;n&quot;&t;&t;&bslash;&n;&quot;&t;teqp&t;lr, #0&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;ldr&t;lr, [%0]&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;and&t;r0, r0, #0x0c000003&bslash;n&quot;&t;&t;&bslash;&n;&quot;&t;subs&t;lr, lr, #1&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;str&t;lr, [%0]&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;orrmi&t;r0, r0, #0x80000000&t;@ set N&bslash;n&quot; &bslash;&n;&quot;&t;teqp&t;r0, #0&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;movmi&t;r0, %0&bslash;n&quot;&t;&t;&t;&bslash;&n;&t;blmi&t;&quot; SYMBOL_NAME_STR(fail)&t;&t;&bslash;&n;&t;:&t;&t;&t;&t;&t;&bslash;&n;&t;: &quot;r&quot; (ptr)&t;&t;&t;&t;&bslash;&n;&t;: &quot;r0&quot;, &quot;lr&quot;, &quot;cc&quot;);&t;&t;&t;&bslash;&n;&t;})
mdefine_line|#define __down_op_ret(ptr,fail)&t;&t;&t;&bslash;&n;&t;({&t;&t;&t;&t;&t;&bslash;&n;&t;&t;unsigned int result;&t;&t;&bslash;&n;&t;__asm__ __volatile__ (&t;&t;&t;&bslash;&n;&quot;&t;@ down_op_ret&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;mov&t;r0, pc&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;orr&t;lr, r0, #0x08000000&bslash;n&quot;&t;&t;&bslash;&n;&quot;&t;teqp&t;lr, #0&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;ldr&t;lr, [%1]&bslash;m&quot;&t;&t;&t;&bslash;&n;&quot;&t;and&t;r0, r0, #0x0c000003&bslash;n&quot;&t;&t;&bslash;&n;&quot;&t;subs&t;lr, lr, #1&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;str&t;lr, [%1]&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;orrmi&t;r0, r0, #0x80000000&t;@ set N&bslash;n&quot; &bslash;&n;&quot;&t;teqp&t;r0, #0&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;movmi&t;r0, %1&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;movpl&t;r0, #0&bslash;n&quot;&t;&t;&t;&bslash;&n;&quot;&t;blmi&t;&quot; SYMBOL_NAME_STR(fail) &quot;&bslash;n&quot;&t;&bslash;&n;&quot;&t;mov&t;%0, r0&quot;&t;&t;&t;&t;&bslash;&n;&t;: &quot;=&amp;r&quot; (result)&t;&t;&t;&bslash;&n;&t;: &quot;r&quot; (ptr)&t;&t;&t;&t;&bslash;&n;&t;: &quot;r0&quot;, &quot;lr&quot;, &quot;cc&quot;);&t;&t;&t;&bslash;&n;&t;result;&t;&t;&t;&t;&t;&bslash;&n;&t;})
mdefine_line|#define __up_op(ptr,wake)&t;&t;&t;&bslash;&n;&t;({&t;&t;&t;&t;&t;&bslash;&n;&t;__asm__ __volatile__ (&t;&t;&t;&bslash;&n;&t;&quot;@ up_op&bslash;n&quot;&t;&t;&t;&t;&bslash;&n;&t;mov&t;r0, pc&bslash;n&quot;&t;&t;&t;&bslash;&n;&t;orr&t;lr, r0, #0x08000000&bslash;n&quot;&t;&t;&bslash;&n;&t;teqp&t;lr, #0&bslash;n&quot;&t;&t;&t;&bslash;&n;&t;ldr&t;lr, [%0]&bslash;n&quot;&t;&t;&t;&bslash;&n;&t;and&t;r0, r0, #0x0c000003&bslash;n&quot;&t;&t;&bslash;&n;&t;adds&t;lr, lr, #1&bslash;n&quot;&t;&t;&t;&bslash;&n;&t;str&t;lr, [%0]&bslash;n&quot;&t;&t;&t;&bslash;&n;&t;orrle&t;r0, r0, #0x80000000&t;@ set N&bslash;n&quot; &bslash;&n;&t;teqp&t;r0, #0&bslash;n&quot;&t;&t;&t;&bslash;&n;&t;movmi&t;r0, %0&bslash;n&quot;&t;&t;&t;&bslash;&n;&t;blmi&t;&quot; SYMBOL_NAME_STR(wake)&t;&t;&bslash;&n;&t;:&t;&t;&t;&t;&t;&bslash;&n;&t;: &quot;r&quot; (ptr)&t;&t;&t;&t;&bslash;&n;&t;: &quot;r0&quot;, &quot;lr&quot;, &quot;cc&quot;);&t;&t;&t;&bslash;&n;&t;})
macro_line|#endif
eof
