macro_line|#ifndef __ASM_ARCH_DMA_H
DECL|macro|__ASM_ARCH_DMA_H
mdefine_line|#define __ASM_ARCH_DMA_H
DECL|macro|MAX_DMA_ADDRESS
mdefine_line|#define MAX_DMA_ADDRESS&t;&t;0xd0000000
macro_line|#ifdef KERNEL_ARCH_DMA
DECL|variable|arch_dma_setup
r_static
r_int
r_char
id|arch_dma_setup
suffix:semicolon
DECL|variable|arch_dma_ctrl
r_int
r_char
id|arch_dma_ctrl
(braket
l_int|8
)braket
suffix:semicolon
DECL|variable|arch_dma_addr
r_int
r_int
id|arch_dma_addr
(braket
l_int|8
)braket
suffix:semicolon
DECL|variable|arch_dma_cnt
r_int
r_int
id|arch_dma_cnt
(braket
l_int|8
)braket
suffix:semicolon
DECL|function|arch_enable_dma
r_static
r_inline
r_void
id|arch_enable_dma
c_func
(paren
r_int
id|dmanr
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|arch_dma_setup
op_amp
(paren
l_int|1
op_lshift
id|dmanr
)paren
)paren
)paren
(brace
id|arch_dma_setup
op_or_assign
l_int|1
op_lshift
id|dmanr
suffix:semicolon
multiline_comment|/*    dma_interrupt (16 + dmanr);*/
)brace
id|arch_dma_ctrl
(braket
id|dmanr
)braket
op_or_assign
id|DMA_CR_E
suffix:semicolon
r_switch
c_cond
(paren
id|dmanr
)paren
(brace
r_case
l_int|0
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|0
)braket
comma
id|IOMD_IO0CR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|1
)braket
comma
id|IOMD_IO1CR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|2
)braket
comma
id|IOMD_IO2CR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|3
)braket
comma
id|IOMD_IO3CR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|4
)braket
comma
id|IOMD_SD0CR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|5
)braket
comma
id|IOMD_SD1CR
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|arch_disable_dma
r_static
r_inline
r_void
id|arch_disable_dma
c_func
(paren
r_int
id|dmanr
)paren
(brace
id|arch_dma_ctrl
(braket
id|dmanr
)braket
op_and_assign
op_complement
id|DMA_CR_E
suffix:semicolon
r_switch
c_cond
(paren
id|dmanr
)paren
(brace
r_case
l_int|0
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|0
)braket
comma
id|IOMD_IO0CR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|1
)braket
comma
id|IOMD_IO1CR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|2
)braket
comma
id|IOMD_IO2CR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|3
)braket
comma
id|IOMD_IO3CR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|4
)braket
comma
id|IOMD_SD0CR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|outb
(paren
id|arch_dma_ctrl
(braket
l_int|5
)braket
comma
id|IOMD_SD1CR
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|arch_set_dma_addr
r_static
r_inline
r_void
id|arch_set_dma_addr
c_func
(paren
r_int
id|dmanr
comma
r_int
r_int
id|addr
)paren
(brace
id|arch_dma_setup
op_and_assign
op_complement
id|dmanr
suffix:semicolon
id|arch_dma_addr
(braket
id|dmanr
)braket
op_assign
id|addr
suffix:semicolon
)brace
DECL|function|arch_set_dma_count
r_static
r_inline
r_void
id|arch_set_dma_count
c_func
(paren
r_int
id|dmanr
comma
r_int
r_int
id|count
)paren
(brace
id|arch_dma_setup
op_and_assign
op_complement
id|dmanr
suffix:semicolon
id|arch_dma_cnt
(braket
id|dmanr
)braket
op_assign
id|count
suffix:semicolon
)brace
DECL|function|arch_set_dma_mode
r_static
r_inline
r_void
id|arch_set_dma_mode
c_func
(paren
r_int
id|dmanr
comma
r_char
id|mode
)paren
(brace
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|DMA_MODE_READ
suffix:colon
id|arch_dma_ctrl
(braket
id|dmanr
)braket
op_or_assign
id|DMA_CR_D
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_MODE_WRITE
suffix:colon
id|arch_dma_ctrl
(braket
id|dmanr
)braket
op_and_assign
op_complement
id|DMA_CR_D
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|arch_dma_count
r_static
r_inline
r_int
id|arch_dma_count
(paren
r_int
id|dmanr
)paren
(brace
r_return
id|arch_dma_cnt
(braket
id|dmanr
)braket
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* enable/disable a specific DMA channel */
r_extern
r_void
id|enable_dma
c_func
(paren
r_int
r_int
id|dmanr
)paren
suffix:semicolon
DECL|function|disable_dma
r_static
id|__inline__
r_void
id|disable_dma
c_func
(paren
r_int
r_int
id|dmanr
)paren
(brace
r_switch
c_cond
(paren
id|dmanr
)paren
(brace
r_case
l_int|1
suffix:colon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|disable_irq
c_func
(paren
l_int|64
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|dma_str
comma
l_string|&quot;disable_dma&quot;
comma
id|dmanr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Clear the &squot;DMA Pointer Flip Flop&squot;.&n; * Write 0 for LSB/MSB, 1 for MSB/LSB access.&n; * Use this once to initialize the FF to a known state.&n; * After that, keep track of it. :-)&n; * --- In order to do that, the DMA routines below should ---&n; * --- only be used while interrupts are disabled! ---&n; */
DECL|macro|clear_dma_ff
mdefine_line|#define clear_dma_ff(dmanr)
multiline_comment|/* set mode (above) for a specific DMA channel */
r_extern
r_void
id|set_dma_mode
c_func
(paren
r_int
r_int
id|dmanr
comma
r_char
id|mode
)paren
suffix:semicolon
multiline_comment|/* Set only the page register bits of the transfer address.&n; * This is used for successive transfers when we know the contents of&n; * the lower 16 bits of the DMA current address register, but a 64k boundary&n; * may have been crossed.&n; */
DECL|function|set_dma_page
r_static
id|__inline__
r_void
id|set_dma_page
c_func
(paren
r_int
r_int
id|dmanr
comma
r_char
id|pagenr
)paren
(brace
id|printk
(paren
id|dma_str
comma
l_string|&quot;set_dma_page&quot;
comma
id|dmanr
)paren
suffix:semicolon
)brace
multiline_comment|/* Set transfer address &amp; page bits for specific DMA channel.&n; * Assumes dma flipflop is clear.&n; */
r_extern
r_void
id|set_dma_addr
c_func
(paren
r_int
r_int
id|dmanr
comma
r_int
r_int
id|addr
)paren
suffix:semicolon
multiline_comment|/* Set transfer size for a specific DMA channel.&n; */
r_extern
r_void
id|set_dma_count
c_func
(paren
r_int
r_int
id|dmanr
comma
r_int
r_int
id|count
)paren
suffix:semicolon
multiline_comment|/* Get DMA residue count. After a DMA transfer, this&n; * should return zero. Reading this while a DMA transfer is&n; * still in progress will return unpredictable results.&n; * If called before the channel has been used, it may return 1.&n; * Otherwise, it returns the number of _bytes_ left to transfer.&n; *&n; * Assumes DMA flip-flop is clear.&n; */
r_extern
r_int
id|get_dma_residue
c_func
(paren
r_int
r_int
id|dmanr
)paren
suffix:semicolon
macro_line|#endif /* _ASM_ARCH_DMA_H */
eof
