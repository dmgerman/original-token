multiline_comment|/* $Id: parport.h,v 1.3 1999/08/04 03:20:03 davem Exp $&n; * parport.h: sparc64 specific parport initialization and dma.&n; *&n; * Copyright (C) 1999  Eddie C. Dost  (ecd@skynet.be)&n; */
macro_line|#ifndef _ASM_SPARC64_PARPORT_H
DECL|macro|_ASM_SPARC64_PARPORT_H
mdefine_line|#define _ASM_SPARC64_PARPORT_H 1
macro_line|#include &lt;asm/ebus.h&gt;
macro_line|#include &lt;asm/ns87303.h&gt;
macro_line|#ifdef CONFIG_PARPORT_PC_PCMCIA
DECL|macro|__maybe_init
mdefine_line|#define __maybe_init
DECL|macro|__maybe_initdata
mdefine_line|#define __maybe_initdata
macro_line|#else
DECL|macro|__maybe_init
mdefine_line|#define __maybe_init __init
DECL|macro|__maybe_initdata
mdefine_line|#define __maybe_initdata __initdata
macro_line|#endif
DECL|macro|HAVE_SLOW_DEVICES
macro_line|#undef HAVE_SLOW_DEVICES
DECL|macro|PARPORT_PC_MAX_PORTS
mdefine_line|#define PARPORT_PC_MAX_PORTS&t;PARPORT_MAX
DECL|variable|sparc_ebus_dmas
r_static
r_struct
id|linux_ebus_dma
op_star
id|sparc_ebus_dmas
(braket
id|PARPORT_PC_MAX_PORTS
)braket
suffix:semicolon
r_static
id|__inline__
r_void
DECL|function|reset_dma
id|reset_dma
c_func
(paren
r_int
r_int
id|dmanr
)paren
(brace
r_int
r_int
id|dcsr
suffix:semicolon
id|writel
c_func
(paren
id|EBUS_DCSR_RESET
comma
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|dcsr
op_assign
id|EBUS_DCSR_BURST_SZ_16
op_or
id|EBUS_DCSR_TCI_DIS
op_or
id|EBUS_DCSR_EN_CNT
suffix:semicolon
id|writel
c_func
(paren
id|dcsr
comma
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_void
DECL|function|enable_dma
id|enable_dma
c_func
(paren
r_int
r_int
id|dmanr
)paren
(brace
r_int
r_int
id|dcsr
suffix:semicolon
id|dcsr
op_assign
id|readl
c_func
(paren
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
id|dcsr
op_or_assign
id|EBUS_DCSR_EN_DMA
suffix:semicolon
id|writel
c_func
(paren
id|dcsr
comma
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_void
DECL|function|disable_dma
id|disable_dma
c_func
(paren
r_int
r_int
id|dmanr
)paren
(brace
r_int
r_int
id|dcsr
suffix:semicolon
id|dcsr
op_assign
id|readl
c_func
(paren
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dcsr
op_amp
id|EBUS_DCSR_EN_DMA
)paren
(brace
r_while
c_loop
(paren
id|dcsr
op_amp
id|EBUS_DCSR_DRAIN
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|dcsr
op_assign
id|readl
c_func
(paren
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
)brace
id|dcsr
op_and_assign
op_complement
(paren
id|EBUS_DCSR_EN_DMA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|dcsr
comma
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
id|dcsr
op_assign
id|readl
c_func
(paren
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dcsr
op_amp
id|EBUS_DCSR_ERR_PEND
)paren
(brace
id|reset_dma
c_func
(paren
id|dmanr
)paren
suffix:semicolon
id|dcsr
op_and_assign
op_complement
(paren
id|EBUS_DCSR_ERR_PEND
)paren
suffix:semicolon
)brace
id|writel
c_func
(paren
id|dcsr
comma
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
)brace
)brace
r_static
id|__inline__
r_void
DECL|function|clear_dma_ff
id|clear_dma_ff
c_func
(paren
r_int
r_int
id|dmanr
)paren
(brace
multiline_comment|/* nothing */
)brace
r_static
id|__inline__
r_void
DECL|function|set_dma_mode
id|set_dma_mode
c_func
(paren
r_int
r_int
id|dmanr
comma
r_char
id|mode
)paren
(brace
r_int
r_int
id|dcsr
suffix:semicolon
id|dcsr
op_assign
id|readl
c_func
(paren
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
id|dcsr
op_or_assign
id|EBUS_DCSR_EN_CNT
op_or
id|EBUS_DCSR_TC
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|DMA_MODE_WRITE
)paren
id|dcsr
op_and_assign
op_complement
(paren
id|EBUS_DCSR_WRITE
)paren
suffix:semicolon
r_else
id|dcsr
op_or_assign
id|EBUS_DCSR_WRITE
suffix:semicolon
id|writel
c_func
(paren
id|dcsr
comma
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_void
DECL|function|set_dma_addr
id|set_dma_addr
c_func
(paren
r_int
r_int
id|dmanr
comma
r_int
r_int
id|addr
)paren
(brace
id|writel
c_func
(paren
id|addr
comma
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dacr
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_void
DECL|function|set_dma_count
id|set_dma_count
c_func
(paren
r_int
r_int
id|dmanr
comma
r_int
r_int
id|count
)paren
(brace
id|writel
c_func
(paren
id|count
comma
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dbcr
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_int
DECL|function|get_dma_residue
id|get_dma_residue
c_func
(paren
r_int
r_int
id|dmanr
)paren
(brace
r_int
r_int
id|dcsr
suffix:semicolon
r_int
id|res
suffix:semicolon
id|res
op_assign
id|readl
c_func
(paren
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dbcr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_ne
l_int|0
)paren
(brace
id|dcsr
op_assign
id|readl
c_func
(paren
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
id|reset_dma
c_func
(paren
id|dmanr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|dcsr
comma
op_amp
id|sparc_ebus_dmas
(braket
id|dmanr
)braket
op_member_access_from_pointer
id|dcsr
)paren
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
r_static
r_int
id|__maybe_init
id|parport_pc_init_pci
c_func
(paren
r_int
id|irq
comma
r_int
id|dma
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|user_specified
id|__initdata
op_assign
l_int|0
suffix:semicolon
r_int
id|__init
DECL|function|parport_pc_init
id|parport_pc_init
c_func
(paren
r_int
op_star
id|io
comma
r_int
op_star
id|io_hi
comma
r_int
op_star
id|irq
comma
r_int
op_star
id|dma
)paren
(brace
r_struct
id|linux_ebus
op_star
id|ebus
suffix:semicolon
r_struct
id|linux_ebus_device
op_star
id|edev
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|for_each_ebus
c_func
(paren
id|ebus
)paren
(brace
id|for_each_ebusdev
c_func
(paren
id|edev
comma
id|ebus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|edev-&gt;prom_name
comma
l_string|&quot;ecpp&quot;
)paren
)paren
(brace
r_int
r_int
id|base
op_assign
id|edev-&gt;base_address
(braket
l_int|0
)braket
suffix:semicolon
r_int
r_int
id|config
op_assign
id|edev-&gt;base_address
(braket
l_int|1
)braket
suffix:semicolon
r_int
r_char
id|cfg
suffix:semicolon
id|sparc_ebus_dmas
(braket
id|count
)braket
op_assign
(paren
r_struct
id|linux_ebus_dma
op_star
)paren
id|edev-&gt;base_address
(braket
l_int|2
)braket
suffix:semicolon
id|reset_dma
c_func
(paren
id|count
)paren
suffix:semicolon
multiline_comment|/* Enable ECP, set bit 2 of the CTR first */
id|outb
c_func
(paren
l_int|0x04
comma
id|base
op_plus
l_int|0x02
)paren
suffix:semicolon
id|cfg
op_assign
id|ns87303_readb
c_func
(paren
id|config
comma
id|PCR
)paren
suffix:semicolon
id|cfg
op_or_assign
(paren
id|PCR_ECP_ENABLE
op_or
id|PCR_ECP_CLK_ENA
)paren
suffix:semicolon
id|ns87303_writeb
c_func
(paren
id|config
comma
id|PCR
comma
id|cfg
)paren
suffix:semicolon
multiline_comment|/* CTR bit 5 controls direction of port */
id|cfg
op_assign
id|ns87303_readb
c_func
(paren
id|config
comma
id|PTR
)paren
suffix:semicolon
id|cfg
op_or_assign
id|PTR_LPT_REG_DIR
suffix:semicolon
id|ns87303_writeb
c_func
(paren
id|config
comma
id|PTR
comma
id|cfg
)paren
suffix:semicolon
multiline_comment|/* Configure IRQ to Push Pull, Level Low */
id|cfg
op_assign
id|ns87303_readb
c_func
(paren
id|config
comma
id|PCR
)paren
suffix:semicolon
id|cfg
op_and_assign
op_complement
(paren
id|PCR_IRQ_ODRAIN
)paren
suffix:semicolon
id|cfg
op_or_assign
id|PCR_IRQ_POLAR
suffix:semicolon
id|ns87303_writeb
c_func
(paren
id|config
comma
id|PCR
comma
id|cfg
)paren
suffix:semicolon
macro_line|#ifndef HAVE_SLOW_DEVICES
multiline_comment|/* Enable Zero Wait State for ECP */
id|cfg
op_assign
id|ns87303_readb
c_func
(paren
id|config
comma
id|FCR
)paren
suffix:semicolon
id|cfg
op_or_assign
id|FCR_ZWS_ENA
suffix:semicolon
id|ns87303_writeb
c_func
(paren
id|config
comma
id|FCR
comma
id|cfg
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|parport_pc_probe_port
c_func
(paren
id|base
comma
id|base
op_plus
l_int|0x400
comma
id|edev-&gt;irqs
(braket
l_int|0
)braket
comma
id|count
)paren
)paren
id|count
op_increment
suffix:semicolon
)brace
)brace
)brace
id|count
op_add_assign
id|parport_pc_init_pci
c_func
(paren
id|PARPORT_IRQ_AUTO
comma
id|PARPORT_DMA_NONE
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
macro_line|#endif /* !(_ASM_SPARC64_PARPORT_H */
eof
