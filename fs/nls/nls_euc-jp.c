multiline_comment|/*&n; * linux/fs/nls_euc-jp.c&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/nls.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
DECL|variable|p_nls
r_static
r_struct
id|nls_table
op_star
id|p_nls
suffix:semicolon
DECL|macro|SS2
mdefine_line|#define SS2&t;&t;(0x8E)&t;&t;/* Single Shift 2 */
DECL|macro|SS3
mdefine_line|#define SS3&t;&t;(0x8F)&t;&t;/* Single Shift 3 */
DECL|function|uni2char
r_static
r_int
id|uni2char
c_func
(paren
r_const
m_wchar_t
id|uni
comma
r_int
r_char
op_star
id|out
comma
r_int
id|boundlen
)paren
(brace
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p_nls
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_assign
id|p_nls
op_member_access_from_pointer
id|uni2char
c_func
(paren
id|uni
comma
id|out
comma
id|boundlen
)paren
)paren
OL
l_int|0
)paren
r_return
id|n
suffix:semicolon
multiline_comment|/* translate SJIS into EUC-JP */
r_if
c_cond
(paren
id|n
op_eq
l_int|1
)paren
(brace
multiline_comment|/* JIS X 201 KANA */
r_if
c_cond
(paren
l_int|0xA1
op_le
id|out
(braket
l_int|0
)braket
op_logical_and
id|out
(braket
l_int|0
)braket
op_le
l_int|0xDF
)paren
(brace
r_if
c_cond
(paren
id|boundlen
op_le
l_int|1
)paren
r_return
op_minus
id|ENAMETOOLONG
suffix:semicolon
id|out
(braket
l_int|1
)braket
op_assign
id|out
(braket
l_int|0
)braket
suffix:semicolon
id|out
(braket
l_int|0
)braket
op_assign
id|SS2
suffix:semicolon
id|n
op_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|n
op_eq
l_int|2
)paren
(brace
multiline_comment|/* JIS X 208 */
multiline_comment|/* SJIS codes 0xF0xx to 0xFFxx are machine-dependent codes and user-defining characters */
r_if
c_cond
(paren
id|out
(braket
l_int|0
)braket
op_ge
l_int|0xF0
)paren
(brace
id|out
(braket
l_int|0
)braket
op_assign
l_int|0x81
suffix:semicolon
multiline_comment|/* &squot;GETA&squot; with SJIS coding */
id|out
(braket
l_int|1
)braket
op_assign
l_int|0xAC
suffix:semicolon
)brace
id|out
(braket
l_int|0
)braket
op_assign
(paren
id|out
(braket
l_int|0
)braket
op_xor
l_int|0xA0
)paren
op_star
l_int|2
op_plus
l_int|0x5F
suffix:semicolon
r_if
c_cond
(paren
id|out
(braket
l_int|1
)braket
OG
l_int|0x9E
)paren
id|out
(braket
l_int|0
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|out
(braket
l_int|1
)braket
OL
l_int|0x7F
)paren
id|out
(braket
l_int|1
)braket
op_assign
id|out
(braket
l_int|1
)braket
op_plus
l_int|0x61
suffix:semicolon
r_else
r_if
c_cond
(paren
id|out
(braket
l_int|1
)braket
OL
l_int|0x9F
)paren
id|out
(braket
l_int|1
)braket
op_assign
id|out
(braket
l_int|1
)braket
op_plus
l_int|0x60
suffix:semicolon
r_else
id|out
(braket
l_int|1
)braket
op_assign
id|out
(braket
l_int|1
)braket
op_plus
l_int|0x02
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
DECL|function|char2uni
r_static
r_int
id|char2uni
c_func
(paren
r_const
r_int
r_char
op_star
id|rawstring
comma
r_int
id|boundlen
comma
m_wchar_t
op_star
id|uni
)paren
(brace
r_int
r_char
id|sjis_temp
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|euc_offset
comma
id|n
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p_nls
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|boundlen
op_le
l_int|0
)paren
r_return
op_minus
id|ENAMETOOLONG
suffix:semicolon
r_if
c_cond
(paren
id|boundlen
op_eq
l_int|1
)paren
(brace
op_star
id|uni
op_assign
id|rawstring
(braket
l_int|0
)braket
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* translate EUC-JP into SJIS */
r_if
c_cond
(paren
id|rawstring
(braket
l_int|0
)braket
OG
l_int|0x7F
)paren
(brace
r_if
c_cond
(paren
id|rawstring
(braket
l_int|0
)braket
op_eq
id|SS2
)paren
(brace
multiline_comment|/* JIS X 201 KANA */
id|sjis_temp
(braket
l_int|0
)braket
op_assign
id|rawstring
(braket
l_int|1
)braket
suffix:semicolon
id|sjis_temp
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|euc_offset
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rawstring
(braket
l_int|0
)braket
op_eq
id|SS3
)paren
(brace
multiline_comment|/* JIS X 212 */
id|sjis_temp
(braket
l_int|0
)braket
op_assign
l_int|0x81
suffix:semicolon
multiline_comment|/* &squot;GETA&squot; with SJIS coding */
id|sjis_temp
(braket
l_int|1
)braket
op_assign
l_int|0xAC
suffix:semicolon
id|euc_offset
op_assign
l_int|3
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* JIS X 208 */
id|sjis_temp
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|rawstring
(braket
l_int|0
)braket
op_minus
l_int|0x5f
)paren
op_div
l_int|2
)paren
op_xor
l_int|0xA0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rawstring
(braket
l_int|0
)braket
op_amp
l_int|1
)paren
)paren
id|sjis_temp
(braket
l_int|1
)braket
op_assign
id|rawstring
(braket
l_int|1
)braket
op_minus
l_int|0x02
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rawstring
(braket
l_int|1
)braket
OL
l_int|0xE0
)paren
id|sjis_temp
(braket
l_int|1
)braket
op_assign
id|rawstring
(braket
l_int|1
)braket
op_minus
l_int|0x61
suffix:semicolon
r_else
id|sjis_temp
(braket
l_int|1
)braket
op_assign
id|rawstring
(braket
l_int|1
)braket
op_minus
l_int|0x60
suffix:semicolon
id|euc_offset
op_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* JIS X 201 ROMAJI */
id|sjis_temp
(braket
l_int|0
)braket
op_assign
id|rawstring
(braket
l_int|0
)braket
suffix:semicolon
id|sjis_temp
(braket
l_int|1
)braket
op_assign
id|rawstring
(braket
l_int|1
)braket
suffix:semicolon
id|euc_offset
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|n
op_assign
id|p_nls
op_member_access_from_pointer
id|char2uni
c_func
(paren
id|sjis_temp
comma
id|boundlen
comma
id|uni
)paren
)paren
OL
l_int|0
)paren
r_return
id|n
suffix:semicolon
r_return
id|euc_offset
suffix:semicolon
)brace
DECL|variable|table
r_static
r_struct
id|nls_table
id|table
op_assign
(brace
l_string|&quot;euc-jp&quot;
comma
id|uni2char
comma
id|char2uni
comma
l_int|NULL
comma
l_int|NULL
comma
id|THIS_MODULE
comma
)brace
suffix:semicolon
DECL|function|init_nls_euc_jp
r_static
r_int
id|__init
id|init_nls_euc_jp
c_func
(paren
r_void
)paren
(brace
id|p_nls
op_assign
id|load_nls
c_func
(paren
l_string|&quot;cp932&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p_nls
)paren
(brace
id|table.charset2upper
op_assign
id|p_nls-&gt;charset2upper
suffix:semicolon
id|table.charset2lower
op_assign
id|p_nls-&gt;charset2lower
suffix:semicolon
r_return
id|register_nls
c_func
(paren
op_amp
id|table
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|exit_nls_euc_jp
r_static
r_void
id|__exit
id|exit_nls_euc_jp
c_func
(paren
r_void
)paren
(brace
id|unregister_nls
c_func
(paren
op_amp
id|table
)paren
suffix:semicolon
id|unload_nls
c_func
(paren
id|p_nls
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|init_nls_euc_jp
)paren
id|module_exit
c_func
(paren
id|exit_nls_euc_jp
)paren
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; *&n;---------------------------------------------------------------------------&n; * Local variables:&n; * c-indent-level: 8&n; * c-brace-imaginary-offset: 0&n; * c-brace-offset: -8&n; * c-argdecl-indent: 8&n; * c-label-offset: -8&n; * c-continued-statement-offset: 8&n; * c-continued-brace-offset: 0&n; * End:&n; */
eof
