multiline_comment|/*&n; * linux/fs/nfsd/nfs3xdr.c&n; *&n; * XDR support for nfsd/protocol version 3.&n; *&n; * Copyright (C) 1995, 1996, 1997 Olaf Kirch &lt;okir@monad.swb.de&gt;&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/nfs3.h&gt;
macro_line|#include &lt;linux/sunrpc/xdr.h&gt;
macro_line|#include &lt;linux/sunrpc/svc.h&gt;
macro_line|#include &lt;linux/nfsd/nfsd.h&gt;
macro_line|#include &lt;linux/nfsd/xdr3.h&gt;
DECL|macro|NFSDDBG_FACILITY
mdefine_line|#define NFSDDBG_FACILITY&t;&t;NFSDDBG_XDR
macro_line|#ifdef NFSD_OPTIMIZE_SPACE
DECL|macro|inline
macro_line|# define inline
macro_line|#endif
multiline_comment|/*&n; * Mapping of S_IF* types to NFS file types&n; */
DECL|variable|nfs3_ftypes
r_static
id|u32
id|nfs3_ftypes
(braket
)braket
op_assign
(brace
id|NF3NON
comma
id|NF3FIFO
comma
id|NF3CHR
comma
id|NF3BAD
comma
id|NF3DIR
comma
id|NF3BAD
comma
id|NF3BLK
comma
id|NF3BAD
comma
id|NF3REG
comma
id|NF3BAD
comma
id|NF3LNK
comma
id|NF3BAD
comma
id|NF3SOCK
comma
id|NF3BAD
comma
id|NF3LNK
comma
id|NF3BAD
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * XDR functions for basic NFS types&n; */
r_static
r_inline
id|u32
op_star
DECL|function|encode_time3
id|encode_time3
c_func
(paren
id|u32
op_star
id|p
comma
id|time_t
id|secs
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|secs
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_time3
id|decode_time3
c_func
(paren
id|u32
op_star
id|p
comma
id|time_t
op_star
id|secp
)paren
(brace
op_star
id|secp
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|p
op_plus
l_int|1
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_fh
id|decode_fh
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_int
id|size
suffix:semicolon
id|fh_init
c_func
(paren
id|fhp
comma
id|NFS3_FHSIZE
)paren
suffix:semicolon
id|size
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|NFS3_FHSIZE
)paren
r_return
l_int|NULL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|fhp-&gt;fh_handle.fh_base
comma
id|p
comma
id|size
)paren
suffix:semicolon
id|fhp-&gt;fh_handle.fh_size
op_assign
id|size
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_fh
id|encode_fh
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_int
id|size
op_assign
id|fhp-&gt;fh_handle.fh_size
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
)paren
id|p
(braket
id|XDR_QUADLEN
c_func
(paren
id|size
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
op_amp
id|fhp-&gt;fh_handle.fh_base
comma
id|size
)paren
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode a file name and make sure that the path contains&n; * no slashes or null bytes.&n; */
r_static
r_inline
id|u32
op_star
DECL|function|decode_filename
id|decode_filename
c_func
(paren
id|u32
op_star
id|p
comma
r_char
op_star
op_star
id|namp
comma
r_int
op_star
id|lenp
)paren
(brace
r_char
op_star
id|name
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|xdr_decode_string
c_func
(paren
id|p
comma
id|namp
comma
id|lenp
comma
id|NFS3_MAXNAMLEN
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|name
op_assign
op_star
id|namp
suffix:semicolon
id|i
OL
op_star
id|lenp
suffix:semicolon
id|i
op_increment
comma
id|name
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|name
op_eq
l_char|&squot;&bslash;0&squot;
op_logical_or
op_star
id|name
op_eq
l_char|&squot;/&squot;
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|name
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_pathname
id|decode_pathname
c_func
(paren
id|u32
op_star
id|p
comma
r_char
op_star
op_star
id|namp
comma
r_int
op_star
id|lenp
)paren
(brace
r_char
op_star
id|name
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|xdr_decode_string
c_func
(paren
id|p
comma
id|namp
comma
id|lenp
comma
id|NFS3_MAXPATHLEN
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|name
op_assign
op_star
id|namp
suffix:semicolon
id|i
OL
op_star
id|lenp
suffix:semicolon
id|i
op_increment
comma
id|name
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|name
op_eq
l_char|&squot;&bslash;0&squot;
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|name
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_sattr3
id|decode_sattr3
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|iattr
op_star
id|iap
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|iap-&gt;ia_valid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_MODE
suffix:semicolon
id|iap-&gt;ia_mode
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_UID
suffix:semicolon
id|iap-&gt;ia_uid
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_GID
suffix:semicolon
id|iap-&gt;ia_gid
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|u64
id|newsize
suffix:semicolon
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_SIZE
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|newsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newsize
op_le
id|NFS_OFFSET_MAX
)paren
id|iap-&gt;ia_size
op_assign
id|newsize
suffix:semicolon
r_else
id|iap-&gt;ia_size
op_assign
id|NFS_OFFSET_MAX
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
op_eq
l_int|1
)paren
(brace
multiline_comment|/* set to server time */
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_ATIME
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tmp
op_eq
l_int|2
)paren
(brace
multiline_comment|/* set to client time */
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_ATIME
op_or
id|ATTR_ATIME_SET
suffix:semicolon
id|iap-&gt;ia_atime
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
comma
id|p
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
op_eq
l_int|1
)paren
(brace
multiline_comment|/* set to server time */
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_MTIME
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tmp
op_eq
l_int|2
)paren
(brace
multiline_comment|/* set to client time */
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_MTIME
op_or
id|ATTR_MTIME_SET
suffix:semicolon
id|iap-&gt;ia_mtime
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
comma
id|p
op_increment
suffix:semicolon
)brace
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_fattr3
id|encode_fattr3
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;nfsd: NULL inode in %s:%d&quot;
comma
id|__FILE__
comma
id|__LINE__
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfs3_ftypes
(braket
(paren
id|inode-&gt;i_mode
op_amp
id|S_IFMT
)paren
op_rshift
l_int|12
)braket
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|inode-&gt;i_mode
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|inode-&gt;i_nlink
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|nfsd_ruid
c_func
(paren
id|rqstp
comma
id|inode-&gt;i_uid
)paren
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|nfsd_rgid
c_func
(paren
id|rqstp
comma
id|inode-&gt;i_gid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|inode-&gt;i_mode
)paren
op_logical_and
id|inode-&gt;i_size
OG
id|NFS3_MAXPATHLEN
)paren
(brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|NFS3_MAXPATHLEN
)paren
suffix:semicolon
)brace
r_else
(brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|inode-&gt;i_size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inode-&gt;i_blksize
op_eq
l_int|0
op_logical_and
id|inode-&gt;i_blocks
op_eq
l_int|0
)paren
multiline_comment|/* Minix file system(?) i_size is (hopefully) close enough */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
(paren
id|inode-&gt;i_size
op_plus
l_int|511
)paren
op_amp
op_complement
l_int|511
)paren
suffix:semicolon
r_else
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
(paren
id|u64
)paren
id|inode-&gt;i_blocks
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|MAJOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|inode-&gt;i_dev
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|inode-&gt;i_ino
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|inode-&gt;i_atime
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|lease_get_mtime
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|inode-&gt;i_ctime
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_saved_post_attr
id|encode_saved_post_attr
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|fhp-&gt;fh_dentry-&gt;d_inode
suffix:semicolon
multiline_comment|/* Attributes to follow */
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfs3_ftypes
(braket
(paren
id|fhp-&gt;fh_post_mode
op_amp
id|S_IFMT
)paren
op_rshift
l_int|12
)braket
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|fhp-&gt;fh_post_mode
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|fhp-&gt;fh_post_nlink
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|nfsd_ruid
c_func
(paren
id|rqstp
comma
id|fhp-&gt;fh_post_uid
)paren
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|nfsd_rgid
c_func
(paren
id|rqstp
comma
id|fhp-&gt;fh_post_gid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|fhp-&gt;fh_post_mode
)paren
op_logical_and
id|fhp-&gt;fh_post_size
OG
id|NFS3_MAXPATHLEN
)paren
(brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|NFS3_MAXPATHLEN
)paren
suffix:semicolon
)brace
r_else
(brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|fhp-&gt;fh_post_size
)paren
suffix:semicolon
)brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
(paren
id|u64
)paren
id|fhp-&gt;fh_post_blocks
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|MAJOR
c_func
(paren
id|fhp-&gt;fh_post_rdev
)paren
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|MINOR
c_func
(paren
id|fhp-&gt;fh_post_rdev
)paren
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|inode-&gt;i_dev
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|inode-&gt;i_ino
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|fhp-&gt;fh_post_atime
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|fhp-&gt;fh_post_mtime
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|fhp-&gt;fh_post_ctime
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode post-operation attributes.&n; * The inode may be NULL if the call failed because of a stale file&n; * handle. In this case, no attributes are returned.&n; */
r_static
id|u32
op_star
DECL|function|encode_post_op_attr
id|encode_post_op_attr
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_if
c_cond
(paren
id|dentry
op_logical_and
id|dentry-&gt;d_inode
op_ne
l_int|NULL
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* attributes follow */
r_return
id|encode_fattr3
c_func
(paren
id|rqstp
comma
id|p
comma
id|dentry
)paren
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
multiline_comment|/*&n; * Enocde weak cache consistency data&n; */
r_static
id|u32
op_star
DECL|function|encode_wcc_data
id|encode_wcc_data
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_struct
id|dentry
op_star
id|dentry
op_assign
id|fhp-&gt;fh_dentry
suffix:semicolon
r_if
c_cond
(paren
id|dentry
op_logical_and
id|dentry-&gt;d_inode
op_logical_and
id|fhp-&gt;fh_post_saved
)paren
(brace
r_if
c_cond
(paren
id|fhp-&gt;fh_pre_saved
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|fhp-&gt;fh_pre_size
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|fhp-&gt;fh_pre_mtime
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|fhp-&gt;fh_pre_ctime
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
)brace
r_return
id|encode_saved_post_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|fhp
)paren
suffix:semicolon
)brace
multiline_comment|/* no pre- or post-attrs */
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
r_return
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|dentry
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Check buffer bounds after decoding arguments&n; */
r_static
r_inline
r_int
DECL|function|xdr_argsize_check
id|xdr_argsize_check
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
)paren
(brace
r_struct
id|svc_buf
op_star
id|buf
op_assign
op_amp
id|rqstp-&gt;rq_argbuf
suffix:semicolon
r_return
id|p
op_minus
id|buf-&gt;base
op_le
id|buf-&gt;buflen
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|xdr_ressize_check
id|xdr_ressize_check
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
)paren
(brace
r_struct
id|svc_buf
op_star
id|buf
op_assign
op_amp
id|rqstp-&gt;rq_resbuf
suffix:semicolon
id|buf-&gt;len
op_assign
id|p
op_minus
id|buf-&gt;base
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;nfsd: ressize_check p %p base %p len %d&bslash;n&quot;
comma
id|p
comma
id|buf-&gt;base
comma
id|buf-&gt;buflen
)paren
suffix:semicolon
r_return
(paren
id|buf-&gt;len
op_le
id|buf-&gt;buflen
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR decode functions&n; */
r_int
DECL|function|nfs3svc_decode_fhandle
id|nfs3svc_decode_fhandle
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
id|fhp
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_sattrargs
id|nfs3svc_decode_sattrargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_sattrargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|args-&gt;check_guard
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
op_ne
l_int|0
)paren
id|p
op_assign
id|decode_time3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;guardtime
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_diropargs
id|nfs3svc_decode_diropargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_diropargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_accessargs
id|nfs3svc_decode_accessargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_accessargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;access
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_readargs
id|nfs3svc_decode_readargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|args-&gt;offset
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_writeargs
id|nfs3svc_decode_writeargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_writeargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|args-&gt;offset
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;stable
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;data
op_assign
(paren
r_char
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|args-&gt;len
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_createargs
id|nfs3svc_decode_createargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_createargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|args-&gt;createmode
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
(brace
r_case
id|NFS3_CREATE_UNCHECKED
suffix:colon
r_case
id|NFS3_CREATE_GUARDED
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NFS3_CREATE_EXCLUSIVE
suffix:colon
id|args-&gt;verf
op_assign
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_mkdirargs
id|nfs3svc_decode_mkdirargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_createargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_symlinkargs
id|nfs3svc_decode_symlinkargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_symlinkargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;ffh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fname
comma
op_amp
id|args-&gt;flen
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_pathname
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tname
comma
op_amp
id|args-&gt;tlen
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_mknodargs
id|nfs3svc_decode_mknodargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_mknodargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;ftype
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;ftype
op_eq
id|NF3BLK
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3CHR
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3SOCK
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3FIFO
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|args-&gt;ftype
op_eq
id|NF3BLK
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3CHR
)paren
(brace
id|args-&gt;major
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;minor
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_renameargs
id|nfs3svc_decode_renameargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_renameargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;ffh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fname
comma
op_amp
id|args-&gt;flen
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tfh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tname
comma
op_amp
id|args-&gt;tlen
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_linkargs
id|nfs3svc_decode_linkargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_linkargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;ffh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tfh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tname
comma
op_amp
id|args-&gt;tlen
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_readdirargs
id|nfs3svc_decode_readdirargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readdirargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|args-&gt;cookie
)paren
suffix:semicolon
id|args-&gt;verf
op_assign
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
id|args-&gt;dircount
op_assign
op_complement
l_int|0
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_readdirplusargs
id|nfs3svc_decode_readdirplusargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readdirargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|args-&gt;cookie
)paren
suffix:semicolon
id|args-&gt;verf
op_assign
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
id|args-&gt;dircount
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_commitargs
id|nfs3svc_decode_commitargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_commitargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|args-&gt;offset
)paren
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR encode functions&n; */
multiline_comment|/*&n; * There must be an encoding function for void results so svc_process&n; * will work properly.&n; */
r_int
DECL|function|nfs3svc_encode_voidres
id|nfs3svc_encode_voidres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_void
op_star
id|dummy
)paren
(brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* GETATTR */
r_int
DECL|function|nfs3svc_encode_attrstat
id|nfs3svc_encode_attrstat
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_attrstat
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
op_logical_and
op_logical_neg
(paren
id|p
op_assign
id|encode_fattr3
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_dentry
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* SETATTR, REMOVE, RMDIR */
r_int
DECL|function|nfs3svc_encode_wccstat
id|nfs3svc_encode_wccstat
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_attrstat
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* LOOKUP */
r_int
DECL|function|nfs3svc_encode_diropres
id|nfs3svc_encode_diropres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_diropres
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
id|p
op_assign
id|encode_fh
c_func
(paren
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_dentry
)paren
suffix:semicolon
)brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;dirfh.fh_dentry
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* ACCESS */
r_int
DECL|function|nfs3svc_encode_accessres
id|nfs3svc_encode_accessres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_accessres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;access
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* READLINK */
r_int
DECL|function|nfs3svc_encode_readlinkres
id|nfs3svc_encode_readlinkres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readlinkres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;len
)paren
suffix:semicolon
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|resp-&gt;len
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* READ */
r_int
DECL|function|nfs3svc_encode_readres
id|nfs3svc_encode_readres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;eof
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
multiline_comment|/* xdr opaque count */
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* WRITE */
r_int
DECL|function|nfs3svc_encode_writeres
id|nfs3svc_encode_writeres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_writeres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;committed
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_sec
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_usec
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* CREATE, MKDIR, SYMLINK, MKNOD */
r_int
DECL|function|nfs3svc_encode_createres
id|nfs3svc_encode_createres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_diropres
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
id|p
op_assign
id|encode_fh
c_func
(paren
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_dentry
)paren
suffix:semicolon
)brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;dirfh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* RENAME */
r_int
DECL|function|nfs3svc_encode_renameres
id|nfs3svc_encode_renameres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_renameres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;ffh
)paren
suffix:semicolon
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;tfh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* LINK */
r_int
DECL|function|nfs3svc_encode_linkres
id|nfs3svc_encode_linkres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_linkres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_dentry
)paren
suffix:semicolon
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;tfh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* READDIR */
r_int
DECL|function|nfs3svc_encode_readdirres
id|nfs3svc_encode_readdirres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readdirres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
multiline_comment|/* stupid readdir cookie */
id|memcpy
c_func
(paren
id|p
comma
id|resp-&gt;verf
comma
l_int|8
)paren
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode a directory entry. This one works for both normal readdir&n; * and readdirplus.&n; * The normal readdir reply requires 2 (fileid) + 1 (stringlen)&n; * + string + 2 (cookie) + 1 (next) words, i.e. 6 + strlen.&n; * &n; * The readdirplus baggage is 1+21 words for post_op_attr, plus the&n; * file handle.&n; */
DECL|macro|NFS3_ENTRY_BAGGAGE
mdefine_line|#define NFS3_ENTRY_BAGGAGE&t;(2 + 1 + 2 + 1)
DECL|macro|NFS3_ENTRYPLUS_BAGGAGE
mdefine_line|#define NFS3_ENTRYPLUS_BAGGAGE&t;(1 + 21 + 1 + (NFS3_FHSIZE &gt;&gt; 2))
r_static
r_int
DECL|function|encode_entry
id|encode_entry
c_func
(paren
r_struct
id|readdir_cd
op_star
id|cd
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
comma
id|off_t
id|offset
comma
id|ino_t
id|ino
comma
r_int
r_int
id|d_type
comma
r_int
id|plus
)paren
(brace
id|u32
op_star
id|p
op_assign
id|cd-&gt;buffer
suffix:semicolon
r_int
id|buflen
comma
id|slen
comma
id|elen
suffix:semicolon
r_if
c_cond
(paren
id|cd-&gt;offset
)paren
id|xdr_encode_hyper
c_func
(paren
id|cd-&gt;offset
comma
(paren
id|u64
)paren
id|offset
)paren
suffix:semicolon
multiline_comment|/* nfsd_readdir calls us with name == 0 when it wants us to&n;&t; * set the last offset entry. */
r_if
c_cond
(paren
id|name
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;dprintk(&quot;encode_entry(%.*s @%ld%s)&bslash;n&quot;,&n;&t;&t;namlen, name, (long) offset, plus? &quot; plus&quot; : &quot;&quot;);&n;&t; */
multiline_comment|/* truncate filename if too long */
r_if
c_cond
(paren
id|namlen
OG
id|NFS3_MAXNAMLEN
)paren
id|namlen
op_assign
id|NFS3_MAXNAMLEN
suffix:semicolon
id|slen
op_assign
id|XDR_QUADLEN
c_func
(paren
id|namlen
)paren
suffix:semicolon
id|elen
op_assign
id|slen
op_plus
id|NFS3_ENTRY_BAGGAGE
op_plus
(paren
id|plus
ques
c_cond
id|NFS3_ENTRYPLUS_BAGGAGE
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buflen
op_assign
id|cd-&gt;buflen
op_minus
id|elen
)paren
OL
l_int|0
)paren
(brace
id|cd-&gt;eob
op_assign
l_int|1
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* mark entry present */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|ino
)paren
suffix:semicolon
multiline_comment|/* file id */
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|name
comma
id|namlen
)paren
suffix:semicolon
multiline_comment|/* name length &amp; name */
id|cd-&gt;offset
op_assign
id|p
suffix:semicolon
multiline_comment|/* remember pointer */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|NFS_OFFSET_MAX
)paren
suffix:semicolon
multiline_comment|/* offset of next entry */
multiline_comment|/* throw in readdirplus baggage */
r_if
c_cond
(paren
id|plus
)paren
(brace
r_struct
id|svc_fh
id|fh
suffix:semicolon
r_struct
id|svc_export
op_star
id|exp
suffix:semicolon
r_struct
id|dentry
op_star
id|dparent
comma
op_star
id|dchild
suffix:semicolon
id|dparent
op_assign
id|cd-&gt;dirfh-&gt;fh_dentry
suffix:semicolon
id|exp
op_assign
id|cd-&gt;dirfh-&gt;fh_export
suffix:semicolon
id|fh_init
c_func
(paren
op_amp
id|fh
comma
id|NFS3_FHSIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fh_verify
c_func
(paren
id|cd-&gt;rqstp
comma
id|cd-&gt;dirfh
comma
id|S_IFDIR
comma
id|MAY_EXEC
)paren
op_ne
l_int|0
)paren
r_goto
id|noexec
suffix:semicolon
r_if
c_cond
(paren
id|isdotent
c_func
(paren
id|name
comma
id|namlen
)paren
)paren
(brace
id|dchild
op_assign
id|dparent
suffix:semicolon
r_if
c_cond
(paren
id|namlen
op_eq
l_int|2
)paren
id|dchild
op_assign
id|dchild-&gt;d_parent
suffix:semicolon
id|dchild
op_assign
id|dget
c_func
(paren
id|dchild
)paren
suffix:semicolon
)brace
r_else
id|dchild
op_assign
id|lookup_one
c_func
(paren
id|name
comma
id|dparent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|dchild
)paren
)paren
r_goto
id|noexec
suffix:semicolon
r_if
c_cond
(paren
id|fh_compose
c_func
(paren
op_amp
id|fh
comma
id|exp
comma
id|dchild
)paren
op_ne
l_int|0
op_logical_or
op_logical_neg
id|dchild-&gt;d_inode
)paren
r_goto
id|noexec
suffix:semicolon
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|cd-&gt;rqstp
comma
id|p
comma
id|fh.fh_dentry
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* yes, a file handle follows */
id|p
op_assign
id|encode_fh
c_func
(paren
id|p
comma
op_amp
id|fh
)paren
suffix:semicolon
id|fh_put
c_func
(paren
op_amp
id|fh
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|cd-&gt;buflen
op_assign
id|buflen
suffix:semicolon
id|cd-&gt;buffer
op_assign
id|p
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|noexec
suffix:colon
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_encode_entry
id|nfs3svc_encode_entry
c_func
(paren
r_struct
id|readdir_cd
op_star
id|cd
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
comma
id|off_t
id|offset
comma
id|ino_t
id|ino
comma
r_int
r_int
id|d_type
)paren
(brace
r_return
id|encode_entry
c_func
(paren
id|cd
comma
id|name
comma
id|namlen
comma
id|offset
comma
id|ino
comma
id|d_type
comma
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_encode_entry_plus
id|nfs3svc_encode_entry_plus
c_func
(paren
r_struct
id|readdir_cd
op_star
id|cd
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
comma
id|off_t
id|offset
comma
id|ino_t
id|ino
comma
r_int
r_int
id|d_type
)paren
(brace
r_return
id|encode_entry
c_func
(paren
id|cd
comma
id|name
comma
id|namlen
comma
id|offset
comma
id|ino
comma
id|d_type
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* FSSTAT */
r_int
DECL|function|nfs3svc_encode_fsstatres
id|nfs3svc_encode_fsstatres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_fsstatres
op_star
id|resp
)paren
(brace
r_struct
id|statfs
op_star
id|s
op_assign
op_amp
id|resp-&gt;stats
suffix:semicolon
id|u64
id|bs
op_assign
id|s-&gt;f_bsize
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* no post_op_attr */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|bs
op_star
id|s-&gt;f_blocks
)paren
suffix:semicolon
multiline_comment|/* total bytes */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|bs
op_star
id|s-&gt;f_bfree
)paren
suffix:semicolon
multiline_comment|/* free bytes */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|bs
op_star
id|s-&gt;f_bavail
)paren
suffix:semicolon
multiline_comment|/* user available bytes */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|s-&gt;f_files
)paren
suffix:semicolon
multiline_comment|/* total inodes */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|s-&gt;f_ffree
)paren
suffix:semicolon
multiline_comment|/* free inodes */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|s-&gt;f_ffree
)paren
suffix:semicolon
multiline_comment|/* user available inodes */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;invarsec
)paren
suffix:semicolon
multiline_comment|/* mean unchanged time */
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* FSINFO */
r_int
DECL|function|nfs3svc_encode_fsinfores
id|nfs3svc_encode_fsinfores
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_fsinfores
op_star
id|resp
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* no post_op_attr */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_rtmax
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_rtpref
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_rtmult
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_wtmax
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_wtpref
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_wtmult
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_dtpref
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|resp-&gt;f_maxfilesize
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_properties
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* PATHCONF */
r_int
DECL|function|nfs3svc_encode_pathconfres
id|nfs3svc_encode_pathconfres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_pathconfres
op_star
id|resp
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* no post_op_attr */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_link_max
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_name_max
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_no_trunc
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_chown_restricted
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_case_insensitive
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_case_preserving
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* COMMIT */
r_int
DECL|function|nfs3svc_encode_commitres
id|nfs3svc_encode_commitres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_commitres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
multiline_comment|/* Write verifier */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_sec
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_usec
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR release functions&n; */
r_int
DECL|function|nfs3svc_release_fhandle
id|nfs3svc_release_fhandle
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_attrstat
op_star
id|resp
)paren
(brace
id|fh_put
c_func
(paren
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_release_fhandle2
id|nfs3svc_release_fhandle2
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_fhandle_pair
op_star
id|resp
)paren
(brace
id|fh_put
c_func
(paren
op_amp
id|resp-&gt;fh1
)paren
suffix:semicolon
id|fh_put
c_func
(paren
op_amp
id|resp-&gt;fh2
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
eof
