multiline_comment|/*&n; * linux/fs/nfsd/nfs3xdr.c&n; *&n; * XDR support for nfsd/protocol version 3.&n; *&n; * Copyright (C) 1995, 1996 Olaf Kirch &lt;okir@monad.swb.de&gt;&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/nfs3.h&gt;
macro_line|#include &lt;linux/sunrpc/xdr.h&gt;
macro_line|#include &lt;linux/sunrpc/svc.h&gt;
macro_line|#include &lt;linux/nfsd/nfsd.h&gt;
macro_line|#include &lt;linux/nfsd/xdr3.h&gt;
DECL|macro|NFSDDBG_FACILITY
mdefine_line|#define NFSDDBG_FACILITY&t;&t;NFSDDBG_XDR
DECL|variable|nfs_ok
DECL|variable|nfserr_perm
DECL|variable|nfserr_noent
DECL|variable|nfserr_io
DECL|variable|nfserr_nxio
id|u32
id|nfs_ok
comma
id|nfserr_perm
comma
id|nfserr_noent
comma
id|nfserr_io
comma
id|nfserr_nxio
comma
DECL|variable|nfserr_acces
DECL|variable|nfserr_exist
DECL|variable|nfserr_nodev
DECL|variable|nfserr_notdir
id|nfserr_acces
comma
id|nfserr_exist
comma
id|nfserr_nodev
comma
id|nfserr_notdir
comma
DECL|variable|nfserr_isdir
DECL|variable|nfserr_fbig
DECL|variable|nfserr_nospc
DECL|variable|nfserr_rofs
id|nfserr_isdir
comma
id|nfserr_fbig
comma
id|nfserr_nospc
comma
id|nfserr_rofs
comma
DECL|variable|nfserr_nametoolong
DECL|variable|nfserr_dquot
DECL|variable|nfserr_stale
id|nfserr_nametoolong
comma
id|nfserr_dquot
comma
id|nfserr_stale
suffix:semicolon
macro_line|#ifdef NFSD_OPTIMIZE_SPACE
DECL|macro|inline
macro_line|# define inline
macro_line|#endif
multiline_comment|/*&n; * Mapping of S_IF* types to NFS file types&n; */
DECL|variable|nfs3_ftypes
r_static
id|u32
id|nfs3_ftypes
(braket
)braket
op_assign
(brace
id|NF3NON
comma
id|NF3FIFO
comma
id|NF3CHR
comma
id|NF3BAD
comma
id|NF3DIR
comma
id|NF3BAD
comma
id|NF3BLK
comma
id|NF3BAD
comma
id|NF3REG
comma
id|NF3BAD
comma
id|NF3LNK
comma
id|NF3BAD
comma
id|NF3SOCK
comma
id|NF3BAD
comma
id|NF3LNK
comma
id|NF3BAD
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Initialization of NFS status variables&n; */
r_void
DECL|function|nfs3xdr_init
id|nfs3xdr_init
c_func
(paren
r_void
)paren
(brace
r_static
r_int
id|inited
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|inited
)paren
r_return
suffix:semicolon
id|nfs_ok
op_assign
id|htonl
c_func
(paren
id|NFS_OK
)paren
suffix:semicolon
id|nfserr_perm
op_assign
id|htonl
c_func
(paren
id|NFSERR_PERM
)paren
suffix:semicolon
id|nfserr_noent
op_assign
id|htonl
c_func
(paren
id|NFSERR_NOENT
)paren
suffix:semicolon
id|nfserr_io
op_assign
id|htonl
c_func
(paren
id|NFSERR_IO
)paren
suffix:semicolon
id|nfserr_nxio
op_assign
id|htonl
c_func
(paren
id|NFSERR_NXIO
)paren
suffix:semicolon
id|nfserr_acces
op_assign
id|htonl
c_func
(paren
id|NFSERR_ACCES
)paren
suffix:semicolon
id|nfserr_exist
op_assign
id|htonl
c_func
(paren
id|NFSERR_EXIST
)paren
suffix:semicolon
id|nfserr_nodev
op_assign
id|htonl
c_func
(paren
id|NFSERR_NODEV
)paren
suffix:semicolon
id|nfserr_notdir
op_assign
id|htonl
c_func
(paren
id|NFSERR_NOTDIR
)paren
suffix:semicolon
id|nfserr_isdir
op_assign
id|htonl
c_func
(paren
id|NFSERR_ISDIR
)paren
suffix:semicolon
id|nfserr_fbig
op_assign
id|htonl
c_func
(paren
id|NFSERR_FBIG
)paren
suffix:semicolon
id|nfserr_nospc
op_assign
id|htonl
c_func
(paren
id|NFSERR_NOSPC
)paren
suffix:semicolon
id|nfserr_rofs
op_assign
id|htonl
c_func
(paren
id|NFSERR_ROFS
)paren
suffix:semicolon
id|nfserr_nametoolong
op_assign
id|htonl
c_func
(paren
id|NFSERR_NAMETOOLONG
)paren
suffix:semicolon
id|nfserr_dquot
op_assign
id|htonl
c_func
(paren
id|NFSERR_DQUOT
)paren
suffix:semicolon
id|nfserr_stale
op_assign
id|htonl
c_func
(paren
id|NFSERR_STALE
)paren
suffix:semicolon
id|inited
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR functions for basic NFS types&n; */
r_static
r_inline
id|u32
op_star
DECL|function|enc64
id|enc64
c_func
(paren
id|u32
op_star
id|p
comma
id|u64
id|val
)paren
(brace
op_star
id|p
op_increment
op_assign
(paren
id|val
op_rshift
l_int|32
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
(paren
id|val
op_amp
l_int|0xffffffff
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|dec64
id|dec64
c_func
(paren
id|u32
op_star
id|p
comma
id|u64
op_star
id|valp
)paren
(brace
op_star
id|valp
op_assign
(paren
(paren
id|u64
)paren
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
op_lshift
l_int|32
suffix:semicolon
op_star
id|valp
op_or_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_time3
id|encode_time3
c_func
(paren
id|u32
op_star
id|p
comma
id|time_t
id|secs
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|secs
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_time3
id|decode_time3
c_func
(paren
id|u32
op_star
id|p
comma
id|time_t
op_star
id|secp
)paren
(brace
op_star
id|secp
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|p
op_plus
l_int|1
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_fh
id|decode_fh
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_if
c_cond
(paren
op_star
id|p
op_increment
op_ne
r_sizeof
(paren
r_struct
id|knfs_fh
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|fhp-&gt;fh_handle
comma
id|p
comma
r_sizeof
(paren
r_struct
id|knfs_fh
)paren
)paren
suffix:semicolon
id|fhp-&gt;fh_inode
op_assign
l_int|NULL
suffix:semicolon
id|fhp-&gt;fh_export
op_assign
l_int|NULL
suffix:semicolon
r_return
id|p
op_plus
(paren
r_sizeof
(paren
r_struct
id|knfs_fh
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_fh
id|encode_fh
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
r_sizeof
(paren
r_struct
id|knfs_fh
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
op_amp
id|fhp-&gt;fh_handle
comma
r_sizeof
(paren
r_struct
id|knfs_fh
)paren
)paren
suffix:semicolon
r_return
id|p
op_plus
(paren
r_sizeof
(paren
r_struct
id|knfs_fh
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode a file name and make sure that the path contains&n; * no slashes or null bytes.&n; */
r_static
r_inline
id|u32
op_star
DECL|function|decode_filename
id|decode_filename
c_func
(paren
id|u32
op_star
id|p
comma
r_char
op_star
op_star
id|namp
comma
r_int
op_star
id|lenp
)paren
(brace
r_char
op_star
id|name
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|xdr_decode_string
c_func
(paren
id|p
comma
id|namp
comma
id|lenp
comma
id|NFS3_MAXNAMLEN
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|name
op_assign
op_star
id|namp
suffix:semicolon
id|i
OL
op_star
id|lenp
suffix:semicolon
id|i
op_increment
comma
id|name
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|name
op_eq
l_char|&squot;&bslash;0&squot;
op_logical_or
op_star
id|name
op_eq
l_char|&squot;/&squot;
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|name
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_pathname
id|decode_pathname
c_func
(paren
id|u32
op_star
id|p
comma
r_char
op_star
op_star
id|namp
comma
r_int
op_star
id|lenp
)paren
(brace
r_char
op_star
id|name
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|xdr_decode_string
c_func
(paren
id|p
comma
id|namp
comma
id|lenp
comma
id|NFS3_MAXPATHLEN
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|name
op_assign
op_star
id|namp
suffix:semicolon
id|i
OL
op_star
id|lenp
suffix:semicolon
id|i
op_increment
comma
id|name
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|name
op_eq
l_char|&squot;&bslash;0&squot;
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|name
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_sattr3
id|decode_sattr3
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|iattr
op_star
id|iap
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|iap-&gt;ia_valid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_MODE
suffix:semicolon
id|iap-&gt;ia_mode
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_UID
suffix:semicolon
id|iap-&gt;ia_uid
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_GID
suffix:semicolon
id|iap-&gt;ia_gid
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_SIZE
suffix:semicolon
id|iap-&gt;ia_size
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp
op_assign
op_star
id|p
op_increment
)paren
op_eq
l_int|1
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_ATIME
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tmp
op_eq
l_int|2
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_ATIME
op_or
id|ATTR_ATIME_SET
suffix:semicolon
id|iap-&gt;ia_atime
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
comma
id|p
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp
op_assign
op_star
id|p
op_increment
)paren
op_ne
l_int|0
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_MTIME
op_or
id|ATTR_MTIME_SET
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tmp
op_eq
l_int|2
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_MTIME
suffix:semicolon
id|iap-&gt;ia_mtime
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
comma
id|p
op_increment
suffix:semicolon
)brace
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_fattr3
id|encode_fattr3
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;nfsd: NULL inode in %s:%d&quot;
comma
id|__FILE__
comma
id|__LINE__
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfs3_ftypes
(braket
(paren
id|inode-&gt;i_mode
op_amp
id|S_IFMT
)paren
op_rshift
l_int|12
)braket
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|inode-&gt;i_mode
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|inode-&gt;i_nlink
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|nfsd_ruid
c_func
(paren
id|rqstp
comma
id|inode-&gt;i_uid
)paren
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|nfsd_rgid
c_func
(paren
id|rqstp
comma
id|inode-&gt;i_gid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|inode-&gt;i_mode
)paren
op_logical_and
id|inode-&gt;i_size
OG
id|NFS3_MAXPATHLEN
)paren
(brace
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|NFS3_MAXPATHLEN
)paren
suffix:semicolon
)brace
r_else
(brace
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|inode-&gt;i_size
)paren
suffix:semicolon
)brace
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
id|inode-&gt;i_blksize
op_star
id|inode-&gt;i_blocks
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|MAJOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|inode-&gt;i_dev
)paren
suffix:semicolon
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|inode-&gt;i_ino
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|inode-&gt;i_atime
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|inode-&gt;i_mtime
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|inode-&gt;i_ctime
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode post-operation attributes.&n; * The inode may be NULL if the call failed because of a stale file&n; * handle. In this case, no attributes are returned.&n; */
r_static
id|u32
op_star
DECL|function|encode_post_op_attr
id|encode_post_op_attr
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_if
c_cond
(paren
id|inode
op_eq
l_int|NULL
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_return
id|encode_fattr3
c_func
(paren
id|rqstp
comma
id|p
comma
id|inode
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Enocde weak cache consistency data&n; */
r_static
id|u32
op_star
DECL|function|encode_wcc_data
id|encode_wcc_data
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|fhp-&gt;fh_inode
suffix:semicolon
r_if
c_cond
(paren
id|fhp-&gt;fh_post_version
op_eq
id|inode-&gt;i_version
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|fhp-&gt;fh_pre_size
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|fhp-&gt;fh_pre_mtime
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
id|fhp-&gt;fh_pre_ctime
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
)brace
r_return
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|inode
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Check buffer bounds after decoding arguments&n; */
r_static
r_inline
r_int
DECL|function|xdr_argsize_check
id|xdr_argsize_check
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
)paren
(brace
r_struct
id|svc_buf
op_star
id|buf
op_assign
op_amp
id|rqstp-&gt;rq_argbuf
suffix:semicolon
r_return
id|p
op_minus
id|buf-&gt;base
op_le
id|buf-&gt;buflen
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|xdr_ressize_check
id|xdr_ressize_check
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
)paren
(brace
r_struct
id|svc_buf
op_star
id|buf
op_assign
op_amp
id|rqstp-&gt;rq_resbuf
suffix:semicolon
id|buf-&gt;len
op_assign
id|p
op_minus
id|buf-&gt;base
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;nfsd: ressize_check p %p base %p len %d&bslash;n&quot;
comma
id|p
comma
id|buf-&gt;base
comma
id|buf-&gt;buflen
)paren
suffix:semicolon
r_return
(paren
id|buf-&gt;len
op_le
id|buf-&gt;buflen
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR decode functions&n; */
r_int
DECL|function|nfs3svc_decode_fhandle
id|nfs3svc_decode_fhandle
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
id|fhp
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_sattrargs
id|nfs3svc_decode_sattrargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_sattrargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
op_logical_or
(paren
op_star
id|p
op_increment
op_logical_and
op_logical_neg
(paren
id|p
op_assign
id|decode_time3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;guardtime
)paren
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_diropargs
id|nfs3svc_decode_diropargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_diropargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_accessargs
id|nfs3svc_decode_accessargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_accessargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;access
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_readargs
id|nfs3svc_decode_readargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|dec64
c_func
(paren
id|p
comma
op_amp
id|args-&gt;offset
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|dec64
c_func
(paren
id|p
comma
op_amp
id|args-&gt;count
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_writeargs
id|nfs3svc_decode_writeargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_writeargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|dec64
c_func
(paren
id|p
comma
op_amp
id|args-&gt;offset
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|dec64
c_func
(paren
id|p
comma
op_amp
id|args-&gt;count
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;stable
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;data
op_assign
(paren
r_char
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
(paren
id|args-&gt;len
op_plus
l_int|3
)paren
op_rshift
l_int|2
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_createargs
id|nfs3svc_decode_createargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_createargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|args-&gt;createmode
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|args-&gt;verf
op_assign
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_mkdirargs
id|nfs3svc_decode_mkdirargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_createargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_symlinkargs
id|nfs3svc_decode_symlinkargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_symlinkargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;ffh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fname
comma
op_amp
id|args-&gt;flen
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_pathname
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tname
comma
op_amp
id|args-&gt;tlen
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_mknodargs
id|nfs3svc_decode_mknodargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_mknodargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;ftype
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;ftype
op_eq
id|NF3BLK
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3CHR
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3SOCK
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3FIFO
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|args-&gt;ftype
op_eq
id|NF3BLK
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3CHR
)paren
(brace
id|args-&gt;major
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;minor
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_renameargs
id|nfs3svc_decode_renameargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_renameargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;ffh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fname
comma
op_amp
id|args-&gt;flen
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tfh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tname
comma
op_amp
id|args-&gt;tlen
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_linkargs
id|nfs3svc_decode_linkargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_linkargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;ffh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tfh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tname
comma
op_amp
id|args-&gt;tlen
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_readdirargs
id|nfs3svc_decode_readdirargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readdirargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;cookie
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;verf
op_assign
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_readdirplusargs
id|nfs3svc_decode_readdirplusargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readdirargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;cookie
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;verf
op_assign
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
id|args-&gt;dircount
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_commitargs
id|nfs3svc_decode_commitargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_commitargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|dec64
c_func
(paren
id|p
comma
op_amp
id|args-&gt;offset
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR encode functions&n; */
multiline_comment|/* GETATTR */
r_int
DECL|function|nfs3svc_encode_attrstat
id|nfs3svc_encode_attrstat
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_attrstat
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|encode_fattr3
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_inode
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* SETATTR, REMOVE, RMDIR */
r_int
DECL|function|nfs3svc_encode_wccstat
id|nfs3svc_encode_wccstat
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_attrstat
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* LOOKUP */
r_int
DECL|function|nfs3svc_encode_lookupres
id|nfs3svc_encode_lookupres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_lookupres
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
id|p
op_assign
id|encode_fh
c_func
(paren
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|encode_fattr3
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_inode
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;dirfh.fh_inode
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* ACCESS */
r_int
DECL|function|nfs3svc_encode_accessres
id|nfs3svc_encode_accessres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_accessres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;access
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* READLINK */
r_int
DECL|function|nfs3svc_encode_readlinkres
id|nfs3svc_encode_readlinkres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readlinkres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;len
)paren
suffix:semicolon
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|resp-&gt;len
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* READ */
r_int
DECL|function|nfs3svc_encode_readres
id|nfs3svc_encode_readres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;eof
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
multiline_comment|/* xdr opaque count */
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* WRITE */
r_int
DECL|function|nfs3svc_encode_writeres
id|nfs3svc_encode_writeres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_writeres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;committed
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_sec
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_usec
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* CREATE, MKDIR, SYMLINK, MKNOD */
r_int
DECL|function|nfs3svc_encode_createres
id|nfs3svc_encode_createres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_createres
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
id|p
op_assign
id|encode_fh
c_func
(paren
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_inode
)paren
suffix:semicolon
)brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;dirfh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* RENAME */
r_int
DECL|function|nfs3svc_encode_renameres
id|nfs3svc_encode_renameres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_renameres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;ffh
)paren
suffix:semicolon
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;tfh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* LINK */
r_int
DECL|function|nfs3svc_encode_linkres
id|nfs3svc_encode_linkres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_linkres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_inode
)paren
suffix:semicolon
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;tfh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* READDIR */
r_int
DECL|function|nfs3svc_encode_readdirres
id|nfs3svc_encode_readdirres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readdirres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|resp-&gt;fh.fh_inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
multiline_comment|/* stupid readdir cookie */
op_star
id|p
op_increment
op_assign
id|ntohl
c_func
(paren
id|resp-&gt;fh.fh_inode-&gt;i_mtime
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
id|p
op_assign
id|resp-&gt;list_end
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
DECL|macro|NFS3_ENTRYPLUS_BAGGAGE
mdefine_line|#define NFS3_ENTRYPLUS_BAGGAGE&t;((1 + 20 + 1 + NFS3_FHSIZE) &lt;&lt; 2)
r_int
DECL|function|nfs3svc_encode_entry
id|nfs3svc_encode_entry
c_func
(paren
r_struct
id|readdir_cd
op_star
id|cd
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
comma
r_int
r_int
id|offset
comma
id|ino_t
id|ino
)paren
(brace
id|u32
op_star
id|p
op_assign
id|cd-&gt;buffer
suffix:semicolon
r_int
id|buflen
comma
id|slen
comma
id|elen
suffix:semicolon
r_struct
id|svc_fh
id|fh
suffix:semicolon
r_if
c_cond
(paren
id|offset
OG
op_complement
(paren
(paren
id|u64
)paren
l_int|0
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cd-&gt;offset
)paren
op_star
id|cd-&gt;offset
op_assign
id|htonl
c_func
(paren
id|offset
)paren
suffix:semicolon
multiline_comment|/* For readdirplus, look up the inode */
r_if
c_cond
(paren
id|cd-&gt;plus
op_logical_and
id|nfsd_lookup
c_func
(paren
id|cd-&gt;rqstp
comma
id|cd-&gt;dirfh
comma
id|name
comma
id|namlen
comma
op_amp
id|fh
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* truncate filename if too long */
r_if
c_cond
(paren
id|namlen
OG
id|NFS3_MAXNAMLEN
)paren
id|namlen
op_assign
id|NFS3_MAXNAMLEN
suffix:semicolon
id|slen
op_assign
id|XDR_QUADLEN
c_func
(paren
id|namlen
)paren
suffix:semicolon
id|elen
op_assign
id|slen
op_plus
(paren
id|cd-&gt;plus
ques
c_cond
id|NFS3_ENTRYPLUS_BAGGAGE
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buflen
op_assign
id|cd-&gt;buflen
op_minus
id|elen
op_minus
l_int|4
)paren
OL
l_int|0
)paren
(brace
id|cd-&gt;eob
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cd-&gt;plus
)paren
id|fh_put
c_func
(paren
op_amp
id|fh
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* mark entry present */
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* file id (64 bit) */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|ino
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|namlen
)paren
suffix:semicolon
multiline_comment|/* name length &amp; name */
id|memcpy
c_func
(paren
id|p
comma
id|name
comma
id|namlen
)paren
suffix:semicolon
id|p
op_add_assign
id|slen
suffix:semicolon
multiline_comment|/* throw in readdirplus baggage */
r_if
c_cond
(paren
id|cd-&gt;plus
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|cd-&gt;rqstp
comma
id|p
comma
id|fh.fh_inode
)paren
suffix:semicolon
id|p
op_assign
id|encode_fh
c_func
(paren
id|p
comma
op_amp
id|fh
)paren
suffix:semicolon
id|fh_put
c_func
(paren
op_amp
id|fh
)paren
suffix:semicolon
)brace
id|cd-&gt;offset
op_assign
id|p
suffix:semicolon
multiline_comment|/* remember pointer */
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
op_complement
(paren
id|u64
)paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* offset of next entry */
id|cd-&gt;buflen
op_assign
id|buflen
suffix:semicolon
id|cd-&gt;buffer
op_assign
id|p
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* FSSTAT */
r_int
DECL|function|nfs3svc_encode_statfsres
id|nfs3svc_encode_statfsres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_statfsres
op_star
id|resp
)paren
(brace
r_struct
id|statfs
op_star
id|s
op_assign
op_amp
id|resp-&gt;stats
suffix:semicolon
id|u64
id|bs
op_assign
id|s-&gt;f_bsize
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* no post_op_attr */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
id|bs
op_star
id|s-&gt;f_blocks
)paren
suffix:semicolon
multiline_comment|/* total bytes */
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
id|bs
op_star
id|s-&gt;f_bfree
)paren
suffix:semicolon
multiline_comment|/* free bytes */
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
id|bs
op_star
id|s-&gt;f_bavail
)paren
suffix:semicolon
multiline_comment|/* user available bytes */
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
id|s-&gt;f_files
)paren
suffix:semicolon
multiline_comment|/* total inodes */
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
id|s-&gt;f_ffree
)paren
suffix:semicolon
multiline_comment|/* free inodes */
id|p
op_assign
id|enc64
c_func
(paren
id|p
comma
id|s-&gt;f_ffree
)paren
suffix:semicolon
multiline_comment|/* user available inodes */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;invarsec
)paren
suffix:semicolon
multiline_comment|/* mean unchanged time */
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* FSINFO */
r_int
DECL|function|nfs3svc_encode_fsinfores
id|nfs3svc_encode_fsinfores
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_fsinfores
op_star
id|resp
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* no post_op_attr */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_rtmax
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_rtpref
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_rtmult
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_wtmax
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_wtpref
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_wtmult
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_dtpref
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_maxfilesize
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
l_int|1000000000
op_div
id|HZ
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_properties
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* PATHCONF */
r_int
DECL|function|nfs3svc_encode_pathconfres
id|nfs3svc_encode_pathconfres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_pathconfres
op_star
id|resp
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* no post_op_attr */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_link_max
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_name_max
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* always reject long file names */
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* chown restricted */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_case_insensitive
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_case_preserving
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* COMMIT */
r_int
DECL|function|nfs3svc_encode_commitres
id|nfs3svc_encode_commitres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_commitres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
multiline_comment|/* Write verifier */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_sec
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_usec
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR release functions&n; */
r_int
DECL|function|nfs3svc_release_fhandle
id|nfs3svc_release_fhandle
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd_fhandle
op_star
id|resp
)paren
(brace
id|fh_put
c_func
(paren
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_release_fhandle2
id|nfs3svc_release_fhandle2
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_fhandle2
op_star
id|resp
)paren
(brace
id|fh_put
c_func
(paren
op_amp
id|resp-&gt;fh1
)paren
suffix:semicolon
id|fh_put
c_func
(paren
op_amp
id|resp-&gt;fh2
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
eof
