multiline_comment|/*&n; * linux/fs/nfsd/stats.c&n; *&n; * procfs-based user access to knfsd statistics&n; *&n; * /proc/net/rpc/nfsd&n; *&n; * Format:&n; *&t;rc &lt;hits&gt; &lt;misses&gt; &lt;nocache&gt;&n; *&t;&t;&t;Statistsics for the reply cache&n; *&t;fh &lt;stale&gt; &lt;total-lookups&gt; &lt;anonlookups&gt; &lt;dir-not-in-dcache&gt; &lt;nondir-not-in-dcache&gt;&n; *&t;&t;&t;statistics for filehandle lookup&n; *&t;io &lt;bytes-read&gt; &lt;bytes-writtten&gt;&n; *&t;&t;&t;statistics for IO throughput&n; *&t;th &lt;threads&gt; &lt;fullcnt&gt; &lt;10%-20%&gt; &lt;20%-30%&gt; ... &lt;90%-100%&gt; &lt;100%&gt; &n; *&t;&t;&t;time (seconds) when nfsd thread usage above thresholds&n; *&t;&t;&t;and number of times that all threads were in use&n; *&t;ra cache-size  &lt;10%  &lt;20%  &lt;30% ... &lt;100% not-found&n; *&t;&t;&t;number of times that read-ahead entry was found that deep in&n; *&t;&t;&t;the cache.&n; *&t;plus generic RPC stats (see net/sunrpc/stats.c)&n; *&n; * Copyright (C) 1995, 1996, 1997 Olaf Kirch &lt;okir@monad.swb.de&gt;&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sunrpc/svc.h&gt;
macro_line|#include &lt;linux/sunrpc/stats.h&gt;
macro_line|#include &lt;linux/nfsd/nfsd.h&gt;
macro_line|#include &lt;linux/nfsd/stats.h&gt;
DECL|variable|nfsdstats
r_struct
id|nfsd_stats
id|nfsdstats
suffix:semicolon
DECL|variable|nfsd_svcstats
r_struct
id|svc_stat
id|nfsd_svcstats
op_assign
(brace
op_amp
id|nfsd_program
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|nfsd_proc_read
id|nfsd_proc_read
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|len
suffix:semicolon
r_int
id|i
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;rc %u %u %u&bslash;nfh %u %u %u %u %u&bslash;nio %u %u&bslash;n&quot;
comma
id|nfsdstats.rchits
comma
id|nfsdstats.rcmisses
comma
id|nfsdstats.rcnocache
comma
id|nfsdstats.fh_stale
comma
id|nfsdstats.fh_lookup
comma
id|nfsdstats.fh_anon
comma
id|nfsdstats.fh_nocache_dir
comma
id|nfsdstats.fh_nocache_nondir
comma
id|nfsdstats.io_read
comma
id|nfsdstats.io_write
)paren
suffix:semicolon
multiline_comment|/* thread usage: */
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;th %u %u&quot;
comma
id|nfsdstats.th_cnt
comma
id|nfsdstats.th_fullcnt
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|jifs
op_assign
id|nfsdstats.th_usage
(braket
id|i
)braket
suffix:semicolon
r_int
r_int
id|sec
op_assign
id|jifs
op_div
id|HZ
comma
id|msec
op_assign
(paren
id|jifs
op_mod
id|HZ
)paren
op_star
l_int|1000
op_div
id|HZ
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; %u.%03u&quot;
comma
id|sec
comma
id|msec
)paren
suffix:semicolon
)brace
multiline_comment|/* newline and ra-cache */
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;nra %u&quot;
comma
id|nfsdstats.ra_size
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|11
suffix:semicolon
id|i
op_increment
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; %u&quot;
comma
id|nfsdstats.ra_depth
(braket
id|i
)braket
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Assume we haven&squot;t hit EOF yet. Will be set by svc_proc_read. */
op_star
id|eof
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Append generic nfsd RPC statistics if there&squot;s room for it.&n;&t; */
r_if
c_cond
(paren
id|len
op_le
id|offset
)paren
(brace
id|len
op_assign
id|svc_proc_read
c_func
(paren
id|buffer
comma
id|start
comma
id|offset
op_minus
id|len
comma
id|count
comma
id|eof
comma
id|data
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
id|count
)paren
(brace
id|len
op_add_assign
id|svc_proc_read
c_func
(paren
id|buffer
op_plus
id|len
comma
id|start
comma
l_int|0
comma
id|count
op_minus
id|len
comma
id|eof
comma
id|data
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|offset
op_ge
id|len
)paren
(brace
op_star
id|start
op_assign
id|buffer
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_sub_assign
id|offset
)paren
OG
id|count
)paren
r_return
id|count
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_void
DECL|function|nfsd_stat_init
id|nfsd_stat_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|ent
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ent
op_assign
id|svc_proc_register
c_func
(paren
op_amp
id|nfsd_svcstats
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|ent-&gt;read_proc
op_assign
id|nfsd_proc_read
suffix:semicolon
id|ent-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
)brace
)brace
r_void
DECL|function|nfsd_stat_shutdown
id|nfsd_stat_shutdown
c_func
(paren
r_void
)paren
(brace
id|svc_proc_unregister
c_func
(paren
l_string|&quot;nfsd&quot;
)paren
suffix:semicolon
)brace
eof
