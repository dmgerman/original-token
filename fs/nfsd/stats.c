multiline_comment|/*&n; * nfsstat.c&t;procfs-based user access to knfsd statistics&n; *&n; * /proc/net/nfssrv&n; * Format:&n; *&t;net &lt;packets&gt; &lt;udp&gt; &lt;tcp&gt; &lt;tcpconn&gt;&n; *&t;rpc &lt;packets&gt; &lt;badfmt&gt; &lt;badclnt&gt;&n; *&t;auth &lt;flavor&gt; &lt;creds&gt; &lt;upcalls&gt; &lt;badauth&gt; &lt;badverf&gt; &lt;authrej&gt;&n; *&t;fh  &lt;hits&gt; &lt;misses&gt; &lt;avg_util&gt; &lt;stale&gt; &lt;cksum&gt; &lt;badcksum&gt;&n; *&t;rc &lt;hits&gt; &lt;misses&gt; &lt;nocache&gt;&n; *&t;proto &lt;version&gt; &lt;nrprocs&gt;&n; *&t;&lt;calls&gt; &lt;time_msec&gt;&n; *&t;... (for each procedure and protocol version)&n; *&n; * Copyright (C) 1995, 1996 Olaf Kirch &lt;okir@monad.swb.de&gt;&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/sunrpc/svc.h&gt;
macro_line|#include &lt;linux/sunrpc/stats.h&gt;
macro_line|#include &lt;linux/nfsd/nfsd.h&gt;
macro_line|#include &lt;linux/nfsd/stats.h&gt;
DECL|variable|nfsdstats
r_struct
id|nfsd_stats
id|nfsdstats
suffix:semicolon
r_static
r_int
id|nfsd_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
macro_line|#ifndef PROC_NET_NFSSRV
DECL|macro|PROC_NET_NFSSRV
macro_line|# define PROC_NET_NFSSRV&t;0
macro_line|#endif
DECL|variable|proc_nfssrv
r_static
r_struct
id|proc_dir_entry
id|proc_nfssrv
op_assign
(brace
id|PROC_NET_NFSSRV
comma
l_int|4
comma
l_string|&quot;nfsd&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|6
comma
op_amp
id|proc_net_inode_operations
comma
id|nfsd_get_info
)brace
suffix:semicolon
DECL|variable|nfsd_svcstats
r_struct
id|svc_stat
id|nfsd_svcstats
op_assign
(brace
l_int|NULL
comma
op_amp
id|proc_nfssrv
comma
op_amp
id|nfsd_program
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|nfsd_get_info
id|nfsd_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_int
id|len
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;rc %d %d %d&bslash;n&quot;
comma
id|nfsdstats.rchits
comma
id|nfsdstats.rcmisses
comma
id|nfsdstats.rcnocache
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Append generic nfsd RPC statistics&n;&t; */
r_if
c_cond
(paren
id|offset
op_ge
id|len
)paren
(brace
id|offset
op_sub_assign
id|len
suffix:semicolon
id|len
op_assign
id|svcstat_get_info
c_func
(paren
op_amp
id|nfsd_svcstats
comma
id|buffer
comma
id|start
comma
id|offset
comma
id|length
)paren
suffix:semicolon
macro_line|#if 0
)brace
r_else
r_if
c_cond
(paren
id|len
OL
id|length
)paren
(brace
id|len
op_assign
id|svcstat_get_info
c_func
(paren
op_amp
id|nfsd_svcstats
comma
id|buffer
op_plus
id|len
comma
id|start
comma
id|offset
op_minus
id|len
comma
id|length
op_minus
id|len
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|offset
op_ge
id|len
)paren
(brace
op_star
id|start
op_assign
id|buffer
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_sub_assign
id|offset
)paren
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_void
DECL|function|nfsd_stat_init
id|nfsd_stat_init
c_func
(paren
r_void
)paren
(brace
id|svcstat_register
c_func
(paren
op_amp
id|nfsd_svcstats
)paren
suffix:semicolon
)brace
r_void
DECL|function|nfsd_stat_shutdown
id|nfsd_stat_shutdown
c_func
(paren
r_void
)paren
(brace
id|svcstat_unregister
c_func
(paren
op_amp
id|nfsd_svcstats
)paren
suffix:semicolon
)brace
eof
