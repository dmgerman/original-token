multiline_comment|/*&n; *  linux/fs/affs/bitmap.c&n; *&n; *  (c) 1996 Hans-Joachim Widmaier&n; */
multiline_comment|/* bitmap.c contains the code that handles the inode and block bitmaps */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/affs_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/amigaffs.h&gt;
macro_line|#include &lt;linux/locks.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
DECL|variable|nibblemap
r_static
r_int
id|nibblemap
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|2
comma
l_int|1
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|1
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|2
comma
l_int|3
comma
l_int|3
comma
l_int|4
)brace
suffix:semicolon
r_int
DECL|function|affs_count_free_bits
id|affs_count_free_bits
c_func
(paren
r_int
id|blocksize
comma
r_const
id|UBYTE
op_star
id|data
)paren
(brace
r_int
id|free
suffix:semicolon
r_int
id|i
suffix:semicolon
id|free
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|blocksize
suffix:semicolon
id|i
op_increment
)paren
(brace
id|free
op_add_assign
id|nibblemap
(braket
id|data
(braket
id|i
)braket
op_amp
l_int|0xF
)braket
op_plus
id|nibblemap
(braket
(paren
id|data
(braket
id|i
)braket
op_rshift
l_int|4
)paren
op_amp
l_int|0xF
)braket
suffix:semicolon
)brace
r_return
id|free
suffix:semicolon
)brace
r_int
DECL|function|affs_count_free_blocks
id|affs_count_free_blocks
c_func
(paren
r_struct
id|super_block
op_star
id|s
)paren
(brace
r_int
id|free
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;AFFS: count_free_blocks()&bslash;n&quot;
)paren
suffix:semicolon
id|free
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;u.affs_sb.s_flags
op_amp
id|SF_BM_VALID
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|s-&gt;u.affs_sb.s_bm_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|free
op_add_assign
id|s-&gt;u.affs_sb.s_bitmap
(braket
id|i
)braket
dot
id|bm_free
suffix:semicolon
)brace
)brace
r_return
id|free
suffix:semicolon
)brace
r_void
DECL|function|affs_free_block
id|affs_free_block
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
id|LONG
id|block
)paren
(brace
r_int
id|bmap
suffix:semicolon
r_int
id|bit
suffix:semicolon
id|ULONG
id|blk
suffix:semicolon
r_struct
id|affs_bm_info
op_star
id|bm
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;AFFS: free_block(%d)&bslash;n&quot;
comma
id|block
)paren
suffix:semicolon
id|blk
op_assign
id|block
op_minus
id|sb-&gt;u.affs_sb.s_reserved
suffix:semicolon
id|bmap
op_assign
id|blk
op_div
(paren
id|sb-&gt;s_blocksize
op_star
l_int|8
op_minus
l_int|32
)paren
suffix:semicolon
id|bit
op_assign
id|blk
op_mod
(paren
id|sb-&gt;s_blocksize
op_star
l_int|8
op_minus
l_int|32
)paren
suffix:semicolon
id|bm
op_assign
op_amp
id|sb-&gt;u.affs_sb.s_bitmap
(braket
id|bmap
)braket
suffix:semicolon
r_if
c_cond
(paren
id|bmap
op_ge
id|sb-&gt;u.affs_sb.s_bm_count
op_logical_or
id|bit
op_ge
id|bm-&gt;bm_size
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AFFS: free_block(): block %d outside partition.&bslash;n&quot;
comma
id|block
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|blk
op_assign
l_int|0
suffix:semicolon
id|set_bit
c_func
(paren
id|bit
op_amp
l_int|31
comma
op_amp
id|blk
)paren
suffix:semicolon
id|lock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|set_bit
c_func
(paren
id|bit
op_xor
id|BO_EXBITS
comma
id|bm-&gt;bm_bh-&gt;b_data
op_plus
l_int|4
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;AFFS: free_block(): block %d is already free.&bslash;n&quot;
comma
id|block
)paren
suffix:semicolon
r_else
(brace
id|bm-&gt;bm_free
op_increment
suffix:semicolon
(paren
(paren
id|ULONG
op_star
)paren
id|bm-&gt;bm_bh-&gt;b_data
)paren
(braket
l_int|0
)braket
op_assign
id|ntohl
c_func
(paren
id|htonl
c_func
(paren
(paren
(paren
id|ULONG
op_star
)paren
id|bm-&gt;bm_bh-&gt;b_data
)paren
(braket
l_int|0
)braket
)paren
op_minus
id|blk
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|bm-&gt;bm_bh
comma
l_int|1
)paren
suffix:semicolon
id|sb-&gt;s_dirt
op_assign
l_int|1
suffix:semicolon
)brace
id|unlock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
)brace
r_static
id|ULONG
DECL|function|affs_balloc
id|affs_balloc
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|zone_no
)paren
(brace
id|ULONG
id|w
suffix:semicolon
id|ULONG
op_star
id|bm
suffix:semicolon
r_int
id|fb
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|fwb
suffix:semicolon
id|ULONG
id|block
suffix:semicolon
r_struct
id|affs_zone
op_star
id|zone
suffix:semicolon
r_struct
id|super_block
op_star
id|sb
suffix:semicolon
id|sb
op_assign
id|inode-&gt;i_sb
suffix:semicolon
id|zone
op_assign
op_amp
id|sb-&gt;u.affs_sb.s_zones
(braket
id|zone_no
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|zone
op_logical_or
op_logical_neg
id|zone-&gt;z_bm
op_logical_or
op_logical_neg
id|zone-&gt;z_bm-&gt;bm_bh
)paren
r_return
l_int|0
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;AFFS: balloc(inode=%lu,zone=%d)&bslash;n&quot;
comma
id|inode-&gt;i_ino
comma
id|zone_no
)paren
suffix:semicolon
id|bm
op_assign
(paren
id|ULONG
op_star
)paren
id|zone-&gt;z_bm-&gt;bm_bh-&gt;b_data
suffix:semicolon
id|repeat
suffix:colon
id|fb
op_assign
(paren
id|zone-&gt;z_bm-&gt;bm_size
op_plus
l_int|31
)paren
op_rshift
l_int|5
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|zone-&gt;z_start
suffix:semicolon
id|i
op_le
id|fb
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|bm
(braket
id|i
)braket
)paren
r_goto
id|found
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|found
suffix:colon
id|fwb
op_assign
id|zone-&gt;z_bm-&gt;bm_firstblk
op_plus
(paren
id|i
op_minus
l_int|1
)paren
op_star
l_int|32
suffix:semicolon
id|lock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
id|zone-&gt;z_start
op_assign
id|i
suffix:semicolon
id|w
op_assign
id|htonl
c_func
(paren
id|bm
(braket
id|i
)braket
)paren
suffix:semicolon
id|fb
op_assign
id|find_first_one_bit
c_func
(paren
op_amp
id|w
comma
l_int|32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb
OG
l_int|31
op_logical_or
op_logical_neg
id|clear_bit
c_func
(paren
id|fb
op_xor
id|BO_EXBITS
comma
op_amp
id|bm
(braket
id|i
)braket
)paren
)paren
(brace
id|unlock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;AFFS: balloc(): empty block disappeared somehow&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|repeat
suffix:semicolon
)brace
id|block
op_assign
id|fwb
op_plus
id|fb
suffix:semicolon
id|zone-&gt;z_bm-&gt;bm_free
op_decrement
suffix:semicolon
multiline_comment|/* prealloc as much as possible within this word, but not for headers */
r_if
c_cond
(paren
id|zone_no
)paren
(brace
r_while
c_loop
(paren
id|inode-&gt;u.affs_i.i_pa_cnt
OL
id|MAX_PREALLOC
op_logical_and
op_increment
id|fb
OL
l_int|32
)paren
(brace
id|fb
op_assign
id|find_next_one_bit
c_func
(paren
op_amp
id|w
comma
l_int|32
comma
id|fb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fb
OG
l_int|31
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|clear_bit
c_func
(paren
id|fb
op_xor
id|BO_EXBITS
comma
op_amp
id|bm
(braket
id|i
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AFFS: balloc(): empty block disappeared&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|inode-&gt;u.affs_i.i_data
(braket
id|inode-&gt;u.affs_i.i_pa_last
op_increment
)braket
op_assign
id|fwb
op_plus
id|fb
suffix:semicolon
id|inode-&gt;u.affs_i.i_pa_last
op_and_assign
id|MAX_PREALLOC
op_minus
l_int|1
suffix:semicolon
id|inode-&gt;u.affs_i.i_pa_cnt
op_increment
suffix:semicolon
id|zone-&gt;z_bm-&gt;bm_free
op_decrement
suffix:semicolon
)brace
)brace
id|w
op_sub_assign
id|htonl
c_func
(paren
id|bm
(braket
id|i
)braket
)paren
suffix:semicolon
id|bm
(braket
l_int|0
)braket
op_assign
id|ntohl
c_func
(paren
id|htonl
c_func
(paren
id|bm
(braket
l_int|0
)braket
)paren
op_plus
id|w
)paren
suffix:semicolon
id|unlock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|zone-&gt;z_bm-&gt;bm_bh
comma
l_int|1
)paren
suffix:semicolon
r_return
id|block
suffix:semicolon
)brace
r_static
r_void
DECL|function|affs_find_new_zone
id|affs_find_new_zone
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|affs_zone
op_star
id|z
comma
r_int
id|minfree
comma
r_int
id|start
)paren
(brace
r_struct
id|affs_bm_info
op_star
id|bm
suffix:semicolon
r_int
id|offs
suffix:semicolon
r_int
id|zone
suffix:semicolon
r_int
id|free
suffix:semicolon
r_int
id|len
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;AFFS: find_new_zone()&bslash;n&quot;
)paren
suffix:semicolon
id|lock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
id|zone
op_assign
id|start
suffix:semicolon
id|z-&gt;z_bm
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|zone
op_ge
id|sb-&gt;u.affs_sb.s_num_zones
)paren
(brace
id|zone
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|set_bit
c_func
(paren
id|zone
comma
id|sb-&gt;u.affs_sb.s_zonemap
)paren
)paren
(brace
id|bm
op_assign
op_amp
id|sb-&gt;u.affs_sb.s_bitmap
(braket
id|zone
op_rshift
(paren
id|sb-&gt;s_blocksize_bits
op_minus
l_int|8
)paren
)braket
suffix:semicolon
id|offs
op_assign
id|zone
op_star
l_int|256
op_amp
(paren
id|sb-&gt;s_blocksize
op_minus
l_int|1
)paren
suffix:semicolon
id|len
op_assign
id|bm-&gt;bm_size
op_div
l_int|8
op_minus
id|offs
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|256
)paren
id|len
op_assign
l_int|256
suffix:semicolon
id|offs
op_add_assign
l_int|4
suffix:semicolon
id|free
op_assign
id|affs_count_free_bits
c_func
(paren
id|len
comma
(paren
r_char
op_star
)paren
id|bm-&gt;bm_bh-&gt;b_data
op_plus
id|offs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|free
op_logical_and
(paren
l_int|100
op_star
id|free
)paren
op_div
(paren
id|len
op_star
l_int|8
)paren
OG
id|minfree
)paren
(brace
id|z-&gt;z_bm
op_assign
id|bm
suffix:semicolon
id|z-&gt;z_start
op_assign
id|offs
op_div
l_int|4
suffix:semicolon
id|z-&gt;z_ino
op_assign
l_int|0
suffix:semicolon
id|z-&gt;z_zone_no
op_assign
id|zone
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;  ++ found zone (%d) in bh %d at offset %d with %d free blocks&bslash;n&quot;
comma
id|zone
comma
(paren
id|zone
op_rshift
(paren
id|sb-&gt;s_blocksize_bits
op_minus
l_int|8
)paren
)paren
comma
id|offs
comma
id|free
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|zone
comma
id|sb-&gt;u.affs_sb.s_zonemap
)paren
suffix:semicolon
)brace
multiline_comment|/* Skip to next possible zone */
id|pr_debug
c_func
(paren
l_string|&quot;  ++ Skipping to next zone&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|zone
op_eq
id|start
)paren
r_break
suffix:semicolon
)brace
id|unlock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|LONG
DECL|function|affs_new_header
id|affs_new_header
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_struct
id|affs_zone
op_star
id|zone
suffix:semicolon
id|LONG
id|block
suffix:semicolon
r_struct
id|super_block
op_star
id|sb
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
id|sb
op_assign
id|inode-&gt;i_sb
suffix:semicolon
id|zone
op_assign
op_amp
id|sb-&gt;u.affs_sb.s_zones
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* We try up to 3 times to find a free block:&n;&t; * If there is no more room in the current header zone,&n;&t; * we try to get a new one and allocate the block there.&n;&t; * If there is no zone with at least AFFS_HDR_MIN_FREE&n;&t; * percent of free blocks, we try to find a zone with&n;&t; * at least one free block.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|block
op_assign
id|affs_balloc
c_func
(paren
id|inode
comma
l_int|0
)paren
)paren
)paren
(brace
id|clear_bit
c_func
(paren
id|zone-&gt;z_zone_no
comma
id|sb-&gt;u.affs_sb.s_zonemap
)paren
suffix:semicolon
id|affs_find_new_zone
c_func
(paren
id|sb
comma
id|zone
comma
id|AFFS_HDR_MIN_FREE
comma
(paren
id|sb-&gt;u.affs_sb.s_num_zones
op_plus
l_int|1
)paren
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|block
op_assign
id|affs_balloc
c_func
(paren
id|inode
comma
l_int|0
)paren
)paren
)paren
(brace
id|clear_bit
c_func
(paren
id|zone-&gt;z_zone_no
comma
id|sb-&gt;u.affs_sb.s_zonemap
)paren
suffix:semicolon
id|affs_find_new_zone
c_func
(paren
id|sb
comma
id|zone
comma
l_int|0
comma
(paren
id|sb-&gt;u.affs_sb.s_num_zones
op_plus
l_int|1
)paren
op_div
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|block
op_assign
id|affs_balloc
c_func
(paren
id|inode
comma
l_int|0
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|getblk
c_func
(paren
id|inode-&gt;i_dev
comma
id|block
comma
id|sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AFFS: balloc(): cannot read block %d&bslash;n&quot;
comma
id|block
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
id|bh-&gt;b_data
comma
l_int|0
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
id|mark_buffer_uptodate
c_func
(paren
id|bh
comma
l_int|1
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|bh
comma
l_int|1
)paren
suffix:semicolon
id|affs_brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
id|block
suffix:semicolon
)brace
id|LONG
DECL|function|affs_new_data
id|affs_new_data
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_int
id|empty
comma
id|old
suffix:semicolon
r_int
r_int
id|oldest
suffix:semicolon
r_struct
id|affs_zone
op_star
id|zone
suffix:semicolon
r_struct
id|super_block
op_star
id|sb
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|LONG
id|block
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;AFFS: new_data(ino=%lu)&bslash;n&quot;
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
id|sb
op_assign
id|inode-&gt;i_sb
suffix:semicolon
id|lock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;u.affs_i.i_pa_cnt
)paren
(brace
id|inode-&gt;u.affs_i.i_pa_cnt
op_decrement
suffix:semicolon
id|unlock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
id|block
op_assign
id|inode-&gt;u.affs_i.i_data
(braket
id|inode-&gt;u.affs_i.i_pa_next
op_increment
)braket
suffix:semicolon
id|inode-&gt;u.affs_i.i_pa_next
op_and_assign
id|MAX_PREALLOC
op_minus
l_int|1
suffix:semicolon
r_goto
id|init_block
suffix:semicolon
)brace
id|unlock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
id|repeat
suffix:colon
id|oldest
op_assign
id|jiffies
suffix:semicolon
id|old
op_assign
l_int|0
suffix:semicolon
id|empty
op_assign
l_int|0
suffix:semicolon
id|zone
op_assign
op_amp
id|sb-&gt;u.affs_sb.s_zones
(braket
id|inode-&gt;u.affs_i.i_zone
)braket
suffix:semicolon
r_if
c_cond
(paren
id|zone-&gt;z_ino
op_eq
id|inode-&gt;i_ino
)paren
(brace
id|i
op_assign
id|inode-&gt;u.affs_i.i_zone
suffix:semicolon
r_goto
id|found
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|MAX_ZONES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|zone
op_assign
op_amp
id|sb-&gt;u.affs_sb.s_zones
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|empty
op_logical_and
id|zone-&gt;z_bm
op_logical_and
op_logical_neg
id|zone-&gt;z_ino
)paren
id|empty
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|zone-&gt;z_bm
op_logical_and
id|zone-&gt;z_lru_time
OL
id|oldest
)paren
(brace
id|old
op_assign
id|i
suffix:semicolon
id|oldest
op_assign
id|zone-&gt;z_lru_time
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|empty
)paren
id|i
op_assign
id|empty
suffix:semicolon
r_else
r_if
c_cond
(paren
id|old
)paren
id|i
op_assign
id|old
suffix:semicolon
r_else
r_return
id|affs_new_header
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode-&gt;u.affs_i.i_zone
op_assign
id|i
suffix:semicolon
id|zone-&gt;z_ino
op_assign
id|inode-&gt;i_ino
suffix:semicolon
id|found
suffix:colon
id|zone
op_assign
op_amp
id|sb-&gt;u.affs_sb.s_zones
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|block
op_assign
id|affs_balloc
c_func
(paren
id|inode
comma
id|i
)paren
)paren
)paren
(brace
multiline_comment|/* Zone is full */
id|clear_bit
c_func
(paren
id|zone-&gt;z_zone_no
comma
id|sb-&gt;u.affs_sb.s_zonemap
)paren
suffix:semicolon
id|affs_find_new_zone
c_func
(paren
id|sb
comma
id|zone
comma
id|AFFS_DATA_MIN_FREE
comma
id|sb-&gt;u.affs_sb.s_nextzone
)paren
suffix:semicolon
id|sb-&gt;u.affs_sb.s_nextzone
op_assign
id|zone-&gt;z_zone_no
op_plus
l_int|1
suffix:semicolon
r_goto
id|repeat
suffix:semicolon
)brace
id|init_block
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|getblk
c_func
(paren
id|inode-&gt;i_dev
comma
id|block
comma
id|sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AFFS: balloc(): cannot read block %u&bslash;n&quot;
comma
id|block
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
id|bh-&gt;b_data
comma
l_int|0
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
id|mark_buffer_uptodate
c_func
(paren
id|bh
comma
l_int|1
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|bh
comma
l_int|1
)paren
suffix:semicolon
id|affs_brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
id|block
suffix:semicolon
)brace
r_void
DECL|function|affs_make_zones
id|affs_make_zones
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;AFFS: make_zones(): num_zones=%d&bslash;n&quot;
comma
id|sb-&gt;u.affs_sb.s_num_zones
)paren
suffix:semicolon
id|j
op_assign
(paren
id|sb-&gt;u.affs_sb.s_num_zones
op_plus
l_int|1
)paren
op_div
l_int|2
suffix:semicolon
id|affs_find_new_zone
c_func
(paren
id|sb
comma
op_amp
id|sb-&gt;u.affs_sb.s_zones
(braket
l_int|0
)braket
comma
id|AFFS_HDR_MIN_FREE
comma
id|j
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|MAX_ZONES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|affs_find_new_zone
c_func
(paren
id|sb
comma
op_amp
id|sb-&gt;u.affs_sb.s_zones
(braket
id|i
)braket
comma
id|AFFS_DATA_MIN_FREE
comma
id|j
)paren
suffix:semicolon
id|j
op_assign
id|sb-&gt;u.affs_sb.s_zones
(braket
id|i
)braket
dot
id|z_zone_no
op_plus
l_int|1
suffix:semicolon
)brace
)brace
eof
