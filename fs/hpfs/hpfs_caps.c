multiline_comment|/* Capitalization rules for HPFS */
multiline_comment|/* In OS/2, HPFS filenames preserve upper and lower case letter distinctions&n;   but filename matching ignores case.  That is, creating a file &quot;Foo&quot;&n;   actually creates a file named &quot;Foo&quot; which can be looked up as &quot;Foo&quot;,&n;   &quot;foo&quot;, or &quot;FOO&quot;, among other possibilities.&n;&n;   Also, HPFS is internationalized -- a table giving the uppercase&n;   equivalent of every character is stored in the filesystem, so that&n;   any national character set may be used.  If several different&n;   national character sets are in use, several tables are stored&n;   in the filesystem.&n;&n;   It would be perfectly reasonable for Linux HPFS to act as a Unix&n;   filesystem and match &quot;Foo&quot; only if asked for &quot;Foo&quot; exactly.  But&n;   the sort order of HPFS directories is case-insensitive, so Linux&n;   still has to know the capitalization rules used by OS/2.  Because&n;   of this, it turns out to be more natural for us to be case-insensitive&n;   than not.&n;&n;   Currently the standard character set used by Linux is Latin-1.&n;   Work is underway to permit people to use UTF-8 instead, therefore&n;   all code that depends on the character set is segregated here.&n;&n;   (It would be wonderful if Linux HPFS could be independent of what&n;   character set is in use on the Linux side, but because of the&n;   necessary case folding this is impossible.)&n;&n;   There is a map from Latin-1 into code page 850 for every printing&n;   character in Latin-1.  Most, maybe all, OS/2 installations have code&n;   page 850 available, and surely all (on PC hardware) have 437 available.&n;&n;   It is not clear exactly how HPFS.IFS handles the situation when&n;   multiple code pages are in use.  Experiments show that&n;&n;   - tables on the disk give uppercasing rules for the installed code pages&n;&n;   - each directory entry is tagged with what code page was current&n;     when that name was created&n;&n;   - doing just CHCP, without changing what&squot;s on the disk in any way,&n;     can change what DIR reports, and what name a case-folded match&n;     will match.&n;&n;   This means, I think, that HPFS.IFS operates in the current code&n;   page, without regard to the uppercasing information recorded in&n;   the tables on the disk.  It does record the uppercasing rules&n;   it used, perhaps for alien operating systems such as us, but it&n;   does not appear to use them itself.&n;&n;   So: Linux, a Latin-1 system, will operate in code page 850.  We&n;   recode between 850 and Latin-1 when dealing with the names actually&n;   on the disk.  We don&squot;t use the uppercasing tables either.&n;&n;   In a hypothetical UTF-8 implementation, one reasonable way to&n;   proceed that matches OS/2 (for least surprise) is: do case&n;   translation in UTF-8, and recode to/from one of the code pages&n;   available on the mounted filesystem.  Reject as invalid any name&n;   containing chars that can&squot;t be represented on disk by one of the&n;   code pages OS/2 is using.  Recoding from on-disk names to UTF-8&n;   could use the code page tags, though this is not what OS/2 does. */
DECL|variable|tb_cp850_to_latin1
r_static
r_const
r_int
r_char
id|tb_cp850_to_latin1
(braket
l_int|128
)braket
op_assign
(brace
l_int|199
comma
l_int|252
comma
l_int|233
comma
l_int|226
comma
l_int|228
comma
l_int|224
comma
l_int|229
comma
l_int|231
comma
l_int|234
comma
l_int|235
comma
l_int|232
comma
l_int|239
comma
l_int|238
comma
l_int|236
comma
l_int|196
comma
l_int|197
comma
l_int|201
comma
l_int|230
comma
l_int|198
comma
l_int|244
comma
l_int|246
comma
l_int|242
comma
l_int|251
comma
l_int|249
comma
l_int|255
comma
l_int|214
comma
l_int|220
comma
l_int|248
comma
l_int|163
comma
l_int|216
comma
l_int|215
comma
l_int|159
comma
l_int|225
comma
l_int|237
comma
l_int|243
comma
l_int|250
comma
l_int|241
comma
l_int|209
comma
l_int|170
comma
l_int|186
comma
l_int|191
comma
l_int|174
comma
l_int|172
comma
l_int|189
comma
l_int|188
comma
l_int|161
comma
l_int|171
comma
l_int|187
comma
l_int|155
comma
l_int|156
comma
l_int|157
comma
l_int|144
comma
l_int|151
comma
l_int|193
comma
l_int|194
comma
l_int|192
comma
l_int|169
comma
l_int|135
comma
l_int|128
comma
l_int|131
comma
l_int|133
comma
l_int|162
comma
l_int|165
comma
l_int|147
comma
l_int|148
comma
l_int|153
comma
l_int|152
comma
l_int|150
comma
l_int|145
comma
l_int|154
comma
l_int|227
comma
l_int|195
comma
l_int|132
comma
l_int|130
comma
l_int|137
comma
l_int|136
comma
l_int|134
comma
l_int|129
comma
l_int|138
comma
l_int|164
comma
l_int|240
comma
l_int|208
comma
l_int|202
comma
l_int|203
comma
l_int|200
comma
l_int|158
comma
l_int|205
comma
l_int|206
comma
l_int|207
comma
l_int|149
comma
l_int|146
comma
l_int|141
comma
l_int|140
comma
l_int|166
comma
l_int|204
comma
l_int|139
comma
l_int|211
comma
l_int|223
comma
l_int|212
comma
l_int|210
comma
l_int|245
comma
l_int|213
comma
l_int|181
comma
l_int|254
comma
l_int|222
comma
l_int|218
comma
l_int|219
comma
l_int|217
comma
l_int|253
comma
l_int|221
comma
l_int|175
comma
l_int|180
comma
l_int|173
comma
l_int|177
comma
l_int|143
comma
l_int|190
comma
l_int|182
comma
l_int|167
comma
l_int|247
comma
l_int|184
comma
l_int|176
comma
l_int|168
comma
l_int|183
comma
l_int|185
comma
l_int|179
comma
l_int|178
comma
l_int|142
comma
l_int|160
comma
)brace
suffix:semicolon
macro_line|#if 0
r_static
r_const
r_int
r_char
id|tb_latin1_to_cp850
(braket
l_int|128
)braket
op_assign
(brace
l_int|186
comma
l_int|205
comma
l_int|201
comma
l_int|187
comma
l_int|200
comma
l_int|188
comma
l_int|204
comma
l_int|185
comma
l_int|203
comma
l_int|202
comma
l_int|206
comma
l_int|223
comma
l_int|220
comma
l_int|219
comma
l_int|254
comma
l_int|242
comma
l_int|179
comma
l_int|196
comma
l_int|218
comma
l_int|191
comma
l_int|192
comma
l_int|217
comma
l_int|195
comma
l_int|180
comma
l_int|194
comma
l_int|193
comma
l_int|197
comma
l_int|176
comma
l_int|177
comma
l_int|178
comma
l_int|213
comma
l_int|159
comma
l_int|255
comma
l_int|173
comma
l_int|189
comma
l_int|156
comma
l_int|207
comma
l_int|190
comma
l_int|221
comma
l_int|245
comma
l_int|249
comma
l_int|184
comma
l_int|166
comma
l_int|174
comma
l_int|170
comma
l_int|240
comma
l_int|169
comma
l_int|238
comma
l_int|248
comma
l_int|241
comma
l_int|253
comma
l_int|252
comma
l_int|239
comma
l_int|230
comma
l_int|244
comma
l_int|250
comma
l_int|247
comma
l_int|251
comma
l_int|167
comma
l_int|175
comma
l_int|172
comma
l_int|171
comma
l_int|243
comma
l_int|168
comma
l_int|183
comma
l_int|181
comma
l_int|182
comma
l_int|199
comma
l_int|142
comma
l_int|143
comma
l_int|146
comma
l_int|128
comma
l_int|212
comma
l_int|144
comma
l_int|210
comma
l_int|211
comma
l_int|222
comma
l_int|214
comma
l_int|215
comma
l_int|216
comma
l_int|209
comma
l_int|165
comma
l_int|227
comma
l_int|224
comma
l_int|226
comma
l_int|229
comma
l_int|153
comma
l_int|158
comma
l_int|157
comma
l_int|235
comma
l_int|233
comma
l_int|234
comma
l_int|154
comma
l_int|237
comma
l_int|232
comma
l_int|225
comma
l_int|133
comma
l_int|160
comma
l_int|131
comma
l_int|198
comma
l_int|132
comma
l_int|134
comma
l_int|145
comma
l_int|135
comma
l_int|138
comma
l_int|130
comma
l_int|136
comma
l_int|137
comma
l_int|141
comma
l_int|161
comma
l_int|140
comma
l_int|139
comma
l_int|208
comma
l_int|164
comma
l_int|149
comma
l_int|162
comma
l_int|147
comma
l_int|228
comma
l_int|148
comma
l_int|246
comma
l_int|155
comma
l_int|151
comma
l_int|163
comma
l_int|150
comma
l_int|129
comma
l_int|236
comma
l_int|231
comma
l_int|152
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|function|latin1_upcase
r_static
r_inline
r_int
id|latin1_upcase
(paren
r_int
id|c
)paren
(brace
r_if
c_cond
(paren
id|c
op_minus
(paren
r_int
r_char
)paren
l_char|&squot;a&squot;
op_le
(paren
r_int
r_char
)paren
l_char|&squot;z&squot;
op_minus
(paren
r_int
r_char
)paren
l_char|&squot;a&squot;
op_logical_or
(paren
id|c
op_minus
(paren
r_int
r_char
)paren
l_char|&squot;`&squot;
op_le
(paren
r_int
r_char
)paren
l_char|&squot;~&squot;
op_minus
(paren
r_int
r_char
)paren
l_char|&squot;`&squot;
op_logical_and
id|c
op_ne
(paren
r_int
r_char
)paren
l_char|&squot;w&squot;
)paren
)paren
r_return
id|c
op_minus
(paren
r_int
r_char
)paren
l_char|&squot;a&squot;
op_plus
(paren
r_int
r_char
)paren
l_char|&squot;A&squot;
suffix:semicolon
r_else
r_return
id|c
suffix:semicolon
)brace
DECL|function|latin1_downcase
r_static
r_inline
r_int
id|latin1_downcase
(paren
r_int
id|c
)paren
(brace
r_if
c_cond
(paren
id|c
op_minus
(paren
r_int
r_char
)paren
l_char|&squot;A&squot;
op_le
(paren
r_int
r_char
)paren
l_char|&squot;Z&squot;
op_minus
(paren
r_int
r_char
)paren
l_char|&squot;A&squot;
op_logical_or
(paren
id|c
op_minus
(paren
r_int
r_char
)paren
l_char|&squot;@&squot;
op_le
(paren
r_int
r_char
)paren
l_char|&squot;^&squot;
op_minus
(paren
r_int
r_char
)paren
l_char|&squot;@&squot;
op_logical_and
id|c
op_ne
(paren
r_int
r_char
)paren
l_char|&squot;W&squot;
)paren
)paren
r_return
id|c
op_plus
(paren
r_int
r_char
)paren
l_char|&squot;a&squot;
op_minus
(paren
r_int
r_char
)paren
l_char|&squot;A&squot;
suffix:semicolon
r_else
r_return
id|c
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_inline
r_int
id|latin1_to_cp850
(paren
r_int
id|c
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|c
op_minus
l_int|128
op_ge
l_int|0
)paren
r_return
id|tb_latin1_to_cp850
(braket
id|c
op_minus
l_int|128
)braket
suffix:semicolon
r_else
r_return
id|c
suffix:semicolon
)brace
macro_line|#endif
DECL|function|cp850_to_latin1
r_static
r_inline
r_int
id|cp850_to_latin1
(paren
r_int
id|c
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|c
op_minus
l_int|128
op_ge
l_int|0
)paren
r_return
id|tb_cp850_to_latin1
(braket
id|c
op_minus
l_int|128
)braket
suffix:semicolon
r_else
r_return
id|c
suffix:semicolon
)brace
DECL|function|hpfs_char_to_upper_linux
r_int
id|hpfs_char_to_upper_linux
(paren
r_int
id|c
)paren
(brace
r_return
id|latin1_upcase
(paren
id|cp850_to_latin1
(paren
id|c
)paren
)paren
suffix:semicolon
)brace
DECL|function|linux_char_to_upper_linux
r_int
id|linux_char_to_upper_linux
(paren
r_int
id|c
)paren
(brace
r_return
id|latin1_upcase
(paren
id|c
)paren
suffix:semicolon
)brace
DECL|function|hpfs_char_to_lower_linux
r_int
id|hpfs_char_to_lower_linux
(paren
r_int
id|c
)paren
(brace
r_return
id|latin1_downcase
(paren
id|cp850_to_latin1
(paren
id|c
)paren
)paren
suffix:semicolon
)brace
DECL|function|hpfs_char_to_linux
r_int
id|hpfs_char_to_linux
(paren
r_int
id|c
)paren
(brace
r_return
id|cp850_to_latin1
(paren
id|c
)paren
suffix:semicolon
)brace
eof
