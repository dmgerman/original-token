multiline_comment|/*&n; *  fs.c&n; *  NTFS driver for Linux 2.3.x&n; *&n; *  Copyright (C) 1995-1997, 1999 Martin von L&#xfffd;wis&n; *  Copyright (C) 1996 Richard Russon&n; *  Copyright (C) 1996-1997 R&#xfffd;gis Duchesne&n; *  Copyright (C) 2000, Anton Altaparmakov&n; */
macro_line|#ifdef HAVE_CONFIG_H
macro_line|#include &quot;config.h&quot;
macro_line|#endif
macro_line|#ifdef NTFS_IN_LINUX_KERNEL
macro_line|#include &lt;linux/config.h&gt;
macro_line|#endif
macro_line|#include &quot;ntfstypes.h&quot;
macro_line|#include &quot;struct.h&quot;
macro_line|#include &quot;util.h&quot;
macro_line|#include &quot;inode.h&quot;
macro_line|#include &quot;super.h&quot;
macro_line|#include &quot;dir.h&quot;
macro_line|#include &quot;support.h&quot;
macro_line|#include &quot;macros.h&quot;
macro_line|#include &quot;sysctl.h&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/nls.h&gt;
macro_line|#include &lt;linux/locks.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
multiline_comment|/* Forward declarations */
DECL|variable|ntfs_dir_inode_operations
r_static
r_struct
id|inode_operations
id|ntfs_dir_inode_operations
suffix:semicolon
DECL|variable|ntfs_dir_operations
r_static
r_struct
id|file_operations
id|ntfs_dir_operations
suffix:semicolon
DECL|macro|ITEM_SIZE
mdefine_line|#define ITEM_SIZE 2040
multiline_comment|/* io functions to user space */
DECL|function|ntfs_putuser
r_static
r_void
id|ntfs_putuser
c_func
(paren
id|ntfs_io
op_star
id|dest
comma
r_void
op_star
id|src
comma
id|ntfs_size_t
id|len
)paren
(brace
id|copy_to_user
c_func
(paren
id|dest-&gt;param
comma
id|src
comma
id|len
)paren
suffix:semicolon
id|dest-&gt;param
op_add_assign
id|len
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NTFS_RW
DECL|struct|ntfs_getuser_update_vm_s
r_struct
id|ntfs_getuser_update_vm_s
(brace
DECL|member|user
r_const
r_char
op_star
id|user
suffix:semicolon
DECL|member|ino
r_struct
id|inode
op_star
id|ino
suffix:semicolon
DECL|member|off
id|loff_t
id|off
suffix:semicolon
)brace
suffix:semicolon
DECL|function|ntfs_getuser_update_vm
r_static
r_void
id|ntfs_getuser_update_vm
(paren
r_void
op_star
id|dest
comma
id|ntfs_io
op_star
id|src
comma
id|ntfs_size_t
id|len
)paren
(brace
r_struct
id|ntfs_getuser_update_vm_s
op_star
id|p
op_assign
id|src-&gt;param
suffix:semicolon
id|copy_from_user
(paren
id|dest
comma
id|p-&gt;user
comma
id|len
)paren
suffix:semicolon
id|p-&gt;user
op_add_assign
id|len
suffix:semicolon
id|p-&gt;off
op_add_assign
id|len
suffix:semicolon
)brace
macro_line|#endif
r_static
id|ssize_t
DECL|function|ntfs_read
id|ntfs_read
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_int
id|error
suffix:semicolon
id|ntfs_io
id|io
suffix:semicolon
id|ntfs_inode
op_star
id|ino
op_assign
id|NTFS_LINO2NINO
c_func
(paren
id|filp-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
multiline_comment|/* inode is not properly initialized */
r_if
c_cond
(paren
op_logical_neg
id|ino
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_read %x,%x,%x -&gt;&quot;
comma
(paren
r_int
)paren
id|ino-&gt;i_number
comma
(paren
r_int
)paren
op_star
id|off
comma
(paren
r_int
)paren
id|count
)paren
suffix:semicolon
multiline_comment|/* inode has no unnamed data attribute */
r_if
c_cond
(paren
op_logical_neg
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|ino-&gt;vol-&gt;at_data
comma
l_int|NULL
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* read the data */
id|io.fn_put
op_assign
id|ntfs_putuser
suffix:semicolon
id|io.fn_get
op_assign
l_int|0
suffix:semicolon
id|io.param
op_assign
id|buf
suffix:semicolon
id|io.size
op_assign
id|count
suffix:semicolon
id|error
op_assign
id|ntfs_read_attr
c_func
(paren
id|ino
comma
id|ino-&gt;vol-&gt;at_data
comma
l_int|NULL
comma
op_star
id|off
comma
op_amp
id|io
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_logical_and
op_logical_neg
id|io.size
)paren
(brace
r_return
op_minus
id|error
suffix:semicolon
)brace
op_star
id|off
op_add_assign
id|io.size
suffix:semicolon
r_return
id|io.size
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NTFS_RW
r_static
id|ssize_t
DECL|function|ntfs_write
id|ntfs_write
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ntfs_io
id|io
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
id|ntfs_inode
op_star
id|ino
op_assign
id|NTFS_LINO2NINO
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|ntfs_getuser_update_vm_s
id|param
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ino
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ntfs_debug
(paren
id|DEBUG_LINUX
comma
l_string|&quot;ntfs_write %x,%x,%x -&gt;&bslash;n&quot;
comma
(paren
r_int
)paren
id|ino-&gt;i_number
comma
(paren
r_int
)paren
op_star
id|pos
comma
(paren
r_int
)paren
id|count
)paren
suffix:semicolon
multiline_comment|/* Allows to lock fs ro at any time */
r_if
c_cond
(paren
id|inode-&gt;i_sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
r_return
op_minus
id|ENOSPC
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|ino-&gt;vol-&gt;at_data
comma
l_int|NULL
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Evaluating O_APPEND is the file system&squot;s job... */
r_if
c_cond
(paren
id|filp-&gt;f_flags
op_amp
id|O_APPEND
)paren
op_star
id|pos
op_assign
id|inode-&gt;i_size
suffix:semicolon
id|param.user
op_assign
id|buf
suffix:semicolon
id|param.ino
op_assign
id|inode
suffix:semicolon
id|param.off
op_assign
op_star
id|pos
suffix:semicolon
id|io.fn_put
op_assign
l_int|0
suffix:semicolon
id|io.fn_get
op_assign
id|ntfs_getuser_update_vm
suffix:semicolon
id|io.param
op_assign
op_amp
id|param
suffix:semicolon
id|io.size
op_assign
id|count
suffix:semicolon
id|ret
op_assign
id|ntfs_write_attr
(paren
id|ino
comma
id|ino-&gt;vol-&gt;at_data
comma
l_int|NULL
comma
op_star
id|pos
comma
op_amp
id|io
)paren
suffix:semicolon
id|ntfs_debug
(paren
id|DEBUG_LINUX
comma
l_string|&quot;write -&gt; %x&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
op_star
id|pos
op_add_assign
id|io.size
suffix:semicolon
r_if
c_cond
(paren
op_star
id|pos
OG
id|inode-&gt;i_size
)paren
id|inode-&gt;i_size
op_assign
op_star
id|pos
suffix:semicolon
id|mark_inode_dirty
(paren
id|filp-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
r_return
id|io.size
suffix:semicolon
)brace
macro_line|#endif
DECL|struct|ntfs_filldir
r_struct
id|ntfs_filldir
(brace
DECL|member|dir
r_struct
id|inode
op_star
id|dir
suffix:semicolon
DECL|member|filldir
id|filldir_t
id|filldir
suffix:semicolon
DECL|member|type
r_int
r_int
id|type
suffix:semicolon
DECL|member|ph
DECL|member|pl
id|ntfs_u32
id|ph
comma
id|pl
suffix:semicolon
DECL|member|dirent
r_void
op_star
id|dirent
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|namelen
r_int
id|namelen
suffix:semicolon
)brace
suffix:semicolon
DECL|function|ntfs_printcb
r_static
r_int
id|ntfs_printcb
c_func
(paren
id|ntfs_u8
op_star
id|entry
comma
r_void
op_star
id|param
)paren
(brace
r_struct
id|ntfs_filldir
op_star
id|nf
op_assign
id|param
suffix:semicolon
r_int
id|flags
op_assign
id|NTFS_GETU8
c_func
(paren
id|entry
op_plus
l_int|0x51
)paren
suffix:semicolon
r_int
id|show_hidden
op_assign
l_int|0
suffix:semicolon
r_int
id|length
op_assign
id|NTFS_GETU8
c_func
(paren
id|entry
op_plus
l_int|0x50
)paren
suffix:semicolon
r_int
id|inum
op_assign
id|NTFS_GETU32
c_func
(paren
id|entry
)paren
suffix:semicolon
r_int
id|error
suffix:semicolon
macro_line|#ifdef NTFS_NGT_NT_DOES_LOWER
r_int
id|i
comma
id|to_lower
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|nf-&gt;type
)paren
(brace
r_case
id|ngt_dos
suffix:colon
multiline_comment|/* Don&squot;t display long names */
r_if
c_cond
(paren
(paren
id|flags
op_amp
l_int|2
)paren
op_eq
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ngt_nt
suffix:colon
multiline_comment|/* Don&squot;t display short-only names */
r_switch
c_cond
(paren
id|flags
op_amp
l_int|3
)paren
(brace
r_case
l_int|2
suffix:colon
r_return
l_int|0
suffix:semicolon
macro_line|#ifdef NTFS_NGT_NT_DOES_LOWER
r_case
l_int|3
suffix:colon
id|to_lower
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
)brace
r_break
suffix:semicolon
r_case
id|ngt_posix
suffix:colon
r_break
suffix:semicolon
r_case
id|ngt_full
suffix:colon
id|show_hidden
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|show_hidden
op_logical_and
(paren
(paren
id|NTFS_GETU8
c_func
(paren
id|entry
op_plus
l_int|0x48
)paren
op_amp
l_int|2
)paren
op_eq
l_int|2
)paren
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Skipping hidden file&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|nf-&gt;name
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ntfs_encodeuni
c_func
(paren
id|NTFS_INO2VOL
c_func
(paren
id|nf-&gt;dir
)paren
comma
(paren
id|ntfs_u16
op_star
)paren
(paren
id|entry
op_plus
l_int|0x52
)paren
comma
id|length
comma
op_amp
id|nf-&gt;name
comma
op_amp
id|nf-&gt;namelen
)paren
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Skipping unrepresentable file&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nf-&gt;name
)paren
(brace
id|ntfs_free
c_func
(paren
id|nf-&gt;name
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Do not return &quot;.&quot;, as this is faked */
r_if
c_cond
(paren
id|length
op_eq
l_int|1
op_logical_and
op_star
id|nf-&gt;name
op_eq
l_char|&squot;.&squot;
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef NTFS_NGT_NT_DOES_LOWER
r_if
c_cond
(paren
id|to_lower
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nf-&gt;namelen
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* This supports ASCII only. Since only DOS-only&n;&t;&t;&t;   names get converted, and since those are restricted&n;&t;&t;&t;   to ASCII, this should be correct */
r_if
c_cond
(paren
id|nf-&gt;name
(braket
id|i
)braket
op_ge
l_char|&squot;A&squot;
op_logical_and
id|nf-&gt;name
(braket
id|i
)braket
op_le
l_char|&squot;Z&squot;
)paren
(brace
id|nf-&gt;name
(braket
id|i
)braket
op_add_assign
l_char|&squot;a&squot;
op_minus
l_char|&squot;A&squot;
suffix:semicolon
)brace
macro_line|#endif
id|nf-&gt;name
(braket
id|nf-&gt;namelen
)braket
op_assign
l_int|0
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;readdir got %s,len %d&bslash;n&quot;
comma
id|nf-&gt;name
comma
id|nf-&gt;namelen
)paren
suffix:semicolon
multiline_comment|/* filldir expects an off_t rather than an loff_t.&n;&t;   Hope we don&squot;t have more than 65535 index records */
id|error
op_assign
id|nf
op_member_access_from_pointer
id|filldir
c_func
(paren
id|nf-&gt;dirent
comma
id|nf-&gt;name
comma
id|nf-&gt;namelen
comma
(paren
id|nf-&gt;ph
op_lshift
l_int|16
)paren
op_or
id|nf-&gt;pl
comma
id|inum
comma
id|DT_UNKNOWN
)paren
suffix:semicolon
id|ntfs_free
c_func
(paren
id|nf-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Linux filldir errors are negative, other errors positive */
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/* readdir returns &squot;..&squot;, then &squot;.&squot;, then the directory entries in sequence&n;   As the root directory contains a entry for itself, &squot;.&squot; is not emulated&n;   for the root directory */
DECL|function|ntfs_readdir
r_static
r_int
id|ntfs_readdir
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|dirent
comma
id|filldir_t
id|filldir
)paren
(brace
r_struct
id|ntfs_filldir
id|cb
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|inode
op_star
id|dir
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_readdir ino %x mode %x&bslash;n&quot;
comma
(paren
r_int
)paren
id|dir-&gt;i_ino
comma
(paren
r_int
r_int
)paren
id|dir-&gt;i_mode
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;readdir: Looking for file %x dircount %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|filp-&gt;f_pos
comma
id|atomic_read
c_func
(paren
op_amp
id|dir-&gt;i_count
)paren
)paren
suffix:semicolon
id|cb.pl
op_assign
id|filp-&gt;f_pos
op_amp
l_int|0xFFFF
suffix:semicolon
id|cb.ph
op_assign
id|filp-&gt;f_pos
op_rshift
l_int|16
suffix:semicolon
multiline_comment|/* end of directory */
r_if
c_cond
(paren
id|cb.ph
op_eq
l_int|0xFFFF
)paren
(brace
multiline_comment|/* FIXME: Maybe we can return those with the previous call */
r_switch
c_cond
(paren
id|cb.pl
)paren
(brace
r_case
l_int|0
suffix:colon
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;.&quot;
comma
l_int|1
comma
id|filp-&gt;f_pos
comma
id|dir-&gt;i_ino
comma
id|DT_DIR
)paren
suffix:semicolon
id|filp-&gt;f_pos
op_assign
l_int|0xFFFF0001
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: parent directory */
r_case
l_int|1
suffix:colon
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;..&quot;
comma
l_int|2
comma
id|filp-&gt;f_pos
comma
l_int|0
comma
id|DT_DIR
)paren
suffix:semicolon
id|filp-&gt;f_pos
op_assign
l_int|0xFFFF0002
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;readdir: EOD&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|cb.dir
op_assign
id|dir
suffix:semicolon
id|cb.filldir
op_assign
id|filldir
suffix:semicolon
id|cb.dirent
op_assign
id|dirent
suffix:semicolon
id|cb.type
op_assign
id|NTFS_INO2VOL
c_func
(paren
id|dir
)paren
op_member_access_from_pointer
id|ngt
suffix:semicolon
r_do
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;looking for next file&bslash;n&quot;
)paren
suffix:semicolon
id|error
op_assign
id|ntfs_getdir_unsorted
c_func
(paren
id|NTFS_LINO2NINO
c_func
(paren
id|dir
)paren
comma
op_amp
id|cb.ph
comma
op_amp
id|cb.pl
comma
id|ntfs_printcb
comma
op_amp
id|cb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|error
op_logical_and
id|cb.ph
op_ne
l_int|0xFFFFFFFF
)paren
suffix:semicolon
id|filp-&gt;f_pos
op_assign
(paren
id|cb.ph
op_lshift
l_int|16
)paren
op_or
id|cb.pl
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;new position %x&bslash;n&quot;
comma
(paren
r_int
)paren
id|filp-&gt;f_pos
)paren
suffix:semicolon
multiline_comment|/* -EINVAL is on user buffer full. This is not considered &n;&t;   as an error by sys_getdents */
r_if
c_cond
(paren
id|error
OL
l_int|0
)paren
(brace
id|error
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Otherwise (device error, inconsistent data), switch the sign */
r_return
op_minus
id|error
suffix:semicolon
)brace
multiline_comment|/* Copied from vfat driver */
DECL|function|simple_getbool
r_static
r_int
id|simple_getbool
c_func
(paren
r_char
op_star
id|s
comma
r_int
op_star
id|setval
)paren
(brace
r_if
c_cond
(paren
id|s
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;1&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;yes&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;true&quot;
)paren
)paren
(brace
op_star
id|setval
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;0&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;no&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;false&quot;
)paren
)paren
(brace
op_star
id|setval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|setval
op_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Parse the (re)mount options */
DECL|function|parse_options
r_static
r_int
id|parse_options
c_func
(paren
id|ntfs_volume
op_star
id|vol
comma
r_char
op_star
id|opt
)paren
(brace
r_char
op_star
id|value
suffix:semicolon
id|vol-&gt;uid
op_assign
id|vol-&gt;gid
op_assign
l_int|0
suffix:semicolon
id|vol-&gt;umask
op_assign
l_int|0077
suffix:semicolon
id|vol-&gt;ngt
op_assign
id|ngt_nt
suffix:semicolon
id|vol-&gt;nls_map
op_assign
l_int|0
suffix:semicolon
id|vol-&gt;nct
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opt
)paren
(brace
r_goto
id|done
suffix:semicolon
)brace
r_for
c_loop
(paren
id|opt
op_assign
id|strtok
c_func
(paren
id|opt
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
id|opt
suffix:semicolon
id|opt
op_assign
id|strtok
c_func
(paren
l_int|NULL
comma
l_string|&quot;,&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|value
op_assign
id|strchr
c_func
(paren
id|opt
comma
l_char|&squot;=&squot;
)paren
)paren
op_ne
l_int|NULL
)paren
op_star
id|value
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;uid&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
(brace
r_goto
id|needs_arg
suffix:semicolon
)brace
id|vol-&gt;uid
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: uid invalid argument&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;gid&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
(brace
r_goto
id|needs_arg
suffix:semicolon
)brace
id|vol-&gt;gid
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;gid invalid argument&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;umask&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
(brace
r_goto
id|needs_arg
suffix:semicolon
)brace
id|vol-&gt;umask
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;umask invalid argument&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;iocharset&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
(brace
r_goto
id|needs_arg
suffix:semicolon
)brace
id|vol-&gt;nls_map
op_assign
id|load_nls
c_func
(paren
id|value
)paren
suffix:semicolon
id|vol-&gt;nct
op_or_assign
id|nct_map
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vol-&gt;nls_map
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: charset not found&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;posix&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
(brace
r_goto
id|needs_arg
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|simple_getbool
c_func
(paren
id|value
comma
op_amp
id|val
)paren
)paren
(brace
r_goto
id|needs_bool
suffix:semicolon
)brace
id|vol-&gt;ngt
op_assign
id|val
ques
c_cond
id|ngt_posix
suffix:colon
id|ngt_nt
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;utf8&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
(brace
id|val
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|simple_getbool
c_func
(paren
id|value
comma
op_amp
id|val
)paren
)paren
(brace
r_goto
id|needs_bool
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
)paren
(brace
id|vol-&gt;nct
op_or_assign
id|nct_utf8
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;uni_xlate&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|val
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no argument: uni_vfat.&n;&t;&t;&t;   boolean argument: uni_vfat.&n;&t;&t;&t;   &quot;2&quot;: uni.&n;&t;&t;&t;*/
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
(brace
id|val
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|value
comma
l_string|&quot;2&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|vol-&gt;nct
op_or_assign
id|nct_uni_xlate
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|simple_getbool
c_func
(paren
id|value
comma
op_amp
id|val
)paren
)paren
(brace
r_goto
id|needs_bool
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
)paren
(brace
id|vol-&gt;nct
op_or_assign
id|nct_uni_xlate_vfat
op_or
id|nct_uni_xlate
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: unkown option &squot;%s&squot;&bslash;n&quot;
comma
id|opt
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|vol-&gt;nct
op_amp
id|nct_utf8
op_amp
(paren
id|nct_map
op_or
id|nct_uni_xlate
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;utf8 cannot be combined with iocharset or uni_xlate&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|done
suffix:colon
r_if
c_cond
(paren
(paren
id|vol-&gt;nct
op_amp
(paren
id|nct_uni_xlate
op_or
id|nct_map
op_or
id|nct_utf8
)paren
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* default to UTF-8 */
id|vol-&gt;nct
op_assign
id|nct_utf8
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|vol-&gt;nls_map
)paren
(brace
id|vol-&gt;nls_map
op_assign
id|load_nls_default
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vol-&gt;nls_map
)paren
id|vol-&gt;nct
op_assign
id|nct_map
op_or
(paren
id|vol-&gt;nct
op_amp
id|nct_uni_xlate
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
id|needs_arg
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: %s needs an argument&quot;
comma
id|opt
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|needs_bool
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: %s needs boolean argument&quot;
comma
id|opt
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ntfs_lookup
r_static
r_struct
id|dentry
op_star
id|ntfs_lookup
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|d
)paren
(brace
r_struct
id|inode
op_star
id|res
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|item
op_assign
l_int|0
suffix:semicolon
id|ntfs_iterate_s
id|walk
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_NAME1
comma
l_string|&quot;Looking up %s in %x&bslash;n&quot;
comma
id|d-&gt;d_name.name
comma
(paren
r_int
)paren
id|dir-&gt;i_ino
)paren
suffix:semicolon
multiline_comment|/* convert to wide string */
id|error
op_assign
id|ntfs_decodeuni
c_func
(paren
id|NTFS_INO2VOL
c_func
(paren
id|dir
)paren
comma
(paren
r_char
op_star
)paren
id|d-&gt;d_name.name
comma
id|d-&gt;d_name.len
comma
op_amp
id|walk.name
comma
op_amp
id|walk.namelen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|error
)paren
suffix:semicolon
)brace
id|item
op_assign
id|ntfs_malloc
c_func
(paren
id|ITEM_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|item
)paren
(brace
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
)brace
multiline_comment|/* ntfs_getdir will place the directory entry into item,&n;&t;   and the first long long is the MFT record number */
id|walk.type
op_assign
id|BY_NAME
suffix:semicolon
id|walk.dir
op_assign
id|NTFS_LINO2NINO
c_func
(paren
id|dir
)paren
suffix:semicolon
id|walk.result
op_assign
id|item
suffix:semicolon
r_if
c_cond
(paren
id|ntfs_getdir_byname
c_func
(paren
op_amp
id|walk
)paren
)paren
(brace
id|res
op_assign
id|iget
c_func
(paren
id|dir-&gt;i_sb
comma
id|NTFS_GETU32
c_func
(paren
id|item
)paren
)paren
suffix:semicolon
)brace
id|d_add
c_func
(paren
id|d
comma
id|res
)paren
suffix:semicolon
id|ntfs_free
c_func
(paren
id|item
)paren
suffix:semicolon
id|ntfs_free
c_func
(paren
id|walk.name
)paren
suffix:semicolon
multiline_comment|/* Always return success, the dcache will handle negative entries. */
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|variable|ntfs_file_operations_nommap
r_static
r_struct
id|file_operations
id|ntfs_file_operations_nommap
op_assign
(brace
id|read
suffix:colon
id|ntfs_read
comma
macro_line|#ifdef CONFIG_NTFS_RW
id|write
suffix:colon
id|ntfs_write
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|variable|ntfs_inode_operations_nobmap
r_static
r_struct
id|inode_operations
id|ntfs_inode_operations_nobmap
suffix:semicolon
macro_line|#ifdef CONFIG_NTFS_RW
r_static
r_int
DECL|function|ntfs_create
id|ntfs_create
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|d
comma
r_int
id|mode
)paren
(brace
r_struct
id|inode
op_star
id|r
op_assign
l_int|0
suffix:semicolon
id|ntfs_inode
op_star
id|ino
op_assign
l_int|0
suffix:semicolon
id|ntfs_volume
op_star
id|vol
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
id|ntfs_attribute
op_star
id|si
suffix:semicolon
id|r
op_assign
id|new_inode
c_func
(paren
id|dir-&gt;i_sb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
(brace
id|error
op_assign
id|ENOMEM
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_create %s&bslash;n&quot;
comma
id|d-&gt;d_name.name
)paren
suffix:semicolon
id|vol
op_assign
id|NTFS_INO2VOL
c_func
(paren
id|dir
)paren
suffix:semicolon
macro_line|#ifdef NTFS_IN_LINUX_KERNEL
id|ino
op_assign
id|NTFS_LINO2NINO
c_func
(paren
id|r
)paren
suffix:semicolon
macro_line|#else
id|ino
op_assign
id|ntfs_malloc
c_func
(paren
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ino
)paren
(brace
id|error
op_assign
id|ENOMEM
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|r-&gt;u.generic_ip
op_assign
id|ino
suffix:semicolon
macro_line|#endif
id|error
op_assign
id|ntfs_alloc_file
c_func
(paren
id|NTFS_LINO2NINO
c_func
(paren
id|dir
)paren
comma
id|ino
comma
(paren
r_char
op_star
)paren
id|d-&gt;d_name.name
comma
id|d-&gt;d_name.len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_goto
id|fail
suffix:semicolon
)brace
id|error
op_assign
id|ntfs_update_inode
c_func
(paren
id|ino
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_goto
id|fail
suffix:semicolon
)brace
id|error
op_assign
id|ntfs_update_inode
c_func
(paren
id|NTFS_LINO2NINO
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_goto
id|fail
suffix:semicolon
)brace
id|r-&gt;i_uid
op_assign
id|vol-&gt;uid
suffix:semicolon
id|r-&gt;i_gid
op_assign
id|vol-&gt;gid
suffix:semicolon
multiline_comment|/* FIXME: dirty? dev? */
multiline_comment|/* get the file modification times from the standard information */
id|si
op_assign
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_standard_information
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si
)paren
(brace
r_char
op_star
id|attr
op_assign
id|si-&gt;d.data
suffix:semicolon
id|r-&gt;i_atime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|0x18
)paren
)paren
suffix:semicolon
id|r-&gt;i_ctime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
)paren
)paren
suffix:semicolon
id|r-&gt;i_mtime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|8
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* It&squot;s not a directory */
id|r-&gt;i_op
op_assign
op_amp
id|ntfs_inode_operations_nobmap
suffix:semicolon
id|r-&gt;i_fop
op_assign
op_amp
id|ntfs_file_operations_nommap
comma
id|r-&gt;i_mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
suffix:semicolon
macro_line|#ifdef CONFIG_NTFS_RW
id|r-&gt;i_mode
op_or_assign
id|S_IWUGO
suffix:semicolon
macro_line|#endif
id|r-&gt;i_mode
op_and_assign
op_complement
id|vol-&gt;umask
suffix:semicolon
id|insert_inode_hash
c_func
(paren
id|r
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|d
comma
id|r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
macro_line|#ifndef NTFS_IN_LINUX_KERNEL
r_if
c_cond
(paren
id|ino
)paren
(brace
id|ntfs_free
c_func
(paren
id|ino
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|r
)paren
(brace
id|iput
c_func
(paren
id|r
)paren
suffix:semicolon
)brace
r_return
op_minus
id|error
suffix:semicolon
)brace
r_static
r_int
DECL|function|_linux_ntfs_mkdir
id|_linux_ntfs_mkdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|d
comma
r_int
id|mode
)paren
(brace
r_int
id|error
suffix:semicolon
r_struct
id|inode
op_star
id|r
op_assign
l_int|0
suffix:semicolon
id|ntfs_volume
op_star
id|vol
suffix:semicolon
id|ntfs_inode
op_star
id|ino
suffix:semicolon
id|ntfs_attribute
op_star
id|si
suffix:semicolon
id|ntfs_debug
(paren
id|DEBUG_DIR1
comma
l_string|&quot;mkdir %s in %x&bslash;n&quot;
comma
id|d-&gt;d_name.name
comma
id|dir-&gt;i_ino
)paren
suffix:semicolon
id|error
op_assign
id|ENAMETOOLONG
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;d_name.len
OG
multiline_comment|/* FIXME */
l_int|255
)paren
r_goto
id|out
suffix:semicolon
id|error
op_assign
id|EIO
suffix:semicolon
id|r
op_assign
id|new_inode
c_func
(paren
id|dir-&gt;i_sb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
r_goto
id|out
suffix:semicolon
id|vol
op_assign
id|NTFS_INO2VOL
c_func
(paren
id|dir
)paren
suffix:semicolon
macro_line|#ifdef NTFS_IN_LINUX_KERNEL
id|ino
op_assign
id|NTFS_LINO2NINO
c_func
(paren
id|r
)paren
suffix:semicolon
macro_line|#else
id|ino
op_assign
id|ntfs_malloc
c_func
(paren
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|error
op_assign
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ino
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|r-&gt;u.generic_ip
op_assign
id|ino
suffix:semicolon
macro_line|#endif
id|error
op_assign
id|ntfs_mkdir
c_func
(paren
id|NTFS_LINO2NINO
c_func
(paren
id|dir
)paren
comma
id|d-&gt;d_name.name
comma
id|d-&gt;d_name.len
comma
id|ino
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|r-&gt;i_uid
op_assign
id|vol-&gt;uid
suffix:semicolon
id|r-&gt;i_gid
op_assign
id|vol-&gt;gid
suffix:semicolon
id|si
op_assign
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_standard_information
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si
)paren
(brace
r_char
op_star
id|attr
op_assign
id|si-&gt;d.data
suffix:semicolon
id|r-&gt;i_atime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|0x18
)paren
)paren
suffix:semicolon
id|r-&gt;i_ctime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
)paren
)paren
suffix:semicolon
id|r-&gt;i_mtime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|8
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* It&squot;s a directory */
id|r-&gt;i_op
op_assign
op_amp
id|ntfs_dir_inode_operations
suffix:semicolon
id|r-&gt;i_fop
op_assign
op_amp
id|ntfs_dir_operations
suffix:semicolon
id|r-&gt;i_mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
suffix:semicolon
macro_line|#ifdef CONFIG_NTFS_RW
id|r-&gt;i_mode
op_or_assign
id|S_IWUGO
suffix:semicolon
macro_line|#endif
id|r-&gt;i_mode
op_and_assign
op_complement
id|vol-&gt;umask
suffix:semicolon
id|insert_inode_hash
c_func
(paren
id|r
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|d
comma
id|r
)paren
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|ntfs_debug
(paren
id|DEBUG_DIR1
comma
l_string|&quot;mkdir returns %d&bslash;n&quot;
comma
op_minus
id|error
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if 0
r_static
r_int
id|ntfs_bmap
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_int
id|block
)paren
(brace
r_int
id|ret
op_assign
id|ntfs_vcn_to_lcn
c_func
(paren
id|NTFS_LINO2NINO
c_func
(paren
id|ino
)paren
comma
id|block
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;bmap of %lx,block %x is %x&bslash;n&quot;
comma
id|ino-&gt;i_ino
comma
id|block
comma
id|ret
)paren
suffix:semicolon
r_return
(paren
id|ret
op_eq
op_minus
l_int|1
)paren
ques
c_cond
l_int|0
suffix:colon
id|ret
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* It&squot;s fscking broken. */
multiline_comment|/* FIXME: [bm]map code is disabled until ntfs_get_block gets sorted! */
multiline_comment|/*&n;static int ntfs_get_block(struct inode *inode, long block, struct buffer_head *bh, int create)&n;{&n;&t;BUG();&n;&t;return -1;&n;}&n;&n;static struct file_operations ntfs_file_operations = {&n;&t;read:&t;&t;ntfs_read,&n;&t;mmap:&t;&t;generic_file_mmap,&n;#ifdef CONFIG_NTFS_RW&n;&t;write:&t;&t;ntfs_write,&n;#endif&n;};&n;&n;static struct inode_operations ntfs_inode_operations;&n;*/
DECL|variable|ntfs_dir_operations
r_static
r_struct
id|file_operations
id|ntfs_dir_operations
op_assign
(brace
id|read
suffix:colon
id|generic_read_dir
comma
id|readdir
suffix:colon
id|ntfs_readdir
comma
)brace
suffix:semicolon
DECL|variable|ntfs_dir_inode_operations
r_static
r_struct
id|inode_operations
id|ntfs_dir_inode_operations
op_assign
(brace
id|lookup
suffix:colon
id|ntfs_lookup
comma
macro_line|#ifdef CONFIG_NTFS_RW
id|create
suffix:colon
id|ntfs_create
comma
id|mkdir
suffix:colon
id|_linux_ntfs_mkdir
comma
macro_line|#endif
)brace
suffix:semicolon
multiline_comment|/*&n;static int ntfs_writepage(struct page *page)&n;{&n;&t;return block_write_full_page(page,ntfs_get_block);&n;}&n;static int ntfs_readpage(struct file *file, struct page *page)&n;{&n;&t;return block_read_full_page(page,ntfs_get_block);&n;}&n;static int ntfs_prepare_write(struct file *file, struct page *page, unsigned from, unsigned to)&n;{&n;&t;return cont_prepare_write(page,from,to,ntfs_get_block,&n;&t;&t;&amp;page-&gt;mapping-&gt;host-&gt;u.ntfs_i.mmu_private);&n;}&n;static int _ntfs_bmap(struct address_space *mapping, long block)&n;{&n;&t;return generic_block_bmap(mapping,block,ntfs_get_block);&n;}&n;struct address_space_operations ntfs_aops = {&n;&t;readpage: ntfs_readpage,&n;&t;writepage: ntfs_writepage,&n;&t;sync_page: block_sync_page,&n;&t;prepare_write: ntfs_prepare_write,&n;&t;commit_write: generic_commit_write,&n;&t;bmap: _ntfs_bmap&n;};&n;*/
multiline_comment|/* ntfs_read_inode is called by the Virtual File System (the kernel layer that&n; * deals with filesystems) when iget is called requesting an inode not already&n; * present in the inode table. Typically filesystems have separate&n; * inode_operations for directories, files and symlinks.&n; */
DECL|function|ntfs_read_inode
r_static
r_void
id|ntfs_read_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|ntfs_volume
op_star
id|vol
suffix:semicolon
r_int
id|can_mmap
op_assign
l_int|0
suffix:semicolon
id|ntfs_inode
op_star
id|ino
suffix:semicolon
id|ntfs_attribute
op_star
id|data
suffix:semicolon
id|ntfs_attribute
op_star
id|si
suffix:semicolon
id|vol
op_assign
id|NTFS_INO2VOL
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode-&gt;i_mode
op_assign
l_int|0
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_read_inode %x&bslash;n&quot;
comma
(paren
r_int
)paren
id|inode-&gt;i_ino
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|inode-&gt;i_ino
)paren
(brace
multiline_comment|/* those are loaded special files */
r_case
id|FILE_MFT
suffix:colon
id|ntfs_error
c_func
(paren
l_string|&quot;Trying to open MFT&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
macro_line|#ifdef NTFS_IN_LINUX_KERNEL
id|ino
op_assign
op_amp
id|inode-&gt;u.ntfs_i
suffix:semicolon
macro_line|#else
multiline_comment|/* FIXME: check for ntfs_malloc failure */
id|ino
op_assign
(paren
id|ntfs_inode
op_star
)paren
id|ntfs_malloc
c_func
(paren
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|inode-&gt;u.generic_ip
op_assign
id|ino
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|ino
op_logical_or
id|ntfs_init_inode
c_func
(paren
id|ino
comma
id|NTFS_INO2VOL
c_func
(paren
id|inode
)paren
comma
id|inode-&gt;i_ino
)paren
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;NTFS:Error loading inode %x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|inode-&gt;i_ino
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/* Set uid/gid from mount options */
id|inode-&gt;i_uid
op_assign
id|vol-&gt;uid
suffix:semicolon
id|inode-&gt;i_gid
op_assign
id|vol-&gt;gid
suffix:semicolon
id|inode-&gt;i_nlink
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Use the size of the data attribute as file size */
id|data
op_assign
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_data
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
(brace
id|inode-&gt;i_size
op_assign
l_int|0
suffix:semicolon
id|can_mmap
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_size
op_assign
id|data-&gt;size
suffix:semicolon
multiline_comment|/* FIXME: once ntfs_get_block is implemented, uncomment the&n;&t;&t; * next line and remove the can_mmap = 0; */
multiline_comment|/* can_mmap=!data-&gt;resident &amp;&amp; !data-&gt;compressed;*/
id|can_mmap
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get the file modification times from the standard information */
id|si
op_assign
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_standard_information
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si
)paren
(brace
r_char
op_star
id|attr
op_assign
id|si-&gt;d.data
suffix:semicolon
id|inode-&gt;i_atime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|0x18
)paren
)paren
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
)paren
)paren
suffix:semicolon
id|inode-&gt;i_mtime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|8
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* if it has an index root, it&squot;s a directory */
r_if
c_cond
(paren
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_index_root
comma
l_string|&quot;$I30&quot;
)paren
)paren
(brace
id|ntfs_attribute
op_star
id|at
suffix:semicolon
id|at
op_assign
id|ntfs_find_attr
(paren
id|ino
comma
id|vol-&gt;at_index_allocation
comma
l_string|&quot;$I30&quot;
)paren
suffix:semicolon
id|inode-&gt;i_size
op_assign
id|at
ques
c_cond
id|at-&gt;size
suffix:colon
l_int|0
suffix:semicolon
id|inode-&gt;i_op
op_assign
op_amp
id|ntfs_dir_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|ntfs_dir_operations
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* As long as ntfs_get_block() is just a call to BUG() do not&n;&t; &t; * define any [bm]map ops or we get the BUG() whenever someone&n;&t;&t; * runs mc or mpg123 on an ntfs partition!&n;&t;&t; * FIXME: Uncomment the below code when ntfs_get_block is&n;&t;&t; * implemented. */
multiline_comment|/* if (can_mmap) {&n;&t;&t;&t;inode-&gt;i_op = &amp;ntfs_inode_operations;&n;&t;&t;&t;inode-&gt;i_fop = &amp;ntfs_file_operations;&n;&t;&t;&t;inode-&gt;i_mapping-&gt;a_ops = &amp;ntfs_aops;&n;&t;&t;&t;inode-&gt;u.ntfs_i.mmu_private = inode-&gt;i_size;&n;&t;&t;} else */
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|ntfs_inode_operations_nobmap
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|ntfs_file_operations_nommap
suffix:semicolon
)brace
id|inode-&gt;i_mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NTFS_RW
r_if
c_cond
(paren
op_logical_neg
id|data
op_logical_or
op_logical_neg
id|data-&gt;compressed
)paren
(brace
id|inode-&gt;i_mode
op_or_assign
id|S_IWUGO
suffix:semicolon
)brace
macro_line|#endif
id|inode-&gt;i_mode
op_and_assign
op_complement
id|vol-&gt;umask
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NTFS_RW
r_static
r_void
DECL|function|ntfs_write_inode
id|ntfs_write_inode
(paren
r_struct
id|inode
op_star
id|ino
comma
r_int
id|unused
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|ntfs_debug
(paren
id|DEBUG_LINUX
comma
l_string|&quot;ntfs:write inode %x&bslash;n&quot;
comma
id|ino-&gt;i_ino
)paren
suffix:semicolon
id|ntfs_update_inode
(paren
id|NTFS_LINO2NINO
(paren
id|ino
)paren
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|_ntfs_clear_inode
r_static
r_void
id|_ntfs_clear_inode
c_func
(paren
r_struct
id|inode
op_star
id|ino
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_clear_inode %lx&bslash;n&quot;
comma
id|ino-&gt;i_ino
)paren
suffix:semicolon
macro_line|#ifdef NTFS_IN_LINUX_KERNEL
r_if
c_cond
(paren
id|ino-&gt;i_ino
op_ne
id|FILE_MFT
)paren
(brace
id|ntfs_clear_inode
c_func
(paren
op_amp
id|ino-&gt;u.ntfs_i
)paren
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
id|ino-&gt;i_ino
op_ne
id|FILE_MFT
op_logical_and
id|ino-&gt;u.generic_ip
)paren
(brace
id|ntfs_clear_inode
c_func
(paren
id|ino-&gt;u.generic_ip
)paren
suffix:semicolon
id|ntfs_free
c_func
(paren
id|ino-&gt;u.generic_ip
)paren
suffix:semicolon
id|ino-&gt;u.generic_ip
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Called when umounting a filesystem by do_umount() in fs/super.c */
DECL|function|ntfs_put_super
r_static
r_void
id|ntfs_put_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
id|ntfs_volume
op_star
id|vol
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_put_super&bslash;n&quot;
)paren
suffix:semicolon
id|vol
op_assign
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
suffix:semicolon
id|ntfs_release_volume
c_func
(paren
id|vol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vol-&gt;nls_map
)paren
(brace
id|unload_nls
c_func
(paren
id|vol-&gt;nls_map
)paren
suffix:semicolon
)brace
macro_line|#ifndef NTFS_IN_LINUX_KERNEL
id|ntfs_free
c_func
(paren
id|vol
)paren
suffix:semicolon
macro_line|#endif
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_put_super: done&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Called by the kernel when asking for stats */
DECL|function|ntfs_statfs
r_static
r_int
id|ntfs_statfs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|statfs
op_star
id|sf
)paren
(brace
r_struct
id|inode
op_star
id|mft
suffix:semicolon
id|ntfs_volume
op_star
id|vol
suffix:semicolon
id|ntfs_u64
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_statfs&bslash;n&quot;
)paren
suffix:semicolon
id|vol
op_assign
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
suffix:semicolon
id|sf-&gt;f_type
op_assign
id|NTFS_SUPER_MAGIC
suffix:semicolon
id|sf-&gt;f_bsize
op_assign
id|vol-&gt;clustersize
suffix:semicolon
id|error
op_assign
id|ntfs_get_volumesize
c_func
(paren
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_return
op_minus
id|error
suffix:semicolon
)brace
id|sf-&gt;f_blocks
op_assign
id|size
suffix:semicolon
multiline_comment|/* volumesize is in clusters */
id|sf-&gt;f_bfree
op_assign
id|ntfs_get_free_cluster_count
c_func
(paren
id|vol-&gt;bitmap
)paren
suffix:semicolon
id|sf-&gt;f_bavail
op_assign
id|sf-&gt;f_bfree
suffix:semicolon
id|mft
op_assign
id|iget
c_func
(paren
id|sb
comma
id|FILE_MFT
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mft
)paren
r_return
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* So ... we lie... thus this following cast of loff_t value&n;&t;   is ok here.. */
id|sf-&gt;f_files
op_assign
(paren
r_int
r_int
)paren
id|mft-&gt;i_size
op_div
id|vol-&gt;mft_recordsize
suffix:semicolon
id|iput
c_func
(paren
id|mft
)paren
suffix:semicolon
multiline_comment|/* should be read from volume */
id|sf-&gt;f_namelen
op_assign
l_int|255
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Called when remounting a filesystem by do_remount_sb() in fs/super.c */
DECL|function|ntfs_remount_fs
r_static
r_int
id|ntfs_remount_fs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
op_star
id|flags
comma
r_char
op_star
id|options
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|parse_options
c_func
(paren
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
comma
id|options
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Define the super block operation that are implemented */
DECL|variable|ntfs_super_operations
r_static
r_struct
id|super_operations
id|ntfs_super_operations
op_assign
(brace
id|read_inode
suffix:colon
id|ntfs_read_inode
comma
macro_line|#ifdef CONFIG_NTFS_RW
id|write_inode
suffix:colon
id|ntfs_write_inode
comma
macro_line|#endif
id|put_super
suffix:colon
id|ntfs_put_super
comma
id|statfs
suffix:colon
id|ntfs_statfs
comma
id|remount_fs
suffix:colon
id|ntfs_remount_fs
comma
id|clear_inode
suffix:colon
id|_ntfs_clear_inode
comma
)brace
suffix:semicolon
multiline_comment|/* Called to mount a filesystem by read_super() in fs/super.c&n; * Return a super block, the main structure of a filesystem&n; *&n; * NOTE : Don&squot;t store a pointer to an option, as the page containing the&n; * options is freed after ntfs_read_super() returns.&n; *&n; * NOTE : A context switch can happen in kernel code only if the code blocks&n; * (= calls schedule() in kernel/sched.c).&n; */
DECL|function|ntfs_read_super
r_struct
id|super_block
op_star
id|ntfs_read_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_void
op_star
id|options
comma
r_int
id|silent
)paren
(brace
id|ntfs_volume
op_star
id|vol
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_read_super&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef NTFS_IN_LINUX_KERNEL
id|vol
op_assign
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
op_logical_neg
(paren
id|vol
op_assign
id|ntfs_malloc
c_func
(paren
r_sizeof
(paren
id|ntfs_volume
)paren
)paren
)paren
)paren
(brace
r_goto
id|ntfs_read_super_dec
suffix:semicolon
)brace
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
op_assign
id|vol
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|parse_options
c_func
(paren
id|vol
comma
(paren
r_char
op_star
)paren
id|options
)paren
)paren
(brace
r_goto
id|ntfs_read_super_vol
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* Set to read only, user option might reset it */
id|sb-&gt;s_flags
op_or_assign
id|MS_RDONLY
suffix:semicolon
macro_line|#endif
multiline_comment|/* Assume a 512 bytes block device for now */
id|set_blocksize
c_func
(paren
id|sb-&gt;s_dev
comma
l_int|512
)paren
suffix:semicolon
multiline_comment|/* Read the super block (boot block) */
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|bread
c_func
(paren
id|sb-&gt;s_dev
comma
l_int|0
comma
l_int|512
)paren
)paren
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Reading super block failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_unl
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Done reading boot block&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Check for &squot;NTFS&squot; magic number */
r_if
c_cond
(paren
op_logical_neg
id|IS_NTFS_VOLUME
c_func
(paren
id|bh-&gt;b_data
)paren
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Not a NTFS volume&bslash;n&quot;
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_unl
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Going to init volume&bslash;n&quot;
)paren
suffix:semicolon
id|ntfs_init_volume
c_func
(paren
id|vol
comma
id|bh-&gt;b_data
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;MFT record at cluster 0x%X&bslash;n&quot;
comma
id|vol-&gt;mft_cluster
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
id|NTFS_SB
c_func
(paren
id|vol
)paren
op_assign
id|sb
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Done to init volume&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Inform the kernel that a device block is a NTFS cluster */
id|sb-&gt;s_blocksize
op_assign
id|vol-&gt;clustersize
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|sb-&gt;s_blocksize
comma
id|sb-&gt;s_blocksize_bits
op_assign
l_int|0
suffix:semicolon
id|i
op_ne
l_int|1
suffix:semicolon
id|i
op_rshift_assign
l_int|1
)paren
(brace
id|sb-&gt;s_blocksize_bits
op_increment
suffix:semicolon
)brace
id|set_blocksize
c_func
(paren
id|sb-&gt;s_dev
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;set_blocksize&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Allocate a MFT record (MFT record can be smaller than a cluster) */
r_if
c_cond
(paren
op_logical_neg
(paren
id|vol-&gt;mft
op_assign
id|ntfs_malloc
c_func
(paren
id|max
c_func
(paren
id|vol-&gt;mft_recordsize
comma
id|vol-&gt;clustersize
)paren
)paren
)paren
)paren
(brace
r_goto
id|ntfs_read_super_unl
suffix:semicolon
)brace
multiline_comment|/* Read at least the MFT record for $MFT */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max
c_func
(paren
id|vol-&gt;mft_clusters_per_record
comma
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|bread
c_func
(paren
id|sb-&gt;s_dev
comma
id|vol-&gt;mft_cluster
op_plus
id|i
comma
id|vol-&gt;clustersize
)paren
)paren
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Could not read MFT record 0&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_mft
suffix:semicolon
)brace
id|ntfs_memcpy
c_func
(paren
id|vol-&gt;mft
op_plus
id|i
op_star
id|vol-&gt;clustersize
comma
id|bh-&gt;b_data
comma
id|vol-&gt;clustersize
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Read cluster %x&bslash;n&quot;
comma
id|vol-&gt;mft_cluster
op_plus
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* Check and fixup this MFT record */
r_if
c_cond
(paren
op_logical_neg
id|ntfs_check_mft_record
c_func
(paren
id|vol
comma
id|vol-&gt;mft
)paren
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Invalid MFT record 0&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_mft
suffix:semicolon
)brace
multiline_comment|/* Inform the kernel about which super operations are available */
id|sb-&gt;s_op
op_assign
op_amp
id|ntfs_super_operations
suffix:semicolon
id|sb-&gt;s_magic
op_assign
id|NTFS_SUPER_MAGIC
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Reading special files&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ntfs_load_special_files
c_func
(paren
id|vol
)paren
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Error loading special files&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_mft
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Getting RootDir&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Get the root directory */
r_if
c_cond
(paren
op_logical_neg
(paren
id|sb-&gt;s_root
op_assign
id|d_alloc_root
c_func
(paren
id|iget
c_func
(paren
id|sb
comma
id|FILE_ROOT
)paren
)paren
)paren
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Could not get root dir inode&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_mft
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;read_super: done&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|sb
suffix:semicolon
id|ntfs_read_super_mft
suffix:colon
id|ntfs_free
c_func
(paren
id|vol-&gt;mft
)paren
suffix:semicolon
id|ntfs_read_super_unl
suffix:colon
id|ntfs_read_super_vol
suffix:colon
macro_line|#ifndef NTFS_IN_LINUX_KERNEL
id|ntfs_free
c_func
(paren
id|vol
)paren
suffix:semicolon
id|ntfs_read_super_dec
suffix:colon
macro_line|#endif
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;read_super: done&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Define the filesystem&n; */
r_static
id|DECLARE_FSTYPE_DEV
c_func
(paren
id|ntfs_fs_type
comma
l_string|&quot;ntfs&quot;
comma
id|ntfs_read_super
)paren
suffix:semicolon
DECL|function|init_ntfs_fs
r_static
r_int
id|__init
id|init_ntfs_fs
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Comment this if you trust klogd. There are reasons not to trust it&n;&t; */
macro_line|#if defined(DEBUG) &amp;&amp; !defined(MODULE)
id|console_verbose
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NTFS version &quot;
id|NTFS_VERSION
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|SYSCTL
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;registering %s&bslash;n&quot;
comma
id|ntfs_fs_type.name
)paren
suffix:semicolon
multiline_comment|/* add this filesystem to the kernel table of filesystems */
r_return
id|register_filesystem
c_func
(paren
op_amp
id|ntfs_fs_type
)paren
suffix:semicolon
)brace
DECL|function|exit_ntfs_fs
r_static
r_void
id|__exit
id|exit_ntfs_fs
c_func
(paren
r_void
)paren
(brace
id|SYSCTL
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;unregistering %s&bslash;n&quot;
comma
id|ntfs_fs_type.name
)paren
suffix:semicolon
id|unregister_filesystem
c_func
(paren
op_amp
id|ntfs_fs_type
)paren
suffix:semicolon
)brace
id|EXPORT_NO_SYMBOLS
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Martin von L&#xfffd;wis&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;NTFS driver&quot;
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|MODULE_PARM
c_func
(paren
id|ntdebug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|ntdebug
comma
l_string|&quot;Debug level&quot;
)paren
suffix:semicolon
macro_line|#endif
id|module_init
c_func
(paren
id|init_ntfs_fs
)paren
id|module_exit
c_func
(paren
id|exit_ntfs_fs
)paren
multiline_comment|/*&n; * Local variables:&n; *  c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
