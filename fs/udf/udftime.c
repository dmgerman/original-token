multiline_comment|/* Copyright (C) 1993, 1994, 1995, 1996, 1997 Free Software Foundation, Inc.&n;   This file is part of the GNU C Library.&n;   Contributed by Paul Eggert (eggert@twinsun.com).&n;&n;   The GNU C Library is free software; you can redistribute it and/or&n;   modify it under the terms of the GNU Library General Public License as&n;   published by the Free Software Foundation; either version 2 of the&n;   License, or (at your option) any later version.&n;&n;   The GNU C Library is distributed in the hope that it will be useful,&n;   but WITHOUT ANY WARRANTY; without even the implied warranty of&n;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n;   Library General Public License for more details.&n;&n;   You should have received a copy of the GNU Library General Public&n;   License along with the GNU C Library; see the file COPYING.LIB.  If not,&n;   write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330,&n;   Boston, MA 02111-1307, USA.  */
multiline_comment|/*&n; * dgb 10/02/98: ripped this from glibc source to help convert timestamps to unix time &n; *     10/04/98: added new table-based lookup after seeing how ugly the gnu code is&n; * blf 09/27/99: ripped out all the old code and inserted new table from&n; *&t;&t;&t;&t;&t;John Brockmeyer (without leap second corrections)&n; *&t;&t;&t;&t; rewrote udf_stamp_to_time and fixed timezone accounting in&n;&t;&t;&t;&t;&t;udf_time_to_stamp.&n; */
multiline_comment|/*&n; * We don&squot;t take into account leap seconds. This may be correct or incorrect.&n; * For more NIST information (especially dealing with leap seconds), see:&n; *  http://www.boulder.nist.gov/timefreq/pubs/bulletin/leapsecond.htm&n; */
macro_line|#if defined(__linux__) &amp;&amp; defined(__KERNEL__)
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#else
macro_line|#include &lt;stdio.h&gt;
macro_line|#include &lt;sys/types.h&gt;
macro_line|#include &lt;sys/time.h&gt;
macro_line|#endif
macro_line|#include &quot;udfdecl.h&quot;
DECL|macro|EPOCH_YEAR
mdefine_line|#define EPOCH_YEAR 1970
macro_line|#ifndef __isleap
multiline_comment|/* Nonzero if YEAR is a leap year (every 4 years,&n;   except every 100th isn&squot;t, and every 400th is).  */
DECL|macro|__isleap
mdefine_line|#define&t;__isleap(year)&t;&bslash;&n;  ((year) % 4 == 0 &amp;&amp; ((year) % 100 != 0 || (year) % 400 == 0))
macro_line|#endif
multiline_comment|/* How many days come before each month (0-12).  */
DECL|variable|__mon_yday
r_const
r_int
r_int
r_int
id|__mon_yday
(braket
l_int|2
)braket
(braket
l_int|13
)braket
op_assign
(brace
multiline_comment|/* Normal years.  */
(brace
l_int|0
comma
l_int|31
comma
l_int|59
comma
l_int|90
comma
l_int|120
comma
l_int|151
comma
l_int|181
comma
l_int|212
comma
l_int|243
comma
l_int|273
comma
l_int|304
comma
l_int|334
comma
l_int|365
)brace
comma
multiline_comment|/* Leap years.  */
(brace
l_int|0
comma
l_int|31
comma
l_int|60
comma
l_int|91
comma
l_int|121
comma
l_int|152
comma
l_int|182
comma
l_int|213
comma
l_int|244
comma
l_int|274
comma
l_int|305
comma
l_int|335
comma
l_int|366
)brace
)brace
suffix:semicolon
DECL|macro|MAX_YEAR_SECONDS
mdefine_line|#define MAX_YEAR_SECONDS&t;69
DECL|macro|SPD
mdefine_line|#define SPD 0x15180 /*3600*24*/
DECL|macro|SPY
mdefine_line|#define SPY(y,l,s) (SPD * (365*y+l)+s)
DECL|variable|year_seconds
id|time_t
id|year_seconds
(braket
id|MAX_YEAR_SECONDS
)braket
op_assign
(brace
multiline_comment|/*1970*/
id|SPY
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|2
comma
l_int|0
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|3
comma
l_int|1
comma
l_int|0
)paren
comma
multiline_comment|/*1974*/
id|SPY
c_func
(paren
l_int|4
comma
l_int|1
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|5
comma
l_int|1
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|6
comma
l_int|1
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|7
comma
l_int|2
comma
l_int|0
)paren
comma
multiline_comment|/*1978*/
id|SPY
c_func
(paren
l_int|8
comma
l_int|2
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|9
comma
l_int|2
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|10
comma
l_int|2
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|11
comma
l_int|3
comma
l_int|0
)paren
comma
multiline_comment|/*1982*/
id|SPY
c_func
(paren
l_int|12
comma
l_int|3
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|13
comma
l_int|3
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|14
comma
l_int|3
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|15
comma
l_int|4
comma
l_int|0
)paren
comma
multiline_comment|/*1986*/
id|SPY
c_func
(paren
l_int|16
comma
l_int|4
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|17
comma
l_int|4
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|18
comma
l_int|4
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|19
comma
l_int|5
comma
l_int|0
)paren
comma
multiline_comment|/*1990*/
id|SPY
c_func
(paren
l_int|20
comma
l_int|5
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|21
comma
l_int|5
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|22
comma
l_int|5
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|23
comma
l_int|6
comma
l_int|0
)paren
comma
multiline_comment|/*1994*/
id|SPY
c_func
(paren
l_int|24
comma
l_int|6
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|25
comma
l_int|6
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|26
comma
l_int|6
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|27
comma
l_int|7
comma
l_int|0
)paren
comma
multiline_comment|/*1998*/
id|SPY
c_func
(paren
l_int|28
comma
l_int|7
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|29
comma
l_int|7
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|30
comma
l_int|7
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|31
comma
l_int|8
comma
l_int|0
)paren
comma
multiline_comment|/*2002*/
id|SPY
c_func
(paren
l_int|32
comma
l_int|8
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|33
comma
l_int|8
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|34
comma
l_int|8
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|35
comma
l_int|9
comma
l_int|0
)paren
comma
multiline_comment|/*2006*/
id|SPY
c_func
(paren
l_int|36
comma
l_int|9
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|37
comma
l_int|9
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|38
comma
l_int|9
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|39
comma
l_int|10
comma
l_int|0
)paren
comma
multiline_comment|/*2010*/
id|SPY
c_func
(paren
l_int|40
comma
l_int|10
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|41
comma
l_int|10
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|42
comma
l_int|10
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|43
comma
l_int|11
comma
l_int|0
)paren
comma
multiline_comment|/*2014*/
id|SPY
c_func
(paren
l_int|44
comma
l_int|11
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|45
comma
l_int|11
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|46
comma
l_int|11
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|47
comma
l_int|12
comma
l_int|0
)paren
comma
multiline_comment|/*2018*/
id|SPY
c_func
(paren
l_int|48
comma
l_int|12
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|49
comma
l_int|12
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|50
comma
l_int|12
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|51
comma
l_int|13
comma
l_int|0
)paren
comma
multiline_comment|/*2022*/
id|SPY
c_func
(paren
l_int|52
comma
l_int|13
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|53
comma
l_int|13
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|54
comma
l_int|13
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|55
comma
l_int|14
comma
l_int|0
)paren
comma
multiline_comment|/*2026*/
id|SPY
c_func
(paren
l_int|56
comma
l_int|14
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|57
comma
l_int|14
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|58
comma
l_int|14
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|59
comma
l_int|15
comma
l_int|0
)paren
comma
multiline_comment|/*2030*/
id|SPY
c_func
(paren
l_int|60
comma
l_int|15
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|61
comma
l_int|15
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|62
comma
l_int|15
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|63
comma
l_int|16
comma
l_int|0
)paren
comma
multiline_comment|/*2034*/
id|SPY
c_func
(paren
l_int|64
comma
l_int|16
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|65
comma
l_int|16
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|66
comma
l_int|16
comma
l_int|0
)paren
comma
id|SPY
c_func
(paren
l_int|67
comma
l_int|17
comma
l_int|0
)paren
comma
multiline_comment|/*2038*/
id|SPY
c_func
(paren
l_int|68
comma
l_int|17
comma
l_int|0
)paren
)brace
suffix:semicolon
macro_line|#ifdef __KERNEL__
r_extern
r_struct
id|timezone
id|sys_tz
suffix:semicolon
macro_line|#endif
DECL|macro|SECS_PER_HOUR
mdefine_line|#define SECS_PER_HOUR&t;(60 * 60)
DECL|macro|SECS_PER_DAY
mdefine_line|#define SECS_PER_DAY&t;(SECS_PER_HOUR * 24)
id|time_t
op_star
DECL|function|udf_stamp_to_time
id|udf_stamp_to_time
c_func
(paren
id|time_t
op_star
id|dest
comma
r_int
op_star
id|dest_usec
comma
id|timestamp
id|src
)paren
(brace
r_int
id|yday
suffix:semicolon
id|Uint8
id|type
op_assign
id|src.typeAndTimezone
op_rshift
l_int|12
suffix:semicolon
id|Sint16
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
l_int|1
)paren
(brace
id|offset
op_assign
id|src.typeAndTimezone
op_lshift
l_int|4
suffix:semicolon
multiline_comment|/* sign extent offset */
id|offset
op_assign
(paren
id|offset
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
r_else
id|offset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|src.year
OL
id|EPOCH_YEAR
)paren
op_logical_or
(paren
id|src.year
OG
id|EPOCH_YEAR
op_plus
id|MAX_YEAR_SECONDS
)paren
)paren
(brace
op_star
id|dest
op_assign
op_minus
l_int|1
suffix:semicolon
op_star
id|dest_usec
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|dest
op_assign
id|year_seconds
(braket
id|src.year
op_minus
id|EPOCH_YEAR
)braket
suffix:semicolon
op_star
id|dest
op_sub_assign
id|offset
op_star
l_int|60
suffix:semicolon
id|yday
op_assign
(paren
(paren
id|__mon_yday
(braket
id|__isleap
(paren
id|src.year
)paren
)braket
(braket
id|src.month
op_minus
l_int|1
)braket
)paren
op_plus
(paren
id|src.day
op_minus
l_int|1
)paren
)paren
suffix:semicolon
op_star
id|dest
op_add_assign
(paren
(paren
(paren
id|yday
op_star
l_int|24
)paren
op_plus
id|src.hour
)paren
op_star
l_int|60
op_plus
id|src.minute
)paren
op_star
l_int|60
op_plus
id|src.second
suffix:semicolon
op_star
id|dest_usec
op_assign
id|src.centiseconds
op_star
l_int|10000
op_plus
id|src.hundredsOfMicroseconds
op_star
l_int|100
op_plus
id|src.microseconds
suffix:semicolon
r_return
id|dest
suffix:semicolon
)brace
id|timestamp
op_star
DECL|function|udf_time_to_stamp
id|udf_time_to_stamp
c_func
(paren
id|timestamp
op_star
id|dest
comma
id|time_t
id|tv_sec
comma
r_int
id|tv_usec
)paren
(brace
r_int
r_int
id|days
comma
id|rem
comma
id|y
suffix:semicolon
r_const
r_int
r_int
r_int
op_star
id|ip
suffix:semicolon
id|Sint16
id|offset
suffix:semicolon
macro_line|#ifndef __KERNEL__
r_struct
id|timeval
id|tv
suffix:semicolon
r_struct
id|timezone
id|sys_tz
suffix:semicolon
id|gettimeofday
c_func
(paren
op_amp
id|tv
comma
op_amp
id|sys_tz
)paren
suffix:semicolon
macro_line|#endif
id|offset
op_assign
op_minus
id|sys_tz.tz_minuteswest
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dest
)paren
r_return
l_int|NULL
suffix:semicolon
id|dest-&gt;typeAndTimezone
op_assign
l_int|0x1000
op_or
(paren
id|offset
op_amp
l_int|0x0FFF
)paren
suffix:semicolon
id|tv_sec
op_add_assign
id|offset
op_star
l_int|60
suffix:semicolon
id|days
op_assign
id|tv_sec
op_div
id|SECS_PER_DAY
suffix:semicolon
id|rem
op_assign
id|tv_sec
op_mod
id|SECS_PER_DAY
suffix:semicolon
id|dest-&gt;hour
op_assign
id|rem
op_div
id|SECS_PER_HOUR
suffix:semicolon
id|rem
op_mod_assign
id|SECS_PER_HOUR
suffix:semicolon
id|dest-&gt;minute
op_assign
id|rem
op_div
l_int|60
suffix:semicolon
id|dest-&gt;second
op_assign
id|rem
op_mod
l_int|60
suffix:semicolon
id|y
op_assign
l_int|1970
suffix:semicolon
DECL|macro|DIV
mdefine_line|#define DIV(a,b) ((a) / (b) - ((a) % (b) &lt; 0))
DECL|macro|LEAPS_THRU_END_OF
mdefine_line|#define LEAPS_THRU_END_OF(y) (DIV (y, 4) - DIV (y, 100) + DIV (y, 400))
r_while
c_loop
(paren
id|days
OL
l_int|0
op_logical_or
id|days
op_ge
(paren
id|__isleap
c_func
(paren
id|y
)paren
ques
c_cond
l_int|366
suffix:colon
l_int|365
)paren
)paren
(brace
r_int
r_int
id|yg
op_assign
id|y
op_plus
id|days
op_div
l_int|365
op_minus
(paren
id|days
op_mod
l_int|365
OL
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Adjust DAYS and Y to match the guessed year.  */
id|days
op_sub_assign
(paren
(paren
id|yg
op_minus
id|y
)paren
op_star
l_int|365
op_plus
id|LEAPS_THRU_END_OF
(paren
id|yg
op_minus
l_int|1
)paren
op_minus
id|LEAPS_THRU_END_OF
(paren
id|y
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|y
op_assign
id|yg
suffix:semicolon
)brace
id|dest-&gt;year
op_assign
id|y
suffix:semicolon
id|ip
op_assign
id|__mon_yday
(braket
id|__isleap
c_func
(paren
id|y
)paren
)braket
suffix:semicolon
r_for
c_loop
(paren
id|y
op_assign
l_int|11
suffix:semicolon
id|days
OL
(paren
r_int
r_int
)paren
id|ip
(braket
id|y
)braket
suffix:semicolon
op_decrement
id|y
)paren
r_continue
suffix:semicolon
id|days
op_sub_assign
id|ip
(braket
id|y
)braket
suffix:semicolon
id|dest-&gt;month
op_assign
id|y
op_plus
l_int|1
suffix:semicolon
id|dest-&gt;day
op_assign
id|days
op_plus
l_int|1
suffix:semicolon
id|dest-&gt;centiseconds
op_assign
id|tv_usec
op_div
l_int|10000
suffix:semicolon
id|dest-&gt;hundredsOfMicroseconds
op_assign
(paren
id|tv_usec
op_minus
id|dest-&gt;centiseconds
op_star
l_int|10000
)paren
op_div
l_int|100
suffix:semicolon
id|dest-&gt;microseconds
op_assign
(paren
id|tv_usec
op_minus
id|dest-&gt;centiseconds
op_star
l_int|10000
op_minus
id|dest-&gt;hundredsOfMicroseconds
op_star
l_int|100
)paren
suffix:semicolon
r_return
id|dest
suffix:semicolon
)brace
multiline_comment|/* EOF */
eof
