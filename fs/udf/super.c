multiline_comment|/*&n; * super.c&n; *&n; * PURPOSE&n; *  Super block routines for the OSTA-UDF(tm) filesystem.&n; *&n; * DESCRIPTION&n; *  OSTA-UDF(tm) = Optical Storage Technology Association&n; *  Universal Disk Format.&n; *&n; *  This code is based on version 2.00 of the UDF specification,&n; *  and revision 3 of the ECMA 167 standard [equivalent to ISO 13346].&n; *    http://www.osta.org/&n; *    http://www.ecma.ch/&n; *    http://www.iso.org/&n; *&n; * CONTACTS&n; *  E-mail regarding any portion of the Linux UDF file system should be&n; *  directed to the development team mailing list (run by majordomo):&n; *&t;  linux_udf@hootie.lvld.hp.com&n; *&n; * COPYRIGHT&n; *  This file is distributed under the terms of the GNU General Public&n; *  License (GPL). Copies of the GPL can be obtained from:&n; *    ftp://prep.ai.mit.edu/pub/gnu/GPL&n; *  Each contributing author retains all rights to their own work.&n; *&n; *  (C) 1998 Dave Boynton&n; *  (C) 1998-1999 Ben Fennema&n; *&n; * HISTORY&n; *&n; *  09/24/98 dgb  changed to allow compiling outside of kernel, and&n; *                added some debugging.&n; *  10/01/98 dgb  updated to allow (some) possibility of compiling w/2.0.34&n; *  10/16/98      attempting some multi-session support&n; *  10/17/98      added freespace count for &quot;df&quot;&n; *  11/11/98 gr   added novrs option&n; *  11/26/98 dgb  added fileset,anchor mount options&n; *  12/06/98 blf  really hosed things royally. vat/sparing support. sequenced vol descs&n; *                rewrote option handling based on isofs&n; *  12/20/98      find the free space bitmap (if it exists)&n; */
macro_line|#ifndef LINUX_VERSION_CODE
macro_line|#include &lt;linux/version.h&gt;
macro_line|#endif
macro_line|#include &quot;udfdecl.h&quot;    
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/locks.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/cdrom.h&gt;
macro_line|#include &lt;linux/nls.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;linux/udf_fs.h&gt;
macro_line|#include &quot;udf_sb.h&quot;
macro_line|#include &quot;udf_i.h&quot;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|variable|error_buf
r_static
r_char
id|error_buf
(braket
l_int|1024
)braket
suffix:semicolon
multiline_comment|/* These are the &quot;meat&quot; - everything else is stuffing */
r_static
r_struct
id|super_block
op_star
id|udf_read_super
c_func
(paren
r_struct
id|super_block
op_star
comma
r_void
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|udf_put_super
c_func
(paren
r_struct
id|super_block
op_star
)paren
suffix:semicolon
r_static
r_int
id|udf_remount_fs
c_func
(paren
r_struct
id|super_block
op_star
comma
r_int
op_star
comma
r_char
op_star
)paren
suffix:semicolon
r_static
r_int
id|udf_check_valid
c_func
(paren
r_struct
id|super_block
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|udf_vrs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
id|silent
)paren
suffix:semicolon
r_static
r_int
id|udf_load_partition
c_func
(paren
r_struct
id|super_block
op_star
comma
id|lb_addr
op_star
)paren
suffix:semicolon
r_static
r_int
id|udf_load_logicalvol
c_func
(paren
r_struct
id|super_block
op_star
comma
r_struct
id|buffer_head
op_star
comma
id|lb_addr
op_star
)paren
suffix:semicolon
r_static
r_void
id|udf_load_logicalvolint
c_func
(paren
r_struct
id|super_block
op_star
comma
id|extent_ad
)paren
suffix:semicolon
r_static
r_int
id|udf_find_anchor
c_func
(paren
r_struct
id|super_block
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|udf_find_fileset
c_func
(paren
r_struct
id|super_block
op_star
comma
id|lb_addr
op_star
comma
id|lb_addr
op_star
)paren
suffix:semicolon
r_static
r_void
id|udf_load_pvoldesc
c_func
(paren
r_struct
id|super_block
op_star
comma
r_struct
id|buffer_head
op_star
)paren
suffix:semicolon
r_static
r_void
id|udf_load_fileset
c_func
(paren
r_struct
id|super_block
op_star
comma
r_struct
id|buffer_head
op_star
comma
id|lb_addr
op_star
)paren
suffix:semicolon
r_static
r_void
id|udf_load_partdesc
c_func
(paren
r_struct
id|super_block
op_star
comma
r_struct
id|buffer_head
op_star
)paren
suffix:semicolon
r_static
r_void
id|udf_open_lvid
c_func
(paren
r_struct
id|super_block
op_star
)paren
suffix:semicolon
r_static
r_void
id|udf_close_lvid
c_func
(paren
r_struct
id|super_block
op_star
)paren
suffix:semicolon
r_static
r_int
r_int
id|udf_count_free
c_func
(paren
r_struct
id|super_block
op_star
)paren
suffix:semicolon
multiline_comment|/* version specific functions */
r_static
r_int
id|udf_statfs
c_func
(paren
r_struct
id|super_block
op_star
comma
r_struct
id|statfs
op_star
comma
r_int
)paren
suffix:semicolon
multiline_comment|/* UDF filesystem type */
DECL|variable|udf_fstype
r_static
r_struct
id|file_system_type
id|udf_fstype
op_assign
(brace
l_string|&quot;udf&quot;
comma
multiline_comment|/* name */
id|FS_REQUIRES_DEV
comma
multiline_comment|/* fs_flags */
id|udf_read_super
comma
multiline_comment|/* read_super */
l_int|NULL
multiline_comment|/* next */
)brace
suffix:semicolon
multiline_comment|/* Superblock operations */
DECL|variable|udf_sb_ops
r_static
r_struct
id|super_operations
id|udf_sb_ops
op_assign
(brace
id|udf_read_inode
comma
multiline_comment|/* read_inode */
macro_line|#ifdef CONFIG_UDF_RW
id|udf_write_inode
comma
multiline_comment|/* write_inode */
macro_line|#else
l_int|NULL
comma
multiline_comment|/* write_inode */
macro_line|#endif
id|udf_put_inode
comma
multiline_comment|/* put_inode */
macro_line|#ifdef CONFIG_UDF_RW
id|udf_delete_inode
comma
multiline_comment|/* delete_inode */
macro_line|#else
l_int|NULL
comma
multiline_comment|/* delete_inode */
macro_line|#endif
l_int|NULL
comma
multiline_comment|/* notify_change */
id|udf_put_super
comma
multiline_comment|/* put_super */
l_int|NULL
comma
multiline_comment|/* write_super */
id|udf_statfs
comma
multiline_comment|/* statfs */
id|udf_remount_fs
comma
multiline_comment|/* remount_fs */
l_int|NULL
comma
multiline_comment|/* clear_inode */
l_int|NULL
comma
multiline_comment|/* umount_begin */
)brace
suffix:semicolon
DECL|struct|udf_options
r_struct
id|udf_options
(brace
DECL|member|novrs
r_int
r_char
id|novrs
suffix:semicolon
DECL|member|utf8
r_int
r_char
id|utf8
suffix:semicolon
DECL|member|blocksize
r_int
r_int
id|blocksize
suffix:semicolon
DECL|member|session
r_int
r_int
id|session
suffix:semicolon
DECL|member|lastblock
r_int
r_int
id|lastblock
suffix:semicolon
DECL|member|anchor
r_int
r_int
id|anchor
suffix:semicolon
DECL|member|volume
r_int
r_int
id|volume
suffix:semicolon
DECL|member|partition
r_int
r_int
id|partition
suffix:semicolon
DECL|member|fileset
r_int
r_int
id|fileset
suffix:semicolon
DECL|member|rootdir
r_int
r_int
id|rootdir
suffix:semicolon
DECL|member|flags
r_int
r_int
id|flags
suffix:semicolon
DECL|member|umask
id|mode_t
id|umask
suffix:semicolon
DECL|member|gid
id|gid_t
id|gid
suffix:semicolon
DECL|member|uid
id|uid_t
id|uid
suffix:semicolon
DECL|member|iocharset
r_char
op_star
id|iocharset
suffix:semicolon
)brace
suffix:semicolon
macro_line|#if defined(MODULE)
multiline_comment|/*&n; * cleanup_module&n; *&n; * PURPOSE&n; *&t;Unregister the UDF filesystem type.&n; *&n; * DESCRIPTION&n; *&t;Clean-up before the module is unloaded.&n; *&t;This routine only applies when compiled as a module.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
r_int
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;udf: unregistering filesystem&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|unregister_filesystem
c_func
(paren
op_amp
id|udf_fstype
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * init_module / init_udf_fs&n; *&n; * PURPOSE&n; *&t;Register the UDF filesystem type.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
macro_line|#else /* if !defined(MODULE) */
r_int
id|__init
id|init_udf_fs
c_func
(paren
r_void
)paren
macro_line|#endif
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;udf: registering filesystem&bslash;n&quot;
)paren
suffix:semicolon
(brace
r_struct
id|super_block
id|sb
suffix:semicolon
r_int
id|size
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
r_struct
id|super_block
)paren
op_plus
(paren
r_int
)paren
op_amp
id|sb.u
op_minus
(paren
r_int
)paren
op_amp
id|sb
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
r_sizeof
(paren
r_struct
id|udf_sb_info
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: Danger! Kernel was compiled without enough room for udf_sb_info&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: Kernel has room for %u bytes, udf needs %u&bslash;n&quot;
comma
id|size
comma
r_sizeof
(paren
r_struct
id|udf_sb_info
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|register_filesystem
c_func
(paren
op_amp
id|udf_fstype
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_parse_options&n; *&n; * PURPOSE&n; *&t;Parse mount options.&n; *&n; * DESCRIPTION&n; *&t;The following mount options are supported:&n; *&n; *&t;gid=&t;&t;Set the default group.&n; *&t;umask=&t;&t;Set the default umask.&n; *&t;uid=&t;&t;Set the default user.&n; *&t;unhide&t;&t;Show otherwise hidden files.&n; *&t;undelete&t;Show deleted files in lists.&n; *&t;strict&t;&t;Set strict conformance (unused)&n; *&t;utf8&t;&t;(unused)&n; *&t;iocharset&t;(unused)&n; *&n; *&t;The remaining are for debugging and disaster recovery:&n; *&n; *&t;bs=&t;&t;Set the block size. (may not work unless 2048)&n; *&t;novrs           Skip volume sequence recognition &n; *&n; *&t;The following expect a offset from 0.&n; *&n; *&t;session=&t;Set the CDROM session (default= last session)&n; *&t;anchor=&t;&t;Override standard anchor location. (default= 256)&n; *&t;volume=&t;&t;Override the VolumeDesc location. (unused)&n; *&t;partition=&t;Override the PartitionDesc location. (unused)&n; *&t;lastblock=&t;Set the last block of the filesystem/&n; *&n; *&t;The following expect a offset from the partition root.&n; *&n; *&t;fileset=&t;Override the fileset block location. (unused)&n; *&t;rootdir=&t;Override the root directory location. (unused)&n; *&t;&t;WARNING: overriding the rootdir to a non-directory may&n; *&t;&t;yield highly unpredictable results.&n; *&n; * PRE-CONDITIONS&n; *&t;options&t;&t;Pointer to mount options string.&n; *&t;uopts&t;&t;Pointer to mount options variable.&n; *&n; * POST-CONDITIONS&n; *&t;&lt;return&gt;&t;0&t;Mount options parsed okay.&n; *&t;&lt;return&gt;&t;-1&t;Error parsing mount options.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
r_static
r_int
DECL|function|udf_parse_options
id|udf_parse_options
c_func
(paren
r_char
op_star
id|options
comma
r_struct
id|udf_options
op_star
id|uopt
)paren
(brace
r_char
op_star
id|opt
comma
op_star
id|val
suffix:semicolon
id|uopt-&gt;novrs
op_assign
l_int|0
suffix:semicolon
id|uopt-&gt;blocksize
op_assign
l_int|2048
suffix:semicolon
id|uopt-&gt;partition
op_assign
l_int|0xFFFF
suffix:semicolon
id|uopt-&gt;session
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|uopt-&gt;lastblock
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|uopt-&gt;anchor
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|uopt-&gt;volume
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|uopt-&gt;rootdir
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|uopt-&gt;fileset
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|uopt-&gt;iocharset
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|opt
op_assign
id|strtok
c_func
(paren
id|options
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
id|opt
suffix:semicolon
id|opt
op_assign
id|strtok
c_func
(paren
l_int|NULL
comma
l_string|&quot;,&quot;
)paren
)paren
(brace
multiline_comment|/* Make &quot;opt=val&quot; into two strings */
id|val
op_assign
id|strchr
c_func
(paren
id|opt
comma
l_char|&squot;=&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
op_star
(paren
id|val
op_increment
)paren
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;novrs&quot;
)paren
op_logical_and
op_logical_neg
id|val
)paren
id|uopt-&gt;novrs
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;utf8&quot;
)paren
op_logical_and
op_logical_neg
id|val
)paren
id|uopt-&gt;utf8
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;bs&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;blocksize
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;unhide&quot;
)paren
op_logical_and
op_logical_neg
id|val
)paren
id|uopt-&gt;flags
op_or_assign
id|UDF_FLAG_UNHIDE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;undelete&quot;
)paren
op_logical_and
op_logical_neg
id|val
)paren
id|uopt-&gt;flags
op_or_assign
id|UDF_FLAG_UNDELETE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;gid&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;gid
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;umask&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;umask
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;strict&quot;
)paren
op_logical_and
op_logical_neg
id|val
)paren
id|uopt-&gt;flags
op_or_assign
id|UDF_FLAG_STRICT
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;uid&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;uid
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;session&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;session
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;lastblock&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;lastblock
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;anchor&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;anchor
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;volume&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;volume
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;partition&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;partition
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;fileset&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;fileset
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;rootdir&quot;
)paren
op_logical_and
id|val
)paren
id|uopt-&gt;rootdir
op_assign
id|simple_strtoul
c_func
(paren
id|val
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;iocharset&quot;
)paren
op_logical_and
id|val
)paren
(brace
id|uopt-&gt;iocharset
op_assign
id|val
suffix:semicolon
r_while
c_loop
(paren
op_star
id|val
op_logical_and
op_star
id|val
op_ne
l_char|&squot;,&squot;
)paren
id|val
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|uopt-&gt;iocharset
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|val
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: bad mount option &bslash;&quot;%s=%s&bslash;&quot;&bslash;n&quot;
comma
id|opt
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: bad mount option &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|opt
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|udf_remount_fs
id|udf_remount_fs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
op_star
id|flags
comma
r_char
op_star
id|options
)paren
(brace
r_struct
id|udf_options
id|uopt
suffix:semicolon
id|uopt.flags
op_assign
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_flags
suffix:semicolon
id|uopt.uid
op_assign
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_uid
suffix:semicolon
id|uopt.gid
op_assign
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_gid
suffix:semicolon
id|uopt.umask
op_assign
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_umask
suffix:semicolon
id|uopt.utf8
op_assign
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_utf8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|udf_parse_options
c_func
(paren
id|options
comma
op_amp
id|uopt
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_flags
op_assign
id|uopt.flags
suffix:semicolon
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_uid
op_assign
id|uopt.uid
suffix:semicolon
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_gid
op_assign
id|uopt.gid
suffix:semicolon
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_umask
op_assign
id|uopt.umask
suffix:semicolon
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_utf8
op_assign
id|uopt.utf8
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|flags
op_amp
id|MS_RDONLY
)paren
op_eq
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|flags
op_amp
id|MS_RDONLY
)paren
id|udf_close_lvid
c_func
(paren
id|sb
)paren
suffix:semicolon
r_else
id|udf_open_lvid
c_func
(paren
id|sb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_set_blocksize&n; *&n; * PURPOSE&n; *&t;Set the block size to be used in all transfers.&n; *&n; * DESCRIPTION&n; *&t;To allow room for a DMA transfer, it is best to guess big when unsure.&n; *&t;This routine picks 2048 bytes as the blocksize when guessing. This&n; *&t;should be adequate until devices with larger block sizes become common.&n; *&n; *&t;Note that the Linux kernel can currently only deal with blocksizes of&n; *&t;512, 1024, 2048, 4096, and 8192 bytes.&n; *&n; * PRE-CONDITIONS&n; *&t;sb&t;&t;&t;Pointer to _locked_ superblock.&n; *&n; * POST-CONDITIONS&n; *&t;sb-&gt;s_blocksize&t;&t;Blocksize.&n; *&t;sb-&gt;s_blocksize_bits&t;log2 of blocksize.&n; *&t;&lt;return&gt;&t;0&t;Blocksize is valid.&n; *&t;&lt;return&gt;&t;1&t;Blocksize is invalid.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
r_static
r_int
DECL|function|udf_set_blocksize
id|udf_set_blocksize
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
id|bsize
)paren
(brace
multiline_comment|/* Use specified block size if specified */
id|sb-&gt;s_blocksize
op_assign
id|get_hardblocksize
c_func
(paren
id|sb-&gt;s_dev
)paren
suffix:semicolon
id|sb-&gt;s_blocksize
op_assign
id|sb-&gt;s_blocksize
ques
c_cond
id|sb-&gt;s_blocksize
suffix:colon
l_int|2048
suffix:semicolon
r_if
c_cond
(paren
id|bsize
OG
id|sb-&gt;s_blocksize
)paren
id|sb-&gt;s_blocksize
op_assign
id|bsize
suffix:semicolon
multiline_comment|/* Block size must be an even multiple of 512 */
r_switch
c_cond
(paren
id|sb-&gt;s_blocksize
)paren
(brace
r_case
l_int|512
suffix:colon
id|sb-&gt;s_blocksize_bits
op_assign
l_int|9
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1024
suffix:colon
id|sb-&gt;s_blocksize_bits
op_assign
l_int|10
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2048
suffix:colon
id|sb-&gt;s_blocksize_bits
op_assign
l_int|11
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4096
suffix:colon
id|sb-&gt;s_blocksize_bits
op_assign
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8192
suffix:colon
id|sb-&gt;s_blocksize_bits
op_assign
l_int|13
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Bad block size (%ld)&bslash;n&quot;
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: bad block size (%ld)&bslash;n&quot;
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Set the block size */
id|set_blocksize
c_func
(paren
id|sb-&gt;s_dev
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
r_return
id|sb-&gt;s_blocksize
suffix:semicolon
)brace
r_static
r_int
DECL|function|udf_vrs
id|udf_vrs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
id|silent
)paren
(brace
r_struct
id|VolStructDesc
op_star
id|vsd
op_assign
l_int|NULL
suffix:semicolon
r_int
id|sector
op_assign
l_int|32768
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_int
id|iso9660
op_assign
l_int|0
suffix:semicolon
r_int
id|nsr02
op_assign
l_int|0
suffix:semicolon
r_int
id|nsr03
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Block size must be a multiple of 512 */
r_if
c_cond
(paren
id|sb-&gt;s_blocksize
op_amp
l_int|511
)paren
r_return
id|sector
suffix:semicolon
id|sector
op_add_assign
(paren
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
op_lshift
id|sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;Starting at sector %u (%ld byte sectors)&bslash;n&quot;
comma
(paren
id|sector
op_rshift
id|sb-&gt;s_blocksize_bits
)paren
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
multiline_comment|/* Process the sequence (if applicable) */
r_for
c_loop
(paren
suffix:semicolon
op_logical_neg
id|nsr02
op_logical_and
op_logical_neg
id|nsr03
suffix:semicolon
id|sector
op_add_assign
l_int|2048
)paren
(brace
multiline_comment|/* Read a block */
id|bh
op_assign
id|udf_tread
c_func
(paren
id|sb
comma
id|sector
op_rshift
id|sb-&gt;s_blocksize_bits
comma
l_int|2048
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
r_break
suffix:semicolon
multiline_comment|/* Look for ISO  descriptors */
id|vsd
op_assign
(paren
r_struct
id|VolStructDesc
op_star
)paren
(paren
id|bh-&gt;b_data
op_plus
(paren
id|sector
op_amp
(paren
id|sb-&gt;s_blocksize
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vsd-&gt;stdIdent
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|vsd-&gt;stdIdent
comma
id|STD_ID_CD001
comma
id|STD_ID_LEN
)paren
)paren
(brace
id|iso9660
op_assign
id|sector
suffix:semicolon
r_switch
c_cond
(paren
id|vsd-&gt;structType
)paren
(brace
r_case
l_int|0
suffix:colon
id|udf_debug
c_func
(paren
l_string|&quot;ISO9660 Boot Record found&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|udf_debug
c_func
(paren
l_string|&quot;ISO9660 Primary Volume Descriptor found&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|udf_debug
c_func
(paren
l_string|&quot;ISO9660 Supplementary Volume Descriptor found&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|udf_debug
c_func
(paren
l_string|&quot;ISO9660 Volume Partition Descriptor found&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|255
suffix:colon
id|udf_debug
c_func
(paren
l_string|&quot;ISO9660 Volume Descriptor Set Terminator found&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|udf_debug
c_func
(paren
l_string|&quot;ISO9660 VRS (%u) found&bslash;n&quot;
comma
id|vsd-&gt;structType
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|vsd-&gt;stdIdent
comma
id|STD_ID_BEA01
comma
id|STD_ID_LEN
)paren
)paren
(brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|vsd-&gt;stdIdent
comma
id|STD_ID_TEA01
comma
id|STD_ID_LEN
)paren
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|vsd-&gt;stdIdent
comma
id|STD_ID_NSR02
comma
id|STD_ID_LEN
)paren
)paren
(brace
id|nsr02
op_assign
id|sector
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|vsd-&gt;stdIdent
comma
id|STD_ID_NSR03
comma
id|STD_ID_LEN
)paren
)paren
(brace
id|nsr03
op_assign
id|sector
suffix:semicolon
)brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nsr03
)paren
r_return
id|nsr03
suffix:semicolon
r_else
r_if
c_cond
(paren
id|nsr02
)paren
r_return
id|nsr02
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sector
op_minus
(paren
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
op_lshift
id|sb-&gt;s_blocksize_bits
)paren
op_eq
l_int|32768
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_find_anchor&n; *&n; * PURPOSE&n; *&t;Find an anchor volume descriptor.&n; *&n; * PRE-CONDITIONS&n; *&t;sb&t;&t;&t;Pointer to _locked_ superblock.&n; *&t;lastblock&t;&t;Last block on media.&n; *&n; * POST-CONDITIONS&n; *&t;&lt;return&gt;&t;&t;1 if not found, 0 if ok&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
r_static
r_int
DECL|function|udf_find_anchor
id|udf_find_anchor
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
id|useranchor
comma
r_int
id|lastblock
)paren
(brace
r_int
id|varlastblock
op_assign
id|udf_variable_to_fixed
c_func
(paren
id|lastblock
)paren
suffix:semicolon
r_int
id|last
(braket
)braket
op_assign
(brace
id|lastblock
comma
id|lastblock
op_minus
l_int|2
comma
id|lastblock
op_minus
l_int|150
comma
id|lastblock
op_minus
l_int|152
comma
id|varlastblock
comma
id|varlastblock
op_minus
l_int|2
comma
id|varlastblock
op_minus
l_int|150
comma
id|varlastblock
op_minus
l_int|152
)brace
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
id|Uint16
id|ident
suffix:semicolon
id|Uint32
id|location
suffix:semicolon
r_int
id|i
suffix:semicolon
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|3
)braket
op_assign
l_int|256
op_plus
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
suffix:semicolon
id|lastblock
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Search for an anchor volume descriptor pointer */
multiline_comment|/*  according to spec, anchor is in either:&n;&t; *     block 256&n;&t; *     lastblock-256&n;&t; *     lastblock&n;&t; *  however, if the disc isn&squot;t closed, it could be 512 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
op_logical_neg
id|lastblock
op_logical_and
id|i
OL
r_sizeof
(paren
id|last
)paren
op_div
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|bread
c_func
(paren
id|sb-&gt;s_dev
comma
id|last
(braket
id|i
)braket
comma
id|sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|ident
op_assign
id|location
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|ident
op_assign
id|le16_to_cpu
c_func
(paren
(paren
(paren
id|tag
op_star
)paren
id|bh-&gt;b_data
)paren
op_member_access_from_pointer
id|tagIdent
)paren
suffix:semicolon
id|location
op_assign
id|le32_to_cpu
c_func
(paren
(paren
(paren
id|tag
op_star
)paren
id|bh-&gt;b_data
)paren
op_member_access_from_pointer
id|tagLocation
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ident
op_eq
id|TID_ANCHOR_VOL_DESC_PTR
)paren
(brace
r_if
c_cond
(paren
id|location
op_eq
id|last
(braket
id|i
)braket
op_minus
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
)paren
(brace
id|lastblock
op_assign
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|0
)braket
op_assign
id|last
(braket
id|i
)braket
suffix:semicolon
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|1
)braket
op_assign
id|last
(braket
id|i
)braket
op_minus
l_int|256
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|location
op_eq
id|udf_variable_to_fixed
c_func
(paren
id|last
(braket
id|i
)braket
)paren
op_minus
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
)paren
(brace
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_flags
op_or_assign
id|UDF_FLAG_VARCONV
suffix:semicolon
id|lastblock
op_assign
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|0
)braket
op_assign
id|udf_variable_to_fixed
c_func
(paren
id|last
(braket
id|i
)braket
)paren
suffix:semicolon
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|1
)braket
op_assign
id|lastblock
op_minus
l_int|256
suffix:semicolon
)brace
r_else
id|udf_debug
c_func
(paren
l_string|&quot;Anchor found at block %d, location mismatch %d.&bslash;n&quot;
comma
id|last
(braket
id|i
)braket
comma
id|location
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ident
op_eq
id|TID_FILE_ENTRY
op_logical_or
id|ident
op_eq
id|TID_EXTENDED_FILE_ENTRY
)paren
(brace
id|lastblock
op_assign
id|last
(braket
id|i
)braket
suffix:semicolon
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|2
)braket
op_assign
l_int|512
op_plus
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|bread
c_func
(paren
id|sb-&gt;s_dev
comma
id|last
(braket
id|i
)braket
op_minus
l_int|256
comma
id|sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|ident
op_assign
id|location
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|ident
op_assign
id|le16_to_cpu
c_func
(paren
(paren
(paren
id|tag
op_star
)paren
id|bh-&gt;b_data
)paren
op_member_access_from_pointer
id|tagIdent
)paren
suffix:semicolon
id|location
op_assign
id|le32_to_cpu
c_func
(paren
(paren
(paren
id|tag
op_star
)paren
id|bh-&gt;b_data
)paren
op_member_access_from_pointer
id|tagLocation
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ident
op_eq
id|TID_ANCHOR_VOL_DESC_PTR
op_logical_and
id|location
op_eq
id|last
(braket
id|i
)braket
op_minus
l_int|256
op_minus
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
)paren
(brace
id|lastblock
op_assign
id|last
(braket
id|i
)braket
suffix:semicolon
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|1
)braket
op_assign
id|last
(braket
id|i
)braket
op_minus
l_int|256
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|bread
c_func
(paren
id|sb-&gt;s_dev
comma
id|last
(braket
id|i
)braket
op_minus
l_int|312
op_minus
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
comma
id|sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|ident
op_assign
id|location
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|ident
op_assign
id|le16_to_cpu
c_func
(paren
(paren
(paren
id|tag
op_star
)paren
id|bh-&gt;b_data
)paren
op_member_access_from_pointer
id|tagIdent
)paren
suffix:semicolon
id|location
op_assign
id|le32_to_cpu
c_func
(paren
(paren
(paren
id|tag
op_star
)paren
id|bh-&gt;b_data
)paren
op_member_access_from_pointer
id|tagLocation
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ident
op_eq
id|TID_ANCHOR_VOL_DESC_PTR
op_logical_and
id|location
op_eq
id|udf_variable_to_fixed
c_func
(paren
id|last
(braket
id|i
)braket
)paren
op_minus
l_int|256
)paren
(brace
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_flags
op_or_assign
id|UDF_FLAG_VARCONV
suffix:semicolon
id|lastblock
op_assign
id|udf_variable_to_fixed
c_func
(paren
id|last
(braket
id|i
)braket
)paren
suffix:semicolon
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
l_int|1
)braket
op_assign
id|lastblock
op_minus
l_int|256
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|lastblock
)paren
(brace
multiline_comment|/* We havn&squot;t found the lastblock. check 312 */
r_if
c_cond
(paren
(paren
id|bh
op_assign
id|bread
c_func
(paren
id|sb-&gt;s_dev
comma
l_int|312
op_plus
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
comma
id|sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|ident
op_assign
id|le16_to_cpu
c_func
(paren
(paren
(paren
id|tag
op_star
)paren
id|bh-&gt;b_data
)paren
op_member_access_from_pointer
id|tagIdent
)paren
suffix:semicolon
id|location
op_assign
id|le32_to_cpu
c_func
(paren
(paren
(paren
id|tag
op_star
)paren
id|bh-&gt;b_data
)paren
op_member_access_from_pointer
id|tagLocation
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ident
op_eq
id|TID_ANCHOR_VOL_DESC_PTR
op_logical_and
id|location
op_eq
l_int|256
)paren
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_flags
op_or_assign
id|UDF_FLAG_VARCONV
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
)paren
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|udf_read_tagged
c_func
(paren
id|sb
comma
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
comma
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
comma
op_amp
id|ident
)paren
)paren
)paren
(brace
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ident
op_ne
id|TID_ANCHOR_VOL_DESC_PTR
)paren
op_logical_and
(paren
id|i
op_logical_or
(paren
id|ident
op_ne
id|TID_FILE_ENTRY
op_logical_and
id|ident
op_ne
id|TID_EXTENDED_FILE_ENTRY
)paren
)paren
)paren
(brace
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|useranchor
op_ne
l_int|0xFFFFFFFF
)paren
(brace
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
op_assign
id|useranchor
suffix:semicolon
id|useranchor
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)brace
)brace
r_return
id|lastblock
suffix:semicolon
)brace
r_static
r_int
DECL|function|udf_find_fileset
id|udf_find_fileset
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
id|lb_addr
op_star
id|fileset
comma
id|lb_addr
op_star
id|root
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_int
id|lastblock
suffix:semicolon
id|Uint16
id|ident
suffix:semicolon
r_if
c_cond
(paren
id|fileset-&gt;logicalBlockNum
op_ne
l_int|0xFFFFFFFF
op_logical_or
id|fileset-&gt;partitionReferenceNum
op_ne
l_int|0xFFFF
)paren
(brace
id|bh
op_assign
id|udf_read_ptagged
c_func
(paren
id|sb
comma
op_star
id|fileset
comma
l_int|0
comma
op_amp
id|ident
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
r_return
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ident
op_ne
id|TID_FILE_SET_DESC
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
multiline_comment|/* Search backwards through the partitions */
(brace
id|lb_addr
id|newfileset
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|newfileset.partitionReferenceNum
op_assign
id|UDF_SB_NUMPARTS
c_func
(paren
id|sb
)paren
op_minus
l_int|1
suffix:semicolon
(paren
id|newfileset.partitionReferenceNum
op_ne
l_int|0xFFFF
op_logical_and
id|fileset-&gt;logicalBlockNum
op_eq
l_int|0xFFFFFFFF
op_logical_and
id|fileset-&gt;partitionReferenceNum
op_eq
l_int|0xFFFF
)paren
suffix:semicolon
id|newfileset.partitionReferenceNum
op_decrement
)paren
(brace
id|lastblock
op_assign
id|UDF_SB_PARTLEN
c_func
(paren
id|sb
comma
id|newfileset.partitionReferenceNum
)paren
suffix:semicolon
id|newfileset.logicalBlockNum
op_assign
l_int|0
suffix:semicolon
r_do
(brace
id|bh
op_assign
id|udf_read_ptagged
c_func
(paren
id|sb
comma
id|newfileset
comma
l_int|0
comma
op_amp
id|ident
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
(brace
id|newfileset.logicalBlockNum
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ident
)paren
(brace
r_case
id|TID_SPACE_BITMAP_DESC
suffix:colon
(brace
r_struct
id|SpaceBitmapDesc
op_star
id|sp
suffix:semicolon
id|sp
op_assign
(paren
r_struct
id|SpaceBitmapDesc
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
id|newfileset.logicalBlockNum
op_add_assign
l_int|1
op_plus
(paren
(paren
id|le32_to_cpu
c_func
(paren
id|sp-&gt;numOfBytes
)paren
op_plus
r_sizeof
(paren
r_struct
id|SpaceBitmapDesc
)paren
op_minus
l_int|1
)paren
op_rshift
id|sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|TID_FILE_SET_DESC
suffix:colon
(brace
op_star
id|fileset
op_assign
id|newfileset
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
(brace
id|newfileset.logicalBlockNum
op_increment
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_while
c_loop
(paren
id|newfileset.logicalBlockNum
OL
id|lastblock
op_logical_and
id|fileset-&gt;logicalBlockNum
op_eq
l_int|0xFFFFFFFF
op_logical_and
id|fileset-&gt;partitionReferenceNum
op_eq
l_int|0xFFFF
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|fileset-&gt;logicalBlockNum
op_ne
l_int|0xFFFFFFFF
op_logical_or
id|fileset-&gt;partitionReferenceNum
op_ne
l_int|0xFFFF
)paren
op_logical_and
id|bh
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Fileset at block=%d, partition=%d&bslash;n&quot;
comma
id|fileset-&gt;logicalBlockNum
comma
id|fileset-&gt;partitionReferenceNum
)paren
suffix:semicolon
id|UDF_SB_PARTITION
c_func
(paren
id|sb
)paren
op_assign
id|fileset-&gt;partitionReferenceNum
suffix:semicolon
id|udf_load_fileset
c_func
(paren
id|sb
comma
id|bh
comma
id|root
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|udf_load_pvoldesc
id|udf_load_pvoldesc
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|buffer_head
op_star
id|bh
)paren
(brace
r_struct
id|PrimaryVolDesc
op_star
id|pvoldesc
suffix:semicolon
id|time_t
id|recording
suffix:semicolon
r_int
id|recording_usec
suffix:semicolon
r_struct
id|ustr
id|instr
suffix:semicolon
r_struct
id|ustr
id|outstr
suffix:semicolon
id|pvoldesc
op_assign
(paren
r_struct
id|PrimaryVolDesc
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
r_if
c_cond
(paren
id|udf_stamp_to_time
c_func
(paren
op_amp
id|recording
comma
op_amp
id|recording_usec
comma
id|lets_to_cpu
c_func
(paren
id|pvoldesc-&gt;recordingDateAndTime
)paren
)paren
)paren
(brace
id|timestamp
id|ts
suffix:semicolon
id|ts
op_assign
id|lets_to_cpu
c_func
(paren
id|pvoldesc-&gt;recordingDateAndTime
)paren
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;recording time %ld/%ld, %04u/%02u/%02u %02u:%02u (%x)&bslash;n&quot;
comma
id|recording
comma
id|recording_usec
comma
id|ts.year
comma
id|ts.month
comma
id|ts.day
comma
id|ts.hour
comma
id|ts.minute
comma
id|ts.typeAndTimezone
)paren
suffix:semicolon
id|UDF_SB_RECORDTIME
c_func
(paren
id|sb
)paren
op_assign
id|recording
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|udf_build_ustr
c_func
(paren
op_amp
id|instr
comma
id|pvoldesc-&gt;volIdent
comma
l_int|32
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|udf_CS0toUTF8
c_func
(paren
op_amp
id|outstr
comma
op_amp
id|instr
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;volIdent[] = &squot;%s&squot;&bslash;n&quot;
comma
id|outstr.u_name
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|UDF_SB_VOLIDENT
c_func
(paren
id|sb
)paren
comma
id|outstr.u_name
comma
id|outstr.u_len
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|udf_build_ustr
c_func
(paren
op_amp
id|instr
comma
id|pvoldesc-&gt;volSetIdent
comma
l_int|128
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|udf_CS0toUTF8
c_func
(paren
op_amp
id|outstr
comma
op_amp
id|instr
)paren
)paren
id|udf_debug
c_func
(paren
l_string|&quot;volSetIdent[] = &squot;%s&squot;&bslash;n&quot;
comma
id|outstr.u_name
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|udf_load_fileset
id|udf_load_fileset
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|buffer_head
op_star
id|bh
comma
id|lb_addr
op_star
id|root
)paren
(brace
r_struct
id|FileSetDesc
op_star
id|fset
suffix:semicolon
id|fset
op_assign
(paren
r_struct
id|FileSetDesc
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
op_star
id|root
op_assign
id|lelb_to_cpu
c_func
(paren
id|fset-&gt;rootDirectoryICB.extLocation
)paren
suffix:semicolon
id|UDF_SB_SERIALNUM
c_func
(paren
id|sb
)paren
op_assign
id|le16_to_cpu
c_func
(paren
id|fset-&gt;descTag.tagSerialNum
)paren
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;Rootdir at block=%d, partition=%d&bslash;n&quot;
comma
id|root-&gt;logicalBlockNum
comma
id|root-&gt;partitionReferenceNum
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|udf_load_partdesc
id|udf_load_partdesc
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|buffer_head
op_star
id|bh
)paren
(brace
r_struct
id|PartitionDesc
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
id|p
op_assign
(paren
r_struct
id|PartitionDesc
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|UDF_SB_NUMPARTS
c_func
(paren
id|sb
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Searching map: (%d == %d)&bslash;n&quot;
comma
id|UDF_SB_PARTMAPS
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
dot
id|s_partition_num
comma
id|le16_to_cpu
c_func
(paren
id|p-&gt;partitionNumber
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_SB_PARTMAPS
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
dot
id|s_partition_num
op_eq
id|le16_to_cpu
c_func
(paren
id|p-&gt;partitionNumber
)paren
)paren
(brace
id|UDF_SB_PARTLEN
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|le32_to_cpu
c_func
(paren
id|p-&gt;partitionLength
)paren
suffix:semicolon
multiline_comment|/* blocks */
id|UDF_SB_PARTROOT
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|le32_to_cpu
c_func
(paren
id|p-&gt;partitionStartingLocation
)paren
op_plus
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
suffix:semicolon
id|UDF_SB_PARTMAPS
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
dot
id|s_uspace_bitmap
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|p-&gt;partitionContents.ident
comma
id|PARTITION_CONTENTS_NSR02
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|p-&gt;partitionContents.ident
comma
id|PARTITION_CONTENTS_NSR03
)paren
)paren
(brace
r_struct
id|PartitionHeaderDesc
op_star
id|phd
suffix:semicolon
id|phd
op_assign
(paren
r_struct
id|PartitionHeaderDesc
op_star
)paren
(paren
id|p-&gt;partitionContentsUse
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phd-&gt;unallocatedSpaceTable.extLength
)paren
id|udf_debug
c_func
(paren
l_string|&quot;unallocatedSpaceTable (part %d)&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phd-&gt;unallocatedSpaceBitmap.extLength
)paren
(brace
id|UDF_SB_PARTMAPS
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
dot
id|s_uspace_bitmap
op_assign
id|le32_to_cpu
c_func
(paren
id|phd-&gt;unallocatedSpaceBitmap.extPosition
)paren
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;unallocatedSpaceBitmap (part %d) @ %d&bslash;n&quot;
comma
id|i
comma
id|UDF_SB_PARTMAPS
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
dot
id|s_uspace_bitmap
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|phd-&gt;partitionIntegrityTable.extLength
)paren
id|udf_debug
c_func
(paren
l_string|&quot;partitionIntegrityTable (part %d)&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phd-&gt;freedSpaceTable.extLength
)paren
id|udf_debug
c_func
(paren
l_string|&quot;freedSpaceTable (part %d)&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phd-&gt;freedSpaceBitmap.extLength
)paren
id|udf_debug
c_func
(paren
l_string|&quot;freedSpaceBitmap (part %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
id|UDF_SB_NUMPARTS
c_func
(paren
id|sb
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Partition (%d) not found in partition map&bslash;n&quot;
comma
id|le16_to_cpu
c_func
(paren
id|p-&gt;partitionNumber
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Partition (%d:%d type %x) starts at physical %d, block length %d&bslash;n&quot;
comma
id|le16_to_cpu
c_func
(paren
id|p-&gt;partitionNumber
)paren
comma
id|i
comma
id|UDF_SB_PARTTYPE
c_func
(paren
id|sb
comma
id|i
)paren
comma
id|UDF_SB_PARTROOT
c_func
(paren
id|sb
comma
id|i
)paren
comma
id|UDF_SB_PARTLEN
c_func
(paren
id|sb
comma
id|i
)paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|udf_load_logicalvol
id|udf_load_logicalvol
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|buffer_head
op_star
id|bh
comma
id|lb_addr
op_star
id|fileset
)paren
(brace
r_struct
id|LogicalVolDesc
op_star
id|lvd
suffix:semicolon
r_int
id|i
comma
id|offset
suffix:semicolon
id|Uint8
id|type
suffix:semicolon
id|lvd
op_assign
(paren
r_struct
id|LogicalVolDesc
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
id|UDF_SB_NUMPARTS
c_func
(paren
id|sb
)paren
op_assign
id|le32_to_cpu
c_func
(paren
id|lvd-&gt;numPartitionMaps
)paren
suffix:semicolon
id|UDF_SB_ALLOC_PARTMAPS
c_func
(paren
id|sb
comma
id|UDF_SB_NUMPARTS
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|offset
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|UDF_SB_NUMPARTS
c_func
(paren
id|sb
)paren
op_logical_and
id|offset
OL
id|le32_to_cpu
c_func
(paren
id|lvd-&gt;mapTableLength
)paren
suffix:semicolon
id|i
op_increment
comma
id|offset
op_add_assign
(paren
(paren
r_struct
id|GenericPartitionMap
op_star
)paren
op_amp
(paren
id|lvd-&gt;partitionMaps
(braket
id|offset
)braket
)paren
)paren
op_member_access_from_pointer
id|partitionMapLength
)paren
(brace
id|type
op_assign
(paren
(paren
r_struct
id|GenericPartitionMap
op_star
)paren
op_amp
(paren
id|lvd-&gt;partitionMaps
(braket
id|offset
)braket
)paren
)paren
op_member_access_from_pointer
id|partitionMapType
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;Partition (%d) type %d&bslash;n&quot;
comma
id|i
comma
id|type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
l_int|1
)paren
(brace
r_struct
id|GenericPartitionMap1
op_star
id|gpm1
op_assign
(paren
r_struct
id|GenericPartitionMap1
op_star
)paren
op_amp
(paren
id|lvd-&gt;partitionMaps
(braket
id|offset
)braket
)paren
suffix:semicolon
id|UDF_SB_PARTTYPE
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|UDF_TYPE1_MAP15
suffix:semicolon
id|UDF_SB_PARTVSN
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|le16_to_cpu
c_func
(paren
id|gpm1-&gt;volSeqNum
)paren
suffix:semicolon
id|UDF_SB_PARTNUM
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|le16_to_cpu
c_func
(paren
id|gpm1-&gt;partitionNum
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|type
op_eq
l_int|2
)paren
(brace
r_struct
id|UdfPartitionMap2
op_star
id|upm2
op_assign
(paren
r_struct
id|UdfPartitionMap2
op_star
)paren
op_amp
(paren
id|lvd-&gt;partitionMaps
(braket
id|offset
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|upm2-&gt;partIdent.ident
comma
id|UDF_ID_VIRTUAL
comma
id|strlen
c_func
(paren
id|UDF_ID_VIRTUAL
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
(paren
(paren
id|Uint16
op_star
)paren
id|upm2-&gt;partIdent.identSuffix
)paren
(braket
l_int|0
)braket
)paren
op_eq
l_int|0x0150
)paren
id|UDF_SB_PARTTYPE
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|UDF_VIRTUAL_MAP15
suffix:semicolon
r_else
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
(paren
(paren
id|Uint16
op_star
)paren
id|upm2-&gt;partIdent.identSuffix
)paren
(braket
l_int|0
)braket
)paren
op_eq
l_int|0x0200
)paren
id|UDF_SB_PARTTYPE
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|UDF_VIRTUAL_MAP20
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|upm2-&gt;partIdent.ident
comma
id|UDF_ID_SPARABLE
comma
id|strlen
c_func
(paren
id|UDF_ID_SPARABLE
)paren
)paren
)paren
(brace
r_struct
id|SparablePartitionMap
op_star
id|spm
op_assign
(paren
r_struct
id|SparablePartitionMap
op_star
)paren
op_amp
(paren
id|lvd-&gt;partitionMaps
(braket
id|offset
)braket
)paren
suffix:semicolon
id|UDF_SB_PARTTYPE
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|UDF_SPARABLE_MAP15
suffix:semicolon
id|UDF_SB_TYPESPAR
c_func
(paren
id|sb
comma
id|i
)paren
dot
id|s_spar_plen
op_assign
id|le16_to_cpu
c_func
(paren
id|spm-&gt;packetLength
)paren
suffix:semicolon
id|UDF_SB_TYPESPAR
c_func
(paren
id|sb
comma
id|i
)paren
dot
id|s_spar_loc
op_assign
id|le32_to_cpu
c_func
(paren
id|spm-&gt;locSparingTable
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Unknown ident: %s&bslash;n&quot;
comma
id|upm2-&gt;partIdent.ident
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|UDF_SB_PARTVSN
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|le16_to_cpu
c_func
(paren
id|upm2-&gt;volSeqNum
)paren
suffix:semicolon
id|UDF_SB_PARTNUM
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|le16_to_cpu
c_func
(paren
id|upm2-&gt;partitionNum
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|fileset
)paren
(brace
id|long_ad
op_star
id|la
op_assign
(paren
id|long_ad
op_star
)paren
op_amp
(paren
id|lvd-&gt;logicalVolContentsUse
(braket
l_int|0
)braket
)paren
suffix:semicolon
op_star
id|fileset
op_assign
id|lelb_to_cpu
c_func
(paren
id|la-&gt;extLocation
)paren
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;FileSet found in LogicalVolDesc at block=%d, partition=%d&bslash;n&quot;
comma
id|fileset-&gt;logicalBlockNum
comma
id|fileset-&gt;partitionReferenceNum
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lvd-&gt;integritySeqExt.extLength
)paren
id|udf_load_logicalvolint
c_func
(paren
id|sb
comma
id|leea_to_cpu
c_func
(paren
id|lvd-&gt;integritySeqExt
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_load_logicalvolint&n; *&n; */
r_static
r_void
DECL|function|udf_load_logicalvolint
id|udf_load_logicalvolint
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
id|extent_ad
id|loc
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
id|Uint16
id|ident
suffix:semicolon
r_while
c_loop
(paren
(paren
id|bh
op_assign
id|udf_read_tagged
c_func
(paren
id|sb
comma
id|loc.extLocation
comma
id|loc.extLocation
comma
op_amp
id|ident
)paren
)paren
op_logical_and
id|ident
op_eq
id|TID_LOGICAL_VOL_INTEGRITY_DESC
op_logical_and
id|loc.extLength
OG
l_int|0
)paren
(brace
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
op_assign
id|bh
suffix:semicolon
r_if
c_cond
(paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|nextIntegrityExt.extLength
)paren
id|udf_load_logicalvolint
c_func
(paren
id|sb
comma
id|leea_to_cpu
c_func
(paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|nextIntegrityExt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
op_ne
id|bh
)paren
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|loc.extLength
op_sub_assign
id|sb-&gt;s_blocksize
suffix:semicolon
id|loc.extLocation
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
op_ne
id|bh
)paren
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_process_sequence&n; *&n; * PURPOSE&n; *&t;Process a main/reserve volume descriptor sequence.&n; *&n; * PRE-CONDITIONS&n; *&t;sb&t;&t;&t;Pointer to _locked_ superblock.&n; *&t;block&t;&t;&t;First block of first extent of the sequence.&n; *&t;lastblock&t;&t;Lastblock of first extent of the sequence.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
r_static
r_int
DECL|function|udf_process_sequence
id|udf_process_sequence
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
id|block
comma
r_int
id|lastblock
comma
id|lb_addr
op_star
id|fileset
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|udf_vds_record
id|vds
(braket
id|VDS_POS_LENGTH
)braket
suffix:semicolon
r_struct
id|GenericDesc
op_star
id|gd
suffix:semicolon
r_int
id|done
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|Uint32
id|vdsn
suffix:semicolon
id|Uint16
id|ident
suffix:semicolon
id|memset
c_func
(paren
id|vds
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|udf_vds_record
)paren
op_star
id|VDS_POS_LENGTH
)paren
suffix:semicolon
multiline_comment|/* Read the main descriptor sequence */
r_for
c_loop
(paren
suffix:semicolon
(paren
op_logical_neg
id|done
op_logical_and
id|block
op_le
id|lastblock
)paren
suffix:semicolon
id|block
op_increment
)paren
(brace
id|bh
op_assign
id|udf_read_tagged
c_func
(paren
id|sb
comma
id|block
comma
id|block
comma
op_amp
id|ident
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
r_break
suffix:semicolon
multiline_comment|/* Process each descriptor (ISO 13346 3/8.3-8.4) */
id|gd
op_assign
(paren
r_struct
id|GenericDesc
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
id|vdsn
op_assign
id|le32_to_cpu
c_func
(paren
id|gd-&gt;volDescSeqNum
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ident
)paren
(brace
r_case
id|TID_PRIMARY_VOL_DESC
suffix:colon
multiline_comment|/* ISO 13346 3/10.1 */
r_if
c_cond
(paren
id|vdsn
op_ge
id|vds
(braket
id|VDS_POS_PRIMARY_VOL_DESC
)braket
dot
id|volDescSeqNum
)paren
(brace
id|vds
(braket
id|VDS_POS_PRIMARY_VOL_DESC
)braket
dot
id|volDescSeqNum
op_assign
id|vdsn
suffix:semicolon
id|vds
(braket
id|VDS_POS_PRIMARY_VOL_DESC
)braket
dot
id|block
op_assign
id|block
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TID_VOL_DESC_PTR
suffix:colon
multiline_comment|/* ISO 13346 3/10.3 */
r_if
c_cond
(paren
id|vdsn
op_ge
id|vds
(braket
id|VDS_POS_VOL_DESC_PTR
)braket
dot
id|volDescSeqNum
)paren
(brace
id|vds
(braket
id|VDS_POS_VOL_DESC_PTR
)braket
dot
id|volDescSeqNum
op_assign
id|vdsn
suffix:semicolon
id|vds
(braket
id|VDS_POS_VOL_DESC_PTR
)braket
dot
id|block
op_assign
id|block
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TID_IMP_USE_VOL_DESC
suffix:colon
multiline_comment|/* ISO 13346 3/10.4 */
r_if
c_cond
(paren
id|vdsn
op_ge
id|vds
(braket
id|VDS_POS_IMP_USE_VOL_DESC
)braket
dot
id|volDescSeqNum
)paren
(brace
id|vds
(braket
id|VDS_POS_IMP_USE_VOL_DESC
)braket
dot
id|volDescSeqNum
op_assign
id|vdsn
suffix:semicolon
id|vds
(braket
id|VDS_POS_IMP_USE_VOL_DESC
)braket
dot
id|block
op_assign
id|block
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TID_PARTITION_DESC
suffix:colon
multiline_comment|/* ISO 13346 3/10.5 */
r_if
c_cond
(paren
op_logical_neg
id|vds
(braket
id|VDS_POS_PARTITION_DESC
)braket
dot
id|block
)paren
id|vds
(braket
id|VDS_POS_PARTITION_DESC
)braket
dot
id|block
op_assign
id|block
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TID_LOGICAL_VOL_DESC
suffix:colon
multiline_comment|/* ISO 13346 3/10.6 */
r_if
c_cond
(paren
id|vdsn
op_ge
id|vds
(braket
id|VDS_POS_LOGICAL_VOL_DESC
)braket
dot
id|volDescSeqNum
)paren
(brace
id|vds
(braket
id|VDS_POS_LOGICAL_VOL_DESC
)braket
dot
id|volDescSeqNum
op_assign
id|vdsn
suffix:semicolon
id|vds
(braket
id|VDS_POS_LOGICAL_VOL_DESC
)braket
dot
id|block
op_assign
id|block
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TID_UNALLOC_SPACE_DESC
suffix:colon
multiline_comment|/* ISO 13346 3/10.8 */
r_if
c_cond
(paren
id|vdsn
op_ge
id|vds
(braket
id|VDS_POS_UNALLOC_SPACE_DESC
)braket
dot
id|volDescSeqNum
)paren
(brace
id|vds
(braket
id|VDS_POS_UNALLOC_SPACE_DESC
)braket
dot
id|volDescSeqNum
op_assign
id|vdsn
suffix:semicolon
id|vds
(braket
id|VDS_POS_UNALLOC_SPACE_DESC
)braket
dot
id|block
op_assign
id|block
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TID_TERMINATING_DESC
suffix:colon
multiline_comment|/* ISO 13346 3/10.9 */
id|vds
(braket
id|VDS_POS_TERMINATING_DESC
)braket
dot
id|block
op_assign
id|block
suffix:semicolon
id|done
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VDS_POS_LENGTH
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|vds
(braket
id|i
)braket
dot
id|block
)paren
(brace
id|bh
op_assign
id|udf_read_tagged
c_func
(paren
id|sb
comma
id|vds
(braket
id|i
)braket
dot
id|block
comma
id|vds
(braket
id|i
)braket
dot
id|block
comma
op_amp
id|ident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|VDS_POS_PRIMARY_VOL_DESC
)paren
id|udf_load_pvoldesc
c_func
(paren
id|sb
comma
id|bh
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|i
op_eq
id|VDS_POS_LOGICAL_VOL_DESC
)paren
id|udf_load_logicalvol
c_func
(paren
id|sb
comma
id|bh
comma
id|fileset
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|i
op_eq
id|VDS_POS_PARTITION_DESC
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh2
op_assign
l_int|NULL
suffix:semicolon
id|udf_load_partdesc
c_func
(paren
id|sb
comma
id|bh
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|vds
(braket
id|i
)braket
dot
id|block
op_plus
l_int|1
suffix:semicolon
id|j
OL
id|vds
(braket
id|VDS_POS_TERMINATING_DESC
)braket
dot
id|block
suffix:semicolon
id|j
op_increment
)paren
(brace
id|bh2
op_assign
id|udf_read_tagged
c_func
(paren
id|sb
comma
id|j
comma
id|j
comma
op_amp
id|ident
)paren
suffix:semicolon
id|gd
op_assign
(paren
r_struct
id|GenericDesc
op_star
)paren
id|bh2-&gt;b_data
suffix:semicolon
r_if
c_cond
(paren
id|ident
op_eq
id|TID_PARTITION_DESC
)paren
id|udf_load_partdesc
c_func
(paren
id|sb
comma
id|bh2
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh2
)paren
suffix:semicolon
)brace
)brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_check_valid()&n; */
r_static
r_int
DECL|function|udf_check_valid
id|udf_check_valid
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
id|novrs
comma
r_int
id|silent
)paren
(brace
r_int
id|block
suffix:semicolon
r_if
c_cond
(paren
id|novrs
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Validity check skipped because of novrs option&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Check that it is NSR02 compliant */
multiline_comment|/* Process any &quot;CD-ROM Volume Descriptor Set&quot; (ECMA 167 2/8.3.1) */
r_else
r_if
c_cond
(paren
(paren
id|block
op_assign
id|udf_vrs
c_func
(paren
id|sb
comma
id|silent
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Failed to read byte 32768. Assuming open disc. Skipping validity check&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_logical_neg
id|block
suffix:semicolon
)brace
r_static
r_int
DECL|function|udf_load_partition
id|udf_load_partition
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
id|lb_addr
op_star
id|fileset
)paren
(brace
r_struct
id|AnchorVolDescPtr
op_star
id|anchor
suffix:semicolon
id|Uint16
id|ident
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
r_int
id|main_s
comma
id|main_e
comma
id|reserve_s
comma
id|reserve_e
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
)paren
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
op_logical_and
(paren
id|bh
op_assign
id|udf_read_tagged
c_func
(paren
id|sb
comma
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
comma
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
op_minus
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
comma
op_amp
id|ident
)paren
)paren
)paren
(brace
id|anchor
op_assign
(paren
r_struct
id|AnchorVolDescPtr
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
multiline_comment|/* Locate the main sequence */
id|main_s
op_assign
id|le32_to_cpu
c_func
(paren
id|anchor-&gt;mainVolDescSeqExt.extLocation
)paren
suffix:semicolon
id|main_e
op_assign
id|le32_to_cpu
c_func
(paren
id|anchor-&gt;mainVolDescSeqExt.extLength
)paren
suffix:semicolon
id|main_e
op_assign
id|main_e
op_rshift
id|sb-&gt;s_blocksize_bits
suffix:semicolon
id|main_e
op_add_assign
id|main_s
suffix:semicolon
multiline_comment|/* Locate the reserve sequence */
id|reserve_s
op_assign
id|le32_to_cpu
c_func
(paren
id|anchor-&gt;reserveVolDescSeqExt.extLocation
)paren
suffix:semicolon
id|reserve_e
op_assign
id|le32_to_cpu
c_func
(paren
id|anchor-&gt;reserveVolDescSeqExt.extLength
)paren
suffix:semicolon
id|reserve_e
op_assign
id|reserve_e
op_rshift
id|sb-&gt;s_blocksize_bits
suffix:semicolon
id|reserve_e
op_add_assign
id|reserve_s
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
multiline_comment|/* Process the main &amp; reserve sequences */
multiline_comment|/* responsible for finding the PartitionDesc(s) */
r_if
c_cond
(paren
op_logical_neg
(paren
id|udf_process_sequence
c_func
(paren
id|sb
comma
id|main_s
comma
id|main_e
comma
id|fileset
)paren
op_logical_and
id|udf_process_sequence
c_func
(paren
id|sb
comma
id|reserve_s
comma
id|reserve_e
comma
id|fileset
)paren
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
r_sizeof
(paren
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
)paren
op_div
r_sizeof
(paren
r_int
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;No Anchor block found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
id|udf_debug
c_func
(paren
l_string|&quot;Using anchor in block %d&bslash;n&quot;
comma
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|UDF_SB_NUMPARTS
c_func
(paren
id|sb
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
id|UDF_SB_PARTTYPE
c_func
(paren
id|sb
comma
id|i
)paren
(brace
r_case
id|UDF_VIRTUAL_MAP15
suffix:colon
r_case
id|UDF_VIRTUAL_MAP20
suffix:colon
(brace
id|lb_addr
id|ino
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|UDF_SB_LASTBLOCK
c_func
(paren
id|sb
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Unable to determine Lastblock (For Virtual Partition)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
id|ino.partitionReferenceNum
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
r_else
id|ino.partitionReferenceNum
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
id|ino.logicalBlockNum
op_assign
id|UDF_SB_LASTBLOCK
c_func
(paren
id|sb
)paren
op_minus
id|UDF_SB_PARTROOT
c_func
(paren
id|sb
comma
id|ino.partitionReferenceNum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
op_assign
id|udf_iget
c_func
(paren
id|sb
comma
id|ino
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|UDF_SB_PARTTYPE
c_func
(paren
id|sb
comma
id|i
)paren
op_eq
id|UDF_VIRTUAL_MAP15
)paren
(brace
id|UDF_SB_TYPEVIRT
c_func
(paren
id|sb
comma
id|i
)paren
dot
id|s_start_offset
op_assign
id|UDF_I_EXT0OFFS
c_func
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|UDF_SB_TYPEVIRT
c_func
(paren
id|sb
comma
id|i
)paren
dot
id|s_num_entries
op_assign
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|i_size
op_minus
l_int|36
)paren
op_rshift
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|UDF_SB_PARTTYPE
c_func
(paren
id|sb
comma
id|i
)paren
op_eq
id|UDF_VIRTUAL_MAP20
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
id|Uint32
id|pos
suffix:semicolon
id|pos
op_assign
id|udf_block_map
c_func
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
comma
l_int|0
)paren
suffix:semicolon
id|bh
op_assign
id|bread
c_func
(paren
id|sb-&gt;s_dev
comma
id|pos
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
id|UDF_SB_TYPEVIRT
c_func
(paren
id|sb
comma
id|i
)paren
dot
id|s_start_offset
op_assign
id|le16_to_cpu
c_func
(paren
(paren
(paren
r_struct
id|VirtualAllocationTable20
op_star
)paren
id|bh-&gt;b_data
op_plus
id|UDF_I_EXT0OFFS
c_func
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
)paren
)paren
op_member_access_from_pointer
id|lengthHeader
)paren
op_plus
id|UDF_I_EXT0OFFS
c_func
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|UDF_SB_TYPEVIRT
c_func
(paren
id|sb
comma
id|i
)paren
dot
id|s_num_entries
op_assign
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|i_size
op_minus
id|UDF_SB_TYPEVIRT
c_func
(paren
id|sb
comma
id|i
)paren
dot
id|s_start_offset
)paren
op_rshift
l_int|2
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
id|UDF_SB_PARTROOT
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|udf_get_pblock
c_func
(paren
id|sb
comma
l_int|0
comma
id|i
comma
l_int|0
)paren
suffix:semicolon
id|UDF_SB_PARTLEN
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
id|UDF_SB_PARTLEN
c_func
(paren
id|sb
comma
id|ino.partitionReferenceNum
)paren
suffix:semicolon
id|UDF_SB_PARTMAPS
c_func
(paren
id|sb
)paren
(braket
id|i
)braket
dot
id|s_uspace_bitmap
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|udf_open_lvid
r_static
r_void
id|udf_open_lvid
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
macro_line|#ifdef CONFIG_UDF_RW
r_if
c_cond
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
id|timestamp
id|cpu_time
suffix:semicolon
id|UDF_SB_LVIDIU
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|impIdent.identSuffix
(braket
l_int|0
)braket
op_assign
id|UDF_OS_CLASS_UNIX
suffix:semicolon
id|UDF_SB_LVIDIU
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|impIdent.identSuffix
(braket
l_int|1
)braket
op_assign
id|UDF_OS_ID_LINUX
suffix:semicolon
r_if
c_cond
(paren
id|udf_time_to_stamp
c_func
(paren
op_amp
id|cpu_time
comma
id|CURRENT_TIME
comma
id|CURRENT_UTIME
)paren
)paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|recordingDateAndTime
op_assign
id|cpu_to_lets
c_func
(paren
id|cpu_time
)paren
suffix:semicolon
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|integrityType
op_assign
id|INTEGRITY_TYPE_OPEN
suffix:semicolon
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|descTag.descCRC
op_assign
id|cpu_to_le16
c_func
(paren
id|udf_crc
c_func
(paren
(paren
r_char
op_star
)paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_plus
r_sizeof
(paren
id|tag
)paren
comma
id|le16_to_cpu
c_func
(paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|descTag.descCRCLength
)paren
comma
l_int|0
)paren
)paren
suffix:semicolon
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|descTag.tagChecksum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|i
op_ne
l_int|4
)paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|descTag.tagChecksum
op_add_assign
(paren
(paren
id|Uint8
op_star
)paren
op_amp
(paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|descTag
)paren
)paren
(braket
id|i
)braket
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|udf_close_lvid
r_static
r_void
id|udf_close_lvid
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
macro_line|#ifdef CONFIG_UDF_RW
r_if
c_cond
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
op_logical_and
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|integrityType
op_eq
id|INTEGRITY_TYPE_OPEN
)paren
(brace
r_int
id|i
suffix:semicolon
id|timestamp
id|cpu_time
suffix:semicolon
id|UDF_SB_LVIDIU
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|impIdent.identSuffix
(braket
l_int|0
)braket
op_assign
id|UDF_OS_CLASS_UNIX
suffix:semicolon
id|UDF_SB_LVIDIU
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|impIdent.identSuffix
(braket
l_int|1
)braket
op_assign
id|UDF_OS_ID_LINUX
suffix:semicolon
r_if
c_cond
(paren
id|udf_time_to_stamp
c_func
(paren
op_amp
id|cpu_time
comma
id|CURRENT_TIME
comma
id|CURRENT_UTIME
)paren
)paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|recordingDateAndTime
op_assign
id|cpu_to_lets
c_func
(paren
id|cpu_time
)paren
suffix:semicolon
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|integrityType
op_assign
id|INTEGRITY_TYPE_CLOSE
suffix:semicolon
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|descTag.descCRC
op_assign
id|cpu_to_le16
c_func
(paren
id|udf_crc
c_func
(paren
(paren
r_char
op_star
)paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_plus
r_sizeof
(paren
id|tag
)paren
comma
id|le16_to_cpu
c_func
(paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|descTag.descCRCLength
)paren
comma
l_int|0
)paren
)paren
suffix:semicolon
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|descTag.tagChecksum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|i
op_ne
l_int|4
)paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|descTag.tagChecksum
op_add_assign
(paren
(paren
id|Uint8
op_star
)paren
op_amp
(paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|descTag
)paren
)paren
(braket
id|i
)braket
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
multiline_comment|/*&n; * udf_read_super&n; *&n; * PURPOSE&n; *&t;Complete the specified super block.&n; *&n; * PRE-CONDITIONS&n; *&t;sb&t;&t;&t;Pointer to superblock to complete - never NULL.&n; *&t;sb-&gt;s_dev&t;&t;Device to read suberblock from.&n; *&t;options&t;&t;&t;Pointer to mount options.&n; *&t;silent&t;&t;&t;Silent flag.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
r_static
r_struct
id|super_block
op_star
DECL|function|udf_read_super
id|udf_read_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_void
op_star
id|options
comma
r_int
id|silent
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|udf_options
id|uopt
suffix:semicolon
id|lb_addr
id|rootdir
comma
id|fileset
suffix:semicolon
r_int
id|i
suffix:semicolon
id|uopt.flags
op_assign
l_int|0
suffix:semicolon
id|uopt.uid
op_assign
l_int|0
suffix:semicolon
id|uopt.gid
op_assign
l_int|0
suffix:semicolon
id|uopt.umask
op_assign
l_int|0
suffix:semicolon
id|uopt.utf8
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Lock the module in memory (if applicable) */
id|MOD_INC_USE_COUNT
suffix:semicolon
id|lock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
id|UDF_SB_PARTMAPS
c_func
(paren
id|sb
)paren
op_assign
l_int|NULL
suffix:semicolon
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
op_assign
l_int|NULL
suffix:semicolon
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|udf_parse_options
c_func
(paren
(paren
r_char
op_star
)paren
id|options
comma
op_amp
id|uopt
)paren
)paren
r_goto
id|error_out
suffix:semicolon
id|memset
c_func
(paren
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
comma
l_int|0x00
comma
r_sizeof
(paren
id|UDF_SB_ANCHOR
c_func
(paren
id|sb
)paren
)paren
)paren
suffix:semicolon
id|fileset.logicalBlockNum
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|fileset.partitionReferenceNum
op_assign
l_int|0xFFFF
suffix:semicolon
id|UDF_SB_RECORDTIME
c_func
(paren
id|sb
)paren
op_assign
l_int|0
suffix:semicolon
id|UDF_SB_VOLIDENT
c_func
(paren
id|sb
)paren
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_flags
op_assign
id|uopt.flags
suffix:semicolon
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_uid
op_assign
id|uopt.uid
suffix:semicolon
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_gid
op_assign
id|uopt.gid
suffix:semicolon
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_umask
op_assign
id|uopt.umask
suffix:semicolon
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_utf8
op_assign
id|uopt.utf8
suffix:semicolon
multiline_comment|/* Set the block size for all transfers */
r_if
c_cond
(paren
op_logical_neg
id|udf_set_blocksize
c_func
(paren
id|sb
comma
id|uopt.blocksize
)paren
)paren
r_goto
id|error_out
suffix:semicolon
r_if
c_cond
(paren
id|uopt.session
op_eq
l_int|0xFFFFFFFF
)paren
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
op_assign
id|udf_get_last_session
c_func
(paren
id|sb-&gt;s_dev
)paren
suffix:semicolon
r_else
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
op_assign
id|uopt.session
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;Multi-session=%d&bslash;n&quot;
comma
id|UDF_SB_SESSION
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uopt.lastblock
op_eq
l_int|0xFFFFFFFF
)paren
id|UDF_SB_LASTBLOCK
c_func
(paren
id|sb
)paren
op_assign
id|udf_get_last_block
c_func
(paren
id|sb-&gt;s_dev
comma
op_amp
(paren
id|UDF_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_flags
)paren
)paren
suffix:semicolon
r_else
id|UDF_SB_LASTBLOCK
c_func
(paren
id|sb
)paren
op_assign
id|uopt.lastblock
suffix:semicolon
id|UDF_SB_LASTBLOCK
c_func
(paren
id|sb
)paren
op_assign
id|udf_find_anchor
c_func
(paren
id|sb
comma
id|uopt.anchor
comma
id|UDF_SB_LASTBLOCK
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;Lastblock=%d&bslash;n&quot;
comma
id|UDF_SB_LASTBLOCK
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udf_check_valid
c_func
(paren
id|sb
comma
id|uopt.novrs
comma
id|silent
)paren
)paren
multiline_comment|/* read volume recognition sequences */
(brace
id|udf_debug
c_func
(paren
l_string|&quot;No VRS found&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|error_out
suffix:semicolon
)brace
id|UDF_SB_CHARSET
c_func
(paren
id|sb
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef CONFIG_NLS
r_if
c_cond
(paren
id|uopt.utf8
op_eq
l_int|0
)paren
(brace
r_char
op_star
id|p
op_assign
id|uopt.iocharset
ques
c_cond
id|uopt.iocharset
suffix:colon
l_string|&quot;iso8859-1&quot;
suffix:semicolon
id|UDF_SB_CHARSET
c_func
(paren
id|sb
)paren
op_assign
id|load_nls
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|UDF_SB_CHARSET
c_func
(paren
id|sb
)paren
)paren
r_if
c_cond
(paren
id|uopt.iocharset
)paren
r_goto
id|error_out
suffix:semicolon
id|UDF_SB_CHARSET
c_func
(paren
id|sb
)paren
op_assign
id|load_nls_default
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Fill in the rest of the superblock */
id|sb-&gt;s_op
op_assign
op_amp
id|udf_sb_ops
suffix:semicolon
id|sb-&gt;dq_op
op_assign
l_int|NULL
suffix:semicolon
id|sb-&gt;s_dirt
op_assign
l_int|0
suffix:semicolon
id|sb-&gt;s_magic
op_assign
id|UDF_SUPER_MAGIC
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|UDF_MAX_BLOCK_LOADED
suffix:semicolon
id|i
op_increment
)paren
(brace
id|UDF_SB_BLOCK_BITMAP_NUMBER
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
l_int|0
suffix:semicolon
id|UDF_SB_BLOCK_BITMAP
c_func
(paren
id|sb
comma
id|i
)paren
op_assign
l_int|NULL
suffix:semicolon
)brace
id|UDF_SB_LOADED_BLOCK_BITMAPS
c_func
(paren
id|sb
)paren
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|udf_load_partition
c_func
(paren
id|sb
comma
op_amp
id|fileset
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;No partition found (1)&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|error_out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|UDF_SB_NUMPARTS
c_func
(paren
id|sb
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;No partition found (2)&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|error_out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|udf_find_fileset
c_func
(paren
id|sb
comma
op_amp
id|fileset
comma
op_amp
id|rootdir
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;No fileset found&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|error_out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|silent
)paren
(brace
id|timestamp
id|ts
suffix:semicolon
id|udf_time_to_stamp
c_func
(paren
op_amp
id|ts
comma
id|UDF_SB_RECORDTIME
c_func
(paren
id|sb
)paren
comma
l_int|0
)paren
suffix:semicolon
id|udf_info
c_func
(paren
l_string|&quot;Mounting volume &squot;%s&squot;, timestamp %04u/%02u/%02u %02u:%02u (%x)&bslash;n&quot;
comma
id|UDF_SB_VOLIDENT
c_func
(paren
id|sb
)paren
comma
id|ts.year
comma
id|ts.month
comma
id|ts.day
comma
id|ts.hour
comma
id|ts.minute
comma
id|ts.typeAndTimezone
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
id|udf_open_lvid
c_func
(paren
id|sb
)paren
suffix:semicolon
id|unlock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
multiline_comment|/* Assign the root inode */
multiline_comment|/* assign inodes by physical block number */
multiline_comment|/* perhaps it&squot;s not extensible enough, but for now ... */
id|inode
op_assign
id|udf_iget
c_func
(paren
id|sb
comma
id|rootdir
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Error in udf_iget, block=%d, partition=%d&bslash;n&quot;
comma
id|rootdir.logicalBlockNum
comma
id|rootdir.partitionReferenceNum
)paren
suffix:semicolon
r_goto
id|error_out
suffix:semicolon
)brace
multiline_comment|/* Allocate a dentry for the root inode */
id|sb-&gt;s_root
op_assign
id|d_alloc_root
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb-&gt;s_root
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;Couldn&squot;t allocate root dentry&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|error_out
suffix:semicolon
)brace
r_return
id|sb
suffix:semicolon
id|error_out
suffix:colon
id|sb-&gt;s_dev
op_assign
id|NODEV
suffix:semicolon
r_if
c_cond
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
)paren
id|iput
c_func
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
id|udf_close_lvid
c_func
(paren
id|sb
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|UDF_SB_FREE
c_func
(paren
id|sb
)paren
suffix:semicolon
id|unlock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|udf_error
r_void
id|udf_error
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_const
r_char
op_star
id|function
comma
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
(brace
multiline_comment|/* mark sb error */
id|sb-&gt;s_dirt
op_assign
l_int|1
suffix:semicolon
)brace
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|vsprintf
c_func
(paren
id|error_buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|printk
(paren
id|KERN_CRIT
l_string|&quot;UDF-fs error (device %s): %s: %s&bslash;n&quot;
comma
id|bdevname
c_func
(paren
id|sb-&gt;s_dev
)paren
comma
id|function
comma
id|error_buf
)paren
suffix:semicolon
)brace
DECL|function|udf_warning
r_void
id|udf_warning
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_const
r_char
op_star
id|function
comma
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
id|va_start
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|vsprintf
c_func
(paren
id|error_buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;UDF-fs warning (device %s): %s: %s&bslash;n&quot;
comma
id|bdevname
c_func
(paren
id|sb-&gt;s_dev
)paren
comma
id|function
comma
id|error_buf
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_put_super&n; *&n; * PURPOSE&n; *&t;Prepare for destruction of the superblock.&n; *&n; * DESCRIPTION&n; *&t;Called before the filesystem is unmounted.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
r_static
r_void
DECL|function|udf_put_super
id|udf_put_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
)paren
id|iput
c_func
(paren
id|UDF_SB_VAT
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
id|udf_close_lvid
c_func
(paren
id|sb
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|UDF_MAX_BLOCK_LOADED
suffix:semicolon
id|i
op_increment
)paren
id|udf_release_data
c_func
(paren
id|UDF_SB_BLOCK_BITMAP
c_func
(paren
id|sb
comma
id|i
)paren
)paren
suffix:semicolon
id|UDF_SB_FREE
c_func
(paren
id|sb
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_stat_fs&n; *&n; * PURPOSE&n; *&t;Return info about the filesystem.&n; *&n; * DESCRIPTION&n; *&t;Called by sys_statfs()&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
r_static
r_int
DECL|function|udf_statfs
id|udf_statfs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|statfs
op_star
id|buf
comma
r_int
id|bufsize
)paren
(brace
r_int
id|size
suffix:semicolon
r_struct
id|statfs
id|tmp
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|size
op_assign
(paren
id|bufsize
OL
r_sizeof
(paren
id|tmp
)paren
)paren
ques
c_cond
id|bufsize
suffix:colon
r_sizeof
(paren
id|tmp
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|tmp
comma
l_int|0
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
id|tmp.f_type
op_assign
id|UDF_SUPER_MAGIC
suffix:semicolon
id|tmp.f_bsize
op_assign
id|sb-&gt;s_blocksize
suffix:semicolon
id|tmp.f_blocks
op_assign
id|UDF_SB_PARTLEN
c_func
(paren
id|sb
comma
id|UDF_SB_PARTITION
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|tmp.f_bfree
op_assign
id|udf_count_free
c_func
(paren
id|sb
)paren
suffix:semicolon
id|tmp.f_bavail
op_assign
id|tmp.f_bfree
suffix:semicolon
id|tmp.f_files
op_assign
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
ques
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|UDF_SB_LVIDIU
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|numFiles
)paren
op_plus
id|le32_to_cpu
c_func
(paren
id|UDF_SB_LVIDIU
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|numDirs
)paren
)paren
suffix:colon
l_int|0
)paren
op_plus
id|tmp.f_bfree
suffix:semicolon
id|tmp.f_ffree
op_assign
id|tmp.f_bfree
suffix:semicolon
multiline_comment|/* __kernel_fsid_t f_fsid */
id|tmp.f_namelen
op_assign
id|UDF_NAME_LEN
suffix:semicolon
id|rc
op_assign
id|copy_to_user
c_func
(paren
id|buf
comma
op_amp
id|tmp
comma
id|size
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|udf_bitmap_lookup
r_static
r_int
r_char
id|udf_bitmap_lookup
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|2
comma
l_int|1
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|1
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|2
comma
l_int|3
comma
l_int|3
comma
l_int|4
)brace
suffix:semicolon
r_static
r_int
r_int
DECL|function|udf_count_free
id|udf_count_free
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|accum
op_assign
l_int|0
suffix:semicolon
r_int
id|index
suffix:semicolon
r_int
id|block
op_assign
l_int|0
comma
id|newblock
suffix:semicolon
id|lb_addr
id|loc
suffix:semicolon
id|Uint32
id|bytes
suffix:semicolon
id|Uint8
id|value
suffix:semicolon
id|Uint8
op_star
id|ptr
suffix:semicolon
id|Uint16
id|ident
suffix:semicolon
r_if
c_cond
(paren
id|UDF_SB_PARTMAPS
c_func
(paren
id|sb
)paren
(braket
id|UDF_SB_PARTITION
c_func
(paren
id|sb
)paren
)braket
dot
id|s_uspace_bitmap
op_eq
l_int|0xFFFFFFFF
)paren
(brace
r_if
c_cond
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|sb
)paren
)paren
(brace
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|numOfPartitions
)paren
OG
id|UDF_SB_PARTITION
c_func
(paren
id|sb
)paren
)paren
id|accum
op_assign
id|le32_to_cpu
c_func
(paren
id|UDF_SB_LVID
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|freeSpaceTable
(braket
id|UDF_SB_PARTITION
c_func
(paren
id|sb
)paren
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|accum
op_eq
l_int|0xFFFFFFFF
)paren
id|accum
op_assign
l_int|0
suffix:semicolon
r_return
id|accum
suffix:semicolon
)brace
r_else
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_struct
id|SpaceBitmapDesc
op_star
id|bm
suffix:semicolon
id|loc.logicalBlockNum
op_assign
id|UDF_SB_PARTMAPS
c_func
(paren
id|sb
)paren
(braket
id|UDF_SB_PARTITION
c_func
(paren
id|sb
)paren
)braket
dot
id|s_uspace_bitmap
suffix:semicolon
id|loc.partitionReferenceNum
op_assign
id|UDF_SB_PARTITION
c_func
(paren
id|sb
)paren
suffix:semicolon
id|bh
op_assign
id|udf_read_ptagged
c_func
(paren
id|sb
comma
id|loc
comma
l_int|0
comma
op_amp
id|ident
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: udf_count_free failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ident
op_ne
id|TID_SPACE_BITMAP_DESC
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: udf_count_free failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|bm
op_assign
(paren
r_struct
id|SpaceBitmapDesc
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
id|bytes
op_assign
id|bm-&gt;numOfBytes
suffix:semicolon
id|index
op_assign
r_sizeof
(paren
r_struct
id|SpaceBitmapDesc
)paren
suffix:semicolon
multiline_comment|/* offset in first block only */
id|ptr
op_assign
(paren
id|Uint8
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
r_while
c_loop
(paren
id|bytes
OG
l_int|0
)paren
(brace
r_while
c_loop
(paren
(paren
id|bytes
OG
l_int|0
)paren
op_logical_and
(paren
id|index
OL
id|sb-&gt;s_blocksize
)paren
)paren
(brace
id|value
op_assign
id|ptr
(braket
id|index
)braket
suffix:semicolon
id|accum
op_add_assign
id|udf_bitmap_lookup
(braket
id|value
op_amp
l_int|0x0f
)braket
suffix:semicolon
id|accum
op_add_assign
id|udf_bitmap_lookup
(braket
id|value
op_rshift
l_int|4
)braket
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|bytes
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bytes
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|newblock
op_assign
id|udf_get_lb_pblock
c_func
(paren
id|sb
comma
id|loc
comma
op_increment
id|block
)paren
suffix:semicolon
id|bh
op_assign
id|udf_tread
c_func
(paren
id|sb
comma
id|newblock
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;read failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|accum
suffix:semicolon
)brace
id|index
op_assign
l_int|0
suffix:semicolon
id|ptr
op_assign
(paren
id|Uint8
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
)brace
)brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
id|accum
suffix:semicolon
)brace
)brace
eof
