multiline_comment|/*&n; * crc.c&n; *&n; * PURPOSE&n; *&t;Routines to generate, calculate, and test a 16-bit CRC.&n; *&n; * DESCRIPTION&n; *&t;The CRC code was devised by Don P. Mitchell of AT&amp;T Bell Laboratories&n; *&t;and Ned W. Rhodes of Software Systems Group. It has been published in&n; *&t;&quot;Design and Validation of Computer Protocols&quot;, Prentice Hall,&n; *&t;Englewood Cliffs, NJ, 1991, Chapter 3, ISBN 0-13-539925-4.&n; *&n; *&t;Copyright is held by AT&amp;T.&n; *&n; *&t;AT&amp;T gives permission for the free use of the CRC source code.&n; *&n; * CONTACTS&n; *&t;E-mail regarding any portion of the Linux UDF file system should be&n; *&t;directed to the development team mailing list (run by majordomo):&n; *&t;&t;linux_udf@hootie.lvld.hp.com&n; *&n; * COPYRIGHT&n; *&t;This file is distributed under the terms of the GNU General Public&n; *&t;License (GPL). Copies of the GPL can be obtained from:&n; *&t;&t;ftp://prep.ai.mit.edu/pub/gnu/GPL&n; *&t;Each contributing author retains all rights to their own work.&n; */
macro_line|#include &quot;udfdecl.h&quot;
DECL|variable|crc_table
r_static
id|Uint16
id|crc_table
(braket
l_int|256
)braket
op_assign
(brace
l_int|0x0000U
comma
l_int|0x1021U
comma
l_int|0x2042U
comma
l_int|0x3063U
comma
l_int|0x4084U
comma
l_int|0x50a5U
comma
l_int|0x60c6U
comma
l_int|0x70e7U
comma
l_int|0x8108U
comma
l_int|0x9129U
comma
l_int|0xa14aU
comma
l_int|0xb16bU
comma
l_int|0xc18cU
comma
l_int|0xd1adU
comma
l_int|0xe1ceU
comma
l_int|0xf1efU
comma
l_int|0x1231U
comma
l_int|0x0210U
comma
l_int|0x3273U
comma
l_int|0x2252U
comma
l_int|0x52b5U
comma
l_int|0x4294U
comma
l_int|0x72f7U
comma
l_int|0x62d6U
comma
l_int|0x9339U
comma
l_int|0x8318U
comma
l_int|0xb37bU
comma
l_int|0xa35aU
comma
l_int|0xd3bdU
comma
l_int|0xc39cU
comma
l_int|0xf3ffU
comma
l_int|0xe3deU
comma
l_int|0x2462U
comma
l_int|0x3443U
comma
l_int|0x0420U
comma
l_int|0x1401U
comma
l_int|0x64e6U
comma
l_int|0x74c7U
comma
l_int|0x44a4U
comma
l_int|0x5485U
comma
l_int|0xa56aU
comma
l_int|0xb54bU
comma
l_int|0x8528U
comma
l_int|0x9509U
comma
l_int|0xe5eeU
comma
l_int|0xf5cfU
comma
l_int|0xc5acU
comma
l_int|0xd58dU
comma
l_int|0x3653U
comma
l_int|0x2672U
comma
l_int|0x1611U
comma
l_int|0x0630U
comma
l_int|0x76d7U
comma
l_int|0x66f6U
comma
l_int|0x5695U
comma
l_int|0x46b4U
comma
l_int|0xb75bU
comma
l_int|0xa77aU
comma
l_int|0x9719U
comma
l_int|0x8738U
comma
l_int|0xf7dfU
comma
l_int|0xe7feU
comma
l_int|0xd79dU
comma
l_int|0xc7bcU
comma
l_int|0x48c4U
comma
l_int|0x58e5U
comma
l_int|0x6886U
comma
l_int|0x78a7U
comma
l_int|0x0840U
comma
l_int|0x1861U
comma
l_int|0x2802U
comma
l_int|0x3823U
comma
l_int|0xc9ccU
comma
l_int|0xd9edU
comma
l_int|0xe98eU
comma
l_int|0xf9afU
comma
l_int|0x8948U
comma
l_int|0x9969U
comma
l_int|0xa90aU
comma
l_int|0xb92bU
comma
l_int|0x5af5U
comma
l_int|0x4ad4U
comma
l_int|0x7ab7U
comma
l_int|0x6a96U
comma
l_int|0x1a71U
comma
l_int|0x0a50U
comma
l_int|0x3a33U
comma
l_int|0x2a12U
comma
l_int|0xdbfdU
comma
l_int|0xcbdcU
comma
l_int|0xfbbfU
comma
l_int|0xeb9eU
comma
l_int|0x9b79U
comma
l_int|0x8b58U
comma
l_int|0xbb3bU
comma
l_int|0xab1aU
comma
l_int|0x6ca6U
comma
l_int|0x7c87U
comma
l_int|0x4ce4U
comma
l_int|0x5cc5U
comma
l_int|0x2c22U
comma
l_int|0x3c03U
comma
l_int|0x0c60U
comma
l_int|0x1c41U
comma
l_int|0xedaeU
comma
l_int|0xfd8fU
comma
l_int|0xcdecU
comma
l_int|0xddcdU
comma
l_int|0xad2aU
comma
l_int|0xbd0bU
comma
l_int|0x8d68U
comma
l_int|0x9d49U
comma
l_int|0x7e97U
comma
l_int|0x6eb6U
comma
l_int|0x5ed5U
comma
l_int|0x4ef4U
comma
l_int|0x3e13U
comma
l_int|0x2e32U
comma
l_int|0x1e51U
comma
l_int|0x0e70U
comma
l_int|0xff9fU
comma
l_int|0xefbeU
comma
l_int|0xdfddU
comma
l_int|0xcffcU
comma
l_int|0xbf1bU
comma
l_int|0xaf3aU
comma
l_int|0x9f59U
comma
l_int|0x8f78U
comma
l_int|0x9188U
comma
l_int|0x81a9U
comma
l_int|0xb1caU
comma
l_int|0xa1ebU
comma
l_int|0xd10cU
comma
l_int|0xc12dU
comma
l_int|0xf14eU
comma
l_int|0xe16fU
comma
l_int|0x1080U
comma
l_int|0x00a1U
comma
l_int|0x30c2U
comma
l_int|0x20e3U
comma
l_int|0x5004U
comma
l_int|0x4025U
comma
l_int|0x7046U
comma
l_int|0x6067U
comma
l_int|0x83b9U
comma
l_int|0x9398U
comma
l_int|0xa3fbU
comma
l_int|0xb3daU
comma
l_int|0xc33dU
comma
l_int|0xd31cU
comma
l_int|0xe37fU
comma
l_int|0xf35eU
comma
l_int|0x02b1U
comma
l_int|0x1290U
comma
l_int|0x22f3U
comma
l_int|0x32d2U
comma
l_int|0x4235U
comma
l_int|0x5214U
comma
l_int|0x6277U
comma
l_int|0x7256U
comma
l_int|0xb5eaU
comma
l_int|0xa5cbU
comma
l_int|0x95a8U
comma
l_int|0x8589U
comma
l_int|0xf56eU
comma
l_int|0xe54fU
comma
l_int|0xd52cU
comma
l_int|0xc50dU
comma
l_int|0x34e2U
comma
l_int|0x24c3U
comma
l_int|0x14a0U
comma
l_int|0x0481U
comma
l_int|0x7466U
comma
l_int|0x6447U
comma
l_int|0x5424U
comma
l_int|0x4405U
comma
l_int|0xa7dbU
comma
l_int|0xb7faU
comma
l_int|0x8799U
comma
l_int|0x97b8U
comma
l_int|0xe75fU
comma
l_int|0xf77eU
comma
l_int|0xc71dU
comma
l_int|0xd73cU
comma
l_int|0x26d3U
comma
l_int|0x36f2U
comma
l_int|0x0691U
comma
l_int|0x16b0U
comma
l_int|0x6657U
comma
l_int|0x7676U
comma
l_int|0x4615U
comma
l_int|0x5634U
comma
l_int|0xd94cU
comma
l_int|0xc96dU
comma
l_int|0xf90eU
comma
l_int|0xe92fU
comma
l_int|0x99c8U
comma
l_int|0x89e9U
comma
l_int|0xb98aU
comma
l_int|0xa9abU
comma
l_int|0x5844U
comma
l_int|0x4865U
comma
l_int|0x7806U
comma
l_int|0x6827U
comma
l_int|0x18c0U
comma
l_int|0x08e1U
comma
l_int|0x3882U
comma
l_int|0x28a3U
comma
l_int|0xcb7dU
comma
l_int|0xdb5cU
comma
l_int|0xeb3fU
comma
l_int|0xfb1eU
comma
l_int|0x8bf9U
comma
l_int|0x9bd8U
comma
l_int|0xabbbU
comma
l_int|0xbb9aU
comma
l_int|0x4a75U
comma
l_int|0x5a54U
comma
l_int|0x6a37U
comma
l_int|0x7a16U
comma
l_int|0x0af1U
comma
l_int|0x1ad0U
comma
l_int|0x2ab3U
comma
l_int|0x3a92U
comma
l_int|0xfd2eU
comma
l_int|0xed0fU
comma
l_int|0xdd6cU
comma
l_int|0xcd4dU
comma
l_int|0xbdaaU
comma
l_int|0xad8bU
comma
l_int|0x9de8U
comma
l_int|0x8dc9U
comma
l_int|0x7c26U
comma
l_int|0x6c07U
comma
l_int|0x5c64U
comma
l_int|0x4c45U
comma
l_int|0x3ca2U
comma
l_int|0x2c83U
comma
l_int|0x1ce0U
comma
l_int|0x0cc1U
comma
l_int|0xef1fU
comma
l_int|0xff3eU
comma
l_int|0xcf5dU
comma
l_int|0xdf7cU
comma
l_int|0xaf9bU
comma
l_int|0xbfbaU
comma
l_int|0x8fd9U
comma
l_int|0x9ff8U
comma
l_int|0x6e17U
comma
l_int|0x7e36U
comma
l_int|0x4e55U
comma
l_int|0x5e74U
comma
l_int|0x2e93U
comma
l_int|0x3eb2U
comma
l_int|0x0ed1U
comma
l_int|0x1ef0U
)brace
suffix:semicolon
multiline_comment|/*&n; * udf_crc&n; *&n; * PURPOSE&n; *&t;Calculate a 16-bit CRC checksum using ITU-T V.41 polynomial.&n; *&n; * DESCRIPTION&n; *&t;The OSTA-UDF(tm) 1.50 standard states that using CRCs is mandatory.&n; *&t;The polynomial used is:&t;x^16 + x^12 + x^15 + 1&n; *&n; * PRE-CONDITIONS&n; *&t;data&t;&t;Pointer to the data block.&n; *&t;size&t;&t;Size of the data block.&n; *&n; * POST-CONDITIONS&n; *&t;&lt;return&gt;&t;CRC of the data block.&n; *&n; * HISTORY&n; *&t;July 21, 1997 - Andrew E. Mileski&n; *&t;Adapted from OSTA-UDF(tm) 1.50 standard.&n; */
r_extern
id|Uint16
DECL|function|udf_crc
id|udf_crc
c_func
(paren
id|Uint8
op_star
id|data
comma
id|Uint32
id|size
comma
id|Uint16
id|crc
)paren
(brace
r_while
c_loop
(paren
id|size
op_decrement
)paren
id|crc
op_assign
id|crc_table
(braket
(paren
id|crc
op_rshift
l_int|8
op_xor
op_star
(paren
id|data
op_increment
)paren
)paren
op_amp
l_int|0xffU
)braket
op_xor
(paren
id|crc
op_lshift
l_int|8
)paren
suffix:semicolon
r_return
id|crc
suffix:semicolon
)brace
multiline_comment|/****************************************************************************/
macro_line|#if defined(TEST)
multiline_comment|/*&n; * PURPOSE&n; *&t;Test udf_crc()&n; *&n; * HISTORY&n; *&t;July 21, 1997 - Andrew E. Mileski&n; *&t;Adapted from OSTA-UDF(tm) 1.50 standard.&n; */
DECL|variable|bytes
r_int
r_char
id|bytes
(braket
)braket
op_assign
(brace
l_int|0x70U
comma
l_int|0x6AU
comma
l_int|0x77U
)brace
suffix:semicolon
DECL|function|main
r_int
id|main
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|x
suffix:semicolon
id|x
op_assign
id|udf_crc16
c_func
(paren
id|bytes
comma
r_sizeof
id|bytes
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;udf_crc16: calculated = %4.4x, correct = %4.4x&bslash;n&quot;
comma
id|x
comma
l_int|0x3299U
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* defined(TEST) */
multiline_comment|/****************************************************************************/
macro_line|#if defined(GENERATE)
multiline_comment|/*&n; * PURPOSE&n; *&t;Generate a table for fast 16-bit CRC calculations (any polynomial).&n; *&n; * DESCRIPTION&n; *&t;The ITU-T V.41 polynomial is 010041.&n; *&n; * HISTORY&n; *&t;July 21, 1997 - Andrew E. Mileski&n; *&t;Adapted from OSTA-UDF(tm) 1.50 standard.&n; */
macro_line|#include &lt;stdio.h&gt;
DECL|function|main
r_int
id|main
c_func
(paren
r_int
id|argc
comma
r_char
op_star
op_star
id|argv
)paren
(brace
r_int
r_int
id|crc
comma
id|poly
suffix:semicolon
r_int
id|n
comma
id|i
suffix:semicolon
multiline_comment|/* Get the polynomial */
id|sscanf
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
l_string|&quot;%lo&quot;
comma
op_amp
id|poly
)paren
suffix:semicolon
r_if
c_cond
(paren
id|poly
op_amp
l_int|0xffff0000U
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;polynomial is too large&bslash;en&quot;
)paren
suffix:semicolon
m_exit
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|printf
c_func
(paren
l_string|&quot;/* CRC 0%o */&bslash;n&quot;
comma
id|poly
)paren
suffix:semicolon
multiline_comment|/* Create a table */
id|printf
c_func
(paren
l_string|&quot;static unsigned short crc_table[256] = {&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
l_int|256
suffix:semicolon
id|n
op_increment
)paren
(brace
r_if
c_cond
(paren
id|n
op_mod
l_int|8
op_eq
l_int|0
)paren
id|printf
c_func
(paren
l_string|&quot;&bslash;t&quot;
)paren
suffix:semicolon
id|crc
op_assign
id|n
op_lshift
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|crc
op_amp
l_int|0x8000U
)paren
(brace
id|crc
op_assign
(paren
id|crc
op_lshift
l_int|1
)paren
op_xor
id|poly
suffix:semicolon
)brace
r_else
id|crc
op_lshift_assign
l_int|1
suffix:semicolon
id|crc
op_and_assign
l_int|0xFFFFU
suffix:semicolon
)brace
r_if
c_cond
(paren
id|n
op_eq
l_int|255
)paren
id|printf
c_func
(paren
l_string|&quot;0x%04xU &quot;
comma
id|crc
)paren
suffix:semicolon
r_else
id|printf
c_func
(paren
l_string|&quot;0x%04xU, &quot;
comma
id|crc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
op_mod
l_int|8
op_eq
l_int|7
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|printf
c_func
(paren
l_string|&quot;};&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* defined(GENERATE) */
eof
