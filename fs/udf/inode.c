multiline_comment|/*&n; * inode.c&n; *&n; * PURPOSE&n; *  Inode handling routines for the OSTA-UDF(tm) filesystem.&n; *&n; * CONTACTS&n; *  E-mail regarding any portion of the Linux UDF file system should be&n; *  directed to the development team mailing list (run by majordomo):&n; *    linux_udf@hootie.lvld.hp.com&n; *&n; * COPYRIGHT&n; *  This file is distributed under the terms of the GNU General Public&n; *  License (GPL). Copies of the GPL can be obtained from:&n; *    ftp://prep.ai.mit.edu/pub/gnu/GPL&n; *  Each contributing author retains all rights to their own work.&n; *&n; *  (C) 1998 Dave Boynton&n; *  (C) 1998-2000 Ben Fennema&n; *  (C) 1999-2000 Stelias Computing Inc&n; *&n; * HISTORY&n; *&n; *  10/04/98 dgb  Added rudimentary directory functions&n; *  10/07/98      Fully working udf_block_map! It works!&n; *  11/25/98      bmap altered to better support extents&n; *  12/06/98 blf  partition support in udf_iget, udf_block_map and udf_read_inode&n; *  12/12/98      rewrote udf_block_map to handle next extents and descs across&n; *                block boundaries (which is not actually allowed)&n; *  12/20/98      added support for strategy 4096&n; *  03/07/99      rewrote udf_block_map (again)&n; *                New funcs, inode_bmap, udf_next_aext&n; *  04/19/99      Support for writing device EA&squot;s for major/minor #&n; */
macro_line|#include &quot;udfdecl.h&quot;
macro_line|#include &lt;linux/locks.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &quot;udf_i.h&quot;
macro_line|#include &quot;udf_sb.h&quot;
DECL|macro|EXTENT_MERGE_SIZE
mdefine_line|#define EXTENT_MERGE_SIZE 5
r_static
id|mode_t
id|udf_convert_permissions
c_func
(paren
r_struct
id|FileEntry
op_star
)paren
suffix:semicolon
r_static
r_int
id|udf_update_inode
c_func
(paren
r_struct
id|inode
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|udf_fill_inode
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|buffer_head
op_star
)paren
suffix:semicolon
r_static
r_struct
id|buffer_head
op_star
id|inode_getblk
c_func
(paren
r_struct
id|inode
op_star
comma
r_int
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
)paren
suffix:semicolon
r_static
r_void
id|udf_split_extents
c_func
(paren
r_struct
id|inode
op_star
comma
r_int
op_star
comma
r_int
comma
r_int
comma
id|long_ad
(braket
id|EXTENT_MERGE_SIZE
)braket
comma
r_int
op_star
)paren
suffix:semicolon
r_static
r_void
id|udf_prealloc_extents
c_func
(paren
r_struct
id|inode
op_star
comma
r_int
comma
r_int
comma
id|long_ad
(braket
id|EXTENT_MERGE_SIZE
)braket
comma
r_int
op_star
)paren
suffix:semicolon
r_static
r_void
id|udf_merge_extents
c_func
(paren
r_struct
id|inode
op_star
comma
id|long_ad
(braket
id|EXTENT_MERGE_SIZE
)braket
comma
r_int
op_star
)paren
suffix:semicolon
r_static
r_void
id|udf_update_extents
c_func
(paren
r_struct
id|inode
op_star
comma
id|long_ad
(braket
id|EXTENT_MERGE_SIZE
)braket
comma
r_int
comma
r_int
comma
id|lb_addr
comma
id|Uint32
comma
r_struct
id|buffer_head
op_star
op_star
)paren
suffix:semicolon
r_static
r_int
id|udf_get_block
c_func
(paren
r_struct
id|inode
op_star
comma
r_int
comma
r_struct
id|buffer_head
op_star
comma
r_int
)paren
suffix:semicolon
multiline_comment|/*&n; * udf_put_inode&n; *&n; * PURPOSE&n; *&n; * DESCRIPTION&n; *&t;This routine is called whenever the kernel no longer needs the inode.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; *&n; *  Called at each iput()&n; */
DECL|function|udf_put_inode
r_void
id|udf_put_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inode-&gt;i_sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|udf_discard_prealloc
c_func
(paren
id|inode
)paren
suffix:semicolon
multiline_comment|/* write the root inode on put, if dirty */
r_if
c_cond
(paren
op_logical_neg
id|inode-&gt;i_sb-&gt;s_root
op_logical_and
id|inode-&gt;i_state
op_amp
id|I_DIRTY
)paren
id|udf_update_inode
c_func
(paren
id|inode
comma
id|IS_SYNC
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * udf_delete_inode&n; *&n; * PURPOSE&n; *&t;Clean-up before the specified inode is destroyed.&n; *&n; * DESCRIPTION&n; *&t;This routine is called when the kernel destroys an inode structure&n; *&t;ie. when iput() finds i_count == 0.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; *&n; *  Called at the last iput() if i_nlink is zero.&n; */
DECL|function|udf_delete_inode
r_void
id|udf_delete_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_bad_inode
c_func
(paren
id|inode
)paren
)paren
(brace
id|clear_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|inode-&gt;i_size
op_assign
l_int|0
suffix:semicolon
id|udf_truncate
c_func
(paren
id|inode
)paren
suffix:semicolon
id|udf_update_inode
c_func
(paren
id|inode
comma
id|IS_SYNC
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|udf_free_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|udf_discard_prealloc
r_void
id|udf_discard_prealloc
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_if
c_cond
(paren
id|inode-&gt;i_size
op_logical_and
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_ne
id|ICB_FLAG_AD_IN_ICB
)paren
id|udf_trunc
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
DECL|function|udf_writepage
r_static
r_int
id|udf_writepage
c_func
(paren
r_struct
id|page
op_star
id|page
)paren
(brace
r_return
id|block_write_full_page
c_func
(paren
id|page
comma
id|udf_get_block
)paren
suffix:semicolon
)brace
DECL|function|udf_readpage
r_static
r_int
id|udf_readpage
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|page
op_star
id|page
)paren
(brace
r_return
id|block_read_full_page
c_func
(paren
id|page
comma
id|udf_get_block
)paren
suffix:semicolon
)brace
DECL|function|udf_prepare_write
r_static
r_int
id|udf_prepare_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|page
op_star
id|page
comma
r_int
id|from
comma
r_int
id|to
)paren
(brace
r_return
id|block_prepare_write
c_func
(paren
id|page
comma
id|from
comma
id|to
comma
id|udf_get_block
)paren
suffix:semicolon
)brace
DECL|function|udf_bmap
r_static
r_int
id|udf_bmap
c_func
(paren
r_struct
id|address_space
op_star
id|mapping
comma
r_int
id|block
)paren
(brace
r_return
id|generic_block_bmap
c_func
(paren
id|mapping
comma
id|block
comma
id|udf_get_block
)paren
suffix:semicolon
)brace
DECL|variable|udf_aops
r_struct
id|address_space_operations
id|udf_aops
op_assign
(brace
id|readpage
suffix:colon
id|udf_readpage
comma
id|writepage
suffix:colon
id|udf_writepage
comma
id|sync_page
suffix:colon
id|block_sync_page
comma
id|prepare_write
suffix:colon
id|udf_prepare_write
comma
id|commit_write
suffix:colon
id|generic_commit_write
comma
id|bmap
suffix:colon
id|udf_bmap
comma
)brace
suffix:semicolon
DECL|function|udf_expand_file_adinicb
r_void
id|udf_expand_file_adinicb
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|newsize
comma
r_int
op_star
id|err
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|page
op_star
id|page
suffix:semicolon
r_int
id|block
suffix:semicolon
multiline_comment|/* from now on we have normal address_space methods */
id|inode-&gt;i_data.a_ops
op_assign
op_amp
id|udf_aops
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
)paren
(brace
r_if
c_cond
(paren
id|UDF_QUERY_FLAG
c_func
(paren
id|inode-&gt;i_sb
comma
id|UDF_FLAG_USE_SHORT_AD
)paren
)paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_assign
id|ICB_FLAG_AD_SHORT
suffix:semicolon
r_else
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_assign
id|ICB_FLAG_AD_LONG
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|block
op_assign
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
l_int|0
)paren
suffix:semicolon
id|bh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|block
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
r_return
suffix:semicolon
id|page
op_assign
id|grab_cache_page
c_func
(paren
id|inode-&gt;i_mapping
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|PageLocked
c_func
(paren
id|page
)paren
)paren
id|PAGE_BUG
c_func
(paren
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Page_Uptodate
c_func
(paren
id|page
)paren
)paren
(brace
r_char
op_star
id|kaddr
op_assign
id|kmap
c_func
(paren
id|page
)paren
suffix:semicolon
id|memset
c_func
(paren
id|kaddr
op_plus
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
comma
l_int|0x00
comma
id|PAGE_CACHE_SIZE
op_minus
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|kaddr
comma
id|bh-&gt;b_data
op_plus
id|udf_file_entry_alloc_offset
c_func
(paren
id|inode
)paren
comma
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|flush_dcache_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|SetPageUptodate
c_func
(paren
id|page
)paren
suffix:semicolon
id|kunmap
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|bh-&gt;b_data
op_plus
id|udf_file_entry_alloc_offset
c_func
(paren
id|inode
)paren
comma
l_int|0
comma
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|UDF_QUERY_FLAG
c_func
(paren
id|inode-&gt;i_sb
comma
id|UDF_FLAG_USE_SHORT_AD
)paren
)paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_assign
id|ICB_FLAG_AD_SHORT
suffix:semicolon
r_else
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_assign
id|ICB_FLAG_AD_LONG
suffix:semicolon
id|inode-&gt;i_blocks
op_assign
id|inode-&gt;i_sb-&gt;s_blocksize
op_div
l_int|512
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|bh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|inode-&gt;i_data.a_ops
op_member_access_from_pointer
id|writepage
c_func
(paren
id|page
)paren
suffix:semicolon
id|UnlockPage
c_func
(paren
id|page
)paren
suffix:semicolon
id|page_cache_release
c_func
(paren
id|page
)paren
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode-&gt;i_version
op_increment
suffix:semicolon
)brace
DECL|function|udf_expand_dir_adinicb
r_struct
id|buffer_head
op_star
id|udf_expand_dir_adinicb
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
op_star
id|block
comma
r_int
op_star
id|err
)paren
(brace
r_int
id|newblock
suffix:semicolon
r_struct
id|buffer_head
op_star
id|sbh
op_assign
l_int|NULL
comma
op_star
id|dbh
op_assign
l_int|NULL
suffix:semicolon
id|lb_addr
id|bloc
comma
id|eloc
suffix:semicolon
id|Uint32
id|elen
comma
id|extoffset
suffix:semicolon
r_struct
id|udf_fileident_bh
id|sfibh
comma
id|dfibh
suffix:semicolon
id|loff_t
id|f_pos
op_assign
id|udf_ext0_offset
c_func
(paren
id|inode
)paren
op_rshift
l_int|2
suffix:semicolon
r_int
id|size
op_assign
(paren
id|udf_ext0_offset
c_func
(paren
id|inode
)paren
op_plus
id|inode-&gt;i_size
)paren
op_rshift
l_int|2
suffix:semicolon
r_struct
id|FileIdentDesc
id|cfi
comma
op_star
id|sfi
comma
op_star
id|dfi
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode-&gt;i_size
)paren
(brace
r_if
c_cond
(paren
id|UDF_QUERY_FLAG
c_func
(paren
id|inode-&gt;i_sb
comma
id|UDF_FLAG_USE_SHORT_AD
)paren
)paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_assign
id|ICB_FLAG_AD_SHORT
suffix:semicolon
r_else
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_assign
id|ICB_FLAG_AD_LONG
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* alloc block, and copy data to it */
op_star
id|block
op_assign
id|udf_new_block
c_func
(paren
id|inode
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|logicalBlockNum
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|block
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|newblock
op_assign
id|udf_get_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
op_star
id|block
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newblock
)paren
r_return
l_int|NULL
suffix:semicolon
id|sbh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|inode-&gt;i_ino
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbh
)paren
r_return
l_int|NULL
suffix:semicolon
id|dbh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|newblock
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dbh
)paren
r_return
l_int|NULL
suffix:semicolon
id|sfibh.soffset
op_assign
id|sfibh.eoffset
op_assign
(paren
id|f_pos
op_amp
(paren
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
l_int|2
)paren
)paren
op_lshift
l_int|2
suffix:semicolon
id|sfibh.sbh
op_assign
id|sfibh.ebh
op_assign
id|sbh
suffix:semicolon
id|dfibh.soffset
op_assign
id|dfibh.eoffset
op_assign
l_int|0
suffix:semicolon
id|dfibh.sbh
op_assign
id|dfibh.ebh
op_assign
id|dbh
suffix:semicolon
r_while
c_loop
(paren
(paren
id|f_pos
OL
id|size
)paren
)paren
(brace
id|sfi
op_assign
id|udf_fileident_read
c_func
(paren
id|inode
comma
op_amp
id|f_pos
comma
op_amp
id|sfibh
comma
op_amp
id|cfi
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sfi
)paren
(brace
id|udf_release_data
c_func
(paren
id|sbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|dbh
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|sfi-&gt;descTag.tagLocation
op_assign
op_star
id|block
suffix:semicolon
id|dfibh.soffset
op_assign
id|dfibh.eoffset
suffix:semicolon
id|dfibh.eoffset
op_add_assign
(paren
id|sfibh.eoffset
op_minus
id|sfibh.soffset
)paren
suffix:semicolon
id|dfi
op_assign
(paren
r_struct
id|FileIdentDesc
op_star
)paren
(paren
id|dbh-&gt;b_data
op_plus
id|dfibh.soffset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udf_write_fi
c_func
(paren
id|sfi
comma
id|dfi
comma
op_amp
id|dfibh
comma
id|sfi-&gt;impUse
comma
id|sfi-&gt;fileIdent
op_plus
id|sfi-&gt;lengthOfImpUse
)paren
)paren
(brace
id|udf_release_data
c_func
(paren
id|sbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|dbh
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
id|mark_buffer_dirty
c_func
(paren
id|dbh
)paren
suffix:semicolon
id|memset
c_func
(paren
id|sbh-&gt;b_data
op_plus
id|udf_file_entry_alloc_offset
c_func
(paren
id|inode
)paren
comma
l_int|0
comma
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|UDF_QUERY_FLAG
c_func
(paren
id|inode-&gt;i_sb
comma
id|UDF_FLAG_USE_SHORT_AD
)paren
)paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_assign
id|ICB_FLAG_AD_SHORT
suffix:semicolon
r_else
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_assign
id|ICB_FLAG_AD_LONG
suffix:semicolon
id|bloc
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
suffix:semicolon
id|eloc.logicalBlockNum
op_assign
op_star
id|block
suffix:semicolon
id|eloc.partitionReferenceNum
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
suffix:semicolon
id|elen
op_assign
id|inode-&gt;i_size
suffix:semicolon
id|extoffset
op_assign
id|udf_file_entry_alloc_offset
c_func
(paren
id|inode
)paren
suffix:semicolon
id|udf_add_aext
c_func
(paren
id|inode
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
id|eloc
comma
id|elen
comma
op_amp
id|sbh
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* UniqueID stuff */
id|inode-&gt;i_blocks
op_assign
id|inode-&gt;i_sb-&gt;s_blocksize
op_div
l_int|512
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|sbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|sbh
)paren
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode-&gt;i_version
op_increment
suffix:semicolon
r_return
id|dbh
suffix:semicolon
)brace
DECL|function|udf_get_block
r_static
r_int
id|udf_get_block
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|block
comma
r_struct
id|buffer_head
op_star
id|bh_result
comma
r_int
id|create
)paren
(brace
r_int
id|err
comma
r_new
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
r_int
r_int
id|phys
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|create
)paren
(brace
id|phys
op_assign
id|udf_block_map
c_func
(paren
id|inode
comma
id|block
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phys
)paren
(brace
id|bh_result-&gt;b_dev
op_assign
id|inode-&gt;i_dev
suffix:semicolon
id|bh_result-&gt;b_blocknr
op_assign
id|phys
suffix:semicolon
id|bh_result-&gt;b_state
op_or_assign
(paren
l_int|1UL
op_lshift
id|BH_Mapped
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_new
op_assign
l_int|0
suffix:semicolon
id|bh
op_assign
l_int|NULL
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|block
OL
l_int|0
)paren
r_goto
id|abort_negative
suffix:semicolon
r_if
c_cond
(paren
id|block
op_eq
id|UDF_I_NEXT_ALLOC_BLOCK
c_func
(paren
id|inode
)paren
op_plus
l_int|1
)paren
(brace
id|UDF_I_NEXT_ALLOC_BLOCK
c_func
(paren
id|inode
)paren
op_increment
suffix:semicolon
id|UDF_I_NEXT_ALLOC_GOAL
c_func
(paren
id|inode
)paren
op_increment
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
id|bh
op_assign
id|inode_getblk
c_func
(paren
id|inode
comma
id|block
comma
op_amp
id|err
comma
op_amp
id|phys
comma
op_amp
r_new
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bh
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
m_abort
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|phys
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|bh_result-&gt;b_dev
op_assign
id|inode-&gt;i_dev
suffix:semicolon
id|bh_result-&gt;b_blocknr
op_assign
id|phys
suffix:semicolon
id|bh_result-&gt;b_state
op_or_assign
(paren
l_int|1UL
op_lshift
id|BH_Mapped
)paren
suffix:semicolon
r_if
c_cond
(paren
r_new
)paren
id|bh_result-&gt;b_state
op_or_assign
(paren
l_int|1UL
op_lshift
id|BH_New
)paren
suffix:semicolon
m_abort
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
id|abort_negative
suffix:colon
id|udf_warning
c_func
(paren
id|inode-&gt;i_sb
comma
l_string|&quot;udf_get_block&quot;
comma
l_string|&quot;block &lt; 0&quot;
)paren
suffix:semicolon
r_goto
m_abort
suffix:semicolon
)brace
DECL|function|udf_getblk
r_struct
id|buffer_head
op_star
id|udf_getblk
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|block
comma
r_int
id|create
comma
r_int
op_star
id|err
)paren
(brace
r_struct
id|buffer_head
id|dummy
suffix:semicolon
r_int
id|error
suffix:semicolon
id|dummy.b_state
op_assign
l_int|0
suffix:semicolon
id|dummy.b_blocknr
op_assign
op_minus
l_int|1000
suffix:semicolon
id|error
op_assign
id|udf_get_block
c_func
(paren
id|inode
comma
id|block
comma
op_amp
id|dummy
comma
id|create
)paren
suffix:semicolon
op_star
id|err
op_assign
id|error
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
op_amp
id|buffer_mapped
c_func
(paren
op_amp
id|dummy
)paren
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
id|bh
op_assign
id|getblk
c_func
(paren
id|dummy.b_dev
comma
id|dummy.b_blocknr
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buffer_new
c_func
(paren
op_amp
id|dummy
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|buffer_uptodate
c_func
(paren
id|bh
)paren
)paren
id|wait_on_buffer
c_func
(paren
id|bh
)paren
suffix:semicolon
id|memset
c_func
(paren
id|bh-&gt;b_data
comma
l_int|0x00
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|mark_buffer_uptodate
c_func
(paren
id|bh
comma
l_int|1
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
r_return
id|bh
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|inode_getblk
r_static
r_struct
id|buffer_head
op_star
id|inode_getblk
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|block
comma
r_int
op_star
id|err
comma
r_int
op_star
id|phys
comma
r_int
op_star
r_new
)paren
(brace
r_struct
id|buffer_head
op_star
id|pbh
op_assign
l_int|NULL
comma
op_star
id|cbh
op_assign
l_int|NULL
comma
op_star
id|result
op_assign
l_int|NULL
suffix:semicolon
id|long_ad
id|laarr
(braket
id|EXTENT_MERGE_SIZE
)braket
suffix:semicolon
id|Uint32
id|pextoffset
op_assign
l_int|0
comma
id|cextoffset
op_assign
l_int|0
comma
id|nextoffset
op_assign
l_int|0
suffix:semicolon
r_int
id|count
op_assign
l_int|0
comma
id|startnum
op_assign
l_int|0
comma
id|endnum
op_assign
l_int|0
suffix:semicolon
id|Uint32
id|elen
op_assign
l_int|0
suffix:semicolon
id|lb_addr
id|eloc
comma
id|pbloc
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
id|cbloc
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
suffix:semicolon
r_int
id|c
op_assign
l_int|1
suffix:semicolon
r_int
id|lbcount
op_assign
l_int|0
comma
id|b_off
op_assign
l_int|0
comma
id|offset
op_assign
l_int|0
suffix:semicolon
id|Uint32
id|newblocknum
comma
id|newblock
suffix:semicolon
r_int
id|etype
suffix:semicolon
r_int
id|goal
op_assign
l_int|0
comma
id|pgoal
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|logicalBlockNum
suffix:semicolon
r_char
id|lastblock
op_assign
l_int|0
suffix:semicolon
id|pextoffset
op_assign
id|cextoffset
op_assign
id|nextoffset
op_assign
id|udf_file_entry_alloc_offset
c_func
(paren
id|inode
)paren
suffix:semicolon
id|b_off
op_assign
id|block
op_lshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
suffix:semicolon
id|pbloc
op_assign
id|cbloc
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
suffix:semicolon
multiline_comment|/* find the extent which contains the block we are looking for.&n;       alternate between laarr[0] and laarr[1] for locations of the&n;       current extent, and the previous extent */
r_do
(brace
r_if
c_cond
(paren
id|pbh
op_ne
id|cbh
)paren
(brace
id|udf_release_data
c_func
(paren
id|pbh
)paren
suffix:semicolon
id|pbh
op_assign
id|cbh
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|cbh-&gt;b_count
)paren
suffix:semicolon
id|pbloc
op_assign
id|cbloc
suffix:semicolon
)brace
id|lbcount
op_add_assign
id|elen
suffix:semicolon
id|pextoffset
op_assign
id|cextoffset
suffix:semicolon
id|cextoffset
op_assign
id|nextoffset
suffix:semicolon
r_if
c_cond
(paren
(paren
id|etype
op_assign
id|udf_next_aext
c_func
(paren
id|inode
comma
op_amp
id|cbloc
comma
op_amp
id|nextoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|cbh
comma
l_int|1
)paren
)paren
op_eq
op_minus
l_int|1
)paren
r_break
suffix:semicolon
id|c
op_assign
op_logical_neg
id|c
suffix:semicolon
id|laarr
(braket
id|c
)braket
dot
id|extLength
op_assign
(paren
id|etype
op_lshift
l_int|30
)paren
op_or
id|elen
suffix:semicolon
id|laarr
(braket
id|c
)braket
dot
id|extLocation
op_assign
id|eloc
suffix:semicolon
r_if
c_cond
(paren
id|etype
op_ne
id|EXTENT_NOT_RECORDED_NOT_ALLOCATED
)paren
id|pgoal
op_assign
id|eloc.logicalBlockNum
op_plus
(paren
(paren
id|elen
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|lbcount
op_plus
id|elen
op_le
id|b_off
)paren
suffix:semicolon
id|b_off
op_sub_assign
id|lbcount
suffix:semicolon
id|offset
op_assign
id|b_off
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
suffix:semicolon
multiline_comment|/* if the extent is allocated and recorded, return the block&n;       if the extent is not a multiple of the blocksize, round up */
r_if
c_cond
(paren
id|etype
op_eq
id|EXTENT_RECORDED_ALLOCATED
)paren
(brace
r_if
c_cond
(paren
id|elen
op_amp
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
)paren
(brace
id|elen
op_assign
(paren
id|EXTENT_RECORDED_ALLOCATED
op_lshift
l_int|30
)paren
op_or
(paren
(paren
id|elen
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_amp
op_complement
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|etype
op_assign
id|udf_write_aext
c_func
(paren
id|inode
comma
id|cbloc
comma
op_amp
id|cextoffset
comma
id|eloc
comma
id|elen
comma
op_amp
id|cbh
comma
l_int|1
)paren
suffix:semicolon
)brace
id|udf_release_data
c_func
(paren
id|pbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|cbh
)paren
suffix:semicolon
id|newblock
op_assign
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|eloc
comma
id|offset
)paren
suffix:semicolon
op_star
id|phys
op_assign
id|newblock
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|etype
op_eq
op_minus
l_int|1
)paren
(brace
id|endnum
op_assign
id|startnum
op_assign
(paren
(paren
id|count
OG
l_int|1
)paren
ques
c_cond
l_int|1
suffix:colon
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|laarr
(braket
id|c
)braket
dot
id|extLength
op_amp
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
)paren
(brace
id|laarr
(braket
id|c
)braket
dot
id|extLength
op_assign
(paren
id|laarr
(braket
id|c
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_FLAG_MASK
)paren
op_or
(paren
(paren
(paren
id|laarr
(braket
id|c
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_amp
op_complement
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
id|c
op_assign
op_logical_neg
id|c
suffix:semicolon
id|laarr
(braket
id|c
)braket
dot
id|extLength
op_assign
(paren
id|EXTENT_NOT_RECORDED_NOT_ALLOCATED
op_lshift
l_int|30
)paren
op_or
(paren
(paren
id|offset
op_plus
l_int|1
)paren
op_lshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|laarr
(braket
id|c
)braket
dot
id|extLocation
comma
l_int|0x00
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
suffix:semicolon
id|count
op_increment
suffix:semicolon
id|endnum
op_increment
suffix:semicolon
id|lastblock
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|endnum
op_assign
id|startnum
op_assign
(paren
(paren
id|count
OG
l_int|2
)paren
ques
c_cond
l_int|2
suffix:colon
id|count
)paren
suffix:semicolon
multiline_comment|/* if the current extent is in position 0, swap it with the previous */
r_if
c_cond
(paren
op_logical_neg
id|c
op_logical_and
id|count
op_ne
l_int|1
)paren
(brace
id|laarr
(braket
l_int|2
)braket
op_assign
id|laarr
(braket
l_int|0
)braket
suffix:semicolon
id|laarr
(braket
l_int|0
)braket
op_assign
id|laarr
(braket
l_int|1
)braket
suffix:semicolon
id|laarr
(braket
l_int|1
)braket
op_assign
id|laarr
(braket
l_int|2
)braket
suffix:semicolon
id|c
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* if the current block is located in a extent, read the next extent */
r_if
c_cond
(paren
id|etype
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|etype
op_assign
id|udf_next_aext
c_func
(paren
id|inode
comma
op_amp
id|cbloc
comma
op_amp
id|nextoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|cbh
comma
l_int|0
)paren
)paren
op_ne
op_minus
l_int|1
)paren
(brace
id|laarr
(braket
id|c
op_plus
l_int|1
)braket
dot
id|extLength
op_assign
(paren
id|etype
op_lshift
l_int|30
)paren
op_or
id|elen
suffix:semicolon
id|laarr
(braket
id|c
op_plus
l_int|1
)braket
dot
id|extLocation
op_assign
id|eloc
suffix:semicolon
id|count
op_increment
suffix:semicolon
id|startnum
op_increment
suffix:semicolon
id|endnum
op_increment
suffix:semicolon
)brace
r_else
id|lastblock
op_assign
l_int|1
suffix:semicolon
)brace
id|udf_release_data
c_func
(paren
id|cbh
)paren
suffix:semicolon
multiline_comment|/* if the current extent is not recorded but allocated, get the&n;&t;&t;block in the extent corresponding to the requested block */
r_if
c_cond
(paren
(paren
id|laarr
(braket
id|c
)braket
dot
id|extLength
op_rshift
l_int|30
)paren
op_eq
id|EXTENT_NOT_RECORDED_ALLOCATED
)paren
id|newblocknum
op_assign
id|laarr
(braket
id|c
)braket
dot
id|extLocation.logicalBlockNum
op_plus
id|offset
suffix:semicolon
r_else
multiline_comment|/* otherwise, allocate a new block */
(brace
r_if
c_cond
(paren
id|UDF_I_NEXT_ALLOC_BLOCK
c_func
(paren
id|inode
)paren
op_eq
id|block
)paren
id|goal
op_assign
id|UDF_I_NEXT_ALLOC_GOAL
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|goal
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|goal
op_assign
id|pgoal
)paren
)paren
id|goal
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|logicalBlockNum
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|newblocknum
op_assign
id|udf_new_block
c_func
(paren
id|inode
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
comma
id|goal
comma
id|err
)paren
)paren
)paren
(brace
id|udf_release_data
c_func
(paren
id|pbh
)paren
suffix:semicolon
op_star
id|err
op_assign
op_minus
id|ENOSPC
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/* if the extent the requsted block is located in contains multiple blocks,&n;       split the extent into at most three extents. blocks prior to requested&n;       block, requested block, and blocks after requested block */
id|udf_split_extents
c_func
(paren
id|inode
comma
op_amp
id|c
comma
id|offset
comma
id|newblocknum
comma
id|laarr
comma
op_amp
id|endnum
)paren
suffix:semicolon
macro_line|#ifdef UDF_PREALLOCATE
multiline_comment|/* preallocate blocks */
id|udf_prealloc_extents
c_func
(paren
id|inode
comma
id|c
comma
id|lastblock
comma
id|laarr
comma
op_amp
id|endnum
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* merge any continuous blocks in laarr */
id|udf_merge_extents
c_func
(paren
id|inode
comma
id|laarr
comma
op_amp
id|endnum
)paren
suffix:semicolon
multiline_comment|/* write back the new extents, inserting new extents if the new number&n;       of extents is greater than the old number, and deleting extents if&n;       the new number of extents is less than the old number */
id|udf_update_extents
c_func
(paren
id|inode
comma
id|laarr
comma
id|startnum
comma
id|endnum
comma
id|pbloc
comma
id|pextoffset
comma
op_amp
id|pbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|pbh
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|newblock
op_assign
id|udf_get_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|newblocknum
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
comma
l_int|0
)paren
)paren
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|phys
op_assign
id|newblock
suffix:semicolon
op_star
id|err
op_assign
l_int|0
suffix:semicolon
op_star
r_new
op_assign
l_int|1
suffix:semicolon
id|UDF_I_NEXT_ALLOC_BLOCK
c_func
(paren
id|inode
)paren
op_assign
id|block
suffix:semicolon
id|UDF_I_NEXT_ALLOC_GOAL
c_func
(paren
id|inode
)paren
op_assign
id|newblocknum
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|inode
)paren
op_assign
id|CURRENT_UTIME
suffix:semicolon
id|inode-&gt;i_blocks
op_add_assign
id|inode-&gt;i_sb-&gt;s_blocksize
op_div
l_int|512
suffix:semicolon
r_if
c_cond
(paren
id|IS_SYNC
c_func
(paren
id|inode
)paren
)paren
id|udf_sync_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
r_else
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|udf_split_extents
r_static
r_void
id|udf_split_extents
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
op_star
id|c
comma
r_int
id|offset
comma
r_int
id|newblocknum
comma
id|long_ad
id|laarr
(braket
id|EXTENT_MERGE_SIZE
)braket
comma
r_int
op_star
id|endnum
)paren
(brace
r_if
c_cond
(paren
(paren
id|laarr
(braket
op_star
id|c
)braket
dot
id|extLength
op_rshift
l_int|30
)paren
op_eq
id|EXTENT_NOT_RECORDED_ALLOCATED
op_logical_or
(paren
id|laarr
(braket
op_star
id|c
)braket
dot
id|extLength
op_rshift
l_int|30
)paren
op_eq
id|EXTENT_NOT_RECORDED_NOT_ALLOCATED
)paren
(brace
r_int
id|curr
op_assign
op_star
id|c
suffix:semicolon
r_int
id|blen
op_assign
(paren
(paren
id|laarr
(braket
id|curr
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
suffix:semicolon
r_int
id|type
op_assign
id|laarr
(braket
id|curr
)braket
dot
id|extLength
op_amp
op_complement
id|UDF_EXTENT_LENGTH_MASK
suffix:semicolon
r_if
c_cond
(paren
id|blen
op_eq
l_int|1
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|offset
op_logical_or
id|blen
op_eq
id|offset
op_plus
l_int|1
)paren
(brace
id|laarr
(braket
id|curr
op_plus
l_int|2
)braket
op_assign
id|laarr
(braket
id|curr
op_plus
l_int|1
)braket
suffix:semicolon
id|laarr
(braket
id|curr
op_plus
l_int|1
)braket
op_assign
id|laarr
(braket
id|curr
)braket
suffix:semicolon
)brace
r_else
(brace
id|laarr
(braket
id|curr
op_plus
l_int|3
)braket
op_assign
id|laarr
(braket
id|curr
op_plus
l_int|1
)braket
suffix:semicolon
id|laarr
(braket
id|curr
op_plus
l_int|2
)braket
op_assign
id|laarr
(braket
id|curr
op_plus
l_int|1
)braket
op_assign
id|laarr
(braket
id|curr
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|offset
)paren
(brace
id|laarr
(braket
id|curr
)braket
dot
id|extLength
op_assign
id|type
op_or
(paren
id|offset
op_lshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
id|curr
op_increment
suffix:semicolon
(paren
op_star
id|c
)paren
op_increment
suffix:semicolon
(paren
op_star
id|endnum
)paren
op_increment
suffix:semicolon
)brace
id|laarr
(braket
id|curr
)braket
dot
id|extLocation.logicalBlockNum
op_assign
id|newblocknum
suffix:semicolon
r_if
c_cond
(paren
(paren
id|type
op_rshift
l_int|30
)paren
op_eq
id|EXTENT_NOT_RECORDED_NOT_ALLOCATED
)paren
id|laarr
(braket
id|curr
)braket
dot
id|extLocation.partitionReferenceNum
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
suffix:semicolon
id|laarr
(braket
id|curr
)braket
dot
id|extLength
op_assign
(paren
id|EXTENT_RECORDED_ALLOCATED
op_lshift
l_int|30
)paren
op_or
id|inode-&gt;i_sb-&gt;s_blocksize
suffix:semicolon
id|curr
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|blen
op_ne
id|offset
op_plus
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|type
op_rshift
l_int|30
)paren
op_eq
id|EXTENT_NOT_RECORDED_ALLOCATED
)paren
id|laarr
(braket
id|curr
)braket
dot
id|extLocation.logicalBlockNum
op_add_assign
(paren
id|offset
op_plus
l_int|1
)paren
suffix:semicolon
id|laarr
(braket
id|curr
)braket
dot
id|extLength
op_assign
id|type
op_or
(paren
(paren
id|blen
op_minus
(paren
id|offset
op_plus
l_int|1
)paren
)paren
op_lshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
id|curr
op_increment
suffix:semicolon
(paren
op_star
id|endnum
)paren
op_increment
suffix:semicolon
)brace
)brace
)brace
DECL|function|udf_prealloc_extents
r_static
r_void
id|udf_prealloc_extents
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|c
comma
r_int
id|lastblock
comma
id|long_ad
id|laarr
(braket
id|EXTENT_MERGE_SIZE
)braket
comma
r_int
op_star
id|endnum
)paren
(brace
r_int
id|start
comma
id|length
op_assign
l_int|0
comma
id|currlength
op_assign
l_int|0
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
op_star
id|endnum
op_ge
(paren
id|c
op_plus
l_int|1
)paren
op_logical_and
op_logical_neg
id|lastblock
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|laarr
(braket
id|c
op_plus
l_int|1
)braket
dot
id|extLength
op_rshift
l_int|30
)paren
op_eq
id|EXTENT_NOT_RECORDED_ALLOCATED
)paren
(brace
id|start
op_assign
id|c
op_plus
l_int|1
suffix:semicolon
id|length
op_assign
id|currlength
op_assign
(paren
(paren
(paren
id|laarr
(braket
id|c
op_plus
l_int|1
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
)brace
r_else
id|start
op_assign
id|c
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|start
op_plus
l_int|1
suffix:semicolon
id|i
op_le
op_star
id|endnum
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
op_star
id|endnum
)paren
(brace
r_if
c_cond
(paren
id|lastblock
)paren
id|length
op_add_assign
id|UDF_DEFAULT_PREALLOC_BLOCKS
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_rshift
l_int|30
)paren
op_eq
id|EXTENT_NOT_RECORDED_NOT_ALLOCATED
)paren
id|length
op_add_assign
(paren
(paren
(paren
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|length
)paren
(brace
r_int
id|next
op_assign
id|laarr
(braket
id|start
)braket
dot
id|extLocation.logicalBlockNum
op_plus
(paren
(paren
(paren
id|laarr
(braket
id|start
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
r_int
id|numalloc
op_assign
id|udf_prealloc_blocks
c_func
(paren
id|inode
comma
id|laarr
(braket
id|start
)braket
dot
id|extLocation.partitionReferenceNum
comma
id|next
comma
(paren
id|UDF_DEFAULT_PREALLOC_BLOCKS
OG
id|length
ques
c_cond
id|length
suffix:colon
id|UDF_DEFAULT_PREALLOC_BLOCKS
)paren
op_minus
id|currlength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|numalloc
)paren
(brace
r_if
c_cond
(paren
id|start
op_eq
(paren
id|c
op_plus
l_int|1
)paren
)paren
id|laarr
(braket
id|start
)braket
dot
id|extLength
op_add_assign
(paren
id|numalloc
op_lshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
r_else
(brace
id|memmove
c_func
(paren
op_amp
id|laarr
(braket
id|c
op_plus
l_int|2
)braket
comma
op_amp
id|laarr
(braket
id|c
op_plus
l_int|1
)braket
comma
r_sizeof
(paren
id|long_ad
)paren
op_star
(paren
op_star
id|endnum
op_minus
(paren
id|c
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
(paren
op_star
id|endnum
)paren
op_increment
suffix:semicolon
id|laarr
(braket
id|c
op_plus
l_int|1
)braket
dot
id|extLocation.logicalBlockNum
op_assign
id|next
suffix:semicolon
id|laarr
(braket
id|c
op_plus
l_int|1
)braket
dot
id|extLocation.partitionReferenceNum
op_assign
id|laarr
(braket
id|c
)braket
dot
id|extLocation.partitionReferenceNum
suffix:semicolon
id|laarr
(braket
id|c
op_plus
l_int|1
)braket
dot
id|extLength
op_assign
(paren
id|EXTENT_NOT_RECORDED_ALLOCATED
op_lshift
l_int|30
)paren
op_or
(paren
id|numalloc
op_lshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
id|start
op_assign
id|c
op_plus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|start
op_plus
l_int|1
suffix:semicolon
id|numalloc
op_logical_and
id|i
OL
op_star
id|endnum
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|elen
op_assign
(paren
(paren
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
suffix:semicolon
r_if
c_cond
(paren
id|elen
OG
id|numalloc
)paren
(brace
id|laarr
(braket
id|c
op_plus
l_int|1
)braket
dot
id|extLength
op_sub_assign
(paren
id|numalloc
op_lshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
id|numalloc
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|numalloc
op_sub_assign
id|elen
suffix:semicolon
r_if
c_cond
(paren
op_star
id|endnum
OG
(paren
id|i
op_plus
l_int|1
)paren
)paren
id|memmove
c_func
(paren
op_amp
id|laarr
(braket
id|i
)braket
comma
op_amp
id|laarr
(braket
id|i
op_plus
l_int|1
)braket
comma
r_sizeof
(paren
id|long_ad
)paren
op_star
(paren
op_star
id|endnum
op_minus
(paren
id|i
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|i
op_decrement
suffix:semicolon
(paren
op_star
id|endnum
)paren
op_decrement
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|function|udf_merge_extents
r_static
r_void
id|udf_merge_extents
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|long_ad
id|laarr
(braket
id|EXTENT_MERGE_SIZE
)braket
comma
r_int
op_star
id|endnum
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
op_star
id|endnum
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_rshift
l_int|30
)paren
op_eq
(paren
id|laarr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|extLength
op_rshift
l_int|30
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_rshift
l_int|30
)paren
op_eq
id|EXTENT_NOT_RECORDED_NOT_ALLOCATED
)paren
op_logical_or
(paren
(paren
id|laarr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|extLocation.logicalBlockNum
op_minus
id|laarr
(braket
id|i
)braket
dot
id|extLocation.logicalBlockNum
)paren
op_eq
(paren
(paren
(paren
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
(paren
id|laarr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_amp
op_complement
id|UDF_EXTENT_LENGTH_MASK
)paren
(brace
id|laarr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|extLength
op_assign
(paren
id|laarr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|extLength
op_minus
(paren
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
id|UDF_EXTENT_LENGTH_MASK
)paren
op_amp
op_complement
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
suffix:semicolon
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_assign
(paren
id|UDF_EXTENT_LENGTH_MASK
op_plus
l_int|1
)paren
op_minus
id|inode-&gt;i_sb-&gt;s_blocksize
suffix:semicolon
id|laarr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|extLocation.logicalBlockNum
op_assign
id|laarr
(braket
id|i
)braket
dot
id|extLocation.logicalBlockNum
op_plus
(paren
(paren
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
)brace
r_else
(brace
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_assign
id|laarr
(braket
id|i
op_plus
l_int|1
)braket
dot
id|extLength
op_plus
(paren
(paren
(paren
id|laarr
(braket
id|i
)braket
dot
id|extLength
op_amp
id|UDF_EXTENT_LENGTH_MASK
)paren
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_amp
op_complement
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|endnum
OG
(paren
id|i
op_plus
l_int|2
)paren
)paren
id|memmove
c_func
(paren
op_amp
id|laarr
(braket
id|i
op_plus
l_int|1
)braket
comma
op_amp
id|laarr
(braket
id|i
op_plus
l_int|2
)braket
comma
r_sizeof
(paren
id|long_ad
)paren
op_star
(paren
op_star
id|endnum
op_minus
(paren
id|i
op_plus
l_int|2
)paren
)paren
)paren
suffix:semicolon
id|i
op_decrement
suffix:semicolon
(paren
op_star
id|endnum
)paren
op_decrement
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|function|udf_update_extents
r_static
r_void
id|udf_update_extents
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|long_ad
id|laarr
(braket
id|EXTENT_MERGE_SIZE
)braket
comma
r_int
id|startnum
comma
r_int
id|endnum
comma
id|lb_addr
id|pbloc
comma
id|Uint32
id|pextoffset
comma
r_struct
id|buffer_head
op_star
op_star
id|pbh
)paren
(brace
r_int
id|start
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|lb_addr
id|tmploc
suffix:semicolon
id|Uint32
id|tmplen
suffix:semicolon
r_if
c_cond
(paren
id|startnum
OG
id|endnum
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|startnum
op_minus
id|endnum
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udf_delete_aext
c_func
(paren
id|inode
comma
id|pbloc
comma
id|pextoffset
comma
id|laarr
(braket
id|i
)braket
dot
id|extLocation
comma
id|laarr
(braket
id|i
)braket
dot
id|extLength
comma
op_star
id|pbh
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|startnum
OL
id|endnum
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|endnum
op_minus
id|startnum
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udf_insert_aext
c_func
(paren
id|inode
comma
id|pbloc
comma
id|pextoffset
comma
id|laarr
(braket
id|i
)braket
dot
id|extLocation
comma
id|laarr
(braket
id|i
)braket
dot
id|extLength
comma
op_star
id|pbh
)paren
suffix:semicolon
id|udf_next_aext
c_func
(paren
id|inode
comma
op_amp
id|pbloc
comma
op_amp
id|pextoffset
comma
op_amp
id|laarr
(braket
id|i
)braket
dot
id|extLocation
comma
op_amp
id|laarr
(braket
id|i
)braket
dot
id|extLength
comma
id|pbh
comma
l_int|1
)paren
suffix:semicolon
id|start
op_increment
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
id|start
suffix:semicolon
id|i
OL
id|endnum
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udf_next_aext
c_func
(paren
id|inode
comma
op_amp
id|pbloc
comma
op_amp
id|pextoffset
comma
op_amp
id|tmploc
comma
op_amp
id|tmplen
comma
id|pbh
comma
l_int|0
)paren
suffix:semicolon
id|udf_write_aext
c_func
(paren
id|inode
comma
id|pbloc
comma
op_amp
id|pextoffset
comma
id|laarr
(braket
id|i
)braket
dot
id|extLocation
comma
id|laarr
(braket
id|i
)braket
dot
id|extLength
comma
id|pbh
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|udf_bread
r_struct
id|buffer_head
op_star
id|udf_bread
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|block
comma
r_int
id|create
comma
r_int
op_star
id|err
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_int
id|prev_blocks
suffix:semicolon
id|prev_blocks
op_assign
id|inode-&gt;i_blocks
suffix:semicolon
id|bh
op_assign
id|udf_getblk
c_func
(paren
id|inode
comma
id|block
comma
id|create
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
r_return
l_int|NULL
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|create
op_logical_and
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
op_logical_and
id|inode-&gt;i_blocks
OG
id|prev_blocks
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|buffer_head
op_star
id|tmp_bh
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|UDF_DEFAULT_PREALLOC_DIR_BLOCKS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmp_bh
op_assign
id|udf_getblk
c_func
(paren
id|inode
comma
id|block
op_plus
id|i
comma
id|create
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tmp_bh
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|udf_release_data
c_func
(paren
id|tmp_bh
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|buffer_uptodate
c_func
(paren
id|bh
)paren
)paren
r_return
id|bh
suffix:semicolon
id|ll_rw_block
c_func
(paren
id|READ
comma
l_int|1
comma
op_amp
id|bh
)paren
suffix:semicolon
id|wait_on_buffer
c_func
(paren
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buffer_uptodate
c_func
(paren
id|bh
)paren
)paren
r_return
id|bh
suffix:semicolon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
op_star
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_read_inode&n; *&n; * PURPOSE&n; *&t;Read an inode.&n; *&n; * DESCRIPTION&n; *&t;This routine is called by iget() [which is called by udf_iget()]&n; *      (clean_inode() will have been called first)&n; *&t;when an inode is first read into memory.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; *&n; * 12/19/98 dgb  Updated to fix size problems.&n; */
r_void
DECL|function|udf_read_inode
id|udf_read_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|memset
c_func
(paren
op_amp
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
l_int|0xFF
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|__udf_read_inode
id|__udf_read_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|FileEntry
op_star
id|fe
suffix:semicolon
id|Uint16
id|ident
suffix:semicolon
multiline_comment|/*&n;&t; * Set defaults, but the inode is still incomplete!&n;&t; * Note: get_new_inode() sets the following on a new inode:&n;&t; *      i_sb = sb&n;&t; *      i_dev = sb-&gt;s_dev;&n;&t; *      i_no = ino&n;&t; *      i_flags = sb-&gt;s_flags&n;&t; *      i_state = 0&n;&t; * clean_inode(): zero fills and sets&n;&t; *      i_count = 1&n;&t; *      i_nlink = 1&n;&t; *      i_op = NULL;&n;&t; */
id|inode-&gt;i_blksize
op_assign
id|PAGE_SIZE
suffix:semicolon
id|bh
op_assign
id|udf_read_ptagged
c_func
(paren
id|inode-&gt;i_sb
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
l_int|0
comma
op_amp
id|ident
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: udf_read_inode(ino %ld) failed !bh&bslash;n&quot;
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
id|make_bad_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ident
op_ne
id|TID_FILE_ENTRY
op_logical_and
id|ident
op_ne
id|TID_EXTENDED_FILE_ENTRY
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: udf_read_inode(ino %ld) failed ident=%d&bslash;n&quot;
comma
id|inode-&gt;i_ino
comma
id|ident
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|make_bad_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|fe
op_assign
(paren
r_struct
id|FileEntry
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|fe-&gt;icbTag.strategyType
)paren
op_eq
l_int|4096
)paren
(brace
r_struct
id|buffer_head
op_star
id|ibh
op_assign
l_int|NULL
comma
op_star
id|nbh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|IndirectEntry
op_star
id|ie
suffix:semicolon
id|ibh
op_assign
id|udf_read_ptagged
c_func
(paren
id|inode-&gt;i_sb
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
l_int|1
comma
op_amp
id|ident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ident
op_eq
id|TID_INDIRECT_ENTRY
)paren
(brace
r_if
c_cond
(paren
id|ibh
)paren
(brace
id|lb_addr
id|loc
suffix:semicolon
id|ie
op_assign
(paren
r_struct
id|IndirectEntry
op_star
)paren
id|ibh-&gt;b_data
suffix:semicolon
id|loc
op_assign
id|lelb_to_cpu
c_func
(paren
id|ie-&gt;indirectICB.extLocation
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ie-&gt;indirectICB.extLength
op_logical_and
(paren
id|nbh
op_assign
id|udf_read_ptagged
c_func
(paren
id|inode-&gt;i_sb
comma
id|loc
comma
l_int|0
comma
op_amp
id|ident
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ident
op_eq
id|TID_FILE_ENTRY
op_logical_or
id|ident
op_eq
id|TID_EXTENDED_FILE_ENTRY
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
op_amp
id|loc
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|ibh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|nbh
)paren
suffix:semicolon
id|__udf_read_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|udf_release_data
c_func
(paren
id|nbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|ibh
)paren
suffix:semicolon
)brace
)brace
r_else
id|udf_release_data
c_func
(paren
id|ibh
)paren
suffix:semicolon
)brace
)brace
r_else
id|udf_release_data
c_func
(paren
id|ibh
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|fe-&gt;icbTag.strategyType
)paren
op_ne
l_int|4
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: unsupported strategy type: %d&bslash;n&quot;
comma
id|le16_to_cpu
c_func
(paren
id|fe-&gt;icbTag.strategyType
)paren
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|make_bad_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|udf_fill_inode
c_func
(paren
id|inode
comma
id|bh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
DECL|function|udf_fill_inode
r_static
r_void
id|udf_fill_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|buffer_head
op_star
id|bh
)paren
(brace
r_struct
id|FileEntry
op_star
id|fe
suffix:semicolon
r_struct
id|ExtendedFileEntry
op_star
id|efe
suffix:semicolon
id|time_t
id|convtime
suffix:semicolon
r_int
id|convtime_usec
suffix:semicolon
r_int
id|offset
comma
id|alen
suffix:semicolon
id|inode-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
id|UDF_I_NEW_INODE
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
id|fe
op_assign
(paren
r_struct
id|FileEntry
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
id|efe
op_assign
(paren
r_struct
id|ExtendedFileEntry
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;descTag.tagIdent
op_eq
id|TID_EXTENDED_FILE_ENTRY
)paren
id|UDF_I_EXTENDED_FE
c_func
(paren
id|inode
)paren
op_assign
l_int|1
suffix:semicolon
r_else
multiline_comment|/* fe-&gt;descTag.tagIdent == TID_FILE_ENTRY */
id|UDF_I_EXTENDED_FE
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|fe-&gt;icbTag.strategyType
)paren
op_eq
l_int|4
)paren
id|UDF_I_STRAT4096
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
r_else
multiline_comment|/* if (le16_to_cpu(fe-&gt;icbTag.strategyType) == 4096) */
id|UDF_I_STRAT4096
c_func
(paren
id|inode
)paren
op_assign
l_int|1
suffix:semicolon
id|inode-&gt;i_uid
op_assign
id|le32_to_cpu
c_func
(paren
id|fe-&gt;uid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_uid
op_eq
op_minus
l_int|1
)paren
id|inode-&gt;i_uid
op_assign
id|UDF_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_uid
suffix:semicolon
id|inode-&gt;i_gid
op_assign
id|le32_to_cpu
c_func
(paren
id|fe-&gt;gid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_gid
op_eq
op_minus
l_int|1
)paren
id|inode-&gt;i_gid
op_assign
id|UDF_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_gid
suffix:semicolon
id|inode-&gt;i_nlink
op_assign
id|le16_to_cpu
c_func
(paren
id|fe-&gt;fileLinkCount
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode-&gt;i_nlink
)paren
id|inode-&gt;i_nlink
op_assign
l_int|1
suffix:semicolon
id|inode-&gt;i_size
op_assign
id|le64_to_cpu
c_func
(paren
id|fe-&gt;informationLength
)paren
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|udf_convert_permissions
c_func
(paren
id|fe
)paren
suffix:semicolon
id|inode-&gt;i_mode
op_and_assign
op_complement
id|UDF_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_umask
suffix:semicolon
id|UDF_I_NEXT_ALLOC_BLOCK
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
id|UDF_I_NEXT_ALLOC_GOAL
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_assign
id|le16_to_cpu
c_func
(paren
id|fe-&gt;icbTag.flags
)paren
op_amp
id|ICB_FLAG_ALLOC_MASK
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_EXTENDED_FE
c_func
(paren
id|inode
)paren
op_eq
l_int|0
)paren
(brace
id|inode-&gt;i_blocks
op_assign
id|le64_to_cpu
c_func
(paren
id|fe-&gt;logicalBlocksRecorded
)paren
op_lshift
(paren
id|inode-&gt;i_sb-&gt;s_blocksize_bits
op_minus
l_int|9
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udf_stamp_to_time
c_func
(paren
op_amp
id|convtime
comma
op_amp
id|convtime_usec
comma
id|lets_to_cpu
c_func
(paren
id|fe-&gt;modificationTime
)paren
)paren
)paren
(brace
id|inode-&gt;i_mtime
op_assign
id|convtime
suffix:semicolon
id|UDF_I_UMTIME
c_func
(paren
id|inode
)paren
op_assign
id|convtime_usec
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|convtime
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|inode
)paren
op_assign
id|convtime_usec
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_mtime
op_assign
id|UDF_SB_RECORDTIME
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|UDF_I_UMTIME
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|UDF_SB_RECORDTIME
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|udf_stamp_to_time
c_func
(paren
op_amp
id|convtime
comma
op_amp
id|convtime_usec
comma
id|lets_to_cpu
c_func
(paren
id|fe-&gt;accessTime
)paren
)paren
)paren
(brace
id|inode-&gt;i_atime
op_assign
id|convtime
suffix:semicolon
id|UDF_I_UATIME
c_func
(paren
id|inode
)paren
op_assign
id|convtime_usec
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_atime
op_assign
id|UDF_SB_RECORDTIME
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|UDF_I_UATIME
c_func
(paren
id|inode
)paren
op_assign
id|convtime_usec
suffix:semicolon
)brace
id|UDF_I_UNIQUE
c_func
(paren
id|inode
)paren
op_assign
id|le64_to_cpu
c_func
(paren
id|fe-&gt;uniqueID
)paren
suffix:semicolon
id|UDF_I_LENEATTR
c_func
(paren
id|inode
)paren
op_assign
id|le32_to_cpu
c_func
(paren
id|fe-&gt;lengthExtendedAttr
)paren
suffix:semicolon
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_assign
id|le32_to_cpu
c_func
(paren
id|fe-&gt;lengthAllocDescs
)paren
suffix:semicolon
id|offset
op_assign
r_sizeof
(paren
r_struct
id|FileEntry
)paren
op_plus
id|UDF_I_LENEATTR
c_func
(paren
id|inode
)paren
suffix:semicolon
id|alen
op_assign
id|offset
op_plus
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_blocks
op_assign
id|le64_to_cpu
c_func
(paren
id|efe-&gt;logicalBlocksRecorded
)paren
op_lshift
(paren
id|inode-&gt;i_sb-&gt;s_blocksize_bits
op_minus
l_int|9
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udf_stamp_to_time
c_func
(paren
op_amp
id|convtime
comma
op_amp
id|convtime_usec
comma
id|lets_to_cpu
c_func
(paren
id|efe-&gt;modificationTime
)paren
)paren
)paren
(brace
id|inode-&gt;i_mtime
op_assign
id|convtime
suffix:semicolon
id|UDF_I_UMTIME
c_func
(paren
id|inode
)paren
op_assign
id|convtime_usec
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_mtime
op_assign
id|UDF_SB_RECORDTIME
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|UDF_I_UMTIME
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|udf_stamp_to_time
c_func
(paren
op_amp
id|convtime
comma
op_amp
id|convtime_usec
comma
id|lets_to_cpu
c_func
(paren
id|efe-&gt;accessTime
)paren
)paren
)paren
(brace
id|inode-&gt;i_atime
op_assign
id|convtime
suffix:semicolon
id|UDF_I_UATIME
c_func
(paren
id|inode
)paren
op_assign
id|convtime_usec
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_atime
op_assign
id|UDF_SB_RECORDTIME
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|UDF_I_UATIME
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|udf_stamp_to_time
c_func
(paren
op_amp
id|convtime
comma
op_amp
id|convtime_usec
comma
id|lets_to_cpu
c_func
(paren
id|efe-&gt;createTime
)paren
)paren
)paren
(brace
id|inode-&gt;i_ctime
op_assign
id|convtime
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|inode
)paren
op_assign
id|convtime_usec
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_ctime
op_assign
id|UDF_SB_RECORDTIME
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
)brace
id|UDF_I_UNIQUE
c_func
(paren
id|inode
)paren
op_assign
id|le64_to_cpu
c_func
(paren
id|efe-&gt;uniqueID
)paren
suffix:semicolon
id|UDF_I_LENEATTR
c_func
(paren
id|inode
)paren
op_assign
id|le32_to_cpu
c_func
(paren
id|efe-&gt;lengthExtendedAttr
)paren
suffix:semicolon
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_assign
id|le32_to_cpu
c_func
(paren
id|efe-&gt;lengthAllocDescs
)paren
suffix:semicolon
id|offset
op_assign
r_sizeof
(paren
r_struct
id|ExtendedFileEntry
)paren
op_plus
id|UDF_I_LENEATTR
c_func
(paren
id|inode
)paren
suffix:semicolon
id|alen
op_assign
id|offset
op_plus
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|fe-&gt;icbTag.fileType
)paren
(brace
r_case
id|FILE_TYPE_DIRECTORY
suffix:colon
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|udf_dir_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|udf_dir_operations
suffix:semicolon
id|inode-&gt;i_mode
op_or_assign
id|S_IFDIR
suffix:semicolon
id|inode-&gt;i_nlink
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FILE_TYPE_REGULAR
suffix:colon
r_case
id|FILE_TYPE_NONE
suffix:colon
(brace
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
)paren
id|inode-&gt;i_data.a_ops
op_assign
op_amp
id|udf_adinicb_aops
suffix:semicolon
r_else
id|inode-&gt;i_data.a_ops
op_assign
op_amp
id|udf_aops
suffix:semicolon
id|inode-&gt;i_op
op_assign
op_amp
id|udf_file_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|udf_file_operations
suffix:semicolon
id|inode-&gt;i_mode
op_or_assign
id|S_IFREG
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FILE_TYPE_BLOCK
suffix:colon
(brace
id|inode-&gt;i_mode
op_or_assign
id|S_IFBLK
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FILE_TYPE_CHAR
suffix:colon
(brace
id|inode-&gt;i_mode
op_or_assign
id|S_IFCHR
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FILE_TYPE_FIFO
suffix:colon
(brace
id|init_special_inode
c_func
(paren
id|inode
comma
id|inode-&gt;i_mode
op_or
id|S_IFIFO
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FILE_TYPE_SYMLINK
suffix:colon
(brace
id|inode-&gt;i_data.a_ops
op_assign
op_amp
id|udf_symlink_aops
suffix:semicolon
id|inode-&gt;i_op
op_assign
op_amp
id|page_symlink_inode_operations
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|S_IFLNK
op_or
id|S_IRWXUGO
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: udf_fill_inode(ino %ld) failed unknown file type=%d&bslash;n&quot;
comma
id|inode-&gt;i_ino
comma
id|fe-&gt;icbTag.fileType
)paren
suffix:semicolon
id|make_bad_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|S_ISCHR
c_func
(paren
id|inode-&gt;i_mode
)paren
op_logical_or
id|S_ISBLK
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
r_struct
id|buffer_head
op_star
id|tbh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|DeviceSpecificationExtendedAttr
op_star
id|dsea
op_assign
(paren
r_struct
id|DeviceSpecificationExtendedAttr
op_star
)paren
id|udf_get_extendedattr
c_func
(paren
id|inode
comma
l_int|12
comma
l_int|1
comma
op_amp
id|tbh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dsea
)paren
(brace
id|init_special_inode
c_func
(paren
id|inode
comma
id|inode-&gt;i_mode
comma
(paren
(paren
id|le32_to_cpu
c_func
(paren
id|dsea-&gt;majorDeviceIdent
)paren
)paren
op_lshift
l_int|8
)paren
op_or
(paren
id|le32_to_cpu
c_func
(paren
id|dsea-&gt;minorDeviceIdent
)paren
op_amp
l_int|0xFF
)paren
)paren
suffix:semicolon
multiline_comment|/* Developer ID ??? */
id|udf_release_data
c_func
(paren
id|tbh
)paren
suffix:semicolon
)brace
r_else
(brace
id|make_bad_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
id|mode_t
DECL|function|udf_convert_permissions
id|udf_convert_permissions
c_func
(paren
r_struct
id|FileEntry
op_star
id|fe
)paren
(brace
id|mode_t
id|mode
suffix:semicolon
id|Uint32
id|permissions
suffix:semicolon
id|Uint32
id|flags
suffix:semicolon
id|permissions
op_assign
id|le32_to_cpu
c_func
(paren
id|fe-&gt;permissions
)paren
suffix:semicolon
id|flags
op_assign
id|le16_to_cpu
c_func
(paren
id|fe-&gt;icbTag.flags
)paren
suffix:semicolon
id|mode
op_assign
(paren
(paren
id|permissions
)paren
op_amp
id|S_IRWXO
)paren
op_or
(paren
(paren
id|permissions
op_rshift
l_int|2
)paren
op_amp
id|S_IRWXG
)paren
op_or
(paren
(paren
id|permissions
op_rshift
l_int|4
)paren
op_amp
id|S_IRWXU
)paren
op_or
(paren
(paren
id|flags
op_amp
id|ICB_FLAG_SETUID
)paren
ques
c_cond
id|S_ISUID
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|flags
op_amp
id|ICB_FLAG_SETGID
)paren
ques
c_cond
id|S_ISGID
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|flags
op_amp
id|ICB_FLAG_STICKY
)paren
ques
c_cond
id|S_ISVTX
suffix:colon
l_int|0
)paren
suffix:semicolon
r_return
id|mode
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_write_inode&n; *&n; * PURPOSE&n; *&t;Write out the specified inode.&n; *&n; * DESCRIPTION&n; *&t;This routine is called whenever an inode is synced.&n; *&t;Currently this routine is just a placeholder.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
DECL|function|udf_write_inode
r_void
id|udf_write_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|sync
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|udf_update_inode
c_func
(paren
id|inode
comma
id|sync
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|udf_sync_inode
r_int
id|udf_sync_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_return
id|udf_update_inode
c_func
(paren
id|inode
comma
l_int|1
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|udf_update_inode
id|udf_update_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|do_sync
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|FileEntry
op_star
id|fe
suffix:semicolon
r_struct
id|ExtendedFileEntry
op_star
id|efe
suffix:semicolon
id|Uint32
id|udfperms
suffix:semicolon
id|Uint16
id|icbflags
suffix:semicolon
id|Uint16
id|crclen
suffix:semicolon
r_int
id|i
suffix:semicolon
id|timestamp
id|cpu_time
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|bh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
l_int|0
)paren
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;bread failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|fe
op_assign
(paren
r_struct
id|FileEntry
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
id|efe
op_assign
(paren
r_struct
id|ExtendedFileEntry
op_star
)paren
id|bh-&gt;b_data
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_NEW_INODE
c_func
(paren
id|inode
)paren
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|UDF_I_EXTENDED_FE
c_func
(paren
id|inode
)paren
op_eq
l_int|0
)paren
id|memset
c_func
(paren
id|bh-&gt;b_data
comma
l_int|0x0
comma
r_sizeof
(paren
r_struct
id|FileEntry
)paren
)paren
suffix:semicolon
r_else
id|memset
c_func
(paren
id|bh-&gt;b_data
comma
l_int|0x00
comma
r_sizeof
(paren
r_struct
id|ExtendedFileEntry
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|bh-&gt;b_data
op_plus
id|udf_file_entry_alloc_offset
c_func
(paren
id|inode
)paren
op_plus
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
comma
l_int|0x0
comma
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
id|udf_file_entry_alloc_offset
c_func
(paren
id|inode
)paren
op_minus
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|UDF_I_NEW_INODE
c_func
(paren
id|inode
)paren
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inode-&gt;i_uid
op_ne
id|UDF_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_uid
)paren
id|fe-&gt;uid
op_assign
id|cpu_to_le32
c_func
(paren
id|inode-&gt;i_uid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_gid
op_ne
id|UDF_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_gid
)paren
id|fe-&gt;gid
op_assign
id|cpu_to_le32
c_func
(paren
id|inode-&gt;i_gid
)paren
suffix:semicolon
id|udfperms
op_assign
(paren
(paren
id|inode-&gt;i_mode
op_amp
id|S_IRWXO
)paren
)paren
op_or
(paren
(paren
id|inode-&gt;i_mode
op_amp
id|S_IRWXG
)paren
op_lshift
l_int|2
)paren
op_or
(paren
(paren
id|inode-&gt;i_mode
op_amp
id|S_IRWXU
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|udfperms
op_or_assign
(paren
id|le32_to_cpu
c_func
(paren
id|fe-&gt;permissions
)paren
op_amp
(paren
id|PERM_O_DELETE
op_or
id|PERM_O_CHATTR
op_or
id|PERM_G_DELETE
op_or
id|PERM_G_CHATTR
op_or
id|PERM_U_DELETE
op_or
id|PERM_U_CHATTR
)paren
)paren
suffix:semicolon
id|fe-&gt;permissions
op_assign
id|cpu_to_le32
c_func
(paren
id|udfperms
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
id|fe-&gt;fileLinkCount
op_assign
id|cpu_to_le16
c_func
(paren
id|inode-&gt;i_nlink
op_minus
l_int|1
)paren
suffix:semicolon
r_else
id|fe-&gt;fileLinkCount
op_assign
id|cpu_to_le16
c_func
(paren
id|inode-&gt;i_nlink
)paren
suffix:semicolon
id|fe-&gt;informationLength
op_assign
id|cpu_to_le64
c_func
(paren
id|inode-&gt;i_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISCHR
c_func
(paren
id|inode-&gt;i_mode
)paren
op_logical_or
id|S_ISBLK
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
id|EntityID
op_star
id|eid
suffix:semicolon
r_struct
id|buffer_head
op_star
id|tbh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|DeviceSpecificationExtendedAttr
op_star
id|dsea
op_assign
(paren
r_struct
id|DeviceSpecificationExtendedAttr
op_star
)paren
id|udf_get_extendedattr
c_func
(paren
id|inode
comma
l_int|12
comma
l_int|1
comma
op_amp
id|tbh
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dsea
)paren
(brace
id|dsea
op_assign
(paren
r_struct
id|DeviceSpecificationExtendedAttr
op_star
)paren
id|udf_add_extendedattr
c_func
(paren
id|inode
comma
r_sizeof
(paren
r_struct
id|DeviceSpecificationExtendedAttr
)paren
op_plus
r_sizeof
(paren
id|EntityID
)paren
comma
l_int|12
comma
l_int|0x3
comma
op_amp
id|tbh
)paren
suffix:semicolon
id|dsea-&gt;attrType
op_assign
l_int|12
suffix:semicolon
id|dsea-&gt;attrSubtype
op_assign
l_int|1
suffix:semicolon
id|dsea-&gt;attrLength
op_assign
r_sizeof
(paren
r_struct
id|DeviceSpecificationExtendedAttr
)paren
op_plus
r_sizeof
(paren
id|EntityID
)paren
suffix:semicolon
id|dsea-&gt;impUseLength
op_assign
r_sizeof
(paren
id|EntityID
)paren
suffix:semicolon
)brace
id|eid
op_assign
(paren
id|EntityID
op_star
)paren
id|dsea-&gt;impUse
suffix:semicolon
id|memset
c_func
(paren
id|eid
comma
l_int|0
comma
r_sizeof
(paren
id|EntityID
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|eid-&gt;ident
comma
id|UDF_ID_DEVELOPER
)paren
suffix:semicolon
id|eid-&gt;identSuffix
(braket
l_int|0
)braket
op_assign
id|UDF_OS_CLASS_UNIX
suffix:semicolon
id|eid-&gt;identSuffix
(braket
l_int|1
)braket
op_assign
id|UDF_OS_ID_LINUX
suffix:semicolon
id|dsea-&gt;majorDeviceIdent
op_assign
id|kdev_t_to_nr
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_rshift
l_int|8
suffix:semicolon
id|dsea-&gt;minorDeviceIdent
op_assign
id|kdev_t_to_nr
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_amp
l_int|0xFF
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|tbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|tbh
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|UDF_I_EXTENDED_FE
c_func
(paren
id|inode
)paren
op_eq
l_int|0
)paren
(brace
id|fe-&gt;logicalBlocksRecorded
op_assign
id|cpu_to_le64
c_func
(paren
(paren
id|inode-&gt;i_blocks
op_plus
(paren
l_int|1
op_lshift
(paren
id|inode-&gt;i_sb-&gt;s_blocksize_bits
op_minus
l_int|9
)paren
)paren
op_minus
l_int|1
)paren
op_rshift
(paren
id|inode-&gt;i_sb-&gt;s_blocksize_bits
op_minus
l_int|9
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udf_time_to_stamp
c_func
(paren
op_amp
id|cpu_time
comma
id|inode-&gt;i_atime
comma
id|UDF_I_UATIME
c_func
(paren
id|inode
)paren
)paren
)paren
id|fe-&gt;accessTime
op_assign
id|cpu_to_lets
c_func
(paren
id|cpu_time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udf_time_to_stamp
c_func
(paren
op_amp
id|cpu_time
comma
id|inode-&gt;i_mtime
comma
id|UDF_I_UMTIME
c_func
(paren
id|inode
)paren
)paren
)paren
id|fe-&gt;modificationTime
op_assign
id|cpu_to_lets
c_func
(paren
id|cpu_time
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
(paren
id|fe-&gt;impIdent
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|EntityID
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|fe-&gt;impIdent.ident
comma
id|UDF_ID_DEVELOPER
)paren
suffix:semicolon
id|fe-&gt;impIdent.identSuffix
(braket
l_int|0
)braket
op_assign
id|UDF_OS_CLASS_UNIX
suffix:semicolon
id|fe-&gt;impIdent.identSuffix
(braket
l_int|1
)braket
op_assign
id|UDF_OS_ID_LINUX
suffix:semicolon
id|fe-&gt;uniqueID
op_assign
id|cpu_to_le64
c_func
(paren
id|UDF_I_UNIQUE
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|fe-&gt;lengthExtendedAttr
op_assign
id|cpu_to_le32
c_func
(paren
id|UDF_I_LENEATTR
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|fe-&gt;lengthAllocDescs
op_assign
id|cpu_to_le32
c_func
(paren
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|fe-&gt;descTag.tagIdent
op_assign
id|le16_to_cpu
c_func
(paren
id|TID_FILE_ENTRY
)paren
suffix:semicolon
id|crclen
op_assign
r_sizeof
(paren
r_struct
id|FileEntry
)paren
suffix:semicolon
)brace
r_else
(brace
id|efe-&gt;logicalBlocksRecorded
op_assign
id|cpu_to_le64
c_func
(paren
(paren
id|inode-&gt;i_blocks
op_plus
(paren
l_int|2
op_lshift
(paren
id|inode-&gt;i_sb-&gt;s_blocksize_bits
op_minus
l_int|9
)paren
)paren
op_minus
l_int|1
)paren
op_rshift
(paren
id|inode-&gt;i_sb-&gt;s_blocksize_bits
op_minus
l_int|9
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udf_time_to_stamp
c_func
(paren
op_amp
id|cpu_time
comma
id|inode-&gt;i_atime
comma
id|UDF_I_UATIME
c_func
(paren
id|inode
)paren
)paren
)paren
id|efe-&gt;accessTime
op_assign
id|cpu_to_lets
c_func
(paren
id|cpu_time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udf_time_to_stamp
c_func
(paren
op_amp
id|cpu_time
comma
id|inode-&gt;i_mtime
comma
id|UDF_I_UMTIME
c_func
(paren
id|inode
)paren
)paren
)paren
id|efe-&gt;modificationTime
op_assign
id|cpu_to_lets
c_func
(paren
id|cpu_time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udf_time_to_stamp
c_func
(paren
op_amp
id|cpu_time
comma
id|inode-&gt;i_ctime
comma
id|UDF_I_UCTIME
c_func
(paren
id|inode
)paren
)paren
)paren
id|efe-&gt;createTime
op_assign
id|cpu_to_lets
c_func
(paren
id|cpu_time
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
(paren
id|efe-&gt;impIdent
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|EntityID
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|efe-&gt;impIdent.ident
comma
id|UDF_ID_DEVELOPER
)paren
suffix:semicolon
id|efe-&gt;impIdent.identSuffix
(braket
l_int|0
)braket
op_assign
id|UDF_OS_CLASS_UNIX
suffix:semicolon
id|efe-&gt;impIdent.identSuffix
(braket
l_int|1
)braket
op_assign
id|UDF_OS_ID_LINUX
suffix:semicolon
id|efe-&gt;uniqueID
op_assign
id|cpu_to_le64
c_func
(paren
id|UDF_I_UNIQUE
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|efe-&gt;lengthExtendedAttr
op_assign
id|cpu_to_le32
c_func
(paren
id|UDF_I_LENEATTR
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|efe-&gt;lengthAllocDescs
op_assign
id|cpu_to_le32
c_func
(paren
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|efe-&gt;descTag.tagIdent
op_assign
id|le16_to_cpu
c_func
(paren
id|TID_EXTENDED_FILE_ENTRY
)paren
suffix:semicolon
id|crclen
op_assign
r_sizeof
(paren
r_struct
id|ExtendedFileEntry
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|UDF_I_STRAT4096
c_func
(paren
id|inode
)paren
)paren
(brace
id|fe-&gt;icbTag.strategyType
op_assign
id|cpu_to_le16
c_func
(paren
l_int|4096
)paren
suffix:semicolon
id|fe-&gt;icbTag.strategyParameter
op_assign
id|cpu_to_le16
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|fe-&gt;icbTag.numEntries
op_assign
id|cpu_to_le16
c_func
(paren
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
id|fe-&gt;icbTag.strategyType
op_assign
id|cpu_to_le16
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|fe-&gt;icbTag.numEntries
op_assign
id|cpu_to_le16
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
id|fe-&gt;icbTag.fileType
op_assign
id|FILE_TYPE_DIRECTORY
suffix:semicolon
r_else
r_if
c_cond
(paren
id|S_ISREG
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
id|fe-&gt;icbTag.fileType
op_assign
id|FILE_TYPE_REGULAR
suffix:semicolon
r_else
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
id|fe-&gt;icbTag.fileType
op_assign
id|FILE_TYPE_SYMLINK
suffix:semicolon
r_else
r_if
c_cond
(paren
id|S_ISBLK
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
id|fe-&gt;icbTag.fileType
op_assign
id|FILE_TYPE_BLOCK
suffix:semicolon
r_else
r_if
c_cond
(paren
id|S_ISCHR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
id|fe-&gt;icbTag.fileType
op_assign
id|FILE_TYPE_CHAR
suffix:semicolon
r_else
r_if
c_cond
(paren
id|S_ISFIFO
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
id|fe-&gt;icbTag.fileType
op_assign
id|FILE_TYPE_FIFO
suffix:semicolon
id|icbflags
op_assign
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_or
(paren
(paren
id|inode-&gt;i_mode
op_amp
id|S_ISUID
)paren
ques
c_cond
id|ICB_FLAG_SETUID
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|inode-&gt;i_mode
op_amp
id|S_ISGID
)paren
ques
c_cond
id|ICB_FLAG_SETGID
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|inode-&gt;i_mode
op_amp
id|S_ISVTX
)paren
ques
c_cond
id|ICB_FLAG_STICKY
suffix:colon
l_int|0
)paren
op_or
(paren
id|le16_to_cpu
c_func
(paren
id|fe-&gt;icbTag.flags
)paren
op_amp
op_complement
(paren
id|ICB_FLAG_ALLOC_MASK
op_or
id|ICB_FLAG_SETUID
op_or
id|ICB_FLAG_SETGID
op_or
id|ICB_FLAG_STICKY
)paren
)paren
suffix:semicolon
id|fe-&gt;icbTag.flags
op_assign
id|cpu_to_le16
c_func
(paren
id|icbflags
)paren
suffix:semicolon
id|fe-&gt;descTag.descVersion
op_assign
id|cpu_to_le16
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|fe-&gt;descTag.tagSerialNum
op_assign
id|cpu_to_le16
c_func
(paren
id|UDF_SB_SERIALNUM
c_func
(paren
id|inode-&gt;i_sb
)paren
)paren
suffix:semicolon
id|fe-&gt;descTag.tagLocation
op_assign
id|cpu_to_le32
c_func
(paren
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|logicalBlockNum
)paren
suffix:semicolon
id|crclen
op_add_assign
id|UDF_I_LENEATTR
c_func
(paren
id|inode
)paren
op_plus
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_minus
r_sizeof
(paren
id|tag
)paren
suffix:semicolon
id|fe-&gt;descTag.descCRCLength
op_assign
id|cpu_to_le16
c_func
(paren
id|crclen
)paren
suffix:semicolon
id|fe-&gt;descTag.descCRC
op_assign
id|cpu_to_le16
c_func
(paren
id|udf_crc
c_func
(paren
(paren
r_char
op_star
)paren
id|fe
op_plus
r_sizeof
(paren
id|tag
)paren
comma
id|crclen
comma
l_int|0
)paren
)paren
suffix:semicolon
id|fe-&gt;descTag.tagChecksum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|i
op_ne
l_int|4
)paren
id|fe-&gt;descTag.tagChecksum
op_add_assign
(paren
(paren
id|Uint8
op_star
)paren
op_amp
(paren
id|fe-&gt;descTag
)paren
)paren
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* write the data blocks */
id|mark_buffer_dirty
c_func
(paren
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_sync
)paren
(brace
id|ll_rw_block
c_func
(paren
id|WRITE
comma
l_int|1
comma
op_amp
id|bh
)paren
suffix:semicolon
id|wait_on_buffer
c_func
(paren
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buffer_req
c_func
(paren
id|bh
)paren
op_logical_and
op_logical_neg
id|buffer_uptodate
c_func
(paren
id|bh
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;IO error syncing udf inode [%s:%08lx]&bslash;n&quot;
comma
id|bdevname
c_func
(paren
id|inode-&gt;i_dev
)paren
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
)brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_iget&n; *&n; * PURPOSE&n; *&t;Get an inode.&n; *&n; * DESCRIPTION&n; *&t;This routine replaces iget() and read_inode().&n; *&n; * HISTORY&n; *&t;October 3, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; *&n; * 12/19/98 dgb  Added semaphore and changed to be a wrapper of iget&n; */
r_struct
id|inode
op_star
DECL|function|udf_iget
id|udf_iget
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
id|lb_addr
id|ino
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_int
r_int
id|block
suffix:semicolon
id|block
op_assign
id|udf_get_lb_pblock
c_func
(paren
id|sb
comma
id|ino
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Get the inode */
id|inode
op_assign
id|iget
c_func
(paren
id|sb
comma
id|block
)paren
suffix:semicolon
multiline_comment|/* calls udf_read_inode() ! */
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: iget() failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|is_bad_inode
c_func
(paren
id|inode
)paren
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|logicalBlockNum
op_eq
l_int|0xFFFFFFFF
op_logical_and
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
op_eq
l_int|0xFFFF
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
op_amp
id|ino
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
suffix:semicolon
id|__udf_read_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ino.logicalBlockNum
op_ge
id|UDF_SB_PARTLEN
c_func
(paren
id|sb
comma
id|ino.partitionReferenceNum
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;block=%d, partition=%d out of range&bslash;n&quot;
comma
id|ino.logicalBlockNum
comma
id|ino.partitionReferenceNum
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|inode
suffix:semicolon
)brace
DECL|function|udf_add_aext
r_int
id|udf_add_aext
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|lb_addr
op_star
id|bloc
comma
r_int
op_star
id|extoffset
comma
id|lb_addr
id|eloc
comma
id|Uint32
id|elen
comma
r_struct
id|buffer_head
op_star
op_star
id|bh
comma
r_int
id|inc
)paren
(brace
r_int
id|adsize
suffix:semicolon
id|short_ad
op_star
id|sad
op_assign
l_int|NULL
suffix:semicolon
id|long_ad
op_star
id|lad
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|AllocExtDesc
op_star
id|aed
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|bh
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|bh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
op_star
id|bloc
comma
l_int|0
)paren
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;reading block %d failed!&bslash;n&quot;
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
op_star
id|bloc
comma
l_int|0
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_SHORT
)paren
id|adsize
op_assign
r_sizeof
(paren
id|short_ad
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_LONG
)paren
id|adsize
op_assign
r_sizeof
(paren
id|long_ad
)paren
suffix:semicolon
r_else
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_star
id|extoffset
op_plus
(paren
l_int|2
op_star
id|adsize
)paren
OG
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
(brace
r_char
op_star
id|sptr
comma
op_star
id|dptr
suffix:semicolon
r_struct
id|buffer_head
op_star
id|nbh
suffix:semicolon
r_int
id|err
comma
id|loffset
suffix:semicolon
id|lb_addr
id|obloc
op_assign
op_star
id|bloc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bloc-&gt;logicalBlockNum
op_assign
id|udf_new_block
c_func
(paren
id|inode
comma
id|obloc.partitionReferenceNum
comma
id|obloc.logicalBlockNum
comma
op_amp
id|err
)paren
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|nbh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
op_star
id|bloc
comma
l_int|0
)paren
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|aed
op_assign
(paren
r_struct
id|AllocExtDesc
op_star
)paren
(paren
id|nbh-&gt;b_data
)paren
suffix:semicolon
id|aed-&gt;previousAllocExtLocation
op_assign
id|cpu_to_le32
c_func
(paren
id|obloc.logicalBlockNum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|extoffset
op_plus
id|adsize
OG
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
(brace
id|loffset
op_assign
op_star
id|extoffset
suffix:semicolon
id|aed-&gt;lengthAllocDescs
op_assign
id|cpu_to_le32
c_func
(paren
id|adsize
)paren
suffix:semicolon
id|sptr
op_assign
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
op_plus
op_star
id|extoffset
op_minus
id|adsize
suffix:semicolon
id|dptr
op_assign
id|nbh-&gt;b_data
op_plus
r_sizeof
(paren
r_struct
id|AllocExtDesc
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dptr
comma
id|sptr
comma
id|adsize
)paren
suffix:semicolon
op_star
id|extoffset
op_assign
r_sizeof
(paren
r_struct
id|AllocExtDesc
)paren
op_plus
id|adsize
suffix:semicolon
)brace
r_else
(brace
id|loffset
op_assign
op_star
id|extoffset
op_plus
id|adsize
suffix:semicolon
id|aed-&gt;lengthAllocDescs
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|sptr
op_assign
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
op_plus
op_star
id|extoffset
suffix:semicolon
op_star
id|extoffset
op_assign
r_sizeof
(paren
r_struct
id|AllocExtDesc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
op_amp
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
op_amp
id|obloc
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
)paren
(brace
id|aed
op_assign
(paren
r_struct
id|AllocExtDesc
op_star
)paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
suffix:semicolon
id|aed-&gt;lengthAllocDescs
op_assign
id|cpu_to_le32
c_func
(paren
id|le32_to_cpu
c_func
(paren
id|aed-&gt;lengthAllocDescs
)paren
op_plus
id|adsize
)paren
suffix:semicolon
)brace
r_else
(brace
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_add_assign
id|adsize
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
)brace
id|udf_new_tag
c_func
(paren
id|nbh-&gt;b_data
comma
id|TID_ALLOC_EXTENT_DESC
comma
l_int|2
comma
l_int|1
comma
id|bloc-&gt;logicalBlockNum
comma
r_sizeof
(paren
id|tag
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
)paren
(brace
r_case
id|ICB_FLAG_AD_SHORT
suffix:colon
(brace
id|sad
op_assign
(paren
id|short_ad
op_star
)paren
id|sptr
suffix:semicolon
id|sad-&gt;extLength
op_assign
id|cpu_to_le32
c_func
(paren
id|EXTENT_NEXT_EXTENT_ALLOCDECS
op_lshift
l_int|30
op_or
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|sad-&gt;extPosition
op_assign
id|cpu_to_le32
c_func
(paren
id|bloc-&gt;logicalBlockNum
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|ICB_FLAG_AD_LONG
suffix:colon
(brace
id|lad
op_assign
(paren
id|long_ad
op_star
)paren
id|sptr
suffix:semicolon
id|lad-&gt;extLength
op_assign
id|cpu_to_le32
c_func
(paren
id|EXTENT_NEXT_EXTENT_ALLOCDECS
op_lshift
l_int|30
op_or
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|lad-&gt;extLocation
op_assign
id|cpu_to_lelb
c_func
(paren
op_star
id|bloc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|udf_update_tag
c_func
(paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
comma
id|loffset
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
op_star
id|bh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
op_star
id|bh
)paren
suffix:semicolon
op_star
id|bh
op_assign
id|nbh
suffix:semicolon
)brace
id|ret
op_assign
id|udf_write_aext
c_func
(paren
id|inode
comma
op_star
id|bloc
comma
id|extoffset
comma
id|eloc
comma
id|elen
comma
id|bh
comma
id|inc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
id|bloc
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
)paren
(brace
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_add_assign
id|adsize
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_else
(brace
id|aed
op_assign
(paren
r_struct
id|AllocExtDesc
op_star
)paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
suffix:semicolon
id|aed-&gt;lengthAllocDescs
op_assign
id|cpu_to_le32
c_func
(paren
id|le32_to_cpu
c_func
(paren
id|aed-&gt;lengthAllocDescs
)paren
op_plus
id|adsize
)paren
suffix:semicolon
id|udf_update_tag
c_func
(paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
comma
op_star
id|extoffset
op_plus
(paren
id|inc
ques
c_cond
l_int|0
suffix:colon
id|adsize
)paren
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
op_star
id|bh
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|udf_write_aext
r_int
id|udf_write_aext
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|lb_addr
id|bloc
comma
r_int
op_star
id|extoffset
comma
id|lb_addr
id|eloc
comma
id|Uint32
id|elen
comma
r_struct
id|buffer_head
op_star
op_star
id|bh
comma
r_int
id|inc
)paren
(brace
r_int
id|adsize
suffix:semicolon
id|short_ad
op_star
id|sad
op_assign
l_int|NULL
suffix:semicolon
id|long_ad
op_star
id|lad
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|bh
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|bh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|bloc
comma
l_int|0
)paren
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;reading block %d failed!&bslash;n&quot;
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|bloc
comma
l_int|0
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_SHORT
)paren
id|adsize
op_assign
r_sizeof
(paren
id|short_ad
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_LONG
)paren
id|adsize
op_assign
r_sizeof
(paren
id|long_ad
)paren
suffix:semicolon
r_else
r_return
op_minus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
)paren
(brace
r_case
id|ICB_FLAG_AD_SHORT
suffix:colon
(brace
id|sad
op_assign
(paren
id|short_ad
op_star
)paren
(paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
op_plus
op_star
id|extoffset
)paren
suffix:semicolon
id|sad-&gt;extLength
op_assign
id|cpu_to_le32
c_func
(paren
id|elen
)paren
suffix:semicolon
id|sad-&gt;extPosition
op_assign
id|cpu_to_le32
c_func
(paren
id|eloc.logicalBlockNum
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|ICB_FLAG_AD_LONG
suffix:colon
(brace
id|lad
op_assign
(paren
id|long_ad
op_star
)paren
(paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
op_plus
op_star
id|extoffset
)paren
suffix:semicolon
id|lad-&gt;extLength
op_assign
id|cpu_to_le32
c_func
(paren
id|elen
)paren
suffix:semicolon
id|lad-&gt;extLocation
op_assign
id|cpu_to_lelb
c_func
(paren
id|eloc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
op_amp
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
op_amp
id|bloc
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
)paren
(brace
r_struct
id|AllocExtDesc
op_star
id|aed
op_assign
(paren
r_struct
id|AllocExtDesc
op_star
)paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
suffix:semicolon
id|udf_update_tag
c_func
(paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
comma
id|le32_to_cpu
c_func
(paren
id|aed-&gt;lengthAllocDescs
)paren
op_plus
r_sizeof
(paren
r_struct
id|AllocExtDesc
)paren
)paren
suffix:semicolon
)brace
r_else
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
op_star
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inc
)paren
op_star
id|extoffset
op_add_assign
id|adsize
suffix:semicolon
r_return
(paren
id|elen
op_rshift
l_int|30
)paren
suffix:semicolon
)brace
DECL|function|udf_next_aext
r_int
id|udf_next_aext
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|lb_addr
op_star
id|bloc
comma
r_int
op_star
id|extoffset
comma
id|lb_addr
op_star
id|eloc
comma
id|Uint32
op_star
id|elen
comma
r_struct
id|buffer_head
op_star
op_star
id|bh
comma
r_int
id|inc
)paren
(brace
r_int
id|pos
comma
id|alen
suffix:semicolon
id|Uint8
id|etype
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|bh
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|bh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
op_star
id|bloc
comma
l_int|0
)paren
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;reading block %d failed!&bslash;n&quot;
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
op_star
id|bloc
comma
l_int|0
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
id|bloc
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
)paren
(brace
id|pos
op_assign
id|udf_file_entry_alloc_offset
c_func
(paren
id|inode
)paren
suffix:semicolon
id|alen
op_assign
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_plus
id|pos
suffix:semicolon
)brace
r_else
(brace
r_struct
id|AllocExtDesc
op_star
id|aed
op_assign
(paren
r_struct
id|AllocExtDesc
op_star
)paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
suffix:semicolon
id|pos
op_assign
r_sizeof
(paren
r_struct
id|AllocExtDesc
)paren
suffix:semicolon
id|alen
op_assign
id|le32_to_cpu
c_func
(paren
id|aed-&gt;lengthAllocDescs
)paren
op_plus
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|extoffset
)paren
)paren
op_star
id|extoffset
op_assign
id|pos
suffix:semicolon
r_switch
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
)paren
(brace
r_case
id|ICB_FLAG_AD_SHORT
suffix:colon
(brace
id|short_ad
op_star
id|sad
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sad
op_assign
id|udf_get_fileshortad
c_func
(paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
comma
id|alen
comma
id|extoffset
comma
id|inc
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|etype
op_assign
id|le32_to_cpu
c_func
(paren
id|sad-&gt;extLength
)paren
op_rshift
l_int|30
)paren
op_eq
id|EXTENT_NEXT_EXTENT_ALLOCDECS
)paren
(brace
id|bloc-&gt;logicalBlockNum
op_assign
id|le32_to_cpu
c_func
(paren
id|sad-&gt;extPosition
)paren
suffix:semicolon
op_star
id|extoffset
op_assign
l_int|0
suffix:semicolon
id|udf_release_data
c_func
(paren
op_star
id|bh
)paren
suffix:semicolon
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_return
id|udf_next_aext
c_func
(paren
id|inode
comma
id|bloc
comma
id|extoffset
comma
id|eloc
comma
id|elen
comma
id|bh
comma
id|inc
)paren
suffix:semicolon
)brace
r_else
(brace
id|eloc-&gt;logicalBlockNum
op_assign
id|le32_to_cpu
c_func
(paren
id|sad-&gt;extPosition
)paren
suffix:semicolon
id|eloc-&gt;partitionReferenceNum
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
suffix:semicolon
op_star
id|elen
op_assign
id|le32_to_cpu
c_func
(paren
id|sad-&gt;extLength
)paren
op_amp
id|UDF_EXTENT_LENGTH_MASK
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|ICB_FLAG_AD_LONG
suffix:colon
(brace
id|long_ad
op_star
id|lad
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|lad
op_assign
id|udf_get_filelongad
c_func
(paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
comma
id|alen
comma
id|extoffset
comma
id|inc
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|etype
op_assign
id|le32_to_cpu
c_func
(paren
id|lad-&gt;extLength
)paren
op_rshift
l_int|30
)paren
op_eq
id|EXTENT_NEXT_EXTENT_ALLOCDECS
)paren
(brace
op_star
id|bloc
op_assign
id|lelb_to_cpu
c_func
(paren
id|lad-&gt;extLocation
)paren
suffix:semicolon
op_star
id|extoffset
op_assign
l_int|0
suffix:semicolon
id|udf_release_data
c_func
(paren
op_star
id|bh
)paren
suffix:semicolon
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_return
id|udf_next_aext
c_func
(paren
id|inode
comma
id|bloc
comma
id|extoffset
comma
id|eloc
comma
id|elen
comma
id|bh
comma
id|inc
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|eloc
op_assign
id|lelb_to_cpu
c_func
(paren
id|lad-&gt;extLocation
)paren
suffix:semicolon
op_star
id|elen
op_assign
id|le32_to_cpu
c_func
(paren
id|lad-&gt;extLength
)paren
op_amp
id|UDF_EXTENT_LENGTH_MASK
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|ICB_FLAG_AD_IN_ICB
suffix:colon
(brace
r_if
c_cond
(paren
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|etype
op_assign
id|EXTENT_RECORDED_ALLOCATED
suffix:semicolon
op_star
id|eloc
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
suffix:semicolon
op_star
id|elen
op_assign
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
(brace
id|udf_debug
c_func
(paren
l_string|&quot;alloc_type = %d unsupported&bslash;n&quot;
comma
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_star
id|elen
)paren
r_return
id|etype
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;Empty Extent, inode=%ld, alloctype=%d, eloc=%d, elen=%d, etype=%d, extoffset=%d&bslash;n&quot;
comma
id|inode-&gt;i_ino
comma
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
comma
id|eloc-&gt;logicalBlockNum
comma
op_star
id|elen
comma
id|etype
comma
op_star
id|extoffset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_SHORT
)paren
op_star
id|extoffset
op_sub_assign
r_sizeof
(paren
id|short_ad
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_LONG
)paren
op_star
id|extoffset
op_sub_assign
r_sizeof
(paren
id|long_ad
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|udf_current_aext
r_int
id|udf_current_aext
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|lb_addr
op_star
id|bloc
comma
r_int
op_star
id|extoffset
comma
id|lb_addr
op_star
id|eloc
comma
id|Uint32
op_star
id|elen
comma
r_struct
id|buffer_head
op_star
op_star
id|bh
comma
r_int
id|inc
)paren
(brace
r_int
id|pos
comma
id|alen
suffix:semicolon
id|Uint8
id|etype
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|bh
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|bh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
op_star
id|bloc
comma
l_int|0
)paren
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;reading block %d failed!&bslash;n&quot;
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
op_star
id|bloc
comma
l_int|0
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
id|bloc
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|UDF_I_EXTENDED_FE
c_func
(paren
id|inode
)paren
)paren
)paren
id|pos
op_assign
r_sizeof
(paren
r_struct
id|FileEntry
)paren
op_plus
id|UDF_I_LENEATTR
c_func
(paren
id|inode
)paren
suffix:semicolon
r_else
id|pos
op_assign
r_sizeof
(paren
r_struct
id|ExtendedFileEntry
)paren
op_plus
id|UDF_I_LENEATTR
c_func
(paren
id|inode
)paren
suffix:semicolon
id|alen
op_assign
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_plus
id|pos
suffix:semicolon
)brace
r_else
(brace
r_struct
id|AllocExtDesc
op_star
id|aed
op_assign
(paren
r_struct
id|AllocExtDesc
op_star
)paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
suffix:semicolon
id|pos
op_assign
r_sizeof
(paren
r_struct
id|AllocExtDesc
)paren
suffix:semicolon
id|alen
op_assign
id|le32_to_cpu
c_func
(paren
id|aed-&gt;lengthAllocDescs
)paren
op_plus
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|extoffset
)paren
)paren
op_star
id|extoffset
op_assign
id|pos
suffix:semicolon
r_switch
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
)paren
(brace
r_case
id|ICB_FLAG_AD_SHORT
suffix:colon
(brace
id|short_ad
op_star
id|sad
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sad
op_assign
id|udf_get_fileshortad
c_func
(paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
comma
id|alen
comma
id|extoffset
comma
id|inc
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|etype
op_assign
id|le32_to_cpu
c_func
(paren
id|sad-&gt;extLength
)paren
op_rshift
l_int|30
suffix:semicolon
id|eloc-&gt;logicalBlockNum
op_assign
id|le32_to_cpu
c_func
(paren
id|sad-&gt;extPosition
)paren
suffix:semicolon
id|eloc-&gt;partitionReferenceNum
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
suffix:semicolon
op_star
id|elen
op_assign
id|le32_to_cpu
c_func
(paren
id|sad-&gt;extLength
)paren
op_amp
id|UDF_EXTENT_LENGTH_MASK
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|ICB_FLAG_AD_LONG
suffix:colon
(brace
id|long_ad
op_star
id|lad
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|lad
op_assign
id|udf_get_filelongad
c_func
(paren
(paren
op_star
id|bh
)paren
op_member_access_from_pointer
id|b_data
comma
id|alen
comma
id|extoffset
comma
id|inc
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|etype
op_assign
id|le32_to_cpu
c_func
(paren
id|lad-&gt;extLength
)paren
op_rshift
l_int|30
suffix:semicolon
op_star
id|eloc
op_assign
id|lelb_to_cpu
c_func
(paren
id|lad-&gt;extLocation
)paren
suffix:semicolon
op_star
id|elen
op_assign
id|le32_to_cpu
c_func
(paren
id|lad-&gt;extLength
)paren
op_amp
id|UDF_EXTENT_LENGTH_MASK
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
(brace
id|udf_debug
c_func
(paren
l_string|&quot;alloc_type = %d unsupported&bslash;n&quot;
comma
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_star
id|elen
)paren
r_return
id|etype
suffix:semicolon
id|udf_debug
c_func
(paren
l_string|&quot;Empty Extent!&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_SHORT
)paren
op_star
id|extoffset
op_sub_assign
r_sizeof
(paren
id|short_ad
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_LONG
)paren
op_star
id|extoffset
op_sub_assign
r_sizeof
(paren
id|long_ad
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|udf_insert_aext
r_int
id|udf_insert_aext
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|lb_addr
id|bloc
comma
r_int
id|extoffset
comma
id|lb_addr
id|neloc
comma
id|Uint32
id|nelen
comma
r_struct
id|buffer_head
op_star
id|bh
)paren
(brace
id|lb_addr
id|oeloc
suffix:semicolon
id|Uint32
id|oelen
suffix:semicolon
r_int
id|type
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|bloc
comma
l_int|0
)paren
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;reading block %d failed!&bslash;n&quot;
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|bloc
comma
l_int|0
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_else
id|atomic_inc
c_func
(paren
op_amp
id|bh-&gt;b_count
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|type
op_assign
id|udf_next_aext
c_func
(paren
id|inode
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
op_amp
id|oeloc
comma
op_amp
id|oelen
comma
op_amp
id|bh
comma
l_int|0
)paren
)paren
op_ne
op_minus
l_int|1
)paren
(brace
id|udf_write_aext
c_func
(paren
id|inode
comma
id|bloc
comma
op_amp
id|extoffset
comma
id|neloc
comma
id|nelen
comma
op_amp
id|bh
comma
l_int|1
)paren
suffix:semicolon
id|neloc
op_assign
id|oeloc
suffix:semicolon
id|nelen
op_assign
(paren
id|type
op_lshift
l_int|30
)paren
op_or
id|oelen
suffix:semicolon
)brace
id|udf_add_aext
c_func
(paren
id|inode
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
id|neloc
comma
id|nelen
comma
op_amp
id|bh
comma
l_int|1
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
(paren
id|nelen
op_rshift
l_int|30
)paren
suffix:semicolon
)brace
DECL|function|udf_delete_aext
r_int
id|udf_delete_aext
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|lb_addr
id|nbloc
comma
r_int
id|nextoffset
comma
id|lb_addr
id|eloc
comma
id|Uint32
id|elen
comma
r_struct
id|buffer_head
op_star
id|nbh
)paren
(brace
r_struct
id|buffer_head
op_star
id|obh
suffix:semicolon
id|lb_addr
id|obloc
suffix:semicolon
r_int
id|oextoffset
comma
id|adsize
suffix:semicolon
r_int
id|type
suffix:semicolon
r_struct
id|AllocExtDesc
op_star
id|aed
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|nbh
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|nbh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|nbloc
comma
l_int|0
)paren
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;reading block %d failed!&bslash;n&quot;
comma
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|nbloc
comma
l_int|0
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_else
id|atomic_inc
c_func
(paren
op_amp
id|nbh-&gt;b_count
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|nbh-&gt;b_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_SHORT
)paren
id|adsize
op_assign
r_sizeof
(paren
id|short_ad
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_LONG
)paren
id|adsize
op_assign
r_sizeof
(paren
id|long_ad
)paren
suffix:semicolon
r_else
id|adsize
op_assign
l_int|0
suffix:semicolon
id|obh
op_assign
id|nbh
suffix:semicolon
id|obloc
op_assign
id|nbloc
suffix:semicolon
id|oextoffset
op_assign
id|nextoffset
suffix:semicolon
r_if
c_cond
(paren
id|udf_next_aext
c_func
(paren
id|inode
comma
op_amp
id|nbloc
comma
op_amp
id|nextoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|nbh
comma
l_int|1
)paren
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
(paren
id|type
op_assign
id|udf_next_aext
c_func
(paren
id|inode
comma
op_amp
id|nbloc
comma
op_amp
id|nextoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|nbh
comma
l_int|1
)paren
)paren
op_ne
op_minus
l_int|1
)paren
(brace
id|udf_write_aext
c_func
(paren
id|inode
comma
id|obloc
comma
op_amp
id|oextoffset
comma
id|eloc
comma
(paren
id|type
op_lshift
l_int|30
)paren
op_or
id|elen
comma
op_amp
id|obh
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
op_amp
id|nbloc
comma
op_amp
id|obloc
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
)paren
(brace
id|obloc
op_assign
id|nbloc
suffix:semicolon
id|udf_release_data
c_func
(paren
id|obh
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|nbh-&gt;b_count
)paren
suffix:semicolon
id|obh
op_assign
id|nbh
suffix:semicolon
id|oextoffset
op_assign
id|nextoffset
op_minus
id|adsize
suffix:semicolon
)brace
)brace
id|memset
c_func
(paren
op_amp
id|eloc
comma
l_int|0x00
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
suffix:semicolon
id|elen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
op_amp
id|nbloc
comma
op_amp
id|obloc
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
)paren
(brace
id|udf_free_blocks
c_func
(paren
id|inode
comma
id|nbloc
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|udf_write_aext
c_func
(paren
id|inode
comma
id|obloc
comma
op_amp
id|oextoffset
comma
id|eloc
comma
id|elen
comma
op_amp
id|obh
comma
l_int|1
)paren
suffix:semicolon
id|udf_write_aext
c_func
(paren
id|inode
comma
id|obloc
comma
op_amp
id|oextoffset
comma
id|eloc
comma
id|elen
comma
op_amp
id|obh
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
op_amp
id|obloc
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
)paren
(brace
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_sub_assign
(paren
id|adsize
op_star
l_int|2
)paren
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_else
(brace
id|aed
op_assign
(paren
r_struct
id|AllocExtDesc
op_star
)paren
(paren
id|obh
)paren
op_member_access_from_pointer
id|b_data
suffix:semicolon
id|aed-&gt;lengthAllocDescs
op_assign
id|cpu_to_le32
c_func
(paren
id|le32_to_cpu
c_func
(paren
id|aed-&gt;lengthAllocDescs
)paren
op_minus
(paren
l_int|2
op_star
id|adsize
)paren
)paren
suffix:semicolon
id|udf_update_tag
c_func
(paren
(paren
id|obh
)paren
op_member_access_from_pointer
id|b_data
comma
id|oextoffset
op_minus
(paren
l_int|2
op_star
id|adsize
)paren
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|obh
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|udf_write_aext
c_func
(paren
id|inode
comma
id|obloc
comma
op_amp
id|oextoffset
comma
id|eloc
comma
id|elen
comma
op_amp
id|obh
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
op_amp
id|obloc
comma
r_sizeof
(paren
id|lb_addr
)paren
)paren
)paren
(brace
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_sub_assign
id|adsize
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_else
(brace
id|aed
op_assign
(paren
r_struct
id|AllocExtDesc
op_star
)paren
(paren
id|obh
)paren
op_member_access_from_pointer
id|b_data
suffix:semicolon
id|aed-&gt;lengthAllocDescs
op_assign
id|cpu_to_le32
c_func
(paren
id|le32_to_cpu
c_func
(paren
id|aed-&gt;lengthAllocDescs
)paren
op_minus
id|adsize
)paren
suffix:semicolon
id|udf_update_tag
c_func
(paren
(paren
id|obh
)paren
op_member_access_from_pointer
id|b_data
comma
id|oextoffset
op_minus
id|adsize
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|obh
)paren
suffix:semicolon
)brace
)brace
id|udf_release_data
c_func
(paren
id|nbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|obh
)paren
suffix:semicolon
r_return
(paren
id|elen
op_rshift
l_int|30
)paren
suffix:semicolon
)brace
DECL|function|inode_bmap
r_int
id|inode_bmap
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|block
comma
id|lb_addr
op_star
id|bloc
comma
id|Uint32
op_star
id|extoffset
comma
id|lb_addr
op_star
id|eloc
comma
id|Uint32
op_star
id|elen
comma
id|Uint32
op_star
id|offset
comma
r_struct
id|buffer_head
op_star
op_star
id|bh
)paren
(brace
r_int
id|etype
comma
id|lbcount
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|block
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: inode_bmap: block &lt; 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;udf: inode_bmap: NULL inode&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
op_star
id|extoffset
op_assign
l_int|0
suffix:semicolon
op_star
id|elen
op_assign
l_int|0
suffix:semicolon
op_star
id|bloc
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|etype
op_assign
id|udf_next_aext
c_func
(paren
id|inode
comma
id|bloc
comma
id|extoffset
comma
id|eloc
comma
id|elen
comma
id|bh
comma
l_int|1
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
op_star
id|offset
op_assign
id|block
op_minus
id|lbcount
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|lbcount
op_add_assign
(paren
(paren
op_star
id|elen
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|lbcount
op_le
id|block
)paren
suffix:semicolon
op_star
id|offset
op_assign
id|block
op_plus
(paren
(paren
op_star
id|elen
op_plus
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
id|inode-&gt;i_sb-&gt;s_blocksize_bits
)paren
op_minus
id|lbcount
suffix:semicolon
r_return
id|etype
suffix:semicolon
)brace
DECL|function|udf_locked_block_map
r_int
id|udf_locked_block_map
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|block
)paren
(brace
id|lb_addr
id|eloc
comma
id|bloc
suffix:semicolon
id|Uint32
id|offset
comma
id|extoffset
comma
id|elen
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|inode_bmap
c_func
(paren
id|inode
comma
id|block
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|offset
comma
op_amp
id|bh
)paren
op_eq
id|EXTENT_RECORDED_ALLOCATED
)paren
id|ret
op_assign
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|eloc
comma
id|offset
)paren
suffix:semicolon
r_else
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bh
)paren
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_QUERY_FLAG
c_func
(paren
id|inode-&gt;i_sb
comma
id|UDF_FLAG_VARCONV
)paren
)paren
r_return
id|udf_fixed_to_variable
c_func
(paren
id|ret
)paren
suffix:semicolon
r_else
r_return
id|ret
suffix:semicolon
)brace
DECL|function|udf_block_map
r_int
id|udf_block_map
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|block
)paren
(brace
r_int
id|ret
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
id|udf_locked_block_map
c_func
(paren
id|inode
comma
id|block
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
eof
