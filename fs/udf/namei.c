multiline_comment|/*&n; * namei.c&n; *&n; * PURPOSE&n; *      Inode name handling routines for the OSTA-UDF(tm) filesystem.&n; *&n; * CONTACTS&n; *      E-mail regarding any portion of the Linux UDF file system should be&n; *      directed to the development team mailing list (run by majordomo):&n; *              linux_udf@hootie.lvld.hp.com&n; *&n; * COPYRIGHT&n; *      This file is distributed under the terms of the GNU General Public&n; *      License (GPL). Copies of the GPL can be obtained from:&n; *              ftp://prep.ai.mit.edu/pub/gnu/GPL&n; *      Each contributing author retains all rights to their own work.&n; *&n; *  (C) 1998-2000 Ben Fennema&n; *  (C) 1999-2000 Stelias Computing Inc&n; *&n; * HISTORY&n; *&n; *  12/12/98 blf  Created. Split out the lookup code from dir.c&n; *  04/19/99 blf  link, mknod, symlink support&n; */
macro_line|#include &quot;udfdecl.h&quot;
macro_line|#include &quot;udf_i.h&quot;
macro_line|#include &quot;udf_sb.h&quot;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/quotaops.h&gt;
macro_line|#include &lt;linux/udf_fs.h&gt;
DECL|function|udf_match
r_static
r_inline
r_int
id|udf_match
c_func
(paren
r_int
id|len
comma
r_const
r_char
op_star
r_const
id|name
comma
r_struct
id|qstr
op_star
id|qs
)paren
(brace
r_if
c_cond
(paren
id|len
op_ne
id|qs-&gt;len
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_logical_neg
id|memcmp
c_func
(paren
id|name
comma
id|qs-&gt;name
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|udf_write_fi
r_int
id|udf_write_fi
c_func
(paren
r_struct
id|FileIdentDesc
op_star
id|cfi
comma
r_struct
id|FileIdentDesc
op_star
id|sfi
comma
r_struct
id|udf_fileident_bh
op_star
id|fibh
comma
id|Uint8
op_star
id|impuse
comma
id|Uint8
op_star
id|fileident
)paren
(brace
id|Uint16
id|crclen
op_assign
id|fibh-&gt;eoffset
op_minus
id|fibh-&gt;soffset
op_minus
r_sizeof
(paren
id|tag
)paren
suffix:semicolon
id|Uint16
id|crc
suffix:semicolon
id|Uint8
id|checksum
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|offset
suffix:semicolon
id|Uint16
id|liu
op_assign
id|le16_to_cpu
c_func
(paren
id|cfi-&gt;lengthOfImpUse
)paren
suffix:semicolon
id|Uint8
id|lfi
op_assign
id|cfi-&gt;lengthFileIdent
suffix:semicolon
r_int
id|padlen
op_assign
id|fibh-&gt;eoffset
op_minus
id|fibh-&gt;soffset
op_minus
id|liu
op_minus
id|lfi
op_minus
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
suffix:semicolon
id|offset
op_assign
id|fibh-&gt;soffset
op_plus
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|impuse
)paren
(brace
r_if
c_cond
(paren
id|offset
op_plus
id|liu
OL
l_int|0
)paren
id|memcpy
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|sfi-&gt;impUse
comma
id|impuse
comma
id|liu
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|offset
op_ge
l_int|0
)paren
id|memcpy
c_func
(paren
id|fibh-&gt;ebh-&gt;b_data
op_plus
id|offset
comma
id|impuse
comma
id|liu
)paren
suffix:semicolon
r_else
(brace
id|memcpy
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|sfi-&gt;impUse
comma
id|impuse
comma
op_minus
id|offset
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fibh-&gt;ebh-&gt;b_data
comma
id|impuse
op_minus
id|offset
comma
id|liu
op_plus
id|offset
)paren
suffix:semicolon
)brace
)brace
id|offset
op_add_assign
id|liu
suffix:semicolon
r_if
c_cond
(paren
id|fileident
)paren
(brace
r_if
c_cond
(paren
id|offset
op_plus
id|lfi
OL
l_int|0
)paren
id|memcpy
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|sfi-&gt;fileIdent
op_plus
id|liu
comma
id|fileident
comma
id|lfi
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|offset
op_ge
l_int|0
)paren
id|memcpy
c_func
(paren
id|fibh-&gt;ebh-&gt;b_data
op_plus
id|offset
comma
id|fileident
comma
id|lfi
)paren
suffix:semicolon
r_else
(brace
id|memcpy
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|sfi-&gt;fileIdent
op_plus
id|liu
comma
id|fileident
comma
op_minus
id|offset
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fibh-&gt;ebh-&gt;b_data
comma
id|fileident
op_minus
id|offset
comma
id|lfi
op_plus
id|offset
)paren
suffix:semicolon
)brace
)brace
id|offset
op_add_assign
id|lfi
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_plus
id|padlen
OL
l_int|0
)paren
id|memset
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|sfi-&gt;padding
op_plus
id|liu
op_plus
id|lfi
comma
l_int|0x00
comma
id|padlen
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|offset
op_ge
l_int|0
)paren
id|memset
c_func
(paren
id|fibh-&gt;ebh-&gt;b_data
op_plus
id|offset
comma
l_int|0x00
comma
id|padlen
)paren
suffix:semicolon
r_else
(brace
id|memset
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|sfi-&gt;padding
op_plus
id|liu
op_plus
id|lfi
comma
l_int|0x00
comma
op_minus
id|offset
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fibh-&gt;ebh-&gt;b_data
comma
l_int|0x00
comma
id|padlen
op_plus
id|offset
)paren
suffix:semicolon
)brace
id|crc
op_assign
id|udf_crc
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|cfi
op_plus
r_sizeof
(paren
id|tag
)paren
comma
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
op_minus
r_sizeof
(paren
id|tag
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_eq
id|fibh-&gt;ebh
)paren
id|crc
op_assign
id|udf_crc
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|sfi-&gt;impUse
comma
id|crclen
op_plus
r_sizeof
(paren
id|tag
)paren
op_minus
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
comma
id|crc
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
op_ge
op_minus
id|fibh-&gt;soffset
)paren
id|crc
op_assign
id|udf_crc
c_func
(paren
id|fibh-&gt;ebh-&gt;b_data
op_plus
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
op_plus
id|fibh-&gt;soffset
comma
id|crclen
op_plus
r_sizeof
(paren
id|tag
)paren
op_minus
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
comma
id|crc
)paren
suffix:semicolon
r_else
(brace
id|crc
op_assign
id|udf_crc
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|sfi-&gt;impUse
comma
op_minus
id|fibh-&gt;soffset
op_minus
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
comma
id|crc
)paren
suffix:semicolon
id|crc
op_assign
id|udf_crc
c_func
(paren
id|fibh-&gt;ebh-&gt;b_data
comma
id|fibh-&gt;eoffset
comma
id|crc
)paren
suffix:semicolon
)brace
id|cfi-&gt;descTag.descCRC
op_assign
id|cpu_to_le32
c_func
(paren
id|crc
)paren
suffix:semicolon
id|cfi-&gt;descTag.descCRCLength
op_assign
id|cpu_to_le16
c_func
(paren
id|crclen
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|i
op_ne
l_int|4
)paren
id|checksum
op_add_assign
(paren
(paren
id|Uint8
op_star
)paren
op_amp
id|cfi-&gt;descTag
)paren
(braket
id|i
)braket
suffix:semicolon
id|cfi-&gt;descTag.tagChecksum
op_assign
id|checksum
suffix:semicolon
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
op_le
op_minus
id|fibh-&gt;soffset
)paren
id|memcpy
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|sfi
comma
(paren
id|Uint8
op_star
)paren
id|cfi
comma
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
)paren
suffix:semicolon
r_else
(brace
id|memcpy
c_func
(paren
(paren
id|Uint8
op_star
)paren
id|sfi
comma
(paren
id|Uint8
op_star
)paren
id|cfi
comma
op_minus
id|fibh-&gt;soffset
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fibh-&gt;ebh-&gt;b_data
comma
(paren
id|Uint8
op_star
)paren
id|cfi
op_minus
id|fibh-&gt;soffset
comma
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
op_plus
id|fibh-&gt;soffset
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_ne
id|fibh-&gt;ebh
)paren
id|mark_buffer_dirty
c_func
(paren
id|fibh-&gt;ebh
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|FileIdentDesc
op_star
DECL|function|udf_find_entry
id|udf_find_entry
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|udf_fileident_bh
op_star
id|fibh
comma
r_struct
id|FileIdentDesc
op_star
id|cfi
)paren
(brace
r_struct
id|FileIdentDesc
op_star
id|fi
op_assign
l_int|NULL
suffix:semicolon
id|loff_t
id|f_pos
suffix:semicolon
r_int
id|block
comma
id|flen
suffix:semicolon
r_char
id|fname
(braket
l_int|255
)braket
suffix:semicolon
r_char
op_star
id|nameptr
suffix:semicolon
id|Uint8
id|lfi
suffix:semicolon
id|Uint16
id|liu
suffix:semicolon
id|loff_t
id|size
op_assign
(paren
id|udf_ext0_offset
c_func
(paren
id|dir
)paren
op_plus
id|dir-&gt;i_size
)paren
op_rshift
l_int|2
suffix:semicolon
id|lb_addr
id|bloc
comma
id|eloc
suffix:semicolon
id|Uint32
id|extoffset
comma
id|elen
comma
id|offset
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dir
)paren
r_return
l_int|NULL
suffix:semicolon
id|f_pos
op_assign
(paren
id|udf_ext0_offset
c_func
(paren
id|dir
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
id|fibh-&gt;soffset
op_assign
id|fibh-&gt;eoffset
op_assign
(paren
id|f_pos
op_amp
(paren
(paren
id|dir-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
l_int|2
)paren
)paren
op_lshift
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|inode_bmap
c_func
(paren
id|dir
comma
id|f_pos
op_rshift
(paren
id|dir-&gt;i_sb-&gt;s_blocksize_bits
op_minus
l_int|2
)paren
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|offset
comma
op_amp
id|bh
)paren
op_eq
id|EXTENT_RECORDED_ALLOCATED
)paren
(brace
id|block
op_assign
id|udf_get_lb_pblock
c_func
(paren
id|dir-&gt;i_sb
comma
id|eloc
comma
id|offset
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_increment
id|offset
op_lshift
id|dir-&gt;i_sb-&gt;s_blocksize_bits
)paren
OL
id|elen
)paren
(brace
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_SHORT
)paren
id|extoffset
op_sub_assign
r_sizeof
(paren
id|short_ad
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_LONG
)paren
id|extoffset
op_sub_assign
r_sizeof
(paren
id|long_ad
)paren
suffix:semicolon
)brace
r_else
id|offset
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fibh-&gt;sbh
op_assign
id|fibh-&gt;ebh
op_assign
id|udf_tread
c_func
(paren
id|dir-&gt;i_sb
comma
id|block
comma
id|dir-&gt;i_sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|f_pos
OL
id|size
)paren
)paren
(brace
id|fi
op_assign
id|udf_fileident_read
c_func
(paren
id|dir
comma
op_amp
id|f_pos
comma
id|fibh
comma
id|cfi
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|offset
comma
op_amp
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi
)paren
(brace
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_ne
id|fibh-&gt;ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh-&gt;ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|liu
op_assign
id|le16_to_cpu
c_func
(paren
id|cfi-&gt;lengthOfImpUse
)paren
suffix:semicolon
id|lfi
op_assign
id|cfi-&gt;lengthFileIdent
suffix:semicolon
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_eq
id|fibh-&gt;ebh
)paren
(brace
id|nameptr
op_assign
id|fi-&gt;fileIdent
op_plus
id|liu
suffix:semicolon
)brace
r_else
(brace
r_int
id|poffset
suffix:semicolon
multiline_comment|/* Unpaded ending offset */
id|poffset
op_assign
id|fibh-&gt;soffset
op_plus
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
op_plus
id|liu
op_plus
id|lfi
suffix:semicolon
r_if
c_cond
(paren
id|poffset
op_ge
id|lfi
)paren
id|nameptr
op_assign
(paren
id|Uint8
op_star
)paren
(paren
id|fibh-&gt;ebh-&gt;b_data
op_plus
id|poffset
op_minus
id|lfi
)paren
suffix:semicolon
r_else
(brace
id|nameptr
op_assign
id|fname
suffix:semicolon
id|memcpy
c_func
(paren
id|nameptr
comma
id|fi-&gt;fileIdent
op_plus
id|liu
comma
id|lfi
op_minus
id|poffset
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|nameptr
op_plus
id|lfi
op_minus
id|poffset
comma
id|fibh-&gt;ebh-&gt;b_data
comma
id|poffset
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|cfi-&gt;fileCharacteristics
op_amp
id|FILE_DELETED
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|UDF_QUERY_FLAG
c_func
(paren
id|dir-&gt;i_sb
comma
id|UDF_FLAG_UNDELETE
)paren
)paren
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cfi-&gt;fileCharacteristics
op_amp
id|FILE_HIDDEN
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|UDF_QUERY_FLAG
c_func
(paren
id|dir-&gt;i_sb
comma
id|UDF_FLAG_UNHIDE
)paren
)paren
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|lfi
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flen
op_assign
id|udf_get_filename
c_func
(paren
id|nameptr
comma
id|fname
comma
id|lfi
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|udf_match
c_func
(paren
id|flen
comma
id|fname
comma
op_amp
(paren
id|dentry-&gt;d_name
)paren
)paren
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
id|fi
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_ne
id|fibh-&gt;ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh-&gt;ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * udf_lookup&n; *&n; * PURPOSE&n; *&t;Look-up the inode for a given name.&n; *&n; * DESCRIPTION&n; *&t;Required - lookup_dentry() will return -ENOTDIR if this routine is not&n; *&t;available for a directory. The filesystem is useless if this routine is&n; *&t;not available for at least the filesystem&squot;s root directory.&n; *&n; *&t;This routine is passed an incomplete dentry - it must be completed by&n; *&t;calling d_add(dentry, inode). If the name does not exist, then the&n; *&t;specified inode must be set to null. An error should only be returned&n; *&t;when the lookup fails for a reason other than the name not existing.&n; *&t;Note that the directory inode semaphore is held during the call.&n; *&n; *&t;Refer to lookup_dentry() in fs/namei.c&n; *&t;lookup_dentry() -&gt; lookup() -&gt; real_lookup() -&gt; .&n; *&n; * PRE-CONDITIONS&n; *&t;dir&t;&t;&t;Pointer to inode of parent directory.&n; *&t;dentry&t;&t;&t;Pointer to dentry to complete.&n; *&n; * POST-CONDITIONS&n; *&t;&lt;return&gt;&t;&t;Zero on success.&n; *&n; * HISTORY&n; *&t;July 1, 1997 - Andrew E. Mileski&n; *&t;Written, tested, and released.&n; */
r_static
r_struct
id|dentry
op_star
DECL|function|udf_lookup
id|udf_lookup
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|FileIdentDesc
id|cfi
comma
op_star
id|fi
suffix:semicolon
r_struct
id|udf_fileident_bh
id|fibh
suffix:semicolon
r_if
c_cond
(paren
id|dentry-&gt;d_name.len
OG
id|UDF_NAME_LEN
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENAMETOOLONG
)paren
suffix:semicolon
macro_line|#ifdef UDF_RECOVERY
multiline_comment|/* temporary shorthand for specifying files by inode number */
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|dentry-&gt;d_name.name
comma
l_string|&quot;.B=&quot;
comma
l_int|3
)paren
)paren
(brace
id|lb_addr
id|lb
op_assign
(brace
l_int|0
comma
id|simple_strtoul
c_func
(paren
id|dentry-&gt;d_name.name
op_plus
l_int|3
comma
l_int|NULL
comma
l_int|0
)paren
)brace
suffix:semicolon
id|inode
op_assign
id|udf_iget
c_func
(paren
id|dir-&gt;i_sb
comma
id|lb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EACCES
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif /* UDF_RECOVERY */
r_if
c_cond
(paren
(paren
id|fi
op_assign
id|udf_find_entry
c_func
(paren
id|dir
comma
id|dentry
comma
op_amp
id|fibh
comma
op_amp
id|cfi
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|fibh.sbh
op_ne
id|fibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|inode
op_assign
id|udf_iget
c_func
(paren
id|dir-&gt;i_sb
comma
id|lelb_to_cpu
c_func
(paren
id|cfi.icb.extLocation
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EACCES
)paren
suffix:semicolon
)brace
id|d_add
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_struct
id|FileIdentDesc
op_star
DECL|function|udf_add_entry
id|udf_add_entry
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|udf_fileident_bh
op_star
id|fibh
comma
r_struct
id|FileIdentDesc
op_star
id|cfi
comma
r_int
op_star
id|err
)paren
(brace
r_struct
id|super_block
op_star
id|sb
suffix:semicolon
r_struct
id|FileIdentDesc
op_star
id|fi
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ustr
id|unifilename
suffix:semicolon
r_char
id|name
(braket
id|UDF_NAME_LEN
)braket
comma
id|fname
(braket
id|UDF_NAME_LEN
)braket
suffix:semicolon
r_int
id|namelen
suffix:semicolon
id|loff_t
id|f_pos
suffix:semicolon
r_int
id|flen
suffix:semicolon
r_char
op_star
id|nameptr
suffix:semicolon
id|loff_t
id|size
op_assign
(paren
id|udf_ext0_offset
c_func
(paren
id|dir
)paren
op_plus
id|dir-&gt;i_size
)paren
op_rshift
l_int|2
suffix:semicolon
r_int
id|nfidlen
suffix:semicolon
id|Uint8
id|lfi
suffix:semicolon
id|Uint16
id|liu
suffix:semicolon
r_int
id|block
suffix:semicolon
id|lb_addr
id|bloc
comma
id|eloc
suffix:semicolon
id|Uint32
id|extoffset
comma
id|elen
comma
id|offset
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
id|sb
op_assign
id|dir-&gt;i_sb
suffix:semicolon
r_if
c_cond
(paren
id|dentry
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|udf_char_to_ustr
c_func
(paren
op_amp
id|unifilename
comma
id|dentry-&gt;d_name.name
comma
id|dentry-&gt;d_name.len
)paren
)paren
)paren
(brace
op_star
id|err
op_assign
op_minus
id|ENAMETOOLONG
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|namelen
op_assign
id|udf_UTF8toCS0
c_func
(paren
id|name
comma
op_amp
id|unifilename
comma
id|UDF_NAME_LEN
)paren
)paren
)paren
(brace
op_star
id|err
op_assign
op_minus
id|ENAMETOOLONG
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|dir-&gt;i_size
op_ne
l_int|0
)paren
(brace
multiline_comment|/* WTF??? */
op_star
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_else
multiline_comment|/* .. */
id|namelen
op_assign
l_int|0
suffix:semicolon
id|nfidlen
op_assign
(paren
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
op_plus
l_int|0
op_plus
id|namelen
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|f_pos
op_assign
(paren
id|udf_ext0_offset
c_func
(paren
id|dir
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
id|fibh-&gt;soffset
op_assign
id|fibh-&gt;eoffset
op_assign
(paren
id|f_pos
op_amp
(paren
(paren
id|dir-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
l_int|2
)paren
)paren
op_lshift
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|inode_bmap
c_func
(paren
id|dir
comma
id|f_pos
op_rshift
(paren
id|dir-&gt;i_sb-&gt;s_blocksize_bits
op_minus
l_int|2
)paren
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|offset
comma
op_amp
id|bh
)paren
op_eq
id|EXTENT_RECORDED_ALLOCATED
)paren
(brace
id|block
op_assign
id|udf_get_lb_pblock
c_func
(paren
id|dir-&gt;i_sb
comma
id|eloc
comma
id|offset
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_increment
id|offset
op_lshift
id|dir-&gt;i_sb-&gt;s_blocksize_bits
)paren
OL
id|elen
)paren
(brace
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_SHORT
)paren
id|extoffset
op_sub_assign
r_sizeof
(paren
id|short_ad
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_LONG
)paren
id|extoffset
op_sub_assign
r_sizeof
(paren
id|long_ad
)paren
suffix:semicolon
)brace
r_else
id|offset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fibh-&gt;sbh
op_assign
id|fibh-&gt;ebh
op_assign
id|udf_tread
c_func
(paren
id|dir-&gt;i_sb
comma
id|block
comma
id|dir-&gt;i_sb-&gt;s_blocksize
)paren
)paren
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|block
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|dir
)paren
dot
id|logicalBlockNum
suffix:semicolon
r_while
c_loop
(paren
(paren
id|f_pos
OL
id|size
)paren
)paren
(brace
id|fi
op_assign
id|udf_fileident_read
c_func
(paren
id|dir
comma
op_amp
id|f_pos
comma
id|fibh
comma
id|cfi
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|offset
comma
op_amp
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi
)paren
(brace
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_ne
id|fibh-&gt;ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh-&gt;ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|liu
op_assign
id|le16_to_cpu
c_func
(paren
id|cfi-&gt;lengthOfImpUse
)paren
suffix:semicolon
id|lfi
op_assign
id|cfi-&gt;lengthFileIdent
suffix:semicolon
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_eq
id|fibh-&gt;ebh
)paren
id|nameptr
op_assign
id|fi-&gt;fileIdent
op_plus
id|liu
suffix:semicolon
r_else
(brace
r_int
id|poffset
suffix:semicolon
multiline_comment|/* Unpaded ending offset */
id|poffset
op_assign
id|fibh-&gt;soffset
op_plus
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
op_plus
id|liu
op_plus
id|lfi
suffix:semicolon
r_if
c_cond
(paren
id|poffset
op_ge
id|lfi
)paren
id|nameptr
op_assign
(paren
r_char
op_star
)paren
(paren
id|fibh-&gt;ebh-&gt;b_data
op_plus
id|poffset
op_minus
id|lfi
)paren
suffix:semicolon
r_else
(brace
id|nameptr
op_assign
id|fname
suffix:semicolon
id|memcpy
c_func
(paren
id|nameptr
comma
id|fi-&gt;fileIdent
op_plus
id|liu
comma
id|lfi
op_minus
id|poffset
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|nameptr
op_plus
id|lfi
op_minus
id|poffset
comma
id|fibh-&gt;ebh-&gt;b_data
comma
id|poffset
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|cfi-&gt;fileCharacteristics
op_amp
id|FILE_DELETED
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
op_plus
id|liu
op_plus
id|lfi
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
)paren
op_eq
id|nfidlen
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|cfi-&gt;descTag.tagSerialNum
op_assign
id|cpu_to_le16
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cfi-&gt;fileVersionNum
op_assign
id|cpu_to_le16
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cfi-&gt;fileCharacteristics
op_assign
l_int|0
suffix:semicolon
id|cfi-&gt;lengthFileIdent
op_assign
id|namelen
suffix:semicolon
id|cfi-&gt;lengthOfImpUse
op_assign
id|cpu_to_le16
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|udf_write_fi
c_func
(paren
id|cfi
comma
id|fi
comma
id|fibh
comma
l_int|NULL
comma
id|name
)paren
)paren
r_return
id|fi
suffix:semicolon
r_else
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|lfi
op_logical_or
op_logical_neg
id|dentry
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flen
op_assign
id|udf_get_filename
c_func
(paren
id|nameptr
comma
id|fname
comma
id|lfi
)paren
)paren
op_logical_and
id|udf_match
c_func
(paren
id|flen
comma
id|fname
comma
op_amp
(paren
id|dentry-&gt;d_name
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_ne
id|fibh-&gt;ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh-&gt;ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
op_star
id|err
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|block
op_assign
id|udf_get_lb_pblock
c_func
(paren
id|dir-&gt;i_sb
comma
id|UDF_I_LOCATION
c_func
(paren
id|dir
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
)paren
(brace
id|fibh-&gt;sbh
op_assign
id|fibh-&gt;ebh
op_assign
id|udf_tread
c_func
(paren
id|dir-&gt;i_sb
comma
id|block
comma
id|dir-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|fibh-&gt;soffset
op_assign
id|fibh-&gt;eoffset
op_assign
id|udf_file_entry_alloc_offset
c_func
(paren
id|dir
)paren
suffix:semicolon
)brace
r_else
(brace
id|fibh-&gt;sbh
op_assign
id|fibh-&gt;ebh
op_assign
l_int|NULL
suffix:semicolon
id|fibh-&gt;soffset
op_assign
id|fibh-&gt;eoffset
op_assign
id|sb-&gt;s_blocksize
suffix:semicolon
)brace
)brace
id|f_pos
op_add_assign
id|nfidlen
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
op_logical_and
id|sb-&gt;s_blocksize
op_minus
id|fibh-&gt;eoffset
OL
id|nfidlen
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|bh
op_assign
l_int|NULL
suffix:semicolon
id|fibh-&gt;soffset
op_sub_assign
id|udf_ext0_offset
c_func
(paren
id|dir
)paren
suffix:semicolon
id|fibh-&gt;eoffset
op_sub_assign
id|udf_ext0_offset
c_func
(paren
id|dir
)paren
suffix:semicolon
id|f_pos
op_sub_assign
(paren
id|udf_ext0_offset
c_func
(paren
id|dir
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_ne
id|fibh-&gt;ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh-&gt;ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fibh-&gt;sbh
op_assign
id|fibh-&gt;ebh
op_assign
id|udf_expand_dir_adinicb
c_func
(paren
id|dir
comma
op_amp
id|block
comma
id|err
)paren
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|bloc
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|dir
)paren
suffix:semicolon
id|eloc.logicalBlockNum
op_assign
id|block
suffix:semicolon
id|eloc.partitionReferenceNum
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|dir
)paren
dot
id|partitionReferenceNum
suffix:semicolon
id|elen
op_assign
id|dir-&gt;i_sb-&gt;s_blocksize
suffix:semicolon
id|extoffset
op_assign
id|udf_file_entry_alloc_offset
c_func
(paren
id|dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_SHORT
)paren
id|extoffset
op_add_assign
r_sizeof
(paren
id|short_ad
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_LONG
)paren
id|extoffset
op_add_assign
r_sizeof
(paren
id|long_ad
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sb-&gt;s_blocksize
op_minus
id|fibh-&gt;eoffset
op_ge
id|nfidlen
)paren
(brace
id|fibh-&gt;soffset
op_assign
id|fibh-&gt;eoffset
suffix:semicolon
id|fibh-&gt;eoffset
op_add_assign
id|nfidlen
suffix:semicolon
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_ne
id|fibh-&gt;ebh
)paren
(brace
id|udf_release_data
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
id|fibh-&gt;sbh
op_assign
id|fibh-&gt;ebh
suffix:semicolon
)brace
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_ne
id|ICB_FLAG_AD_IN_ICB
)paren
id|block
op_assign
id|eloc.logicalBlockNum
op_plus
(paren
(paren
id|elen
op_minus
l_int|1
)paren
op_rshift
id|dir-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
r_else
id|block
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|dir
)paren
dot
id|logicalBlockNum
suffix:semicolon
id|fi
op_assign
(paren
r_struct
id|FileIdentDesc
op_star
)paren
(paren
id|fibh-&gt;sbh-&gt;b_data
op_plus
id|fibh-&gt;soffset
)paren
suffix:semicolon
)brace
r_else
(brace
id|fibh-&gt;soffset
op_assign
id|fibh-&gt;eoffset
op_minus
id|sb-&gt;s_blocksize
suffix:semicolon
id|fibh-&gt;eoffset
op_add_assign
id|nfidlen
op_minus
id|sb-&gt;s_blocksize
suffix:semicolon
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_ne
id|fibh-&gt;ebh
)paren
(brace
id|udf_release_data
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
id|fibh-&gt;sbh
op_assign
id|fibh-&gt;ebh
suffix:semicolon
)brace
id|block
op_assign
id|eloc.logicalBlockNum
op_plus
(paren
(paren
id|elen
op_minus
l_int|1
)paren
op_rshift
id|dir-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
op_star
id|err
op_assign
op_minus
id|ENOSPC
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fibh-&gt;ebh
op_assign
id|udf_bread
c_func
(paren
id|dir
comma
id|f_pos
op_rshift
(paren
id|dir-&gt;i_sb-&gt;s_blocksize_bits
op_minus
l_int|2
)paren
comma
l_int|1
comma
id|err
)paren
)paren
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fibh-&gt;soffset
)paren
)paren
(brace
r_if
c_cond
(paren
id|udf_next_aext
c_func
(paren
id|dir
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|bh
comma
l_int|1
)paren
op_eq
id|EXTENT_RECORDED_ALLOCATED
)paren
(brace
id|block
op_assign
id|eloc.logicalBlockNum
op_plus
(paren
(paren
id|elen
op_minus
l_int|1
)paren
op_rshift
id|dir-&gt;i_sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
)brace
r_else
id|block
op_increment
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
id|fibh-&gt;sbh
op_assign
id|fibh-&gt;ebh
suffix:semicolon
id|fi
op_assign
(paren
r_struct
id|FileIdentDesc
op_star
)paren
(paren
id|fibh-&gt;sbh-&gt;b_data
)paren
suffix:semicolon
)brace
r_else
(brace
id|fi
op_assign
(paren
r_struct
id|FileIdentDesc
op_star
)paren
(paren
id|fibh-&gt;sbh-&gt;b_data
op_plus
id|sb-&gt;s_blocksize
op_plus
id|fibh-&gt;soffset
)paren
suffix:semicolon
)brace
)brace
id|memset
c_func
(paren
id|cfi
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
)paren
suffix:semicolon
id|udf_new_tag
c_func
(paren
(paren
r_char
op_star
)paren
id|cfi
comma
id|TID_FILE_IDENT_DESC
comma
l_int|2
comma
l_int|1
comma
id|block
comma
r_sizeof
(paren
id|tag
)paren
)paren
suffix:semicolon
id|cfi-&gt;fileVersionNum
op_assign
id|cpu_to_le16
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cfi-&gt;lengthFileIdent
op_assign
id|namelen
suffix:semicolon
id|cfi-&gt;lengthOfImpUse
op_assign
id|cpu_to_le16
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|udf_write_fi
c_func
(paren
id|cfi
comma
id|fi
comma
id|fibh
comma
l_int|NULL
comma
id|name
)paren
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|dir-&gt;i_size
op_add_assign
id|nfidlen
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
)paren
id|UDF_I_LENALLOC
c_func
(paren
id|dir
)paren
op_add_assign
id|nfidlen
suffix:semicolon
id|dir-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|dir
)paren
suffix:semicolon
r_return
id|fi
suffix:semicolon
)brace
r_else
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fibh-&gt;sbh
op_ne
id|fibh-&gt;ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh-&gt;ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh-&gt;sbh
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|udf_delete_entry
r_static
r_int
id|udf_delete_entry
c_func
(paren
r_struct
id|FileIdentDesc
op_star
id|fi
comma
r_struct
id|udf_fileident_bh
op_star
id|fibh
comma
r_struct
id|FileIdentDesc
op_star
id|cfi
)paren
(brace
id|cfi-&gt;fileCharacteristics
op_or_assign
id|FILE_DELETED
suffix:semicolon
r_return
id|udf_write_fi
c_func
(paren
id|cfi
comma
id|fi
comma
id|fibh
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|udf_create
r_static
r_int
id|udf_create
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mode
)paren
(brace
r_struct
id|udf_fileident_bh
id|fibh
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|FileIdentDesc
id|cfi
comma
op_star
id|fi
suffix:semicolon
r_int
id|err
suffix:semicolon
id|inode
op_assign
id|udf_new_inode
c_func
(paren
id|dir
comma
id|mode
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
)paren
id|inode-&gt;i_data.a_ops
op_assign
op_amp
id|udf_adinicb_aops
suffix:semicolon
r_else
id|inode-&gt;i_data.a_ops
op_assign
op_amp
id|udf_aops
suffix:semicolon
id|inode-&gt;i_op
op_assign
op_amp
id|udf_file_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|udf_file_operations
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|mode
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fi
op_assign
id|udf_add_entry
c_func
(paren
id|dir
comma
id|dentry
comma
op_amp
id|fibh
comma
op_amp
id|cfi
comma
op_amp
id|err
)paren
)paren
)paren
(brace
id|inode-&gt;i_nlink
op_decrement
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|cfi.icb.extLength
op_assign
id|cpu_to_le32
c_func
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|cfi.icb.extLocation
op_assign
id|cpu_to_lelb
c_func
(paren
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
op_star
(paren
id|Uint32
op_star
)paren
(paren
(paren
r_struct
id|ADImpUse
op_star
)paren
id|cfi.icb.impUse
)paren
op_member_access_from_pointer
id|impUse
op_assign
id|cpu_to_le32
c_func
(paren
id|UDF_I_UNIQUE
c_func
(paren
id|inode
)paren
op_amp
l_int|0x00000000FFFFFFFFUL
)paren
suffix:semicolon
id|udf_write_fi
c_func
(paren
op_amp
id|cfi
comma
id|fi
comma
op_amp
id|fibh
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
)paren
(brace
id|mark_inode_dirty
c_func
(paren
id|dir
)paren
suffix:semicolon
id|dir-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fibh.sbh
op_ne
id|fibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|udf_mknod
r_static
r_int
id|udf_mknod
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mode
comma
r_int
id|rdev
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|udf_fileident_bh
id|fibh
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|FileIdentDesc
id|cfi
comma
op_star
id|fi
suffix:semicolon
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
id|inode
op_assign
id|udf_new_inode
c_func
(paren
id|dir
comma
id|mode
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_goto
id|out
suffix:semicolon
id|inode-&gt;i_uid
op_assign
id|current-&gt;fsuid
suffix:semicolon
id|init_special_inode
c_func
(paren
id|inode
comma
id|mode
comma
id|rdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fi
op_assign
id|udf_add_entry
c_func
(paren
id|dir
comma
id|dentry
comma
op_amp
id|fibh
comma
op_amp
id|cfi
comma
op_amp
id|err
)paren
)paren
)paren
(brace
id|inode-&gt;i_nlink
op_decrement
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|cfi.icb.extLength
op_assign
id|cpu_to_le32
c_func
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|cfi.icb.extLocation
op_assign
id|cpu_to_lelb
c_func
(paren
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
op_star
(paren
id|Uint32
op_star
)paren
(paren
(paren
r_struct
id|ADImpUse
op_star
)paren
id|cfi.icb.impUse
)paren
op_member_access_from_pointer
id|impUse
op_assign
id|cpu_to_le32
c_func
(paren
id|UDF_I_UNIQUE
c_func
(paren
id|inode
)paren
op_amp
l_int|0x00000000FFFFFFFFUL
)paren
suffix:semicolon
id|udf_write_fi
c_func
(paren
op_amp
id|cfi
comma
id|fi
comma
op_amp
id|fibh
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
)paren
(brace
id|mark_inode_dirty
c_func
(paren
id|dir
)paren
suffix:semicolon
id|dir-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
)brace
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fibh.sbh
op_ne
id|fibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|udf_mkdir
r_static
r_int
id|udf_mkdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mode
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|udf_fileident_bh
id|fibh
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|FileIdentDesc
id|cfi
comma
op_star
id|fi
suffix:semicolon
id|err
op_assign
op_minus
id|EMLINK
suffix:semicolon
r_if
c_cond
(paren
id|dir-&gt;i_nlink
op_ge
(paren
l_int|256
op_lshift
r_sizeof
(paren
id|dir-&gt;i_nlink
)paren
)paren
op_minus
l_int|1
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
id|inode
op_assign
id|udf_new_inode
c_func
(paren
id|dir
comma
id|S_IFDIR
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_goto
id|out
suffix:semicolon
id|inode-&gt;i_op
op_assign
op_amp
id|udf_dir_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|udf_dir_operations
suffix:semicolon
id|inode-&gt;i_size
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fi
op_assign
id|udf_add_entry
c_func
(paren
id|inode
comma
l_int|NULL
comma
op_amp
id|fibh
comma
op_amp
id|cfi
comma
op_amp
id|err
)paren
)paren
)paren
(brace
id|inode-&gt;i_nlink
op_decrement
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|inode-&gt;i_nlink
op_assign
l_int|2
suffix:semicolon
id|cfi.icb.extLength
op_assign
id|cpu_to_le32
c_func
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|cfi.icb.extLocation
op_assign
id|cpu_to_lelb
c_func
(paren
id|UDF_I_LOCATION
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
op_star
(paren
id|Uint32
op_star
)paren
(paren
(paren
r_struct
id|ADImpUse
op_star
)paren
id|cfi.icb.impUse
)paren
op_member_access_from_pointer
id|impUse
op_assign
id|cpu_to_le32
c_func
(paren
id|UDF_I_UNIQUE
c_func
(paren
id|dir
)paren
op_amp
l_int|0x00000000FFFFFFFFUL
)paren
suffix:semicolon
id|cfi.fileCharacteristics
op_assign
id|FILE_DIRECTORY
op_or
id|FILE_PARENT
suffix:semicolon
id|udf_write_fi
c_func
(paren
op_amp
id|cfi
comma
id|fi
comma
op_amp
id|fibh
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|S_IFDIR
op_or
id|mode
suffix:semicolon
r_if
c_cond
(paren
id|dir-&gt;i_mode
op_amp
id|S_ISGID
)paren
id|inode-&gt;i_mode
op_or_assign
id|S_ISGID
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fi
op_assign
id|udf_add_entry
c_func
(paren
id|dir
comma
id|dentry
comma
op_amp
id|fibh
comma
op_amp
id|cfi
comma
op_amp
id|err
)paren
)paren
)paren
(brace
id|inode-&gt;i_nlink
op_assign
l_int|0
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|cfi.icb.extLength
op_assign
id|cpu_to_le32
c_func
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|cfi.icb.extLocation
op_assign
id|cpu_to_lelb
c_func
(paren
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
op_star
(paren
id|Uint32
op_star
)paren
(paren
(paren
r_struct
id|ADImpUse
op_star
)paren
id|cfi.icb.impUse
)paren
op_member_access_from_pointer
id|impUse
op_assign
id|cpu_to_le32
c_func
(paren
id|UDF_I_UNIQUE
c_func
(paren
id|inode
)paren
op_amp
l_int|0x00000000FFFFFFFFUL
)paren
suffix:semicolon
id|cfi.fileCharacteristics
op_or_assign
id|FILE_DIRECTORY
suffix:semicolon
id|udf_write_fi
c_func
(paren
op_amp
id|cfi
comma
id|fi
comma
op_amp
id|fibh
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|dir-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
id|dir-&gt;i_nlink
op_increment
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|dir
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fibh.sbh
op_ne
id|fibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|empty_dir
r_static
r_int
id|empty_dir
c_func
(paren
r_struct
id|inode
op_star
id|dir
)paren
(brace
r_struct
id|FileIdentDesc
op_star
id|fi
comma
id|cfi
suffix:semicolon
r_struct
id|udf_fileident_bh
id|fibh
suffix:semicolon
id|loff_t
id|f_pos
suffix:semicolon
id|loff_t
id|size
op_assign
(paren
id|udf_ext0_offset
c_func
(paren
id|dir
)paren
op_plus
id|dir-&gt;i_size
)paren
op_rshift
l_int|2
suffix:semicolon
r_int
id|block
suffix:semicolon
id|lb_addr
id|bloc
comma
id|eloc
suffix:semicolon
id|Uint32
id|extoffset
comma
id|elen
comma
id|offset
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
id|f_pos
op_assign
(paren
id|udf_ext0_offset
c_func
(paren
id|dir
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
id|fibh.soffset
op_assign
id|fibh.eoffset
op_assign
(paren
id|f_pos
op_amp
(paren
(paren
id|dir-&gt;i_sb-&gt;s_blocksize
op_minus
l_int|1
)paren
op_rshift
l_int|2
)paren
)paren
op_lshift
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|inode_bmap
c_func
(paren
id|dir
comma
id|f_pos
op_rshift
(paren
id|dir-&gt;i_sb-&gt;s_blocksize_bits
op_minus
l_int|2
)paren
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|offset
comma
op_amp
id|bh
)paren
op_eq
id|EXTENT_RECORDED_ALLOCATED
)paren
(brace
id|block
op_assign
id|udf_get_lb_pblock
c_func
(paren
id|dir-&gt;i_sb
comma
id|eloc
comma
id|offset
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_increment
id|offset
op_lshift
id|dir-&gt;i_sb-&gt;s_blocksize_bits
)paren
OL
id|elen
)paren
(brace
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_SHORT
)paren
id|extoffset
op_sub_assign
r_sizeof
(paren
id|short_ad
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_LONG
)paren
id|extoffset
op_sub_assign
r_sizeof
(paren
id|long_ad
)paren
suffix:semicolon
)brace
r_else
id|offset
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fibh.sbh
op_assign
id|fibh.ebh
op_assign
id|udf_tread
c_func
(paren
id|dir-&gt;i_sb
comma
id|block
comma
id|dir-&gt;i_sb-&gt;s_blocksize
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|f_pos
OL
id|size
)paren
)paren
(brace
id|fi
op_assign
id|udf_fileident_read
c_func
(paren
id|dir
comma
op_amp
id|f_pos
comma
op_amp
id|fibh
comma
op_amp
id|cfi
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
op_amp
id|eloc
comma
op_amp
id|elen
comma
op_amp
id|offset
comma
op_amp
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi
)paren
(brace
r_if
c_cond
(paren
id|fibh.sbh
op_ne
id|fibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cfi.lengthFileIdent
op_logical_and
(paren
id|cfi.fileCharacteristics
op_amp
id|FILE_DELETED
)paren
op_eq
l_int|0
)paren
(brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|fibh.sbh
op_ne
id|fibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|udf_rmdir
r_static
r_int
id|udf_rmdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_int
id|retval
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|udf_fileident_bh
id|fibh
suffix:semicolon
r_struct
id|FileIdentDesc
op_star
id|fi
comma
id|cfi
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOENT
suffix:semicolon
id|fi
op_assign
id|udf_find_entry
c_func
(paren
id|dir
comma
id|dentry
comma
op_amp
id|fibh
comma
op_amp
id|cfi
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi
)paren
r_goto
id|out
suffix:semicolon
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
id|DQUOT_INIT
c_func
(paren
id|inode
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|udf_get_lb_pblock
c_func
(paren
id|dir-&gt;i_sb
comma
id|lelb_to_cpu
c_func
(paren
id|cfi.icb.extLocation
)paren
comma
l_int|0
)paren
op_ne
id|inode-&gt;i_ino
)paren
r_goto
id|end_rmdir
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOTEMPTY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|empty_dir
c_func
(paren
id|inode
)paren
)paren
r_goto
id|end_rmdir
suffix:semicolon
id|retval
op_assign
id|udf_delete_entry
c_func
(paren
id|fi
comma
op_amp
id|fibh
comma
op_amp
id|cfi
)paren
suffix:semicolon
id|dir-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|end_rmdir
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_nlink
op_ne
l_int|2
)paren
id|udf_warning
c_func
(paren
id|inode-&gt;i_sb
comma
l_string|&quot;udf_rmdir&quot;
comma
l_string|&quot;empty directory has nlink != 2 (%d)&quot;
comma
id|inode-&gt;i_nlink
)paren
suffix:semicolon
id|inode-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
id|inode-&gt;i_nlink
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;i_size
op_assign
l_int|0
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|dir-&gt;i_nlink
op_decrement
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|dir-&gt;i_ctime
op_assign
id|dir-&gt;i_mtime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|inode
)paren
op_assign
id|UDF_I_UCTIME
c_func
(paren
id|dir
)paren
op_assign
id|UDF_I_UMTIME
c_func
(paren
id|dir
)paren
op_assign
id|CURRENT_UTIME
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|dir
)paren
suffix:semicolon
id|end_rmdir
suffix:colon
r_if
c_cond
(paren
id|fibh.sbh
op_ne
id|fibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|udf_unlink
r_static
r_int
id|udf_unlink
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_int
id|retval
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|udf_fileident_bh
id|fibh
suffix:semicolon
r_struct
id|FileIdentDesc
op_star
id|fi
suffix:semicolon
r_struct
id|FileIdentDesc
id|cfi
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOENT
suffix:semicolon
id|fi
op_assign
id|udf_find_entry
c_func
(paren
id|dir
comma
id|dentry
comma
op_amp
id|fibh
comma
op_amp
id|cfi
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi
)paren
r_goto
id|out
suffix:semicolon
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
id|DQUOT_INIT
c_func
(paren
id|inode
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|udf_get_lb_pblock
c_func
(paren
id|dir-&gt;i_sb
comma
id|lelb_to_cpu
c_func
(paren
id|cfi.icb.extLocation
)paren
comma
l_int|0
)paren
op_ne
id|inode-&gt;i_ino
)paren
(brace
r_goto
id|end_unlink
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|inode-&gt;i_nlink
)paren
(brace
id|udf_debug
c_func
(paren
l_string|&quot;Deleting nonexistent file (%lu), %d&bslash;n&quot;
comma
id|inode-&gt;i_ino
comma
id|inode-&gt;i_nlink
)paren
suffix:semicolon
id|inode-&gt;i_nlink
op_assign
l_int|1
suffix:semicolon
)brace
id|retval
op_assign
id|udf_delete_entry
c_func
(paren
id|fi
comma
op_amp
id|fibh
comma
op_amp
id|cfi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|end_unlink
suffix:semicolon
id|dir-&gt;i_ctime
op_assign
id|dir-&gt;i_mtime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|dir
)paren
op_assign
id|UDF_I_UMTIME
c_func
(paren
id|dir
)paren
op_assign
id|CURRENT_UTIME
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|dir
)paren
suffix:semicolon
id|inode-&gt;i_nlink
op_decrement
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|dir-&gt;i_ctime
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
id|end_unlink
suffix:colon
r_if
c_cond
(paren
id|fibh.sbh
op_ne
id|fibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|udf_symlink
r_static
r_int
id|udf_symlink
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_const
r_char
op_star
id|symname
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|PathComponent
op_star
id|pc
suffix:semicolon
r_char
op_star
id|compstart
suffix:semicolon
r_struct
id|udf_fileident_bh
id|fibh
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_int
id|eoffset
comma
id|elen
op_assign
l_int|0
suffix:semicolon
r_struct
id|FileIdentDesc
op_star
id|fi
suffix:semicolon
r_struct
id|FileIdentDesc
id|cfi
suffix:semicolon
r_char
op_star
id|ea
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|block
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|inode
op_assign
id|udf_new_inode
c_func
(paren
id|dir
comma
id|S_IFLNK
comma
op_amp
id|err
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|S_IFLNK
op_or
id|S_IRWXUGO
suffix:semicolon
id|inode-&gt;i_data.a_ops
op_assign
op_amp
id|udf_symlink_aops
suffix:semicolon
id|inode-&gt;i_op
op_assign
op_amp
id|page_symlink_inode_operations
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_ne
id|ICB_FLAG_AD_IN_ICB
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
id|lb_addr
id|bloc
comma
id|eloc
suffix:semicolon
id|Uint32
id|elen
comma
id|extoffset
suffix:semicolon
id|block
op_assign
id|udf_new_block
c_func
(paren
id|inode
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|logicalBlockNum
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|block
)paren
r_goto
id|out_no_entry
suffix:semicolon
id|bloc
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
suffix:semicolon
id|eloc.logicalBlockNum
op_assign
id|block
suffix:semicolon
id|eloc.partitionReferenceNum
op_assign
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
suffix:semicolon
id|elen
op_assign
id|inode-&gt;i_sb-&gt;s_blocksize
suffix:semicolon
id|extoffset
op_assign
id|udf_file_entry_alloc_offset
c_func
(paren
id|inode
)paren
suffix:semicolon
id|udf_add_aext
c_func
(paren
id|inode
comma
op_amp
id|bloc
comma
op_amp
id|extoffset
comma
id|eloc
comma
id|elen
comma
op_amp
id|bh
comma
l_int|0
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|inode-&gt;i_blocks
op_assign
id|inode-&gt;i_sb-&gt;s_blocksize
op_div
l_int|512
suffix:semicolon
id|block
op_assign
id|udf_get_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|block
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
dot
id|partitionReferenceNum
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
id|block
op_assign
id|udf_get_lb_pblock
c_func
(paren
id|inode-&gt;i_sb
comma
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
comma
l_int|0
)paren
suffix:semicolon
id|bh
op_assign
id|udf_tread
c_func
(paren
id|inode-&gt;i_sb
comma
id|block
comma
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|ea
op_assign
id|bh-&gt;b_data
op_plus
id|udf_ext0_offset
c_func
(paren
id|inode
)paren
suffix:semicolon
id|eoffset
op_assign
id|inode-&gt;i_sb-&gt;s_blocksize
op_minus
id|udf_ext0_offset
c_func
(paren
id|inode
)paren
suffix:semicolon
id|pc
op_assign
(paren
r_struct
id|PathComponent
op_star
)paren
id|ea
suffix:semicolon
r_if
c_cond
(paren
op_star
id|symname
op_eq
l_char|&squot;/&squot;
)paren
(brace
r_do
(brace
id|symname
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
op_star
id|symname
op_eq
l_char|&squot;/&squot;
)paren
suffix:semicolon
id|pc-&gt;componentType
op_assign
l_int|1
suffix:semicolon
id|pc-&gt;lengthComponentIdent
op_assign
l_int|0
suffix:semicolon
id|pc-&gt;componentFileVersionNum
op_assign
l_int|0
suffix:semicolon
id|pc
op_add_assign
r_sizeof
(paren
r_struct
id|PathComponent
)paren
suffix:semicolon
id|elen
op_add_assign
r_sizeof
(paren
r_struct
id|PathComponent
)paren
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ENAMETOOLONG
suffix:semicolon
r_while
c_loop
(paren
op_star
id|symname
)paren
(brace
r_if
c_cond
(paren
id|elen
op_plus
r_sizeof
(paren
r_struct
id|PathComponent
)paren
OG
id|eoffset
)paren
r_goto
id|out_no_entry
suffix:semicolon
id|pc
op_assign
(paren
r_struct
id|PathComponent
op_star
)paren
(paren
id|ea
op_plus
id|elen
)paren
suffix:semicolon
id|compstart
op_assign
(paren
r_char
op_star
)paren
id|symname
suffix:semicolon
r_do
(brace
id|symname
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
op_star
id|symname
op_logical_and
op_star
id|symname
op_ne
l_char|&squot;/&squot;
)paren
suffix:semicolon
id|pc-&gt;componentType
op_assign
l_int|5
suffix:semicolon
id|pc-&gt;lengthComponentIdent
op_assign
l_int|0
suffix:semicolon
id|pc-&gt;componentFileVersionNum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pc-&gt;componentIdent
(braket
l_int|0
)braket
op_eq
l_char|&squot;.&squot;
)paren
(brace
r_if
c_cond
(paren
id|pc-&gt;lengthComponentIdent
op_eq
l_int|1
)paren
id|pc-&gt;componentType
op_assign
l_int|4
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pc-&gt;lengthComponentIdent
op_eq
l_int|2
op_logical_and
id|pc-&gt;componentIdent
(braket
l_int|1
)braket
op_eq
l_char|&squot;.&squot;
)paren
id|pc-&gt;componentType
op_assign
l_int|3
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pc-&gt;componentType
op_eq
l_int|5
)paren
(brace
r_if
c_cond
(paren
id|elen
op_plus
r_sizeof
(paren
r_struct
id|PathComponent
)paren
op_plus
id|symname
op_minus
id|compstart
OG
id|eoffset
)paren
r_goto
id|out_no_entry
suffix:semicolon
r_else
id|pc-&gt;lengthComponentIdent
op_assign
id|symname
op_minus
id|compstart
suffix:semicolon
id|memcpy
c_func
(paren
id|pc-&gt;componentIdent
comma
id|compstart
comma
id|pc-&gt;lengthComponentIdent
)paren
suffix:semicolon
)brace
id|elen
op_add_assign
r_sizeof
(paren
r_struct
id|PathComponent
)paren
op_plus
id|pc-&gt;lengthComponentIdent
suffix:semicolon
r_if
c_cond
(paren
op_star
id|symname
)paren
(brace
r_do
(brace
id|symname
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
op_star
id|symname
op_eq
l_char|&squot;/&squot;
)paren
suffix:semicolon
)brace
)brace
id|udf_release_data
c_func
(paren
id|bh
)paren
suffix:semicolon
id|inode-&gt;i_size
op_assign
id|elen
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|inode
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
)paren
id|UDF_I_LENALLOC
c_func
(paren
id|inode
)paren
op_assign
id|inode-&gt;i_size
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fi
op_assign
id|udf_add_entry
c_func
(paren
id|dir
comma
id|dentry
comma
op_amp
id|fibh
comma
op_amp
id|cfi
comma
op_amp
id|err
)paren
)paren
)paren
r_goto
id|out_no_entry
suffix:semicolon
id|cfi.icb.extLength
op_assign
id|cpu_to_le32
c_func
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|cfi.icb.extLocation
op_assign
id|cpu_to_lelb
c_func
(paren
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|inode-&gt;i_sb
)paren
)paren
(brace
r_struct
id|LogicalVolHeaderDesc
op_star
id|lvhd
suffix:semicolon
id|Uint64
id|uniqueID
suffix:semicolon
id|lvhd
op_assign
(paren
r_struct
id|LogicalVolHeaderDesc
op_star
)paren
(paren
id|UDF_SB_LVID
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|logicalVolContentsUse
)paren
suffix:semicolon
id|uniqueID
op_assign
id|le64_to_cpu
c_func
(paren
id|lvhd-&gt;uniqueID
)paren
suffix:semicolon
op_star
(paren
id|Uint32
op_star
)paren
(paren
(paren
r_struct
id|ADImpUse
op_star
)paren
id|cfi.icb.impUse
)paren
op_member_access_from_pointer
id|impUse
op_assign
id|cpu_to_le32
c_func
(paren
id|uniqueID
op_amp
l_int|0x00000000FFFFFFFFUL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_increment
id|uniqueID
op_amp
l_int|0x00000000FFFFFFFFUL
)paren
)paren
id|uniqueID
op_add_assign
l_int|16
suffix:semicolon
id|lvhd-&gt;uniqueID
op_assign
id|cpu_to_le64
c_func
(paren
id|uniqueID
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|inode-&gt;i_sb
)paren
)paren
suffix:semicolon
)brace
id|udf_write_fi
c_func
(paren
op_amp
id|cfi
comma
id|fi
comma
op_amp
id|fibh
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
)paren
(brace
id|mark_inode_dirty
c_func
(paren
id|dir
)paren
suffix:semicolon
id|dir-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fibh.sbh
op_ne
id|fibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
id|out_no_entry
suffix:colon
id|inode-&gt;i_nlink
op_decrement
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|udf_link
r_static
r_int
id|udf_link
c_func
(paren
r_struct
id|dentry
op_star
id|old_dentry
comma
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|old_dentry-&gt;d_inode
suffix:semicolon
r_struct
id|udf_fileident_bh
id|fibh
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|FileIdentDesc
id|cfi
comma
op_star
id|fi
suffix:semicolon
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_nlink
op_ge
(paren
l_int|256
op_lshift
r_sizeof
(paren
id|inode-&gt;i_nlink
)paren
)paren
op_minus
l_int|1
)paren
r_return
op_minus
id|EMLINK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fi
op_assign
id|udf_add_entry
c_func
(paren
id|dir
comma
id|dentry
comma
op_amp
id|fibh
comma
op_amp
id|cfi
comma
op_amp
id|err
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|cfi.icb.extLength
op_assign
id|cpu_to_le32
c_func
(paren
id|inode-&gt;i_sb-&gt;s_blocksize
)paren
suffix:semicolon
id|cfi.icb.extLocation
op_assign
id|cpu_to_lelb
c_func
(paren
id|UDF_I_LOCATION
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|inode-&gt;i_sb
)paren
)paren
(brace
r_struct
id|LogicalVolHeaderDesc
op_star
id|lvhd
suffix:semicolon
id|Uint64
id|uniqueID
suffix:semicolon
id|lvhd
op_assign
(paren
r_struct
id|LogicalVolHeaderDesc
op_star
)paren
(paren
id|UDF_SB_LVID
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|logicalVolContentsUse
)paren
suffix:semicolon
id|uniqueID
op_assign
id|le64_to_cpu
c_func
(paren
id|lvhd-&gt;uniqueID
)paren
suffix:semicolon
op_star
(paren
id|Uint32
op_star
)paren
(paren
(paren
r_struct
id|ADImpUse
op_star
)paren
id|cfi.icb.impUse
)paren
op_member_access_from_pointer
id|impUse
op_assign
id|cpu_to_le32
c_func
(paren
id|uniqueID
op_amp
l_int|0x00000000FFFFFFFFUL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_increment
id|uniqueID
op_amp
l_int|0x00000000FFFFFFFFUL
)paren
)paren
id|uniqueID
op_add_assign
l_int|16
suffix:semicolon
id|lvhd-&gt;uniqueID
op_assign
id|cpu_to_le64
c_func
(paren
id|uniqueID
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|UDF_SB_LVIDBH
c_func
(paren
id|inode-&gt;i_sb
)paren
)paren
suffix:semicolon
)brace
id|udf_write_fi
c_func
(paren
op_amp
id|cfi
comma
id|fi
comma
op_amp
id|fibh
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|dir
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
)paren
(brace
id|mark_inode_dirty
c_func
(paren
id|dir
)paren
suffix:semicolon
id|dir-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fibh.sbh
op_ne
id|fibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|fibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|fibh.sbh
)paren
suffix:semicolon
id|inode-&gt;i_nlink
op_increment
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|inode
)paren
op_assign
id|CURRENT_UTIME
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|inode
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|inode-&gt;i_count
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Anybody can rename anything with this: the permission checks are left to the&n; * higher-level routines.&n; */
DECL|function|udf_rename
r_static
r_int
id|udf_rename
(paren
r_struct
id|inode
op_star
id|old_dir
comma
r_struct
id|dentry
op_star
id|old_dentry
comma
r_struct
id|inode
op_star
id|new_dir
comma
r_struct
id|dentry
op_star
id|new_dentry
)paren
(brace
r_struct
id|inode
op_star
id|old_inode
comma
op_star
id|new_inode
suffix:semicolon
r_struct
id|udf_fileident_bh
id|ofibh
comma
id|nfibh
suffix:semicolon
r_struct
id|FileIdentDesc
op_star
id|ofi
op_assign
l_int|NULL
comma
op_star
id|nfi
op_assign
l_int|NULL
comma
op_star
id|dir_fi
op_assign
l_int|NULL
comma
id|ocfi
comma
id|ncfi
suffix:semicolon
r_struct
id|buffer_head
op_star
id|dir_bh
op_assign
l_int|NULL
suffix:semicolon
r_int
id|retval
op_assign
op_minus
id|ENOENT
suffix:semicolon
id|old_inode
op_assign
id|old_dentry-&gt;d_inode
suffix:semicolon
id|ofi
op_assign
id|udf_find_entry
c_func
(paren
id|old_dir
comma
id|old_dentry
comma
op_amp
id|ofibh
comma
op_amp
id|ocfi
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ofi
op_logical_or
id|udf_get_lb_pblock
c_func
(paren
id|old_dir-&gt;i_sb
comma
id|lelb_to_cpu
c_func
(paren
id|ocfi.icb.extLocation
)paren
comma
l_int|0
)paren
op_ne
id|old_inode-&gt;i_ino
)paren
(brace
r_goto
id|end_rename
suffix:semicolon
)brace
id|new_inode
op_assign
id|new_dentry-&gt;d_inode
suffix:semicolon
id|nfi
op_assign
id|udf_find_entry
c_func
(paren
id|new_dir
comma
id|new_dentry
comma
op_amp
id|nfibh
comma
op_amp
id|ncfi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nfi
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|new_inode
)paren
(brace
r_if
c_cond
(paren
id|nfibh.sbh
op_ne
id|nfibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|nfibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|nfibh.sbh
)paren
suffix:semicolon
id|nfi
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|DQUOT_INIT
c_func
(paren
id|new_inode
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|old_inode-&gt;i_mode
)paren
)paren
(brace
id|Uint32
id|offset
op_assign
id|udf_ext0_offset
c_func
(paren
id|old_inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_inode
)paren
(brace
id|retval
op_assign
op_minus
id|ENOTEMPTY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|empty_dir
c_func
(paren
id|new_inode
)paren
)paren
r_goto
id|end_rename
suffix:semicolon
)brace
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
id|dir_bh
op_assign
id|udf_bread
c_func
(paren
id|old_inode
comma
l_int|0
comma
l_int|0
comma
op_amp
id|retval
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dir_bh
)paren
r_goto
id|end_rename
suffix:semicolon
id|dir_fi
op_assign
id|udf_get_fileident
c_func
(paren
id|dir_bh-&gt;b_data
comma
id|old_inode-&gt;i_sb-&gt;s_blocksize
comma
op_amp
id|offset
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dir_fi
)paren
r_goto
id|end_rename
suffix:semicolon
r_if
c_cond
(paren
id|udf_get_lb_pblock
c_func
(paren
id|old_inode-&gt;i_sb
comma
id|cpu_to_lelb
c_func
(paren
id|dir_fi-&gt;icb.extLocation
)paren
comma
l_int|0
)paren
op_ne
id|old_dir-&gt;i_ino
)paren
(brace
r_goto
id|end_rename
suffix:semicolon
)brace
id|retval
op_assign
op_minus
id|EMLINK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_inode
op_logical_and
id|new_dir-&gt;i_nlink
op_ge
(paren
l_int|256
op_lshift
r_sizeof
(paren
id|new_dir-&gt;i_nlink
)paren
)paren
op_minus
l_int|1
)paren
r_goto
id|end_rename
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|nfi
)paren
(brace
id|nfi
op_assign
id|udf_add_entry
c_func
(paren
id|new_dir
comma
id|new_dentry
comma
op_amp
id|nfibh
comma
op_amp
id|ncfi
comma
op_amp
id|retval
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfi
)paren
r_goto
id|end_rename
suffix:semicolon
)brace
id|new_dir-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
multiline_comment|/*&n;&t; * Like most other Unix systems, set the ctime for inodes on a&n;&t; * rename.&n;&t; */
id|old_inode-&gt;i_ctime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|old_inode
)paren
op_assign
id|CURRENT_UTIME
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|old_inode
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * ok, that&squot;s it&n;&t; */
id|ncfi.fileVersionNum
op_assign
id|ocfi.fileVersionNum
suffix:semicolon
id|ncfi.fileCharacteristics
op_assign
id|ocfi.fileCharacteristics
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
id|ncfi.icb
)paren
comma
op_amp
(paren
id|ocfi.icb
)paren
comma
r_sizeof
(paren
id|long_ad
)paren
)paren
suffix:semicolon
id|udf_write_fi
c_func
(paren
op_amp
id|ncfi
comma
id|nfi
comma
op_amp
id|nfibh
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|udf_delete_entry
c_func
(paren
id|ofi
comma
op_amp
id|ofibh
comma
op_amp
id|ocfi
)paren
suffix:semicolon
id|old_dir-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
r_if
c_cond
(paren
id|new_inode
)paren
(brace
id|new_inode-&gt;i_nlink
op_decrement
suffix:semicolon
id|new_inode-&gt;i_ctime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|new_inode
)paren
op_assign
id|CURRENT_UTIME
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|new_inode
)paren
suffix:semicolon
)brace
id|old_dir-&gt;i_ctime
op_assign
id|old_dir-&gt;i_mtime
op_assign
id|CURRENT_TIME
suffix:semicolon
id|UDF_I_UCTIME
c_func
(paren
id|old_dir
)paren
op_assign
id|UDF_I_UMTIME
c_func
(paren
id|old_dir
)paren
op_assign
id|CURRENT_UTIME
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|old_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dir_bh
)paren
(brace
id|dir_fi-&gt;icb.extLocation
op_assign
id|lelb_to_cpu
c_func
(paren
id|UDF_I_LOCATION
c_func
(paren
id|new_dir
)paren
)paren
suffix:semicolon
id|udf_update_tag
c_func
(paren
(paren
r_char
op_star
)paren
id|dir_fi
comma
r_sizeof
(paren
r_struct
id|FileIdentDesc
)paren
op_plus
id|cpu_to_le16
c_func
(paren
id|dir_fi-&gt;lengthOfImpUse
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UDF_I_ALLOCTYPE
c_func
(paren
id|old_inode
)paren
op_eq
id|ICB_FLAG_AD_IN_ICB
)paren
(brace
id|mark_inode_dirty
c_func
(paren
id|old_inode
)paren
suffix:semicolon
id|old_inode-&gt;i_version
op_assign
op_increment
id|event
suffix:semicolon
)brace
r_else
id|mark_buffer_dirty
c_func
(paren
id|dir_bh
)paren
suffix:semicolon
id|old_dir-&gt;i_nlink
op_decrement
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|old_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_inode
)paren
(brace
id|new_inode-&gt;i_nlink
op_decrement
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|new_inode
)paren
suffix:semicolon
)brace
r_else
(brace
id|new_dir-&gt;i_nlink
op_increment
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|new_dir
)paren
suffix:semicolon
)brace
)brace
id|retval
op_assign
l_int|0
suffix:semicolon
id|end_rename
suffix:colon
id|udf_release_data
c_func
(paren
id|dir_bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ofi
)paren
(brace
r_if
c_cond
(paren
id|ofibh.sbh
op_ne
id|ofibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|ofibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|ofibh.sbh
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nfi
)paren
(brace
r_if
c_cond
(paren
id|nfibh.sbh
op_ne
id|nfibh.ebh
)paren
id|udf_release_data
c_func
(paren
id|nfibh.ebh
)paren
suffix:semicolon
id|udf_release_data
c_func
(paren
id|nfibh.sbh
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|variable|udf_dir_inode_operations
r_struct
id|inode_operations
id|udf_dir_inode_operations
op_assign
(brace
id|lookup
suffix:colon
id|udf_lookup
comma
id|create
suffix:colon
id|udf_create
comma
id|link
suffix:colon
id|udf_link
comma
id|unlink
suffix:colon
id|udf_unlink
comma
id|symlink
suffix:colon
id|udf_symlink
comma
id|mkdir
suffix:colon
id|udf_mkdir
comma
id|rmdir
suffix:colon
id|udf_rmdir
comma
id|mknod
suffix:colon
id|udf_mknod
comma
id|rename
suffix:colon
id|udf_rename
comma
)brace
suffix:semicolon
eof
