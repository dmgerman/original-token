multiline_comment|/* $Id: inode.c,v 1.13 2000/08/12 13:25:46 davem Exp $&n; * openpromfs.c: /proc/openprom handling routines&n; *&n; * Copyright (C) 1996-1999 Jakub Jelinek  (jakub@redhat.com)&n; * Copyright (C) 1998      Eddie C. Dost  (ecd@skynet.be)&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/openprom_fs.h&gt;
macro_line|#include &lt;linux/locks.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|macro|ALIASES_NNODES
mdefine_line|#define ALIASES_NNODES 64
r_typedef
r_struct
(brace
DECL|member|parent
id|u16
id|parent
suffix:semicolon
DECL|member|next
id|u16
id|next
suffix:semicolon
DECL|member|child
id|u16
id|child
suffix:semicolon
DECL|member|first_prop
id|u16
id|first_prop
suffix:semicolon
DECL|member|node
id|u32
id|node
suffix:semicolon
DECL|typedef|openpromfs_node
)brace
id|openpromfs_node
suffix:semicolon
r_typedef
r_struct
(brace
DECL|macro|OPP_STRING
mdefine_line|#define OPP_STRING&t;0x10
DECL|macro|OPP_STRINGLIST
mdefine_line|#define OPP_STRINGLIST&t;0x20
DECL|macro|OPP_BINARY
mdefine_line|#define OPP_BINARY&t;0x40
DECL|macro|OPP_HEXSTRING
mdefine_line|#define OPP_HEXSTRING&t;0x80
DECL|macro|OPP_DIRTY
mdefine_line|#define OPP_DIRTY&t;0x01
DECL|macro|OPP_QUOTED
mdefine_line|#define OPP_QUOTED&t;0x02
DECL|macro|OPP_NOTQUOTED
mdefine_line|#define OPP_NOTQUOTED&t;0x04
DECL|macro|OPP_ASCIIZ
mdefine_line|#define OPP_ASCIIZ&t;0x08
DECL|member|flag
id|u32
id|flag
suffix:semicolon
DECL|member|alloclen
id|u32
id|alloclen
suffix:semicolon
DECL|member|len
id|u32
id|len
suffix:semicolon
DECL|member|value
r_char
op_star
id|value
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
l_int|8
)braket
suffix:semicolon
DECL|typedef|openprom_property
)brace
id|openprom_property
suffix:semicolon
DECL|variable|nodes
r_static
id|openpromfs_node
op_star
id|nodes
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|alloced
r_static
r_int
id|alloced
op_assign
l_int|0
suffix:semicolon
DECL|variable|last_node
r_static
id|u16
id|last_node
op_assign
l_int|0
suffix:semicolon
DECL|variable|first_prop
r_static
id|u16
id|first_prop
op_assign
l_int|0
suffix:semicolon
DECL|variable|options
r_static
id|u16
id|options
op_assign
l_int|0xffff
suffix:semicolon
DECL|variable|aliases
r_static
id|u16
id|aliases
op_assign
l_int|0xffff
suffix:semicolon
DECL|variable|aliases_nodes
r_static
r_int
id|aliases_nodes
op_assign
l_int|0
suffix:semicolon
DECL|variable|alias_names
r_static
r_char
op_star
id|alias_names
(braket
id|ALIASES_NNODES
)braket
suffix:semicolon
DECL|macro|OPENPROM_ROOT_INO
mdefine_line|#define OPENPROM_ROOT_INO&t;16
DECL|macro|OPENPROM_FIRST_INO
mdefine_line|#define OPENPROM_FIRST_INO&t;OPENPROM_ROOT_INO
DECL|macro|NODE
mdefine_line|#define NODE(ino) nodes[ino - OPENPROM_FIRST_INO]
DECL|macro|NODE2INO
mdefine_line|#define NODE2INO(node) (node + OPENPROM_FIRST_INO)
DECL|macro|NODEP2INO
mdefine_line|#define NODEP2INO(no) (no + OPENPROM_FIRST_INO + last_node)
r_static
r_int
id|openpromfs_create
(paren
r_struct
id|inode
op_star
comma
r_struct
id|dentry
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|openpromfs_readdir
c_func
(paren
r_struct
id|file
op_star
comma
r_void
op_star
comma
id|filldir_t
)paren
suffix:semicolon
r_static
r_struct
id|dentry
op_star
id|openpromfs_lookup
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|dentry
op_star
id|dentry
)paren
suffix:semicolon
r_static
r_int
id|openpromfs_unlink
(paren
r_struct
id|inode
op_star
comma
r_struct
id|dentry
op_star
id|dentry
)paren
suffix:semicolon
DECL|function|nodenum_read
r_static
id|ssize_t
id|nodenum_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_char
id|buffer
(braket
l_int|10
)braket
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
op_logical_or
op_logical_neg
id|inode-&gt;u.generic_ip
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sprintf
(paren
id|buffer
comma
l_string|&quot;%8.8x&bslash;n&quot;
comma
(paren
id|u32
)paren
(paren
r_int
)paren
(paren
id|inode-&gt;u.generic_ip
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
op_ge
l_int|9
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|9
op_minus
id|file-&gt;f_pos
)paren
id|count
op_assign
l_int|9
op_minus
id|file-&gt;f_pos
suffix:semicolon
id|copy_to_user
c_func
(paren
id|buf
comma
id|buffer
op_plus
id|file-&gt;f_pos
comma
id|count
)paren
suffix:semicolon
id|file-&gt;f_pos
op_add_assign
id|count
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|property_read
r_static
id|ssize_t
id|property_read
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
id|u32
id|node
suffix:semicolon
r_char
op_star
id|p
comma
op_star
id|s
suffix:semicolon
id|u32
op_star
id|q
suffix:semicolon
id|openprom_property
op_star
id|op
suffix:semicolon
r_char
id|buffer
(braket
l_int|64
)braket
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_pos
op_ge
l_int|0xffffff
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|filp-&gt;private_data
)paren
(brace
id|node
op_assign
id|nodes
(braket
(paren
id|u16
)paren
(paren
(paren
r_int
)paren
id|inode-&gt;u.generic_ip
)paren
)braket
dot
id|node
suffix:semicolon
id|i
op_assign
(paren
(paren
id|u32
)paren
(paren
r_int
)paren
id|inode-&gt;u.generic_ip
)paren
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u16
)paren
(paren
(paren
r_int
)paren
id|inode-&gt;u.generic_ip
)paren
op_eq
id|aliases
)paren
(brace
r_if
c_cond
(paren
id|i
op_ge
id|aliases_nodes
)paren
id|p
op_assign
l_int|0
suffix:semicolon
r_else
id|p
op_assign
id|alias_names
(braket
id|i
)braket
suffix:semicolon
)brace
r_else
r_for
c_loop
(paren
id|p
op_assign
id|prom_firstprop
(paren
id|node
comma
id|buffer
)paren
suffix:semicolon
id|i
op_logical_and
id|p
op_logical_and
op_star
id|p
suffix:semicolon
id|p
op_assign
id|prom_nextprop
(paren
id|node
comma
id|p
comma
id|buffer
)paren
comma
id|i
op_decrement
)paren
multiline_comment|/* nothing */
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
op_logical_or
op_logical_neg
op_star
id|p
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|i
op_assign
id|prom_getproplen
(paren
id|node
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|u16
)paren
(paren
(paren
r_int
)paren
id|inode-&gt;u.generic_ip
)paren
op_eq
id|aliases
)paren
id|i
op_assign
l_int|0
suffix:semicolon
r_else
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|k
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|64
)paren
id|i
op_assign
l_int|64
suffix:semicolon
id|filp-&gt;private_data
op_assign
id|kmalloc
(paren
r_sizeof
(paren
id|openprom_property
)paren
op_plus
(paren
id|j
op_assign
id|strlen
(paren
id|p
)paren
)paren
op_plus
l_int|2
op_star
id|i
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|filp-&gt;private_data
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|op
op_assign
(paren
id|openprom_property
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
id|op-&gt;flag
op_assign
l_int|0
suffix:semicolon
id|op-&gt;alloclen
op_assign
l_int|2
op_star
id|i
suffix:semicolon
id|strcpy
(paren
id|op-&gt;name
comma
id|p
)paren
suffix:semicolon
id|op-&gt;value
op_assign
(paren
r_char
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
(paren
id|op-&gt;name
op_plus
id|j
op_plus
l_int|4
)paren
)paren
op_amp
op_complement
l_int|3
)paren
suffix:semicolon
id|op-&gt;len
op_assign
id|k
suffix:semicolon
r_if
c_cond
(paren
id|k
op_logical_and
id|prom_getproperty
(paren
id|node
comma
id|p
comma
id|op-&gt;value
comma
id|i
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|op-&gt;value
(braket
id|k
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|k
)paren
(brace
r_for
c_loop
(paren
id|s
op_assign
l_int|0
comma
id|p
op_assign
id|op-&gt;value
suffix:semicolon
id|p
OL
id|op-&gt;value
op_plus
id|k
suffix:semicolon
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
op_star
id|p
op_ge
l_char|&squot; &squot;
op_logical_and
op_star
id|p
op_le
l_char|&squot;~&squot;
)paren
op_logical_or
op_star
id|p
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
id|op-&gt;flag
op_or_assign
id|OPP_STRING
suffix:semicolon
id|s
op_assign
id|p
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
OG
id|op-&gt;value
op_logical_and
op_logical_neg
op_star
id|p
op_logical_and
id|s
op_eq
id|p
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|p
OL
id|op-&gt;value
op_plus
id|k
op_minus
l_int|1
)paren
id|op-&gt;flag
op_or_assign
id|OPP_STRINGLIST
suffix:semicolon
r_else
id|op-&gt;flag
op_or_assign
id|OPP_ASCIIZ
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
op_eq
l_int|1
op_logical_and
op_logical_neg
op_star
id|p
)paren
(brace
id|op-&gt;flag
op_or_assign
(paren
id|OPP_STRING
op_or
id|OPP_ASCIIZ
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|op-&gt;flag
op_and_assign
op_complement
(paren
id|OPP_STRING
op_or
id|OPP_STRINGLIST
)paren
suffix:semicolon
r_if
c_cond
(paren
id|k
op_amp
l_int|3
)paren
id|op-&gt;flag
op_or_assign
id|OPP_HEXSTRING
suffix:semicolon
r_else
id|op-&gt;flag
op_or_assign
id|OPP_BINARY
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_STRINGLIST
)paren
id|op-&gt;flag
op_and_assign
op_complement
(paren
id|OPP_STRING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_ASCIIZ
)paren
id|op-&gt;len
op_decrement
suffix:semicolon
)brace
)brace
r_else
id|op
op_assign
(paren
id|openprom_property
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
op_logical_or
op_logical_neg
(paren
id|op-&gt;len
op_logical_or
(paren
id|op-&gt;flag
op_amp
id|OPP_ASCIIZ
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_STRINGLIST
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
comma
id|p
op_assign
id|op-&gt;value
suffix:semicolon
id|p
OL
id|op-&gt;value
op_plus
id|op-&gt;len
suffix:semicolon
id|p
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
)paren
id|k
op_increment
suffix:semicolon
id|i
op_assign
id|op-&gt;len
op_plus
l_int|4
op_star
id|k
op_plus
l_int|3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_STRING
)paren
(brace
id|i
op_assign
id|op-&gt;len
op_plus
l_int|3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_BINARY
)paren
(brace
id|i
op_assign
(paren
id|op-&gt;len
op_star
l_int|9
)paren
op_rshift
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|i
op_assign
(paren
id|op-&gt;len
op_lshift
l_int|1
)paren
op_plus
l_int|1
suffix:semicolon
)brace
id|k
op_assign
id|filp-&gt;f_pos
suffix:semicolon
r_if
c_cond
(paren
id|k
op_ge
id|i
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|i
op_minus
id|k
)paren
id|count
op_assign
id|i
op_minus
id|k
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_STRING
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|k
)paren
(brace
id|__put_user
c_func
(paren
l_char|&squot;&bslash;&squot;&squot;
comma
id|buf
)paren
suffix:semicolon
id|k
op_increment
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
op_plus
id|count
op_ge
id|i
op_minus
l_int|2
)paren
id|j
op_assign
id|i
op_minus
l_int|2
op_minus
id|k
suffix:semicolon
r_else
id|j
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|j
op_ge
l_int|0
)paren
(brace
id|copy_to_user
c_func
(paren
id|buf
op_plus
id|k
op_minus
id|filp-&gt;f_pos
comma
id|op-&gt;value
op_plus
id|k
op_minus
l_int|1
comma
id|j
)paren
suffix:semicolon
id|count
op_sub_assign
id|j
suffix:semicolon
id|k
op_add_assign
id|j
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
)paren
id|__put_user
c_func
(paren
l_char|&squot;&bslash;&squot;&squot;
comma
op_amp
id|buf
(braket
id|k
op_increment
op_minus
id|filp-&gt;f_pos
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|1
)paren
id|__put_user
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
op_amp
id|buf
(braket
id|k
op_increment
op_minus
id|filp-&gt;f_pos
)braket
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_STRINGLIST
)paren
(brace
r_char
op_star
id|tmp
suffix:semicolon
id|tmp
op_assign
id|kmalloc
(paren
id|i
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tmp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|s
op_assign
id|tmp
suffix:semicolon
op_star
id|s
op_increment
op_assign
l_char|&squot;&bslash;&squot;&squot;
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|op-&gt;value
suffix:semicolon
id|p
OL
id|op-&gt;value
op_plus
id|op-&gt;len
suffix:semicolon
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
)paren
(brace
id|strcpy
c_func
(paren
id|s
comma
l_string|&quot;&squot; + &squot;&quot;
)paren
suffix:semicolon
id|s
op_add_assign
l_int|5
suffix:semicolon
r_continue
suffix:semicolon
)brace
op_star
id|s
op_increment
op_assign
op_star
id|p
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|s
comma
l_string|&quot;&squot;&bslash;n&quot;
)paren
suffix:semicolon
id|copy_to_user
c_func
(paren
id|buf
comma
id|tmp
op_plus
id|k
comma
id|count
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|k
op_add_assign
id|count
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_BINARY
)paren
(brace
r_char
id|buffer
(braket
l_int|10
)braket
suffix:semicolon
id|u32
op_star
id|first
comma
op_star
id|last
suffix:semicolon
r_int
id|first_off
comma
id|last_cnt
suffix:semicolon
id|first
op_assign
(paren
(paren
id|u32
op_star
)paren
id|op-&gt;value
)paren
op_plus
id|k
op_div
l_int|9
suffix:semicolon
id|first_off
op_assign
id|k
op_mod
l_int|9
suffix:semicolon
id|last
op_assign
(paren
(paren
id|u32
op_star
)paren
id|op-&gt;value
)paren
op_plus
(paren
id|k
op_plus
id|count
op_minus
l_int|1
)paren
op_div
l_int|9
suffix:semicolon
id|last_cnt
op_assign
(paren
id|k
op_plus
id|count
)paren
op_mod
l_int|9
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|last_cnt
)paren
id|last_cnt
op_assign
l_int|9
suffix:semicolon
r_if
c_cond
(paren
id|first
op_eq
id|last
)paren
(brace
id|sprintf
(paren
id|buffer
comma
l_string|&quot;%08x.&quot;
comma
op_star
id|first
)paren
suffix:semicolon
id|copy_to_user
(paren
id|buf
comma
id|buffer
op_plus
id|first_off
comma
id|last_cnt
op_minus
id|first_off
)paren
suffix:semicolon
id|buf
op_add_assign
id|last_cnt
op_minus
id|first_off
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|q
op_assign
id|first
suffix:semicolon
id|q
op_le
id|last
suffix:semicolon
id|q
op_increment
)paren
(brace
id|sprintf
(paren
id|buffer
comma
l_string|&quot;%08x.&quot;
comma
op_star
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
id|first
)paren
(brace
id|copy_to_user
(paren
id|buf
comma
id|buffer
op_plus
id|first_off
comma
l_int|9
op_minus
id|first_off
)paren
suffix:semicolon
id|buf
op_add_assign
l_int|9
op_minus
id|first_off
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|q
op_eq
id|last
)paren
(brace
id|copy_to_user
(paren
id|buf
comma
id|buffer
comma
id|last_cnt
)paren
suffix:semicolon
id|buf
op_add_assign
id|last_cnt
suffix:semicolon
)brace
r_else
(brace
id|copy_to_user
(paren
id|buf
comma
id|buffer
comma
l_int|9
)paren
suffix:semicolon
id|buf
op_add_assign
l_int|9
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|last
op_eq
(paren
id|u32
op_star
)paren
(paren
id|op-&gt;value
op_plus
id|op-&gt;len
op_minus
l_int|4
)paren
op_logical_and
id|last_cnt
op_eq
l_int|9
)paren
id|__put_user
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
(paren
id|buf
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|k
op_add_assign
id|count
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_HEXSTRING
)paren
(brace
r_char
id|buffer
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|k
OL
id|i
op_minus
l_int|1
)paren
op_logical_and
(paren
id|k
op_amp
l_int|1
)paren
)paren
(brace
id|sprintf
(paren
id|buffer
comma
l_string|&quot;%02x&quot;
comma
op_star
(paren
id|op-&gt;value
op_plus
(paren
id|k
op_rshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|buffer
(braket
l_int|1
)braket
comma
op_amp
id|buf
(braket
id|k
op_increment
op_minus
id|filp-&gt;f_pos
)braket
)paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
(paren
id|count
OG
l_int|1
)paren
op_logical_and
(paren
id|k
OL
id|i
op_minus
l_int|1
)paren
suffix:semicolon
id|k
op_add_assign
l_int|2
)paren
(brace
id|sprintf
(paren
id|buffer
comma
l_string|&quot;%02x&quot;
comma
op_star
(paren
id|op-&gt;value
op_plus
(paren
id|k
op_rshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|copy_to_user
(paren
id|buf
op_plus
id|k
op_minus
id|filp-&gt;f_pos
comma
id|buffer
comma
l_int|2
)paren
suffix:semicolon
id|count
op_sub_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
op_logical_and
(paren
id|k
OL
id|i
op_minus
l_int|1
)paren
)paren
(brace
id|sprintf
(paren
id|buffer
comma
l_string|&quot;%02x&quot;
comma
op_star
(paren
id|op-&gt;value
op_plus
(paren
id|k
op_rshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|buffer
(braket
l_int|0
)braket
comma
op_amp
id|buf
(braket
id|k
op_increment
op_minus
id|filp-&gt;f_pos
)braket
)paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
)paren
id|__put_user
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
op_amp
id|buf
(braket
id|k
op_increment
op_minus
id|filp-&gt;f_pos
)braket
)paren
suffix:semicolon
)brace
id|count
op_assign
id|k
op_minus
id|filp-&gt;f_pos
suffix:semicolon
id|filp-&gt;f_pos
op_assign
id|k
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|property_write
r_static
id|ssize_t
id|property_write
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
id|u32
op_star
id|q
suffix:semicolon
r_void
op_star
id|b
suffix:semicolon
id|openprom_property
op_star
id|op
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_pos
op_ge
l_int|0xffffff
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|filp-&gt;private_data
)paren
(brace
id|i
op_assign
id|property_read
(paren
id|filp
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
)brace
id|k
op_assign
id|filp-&gt;f_pos
suffix:semicolon
id|op
op_assign
(paren
id|openprom_property
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|op-&gt;flag
op_amp
id|OPP_STRING
)paren
)paren
(brace
id|u32
op_star
id|first
comma
op_star
id|last
suffix:semicolon
r_int
id|first_off
comma
id|last_cnt
suffix:semicolon
id|u32
id|mask
comma
id|mask2
suffix:semicolon
r_char
id|tmp
(braket
l_int|9
)braket
suffix:semicolon
r_int
id|forcelen
op_assign
l_int|0
suffix:semicolon
id|j
op_assign
id|k
op_mod
l_int|9
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|j
op_eq
l_int|9
)paren
id|j
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|j
)paren
(brace
r_char
id|ctmp
suffix:semicolon
id|__get_user
c_func
(paren
id|ctmp
comma
op_amp
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctmp
op_ne
l_char|&squot;.&squot;
)paren
(brace
r_if
c_cond
(paren
id|ctmp
op_ne
l_char|&squot;&bslash;n&squot;
)paren
(brace
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_BINARY
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_else
r_goto
id|write_try_string
suffix:semicolon
)brace
r_else
(brace
id|count
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
id|forcelen
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_char
id|ctmp
suffix:semicolon
id|__get_user
c_func
(paren
id|ctmp
comma
op_amp
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctmp
template_param
l_char|&squot;f&squot;
)paren
(brace
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_BINARY
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_else
r_goto
id|write_try_string
suffix:semicolon
)brace
)brace
)brace
id|op-&gt;flag
op_or_assign
id|OPP_BINARY
suffix:semicolon
id|tmp
(braket
l_int|8
)braket
op_assign
l_int|0
suffix:semicolon
id|i
op_assign
(paren
(paren
id|count
op_plus
id|k
op_plus
l_int|8
)paren
op_div
l_int|9
)paren
op_lshift
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;alloclen
op_le
id|i
)paren
(brace
id|b
op_assign
id|kmalloc
(paren
r_sizeof
(paren
id|openprom_property
)paren
op_plus
l_int|2
op_star
id|i
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|b
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memcpy
(paren
id|b
comma
id|filp-&gt;private_data
comma
r_sizeof
(paren
id|openprom_property
)paren
op_plus
id|strlen
(paren
id|op-&gt;name
)paren
op_plus
id|op-&gt;alloclen
)paren
suffix:semicolon
id|memset
(paren
(paren
(paren
r_char
op_star
)paren
id|b
)paren
op_plus
r_sizeof
(paren
id|openprom_property
)paren
op_plus
id|strlen
(paren
id|op-&gt;name
)paren
op_plus
id|op-&gt;alloclen
comma
l_int|0
comma
l_int|2
op_star
id|i
op_minus
id|op-&gt;alloclen
)paren
suffix:semicolon
id|op
op_assign
(paren
id|openprom_property
op_star
)paren
id|b
suffix:semicolon
id|op-&gt;alloclen
op_assign
l_int|2
op_star
id|i
suffix:semicolon
id|b
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|filp-&gt;private_data
op_assign
(paren
r_void
op_star
)paren
id|op
suffix:semicolon
id|kfree
(paren
id|b
)paren
suffix:semicolon
)brace
id|first
op_assign
(paren
(paren
id|u32
op_star
)paren
id|op-&gt;value
)paren
op_plus
(paren
id|k
op_div
l_int|9
)paren
suffix:semicolon
id|first_off
op_assign
id|k
op_mod
l_int|9
suffix:semicolon
id|last
op_assign
(paren
id|u32
op_star
)paren
(paren
id|op-&gt;value
op_plus
id|i
)paren
suffix:semicolon
id|last_cnt
op_assign
(paren
id|k
op_plus
id|count
)paren
op_mod
l_int|9
suffix:semicolon
r_if
c_cond
(paren
id|first
op_plus
l_int|1
op_eq
id|last
)paren
(brace
id|memset
(paren
id|tmp
comma
l_char|&squot;0&squot;
comma
l_int|8
)paren
suffix:semicolon
id|copy_from_user
(paren
id|tmp
op_plus
id|first_off
comma
id|buf
comma
(paren
id|count
op_plus
id|first_off
OG
l_int|8
)paren
ques
c_cond
l_int|8
op_minus
id|first_off
suffix:colon
id|count
)paren
suffix:semicolon
id|mask
op_assign
l_int|0xffffffff
suffix:semicolon
id|mask2
op_assign
l_int|0xffffffff
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|first_off
suffix:semicolon
id|j
op_increment
)paren
id|mask
op_rshift_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|8
op_minus
id|count
op_minus
id|first_off
suffix:semicolon
id|j
OG
l_int|0
suffix:semicolon
id|j
op_decrement
)paren
id|mask2
op_lshift_assign
l_int|1
suffix:semicolon
id|mask
op_and_assign
id|mask2
suffix:semicolon
r_if
c_cond
(paren
id|mask
)paren
(brace
op_star
id|first
op_and_assign
op_complement
id|mask
suffix:semicolon
op_star
id|first
op_or_assign
id|simple_strtoul
(paren
id|tmp
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
id|op-&gt;flag
op_or_assign
id|OPP_DIRTY
suffix:semicolon
)brace
)brace
r_else
(brace
id|op-&gt;flag
op_or_assign
id|OPP_DIRTY
suffix:semicolon
r_for
c_loop
(paren
id|q
op_assign
id|first
suffix:semicolon
id|q
OL
id|last
suffix:semicolon
id|q
op_increment
)paren
(brace
r_if
c_cond
(paren
id|q
op_eq
id|first
)paren
(brace
r_if
c_cond
(paren
id|first_off
OL
l_int|8
)paren
(brace
id|memset
(paren
id|tmp
comma
l_char|&squot;0&squot;
comma
l_int|8
)paren
suffix:semicolon
id|copy_from_user
(paren
id|tmp
op_plus
id|first_off
comma
id|buf
comma
l_int|8
op_minus
id|first_off
)paren
suffix:semicolon
id|mask
op_assign
l_int|0xffffffff
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|first_off
suffix:semicolon
id|j
op_increment
)paren
id|mask
op_rshift_assign
l_int|1
suffix:semicolon
op_star
id|q
op_and_assign
op_complement
id|mask
suffix:semicolon
op_star
id|q
op_or_assign
id|simple_strtoul
(paren
id|tmp
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
)brace
id|buf
op_add_assign
l_int|9
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|q
op_eq
id|last
op_minus
l_int|1
)paren
op_logical_and
id|last_cnt
op_logical_and
(paren
id|last_cnt
OL
l_int|8
)paren
)paren
(brace
id|memset
(paren
id|tmp
comma
l_char|&squot;0&squot;
comma
l_int|8
)paren
suffix:semicolon
id|copy_from_user
(paren
id|tmp
comma
id|buf
comma
id|last_cnt
)paren
suffix:semicolon
id|mask
op_assign
l_int|0xffffffff
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
op_minus
id|last_cnt
suffix:semicolon
id|j
op_increment
)paren
id|mask
op_lshift_assign
l_int|1
suffix:semicolon
op_star
id|q
op_and_assign
op_complement
id|mask
suffix:semicolon
op_star
id|q
op_or_assign
id|simple_strtoul
(paren
id|tmp
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
id|buf
op_add_assign
id|last_cnt
suffix:semicolon
)brace
r_else
(brace
r_char
id|tchars
(braket
l_int|17
)braket
suffix:semicolon
multiline_comment|/* XXX yuck... */
id|copy_from_user
c_func
(paren
id|tchars
comma
id|buf
comma
l_int|16
)paren
suffix:semicolon
op_star
id|q
op_assign
id|simple_strtoul
(paren
id|tchars
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
id|buf
op_add_assign
l_int|9
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|forcelen
)paren
(brace
r_if
c_cond
(paren
id|op-&gt;len
OL
id|i
)paren
id|op-&gt;len
op_assign
id|i
suffix:semicolon
)brace
r_else
id|op-&gt;len
op_assign
id|i
suffix:semicolon
id|filp-&gt;f_pos
op_add_assign
id|count
suffix:semicolon
)brace
id|write_try_string
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|op-&gt;flag
op_amp
id|OPP_BINARY
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|op-&gt;flag
op_amp
(paren
id|OPP_QUOTED
op_or
id|OPP_NOTQUOTED
)paren
)paren
)paren
(brace
r_char
id|ctmp
suffix:semicolon
multiline_comment|/* No way, if somebody starts writing from the middle, &n;&t;&t;&t; * we don&squot;t know whether he uses quotes around or not &n;&t;&t;&t; */
r_if
c_cond
(paren
id|k
OG
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|__get_user
c_func
(paren
id|ctmp
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctmp
op_eq
l_char|&squot;&bslash;&squot;&squot;
)paren
(brace
id|op-&gt;flag
op_or_assign
id|OPP_QUOTED
suffix:semicolon
id|buf
op_increment
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
(brace
id|op-&gt;flag
op_or_assign
id|OPP_STRING
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_else
id|op-&gt;flag
op_or_assign
id|OPP_NOTQUOTED
suffix:semicolon
)brace
id|op-&gt;flag
op_or_assign
id|OPP_STRING
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;alloclen
op_le
id|count
op_plus
id|filp-&gt;f_pos
)paren
(brace
id|b
op_assign
id|kmalloc
(paren
r_sizeof
(paren
id|openprom_property
)paren
op_plus
l_int|2
op_star
(paren
id|count
op_plus
id|filp-&gt;f_pos
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|b
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memcpy
(paren
id|b
comma
id|filp-&gt;private_data
comma
r_sizeof
(paren
id|openprom_property
)paren
op_plus
id|strlen
(paren
id|op-&gt;name
)paren
op_plus
id|op-&gt;alloclen
)paren
suffix:semicolon
id|memset
(paren
(paren
(paren
r_char
op_star
)paren
id|b
)paren
op_plus
r_sizeof
(paren
id|openprom_property
)paren
op_plus
id|strlen
(paren
id|op-&gt;name
)paren
op_plus
id|op-&gt;alloclen
comma
l_int|0
comma
l_int|2
op_star
(paren
id|count
op_minus
id|filp-&gt;f_pos
)paren
op_minus
id|op-&gt;alloclen
)paren
suffix:semicolon
id|op
op_assign
(paren
id|openprom_property
op_star
)paren
id|b
suffix:semicolon
id|op-&gt;alloclen
op_assign
l_int|2
op_star
(paren
id|count
op_plus
id|filp-&gt;f_pos
)paren
suffix:semicolon
id|b
op_assign
id|filp-&gt;private_data
suffix:semicolon
id|filp-&gt;private_data
op_assign
(paren
r_void
op_star
)paren
id|op
suffix:semicolon
id|kfree
(paren
id|b
)paren
suffix:semicolon
)brace
id|p
op_assign
id|op-&gt;value
op_plus
id|filp-&gt;f_pos
op_minus
(paren
(paren
id|op-&gt;flag
op_amp
id|OPP_QUOTED
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|copy_from_user
(paren
id|p
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|op-&gt;flag
op_or_assign
id|OPP_DIRTY
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
r_if
c_cond
(paren
op_star
id|p
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
op_star
id|p
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
id|count
)paren
(brace
id|op-&gt;len
op_assign
id|p
op_minus
id|op-&gt;value
suffix:semicolon
id|filp-&gt;f_pos
op_add_assign
id|i
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
OG
id|op-&gt;value
)paren
op_logical_and
(paren
id|op-&gt;flag
op_amp
id|OPP_QUOTED
)paren
op_logical_and
(paren
op_star
(paren
id|p
op_minus
l_int|1
)paren
op_eq
l_char|&squot;&bslash;&squot;&squot;
)paren
)paren
id|op-&gt;len
op_decrement
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|p
op_minus
id|op-&gt;value
OG
id|op-&gt;len
)paren
id|op-&gt;len
op_assign
id|p
op_minus
id|op-&gt;value
suffix:semicolon
id|filp-&gt;f_pos
op_add_assign
id|count
suffix:semicolon
)brace
)brace
r_return
id|filp-&gt;f_pos
op_minus
id|k
suffix:semicolon
)brace
DECL|function|property_release
r_int
id|property_release
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
id|openprom_property
op_star
id|op
op_assign
(paren
id|openprom_property
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|error
suffix:semicolon
id|u32
id|node
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|op
)paren
r_return
l_int|0
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|node
op_assign
id|nodes
(braket
(paren
id|u16
)paren
(paren
(paren
r_int
)paren
id|inode-&gt;u.generic_ip
)paren
)braket
dot
id|node
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u16
)paren
(paren
(paren
r_int
)paren
id|inode-&gt;u.generic_ip
)paren
op_eq
id|aliases
)paren
(brace
r_if
c_cond
(paren
(paren
id|op-&gt;flag
op_amp
id|OPP_DIRTY
)paren
op_logical_and
(paren
id|op-&gt;flag
op_amp
id|OPP_STRING
)paren
)paren
(brace
r_char
op_star
id|p
op_assign
id|op-&gt;name
suffix:semicolon
r_int
id|i
op_assign
(paren
id|op-&gt;value
op_minus
id|op-&gt;name
)paren
op_minus
id|strlen
(paren
id|op-&gt;name
)paren
op_minus
l_int|1
suffix:semicolon
id|op-&gt;value
(braket
id|op-&gt;len
)braket
op_assign
l_int|0
suffix:semicolon
op_star
(paren
id|op-&gt;value
op_minus
l_int|1
)paren
op_assign
l_char|&squot; &squot;
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
r_for
c_loop
(paren
id|p
op_assign
id|op-&gt;value
op_minus
id|i
op_minus
l_int|2
suffix:semicolon
id|p
op_ge
id|op-&gt;name
suffix:semicolon
id|p
op_decrement
)paren
id|p
(braket
id|i
)braket
op_assign
op_star
id|p
suffix:semicolon
id|p
op_assign
id|op-&gt;name
op_plus
id|i
suffix:semicolon
)brace
id|memcpy
(paren
id|p
op_minus
l_int|8
comma
l_string|&quot;nvalias &quot;
comma
l_int|8
)paren
suffix:semicolon
id|prom_feval
(paren
id|p
op_minus
l_int|8
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_DIRTY
)paren
(brace
r_if
c_cond
(paren
id|op-&gt;flag
op_amp
id|OPP_STRING
)paren
(brace
id|op-&gt;value
(braket
id|op-&gt;len
)braket
op_assign
l_int|0
suffix:semicolon
id|save_and_cli
(paren
id|flags
)paren
suffix:semicolon
id|error
op_assign
id|prom_setprop
(paren
id|node
comma
id|op-&gt;name
comma
id|op-&gt;value
comma
id|op-&gt;len
op_plus
l_int|1
)paren
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_le
l_int|0
)paren
id|printk
(paren
id|KERN_WARNING
l_string|&quot;openpromfs: &quot;
l_string|&quot;Couldn&squot;t write property %s&bslash;n&quot;
comma
id|op-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|op-&gt;flag
op_amp
id|OPP_BINARY
)paren
op_logical_or
op_logical_neg
id|op-&gt;len
)paren
(brace
id|save_and_cli
(paren
id|flags
)paren
suffix:semicolon
id|error
op_assign
id|prom_setprop
(paren
id|node
comma
id|op-&gt;name
comma
id|op-&gt;value
comma
id|op-&gt;len
)paren
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_le
l_int|0
)paren
id|printk
(paren
id|KERN_WARNING
l_string|&quot;openpromfs: &quot;
l_string|&quot;Couldn&squot;t write property %s&bslash;n&quot;
comma
id|op-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
(paren
id|KERN_WARNING
l_string|&quot;openpromfs: &quot;
l_string|&quot;Unknown property type of %s&bslash;n&quot;
comma
id|op-&gt;name
)paren
suffix:semicolon
)brace
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
id|kfree
(paren
id|filp-&gt;private_data
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|openpromfs_prop_ops
r_static
r_struct
id|file_operations
id|openpromfs_prop_ops
op_assign
(brace
id|read
suffix:colon
id|property_read
comma
id|write
suffix:colon
id|property_write
comma
id|release
suffix:colon
id|property_release
comma
)brace
suffix:semicolon
DECL|variable|openpromfs_nodenum_ops
r_static
r_struct
id|file_operations
id|openpromfs_nodenum_ops
op_assign
(brace
id|read
suffix:colon
id|nodenum_read
comma
)brace
suffix:semicolon
DECL|variable|openprom_operations
r_static
r_struct
id|file_operations
id|openprom_operations
op_assign
(brace
id|read
suffix:colon
id|generic_read_dir
comma
id|readdir
suffix:colon
id|openpromfs_readdir
comma
)brace
suffix:semicolon
DECL|variable|openprom_alias_inode_operations
r_static
r_struct
id|inode_operations
id|openprom_alias_inode_operations
op_assign
(brace
id|create
suffix:colon
id|openpromfs_create
comma
id|lookup
suffix:colon
id|openpromfs_lookup
comma
id|unlink
suffix:colon
id|openpromfs_unlink
comma
)brace
suffix:semicolon
DECL|variable|openprom_inode_operations
r_static
r_struct
id|inode_operations
id|openprom_inode_operations
op_assign
(brace
id|lookup
suffix:colon
id|openpromfs_lookup
comma
)brace
suffix:semicolon
DECL|function|lookup_children
r_static
r_int
id|lookup_children
c_func
(paren
id|u16
id|n
comma
r_const
r_char
op_star
id|name
comma
r_int
id|len
)paren
(brace
r_int
id|ret
suffix:semicolon
id|u16
id|node
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|n
op_ne
l_int|0xffff
suffix:semicolon
id|n
op_assign
id|nodes
(braket
id|n
)braket
dot
id|next
)paren
(brace
id|node
op_assign
id|nodes
(braket
id|n
)braket
dot
id|child
suffix:semicolon
r_if
c_cond
(paren
id|node
op_ne
l_int|0xffff
)paren
(brace
r_char
id|buffer
(braket
l_int|128
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_while
c_loop
(paren
id|node
op_ne
l_int|0xffff
)paren
(brace
r_if
c_cond
(paren
id|prom_getname
(paren
id|nodes
(braket
id|node
)braket
dot
id|node
comma
id|buffer
comma
l_int|128
)paren
op_ge
l_int|0
)paren
(brace
id|i
op_assign
id|strlen
(paren
id|buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_eq
id|i
)paren
op_logical_and
op_logical_neg
id|strncmp
(paren
id|buffer
comma
id|name
comma
id|len
)paren
)paren
r_return
id|NODE2INO
c_func
(paren
id|node
)paren
suffix:semicolon
id|p
op_assign
id|strchr
(paren
id|buffer
comma
l_char|&squot;@&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_logical_and
(paren
id|len
op_eq
id|p
op_minus
id|buffer
)paren
op_logical_and
op_logical_neg
id|strncmp
(paren
id|buffer
comma
id|name
comma
id|len
)paren
)paren
r_return
id|NODE2INO
c_func
(paren
id|node
)paren
suffix:semicolon
)brace
id|node
op_assign
id|nodes
(braket
id|node
)braket
dot
id|next
suffix:semicolon
)brace
)brace
r_else
r_continue
suffix:semicolon
id|ret
op_assign
id|lookup_children
(paren
id|nodes
(braket
id|n
)braket
dot
id|child
comma
id|name
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|openpromfs_lookup
r_static
r_struct
id|dentry
op_star
id|openpromfs_lookup
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_int
id|ino
op_assign
l_int|0
suffix:semicolon
DECL|macro|OPFSL_DIR
mdefine_line|#define OPFSL_DIR&t;0
DECL|macro|OPFSL_PROPERTY
mdefine_line|#define OPFSL_PROPERTY&t;1
DECL|macro|OPFSL_NODENUM
mdefine_line|#define OPFSL_NODENUM&t;2
r_int
id|type
op_assign
l_int|0
suffix:semicolon
r_char
id|buffer
(braket
l_int|128
)braket
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_const
r_char
op_star
id|name
suffix:semicolon
id|u32
id|n
suffix:semicolon
id|u16
id|dirnode
suffix:semicolon
r_int
r_int
id|len
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_char
id|buffer2
(braket
l_int|64
)braket
suffix:semicolon
id|inode
op_assign
l_int|NULL
suffix:semicolon
id|name
op_assign
id|dentry-&gt;d_name.name
suffix:semicolon
id|len
op_assign
id|dentry-&gt;d_name.len
suffix:semicolon
r_if
c_cond
(paren
id|name
(braket
l_int|0
)braket
op_eq
l_char|&squot;.&squot;
op_logical_and
id|len
op_eq
l_int|5
op_logical_and
op_logical_neg
id|strncmp
(paren
id|name
op_plus
l_int|1
comma
l_string|&quot;node&quot;
comma
l_int|4
)paren
)paren
(brace
id|ino
op_assign
id|NODEP2INO
c_func
(paren
id|NODE
c_func
(paren
id|dir-&gt;i_ino
)paren
dot
id|first_prop
)paren
suffix:semicolon
id|type
op_assign
id|OPFSL_NODENUM
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ino
)paren
(brace
id|u16
id|node
op_assign
id|NODE
c_func
(paren
id|dir-&gt;i_ino
)paren
dot
id|child
suffix:semicolon
r_while
c_loop
(paren
id|node
op_ne
l_int|0xffff
)paren
(brace
r_if
c_cond
(paren
id|prom_getname
(paren
id|nodes
(braket
id|node
)braket
dot
id|node
comma
id|buffer
comma
l_int|128
)paren
op_ge
l_int|0
)paren
(brace
id|i
op_assign
id|strlen
(paren
id|buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
id|i
op_logical_and
op_logical_neg
id|strncmp
(paren
id|buffer
comma
id|name
comma
id|len
)paren
)paren
(brace
id|ino
op_assign
id|NODE2INO
c_func
(paren
id|node
)paren
suffix:semicolon
id|type
op_assign
id|OPFSL_DIR
suffix:semicolon
r_break
suffix:semicolon
)brace
id|p
op_assign
id|strchr
(paren
id|buffer
comma
l_char|&squot;@&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_logical_and
(paren
id|len
op_eq
id|p
op_minus
id|buffer
)paren
op_logical_and
op_logical_neg
id|strncmp
(paren
id|buffer
comma
id|name
comma
id|len
)paren
)paren
(brace
id|ino
op_assign
id|NODE2INO
c_func
(paren
id|node
)paren
suffix:semicolon
id|type
op_assign
id|OPFSL_DIR
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|node
op_assign
id|nodes
(braket
id|node
)braket
dot
id|next
suffix:semicolon
)brace
)brace
id|n
op_assign
id|NODE
c_func
(paren
id|dir-&gt;i_ino
)paren
dot
id|node
suffix:semicolon
id|dirnode
op_assign
id|dir-&gt;i_ino
op_minus
id|OPENPROM_FIRST_INO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ino
)paren
(brace
r_int
id|j
op_assign
id|NODEP2INO
c_func
(paren
id|NODE
c_func
(paren
id|dir-&gt;i_ino
)paren
dot
id|first_prop
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dirnode
op_ne
id|aliases
)paren
(brace
r_for
c_loop
(paren
id|p
op_assign
id|prom_firstprop
(paren
id|n
comma
id|buffer2
)paren
suffix:semicolon
id|p
op_logical_and
op_star
id|p
suffix:semicolon
id|p
op_assign
id|prom_nextprop
(paren
id|n
comma
id|p
comma
id|buffer2
)paren
)paren
(brace
id|j
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_eq
id|strlen
(paren
id|p
)paren
)paren
op_logical_and
op_logical_neg
id|strncmp
(paren
id|p
comma
id|name
comma
id|len
)paren
)paren
(brace
id|ino
op_assign
id|j
suffix:semicolon
id|type
op_assign
id|OPFSL_PROPERTY
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_int
id|k
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|aliases_nodes
suffix:semicolon
id|k
op_increment
)paren
(brace
id|j
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|alias_names
(braket
id|k
)braket
op_logical_and
(paren
id|len
op_eq
id|strlen
(paren
id|alias_names
(braket
id|k
)braket
)paren
)paren
op_logical_and
op_logical_neg
id|strncmp
(paren
id|alias_names
(braket
id|k
)braket
comma
id|name
comma
id|len
)paren
)paren
(brace
id|ino
op_assign
id|j
suffix:semicolon
id|type
op_assign
id|OPFSL_PROPERTY
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|ino
)paren
(brace
id|ino
op_assign
id|lookup_children
(paren
id|NODE
c_func
(paren
id|dir-&gt;i_ino
)paren
dot
id|child
comma
id|name
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ino
)paren
id|type
op_assign
id|OPFSL_DIR
suffix:semicolon
r_else
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOENT
)paren
suffix:semicolon
)brace
id|inode
op_assign
id|iget
(paren
id|dir-&gt;i_sb
comma
id|ino
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|OPFSL_DIR
suffix:colon
id|inode-&gt;i_mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
suffix:semicolon
r_if
c_cond
(paren
id|ino
op_eq
id|OPENPROM_FIRST_INO
op_plus
id|aliases
)paren
(brace
id|inode-&gt;i_mode
op_or_assign
id|S_IWUSR
suffix:semicolon
id|inode-&gt;i_op
op_assign
op_amp
id|openprom_alias_inode_operations
suffix:semicolon
)brace
r_else
id|inode-&gt;i_op
op_assign
op_amp
id|openprom_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|openprom_operations
suffix:semicolon
id|inode-&gt;i_nlink
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OPFSL_NODENUM
suffix:colon
id|inode-&gt;i_mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|openpromfs_nodenum_ops
suffix:semicolon
id|inode-&gt;i_nlink
op_assign
l_int|1
suffix:semicolon
id|inode-&gt;u.generic_ip
op_assign
(paren
r_void
op_star
)paren
(paren
r_int
)paren
(paren
id|n
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OPFSL_PROPERTY
suffix:colon
r_if
c_cond
(paren
(paren
id|dirnode
op_eq
id|options
)paren
op_logical_and
(paren
id|len
op_eq
l_int|17
)paren
op_logical_and
op_logical_neg
id|strncmp
(paren
id|name
comma
l_string|&quot;security-password&quot;
comma
l_int|17
)paren
)paren
id|inode-&gt;i_mode
op_assign
id|S_IFREG
op_or
id|S_IRUSR
op_or
id|S_IWUSR
suffix:semicolon
r_else
(brace
id|inode-&gt;i_mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
suffix:semicolon
r_if
c_cond
(paren
id|dirnode
op_eq
id|options
op_logical_or
id|dirnode
op_eq
id|aliases
)paren
(brace
r_if
c_cond
(paren
id|len
op_ne
l_int|4
op_logical_or
id|strncmp
(paren
id|name
comma
l_string|&quot;name&quot;
comma
l_int|4
)paren
)paren
id|inode-&gt;i_mode
op_or_assign
id|S_IWUSR
suffix:semicolon
)brace
)brace
id|inode-&gt;i_fop
op_assign
op_amp
id|openpromfs_prop_ops
suffix:semicolon
id|inode-&gt;i_nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_size
OL
l_int|0
)paren
id|inode-&gt;i_size
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;u.generic_ip
op_assign
(paren
r_void
op_star
)paren
(paren
r_int
)paren
(paren
(paren
(paren
id|u16
)paren
id|dirnode
)paren
op_or
(paren
(paren
(paren
id|u16
)paren
(paren
id|ino
op_minus
id|NODEP2INO
c_func
(paren
id|NODE
c_func
(paren
id|dir-&gt;i_ino
)paren
dot
id|first_prop
)paren
op_minus
l_int|1
)paren
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|inode-&gt;i_gid
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;i_uid
op_assign
l_int|0
suffix:semicolon
id|d_add
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|openpromfs_readdir
r_static
r_int
id|openpromfs_readdir
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|dirent
comma
id|filldir_t
id|filldir
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_int
r_int
id|ino
suffix:semicolon
id|u32
id|n
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_char
id|buffer
(braket
l_int|128
)braket
suffix:semicolon
id|u16
id|node
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_char
id|buffer2
(braket
l_int|64
)braket
suffix:semicolon
id|ino
op_assign
id|inode-&gt;i_ino
suffix:semicolon
id|i
op_assign
id|filp-&gt;f_pos
suffix:semicolon
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;.&quot;
comma
l_int|1
comma
id|i
comma
id|ino
comma
id|DT_DIR
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|i
op_increment
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
multiline_comment|/* fall thru */
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;..&quot;
comma
l_int|2
comma
id|i
comma
(paren
id|NODE
c_func
(paren
id|ino
)paren
dot
id|parent
op_eq
l_int|0xffff
)paren
ques
c_cond
id|OPENPROM_ROOT_INO
suffix:colon
id|NODE2INO
c_func
(paren
id|NODE
c_func
(paren
id|ino
)paren
dot
id|parent
)paren
comma
id|DT_DIR
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|i
op_increment
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
multiline_comment|/* fall thru */
r_default
suffix:colon
id|i
op_sub_assign
l_int|2
suffix:semicolon
id|node
op_assign
id|NODE
c_func
(paren
id|ino
)paren
dot
id|child
suffix:semicolon
r_while
c_loop
(paren
id|i
op_logical_and
id|node
op_ne
l_int|0xffff
)paren
(brace
id|node
op_assign
id|nodes
(braket
id|node
)braket
dot
id|next
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)brace
r_while
c_loop
(paren
id|node
op_ne
l_int|0xffff
)paren
(brace
r_if
c_cond
(paren
id|prom_getname
(paren
id|nodes
(braket
id|node
)braket
dot
id|node
comma
id|buffer
comma
l_int|128
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
id|buffer
comma
id|strlen
c_func
(paren
id|buffer
)paren
comma
id|filp-&gt;f_pos
comma
id|NODE2INO
c_func
(paren
id|node
)paren
comma
id|DT_DIR
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
id|node
op_assign
id|nodes
(braket
id|node
)braket
dot
id|next
suffix:semicolon
)brace
id|j
op_assign
id|NODEP2INO
c_func
(paren
id|NODE
c_func
(paren
id|ino
)paren
dot
id|first_prop
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;.node&quot;
comma
l_int|5
comma
id|filp-&gt;f_pos
comma
id|j
comma
id|DT_REG
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
)brace
r_else
id|i
op_decrement
suffix:semicolon
id|n
op_assign
id|NODE
c_func
(paren
id|ino
)paren
dot
id|node
suffix:semicolon
r_if
c_cond
(paren
id|ino
op_eq
id|OPENPROM_FIRST_INO
op_plus
id|aliases
)paren
(brace
r_for
c_loop
(paren
id|j
op_increment
suffix:semicolon
id|i
OL
id|aliases_nodes
suffix:semicolon
id|i
op_increment
comma
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|alias_names
(braket
id|i
)braket
)paren
(brace
r_if
c_cond
(paren
id|filldir
(paren
id|dirent
comma
id|alias_names
(braket
id|i
)braket
comma
id|strlen
(paren
id|alias_names
(braket
id|i
)braket
)paren
comma
id|filp-&gt;f_pos
comma
id|j
comma
id|DT_REG
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|p
op_assign
id|prom_firstprop
(paren
id|n
comma
id|buffer2
)paren
suffix:semicolon
id|p
op_logical_and
op_star
id|p
suffix:semicolon
id|p
op_assign
id|prom_nextprop
(paren
id|n
comma
id|p
comma
id|buffer2
)paren
)paren
(brace
id|j
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
id|i
op_decrement
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|dirent
comma
id|p
comma
id|strlen
c_func
(paren
id|p
)paren
comma
id|filp-&gt;f_pos
comma
id|j
comma
id|DT_REG
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|filp-&gt;f_pos
op_increment
suffix:semicolon
)brace
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|openpromfs_create
r_static
r_int
id|openpromfs_create
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mode
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dir
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
id|dentry-&gt;d_name.len
OG
l_int|256
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|aliases_nodes
op_eq
id|ALIASES_NNODES
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|p
op_assign
id|kmalloc
(paren
id|dentry-&gt;d_name.len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|strncpy
(paren
id|p
comma
id|dentry-&gt;d_name.name
comma
id|dentry-&gt;d_name.len
)paren
suffix:semicolon
id|p
(braket
id|dentry-&gt;d_name.len
)braket
op_assign
l_int|0
suffix:semicolon
id|alias_names
(braket
id|aliases_nodes
op_increment
)braket
op_assign
id|p
suffix:semicolon
id|inode
op_assign
id|iget
(paren
id|dir-&gt;i_sb
comma
id|NODEP2INO
c_func
(paren
id|NODE
c_func
(paren
id|dir-&gt;i_ino
)paren
dot
id|first_prop
)paren
op_plus
id|aliases_nodes
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|openpromfs_prop_ops
suffix:semicolon
id|inode-&gt;i_nlink
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_size
OL
l_int|0
)paren
id|inode-&gt;i_size
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;u.generic_ip
op_assign
(paren
r_void
op_star
)paren
(paren
r_int
)paren
(paren
(paren
(paren
id|u16
)paren
id|aliases
)paren
op_or
(paren
(paren
(paren
id|u16
)paren
(paren
id|aliases_nodes
op_minus
l_int|1
)paren
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|dentry
comma
id|inode
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|openpromfs_unlink
r_static
r_int
id|openpromfs_unlink
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_int
r_int
id|len
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_const
r_char
op_star
id|name
suffix:semicolon
r_int
id|i
suffix:semicolon
id|name
op_assign
id|dentry-&gt;d_name.name
suffix:semicolon
id|len
op_assign
id|dentry-&gt;d_name.len
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|aliases_nodes
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|strlen
(paren
id|alias_names
(braket
id|i
)braket
)paren
op_eq
id|len
)paren
op_logical_and
op_logical_neg
id|strncmp
(paren
id|name
comma
id|alias_names
(braket
id|i
)braket
comma
id|len
)paren
)paren
(brace
r_char
id|buffer
(braket
l_int|512
)braket
suffix:semicolon
id|p
op_assign
id|alias_names
(braket
id|i
)braket
suffix:semicolon
id|alias_names
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
(paren
id|p
)paren
suffix:semicolon
id|strcpy
(paren
id|buffer
comma
l_string|&quot;nvunalias &quot;
)paren
suffix:semicolon
id|memcpy
(paren
id|buffer
op_plus
l_int|10
comma
id|name
comma
id|len
)paren
suffix:semicolon
id|buffer
(braket
l_int|10
op_plus
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|prom_feval
(paren
id|buffer
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* {{{ init section */
macro_line|#ifndef MODULE
DECL|function|check_space
r_static
r_int
id|__init
id|check_space
(paren
id|u16
id|n
)paren
macro_line|#else
r_static
r_int
id|check_space
(paren
id|u16
id|n
)paren
macro_line|#endif
(brace
r_int
r_int
id|pages
suffix:semicolon
r_if
c_cond
(paren
(paren
l_int|1
op_lshift
id|alloced
)paren
op_star
id|PAGE_SIZE
OL
(paren
id|n
op_plus
l_int|2
)paren
op_star
r_sizeof
(paren
id|openpromfs_node
)paren
)paren
(brace
id|pages
op_assign
id|__get_free_pages
(paren
id|GFP_KERNEL
comma
id|alloced
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pages
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|nodes
)paren
(brace
id|memcpy
(paren
(paren
r_char
op_star
)paren
id|pages
comma
(paren
r_char
op_star
)paren
id|nodes
comma
(paren
l_int|1
op_lshift
id|alloced
)paren
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
id|free_pages
(paren
(paren
r_int
r_int
)paren
id|nodes
comma
id|alloced
)paren
suffix:semicolon
)brace
id|alloced
op_increment
suffix:semicolon
id|nodes
op_assign
(paren
id|openpromfs_node
op_star
)paren
id|pages
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifndef MODULE
DECL|function|get_nodes
r_static
id|u16
id|__init
id|get_nodes
(paren
id|u16
id|parent
comma
id|u32
id|node
)paren
macro_line|#else
r_static
id|u16
id|get_nodes
(paren
id|u16
id|parent
comma
id|u32
id|node
)paren
macro_line|#endif
(brace
r_char
op_star
id|p
suffix:semicolon
id|u16
id|n
op_assign
id|last_node
op_increment
comma
id|i
suffix:semicolon
r_char
id|buffer
(braket
l_int|64
)braket
suffix:semicolon
r_if
c_cond
(paren
id|check_space
(paren
id|n
)paren
OL
l_int|0
)paren
r_return
l_int|0xffff
suffix:semicolon
id|nodes
(braket
id|n
)braket
dot
id|parent
op_assign
id|parent
suffix:semicolon
id|nodes
(braket
id|n
)braket
dot
id|node
op_assign
id|node
suffix:semicolon
id|nodes
(braket
id|n
)braket
dot
id|next
op_assign
l_int|0xffff
suffix:semicolon
id|nodes
(braket
id|n
)braket
dot
id|child
op_assign
l_int|0xffff
suffix:semicolon
id|nodes
(braket
id|n
)braket
dot
id|first_prop
op_assign
id|first_prop
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|parent
)paren
(brace
r_char
id|buffer
(braket
l_int|8
)braket
suffix:semicolon
r_int
id|j
suffix:semicolon
r_if
c_cond
(paren
(paren
id|j
op_assign
id|prom_getproperty
(paren
id|node
comma
l_string|&quot;name&quot;
comma
id|buffer
comma
l_int|8
)paren
)paren
op_ge
l_int|0
)paren
(brace
id|buffer
(braket
id|j
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
(paren
id|buffer
comma
l_string|&quot;options&quot;
)paren
)paren
id|options
op_assign
id|n
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
(paren
id|buffer
comma
l_string|&quot;aliases&quot;
)paren
)paren
id|aliases
op_assign
id|n
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|n
op_ne
id|aliases
)paren
r_for
c_loop
(paren
id|p
op_assign
id|prom_firstprop
(paren
id|node
comma
id|buffer
)paren
suffix:semicolon
id|p
op_logical_and
id|p
op_ne
(paren
r_char
op_star
)paren
op_minus
l_int|1
op_logical_and
op_star
id|p
suffix:semicolon
id|p
op_assign
id|prom_nextprop
(paren
id|node
comma
id|p
comma
id|buffer
)paren
)paren
id|first_prop
op_increment
suffix:semicolon
r_else
(brace
r_char
op_star
id|q
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|prom_firstprop
(paren
id|node
comma
id|buffer
)paren
suffix:semicolon
id|p
op_logical_and
id|p
op_ne
(paren
r_char
op_star
)paren
op_minus
l_int|1
op_logical_and
op_star
id|p
suffix:semicolon
id|p
op_assign
id|prom_nextprop
(paren
id|node
comma
id|p
comma
id|buffer
)paren
)paren
(brace
r_if
c_cond
(paren
id|aliases_nodes
op_eq
id|ALIASES_NNODES
)paren
r_break
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|aliases_nodes
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|strcmp
(paren
id|p
comma
id|alias_names
(braket
id|i
)braket
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|aliases_nodes
)paren
r_continue
suffix:semicolon
id|q
op_assign
id|kmalloc
(paren
id|strlen
(paren
id|p
)paren
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
r_return
l_int|0xffff
suffix:semicolon
id|strcpy
(paren
id|q
comma
id|p
)paren
suffix:semicolon
id|alias_names
(braket
id|aliases_nodes
op_increment
)braket
op_assign
id|q
suffix:semicolon
)brace
id|first_prop
op_add_assign
id|ALIASES_NNODES
suffix:semicolon
)brace
id|node
op_assign
id|prom_getchild
(paren
id|node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|node
)paren
(brace
id|parent
op_assign
id|get_nodes
(paren
id|n
comma
id|node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|parent
op_eq
l_int|0xffff
)paren
r_return
l_int|0xffff
suffix:semicolon
id|nodes
(braket
id|n
)braket
dot
id|child
op_assign
id|parent
suffix:semicolon
r_while
c_loop
(paren
(paren
id|node
op_assign
id|prom_getsibling
(paren
id|node
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|i
op_assign
id|get_nodes
(paren
id|n
comma
id|node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0xffff
)paren
r_return
l_int|0xffff
suffix:semicolon
id|nodes
(braket
id|parent
)braket
dot
id|next
op_assign
id|i
suffix:semicolon
id|parent
op_assign
id|i
suffix:semicolon
)brace
)brace
r_return
id|n
suffix:semicolon
)brace
DECL|function|openprom_read_inode
r_static
r_void
id|openprom_read_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|inode-&gt;i_mtime
op_assign
id|inode-&gt;i_atime
op_assign
id|inode-&gt;i_ctime
op_assign
id|CURRENT_TIME
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_ino
op_eq
id|OPENPROM_ROOT_INO
)paren
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|openprom_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|openprom_operations
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
suffix:semicolon
)brace
)brace
DECL|function|openprom_statfs
r_static
r_int
id|openprom_statfs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|statfs
op_star
id|buf
)paren
(brace
id|buf-&gt;f_type
op_assign
id|OPENPROM_SUPER_MAGIC
suffix:semicolon
id|buf-&gt;f_bsize
op_assign
id|PAGE_SIZE
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
multiline_comment|/* ??? */
id|buf-&gt;f_bfree
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;f_bavail
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;f_ffree
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;f_namelen
op_assign
id|NAME_MAX
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|openprom_sops
r_static
r_struct
id|super_operations
id|openprom_sops
op_assign
(brace
id|read_inode
suffix:colon
id|openprom_read_inode
comma
id|statfs
suffix:colon
id|openprom_statfs
comma
)brace
suffix:semicolon
DECL|function|openprom_read_super
r_struct
id|super_block
op_star
id|openprom_read_super
c_func
(paren
r_struct
id|super_block
op_star
id|s
comma
r_void
op_star
id|data
comma
r_int
id|silent
)paren
(brace
r_struct
id|inode
op_star
id|root_inode
suffix:semicolon
id|s-&gt;s_blocksize
op_assign
l_int|1024
suffix:semicolon
id|s-&gt;s_blocksize_bits
op_assign
l_int|10
suffix:semicolon
id|s-&gt;s_magic
op_assign
id|OPENPROM_SUPER_MAGIC
suffix:semicolon
id|s-&gt;s_op
op_assign
op_amp
id|openprom_sops
suffix:semicolon
id|root_inode
op_assign
id|iget
c_func
(paren
id|s
comma
id|OPENPROM_ROOT_INO
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|root_inode
)paren
r_goto
id|out_no_root
suffix:semicolon
id|s-&gt;s_root
op_assign
id|d_alloc_root
c_func
(paren
id|root_inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;s_root
)paren
r_goto
id|out_no_root
suffix:semicolon
r_return
id|s
suffix:semicolon
id|out_no_root
suffix:colon
id|printk
c_func
(paren
l_string|&quot;openprom_read_super: get root inode failed&bslash;n&quot;
)paren
suffix:semicolon
id|iput
c_func
(paren
id|root_inode
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
id|DECLARE_FSTYPE
c_func
(paren
id|openprom_fs_type
comma
l_string|&quot;openpromfs&quot;
comma
id|openprom_read_super
comma
l_int|0
)paren
suffix:semicolon
DECL|function|init_openprom_fs
r_static
r_int
id|__init
id|init_openprom_fs
c_func
(paren
r_void
)paren
(brace
id|nodes
op_assign
(paren
id|openpromfs_node
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nodes
)paren
(brace
id|printk
(paren
id|KERN_WARNING
l_string|&quot;openpromfs: can&squot;t get free page&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_nodes
(paren
l_int|0xffff
comma
id|prom_root_node
)paren
op_eq
l_int|0xffff
)paren
(brace
id|printk
(paren
id|KERN_WARNING
l_string|&quot;openpromfs: couldn&squot;t setup tree&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|nodes
(braket
id|last_node
)braket
dot
id|first_prop
op_assign
id|first_prop
suffix:semicolon
r_return
id|register_filesystem
c_func
(paren
op_amp
id|openprom_fs_type
)paren
suffix:semicolon
)brace
DECL|function|exit_openprom_fs
r_static
r_void
id|__exit
id|exit_openprom_fs
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|unregister_filesystem
c_func
(paren
op_amp
id|openprom_fs_type
)paren
suffix:semicolon
id|free_pages
(paren
(paren
r_int
r_int
)paren
id|nodes
comma
id|alloced
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|aliases_nodes
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|alias_names
(braket
id|i
)braket
)paren
id|kfree
(paren
id|alias_names
(braket
id|i
)braket
)paren
suffix:semicolon
id|nodes
op_assign
l_int|NULL
suffix:semicolon
)brace
id|EXPORT_NO_SYMBOLS
suffix:semicolon
id|module_init
c_func
(paren
id|init_openprom_fs
)paren
id|module_exit
c_func
(paren
id|exit_openprom_fs
)paren
eof
