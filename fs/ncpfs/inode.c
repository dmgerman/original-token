multiline_comment|/*&n; *  inode.c&n; *&n; *  Copyright (C) 1995, 1996 by Volker Lendecke&n; *  Modified for big endian by J.F. Chadima and David S. Miller&n; *  Modified 1997 Peter Waltenberg, Bill Hawes, David Woodhouse for 2.1 dcache&n; *  Modified 1998 Wolfram Pienkoss for NLS&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/locks.h&gt;
macro_line|#include &lt;linux/file.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ncp_fs.h&gt;
macro_line|#include &quot;ncplib_kernel.h&quot;
r_static
r_void
id|ncp_delete_inode
c_func
(paren
r_struct
id|inode
op_star
)paren
suffix:semicolon
r_static
r_void
id|ncp_put_super
c_func
(paren
r_struct
id|super_block
op_star
)paren
suffix:semicolon
r_static
r_int
id|ncp_statfs
c_func
(paren
r_struct
id|super_block
op_star
comma
r_struct
id|statfs
op_star
)paren
suffix:semicolon
DECL|variable|ncp_sops
r_static
r_struct
id|super_operations
id|ncp_sops
op_assign
(brace
id|put_inode
suffix:colon
id|force_delete
comma
id|delete_inode
suffix:colon
id|ncp_delete_inode
comma
id|put_super
suffix:colon
id|ncp_put_super
comma
id|statfs
suffix:colon
id|ncp_statfs
comma
)brace
suffix:semicolon
r_extern
r_struct
id|dentry_operations
id|ncp_dentry_operations
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_EXTRAS
r_extern
r_struct
id|address_space_operations
id|ncp_symlink_aops
suffix:semicolon
r_extern
r_int
id|ncp_symlink
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|dentry
op_star
comma
r_const
r_char
op_star
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * Fill in the ncpfs-specific information in the inode.&n; */
DECL|function|ncp_update_inode
r_void
id|ncp_update_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|ncp_entry_info
op_star
id|nwinfo
)paren
(brace
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|DosDirNum
op_assign
id|nwinfo-&gt;i.DosDirNum
suffix:semicolon
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|dirEntNum
op_assign
id|nwinfo-&gt;i.dirEntNum
suffix:semicolon
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|volNumber
op_assign
id|nwinfo-&gt;i.volNumber
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_STRONG
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|nwattr
op_assign
id|nwinfo-&gt;i.attributes
suffix:semicolon
macro_line|#endif
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|access
op_assign
id|nwinfo-&gt;access
suffix:semicolon
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|server_file_handle
op_assign
id|nwinfo-&gt;server_file_handle
suffix:semicolon
id|memcpy
c_func
(paren
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|file_handle
comma
id|nwinfo-&gt;file_handle
comma
r_sizeof
(paren
id|nwinfo-&gt;file_handle
)paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ncp_update_inode: updated %s, volnum=%d, dirent=%u&bslash;n&quot;
comma
id|nwinfo-&gt;i.entryName
comma
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|volNumber
comma
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|dirEntNum
)paren
suffix:semicolon
)brace
DECL|function|ncp_update_inode2
r_void
id|ncp_update_inode2
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|ncp_entry_info
op_star
id|nwinfo
)paren
(brace
r_struct
id|nw_info_struct
op_star
id|nwi
op_assign
op_amp
id|nwinfo-&gt;i
suffix:semicolon
r_struct
id|ncp_server
op_star
id|server
op_assign
id|NCP_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|opened
)paren
)paren
(brace
macro_line|#ifdef CONFIG_NCPFS_STRONG
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|nwattr
op_assign
id|nwi-&gt;attributes
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|nwi-&gt;attributes
op_amp
id|aDIR
)paren
(brace
id|inode-&gt;i_mode
op_assign
id|server-&gt;m.dir_mode
suffix:semicolon
id|inode-&gt;i_size
op_assign
id|NCP_BLOCK_SIZE
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_mode
op_assign
id|server-&gt;m.file_mode
suffix:semicolon
id|inode-&gt;i_size
op_assign
id|le32_to_cpu
c_func
(paren
id|nwi-&gt;dataStreamSize
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_EXTRAS
r_if
c_cond
(paren
(paren
id|server-&gt;m.flags
op_amp
(paren
id|NCP_MOUNT_EXTRAS
op_or
id|NCP_MOUNT_SYMLINKS
)paren
)paren
op_logical_and
(paren
id|nwi-&gt;attributes
op_amp
id|aSHARED
)paren
)paren
(brace
r_switch
c_cond
(paren
id|nwi-&gt;attributes
op_amp
(paren
id|aHIDDEN
op_or
id|aSYSTEM
)paren
)paren
(brace
r_case
id|aHIDDEN
suffix:colon
r_if
c_cond
(paren
id|server-&gt;m.flags
op_amp
id|NCP_MOUNT_SYMLINKS
)paren
(brace
r_if
c_cond
(paren
multiline_comment|/* (inode-&gt;i_size &gt;= NCP_MIN_SYMLINK_SIZE)&n;&t;&t;&t;&t;&t;&t;&t; &amp;&amp; */
(paren
id|inode-&gt;i_size
op_le
id|NCP_MAX_SYMLINK_SIZE
)paren
)paren
(brace
id|inode-&gt;i_mode
op_assign
(paren
id|inode-&gt;i_mode
op_amp
op_complement
id|S_IFMT
)paren
op_or
id|S_IFLNK
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* FALLTHROUGH */
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|server-&gt;m.flags
op_amp
id|NCP_MOUNT_EXTRAS
)paren
id|inode-&gt;i_mode
op_or_assign
l_int|0444
suffix:semicolon
r_break
suffix:semicolon
r_case
id|aSYSTEM
suffix:colon
r_if
c_cond
(paren
id|server-&gt;m.flags
op_amp
id|NCP_MOUNT_EXTRAS
)paren
id|inode-&gt;i_mode
op_or_assign
(paren
id|inode-&gt;i_mode
op_rshift
l_int|2
)paren
op_amp
l_int|0111
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* case aSYSTEM|aHIDDEN: */
r_default
suffix:colon
multiline_comment|/* reserved combination */
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|nwi-&gt;attributes
op_amp
id|aRONLY
)paren
id|inode-&gt;i_mode
op_and_assign
op_complement
l_int|0222
suffix:semicolon
)brace
id|inode-&gt;i_blocks
op_assign
(paren
id|inode-&gt;i_size
op_plus
id|NCP_BLOCK_SIZE
op_minus
l_int|1
)paren
op_rshift
id|NCP_BLOCK_SHIFT
suffix:semicolon
id|inode-&gt;i_mtime
op_assign
id|ncp_date_dos2unix
c_func
(paren
id|le16_to_cpu
c_func
(paren
id|nwi-&gt;modifyTime
)paren
comma
id|le16_to_cpu
c_func
(paren
id|nwi-&gt;modifyDate
)paren
)paren
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|ncp_date_dos2unix
c_func
(paren
id|le16_to_cpu
c_func
(paren
id|nwi-&gt;creationTime
)paren
comma
id|le16_to_cpu
c_func
(paren
id|nwi-&gt;creationDate
)paren
)paren
suffix:semicolon
id|inode-&gt;i_atime
op_assign
id|ncp_date_dos2unix
c_func
(paren
l_int|0
comma
id|le16_to_cpu
c_func
(paren
id|nwi-&gt;lastAccessDate
)paren
)paren
suffix:semicolon
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|DosDirNum
op_assign
id|nwi-&gt;DosDirNum
suffix:semicolon
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|dirEntNum
op_assign
id|nwi-&gt;dirEntNum
suffix:semicolon
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|volNumber
op_assign
id|nwi-&gt;volNumber
suffix:semicolon
)brace
multiline_comment|/*&n; * Fill in the inode based on the ncp_entry_info structure.&n; */
DECL|function|ncp_set_attr
r_static
r_void
id|ncp_set_attr
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|ncp_entry_info
op_star
id|nwinfo
)paren
(brace
r_struct
id|nw_info_struct
op_star
id|nwi
op_assign
op_amp
id|nwinfo-&gt;i
suffix:semicolon
r_struct
id|ncp_server
op_star
id|server
op_assign
id|NCP_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nwi-&gt;attributes
op_amp
id|aDIR
)paren
(brace
id|inode-&gt;i_mode
op_assign
id|server-&gt;m.dir_mode
suffix:semicolon
multiline_comment|/* for directories dataStreamSize seems to be some&n;&t;&t;   Object ID ??? */
id|inode-&gt;i_size
op_assign
id|NCP_BLOCK_SIZE
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_mode
op_assign
id|server-&gt;m.file_mode
suffix:semicolon
id|inode-&gt;i_size
op_assign
id|le32_to_cpu
c_func
(paren
id|nwi-&gt;dataStreamSize
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_EXTRAS
r_if
c_cond
(paren
(paren
id|server-&gt;m.flags
op_amp
(paren
id|NCP_MOUNT_EXTRAS
op_or
id|NCP_MOUNT_SYMLINKS
)paren
)paren
op_logical_and
(paren
id|nwi-&gt;attributes
op_amp
id|aSHARED
)paren
)paren
(brace
r_switch
c_cond
(paren
id|nwi-&gt;attributes
op_amp
(paren
id|aHIDDEN
op_or
id|aSYSTEM
)paren
)paren
(brace
r_case
id|aHIDDEN
suffix:colon
r_if
c_cond
(paren
id|server-&gt;m.flags
op_amp
id|NCP_MOUNT_SYMLINKS
)paren
(brace
r_if
c_cond
(paren
multiline_comment|/* (inode-&gt;i_size &gt;= NCP_MIN_SYMLINK_SIZE)&n;&t;&t;&t;&t;&t;&t; &amp;&amp; */
(paren
id|inode-&gt;i_size
op_le
id|NCP_MAX_SYMLINK_SIZE
)paren
)paren
(brace
id|inode-&gt;i_mode
op_assign
(paren
id|inode-&gt;i_mode
op_amp
op_complement
id|S_IFMT
)paren
op_or
id|S_IFLNK
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* FALLTHROUGH */
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|server-&gt;m.flags
op_amp
id|NCP_MOUNT_EXTRAS
)paren
id|inode-&gt;i_mode
op_or_assign
l_int|0444
suffix:semicolon
r_break
suffix:semicolon
r_case
id|aSYSTEM
suffix:colon
r_if
c_cond
(paren
id|server-&gt;m.flags
op_amp
id|NCP_MOUNT_EXTRAS
)paren
id|inode-&gt;i_mode
op_or_assign
(paren
id|inode-&gt;i_mode
op_rshift
l_int|2
)paren
op_amp
l_int|0111
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* case aSYSTEM|aHIDDEN: */
r_default
suffix:colon
multiline_comment|/* reserved combination */
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
r_if
c_cond
(paren
id|nwi-&gt;attributes
op_amp
id|aRONLY
)paren
id|inode-&gt;i_mode
op_and_assign
op_complement
l_int|0222
suffix:semicolon
id|DDPRINTK
c_func
(paren
l_string|&quot;ncp_read_inode: inode-&gt;i_mode = %u&bslash;n&quot;
comma
id|inode-&gt;i_mode
)paren
suffix:semicolon
id|inode-&gt;i_nlink
op_assign
l_int|1
suffix:semicolon
id|inode-&gt;i_uid
op_assign
id|server-&gt;m.uid
suffix:semicolon
id|inode-&gt;i_gid
op_assign
id|server-&gt;m.gid
suffix:semicolon
id|inode-&gt;i_rdev
op_assign
l_int|0
suffix:semicolon
id|inode-&gt;i_blksize
op_assign
id|NCP_BLOCK_SIZE
suffix:semicolon
id|inode-&gt;i_blocks
op_assign
(paren
id|inode-&gt;i_size
op_plus
id|NCP_BLOCK_SIZE
op_minus
l_int|1
)paren
op_rshift
id|NCP_BLOCK_SHIFT
suffix:semicolon
id|inode-&gt;i_mtime
op_assign
id|ncp_date_dos2unix
c_func
(paren
id|le16_to_cpu
c_func
(paren
id|nwi-&gt;modifyTime
)paren
comma
id|le16_to_cpu
c_func
(paren
id|nwi-&gt;modifyDate
)paren
)paren
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|ncp_date_dos2unix
c_func
(paren
id|le16_to_cpu
c_func
(paren
id|nwi-&gt;creationTime
)paren
comma
id|le16_to_cpu
c_func
(paren
id|nwi-&gt;creationDate
)paren
)paren
suffix:semicolon
id|inode-&gt;i_atime
op_assign
id|ncp_date_dos2unix
c_func
(paren
l_int|0
comma
id|le16_to_cpu
c_func
(paren
id|nwi-&gt;lastAccessDate
)paren
)paren
suffix:semicolon
id|ncp_update_inode
c_func
(paren
id|inode
comma
id|nwinfo
)paren
suffix:semicolon
)brace
DECL|variable|ncp_symlink_inode_operations
r_static
r_struct
id|inode_operations
id|ncp_symlink_inode_operations
op_assign
(brace
id|readlink
suffix:colon
id|page_readlink
comma
id|follow_link
suffix:colon
id|page_follow_link
comma
id|setattr
suffix:colon
id|ncp_notify_change
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Get a new inode.&n; */
r_struct
id|inode
op_star
DECL|function|ncp_iget
id|ncp_iget
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|ncp_entry_info
op_star
id|info
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_if
c_cond
(paren
id|info
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ncp_iget: info is NULL&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|inode
op_assign
id|new_inode
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inode
)paren
(brace
id|init_MUTEX
c_func
(paren
op_amp
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|open_sem
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|opened
comma
id|info-&gt;opened
)paren
suffix:semicolon
id|inode-&gt;i_ino
op_assign
id|info-&gt;ino
suffix:semicolon
id|ncp_set_attr
c_func
(paren
id|inode
comma
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISREG
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|ncp_file_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|ncp_file_operations
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|ncp_dir_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|ncp_dir_operations
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_EXTRAS
)brace
r_else
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|ncp_symlink_inode_operations
suffix:semicolon
id|inode-&gt;i_data.a_ops
op_assign
op_amp
id|ncp_symlink_aops
suffix:semicolon
macro_line|#endif
)brace
id|insert_inode_hash
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ncp_iget: iget failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|inode
suffix:semicolon
)brace
r_static
r_void
DECL|function|ncp_delete_inode
id|ncp_delete_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
id|DDPRINTK
c_func
(paren
l_string|&quot;ncp_delete_inode: put directory %ld&bslash;n&quot;
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ncp_make_closed
c_func
(paren
id|inode
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* We can&squot;t do anything but complain. */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ncp_delete_inode: could not close&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|clear_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_struct
id|super_block
op_star
DECL|function|ncp_read_super
id|ncp_read_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_void
op_star
id|raw_data
comma
r_int
id|silent
)paren
(brace
r_struct
id|ncp_mount_data_kernel
id|data
suffix:semicolon
r_struct
id|ncp_server
op_star
id|server
suffix:semicolon
r_struct
id|file
op_star
id|ncp_filp
suffix:semicolon
r_struct
id|inode
op_star
id|root_inode
suffix:semicolon
r_struct
id|inode
op_star
id|sock_inode
suffix:semicolon
r_struct
id|socket
op_star
id|sock
suffix:semicolon
r_int
id|error
suffix:semicolon
r_int
id|default_bufsize
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_PACKET_SIGNING
r_int
id|options
suffix:semicolon
macro_line|#endif
r_struct
id|ncp_entry_info
id|finfo
suffix:semicolon
r_if
c_cond
(paren
id|raw_data
op_eq
l_int|NULL
)paren
r_goto
id|out_no_data
suffix:semicolon
r_switch
c_cond
(paren
op_star
(paren
r_int
op_star
)paren
id|raw_data
)paren
(brace
r_case
id|NCP_MOUNT_VERSION
suffix:colon
(brace
r_struct
id|ncp_mount_data
op_star
id|md
op_assign
(paren
r_struct
id|ncp_mount_data
op_star
)paren
id|raw_data
suffix:semicolon
id|data.flags
op_assign
id|md-&gt;flags
suffix:semicolon
id|data.int_flags
op_assign
id|NCP_IMOUNT_LOGGEDIN_POSSIBLE
suffix:semicolon
id|data.mounted_uid
op_assign
id|md-&gt;mounted_uid
suffix:semicolon
id|data.wdog_pid
op_assign
id|md-&gt;wdog_pid
suffix:semicolon
id|data.ncp_fd
op_assign
id|md-&gt;ncp_fd
suffix:semicolon
id|data.time_out
op_assign
id|md-&gt;time_out
suffix:semicolon
id|data.retry_count
op_assign
id|md-&gt;retry_count
suffix:semicolon
id|data.uid
op_assign
id|md-&gt;uid
suffix:semicolon
id|data.gid
op_assign
id|md-&gt;gid
suffix:semicolon
id|data.file_mode
op_assign
id|md-&gt;file_mode
suffix:semicolon
id|data.dir_mode
op_assign
id|md-&gt;dir_mode
suffix:semicolon
id|memcpy
c_func
(paren
id|data.mounted_vol
comma
id|md-&gt;mounted_vol
comma
id|NCP_VOLNAME_LEN
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|NCP_MOUNT_VERSION_V4
suffix:colon
(brace
r_struct
id|ncp_mount_data_v4
op_star
id|md
op_assign
(paren
r_struct
id|ncp_mount_data_v4
op_star
)paren
id|raw_data
suffix:semicolon
id|data.flags
op_assign
id|md-&gt;flags
suffix:semicolon
id|data.int_flags
op_assign
l_int|0
suffix:semicolon
id|data.mounted_uid
op_assign
id|md-&gt;mounted_uid
suffix:semicolon
id|data.wdog_pid
op_assign
id|md-&gt;wdog_pid
suffix:semicolon
id|data.ncp_fd
op_assign
id|md-&gt;ncp_fd
suffix:semicolon
id|data.time_out
op_assign
id|md-&gt;time_out
suffix:semicolon
id|data.retry_count
op_assign
id|md-&gt;retry_count
suffix:semicolon
id|data.uid
op_assign
id|md-&gt;uid
suffix:semicolon
id|data.gid
op_assign
id|md-&gt;gid
suffix:semicolon
id|data.file_mode
op_assign
id|md-&gt;file_mode
suffix:semicolon
id|data.dir_mode
op_assign
id|md-&gt;dir_mode
suffix:semicolon
id|data.mounted_vol
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|out_bad_mount
suffix:semicolon
)brace
id|ncp_filp
op_assign
id|fget
c_func
(paren
id|data.ncp_fd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ncp_filp
)paren
r_goto
id|out_bad_file
suffix:semicolon
id|sock_inode
op_assign
id|ncp_filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|S_ISSOCK
c_func
(paren
id|sock_inode-&gt;i_mode
)paren
)paren
r_goto
id|out_bad_file2
suffix:semicolon
id|sock
op_assign
op_amp
id|sock_inode-&gt;u.socket_i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sock
)paren
r_goto
id|out_bad_file2
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_STREAM
)paren
id|default_bufsize
op_assign
l_int|61440
suffix:semicolon
r_else
id|default_bufsize
op_assign
l_int|1024
suffix:semicolon
id|sb-&gt;s_blocksize
op_assign
l_int|1024
suffix:semicolon
multiline_comment|/* Eh...  Is this correct? */
id|sb-&gt;s_blocksize_bits
op_assign
l_int|10
suffix:semicolon
id|sb-&gt;s_magic
op_assign
id|NCP_SUPER_MAGIC
suffix:semicolon
id|sb-&gt;s_op
op_assign
op_amp
id|ncp_sops
suffix:semicolon
id|server
op_assign
id|NCP_SBP
c_func
(paren
id|sb
)paren
suffix:semicolon
id|memset
c_func
(paren
id|server
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|server
)paren
)paren
suffix:semicolon
id|server-&gt;ncp_filp
op_assign
id|ncp_filp
suffix:semicolon
multiline_comment|/*&t;server-&gt;lock = 0;&t;*/
id|init_MUTEX
c_func
(paren
op_amp
id|server-&gt;sem
)paren
suffix:semicolon
id|server-&gt;packet
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&t;server-&gt;buffer_size = 0;&t;*/
multiline_comment|/*&t;server-&gt;conn_status = 0;&t;*/
multiline_comment|/*&t;server-&gt;root_dentry = NULL;&t;*/
multiline_comment|/*&t;server-&gt;root_setuped = 0;&t;*/
macro_line|#ifdef CONFIG_NCPFS_PACKET_SIGNING
multiline_comment|/*&t;server-&gt;sign_wanted = 0;&t;*/
multiline_comment|/*&t;server-&gt;sign_active = 0;&t;*/
macro_line|#endif
id|server-&gt;auth.auth_type
op_assign
id|NCP_AUTH_NONE
suffix:semicolon
multiline_comment|/*&t;server-&gt;auth.object_name_len = 0;&t;*/
multiline_comment|/*&t;server-&gt;auth.object_name = NULL;&t;*/
multiline_comment|/*&t;server-&gt;auth.object_type = 0;&t;&t;*/
multiline_comment|/*&t;server-&gt;priv.len = 0;&t;&t;&t;*/
multiline_comment|/*&t;server-&gt;priv.data = NULL;&t;&t;*/
id|server-&gt;m
op_assign
id|data
suffix:semicolon
multiline_comment|/* Althought anything producing this is buggy, it happens&n;&t;   now because of PATH_MAX changes.. */
r_if
c_cond
(paren
id|server-&gt;m.time_out
OL
l_int|1
)paren
(brace
id|server-&gt;m.time_out
op_assign
l_int|10
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;You need to recompile your ncpfs utils..&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|server-&gt;m.time_out
op_assign
id|server-&gt;m.time_out
op_star
id|HZ
op_div
l_int|100
suffix:semicolon
id|server-&gt;m.file_mode
op_assign
(paren
id|server-&gt;m.file_mode
op_amp
(paren
id|S_IRWXU
op_or
id|S_IRWXG
op_or
id|S_IRWXO
)paren
)paren
op_or
id|S_IFREG
suffix:semicolon
id|server-&gt;m.dir_mode
op_assign
(paren
id|server-&gt;m.dir_mode
op_amp
(paren
id|S_IRWXU
op_or
id|S_IRWXG
op_or
id|S_IRWXO
)paren
)paren
op_or
id|S_IFDIR
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_NLS
multiline_comment|/* load the default NLS charsets */
id|server-&gt;nls_vol
op_assign
id|load_nls_default
c_func
(paren
)paren
suffix:semicolon
id|server-&gt;nls_io
op_assign
id|load_nls_default
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_NCPFS_NLS */
id|server-&gt;dentry_ttl
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no caching */
DECL|macro|NCP_PACKET_SIZE
macro_line|#undef NCP_PACKET_SIZE
DECL|macro|NCP_PACKET_SIZE
mdefine_line|#define NCP_PACKET_SIZE 65536
id|server-&gt;packet_size
op_assign
id|NCP_PACKET_SIZE
suffix:semicolon
id|server-&gt;packet
op_assign
id|vmalloc
c_func
(paren
id|NCP_PACKET_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|server-&gt;packet
op_eq
l_int|NULL
)paren
r_goto
id|out_no_packet
suffix:semicolon
id|ncp_lock_server
c_func
(paren
id|server
)paren
suffix:semicolon
id|error
op_assign
id|ncp_connect
c_func
(paren
id|server
)paren
suffix:semicolon
id|ncp_unlock_server
c_func
(paren
id|server
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
OL
l_int|0
)paren
r_goto
id|out_no_connect
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ncp_read_super: NCP_SBP(sb) = %x&bslash;n&quot;
comma
(paren
r_int
)paren
id|NCP_SBP
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_PACKET_SIGNING
r_if
c_cond
(paren
id|ncp_negotiate_size_and_options
c_func
(paren
id|server
comma
id|default_bufsize
comma
id|NCP_DEFAULT_OPTIONS
comma
op_amp
(paren
id|server-&gt;buffer_size
)paren
comma
op_amp
id|options
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|options
op_ne
id|NCP_DEFAULT_OPTIONS
)paren
(brace
r_if
c_cond
(paren
id|ncp_negotiate_size_and_options
c_func
(paren
id|server
comma
id|default_bufsize
comma
id|options
op_amp
l_int|2
comma
op_amp
(paren
id|server-&gt;buffer_size
)paren
comma
op_amp
id|options
)paren
op_ne
l_int|0
)paren
(brace
r_goto
id|out_no_bufsize
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|options
op_amp
l_int|2
)paren
id|server-&gt;sign_wanted
op_assign
l_int|1
suffix:semicolon
)brace
r_else
macro_line|#endif&t;/* CONFIG_NCPFS_PACKET_SIGNING */
r_if
c_cond
(paren
id|ncp_negotiate_buffersize
c_func
(paren
id|server
comma
id|default_bufsize
comma
op_amp
(paren
id|server-&gt;buffer_size
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out_no_bufsize
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ncpfs: bufsize = %d&bslash;n&quot;
comma
id|server-&gt;buffer_size
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|finfo
comma
l_int|0
comma
r_sizeof
(paren
id|finfo
)paren
)paren
suffix:semicolon
id|finfo.i.attributes
op_assign
id|aDIR
suffix:semicolon
id|finfo.i.dataStreamSize
op_assign
id|NCP_BLOCK_SIZE
suffix:semicolon
id|finfo.i.dirEntNum
op_assign
l_int|0
suffix:semicolon
id|finfo.i.DosDirNum
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_SMALLDOS
id|finfo.i.NSCreator
op_assign
id|NW_NS_DOS
suffix:semicolon
macro_line|#endif
id|finfo.i.volNumber
op_assign
id|NCP_NUMBER_OF_VOLUMES
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* illegal volnum */
multiline_comment|/* set dates of mountpoint to Jan 1, 1986; 00:00 */
id|finfo.i.creationTime
op_assign
id|finfo.i.modifyTime
op_assign
id|cpu_to_le16
c_func
(paren
l_int|0x0000
)paren
suffix:semicolon
id|finfo.i.creationDate
op_assign
id|finfo.i.modifyDate
op_assign
id|finfo.i.lastAccessDate
op_assign
id|cpu_to_le16
c_func
(paren
l_int|0x0C21
)paren
suffix:semicolon
id|finfo.i.nameLen
op_assign
l_int|0
suffix:semicolon
id|finfo.i.entryName
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|finfo.opened
op_assign
l_int|0
suffix:semicolon
id|finfo.ino
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* tradition */
id|server-&gt;name_space
(braket
id|finfo.i.volNumber
)braket
op_assign
id|NW_NS_DOS
suffix:semicolon
id|root_inode
op_assign
id|ncp_iget
c_func
(paren
id|sb
comma
op_amp
id|finfo
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|root_inode
)paren
r_goto
id|out_no_root
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ncp_read_super: root vol=%d&bslash;n&quot;
comma
id|NCP_FINFO
c_func
(paren
id|root_inode
)paren
op_member_access_from_pointer
id|volNumber
)paren
suffix:semicolon
id|sb-&gt;s_root
op_assign
id|d_alloc_root
c_func
(paren
id|root_inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb-&gt;s_root
)paren
r_goto
id|out_no_root
suffix:semicolon
id|sb-&gt;s_root-&gt;d_op
op_assign
op_amp
id|ncp_dentry_operations
suffix:semicolon
r_return
id|sb
suffix:semicolon
id|out_no_root
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ncp_read_super: get root inode failed&bslash;n&quot;
)paren
suffix:semicolon
id|iput
c_func
(paren
id|root_inode
)paren
suffix:semicolon
r_goto
id|out_disconnect
suffix:semicolon
id|out_no_bufsize
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ncp_read_super: could not get bufsize&bslash;n&quot;
)paren
suffix:semicolon
id|out_disconnect
suffix:colon
id|ncp_lock_server
c_func
(paren
id|server
)paren
suffix:semicolon
id|ncp_disconnect
c_func
(paren
id|server
)paren
suffix:semicolon
id|ncp_unlock_server
c_func
(paren
id|server
)paren
suffix:semicolon
r_goto
id|out_free_packet
suffix:semicolon
id|out_no_connect
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ncp_read_super: Failed connection, error=%d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
id|out_free_packet
suffix:colon
id|vfree
c_func
(paren
id|server-&gt;packet
)paren
suffix:semicolon
r_goto
id|out_free_server
suffix:semicolon
id|out_no_packet
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ncp_read_super: could not alloc packet&bslash;n&quot;
)paren
suffix:semicolon
id|out_free_server
suffix:colon
macro_line|#ifdef CONFIG_NCPFS_NLS
id|unload_nls
c_func
(paren
id|server-&gt;nls_io
)paren
suffix:semicolon
id|unload_nls
c_func
(paren
id|server-&gt;nls_vol
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* 23/12/1998 Marcin Dalecki &lt;dalecki@cs.net.pl&gt;:&n;&t; * &n;&t; * The previously used put_filp(ncp_filp); was bogous, since&n;&t; * it doesn&squot;t proper unlocking.&n;&t; */
id|fput
c_func
(paren
id|ncp_filp
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|out_bad_file2
suffix:colon
id|fput
c_func
(paren
id|ncp_filp
)paren
suffix:semicolon
id|out_bad_file
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ncp_read_super: invalid ncp socket&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|out_bad_mount
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ncp_read_super: kernel requires mount version %d&bslash;n&quot;
comma
id|NCP_MOUNT_VERSION
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|out_no_data
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ncp_read_super: missing data argument&bslash;n&quot;
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ncp_put_super
r_static
r_void
id|ncp_put_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|ncp_server
op_star
id|server
op_assign
id|NCP_SBP
c_func
(paren
id|sb
)paren
suffix:semicolon
id|ncp_lock_server
c_func
(paren
id|server
)paren
suffix:semicolon
id|ncp_disconnect
c_func
(paren
id|server
)paren
suffix:semicolon
id|ncp_unlock_server
c_func
(paren
id|server
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_NLS
multiline_comment|/* unload the NLS charsets */
r_if
c_cond
(paren
id|server-&gt;nls_vol
)paren
(brace
id|unload_nls
c_func
(paren
id|server-&gt;nls_vol
)paren
suffix:semicolon
id|server-&gt;nls_vol
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|server-&gt;nls_io
)paren
(brace
id|unload_nls
c_func
(paren
id|server-&gt;nls_io
)paren
suffix:semicolon
id|server-&gt;nls_io
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_NCPFS_NLS */
id|fput
c_func
(paren
id|server-&gt;ncp_filp
)paren
suffix:semicolon
id|kill_proc
c_func
(paren
id|server-&gt;m.wdog_pid
comma
id|SIGTERM
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|server-&gt;priv.data
)paren
id|ncp_kfree_s
c_func
(paren
id|server-&gt;priv.data
comma
id|server-&gt;priv.len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|server-&gt;auth.object_name
)paren
id|ncp_kfree_s
c_func
(paren
id|server-&gt;auth.object_name
comma
id|server-&gt;auth.object_name_len
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|server-&gt;packet
)paren
suffix:semicolon
)brace
DECL|function|ncp_statfs
r_static
r_int
id|ncp_statfs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|statfs
op_star
id|buf
)paren
(brace
multiline_comment|/* We cannot say how much disk space is left on a mounted&n;&t;   NetWare Server, because free space is distributed over&n;&t;   volumes, and the current user might have disk quotas. So&n;&t;   free space is not that simple to determine. Our decision&n;&t;   here is to err conservatively. */
id|buf-&gt;f_type
op_assign
id|NCP_SUPER_MAGIC
suffix:semicolon
id|buf-&gt;f_bsize
op_assign
id|NCP_BLOCK_SIZE
suffix:semicolon
id|buf-&gt;f_blocks
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;f_bfree
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;f_bavail
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;f_namelen
op_assign
l_int|12
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ncp_notify_change
r_int
id|ncp_notify_change
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|iattr
op_star
id|attr
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_int
id|info_mask
suffix:semicolon
r_struct
id|nw_modify_dos_info
id|info
suffix:semicolon
r_struct
id|ncp_server
op_star
id|server
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
id|server
op_assign
id|NCP_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|server
)paren
op_logical_or
op_logical_neg
id|ncp_conn_valid
c_func
(paren
id|server
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* ageing the dentry to force validation */
id|ncp_age_dentry
c_func
(paren
id|server
comma
id|dentry
)paren
suffix:semicolon
id|result
op_assign
id|inode_change_ok
c_func
(paren
id|inode
comma
id|attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|result
op_assign
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_UID
)paren
op_logical_and
(paren
id|attr-&gt;ia_uid
op_ne
id|server-&gt;m.uid
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_GID
)paren
op_logical_and
(paren
id|attr-&gt;ia_gid
op_ne
id|server-&gt;m.gid
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_MODE
)paren
op_logical_and
(paren
id|attr-&gt;ia_mode
op_amp
op_complement
(paren
id|S_IFREG
op_or
id|S_IFDIR
op_or
id|S_IRWXU
op_or
id|S_IRWXG
op_or
id|S_IRWXO
)paren
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|info_mask
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|info
comma
l_int|0
comma
r_sizeof
(paren
id|info
)paren
)paren
suffix:semicolon
macro_line|#if 1 
r_if
c_cond
(paren
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_MODE
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
id|umode_t
id|newmode
suffix:semicolon
id|info_mask
op_or_assign
id|DM_ATTRIBUTES
suffix:semicolon
id|newmode
op_assign
id|attr-&gt;ia_mode
suffix:semicolon
id|newmode
op_and_assign
id|NCP_SERVER
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|m.dir_mode
suffix:semicolon
r_if
c_cond
(paren
id|newmode
op_amp
l_int|0222
)paren
id|info.attributes
op_and_assign
op_complement
(paren
id|aRONLY
op_or
id|aRENAMEINHIBIT
op_or
id|aDELETEINHIBIT
)paren
suffix:semicolon
r_else
id|info.attributes
op_or_assign
(paren
id|aRONLY
op_or
id|aRENAMEINHIBIT
op_or
id|aDELETEINHIBIT
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|S_ISREG
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_else
(brace
id|umode_t
id|newmode
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_EXTRAS&t;&t;&t;
r_int
id|extras
suffix:semicolon
id|extras
op_assign
id|server-&gt;m.flags
op_amp
id|NCP_MOUNT_EXTRAS
suffix:semicolon
macro_line|#endif
id|info_mask
op_or_assign
id|DM_ATTRIBUTES
suffix:semicolon
id|newmode
op_assign
id|attr-&gt;ia_mode
suffix:semicolon
macro_line|#ifdef CONFIG_NCPFS_EXTRAS
r_if
c_cond
(paren
op_logical_neg
id|extras
)paren
macro_line|#endif
id|newmode
op_and_assign
id|server-&gt;m.file_mode
suffix:semicolon
r_if
c_cond
(paren
id|newmode
op_amp
l_int|0222
)paren
multiline_comment|/* any write bit set */
(brace
id|info.attributes
op_and_assign
op_complement
(paren
id|aRONLY
op_or
id|aRENAMEINHIBIT
op_or
id|aDELETEINHIBIT
)paren
suffix:semicolon
)brace
r_else
(brace
id|info.attributes
op_or_assign
(paren
id|aRONLY
op_or
id|aRENAMEINHIBIT
op_or
id|aDELETEINHIBIT
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NCPFS_EXTRAS
r_if
c_cond
(paren
id|extras
)paren
(brace
r_if
c_cond
(paren
id|newmode
op_amp
l_int|0111
)paren
multiline_comment|/* any execute bit set */
id|info.attributes
op_or_assign
id|aSHARED
op_or
id|aSYSTEM
suffix:semicolon
multiline_comment|/* read for group/world and not in default file_mode */
r_else
r_if
c_cond
(paren
id|newmode
op_amp
op_complement
id|server-&gt;m.file_mode
op_amp
l_int|0444
)paren
id|info.attributes
op_or_assign
id|aSHARED
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_CTIME
)paren
op_ne
l_int|0
)paren
(brace
id|info_mask
op_or_assign
(paren
id|DM_CREATE_TIME
op_or
id|DM_CREATE_DATE
)paren
suffix:semicolon
id|ncp_date_unix2dos
c_func
(paren
id|attr-&gt;ia_ctime
comma
op_amp
(paren
id|info.creationTime
)paren
comma
op_amp
(paren
id|info.creationDate
)paren
)paren
suffix:semicolon
id|info.creationTime
op_assign
id|le16_to_cpu
c_func
(paren
id|info.creationTime
)paren
suffix:semicolon
id|info.creationDate
op_assign
id|le16_to_cpu
c_func
(paren
id|info.creationDate
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_MTIME
)paren
op_ne
l_int|0
)paren
(brace
id|info_mask
op_or_assign
(paren
id|DM_MODIFY_TIME
op_or
id|DM_MODIFY_DATE
)paren
suffix:semicolon
id|ncp_date_unix2dos
c_func
(paren
id|attr-&gt;ia_mtime
comma
op_amp
(paren
id|info.modifyTime
)paren
comma
op_amp
(paren
id|info.modifyDate
)paren
)paren
suffix:semicolon
id|info.modifyTime
op_assign
id|le16_to_cpu
c_func
(paren
id|info.modifyTime
)paren
suffix:semicolon
id|info.modifyDate
op_assign
id|le16_to_cpu
c_func
(paren
id|info.modifyDate
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_ATIME
)paren
op_ne
l_int|0
)paren
(brace
id|__u16
id|dummy
suffix:semicolon
id|info_mask
op_or_assign
(paren
id|DM_LAST_ACCESS_DATE
)paren
suffix:semicolon
id|ncp_date_unix2dos
c_func
(paren
id|attr-&gt;ia_ctime
comma
op_amp
(paren
id|dummy
)paren
comma
op_amp
(paren
id|info.lastAccessDate
)paren
)paren
suffix:semicolon
id|info.lastAccessDate
op_assign
id|le16_to_cpu
c_func
(paren
id|info.lastAccessDate
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info_mask
op_ne
l_int|0
)paren
(brace
id|result
op_assign
id|ncp_modify_file_or_subdir_dos_info
c_func
(paren
id|NCP_SERVER
c_func
(paren
id|inode
)paren
comma
id|inode
comma
id|info_mask
comma
op_amp
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ne
l_int|0
)paren
(brace
id|result
op_assign
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|info_mask
op_eq
(paren
id|DM_CREATE_TIME
op_or
id|DM_CREATE_DATE
)paren
)paren
(brace
multiline_comment|/* NetWare seems not to allow this. I&n;&t;&t;&t;&t;   do not know why. So, just tell the&n;&t;&t;&t;&t;   user everything went fine. This is&n;&t;&t;&t;&t;   a terrible hack, but I do not know&n;&t;&t;&t;&t;   how to do this correctly. */
id|result
op_assign
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_NCPFS_STRONG&t;&t;
r_if
c_cond
(paren
(paren
op_logical_neg
id|result
)paren
op_logical_and
(paren
id|info_mask
op_amp
id|DM_ATTRIBUTES
)paren
)paren
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|nwattr
op_assign
id|info.attributes
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_SIZE
)paren
op_ne
l_int|0
)paren
(brace
r_int
id|written
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;ncpfs: trying to change size to %ld&bslash;n&quot;
comma
id|attr-&gt;ia_size
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|ncp_make_open
c_func
(paren
id|inode
comma
id|O_WRONLY
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EACCES
suffix:semicolon
)brace
id|ncp_write_kernel
c_func
(paren
id|NCP_SERVER
c_func
(paren
id|inode
)paren
comma
id|NCP_FINFO
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|file_handle
comma
id|attr-&gt;ia_size
comma
l_int|0
comma
l_string|&quot;&quot;
comma
op_amp
id|written
)paren
suffix:semicolon
multiline_comment|/* According to ndir, the changes only take effect after&n;&t;&t;   closing the file */
id|ncp_inode_close
c_func
(paren
id|inode
)paren
suffix:semicolon
id|result
op_assign
id|ncp_make_closed
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|result
)paren
id|vmtruncate
c_func
(paren
id|inode
comma
id|attr-&gt;ia_size
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|result
suffix:semicolon
)brace
macro_line|#ifdef DEBUG_NCP_MALLOC
DECL|variable|ncp_malloced
r_int
id|ncp_malloced
suffix:semicolon
DECL|variable|ncp_current_malloced
r_int
id|ncp_current_malloced
suffix:semicolon
macro_line|#endif
r_static
id|DECLARE_FSTYPE
c_func
(paren
id|ncp_fs_type
comma
l_string|&quot;ncpfs&quot;
comma
id|ncp_read_super
comma
l_int|0
)paren
suffix:semicolon
DECL|function|init_ncp_fs
r_static
r_int
id|__init
id|init_ncp_fs
c_func
(paren
r_void
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ncpfs: init_module called&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_NCP_MALLOC
id|ncp_malloced
op_assign
l_int|0
suffix:semicolon
id|ncp_current_malloced
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_return
id|register_filesystem
c_func
(paren
op_amp
id|ncp_fs_type
)paren
suffix:semicolon
)brace
DECL|function|exit_ncp_fs
r_static
r_void
id|__exit
id|exit_ncp_fs
c_func
(paren
r_void
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;ncpfs: cleanup_module called&bslash;n&quot;
)paren
suffix:semicolon
id|unregister_filesystem
c_func
(paren
op_amp
id|ncp_fs_type
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_NCP_MALLOC
id|PRINTK
c_func
(paren
l_string|&quot;ncp_malloced: %d&bslash;n&quot;
comma
id|ncp_malloced
)paren
suffix:semicolon
id|PRINTK
c_func
(paren
l_string|&quot;ncp_current_malloced: %d&bslash;n&quot;
comma
id|ncp_current_malloced
)paren
suffix:semicolon
macro_line|#endif
)brace
id|EXPORT_NO_SYMBOLS
suffix:semicolon
id|module_init
c_func
(paren
id|init_ncp_fs
)paren
id|module_exit
c_func
(paren
id|exit_ncp_fs
)paren
eof
