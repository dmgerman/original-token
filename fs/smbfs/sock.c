multiline_comment|/*&n; *  sock.c&n; *&n; *  Copyright (C) 1995, 1996 by Paal-Kr. Engstad and Volker Lendecke&n; *  Copyright (C) 1997 by Volker Lendecke&n; *&n; */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smb_fs.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;net/scm.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;linux/smb.h&gt;
macro_line|#include &lt;linux/smbno.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|macro|SMBFS_PARANOIA
mdefine_line|#define SMBFS_PARANOIA 1
multiline_comment|/* #define SMBFS_DEBUG_VERBOSE 1 */
DECL|macro|_S
mdefine_line|#define _S(nr) (1&lt;&lt;((nr)-1))
r_static
r_int
DECL|function|_recvfrom
id|_recvfrom
c_func
(paren
r_struct
id|socket
op_star
id|socket
comma
r_int
r_char
op_star
id|ubuf
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_struct
id|iovec
id|iov
suffix:semicolon
r_struct
id|msghdr
id|msg
suffix:semicolon
r_struct
id|scm_cookie
id|scm
suffix:semicolon
id|msg.msg_name
op_assign
l_int|NULL
suffix:semicolon
id|msg.msg_namelen
op_assign
l_int|0
suffix:semicolon
id|msg.msg_iov
op_assign
op_amp
id|iov
suffix:semicolon
id|msg.msg_iovlen
op_assign
l_int|1
suffix:semicolon
id|msg.msg_control
op_assign
l_int|NULL
suffix:semicolon
id|iov.iov_base
op_assign
id|ubuf
suffix:semicolon
id|iov.iov_len
op_assign
id|size
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|scm
comma
l_int|0
comma
r_sizeof
(paren
id|scm
)paren
)paren
suffix:semicolon
id|size
op_assign
id|socket-&gt;ops
op_member_access_from_pointer
id|recvmsg
c_func
(paren
id|socket
comma
op_amp
id|msg
comma
id|size
comma
id|flags
comma
op_amp
id|scm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ge
l_int|0
)paren
(brace
id|scm_recv
c_func
(paren
id|socket
comma
op_amp
id|msg
comma
op_amp
id|scm
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
id|size
suffix:semicolon
)brace
r_static
r_int
DECL|function|_send
id|_send
c_func
(paren
r_struct
id|socket
op_star
id|socket
comma
r_const
r_void
op_star
id|buff
comma
r_int
id|len
)paren
(brace
r_struct
id|iovec
id|iov
suffix:semicolon
r_struct
id|msghdr
id|msg
suffix:semicolon
r_struct
id|scm_cookie
id|scm
suffix:semicolon
r_int
id|err
suffix:semicolon
id|msg.msg_name
op_assign
l_int|NULL
suffix:semicolon
id|msg.msg_namelen
op_assign
l_int|0
suffix:semicolon
id|msg.msg_iov
op_assign
op_amp
id|iov
suffix:semicolon
id|msg.msg_iovlen
op_assign
l_int|1
suffix:semicolon
id|msg.msg_control
op_assign
l_int|NULL
suffix:semicolon
id|msg.msg_controllen
op_assign
l_int|0
suffix:semicolon
id|iov.iov_base
op_assign
(paren
r_void
op_star
)paren
id|buff
suffix:semicolon
id|iov.iov_len
op_assign
id|len
suffix:semicolon
id|msg.msg_flags
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|scm_send
c_func
(paren
id|socket
comma
op_amp
id|msg
comma
op_amp
id|scm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|0
)paren
(brace
id|err
op_assign
id|socket-&gt;ops
op_member_access_from_pointer
id|sendmsg
c_func
(paren
id|socket
comma
op_amp
id|msg
comma
id|len
comma
op_amp
id|scm
)paren
suffix:semicolon
id|scm_destroy
c_func
(paren
op_amp
id|scm
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * N.B. What happens if we&squot;re in here when the socket closes??&n; */
r_static
r_void
DECL|function|smb_data_callback
id|smb_data_callback
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|len
)paren
(brace
r_struct
id|socket
op_star
id|socket
op_assign
id|sk-&gt;socket
suffix:semicolon
r_int
r_char
id|peek_buf
(braket
l_int|4
)braket
suffix:semicolon
r_int
id|result
suffix:semicolon
r_int
r_int
id|fs
suffix:semicolon
id|fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;dead
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;smb_data_callback: sock dead!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|result
op_assign
id|_recvfrom
c_func
(paren
id|socket
comma
(paren
r_void
op_star
)paren
id|peek_buf
comma
l_int|1
comma
id|MSG_PEEK
op_or
id|MSG_DONTWAIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|EAGAIN
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|peek_buf
(braket
l_int|0
)braket
op_ne
l_int|0x85
)paren
r_break
suffix:semicolon
multiline_comment|/* got SESSION KEEP ALIVE */
id|result
op_assign
id|_recvfrom
c_func
(paren
id|socket
comma
(paren
r_void
op_star
)paren
id|peek_buf
comma
l_int|4
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;smb_data_callback: got SESSION KEEPALIVE&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|EAGAIN
)paren
r_break
suffix:semicolon
)brace
id|set_fs
c_func
(paren
id|fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ne
op_minus
id|EAGAIN
)paren
(brace
id|wake_up_interruptible
c_func
(paren
id|sk-&gt;sleep
)paren
suffix:semicolon
)brace
)brace
r_static
r_struct
id|socket
op_star
DECL|function|server_sock
id|server_sock
c_func
(paren
r_struct
id|smb_sb_info
op_star
id|server
)paren
(brace
r_struct
id|file
op_star
id|file
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_if
c_cond
(paren
id|server
op_logical_and
(paren
id|file
op_assign
id|server-&gt;sock_file
)paren
op_logical_and
(paren
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
)paren
op_logical_and
id|S_ISSOCK
c_func
(paren
id|inode-&gt;i_mode
)paren
op_logical_and
id|inode-&gt;u.socket_i.type
op_eq
id|SOCK_STREAM
)paren
r_return
op_amp
(paren
id|inode-&gt;u.socket_i
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_int
DECL|function|smb_catch_keepalive
id|smb_catch_keepalive
c_func
(paren
r_struct
id|smb_sb_info
op_star
id|server
)paren
(brace
r_struct
id|socket
op_star
id|socket
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_void
op_star
id|data_ready
suffix:semicolon
r_int
id|error
suffix:semicolon
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|socket
op_assign
id|server_sock
c_func
(paren
id|server
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|socket
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;smb_catch_keepalive: did not get valid server!&bslash;n&quot;
)paren
suffix:semicolon
id|server-&gt;data_ready
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|sk
op_assign
id|socket-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_catch_keepalive: sk == NULL&quot;
)paren
suffix:semicolon
id|server-&gt;data_ready
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_catch_keepalive.: sk-&gt;d_r = %x, server-&gt;d_r = %x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
(paren
id|sk-&gt;data_ready
)paren
comma
(paren
r_int
r_int
)paren
(paren
id|server-&gt;data_ready
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Install the callback atomically to avoid races ...&n;&t; */
id|data_ready
op_assign
id|xchg
c_func
(paren
op_amp
id|sk-&gt;data_ready
comma
id|smb_data_callback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data_ready
op_ne
id|smb_data_callback
)paren
(brace
id|server-&gt;data_ready
op_assign
id|data_ready
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;smb_catch_keepalive: already done&bslash;n&quot;
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|error
suffix:semicolon
)brace
r_int
DECL|function|smb_dont_catch_keepalive
id|smb_dont_catch_keepalive
c_func
(paren
r_struct
id|smb_sb_info
op_star
id|server
)paren
(brace
r_struct
id|socket
op_star
id|socket
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_void
op_star
id|data_ready
suffix:semicolon
r_int
id|error
suffix:semicolon
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|socket
op_assign
id|server_sock
c_func
(paren
id|server
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|socket
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;smb_dont_catch_keepalive: did not get valid server!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|sk
op_assign
id|socket-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;smb_dont_catch_keepalive: sk == NULL&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Is this really an error?? */
r_if
c_cond
(paren
id|server-&gt;data_ready
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;smb_dont_catch_keepalive: &quot;
l_string|&quot;server-&gt;data_ready == NULL&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_dont_catch_keepalive: sk-&gt;d_r = %x, server-&gt;d_r = %x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
(paren
id|sk-&gt;data_ready
)paren
comma
(paren
r_int
r_int
)paren
(paren
id|server-&gt;data_ready
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Restore the original callback atomically to avoid races ...&n;&t; */
id|data_ready
op_assign
id|xchg
c_func
(paren
op_amp
id|sk-&gt;data_ready
comma
id|server-&gt;data_ready
)paren
suffix:semicolon
id|server-&gt;data_ready
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|data_ready
op_ne
id|smb_data_callback
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;smb_dont_catch_keepalive: &quot;
l_string|&quot;sk-&gt;data_callback != smb_data_callback&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|error
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/*&n; * Called with the server locked.&n; */
r_void
DECL|function|smb_close_socket
id|smb_close_socket
c_func
(paren
r_struct
id|smb_sb_info
op_star
id|server
)paren
(brace
r_struct
id|file
op_star
id|file
op_assign
id|server-&gt;sock_file
suffix:semicolon
r_if
c_cond
(paren
id|file
)paren
(brace
r_struct
id|socket
op_star
id|socket
op_assign
id|server_sock
c_func
(paren
id|server
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;smb_close_socket: closing socket %p&bslash;n&quot;
comma
id|socket
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * We need a way to check for tasks running the callback!&n;&t;&t; */
r_if
c_cond
(paren
id|socket-&gt;sk-&gt;data_ready
op_eq
id|smb_data_callback
)paren
id|printk
c_func
(paren
l_string|&quot;smb_close_socket: still catching keepalives!&bslash;n&quot;
)paren
suffix:semicolon
id|server-&gt;sock_file
op_assign
l_int|NULL
suffix:semicolon
id|close_fp
c_func
(paren
id|file
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|smb_send_raw
id|smb_send_raw
c_func
(paren
r_struct
id|socket
op_star
id|socket
comma
r_int
r_char
op_star
id|source
comma
r_int
id|length
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
id|already_sent
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|already_sent
OL
id|length
)paren
(brace
id|result
op_assign
id|_send
c_func
(paren
id|socket
comma
(paren
r_void
op_star
)paren
(paren
id|source
op_plus
id|already_sent
)paren
comma
id|length
op_minus
id|already_sent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_send_raw: sendto error = %d&bslash;n&quot;
comma
op_minus
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
id|already_sent
op_add_assign
id|result
suffix:semicolon
)brace
r_return
id|already_sent
suffix:semicolon
)brace
r_static
r_int
DECL|function|smb_receive_raw
id|smb_receive_raw
c_func
(paren
r_struct
id|socket
op_star
id|socket
comma
r_int
r_char
op_star
id|target
comma
r_int
id|length
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
id|already_read
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|already_read
OL
id|length
)paren
(brace
id|result
op_assign
id|_recvfrom
c_func
(paren
id|socket
comma
(paren
r_void
op_star
)paren
(paren
id|target
op_plus
id|already_read
)paren
comma
id|length
op_minus
id|already_read
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_receive_raw: recvfrom error = %d&bslash;n&quot;
comma
op_minus
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
id|already_read
op_add_assign
id|result
suffix:semicolon
)brace
r_return
id|already_read
suffix:semicolon
)brace
r_static
r_int
DECL|function|smb_get_length
id|smb_get_length
c_func
(paren
r_struct
id|socket
op_star
id|socket
comma
r_int
r_char
op_star
id|header
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
r_char
id|peek_buf
(braket
l_int|4
)braket
suffix:semicolon
r_int
r_int
id|fs
suffix:semicolon
id|re_recv
suffix:colon
id|fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|result
op_assign
id|smb_receive_raw
c_func
(paren
id|socket
comma
id|peek_buf
comma
l_int|4
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_get_length: recv error = %d&bslash;n&quot;
comma
op_minus
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|peek_buf
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|0x00
suffix:colon
r_case
l_int|0x82
suffix:colon
r_break
suffix:semicolon
r_case
l_int|0x85
suffix:colon
id|pr_debug
c_func
(paren
l_string|&quot;smb_get_length: Got SESSION KEEP ALIVE&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|re_recv
suffix:semicolon
r_default
suffix:colon
id|pr_debug
c_func
(paren
l_string|&quot;smb_get_length: Invalid NBT packet&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|header
op_ne
l_int|NULL
)paren
(brace
id|memcpy
c_func
(paren
id|header
comma
id|peek_buf
comma
l_int|4
)paren
suffix:semicolon
)brace
multiline_comment|/* The length in the RFC NB header is the raw data length */
r_return
id|smb_len
c_func
(paren
id|peek_buf
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * smb_receive&n; * fs points to the correct segment&n; */
r_static
r_int
DECL|function|smb_receive
id|smb_receive
c_func
(paren
r_struct
id|smb_sb_info
op_star
id|server
)paren
(brace
r_struct
id|socket
op_star
id|socket
op_assign
id|server_sock
c_func
(paren
id|server
)paren
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|result
suffix:semicolon
r_int
r_char
id|peek_buf
(braket
l_int|4
)braket
suffix:semicolon
id|len
op_assign
id|smb_get_length
c_func
(paren
id|socket
comma
id|peek_buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
(brace
r_return
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_plus
l_int|4
OG
id|server-&gt;packet_size
)paren
(brace
multiline_comment|/* Some servers do not care about our max_xmit. They&n;&t;&t;   send larger packets */
id|pr_debug
c_func
(paren
l_string|&quot;smb_receive: Increase packet size from %d to %d&bslash;n&quot;
comma
id|server-&gt;packet_size
comma
id|len
op_plus
l_int|4
)paren
suffix:semicolon
id|smb_vfree
c_func
(paren
id|server-&gt;packet
)paren
suffix:semicolon
id|server-&gt;packet
op_assign
l_int|0
suffix:semicolon
id|server-&gt;packet_size
op_assign
l_int|0
suffix:semicolon
id|server-&gt;packet
op_assign
id|smb_vmalloc
c_func
(paren
id|len
op_plus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|server-&gt;packet
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|server-&gt;packet_size
op_assign
id|len
op_plus
l_int|4
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|server-&gt;packet
comma
id|peek_buf
comma
l_int|4
)paren
suffix:semicolon
id|result
op_assign
id|smb_receive_raw
c_func
(paren
id|socket
comma
id|server-&gt;packet
op_plus
l_int|4
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_receive: receive error: %d&bslash;n&quot;
comma
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
id|server-&gt;rcls
op_assign
op_star
(paren
id|server-&gt;packet
op_plus
l_int|9
)paren
suffix:semicolon
id|server-&gt;err
op_assign
id|WVAL
c_func
(paren
id|server-&gt;packet
comma
l_int|11
)paren
suffix:semicolon
macro_line|#ifdef SMBFS_DEBUG_VERBOSE
r_if
c_cond
(paren
id|server-&gt;rcls
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;smb_receive: rcls=%d, err=%d&bslash;n&quot;
comma
id|server-&gt;rcls
comma
id|server-&gt;err
)paren
suffix:semicolon
macro_line|#endif
r_return
id|result
suffix:semicolon
)brace
r_static
r_int
DECL|function|smb_receive_trans2
id|smb_receive_trans2
c_func
(paren
r_struct
id|smb_sb_info
op_star
id|server
comma
r_int
op_star
id|ldata
comma
r_int
r_char
op_star
op_star
id|data
comma
r_int
op_star
id|lparam
comma
r_int
r_char
op_star
op_star
id|param
)paren
(brace
r_int
id|total_data
op_assign
l_int|0
suffix:semicolon
r_int
id|total_param
op_assign
l_int|0
suffix:semicolon
r_int
id|result
suffix:semicolon
r_int
r_char
op_star
id|rcv_buf
suffix:semicolon
r_int
id|buf_len
suffix:semicolon
r_int
id|data_len
op_assign
l_int|0
suffix:semicolon
r_int
id|param_len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|smb_receive
c_func
(paren
id|server
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|result
suffix:semicolon
)brace
r_if
c_cond
(paren
id|server-&gt;rcls
op_ne
l_int|0
)paren
(brace
op_star
id|param
op_assign
op_star
id|data
op_assign
id|server-&gt;packet
suffix:semicolon
op_star
id|ldata
op_assign
op_star
id|lparam
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|total_data
op_assign
id|WVAL
c_func
(paren
id|server-&gt;packet
comma
id|smb_tdrcnt
)paren
suffix:semicolon
id|total_param
op_assign
id|WVAL
c_func
(paren
id|server-&gt;packet
comma
id|smb_tprcnt
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;smb_receive_trans2: td=%d,tp=%d&bslash;n&quot;
comma
id|total_data
comma
id|total_param
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|total_data
OG
id|TRANS2_MAX_TRANSFER
)paren
op_logical_or
(paren
id|total_param
OG
id|TRANS2_MAX_TRANSFER
)paren
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_receive_trans2: data/param too long&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|buf_len
op_assign
id|total_data
op_plus
id|total_param
suffix:semicolon
r_if
c_cond
(paren
id|server-&gt;packet_size
OG
id|buf_len
)paren
(brace
id|buf_len
op_assign
id|server-&gt;packet_size
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rcv_buf
op_assign
id|smb_vmalloc
c_func
(paren
id|buf_len
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_receive_trans2: could not alloc data area&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
op_star
id|param
op_assign
id|rcv_buf
suffix:semicolon
op_star
id|data
op_assign
id|rcv_buf
op_plus
id|total_param
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_int
r_char
op_star
id|inbuf
op_assign
id|server-&gt;packet
suffix:semicolon
r_if
c_cond
(paren
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_prdisp
)paren
op_plus
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_prcnt
)paren
OG
id|total_param
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_receive_trans2: invalid parameters&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_star
id|param
op_plus
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_prdisp
)paren
comma
id|smb_base
c_func
(paren
id|inbuf
)paren
op_plus
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_proff
)paren
comma
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_prcnt
)paren
)paren
suffix:semicolon
id|param_len
op_add_assign
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_prcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_drdisp
)paren
op_plus
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_drcnt
)paren
OG
id|total_data
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_receive_trans2: invalid data block&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|pr_debug
c_func
(paren
l_string|&quot;disp: %d, off: %d, cnt: %d&bslash;n&quot;
comma
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_drdisp
)paren
comma
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_droff
)paren
comma
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_drcnt
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_star
id|data
op_plus
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_drdisp
)paren
comma
id|smb_base
c_func
(paren
id|inbuf
)paren
op_plus
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_droff
)paren
comma
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_drcnt
)paren
)paren
suffix:semicolon
id|data_len
op_add_assign
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_drcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_tdrcnt
)paren
OG
id|total_data
)paren
op_logical_or
(paren
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_tprcnt
)paren
OG
id|total_param
)paren
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;smb_receive_trans2: data/params grew!&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
multiline_comment|/* the total lengths might shrink! */
id|total_data
op_assign
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_tdrcnt
)paren
suffix:semicolon
id|total_param
op_assign
id|WVAL
c_func
(paren
id|inbuf
comma
id|smb_tprcnt
)paren
suffix:semicolon
macro_line|#ifdef SMBFS_PARANOIA
r_if
c_cond
(paren
(paren
id|data_len
op_ge
id|total_data
op_logical_or
id|param_len
op_ge
id|total_param
)paren
op_logical_and
op_logical_neg
(paren
id|data_len
op_ge
id|total_data
op_logical_and
id|param_len
op_ge
id|total_param
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;smb_receive_trans2: dlen=%d, tdata=%d, plen=%d, tlen=%d&bslash;n&quot;
comma
id|data_len
comma
id|total_data
comma
id|param_len
comma
id|total_param
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* shouldn&squot;t this be an OR test? don&squot;t want to overrun */
r_if
c_cond
(paren
(paren
id|data_len
op_ge
id|total_data
)paren
op_logical_and
(paren
id|param_len
op_ge
id|total_param
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|smb_receive
c_func
(paren
id|server
)paren
)paren
OL
l_int|0
)paren
(brace
r_goto
id|fail
suffix:semicolon
)brace
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|server-&gt;rcls
op_ne
l_int|0
)paren
r_goto
id|fail
suffix:semicolon
)brace
op_star
id|ldata
op_assign
id|data_len
suffix:semicolon
op_star
id|lparam
op_assign
id|param_len
suffix:semicolon
id|smb_vfree
c_func
(paren
id|server-&gt;packet
)paren
suffix:semicolon
id|server-&gt;packet
op_assign
id|rcv_buf
suffix:semicolon
id|server-&gt;packet_size
op_assign
id|buf_len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|smb_vfree
c_func
(paren
id|rcv_buf
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*&n; * Called with the server locked&n; */
r_int
DECL|function|smb_request
id|smb_request
c_func
(paren
r_struct
id|smb_sb_info
op_star
id|server
)paren
(brace
r_int
r_int
id|old_mask
suffix:semicolon
r_int
r_int
id|fs
suffix:semicolon
r_int
id|len
comma
id|result
suffix:semicolon
r_int
r_char
op_star
id|buffer
suffix:semicolon
id|result
op_assign
op_minus
id|EBADF
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|server
)paren
multiline_comment|/* this can&squot;t happen */
r_goto
id|bad_no_server
suffix:semicolon
id|buffer
op_assign
id|server-&gt;packet
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_goto
id|bad_no_packet
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|server-&gt;state
op_ne
id|CONN_VALID
)paren
r_goto
id|bad_no_conn
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|smb_dont_catch_keepalive
c_func
(paren
id|server
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|bad_conn
suffix:semicolon
id|len
op_assign
id|smb_len
c_func
(paren
id|buffer
)paren
op_plus
l_int|4
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;smb_request: len = %d cmd = 0x%X&bslash;n&quot;
comma
id|len
comma
id|buffer
(braket
l_int|8
)braket
)paren
suffix:semicolon
id|old_mask
op_assign
id|current-&gt;blocked
suffix:semicolon
id|current-&gt;blocked
op_or_assign
op_complement
(paren
id|_S
c_func
(paren
id|SIGKILL
)paren
op_or
id|_S
c_func
(paren
id|SIGSTOP
)paren
)paren
suffix:semicolon
id|fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|result
op_assign
id|smb_send_raw
c_func
(paren
id|server_sock
c_func
(paren
id|server
)paren
comma
(paren
r_void
op_star
)paren
id|buffer
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OG
l_int|0
)paren
(brace
id|result
op_assign
id|smb_receive
c_func
(paren
id|server
)paren
suffix:semicolon
)brace
multiline_comment|/* read/write errors are handled by errno */
id|current-&gt;signal
op_and_assign
op_complement
id|_S
c_func
(paren
id|SIGPIPE
)paren
suffix:semicolon
id|current-&gt;blocked
op_assign
id|old_mask
suffix:semicolon
id|set_fs
c_func
(paren
id|fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ge
l_int|0
)paren
(brace
r_int
id|result2
op_assign
id|smb_catch_keepalive
c_func
(paren
id|server
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result2
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;smb_request: catch keepalive failed&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
id|result2
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_goto
id|bad_conn
suffix:semicolon
id|out
suffix:colon
id|pr_debug
c_func
(paren
l_string|&quot;smb_request: result = %d&bslash;n&quot;
comma
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
id|bad_conn
suffix:colon
id|printk
c_func
(paren
l_string|&quot;smb_request: result %d, setting invalid&bslash;n&quot;
comma
id|result
)paren
suffix:semicolon
id|server-&gt;state
op_assign
id|CONN_INVALID
suffix:semicolon
id|smb_invalidate_inodes
c_func
(paren
id|server
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|bad_no_server
suffix:colon
id|printk
c_func
(paren
l_string|&quot;smb_request: no server!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|bad_no_packet
suffix:colon
id|printk
c_func
(paren
l_string|&quot;smb_request: no packet!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|bad_no_conn
suffix:colon
id|printk
c_func
(paren
l_string|&quot;smb_request: connection %d not valid!&bslash;n&quot;
comma
id|server-&gt;state
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|macro|ROUND_UP
mdefine_line|#define ROUND_UP(x) (((x)+3) &amp; ~3)
r_static
r_int
DECL|function|smb_send_trans2
id|smb_send_trans2
c_func
(paren
r_struct
id|smb_sb_info
op_star
id|server
comma
id|__u16
id|trans2_command
comma
r_int
id|ldata
comma
r_int
r_char
op_star
id|data
comma
r_int
id|lparam
comma
r_int
r_char
op_star
id|param
)paren
(brace
r_struct
id|socket
op_star
id|sock
op_assign
id|server_sock
c_func
(paren
id|server
)paren
suffix:semicolon
r_struct
id|scm_cookie
id|scm
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* I know the following is very ugly, but I want to build the&n;&t;   smb packet as efficiently as possible. */
r_const
r_int
id|smb_parameters
op_assign
l_int|15
suffix:semicolon
r_const
r_int
id|oparam
op_assign
id|ROUND_UP
c_func
(paren
id|SMB_HEADER_LEN
op_plus
l_int|2
op_star
id|smb_parameters
op_plus
l_int|2
op_plus
l_int|3
)paren
suffix:semicolon
r_const
r_int
id|odata
op_assign
id|ROUND_UP
c_func
(paren
id|oparam
op_plus
id|lparam
)paren
suffix:semicolon
r_const
r_int
id|bcc
op_assign
id|odata
op_plus
id|ldata
op_minus
(paren
id|SMB_HEADER_LEN
op_plus
l_int|2
op_star
id|smb_parameters
op_plus
l_int|2
)paren
suffix:semicolon
r_const
r_int
id|packet_length
op_assign
id|SMB_HEADER_LEN
op_plus
l_int|2
op_star
id|smb_parameters
op_plus
id|bcc
op_plus
l_int|2
suffix:semicolon
r_int
r_char
id|padding
(braket
l_int|4
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_struct
id|iovec
id|iov
(braket
l_int|4
)braket
suffix:semicolon
r_struct
id|msghdr
id|msg
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bcc
op_plus
id|oparam
)paren
OG
id|server-&gt;opt.max_xmit
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|p
op_assign
id|smb_setup_header
c_func
(paren
id|server
comma
id|SMBtrans2
comma
id|smb_parameters
comma
id|bcc
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_tpscnt
comma
id|lparam
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_tdscnt
comma
id|ldata
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_mprcnt
comma
id|TRANS2_MAX_TRANSFER
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_mdrcnt
comma
id|TRANS2_MAX_TRANSFER
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_msrcnt
comma
l_int|0
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_flags
comma
l_int|0
)paren
suffix:semicolon
id|DSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_timeout
comma
l_int|0
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_pscnt
comma
id|lparam
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_psoff
comma
id|oparam
op_minus
l_int|4
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_dscnt
comma
id|ldata
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_dsoff
comma
id|odata
op_minus
l_int|4
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_suwcnt
comma
l_int|1
)paren
suffix:semicolon
id|WSET
c_func
(paren
id|server-&gt;packet
comma
id|smb_setup0
comma
id|trans2_command
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* null smb_name for trans2 */
op_star
id|p
op_increment
op_assign
l_char|&squot;D&squot;
suffix:semicolon
multiline_comment|/* this was added because OS/2 does it */
op_star
id|p
op_increment
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|msg.msg_name
op_assign
l_int|NULL
suffix:semicolon
id|msg.msg_namelen
op_assign
l_int|0
suffix:semicolon
id|msg.msg_control
op_assign
l_int|NULL
suffix:semicolon
id|msg.msg_controllen
op_assign
l_int|0
suffix:semicolon
id|msg.msg_iov
op_assign
id|iov
suffix:semicolon
id|msg.msg_iovlen
op_assign
l_int|4
suffix:semicolon
id|msg.msg_flags
op_assign
l_int|0
suffix:semicolon
id|iov
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
(paren
r_void
op_star
)paren
id|server-&gt;packet
suffix:semicolon
id|iov
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
id|oparam
suffix:semicolon
id|iov
(braket
l_int|1
)braket
dot
id|iov_base
op_assign
(paren
id|param
op_eq
l_int|NULL
)paren
ques
c_cond
id|padding
suffix:colon
id|param
suffix:semicolon
id|iov
(braket
l_int|1
)braket
dot
id|iov_len
op_assign
id|lparam
suffix:semicolon
id|iov
(braket
l_int|2
)braket
dot
id|iov_base
op_assign
id|padding
suffix:semicolon
id|iov
(braket
l_int|2
)braket
dot
id|iov_len
op_assign
id|odata
op_minus
id|oparam
op_minus
id|lparam
suffix:semicolon
id|iov
(braket
l_int|3
)braket
dot
id|iov_base
op_assign
(paren
id|data
op_eq
l_int|NULL
)paren
ques
c_cond
id|padding
suffix:colon
id|data
suffix:semicolon
id|iov
(braket
l_int|3
)braket
dot
id|iov_len
op_assign
id|ldata
suffix:semicolon
id|err
op_assign
id|scm_send
c_func
(paren
id|sock
comma
op_amp
id|msg
comma
op_amp
id|scm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|0
)paren
(brace
id|err
op_assign
id|sock-&gt;ops
op_member_access_from_pointer
id|sendmsg
c_func
(paren
id|sock
comma
op_amp
id|msg
comma
id|packet_length
comma
op_amp
id|scm
)paren
suffix:semicolon
id|scm_destroy
c_func
(paren
op_amp
id|scm
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * This is not really a trans2 request, we assume that you only have&n; * one packet to send.&n; */
r_int
DECL|function|smb_trans2_request
id|smb_trans2_request
c_func
(paren
r_struct
id|smb_sb_info
op_star
id|server
comma
id|__u16
id|trans2_command
comma
r_int
id|ldata
comma
r_int
r_char
op_star
id|data
comma
r_int
id|lparam
comma
r_int
r_char
op_star
id|param
comma
r_int
op_star
id|lrdata
comma
r_int
r_char
op_star
op_star
id|rdata
comma
r_int
op_star
id|lrparam
comma
r_int
r_char
op_star
op_star
id|rparam
)paren
(brace
r_int
r_int
id|old_mask
suffix:semicolon
r_int
r_int
id|fs
suffix:semicolon
r_int
id|result
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;smb_trans2_request: com=%d, ld=%d, lp=%d&bslash;n&quot;
comma
id|trans2_command
comma
id|ldata
comma
id|lparam
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * These are initialized in smb_request_ok, but not here??&n;&t; */
id|server-&gt;rcls
op_assign
l_int|0
suffix:semicolon
id|server-&gt;err
op_assign
l_int|0
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|server-&gt;state
op_ne
id|CONN_VALID
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|smb_dont_catch_keepalive
c_func
(paren
id|server
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|bad_conn
suffix:semicolon
id|old_mask
op_assign
id|current-&gt;blocked
suffix:semicolon
id|current-&gt;blocked
op_or_assign
op_complement
(paren
id|_S
c_func
(paren
id|SIGKILL
)paren
op_or
id|_S
c_func
(paren
id|SIGSTOP
)paren
)paren
suffix:semicolon
id|fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|result
op_assign
id|smb_send_trans2
c_func
(paren
id|server
comma
id|trans2_command
comma
id|ldata
comma
id|data
comma
id|lparam
comma
id|param
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ge
l_int|0
)paren
(brace
id|result
op_assign
id|smb_receive_trans2
c_func
(paren
id|server
comma
id|lrdata
comma
id|rdata
comma
id|lrparam
comma
id|rparam
)paren
suffix:semicolon
)brace
multiline_comment|/* read/write errors are handled by errno */
id|current-&gt;signal
op_and_assign
op_complement
id|_S
c_func
(paren
id|SIGPIPE
)paren
suffix:semicolon
id|current-&gt;blocked
op_assign
id|old_mask
suffix:semicolon
id|set_fs
c_func
(paren
id|fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ge
l_int|0
)paren
(brace
r_int
id|result2
op_assign
id|smb_catch_keepalive
c_func
(paren
id|server
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result2
OL
l_int|0
)paren
(brace
id|result
op_assign
id|result2
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_goto
id|bad_conn
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;smb_trans2_request: result = %d&bslash;n&quot;
comma
id|result
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|result
suffix:semicolon
id|bad_conn
suffix:colon
id|printk
c_func
(paren
l_string|&quot;smb_trans2_request: connection bad, setting invalid&bslash;n&quot;
)paren
suffix:semicolon
id|server-&gt;state
op_assign
id|CONN_INVALID
suffix:semicolon
id|smb_invalidate_inodes
c_func
(paren
id|server
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
eof
