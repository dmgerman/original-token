multiline_comment|/*&n; * symlink.c&n; *&n; * Copyright (c) 1999 Al Smith&n; *&n; * Portions derived from work (c) 1995,1996 Christian Vogelgsang.&n; */
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/efs_fs.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
DECL|function|efs_symlink_readpage
r_static
r_int
id|efs_symlink_readpage
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|page
op_star
id|page
)paren
(brace
r_char
op_star
id|link
op_assign
id|kmap
c_func
(paren
id|page
)paren
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|page-&gt;mapping-&gt;host
suffix:semicolon
id|efs_block_t
id|size
op_assign
id|inode-&gt;i_size
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
op_minus
id|ENAMETOOLONG
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|2
op_star
id|EFS_BLOCKSIZE
)paren
r_goto
id|fail
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* read first 512 bytes of link target */
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
id|bh
op_assign
id|bread
c_func
(paren
id|inode-&gt;i_dev
comma
id|efs_bmap
c_func
(paren
id|inode
comma
l_int|0
)paren
comma
id|EFS_BLOCKSIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
r_goto
id|fail
suffix:semicolon
id|memcpy
c_func
(paren
id|link
comma
id|bh-&gt;b_data
comma
(paren
id|size
OG
id|EFS_BLOCKSIZE
)paren
ques
c_cond
id|EFS_BLOCKSIZE
suffix:colon
id|size
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|EFS_BLOCKSIZE
)paren
(brace
id|bh
op_assign
id|bread
c_func
(paren
id|inode-&gt;i_dev
comma
id|efs_bmap
c_func
(paren
id|inode
comma
l_int|1
)paren
comma
id|EFS_BLOCKSIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
r_goto
id|fail
suffix:semicolon
id|memcpy
c_func
(paren
id|link
op_plus
id|EFS_BLOCKSIZE
comma
id|bh-&gt;b_data
comma
id|size
op_minus
id|EFS_BLOCKSIZE
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
id|link
(braket
id|size
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
id|SetPageUptodate
c_func
(paren
id|page
)paren
suffix:semicolon
id|kunmap
c_func
(paren
id|page
)paren
suffix:semicolon
id|UnlockPage
c_func
(paren
id|page
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
id|SetPageError
c_func
(paren
id|page
)paren
suffix:semicolon
id|kunmap
c_func
(paren
id|page
)paren
suffix:semicolon
id|UnlockPage
c_func
(paren
id|page
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|efs_symlink_aops
r_struct
id|address_space_operations
id|efs_symlink_aops
op_assign
(brace
id|readpage
suffix:colon
id|efs_symlink_readpage
)brace
suffix:semicolon
eof
