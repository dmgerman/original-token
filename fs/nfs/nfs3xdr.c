multiline_comment|/*&n; * linux/fs/nfs/nfs3xdr.c&n; *&n; * XDR functions to encode/decode NFSv3 RPC arguments and results.&n; *&n; * Copyright (C) 1996, 1997 Olaf Kirch&n; */
macro_line|#include &lt;linux/param.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/utsname.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/kdev_t.h&gt;
macro_line|#include &lt;linux/sunrpc/clnt.h&gt;
macro_line|#include &lt;linux/nfs.h&gt;
macro_line|#include &lt;linux/nfs3.h&gt;
macro_line|#include &lt;linux/nfs_fs.h&gt;
multiline_comment|/* Uncomment this to support servers requiring longword lengths */
DECL|macro|NFS_PAD_WRITES
mdefine_line|#define NFS_PAD_WRITES&t;&t;1
DECL|macro|NFSDBG_FACILITY
mdefine_line|#define NFSDBG_FACILITY&t;&t;NFSDBG_XDR
multiline_comment|/* Mapping from NFS error code to &quot;errno&quot; error code. */
DECL|macro|errno_NFSERR_IO
mdefine_line|#define errno_NFSERR_IO&t;&t;EIO
r_extern
r_int
id|nfs_stat_to_errno
c_func
(paren
r_int
)paren
suffix:semicolon
multiline_comment|/*&n; * Declare the space requirements for NFS arguments and replies as&n; * number of 32bit-words&n; */
DECL|macro|NFS3_fhandle_sz
mdefine_line|#define NFS3_fhandle_sz&t;&t;1+16
DECL|macro|NFS3_fh_sz
mdefine_line|#define NFS3_fh_sz&t;&t;NFS3_fhandle_sz&t;/* shorthand */
DECL|macro|NFS3_sattr_sz
mdefine_line|#define NFS3_sattr_sz&t;&t;15
DECL|macro|NFS3_filename_sz
mdefine_line|#define NFS3_filename_sz&t;1+(NFS3_MAXNAMLEN&gt;&gt;2)
DECL|macro|NFS3_path_sz
mdefine_line|#define NFS3_path_sz&t;&t;1+(NFS3_MAXPATHLEN&gt;&gt;2)
DECL|macro|NFS3_fattr_sz
mdefine_line|#define NFS3_fattr_sz&t;&t;21
DECL|macro|NFS3_wcc_attr_sz
mdefine_line|#define NFS3_wcc_attr_sz&t;&t;6
DECL|macro|NFS3_pre_op_attr_sz
mdefine_line|#define NFS3_pre_op_attr_sz&t;1+NFS3_wcc_attr_sz
DECL|macro|NFS3_post_op_attr_sz
mdefine_line|#define NFS3_post_op_attr_sz&t;1+NFS3_fattr_sz
DECL|macro|NFS3_wcc_data_sz
mdefine_line|#define NFS3_wcc_data_sz&t;&t;NFS3_pre_op_attr_sz+NFS3_post_op_attr_sz
DECL|macro|NFS3_fsstat_sz
mdefine_line|#define NFS3_fsstat_sz&t;&t;
DECL|macro|NFS3_fsinfo_sz
mdefine_line|#define NFS3_fsinfo_sz&t;&t;
DECL|macro|NFS3_pathconf_sz
mdefine_line|#define NFS3_pathconf_sz&t;&t;
DECL|macro|NFS3_entry_sz
mdefine_line|#define NFS3_entry_sz&t;&t;NFS3_filename_sz+3
DECL|macro|NFS3_enc_void_sz
mdefine_line|#define NFS3_enc_void_sz&t;0
DECL|macro|NFS3_sattrargs_sz
mdefine_line|#define NFS3_sattrargs_sz&t;NFS3_fh_sz+NFS3_sattr_sz+3
DECL|macro|NFS3_diropargs_sz
mdefine_line|#define NFS3_diropargs_sz&t;NFS3_fh_sz+NFS3_filename_sz
DECL|macro|NFS3_accessargs_sz
mdefine_line|#define NFS3_accessargs_sz&t;NFS3_fh_sz+1
DECL|macro|NFS3_readlinkargs_sz
mdefine_line|#define NFS3_readlinkargs_sz&t;NFS3_fh_sz
DECL|macro|NFS3_readargs_sz
mdefine_line|#define NFS3_readargs_sz&t;NFS3_fh_sz+3
DECL|macro|NFS3_writeargs_sz
mdefine_line|#define NFS3_writeargs_sz&t;NFS3_fh_sz+5
DECL|macro|NFS3_createargs_sz
mdefine_line|#define NFS3_createargs_sz&t;NFS3_diropargs_sz+NFS3_sattr_sz
DECL|macro|NFS3_mkdirargs_sz
mdefine_line|#define NFS3_mkdirargs_sz&t;NFS3_diropargs_sz+NFS3_sattr_sz
DECL|macro|NFS3_symlinkargs_sz
mdefine_line|#define NFS3_symlinkargs_sz&t;NFS3_diropargs_sz+NFS3_path_sz+NFS3_sattr_sz
DECL|macro|NFS3_mknodargs_sz
mdefine_line|#define NFS3_mknodargs_sz&t;NFS3_diropargs_sz+2+NFS3_sattr_sz
DECL|macro|NFS3_renameargs_sz
mdefine_line|#define NFS3_renameargs_sz&t;NFS3_diropargs_sz+NFS3_diropargs_sz
DECL|macro|NFS3_linkargs_sz
mdefine_line|#define NFS3_linkargs_sz&t;&t;NFS3_fh_sz+NFS3_diropargs_sz
DECL|macro|NFS3_readdirargs_sz
mdefine_line|#define NFS3_readdirargs_sz&t;NFS3_fh_sz+2
DECL|macro|NFS3_commitargs_sz
mdefine_line|#define NFS3_commitargs_sz&t;NFS3_fh_sz+3
DECL|macro|NFS3_dec_void_sz
mdefine_line|#define NFS3_dec_void_sz&t;0
DECL|macro|NFS3_attrstat_sz
mdefine_line|#define NFS3_attrstat_sz&t;1+NFS3_fattr_sz
DECL|macro|NFS3_wccstat_sz
mdefine_line|#define NFS3_wccstat_sz&t;&t;1+NFS3_wcc_data_sz
DECL|macro|NFS3_lookupres_sz
mdefine_line|#define NFS3_lookupres_sz&t;1+NFS3_fh_sz+(2 * NFS3_post_op_attr_sz)
DECL|macro|NFS3_accessres_sz
mdefine_line|#define NFS3_accessres_sz&t;1+NFS3_post_op_attr_sz+1
DECL|macro|NFS3_readlinkres_sz
mdefine_line|#define NFS3_readlinkres_sz&t;1+NFS3_post_op_attr_sz
DECL|macro|NFS3_readres_sz
mdefine_line|#define NFS3_readres_sz&t;&t;1+NFS3_post_op_attr_sz+3
DECL|macro|NFS3_writeres_sz
mdefine_line|#define NFS3_writeres_sz&t;1+NFS3_wcc_data_sz+4
DECL|macro|NFS3_createres_sz
mdefine_line|#define NFS3_createres_sz&t;1+NFS3_fh_sz+NFS3_post_op_attr_sz+NFS3_wcc_data_sz
DECL|macro|NFS3_renameres_sz
mdefine_line|#define NFS3_renameres_sz&t;1+(2 * NFS3_wcc_data_sz)
DECL|macro|NFS3_linkres_sz
mdefine_line|#define NFS3_linkres_sz&t;&t;1+NFS3_post_op_attr_sz+NFS3_wcc_data_sz
DECL|macro|NFS3_readdirres_sz
mdefine_line|#define NFS3_readdirres_sz&t;1+NFS3_post_op_attr_sz+2
DECL|macro|NFS3_fsstatres_sz
mdefine_line|#define NFS3_fsstatres_sz&t;1+NFS3_post_op_attr_sz+13
DECL|macro|NFS3_fsinfores_sz
mdefine_line|#define NFS3_fsinfores_sz&t;1+NFS3_post_op_attr_sz+12
DECL|macro|NFS3_pathconfres_sz
mdefine_line|#define NFS3_pathconfres_sz&t;1+NFS3_post_op_attr_sz+6
DECL|macro|NFS3_commitres_sz
mdefine_line|#define NFS3_commitres_sz&t;1+NFS3_wcc_data_sz+2
multiline_comment|/*&n; * Map file type to S_IFMT bits&n; */
r_static
r_struct
(brace
DECL|member|mode
r_int
r_int
id|mode
suffix:semicolon
DECL|member|nfs2type
r_int
r_int
id|nfs2type
suffix:semicolon
DECL|variable|nfs_type2fmt
)brace
id|nfs_type2fmt
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
id|NFNON
)brace
comma
(brace
id|S_IFREG
comma
id|NFREG
)brace
comma
(brace
id|S_IFDIR
comma
id|NFDIR
)brace
comma
(brace
id|S_IFBLK
comma
id|NFBLK
)brace
comma
(brace
id|S_IFCHR
comma
id|NFCHR
)brace
comma
(brace
id|S_IFLNK
comma
id|NFLNK
)brace
comma
(brace
id|S_IFSOCK
comma
id|NFSOCK
)brace
comma
(brace
id|S_IFIFO
comma
id|NFFIFO
)brace
comma
(brace
l_int|0
comma
id|NFBAD
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * Common NFS XDR functions as inlines&n; */
r_static
r_inline
id|u32
op_star
DECL|function|xdr_encode_fhandle
id|xdr_encode_fhandle
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|nfs_fh
op_star
id|fh
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|fh-&gt;size
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|fh-&gt;data
comma
id|fh-&gt;size
)paren
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
id|fh-&gt;size
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|xdr_decode_fhandle
id|xdr_decode_fhandle
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|nfs_fh
op_star
id|fh
)paren
(brace
multiline_comment|/*&n;&t; * Zero all nonused bytes&n;&t; */
id|memset
c_func
(paren
(paren
id|u8
op_star
)paren
id|fh
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|fh
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fh-&gt;size
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
op_le
id|NFS3_FHSIZE
)paren
(brace
id|memcpy
c_func
(paren
id|fh-&gt;data
comma
id|p
comma
id|fh-&gt;size
)paren
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
id|fh-&gt;size
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode/decode time.&n; * Since the VFS doesn&squot;t care for fractional times, we ignore the&n; * nanosecond field.&n; */
r_static
r_inline
id|u32
op_star
DECL|function|xdr_encode_time
id|xdr_encode_time
c_func
(paren
id|u32
op_star
id|p
comma
id|time_t
id|time
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|time
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|xdr_decode_time3
id|xdr_decode_time3
c_func
(paren
id|u32
op_star
id|p
comma
id|u64
op_star
id|timep
)paren
(brace
id|u64
id|tmp
op_assign
(paren
id|u64
)paren
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
op_lshift
l_int|32
suffix:semicolon
op_star
id|timep
op_assign
id|tmp
op_plus
(paren
id|u64
)paren
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|xdr_encode_time3
id|xdr_encode_time3
c_func
(paren
id|u32
op_star
id|p
comma
id|u64
id|time
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|time
op_rshift
l_int|32
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|time
op_amp
l_int|0xFFFFFFFF
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|xdr_decode_string2
id|xdr_decode_string2
c_func
(paren
id|u32
op_star
id|p
comma
r_char
op_star
op_star
id|string
comma
r_int
r_int
op_star
id|len
comma
r_int
r_int
id|maxlen
)paren
(brace
op_star
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|len
OG
id|maxlen
)paren
r_return
l_int|NULL
suffix:semicolon
op_star
id|string
op_assign
(paren
r_char
op_star
)paren
id|p
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
op_star
id|len
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|xdr_decode_fattr
id|xdr_decode_fattr
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_int
r_int
id|type
suffix:semicolon
r_int
id|fmode
suffix:semicolon
id|type
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ge
id|NF3BAD
)paren
id|type
op_assign
id|NF3BAD
suffix:semicolon
id|fmode
op_assign
id|nfs_type2fmt
(braket
id|type
)braket
dot
id|mode
suffix:semicolon
id|fattr-&gt;type
op_assign
id|nfs_type2fmt
(braket
id|type
)braket
dot
id|nfs2type
suffix:semicolon
id|fattr-&gt;mode
op_assign
(paren
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
op_amp
op_complement
id|S_IFMT
)paren
op_or
id|fmode
suffix:semicolon
id|fattr-&gt;nlink
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|fattr-&gt;uid
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|fattr-&gt;gid
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|fattr-&gt;size
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|fattr-&gt;du.nfs3.used
)paren
suffix:semicolon
multiline_comment|/* Turn remote device info into Linux-specific dev_t */
id|fattr-&gt;rdev
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
op_lshift
id|MINORBITS
suffix:semicolon
id|fattr-&gt;rdev
op_or_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
op_amp
id|MINORMASK
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|fattr-&gt;fsid
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|fattr-&gt;fileid
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_time3
c_func
(paren
id|p
comma
op_amp
id|fattr-&gt;atime
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_time3
c_func
(paren
id|p
comma
op_amp
id|fattr-&gt;mtime
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_time3
c_func
(paren
id|p
comma
op_amp
id|fattr-&gt;ctime
)paren
suffix:semicolon
multiline_comment|/* Update the mode bits */
id|fattr-&gt;valid
op_or_assign
(paren
id|NFS_ATTR_FATTR
op_or
id|NFS_ATTR_FATTR_V3
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|xdr_encode_sattr
id|xdr_encode_sattr
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|iattr
op_star
id|attr
)paren
(brace
r_if
c_cond
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_MODE
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|attr-&gt;ia_mode
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_UID
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|attr-&gt;ia_uid
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_GID
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|attr-&gt;ia_gid
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_SIZE
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|__u64
)paren
id|attr-&gt;ia_size
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_ATIME_SET
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_two
suffix:semicolon
id|p
op_assign
id|xdr_encode_time
c_func
(paren
id|p
comma
id|attr-&gt;ia_atime
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_ATIME
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
)brace
r_else
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_MTIME_SET
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_two
suffix:semicolon
id|p
op_assign
id|xdr_encode_time
c_func
(paren
id|p
comma
id|attr-&gt;ia_mtime
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|attr-&gt;ia_valid
op_amp
id|ATTR_MTIME
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
)brace
r_else
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
)brace
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|xdr_decode_wcc_attr
id|xdr_decode_wcc_attr
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|fattr-&gt;pre_size
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_time3
c_func
(paren
id|p
comma
op_amp
id|fattr-&gt;pre_mtime
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_time3
c_func
(paren
id|p
comma
op_amp
id|fattr-&gt;pre_ctime
)paren
suffix:semicolon
id|fattr-&gt;valid
op_or_assign
id|NFS_ATTR_WCC
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|xdr_decode_post_op_attr
id|xdr_decode_post_op_attr
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
id|p
op_assign
id|xdr_decode_fattr
c_func
(paren
id|p
comma
id|fattr
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|xdr_decode_pre_op_attr
id|xdr_decode_pre_op_attr
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
r_return
id|xdr_decode_wcc_attr
c_func
(paren
id|p
comma
id|fattr
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|xdr_decode_wcc_data
id|xdr_decode_wcc_data
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
id|p
op_assign
id|xdr_decode_pre_op_attr
c_func
(paren
id|p
comma
id|fattr
)paren
suffix:semicolon
r_return
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
id|fattr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * NFS encode functions&n; */
multiline_comment|/*&n; * Encode void argument&n; */
r_static
r_int
DECL|function|nfs3_xdr_enc_void
id|nfs3_xdr_enc_void
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_void
op_star
id|dummy
)paren
(brace
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode file handle argument&n; */
r_static
r_int
DECL|function|nfs3_xdr_fhandle
id|nfs3_xdr_fhandle
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_fh
op_star
id|fh
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|fh
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode SETATTR arguments&n; */
r_static
r_int
DECL|function|nfs3_xdr_sattrargs
id|nfs3_xdr_sattrargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_sattrargs
op_star
id|args
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_sattr
c_func
(paren
id|p
comma
id|args-&gt;sattr
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;guard
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;guard
)paren
id|p
op_assign
id|xdr_encode_time3
c_func
(paren
id|p
comma
id|args-&gt;guardtime
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode directory ops argument&n; */
r_static
r_int
DECL|function|nfs3_xdr_diropargs
id|nfs3_xdr_diropargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_diropargs
op_star
id|args
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|args-&gt;name
comma
id|args-&gt;len
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode access() argument&n; */
r_static
r_int
DECL|function|nfs3_xdr_accessargs
id|nfs3_xdr_accessargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_accessargs
op_star
id|args
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;access
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Arguments to a READ call. Since we read data directly into the page&n; * cache, we also set up the reply iovec here so that iov[1] points&n; * exactly to the page we want to fetch.&n; */
r_static
r_int
DECL|function|nfs3_xdr_readargs
id|nfs3_xdr_readargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_readargs
op_star
id|args
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|req-&gt;rq_task-&gt;tk_auth
suffix:semicolon
r_int
id|buflen
comma
id|replen
suffix:semicolon
r_int
r_int
id|nr
suffix:semicolon
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|args-&gt;offset
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;count
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
multiline_comment|/* Get the number of buffers in the receive iovec */
id|nr
op_assign
id|args-&gt;nriov
suffix:semicolon
r_if
c_cond
(paren
id|nr
op_plus
l_int|2
OG
id|MAX_IOVEC
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NFS: Bad number of iov&squot;s in xdr_readargs&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* set up reply iovec */
id|replen
op_assign
(paren
id|RPC_REPHDRSIZE
op_plus
id|auth-&gt;au_rslack
op_plus
id|NFS3_readres_sz
)paren
op_lshift
l_int|2
suffix:semicolon
id|buflen
op_assign
id|req-&gt;rq_rvec
(braket
l_int|0
)braket
dot
id|iov_len
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
id|replen
suffix:semicolon
multiline_comment|/* Copy the iovec */
id|memcpy
c_func
(paren
id|req-&gt;rq_rvec
op_plus
l_int|1
comma
id|args-&gt;iov
comma
id|nr
op_star
r_sizeof
(paren
r_struct
id|iovec
)paren
)paren
suffix:semicolon
id|req-&gt;rq_rvec
(braket
id|nr
op_plus
l_int|1
)braket
dot
id|iov_base
op_assign
(paren
id|u8
op_star
)paren
id|req-&gt;rq_rvec
(braket
l_int|0
)braket
dot
id|iov_base
op_plus
id|replen
suffix:semicolon
id|req-&gt;rq_rvec
(braket
id|nr
op_plus
l_int|1
)braket
dot
id|iov_len
op_assign
id|buflen
op_minus
id|replen
suffix:semicolon
id|req-&gt;rq_rlen
op_assign
id|args-&gt;count
op_plus
id|buflen
suffix:semicolon
id|req-&gt;rq_rnr
op_add_assign
id|nr
op_plus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Write arguments. Splice the buffer to be written into the iovec.&n; */
r_static
r_int
DECL|function|nfs3_xdr_writeargs
id|nfs3_xdr_writeargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_writeargs
op_star
id|args
)paren
(brace
r_int
r_int
id|nr
suffix:semicolon
id|u32
id|count
op_assign
id|args-&gt;count
suffix:semicolon
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|args-&gt;offset
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|count
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;stable
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|count
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
multiline_comment|/* Get the number of buffers in the send iovec */
id|nr
op_assign
id|args-&gt;nriov
suffix:semicolon
r_if
c_cond
(paren
id|nr
op_plus
l_int|2
OG
id|MAX_IOVEC
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NFS: Bad number of iov&squot;s in xdr_writeargs&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Copy the iovec */
id|memcpy
c_func
(paren
id|req-&gt;rq_svec
op_plus
l_int|1
comma
id|args-&gt;iov
comma
id|nr
op_star
r_sizeof
(paren
r_struct
id|iovec
)paren
)paren
suffix:semicolon
macro_line|#ifdef NFS_PAD_WRITES
multiline_comment|/*&n;&t; * Some old servers require that the message length&n;&t; * be a multiple of 4, so we pad it here if needed.&n;&t; */
r_if
c_cond
(paren
id|count
op_amp
l_int|3
)paren
(brace
r_struct
id|iovec
op_star
id|iov
op_assign
id|req-&gt;rq_svec
op_plus
id|nr
op_plus
l_int|1
suffix:semicolon
r_int
id|pad
op_assign
l_int|4
op_minus
(paren
id|count
op_amp
l_int|3
)paren
suffix:semicolon
id|iov-&gt;iov_base
op_assign
(paren
r_void
op_star
)paren
l_string|&quot;&bslash;0&bslash;0&bslash;0&quot;
suffix:semicolon
id|iov-&gt;iov_len
op_assign
id|pad
suffix:semicolon
id|count
op_add_assign
id|pad
suffix:semicolon
id|nr
op_increment
suffix:semicolon
)brace
macro_line|#endif
id|req-&gt;rq_slen
op_add_assign
id|count
suffix:semicolon
id|req-&gt;rq_snr
op_add_assign
id|nr
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode CREATE arguments&n; */
r_static
r_int
DECL|function|nfs3_xdr_createargs
id|nfs3_xdr_createargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_createargs
op_star
id|args
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|args-&gt;name
comma
id|args-&gt;len
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;createmode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;createmode
op_eq
id|NFS3_CREATE_EXCLUSIVE
)paren
(brace
op_star
id|p
op_increment
op_assign
id|args-&gt;verifier
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|args-&gt;verifier
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_else
id|p
op_assign
id|xdr_encode_sattr
c_func
(paren
id|p
comma
id|args-&gt;sattr
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode MKDIR arguments&n; */
r_static
r_int
DECL|function|nfs3_xdr_mkdirargs
id|nfs3_xdr_mkdirargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_mkdirargs
op_star
id|args
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|args-&gt;name
comma
id|args-&gt;len
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_sattr
c_func
(paren
id|p
comma
id|args-&gt;sattr
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode SYMLINK arguments&n; */
r_static
r_int
DECL|function|nfs3_xdr_symlinkargs
id|nfs3_xdr_symlinkargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_symlinkargs
op_star
id|args
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fromfh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|args-&gt;fromname
comma
id|args-&gt;fromlen
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_sattr
c_func
(paren
id|p
comma
id|args-&gt;sattr
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|args-&gt;topath
comma
id|args-&gt;tolen
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode MKNOD arguments&n; */
r_static
r_int
DECL|function|nfs3_xdr_mknodargs
id|nfs3_xdr_mknodargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_mknodargs
op_star
id|args
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|args-&gt;name
comma
id|args-&gt;len
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;type
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_sattr
c_func
(paren
id|p
comma
id|args-&gt;sattr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;type
op_eq
id|NF3CHR
op_logical_or
id|args-&gt;type
op_eq
id|NF3BLK
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;rdev
op_rshift
id|MINORBITS
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;rdev
op_amp
id|MINORMASK
)paren
suffix:semicolon
)brace
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode RENAME arguments&n; */
r_static
r_int
DECL|function|nfs3_xdr_renameargs
id|nfs3_xdr_renameargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_renameargs
op_star
id|args
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fromfh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|args-&gt;fromname
comma
id|args-&gt;fromlen
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;tofh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|args-&gt;toname
comma
id|args-&gt;tolen
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode LINK arguments&n; */
r_static
r_int
DECL|function|nfs3_xdr_linkargs
id|nfs3_xdr_linkargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_linkargs
op_star
id|args
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fromfh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;tofh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|args-&gt;toname
comma
id|args-&gt;tolen
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode arguments to readdir call&n; */
r_static
r_int
DECL|function|nfs3_xdr_readdirargs
id|nfs3_xdr_readdirargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_readdirargs
op_star
id|args
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|req-&gt;rq_task-&gt;tk_auth
suffix:semicolon
r_int
id|buflen
comma
id|replen
suffix:semicolon
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|args-&gt;cookie
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|args-&gt;verf
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|args-&gt;verf
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;plus
)paren
(brace
multiline_comment|/* readdirplus: need dircount + buffer size.&n;&t;&t; * We just make sure we make dircount big enough */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;bufsiz
op_rshift
l_int|3
)paren
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;bufsiz
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
multiline_comment|/* set up reply iovec */
id|replen
op_assign
(paren
id|RPC_REPHDRSIZE
op_plus
id|auth-&gt;au_rslack
op_plus
id|NFS3_readdirres_sz
)paren
op_lshift
l_int|2
suffix:semicolon
id|buflen
op_assign
id|req-&gt;rq_rvec
(braket
l_int|0
)braket
dot
id|iov_len
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
id|replen
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|1
)braket
dot
id|iov_base
op_assign
id|args-&gt;buffer
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|1
)braket
dot
id|iov_len
op_assign
id|args-&gt;bufsiz
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|2
)braket
dot
id|iov_base
op_assign
(paren
id|u8
op_star
)paren
id|req-&gt;rq_rvec
(braket
l_int|0
)braket
dot
id|iov_base
op_plus
id|replen
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|2
)braket
dot
id|iov_len
op_assign
id|buflen
op_minus
id|replen
suffix:semicolon
id|req-&gt;rq_rlen
op_assign
id|buflen
op_plus
id|args-&gt;bufsiz
suffix:semicolon
id|req-&gt;rq_rnr
op_add_assign
l_int|2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode the result of a readdir call.&n; * We just check for syntactical correctness.&n; */
r_static
r_int
DECL|function|nfs3_xdr_readdirres
id|nfs3_xdr_readdirres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_readdirres
op_star
id|res
)paren
(brace
r_struct
id|iovec
op_star
id|iov
op_assign
id|req-&gt;rq_rvec
suffix:semicolon
r_int
id|hdrlen
suffix:semicolon
r_int
id|status
comma
id|nr
suffix:semicolon
r_int
r_int
id|len
suffix:semicolon
id|u32
op_star
id|entry
comma
op_star
id|end
suffix:semicolon
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
multiline_comment|/* Decode post_op_attrs */
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
id|res-&gt;dir_attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
multiline_comment|/* Decode verifier cookie */
r_if
c_cond
(paren
id|res-&gt;verf
)paren
(brace
id|res-&gt;verf
(braket
l_int|0
)braket
op_assign
op_star
id|p
op_increment
suffix:semicolon
id|res-&gt;verf
(braket
l_int|1
)braket
op_assign
op_star
id|p
op_increment
suffix:semicolon
)brace
r_else
(brace
id|p
op_add_assign
l_int|2
suffix:semicolon
)brace
id|hdrlen
op_assign
(paren
id|u8
op_star
)paren
id|p
op_minus
(paren
id|u8
op_star
)paren
id|iov-&gt;iov_base
suffix:semicolon
r_if
c_cond
(paren
id|iov-&gt;iov_len
OG
id|hdrlen
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;NFS: READDIR header is short. iovec will be shifted.&bslash;n&quot;
)paren
suffix:semicolon
id|xdr_shift_iovec
c_func
(paren
id|iov
comma
id|req-&gt;rq_rnr
comma
id|iov-&gt;iov_len
op_minus
id|hdrlen
)paren
suffix:semicolon
)brace
id|p
op_assign
(paren
id|u32
op_star
)paren
id|iov
(braket
l_int|1
)braket
dot
id|iov_base
suffix:semicolon
id|end
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
id|u8
op_star
)paren
id|p
op_plus
id|iov
(braket
l_int|1
)braket
dot
id|iov_len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|nr
op_assign
l_int|0
suffix:semicolon
op_star
id|p
op_increment
suffix:semicolon
id|nr
op_increment
)paren
(brace
id|entry
op_assign
id|p
op_minus
l_int|1
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
multiline_comment|/* inode # */
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
multiline_comment|/* string length */
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|len
)paren
op_plus
l_int|2
suffix:semicolon
multiline_comment|/* name + cookie */
r_if
c_cond
(paren
id|len
OG
id|NFS3_MAXNAMLEN
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: giant filename in readdir (len %x)!&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
r_return
op_minus
id|errno_NFSERR_IO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|res-&gt;plus
)paren
(brace
multiline_comment|/* post_op_attr */
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
id|p
op_add_assign
l_int|21
suffix:semicolon
multiline_comment|/* post_op_fh3 */
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|NFS3_FHSIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: giant filehandle in &quot;
l_string|&quot;readdir (len %x)!&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
r_return
op_minus
id|errno_NFSERR_IO
suffix:semicolon
)brace
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|len
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|p
op_plus
l_int|2
OG
id|end
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NFS: short packet in readdir reply!&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* truncate listing */
id|entry
(braket
l_int|0
)braket
op_assign
id|entry
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|nr
suffix:semicolon
)brace
id|u32
op_star
DECL|function|nfs3_decode_dirent
id|nfs3_decode_dirent
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|nfs_entry
op_star
id|entry
comma
r_int
id|plus
)paren
(brace
r_struct
id|nfs_entry
id|old
op_assign
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EAGAIN
)paren
suffix:semicolon
id|entry-&gt;eof
op_assign
l_int|1
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EBADCOOKIE
)paren
suffix:semicolon
)brace
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|entry-&gt;ino
)paren
suffix:semicolon
id|entry-&gt;len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|entry-&gt;name
op_assign
(paren
r_const
r_char
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|entry-&gt;len
)paren
suffix:semicolon
id|entry-&gt;prev_cookie
op_assign
id|entry-&gt;cookie
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|entry-&gt;cookie
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plus
)paren
(brace
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
op_amp
id|entry-&gt;fattr
)paren
suffix:semicolon
multiline_comment|/* In fact, a post_op_fh3: */
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|p
op_assign
id|xdr_decode_fhandle
c_func
(paren
id|p
comma
op_amp
id|entry-&gt;fh
)paren
suffix:semicolon
multiline_comment|/* Ugh -- server reply was truncated */
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;NFS: FH truncated&bslash;n&quot;
)paren
suffix:semicolon
op_star
id|entry
op_assign
id|old
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EAGAIN
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* If we don&squot;t get a file handle, the attrs&n;&t;&t;&t; * aren&squot;t worth a lot. */
id|entry-&gt;fattr.valid
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|entry-&gt;eof
op_assign
op_logical_neg
id|p
(braket
l_int|0
)braket
op_logical_and
id|p
(braket
l_int|1
)braket
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode COMMIT arguments&n; */
r_static
r_int
DECL|function|nfs3_xdr_commitargs
id|nfs3_xdr_commitargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_writeargs
op_star
id|args
)paren
(brace
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|args-&gt;offset
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|args-&gt;count
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * NFS XDR decode functions&n; */
multiline_comment|/*&n; * Decode void reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_dec_void
id|nfs3_xdr_dec_void
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_void
op_star
id|dummy
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode attrstat reply.&n; */
r_static
r_int
DECL|function|nfs3_xdr_attrstat
id|nfs3_xdr_attrstat
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_int
id|status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|xdr_decode_fattr
c_func
(paren
id|p
comma
id|fattr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode status+wcc_data reply&n; * SATTR, REMOVE, RMDIR&n; */
r_static
r_int
DECL|function|nfs3_xdr_wccstat
id|nfs3_xdr_wccstat
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_int
id|status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
)paren
id|status
op_assign
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|xdr_decode_wcc_data
c_func
(paren
id|p
comma
id|fattr
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode LOOKUP reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_lookupres
id|nfs3_xdr_lookupres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_diropres
op_star
id|res
)paren
(brace
r_int
id|status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
)paren
(brace
id|status
op_assign
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|xdr_decode_fhandle
c_func
(paren
id|p
comma
id|res-&gt;fh
)paren
)paren
)paren
r_return
op_minus
id|errno_NFSERR_IO
suffix:semicolon
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
id|res-&gt;fattr
)paren
suffix:semicolon
)brace
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
id|res-&gt;dir_attr
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode ACCESS reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_accessres
id|nfs3_xdr_accessres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_accessres
op_star
id|res
)paren
(brace
r_int
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
id|res-&gt;fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|res-&gt;access
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs3_xdr_readlinkargs
id|nfs3_xdr_readlinkargs
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_readlinkargs
op_star
id|args
)paren
(brace
r_struct
id|rpc_task
op_star
id|task
op_assign
id|req-&gt;rq_task
suffix:semicolon
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|task-&gt;tk_auth
suffix:semicolon
r_int
id|buflen
comma
id|replen
suffix:semicolon
id|p
op_assign
id|xdr_encode_fhandle
c_func
(paren
id|p
comma
id|args-&gt;fh
)paren
suffix:semicolon
id|req-&gt;rq_slen
op_assign
id|xdr_adjust_iovec
c_func
(paren
id|req-&gt;rq_svec
comma
id|p
)paren
suffix:semicolon
id|replen
op_assign
(paren
id|RPC_REPHDRSIZE
op_plus
id|auth-&gt;au_rslack
op_plus
id|NFS3_readlinkres_sz
)paren
op_lshift
l_int|2
suffix:semicolon
id|buflen
op_assign
id|req-&gt;rq_rvec
(braket
l_int|0
)braket
dot
id|iov_len
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
id|replen
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|1
)braket
dot
id|iov_base
op_assign
id|args-&gt;buffer
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|1
)braket
dot
id|iov_len
op_assign
id|args-&gt;bufsiz
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|2
)braket
dot
id|iov_base
op_assign
(paren
id|u8
op_star
)paren
id|req-&gt;rq_rvec
(braket
l_int|0
)braket
dot
id|iov_base
op_plus
id|replen
suffix:semicolon
id|req-&gt;rq_rvec
(braket
l_int|2
)braket
dot
id|iov_len
op_assign
id|buflen
op_minus
id|replen
suffix:semicolon
id|req-&gt;rq_rlen
op_assign
id|buflen
op_plus
id|args-&gt;bufsiz
suffix:semicolon
id|req-&gt;rq_rnr
op_add_assign
l_int|2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode READLINK reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_readlinkres
id|nfs3_xdr_readlinkres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_readlinkres
op_star
id|res
)paren
(brace
r_struct
id|iovec
op_star
id|iov
op_assign
id|req-&gt;rq_rvec
suffix:semicolon
r_int
id|hdrlen
suffix:semicolon
id|u32
op_star
id|strlen
suffix:semicolon
r_char
op_star
id|string
suffix:semicolon
r_int
id|status
suffix:semicolon
r_int
r_int
id|len
suffix:semicolon
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
id|res-&gt;fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|hdrlen
op_assign
(paren
id|u8
op_star
)paren
id|p
op_minus
(paren
id|u8
op_star
)paren
id|iov-&gt;iov_base
suffix:semicolon
r_if
c_cond
(paren
id|iov-&gt;iov_len
OG
id|hdrlen
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;NFS: READLINK header is short. iovec will be shifted.&bslash;n&quot;
)paren
suffix:semicolon
id|xdr_shift_iovec
c_func
(paren
id|iov
comma
id|req-&gt;rq_rnr
comma
id|iov-&gt;iov_len
op_minus
id|hdrlen
)paren
suffix:semicolon
)brace
id|strlen
op_assign
(paren
id|u32
op_star
)paren
id|res-&gt;buffer
suffix:semicolon
multiline_comment|/* Convert length of symlink */
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|strlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|res-&gt;bufsiz
op_minus
l_int|5
)paren
id|len
op_assign
id|res-&gt;bufsiz
op_minus
l_int|5
suffix:semicolon
op_star
id|strlen
op_assign
id|len
suffix:semicolon
multiline_comment|/* NULL terminate the string we got */
id|string
op_assign
(paren
r_char
op_star
)paren
(paren
id|strlen
op_plus
l_int|1
)paren
suffix:semicolon
id|string
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode READ reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_readres
id|nfs3_xdr_readres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_readres
op_star
id|res
)paren
(brace
r_struct
id|iovec
op_star
id|iov
op_assign
id|req-&gt;rq_rvec
suffix:semicolon
r_int
id|status
comma
id|count
comma
id|ocount
comma
id|recvd
comma
id|hdrlen
suffix:semicolon
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
id|res-&gt;fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
multiline_comment|/* Decode reply could and EOF flag. NFSv3 is somewhat redundant&n;&t; * in that it puts the count both in the res struct and in the&n;&t; * opaque data count. */
id|count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|res-&gt;eof
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|ocount
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ocount
op_ne
id|count
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: READ count doesn&squot;t match RPC opaque count.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|errno_NFSERR_IO
suffix:semicolon
)brace
id|hdrlen
op_assign
(paren
id|u8
op_star
)paren
id|p
op_minus
(paren
id|u8
op_star
)paren
id|iov-&gt;iov_base
suffix:semicolon
r_if
c_cond
(paren
id|iov-&gt;iov_len
OG
id|hdrlen
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;NFS: READ header is short. iovec will be shifted.&bslash;n&quot;
)paren
suffix:semicolon
id|xdr_shift_iovec
c_func
(paren
id|iov
comma
id|req-&gt;rq_rnr
comma
id|iov-&gt;iov_len
op_minus
id|hdrlen
)paren
suffix:semicolon
)brace
id|recvd
op_assign
id|req-&gt;rq_rlen
op_minus
id|hdrlen
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|recvd
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: server cheating in read reply: &quot;
l_string|&quot;count %d &gt; recvd %d&bslash;n&quot;
comma
id|count
comma
id|recvd
)paren
suffix:semicolon
id|count
op_assign
id|recvd
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OL
id|res-&gt;count
)paren
(brace
id|xdr_zero_iovec
c_func
(paren
id|iov
op_plus
l_int|1
comma
id|req-&gt;rq_rnr
op_minus
l_int|2
comma
id|res-&gt;count
op_minus
id|count
)paren
suffix:semicolon
id|res-&gt;count
op_assign
id|count
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode WRITE response&n; */
r_static
r_int
DECL|function|nfs3_xdr_writeres
id|nfs3_xdr_writeres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_writeres
op_star
id|res
)paren
(brace
r_int
id|status
suffix:semicolon
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_wcc_data
c_func
(paren
id|p
comma
id|res-&gt;fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|res-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|res-&gt;verf-&gt;committed
op_assign
(paren
r_enum
id|nfs3_stable_how
)paren
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|res-&gt;verf-&gt;verifier
(braket
l_int|0
)braket
op_assign
op_star
id|p
op_increment
suffix:semicolon
id|res-&gt;verf-&gt;verifier
(braket
l_int|1
)braket
op_assign
op_star
id|p
op_increment
suffix:semicolon
r_return
id|res-&gt;count
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode a CREATE response&n; */
r_static
r_int
DECL|function|nfs3_xdr_createres
id|nfs3_xdr_createres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_diropres
op_star
id|res
)paren
(brace
r_int
id|status
suffix:semicolon
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|xdr_decode_fhandle
c_func
(paren
id|p
comma
id|res-&gt;fh
)paren
)paren
)paren
r_return
op_minus
id|errno_NFSERR_IO
suffix:semicolon
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
id|res-&gt;fattr
)paren
suffix:semicolon
)brace
r_else
(brace
id|memset
c_func
(paren
id|res-&gt;fh
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|res-&gt;fh
)paren
)paren
suffix:semicolon
multiline_comment|/* Do decode post_op_attr but set it to NULL */
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
id|res-&gt;fattr
)paren
suffix:semicolon
id|res-&gt;fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|status
op_assign
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
id|p
op_assign
id|xdr_decode_wcc_data
c_func
(paren
id|p
comma
id|res-&gt;dir_attr
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode RENAME reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_renameres
id|nfs3_xdr_renameres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_renameres
op_star
id|res
)paren
(brace
r_int
id|status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
op_ne
l_int|0
)paren
id|status
op_assign
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_wcc_data
c_func
(paren
id|p
comma
id|res-&gt;fromattr
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_wcc_data
c_func
(paren
id|p
comma
id|res-&gt;toattr
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode LINK reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_linkres
id|nfs3_xdr_linkres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs3_linkres
op_star
id|res
)paren
(brace
r_int
id|status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
op_ne
l_int|0
)paren
id|status
op_assign
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
id|res-&gt;fattr
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_wcc_data
c_func
(paren
id|p
comma
id|res-&gt;dir_attr
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode FSSTAT reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_fsstatres
id|nfs3_xdr_fsstatres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_fsinfo
op_star
id|res
)paren
(brace
r_struct
id|nfs_fattr
id|dummy
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
op_amp
id|dummy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|res-&gt;tbytes
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|res-&gt;fbytes
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|res-&gt;abytes
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|res-&gt;tfiles
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|res-&gt;ffiles
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|res-&gt;afiles
)paren
suffix:semicolon
multiline_comment|/* ignore invarsec */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode FSINFO reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_fsinfores
id|nfs3_xdr_fsinfores
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_fsinfo
op_star
id|res
)paren
(brace
r_struct
id|nfs_fattr
id|dummy
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
op_amp
id|dummy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|res-&gt;rtmax
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|res-&gt;rtpref
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|res-&gt;rtmult
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|res-&gt;wtmax
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|res-&gt;wtpref
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|res-&gt;wtmult
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|res-&gt;dtpref
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|res-&gt;maxfilesize
)paren
suffix:semicolon
multiline_comment|/* ignore time_delta and properties */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode PATHCONF reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_pathconfres
id|nfs3_xdr_pathconfres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_fsinfo
op_star
id|res
)paren
(brace
r_struct
id|nfs_fattr
id|dummy
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_post_op_attr
c_func
(paren
id|p
comma
op_amp
id|dummy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|res-&gt;linkmax
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|res-&gt;namelen
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
multiline_comment|/* ignore remaining fields */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode COMMIT reply&n; */
r_static
r_int
DECL|function|nfs3_xdr_commitres
id|nfs3_xdr_commitres
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
id|u32
op_star
id|p
comma
r_struct
id|nfs_writeres
op_star
id|res
)paren
(brace
r_int
id|status
suffix:semicolon
id|status
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|p
op_assign
id|xdr_decode_wcc_data
c_func
(paren
id|p
comma
id|res-&gt;fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|status
)paren
suffix:semicolon
id|res-&gt;verf-&gt;verifier
(braket
l_int|0
)braket
op_assign
op_star
id|p
op_increment
suffix:semicolon
id|res-&gt;verf-&gt;verifier
(braket
l_int|1
)braket
op_assign
op_star
id|p
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifndef MAX
DECL|macro|MAX
macro_line|# define MAX(a, b)&t;(((a) &gt; (b))? (a) : (b))
macro_line|#endif
DECL|macro|PROC
mdefine_line|#define PROC(proc, argtype, restype)&t;&t;&t;&t;&bslash;&n;    { &quot;nfs3_&quot; #proc,&t;&t;&t;&t;&t;&t;&bslash;&n;      (kxdrproc_t) nfs3_xdr_##argtype,&t;&t;&t;&t;&bslash;&n;      (kxdrproc_t) nfs3_xdr_##restype,&t;&t;&t;&t;&bslash;&n;      MAX(NFS3_##argtype##_sz,NFS3_##restype##_sz) &lt;&lt; 2,&t;&bslash;&n;      0&t;&t;&t;&t;&t;&t;&t;&bslash;&n;    }
DECL|variable|nfs3_procedures
r_static
r_struct
id|rpc_procinfo
id|nfs3_procedures
(braket
l_int|22
)braket
op_assign
(brace
id|PROC
c_func
(paren
id|null
comma
id|enc_void
comma
id|dec_void
)paren
comma
id|PROC
c_func
(paren
id|getattr
comma
id|fhandle
comma
id|attrstat
)paren
comma
id|PROC
c_func
(paren
id|setattr
comma
id|sattrargs
comma
id|wccstat
)paren
comma
id|PROC
c_func
(paren
id|lookup
comma
id|diropargs
comma
id|lookupres
)paren
comma
id|PROC
c_func
(paren
id|access
comma
id|accessargs
comma
id|accessres
)paren
comma
id|PROC
c_func
(paren
id|readlink
comma
id|readlinkargs
comma
id|readlinkres
)paren
comma
id|PROC
c_func
(paren
id|read
comma
id|readargs
comma
id|readres
)paren
comma
id|PROC
c_func
(paren
id|write
comma
id|writeargs
comma
id|writeres
)paren
comma
id|PROC
c_func
(paren
id|create
comma
id|createargs
comma
id|createres
)paren
comma
id|PROC
c_func
(paren
id|mkdir
comma
id|mkdirargs
comma
id|createres
)paren
comma
id|PROC
c_func
(paren
id|symlink
comma
id|symlinkargs
comma
id|createres
)paren
comma
id|PROC
c_func
(paren
id|mknod
comma
id|mknodargs
comma
id|createres
)paren
comma
id|PROC
c_func
(paren
id|remove
comma
id|diropargs
comma
id|wccstat
)paren
comma
id|PROC
c_func
(paren
id|rmdir
comma
id|diropargs
comma
id|wccstat
)paren
comma
id|PROC
c_func
(paren
id|rename
comma
id|renameargs
comma
id|renameres
)paren
comma
id|PROC
c_func
(paren
id|link
comma
id|linkargs
comma
id|linkres
)paren
comma
id|PROC
c_func
(paren
id|readdir
comma
id|readdirargs
comma
id|readdirres
)paren
comma
id|PROC
c_func
(paren
id|readdirplus
comma
id|readdirargs
comma
id|readdirres
)paren
comma
id|PROC
c_func
(paren
id|fsstat
comma
id|fhandle
comma
id|fsstatres
)paren
comma
id|PROC
c_func
(paren
id|fsinfo
comma
id|fhandle
comma
id|fsinfores
)paren
comma
id|PROC
c_func
(paren
id|pathconf
comma
id|fhandle
comma
id|pathconfres
)paren
comma
id|PROC
c_func
(paren
id|commit
comma
id|commitargs
comma
id|commitres
)paren
comma
)brace
suffix:semicolon
DECL|variable|nfs_version3
r_struct
id|rpc_version
id|nfs_version3
op_assign
(brace
l_int|3
comma
r_sizeof
(paren
id|nfs3_procedures
)paren
op_div
r_sizeof
(paren
id|nfs3_procedures
(braket
l_int|0
)braket
)paren
comma
id|nfs3_procedures
)brace
suffix:semicolon
eof
