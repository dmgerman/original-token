DECL|function|nfs_bl_cache_invalidate
r_void
id|nfs_bl_cache_invalidate
c_func
(paren
id|nfs_cache
op_star
id|nh
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nh-&gt;inuse
)paren
(brace
id|nh-&gt;dead
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|kfree_s
c_func
(paren
id|nh-&gt;data
)paren
suffix:semicolon
id|nh-&gt;data
op_assign
l_int|NULL
suffix:semicolon
id|nh-&gt;free
op_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|nfs_bl_cache_revalidate
r_void
id|nfs_bl_cache_revalidate
c_func
(paren
id|nfs_cache
op_star
id|nh
comma
r_struct
id|fattr
id|fa
)paren
(brace
id|nh-&gt;fattr
op_assign
id|fattr
suffix:semicolon
id|nh-&gt;time
op_assign
id|jiffies
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Find a block in the cache. We know the cache is block sized in block&n; *&t;aligned space.&n; */
DECL|function|nfs_cache_find
id|nfs_cache
op_star
id|nfs_cache_find
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|off_t
id|pos
)paren
(brace
id|nfs_cache
op_star
id|nh
op_assign
op_amp
id|nfs_cache_slot
(braket
l_int|0
)braket
suffix:semicolon
id|nfs_cache
op_star
id|ffree
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|nfs_fattr
id|fattr
suffix:semicolon
r_int
id|ct
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|ct
OL
id|NH_CACHE_SIZE
)paren
(brace
r_if
c_cond
(paren
id|nh-&gt;inode_num
op_eq
id|inode-&gt;i_no
op_logical_and
op_logical_neg
id|nh-&gt;dead
op_logical_and
op_logical_neg
id|nh-&gt;free
op_logical_and
id|nh-&gt;file_pos
op_eq
id|pos
)paren
(brace
r_if
c_cond
(paren
id|abs
c_func
(paren
id|jiffies
op_minus
id|nh-&gt;time
)paren
OL
id|EXPIRE_CACHE
)paren
(brace
r_return
id|nh
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; *&t;Revalidate&n;&t;&t;&t; */
r_if
c_cond
(paren
id|nfs_proc_getattr
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
op_amp
id|fattr
)paren
)paren
(brace
id|nfs_bl_cache_invalidate
c_func
(paren
id|nh
)paren
suffix:semicolon
r_continue
suffix:semicolon
multiline_comment|/* get attr failed */
)brace
r_if
c_cond
(paren
id|nh-&gt;fattr.modified
op_ne
id|fattr.modified
)paren
(brace
id|nfs_bl_cache_invalidate
c_func
(paren
id|nh
)paren
suffix:semicolon
r_continue
suffix:semicolon
multiline_comment|/* cache is out of date */
)brace
id|nfs_refresh_inode
c_func
(paren
id|inode
comma
id|fattr
)paren
suffix:semicolon
id|nh-&gt;fattr
op_assign
id|fattr
suffix:semicolon
id|nfs_bl_cache_revalidate
c_func
(paren
id|nh
)paren
suffix:semicolon
r_return
id|nh
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nh-&gt;free
)paren
(brace
id|ffree
op_assign
id|nh
suffix:semicolon
)brace
)brace
r_return
id|ffree
suffix:semicolon
)brace
eof
