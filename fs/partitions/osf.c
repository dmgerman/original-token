multiline_comment|/*&n; *  fs/partitions/osf.c&n; *&n; *  Code extracted from drivers/block/genhd.c&n; *&n; *  Copyright (C) 1991-1998  Linus Torvalds&n; *  Re-organised Feb 1998 Russell King&n; */
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/genhd.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &quot;check.h&quot;
macro_line|#include &quot;osf.h&quot;
DECL|function|osf_partition
r_int
id|osf_partition
c_func
(paren
r_struct
id|gendisk
op_star
id|hd
comma
id|kdev_t
id|dev
comma
r_int
r_int
id|first_sector
comma
r_int
id|current_minor
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|mask
op_assign
(paren
l_int|1
op_lshift
id|hd-&gt;minor_shift
)paren
op_minus
l_int|1
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
r_struct
id|disklabel
(brace
id|u32
id|d_magic
suffix:semicolon
id|u16
id|d_type
comma
id|d_subtype
suffix:semicolon
id|u8
id|d_typename
(braket
l_int|16
)braket
suffix:semicolon
id|u8
id|d_packname
(braket
l_int|16
)braket
suffix:semicolon
id|u32
id|d_secsize
suffix:semicolon
id|u32
id|d_nsectors
suffix:semicolon
id|u32
id|d_ntracks
suffix:semicolon
id|u32
id|d_ncylinders
suffix:semicolon
id|u32
id|d_secpercyl
suffix:semicolon
id|u32
id|d_secprtunit
suffix:semicolon
id|u16
id|d_sparespertrack
suffix:semicolon
id|u16
id|d_sparespercyl
suffix:semicolon
id|u32
id|d_acylinders
suffix:semicolon
id|u16
id|d_rpm
comma
id|d_interleave
comma
id|d_trackskew
comma
id|d_cylskew
suffix:semicolon
id|u32
id|d_headswitch
comma
id|d_trkseek
comma
id|d_flags
suffix:semicolon
id|u32
id|d_drivedata
(braket
l_int|5
)braket
suffix:semicolon
id|u32
id|d_spare
(braket
l_int|5
)braket
suffix:semicolon
id|u32
id|d_magic2
suffix:semicolon
id|u16
id|d_checksum
suffix:semicolon
id|u16
id|d_npartitions
suffix:semicolon
id|u32
id|d_bbsize
comma
id|d_sbsize
suffix:semicolon
r_struct
id|d_partition
(brace
id|u32
id|p_size
suffix:semicolon
id|u32
id|p_offset
suffix:semicolon
id|u32
id|p_fsize
suffix:semicolon
id|u8
id|p_fstype
suffix:semicolon
id|u8
id|p_frag
suffix:semicolon
id|u16
id|p_cpg
suffix:semicolon
)brace
id|d_partitions
(braket
l_int|8
)braket
suffix:semicolon
)brace
op_star
id|label
suffix:semicolon
r_struct
id|d_partition
op_star
id|partition
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|bread
c_func
(paren
id|dev
comma
l_int|0
comma
id|get_ptable_blocksize
c_func
(paren
id|dev
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|warn_no_part
)paren
id|printk
c_func
(paren
l_string|&quot;unable to read partition table&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|label
op_assign
(paren
r_struct
id|disklabel
op_star
)paren
(paren
id|bh-&gt;b_data
op_plus
l_int|64
)paren
suffix:semicolon
id|partition
op_assign
id|label-&gt;d_partitions
suffix:semicolon
r_if
c_cond
(paren
id|label-&gt;d_magic
op_ne
id|DISKLABELMAGIC
)paren
(brace
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|label-&gt;d_magic2
op_ne
id|DISKLABELMAGIC
)paren
(brace
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|label-&gt;d_npartitions
suffix:semicolon
id|i
op_increment
comma
id|partition
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|current_minor
op_amp
id|mask
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|partition-&gt;p_size
)paren
id|add_gd_partition
c_func
(paren
id|hd
comma
id|current_minor
comma
id|first_sector
op_plus
id|partition-&gt;p_offset
comma
id|partition-&gt;p_size
)paren
suffix:semicolon
id|current_minor
op_increment
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
eof
