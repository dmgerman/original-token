multiline_comment|/*&n; *  linux/fs/file_table.c&n; *&n; *  Copyright (C) 1991, 1992  Linus Torvalds&n; */
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
DECL|variable|first_file
r_struct
id|file
op_star
id|first_file
suffix:semicolon
DECL|variable|nr_files
r_int
id|nr_files
op_assign
l_int|0
suffix:semicolon
DECL|function|insert_file_free
r_static
r_void
id|insert_file_free
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
id|file-&gt;f_next
op_assign
id|first_file
suffix:semicolon
id|file-&gt;f_prev
op_assign
id|first_file-&gt;f_prev
suffix:semicolon
id|file-&gt;f_next-&gt;f_prev
op_assign
id|file
suffix:semicolon
id|file-&gt;f_prev-&gt;f_next
op_assign
id|file
suffix:semicolon
id|first_file
op_assign
id|file
suffix:semicolon
)brace
DECL|function|remove_file_free
r_static
r_void
id|remove_file_free
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_if
c_cond
(paren
id|first_file
op_eq
id|file
)paren
id|first_file
op_assign
id|first_file-&gt;f_next
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_next
)paren
id|file-&gt;f_next-&gt;f_prev
op_assign
id|file-&gt;f_prev
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_prev
)paren
id|file-&gt;f_prev-&gt;f_next
op_assign
id|file-&gt;f_next
suffix:semicolon
id|file-&gt;f_next
op_assign
id|file-&gt;f_prev
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|put_last_free
r_static
r_void
id|put_last_free
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
id|remove_file_free
c_func
(paren
id|file
)paren
suffix:semicolon
id|file-&gt;f_prev
op_assign
id|first_file-&gt;f_prev
suffix:semicolon
id|file-&gt;f_prev-&gt;f_next
op_assign
id|file
suffix:semicolon
id|file-&gt;f_next
op_assign
id|first_file
suffix:semicolon
id|file-&gt;f_next-&gt;f_prev
op_assign
id|file
suffix:semicolon
)brace
DECL|function|grow_files
r_void
id|grow_files
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|page
suffix:semicolon
r_struct
id|file
op_star
id|file
suffix:semicolon
r_int
id|i
suffix:semicolon
id|page
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
r_return
suffix:semicolon
id|file
op_assign
(paren
r_struct
id|file
op_star
)paren
id|page
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|PAGE_SIZE
op_div
r_sizeof
(paren
r_struct
id|file
)paren
)paren
suffix:semicolon
id|i
op_increment
comma
id|file
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|first_file
)paren
(brace
id|file-&gt;f_next
op_assign
id|file
suffix:semicolon
id|file-&gt;f_prev
op_assign
id|file
suffix:semicolon
id|first_file
op_assign
id|file
suffix:semicolon
)brace
r_else
id|insert_file_free
c_func
(paren
id|file
)paren
suffix:semicolon
)brace
id|nr_files
op_add_assign
id|i
suffix:semicolon
)brace
DECL|function|file_table_init
r_int
r_int
id|file_table_init
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|first_file
op_assign
l_int|NULL
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
DECL|function|get_empty_filp
r_struct
id|file
op_star
id|get_empty_filp
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|file
op_star
id|f
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|first_file
)paren
id|grow_files
c_func
(paren
)paren
suffix:semicolon
id|repeat
suffix:colon
r_for
c_loop
(paren
id|f
op_assign
id|first_file
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_files
suffix:semicolon
id|i
op_increment
comma
id|f
op_assign
id|f-&gt;f_next
)paren
r_if
c_cond
(paren
op_logical_neg
id|f-&gt;f_count
)paren
(brace
id|remove_file_free
c_func
(paren
id|f
)paren
suffix:semicolon
id|memset
c_func
(paren
id|f
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|f
)paren
)paren
suffix:semicolon
id|put_last_free
c_func
(paren
id|f
)paren
suffix:semicolon
id|f-&gt;f_count
op_assign
l_int|1
suffix:semicolon
r_return
id|f
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nr_files
OL
id|NR_FILE
)paren
(brace
id|grow_files
c_func
(paren
)paren
suffix:semicolon
r_goto
id|repeat
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
eof
