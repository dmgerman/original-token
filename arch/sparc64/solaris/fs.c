multiline_comment|/* $Id: fs.c,v 1.8 1998/03/29 10:11:02 davem Exp $&n; * fs.c: fs related syscall emulation for Solaris&n; *&n; * Copyright (C) 1997 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/file.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/limits.h&gt;
macro_line|#include &lt;linux/resource.h&gt;
macro_line|#include &lt;linux/quotaops.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/string.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &quot;conv.h&quot;
r_extern
r_char
op_star
id|getname32
c_func
(paren
id|u32
id|filename
)paren
suffix:semicolon
DECL|macro|putname32
mdefine_line|#define putname32 putname
DECL|macro|R4_DEV
mdefine_line|#define R4_DEV(DEV) ((DEV &amp; 0xff) | ((DEV &amp; 0xff00) &lt;&lt; 10))
DECL|macro|R4_MAJOR
mdefine_line|#define R4_MAJOR(DEV) (((DEV) &gt;&gt; 18) &amp; 0x3fff)
DECL|macro|R4_MINOR
mdefine_line|#define R4_MINOR(DEV) ((DEV) &amp; 0x3ffff)
DECL|macro|R3_VERSION
mdefine_line|#define R3_VERSION&t;1
DECL|macro|R4_VERSION
mdefine_line|#define R4_VERSION&t;2
r_typedef
r_struct
(brace
DECL|member|tv_sec
id|s32
id|tv_sec
suffix:semicolon
DECL|member|tv_nsec
id|s32
id|tv_nsec
suffix:semicolon
DECL|typedef|timestruct_t
)brace
id|timestruct_t
suffix:semicolon
DECL|struct|sol_stat
r_struct
id|sol_stat
(brace
DECL|member|st_dev
id|u32
id|st_dev
suffix:semicolon
DECL|member|st_pad1
id|s32
id|st_pad1
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* network id */
DECL|member|st_ino
id|u32
id|st_ino
suffix:semicolon
DECL|member|st_mode
id|u32
id|st_mode
suffix:semicolon
DECL|member|st_nlink
id|u32
id|st_nlink
suffix:semicolon
DECL|member|st_uid
id|u32
id|st_uid
suffix:semicolon
DECL|member|st_gid
id|u32
id|st_gid
suffix:semicolon
DECL|member|st_rdev
id|u32
id|st_rdev
suffix:semicolon
DECL|member|st_pad2
id|s32
id|st_pad2
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|st_size
id|s32
id|st_size
suffix:semicolon
DECL|member|st_pad3
id|s32
id|st_pad3
suffix:semicolon
multiline_comment|/* st_size, off_t expansion */
DECL|member|st_atime
id|timestruct_t
id|st_atime
suffix:semicolon
DECL|member|st_mtime
id|timestruct_t
id|st_mtime
suffix:semicolon
DECL|member|st_ctime
id|timestruct_t
id|st_ctime
suffix:semicolon
DECL|member|st_blksize
id|s32
id|st_blksize
suffix:semicolon
DECL|member|st_blocks
id|s32
id|st_blocks
suffix:semicolon
DECL|member|st_fstype
r_char
id|st_fstype
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|st_pad4
id|s32
id|st_pad4
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* expansion area */
)brace
suffix:semicolon
DECL|macro|UFSMAGIC
mdefine_line|#define UFSMAGIC (((unsigned)&squot;u&squot;&lt;&lt;24)||((unsigned)&squot;f&squot;&lt;&lt;16)||((unsigned)&squot;s&squot;&lt;&lt;8))
DECL|function|putstat
r_static
r_inline
r_int
id|putstat
c_func
(paren
r_struct
id|sol_stat
op_star
id|ubuf
comma
r_struct
id|stat
op_star
id|kbuf
)paren
(brace
r_if
c_cond
(paren
id|put_user
(paren
id|R4_DEV
c_func
(paren
id|kbuf-&gt;st_dev
)paren
comma
op_amp
id|ubuf-&gt;st_dev
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_ino
comma
op_amp
id|ubuf-&gt;st_ino
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_mode
comma
op_amp
id|ubuf-&gt;st_mode
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_nlink
comma
op_amp
id|ubuf-&gt;st_nlink
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_uid
comma
op_amp
id|ubuf-&gt;st_uid
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_gid
comma
op_amp
id|ubuf-&gt;st_gid
)paren
op_logical_or
id|__put_user
(paren
id|R4_DEV
c_func
(paren
id|kbuf-&gt;st_rdev
)paren
comma
op_amp
id|ubuf-&gt;st_rdev
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_size
comma
op_amp
id|ubuf-&gt;st_size
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_atime
comma
op_amp
id|ubuf-&gt;st_atime.tv_sec
)paren
op_logical_or
id|__put_user
(paren
l_int|0
comma
op_amp
id|ubuf-&gt;st_atime.tv_nsec
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_mtime
comma
op_amp
id|ubuf-&gt;st_mtime.tv_sec
)paren
op_logical_or
id|__put_user
(paren
l_int|0
comma
op_amp
id|ubuf-&gt;st_mtime.tv_nsec
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_ctime
comma
op_amp
id|ubuf-&gt;st_ctime.tv_sec
)paren
op_logical_or
id|__put_user
(paren
l_int|0
comma
op_amp
id|ubuf-&gt;st_ctime.tv_nsec
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_blksize
comma
op_amp
id|ubuf-&gt;st_blksize
)paren
op_logical_or
id|__put_user
(paren
id|kbuf-&gt;st_blocks
comma
op_amp
id|ubuf-&gt;st_blocks
)paren
op_logical_or
id|__put_user
(paren
id|UFSMAGIC
comma
(paren
r_int
op_star
)paren
id|ubuf-&gt;st_fstype
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|solaris_stat
id|asmlinkage
r_int
id|solaris_stat
c_func
(paren
id|u32
id|filename
comma
id|u32
id|statbuf
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|stat
id|s
suffix:semicolon
r_char
op_star
id|filenam
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_newstat
)paren
(paren
r_char
op_star
comma
r_struct
id|stat
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_char
op_star
comma
r_struct
id|stat
op_star
)paren
)paren
id|SYS
c_func
(paren
id|stat
)paren
suffix:semicolon
id|filenam
op_assign
id|getname32
(paren
id|filename
)paren
suffix:semicolon
id|ret
op_assign
id|PTR_ERR
c_func
(paren
id|filenam
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_ERR
c_func
(paren
id|filenam
)paren
)paren
(brace
id|set_fs
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_newstat
c_func
(paren
id|filenam
comma
op_amp
id|s
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|putname32
(paren
id|filenam
)paren
suffix:semicolon
r_if
c_cond
(paren
id|putstat
(paren
(paren
r_struct
id|sol_stat
op_star
)paren
id|A
c_func
(paren
id|statbuf
)paren
comma
op_amp
id|s
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_xstat
id|asmlinkage
r_int
id|solaris_xstat
c_func
(paren
r_int
id|vers
comma
id|u32
id|filename
comma
id|u32
id|statbuf
)paren
(brace
multiline_comment|/* Solaris doesn&squot;t bother with looking at vers, so we do neither */
r_return
id|solaris_stat
c_func
(paren
id|filename
comma
id|statbuf
)paren
suffix:semicolon
)brace
DECL|function|solaris_lstat
id|asmlinkage
r_int
id|solaris_lstat
c_func
(paren
id|u32
id|filename
comma
id|u32
id|statbuf
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|stat
id|s
suffix:semicolon
r_char
op_star
id|filenam
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_newlstat
)paren
(paren
r_char
op_star
comma
r_struct
id|stat
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_char
op_star
comma
r_struct
id|stat
op_star
)paren
)paren
id|SYS
c_func
(paren
id|lstat
)paren
suffix:semicolon
id|filenam
op_assign
id|getname32
(paren
id|filename
)paren
suffix:semicolon
id|ret
op_assign
id|PTR_ERR
c_func
(paren
id|filenam
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_ERR
c_func
(paren
id|filenam
)paren
)paren
(brace
id|set_fs
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_newlstat
c_func
(paren
id|filenam
comma
op_amp
id|s
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|putname32
(paren
id|filenam
)paren
suffix:semicolon
r_if
c_cond
(paren
id|putstat
(paren
(paren
r_struct
id|sol_stat
op_star
)paren
id|A
c_func
(paren
id|statbuf
)paren
comma
op_amp
id|s
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_lxstat
id|asmlinkage
r_int
id|solaris_lxstat
c_func
(paren
r_int
id|vers
comma
id|u32
id|filename
comma
id|u32
id|statbuf
)paren
(brace
r_return
id|solaris_lstat
c_func
(paren
id|filename
comma
id|statbuf
)paren
suffix:semicolon
)brace
DECL|function|solaris_fstat
id|asmlinkage
r_int
id|solaris_fstat
c_func
(paren
r_int
r_int
id|fd
comma
id|u32
id|statbuf
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|stat
id|s
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_newfstat
)paren
(paren
r_int
comma
r_struct
id|stat
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
comma
r_struct
id|stat
op_star
)paren
)paren
id|SYS
c_func
(paren
id|fstat
)paren
suffix:semicolon
id|set_fs
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_newfstat
c_func
(paren
id|fd
comma
op_amp
id|s
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|putstat
(paren
(paren
r_struct
id|sol_stat
op_star
)paren
id|A
c_func
(paren
id|statbuf
)paren
comma
op_amp
id|s
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_fxstat
id|asmlinkage
r_int
id|solaris_fxstat
c_func
(paren
r_int
id|vers
comma
id|u32
id|fd
comma
id|u32
id|statbuf
)paren
(brace
r_return
id|solaris_fstat
c_func
(paren
id|fd
comma
id|statbuf
)paren
suffix:semicolon
)brace
DECL|function|solaris_mknod
id|asmlinkage
r_int
id|solaris_mknod
c_func
(paren
id|u32
id|path
comma
id|u32
id|mode
comma
id|s32
id|dev
)paren
(brace
r_int
(paren
op_star
id|sys_mknod
)paren
(paren
r_const
r_char
op_star
comma
r_int
comma
id|dev_t
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_const
r_char
op_star
comma
r_int
comma
id|dev_t
)paren
)paren
id|SYS
c_func
(paren
id|mknod
)paren
suffix:semicolon
r_int
id|major
comma
id|minor
suffix:semicolon
r_if
c_cond
(paren
(paren
id|major
op_assign
id|R4_MAJOR
c_func
(paren
id|dev
)paren
)paren
OG
l_int|255
op_logical_or
(paren
id|minor
op_assign
id|R4_MINOR
c_func
(paren
id|dev
)paren
)paren
OG
l_int|255
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|sys_mknod
c_func
(paren
(paren
r_const
r_char
op_star
)paren
id|A
c_func
(paren
id|path
)paren
comma
id|mode
comma
id|MKDEV
c_func
(paren
id|major
comma
id|minor
)paren
)paren
suffix:semicolon
)brace
DECL|function|solaris_xmknod
id|asmlinkage
r_int
id|solaris_xmknod
c_func
(paren
r_int
id|vers
comma
id|u32
id|path
comma
id|u32
id|mode
comma
id|s32
id|dev
)paren
(brace
r_return
id|solaris_mknod
c_func
(paren
id|path
comma
id|mode
comma
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* This statfs thingie probably will go in the near future, but... */
DECL|struct|sol_statfs
r_struct
id|sol_statfs
(brace
DECL|member|f_type
r_int
id|f_type
suffix:semicolon
DECL|member|f_bsize
id|s32
id|f_bsize
suffix:semicolon
DECL|member|f_frsize
id|s32
id|f_frsize
suffix:semicolon
DECL|member|f_blocks
id|s32
id|f_blocks
suffix:semicolon
DECL|member|f_bfree
id|s32
id|f_bfree
suffix:semicolon
DECL|member|f_files
id|u32
id|f_files
suffix:semicolon
DECL|member|f_ffree
id|u32
id|f_ffree
suffix:semicolon
DECL|member|f_fname
r_char
id|f_fname
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|f_fpack
r_char
id|f_fpack
(braket
l_int|6
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|solaris_statfs
id|asmlinkage
r_int
id|solaris_statfs
c_func
(paren
id|u32
id|path
comma
id|u32
id|buf
comma
r_int
id|len
comma
r_int
id|fstype
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|statfs
id|s
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_statfs
)paren
(paren
r_const
r_char
op_star
comma
r_struct
id|statfs
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_const
r_char
op_star
comma
r_struct
id|statfs
op_star
)paren
)paren
id|SYS
c_func
(paren
id|statfs
)paren
suffix:semicolon
r_struct
id|sol_statfs
op_star
id|ss
op_assign
(paren
r_struct
id|sol_statfs
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ne
r_sizeof
(paren
r_struct
id|sol_statfs
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fstype
)paren
(brace
id|set_fs
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_statfs
c_func
(paren
(paren
r_const
r_char
op_star
)paren
id|A
c_func
(paren
id|path
)paren
comma
op_amp
id|s
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_if
c_cond
(paren
id|put_user
(paren
id|s.f_type
comma
op_amp
id|ss-&gt;f_type
)paren
op_logical_or
id|__put_user
(paren
id|s.f_bsize
comma
op_amp
id|ss-&gt;f_bsize
)paren
op_logical_or
id|__put_user
(paren
l_int|0
comma
op_amp
id|ss-&gt;f_frsize
)paren
op_logical_or
id|__put_user
(paren
id|s.f_blocks
comma
op_amp
id|ss-&gt;f_blocks
)paren
op_logical_or
id|__put_user
(paren
id|s.f_bfree
comma
op_amp
id|ss-&gt;f_bfree
)paren
op_logical_or
id|__put_user
(paren
id|s.f_files
comma
op_amp
id|ss-&gt;f_files
)paren
op_logical_or
id|__put_user
(paren
id|s.f_ffree
comma
op_amp
id|ss-&gt;f_ffree
)paren
op_logical_or
id|__clear_user
(paren
op_amp
id|ss-&gt;f_fname
comma
l_int|12
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Linux can&squot;t stat unmounted filesystems so we&n; * simply lie and claim 100MB of 1GB is free. Sorry.&n; */
r_if
c_cond
(paren
id|put_user
(paren
id|fstype
comma
op_amp
id|ss-&gt;f_type
)paren
op_logical_or
id|__put_user
(paren
l_int|1024
comma
op_amp
id|ss-&gt;f_bsize
)paren
op_logical_or
id|__put_user
(paren
l_int|0
comma
op_amp
id|ss-&gt;f_frsize
)paren
op_logical_or
id|__put_user
(paren
l_int|1024
op_star
l_int|1024
comma
op_amp
id|ss-&gt;f_blocks
)paren
op_logical_or
id|__put_user
(paren
l_int|100
op_star
l_int|1024
comma
op_amp
id|ss-&gt;f_bfree
)paren
op_logical_or
id|__put_user
(paren
l_int|60000
comma
op_amp
id|ss-&gt;f_files
)paren
op_logical_or
id|__put_user
(paren
l_int|50000
comma
op_amp
id|ss-&gt;f_ffree
)paren
op_logical_or
id|__clear_user
(paren
op_amp
id|ss-&gt;f_fname
comma
l_int|12
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|solaris_fstatfs
id|asmlinkage
r_int
id|solaris_fstatfs
c_func
(paren
id|u32
id|fd
comma
id|u32
id|buf
comma
r_int
id|len
comma
r_int
id|fstype
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|statfs
id|s
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_fstatfs
)paren
(paren
r_int
comma
r_struct
id|statfs
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
comma
r_struct
id|statfs
op_star
)paren
)paren
id|SYS
c_func
(paren
id|fstatfs
)paren
suffix:semicolon
r_struct
id|sol_statfs
op_star
id|ss
op_assign
(paren
r_struct
id|sol_statfs
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ne
r_sizeof
(paren
r_struct
id|sol_statfs
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fstype
)paren
(brace
id|set_fs
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_fstatfs
c_func
(paren
id|fd
comma
op_amp
id|s
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_if
c_cond
(paren
id|put_user
(paren
id|s.f_type
comma
op_amp
id|ss-&gt;f_type
)paren
op_logical_or
id|__put_user
(paren
id|s.f_bsize
comma
op_amp
id|ss-&gt;f_bsize
)paren
op_logical_or
id|__put_user
(paren
l_int|0
comma
op_amp
id|ss-&gt;f_frsize
)paren
op_logical_or
id|__put_user
(paren
id|s.f_blocks
comma
op_amp
id|ss-&gt;f_blocks
)paren
op_logical_or
id|__put_user
(paren
id|s.f_bfree
comma
op_amp
id|ss-&gt;f_bfree
)paren
op_logical_or
id|__put_user
(paren
id|s.f_files
comma
op_amp
id|ss-&gt;f_files
)paren
op_logical_or
id|__put_user
(paren
id|s.f_ffree
comma
op_amp
id|ss-&gt;f_ffree
)paren
op_logical_or
id|__clear_user
(paren
op_amp
id|ss-&gt;f_fname
comma
l_int|12
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Otherwise fstatfs is the same as statfs */
r_return
id|solaris_statfs
c_func
(paren
l_int|0
comma
id|buf
comma
id|len
comma
id|fstype
)paren
suffix:semicolon
)brace
DECL|struct|sol_statvfs
r_struct
id|sol_statvfs
(brace
DECL|member|f_bsize
id|u32
id|f_bsize
suffix:semicolon
DECL|member|f_frsize
id|u32
id|f_frsize
suffix:semicolon
DECL|member|f_blocks
id|u32
id|f_blocks
suffix:semicolon
DECL|member|f_bfree
id|u32
id|f_bfree
suffix:semicolon
DECL|member|f_bavail
id|u32
id|f_bavail
suffix:semicolon
DECL|member|f_files
id|u32
id|f_files
suffix:semicolon
DECL|member|f_ffree
id|u32
id|f_ffree
suffix:semicolon
DECL|member|f_favail
id|u32
id|f_favail
suffix:semicolon
DECL|member|f_fsid
id|u32
id|f_fsid
suffix:semicolon
DECL|member|f_basetype
r_char
id|f_basetype
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|f_flag
id|u32
id|f_flag
suffix:semicolon
DECL|member|f_namemax
id|u32
id|f_namemax
suffix:semicolon
DECL|member|f_fstr
r_char
id|f_fstr
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|f_filler
id|u32
id|f_filler
(braket
l_int|16
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|report_statvfs
r_static
r_int
id|report_statvfs
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|u32
id|buf
)paren
(brace
r_struct
id|statfs
id|s
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|sol_statvfs
op_star
id|ss
op_assign
(paren
r_struct
id|sol_statvfs
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
suffix:semicolon
id|set_fs
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|error
op_assign
id|inode-&gt;i_sb-&gt;s_op
op_member_access_from_pointer
id|statfs
c_func
(paren
id|inode-&gt;i_sb
comma
op_amp
id|s
comma
r_sizeof
(paren
r_struct
id|statfs
)paren
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
(brace
r_const
r_char
op_star
id|p
op_assign
id|inode-&gt;i_sb-&gt;s_type-&gt;name
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|j
op_assign
id|strlen
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
OG
l_int|15
)paren
id|j
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|IS_RDONLY
c_func
(paren
id|inode
)paren
)paren
id|i
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|IS_NOSUID
c_func
(paren
id|inode
)paren
)paren
id|i
op_or_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|put_user
(paren
id|s.f_bsize
comma
op_amp
id|ss-&gt;f_bsize
)paren
op_logical_or
id|__put_user
(paren
l_int|0
comma
op_amp
id|ss-&gt;f_frsize
)paren
op_logical_or
id|__put_user
(paren
id|s.f_blocks
comma
op_amp
id|ss-&gt;f_blocks
)paren
op_logical_or
id|__put_user
(paren
id|s.f_bfree
comma
op_amp
id|ss-&gt;f_bfree
)paren
op_logical_or
id|__put_user
(paren
id|s.f_bavail
comma
op_amp
id|ss-&gt;f_bavail
)paren
op_logical_or
id|__put_user
(paren
id|s.f_files
comma
op_amp
id|ss-&gt;f_files
)paren
op_logical_or
id|__put_user
(paren
id|s.f_ffree
comma
op_amp
id|ss-&gt;f_ffree
)paren
op_logical_or
id|__put_user
(paren
id|s.f_ffree
comma
op_amp
id|ss-&gt;f_favail
)paren
op_logical_or
id|__put_user
(paren
id|R4_DEV
c_func
(paren
id|inode-&gt;i_sb-&gt;s_dev
)paren
comma
op_amp
id|ss-&gt;f_fsid
)paren
op_logical_or
id|__copy_to_user
(paren
id|ss-&gt;f_basetype
comma
id|p
comma
id|j
)paren
op_logical_or
id|__put_user
(paren
l_int|0
comma
(paren
r_char
op_star
)paren
op_amp
id|ss-&gt;f_basetype
(braket
id|j
)braket
)paren
op_logical_or
id|__put_user
(paren
id|s.f_namelen
comma
op_amp
id|ss-&gt;f_namemax
)paren
op_logical_or
id|__put_user
(paren
id|i
comma
op_amp
id|ss-&gt;f_flag
)paren
op_logical_or
id|__clear_user
(paren
op_amp
id|ss-&gt;f_fstr
comma
l_int|32
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
DECL|function|solaris_statvfs
id|asmlinkage
r_int
id|solaris_statvfs
c_func
(paren
id|u32
id|path
comma
id|u32
id|buf
)paren
(brace
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_int
id|error
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|dentry
op_assign
id|namei
c_func
(paren
(paren
r_const
r_char
op_star
)paren
id|A
c_func
(paren
id|path
)paren
)paren
suffix:semicolon
id|error
op_assign
id|PTR_ERR
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_ERR
c_func
(paren
id|dentry
)paren
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_sb-&gt;s_op-&gt;statfs
)paren
id|error
op_assign
id|report_statvfs
c_func
(paren
id|inode
comma
id|buf
)paren
suffix:semicolon
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|solaris_fstatvfs
id|asmlinkage
r_int
id|solaris_fstatvfs
c_func
(paren
r_int
r_int
id|fd
comma
id|u32
id|buf
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_struct
id|file
op_star
id|file
suffix:semicolon
r_int
id|error
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EBADF
suffix:semicolon
id|file
op_assign
id|fget
c_func
(paren
id|fd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dentry
op_assign
id|file-&gt;f_dentry
)paren
)paren
id|error
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|inode
op_assign
id|dentry-&gt;d_inode
)paren
)paren
id|error
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|inode-&gt;i_sb
)paren
id|error
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|inode-&gt;i_sb-&gt;s_op-&gt;statfs
)paren
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_else
id|error
op_assign
id|report_statvfs
c_func
(paren
id|inode
comma
id|buf
)paren
suffix:semicolon
id|fput
c_func
(paren
id|file
)paren
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|solaris_open
id|asmlinkage
r_int
id|solaris_open
c_func
(paren
id|u32
id|filename
comma
r_int
id|flags
comma
id|u32
id|mode
)paren
(brace
r_int
(paren
op_star
id|sys_open
)paren
(paren
r_const
r_char
op_star
comma
r_int
comma
r_int
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_const
r_char
op_star
comma
r_int
comma
r_int
)paren
)paren
id|SYS
c_func
(paren
id|open
)paren
suffix:semicolon
r_int
id|fl
op_assign
id|flags
op_amp
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
l_int|0x8050
)paren
id|fl
op_or_assign
id|O_SYNC
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
l_int|0x80
)paren
id|fl
op_or_assign
id|O_NONBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
l_int|0x100
)paren
id|fl
op_or_assign
id|O_CREAT
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
l_int|0x200
)paren
id|fl
op_or_assign
id|O_TRUNC
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
l_int|0x400
)paren
id|fl
op_or_assign
id|O_EXCL
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
l_int|0x800
)paren
id|fl
op_or_assign
id|O_NOCTTY
suffix:semicolon
r_return
id|sys_open
c_func
(paren
(paren
r_const
r_char
op_star
)paren
id|A
c_func
(paren
id|filename
)paren
comma
id|fl
comma
id|mode
)paren
suffix:semicolon
)brace
DECL|macro|SOL_F_SETLK
mdefine_line|#define SOL_F_SETLK&t;6
DECL|macro|SOL_F_SETLKW
mdefine_line|#define SOL_F_SETLKW&t;7
DECL|macro|SOL_F_FREESP
mdefine_line|#define SOL_F_FREESP    11
DECL|macro|SOL_F_ISSTREAM
mdefine_line|#define SOL_F_ISSTREAM  13
DECL|macro|SOL_F_GETLK
mdefine_line|#define SOL_F_GETLK     14
DECL|macro|SOL_F_PRIV
mdefine_line|#define SOL_F_PRIV      15
DECL|macro|SOL_F_NPRIV
mdefine_line|#define SOL_F_NPRIV     16
DECL|macro|SOL_F_QUOTACTL
mdefine_line|#define SOL_F_QUOTACTL  17
DECL|macro|SOL_F_BLOCKS
mdefine_line|#define SOL_F_BLOCKS    18
DECL|macro|SOL_F_BLKSIZE
mdefine_line|#define SOL_F_BLKSIZE   19
DECL|macro|SOL_F_GETOWN
mdefine_line|#define SOL_F_GETOWN    23
DECL|macro|SOL_F_SETOWN
mdefine_line|#define SOL_F_SETOWN    24
DECL|struct|sol_flock
r_struct
id|sol_flock
(brace
DECL|member|l_type
r_int
id|l_type
suffix:semicolon
DECL|member|l_whence
r_int
id|l_whence
suffix:semicolon
DECL|member|l_start
id|u32
id|l_start
suffix:semicolon
DECL|member|l_len
id|u32
id|l_len
suffix:semicolon
DECL|member|l_sysid
id|s32
id|l_sysid
suffix:semicolon
DECL|member|l_pid
id|s32
id|l_pid
suffix:semicolon
DECL|member|l_pad
id|s32
id|l_pad
(braket
l_int|4
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|solaris_fcntl
id|asmlinkage
r_int
id|solaris_fcntl
c_func
(paren
r_int
id|fd
comma
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_int
(paren
op_star
id|sys_fcntl
)paren
(paren
r_int
comma
r_int
comma
r_int
r_int
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
comma
r_int
comma
r_int
r_int
)paren
)paren
id|SYS
c_func
(paren
id|fcntl
)paren
suffix:semicolon
r_int
id|ret
comma
id|flags
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|F_DUPFD
suffix:colon
r_case
id|F_GETFD
suffix:colon
r_case
id|F_SETFD
suffix:colon
r_return
id|sys_fcntl
c_func
(paren
id|fd
comma
id|cmd
comma
(paren
r_int
r_int
)paren
id|arg
)paren
suffix:semicolon
r_case
id|F_GETFL
suffix:colon
id|flags
op_assign
id|sys_fcntl
c_func
(paren
id|fd
comma
id|cmd
comma
l_int|0
)paren
suffix:semicolon
id|ret
op_assign
id|flags
op_amp
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|O_SYNC
)paren
id|ret
op_or_assign
l_int|0x8050
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|O_NONBLOCK
)paren
id|ret
op_or_assign
l_int|0x80
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_case
id|F_SETFL
suffix:colon
id|flags
op_assign
id|arg
op_amp
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|arg
op_amp
l_int|0x8050
)paren
id|flags
op_or_assign
id|O_SYNC
suffix:semicolon
r_if
c_cond
(paren
id|arg
op_amp
l_int|0x80
)paren
id|flags
op_or_assign
id|O_NONBLOCK
suffix:semicolon
r_return
id|sys_fcntl
c_func
(paren
id|fd
comma
id|cmd
comma
(paren
r_int
)paren
id|flags
)paren
suffix:semicolon
r_case
id|SOL_F_GETLK
suffix:colon
r_case
id|SOL_F_SETLK
suffix:colon
r_case
id|SOL_F_SETLKW
suffix:colon
(brace
r_struct
id|flock
id|f
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SOL_F_GETLK
suffix:colon
id|cmd
op_assign
id|F_GETLK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOL_F_SETLK
suffix:colon
id|cmd
op_assign
id|F_SETLK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOL_F_SETLKW
suffix:colon
id|cmd
op_assign
id|F_SETLKW
suffix:semicolon
r_break
suffix:semicolon
)brace
id|get_user_ret
(paren
id|f.l_type
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_type
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__get_user_ret
(paren
id|f.l_whence
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_whence
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__get_user_ret
(paren
id|f.l_start
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_start
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__get_user_ret
(paren
id|f.l_len
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_len
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__get_user_ret
(paren
id|f.l_pid
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_sysid
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_fcntl
c_func
(paren
id|fd
comma
id|cmd
comma
(paren
r_int
r_int
)paren
op_amp
id|f
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
id|__put_user_ret
(paren
id|f.l_type
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_type
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__put_user_ret
(paren
id|f.l_whence
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_whence
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__put_user_ret
(paren
id|f.l_start
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_start
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__put_user_ret
(paren
id|f.l_len
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_len
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__put_user_ret
(paren
id|f.l_pid
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_pid
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__put_user_ret
(paren
l_int|0
comma
op_amp
(paren
(paren
r_struct
id|sol_flock
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|l_sysid
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|solaris_ulimit
id|asmlinkage
r_int
id|solaris_ulimit
c_func
(paren
r_int
id|cmd
comma
r_int
id|val
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* UL_GETFSIZE - in 512B chunks */
r_return
id|current-&gt;rlim
(braket
id|RLIMIT_FSIZE
)braket
dot
id|rlim_cur
op_rshift
l_int|9
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* UL_SETFSIZE */
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|val
OG
(paren
id|LONG_MAX
op_rshift
l_int|9
)paren
)paren
r_return
op_minus
id|ERANGE
suffix:semicolon
id|val
op_lshift_assign
l_int|9
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
id|current-&gt;rlim
(braket
id|RLIMIT_FSIZE
)braket
dot
id|rlim_max
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
(brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|current-&gt;rlim
(braket
id|RLIMIT_FSIZE
)braket
dot
id|rlim_max
op_assign
id|val
suffix:semicolon
)brace
id|current-&gt;rlim
(braket
id|RLIMIT_FSIZE
)braket
dot
id|rlim_cur
op_assign
id|val
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* UL_GMEMLIM */
r_return
id|current-&gt;rlim
(braket
id|RLIMIT_DATA
)braket
dot
id|rlim_cur
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* UL_GDESLIM */
r_return
id|NR_OPEN
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|chown_common
r_static
r_int
id|chown_common
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
id|uid_t
id|user
comma
id|gid_t
id|group
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|iattr
id|newattrs
suffix:semicolon
r_int
id|error
suffix:semicolon
id|error
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|inode
op_assign
id|dentry-&gt;d_inode
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chown_common: NULL inode&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|error
op_assign
op_minus
id|EROFS
suffix:semicolon
r_if
c_cond
(paren
id|IS_RDONLY
c_func
(paren
id|inode
)paren
)paren
r_goto
id|out
suffix:semicolon
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|IS_IMMUTABLE
c_func
(paren
id|inode
)paren
op_logical_or
id|IS_APPEND
c_func
(paren
id|inode
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|user
op_eq
(paren
id|uid_t
)paren
op_minus
l_int|1
)paren
id|user
op_assign
id|inode-&gt;i_uid
suffix:semicolon
r_if
c_cond
(paren
id|group
op_eq
(paren
id|gid_t
)paren
op_minus
l_int|1
)paren
id|group
op_assign
id|inode-&gt;i_gid
suffix:semicolon
id|newattrs.ia_mode
op_assign
id|inode-&gt;i_mode
suffix:semicolon
id|newattrs.ia_uid
op_assign
id|user
suffix:semicolon
id|newattrs.ia_gid
op_assign
id|group
suffix:semicolon
id|newattrs.ia_valid
op_assign
id|ATTR_UID
op_or
id|ATTR_GID
op_or
id|ATTR_CTIME
suffix:semicolon
multiline_comment|/*&n;&t; * If the owner has been changed, remove the setuid bit&n;&t; */
r_if
c_cond
(paren
id|inode-&gt;i_mode
op_amp
id|S_ISUID
)paren
(brace
id|newattrs.ia_mode
op_and_assign
op_complement
id|S_ISUID
suffix:semicolon
id|newattrs.ia_valid
op_or_assign
id|ATTR_MODE
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If the group has been changed, remove the setgid bit&n;&t; *&n;&t; * Don&squot;t remove the setgid bit if no group execute bit.&n;&t; * This is a file marked for mandatory locking.&n;&t; */
r_if
c_cond
(paren
(paren
(paren
id|inode-&gt;i_mode
op_amp
(paren
id|S_ISGID
op_or
id|S_IXGRP
)paren
)paren
op_eq
(paren
id|S_ISGID
op_or
id|S_IXGRP
)paren
)paren
)paren
(brace
id|newattrs.ia_mode
op_and_assign
op_complement
id|S_ISGID
suffix:semicolon
id|newattrs.ia_valid
op_or_assign
id|ATTR_MODE
suffix:semicolon
)brace
id|DQUOT_TRANSFER
c_func
(paren
id|dentry
comma
id|newattrs
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/* Linux chown works like Solaris lchown. Solaris chown does follow symlink */
DECL|function|solaris_chown
id|asmlinkage
r_int
id|solaris_chown
c_func
(paren
id|u32
id|filename
comma
id|s32
id|user
comma
id|s32
id|group
)paren
(brace
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_int
id|error
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|dentry
op_assign
id|namei
c_func
(paren
(paren
r_const
r_char
op_star
)paren
id|A
c_func
(paren
id|filename
)paren
)paren
suffix:semicolon
id|error
op_assign
id|PTR_ERR
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_ERR
c_func
(paren
id|dentry
)paren
)paren
(brace
id|error
op_assign
id|chown_common
c_func
(paren
id|dentry
comma
id|user
comma
id|group
)paren
suffix:semicolon
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/* At least at the time I&squot;m writing this, Linux doesn&squot;t have ACLs, so we&n;   just fake this */
DECL|function|solaris_acl
id|asmlinkage
r_int
id|solaris_acl
c_func
(paren
id|u32
id|filename
comma
r_int
id|cmd
comma
r_int
id|nentries
comma
id|u32
id|aclbufp
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|solaris_facl
id|asmlinkage
r_int
id|solaris_facl
c_func
(paren
r_int
r_int
id|fd
comma
r_int
id|cmd
comma
r_int
id|nentries
comma
id|u32
id|aclbufp
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|solaris_pread
id|asmlinkage
r_int
id|solaris_pread
c_func
(paren
r_int
id|fd
comma
id|u32
id|buf
comma
id|u32
id|nbyte
comma
id|s32
id|offset
)paren
(brace
id|off_t
id|temp
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_struct
id|file
op_star
id|file
suffix:semicolon
r_int
(paren
op_star
id|sys_read
)paren
(paren
r_int
r_int
comma
r_char
op_star
comma
r_int
r_int
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
r_char
op_star
comma
r_int
r_int
)paren
)paren
id|SYS
c_func
(paren
id|read
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_lseek
)paren
(paren
r_int
r_int
comma
id|off_t
comma
r_int
r_int
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
id|off_t
comma
r_int
r_int
)paren
)paren
id|SYS
c_func
(paren
id|lseek
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EBADF
suffix:semicolon
id|file
op_assign
id|fget
c_func
(paren
id|fd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file
)paren
r_goto
id|bad
suffix:semicolon
id|temp
op_assign
id|file-&gt;f_pos
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_ne
id|offset
)paren
(brace
id|retval
op_assign
id|sys_lseek
c_func
(paren
id|fd
comma
id|offset
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_goto
id|out_putf
suffix:semicolon
)brace
id|retval
op_assign
id|sys_read
c_func
(paren
id|fd
comma
(paren
r_char
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
comma
id|nbyte
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
op_ne
id|temp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|retval
)paren
id|retval
op_assign
id|sys_lseek
c_func
(paren
id|fd
comma
id|temp
comma
l_int|0
)paren
suffix:semicolon
r_else
id|sys_lseek
c_func
(paren
id|fd
comma
id|temp
comma
l_int|0
)paren
suffix:semicolon
)brace
id|out_putf
suffix:colon
id|fput
c_func
(paren
id|file
)paren
suffix:semicolon
id|bad
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|solaris_pwrite
id|asmlinkage
r_int
id|solaris_pwrite
c_func
(paren
r_int
id|fd
comma
id|u32
id|buf
comma
id|u32
id|nbyte
comma
id|s32
id|offset
)paren
(brace
id|off_t
id|temp
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_struct
id|file
op_star
id|file
suffix:semicolon
r_int
(paren
op_star
id|sys_write
)paren
(paren
r_int
r_int
comma
r_char
op_star
comma
r_int
r_int
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
r_char
op_star
comma
r_int
r_int
)paren
)paren
id|SYS
c_func
(paren
id|read
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_lseek
)paren
(paren
r_int
r_int
comma
id|off_t
comma
r_int
r_int
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
id|off_t
comma
r_int
r_int
)paren
)paren
id|SYS
c_func
(paren
id|lseek
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EBADF
suffix:semicolon
id|file
op_assign
id|fget
c_func
(paren
id|fd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file
)paren
r_goto
id|bad
suffix:semicolon
id|temp
op_assign
id|file-&gt;f_pos
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_ne
id|offset
)paren
(brace
id|retval
op_assign
id|sys_lseek
c_func
(paren
id|fd
comma
id|offset
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_goto
id|out_putf
suffix:semicolon
)brace
id|retval
op_assign
id|sys_write
c_func
(paren
id|fd
comma
(paren
r_char
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
comma
id|nbyte
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
op_ne
id|temp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|retval
)paren
id|retval
op_assign
id|sys_lseek
c_func
(paren
id|fd
comma
id|temp
comma
l_int|0
)paren
suffix:semicolon
r_else
id|sys_lseek
c_func
(paren
id|fd
comma
id|temp
comma
l_int|0
)paren
suffix:semicolon
)brace
id|out_putf
suffix:colon
id|fput
c_func
(paren
id|file
)paren
suffix:semicolon
id|bad
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* POSIX.1 names */
DECL|macro|_PC_LINK_MAX
mdefine_line|#define _PC_LINK_MAX    1
DECL|macro|_PC_MAX_CANON
mdefine_line|#define _PC_MAX_CANON   2
DECL|macro|_PC_MAX_INPUT
mdefine_line|#define _PC_MAX_INPUT   3
DECL|macro|_PC_NAME_MAX
mdefine_line|#define _PC_NAME_MAX    4
DECL|macro|_PC_PATH_MAX
mdefine_line|#define _PC_PATH_MAX    5
DECL|macro|_PC_PIPE_BUF
mdefine_line|#define _PC_PIPE_BUF    6
DECL|macro|_PC_NO_TRUNC
mdefine_line|#define _PC_NO_TRUNC    7
DECL|macro|_PC_VDISABLE
mdefine_line|#define _PC_VDISABLE    8
DECL|macro|_PC_CHOWN_RESTRICTED
mdefine_line|#define _PC_CHOWN_RESTRICTED    9
multiline_comment|/* POSIX.4 names */
DECL|macro|_PC_ASYNC_IO
mdefine_line|#define _PC_ASYNC_IO    10
DECL|macro|_PC_PRIO_IO
mdefine_line|#define _PC_PRIO_IO     11
DECL|macro|_PC_SYNC_IO
mdefine_line|#define _PC_SYNC_IO     12
DECL|macro|_PC_LAST
mdefine_line|#define _PC_LAST        12
multiline_comment|/* This is not a real and complete implementation yet, just to keep&n; * the easy Solaris binaries happy.&n; */
DECL|function|solaris_fpathconf
id|asmlinkage
r_int
id|solaris_fpathconf
c_func
(paren
r_int
id|fd
comma
r_int
id|name
)paren
(brace
r_int
id|ret
suffix:semicolon
r_switch
c_cond
(paren
id|name
)paren
(brace
r_case
id|_PC_LINK_MAX
suffix:colon
id|ret
op_assign
id|LINK_MAX
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_PC_MAX_CANON
suffix:colon
id|ret
op_assign
id|MAX_CANON
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_PC_MAX_INPUT
suffix:colon
id|ret
op_assign
id|MAX_INPUT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_PC_NAME_MAX
suffix:colon
id|ret
op_assign
id|NAME_MAX
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_PC_PATH_MAX
suffix:colon
id|ret
op_assign
id|PATH_MAX
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_PC_PIPE_BUF
suffix:colon
id|ret
op_assign
id|PIPE_BUF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_PC_CHOWN_RESTRICTED
suffix:colon
id|ret
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_PC_NO_TRUNC
suffix:colon
r_case
id|_PC_VDISABLE
suffix:colon
id|ret
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_pathconf
id|asmlinkage
r_int
id|solaris_pathconf
c_func
(paren
id|u32
id|path
comma
r_int
id|name
)paren
(brace
r_return
id|solaris_fpathconf
c_func
(paren
l_int|0
comma
id|name
)paren
suffix:semicolon
)brace
multiline_comment|/* solaris_llseek returns long long - quite difficult */
DECL|function|solaris_llseek
id|asmlinkage
r_int
id|solaris_llseek
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
id|u32
id|off_hi
comma
id|u32
id|off_lo
comma
r_int
id|whence
)paren
(brace
r_int
(paren
op_star
id|sys_llseek
)paren
(paren
r_int
r_int
comma
r_int
r_int
comma
r_int
r_int
comma
id|loff_t
op_star
comma
r_int
r_int
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
r_int
r_int
comma
r_int
r_int
comma
id|loff_t
op_star
comma
r_int
r_int
)paren
)paren
id|SYS
c_func
(paren
id|_llseek
)paren
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|loff_t
id|retval
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_llseek
c_func
(paren
(paren
r_int
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I0
)braket
comma
id|off_hi
comma
id|off_lo
comma
op_amp
id|retval
comma
id|whence
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|regs-&gt;u_regs
(braket
id|UREG_I1
)braket
op_assign
(paren
id|u32
)paren
id|retval
suffix:semicolon
r_return
(paren
id|retval
op_rshift
l_int|32
)paren
suffix:semicolon
)brace
multiline_comment|/* Have to mask out all but lower 3 bits */
DECL|function|solaris_access
id|asmlinkage
r_int
id|solaris_access
c_func
(paren
id|u32
id|filename
comma
r_int
id|mode
)paren
(brace
r_int
(paren
op_star
id|sys_access
)paren
(paren
r_const
r_char
op_star
comma
r_int
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_const
r_char
op_star
comma
r_int
)paren
)paren
id|SYS
c_func
(paren
id|access
)paren
suffix:semicolon
r_return
id|sys_access
c_func
(paren
(paren
r_const
r_char
op_star
)paren
id|A
c_func
(paren
id|filename
)paren
comma
id|mode
op_amp
l_int|7
)paren
suffix:semicolon
)brace
eof
