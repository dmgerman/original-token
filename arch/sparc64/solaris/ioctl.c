multiline_comment|/* $Id: ioctl.c,v 1.4 1997/09/18 10:38:24 rth Exp $&n; * ioctl.c: Solaris ioctl emulation.&n; *&n; * Copyright (C) 1997 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; *&n; * Streams &amp; timod emulation based on code&n; * Copyright (C) 1995, 1996 Mike Jagdis (jaggy@purplet.demon.co.uk)&n; *&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/ioctl.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/termios.h&gt;
macro_line|#include &quot;conv.h&quot;
r_extern
r_char
op_star
id|getname32
c_func
(paren
id|u32
id|filename
)paren
suffix:semicolon
DECL|macro|putname32
mdefine_line|#define putname32 putname
r_extern
id|asmlinkage
r_int
id|sys_ioctl
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
r_extern
id|asmlinkage
r_int
id|sys32_ioctl
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
suffix:semicolon
id|asmlinkage
r_int
id|solaris_ioctl
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
suffix:semicolon
multiline_comment|/* termio* stuff {{{ */
DECL|struct|solaris_termios
r_struct
id|solaris_termios
(brace
DECL|member|c_iflag
id|u32
id|c_iflag
suffix:semicolon
DECL|member|c_oflag
id|u32
id|c_oflag
suffix:semicolon
DECL|member|c_cflag
id|u32
id|c_cflag
suffix:semicolon
DECL|member|c_lflag
id|u32
id|c_lflag
suffix:semicolon
DECL|member|c_cc
id|u8
id|c_cc
(braket
l_int|19
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|solaris_termio
r_struct
id|solaris_termio
(brace
DECL|member|c_iflag
id|u16
id|c_iflag
suffix:semicolon
DECL|member|c_oflag
id|u16
id|c_oflag
suffix:semicolon
DECL|member|c_cflag
id|u16
id|c_cflag
suffix:semicolon
DECL|member|c_lflag
id|u16
id|c_lflag
suffix:semicolon
DECL|member|c_line
id|s8
id|c_line
suffix:semicolon
DECL|member|c_cc
id|u8
id|c_cc
(braket
l_int|8
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|solaris_termiox
r_struct
id|solaris_termiox
(brace
DECL|member|x_hflag
id|u16
id|x_hflag
suffix:semicolon
DECL|member|x_cflag
id|u16
id|x_cflag
suffix:semicolon
DECL|member|x_rflag
id|u16
id|x_rflag
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|x_sflag
id|u16
id|x_sflag
suffix:semicolon
)brace
suffix:semicolon
DECL|function|solaris_to_linux_cflag
r_static
id|u32
id|solaris_to_linux_cflag
c_func
(paren
id|u32
id|cflag
)paren
(brace
id|cflag
op_and_assign
l_int|0x7fdff000
suffix:semicolon
r_if
c_cond
(paren
id|cflag
op_amp
l_int|0x200000
)paren
(brace
r_int
id|baud
op_assign
id|cflag
op_amp
l_int|0xf
suffix:semicolon
id|cflag
op_and_assign
op_complement
l_int|0x20000f
suffix:semicolon
r_switch
c_cond
(paren
id|baud
)paren
(brace
r_case
l_int|0
suffix:colon
id|baud
op_assign
id|B57600
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|baud
op_assign
id|B76800
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|baud
op_assign
id|B115200
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|baud
op_assign
id|B153600
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|baud
op_assign
id|B230400
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|baud
op_assign
id|B307200
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|baud
op_assign
id|B460800
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cflag
op_or_assign
id|CBAUDEX
op_or
id|baud
suffix:semicolon
)brace
r_return
id|cflag
suffix:semicolon
)brace
DECL|function|linux_to_solaris_cflag
r_static
id|u32
id|linux_to_solaris_cflag
c_func
(paren
id|u32
id|cflag
)paren
(brace
id|cflag
op_and_assign
op_complement
(paren
id|CMSPAR
op_or
id|CIBAUD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cflag
op_amp
id|CBAUDEX
)paren
(brace
r_int
id|baud
op_assign
id|cflag
op_amp
id|CBAUD
suffix:semicolon
id|cflag
op_and_assign
op_complement
id|CBAUD
suffix:semicolon
r_switch
c_cond
(paren
id|baud
)paren
(brace
r_case
id|B57600
suffix:colon
id|baud
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B76800
suffix:colon
id|baud
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B115200
suffix:colon
id|baud
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B153600
suffix:colon
id|baud
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B230400
suffix:colon
id|baud
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B307200
suffix:colon
id|baud
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B460800
suffix:colon
id|baud
op_assign
l_int|6
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B614400
suffix:colon
id|baud
op_assign
l_int|7
suffix:semicolon
r_break
suffix:semicolon
r_case
id|B921600
suffix:colon
id|baud
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0&t;&t;
r_case
id|B1843200
suffix:colon
id|baud
op_assign
l_int|9
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
id|cflag
op_or_assign
l_int|0x200000
op_or
id|baud
suffix:semicolon
)brace
r_return
id|cflag
suffix:semicolon
)brace
DECL|function|linux_to_solaris_termio
r_static
r_inline
r_int
id|linux_to_solaris_termio
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|sys_ioctl
c_func
(paren
id|fd
comma
id|cmd
comma
id|A
c_func
(paren
id|arg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|u32
id|cflag
suffix:semicolon
r_if
c_cond
(paren
id|__get_user
(paren
id|cflag
comma
op_amp
(paren
(paren
r_struct
id|solaris_termio
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_cflag
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|cflag
op_assign
id|linux_to_solaris_cflag
c_func
(paren
id|cflag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__put_user
(paren
id|cflag
comma
op_amp
(paren
(paren
r_struct
id|solaris_termio
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_cflag
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_to_linux_termio
r_static
r_int
id|solaris_to_linux_termio
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|solaris_termio
id|s
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|s
comma
(paren
r_struct
id|solaris_termio
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
comma
r_sizeof
(paren
r_struct
id|solaris_termio
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|s.c_cflag
op_assign
id|solaris_to_linux_cflag
c_func
(paren
id|s.c_cflag
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_ioctl
c_func
(paren
id|fd
comma
id|cmd
comma
(paren
r_int
r_int
)paren
op_amp
id|s
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|linux_to_solaris_termios
r_static
r_inline
r_int
id|linux_to_solaris_termios
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|solaris_termios
id|s
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_ioctl
c_func
(paren
id|fd
comma
id|cmd
comma
(paren
r_int
r_int
)paren
op_amp
id|s
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_if
c_cond
(paren
id|put_user
(paren
id|s.c_iflag
comma
op_amp
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_iflag
)paren
op_logical_or
id|__put_user
(paren
id|s.c_oflag
comma
op_amp
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_oflag
)paren
op_logical_or
id|__put_user
(paren
id|linux_to_solaris_cflag
c_func
(paren
id|s.c_cflag
)paren
comma
op_amp
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_cflag
)paren
op_logical_or
id|__put_user
(paren
id|s.c_lflag
comma
op_amp
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_lflag
)paren
op_logical_or
id|__copy_to_user
(paren
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_cc
comma
id|s.c_cc
comma
l_int|16
)paren
op_logical_or
id|__clear_user
(paren
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_cc
op_plus
l_int|16
comma
l_int|2
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_to_linux_termios
r_static
r_int
id|solaris_to_linux_termios
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|solaris_termios
id|s
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_ioctl
c_func
(paren
id|fd
comma
id|TCGETS
comma
(paren
r_int
r_int
)paren
op_amp
id|s
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|put_user
(paren
id|s.c_iflag
comma
op_amp
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_iflag
)paren
op_logical_or
id|__put_user
(paren
id|s.c_oflag
comma
op_amp
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_oflag
)paren
op_logical_or
id|__put_user
(paren
id|s.c_cflag
comma
op_amp
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_cflag
)paren
op_logical_or
id|__put_user
(paren
id|s.c_lflag
comma
op_amp
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_lflag
)paren
op_logical_or
id|__copy_from_user
(paren
id|s.c_cc
comma
(paren
(paren
r_struct
id|solaris_termios
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
)paren
op_member_access_from_pointer
id|c_cc
comma
l_int|16
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|s.c_cflag
op_assign
id|solaris_to_linux_cflag
c_func
(paren
id|s.c_cflag
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_ioctl
c_func
(paren
id|fd
comma
id|cmd
comma
(paren
r_int
r_int
)paren
op_amp
id|s
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_T
r_static
r_inline
r_int
id|solaris_T
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* TCGETA */
r_return
id|linux_to_solaris_termio
c_func
(paren
id|fd
comma
id|TCGETA
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* TCSETA */
r_return
id|solaris_to_linux_termio
c_func
(paren
id|fd
comma
id|TCSETA
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* TCSETAW */
r_return
id|solaris_to_linux_termio
c_func
(paren
id|fd
comma
id|TCSETAW
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* TCSETAF */
r_return
id|solaris_to_linux_termio
c_func
(paren
id|fd
comma
id|TCSETAF
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* TCSBRK */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|TCSBRK
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|6
suffix:colon
multiline_comment|/* TCXONC */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|TCXONC
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|7
suffix:colon
multiline_comment|/* TCFLSH */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|TCFLSH
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|13
suffix:colon
multiline_comment|/* TCGETS */
r_return
id|linux_to_solaris_termios
c_func
(paren
id|fd
comma
id|TCGETS
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|14
suffix:colon
multiline_comment|/* TCSETS */
r_return
id|solaris_to_linux_termios
c_func
(paren
id|fd
comma
id|TCSETS
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|15
suffix:colon
multiline_comment|/* TCSETSW */
r_return
id|solaris_to_linux_termios
c_func
(paren
id|fd
comma
id|TCSETSW
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|16
suffix:colon
multiline_comment|/* TCSETSF */
r_return
id|solaris_to_linux_termios
c_func
(paren
id|fd
comma
id|TCSETSF
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|103
suffix:colon
multiline_comment|/* TIOCSWINSZ */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|TIOCSWINSZ
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|104
suffix:colon
multiline_comment|/* TIOCGWINSZ */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|TIOCGWINSZ
comma
id|arg
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|solaris_t
r_static
r_inline
r_int
id|solaris_t
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
l_int|20
suffix:colon
multiline_comment|/* TIOCGPGRP */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|TIOCGPGRP
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|21
suffix:colon
multiline_comment|/* TIOCSPGRP */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|TIOCSPGRP
comma
id|arg
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
multiline_comment|/* }}} */
multiline_comment|/* A pseudo STREAMS support {{{ */
DECL|struct|strioctl
r_struct
id|strioctl
(brace
DECL|member|cmd
DECL|member|timeout
DECL|member|len
r_int
id|cmd
comma
id|timeout
comma
id|len
suffix:semicolon
DECL|member|data
id|u32
id|data
suffix:semicolon
)brace
suffix:semicolon
DECL|function|solaris_S
r_static
r_inline
r_int
id|solaris_S
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_struct
id|strioctl
id|si
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* I_NREAD */
r_return
op_minus
id|ENOSYS
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* I_PUSH */
id|p
op_assign
id|getname32
(paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
(paren
id|p
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|p
)paren
suffix:semicolon
id|putname32
(paren
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* I_POP */
r_return
l_int|0
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* I_FLUSH */
r_return
l_int|0
suffix:semicolon
r_case
l_int|8
suffix:colon
multiline_comment|/* I_STR */
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|si
comma
(paren
r_struct
id|strioctl
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
comma
r_sizeof
(paren
r_struct
id|strioctl
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|si.cmd
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
(brace
r_case
l_char|&squot;T&squot;
suffix:colon
r_default
suffix:colon
r_return
id|solaris_ioctl
c_func
(paren
id|fd
comma
id|si.cmd
comma
id|si.data
)paren
suffix:semicolon
)brace
r_case
l_int|9
suffix:colon
multiline_comment|/* I_SETSIG */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|FIOSETOWN
comma
id|current-&gt;pid
)paren
suffix:semicolon
r_case
l_int|10
suffix:colon
multiline_comment|/* I_GETSIG */
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|sys_ioctl
c_func
(paren
id|fd
comma
id|FIOGETOWN
comma
(paren
r_int
r_int
)paren
op_amp
id|ret
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|current-&gt;pid
)paren
r_return
l_int|0x3ff
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
l_int|11
suffix:colon
multiline_comment|/* I_FIND */
id|p
op_assign
id|getname32
(paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
(paren
id|p
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|p
)paren
suffix:semicolon
id|ret
op_assign
op_logical_neg
id|strcmp
c_func
(paren
id|p
comma
l_string|&quot;timod&quot;
)paren
suffix:semicolon
id|putname32
(paren
id|p
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|solaris_s
r_static
r_inline
r_int
id|solaris_s
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* SIOCSHIWAT */
r_case
l_int|2
suffix:colon
multiline_comment|/* SIOCSLOWAT */
r_return
l_int|0
suffix:semicolon
multiline_comment|/* We don&squot;t support them */
r_case
l_int|1
suffix:colon
multiline_comment|/* SIOCGHIWAT */
r_case
l_int|3
suffix:colon
multiline_comment|/* SIOCGLOWAT */
id|put_user_ret
(paren
l_int|0
comma
(paren
id|u32
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Lie */
r_case
l_int|7
suffix:colon
multiline_comment|/* SIOCATMARK */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|SIOCATMARK
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|8
suffix:colon
multiline_comment|/* SIOCSPGRP */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|SIOCSPGRP
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|9
suffix:colon
multiline_comment|/* SIOCGPGRP */
r_return
id|sys_ioctl
c_func
(paren
id|fd
comma
id|SIOCGPGRP
comma
id|arg
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|solaris_r
r_static
r_inline
r_int
id|solaris_r
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
l_int|10
suffix:colon
multiline_comment|/* SIOCADDRT */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCADDRT
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|11
suffix:colon
multiline_comment|/* SIOCDELRT */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCDELRT
comma
id|arg
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|solaris_i
r_static
r_inline
r_int
id|solaris_i
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
op_amp
l_int|0xff
)paren
(brace
r_case
l_int|12
suffix:colon
multiline_comment|/* SIOCSIFADDR */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFADDR
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|13
suffix:colon
multiline_comment|/* SIOCGIFADDR */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFADDR
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|14
suffix:colon
multiline_comment|/* SIOCSIFDSTADDR */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFDSTADDR
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|15
suffix:colon
multiline_comment|/* SIOCGIFDSTADDR */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFDSTADDR
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|16
suffix:colon
multiline_comment|/* SIOCSIFFLAGS */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFFLAGS
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|17
suffix:colon
multiline_comment|/* SIOCGIFFLAGS */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFFLAGS
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|18
suffix:colon
multiline_comment|/* SIOCSIFMEM */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFMEM
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|19
suffix:colon
multiline_comment|/* SIOCGIFMEM */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFMEM
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|20
suffix:colon
multiline_comment|/* SIOCGIFCONF */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFCONF
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|21
suffix:colon
multiline_comment|/* SIOCSIFMTU */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFMTU
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|22
suffix:colon
multiline_comment|/* SIOCGIFMTU */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFMTU
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|23
suffix:colon
multiline_comment|/* SIOCGIFBRDADDR */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFBRDADDR
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|24
suffix:colon
multiline_comment|/* SIOCSIFBRDADDR */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFBRDADDR
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|25
suffix:colon
multiline_comment|/* SIOCGIFNETMASK */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFNETMASK
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|26
suffix:colon
multiline_comment|/* SIOCSIFNETMASK */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFNETMASK
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|27
suffix:colon
multiline_comment|/* SIOCGIFMETRIC */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFMETRIC
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|28
suffix:colon
multiline_comment|/* SIOCSIFMETRIC */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFMETRIC
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|30
suffix:colon
multiline_comment|/* SIOCSARP */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSARP
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|31
suffix:colon
multiline_comment|/* SIOCGARP */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGARP
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|32
suffix:colon
multiline_comment|/* SIOCDARP */
r_return
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCDARP
comma
id|arg
)paren
suffix:semicolon
r_case
l_int|52
suffix:colon
multiline_comment|/* SIOCGETNAME */
r_case
l_int|53
suffix:colon
multiline_comment|/* SIOCGETPEER */
(brace
r_struct
id|sockaddr
id|uaddr
suffix:semicolon
r_int
id|uaddr_len
op_assign
r_sizeof
(paren
r_struct
id|sockaddr
)paren
comma
id|ret
suffix:semicolon
r_int
id|args
(braket
l_int|3
)braket
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_socketcall
)paren
(paren
r_int
comma
r_int
r_int
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
comma
r_int
r_int
op_star
)paren
)paren
id|SYS
c_func
(paren
id|socketcall
)paren
suffix:semicolon
id|args
(braket
l_int|0
)braket
op_assign
id|fd
suffix:semicolon
id|args
(braket
l_int|1
)braket
op_assign
(paren
r_int
)paren
op_amp
id|uaddr
suffix:semicolon
id|args
(braket
l_int|2
)braket
op_assign
(paren
r_int
)paren
op_amp
id|uaddr_len
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_socketcall
c_func
(paren
(paren
(paren
id|cmd
op_amp
l_int|0xff
)paren
op_eq
l_int|52
)paren
ques
c_cond
id|SYS_GETSOCKNAME
suffix:colon
id|SYS_GETPEERNAME
comma
id|args
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ge
l_int|0
)paren
id|copy_to_user_ret
c_func
(paren
(paren
r_char
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
comma
op_amp
id|uaddr
comma
id|uaddr_len
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
macro_line|#if 0&t;&t;
r_case
l_int|86
suffix:colon
multiline_comment|/* SIOCSOCKSYS */
r_return
id|socksys_syscall
c_func
(paren
id|fd
comma
id|arg
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_case
l_int|87
suffix:colon
multiline_comment|/* SIOCGIFNUM */
(brace
r_struct
id|device
op_star
id|d
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|d
op_assign
id|dev_base
suffix:semicolon
id|d
suffix:semicolon
id|d
op_assign
id|d-&gt;next
)paren
id|i
op_increment
suffix:semicolon
id|put_user_ret
(paren
id|i
comma
(paren
r_int
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
multiline_comment|/* }}} */
DECL|function|solaris_ioctl
id|asmlinkage
r_int
id|solaris_ioctl
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_struct
id|file
op_star
id|filp
suffix:semicolon
r_int
id|error
op_assign
op_minus
id|EBADF
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fd
op_ge
id|NR_OPEN
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|filp
op_assign
id|current-&gt;files-&gt;fd
(braket
id|fd
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|filp
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|error
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|cmd
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
(brace
r_case
l_char|&squot;S&squot;
suffix:colon
id|error
op_assign
id|solaris_S
c_func
(paren
id|fd
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;T&squot;
suffix:colon
id|error
op_assign
id|solaris_T
c_func
(paren
id|fd
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;i&squot;
suffix:colon
id|error
op_assign
id|solaris_i
c_func
(paren
id|fd
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;r&squot;
suffix:colon
id|error
op_assign
id|solaris_r
c_func
(paren
id|fd
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;s&squot;
suffix:colon
id|error
op_assign
id|solaris_s
c_func
(paren
id|fd
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;t&squot;
suffix:colon
id|error
op_assign
id|solaris_t
c_func
(paren
id|fd
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|error
op_eq
op_minus
id|ENOSYS
)paren
(brace
r_int
r_char
id|c
op_assign
id|cmd
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|c
template_param
l_int|126
)paren
id|c
op_assign
l_char|&squot;.&squot;
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;solaris_ioctl: Unknown cmd fd(%d) cmd(%08x &squot;%c&squot;) arg(%08x)&bslash;n&quot;
comma
(paren
r_int
)paren
id|fd
comma
(paren
r_int
r_int
)paren
id|cmd
comma
id|c
comma
(paren
r_int
r_int
)paren
id|arg
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
eof
