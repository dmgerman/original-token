multiline_comment|/* $Id: misc.c,v 1.6 1997/12/14 23:40:15 ecd Exp $&n; * misc.c: Miscelaneous syscall emulation for Solaris&n; *&n; * Copyright (C) 1997 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; */
macro_line|#include &lt;linux/module.h&gt; 
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/utsname.h&gt;
macro_line|#include &lt;linux/limits.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/string.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/idprom.h&gt;
macro_line|#include &lt;asm/machines.h&gt;
macro_line|#include &quot;conv.h&quot;
multiline_comment|/* Conversion from Linux to Solaris errnos. 0-34 are identity mapped.&n;   Some Linux errnos (EPROCLIM, EDOTDOT, ERREMOTE, EUCLEAN, ENOTNAM, &n;   ENAVAIL, EISNAM, EREMOTEIO, ENOMEDIUM, EMEDIUMTYPE) have no Solaris&n;   equivalents. I return EINVAL in that case, which is very wrong. If&n;   someone suggest a better value for them, you&squot;re welcomed.&n;   On the other side, Solaris ECANCELED and ENOTSUP have no Linux equivalents,&n;   but that doesn&squot;t matter here. --jj */
DECL|variable|solaris_err_table
r_int
id|solaris_err_table
(braket
)braket
op_assign
(brace
multiline_comment|/* 0 */
l_int|0
comma
l_int|1
comma
l_int|2
comma
l_int|3
comma
l_int|4
comma
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|8
comma
l_int|9
comma
multiline_comment|/* 10 */
l_int|10
comma
l_int|11
comma
l_int|12
comma
l_int|13
comma
l_int|14
comma
l_int|15
comma
l_int|16
comma
l_int|17
comma
l_int|18
comma
l_int|19
comma
multiline_comment|/* 20 */
l_int|20
comma
l_int|21
comma
l_int|22
comma
l_int|23
comma
l_int|24
comma
l_int|25
comma
l_int|26
comma
l_int|27
comma
l_int|28
comma
l_int|29
comma
multiline_comment|/* 30 */
l_int|30
comma
l_int|31
comma
l_int|32
comma
l_int|33
comma
l_int|34
comma
l_int|22
comma
l_int|150
comma
l_int|149
comma
l_int|95
comma
l_int|96
comma
multiline_comment|/* 40 */
l_int|97
comma
l_int|98
comma
l_int|99
comma
l_int|120
comma
l_int|121
comma
l_int|122
comma
l_int|123
comma
l_int|124
comma
l_int|125
comma
l_int|126
comma
multiline_comment|/* 50 */
l_int|127
comma
l_int|128
comma
l_int|129
comma
l_int|130
comma
l_int|131
comma
l_int|132
comma
l_int|133
comma
l_int|134
comma
l_int|143
comma
l_int|144
comma
multiline_comment|/* 60 */
l_int|145
comma
l_int|146
comma
l_int|90
comma
l_int|78
comma
l_int|147
comma
l_int|148
comma
l_int|93
comma
l_int|22
comma
l_int|94
comma
l_int|49
comma
multiline_comment|/* 70 */
l_int|151
comma
l_int|66
comma
l_int|60
comma
l_int|62
comma
l_int|63
comma
l_int|35
comma
l_int|77
comma
l_int|36
comma
l_int|45
comma
l_int|46
comma
multiline_comment|/* 80 */
l_int|64
comma
l_int|22
comma
l_int|67
comma
l_int|68
comma
l_int|69
comma
l_int|70
comma
l_int|71
comma
l_int|74
comma
l_int|22
comma
l_int|82
comma
multiline_comment|/* 90 */
l_int|89
comma
l_int|92
comma
l_int|79
comma
l_int|81
comma
l_int|37
comma
l_int|38
comma
l_int|39
comma
l_int|40
comma
l_int|41
comma
l_int|42
comma
multiline_comment|/* 100 */
l_int|43
comma
l_int|44
comma
l_int|50
comma
l_int|51
comma
l_int|52
comma
l_int|53
comma
l_int|54
comma
l_int|55
comma
l_int|56
comma
l_int|57
comma
multiline_comment|/* 110 */
l_int|87
comma
l_int|61
comma
l_int|84
comma
l_int|65
comma
l_int|83
comma
l_int|80
comma
l_int|91
comma
l_int|22
comma
l_int|22
comma
l_int|22
comma
multiline_comment|/* 120 */
l_int|22
comma
l_int|22
comma
l_int|88
comma
l_int|86
comma
l_int|85
comma
l_int|22
comma
l_int|22
comma
)brace
suffix:semicolon
DECL|function|solaris_mmap
id|asmlinkage
id|u32
id|solaris_mmap
c_func
(paren
id|u32
id|addr
comma
id|u32
id|len
comma
id|u32
id|prot
comma
id|u32
id|flags
comma
id|u32
id|fd
comma
id|u32
id|off
)paren
(brace
id|u32
(paren
op_star
id|sunos_mmap
)paren
(paren
id|u32
comma
id|u32
comma
id|u32
comma
id|u32
comma
id|u32
comma
id|u32
)paren
op_assign
(paren
id|u32
(paren
op_star
)paren
(paren
id|u32
comma
id|u32
comma
id|u32
comma
id|u32
comma
id|u32
comma
id|u32
)paren
)paren
id|SUNOS
c_func
(paren
l_int|71
)paren
suffix:semicolon
id|u32
id|ret
suffix:semicolon
id|ret
op_assign
id|sunos_mmap
c_func
(paren
id|addr
comma
id|len
comma
id|prot
comma
id|flags
comma
id|fd
comma
id|off
)paren
suffix:semicolon
multiline_comment|/* sunos_mmap sets personality to PER_BSD */
id|current-&gt;personality
op_assign
id|PER_SVR4
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_brk
id|asmlinkage
r_int
id|solaris_brk
c_func
(paren
id|u32
id|brk
)paren
(brace
r_int
(paren
op_star
id|sunos_brk
)paren
(paren
id|u32
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|u32
)paren
)paren
id|SUNOS
c_func
(paren
l_int|17
)paren
suffix:semicolon
r_return
id|sunos_brk
c_func
(paren
id|brk
)paren
suffix:semicolon
)brace
DECL|macro|set_utsfield
mdefine_line|#define set_utsfield(to, from, dotchop, countfrom) {&t;&t;&t;&bslash;&n;&t;char *p; &t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int i, len = (countfrom) ? &t;&t;&t;&t;&t;&bslash;&n;&t;&t;((sizeof(to) &gt; sizeof(from) ? &t;&t;&t;&t;&bslash;&n;&t;&t;&t;sizeof(from) : sizeof(to))) : sizeof(to); &t;&bslash;&n;&t;copy_to_user_ret(to, from, len, -EFAULT); &t;&t;&t;&bslash;&n;&t;if (dotchop) &t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;for (p=from,i=0; *p &amp;&amp; *p != &squot;.&squot; &amp;&amp; --len; p++,i++); &t;&bslash;&n;&t;else &t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i = len - 1; &t;&t;&t;&t;&t;&t;&bslash;&n;&t;__put_user_ret(&squot;&bslash;0&squot;, (char *)(to+i), -EFAULT); &t;&t;&t;&bslash;&n;}
DECL|struct|sol_uname
r_struct
id|sol_uname
(brace
DECL|member|sysname
r_char
id|sysname
(braket
l_int|9
)braket
suffix:semicolon
DECL|member|nodename
r_char
id|nodename
(braket
l_int|9
)braket
suffix:semicolon
DECL|member|release
r_char
id|release
(braket
l_int|9
)braket
suffix:semicolon
DECL|member|version
r_char
id|version
(braket
l_int|9
)braket
suffix:semicolon
DECL|member|machine
r_char
id|machine
(braket
l_int|9
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sol_utsname
r_struct
id|sol_utsname
(brace
DECL|member|sysname
r_char
id|sysname
(braket
l_int|257
)braket
suffix:semicolon
DECL|member|nodename
r_char
id|nodename
(braket
l_int|257
)braket
suffix:semicolon
DECL|member|release
r_char
id|release
(braket
l_int|257
)braket
suffix:semicolon
DECL|member|version
r_char
id|version
(braket
l_int|257
)braket
suffix:semicolon
DECL|member|machine
r_char
id|machine
(braket
l_int|257
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|machine
r_static
r_char
op_star
id|machine
c_func
(paren
r_void
)paren
(brace
r_switch
c_cond
(paren
id|sparc_cpu_model
)paren
(brace
r_case
id|sun4
suffix:colon
r_return
l_string|&quot;sun4&quot;
suffix:semicolon
r_case
id|sun4c
suffix:colon
r_return
l_string|&quot;sun4c&quot;
suffix:semicolon
r_case
id|sun4e
suffix:colon
r_return
l_string|&quot;sun4e&quot;
suffix:semicolon
r_case
id|sun4m
suffix:colon
r_return
l_string|&quot;sun4m&quot;
suffix:semicolon
r_case
id|sun4d
suffix:colon
r_return
l_string|&quot;sun4d&quot;
suffix:semicolon
r_case
id|sun4u
suffix:colon
r_return
l_string|&quot;sun4u&quot;
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;sparc&quot;
suffix:semicolon
)brace
)brace
DECL|function|platform
r_static
r_char
op_star
id|platform
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
(brace
r_char
op_star
id|platform
suffix:semicolon
r_int
id|id_machtype
suffix:semicolon
)brace
id|platforms
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;sun4&quot;
comma
(paren
id|SM_SUN4
op_or
id|SM_4_110
)paren
)brace
comma
(brace
l_string|&quot;sun4&quot;
comma
(paren
id|SM_SUN4
op_or
id|SM_4_260
)paren
)brace
comma
(brace
l_string|&quot;sun4&quot;
comma
(paren
id|SM_SUN4
op_or
id|SM_4_330
)paren
)brace
comma
(brace
l_string|&quot;sun4&quot;
comma
(paren
id|SM_SUN4
op_or
id|SM_4_470
)paren
)brace
comma
(brace
l_string|&quot;SUNW,Sun_4_60&quot;
comma
(paren
id|SM_SUN4C
op_or
id|SM_4C_SS1
)paren
)brace
comma
(brace
l_string|&quot;SUNW,Sun_4_40&quot;
comma
(paren
id|SM_SUN4C
op_or
id|SM_4C_IPC
)paren
)brace
comma
(brace
l_string|&quot;SUNW,Sun_4_65&quot;
comma
(paren
id|SM_SUN4C
op_or
id|SM_4C_SS1PLUS
)paren
)brace
comma
(brace
l_string|&quot;SUNW,Sun_4_20&quot;
comma
(paren
id|SM_SUN4C
op_or
id|SM_4C_SLC
)paren
)brace
comma
(brace
l_string|&quot;SUNW,Sun_4_75&quot;
comma
(paren
id|SM_SUN4C
op_or
id|SM_4C_SS2
)paren
)brace
comma
(brace
l_string|&quot;SUNW,Sun_4_25&quot;
comma
(paren
id|SM_SUN4C
op_or
id|SM_4C_ELC
)paren
)brace
comma
(brace
l_string|&quot;SUNW,Sun_4_50&quot;
comma
(paren
id|SM_SUN4C
op_or
id|SM_4C_IPX
)paren
)brace
comma
(brace
l_string|&quot;SUNW,Sun_4_600&quot;
comma
(paren
id|SM_SUN4M
op_or
id|SM_4M_SS60
)paren
)brace
comma
(brace
l_string|&quot;SUNW,SPARCstation-5&quot;
comma
(paren
id|SM_SUN4M
op_or
id|SM_4M_SS50
)paren
)brace
comma
(brace
l_string|&quot;SUNW,SPARCstation-20&quot;
comma
(paren
id|SM_SUN4M
op_or
id|SM_4M_SS40
)paren
)brace
)brace
suffix:semicolon
op_star
id|buffer
op_assign
l_int|0
suffix:semicolon
id|prom_getproperty
c_func
(paren
id|prom_root_node
comma
l_string|&quot;name&quot;
comma
id|buffer
comma
l_int|256
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|buffer
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|buffer
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_increment
)paren
r_if
c_cond
(paren
op_star
id|p
op_eq
l_char|&squot;/&squot;
op_logical_or
op_star
id|p
op_eq
l_char|&squot; &squot;
)paren
op_star
id|p
op_assign
l_char|&squot;_&squot;
suffix:semicolon
r_return
id|buffer
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|platforms
)paren
op_div
r_sizeof
(paren
id|platforms
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|platforms
(braket
id|i
)braket
dot
id|id_machtype
op_eq
id|idprom-&gt;id_machtype
)paren
r_return
id|platforms
(braket
id|i
)braket
dot
id|platform
suffix:semicolon
r_return
l_string|&quot;sun4c&quot;
suffix:semicolon
)brace
DECL|function|serial
r_static
r_char
op_star
id|serial
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_int
id|node
op_assign
id|prom_getchild
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
id|node
op_assign
id|prom_searchsiblings
c_func
(paren
id|node
comma
l_string|&quot;options&quot;
)paren
suffix:semicolon
op_star
id|buffer
op_assign
l_int|0
suffix:semicolon
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;system-board-serial#&quot;
comma
id|buffer
comma
l_int|256
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|buffer
)paren
r_return
l_string|&quot;4512348717234&quot;
suffix:semicolon
r_else
r_return
id|buffer
suffix:semicolon
)brace
DECL|function|solaris_utssys
id|asmlinkage
r_int
id|solaris_utssys
c_func
(paren
id|u32
id|buf
comma
id|u32
id|flags
comma
r_int
id|which
comma
id|u32
id|buf2
)paren
(brace
r_switch
c_cond
(paren
id|which
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* old uname */
multiline_comment|/* Lets cheat */
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_uname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|sysname
comma
l_string|&quot;SunOS&quot;
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_uname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|nodename
comma
id|system_utsname.nodename
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_uname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|release
comma
l_string|&quot;2.6&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_uname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|version
comma
l_string|&quot;Generic&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_uname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|machine
comma
id|machine
c_func
(paren
)paren
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* ustat */
r_return
op_minus
id|ENOSYS
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* fusers */
r_return
op_minus
id|ENOSYS
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|solaris_utsname
id|asmlinkage
r_int
id|solaris_utsname
c_func
(paren
id|u32
id|buf
)paren
(brace
multiline_comment|/* Why should we not lie a bit? */
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_utsname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|sysname
comma
l_string|&quot;SunOS&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_utsname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|nodename
comma
id|system_utsname.nodename
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_utsname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|release
comma
l_string|&quot;5.6&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_utsname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|version
comma
l_string|&quot;Generic&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_utsname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|machine
comma
id|machine
c_func
(paren
)paren
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|SI_SYSNAME
mdefine_line|#define SI_SYSNAME&t;&t;1       /* return name of operating system */
DECL|macro|SI_HOSTNAME
mdefine_line|#define SI_HOSTNAME&t;&t;2       /* return name of node */
DECL|macro|SI_RELEASE
mdefine_line|#define SI_RELEASE&t;&t;3       /* return release of operating system */
DECL|macro|SI_VERSION
mdefine_line|#define SI_VERSION&t;&t;4       /* return version field of utsname */
DECL|macro|SI_MACHINE
mdefine_line|#define SI_MACHINE&t;&t;5       /* return kind of machine */
DECL|macro|SI_ARCHITECTURE
mdefine_line|#define SI_ARCHITECTURE&t;&t;6       /* return instruction set arch */
DECL|macro|SI_HW_SERIAL
mdefine_line|#define SI_HW_SERIAL&t;&t;7       /* return hardware serial number */
DECL|macro|SI_HW_PROVIDER
mdefine_line|#define SI_HW_PROVIDER&t;&t;8       /* return hardware manufacturer */
DECL|macro|SI_SRPC_DOMAIN
mdefine_line|#define SI_SRPC_DOMAIN&t;&t;9       /* return secure RPC domain */
DECL|macro|SI_PLATFORM
mdefine_line|#define SI_PLATFORM&t;&t;513     /* return platform identifier */
DECL|function|solaris_sysinfo
id|asmlinkage
r_int
id|solaris_sysinfo
c_func
(paren
r_int
id|cmd
comma
id|u32
id|buf
comma
id|s32
id|count
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
comma
op_star
id|r
suffix:semicolon
r_char
id|buffer
(braket
l_int|256
)braket
suffix:semicolon
r_int
id|len
suffix:semicolon
multiline_comment|/* Again, we cheat :)) */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SI_SYSNAME
suffix:colon
id|r
op_assign
l_string|&quot;SunOS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_HOSTNAME
suffix:colon
id|r
op_assign
id|buffer
op_plus
l_int|256
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|system_utsname.nodename
comma
id|q
op_assign
id|buffer
suffix:semicolon
id|q
OL
id|r
op_logical_and
op_star
id|p
op_logical_and
op_star
id|p
op_ne
l_char|&squot;.&squot;
suffix:semicolon
op_star
id|q
op_increment
op_assign
op_star
id|p
op_increment
)paren
suffix:semicolon
op_star
id|q
op_assign
l_int|0
suffix:semicolon
id|r
op_assign
id|buffer
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_RELEASE
suffix:colon
id|r
op_assign
l_string|&quot;5.6&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_MACHINE
suffix:colon
id|r
op_assign
id|machine
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_ARCHITECTURE
suffix:colon
id|r
op_assign
l_string|&quot;sparc&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_HW_PROVIDER
suffix:colon
id|r
op_assign
l_string|&quot;Sun_Microsystems&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_HW_SERIAL
suffix:colon
id|r
op_assign
id|serial
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_PLATFORM
suffix:colon
id|r
op_assign
id|platform
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_SRPC_DOMAIN
suffix:colon
id|r
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_VERSION
suffix:colon
id|r
op_assign
l_string|&quot;Generic&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|len
op_assign
id|strlen
c_func
(paren
id|r
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|len
)paren
(brace
id|copy_to_user_ret
c_func
(paren
(paren
r_char
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
comma
id|r
comma
id|count
op_minus
l_int|1
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
id|__put_user_ret
c_func
(paren
l_int|0
comma
(paren
r_char
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
op_plus
id|count
op_minus
l_int|1
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
)brace
r_else
id|copy_to_user_ret
c_func
(paren
(paren
r_char
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
comma
id|r
comma
id|len
comma
op_minus
id|EFAULT
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|macro|SOLARIS_CONFIG_NGROUPS
mdefine_line|#define&t;SOLARIS_CONFIG_NGROUPS&t;&t;&t;2
DECL|macro|SOLARIS_CONFIG_CHILD_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_CHILD_MAX&t;&t;3
DECL|macro|SOLARIS_CONFIG_OPEN_FILES
mdefine_line|#define&t;SOLARIS_CONFIG_OPEN_FILES&t;&t;4
DECL|macro|SOLARIS_CONFIG_POSIX_VER
mdefine_line|#define&t;SOLARIS_CONFIG_POSIX_VER&t;&t;5
DECL|macro|SOLARIS_CONFIG_PAGESIZE
mdefine_line|#define&t;SOLARIS_CONFIG_PAGESIZE&t;&t;&t;6
DECL|macro|SOLARIS_CONFIG_CLK_TCK
mdefine_line|#define&t;SOLARIS_CONFIG_CLK_TCK&t;&t;&t;7
DECL|macro|SOLARIS_CONFIG_XOPEN_VER
mdefine_line|#define&t;SOLARIS_CONFIG_XOPEN_VER&t;&t;8
DECL|macro|SOLARIS_CONFIG_PROF_TCK
mdefine_line|#define&t;SOLARIS_CONFIG_PROF_TCK&t;&t;&t;10
DECL|macro|SOLARIS_CONFIG_NPROC_CONF
mdefine_line|#define&t;SOLARIS_CONFIG_NPROC_CONF&t;&t;11
DECL|macro|SOLARIS_CONFIG_NPROC_ONLN
mdefine_line|#define&t;SOLARIS_CONFIG_NPROC_ONLN&t;&t;12
DECL|macro|SOLARIS_CONFIG_AIO_LISTIO_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_AIO_LISTIO_MAX&t;&t;13
DECL|macro|SOLARIS_CONFIG_AIO_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_AIO_MAX&t;&t;&t;14
DECL|macro|SOLARIS_CONFIG_AIO_PRIO_DELTA_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_AIO_PRIO_DELTA_MAX&t;15
DECL|macro|SOLARIS_CONFIG_DELAYTIMER_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_DELAYTIMER_MAX&t;&t;16
DECL|macro|SOLARIS_CONFIG_MQ_OPEN_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_MQ_OPEN_MAX&t;&t;17
DECL|macro|SOLARIS_CONFIG_MQ_PRIO_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_MQ_PRIO_MAX&t;&t;18
DECL|macro|SOLARIS_CONFIG_RTSIG_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_RTSIG_MAX&t;&t;19
DECL|macro|SOLARIS_CONFIG_SEM_NSEMS_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_SEM_NSEMS_MAX&t;&t;20
DECL|macro|SOLARIS_CONFIG_SEM_VALUE_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_SEM_VALUE_MAX&t;&t;21
DECL|macro|SOLARIS_CONFIG_SIGQUEUE_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_SIGQUEUE_MAX&t;&t;22
DECL|macro|SOLARIS_CONFIG_SIGRT_MIN
mdefine_line|#define&t;SOLARIS_CONFIG_SIGRT_MIN&t;&t;23
DECL|macro|SOLARIS_CONFIG_SIGRT_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_SIGRT_MAX&t;&t;24
DECL|macro|SOLARIS_CONFIG_TIMER_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_TIMER_MAX&t;&t;25
DECL|macro|SOLARIS_CONFIG_PHYS_PAGES
mdefine_line|#define&t;SOLARIS_CONFIG_PHYS_PAGES&t;&t;26
DECL|macro|SOLARIS_CONFIG_AVPHYS_PAGES
mdefine_line|#define&t;SOLARIS_CONFIG_AVPHYS_PAGES&t;&t;27
DECL|function|solaris_sysconf
id|asmlinkage
r_int
id|solaris_sysconf
c_func
(paren
r_int
id|id
)paren
(brace
r_switch
c_cond
(paren
id|id
)paren
(brace
r_case
id|SOLARIS_CONFIG_NGROUPS
suffix:colon
r_return
id|NGROUPS_MAX
suffix:semicolon
r_case
id|SOLARIS_CONFIG_CHILD_MAX
suffix:colon
r_return
id|CHILD_MAX
suffix:semicolon
r_case
id|SOLARIS_CONFIG_OPEN_FILES
suffix:colon
r_return
id|OPEN_MAX
suffix:semicolon
r_case
id|SOLARIS_CONFIG_POSIX_VER
suffix:colon
r_return
l_int|199309
suffix:semicolon
r_case
id|SOLARIS_CONFIG_PAGESIZE
suffix:colon
r_return
id|PAGE_SIZE
suffix:semicolon
r_case
id|SOLARIS_CONFIG_XOPEN_VER
suffix:colon
r_return
l_int|3
suffix:semicolon
r_case
id|SOLARIS_CONFIG_CLK_TCK
suffix:colon
r_case
id|SOLARIS_CONFIG_PROF_TCK
suffix:colon
r_return
id|prom_getintdefault
c_func
(paren
id|linux_cpus
(braket
id|smp_processor_id
c_func
(paren
)paren
)braket
dot
id|prom_node
comma
l_string|&quot;clock-frequency&quot;
comma
l_int|167000000
)paren
suffix:semicolon
macro_line|#ifdef __SMP__&t;
r_case
id|SOLARIS_CONFIG_NPROC_CONF
suffix:colon
r_return
id|NR_CPUS
suffix:semicolon
r_case
id|SOLARIS_CONFIG_NPROC_ONLN
suffix:colon
r_return
id|smp_num_cpus
suffix:semicolon
macro_line|#else
r_case
id|SOLARIS_CONFIG_NPROC_CONF
suffix:colon
r_return
l_int|1
suffix:semicolon
r_case
id|SOLARIS_CONFIG_NPROC_ONLN
suffix:colon
r_return
l_int|1
suffix:semicolon
macro_line|#endif
r_case
id|SOLARIS_CONFIG_SIGRT_MIN
suffix:colon
r_return
l_int|37
suffix:semicolon
r_case
id|SOLARIS_CONFIG_SIGRT_MAX
suffix:colon
r_return
l_int|44
suffix:semicolon
r_case
id|SOLARIS_CONFIG_PHYS_PAGES
suffix:colon
r_case
id|SOLARIS_CONFIG_AVPHYS_PAGES
suffix:colon
(brace
r_struct
id|sysinfo
id|s
suffix:semicolon
id|si_meminfo
c_func
(paren
op_amp
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|SOLARIS_CONFIG_PHYS_PAGES
)paren
r_return
id|s.totalram
op_rshift_assign
id|PAGE_SHIFT
suffix:semicolon
r_else
r_return
id|s.freeram
op_rshift_assign
id|PAGE_SHIFT
suffix:semicolon
)brace
multiline_comment|/* XXX support these as well -jj */
r_case
id|SOLARIS_CONFIG_AIO_LISTIO_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_AIO_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_AIO_PRIO_DELTA_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_DELAYTIMER_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_MQ_OPEN_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_MQ_PRIO_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_RTSIG_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_SEM_NSEMS_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_SEM_VALUE_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_SIGQUEUE_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_TIMER_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|function|solaris_procids
id|asmlinkage
r_int
id|solaris_procids
c_func
(paren
r_int
id|cmd
comma
id|s32
id|pid
comma
id|s32
id|pgid
)paren
(brace
r_int
id|ret
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* getpgrp */
r_return
id|current-&gt;pgrp
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* setpgrp */
(brace
r_int
(paren
op_star
id|sys_setpgid
)paren
(paren
id|pid_t
comma
id|pid_t
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|pid_t
comma
id|pid_t
)paren
)paren
id|SYS
c_func
(paren
id|setpgid
)paren
suffix:semicolon
multiline_comment|/* can anyone explain me the difference between&n;&t;&t;&t;   Solaris setpgrp and setsid? */
id|ret
op_assign
id|sys_setpgid
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|current-&gt;tty
op_assign
l_int|NULL
suffix:semicolon
r_return
id|current-&gt;pgrp
suffix:semicolon
)brace
r_case
l_int|2
suffix:colon
multiline_comment|/* getsid */
(brace
r_int
(paren
op_star
id|sys_getsid
)paren
(paren
id|pid_t
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|pid_t
)paren
)paren
id|SYS
c_func
(paren
id|getsid
)paren
suffix:semicolon
r_return
id|sys_getsid
c_func
(paren
id|pid
)paren
suffix:semicolon
)brace
r_case
l_int|3
suffix:colon
multiline_comment|/* setsid */
(brace
r_int
(paren
op_star
id|sys_setsid
)paren
(paren
r_void
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_void
)paren
)paren
id|SYS
c_func
(paren
id|setsid
)paren
suffix:semicolon
r_return
id|sys_setsid
c_func
(paren
)paren
suffix:semicolon
)brace
r_case
l_int|4
suffix:colon
multiline_comment|/* getpgid */
(brace
r_int
(paren
op_star
id|sys_getpgid
)paren
(paren
id|pid_t
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|pid_t
)paren
)paren
id|SYS
c_func
(paren
id|getpgid
)paren
suffix:semicolon
r_return
id|sys_getpgid
c_func
(paren
id|pid
)paren
suffix:semicolon
)brace
r_case
l_int|5
suffix:colon
multiline_comment|/* setpgid */
(brace
r_int
(paren
op_star
id|sys_setpgid
)paren
(paren
id|pid_t
comma
id|pid_t
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|pid_t
comma
id|pid_t
)paren
)paren
id|SYS
c_func
(paren
id|setpgid
)paren
suffix:semicolon
r_return
id|sys_setpgid
c_func
(paren
id|pid
comma
id|pgid
)paren
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|do_sol_unimplemented
id|asmlinkage
r_int
id|do_sol_unimplemented
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
(paren
l_string|&quot;Unimplemented Solaris syscall %d %08x %08x %08x %08x&bslash;n&quot;
comma
(paren
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_G1
)braket
comma
(paren
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I0
)braket
comma
(paren
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I1
)braket
comma
(paren
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I2
)braket
comma
(paren
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I3
)braket
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|solaris_register
id|asmlinkage
r_void
id|solaris_register
c_func
(paren
r_void
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|current-&gt;personality
op_assign
id|PER_SVR4
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;exec_domain
op_logical_and
id|current-&gt;exec_domain-&gt;module
)paren
id|__MOD_DEC_USE_COUNT
c_func
(paren
id|current-&gt;exec_domain-&gt;module
)paren
suffix:semicolon
id|current-&gt;exec_domain
op_assign
id|lookup_exec_domain
c_func
(paren
id|current-&gt;personality
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;exec_domain
op_logical_and
id|current-&gt;exec_domain-&gt;module
)paren
id|__MOD_INC_USE_COUNT
c_func
(paren
id|current-&gt;exec_domain-&gt;module
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
r_extern
r_int
id|solaris_to_linux_signals
(braket
)braket
comma
id|linux_to_solaris_signals
(braket
)braket
suffix:semicolon
DECL|variable|solaris_exec_domain
r_struct
id|exec_domain
id|solaris_exec_domain
op_assign
(brace
l_string|&quot;Solaris&quot;
comma
(paren
id|lcall7_func
)paren
l_int|NULL
comma
l_int|1
comma
l_int|1
comma
multiline_comment|/* PER_SVR4 personality */
id|solaris_to_linux_signals
comma
id|linux_to_solaris_signals
comma
macro_line|#ifdef MODULE
op_amp
id|__this_module
comma
macro_line|#else
l_int|NULL
comma
macro_line|#endif
l_int|NULL
)brace
suffix:semicolon
macro_line|#ifdef MODULE
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jakub Jelinek (jj@sunsite.mff.cuni.cz)&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Solaris binary emulation module&quot;
)paren
suffix:semicolon
macro_line|#ifdef __sparc_v9__
r_extern
id|u32
id|tl0_solaris
(braket
l_int|8
)braket
suffix:semicolon
DECL|macro|update_ttable
mdefine_line|#define update_ttable(x) &t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;tl0_solaris[3] = (((long)(x) - (long)tl0_solaris - 3) &gt;&gt; 2) | 0x40000000;&t;&t;&t;&bslash;&n;&t;__asm__ __volatile__ (&quot;membar #StoreStore; flush %0&quot; : : &quot;r&quot; (&amp;tl0_solaris[3]))
macro_line|#else
macro_line|#endif&t;
r_extern
id|u32
id|solaris_sparc_syscall
(braket
)braket
suffix:semicolon
r_extern
id|u32
id|solaris_syscall
(braket
)braket
suffix:semicolon
r_extern
r_int
id|init_socksys
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|cleanup_socksys
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|register_exec_domain
c_func
(paren
op_amp
id|solaris_exec_domain
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|init_socksys
c_func
(paren
)paren
)paren
)paren
(brace
id|unregister_exec_domain
c_func
(paren
op_amp
id|solaris_exec_domain
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|update_ttable
c_func
(paren
id|solaris_sparc_syscall
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|update_ttable
c_func
(paren
id|solaris_syscall
)paren
suffix:semicolon
id|cleanup_socksys
c_func
(paren
)paren
suffix:semicolon
id|unregister_exec_domain
c_func
(paren
op_amp
id|solaris_exec_domain
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|init_solaris_emul
r_int
id|init_solaris_emul
c_func
(paren
r_void
)paren
(brace
id|register_exec_domain
c_func
(paren
op_amp
id|solaris_exec_domain
)paren
suffix:semicolon
id|init_socksys
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
