multiline_comment|/* $Id: misc.c,v 1.31 2000/12/14 22:57:25 davem Exp $&n; * misc.c: Miscelaneous syscall emulation for Solaris&n; *&n; * Copyright (C) 1997,1998 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt; 
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/utsname.h&gt;
macro_line|#include &lt;linux/limits.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/mman.h&gt;
macro_line|#include &lt;linux/file.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/string.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/idprom.h&gt;
macro_line|#include &quot;conv.h&quot;
multiline_comment|/* Conversion from Linux to Solaris errnos. 0-34 are identity mapped.&n;   Some Linux errnos (EPROCLIM, EDOTDOT, ERREMOTE, EUCLEAN, ENOTNAM, &n;   ENAVAIL, EISNAM, EREMOTEIO, ENOMEDIUM, EMEDIUMTYPE) have no Solaris&n;   equivalents. I return EINVAL in that case, which is very wrong. If&n;   someone suggest a better value for them, you&squot;re welcomed.&n;   On the other side, Solaris ECANCELED and ENOTSUP have no Linux equivalents,&n;   but that doesn&squot;t matter here. --jj */
DECL|variable|solaris_err_table
r_int
id|solaris_err_table
(braket
)braket
op_assign
(brace
multiline_comment|/* 0 */
l_int|0
comma
l_int|1
comma
l_int|2
comma
l_int|3
comma
l_int|4
comma
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|8
comma
l_int|9
comma
multiline_comment|/* 10 */
l_int|10
comma
l_int|11
comma
l_int|12
comma
l_int|13
comma
l_int|14
comma
l_int|15
comma
l_int|16
comma
l_int|17
comma
l_int|18
comma
l_int|19
comma
multiline_comment|/* 20 */
l_int|20
comma
l_int|21
comma
l_int|22
comma
l_int|23
comma
l_int|24
comma
l_int|25
comma
l_int|26
comma
l_int|27
comma
l_int|28
comma
l_int|29
comma
multiline_comment|/* 30 */
l_int|30
comma
l_int|31
comma
l_int|32
comma
l_int|33
comma
l_int|34
comma
l_int|22
comma
l_int|150
comma
l_int|149
comma
l_int|95
comma
l_int|96
comma
multiline_comment|/* 40 */
l_int|97
comma
l_int|98
comma
l_int|99
comma
l_int|120
comma
l_int|121
comma
l_int|122
comma
l_int|123
comma
l_int|124
comma
l_int|125
comma
l_int|126
comma
multiline_comment|/* 50 */
l_int|127
comma
l_int|128
comma
l_int|129
comma
l_int|130
comma
l_int|131
comma
l_int|132
comma
l_int|133
comma
l_int|134
comma
l_int|143
comma
l_int|144
comma
multiline_comment|/* 60 */
l_int|145
comma
l_int|146
comma
l_int|90
comma
l_int|78
comma
l_int|147
comma
l_int|148
comma
l_int|93
comma
l_int|22
comma
l_int|94
comma
l_int|49
comma
multiline_comment|/* 70 */
l_int|151
comma
l_int|66
comma
l_int|60
comma
l_int|62
comma
l_int|63
comma
l_int|35
comma
l_int|77
comma
l_int|36
comma
l_int|45
comma
l_int|46
comma
multiline_comment|/* 80 */
l_int|64
comma
l_int|22
comma
l_int|67
comma
l_int|68
comma
l_int|69
comma
l_int|70
comma
l_int|71
comma
l_int|74
comma
l_int|22
comma
l_int|82
comma
multiline_comment|/* 90 */
l_int|89
comma
l_int|92
comma
l_int|79
comma
l_int|81
comma
l_int|37
comma
l_int|38
comma
l_int|39
comma
l_int|40
comma
l_int|41
comma
l_int|42
comma
multiline_comment|/* 100 */
l_int|43
comma
l_int|44
comma
l_int|50
comma
l_int|51
comma
l_int|52
comma
l_int|53
comma
l_int|54
comma
l_int|55
comma
l_int|56
comma
l_int|57
comma
multiline_comment|/* 110 */
l_int|87
comma
l_int|61
comma
l_int|84
comma
l_int|65
comma
l_int|83
comma
l_int|80
comma
l_int|91
comma
l_int|22
comma
l_int|22
comma
l_int|22
comma
multiline_comment|/* 120 */
l_int|22
comma
l_int|22
comma
l_int|88
comma
l_int|86
comma
l_int|85
comma
l_int|22
comma
l_int|22
comma
)brace
suffix:semicolon
DECL|macro|SOLARIS_NR_OPEN
mdefine_line|#define SOLARIS_NR_OPEN&t;256
DECL|function|do_solaris_mmap
r_static
id|u32
id|do_solaris_mmap
c_func
(paren
id|u32
id|addr
comma
id|u32
id|len
comma
id|u32
id|prot
comma
id|u32
id|flags
comma
id|u32
id|fd
comma
id|u64
id|off
)paren
(brace
r_struct
id|file
op_star
id|file
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|retval
comma
id|ret_type
suffix:semicolon
multiline_comment|/* Do we need it here? */
id|set_personality
c_func
(paren
id|PER_SVR4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|MAP_NORESERVE
)paren
(brace
r_static
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OL
l_int|5
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s:  unimplemented Solaris MAP_NORESERVE mmap() flag&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|cnt
op_increment
suffix:semicolon
)brace
id|flags
op_and_assign
op_complement
id|MAP_NORESERVE
suffix:semicolon
)brace
id|retval
op_assign
op_minus
id|EBADF
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MAP_ANONYMOUS
)paren
)paren
(brace
r_if
c_cond
(paren
id|fd
op_ge
id|SOLARIS_NR_OPEN
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|file
op_assign
id|fget
c_func
(paren
id|fd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file
)paren
r_goto
id|out
suffix:semicolon
r_else
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_if
c_cond
(paren
id|MAJOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_eq
id|MEM_MAJOR
op_logical_and
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_eq
l_int|5
)paren
(brace
id|flags
op_or_assign
id|MAP_ANONYMOUS
suffix:semicolon
id|fput
c_func
(paren
id|file
)paren
suffix:semicolon
id|file
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|len
op_assign
id|PAGE_ALIGN
c_func
(paren
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MAP_FIXED
)paren
)paren
(brace
id|addr
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|len
OG
l_int|0xf0000000UL
op_logical_or
id|addr
OG
l_int|0xf0000000UL
op_minus
id|len
)paren
r_goto
id|out_putf
suffix:semicolon
id|ret_type
op_assign
id|flags
op_amp
id|_MAP_NEW
suffix:semicolon
id|flags
op_and_assign
op_complement
id|_MAP_NEW
suffix:semicolon
id|down
c_func
(paren
op_amp
id|current-&gt;mm-&gt;mmap_sem
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
(paren
id|MAP_EXECUTABLE
op_or
id|MAP_DENYWRITE
)paren
suffix:semicolon
id|retval
op_assign
id|do_mmap
c_func
(paren
id|file
comma
(paren
r_int
r_int
)paren
id|addr
comma
(paren
r_int
r_int
)paren
id|len
comma
(paren
r_int
r_int
)paren
id|prot
comma
(paren
r_int
r_int
)paren
id|flags
comma
id|off
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|current-&gt;mm-&gt;mmap_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret_type
)paren
(brace
id|retval
op_assign
(paren
(paren
id|retval
OL
l_int|0xf0000000
)paren
ques
c_cond
l_int|0
suffix:colon
id|retval
)paren
suffix:semicolon
)brace
id|out_putf
suffix:colon
r_if
c_cond
(paren
id|file
)paren
id|fput
c_func
(paren
id|file
)paren
suffix:semicolon
id|out
suffix:colon
r_return
(paren
id|u32
)paren
id|retval
suffix:semicolon
)brace
DECL|function|solaris_mmap
id|asmlinkage
id|u32
id|solaris_mmap
c_func
(paren
id|u32
id|addr
comma
id|u32
id|len
comma
id|u32
id|prot
comma
id|u32
id|flags
comma
id|u32
id|fd
comma
id|u32
id|off
)paren
(brace
r_return
id|do_solaris_mmap
c_func
(paren
id|addr
comma
id|len
comma
id|prot
comma
id|flags
comma
id|fd
comma
(paren
id|u64
)paren
id|off
)paren
suffix:semicolon
)brace
DECL|function|solaris_mmap64
id|asmlinkage
id|u32
id|solaris_mmap64
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
id|u32
id|len
comma
id|u32
id|prot
comma
id|u32
id|flags
comma
id|u32
id|fd
comma
id|u32
id|offhi
)paren
(brace
id|u32
id|offlo
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;u_regs
(braket
id|UREG_G1
)braket
)paren
(brace
r_if
c_cond
(paren
id|get_user
(paren
id|offlo
comma
(paren
id|u32
op_star
)paren
(paren
r_int
)paren
(paren
(paren
id|u32
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I6
)braket
op_plus
l_int|0x5c
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|get_user
(paren
id|offlo
comma
(paren
id|u32
op_star
)paren
(paren
r_int
)paren
(paren
(paren
id|u32
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I6
)braket
op_plus
l_int|0x60
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|do_solaris_mmap
c_func
(paren
(paren
id|u32
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I0
)braket
comma
id|len
comma
id|prot
comma
id|flags
comma
id|fd
comma
(paren
(paren
(paren
id|u64
)paren
id|offhi
)paren
op_lshift
l_int|32
)paren
op_or
id|offlo
)paren
suffix:semicolon
)brace
DECL|function|solaris_brk
id|asmlinkage
r_int
id|solaris_brk
c_func
(paren
id|u32
id|brk
)paren
(brace
r_int
(paren
op_star
id|sunos_brk
)paren
(paren
id|u32
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|u32
)paren
)paren
id|SUNOS
c_func
(paren
l_int|17
)paren
suffix:semicolon
r_return
id|sunos_brk
c_func
(paren
id|brk
)paren
suffix:semicolon
)brace
DECL|macro|set_utsfield
mdefine_line|#define set_utsfield(to, from, dotchop, countfrom) {&t;&t;&t;&bslash;&n;&t;char *p; &t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;int i, len = (countfrom) ? &t;&t;&t;&t;&t;&bslash;&n;&t;&t;((sizeof(to) &gt; sizeof(from) ? &t;&t;&t;&t;&bslash;&n;&t;&t;&t;sizeof(from) : sizeof(to))) : sizeof(to); &t;&bslash;&n;&t;if (copy_to_user(to, from, len))&t;&t;&t;&t;&bslash;&n;&t;&t;return -EFAULT;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (dotchop) &t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;for (p=from,i=0; *p &amp;&amp; *p != &squot;.&squot; &amp;&amp; --len; p++,i++); &t;&bslash;&n;&t;else &t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;i = len - 1; &t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (__put_user(&squot;&bslash;0&squot;, (char *)(to+i)))&t;&t;&t;&t;&bslash;&n;&t;&t;return -EFAULT;&t;&t;&t;&t;&t;&t;&bslash;&n;}
DECL|struct|sol_uname
r_struct
id|sol_uname
(brace
DECL|member|sysname
r_char
id|sysname
(braket
l_int|9
)braket
suffix:semicolon
DECL|member|nodename
r_char
id|nodename
(braket
l_int|9
)braket
suffix:semicolon
DECL|member|release
r_char
id|release
(braket
l_int|9
)braket
suffix:semicolon
DECL|member|version
r_char
id|version
(braket
l_int|9
)braket
suffix:semicolon
DECL|member|machine
r_char
id|machine
(braket
l_int|9
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sol_utsname
r_struct
id|sol_utsname
(brace
DECL|member|sysname
r_char
id|sysname
(braket
l_int|257
)braket
suffix:semicolon
DECL|member|nodename
r_char
id|nodename
(braket
l_int|257
)braket
suffix:semicolon
DECL|member|release
r_char
id|release
(braket
l_int|257
)braket
suffix:semicolon
DECL|member|version
r_char
id|version
(braket
l_int|257
)braket
suffix:semicolon
DECL|member|machine
r_char
id|machine
(braket
l_int|257
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|machine
r_static
r_char
op_star
id|machine
c_func
(paren
r_void
)paren
(brace
r_switch
c_cond
(paren
id|sparc_cpu_model
)paren
(brace
r_case
id|sun4
suffix:colon
r_return
l_string|&quot;sun4&quot;
suffix:semicolon
r_case
id|sun4c
suffix:colon
r_return
l_string|&quot;sun4c&quot;
suffix:semicolon
r_case
id|sun4e
suffix:colon
r_return
l_string|&quot;sun4e&quot;
suffix:semicolon
r_case
id|sun4m
suffix:colon
r_return
l_string|&quot;sun4m&quot;
suffix:semicolon
r_case
id|sun4d
suffix:colon
r_return
l_string|&quot;sun4d&quot;
suffix:semicolon
r_case
id|sun4u
suffix:colon
r_return
l_string|&quot;sun4u&quot;
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;sparc&quot;
suffix:semicolon
)brace
)brace
DECL|function|platform
r_static
r_char
op_star
id|platform
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_int
id|len
suffix:semicolon
op_star
id|buffer
op_assign
l_int|0
suffix:semicolon
id|len
op_assign
id|prom_getproperty
c_func
(paren
id|prom_root_node
comma
l_string|&quot;name&quot;
comma
id|buffer
comma
l_int|256
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
id|buffer
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|buffer
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|buffer
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_increment
)paren
r_if
c_cond
(paren
op_star
id|p
op_eq
l_char|&squot;/&squot;
op_logical_or
op_star
id|p
op_eq
l_char|&squot; &squot;
)paren
op_star
id|p
op_assign
l_char|&squot;_&squot;
suffix:semicolon
r_return
id|buffer
suffix:semicolon
)brace
r_return
l_string|&quot;sun4u&quot;
suffix:semicolon
)brace
DECL|function|serial
r_static
r_char
op_star
id|serial
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_int
id|node
op_assign
id|prom_getchild
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
r_int
id|len
suffix:semicolon
id|node
op_assign
id|prom_searchsiblings
c_func
(paren
id|node
comma
l_string|&quot;options&quot;
)paren
suffix:semicolon
op_star
id|buffer
op_assign
l_int|0
suffix:semicolon
id|len
op_assign
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;system-board-serial#&quot;
comma
id|buffer
comma
l_int|256
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
id|buffer
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|buffer
)paren
r_return
l_string|&quot;4512348717234&quot;
suffix:semicolon
r_else
r_return
id|buffer
suffix:semicolon
)brace
DECL|function|solaris_utssys
id|asmlinkage
r_int
id|solaris_utssys
c_func
(paren
id|u32
id|buf
comma
id|u32
id|flags
comma
r_int
id|which
comma
id|u32
id|buf2
)paren
(brace
r_switch
c_cond
(paren
id|which
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* old uname */
multiline_comment|/* Let&squot;s cheat */
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_uname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|sysname
comma
l_string|&quot;SunOS&quot;
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|uts_sem
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_uname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|nodename
comma
id|system_utsname.nodename
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|uts_sem
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_uname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|release
comma
l_string|&quot;2.6&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_uname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|version
comma
l_string|&quot;Generic&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_uname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|machine
comma
id|machine
c_func
(paren
)paren
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* ustat */
r_return
op_minus
id|ENOSYS
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* fusers */
r_return
op_minus
id|ENOSYS
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|solaris_utsname
id|asmlinkage
r_int
id|solaris_utsname
c_func
(paren
id|u32
id|buf
)paren
(brace
multiline_comment|/* Why should we not lie a bit? */
id|down_read
c_func
(paren
op_amp
id|uts_sem
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_utsname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|sysname
comma
l_string|&quot;SunOS&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_utsname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|nodename
comma
id|system_utsname.nodename
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_utsname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|release
comma
l_string|&quot;5.6&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_utsname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|version
comma
l_string|&quot;Generic&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_utsfield
c_func
(paren
(paren
(paren
r_struct
id|sol_utsname
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
)paren
op_member_access_from_pointer
id|machine
comma
id|machine
c_func
(paren
)paren
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|uts_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|SI_SYSNAME
mdefine_line|#define SI_SYSNAME&t;&t;1       /* return name of operating system */
DECL|macro|SI_HOSTNAME
mdefine_line|#define SI_HOSTNAME&t;&t;2       /* return name of node */
DECL|macro|SI_RELEASE
mdefine_line|#define SI_RELEASE&t;&t;3       /* return release of operating system */
DECL|macro|SI_VERSION
mdefine_line|#define SI_VERSION&t;&t;4       /* return version field of utsname */
DECL|macro|SI_MACHINE
mdefine_line|#define SI_MACHINE&t;&t;5       /* return kind of machine */
DECL|macro|SI_ARCHITECTURE
mdefine_line|#define SI_ARCHITECTURE&t;&t;6       /* return instruction set arch */
DECL|macro|SI_HW_SERIAL
mdefine_line|#define SI_HW_SERIAL&t;&t;7       /* return hardware serial number */
DECL|macro|SI_HW_PROVIDER
mdefine_line|#define SI_HW_PROVIDER&t;&t;8       /* return hardware manufacturer */
DECL|macro|SI_SRPC_DOMAIN
mdefine_line|#define SI_SRPC_DOMAIN&t;&t;9       /* return secure RPC domain */
DECL|macro|SI_PLATFORM
mdefine_line|#define SI_PLATFORM&t;&t;513     /* return platform identifier */
DECL|function|solaris_sysinfo
id|asmlinkage
r_int
id|solaris_sysinfo
c_func
(paren
r_int
id|cmd
comma
id|u32
id|buf
comma
id|s32
id|count
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
comma
op_star
id|r
suffix:semicolon
r_char
id|buffer
(braket
l_int|256
)braket
suffix:semicolon
r_int
id|len
suffix:semicolon
multiline_comment|/* Again, we cheat :)) */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SI_SYSNAME
suffix:colon
id|r
op_assign
l_string|&quot;SunOS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_HOSTNAME
suffix:colon
id|r
op_assign
id|buffer
op_plus
l_int|256
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|uts_sem
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|system_utsname.nodename
comma
id|q
op_assign
id|buffer
suffix:semicolon
id|q
OL
id|r
op_logical_and
op_star
id|p
op_logical_and
op_star
id|p
op_ne
l_char|&squot;.&squot;
suffix:semicolon
op_star
id|q
op_increment
op_assign
op_star
id|p
op_increment
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|uts_sem
)paren
suffix:semicolon
op_star
id|q
op_assign
l_int|0
suffix:semicolon
id|r
op_assign
id|buffer
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_RELEASE
suffix:colon
id|r
op_assign
l_string|&quot;5.6&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_MACHINE
suffix:colon
id|r
op_assign
id|machine
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_ARCHITECTURE
suffix:colon
id|r
op_assign
l_string|&quot;sparc&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_HW_PROVIDER
suffix:colon
id|r
op_assign
l_string|&quot;Sun_Microsystems&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_HW_SERIAL
suffix:colon
id|r
op_assign
id|serial
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_PLATFORM
suffix:colon
id|r
op_assign
id|platform
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_SRPC_DOMAIN
suffix:colon
id|r
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SI_VERSION
suffix:colon
id|r
op_assign
l_string|&quot;Generic&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|len
op_assign
id|strlen
c_func
(paren
id|r
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
id|len
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
comma
id|r
comma
id|count
op_minus
l_int|1
)paren
op_logical_or
id|__put_user
c_func
(paren
l_int|0
comma
(paren
r_char
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
op_plus
id|count
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_char
op_star
)paren
id|A
c_func
(paren
id|buf
)paren
comma
id|r
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|macro|SOLARIS_CONFIG_NGROUPS
mdefine_line|#define&t;SOLARIS_CONFIG_NGROUPS&t;&t;&t;2
DECL|macro|SOLARIS_CONFIG_CHILD_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_CHILD_MAX&t;&t;3
DECL|macro|SOLARIS_CONFIG_OPEN_FILES
mdefine_line|#define&t;SOLARIS_CONFIG_OPEN_FILES&t;&t;4
DECL|macro|SOLARIS_CONFIG_POSIX_VER
mdefine_line|#define&t;SOLARIS_CONFIG_POSIX_VER&t;&t;5
DECL|macro|SOLARIS_CONFIG_PAGESIZE
mdefine_line|#define&t;SOLARIS_CONFIG_PAGESIZE&t;&t;&t;6
DECL|macro|SOLARIS_CONFIG_CLK_TCK
mdefine_line|#define&t;SOLARIS_CONFIG_CLK_TCK&t;&t;&t;7
DECL|macro|SOLARIS_CONFIG_XOPEN_VER
mdefine_line|#define&t;SOLARIS_CONFIG_XOPEN_VER&t;&t;8
DECL|macro|SOLARIS_CONFIG_PROF_TCK
mdefine_line|#define&t;SOLARIS_CONFIG_PROF_TCK&t;&t;&t;10
DECL|macro|SOLARIS_CONFIG_NPROC_CONF
mdefine_line|#define&t;SOLARIS_CONFIG_NPROC_CONF&t;&t;11
DECL|macro|SOLARIS_CONFIG_NPROC_ONLN
mdefine_line|#define&t;SOLARIS_CONFIG_NPROC_ONLN&t;&t;12
DECL|macro|SOLARIS_CONFIG_AIO_LISTIO_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_AIO_LISTIO_MAX&t;&t;13
DECL|macro|SOLARIS_CONFIG_AIO_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_AIO_MAX&t;&t;&t;14
DECL|macro|SOLARIS_CONFIG_AIO_PRIO_DELTA_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_AIO_PRIO_DELTA_MAX&t;15
DECL|macro|SOLARIS_CONFIG_DELAYTIMER_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_DELAYTIMER_MAX&t;&t;16
DECL|macro|SOLARIS_CONFIG_MQ_OPEN_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_MQ_OPEN_MAX&t;&t;17
DECL|macro|SOLARIS_CONFIG_MQ_PRIO_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_MQ_PRIO_MAX&t;&t;18
DECL|macro|SOLARIS_CONFIG_RTSIG_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_RTSIG_MAX&t;&t;19
DECL|macro|SOLARIS_CONFIG_SEM_NSEMS_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_SEM_NSEMS_MAX&t;&t;20
DECL|macro|SOLARIS_CONFIG_SEM_VALUE_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_SEM_VALUE_MAX&t;&t;21
DECL|macro|SOLARIS_CONFIG_SIGQUEUE_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_SIGQUEUE_MAX&t;&t;22
DECL|macro|SOLARIS_CONFIG_SIGRT_MIN
mdefine_line|#define&t;SOLARIS_CONFIG_SIGRT_MIN&t;&t;23
DECL|macro|SOLARIS_CONFIG_SIGRT_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_SIGRT_MAX&t;&t;24
DECL|macro|SOLARIS_CONFIG_TIMER_MAX
mdefine_line|#define&t;SOLARIS_CONFIG_TIMER_MAX&t;&t;25
DECL|macro|SOLARIS_CONFIG_PHYS_PAGES
mdefine_line|#define&t;SOLARIS_CONFIG_PHYS_PAGES&t;&t;26
DECL|macro|SOLARIS_CONFIG_AVPHYS_PAGES
mdefine_line|#define&t;SOLARIS_CONFIG_AVPHYS_PAGES&t;&t;27
r_extern
r_int
id|prom_cpu_nodes
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|function|solaris_sysconf
id|asmlinkage
r_int
id|solaris_sysconf
c_func
(paren
r_int
id|id
)paren
(brace
r_switch
c_cond
(paren
id|id
)paren
(brace
r_case
id|SOLARIS_CONFIG_NGROUPS
suffix:colon
r_return
id|NGROUPS_MAX
suffix:semicolon
r_case
id|SOLARIS_CONFIG_CHILD_MAX
suffix:colon
r_return
id|CHILD_MAX
suffix:semicolon
r_case
id|SOLARIS_CONFIG_OPEN_FILES
suffix:colon
r_return
id|OPEN_MAX
suffix:semicolon
r_case
id|SOLARIS_CONFIG_POSIX_VER
suffix:colon
r_return
l_int|199309
suffix:semicolon
r_case
id|SOLARIS_CONFIG_PAGESIZE
suffix:colon
r_return
id|PAGE_SIZE
suffix:semicolon
r_case
id|SOLARIS_CONFIG_XOPEN_VER
suffix:colon
r_return
l_int|3
suffix:semicolon
r_case
id|SOLARIS_CONFIG_CLK_TCK
suffix:colon
r_case
id|SOLARIS_CONFIG_PROF_TCK
suffix:colon
r_return
id|prom_getintdefault
c_func
(paren
id|prom_cpu_nodes
(braket
id|smp_processor_id
c_func
(paren
)paren
)braket
comma
l_string|&quot;clock-frequency&quot;
comma
l_int|167000000
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SMP&t;
r_case
id|SOLARIS_CONFIG_NPROC_CONF
suffix:colon
r_return
id|NR_CPUS
suffix:semicolon
r_case
id|SOLARIS_CONFIG_NPROC_ONLN
suffix:colon
r_return
id|smp_num_cpus
suffix:semicolon
macro_line|#else
r_case
id|SOLARIS_CONFIG_NPROC_CONF
suffix:colon
r_return
l_int|1
suffix:semicolon
r_case
id|SOLARIS_CONFIG_NPROC_ONLN
suffix:colon
r_return
l_int|1
suffix:semicolon
macro_line|#endif
r_case
id|SOLARIS_CONFIG_SIGRT_MIN
suffix:colon
r_return
l_int|37
suffix:semicolon
r_case
id|SOLARIS_CONFIG_SIGRT_MAX
suffix:colon
r_return
l_int|44
suffix:semicolon
r_case
id|SOLARIS_CONFIG_PHYS_PAGES
suffix:colon
r_case
id|SOLARIS_CONFIG_AVPHYS_PAGES
suffix:colon
(brace
r_struct
id|sysinfo
id|s
suffix:semicolon
id|si_meminfo
c_func
(paren
op_amp
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|SOLARIS_CONFIG_PHYS_PAGES
)paren
r_return
id|s.totalram
op_rshift_assign
id|PAGE_SHIFT
suffix:semicolon
r_else
r_return
id|s.freeram
op_rshift_assign
id|PAGE_SHIFT
suffix:semicolon
)brace
multiline_comment|/* XXX support these as well -jj */
r_case
id|SOLARIS_CONFIG_AIO_LISTIO_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_AIO_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_AIO_PRIO_DELTA_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_DELAYTIMER_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_MQ_OPEN_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_MQ_PRIO_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_RTSIG_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_SEM_NSEMS_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_SEM_VALUE_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_SIGQUEUE_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SOLARIS_CONFIG_TIMER_MAX
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|function|solaris_procids
id|asmlinkage
r_int
id|solaris_procids
c_func
(paren
r_int
id|cmd
comma
id|s32
id|pid
comma
id|s32
id|pgid
)paren
(brace
r_int
id|ret
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* getpgrp */
r_return
id|current-&gt;pgrp
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* setpgrp */
(brace
r_int
(paren
op_star
id|sys_setpgid
)paren
(paren
id|pid_t
comma
id|pid_t
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|pid_t
comma
id|pid_t
)paren
)paren
id|SYS
c_func
(paren
id|setpgid
)paren
suffix:semicolon
multiline_comment|/* can anyone explain me the difference between&n;&t;&t;&t;   Solaris setpgrp and setsid? */
id|ret
op_assign
id|sys_setpgid
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|current-&gt;tty
op_assign
l_int|NULL
suffix:semicolon
r_return
id|current-&gt;pgrp
suffix:semicolon
)brace
r_case
l_int|2
suffix:colon
multiline_comment|/* getsid */
(brace
r_int
(paren
op_star
id|sys_getsid
)paren
(paren
id|pid_t
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|pid_t
)paren
)paren
id|SYS
c_func
(paren
id|getsid
)paren
suffix:semicolon
r_return
id|sys_getsid
c_func
(paren
id|pid
)paren
suffix:semicolon
)brace
r_case
l_int|3
suffix:colon
multiline_comment|/* setsid */
(brace
r_int
(paren
op_star
id|sys_setsid
)paren
(paren
r_void
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_void
)paren
)paren
id|SYS
c_func
(paren
id|setsid
)paren
suffix:semicolon
r_return
id|sys_setsid
c_func
(paren
)paren
suffix:semicolon
)brace
r_case
l_int|4
suffix:colon
multiline_comment|/* getpgid */
(brace
r_int
(paren
op_star
id|sys_getpgid
)paren
(paren
id|pid_t
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|pid_t
)paren
)paren
id|SYS
c_func
(paren
id|getpgid
)paren
suffix:semicolon
r_return
id|sys_getpgid
c_func
(paren
id|pid
)paren
suffix:semicolon
)brace
r_case
l_int|5
suffix:colon
multiline_comment|/* setpgid */
(brace
r_int
(paren
op_star
id|sys_setpgid
)paren
(paren
id|pid_t
comma
id|pid_t
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|pid_t
comma
id|pid_t
)paren
)paren
id|SYS
c_func
(paren
id|setpgid
)paren
suffix:semicolon
r_return
id|sys_setpgid
c_func
(paren
id|pid
comma
id|pgid
)paren
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|solaris_gettimeofday
id|asmlinkage
r_int
id|solaris_gettimeofday
c_func
(paren
id|u32
id|tim
)paren
(brace
r_int
(paren
op_star
id|sys_gettimeofday
)paren
(paren
r_struct
id|timeval
op_star
comma
r_struct
id|timezone
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_struct
id|timeval
op_star
comma
r_struct
id|timezone
op_star
)paren
)paren
id|SYS
c_func
(paren
id|gettimeofday
)paren
suffix:semicolon
r_return
id|sys_gettimeofday
c_func
(paren
(paren
r_struct
id|timeval
op_star
)paren
(paren
id|u64
)paren
id|tim
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|macro|RLIM_SOL_INFINITY32
mdefine_line|#define RLIM_SOL_INFINITY32&t;0x7fffffff
DECL|macro|RLIM_SOL_SAVED_MAX32
mdefine_line|#define RLIM_SOL_SAVED_MAX32&t;0x7ffffffe
DECL|macro|RLIM_SOL_SAVED_CUR32
mdefine_line|#define RLIM_SOL_SAVED_CUR32&t;0x7ffffffd
DECL|macro|RLIM_SOL_INFINITY
mdefine_line|#define RLIM_SOL_INFINITY&t;((u64)-3)
DECL|macro|RLIM_SOL_SAVED_MAX
mdefine_line|#define RLIM_SOL_SAVED_MAX&t;((u64)-2)
DECL|macro|RLIM_SOL_SAVED_CUR
mdefine_line|#define RLIM_SOL_SAVED_CUR&t;((u64)-1)
DECL|macro|RESOURCE32
mdefine_line|#define RESOURCE32(x) ((x &gt; RLIM_INFINITY32) ? RLIM_INFINITY32 : x)
DECL|macro|RLIMIT_SOL_NOFILE
mdefine_line|#define RLIMIT_SOL_NOFILE&t;5
DECL|macro|RLIMIT_SOL_VMEM
mdefine_line|#define RLIMIT_SOL_VMEM&t;&t;6
DECL|struct|rlimit32
r_struct
id|rlimit32
(brace
DECL|member|rlim_cur
id|u32
id|rlim_cur
suffix:semicolon
DECL|member|rlim_max
id|u32
id|rlim_max
suffix:semicolon
)brace
suffix:semicolon
DECL|function|solaris_getrlimit
id|asmlinkage
r_int
id|solaris_getrlimit
c_func
(paren
r_int
r_int
id|resource
comma
r_struct
id|rlimit32
op_star
id|rlim
)paren
(brace
r_struct
id|rlimit
id|r
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
(paren
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_getrlimit
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
)paren
id|SYS
c_func
(paren
id|getrlimit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resource
OG
id|RLIMIT_SOL_VMEM
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|resource
)paren
(brace
r_case
id|RLIMIT_SOL_NOFILE
suffix:colon
id|resource
op_assign
id|RLIMIT_NOFILE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RLIMIT_SOL_VMEM
suffix:colon
id|resource
op_assign
id|RLIMIT_AS
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|set_fs
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_getrlimit
c_func
(paren
id|resource
comma
op_amp
id|r
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_if
c_cond
(paren
id|r.rlim_cur
op_eq
id|RLIM_INFINITY
)paren
id|r.rlim_cur
op_assign
id|RLIM_SOL_INFINITY32
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|u64
)paren
id|r.rlim_cur
OG
id|RLIM_SOL_INFINITY32
)paren
id|r.rlim_cur
op_assign
id|RLIM_SOL_SAVED_CUR32
suffix:semicolon
r_if
c_cond
(paren
id|r.rlim_max
op_eq
id|RLIM_INFINITY
)paren
id|r.rlim_max
op_assign
id|RLIM_SOL_INFINITY32
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|u64
)paren
id|r.rlim_max
OG
id|RLIM_SOL_INFINITY32
)paren
id|r.rlim_max
op_assign
id|RLIM_SOL_SAVED_MAX32
suffix:semicolon
id|ret
op_assign
id|put_user
(paren
id|r.rlim_cur
comma
op_amp
id|rlim-&gt;rlim_cur
)paren
suffix:semicolon
id|ret
op_or_assign
id|__put_user
(paren
id|r.rlim_max
comma
op_amp
id|rlim-&gt;rlim_max
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_setrlimit
id|asmlinkage
r_int
id|solaris_setrlimit
c_func
(paren
r_int
r_int
id|resource
comma
r_struct
id|rlimit32
op_star
id|rlim
)paren
(brace
r_struct
id|rlimit
id|r
comma
id|rold
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
(paren
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_getrlimit
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
)paren
id|SYS
c_func
(paren
id|getrlimit
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_setrlimit
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
)paren
id|SYS
c_func
(paren
id|setrlimit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resource
OG
id|RLIMIT_SOL_VMEM
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|resource
)paren
(brace
r_case
id|RLIMIT_SOL_NOFILE
suffix:colon
id|resource
op_assign
id|RLIMIT_NOFILE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RLIMIT_SOL_VMEM
suffix:colon
id|resource
op_assign
id|RLIMIT_AS
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
(paren
id|r.rlim_cur
comma
op_amp
id|rlim-&gt;rlim_cur
)paren
op_logical_or
id|__get_user
(paren
id|r.rlim_max
comma
op_amp
id|rlim-&gt;rlim_max
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_fs
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_getrlimit
c_func
(paren
id|resource
comma
op_amp
id|rold
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_if
c_cond
(paren
id|r.rlim_cur
op_eq
id|RLIM_SOL_INFINITY32
)paren
id|r.rlim_cur
op_assign
id|RLIM_INFINITY
suffix:semicolon
r_else
r_if
c_cond
(paren
id|r.rlim_cur
op_eq
id|RLIM_SOL_SAVED_CUR32
)paren
id|r.rlim_cur
op_assign
id|rold.rlim_cur
suffix:semicolon
r_else
r_if
c_cond
(paren
id|r.rlim_cur
op_eq
id|RLIM_SOL_SAVED_MAX32
)paren
id|r.rlim_cur
op_assign
id|rold.rlim_max
suffix:semicolon
r_if
c_cond
(paren
id|r.rlim_max
op_eq
id|RLIM_SOL_INFINITY32
)paren
id|r.rlim_max
op_assign
id|RLIM_INFINITY
suffix:semicolon
r_else
r_if
c_cond
(paren
id|r.rlim_max
op_eq
id|RLIM_SOL_SAVED_CUR32
)paren
id|r.rlim_max
op_assign
id|rold.rlim_cur
suffix:semicolon
r_else
r_if
c_cond
(paren
id|r.rlim_max
op_eq
id|RLIM_SOL_SAVED_MAX32
)paren
id|r.rlim_max
op_assign
id|rold.rlim_max
suffix:semicolon
id|ret
op_assign
id|sys_setrlimit
c_func
(paren
id|resource
comma
op_amp
id|r
)paren
suffix:semicolon
)brace
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_getrlimit64
id|asmlinkage
r_int
id|solaris_getrlimit64
c_func
(paren
r_int
r_int
id|resource
comma
r_struct
id|rlimit
op_star
id|rlim
)paren
(brace
r_struct
id|rlimit
id|r
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
(paren
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_getrlimit
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
)paren
id|SYS
c_func
(paren
id|getrlimit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resource
OG
id|RLIMIT_SOL_VMEM
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|resource
)paren
(brace
r_case
id|RLIMIT_SOL_NOFILE
suffix:colon
id|resource
op_assign
id|RLIMIT_NOFILE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RLIMIT_SOL_VMEM
suffix:colon
id|resource
op_assign
id|RLIMIT_AS
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|set_fs
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_getrlimit
c_func
(paren
id|resource
comma
op_amp
id|r
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_if
c_cond
(paren
id|r.rlim_cur
op_eq
id|RLIM_INFINITY
)paren
id|r.rlim_cur
op_assign
id|RLIM_SOL_INFINITY
suffix:semicolon
r_if
c_cond
(paren
id|r.rlim_max
op_eq
id|RLIM_INFINITY
)paren
id|r.rlim_max
op_assign
id|RLIM_SOL_INFINITY
suffix:semicolon
id|ret
op_assign
id|put_user
(paren
id|r.rlim_cur
comma
op_amp
id|rlim-&gt;rlim_cur
)paren
suffix:semicolon
id|ret
op_or_assign
id|__put_user
(paren
id|r.rlim_max
comma
op_amp
id|rlim-&gt;rlim_max
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_setrlimit64
id|asmlinkage
r_int
id|solaris_setrlimit64
c_func
(paren
r_int
r_int
id|resource
comma
r_struct
id|rlimit
op_star
id|rlim
)paren
(brace
r_struct
id|rlimit
id|r
comma
id|rold
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
(paren
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_getrlimit
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
)paren
id|SYS
c_func
(paren
id|getrlimit
)paren
suffix:semicolon
r_int
(paren
op_star
id|sys_setrlimit
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
r_int
comma
r_struct
id|rlimit
op_star
)paren
)paren
id|SYS
c_func
(paren
id|setrlimit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resource
OG
id|RLIMIT_SOL_VMEM
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|resource
)paren
(brace
r_case
id|RLIMIT_SOL_NOFILE
suffix:colon
id|resource
op_assign
id|RLIMIT_NOFILE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RLIMIT_SOL_VMEM
suffix:colon
id|resource
op_assign
id|RLIMIT_AS
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
(paren
id|r.rlim_cur
comma
op_amp
id|rlim-&gt;rlim_cur
)paren
op_logical_or
id|__get_user
(paren
id|r.rlim_max
comma
op_amp
id|rlim-&gt;rlim_max
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_fs
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_getrlimit
c_func
(paren
id|resource
comma
op_amp
id|rold
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_if
c_cond
(paren
id|r.rlim_cur
op_eq
id|RLIM_SOL_INFINITY
)paren
id|r.rlim_cur
op_assign
id|RLIM_INFINITY
suffix:semicolon
r_else
r_if
c_cond
(paren
id|r.rlim_cur
op_eq
id|RLIM_SOL_SAVED_CUR
)paren
id|r.rlim_cur
op_assign
id|rold.rlim_cur
suffix:semicolon
r_else
r_if
c_cond
(paren
id|r.rlim_cur
op_eq
id|RLIM_SOL_SAVED_MAX
)paren
id|r.rlim_cur
op_assign
id|rold.rlim_max
suffix:semicolon
r_if
c_cond
(paren
id|r.rlim_max
op_eq
id|RLIM_SOL_INFINITY
)paren
id|r.rlim_max
op_assign
id|RLIM_INFINITY
suffix:semicolon
r_else
r_if
c_cond
(paren
id|r.rlim_max
op_eq
id|RLIM_SOL_SAVED_CUR
)paren
id|r.rlim_max
op_assign
id|rold.rlim_cur
suffix:semicolon
r_else
r_if
c_cond
(paren
id|r.rlim_max
op_eq
id|RLIM_SOL_SAVED_MAX
)paren
id|r.rlim_max
op_assign
id|rold.rlim_max
suffix:semicolon
id|ret
op_assign
id|sys_setrlimit
c_func
(paren
id|resource
comma
op_amp
id|r
)paren
suffix:semicolon
)brace
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|struct|timeval32
r_struct
id|timeval32
(brace
DECL|member|tv_sec
DECL|member|tv_usec
r_int
id|tv_sec
comma
id|tv_usec
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sol_ntptimeval
r_struct
id|sol_ntptimeval
(brace
DECL|member|time
r_struct
id|timeval32
id|time
suffix:semicolon
DECL|member|maxerror
id|s32
id|maxerror
suffix:semicolon
DECL|member|esterror
id|s32
id|esterror
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sol_timex
r_struct
id|sol_timex
(brace
DECL|member|modes
id|u32
id|modes
suffix:semicolon
DECL|member|offset
id|s32
id|offset
suffix:semicolon
DECL|member|freq
id|s32
id|freq
suffix:semicolon
DECL|member|maxerror
id|s32
id|maxerror
suffix:semicolon
DECL|member|esterror
id|s32
id|esterror
suffix:semicolon
DECL|member|status
id|s32
id|status
suffix:semicolon
DECL|member|constant
id|s32
id|constant
suffix:semicolon
DECL|member|precision
id|s32
id|precision
suffix:semicolon
DECL|member|tolerance
id|s32
id|tolerance
suffix:semicolon
DECL|member|ppsfreq
id|s32
id|ppsfreq
suffix:semicolon
DECL|member|jitter
id|s32
id|jitter
suffix:semicolon
DECL|member|shift
id|s32
id|shift
suffix:semicolon
DECL|member|stabil
id|s32
id|stabil
suffix:semicolon
DECL|member|jitcnt
id|s32
id|jitcnt
suffix:semicolon
DECL|member|calcnt
id|s32
id|calcnt
suffix:semicolon
DECL|member|errcnt
id|s32
id|errcnt
suffix:semicolon
DECL|member|stbcnt
id|s32
id|stbcnt
suffix:semicolon
)brace
suffix:semicolon
DECL|function|solaris_ntp_gettime
id|asmlinkage
r_int
id|solaris_ntp_gettime
c_func
(paren
r_struct
id|sol_ntptimeval
op_star
id|ntp
)paren
(brace
r_int
(paren
op_star
id|sys_adjtimex
)paren
(paren
r_struct
id|timex
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_struct
id|timex
op_star
)paren
)paren
id|SYS
c_func
(paren
id|adjtimex
)paren
suffix:semicolon
r_struct
id|timex
id|t
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|t.modes
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|sys_adjtimex
c_func
(paren
op_amp
id|t
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|put_user
(paren
id|t.time.tv_sec
comma
op_amp
id|ntp-&gt;time.tv_sec
)paren
suffix:semicolon
id|ret
op_or_assign
id|__put_user
(paren
id|t.time.tv_usec
comma
op_amp
id|ntp-&gt;time.tv_usec
)paren
suffix:semicolon
id|ret
op_or_assign
id|__put_user
(paren
id|t.maxerror
comma
op_amp
id|ntp-&gt;maxerror
)paren
suffix:semicolon
id|ret
op_or_assign
id|__put_user
(paren
id|t.esterror
comma
op_amp
id|ntp-&gt;esterror
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|solaris_ntp_adjtime
id|asmlinkage
r_int
id|solaris_ntp_adjtime
c_func
(paren
r_struct
id|sol_timex
op_star
id|txp
)paren
(brace
r_int
(paren
op_star
id|sys_adjtimex
)paren
(paren
r_struct
id|timex
op_star
)paren
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_struct
id|timex
op_star
)paren
)paren
id|SYS
c_func
(paren
id|adjtimex
)paren
suffix:semicolon
r_struct
id|timex
id|t
suffix:semicolon
r_int
id|ret
comma
id|err
suffix:semicolon
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
id|get_user
(paren
id|t.modes
comma
op_amp
id|txp-&gt;modes
)paren
suffix:semicolon
id|ret
op_or_assign
id|__get_user
(paren
id|t.offset
comma
op_amp
id|txp-&gt;offset
)paren
suffix:semicolon
id|ret
op_or_assign
id|__get_user
(paren
id|t.freq
comma
op_amp
id|txp-&gt;freq
)paren
suffix:semicolon
id|ret
op_or_assign
id|__get_user
(paren
id|t.maxerror
comma
op_amp
id|txp-&gt;maxerror
)paren
suffix:semicolon
id|ret
op_or_assign
id|__get_user
(paren
id|t.esterror
comma
op_amp
id|txp-&gt;esterror
)paren
suffix:semicolon
id|ret
op_or_assign
id|__get_user
(paren
id|t.status
comma
op_amp
id|txp-&gt;status
)paren
suffix:semicolon
id|ret
op_or_assign
id|__get_user
(paren
id|t.constant
comma
op_amp
id|txp-&gt;constant
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_adjtimex
c_func
(paren
op_amp
id|t
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|err
op_assign
id|put_user
(paren
id|t.offset
comma
op_amp
id|txp-&gt;offset
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.freq
comma
op_amp
id|txp-&gt;freq
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.maxerror
comma
op_amp
id|txp-&gt;maxerror
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.esterror
comma
op_amp
id|txp-&gt;esterror
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.status
comma
op_amp
id|txp-&gt;status
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.constant
comma
op_amp
id|txp-&gt;constant
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.precision
comma
op_amp
id|txp-&gt;precision
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.tolerance
comma
op_amp
id|txp-&gt;tolerance
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.ppsfreq
comma
op_amp
id|txp-&gt;ppsfreq
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.jitter
comma
op_amp
id|txp-&gt;jitter
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.shift
comma
op_amp
id|txp-&gt;shift
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.stabil
comma
op_amp
id|txp-&gt;stabil
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.jitcnt
comma
op_amp
id|txp-&gt;jitcnt
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.calcnt
comma
op_amp
id|txp-&gt;calcnt
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.errcnt
comma
op_amp
id|txp-&gt;errcnt
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
(paren
id|t.stbcnt
comma
op_amp
id|txp-&gt;stbcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|do_sol_unimplemented
id|asmlinkage
r_int
id|do_sol_unimplemented
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
(paren
l_string|&quot;Unimplemented Solaris syscall %d %08x %08x %08x %08x&bslash;n&quot;
comma
(paren
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_G1
)braket
comma
(paren
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I0
)braket
comma
(paren
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I1
)braket
comma
(paren
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I2
)braket
comma
(paren
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I3
)braket
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|solaris_register
id|asmlinkage
r_void
id|solaris_register
c_func
(paren
r_void
)paren
(brace
id|set_personality
c_func
(paren
id|PER_SVR4
)paren
suffix:semicolon
)brace
r_extern
r_int
id|solaris_to_linux_signals
(braket
)braket
comma
id|linux_to_solaris_signals
(braket
)braket
suffix:semicolon
DECL|variable|solaris_exec_domain
r_struct
id|exec_domain
id|solaris_exec_domain
op_assign
(brace
l_string|&quot;Solaris&quot;
comma
(paren
id|lcall7_func
)paren
l_int|NULL
comma
l_int|1
comma
l_int|1
comma
multiline_comment|/* PER_SVR4 personality */
id|solaris_to_linux_signals
comma
id|linux_to_solaris_signals
comma
id|THIS_MODULE
comma
l_int|NULL
)brace
suffix:semicolon
r_extern
r_int
id|init_socksys
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef MODULE
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jakub Jelinek (jj@ultra.linux.cz), Patrik Rak (prak3264@ss1000.ms.mff.cuni.cz)&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Solaris binary emulation module&quot;
)paren
suffix:semicolon
id|EXPORT_NO_SYMBOLS
suffix:semicolon
macro_line|#ifdef __sparc_v9__
r_extern
id|u32
id|tl0_solaris
(braket
l_int|8
)braket
suffix:semicolon
DECL|macro|update_ttable
mdefine_line|#define update_ttable(x) &t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;tl0_solaris[3] = (((long)(x) - (long)tl0_solaris - 3) &gt;&gt; 2) | 0x40000000;&t;&t;&t;&bslash;&n;&t;__asm__ __volatile__ (&quot;membar #StoreStore; flush %0&quot; : : &quot;r&quot; (&amp;tl0_solaris[3]))
macro_line|#else
macro_line|#endif&t;
r_extern
id|u32
id|solaris_sparc_syscall
(braket
)braket
suffix:semicolon
r_extern
id|u32
id|solaris_syscall
(braket
)braket
suffix:semicolon
r_extern
r_void
id|cleanup_socksys
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|SOLDD
c_func
(paren
(paren
l_string|&quot;Solaris module at %p&bslash;n&quot;
comma
id|solaris_sparc_syscall
)paren
)paren
suffix:semicolon
id|register_exec_domain
c_func
(paren
op_amp
id|solaris_exec_domain
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|init_socksys
c_func
(paren
)paren
)paren
)paren
(brace
id|unregister_exec_domain
c_func
(paren
op_amp
id|solaris_exec_domain
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|update_ttable
c_func
(paren
id|solaris_sparc_syscall
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|update_ttable
c_func
(paren
id|solaris_syscall
)paren
suffix:semicolon
id|cleanup_socksys
c_func
(paren
)paren
suffix:semicolon
id|unregister_exec_domain
c_func
(paren
op_amp
id|solaris_exec_domain
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|init_solaris_emul
r_int
id|init_solaris_emul
c_func
(paren
r_void
)paren
(brace
id|register_exec_domain
c_func
(paren
op_amp
id|solaris_exec_domain
)paren
suffix:semicolon
id|init_socksys
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
eof
