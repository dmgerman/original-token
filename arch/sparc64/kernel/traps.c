multiline_comment|/* $Id: traps.c,v 1.13 1997/05/27 19:30:08 jj Exp $&n; * arch/sparc/kernel/traps.c&n; *&n; * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n; * Copyright (C) 1997 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; */
multiline_comment|/*&n; * I hate traps on the sparc, grrr...&n; */
macro_line|#include &lt;linux/sched.h&gt;  /* for jiffies */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/unistd.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
multiline_comment|/* #define SYSCALL_TRACING */
multiline_comment|/* #define VERBOSE_SYSCALL_TRACING */
macro_line|#ifdef SYSCALL_TRACING
macro_line|#ifdef VERBOSE_SYSCALL_TRACING
DECL|struct|sdesc
r_struct
id|sdesc
(brace
DECL|member|scall_num
r_int
id|scall_num
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|num_args
r_int
id|num_args
suffix:semicolon
DECL|member|arg_is_string
r_char
id|arg_is_string
(braket
l_int|6
)braket
suffix:semicolon
DECL|variable|sdesc_entries
)brace
id|sdesc_entries
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
l_string|&quot;setup&quot;
comma
l_int|0
comma
)brace
comma
(brace
l_int|1
comma
l_string|&quot;exit&quot;
comma
l_int|1
comma
(brace
l_int|0
comma
)brace
)brace
comma
(brace
l_int|2
comma
l_string|&quot;fork&quot;
comma
l_int|0
comma
)brace
comma
(brace
l_int|3
comma
l_string|&quot;read&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|4
comma
l_string|&quot;write&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|5
comma
l_string|&quot;open&quot;
comma
l_int|3
comma
(brace
l_int|1
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|6
comma
l_string|&quot;close&quot;
comma
l_int|1
comma
(brace
l_int|0
comma
)brace
)brace
comma
(brace
l_int|7
comma
l_string|&quot;wait4&quot;
comma
l_int|4
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|8
comma
l_string|&quot;creat&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|9
comma
l_string|&quot;link&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|1
comma
)brace
)brace
comma
(brace
l_int|10
comma
l_string|&quot;unlink&quot;
comma
l_int|1
comma
(brace
l_int|1
comma
)brace
)brace
comma
(brace
l_int|11
comma
l_string|&quot;execv&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|12
comma
l_string|&quot;chdir&quot;
comma
l_int|1
comma
(brace
l_int|1
comma
)brace
)brace
comma
(brace
l_int|15
comma
l_string|&quot;chmod&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|16
comma
l_string|&quot;chown&quot;
comma
l_int|3
comma
(brace
l_int|1
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|17
comma
l_string|&quot;brk&quot;
comma
l_int|1
comma
(brace
l_int|0
comma
)brace
)brace
comma
(brace
l_int|19
comma
l_string|&quot;lseek&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|27
comma
l_string|&quot;alarm&quot;
comma
l_int|1
comma
(brace
l_int|0
comma
)brace
)brace
comma
(brace
l_int|29
comma
l_string|&quot;pause&quot;
comma
l_int|0
comma
)brace
comma
(brace
l_int|33
comma
l_string|&quot;access&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|36
comma
l_string|&quot;sync&quot;
comma
l_int|0
comma
)brace
comma
(brace
l_int|37
comma
l_string|&quot;kill&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|38
comma
l_string|&quot;stat&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|40
comma
l_string|&quot;lstat&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|41
comma
l_string|&quot;dup&quot;
comma
l_int|1
comma
(brace
l_int|0
comma
)brace
)brace
comma
(brace
l_int|42
comma
l_string|&quot;pipd&quot;
comma
l_int|0
comma
)brace
comma
(brace
l_int|54
comma
l_string|&quot;ioctl&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|57
comma
l_string|&quot;symlink&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|1
comma
)brace
)brace
comma
(brace
l_int|58
comma
l_string|&quot;readlink&quot;
comma
l_int|3
comma
(brace
l_int|1
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|59
comma
l_string|&quot;execve&quot;
comma
l_int|3
comma
(brace
l_int|1
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|60
comma
l_string|&quot;umask&quot;
comma
l_int|1
comma
(brace
l_int|0
comma
)brace
)brace
comma
(brace
l_int|62
comma
l_string|&quot;fstat&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|64
comma
l_string|&quot;getpagesize&quot;
comma
l_int|0
comma
)brace
comma
(brace
l_int|71
comma
l_string|&quot;mmap&quot;
comma
l_int|6
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|73
comma
l_string|&quot;munmap&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|74
comma
l_string|&quot;mprotect&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|83
comma
l_string|&quot;setitimer&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|90
comma
l_string|&quot;dup2&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|92
comma
l_string|&quot;fcntl&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|93
comma
l_string|&quot;select&quot;
comma
l_int|5
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|97
comma
l_string|&quot;socket&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|98
comma
l_string|&quot;connect&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|99
comma
l_string|&quot;accept&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|101
comma
l_string|&quot;send&quot;
comma
l_int|4
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|102
comma
l_string|&quot;recv&quot;
comma
l_int|4
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|104
comma
l_string|&quot;bind&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|105
comma
l_string|&quot;setsockopt&quot;
comma
l_int|5
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|106
comma
l_string|&quot;listen&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|120
comma
l_string|&quot;readv&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|121
comma
l_string|&quot;writev&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|123
comma
l_string|&quot;fchown&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|124
comma
l_string|&quot;fchmod&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|128
comma
l_string|&quot;rename&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|1
comma
)brace
)brace
comma
(brace
l_int|129
comma
l_string|&quot;truncate&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|130
comma
l_string|&quot;ftruncate&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|131
comma
l_string|&quot;flock&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|136
comma
l_string|&quot;mkdir&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|137
comma
l_string|&quot;rmdir&quot;
comma
l_int|1
comma
(brace
l_int|1
comma
)brace
)brace
comma
(brace
l_int|146
comma
l_string|&quot;killpg&quot;
comma
l_int|1
comma
(brace
l_int|0
comma
)brace
)brace
comma
(brace
l_int|157
comma
l_string|&quot;statfs&quot;
comma
l_int|2
comma
(brace
l_int|1
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|158
comma
l_string|&quot;fstatfs&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|159
comma
l_string|&quot;umount&quot;
comma
l_int|1
comma
(brace
l_int|1
comma
)brace
)brace
comma
(brace
l_int|167
comma
l_string|&quot;mount&quot;
comma
l_int|5
comma
(brace
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|174
comma
l_string|&quot;getdents&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|176
comma
l_string|&quot;fchdir&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|198
comma
l_string|&quot;sigaction&quot;
comma
l_int|3
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|201
comma
l_string|&quot;sigsuspend&quot;
comma
l_int|1
comma
(brace
l_int|0
comma
)brace
)brace
comma
(brace
l_int|206
comma
l_string|&quot;socketcall&quot;
comma
l_int|2
comma
(brace
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|216
comma
l_string|&quot;sigreturn&quot;
comma
l_int|0
comma
)brace
comma
(brace
l_int|230
comma
l_string|&quot;newselect&quot;
comma
l_int|5
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|236
comma
l_string|&quot;llseek&quot;
comma
l_int|5
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
comma
(brace
l_int|251
comma
l_string|&quot;sysctl&quot;
comma
l_int|1
comma
(brace
l_int|0
comma
)brace
)brace
comma
)brace
suffix:semicolon
DECL|macro|NUM_SDESC_ENTRIES
mdefine_line|#define NUM_SDESC_ENTRIES (sizeof(sdesc_entries) / sizeof(sdesc_entries[0]))
macro_line|#endif
macro_line|#ifdef VERBOSE_SYSCALL_TRACING
DECL|variable|scall_strbuf
r_static
r_char
id|scall_strbuf
(braket
l_int|512
)braket
suffix:semicolon
macro_line|#endif
DECL|function|syscall_trace_entry
r_void
id|syscall_trace_entry
c_func
(paren
r_int
r_int
id|g1
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
macro_line|#ifdef VERBOSE_SYSCALL_TRACING
r_struct
id|sdesc
op_star
id|sdp
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;SYS[%s:%d]: &lt;%d&gt; &quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
(paren
r_int
)paren
id|g1
)paren
suffix:semicolon
macro_line|#ifdef VERBOSE_SYSCALL_TRACING
id|sdp
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_SDESC_ENTRIES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|sdesc_entries
(braket
id|i
)braket
dot
id|scall_num
op_eq
id|g1
)paren
(brace
id|sdp
op_assign
op_amp
id|sdesc_entries
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sdp
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s(&quot;
comma
id|sdp-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sdp-&gt;num_args
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;,&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sdp-&gt;arg_is_string
(braket
id|i
)braket
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%08x&quot;
comma
(paren
r_int
r_int
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I0
op_plus
id|i
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|strncpy_from_user
c_func
(paren
id|scall_strbuf
comma
(paren
r_char
op_star
)paren
id|regs-&gt;u_regs
(braket
id|UREG_I0
op_plus
id|i
)braket
comma
l_int|512
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|scall_strbuf
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;) &quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|syscall_trace_exit
r_int
r_int
id|syscall_trace_exit
c_func
(paren
r_int
r_int
id|retval
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ret[%08x]&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|retval
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
macro_line|#endif /* SYSCALL_TRACING */
macro_line|#if 0
r_void
id|user_rtrap_report
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_static
r_int
id|hits
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Bwahhhhrggg... */
r_if
c_cond
(paren
id|regs-&gt;tpc
op_eq
l_int|0x1f294UL
op_logical_and
op_increment
id|hits
op_eq
l_int|2
)paren
(brace
r_register
r_int
r_int
id|ctx
id|asm
c_func
(paren
l_string|&quot;o4&quot;
)paren
suffix:semicolon
r_register
r_int
r_int
id|paddr
id|asm
c_func
(paren
l_string|&quot;o5&quot;
)paren
suffix:semicolon
r_int
r_int
id|cwp
comma
id|wstate
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;RT[%016lx:%016lx] &quot;
comma
id|regs-&gt;tpc
comma
id|regs-&gt;u_regs
(braket
id|UREG_I6
)braket
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;rdpr %%cwp, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|cwp
)paren
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;rdpr %%wstate, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|wstate
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CWP[%d] WSTATE[%016lx]&bslash;n&quot;
l_string|&quot;TSS( ksp[%016lx] kpc[%016lx] wstate[%016lx] w_saved[%d] flgs[%x]&quot;
l_string|&quot; cur_ds[%d] )&bslash;n&quot;
comma
id|cwp
comma
id|wstate
comma
id|current-&gt;tss.ksp
comma
id|current-&gt;tss.kpc
comma
id|current-&gt;tss.wstate
comma
(paren
r_int
)paren
id|current-&gt;tss.w_saved
comma
id|current-&gt;tss.flags
comma
id|current-&gt;tss.current_ds
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
"&quot;"
id|rdpr
op_mod
op_mod
id|pstate
comma
op_mod
op_mod
id|o3
id|wrpr
op_mod
op_mod
id|o3
comma
op_mod
l_int|2
comma
op_mod
op_mod
id|pstate
id|mov
op_mod
op_mod
id|g7
comma
op_mod
op_mod
id|o5
id|mov
l_int|0x10
comma
op_mod
op_mod
id|o4
id|ldxa
(braket
op_mod
op_mod
id|o4
)braket
op_mod
l_int|3
comma
op_mod
op_mod
id|o4
id|wrpr
op_mod
op_mod
id|o3
comma
l_int|0x0
comma
op_mod
op_mod
id|pstate
l_string|&quot; : &quot;
op_assign
id|r
l_string|&quot; (ctx), &quot;
op_assign
id|r
"&quot;"
(paren
id|paddr
)paren
suffix:colon
l_string|&quot;i&quot;
(paren
id|PSTATE_MG
op_or
id|PSTATE_IE
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_DMMU
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;MMU[ppgd(%016lx)sctx(%d)] &quot;
comma
id|paddr
comma
id|ctx
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;mm-&gt;context(%016lx) mm-&gt;pgd(%p)&bslash;n&quot;
comma
id|current-&gt;mm-&gt;context
comma
id|current-&gt;mm-&gt;pgd
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;TASK: signal[%016lx] blocked[%016lx]&bslash;n&quot;
comma
id|current-&gt;signal
comma
id|current-&gt;blocked
)paren
suffix:semicolon
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
DECL|function|bad_trap
r_void
id|bad_trap
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|lvl
)paren
(brace
id|lock_kernel
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lvl
OL
l_int|0x100
)paren
(brace
r_char
id|buffer
(braket
l_int|24
)braket
suffix:semicolon
id|sprintf
(paren
id|buffer
comma
l_string|&quot;Bad hw trap %lx at tl0&bslash;n&quot;
comma
id|lvl
)paren
suffix:semicolon
id|die_if_kernel
(paren
id|buffer
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
id|die_if_kernel
(paren
l_string|&quot;Kernel bad trap&quot;
comma
id|regs
)paren
suffix:semicolon
id|current-&gt;tss.sig_desc
op_assign
id|SUBSIG_BADTRAP
c_func
(paren
id|lvl
op_minus
l_int|0x100
)paren
suffix:semicolon
id|current-&gt;tss.sig_address
op_assign
id|regs-&gt;tpc
suffix:semicolon
id|send_sig
c_func
(paren
id|SIGILL
comma
id|current
comma
l_int|1
)paren
suffix:semicolon
id|unlock_kernel
(paren
)paren
suffix:semicolon
)brace
DECL|function|bad_trap_tl1
r_void
id|bad_trap_tl1
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|lvl
)paren
(brace
r_char
id|buffer
(braket
l_int|24
)braket
suffix:semicolon
id|lock_kernel
(paren
)paren
suffix:semicolon
id|sprintf
(paren
id|buffer
comma
l_string|&quot;Bad trap %lx at tl&gt;0&quot;
comma
id|lvl
)paren
suffix:semicolon
id|die_if_kernel
(paren
id|buffer
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|data_access_exception
r_void
id|data_access_exception
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|lock_kernel
(paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;Unhandled data access exception &quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;sfsr %016lx sfar %016lx&bslash;n&quot;
comma
id|spitfire_get_dsfsr
c_func
(paren
)paren
comma
id|spitfire_get_sfar
c_func
(paren
)paren
)paren
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;Data access exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_dae
r_void
id|do_dae
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DAE: at %016lx&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|instruction_access_exception
r_void
id|instruction_access_exception
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|lock_kernel
(paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;Unhandled instruction access exception &quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;sfsr %016lx&bslash;n&quot;
comma
id|spitfire_get_isfsr
c_func
(paren
)paren
)paren
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;Instruction access exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_iae
r_void
id|do_iae
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;IAE at %016lx&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_fpdis
r_void
id|do_fpdis
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;FPDIS: at %016lx&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_fpieee
r_void
id|do_fpieee
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;FPIEEE: at %016lx&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_fpother
r_void
id|do_fpother
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;FPOTHER: at %016lx&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_tof
r_void
id|do_tof
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;TOF: at %016lx&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_div0
r_void
id|do_div0
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DIV0: at %016lx&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|instruction_dump
r_void
id|instruction_dump
(paren
r_int
r_int
op_star
id|pc
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|pc
)paren
op_amp
l_int|3
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
op_minus
l_int|3
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%c%08x%c&quot;
comma
id|i
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;&lt;&squot;
comma
id|pc
(braket
id|i
)braket
comma
id|i
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;&gt;&squot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|die_if_kernel
r_void
id|die_if_kernel
c_func
(paren
r_char
op_star
id|str
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
multiline_comment|/* Amuse the user. */
id|printk
c_func
(paren
l_string|&quot;              &bslash;&bslash;|/ ____ &bslash;&bslash;|/&bslash;n&quot;
l_string|&quot;              &bslash;&quot;@&squot;/ .` &bslash;&bslash;`@&bslash;&quot;&bslash;n&quot;
l_string|&quot;              /_| &bslash;&bslash;__/ |_&bslash;&bslash;&bslash;n&quot;
l_string|&quot;                 &bslash;&bslash;__U_/&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s(%d): %s&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
id|str
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;flushw&quot;
)paren
suffix:semicolon
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
(brace
r_struct
id|reg_window
op_star
id|rw
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
(paren
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
op_plus
id|STACK_BIAS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rw
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Caller[%016lx]&bslash;n&quot;
comma
id|rw-&gt;ins
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|rw
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
(paren
id|rw-&gt;ins
(braket
l_int|6
)braket
op_plus
id|STACK_BIAS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rw
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Caller[%016lx]&bslash;n&quot;
comma
id|rw-&gt;ins
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|rw
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
(paren
id|rw-&gt;ins
(braket
l_int|6
)braket
op_plus
id|STACK_BIAS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rw
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Caller[%016lx]&bslash;n&quot;
comma
id|rw-&gt;ins
(braket
l_int|7
)braket
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;Instruction DUMP:&quot;
)paren
suffix:semicolon
id|instruction_dump
(paren
(paren
r_int
r_int
op_star
)paren
id|regs-&gt;tpc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|do_exit
c_func
(paren
id|SIGKILL
)paren
suffix:semicolon
)brace
id|do_exit
c_func
(paren
id|SIGSEGV
)paren
suffix:semicolon
)brace
DECL|function|do_illegal_instruction
r_void
id|do_illegal_instruction
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|pc
op_assign
id|regs-&gt;tpc
suffix:semicolon
r_int
r_int
id|tstate
op_assign
id|regs-&gt;tstate
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;Kernel illegal instruction&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
macro_line|#if 1
(brace
r_int
r_int
id|insn
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Ill instr. at pc=%016lx &quot;
comma
id|pc
)paren
suffix:semicolon
id|get_user
c_func
(paren
id|insn
comma
(paren
(paren
r_int
r_int
op_star
)paren
id|pc
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;insn=[%08x]&bslash;n&quot;
comma
id|insn
)paren
suffix:semicolon
)brace
macro_line|#endif
id|current-&gt;tss.sig_address
op_assign
id|pc
suffix:semicolon
id|current-&gt;tss.sig_desc
op_assign
id|SUBSIG_ILLINST
suffix:semicolon
id|send_sig
c_func
(paren
id|SIGILL
comma
id|current
comma
l_int|1
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_mna
r_void
id|do_mna
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AIEEE: do_mna at %016lx&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_privop
r_void
id|do_privop
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PRIVOP: at %016lx&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_privact
r_void
id|do_privact
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PRIVACT: at %016lx&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_priv_instruction
r_void
id|do_priv_instruction
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|pc
comma
r_int
r_int
id|npc
comma
r_int
r_int
id|tstate
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;Penguin instruction from Penguin mode??!?!&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
id|current-&gt;tss.sig_address
op_assign
id|pc
suffix:semicolon
id|current-&gt;tss.sig_desc
op_assign
id|SUBSIG_PRIVINST
suffix:semicolon
id|send_sig
c_func
(paren
id|SIGILL
comma
id|current
comma
l_int|1
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* XXX User may want to be allowed to do this. XXX */
DECL|function|do_memaccess_unaligned
r_void
id|do_memaccess_unaligned
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|pc
comma
r_int
r_int
id|npc
comma
r_int
r_int
id|tstate
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;KERNEL MNA at pc %016lx npc %016lx called by %016lx&bslash;n&quot;
comma
id|pc
comma
id|npc
comma
id|regs-&gt;u_regs
(braket
id|UREG_RETPC
)braket
)paren
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;BOGUS&quot;
comma
id|regs
)paren
suffix:semicolon
multiline_comment|/* die_if_kernel(&quot;Kernel MNA access&quot;, regs); */
)brace
id|current-&gt;tss.sig_address
op_assign
id|pc
suffix:semicolon
id|current-&gt;tss.sig_desc
op_assign
id|SUBSIG_PRIVINST
suffix:semicolon
macro_line|#if 0
id|show_regs
(paren
id|regs
)paren
suffix:semicolon
id|instruction_dump
(paren
(paren
r_int
r_int
op_star
)paren
id|regs-&gt;tpc
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;do_MNA!&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|send_sig
c_func
(paren
id|SIGBUS
comma
id|current
comma
l_int|1
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|handle_hw_divzero
r_void
id|handle_hw_divzero
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|pc
comma
r_int
r_int
id|npc
comma
r_int
r_int
id|psr
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|send_sig
c_func
(paren
id|SIGILL
comma
id|current
comma
l_int|1
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|trap_init
r_void
id|trap_init
c_func
(paren
r_void
)paren
(brace
)brace
eof
