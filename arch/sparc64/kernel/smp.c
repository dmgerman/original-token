multiline_comment|/* smp.c: Sparc64 SMP support.&n; *&n; * Copyright (C) 1997 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/tasks.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/kernel_stat.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/spinlock.h&gt;
macro_line|#include &lt;asm/hardirq.h&gt;
macro_line|#include &lt;asm/softirq.h&gt;
DECL|macro|__KERNEL_SYSCALLS__
mdefine_line|#define __KERNEL_SYSCALLS__
macro_line|#include &lt;linux/unistd.h&gt;
r_extern
r_int
id|linux_num_cpus
suffix:semicolon
r_extern
r_void
id|calibrate_delay
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|smp_processors_ready
r_volatile
r_int
id|smp_processors_ready
op_assign
l_int|0
suffix:semicolon
DECL|variable|cpu_present_map
r_int
r_int
id|cpu_present_map
op_assign
l_int|0
suffix:semicolon
DECL|variable|smp_num_cpus
r_int
id|smp_num_cpus
op_assign
l_int|1
suffix:semicolon
DECL|variable|smp_threads_ready
r_int
id|smp_threads_ready
op_assign
l_int|0
suffix:semicolon
DECL|variable|cpu_callin_map
r_volatile
r_int
r_int
id|cpu_callin_map
(braket
id|NR_CPUS
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|cpu_data
r_struct
id|cpuinfo_sparc
id|cpu_data
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|variable|boot_cpu_id
r_static
r_int
r_char
id|boot_cpu_id
op_assign
l_int|0
suffix:semicolon
DECL|variable|smp_activated
r_static
r_int
id|smp_activated
op_assign
l_int|0
suffix:semicolon
DECL|variable|cpu_number_map
r_volatile
r_int
id|cpu_number_map
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|variable|cpu_logical_map
r_volatile
r_int
id|cpu_logical_map
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|variable|klock_info
r_struct
id|klock_info
id|klock_info
op_assign
(brace
id|KLOCK_CLEAR
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|smp_commenced
r_static
r_volatile
r_int
id|smp_commenced
op_assign
l_int|0
suffix:semicolon
DECL|function|smp_setup
r_void
id|smp_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
(brace
multiline_comment|/* XXX implement me XXX */
)brace
DECL|variable|smp_buf
r_static
r_char
id|smp_buf
(braket
l_int|512
)braket
suffix:semicolon
DECL|function|smp_info
r_char
op_star
id|smp_info
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* XXX not SMP safe and need to support up to 64 penguins */
id|sprintf
c_func
(paren
id|smp_buf
comma
l_string|&quot;        CPU0&bslash;t&bslash;tCPU1&bslash;t&bslash;tCPU2&bslash;t&bslash;tCPU3&bslash;n&quot;
l_string|&quot;State:  %s&bslash;t&bslash;t%s&bslash;t&bslash;t%s&bslash;t&bslash;t%s&bslash;n&quot;
comma
(paren
id|cpu_present_map
op_amp
l_int|1
)paren
ques
c_cond
(paren
(paren
id|klock_info.akp
op_eq
l_int|0
)paren
ques
c_cond
l_string|&quot;akp&quot;
suffix:colon
l_string|&quot;online&quot;
)paren
suffix:colon
l_string|&quot;offline&quot;
comma
(paren
id|cpu_present_map
op_amp
l_int|2
)paren
ques
c_cond
(paren
(paren
id|klock_info.akp
op_eq
l_int|1
)paren
ques
c_cond
l_string|&quot;akp&quot;
suffix:colon
l_string|&quot;online&quot;
)paren
suffix:colon
l_string|&quot;offline&quot;
comma
(paren
id|cpu_present_map
op_amp
l_int|4
)paren
ques
c_cond
(paren
(paren
id|klock_info.akp
op_eq
l_int|2
)paren
ques
c_cond
l_string|&quot;akp&quot;
suffix:colon
l_string|&quot;online&quot;
)paren
suffix:colon
l_string|&quot;offline&quot;
comma
(paren
id|cpu_present_map
op_amp
l_int|8
)paren
ques
c_cond
(paren
(paren
id|klock_info.akp
op_eq
l_int|3
)paren
ques
c_cond
l_string|&quot;akp&quot;
suffix:colon
l_string|&quot;online&quot;
)paren
suffix:colon
l_string|&quot;offline&quot;
)paren
suffix:semicolon
r_return
id|smp_buf
suffix:semicolon
)brace
DECL|function|smp_store_cpu_info
r_void
id|smp_store_cpu_info
c_func
(paren
r_int
id|id
)paren
(brace
id|cpu_data
(braket
id|id
)braket
dot
id|udelay_val
op_assign
id|loops_per_sec
suffix:semicolon
)brace
DECL|function|smp_commence
r_void
id|smp_commence
c_func
(paren
r_void
)paren
(brace
id|flush_cache_all
c_func
(paren
)paren
suffix:semicolon
id|flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
id|smp_commenced
op_assign
l_int|1
suffix:semicolon
id|flush_cache_all
c_func
(paren
)paren
suffix:semicolon
id|flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_void
id|smp_setup_percpu_timer
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|callin_flag
r_static
r_volatile
r_int
r_int
id|callin_flag
op_assign
l_int|0
suffix:semicolon
DECL|function|smp_callin
r_void
id|smp_callin
c_func
(paren
r_void
)paren
(brace
r_int
id|cpuid
op_assign
id|hard_smp_processor_id
c_func
(paren
)paren
suffix:semicolon
id|flush_cache_all
c_func
(paren
)paren
suffix:semicolon
id|flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
id|smp_setup_percpu_timer
c_func
(paren
)paren
suffix:semicolon
id|calibrate_delay
c_func
(paren
)paren
suffix:semicolon
id|smp_store_cpu_info
c_func
(paren
id|cpuid
)paren
suffix:semicolon
id|callin_flag
op_assign
l_int|1
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;membar #Sync&bslash;n&bslash;t&quot;
l_string|&quot;flush  %%g6&quot;
suffix:colon
suffix:colon
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|task
(braket
id|cpuid
)braket
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
id|current
op_assign
id|task
(braket
id|cpuid
)braket
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|smp_commenced
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
id|__sti
c_func
(paren
)paren
suffix:semicolon
)brace
r_extern
r_int
id|cpu_idle
c_func
(paren
r_void
op_star
id|unused
)paren
suffix:semicolon
r_extern
r_void
id|init_IRQ
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|initialize_secondary
r_void
id|initialize_secondary
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|start_secondary
r_int
id|start_secondary
c_func
(paren
r_void
op_star
id|unused
)paren
(brace
id|trap_init
c_func
(paren
)paren
suffix:semicolon
id|init_IRQ
c_func
(paren
)paren
suffix:semicolon
id|smp_callin
c_func
(paren
)paren
suffix:semicolon
r_return
id|cpu_idle
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|cpu_panic
r_void
id|cpu_panic
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;CPU[%d]: Returns from cpu_idle!&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;SMP bolixed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_extern
r_struct
id|prom_cpuinfo
id|linux_cpus
(braket
id|NR_CPUS
)braket
suffix:semicolon
r_extern
r_int
r_int
id|sparc64_cpu_startup
suffix:semicolon
DECL|function|smp_boot_cpus
r_void
id|smp_boot_cpus
c_func
(paren
r_void
)paren
(brace
r_int
id|cpucount
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Entering UltraSMPenguin Mode...&bslash;n&quot;
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
id|cpu_present_map
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|linux_num_cpus
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cpu_present_map
op_or_assign
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cpu_number_map
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|cpu_logical_map
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|cpu_number_map
(braket
id|boot_cpu_id
)braket
op_assign
l_int|0
suffix:semicolon
id|cpu_logical_map
(braket
l_int|0
)braket
op_assign
id|boot_cpu_id
suffix:semicolon
id|klock_info.akp
op_assign
id|boot_cpu_id
suffix:semicolon
id|current-&gt;processor
op_assign
id|boot_cpu_id
suffix:semicolon
id|smp_store_cpu_info
c_func
(paren
id|boot_cpu_id
)paren
suffix:semicolon
id|smp_setup_percpu_timer
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|linux_num_cpus
op_eq
l_int|1
)paren
(brace
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|boot_cpu_id
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cpu_present_map
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
r_struct
id|task_struct
op_star
id|p
suffix:semicolon
r_int
id|timeout
suffix:semicolon
id|kernel_thread
c_func
(paren
id|start_secondary
comma
l_int|NULL
comma
id|CLONE_PID
)paren
suffix:semicolon
id|p
op_assign
id|task
(braket
op_increment
id|cpucount
)braket
suffix:semicolon
id|p-&gt;processor
op_assign
id|i
suffix:semicolon
id|prom_startcpu
c_func
(paren
id|linux_cpus
(braket
id|i
)braket
dot
id|prom_node
comma
(paren
(paren
r_int
r_int
)paren
op_amp
id|sparc64_cpu_startup
)paren
comma
(paren
(paren
r_int
r_int
)paren
id|p
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|0
suffix:semicolon
id|timeout
OL
l_int|5000000
suffix:semicolon
id|timeout
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cpu_callin_map
(braket
id|i
)braket
)paren
(brace
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cpu_callin_map
(braket
id|i
)braket
)paren
(brace
multiline_comment|/* XXX fix this */
id|cpu_number_map
(braket
id|i
)braket
op_assign
id|i
suffix:semicolon
id|cpu_logical_map
(braket
id|i
)braket
op_assign
id|i
suffix:semicolon
)brace
r_else
(brace
id|cpucount
op_decrement
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Processor %d is stuck.&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cpu_callin_map
(braket
id|i
)braket
)paren
)paren
(brace
id|cpu_present_map
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
id|cpu_number_map
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cpucount
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Error: only one processor found.&bslash;n&quot;
)paren
suffix:semicolon
id|cpu_present_map
op_assign
(paren
l_int|1
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|bogosum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cpu_present_map
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|bogosum
op_add_assign
id|cpu_data
(braket
id|i
)braket
dot
id|udelay_val
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;Total of %d processors activated (%lu.%02lu BogoMIPS).&bslash;n&quot;
comma
id|cpucount
op_plus
l_int|1
comma
(paren
id|bogosum
op_plus
l_int|2500
)paren
op_div
l_int|500000
comma
(paren
(paren
id|bogosum
op_plus
l_int|2500
)paren
op_div
l_int|5000
)paren
op_mod
l_int|100
)paren
suffix:semicolon
id|smp_activated
op_assign
l_int|1
suffix:semicolon
id|smp_num_cpus
op_assign
id|cpucount
op_plus
l_int|1
suffix:semicolon
)brace
id|smp_processors_ready
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* XXX deprecated interface... */
DECL|function|smp_message_pass
r_void
id|smp_message_pass
c_func
(paren
r_int
id|target
comma
r_int
id|msg
comma
r_int
r_int
id|data
comma
r_int
id|wait
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;smp_message_pass() called, this is bad, spinning.&bslash;n&quot;
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|xcall_deliver
r_static
r_inline
r_void
id|xcall_deliver
c_func
(paren
id|u64
id|data0
comma
id|u64
id|data1
comma
id|u64
id|data2
comma
id|u64
id|pstate
comma
r_int
id|cpu
)paren
(brace
id|u64
id|result
comma
id|target
op_assign
(paren
id|cpu_number_map
(braket
id|cpu
)braket
op_lshift
l_int|14
)paren
op_or
l_int|0x70
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
"&quot;"
id|wrpr
op_mod
l_int|0
comma
op_mod
l_int|1
comma
op_mod
op_mod
id|pstate
id|wr
op_mod
op_mod
id|g0
comma
op_mod
l_int|2
comma
op_mod
op_mod
id|asi
id|stxa
op_mod
l_int|3
comma
(braket
l_int|0x40
)braket
op_mod
op_mod
id|asi
id|stxa
op_mod
l_int|4
comma
(braket
l_int|0x50
)braket
op_mod
op_mod
id|asi
id|stxa
op_mod
l_int|5
comma
(braket
l_int|0x60
)braket
op_mod
op_mod
id|asi
id|stxa
op_mod
op_mod
id|g0
comma
(braket
op_mod
l_int|6
)braket
op_mod
op_mod
id|asi
id|membar
macro_line|#Sync&quot;
suffix:colon
multiline_comment|/* No outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
id|pstate
)paren
comma
l_string|&quot;i&quot;
(paren
id|PSTATE_IE
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_UDB_INTR_W
)paren
comma
l_string|&quot;r&quot;
(paren
id|data0
)paren
comma
l_string|&quot;r&quot;
(paren
id|data1
)paren
comma
l_string|&quot;r&quot;
(paren
id|data2
)paren
comma
l_string|&quot;r&quot;
(paren
id|target
)paren
)paren
suffix:semicolon
multiline_comment|/* NOTE: PSTATE_IE is still clear. */
r_do
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %1, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|result
)paren
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_INTR_DISPATCH_STAT
)paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|result
op_amp
l_int|0x1
)paren
(brace
suffix:semicolon
)brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;wrpr %0, 0x0, %%pstate&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|pstate
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_amp
l_int|0x2
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Penguin NACK&squot;s master!&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|smp_cross_call
r_void
id|smp_cross_call
c_func
(paren
r_int
r_int
op_star
id|func
comma
id|u32
id|ctx
comma
id|u64
id|data1
comma
id|u64
id|data2
)paren
(brace
r_if
c_cond
(paren
id|smp_processors_ready
)paren
(brace
r_int
r_int
id|mask
op_assign
(paren
id|cpu_present_map
op_amp
op_complement
(paren
l_int|1
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
id|u64
id|pstate
comma
id|data0
op_assign
(paren
(paren
(paren
id|u64
)paren
id|ctx
)paren
op_lshift
l_int|32
op_or
(paren
(paren
(paren
id|u64
)paren
id|func
)paren
op_amp
l_int|0xffffffff
)paren
)paren
suffix:semicolon
r_int
id|i
comma
id|ncpus
op_assign
id|smp_num_cpus
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;rdpr %%pstate, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|pstate
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ncpus
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|mask
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|xcall_deliver
c_func
(paren
id|data0
comma
id|data1
comma
id|data2
comma
id|pstate
comma
id|i
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* NOTE: Caller runs local copy on master. */
)brace
)brace
r_extern
r_int
r_int
id|xcall_flush_tlb_page
suffix:semicolon
r_extern
r_int
r_int
id|xcall_flush_tlb_mm
suffix:semicolon
r_extern
r_int
r_int
id|xcall_flush_tlb_range
suffix:semicolon
r_extern
r_int
r_int
id|xcall_flush_tlb_all
suffix:semicolon
r_extern
r_int
r_int
id|xcall_flush_cache_all
suffix:semicolon
DECL|function|smp_flush_cache_all
r_void
id|smp_flush_cache_all
c_func
(paren
r_void
)paren
(brace
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_flush_cache_all
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|__flush_cache_all
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_tlb_all
r_void
id|smp_flush_tlb_all
c_func
(paren
r_void
)paren
(brace
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_flush_tlb_all
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|__flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_tlb_mm
r_void
id|smp_flush_tlb_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
id|u32
id|ctx
op_assign
id|mm-&gt;context
op_amp
l_int|0x1fff
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;cpu_vm_mask
op_ne
(paren
l_int|1UL
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
(brace
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_flush_tlb_mm
comma
id|ctx
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|__flush_tlb_mm
c_func
(paren
id|ctx
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_tlb_range
r_void
id|smp_flush_tlb_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|u32
id|ctx
op_assign
id|mm-&gt;context
op_amp
l_int|0x1fff
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;cpu_vm_mask
op_ne
(paren
l_int|1UL
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
(brace
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_flush_tlb_range
comma
id|ctx
comma
id|start
comma
id|end
)paren
suffix:semicolon
)brace
id|__flush_tlb_range
c_func
(paren
id|ctx
comma
id|start
comma
id|end
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_tlb_page
r_void
id|smp_flush_tlb_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
id|u32
id|ctx
op_assign
id|mm-&gt;context
op_amp
l_int|0x1fff
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;cpu_vm_mask
op_ne
(paren
l_int|1UL
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
(brace
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_flush_tlb_page
comma
id|ctx
comma
id|page
comma
l_int|0
)paren
suffix:semicolon
)brace
id|__flush_tlb_page
c_func
(paren
id|ctx
comma
id|page
)paren
suffix:semicolon
)brace
DECL|variable|ticker_lock
r_static
id|spinlock_t
id|ticker_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|function|sparc64_do_profile
r_static
r_inline
r_void
id|sparc64_do_profile
c_func
(paren
r_int
r_int
id|pc
)paren
(brace
r_if
c_cond
(paren
id|prof_buffer
op_logical_and
id|current-&gt;pid
)paren
(brace
r_extern
r_int
id|_stext
suffix:semicolon
id|pc
op_sub_assign
(paren
r_int
r_int
)paren
op_amp
id|_stext
suffix:semicolon
id|pc
op_rshift_assign
id|prof_shift
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|ticker_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pc
OL
id|prof_len
)paren
(brace
id|prof_buffer
(braket
id|pc
)braket
op_increment
suffix:semicolon
)brace
r_else
id|prof_buffer
(braket
id|prof_len
op_minus
l_int|1
)braket
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|ticker_lock
)paren
suffix:semicolon
)brace
)brace
DECL|variable|prof_multiplier
r_int
r_int
id|prof_multiplier
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|variable|prof_counter
r_int
r_int
id|prof_counter
(braket
id|NR_CPUS
)braket
suffix:semicolon
r_extern
r_void
id|update_one_process
c_func
(paren
r_struct
id|task_struct
op_star
id|p
comma
r_int
r_int
id|ticks
comma
r_int
r_int
id|user
comma
r_int
r_int
id|system
)paren
suffix:semicolon
DECL|function|smp_percpu_timer_interrupt
r_void
id|smp_percpu_timer_interrupt
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|cpu
op_assign
id|smp_processor_id
c_func
(paren
)paren
suffix:semicolon
r_int
id|user
op_assign
id|user_mode
c_func
(paren
id|regs
)paren
suffix:semicolon
multiline_comment|/* XXX clear_profile_irq(cpu); */
r_if
c_cond
(paren
op_logical_neg
id|user
)paren
(brace
id|sparc64_do_profile
c_func
(paren
id|regs-&gt;tpc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|prof_counter
(braket
id|cpu
)braket
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;pid
)paren
(brace
id|update_one_process
c_func
(paren
id|current
comma
l_int|1
comma
id|user
comma
op_logical_neg
id|user
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|current-&gt;counter
OL
l_int|0
)paren
(brace
id|current-&gt;counter
op_assign
l_int|0
suffix:semicolon
id|need_resched
op_assign
l_int|1
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|ticker_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;priority
OL
id|DEF_PRIORITY
)paren
(brace
id|kstat.cpu_nice
op_increment
suffix:semicolon
)brace
r_else
id|kstat.cpu_user
op_increment
suffix:semicolon
)brace
r_else
(brace
id|kstat.cpu_system
op_increment
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|ticker_lock
)paren
suffix:semicolon
)brace
id|prof_counter
(braket
id|cpu
)braket
op_assign
id|prof_multiplier
(braket
id|cpu
)braket
suffix:semicolon
)brace
)brace
DECL|function|smp_setup_percpu_timer
r_static
r_void
id|smp_setup_percpu_timer
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* XXX implement me */
)brace
DECL|function|setup_profiling_timer
r_int
id|setup_profiling_timer
c_func
(paren
r_int
r_int
id|multiplier
)paren
(brace
multiline_comment|/* XXX implement me */
r_return
l_int|0
suffix:semicolon
)brace
eof
