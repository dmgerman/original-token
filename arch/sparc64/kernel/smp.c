multiline_comment|/* smp.c: Sparc64 SMP support.&n; *&n; * Copyright (C) 1997 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/tasks.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/kernel_stat.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/head.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/spinlock.h&gt;
macro_line|#include &lt;asm/hardirq.h&gt;
macro_line|#include &lt;asm/softirq.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/timer.h&gt;
DECL|macro|__KERNEL_SYSCALLS__
mdefine_line|#define __KERNEL_SYSCALLS__
macro_line|#include &lt;linux/unistd.h&gt;
r_extern
r_int
id|linux_num_cpus
suffix:semicolon
r_extern
r_void
id|calibrate_delay
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|prom_cpu_nodes
(braket
)braket
suffix:semicolon
DECL|variable|smp_processors_ready
r_volatile
r_int
id|smp_processors_ready
op_assign
l_int|0
suffix:semicolon
DECL|variable|cpu_present_map
r_int
r_int
id|cpu_present_map
op_assign
l_int|0
suffix:semicolon
DECL|variable|smp_num_cpus
r_int
id|smp_num_cpus
op_assign
l_int|1
suffix:semicolon
DECL|variable|smp_threads_ready
r_int
id|smp_threads_ready
op_assign
l_int|0
suffix:semicolon
DECL|variable|cpu_data
r_struct
id|cpuinfo_sparc
id|cpu_data
(braket
id|NR_CPUS
)braket
id|__attribute__
(paren
(paren
id|aligned
(paren
l_int|64
)paren
)paren
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
r_char
id|boot_cpu_id
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|smp_activated
r_static
r_int
id|smp_activated
op_assign
l_int|0
suffix:semicolon
DECL|variable|cpu_number_map
r_volatile
r_int
id|cpu_number_map
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|variable|__cpu_logical_map
r_volatile
r_int
id|__cpu_logical_map
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|variable|klock_info
r_struct
id|klock_info
id|klock_info
op_assign
(brace
id|KLOCK_CLEAR
comma
l_int|0
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|smp_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
)paren
(brace
multiline_comment|/* XXX implement me XXX */
)brace
DECL|function|smp_info
r_int
id|smp_info
c_func
(paren
r_char
op_star
id|buf
)paren
(brace
r_int
id|len
op_assign
l_int|7
comma
id|i
suffix:semicolon
id|strcpy
c_func
(paren
id|buf
comma
l_string|&quot;State:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cpu_present_map
op_amp
(paren
l_int|1UL
op_lshift
id|i
)paren
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;CPU%d:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|i
comma
id|klock_info.akp
op_eq
id|i
ques
c_cond
l_string|&quot;akp&quot;
suffix:colon
l_string|&quot;online&quot;
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|smp_bogo
r_int
id|smp_bogo
c_func
(paren
r_char
op_star
id|buf
)paren
(brace
r_int
id|len
op_assign
l_int|0
comma
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cpu_present_map
op_amp
(paren
l_int|1UL
op_lshift
id|i
)paren
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Cpu%dBogo&bslash;t: %lu.%02lu&bslash;n&quot;
comma
id|i
comma
id|cpu_data
(braket
id|i
)braket
dot
id|udelay_val
op_div
l_int|500000
comma
(paren
id|cpu_data
(braket
id|i
)braket
dot
id|udelay_val
op_div
l_int|5000
)paren
op_mod
l_int|100
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|smp_store_cpu_info
c_func
(paren
r_int
id|id
)paren
)paren
(brace
id|cpu_data
(braket
id|id
)braket
dot
id|udelay_val
op_assign
id|loops_per_sec
suffix:semicolon
id|cpu_data
(braket
id|id
)braket
dot
id|irq_count
op_assign
l_int|0
suffix:semicolon
id|cpu_data
(braket
id|id
)braket
dot
id|pgcache_size
op_assign
l_int|0
suffix:semicolon
id|cpu_data
(braket
id|id
)braket
dot
id|pgd_cache
op_assign
l_int|NULL
suffix:semicolon
id|cpu_data
(braket
id|id
)braket
dot
id|pmd_cache
op_assign
l_int|NULL
suffix:semicolon
id|cpu_data
(braket
id|id
)braket
dot
id|pte_cache
op_assign
l_int|NULL
suffix:semicolon
)brace
r_extern
r_void
id|distribute_irqs
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|smp_commence
c_func
(paren
r_void
)paren
)paren
(brace
id|distribute_irqs
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_void
id|smp_setup_percpu_timer
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|callin_flag
r_static
r_volatile
r_int
r_int
id|callin_flag
op_assign
l_int|0
suffix:semicolon
r_extern
r_void
id|inherit_locked_prom_mappings
c_func
(paren
r_int
id|save_p
)paren
suffix:semicolon
r_extern
r_void
id|cpu_probe
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|smp_callin
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|cpuid
op_assign
id|hard_smp_processor_id
c_func
(paren
)paren
suffix:semicolon
id|inherit_locked_prom_mappings
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|__flush_cache_all
c_func
(paren
)paren
suffix:semicolon
id|__flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
id|cpu_probe
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Master did this already, now is the time for us to do it. */
id|__asm__
id|__volatile__
c_func
(paren
"&quot;"
id|sethi
op_mod
op_mod
id|hi
c_func
(paren
l_int|0x80000000
)paren
comma
op_mod
op_mod
id|g1
id|sllx
op_mod
op_mod
id|g1
comma
l_int|32
comma
op_mod
op_mod
id|g1
id|rd
op_mod
op_mod
id|tick
comma
op_mod
op_mod
id|g2
id|add
op_mod
op_mod
id|g2
comma
l_int|6
comma
op_mod
op_mod
id|g2
id|andn
op_mod
op_mod
id|g2
comma
op_mod
op_mod
id|g1
comma
op_mod
op_mod
id|g2
id|wrpr
op_mod
op_mod
id|g2
comma
l_int|0
comma
op_mod
op_mod
id|tick
"&quot;"
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
multiline_comment|/* no inputs */
suffix:colon
l_string|&quot;g1&quot;
comma
l_string|&quot;g2&quot;
)paren
suffix:semicolon
id|smp_setup_percpu_timer
c_func
(paren
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
id|calibrate_delay
c_func
(paren
)paren
suffix:semicolon
id|smp_store_cpu_info
c_func
(paren
id|cpuid
)paren
suffix:semicolon
id|callin_flag
op_assign
l_int|1
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;membar #Sync&bslash;n&bslash;t&quot;
l_string|&quot;flush  %%g6&quot;
suffix:colon
suffix:colon
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|smp_processors_ready
)paren
(brace
id|membar
c_func
(paren
l_string|&quot;#LoadLoad&quot;
)paren
suffix:semicolon
)brace
)brace
r_extern
r_int
id|cpu_idle
c_func
(paren
r_void
op_star
id|unused
)paren
suffix:semicolon
r_extern
r_void
id|init_IRQ
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|initialize_secondary
r_void
id|initialize_secondary
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|start_secondary
r_int
id|start_secondary
c_func
(paren
r_void
op_star
id|unused
)paren
(brace
id|trap_init
c_func
(paren
)paren
suffix:semicolon
id|init_IRQ
c_func
(paren
)paren
suffix:semicolon
id|smp_callin
c_func
(paren
)paren
suffix:semicolon
r_return
id|cpu_idle
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|cpu_panic
r_void
id|cpu_panic
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;CPU[%d]: Returns from cpu_idle!&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;SMP bolixed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
id|smp_tickoffset_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_struct
id|prom_cpuinfo
id|linux_cpus
(braket
id|NR_CPUS
)braket
suffix:semicolon
r_extern
r_int
r_int
id|smp_trampoline
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|smp_boot_cpus
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|cpucount
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Entering UltraSMPenguin Mode...&bslash;n&quot;
)paren
suffix:semicolon
id|boot_cpu_id
op_assign
id|hard_smp_processor_id
c_func
(paren
)paren
suffix:semicolon
id|smp_tickoffset_init
c_func
(paren
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
id|cpu_present_map
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|linux_num_cpus
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cpu_present_map
op_or_assign
(paren
l_int|1UL
op_lshift
id|linux_cpus
(braket
id|i
)braket
dot
id|mid
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cpu_number_map
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|__cpu_logical_map
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|cpu_number_map
(braket
id|boot_cpu_id
)braket
op_assign
l_int|0
suffix:semicolon
id|prom_cpu_nodes
(braket
id|boot_cpu_id
)braket
op_assign
id|linux_cpus
(braket
l_int|0
)braket
dot
id|prom_node
suffix:semicolon
id|__cpu_logical_map
(braket
l_int|0
)braket
op_assign
id|boot_cpu_id
suffix:semicolon
id|klock_info.akp
op_assign
id|boot_cpu_id
suffix:semicolon
id|current-&gt;processor
op_assign
id|boot_cpu_id
suffix:semicolon
id|smp_store_cpu_info
c_func
(paren
id|boot_cpu_id
)paren
suffix:semicolon
id|smp_setup_percpu_timer
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|linux_num_cpus
op_eq
l_int|1
)paren
(brace
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|boot_cpu_id
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cpu_present_map
op_amp
(paren
l_int|1UL
op_lshift
id|i
)paren
)paren
(brace
r_int
r_int
id|entry
op_assign
(paren
r_int
r_int
)paren
(paren
op_amp
id|smp_trampoline
)paren
suffix:semicolon
r_struct
id|task_struct
op_star
id|p
suffix:semicolon
r_int
id|timeout
suffix:semicolon
r_int
id|no
suffix:semicolon
r_extern
r_int
r_int
id|phys_base
suffix:semicolon
id|entry
op_add_assign
id|phys_base
op_minus
id|KERNBASE
suffix:semicolon
id|kernel_thread
c_func
(paren
id|start_secondary
comma
l_int|NULL
comma
id|CLONE_PID
)paren
suffix:semicolon
id|p
op_assign
id|task
(braket
op_increment
id|cpucount
)braket
suffix:semicolon
id|p-&gt;processor
op_assign
id|i
suffix:semicolon
id|callin_flag
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|no
op_assign
l_int|0
suffix:semicolon
id|no
OL
id|linux_num_cpus
suffix:semicolon
id|no
op_increment
)paren
r_if
c_cond
(paren
id|linux_cpus
(braket
id|no
)braket
dot
id|mid
op_eq
id|i
)paren
r_break
suffix:semicolon
id|prom_startcpu
c_func
(paren
id|linux_cpus
(braket
id|no
)braket
dot
id|prom_node
comma
id|entry
comma
(paren
(paren
r_int
r_int
)paren
id|p
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|0
suffix:semicolon
id|timeout
OL
l_int|5000000
suffix:semicolon
id|timeout
op_increment
)paren
(brace
r_if
c_cond
(paren
id|callin_flag
)paren
(brace
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|callin_flag
)paren
(brace
id|cpu_number_map
(braket
id|i
)braket
op_assign
id|cpucount
suffix:semicolon
id|prom_cpu_nodes
(braket
id|i
)braket
op_assign
id|linux_cpus
(braket
id|no
)braket
dot
id|prom_node
suffix:semicolon
id|__cpu_logical_map
(braket
id|cpucount
)braket
op_assign
id|i
suffix:semicolon
)brace
r_else
(brace
id|cpucount
op_decrement
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Processor %d is stuck.&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|callin_flag
)paren
(brace
id|cpu_present_map
op_and_assign
op_complement
(paren
l_int|1UL
op_lshift
id|i
)paren
suffix:semicolon
id|cpu_number_map
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cpucount
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Error: only one processor found.&bslash;n&quot;
)paren
suffix:semicolon
id|cpu_present_map
op_assign
(paren
l_int|1UL
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|bogosum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cpu_present_map
op_amp
(paren
l_int|1UL
op_lshift
id|i
)paren
)paren
(brace
id|bogosum
op_add_assign
id|cpu_data
(braket
id|i
)braket
dot
id|udelay_val
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;Total of %d processors activated (%lu.%02lu BogoMIPS).&bslash;n&quot;
comma
id|cpucount
op_plus
l_int|1
comma
(paren
id|bogosum
op_plus
l_int|2500
)paren
op_div
l_int|500000
comma
(paren
(paren
id|bogosum
op_plus
l_int|2500
)paren
op_div
l_int|5000
)paren
op_mod
l_int|100
)paren
suffix:semicolon
id|smp_activated
op_assign
l_int|1
suffix:semicolon
id|smp_num_cpus
op_assign
id|cpucount
op_plus
l_int|1
suffix:semicolon
)brace
id|smp_processors_ready
op_assign
l_int|1
suffix:semicolon
id|membar
c_func
(paren
l_string|&quot;#StoreStore | #StoreLoad&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* We don&squot;t even need to do anything, the only generic message pass done&n; * anymore is to stop all cpus during a panic().  When the user drops to&n; * the PROM prompt, the firmware will send the other cpu&squot;s it&squot;s MONDO&n; * vector anyways, so doing anything special here is pointless.&n; *&n; * This whole thing should go away anyways...&n; */
DECL|function|smp_message_pass
r_void
id|smp_message_pass
c_func
(paren
r_int
id|target
comma
r_int
id|msg
comma
r_int
r_int
id|data
comma
r_int
id|wait
)paren
(brace
)brace
multiline_comment|/* #define XCALL_DEBUG */
DECL|function|xcall_deliver
r_static
r_inline
r_void
id|xcall_deliver
c_func
(paren
id|u64
id|data0
comma
id|u64
id|data1
comma
id|u64
id|data2
comma
id|u64
id|pstate
comma
r_int
r_int
id|cpu
)paren
(brace
id|u64
id|result
comma
id|target
op_assign
(paren
id|cpu
op_lshift
l_int|14
)paren
op_or
l_int|0x70
suffix:semicolon
r_int
id|stuck
suffix:semicolon
macro_line|#ifdef XCALL_DEBUG
id|printk
c_func
(paren
l_string|&quot;CPU[%d]: xcall(data[%016lx:%016lx:%016lx],tgt[%016lx])&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|data0
comma
id|data1
comma
id|data2
comma
id|target
)paren
suffix:semicolon
macro_line|#endif
id|again
suffix:colon
id|__asm__
id|__volatile__
c_func
(paren
"&quot;"
id|wrpr
op_mod
l_int|0
comma
op_mod
l_int|1
comma
op_mod
op_mod
id|pstate
id|wr
op_mod
op_mod
id|g0
comma
op_mod
l_int|2
comma
op_mod
op_mod
id|asi
id|stxa
op_mod
l_int|3
comma
(braket
l_int|0x40
)braket
op_mod
op_mod
id|asi
id|stxa
op_mod
l_int|4
comma
(braket
l_int|0x50
)braket
op_mod
op_mod
id|asi
id|stxa
op_mod
l_int|5
comma
(braket
l_int|0x60
)braket
op_mod
op_mod
id|asi
id|membar
macro_line|#Sync
id|stxa
op_mod
op_mod
id|g0
comma
(braket
op_mod
l_int|6
)braket
op_mod
op_mod
id|asi
id|membar
macro_line|#Sync&quot;
suffix:colon
multiline_comment|/* No outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
id|pstate
)paren
comma
l_string|&quot;i&quot;
(paren
id|PSTATE_IE
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_UDB_INTR_W
)paren
comma
l_string|&quot;r&quot;
(paren
id|data0
)paren
comma
l_string|&quot;r&quot;
(paren
id|data1
)paren
comma
l_string|&quot;r&quot;
(paren
id|data2
)paren
comma
l_string|&quot;r&quot;
(paren
id|target
)paren
)paren
suffix:semicolon
multiline_comment|/* NOTE: PSTATE_IE is still clear. */
id|stuck
op_assign
l_int|100000
suffix:semicolon
r_do
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %1, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|result
)paren
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_INTR_DISPATCH_STAT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
l_int|0
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;wrpr %0, 0x0, %%pstate&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|pstate
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|stuck
op_sub_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|stuck
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|result
op_amp
l_int|0x1
)paren
(brace
suffix:semicolon
)brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;wrpr %0, 0x0, %%pstate&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|pstate
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stuck
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef XCALL_DEBUG
id|printk
c_func
(paren
l_string|&quot;CPU[%d]: mondo stuckage result[%016lx]&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|result
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef XCALL_DEBUG
id|printk
c_func
(paren
l_string|&quot;CPU[%d]: Penguin %d NACK&squot;s master.&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpu
)paren
suffix:semicolon
macro_line|#endif
id|udelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_goto
id|again
suffix:semicolon
)brace
)brace
DECL|function|smp_cross_call
r_void
id|smp_cross_call
c_func
(paren
r_int
r_int
op_star
id|func
comma
id|u32
id|ctx
comma
id|u64
id|data1
comma
id|u64
id|data2
)paren
(brace
r_if
c_cond
(paren
id|smp_processors_ready
)paren
(brace
r_int
r_int
id|mask
op_assign
(paren
id|cpu_present_map
op_amp
op_complement
(paren
l_int|1UL
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
id|u64
id|pstate
comma
id|data0
op_assign
(paren
(paren
(paren
id|u64
)paren
id|ctx
)paren
op_lshift
l_int|32
op_or
(paren
(paren
(paren
id|u64
)paren
id|func
)paren
op_amp
l_int|0xffffffff
)paren
)paren
suffix:semicolon
r_int
id|i
comma
id|ncpus
op_assign
id|smp_num_cpus
op_minus
l_int|1
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;rdpr %%pstate, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|pstate
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|mask
op_amp
(paren
l_int|1UL
op_lshift
id|i
)paren
)paren
(brace
id|xcall_deliver
c_func
(paren
id|data0
comma
id|data1
comma
id|data2
comma
id|pstate
comma
id|i
)paren
suffix:semicolon
id|ncpus
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ncpus
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/* NOTE: Caller runs local copy on master. */
)brace
)brace
r_extern
r_int
r_int
id|xcall_flush_tlb_page
suffix:semicolon
r_extern
r_int
r_int
id|xcall_flush_tlb_mm
suffix:semicolon
r_extern
r_int
r_int
id|xcall_flush_tlb_range
suffix:semicolon
r_extern
r_int
r_int
id|xcall_flush_tlb_all
suffix:semicolon
r_extern
r_int
r_int
id|xcall_tlbcachesync
suffix:semicolon
r_extern
r_int
r_int
id|xcall_flush_cache_all
suffix:semicolon
r_extern
r_int
r_int
id|xcall_report_regs
suffix:semicolon
DECL|function|smp_report_regs
r_void
id|smp_report_regs
c_func
(paren
r_void
)paren
(brace
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_report_regs
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_cache_all
r_void
id|smp_flush_cache_all
c_func
(paren
r_void
)paren
(brace
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_flush_cache_all
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|__flush_cache_all
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_tlb_all
r_void
id|smp_flush_tlb_all
c_func
(paren
r_void
)paren
(brace
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_flush_tlb_all
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|__flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* We know that the window frames of the user have been flushed&n; * to the stack before we get here because all callers of us&n; * are flush_tlb_*() routines, and these run after flush_cache_*()&n; * which performs the flushw.&n; */
DECL|function|smp_cross_call_avoidance
r_static
r_void
id|smp_cross_call_avoidance
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
id|u32
id|ctx
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|scheduler_lock
)paren
suffix:semicolon
id|get_new_mmu_context
c_func
(paren
id|mm
)paren
suffix:semicolon
id|mm-&gt;cpu_vm_mask
op_assign
(paren
l_int|1UL
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
id|current-&gt;tss.ctx
op_assign
id|ctx
op_assign
id|mm-&gt;context
op_amp
l_int|0x3ff
suffix:semicolon
id|spitfire_set_secondary_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;flush %g6&quot;
)paren
suffix:semicolon
id|spitfire_flush_dtlb_secondary_context
c_func
(paren
)paren
suffix:semicolon
id|spitfire_flush_itlb_secondary_context
c_func
(paren
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;flush %g6&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|segment_eq
c_func
(paren
id|current-&gt;tss.current_ds
comma
id|USER_DS
)paren
)paren
(brace
multiline_comment|/* Rarely happens. */
id|current-&gt;tss.ctx
op_assign
l_int|0
suffix:semicolon
id|spitfire_set_secondary_context
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;flush %g6&quot;
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|scheduler_lock
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_tlb_mm
r_void
id|smp_flush_tlb_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
id|u32
id|ctx
op_assign
id|mm-&gt;context
op_amp
l_int|0x3ff
suffix:semicolon
r_if
c_cond
(paren
id|mm
op_eq
id|current-&gt;mm
op_logical_and
id|mm-&gt;count
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|mm-&gt;cpu_vm_mask
op_eq
(paren
l_int|1UL
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
(brace
r_goto
id|local_flush_and_out
suffix:semicolon
)brace
r_return
id|smp_cross_call_avoidance
c_func
(paren
id|mm
)paren
suffix:semicolon
)brace
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_flush_tlb_mm
comma
id|ctx
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|local_flush_and_out
suffix:colon
id|__flush_tlb_mm
c_func
(paren
id|ctx
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_tlb_range
r_void
id|smp_flush_tlb_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|u32
id|ctx
op_assign
id|mm-&gt;context
op_amp
l_int|0x3ff
suffix:semicolon
r_if
c_cond
(paren
id|mm
op_eq
id|current-&gt;mm
op_logical_and
id|mm-&gt;count
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|mm-&gt;cpu_vm_mask
op_eq
(paren
l_int|1UL
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
(brace
r_goto
id|local_flush_and_out
suffix:semicolon
)brace
r_return
id|smp_cross_call_avoidance
c_func
(paren
id|mm
)paren
suffix:semicolon
)brace
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_flush_tlb_range
comma
id|ctx
comma
id|start
comma
id|end
)paren
suffix:semicolon
id|local_flush_and_out
suffix:colon
id|__flush_tlb_range
c_func
(paren
id|ctx
comma
id|start
comma
id|end
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_tlb_page
r_void
id|smp_flush_tlb_page
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|page
)paren
(brace
id|u32
id|ctx
op_assign
id|mm-&gt;context
op_amp
l_int|0x3ff
suffix:semicolon
r_if
c_cond
(paren
id|mm
op_eq
id|current-&gt;mm
op_logical_and
id|mm-&gt;count
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|mm-&gt;cpu_vm_mask
op_eq
(paren
l_int|1UL
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
(brace
r_goto
id|local_flush_and_out
suffix:semicolon
)brace
r_return
id|smp_cross_call_avoidance
c_func
(paren
id|mm
)paren
suffix:semicolon
)brace
macro_line|#if 0 /* XXX Disabled until further notice... */
r_else
r_if
c_cond
(paren
id|mm-&gt;count
op_eq
l_int|1
)paren
(brace
multiline_comment|/* Try to handle two special cases to avoid cross calls&n;&t;&t; * in common scenerios where we are swapping process&n;&t;&t; * pages out.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|mm-&gt;context
op_xor
id|tlb_context_cache
)paren
op_amp
id|CTX_VERSION_MASK
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/* It&squot;s dead, nothing to do. */
r_if
c_cond
(paren
id|mm-&gt;cpu_vm_mask
op_eq
(paren
l_int|1UL
op_lshift
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
(brace
r_goto
id|local_flush_and_out
suffix:semicolon
)brace
)brace
macro_line|#endif
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_flush_tlb_page
comma
id|ctx
comma
id|page
comma
l_int|0
)paren
suffix:semicolon
id|local_flush_and_out
suffix:colon
id|__flush_tlb_page
c_func
(paren
id|ctx
comma
id|page
)paren
suffix:semicolon
)brace
multiline_comment|/* CPU capture. */
DECL|macro|CAPTURE_DEBUG
mdefine_line|#define CAPTURE_DEBUG
r_extern
r_int
r_int
id|xcall_capture
suffix:semicolon
DECL|variable|smp_capture_depth
r_static
id|atomic_t
id|smp_capture_depth
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
DECL|variable|smp_capture_registry
r_static
id|atomic_t
id|smp_capture_registry
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
DECL|variable|penguins_are_doing_time
r_static
r_int
r_int
id|penguins_are_doing_time
op_assign
l_int|0
suffix:semicolon
DECL|function|smp_capture
r_void
id|smp_capture
c_func
(paren
r_void
)paren
(brace
r_int
id|result
op_assign
id|atomic_add_return
c_func
(paren
l_int|1
comma
op_amp
id|smp_capture_depth
)paren
suffix:semicolon
id|membar
c_func
(paren
l_string|&quot;#StoreStore | #LoadStore&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
l_int|1
)paren
(brace
r_int
id|ncpus
op_assign
id|smp_num_cpus
suffix:semicolon
macro_line|#ifdef CAPTURE_DEBUG
id|printk
c_func
(paren
l_string|&quot;CPU[%d]: Sending penguins to jail...&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
macro_line|#endif
id|penguins_are_doing_time
op_assign
l_int|1
suffix:semicolon
id|membar
c_func
(paren
l_string|&quot;#StoreStore | #LoadStore&quot;
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|smp_capture_registry
)paren
suffix:semicolon
id|smp_cross_call
c_func
(paren
op_amp
id|xcall_capture
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_while
c_loop
(paren
id|atomic_read
c_func
(paren
op_amp
id|smp_capture_registry
)paren
op_ne
id|ncpus
)paren
(brace
id|membar
c_func
(paren
l_string|&quot;#LoadLoad&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef CAPTURE_DEBUG
id|printk
c_func
(paren
l_string|&quot;done&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
DECL|function|smp_release
r_void
id|smp_release
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|smp_capture_depth
)paren
)paren
(brace
macro_line|#ifdef CAPTURE_DEBUG
id|printk
c_func
(paren
l_string|&quot;CPU[%d]: Giving pardon to imprisoned penguins&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
macro_line|#endif
id|penguins_are_doing_time
op_assign
l_int|0
suffix:semicolon
id|membar
c_func
(paren
l_string|&quot;#StoreStore | #StoreLoad&quot;
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|smp_capture_registry
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Imprisoned penguins run with %pil == 15, but PSTATE_IE set, so they&n; * can service tlb flush xcalls...&n; */
DECL|function|smp_penguin_jailcell
r_void
id|smp_penguin_jailcell
c_func
(paren
r_void
)paren
(brace
id|flushw_user
c_func
(paren
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|smp_capture_registry
)paren
suffix:semicolon
id|membar
c_func
(paren
l_string|&quot;#StoreLoad | #StoreStore&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|penguins_are_doing_time
)paren
(brace
id|membar
c_func
(paren
l_string|&quot;#LoadLoad&quot;
)paren
suffix:semicolon
)brace
id|atomic_dec
c_func
(paren
op_amp
id|smp_capture_registry
)paren
suffix:semicolon
)brace
DECL|function|sparc64_do_profile
r_static
r_inline
r_void
id|sparc64_do_profile
c_func
(paren
r_int
r_int
id|pc
)paren
(brace
macro_line|#ifdef CONFIG_PROFILE
r_if
c_cond
(paren
id|prof_buffer
op_logical_and
id|current-&gt;pid
)paren
(brace
r_extern
r_int
id|_stext
suffix:semicolon
id|pc
op_sub_assign
(paren
r_int
r_int
)paren
op_amp
id|_stext
suffix:semicolon
id|pc
op_rshift_assign
id|prof_shift
suffix:semicolon
r_if
c_cond
(paren
id|pc
op_ge
id|prof_len
)paren
(brace
id|pc
op_assign
id|prof_len
op_minus
l_int|1
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
(paren
id|atomic_t
op_star
)paren
op_amp
id|prof_buffer
(braket
id|pc
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|variable|current_tick_offset
r_static
r_int
r_int
id|current_tick_offset
suffix:semicolon
DECL|macro|prof_multiplier
mdefine_line|#define prof_multiplier(__cpu)&t;&t;cpu_data[(__cpu)].multiplier
DECL|macro|prof_counter
mdefine_line|#define prof_counter(__cpu)&t;&t;cpu_data[(__cpu)].counter
r_extern
r_void
id|update_one_process
c_func
(paren
r_struct
id|task_struct
op_star
id|p
comma
r_int
r_int
id|ticks
comma
r_int
r_int
id|user
comma
r_int
r_int
id|system
comma
r_int
id|cpu
)paren
suffix:semicolon
DECL|function|smp_percpu_timer_interrupt
r_void
id|smp_percpu_timer_interrupt
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|compare
comma
id|tick
suffix:semicolon
r_int
id|cpu
op_assign
id|smp_processor_id
c_func
(paren
)paren
suffix:semicolon
r_int
id|user
op_assign
id|user_mode
c_func
(paren
id|regs
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Check for level 14 softint.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|get_softint
c_func
(paren
)paren
op_amp
(paren
l_int|1UL
op_lshift
l_int|0
)paren
)paren
)paren
(brace
r_extern
r_void
id|handler_irq
c_func
(paren
r_int
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
id|handler_irq
c_func
(paren
l_int|14
comma
id|regs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|clear_softint
c_func
(paren
(paren
l_int|1UL
op_lshift
l_int|0
)paren
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
id|user
)paren
(brace
id|sparc64_do_profile
c_func
(paren
id|regs-&gt;tpc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|prof_counter
c_func
(paren
id|cpu
)paren
)paren
(brace
r_if
c_cond
(paren
id|cpu
op_eq
id|boot_cpu_id
)paren
(brace
r_extern
r_void
id|irq_enter
c_func
(paren
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_void
id|irq_exit
c_func
(paren
r_int
comma
r_int
)paren
suffix:semicolon
id|irq_enter
c_func
(paren
id|cpu
comma
l_int|0
)paren
suffix:semicolon
id|kstat.irqs
(braket
id|cpu
)braket
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|timer_tick_interrupt
c_func
(paren
id|regs
)paren
suffix:semicolon
id|irq_exit
c_func
(paren
id|cpu
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|current-&gt;pid
)paren
(brace
r_int
r_int
op_star
id|inc
comma
op_star
id|inc2
suffix:semicolon
id|update_one_process
c_func
(paren
id|current
comma
l_int|1
comma
id|user
comma
op_logical_neg
id|user
comma
id|cpu
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|current-&gt;counter
OL
l_int|0
)paren
(brace
id|current-&gt;counter
op_assign
l_int|0
suffix:semicolon
id|need_resched
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|user
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;priority
OL
id|DEF_PRIORITY
)paren
(brace
id|inc
op_assign
op_amp
id|kstat.cpu_nice
suffix:semicolon
id|inc2
op_assign
op_amp
id|kstat.per_cpu_nice
(braket
id|cpu
)braket
suffix:semicolon
)brace
r_else
(brace
id|inc
op_assign
op_amp
id|kstat.cpu_user
suffix:semicolon
id|inc2
op_assign
op_amp
id|kstat.per_cpu_user
(braket
id|cpu
)braket
suffix:semicolon
)brace
)brace
r_else
(brace
id|inc
op_assign
op_amp
id|kstat.cpu_system
suffix:semicolon
id|inc2
op_assign
op_amp
id|kstat.per_cpu_system
(braket
id|cpu
)braket
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
(paren
id|atomic_t
op_star
)paren
id|inc
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
(paren
id|atomic_t
op_star
)paren
id|inc2
)paren
suffix:semicolon
)brace
id|prof_counter
c_func
(paren
id|cpu
)paren
op_assign
id|prof_multiplier
c_func
(paren
id|cpu
)paren
suffix:semicolon
)brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;rd&t;%%tick_cmpr, %0&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%0, %2, %0&bslash;n&bslash;t&quot;
l_string|&quot;wr&t;%0, 0x0, %%tick_cmpr&bslash;n&bslash;t&quot;
l_string|&quot;rd&t;%%tick, %1&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|compare
)paren
comma
l_string|&quot;=r&quot;
(paren
id|tick
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|current_tick_offset
)paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|tick
op_ge
id|compare
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|smp_setup_percpu_timer
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|cpu
op_assign
id|smp_processor_id
c_func
(paren
)paren
suffix:semicolon
id|prof_counter
c_func
(paren
id|cpu
)paren
op_assign
id|prof_multiplier
c_func
(paren
id|cpu
)paren
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cpu
op_eq
id|boot_cpu_id
)paren
(brace
r_extern
r_int
r_int
id|tl0_itick
suffix:semicolon
r_extern
r_int
r_int
id|tl0_smp_itick
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Steal TICK_INT interrupts from timer_interrupt().&n;&t;&t; */
id|__asm__
id|__volatile__
c_func
(paren
"&quot;"
dot
id|globl
id|tl0_smp_itick
id|b
comma
id|pt
op_mod
op_mod
id|xcc
comma
l_float|1f
id|nop
id|tl0_smp_itick
suffix:colon
id|rdpr
op_mod
op_mod
id|pil
comma
op_mod
op_mod
id|g2
id|wrpr
op_mod
op_mod
id|g0
comma
l_int|15
comma
op_mod
op_mod
id|pil
id|b
comma
id|pt
op_mod
op_mod
id|xcc
comma
id|etrap_irq
id|rd
op_mod
op_mod
id|pc
comma
op_mod
op_mod
id|g7
id|call
id|smp_percpu_timer_interrupt
id|add
op_mod
op_mod
id|sp
comma
op_mod
l_int|0
comma
op_mod
op_mod
id|o0
id|b
comma
id|pt
op_mod
op_mod
id|xcc
comma
id|rtrap
id|clr
op_mod
op_mod
id|l6
l_int|1
suffix:colon
"&quot;"
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;i&quot;
(paren
id|STACK_BIAS
op_plus
id|REGWIN_SZ
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|tl0_itick
comma
op_amp
id|tl0_smp_itick
comma
l_int|8
op_star
l_int|4
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
"&quot;"
id|membar
macro_line|#StoreStore
id|flush
op_mod
l_int|0
op_plus
l_int|0x00
id|flush
op_mod
l_int|0
op_plus
l_int|0x08
id|flush
op_mod
l_int|0
op_plus
l_int|0x10
id|flush
op_mod
l_int|0
op_plus
l_int|0x18
"&quot;"
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
op_amp
id|tl0_itick
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;rd&t;%%tick, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%%g1, %0, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;wr&t;%%g1, 0x0, %%tick_cmpr&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
id|current_tick_offset
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|smp_tickoffset_init
c_func
(paren
r_void
)paren
)paren
(brace
id|current_tick_offset
op_assign
id|timer_tick_offset
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|setup_profiling_timer
c_func
(paren
r_int
r_int
id|multiplier
)paren
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|multiplier
)paren
op_logical_or
(paren
id|timer_tick_offset
op_div
id|multiplier
)paren
OL
l_int|1000
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cpu_present_map
op_amp
(paren
l_int|1UL
op_lshift
id|i
)paren
)paren
(brace
id|prof_multiplier
c_func
(paren
id|i
)paren
op_assign
id|multiplier
suffix:semicolon
)brace
)brace
id|current_tick_offset
op_assign
(paren
id|timer_tick_offset
op_div
id|multiplier
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
