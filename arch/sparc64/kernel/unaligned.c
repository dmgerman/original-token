multiline_comment|/* $Id: unaligned.c,v 1.20 2000/04/29 08:05:21 anton Exp $&n; * unaligned.c: Unaligned load/store trap handling with special&n; *              cases for the kernel to do them more quickly.&n; *&n; * Copyright (C) 1996 David S. Miller (davem@caip.rutgers.edu)&n; * Copyright (C) 1996,1997 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/asi.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;asm/fpumacro.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
multiline_comment|/* #define DEBUG_MNA */
DECL|enum|direction
r_enum
id|direction
(brace
DECL|enumerator|load
id|load
comma
multiline_comment|/* ld, ldd, ldh, ldsh */
DECL|enumerator|store
id|store
comma
multiline_comment|/* st, std, sth, stsh */
DECL|enumerator|both
id|both
comma
multiline_comment|/* Swap, ldstub, cas, ... */
DECL|enumerator|fpld
id|fpld
comma
DECL|enumerator|fpst
id|fpst
comma
DECL|enumerator|invalid
id|invalid
comma
)brace
suffix:semicolon
macro_line|#ifdef DEBUG_MNA
DECL|variable|dirstrings
r_static
r_char
op_star
id|dirstrings
(braket
)braket
op_assign
(brace
l_string|&quot;load&quot;
comma
l_string|&quot;store&quot;
comma
l_string|&quot;both&quot;
comma
l_string|&quot;fpload&quot;
comma
l_string|&quot;fpstore&quot;
comma
l_string|&quot;invalid&quot;
)brace
suffix:semicolon
macro_line|#endif
DECL|function|decode_direction
r_static
r_inline
r_enum
id|direction
id|decode_direction
c_func
(paren
r_int
r_int
id|insn
)paren
(brace
r_int
r_int
id|tmp
op_assign
(paren
id|insn
op_rshift
l_int|21
)paren
op_amp
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tmp
)paren
(brace
r_return
id|load
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
(paren
id|insn
op_rshift
l_int|19
)paren
op_amp
l_int|0xf
)paren
(brace
r_case
l_int|15
suffix:colon
multiline_comment|/* swap* */
r_return
id|both
suffix:semicolon
r_default
suffix:colon
r_return
id|store
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* 16 = double-word, 8 = extra-word, 4 = word, 2 = half-word */
DECL|function|decode_access_size
r_static
r_inline
r_int
id|decode_access_size
c_func
(paren
r_int
r_int
id|insn
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
(paren
id|insn
op_rshift
l_int|19
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_int|11
op_logical_or
id|tmp
op_eq
l_int|14
)paren
multiline_comment|/* ldx/stx */
r_return
l_int|8
suffix:semicolon
id|tmp
op_and_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tmp
)paren
(brace
r_return
l_int|4
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tmp
op_eq
l_int|3
)paren
(brace
r_return
l_int|16
suffix:semicolon
)brace
multiline_comment|/* ldd/std - Although it is actually 8 */
r_else
r_if
c_cond
(paren
id|tmp
op_eq
l_int|2
)paren
(brace
r_return
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Impossible unaligned trap. insn=%08x&bslash;n&quot;
comma
id|insn
)paren
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;Byte sized unaligned access?!?!&quot;
comma
id|current-&gt;thread.kregs
)paren
suffix:semicolon
)brace
)brace
DECL|function|decode_asi
r_static
r_inline
r_int
id|decode_asi
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|insn
op_amp
l_int|0x800000
)paren
(brace
r_if
c_cond
(paren
id|insn
op_amp
l_int|0x2000
)paren
r_return
(paren
r_int
r_char
)paren
(paren
id|regs-&gt;tstate
op_rshift
l_int|24
)paren
suffix:semicolon
multiline_comment|/* %asi */
r_else
r_return
(paren
r_int
r_char
)paren
(paren
id|insn
op_rshift
l_int|5
)paren
suffix:semicolon
multiline_comment|/* imm_asi */
)brace
r_else
r_return
id|ASI_P
suffix:semicolon
)brace
multiline_comment|/* 0x400000 = signed, 0 = unsigned */
DECL|function|decode_signedness
r_static
r_inline
r_int
id|decode_signedness
c_func
(paren
r_int
r_int
id|insn
)paren
(brace
r_return
(paren
id|insn
op_amp
l_int|0x400000
)paren
suffix:semicolon
)brace
DECL|function|maybe_flush_windows
r_static
r_inline
r_void
id|maybe_flush_windows
c_func
(paren
r_int
r_int
id|rs1
comma
r_int
r_int
id|rs2
comma
r_int
r_int
id|rd
comma
r_int
id|from_kernel
)paren
(brace
r_if
c_cond
(paren
id|rs2
op_ge
l_int|16
op_logical_or
id|rs1
op_ge
l_int|16
op_logical_or
id|rd
op_ge
l_int|16
)paren
(brace
r_if
c_cond
(paren
id|from_kernel
op_ne
l_int|0
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;flushw&quot;
)paren
suffix:semicolon
)brace
r_else
id|flushw_user
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|sign_extend_imm13
r_static
r_inline
r_int
id|sign_extend_imm13
c_func
(paren
r_int
id|imm
)paren
(brace
r_return
id|imm
op_lshift
l_int|51
op_rshift
l_int|51
suffix:semicolon
)brace
DECL|function|fetch_reg
r_static
r_int
r_int
id|fetch_reg
c_func
(paren
r_int
r_int
id|reg
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|value
suffix:semicolon
r_if
c_cond
(paren
id|reg
OL
l_int|16
)paren
(brace
r_return
(paren
op_logical_neg
id|reg
ques
c_cond
l_int|0
suffix:colon
id|regs-&gt;u_regs
(braket
id|reg
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
r_struct
id|reg_window
op_star
id|win
suffix:semicolon
id|win
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
(paren
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
op_plus
id|STACK_BIAS
)paren
suffix:semicolon
id|value
op_assign
id|win-&gt;locals
(braket
id|reg
op_minus
l_int|16
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
(brace
r_struct
id|reg_window32
op_star
id|win32
suffix:semicolon
id|win32
op_assign
(paren
r_struct
id|reg_window32
op_star
)paren
(paren
(paren
r_int
r_int
)paren
(paren
(paren
id|u32
)paren
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
)paren
)paren
suffix:semicolon
id|get_user
c_func
(paren
id|value
comma
op_amp
id|win32-&gt;locals
(braket
id|reg
op_minus
l_int|16
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|reg_window
op_star
id|win
suffix:semicolon
id|win
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
(paren
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
op_plus
id|STACK_BIAS
)paren
suffix:semicolon
id|get_user
c_func
(paren
id|value
comma
op_amp
id|win-&gt;locals
(braket
id|reg
op_minus
l_int|16
)braket
)paren
suffix:semicolon
)brace
r_return
id|value
suffix:semicolon
)brace
DECL|function|fetch_reg_addr
r_static
r_int
r_int
op_star
id|fetch_reg_addr
c_func
(paren
r_int
r_int
id|reg
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|reg
OL
l_int|16
)paren
(brace
r_return
op_amp
id|regs-&gt;u_regs
(braket
id|reg
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
r_struct
id|reg_window
op_star
id|win
suffix:semicolon
id|win
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
(paren
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
op_plus
id|STACK_BIAS
)paren
suffix:semicolon
r_return
op_amp
id|win-&gt;locals
(braket
id|reg
op_minus
l_int|16
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
(brace
r_struct
id|reg_window32
op_star
id|win32
suffix:semicolon
id|win32
op_assign
(paren
r_struct
id|reg_window32
op_star
)paren
(paren
(paren
r_int
r_int
)paren
(paren
(paren
id|u32
)paren
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
)paren
)paren
suffix:semicolon
r_return
(paren
r_int
r_int
op_star
)paren
op_amp
id|win32-&gt;locals
(braket
id|reg
op_minus
l_int|16
)braket
suffix:semicolon
)brace
r_else
(brace
r_struct
id|reg_window
op_star
id|win
suffix:semicolon
id|win
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
(paren
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
op_plus
id|STACK_BIAS
)paren
suffix:semicolon
r_return
op_amp
id|win-&gt;locals
(braket
id|reg
op_minus
l_int|16
)braket
suffix:semicolon
)brace
)brace
DECL|function|compute_effective_address
r_static
r_inline
r_int
r_int
id|compute_effective_address
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|insn
comma
r_int
r_int
id|rd
)paren
(brace
r_int
r_int
id|rs1
op_assign
(paren
id|insn
op_rshift
l_int|14
)paren
op_amp
l_int|0x1f
suffix:semicolon
r_int
r_int
id|rs2
op_assign
id|insn
op_amp
l_int|0x1f
suffix:semicolon
r_int
id|from_kernel
op_assign
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|insn
op_amp
l_int|0x2000
)paren
(brace
id|maybe_flush_windows
c_func
(paren
id|rs1
comma
l_int|0
comma
id|rd
comma
id|from_kernel
)paren
suffix:semicolon
r_return
(paren
id|fetch_reg
c_func
(paren
id|rs1
comma
id|regs
)paren
op_plus
id|sign_extend_imm13
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|maybe_flush_windows
c_func
(paren
id|rs1
comma
id|rs2
comma
id|rd
comma
id|from_kernel
)paren
suffix:semicolon
r_return
(paren
id|fetch_reg
c_func
(paren
id|rs1
comma
id|regs
)paren
op_plus
id|fetch_reg
c_func
(paren
id|rs2
comma
id|regs
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* This is just to make gcc think die_if_kernel does return... */
DECL|function|unaligned_panic
r_static
r_void
id|unaligned_panic
c_func
(paren
r_char
op_star
id|str
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
id|str
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|macro|do_integer_load
mdefine_line|#define do_integer_load(dest_reg, size, saddr, is_signed, asi, errh) ({&t;&t;&bslash;&n;__asm__ __volatile__ (&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;wr&t;%4, 0, %%asi&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;cmp&t;%1, 8&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;bge,pn&t;%%icc, 9f&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot; cmp&t;%1, 4&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;be,pt&t;%%icc, 6f&bslash;n&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;4:&bslash;t&quot;&t;&quot; lduba&t;[%2] %%asi, %%l1&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;5:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 1] %%asi, %%l2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sll&t;%%l1, 8, %%l1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;brz,pt&t;%3, 3f&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot; add&t;%%l1, %%l2, %%l1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sllx&t;%%l1, 48, %%l1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;srax&t;%%l1, 48, %%l1&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;3:&bslash;t&quot;&t;&quot;ba,pt&t;%%xcc, 0f&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot; stx&t;%%l1, [%0]&bslash;n&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;6:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 1] %%asi, %%l2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sll&t;%%l1, 24, %%l1&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;7:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 2] %%asi, %%g7&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sll&t;%%l2, 16, %%l2&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;8:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 3] %%asi, %%g1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sll&t;%%g7, 8, %%g7&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;or&t;%%l1, %%l2, %%l1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;or&t;%%g7, %%g1, %%g7&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;or&t;%%l1, %%g7, %%l1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;brnz,a,pt %3, 3f&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot; sra&t;%%l1, 0, %%l1&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;3:&bslash;t&quot;&t;&quot;ba,pt&t;%%xcc, 0f&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot; stx&t;%%l1, [%0]&bslash;n&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;9:&bslash;t&quot;&t;&quot;lduba&t;[%2] %%asi, %%l1&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;10:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 1] %%asi, %%l2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sllx&t;%%l1, 56, %%l1&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;11:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 2] %%asi, %%g7&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sllx&t;%%l2, 48, %%l2&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;12:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 3] %%asi, %%g1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sllx&t;%%g7, 40, %%g7&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sllx&t;%%g1, 32, %%g1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;or&t;%%l1, %%l2, %%l1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;or&t;%%g7, %%g1, %%g7&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;13:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 4] %%asi, %%l2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;or&t;%%l1, %%g7, %%g7&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;14:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 5] %%asi, %%g1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sllx&t;%%l2, 24, %%l2&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;15:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 6] %%asi, %%l1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sllx&t;%%g1, 16, %%g1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;or&t;%%g7, %%l2, %%g7&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;16:&bslash;t&quot;&t;&quot;lduba&t;[%2 + 7] %%asi, %%l2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sllx&t;%%l1, 8, %%l1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;or&t;%%g7, %%g1, %%g7&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;or&t;%%l1, %%l2, %%l1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;or&t;%%g7, %%l1, %%g7&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;cmp&t;%1, 8&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;be,a,pt %%icc, 0f&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot; stx&t;%%g7, [%0]&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;srlx&t;%%g7, 32, %%l1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;sra&t;%%g7, 0, %%g7&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;stx&t;%%l1, [%0]&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;stx&t;%%g7, [%0 + 8]&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;0:&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;wr&t;%%g0, %5, %%asi&bslash;n&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.section __ex_table&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;4b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;5b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;6b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;7b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;8b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;9b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;10b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;11b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;12b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;13b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;14b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;15b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;16b, &quot; #errh &quot;&bslash;n&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.previous&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;: : &quot;r&quot; (dest_reg), &quot;r&quot; (size), &quot;r&quot; (saddr), &quot;r&quot; (is_signed),&t;&t;&bslash;&n;&t;  &quot;r&quot; (asi), &quot;i&quot; (ASI_AIUS)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;: &quot;l1&quot;, &quot;l2&quot;, &quot;g7&quot;, &quot;g1&quot;, &quot;cc&quot;);&t;&t;&t;&t;&t;&bslash;&n;})
DECL|macro|store_common
mdefine_line|#define store_common(dst_addr, size, src_val, asi, errh) ({&t;&t;&t;&bslash;&n;__asm__ __volatile__ (&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;wr&t;%3, 0, %%asi&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;ldx&t;[%2], %%l1&bslash;n&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;cmp&t;%1, 2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;be,pn&t;%%icc, 2f&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot; cmp&t;%1, 4&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;be,pt&t;%%icc, 1f&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot; srlx&t;%%l1, 24, %%l2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;srlx&t;%%l1, 56, %%g1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;srlx&t;%%l1, 48, %%g7&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;4:&bslash;t&quot;&t;&quot;stba&t;%%g1, [%0] %%asi&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;srlx&t;%%l1, 40, %%g1&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;5:&bslash;t&quot;&t;&quot;stba&t;%%g7, [%0 + 1] %%asi&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;srlx&t;%%l1, 32, %%g7&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;6:&bslash;t&quot;&t;&quot;stba&t;%%g1, [%0 + 2] %%asi&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;7:&bslash;t&quot;&t;&quot;stba&t;%%g7, [%0 + 3] %%asi&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;srlx&t;%%l1, 16, %%g1&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;8:&bslash;t&quot;&t;&quot;stba&t;%%l2, [%0 + 4] %%asi&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;srlx&t;%%l1, 8, %%g7&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;9:&bslash;t&quot;&t;&quot;stba&t;%%g1, [%0 + 5] %%asi&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;10:&bslash;t&quot;&t;&quot;stba&t;%%g7, [%0 + 6] %%asi&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;ba,pt&t;%%xcc, 0f&bslash;n&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;11:&bslash;t&quot;&t;&quot; stba&t;%%l1, [%0 + 7] %%asi&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;1:&bslash;t&quot;&t;&quot;srl&t;%%l1, 16, %%g7&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;12:&bslash;t&quot;&t;&quot;stba&t;%%l2, [%0] %%asi&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;srl&t;%%l1, 8, %%l2&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;13:&bslash;t&quot;&t;&quot;stba&t;%%g7, [%0 + 1] %%asi&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;14:&bslash;t&quot;&t;&quot;stba&t;%%l2, [%0 + 2] %%asi&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;ba,pt&t;%%xcc, 0f&bslash;n&quot;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;15:&bslash;t&quot;&t;&quot; stba&t;%%l1, [%0 + 3] %%asi&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;2:&bslash;t&quot;&t;&quot;srl&t;%%l1, 8, %%l2&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;16:&bslash;t&quot;&t;&quot;stba&t;%%l2, [%0] %%asi&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;17:&bslash;t&quot;&t;&quot;stba&t;%%l1, [%0 + 1] %%asi&bslash;n&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&quot;0:&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;wr&t;%%g0, %4, %%asi&bslash;n&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.section __ex_table&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;4b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;5b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;6b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;7b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;8b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;9b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;10b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;11b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;12b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;13b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;14b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;15b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;16b, &quot; #errh &quot;&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.word&t;17b, &quot; #errh &quot;&bslash;n&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&quot;.previous&bslash;n&bslash;t&quot;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;: : &quot;r&quot; (dst_addr), &quot;r&quot; (size), &quot;r&quot; (src_val), &quot;r&quot; (asi), &quot;i&quot; (ASI_AIUS)&bslash;&n;&t;: &quot;l1&quot;, &quot;l2&quot;, &quot;g7&quot;, &quot;g1&quot;, &quot;cc&quot;);&t;&t;&t;&t;&t;&bslash;&n;})
DECL|macro|do_integer_store
mdefine_line|#define do_integer_store(reg_num, size, dst_addr, regs, asi, errh) ({&t;&t;&bslash;&n;&t;unsigned long zero = 0;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;unsigned long *src_val = &amp;zero;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (size == 16) {&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;size = 8;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;zero = (((long)(reg_num ? &t;&t;&t;&t;&t;&bslash;&n;&t;&t;        (unsigned)fetch_reg(reg_num, regs) : 0)) &lt;&lt; 32) |&t;&bslash;&n;&t;&t;&t;(unsigned)fetch_reg(reg_num + 1, regs);&t;&t;&t;&bslash;&n;&t;} else if (reg_num) src_val = fetch_reg_addr(reg_num, regs);&t;&t;&bslash;&n;&t;store_common(dst_addr, size, src_val, asi, errh);&t;&t;&t;&bslash;&n;})
multiline_comment|/* XXX Need to capture/release other cpu&squot;s for SMP around this. */
DECL|macro|do_atomic
mdefine_line|#define do_atomic(srcdest_reg, mem, errh) ({&t;&t;&t;&t;&t;&bslash;&n;&t;unsigned long flags, tmp;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;save_and_cli(flags);&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;tmp = *srcdest_reg;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;do_integer_load(srcdest_reg, 4, mem, 0, errh);&t;&t;&t;&t;&bslash;&n;&t;store_common(mem, 4, &amp;tmp, errh);&t;&t;&t;&t;&t;&bslash;&n;&t;restore_flags(flags);&t;&t;&t;&t;&t;&t;&t;&bslash;&n;})
DECL|function|advance
r_static
r_inline
r_void
id|advance
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|regs-&gt;tpc
op_assign
id|regs-&gt;tnpc
suffix:semicolon
id|regs-&gt;tnpc
op_add_assign
l_int|4
suffix:semicolon
)brace
DECL|function|floating_point_load_or_store_p
r_static
r_inline
r_int
id|floating_point_load_or_store_p
c_func
(paren
r_int
r_int
id|insn
)paren
(brace
r_return
(paren
id|insn
op_rshift
l_int|24
)paren
op_amp
l_int|1
suffix:semicolon
)brace
DECL|function|ok_for_kernel
r_static
r_inline
r_int
id|ok_for_kernel
c_func
(paren
r_int
r_int
id|insn
)paren
(brace
r_return
op_logical_neg
id|floating_point_load_or_store_p
c_func
(paren
id|insn
)paren
suffix:semicolon
)brace
r_void
id|kernel_mna_trap_fault
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|insn
)paren
id|__asm__
(paren
l_string|&quot;kernel_mna_trap_fault&quot;
)paren
suffix:semicolon
DECL|function|kernel_mna_trap_fault
r_void
id|kernel_mna_trap_fault
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|insn
)paren
(brace
r_int
r_int
id|g2
op_assign
id|regs-&gt;u_regs
(braket
id|UREG_G2
)braket
suffix:semicolon
r_int
r_int
id|fixup
op_assign
id|search_exception_table
(paren
id|regs-&gt;tpc
comma
op_amp
id|g2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fixup
)paren
(brace
r_int
r_int
id|address
op_assign
id|compute_effective_address
c_func
(paren
id|regs
comma
id|insn
comma
(paren
(paren
id|insn
op_rshift
l_int|25
)paren
op_amp
l_int|0x1f
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|address
OL
id|PAGE_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;Unable to handle kernel NULL pointer dereference in mna handler&quot;
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;Unable to handle kernel paging request in mna handler&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot; at virtual address %016lx&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;current-&gt;{mm,active_mm}-&gt;context = %016lx&bslash;n&quot;
comma
(paren
id|current-&gt;mm
ques
c_cond
id|current-&gt;mm-&gt;context
suffix:colon
id|current-&gt;active_mm-&gt;context
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;current-&gt;{mm,active_mm}-&gt;pgd = %016lx&bslash;n&quot;
comma
(paren
id|current-&gt;mm
ques
c_cond
(paren
r_int
r_int
)paren
id|current-&gt;mm-&gt;pgd
suffix:colon
(paren
r_int
r_int
)paren
id|current-&gt;active_mm-&gt;pgd
)paren
)paren
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;Oops&quot;
comma
id|regs
)paren
suffix:semicolon
multiline_comment|/* Not reached */
)brace
id|regs-&gt;tpc
op_assign
id|fixup
suffix:semicolon
id|regs-&gt;tnpc
op_assign
id|regs-&gt;tpc
op_plus
l_int|4
suffix:semicolon
id|regs-&gt;u_regs
(braket
id|UREG_G2
)braket
op_assign
id|g2
suffix:semicolon
)brace
DECL|function|kernel_unaligned_trap
id|asmlinkage
r_void
id|kernel_unaligned_trap
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|insn
comma
r_int
r_int
id|sfar
comma
r_int
r_int
id|sfsr
)paren
(brace
r_enum
id|direction
id|dir
op_assign
id|decode_direction
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
id|size
op_assign
id|decode_access_size
c_func
(paren
id|insn
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ok_for_kernel
c_func
(paren
id|insn
)paren
op_logical_or
id|dir
op_eq
id|both
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Unsupported unaligned load/store trap for kernel at &lt;%016lx&gt;.&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
id|unaligned_panic
c_func
(paren
l_string|&quot;Kernel does fpu/atomic unaligned load/store.&quot;
comma
id|regs
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;&bslash;n&quot;
l_string|&quot;kernel_unaligned_trap_fault:&bslash;n&bslash;t&quot;
l_string|&quot;mov&t;%0, %%o0&bslash;n&bslash;t&quot;
l_string|&quot;call&t;kernel_mna_trap_fault&bslash;n&bslash;t&quot;
l_string|&quot; mov&t;%1, %%o1&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|regs
)paren
comma
l_string|&quot;r&quot;
(paren
id|insn
)paren
suffix:colon
l_string|&quot;o0&quot;
comma
l_string|&quot;o1&quot;
comma
l_string|&quot;o2&quot;
comma
l_string|&quot;o3&quot;
comma
l_string|&quot;o4&quot;
comma
l_string|&quot;o5&quot;
comma
l_string|&quot;o7&quot;
comma
l_string|&quot;g1&quot;
comma
l_string|&quot;g2&quot;
comma
l_string|&quot;g3&quot;
comma
l_string|&quot;g4&quot;
comma
l_string|&quot;g5&quot;
comma
l_string|&quot;g7&quot;
comma
l_string|&quot;cc&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|addr
op_assign
id|compute_effective_address
c_func
(paren
id|regs
comma
id|insn
comma
(paren
(paren
id|insn
op_rshift
l_int|25
)paren
op_amp
l_int|0x1f
)paren
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_MNA
id|printk
c_func
(paren
l_string|&quot;KMNA: pc=%016lx [dir=%s addr=%016lx size=%d] retpc[%016lx]&bslash;n&quot;
comma
id|regs-&gt;tpc
comma
id|dirstrings
(braket
id|dir
)braket
comma
id|addr
comma
id|size
comma
id|regs-&gt;u_regs
(braket
id|UREG_RETPC
)braket
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|dir
)paren
(brace
r_case
id|load
suffix:colon
id|do_integer_load
c_func
(paren
id|fetch_reg_addr
c_func
(paren
(paren
(paren
id|insn
op_rshift
l_int|25
)paren
op_amp
l_int|0x1f
)paren
comma
id|regs
)paren
comma
id|size
comma
(paren
r_int
r_int
op_star
)paren
id|addr
comma
id|decode_signedness
c_func
(paren
id|insn
)paren
comma
id|decode_asi
c_func
(paren
id|insn
comma
id|regs
)paren
comma
id|kernel_unaligned_trap_fault
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|store
suffix:colon
id|do_integer_store
c_func
(paren
(paren
(paren
id|insn
op_rshift
l_int|25
)paren
op_amp
l_int|0x1f
)paren
comma
id|size
comma
(paren
r_int
r_int
op_star
)paren
id|addr
comma
id|regs
comma
id|decode_asi
c_func
(paren
id|insn
comma
id|regs
)paren
comma
id|kernel_unaligned_trap_fault
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0 /* unsupported */
r_case
id|both
suffix:colon
id|do_atomic
c_func
(paren
id|fetch_reg_addr
c_func
(paren
(paren
(paren
id|insn
op_rshift
l_int|25
)paren
op_amp
l_int|0x1f
)paren
comma
id|regs
)paren
comma
(paren
r_int
r_int
op_star
)paren
id|addr
comma
id|kernel_unaligned_trap_fault
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|panic
c_func
(paren
l_string|&quot;Impossible kernel unaligned trap.&quot;
)paren
suffix:semicolon
multiline_comment|/* Not reached... */
)brace
id|advance
c_func
(paren
id|regs
)paren
suffix:semicolon
)brace
)brace
DECL|variable|popc_helper
r_static
r_char
id|popc_helper
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|2
comma
l_int|1
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|1
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|2
comma
l_int|3
comma
l_int|3
comma
l_int|4
comma
)brace
suffix:semicolon
DECL|function|handle_popc
r_int
id|handle_popc
c_func
(paren
id|u32
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u64
id|value
suffix:semicolon
r_int
id|ret
comma
id|i
comma
id|rd
op_assign
(paren
(paren
id|insn
op_rshift
l_int|25
)paren
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_int
id|from_kernel
op_assign
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|insn
op_amp
l_int|0x2000
)paren
(brace
id|maybe_flush_windows
c_func
(paren
l_int|0
comma
l_int|0
comma
id|rd
comma
id|from_kernel
)paren
suffix:semicolon
id|value
op_assign
id|sign_extend_imm13
c_func
(paren
id|insn
)paren
suffix:semicolon
)brace
r_else
(brace
id|maybe_flush_windows
c_func
(paren
l_int|0
comma
id|insn
op_amp
l_int|0x1f
comma
id|rd
comma
id|from_kernel
)paren
suffix:semicolon
id|value
op_assign
id|fetch_reg
c_func
(paren
id|insn
op_amp
l_int|0x1f
comma
id|regs
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|ret
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_add_assign
id|popc_helper
(braket
id|value
op_amp
l_int|0xf
)braket
suffix:semicolon
id|value
op_rshift_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rd
OL
l_int|16
)paren
(brace
r_if
c_cond
(paren
id|rd
)paren
id|regs-&gt;u_regs
(braket
id|rd
)braket
op_assign
id|ret
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
(brace
r_struct
id|reg_window32
op_star
id|win32
suffix:semicolon
id|win32
op_assign
(paren
r_struct
id|reg_window32
op_star
)paren
(paren
(paren
r_int
r_int
)paren
(paren
(paren
id|u32
)paren
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
)paren
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|ret
comma
op_amp
id|win32-&gt;locals
(braket
id|rd
op_minus
l_int|16
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|reg_window
op_star
id|win
suffix:semicolon
id|win
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
(paren
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
op_plus
id|STACK_BIAS
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|ret
comma
op_amp
id|win-&gt;locals
(braket
id|rd
op_minus
l_int|16
)braket
)paren
suffix:semicolon
)brace
)brace
id|advance
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_extern
r_void
id|do_fpother
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_extern
r_void
id|do_privact
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_extern
r_void
id|data_access_exception
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
DECL|function|handle_ldf_stq
r_int
id|handle_ldf_stq
c_func
(paren
id|u32
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|addr
op_assign
id|compute_effective_address
c_func
(paren
id|regs
comma
id|insn
comma
l_int|0
)paren
suffix:semicolon
r_int
id|freg
op_assign
(paren
(paren
id|insn
op_rshift
l_int|25
)paren
op_amp
l_int|0x1e
)paren
op_or
(paren
(paren
id|insn
op_rshift
l_int|20
)paren
op_amp
l_int|0x20
)paren
suffix:semicolon
r_struct
id|fpustate
op_star
id|f
op_assign
id|FPUSTATE
suffix:semicolon
r_int
id|asi
op_assign
id|decode_asi
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_int
id|flag
op_assign
(paren
id|freg
OL
l_int|32
)paren
ques
c_cond
id|FPRS_DL
suffix:colon
id|FPRS_DU
suffix:semicolon
id|save_and_clear_fpu
c_func
(paren
)paren
suffix:semicolon
id|current-&gt;thread.xfsr
(braket
l_int|0
)braket
op_and_assign
op_complement
l_int|0x1c000
suffix:semicolon
r_if
c_cond
(paren
id|freg
op_amp
l_int|3
)paren
(brace
id|current-&gt;thread.xfsr
(braket
l_int|0
)braket
op_or_assign
(paren
l_int|6
op_lshift
l_int|14
)paren
multiline_comment|/* invalid_fp_register */
suffix:semicolon
id|do_fpother
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|insn
op_amp
l_int|0x200000
)paren
(brace
multiline_comment|/* STQ */
id|u64
id|first
op_assign
l_int|0
comma
id|second
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;thread.fpsaved
(braket
l_int|0
)braket
op_amp
id|flag
)paren
(brace
id|first
op_assign
op_star
(paren
id|u64
op_star
)paren
op_amp
id|f-&gt;regs
(braket
id|freg
)braket
suffix:semicolon
id|second
op_assign
op_star
(paren
id|u64
op_star
)paren
op_amp
id|f-&gt;regs
(braket
id|freg
op_plus
l_int|2
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|asi
OL
l_int|0x80
)paren
(brace
id|do_privact
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|asi
)paren
(brace
r_case
id|ASI_P
suffix:colon
r_case
id|ASI_S
suffix:colon
r_break
suffix:semicolon
r_case
id|ASI_PL
suffix:colon
r_case
id|ASI_SL
suffix:colon
(brace
multiline_comment|/* Need to convert endians */
id|u64
id|tmp
op_assign
id|__swab64p
c_func
(paren
op_amp
id|first
)paren
suffix:semicolon
id|first
op_assign
id|__swab64p
c_func
(paren
op_amp
id|second
)paren
suffix:semicolon
id|second
op_assign
id|tmp
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|data_access_exception
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|put_user
(paren
id|first
op_rshift
l_int|32
comma
(paren
id|u32
op_star
)paren
id|addr
)paren
op_logical_or
id|__put_user
(paren
(paren
id|u32
)paren
id|first
comma
(paren
id|u32
op_star
)paren
(paren
id|addr
op_plus
l_int|4
)paren
)paren
op_logical_or
id|__put_user
(paren
id|second
op_rshift
l_int|32
comma
(paren
id|u32
op_star
)paren
(paren
id|addr
op_plus
l_int|8
)paren
)paren
op_logical_or
id|__put_user
(paren
(paren
id|u32
)paren
id|second
comma
(paren
id|u32
op_star
)paren
(paren
id|addr
op_plus
l_int|12
)paren
)paren
)paren
(brace
id|data_access_exception
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* LDF, LDDF, LDQF */
id|u32
id|data
(braket
l_int|4
)braket
id|__attribute__
(paren
(paren
id|aligned
c_func
(paren
l_int|8
)paren
)paren
)paren
suffix:semicolon
r_int
id|size
comma
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|asi
OL
l_int|0x80
)paren
(brace
id|do_privact
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|asi
OG
id|ASI_SNFL
)paren
(brace
id|data_access_exception
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|insn
op_amp
l_int|0x180000
)paren
(brace
r_case
l_int|0x000000
suffix:colon
id|size
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x100000
suffix:colon
id|size
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|size
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
id|data
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|get_user
(paren
id|data
(braket
l_int|0
)braket
comma
(paren
id|u32
op_star
)paren
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
id|err
op_or_assign
id|__get_user
(paren
id|data
(braket
id|i
)braket
comma
(paren
id|u32
op_star
)paren
(paren
id|addr
op_plus
l_int|4
op_star
id|i
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
op_logical_and
op_logical_neg
(paren
id|asi
op_amp
l_int|0x2
multiline_comment|/* NF */
)paren
)paren
(brace
id|data_access_exception
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|asi
op_amp
l_int|0x8
)paren
multiline_comment|/* Little */
(brace
id|u64
id|tmp
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
l_int|1
suffix:colon
id|data
(braket
l_int|0
)braket
op_assign
id|le32_to_cpup
c_func
(paren
id|data
op_plus
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
op_star
(paren
id|u64
op_star
)paren
(paren
id|data
op_plus
l_int|0
)paren
op_assign
id|le64_to_cpup
c_func
(paren
(paren
id|u64
op_star
)paren
(paren
id|data
op_plus
l_int|0
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|tmp
op_assign
id|le64_to_cpup
c_func
(paren
(paren
id|u64
op_star
)paren
(paren
id|data
op_plus
l_int|0
)paren
)paren
suffix:semicolon
op_star
(paren
id|u64
op_star
)paren
(paren
id|data
op_plus
l_int|0
)paren
op_assign
id|le64_to_cpup
c_func
(paren
(paren
id|u64
op_star
)paren
(paren
id|data
op_plus
l_int|2
)paren
)paren
suffix:semicolon
op_star
(paren
id|u64
op_star
)paren
(paren
id|data
op_plus
l_int|2
)paren
op_assign
id|tmp
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|current-&gt;thread.fpsaved
(braket
l_int|0
)braket
op_amp
id|FPRS_FEF
)paren
)paren
(brace
id|current-&gt;thread.fpsaved
(braket
l_int|0
)braket
op_assign
id|FPRS_FEF
suffix:semicolon
id|current-&gt;thread.gsr
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|current-&gt;thread.fpsaved
(braket
l_int|0
)braket
op_amp
id|flag
)paren
)paren
(brace
r_if
c_cond
(paren
id|freg
OL
l_int|32
)paren
id|memset
c_func
(paren
id|f-&gt;regs
comma
l_int|0
comma
l_int|32
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_else
id|memset
c_func
(paren
id|f-&gt;regs
op_plus
l_int|32
comma
l_int|0
comma
l_int|32
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|f-&gt;regs
op_plus
id|freg
comma
id|data
comma
id|size
op_star
l_int|4
)paren
suffix:semicolon
id|current-&gt;thread.fpsaved
(braket
l_int|0
)braket
op_or_assign
id|flag
suffix:semicolon
)brace
id|advance
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|handle_ld_nf
r_void
id|handle_ld_nf
c_func
(paren
id|u32
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|rd
op_assign
(paren
(paren
id|insn
op_rshift
l_int|25
)paren
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_int
id|from_kernel
op_assign
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
op_ne
l_int|0
suffix:semicolon
r_int
r_int
op_star
id|reg
suffix:semicolon
id|maybe_flush_windows
c_func
(paren
l_int|0
comma
l_int|0
comma
id|rd
comma
id|from_kernel
)paren
suffix:semicolon
id|reg
op_assign
id|fetch_reg_addr
c_func
(paren
id|rd
comma
id|regs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|from_kernel
op_logical_or
id|rd
OL
l_int|16
)paren
(brace
id|reg
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|insn
op_amp
l_int|0x780000
)paren
op_eq
l_int|0x180000
)paren
id|reg
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
(brace
id|put_user
c_func
(paren
l_int|0
comma
(paren
r_int
op_star
)paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|insn
op_amp
l_int|0x780000
)paren
op_eq
l_int|0x180000
)paren
id|put_user
c_func
(paren
l_int|0
comma
(paren
(paren
r_int
op_star
)paren
id|reg
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|put_user
c_func
(paren
l_int|0
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|insn
op_amp
l_int|0x780000
)paren
op_eq
l_int|0x180000
)paren
id|put_user
c_func
(paren
l_int|0
comma
id|reg
op_plus
l_int|1
)paren
suffix:semicolon
)brace
id|advance
c_func
(paren
id|regs
)paren
suffix:semicolon
)brace
DECL|function|handle_lddfmna
r_void
id|handle_lddfmna
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|sfar
comma
r_int
r_int
id|sfsr
)paren
(brace
r_int
r_int
id|pc
op_assign
id|regs-&gt;tpc
suffix:semicolon
r_int
r_int
id|tstate
op_assign
id|regs-&gt;tstate
suffix:semicolon
id|u32
id|insn
suffix:semicolon
id|u32
id|first
comma
id|second
suffix:semicolon
id|u64
id|value
suffix:semicolon
id|u8
id|asi
comma
id|freg
suffix:semicolon
r_int
id|flag
suffix:semicolon
r_struct
id|fpustate
op_star
id|f
op_assign
id|FPUSTATE
suffix:semicolon
r_if
c_cond
(paren
id|tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;lddfmna from kernel&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
(brace
id|pc
op_assign
(paren
id|u32
)paren
id|pc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|insn
comma
(paren
id|u32
op_star
)paren
id|pc
)paren
op_ne
op_minus
id|EFAULT
)paren
(brace
id|asi
op_assign
id|sfsr
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
(paren
id|asi
OG
id|ASI_SNFL
)paren
op_logical_or
(paren
id|asi
OL
id|ASI_P
)paren
)paren
r_goto
id|daex
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|first
comma
(paren
id|u32
op_star
)paren
id|sfar
)paren
op_logical_or
id|get_user
c_func
(paren
id|second
comma
(paren
id|u32
op_star
)paren
(paren
id|sfar
op_plus
l_int|4
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|asi
op_amp
l_int|0x2
)paren
multiline_comment|/* NF */
(brace
id|first
op_assign
l_int|0
suffix:semicolon
id|second
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_goto
id|daex
suffix:semicolon
)brace
id|save_and_clear_fpu
c_func
(paren
)paren
suffix:semicolon
id|freg
op_assign
(paren
(paren
id|insn
op_rshift
l_int|25
)paren
op_amp
l_int|0x1e
)paren
op_or
(paren
(paren
id|insn
op_rshift
l_int|20
)paren
op_amp
l_int|0x20
)paren
suffix:semicolon
id|value
op_assign
(paren
(paren
(paren
id|u64
)paren
id|first
)paren
op_lshift
l_int|32
)paren
op_or
id|second
suffix:semicolon
r_if
c_cond
(paren
id|asi
op_amp
l_int|0x8
)paren
multiline_comment|/* Little */
id|value
op_assign
id|__swab64p
c_func
(paren
op_amp
id|value
)paren
suffix:semicolon
id|flag
op_assign
(paren
id|freg
OL
l_int|32
)paren
ques
c_cond
id|FPRS_DL
suffix:colon
id|FPRS_DU
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|current-&gt;thread.fpsaved
(braket
l_int|0
)braket
op_amp
id|FPRS_FEF
)paren
)paren
(brace
id|current-&gt;thread.fpsaved
(braket
l_int|0
)braket
op_assign
id|FPRS_FEF
suffix:semicolon
id|current-&gt;thread.gsr
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|current-&gt;thread.fpsaved
(braket
l_int|0
)braket
op_amp
id|flag
)paren
)paren
(brace
r_if
c_cond
(paren
id|freg
OL
l_int|32
)paren
id|memset
c_func
(paren
id|f-&gt;regs
comma
l_int|0
comma
l_int|32
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_else
id|memset
c_func
(paren
id|f-&gt;regs
op_plus
l_int|32
comma
l_int|0
comma
l_int|32
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
)brace
op_star
(paren
id|u64
op_star
)paren
(paren
id|f-&gt;regs
op_plus
id|freg
)paren
op_assign
id|value
suffix:semicolon
id|current-&gt;thread.fpsaved
(braket
l_int|0
)braket
op_or_assign
id|flag
suffix:semicolon
)brace
r_else
(brace
id|daex
suffix:colon
id|data_access_exception
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|advance
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|handle_stdfmna
r_void
id|handle_stdfmna
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|sfar
comma
r_int
r_int
id|sfsr
)paren
(brace
r_int
r_int
id|pc
op_assign
id|regs-&gt;tpc
suffix:semicolon
r_int
r_int
id|tstate
op_assign
id|regs-&gt;tstate
suffix:semicolon
id|u32
id|insn
suffix:semicolon
id|u64
id|value
suffix:semicolon
id|u8
id|asi
comma
id|freg
suffix:semicolon
r_int
id|flag
suffix:semicolon
r_struct
id|fpustate
op_star
id|f
op_assign
id|FPUSTATE
suffix:semicolon
r_if
c_cond
(paren
id|tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;stdfmna from kernel&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
(brace
id|pc
op_assign
(paren
id|u32
)paren
id|pc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|insn
comma
(paren
id|u32
op_star
)paren
id|pc
)paren
op_ne
op_minus
id|EFAULT
)paren
(brace
id|freg
op_assign
(paren
(paren
id|insn
op_rshift
l_int|25
)paren
op_amp
l_int|0x1e
)paren
op_or
(paren
(paren
id|insn
op_rshift
l_int|20
)paren
op_amp
l_int|0x20
)paren
suffix:semicolon
id|asi
op_assign
id|sfsr
op_rshift
l_int|16
suffix:semicolon
id|value
op_assign
l_int|0
suffix:semicolon
id|flag
op_assign
(paren
id|freg
OL
l_int|32
)paren
ques
c_cond
id|FPRS_DL
suffix:colon
id|FPRS_DU
suffix:semicolon
r_if
c_cond
(paren
(paren
id|asi
OG
id|ASI_SNFL
)paren
op_logical_or
(paren
id|asi
OL
id|ASI_P
)paren
)paren
r_goto
id|daex
suffix:semicolon
id|save_and_clear_fpu
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;thread.fpsaved
(braket
l_int|0
)braket
op_amp
id|flag
)paren
id|value
op_assign
op_star
(paren
id|u64
op_star
)paren
op_amp
id|f-&gt;regs
(braket
id|freg
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|asi
)paren
(brace
r_case
id|ASI_P
suffix:colon
r_case
id|ASI_S
suffix:colon
r_break
suffix:semicolon
r_case
id|ASI_PL
suffix:colon
r_case
id|ASI_SL
suffix:colon
id|value
op_assign
id|__swab64p
c_func
(paren
op_amp
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|daex
suffix:semicolon
)brace
r_if
c_cond
(paren
id|put_user
(paren
id|value
op_rshift
l_int|32
comma
(paren
id|u32
op_star
)paren
id|sfar
)paren
op_logical_or
id|__put_user
(paren
(paren
id|u32
)paren
id|value
comma
(paren
id|u32
op_star
)paren
(paren
id|sfar
op_plus
l_int|4
)paren
)paren
)paren
r_goto
id|daex
suffix:semicolon
)brace
r_else
(brace
id|daex
suffix:colon
id|data_access_exception
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|advance
c_func
(paren
id|regs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
