multiline_comment|/* $Id: idprom.c,v 1.3 1999/08/31 06:54:53 davem Exp $&n; * idprom.c: Routines to load the idprom into kernel addresses and&n; *           interpret the data contained within.&n; *&n; * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/idprom.h&gt;
DECL|variable|idprom
r_struct
id|idprom
op_star
id|idprom
suffix:semicolon
DECL|variable|idprom_buffer
r_static
r_struct
id|idprom
id|idprom_buffer
suffix:semicolon
multiline_comment|/* Calculate the IDPROM checksum (xor of the data bytes). */
DECL|function|calc_idprom_cksum
r_static
r_int
r_char
id|__init
id|calc_idprom_cksum
c_func
(paren
r_struct
id|idprom
op_star
id|idprom
)paren
(brace
r_int
r_char
id|cksum
comma
id|i
comma
op_star
id|ptr
op_assign
(paren
r_int
r_char
op_star
)paren
id|idprom
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cksum
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x0E
suffix:semicolon
id|i
op_increment
)paren
id|cksum
op_xor_assign
op_star
id|ptr
op_increment
suffix:semicolon
r_return
id|cksum
suffix:semicolon
)brace
multiline_comment|/* Create a local IDPROM copy and verify integrity. */
DECL|function|idprom_init
r_void
id|__init
id|idprom_init
c_func
(paren
r_void
)paren
(brace
id|prom_get_idprom
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|idprom_buffer
comma
r_sizeof
(paren
id|idprom_buffer
)paren
)paren
suffix:semicolon
id|idprom
op_assign
op_amp
id|idprom_buffer
suffix:semicolon
r_if
c_cond
(paren
id|idprom-&gt;id_format
op_ne
l_int|0x01
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;IDPROM: Warning, unknown format type!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idprom-&gt;id_cksum
op_ne
id|calc_idprom_cksum
c_func
(paren
id|idprom
)paren
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;IDPROM: Warning, checksum failure (nvram=%x, calc=%x)!&bslash;n&quot;
comma
id|idprom-&gt;id_cksum
comma
id|calc_idprom_cksum
c_func
(paren
id|idprom
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Ethernet address: %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|idprom-&gt;id_ethaddr
(braket
l_int|0
)braket
comma
id|idprom-&gt;id_ethaddr
(braket
l_int|1
)braket
comma
id|idprom-&gt;id_ethaddr
(braket
l_int|2
)braket
comma
id|idprom-&gt;id_ethaddr
(braket
l_int|3
)braket
comma
id|idprom-&gt;id_ethaddr
(braket
l_int|4
)braket
comma
id|idprom-&gt;id_ethaddr
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
eof
