multiline_comment|/* $Id: sunos_ioctl32.c,v 1.11 2000/07/30 23:12:24 davem Exp $&n; * sunos_ioctl32.c: SunOS ioctl compatability on sparc64.&n; *&n; * Copyright (C) 1995 Miguel de Icaza (miguel@nuclecu.unam.mx)&n; * Copyright (C) 1995, 1996, 1997 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/termios.h&gt;
macro_line|#include &lt;linux/ioctl.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/if.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/file.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;asm/kbio.h&gt;
multiline_comment|/* Use this to get at 32-bit user passed pointers. */
DECL|macro|A
mdefine_line|#define A(__x)&t;&t;&t;&t;&bslash;&n;({&t;unsigned long __ret;&t;&t;&bslash;&n;&t;__asm__ (&quot;srl&t;%0, 0, %0&quot;&t;&bslash;&n;&t;&t; : &quot;=r&quot; (__ret)&t;&t;&bslash;&n;&t;&t; : &quot;0&quot; (__x));&t;&t;&bslash;&n;&t;__ret;&t;&t;&t;&t;&bslash;&n;})
DECL|macro|SUNOS_NR_OPEN
mdefine_line|#define SUNOS_NR_OPEN&t;256
DECL|struct|rtentry32
r_struct
id|rtentry32
(brace
DECL|member|rt_pad1
id|u32
id|rt_pad1
suffix:semicolon
DECL|member|rt_dst
r_struct
id|sockaddr
id|rt_dst
suffix:semicolon
multiline_comment|/* target address               */
DECL|member|rt_gateway
r_struct
id|sockaddr
id|rt_gateway
suffix:semicolon
multiline_comment|/* gateway addr (RTF_GATEWAY)   */
DECL|member|rt_genmask
r_struct
id|sockaddr
id|rt_genmask
suffix:semicolon
multiline_comment|/* target network mask (IP)     */
DECL|member|rt_flags
r_int
r_int
id|rt_flags
suffix:semicolon
DECL|member|rt_pad2
r_int
id|rt_pad2
suffix:semicolon
DECL|member|rt_pad3
id|u32
id|rt_pad3
suffix:semicolon
DECL|member|rt_tos
r_int
r_char
id|rt_tos
suffix:semicolon
DECL|member|rt_class
r_int
r_char
id|rt_class
suffix:semicolon
DECL|member|rt_pad4
r_int
id|rt_pad4
suffix:semicolon
DECL|member|rt_metric
r_int
id|rt_metric
suffix:semicolon
multiline_comment|/* +1 for binary compatibility! */
DECL|member|rt_dev
multiline_comment|/* char * */
id|u32
id|rt_dev
suffix:semicolon
multiline_comment|/* forcing the device at add    */
DECL|member|rt_mtu
id|u32
id|rt_mtu
suffix:semicolon
multiline_comment|/* per route MTU/Window         */
DECL|member|rt_window
id|u32
id|rt_window
suffix:semicolon
multiline_comment|/* Window clamping              */
DECL|member|rt_irtt
r_int
r_int
id|rt_irtt
suffix:semicolon
multiline_comment|/* Initial RTT                  */
)brace
suffix:semicolon
DECL|struct|ifmap32
r_struct
id|ifmap32
(brace
DECL|member|mem_start
id|u32
id|mem_start
suffix:semicolon
DECL|member|mem_end
id|u32
id|mem_end
suffix:semicolon
DECL|member|base_addr
r_int
r_int
id|base_addr
suffix:semicolon
DECL|member|irq
r_int
r_char
id|irq
suffix:semicolon
DECL|member|dma
r_int
r_char
id|dma
suffix:semicolon
DECL|member|port
r_int
r_char
id|port
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ifreq32
r_struct
id|ifreq32
(brace
DECL|macro|IFHWADDRLEN
mdefine_line|#define IFHWADDRLEN     6
DECL|macro|IFNAMSIZ
mdefine_line|#define IFNAMSIZ        16
r_union
(brace
DECL|member|ifrn_name
r_char
id|ifrn_name
(braket
id|IFNAMSIZ
)braket
suffix:semicolon
multiline_comment|/* if name, e.g. &quot;en0&quot; */
DECL|member|ifr_ifrn
)brace
id|ifr_ifrn
suffix:semicolon
r_union
(brace
DECL|member|ifru_addr
r_struct
id|sockaddr
id|ifru_addr
suffix:semicolon
DECL|member|ifru_dstaddr
r_struct
id|sockaddr
id|ifru_dstaddr
suffix:semicolon
DECL|member|ifru_broadaddr
r_struct
id|sockaddr
id|ifru_broadaddr
suffix:semicolon
DECL|member|ifru_netmask
r_struct
id|sockaddr
id|ifru_netmask
suffix:semicolon
DECL|member|ifru_hwaddr
r_struct
id|sockaddr
id|ifru_hwaddr
suffix:semicolon
DECL|member|ifru_flags
r_int
id|ifru_flags
suffix:semicolon
DECL|member|ifru_ivalue
r_int
id|ifru_ivalue
suffix:semicolon
DECL|member|ifru_mtu
r_int
id|ifru_mtu
suffix:semicolon
DECL|member|ifru_map
r_struct
id|ifmap32
id|ifru_map
suffix:semicolon
DECL|member|ifru_slave
r_char
id|ifru_slave
(braket
id|IFNAMSIZ
)braket
suffix:semicolon
multiline_comment|/* Just fits the size */
DECL|member|ifru_data
id|__kernel_caddr_t32
id|ifru_data
suffix:semicolon
DECL|member|ifr_ifru
)brace
id|ifr_ifru
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ifconf32
r_struct
id|ifconf32
(brace
DECL|member|ifc_len
r_int
id|ifc_len
suffix:semicolon
multiline_comment|/* size of buffer       */
DECL|member|ifcbuf
id|__kernel_caddr_t32
id|ifcbuf
suffix:semicolon
)brace
suffix:semicolon
r_extern
id|asmlinkage
r_int
id|sys_ioctl
c_func
(paren
r_int
r_int
id|fd
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
r_extern
id|asmlinkage
r_int
id|sys32_ioctl
c_func
(paren
r_int
r_int
comma
r_int
r_int
comma
id|u32
)paren
suffix:semicolon
r_extern
id|asmlinkage
r_int
id|sys_setsid
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|sunos_ioctl
id|asmlinkage
r_int
id|sunos_ioctl
(paren
r_int
id|fd
comma
id|u32
id|cmd
comma
id|u32
id|arg
)paren
(brace
r_int
id|ret
op_assign
op_minus
id|EBADF
suffix:semicolon
r_if
c_cond
(paren
id|fd
op_ge
id|SUNOS_NR_OPEN
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|fcheck
c_func
(paren
id|fd
)paren
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|TIOCSETD
)paren
(brace
id|mm_segment_t
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_int
op_star
id|p
comma
id|ntty
op_assign
id|N_TTY
suffix:semicolon
r_int
id|tmp
suffix:semicolon
id|p
op_assign
(paren
r_int
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|tmp
comma
id|p
)paren
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmp
op_eq
l_int|2
)paren
(brace
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_ioctl
c_func
(paren
id|fd
comma
id|cmd
comma
(paren
r_int
r_int
)paren
op_amp
id|ntty
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
id|ret
op_assign
(paren
id|ret
op_eq
op_minus
id|EINVAL
ques
c_cond
op_minus
id|EOPNOTSUPP
suffix:colon
id|ret
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|TIOCNOTTY
)paren
(brace
id|ret
op_assign
id|sys_setsid
c_func
(paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|_IOW
c_func
(paren
l_char|&squot;r&squot;
comma
l_int|10
comma
r_struct
id|rtentry32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCADDRT
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;r&squot;
comma
l_int|11
comma
r_struct
id|rtentry32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCDELRT
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|12
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFADDR
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOWR
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|13
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFADDR
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|14
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFDSTADDR
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOWR
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|15
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFDSTADDR
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|16
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFFLAGS
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOWR
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|17
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFFLAGS
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|18
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFMEM
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOWR
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|19
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFMEM
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOWR
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|20
comma
r_struct
id|ifconf32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFCONF
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|21
comma
r_struct
id|ifreq
)paren
suffix:colon
multiline_comment|/* SIOCSIFMTU */
id|ret
op_assign
id|sys_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFMTU
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOWR
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|22
comma
r_struct
id|ifreq
)paren
suffix:colon
multiline_comment|/* SIOCGIFMTU */
id|ret
op_assign
id|sys_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFMTU
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOWR
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|23
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFBRDADDR
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|24
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFBRDADDR
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOWR
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|25
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFNETMASK
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|26
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFNETMASK
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOWR
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|27
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGIFMETRIC
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|28
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSIFMETRIC
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|30
comma
r_struct
id|arpreq
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCSARP
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOWR
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|31
comma
r_struct
id|arpreq
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCGARP
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|32
comma
r_struct
id|arpreq
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCDARP
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|40
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCUPPER */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|41
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCLOWER */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|44
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCSETSYNC */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|45
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCGETSYNC */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|46
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCSSDSTATS */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|47
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCSSESTATS */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|48
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCSPROMISC */
id|ret
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|49
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCADDMULTI
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|50
comma
r_struct
id|ifreq32
)paren
suffix:colon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|SIOCDELMULTI
comma
id|arg
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
multiline_comment|/* FDDI interface ioctls, unsupported. */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|51
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCFDRESET */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|52
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCFDSLEEP */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|53
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCSTRTFMWAR */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|54
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCLDNSTRTFW */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|55
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCGETFDSTAT */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|56
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCFDNMIINT */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|57
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCFDEXUSER */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|58
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCFDGNETMAP */
r_case
id|_IOW
c_func
(paren
l_char|&squot;i&squot;
comma
l_int|59
comma
r_struct
id|ifreq32
)paren
suffix:colon
multiline_comment|/* SIOCFDGIOCTL */
id|printk
c_func
(paren
l_string|&quot;FDDI ioctl, returning EOPNOTSUPP&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|_IOW
c_func
(paren
l_char|&squot;t&squot;
comma
l_int|125
comma
r_int
)paren
suffix:colon
multiline_comment|/* More stupid tty sunos ioctls, just&n;&t;&t; * say it worked.&n;&t;&t; */
id|ret
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
multiline_comment|/* Non posix grp */
r_case
id|_IOW
c_func
(paren
l_char|&squot;t&squot;
comma
l_int|118
comma
r_int
)paren
suffix:colon
(brace
r_int
id|oldval
comma
id|newval
comma
op_star
id|ptr
suffix:semicolon
id|cmd
op_assign
id|TIOCSPGRP
suffix:semicolon
id|ptr
op_assign
(paren
r_int
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|oldval
comma
id|ptr
)paren
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|__get_user
c_func
(paren
id|newval
comma
id|ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newval
op_eq
op_minus
l_int|1
)paren
(brace
id|__put_user
c_func
(paren
id|oldval
comma
id|ptr
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
op_eq
op_minus
id|ENOTTY
)paren
(brace
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
)brace
r_case
id|_IOR
c_func
(paren
l_char|&squot;t&squot;
comma
l_int|119
comma
r_int
)paren
suffix:colon
(brace
r_int
id|oldval
comma
id|newval
comma
op_star
id|ptr
suffix:semicolon
id|cmd
op_assign
id|TIOCGPGRP
suffix:semicolon
id|ptr
op_assign
(paren
r_int
op_star
)paren
id|A
c_func
(paren
id|arg
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|oldval
comma
id|ptr
)paren
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|__get_user
c_func
(paren
id|newval
comma
id|ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newval
op_eq
op_minus
l_int|1
)paren
(brace
id|__put_user
c_func
(paren
id|oldval
comma
id|ptr
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
op_eq
op_minus
id|ENOTTY
)paren
(brace
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
)brace
)brace
suffix:semicolon
id|ret
op_assign
id|sys32_ioctl
c_func
(paren
id|fd
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
multiline_comment|/* so stupid... */
id|ret
op_assign
(paren
id|ret
op_eq
op_minus
id|EINVAL
ques
c_cond
op_minus
id|EOPNOTSUPP
suffix:colon
id|ret
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
eof
