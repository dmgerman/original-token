multiline_comment|/* $Id: init.c,v 1.10 1999/09/21 14:35:59 davem Exp $&n; * init.c:  Initialize internal variables used by the PROM&n; *          library functions.&n; *&n; * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n; * Copyright (C) 1996,1997 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
DECL|variable|prom_vers
r_enum
id|prom_major_version
id|prom_vers
suffix:semicolon
DECL|variable|prom_rev
DECL|variable|prom_prev
r_int
r_int
id|prom_rev
comma
id|prom_prev
suffix:semicolon
multiline_comment|/* The root node of the prom device tree. */
DECL|variable|prom_root_node
r_int
id|prom_root_node
suffix:semicolon
DECL|variable|prom_stdin
DECL|variable|prom_stdout
r_int
id|prom_stdin
comma
id|prom_stdout
suffix:semicolon
DECL|variable|prom_chosen_node
r_int
id|prom_chosen_node
suffix:semicolon
multiline_comment|/* You must call prom_init() before you attempt to use any of the&n; * routines in the prom library.  It returns 0 on success, 1 on&n; * failure.  It gets passed the pointer to the PROM vector.&n; */
r_extern
r_void
id|prom_meminit
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|prom_cif_init
c_func
(paren
r_void
op_star
comma
r_void
op_star
)paren
suffix:semicolon
DECL|function|prom_init
r_void
id|__init
id|prom_init
c_func
(paren
r_void
op_star
id|cif_handler
comma
r_void
op_star
id|cif_stack
)paren
(brace
r_char
id|buffer
(braket
l_int|80
)braket
comma
op_star
id|p
suffix:semicolon
r_int
id|ints
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|node
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|prom_vers
op_assign
id|PROM_P1275
suffix:semicolon
id|prom_cif_init
c_func
(paren
id|cif_handler
comma
id|cif_stack
)paren
suffix:semicolon
id|prom_root_node
op_assign
id|prom_getsibling
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|prom_root_node
op_eq
l_int|0
)paren
op_logical_or
(paren
id|prom_root_node
op_eq
op_minus
l_int|1
)paren
)paren
(brace
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|prom_chosen_node
op_assign
id|prom_finddevice
c_func
(paren
l_string|&quot;/chosen&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|prom_chosen_node
op_logical_or
id|prom_chosen_node
op_eq
op_minus
l_int|1
)paren
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
id|prom_stdin
op_assign
id|prom_getint
(paren
id|prom_chosen_node
comma
l_string|&quot;stdin&quot;
)paren
suffix:semicolon
id|prom_stdout
op_assign
id|prom_getint
(paren
id|prom_chosen_node
comma
l_string|&quot;stdout&quot;
)paren
suffix:semicolon
id|node
op_assign
id|prom_finddevice
c_func
(paren
l_string|&quot;/openprom&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|node
op_logical_or
id|node
op_eq
op_minus
l_int|1
)paren
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
id|prom_getstring
(paren
id|node
comma
l_string|&quot;version&quot;
comma
id|buffer
comma
r_sizeof
(paren
id|buffer
)paren
)paren
suffix:semicolon
id|prom_printf
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
(paren
id|buffer
comma
l_string|&quot;OBP &quot;
comma
l_int|4
)paren
)paren
r_goto
id|strange_version
suffix:semicolon
multiline_comment|/* Version field is expected to be &squot;OBP xx.yy.zz date...&squot; */
id|p
op_assign
id|buffer
op_plus
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|p
op_logical_and
id|isdigit
c_func
(paren
op_star
id|p
)paren
op_logical_and
id|i
OL
l_int|3
)paren
(brace
id|ints
(braket
id|i
op_increment
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|p
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|p
comma
l_char|&squot;.&squot;
)paren
)paren
op_ne
l_int|NULL
)paren
id|p
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ne
l_int|3
)paren
r_goto
id|strange_version
suffix:semicolon
id|prom_rev
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
id|prom_prev
op_assign
(paren
id|ints
(braket
l_int|0
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|ints
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|ints
(braket
l_int|2
)braket
suffix:semicolon
id|printk
(paren
l_string|&quot;PROMLIB: Sun IEEE Boot Prom %s&bslash;n&quot;
comma
id|buffer
op_plus
l_int|4
)paren
suffix:semicolon
id|prom_meminit
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Initialization successful. */
r_return
suffix:semicolon
id|strange_version
suffix:colon
id|prom_printf
(paren
l_string|&quot;Strange OBP version `%s&squot;.&bslash;n&quot;
comma
id|buffer
)paren
suffix:semicolon
id|prom_halt
(paren
)paren
suffix:semicolon
)brace
eof
