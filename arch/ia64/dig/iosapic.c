multiline_comment|/*&n; * Streamlined APIC support.&n; *&n; * Copyright (C) 1999 Intel Corp.&n; * Copyright (C) 1999 Asit Mallick &lt;asit.k.mallick@intel.com&gt;&n; * Copyright (C) 1999-2000 Hewlett-Packard Co.&n; * Copyright (C) 1999-2000 David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;&n; * Copyright (C) 1999 VA Linux Systems&n; * Copyright (C) 1999,2000 Walt Drummond &lt;drummond@valinux.com&gt;&n; *&n; * 00/04/19&t;D. Mosberger&t;Rewritten to mirror more closely the x86 I/O APIC code.&n; *&t;&t;&t;&t;In particular, we now have separate handlers for edge&n; *&t;&t;&t;&t;and level triggered interrupts.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/iosapic.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
DECL|macro|DEBUG_IRQ_ROUTING
macro_line|#undef DEBUG_IRQ_ROUTING
DECL|variable|iosapic_lock
r_static
id|spinlock_t
id|iosapic_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|iosapic_vector
r_struct
id|iosapic_vector
id|iosapic_vector
(braket
id|NR_IRQS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_IRQS
op_minus
l_int|1
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * find the IRQ in the IOSAPIC map for the PCI device on bus/slot/pin&n; */
r_int
DECL|function|iosapic_get_PCI_irq_vector
id|iosapic_get_PCI_irq_vector
(paren
r_int
id|bus
comma
r_int
id|slot
comma
r_int
id|pci_pin
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IRQS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|iosapic_bustype
c_func
(paren
id|i
)paren
op_eq
id|BUS_PCI
)paren
op_logical_and
(paren
id|iosapic_bus
c_func
(paren
id|i
)paren
op_eq
id|bus
)paren
op_logical_and
(paren
id|iosapic_busdata
c_func
(paren
id|i
)paren
op_eq
(paren
(paren
id|slot
op_lshift
l_int|16
)paren
op_or
id|pci_pin
)paren
)paren
)paren
(brace
r_return
id|i
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|set_rte
id|set_rte
(paren
r_int
r_int
id|iosapic_addr
comma
r_int
id|entry
comma
r_int
id|pol
comma
r_int
id|trigger
comma
r_int
id|delivery
comma
r_int
id|dest
comma
r_int
id|vector
)paren
(brace
id|u32
id|low32
suffix:semicolon
id|u32
id|high32
suffix:semicolon
id|low32
op_assign
(paren
(paren
id|pol
op_lshift
id|IO_SAPIC_POLARITY_SHIFT
)paren
op_or
(paren
id|trigger
op_lshift
id|IO_SAPIC_TRIGGER_SHIFT
)paren
op_or
(paren
id|delivery
op_lshift
id|IO_SAPIC_DELIVERY_SHIFT
)paren
op_or
id|vector
)paren
suffix:semicolon
multiline_comment|/* dest contains both id and eid */
id|high32
op_assign
(paren
id|dest
op_lshift
id|IO_SAPIC_DEST_SHIFT
)paren
suffix:semicolon
id|writel
c_func
(paren
id|IO_SAPIC_RTE_HIGH
c_func
(paren
id|entry
)paren
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_REG_SELECT
)paren
suffix:semicolon
id|writel
c_func
(paren
id|high32
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
id|writel
c_func
(paren
id|IO_SAPIC_RTE_LOW
c_func
(paren
id|entry
)paren
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_REG_SELECT
)paren
suffix:semicolon
id|writel
c_func
(paren
id|low32
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nop
id|nop
(paren
r_int
r_int
id|irq
)paren
(brace
multiline_comment|/* do nothing... */
)brace
r_static
r_void
DECL|function|mask_irq
id|mask_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
comma
id|iosapic_addr
op_assign
id|iosapic_addr
c_func
(paren
id|irq
)paren
suffix:semicolon
id|u32
id|low32
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|iosapic_lock
comma
id|flags
)paren
suffix:semicolon
(brace
id|writel
c_func
(paren
id|IO_SAPIC_RTE_LOW
c_func
(paren
id|iosapic_pin
c_func
(paren
id|irq
)paren
)paren
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_REG_SELECT
)paren
suffix:semicolon
id|low32
op_assign
id|readl
c_func
(paren
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
id|low32
op_or_assign
(paren
l_int|1
op_lshift
id|IO_SAPIC_MASK_SHIFT
)paren
suffix:semicolon
multiline_comment|/* Zero only the mask bit */
id|writel
c_func
(paren
id|low32
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|iosapic_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|unmask_irq
id|unmask_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
comma
id|iosapic_addr
op_assign
id|iosapic_addr
c_func
(paren
id|irq
)paren
suffix:semicolon
id|u32
id|low32
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|iosapic_lock
comma
id|flags
)paren
suffix:semicolon
(brace
id|writel
c_func
(paren
id|IO_SAPIC_RTE_LOW
c_func
(paren
id|iosapic_pin
c_func
(paren
id|irq
)paren
)paren
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_REG_SELECT
)paren
suffix:semicolon
id|low32
op_assign
id|readl
c_func
(paren
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
id|low32
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|IO_SAPIC_MASK_SHIFT
)paren
suffix:semicolon
multiline_comment|/* Zero only the mask bit */
id|writel
c_func
(paren
id|low32
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|iosapic_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|iosapic_set_affinity
id|iosapic_set_affinity
(paren
r_int
r_int
id|irq
comma
r_int
r_int
id|mask
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;iosapic_set_affinity: not implemented yet&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Handlers for level-triggered interrupts.&n; */
r_static
r_int
r_int
DECL|function|iosapic_startup_level_irq
id|iosapic_startup_level_irq
(paren
r_int
r_int
id|irq
)paren
(brace
id|unmask_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|iosapic_end_level_irq
id|iosapic_end_level_irq
(paren
r_int
r_int
id|irq
)paren
(brace
id|writel
c_func
(paren
id|irq
comma
id|iosapic_addr
c_func
(paren
id|irq
)paren
op_plus
id|IO_SAPIC_EOI
)paren
suffix:semicolon
)brace
DECL|macro|iosapic_shutdown_level_irq
mdefine_line|#define iosapic_shutdown_level_irq&t;mask_irq
DECL|macro|iosapic_enable_level_irq
mdefine_line|#define iosapic_enable_level_irq&t;unmask_irq
DECL|macro|iosapic_disable_level_irq
mdefine_line|#define iosapic_disable_level_irq&t;mask_irq
DECL|macro|iosapic_ack_level_irq
mdefine_line|#define iosapic_ack_level_irq&t;&t;nop
DECL|variable|irq_type_iosapic_level
r_struct
id|hw_interrupt_type
id|irq_type_iosapic_level
op_assign
(brace
r_typename
suffix:colon
l_string|&quot;IO-SAPIC-level&quot;
comma
id|startup
suffix:colon
id|iosapic_startup_level_irq
comma
id|shutdown
suffix:colon
id|iosapic_shutdown_level_irq
comma
id|enable
suffix:colon
id|iosapic_enable_level_irq
comma
id|disable
suffix:colon
id|iosapic_disable_level_irq
comma
id|ack
suffix:colon
id|iosapic_ack_level_irq
comma
id|end
suffix:colon
id|iosapic_end_level_irq
comma
id|set_affinity
suffix:colon
id|iosapic_set_affinity
)brace
suffix:semicolon
multiline_comment|/*&n; * Handlers for edge-triggered interrupts.&n; */
r_static
r_int
r_int
DECL|function|iosapic_startup_edge_irq
id|iosapic_startup_edge_irq
(paren
r_int
r_int
id|irq
)paren
(brace
id|unmask_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * IOSAPIC simply drops interrupts pended while the&n;&t; * corresponding pin was masked, so we can&squot;t know if an&n;&t; * interrupt is pending already.  Let&squot;s hope not...&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|iosapic_ack_edge_irq
id|iosapic_ack_edge_irq
(paren
r_int
r_int
id|irq
)paren
(brace
multiline_comment|/*&n;&t; * Once we have recorded IRQ_PENDING already, we can mask the&n;&t; * interrupt for real. This prevents IRQ storms from unhandled&n;&t; * devices.&n;&t; */
r_if
c_cond
(paren
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_PENDING
op_or
id|IRQ_DISABLED
)paren
)paren
op_eq
(paren
id|IRQ_PENDING
op_or
id|IRQ_DISABLED
)paren
)paren
id|mask_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|macro|iosapic_enable_edge_irq
mdefine_line|#define iosapic_enable_edge_irq&t;&t;unmask_irq
DECL|macro|iosapic_disable_edge_irq
mdefine_line|#define iosapic_disable_edge_irq&t;nop
DECL|macro|iosapic_end_edge_irq
mdefine_line|#define iosapic_end_edge_irq&t;&t;nop
DECL|variable|irq_type_iosapic_edge
r_struct
id|hw_interrupt_type
id|irq_type_iosapic_edge
op_assign
(brace
r_typename
suffix:colon
l_string|&quot;IO-SAPIC-edge&quot;
comma
id|startup
suffix:colon
id|iosapic_startup_edge_irq
comma
id|shutdown
suffix:colon
id|iosapic_disable_edge_irq
comma
id|enable
suffix:colon
id|iosapic_enable_edge_irq
comma
id|disable
suffix:colon
id|iosapic_disable_edge_irq
comma
id|ack
suffix:colon
id|iosapic_ack_edge_irq
comma
id|end
suffix:colon
id|iosapic_end_edge_irq
comma
id|set_affinity
suffix:colon
id|iosapic_set_affinity
)brace
suffix:semicolon
r_int
r_int
DECL|function|iosapic_version
id|iosapic_version
(paren
r_int
r_int
id|base_addr
)paren
(brace
multiline_comment|/*&n;&t; * IOSAPIC Version Register return 32 bit structure like:&n;&t; * {&n;&t; *&t;unsigned int version   : 8;&n;&t; *&t;unsigned int reserved1 : 8;&n;&t; *&t;unsigned int pins      : 8;&n;&t; *&t;unsigned int reserved2 : 8;&n;&t; * }&n;&t; */
id|writel
c_func
(paren
id|IO_SAPIC_VERSION
comma
id|base_addr
op_plus
id|IO_SAPIC_REG_SELECT
)paren
suffix:semicolon
r_return
id|readl
c_func
(paren
id|IO_SAPIC_WINDOW
op_plus
id|base_addr
)paren
suffix:semicolon
)brace
r_void
DECL|function|iosapic_init
id|iosapic_init
(paren
r_int
r_int
id|address
)paren
(brace
r_struct
id|hw_interrupt_type
op_star
id|irq_type
suffix:semicolon
r_struct
id|pci_vector_struct
op_star
id|vectors
suffix:semicolon
r_int
id|i
comma
id|irq
suffix:semicolon
multiline_comment|/* &n;&t; * Map the legacy ISA devices into the IOSAPIC data.  Some of&n;&t; * these may get reprogrammed later on with data from the ACPI&n;&t; * Interrupt Source Override table.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq
op_assign
id|isa_irq_to_vector
c_func
(paren
id|i
)paren
suffix:semicolon
id|iosapic_pin
c_func
(paren
id|irq
)paren
op_assign
id|i
suffix:semicolon
id|iosapic_bus
c_func
(paren
id|irq
)paren
op_assign
id|BUS_ISA
suffix:semicolon
id|iosapic_busdata
c_func
(paren
id|irq
)paren
op_assign
l_int|0
suffix:semicolon
id|iosapic_dmode
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_LOWEST_PRIORITY
suffix:semicolon
id|iosapic_trigger
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_EDGE
suffix:semicolon
id|iosapic_polarity
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_POL_HIGH
suffix:semicolon
macro_line|#ifdef DEBUG_IRQ_ROUTING
id|printk
c_func
(paren
l_string|&quot;ISA: IRQ %02x -&gt; Vector %02x IOSAPIC Pin %d&bslash;n&quot;
comma
id|i
comma
id|irq
comma
id|iosapic_pin
c_func
(paren
id|irq
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* &n;&t; * Map the PCI Interrupt data into the ACPI IOSAPIC data using&n;&t; * the info that the bootstrap loader passed to us.&n;&t; */
id|ia64_boot_param.pci_vectors
op_assign
(paren
id|__u64
)paren
id|__va
c_func
(paren
id|ia64_boot_param.pci_vectors
)paren
suffix:semicolon
id|vectors
op_assign
(paren
r_struct
id|pci_vector_struct
op_star
)paren
id|ia64_boot_param.pci_vectors
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ia64_boot_param.num_pci_vectors
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq
op_assign
id|vectors
(braket
id|i
)braket
dot
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|irq
OL
l_int|16
)paren
id|irq
op_assign
id|isa_irq_to_vector
c_func
(paren
id|irq
)paren
suffix:semicolon
id|iosapic_bustype
c_func
(paren
id|irq
)paren
op_assign
id|BUS_PCI
suffix:semicolon
id|iosapic_pin
c_func
(paren
id|irq
)paren
op_assign
id|irq
op_minus
id|iosapic_baseirq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|iosapic_bus
c_func
(paren
id|irq
)paren
op_assign
id|vectors
(braket
id|i
)braket
dot
id|bus
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Map the PCI slot and pin data into iosapic_busdata()&n;&t;&t; */
id|iosapic_busdata
c_func
(paren
id|irq
)paren
op_assign
(paren
id|vectors
(braket
id|i
)braket
dot
id|pci_id
op_amp
l_int|0xffff0000
)paren
op_or
id|vectors
(braket
id|i
)braket
dot
id|pin
suffix:semicolon
multiline_comment|/* Default settings for PCI */
id|iosapic_dmode
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_LOWEST_PRIORITY
suffix:semicolon
id|iosapic_trigger
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_LEVEL
suffix:semicolon
id|iosapic_polarity
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_POL_LOW
suffix:semicolon
macro_line|#ifdef DEBUG_IRQ_ROUTING
id|printk
c_func
(paren
l_string|&quot;PCI: BUS %d Slot %x Pin %x IRQ %02x --&gt; Vector %02x IOSAPIC Pin %d&bslash;n&quot;
comma
id|vectors
(braket
id|i
)braket
dot
id|bus
comma
id|vectors
(braket
id|i
)braket
dot
id|pci_id
op_rshift
l_int|16
comma
id|vectors
(braket
id|i
)braket
dot
id|pin
comma
id|vectors
(braket
id|i
)braket
dot
id|irq
comma
id|irq
comma
id|iosapic_pin
c_func
(paren
id|irq
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IRQS
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|iosapic_pin
c_func
(paren
id|i
)paren
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|iosapic_trigger
c_func
(paren
id|i
)paren
op_eq
id|IO_SAPIC_LEVEL
)paren
id|irq_type
op_assign
op_amp
id|irq_type_iosapic_level
suffix:semicolon
r_else
id|irq_type
op_assign
op_amp
id|irq_type_iosapic_edge
suffix:semicolon
r_if
c_cond
(paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_ne
op_amp
id|no_irq_type
)paren
id|printk
c_func
(paren
l_string|&quot;dig_irq_init: warning: changing vector %d from %s to %s&bslash;n&quot;
comma
id|i
comma
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_member_access_from_pointer
r_typename
comma
id|irq_type
op_member_access_from_pointer
r_typename
)paren
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
id|irq_type
suffix:semicolon
multiline_comment|/* program the IOSAPIC routing table: */
id|set_rte
c_func
(paren
id|iosapic_addr
c_func
(paren
id|i
)paren
comma
id|iosapic_pin
c_func
(paren
id|i
)paren
comma
id|iosapic_polarity
c_func
(paren
id|i
)paren
comma
id|iosapic_trigger
c_func
(paren
id|i
)paren
comma
id|iosapic_dmode
c_func
(paren
id|i
)paren
comma
(paren
id|ia64_get_lid
c_func
(paren
)paren
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
comma
id|i
)paren
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|dig_irq_init
id|dig_irq_init
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; * Disable the compatibility mode interrupts (8259 style), needs IN/OUT support&n;&t; * enabled.&n;&t; */
id|outb
c_func
(paren
l_int|0xff
comma
l_int|0xA1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
l_int|0x21
)paren
suffix:semicolon
macro_line|#ifndef CONFIG_IA64_DIG
id|iosapic_init
c_func
(paren
id|IO_SAPIC_DEFAULT_ADDR
)paren
suffix:semicolon
macro_line|#endif
)brace
r_void
DECL|function|dig_pci_fixup
id|dig_pci_fixup
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
r_char
id|pin
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|dev
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_INTERRUPT_PIN
comma
op_amp
id|pin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pin
)paren
(brace
id|pin
op_decrement
suffix:semicolon
multiline_comment|/* interrupt pins are numbered starting from 1 */
id|irq
op_assign
id|iosapic_get_PCI_irq_vector
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
comma
id|pin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
OL
l_int|0
op_logical_and
id|dev-&gt;bus-&gt;parent
)paren
(brace
multiline_comment|/* go back to the bridge */
r_struct
id|pci_dev
op_star
id|bridge
op_assign
id|dev-&gt;bus-&gt;self
suffix:semicolon
multiline_comment|/* do the bridge swizzle... */
id|pin
op_assign
(paren
id|pin
op_plus
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
)paren
op_mod
l_int|4
suffix:semicolon
id|irq
op_assign
id|iosapic_get_PCI_irq_vector
c_func
(paren
id|bridge-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|bridge-&gt;devfn
)paren
comma
id|pin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_ge
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;PCI: using PPB(B%d,I%d,P%d) to get irq %02x&bslash;n&quot;
comma
id|bridge-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|bridge-&gt;devfn
)paren
comma
id|pin
comma
id|irq
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq
op_ge
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PCI-&gt;APIC IRQ transform: (B%d,I%d,P%d) -&gt; %02x&bslash;n&quot;
comma
id|dev-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
comma
id|pin
comma
id|irq
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; * Nothing to fixup&n;&t;&t; * Fix out-of-range IRQ numbers&n;&t;&t; */
r_if
c_cond
(paren
id|dev-&gt;irq
op_ge
id|NR_IRQS
)paren
id|dev-&gt;irq
op_assign
l_int|15
suffix:semicolon
multiline_comment|/* Spurious interrupts */
)brace
)brace
eof
