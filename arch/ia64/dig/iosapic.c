multiline_comment|/*&n; * Streamlined APIC support.&n; *&n; * Copyright (C) 1999 Intel Corp.&n; * Copyright (C) 1999 Asit Mallick &lt;asit.k.mallick@intel.com&gt;&n; * Copyright (C) 1999-2000 Hewlett-Packard Co.&n; * Copyright (C) 1999-2000 David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;&n; * Copyright (C) 1999 VA Linux Systems&n; * Copyright (C) 1999,2000 Walt Drummond &lt;drummond@valinux.com&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/iosapic.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
DECL|macro|DEBUG_IRQ_ROUTING
macro_line|#undef DEBUG_IRQ_ROUTING
multiline_comment|/*&n; * IRQ vectors 0..15 are treated as the legacy interrupts of the PC-AT&n; * platform.  No new drivers should ever ask for specific irqs, but we&n; * provide compatibility here in case there is an old driver that does&n; * ask for specific irqs (serial, keyboard, stuff like that).  Since&n; * IA-64 doesn&squot;t allow irq 0..15 to be used for external interrupts&n; * anyhow, this in no way prevents us from doing the Right Thing&n; * with new drivers.&n; */
DECL|variable|iosapic_vector
r_struct
id|iosapic_vector
id|iosapic_vector
(braket
id|NR_IRQS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_IRQS
op_minus
l_int|1
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
)brace
suffix:semicolon
macro_line|#ifndef CONFIG_IA64_IRQ_ACPI
multiline_comment|/*&n; * Defines the default interrupt routing information for the LION platform&n; * XXX - this information should be obtained from the ACPI and hardcoded since&n; * we do not have ACPI AML support.&n; */
DECL|variable|intr_routing
r_struct
id|intr_routing_entry
id|intr_routing
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|2
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|2
comma
l_int|0xff
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|3
comma
l_int|3
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|4
comma
l_int|4
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|5
comma
l_int|5
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|6
comma
l_int|6
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|7
comma
l_int|7
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|8
comma
l_int|8
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|9
comma
l_int|9
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|10
comma
l_int|10
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|11
comma
l_int|11
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|12
comma
l_int|12
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|13
comma
l_int|13
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|14
comma
l_int|14
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|15
comma
l_int|15
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
macro_line|#ifdef CONFIG_IA64_LION_HACKS
(brace
l_int|1
comma
l_int|0
comma
l_int|0x04
comma
l_int|16
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 1, INTA */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x05
comma
l_int|26
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 1, INTB */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x06
comma
l_int|36
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 1, INTC */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x07
comma
l_int|42
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 1, INTD */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x08
comma
l_int|17
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 2, INTA */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x09
comma
l_int|27
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 2, INTB */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x0a
comma
l_int|37
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 2, INTC */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x0b
comma
l_int|42
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 2, INTD */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x0f
comma
l_int|50
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 3, INTD */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x14
comma
l_int|51
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 5, INTA */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x18
comma
l_int|49
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 6, INTA */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x04
comma
l_int|18
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 1, INTA */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x05
comma
l_int|28
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 1, INTB */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x06
comma
l_int|38
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 1, INTC */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x07
comma
l_int|43
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 1, INTD */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x08
comma
l_int|48
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 2, INTA */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x0c
comma
l_int|19
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 3, INTA */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x0d
comma
l_int|29
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 3, INTB */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x0e
comma
l_int|38
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 3, INTC */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x0f
comma
l_int|44
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 3, INTD */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x10
comma
l_int|20
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 4, INTA */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x11
comma
l_int|30
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 4, INTB */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x12
comma
l_int|39
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 4, INTC */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x13
comma
l_int|45
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 4, INTD */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x04
comma
l_int|21
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 1, INTA */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x05
comma
l_int|31
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 1, INTB */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x06
comma
l_int|39
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 1, INTC */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x07
comma
l_int|45
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 1, INTD */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x08
comma
l_int|22
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 2, INTA */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x09
comma
l_int|32
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 2, INTB */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x0a
comma
l_int|40
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 2, INTC */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x0b
comma
l_int|46
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 2, INTD */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x0c
comma
l_int|23
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 3, INTA */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x0d
comma
l_int|33
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 3, INTB */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x0e
comma
l_int|40
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 3, INTC */
(brace
l_int|1
comma
l_int|2
comma
l_int|0x0f
comma
l_int|46
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 2, device id 3, INTD */
(brace
l_int|1
comma
l_int|3
comma
l_int|0x04
comma
l_int|24
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 3, device id 1, INTA */
(brace
l_int|1
comma
l_int|3
comma
l_int|0x05
comma
l_int|34
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 3, device id 1, INTB */
(brace
l_int|1
comma
l_int|3
comma
l_int|0x06
comma
l_int|41
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 3, device id 1, INTC */
(brace
l_int|1
comma
l_int|3
comma
l_int|0x07
comma
l_int|47
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 3, device id 1, INTD */
(brace
l_int|1
comma
l_int|3
comma
l_int|0x08
comma
l_int|25
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 3, device id 2, INTA */
(brace
l_int|1
comma
l_int|3
comma
l_int|0x09
comma
l_int|35
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 3, device id 2, INTB */
(brace
l_int|1
comma
l_int|3
comma
l_int|0x0a
comma
l_int|41
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 3, device id 2, INTC */
(brace
l_int|1
comma
l_int|3
comma
l_int|0x0b
comma
l_int|47
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 3, device id 2, INTD */
macro_line|#else
multiline_comment|/*&n;       * BigSur platform, bus 0, device 1,2,4 and bus 1 device 0-3&n;       */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x0
comma
l_int|19
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 0, INTA */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x1
comma
l_int|18
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 0, INTB */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x2
comma
l_int|17
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 0, INTC */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x3
comma
l_int|16
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 0, INTD */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x4
comma
l_int|23
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 1, INTA */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x5
comma
l_int|22
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 1, INTB */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x6
comma
l_int|21
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 1, INTC */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x7
comma
l_int|20
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 1, INTD */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x8
comma
l_int|27
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 2, INTA */
(brace
l_int|1
comma
l_int|1
comma
l_int|0x9
comma
l_int|26
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 2, INTB */
(brace
l_int|1
comma
l_int|1
comma
l_int|0xa
comma
l_int|25
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 2, INTC */
(brace
l_int|1
comma
l_int|1
comma
l_int|0xb
comma
l_int|24
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 2, INTD */
(brace
l_int|1
comma
l_int|1
comma
l_int|0xc
comma
l_int|31
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 3, INTA */
(brace
l_int|1
comma
l_int|1
comma
l_int|0xd
comma
l_int|30
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 3, INTB */
(brace
l_int|1
comma
l_int|1
comma
l_int|0xe
comma
l_int|29
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 3, INTC */
(brace
l_int|1
comma
l_int|1
comma
l_int|0xf
comma
l_int|28
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 1, device id 3, INTD */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x4
comma
l_int|35
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 1, INTA */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x5
comma
l_int|34
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 1, INTB */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x6
comma
l_int|33
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 1, INTC */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x7
comma
l_int|32
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 1, INTD */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x8
comma
l_int|39
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 2, INTA */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x9
comma
l_int|38
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 2, INTB */
(brace
l_int|1
comma
l_int|0
comma
l_int|0xa
comma
l_int|37
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 2, INTC */
(brace
l_int|1
comma
l_int|0
comma
l_int|0xb
comma
l_int|36
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 2, INTD */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x10
comma
l_int|43
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 4, INTA */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x11
comma
l_int|42
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 4, INTB */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x12
comma
l_int|41
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 4, INTC */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x13
comma
l_int|40
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 4, INTD */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x14
comma
l_int|17
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 5, INTA */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x18
comma
l_int|18
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 6, INTA */
(brace
l_int|1
comma
l_int|0
comma
l_int|0x1c
comma
l_int|19
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
multiline_comment|/* bus 0, device id 7, INTA */
macro_line|#endif
(brace
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
comma
)brace
suffix:semicolon
r_int
DECL|function|iosapic_get_PCI_irq_vector
id|iosapic_get_PCI_irq_vector
c_func
(paren
r_int
id|bus
comma
r_int
id|slot
comma
r_int
id|pci_pin
)paren
(brace
r_int
id|i
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|intr_routing
(braket
op_increment
id|i
)braket
dot
id|srcbus
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
id|intr_routing
(braket
id|i
)braket
dot
id|srcbus
op_eq
id|BUS_PCI
)paren
(brace
r_if
c_cond
(paren
(paren
id|intr_routing
(braket
id|i
)braket
dot
id|srcbusirq
op_eq
(paren
(paren
id|slot
op_lshift
l_int|2
)paren
op_or
id|pci_pin
)paren
)paren
op_logical_and
(paren
id|intr_routing
(braket
id|i
)braket
dot
id|srcbusno
op_eq
id|bus
)paren
)paren
(brace
r_return
id|intr_routing
(braket
id|i
)braket
dot
id|iosapic_pin
suffix:semicolon
)brace
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#else /* CONFIG_IA64_IRQ_ACPI */
multiline_comment|/*&n; * find the IRQ in the IOSAPIC map for the PCI device on bus/slot/pin&n; */
r_int
DECL|function|iosapic_get_PCI_irq_vector
id|iosapic_get_PCI_irq_vector
c_func
(paren
r_int
id|bus
comma
r_int
id|slot
comma
r_int
id|pci_pin
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IRQS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|iosapic_bustype
c_func
(paren
id|i
)paren
op_eq
id|BUS_PCI
)paren
op_logical_and
(paren
id|iosapic_bus
c_func
(paren
id|i
)paren
op_eq
id|bus
)paren
op_logical_and
(paren
id|iosapic_busdata
c_func
(paren
id|i
)paren
op_eq
(paren
(paren
id|slot
op_lshift
l_int|16
)paren
op_or
id|pci_pin
)paren
)paren
)paren
(brace
r_return
id|i
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif /* !CONFIG_IA64_IRQ_ACPI */
r_static
r_void
DECL|function|set_rte
id|set_rte
(paren
r_int
r_int
id|iosapic_addr
comma
r_int
id|entry
comma
r_int
id|pol
comma
r_int
id|trigger
comma
r_int
id|delivery
comma
r_int
id|dest
comma
r_int
id|vector
)paren
(brace
r_int
id|low32
suffix:semicolon
r_int
id|high32
suffix:semicolon
id|low32
op_assign
(paren
(paren
id|pol
op_lshift
id|IO_SAPIC_POLARITY_SHIFT
)paren
op_or
(paren
id|trigger
op_lshift
id|IO_SAPIC_TRIGGER_SHIFT
)paren
op_or
(paren
id|delivery
op_lshift
id|IO_SAPIC_DELIVERY_SHIFT
)paren
op_or
id|vector
)paren
suffix:semicolon
multiline_comment|/* dest contains both id and eid */
id|high32
op_assign
(paren
id|dest
op_lshift
id|IO_SAPIC_DEST_SHIFT
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * program the rte &n;&t; */
id|writel
c_func
(paren
id|IO_SAPIC_RTE_HIGH
c_func
(paren
id|entry
)paren
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_REG_SELECT
)paren
suffix:semicolon
id|writel
c_func
(paren
id|high32
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
id|writel
c_func
(paren
id|IO_SAPIC_RTE_LOW
c_func
(paren
id|entry
)paren
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_REG_SELECT
)paren
suffix:semicolon
id|writel
c_func
(paren
id|low32
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|enable_pin
id|enable_pin
(paren
r_int
r_int
id|pin
comma
r_int
r_int
id|iosapic_addr
)paren
(brace
r_int
id|low32
suffix:semicolon
id|writel
c_func
(paren
id|IO_SAPIC_RTE_LOW
c_func
(paren
id|pin
)paren
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_REG_SELECT
)paren
suffix:semicolon
id|low32
op_assign
id|readl
c_func
(paren
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
id|low32
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|IO_SAPIC_MASK_SHIFT
)paren
suffix:semicolon
multiline_comment|/* Zero only the mask bit */
id|writel
c_func
(paren
id|low32
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|disable_pin
id|disable_pin
(paren
r_int
r_int
id|pin
comma
r_int
r_int
id|iosapic_addr
)paren
(brace
r_int
id|low32
suffix:semicolon
id|writel
c_func
(paren
id|IO_SAPIC_RTE_LOW
c_func
(paren
id|pin
)paren
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_REG_SELECT
)paren
suffix:semicolon
id|low32
op_assign
id|readl
c_func
(paren
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
id|low32
op_or_assign
(paren
l_int|1
op_lshift
id|IO_SAPIC_MASK_SHIFT
)paren
suffix:semicolon
multiline_comment|/* Set only the mask bit */
id|writel
c_func
(paren
id|low32
comma
id|iosapic_addr
op_plus
id|IO_SAPIC_WINDOW
)paren
suffix:semicolon
)brace
DECL|macro|iosapic_shutdown_irq
mdefine_line|#define iosapic_shutdown_irq&t;iosapic_disable_irq
r_static
r_void
DECL|function|iosapic_enable_irq
id|iosapic_enable_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
id|pin
op_assign
id|iosapic_pin
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pin
OL
l_int|0
)paren
multiline_comment|/* happens during irq auto probing... */
r_return
suffix:semicolon
id|enable_pin
c_func
(paren
id|pin
comma
id|iosapic_addr
c_func
(paren
id|irq
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|iosapic_disable_irq
id|iosapic_disable_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
id|pin
op_assign
id|iosapic_pin
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pin
OL
l_int|0
)paren
r_return
suffix:semicolon
id|disable_pin
c_func
(paren
id|pin
comma
id|iosapic_addr
c_func
(paren
id|irq
)paren
)paren
suffix:semicolon
)brace
r_int
r_int
DECL|function|iosapic_version
id|iosapic_version
c_func
(paren
r_int
r_int
id|base_addr
)paren
(brace
multiline_comment|/*&n;&t; * IOSAPIC Version Register return 32 bit structure like:&n;&t; * {&n;&t; *&t;unsigned int version   : 8;&n;&t; *&t;unsigned int reserved1 : 8;&n;&t; *&t;unsigned int pins      : 8;&n;&t; *&t;unsigned int reserved2 : 8;&n;&t; * }&n;&t; */
id|writel
c_func
(paren
id|IO_SAPIC_VERSION
comma
id|base_addr
op_plus
id|IO_SAPIC_REG_SELECT
)paren
suffix:semicolon
r_return
id|readl
c_func
(paren
id|IO_SAPIC_WINDOW
op_plus
id|base_addr
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|iosapic_handle_irq
id|iosapic_handle_irq
(paren
r_int
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|irqaction
op_star
id|action
op_assign
l_int|0
suffix:semicolon
r_struct
id|irq_desc
op_star
id|id
op_assign
id|irq_desc
op_plus
id|irq
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|irq_controller_lock
)paren
suffix:semicolon
(brace
id|status
op_assign
id|id-&gt;status
suffix:semicolon
multiline_comment|/* do we need to do something IOSAPIC-specific to ACK the irq here??? */
multiline_comment|/* Yes, but only level-triggered interrupts. We&squot;ll do that later */
r_if
c_cond
(paren
(paren
id|status
op_amp
id|IRQ_INPROGRESS
)paren
op_eq
l_int|0
op_logical_and
(paren
id|status
op_amp
id|IRQ_ENABLED
)paren
op_ne
l_int|0
)paren
(brace
id|action
op_assign
id|id-&gt;action
suffix:semicolon
id|status
op_or_assign
id|IRQ_INPROGRESS
suffix:semicolon
)brace
id|id-&gt;status
op_assign
id|status
op_amp
op_complement
(paren
id|IRQ_REPLAY
op_or
id|IRQ_WAITING
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|irq_controller_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|action
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|id-&gt;status
op_amp
id|IRQ_AUTODETECT
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;iosapic_handle_irq: unexpected interrupt %u;&quot;
l_string|&quot;disabling it (status=%x)&bslash;n&quot;
comma
id|irq
comma
id|id-&gt;status
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If we don&squot;t have a handler, disable the pin so we&n;&t;&t; * won&squot;t get any further interrupts (until&n;&t;&t; * re-enabled).  --davidm 99/12/17&n;&t;&t; */
id|iosapic_disable_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|retval
op_assign
id|invoke_irq_handlers
(paren
id|irq
comma
id|regs
comma
id|action
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iosapic_trigger
c_func
(paren
id|irq
)paren
op_eq
id|IO_SAPIC_LEVEL
)paren
multiline_comment|/* ACK Level trigger interrupts */
id|writel
c_func
(paren
id|irq
comma
id|iosapic_addr
c_func
(paren
id|irq
)paren
op_plus
id|IO_SAPIC_EOI
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|irq_controller_lock
)paren
suffix:semicolon
(brace
id|status
op_assign
(paren
id|id-&gt;status
op_amp
op_complement
id|IRQ_INPROGRESS
)paren
suffix:semicolon
id|id-&gt;status
op_assign
id|status
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|irq_controller_lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_void
id|__init
DECL|function|iosapic_init
id|iosapic_init
(paren
r_int
r_int
id|addr
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_IA64_IRQ_ACPI
r_struct
id|pci_vector_struct
op_star
id|vectors
suffix:semicolon
r_int
id|irq
suffix:semicolon
macro_line|#else 
r_int
id|vector
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Disable all local interrupts&n;&t; */
id|ia64_set_itv
c_func
(paren
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|ia64_set_lrr0
c_func
(paren
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|ia64_set_lrr1
c_func
(paren
l_int|0
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Disable the compatibility mode interrupts (8259 style), needs IN/OUT support&n;&t; * enabled.&n;&t; */
id|outb
c_func
(paren
l_int|0xff
comma
l_int|0xA1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
l_int|0x21
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_IA64_SOFTSDV_HACKS)
id|memset
c_func
(paren
id|iosapic_vector
comma
l_int|0x0
comma
r_sizeof
(paren
id|iosapic_vector
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IRQS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|iosapic_pin
c_func
(paren
id|i
)paren
op_assign
l_int|0xff
suffix:semicolon
id|iosapic_addr
c_func
(paren
id|i
)paren
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|IO_SAPIC_DEFAULT_ADDR
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* XXX this should come from systab or some such: */
id|iosapic_pin
c_func
(paren
id|TIMER_IRQ
)paren
op_assign
l_int|5
suffix:semicolon
multiline_comment|/* System Clock Interrupt */
id|iosapic_pin
c_func
(paren
l_int|0x40
)paren
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* Keyboard */
id|iosapic_pin
c_func
(paren
l_int|0x92
)paren
op_assign
l_int|9
suffix:semicolon
multiline_comment|/* COM1 Serial Port */
id|iosapic_pin
c_func
(paren
l_int|0x80
)paren
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* Periodic Interrupt */
id|iosapic_pin
c_func
(paren
l_int|0xc0
)paren
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Mouse */
id|iosapic_pin
c_func
(paren
l_int|0xe0
)paren
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* IDE Disk */
id|iosapic_pin
c_func
(paren
l_int|0xf0
)paren
op_assign
l_int|6
suffix:semicolon
multiline_comment|/* E-IDE CDROM */
id|iosapic_pin
c_func
(paren
l_int|0xa0
)paren
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* Real PCI Interrupt */
macro_line|#elif !defined(CONFIG_IA64_IRQ_ACPI)
multiline_comment|/*&n;&t; * For systems where the routing info in ACPI is&n;&t; * unavailable/wrong, use the intr_routing information to&n;&t; * initialize the iosapic array&n;&t; */
id|i
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|intr_routing
(braket
op_increment
id|i
)braket
dot
id|srcbus
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
id|intr_routing
(braket
id|i
)braket
dot
id|srcbus
op_eq
id|BUS_ISA
)paren
(brace
id|vector
op_assign
id|map_legacy_irq
c_func
(paren
id|intr_routing
(braket
id|i
)braket
dot
id|srcbusirq
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|intr_routing
(braket
id|i
)braket
dot
id|srcbus
op_eq
id|BUS_PCI
)paren
(brace
id|vector
op_assign
id|intr_routing
(braket
id|i
)braket
dot
id|iosapic_pin
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;unknown bus type %d for intr_routing[%d]&bslash;n&quot;
comma
id|intr_routing
(braket
id|i
)braket
dot
id|srcbus
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|iosapic_pin
c_func
(paren
id|vector
)paren
op_assign
id|intr_routing
(braket
id|i
)braket
dot
id|iosapic_pin
suffix:semicolon
id|iosapic_dmode
c_func
(paren
id|vector
)paren
op_assign
id|intr_routing
(braket
id|i
)braket
dot
id|mode
suffix:semicolon
id|iosapic_polarity
c_func
(paren
id|vector
)paren
op_assign
id|intr_routing
(braket
id|i
)braket
dot
id|polarity
suffix:semicolon
id|iosapic_trigger
c_func
(paren
id|vector
)paren
op_assign
id|intr_routing
(braket
id|i
)braket
dot
id|trigger
suffix:semicolon
macro_line|# ifdef DEBUG_IRQ_ROUTING
id|printk
c_func
(paren
l_string|&quot;irq[0x%x(0x%x)]:0x%x, %d, %d, %d&bslash;n&quot;
comma
id|vector
comma
id|intr_routing
(braket
id|i
)braket
dot
id|srcbusirq
comma
id|iosapic_pin
c_func
(paren
id|vector
)paren
comma
id|iosapic_dmode
c_func
(paren
id|vector
)paren
comma
id|iosapic_polarity
c_func
(paren
id|vector
)paren
comma
id|iosapic_trigger
c_func
(paren
id|vector
)paren
)paren
suffix:semicolon
macro_line|# endif
)brace
macro_line|#else /* !defined(CONFIG_IA64_SOFTSDV_HACKS) &amp;&amp; !defined(CONFIG_IA64_IRQ_ACPI) */
multiline_comment|/* &n;&t; * Map the legacy ISA devices into the IOAPIC data; We&squot;ll override these&n;&t; * later with data from the ACPI Interrupt Source Override table.&n;&t; *&n;&t; * Huh, the Lion w/ FPSWA firmware has entries for _all_ of the legacy IRQs, &n;&t; * including those that are not different from PC/AT standard.  I don&squot;t know&n;&t; * if this is a bug in the other firmware or not.  I&squot;m going to leave this code &n;&t; * here, so that this works on BigSur but will go ask Intel. --wfd 2000-Jan-19&n;&t; *&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IA64_MIN_VECTORED_IRQ
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq
op_assign
id|map_legacy_irq
c_func
(paren
id|i
)paren
suffix:semicolon
id|iosapic_pin
c_func
(paren
id|irq
)paren
op_assign
id|i
suffix:semicolon
id|iosapic_bus
c_func
(paren
id|irq
)paren
op_assign
id|BUS_ISA
suffix:semicolon
id|iosapic_busdata
c_func
(paren
id|irq
)paren
op_assign
l_int|0
suffix:semicolon
id|iosapic_dmode
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_LOWEST_PRIORITY
suffix:semicolon
id|iosapic_trigger
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_EDGE
suffix:semicolon
id|iosapic_polarity
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_POL_HIGH
suffix:semicolon
macro_line|#ifdef DEBUG_IRQ_ROUTING
id|printk
c_func
(paren
l_string|&quot;ISA: IRQ %02x -&gt; Vector %02x IOSAPIC Pin %d&bslash;n&quot;
comma
id|i
comma
id|irq
comma
id|iosapic_pin
c_func
(paren
id|irq
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* &n;&t; * Map the PCI Interrupt data into the ACPI IOSAPIC data using&n;&t; * the info that the bootstrap loader passed to us.&n;&t; */
id|ia64_boot_param.pci_vectors
op_assign
(paren
id|__u64
)paren
id|__va
c_func
(paren
id|ia64_boot_param.pci_vectors
)paren
suffix:semicolon
id|vectors
op_assign
(paren
r_struct
id|pci_vector_struct
op_star
)paren
id|ia64_boot_param.pci_vectors
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ia64_boot_param.num_pci_vectors
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq
op_assign
id|map_legacy_irq
c_func
(paren
id|vectors
(braket
id|i
)braket
dot
id|irq
)paren
suffix:semicolon
id|iosapic_bustype
c_func
(paren
id|irq
)paren
op_assign
id|BUS_PCI
suffix:semicolon
id|iosapic_pin
c_func
(paren
id|irq
)paren
op_assign
id|irq
op_minus
id|iosapic_baseirq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|iosapic_bus
c_func
(paren
id|irq
)paren
op_assign
id|vectors
(braket
id|i
)braket
dot
id|bus
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Map the PCI slot and pin data into iosapic_busdata()&n;&t;&t; */
id|iosapic_busdata
c_func
(paren
id|irq
)paren
op_assign
(paren
id|vectors
(braket
id|i
)braket
dot
id|pci_id
op_amp
l_int|0xffff0000
)paren
op_or
id|vectors
(braket
id|i
)braket
dot
id|pin
suffix:semicolon
multiline_comment|/* Default settings for PCI */
id|iosapic_dmode
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_LOWEST_PRIORITY
suffix:semicolon
id|iosapic_trigger
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_LEVEL
suffix:semicolon
id|iosapic_polarity
c_func
(paren
id|irq
)paren
op_assign
id|IO_SAPIC_POL_LOW
suffix:semicolon
macro_line|#ifdef DEBUG_IRQ_ROUTING
id|printk
c_func
(paren
l_string|&quot;PCI: BUS %d Slot %x Pin %x IRQ %02x --&gt; Vector %02x IOSAPIC Pin %d&bslash;n&quot;
comma
id|vectors
(braket
id|i
)braket
dot
id|bus
comma
id|vectors
(braket
id|i
)braket
dot
id|pci_id
op_rshift
l_int|16
comma
id|vectors
(braket
id|i
)braket
dot
id|pin
comma
id|vectors
(braket
id|i
)braket
dot
id|irq
comma
id|irq
comma
id|iosapic_pin
c_func
(paren
id|irq
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif /* !CONFIG_IA64_IRQ_ACPI */
)brace
r_static
r_void
DECL|function|iosapic_startup_irq
id|iosapic_startup_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
id|pin
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
id|TIMER_IRQ
)paren
r_return
suffix:semicolon
id|pin
op_assign
id|iosapic_pin
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pin
OL
l_int|0
)paren
multiline_comment|/* happens during irq auto probing... */
r_return
suffix:semicolon
id|set_rte
c_func
(paren
id|iosapic_addr
c_func
(paren
id|irq
)paren
comma
id|pin
comma
id|iosapic_polarity
c_func
(paren
id|irq
)paren
comma
id|iosapic_trigger
c_func
(paren
id|irq
)paren
comma
id|iosapic_dmode
c_func
(paren
id|irq
)paren
comma
(paren
id|ia64_get_lid
c_func
(paren
)paren
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
comma
id|irq
)paren
suffix:semicolon
id|enable_pin
c_func
(paren
id|pin
comma
id|iosapic_addr
c_func
(paren
id|irq
)paren
)paren
suffix:semicolon
)brace
DECL|variable|irq_type_iosapic
r_struct
id|hw_interrupt_type
id|irq_type_iosapic
op_assign
(brace
l_string|&quot;IOSAPIC&quot;
comma
id|iosapic_init
comma
id|iosapic_startup_irq
comma
id|iosapic_shutdown_irq
comma
id|iosapic_handle_irq
comma
id|iosapic_enable_irq
comma
id|iosapic_disable_irq
)brace
suffix:semicolon
r_void
DECL|function|dig_irq_init
id|dig_irq_init
(paren
r_struct
id|irq_desc
id|desc
(braket
id|NR_IRQS
)braket
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; * Claim all non-legacy irq vectors as ours unless they&squot;re&n;&t; * claimed by someone else already (e.g., timer or IPI are&n;&t; * handled internally).&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
id|IA64_MIN_VECTORED_IRQ
suffix:semicolon
id|i
op_le
id|IA64_MAX_VECTORED_IRQ
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_eq
op_amp
id|irq_type_default
)paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
op_amp
id|irq_type_iosapic
suffix:semicolon
)brace
)brace
r_void
DECL|function|dig_pci_fixup
id|dig_pci_fixup
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_int
id|irq
suffix:semicolon
r_int
r_char
id|pin
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|dev
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_INTERRUPT_PIN
comma
op_amp
id|pin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pin
)paren
(brace
id|pin
op_decrement
suffix:semicolon
multiline_comment|/* interrupt pins are numbered starting from 1 */
id|irq
op_assign
id|iosapic_get_PCI_irq_vector
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
comma
id|pin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
OL
l_int|0
op_logical_and
id|dev-&gt;bus-&gt;parent
)paren
(brace
multiline_comment|/* go back to the bridge */
r_struct
id|pci_dev
op_star
id|bridge
op_assign
id|dev-&gt;bus-&gt;self
suffix:semicolon
multiline_comment|/* do the bridge swizzle... */
id|pin
op_assign
(paren
id|pin
op_plus
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
)paren
op_mod
l_int|4
suffix:semicolon
id|irq
op_assign
id|iosapic_get_PCI_irq_vector
c_func
(paren
id|bridge-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|bridge-&gt;devfn
)paren
comma
id|pin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_ge
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;PCI: using PPB(B%d,I%d,P%d) to get irq %02x&bslash;n&quot;
comma
id|bridge-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|bridge-&gt;devfn
)paren
comma
id|pin
comma
id|irq
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq
op_ge
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PCI-&gt;APIC IRQ transform: (B%d,I%d,P%d) -&gt; %02x&bslash;n&quot;
comma
id|dev-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
comma
id|pin
comma
id|irq
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; * Nothing to fixup&n;&t;&t; * Fix out-of-range IRQ numbers&n;&t;&t; */
r_if
c_cond
(paren
id|dev-&gt;irq
op_ge
id|NR_IRQS
)paren
id|dev-&gt;irq
op_assign
l_int|15
suffix:semicolon
multiline_comment|/* Spurious interrupts */
)brace
)brace
eof
