multiline_comment|/*&n; * File: &t;mca.c&n; * Purpose: &t;Generic MCA handling layer&n; *&n; * Updated for latest kernel&n; * Copyright (C) 2000 Intel&n; * Copyright (C) Chuck Fleckenstein (cfleck@co.intel.com)&n; *  &n; * Copyright (C) 1999 Silicon Graphics, Inc.&n; * Copyright (C) Vijay Chander(vijay@engr.sgi.com)&n; *&n; * 00/03/29 C. Fleckenstein  Fixed PAL/SAL update issues, began MCA bug fixes, logging issues, &n; *                           added min save state dump, added INIT handler. &n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;asm/machvec.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/sal.h&gt;
macro_line|#include &lt;asm/mca.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
DECL|struct|ia64_fptr
r_typedef
r_struct
id|ia64_fptr
(brace
DECL|member|fp
r_int
r_int
id|fp
suffix:semicolon
DECL|member|gp
r_int
r_int
id|gp
suffix:semicolon
DECL|typedef|ia64_fptr_t
)brace
id|ia64_fptr_t
suffix:semicolon
DECL|variable|ia64_mc_info
id|ia64_mc_info_t
id|ia64_mc_info
suffix:semicolon
DECL|variable|ia64_sal_to_os_handoff_state
id|ia64_mca_sal_to_os_state_t
id|ia64_sal_to_os_handoff_state
suffix:semicolon
DECL|variable|ia64_os_to_sal_handoff_state
id|ia64_mca_os_to_sal_state_t
id|ia64_os_to_sal_handoff_state
suffix:semicolon
DECL|variable|ia64_mca_proc_state_dump
id|u64
id|ia64_mca_proc_state_dump
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|ia64_mca_stack
id|u64
id|ia64_mca_stack
(braket
l_int|1024
)braket
suffix:semicolon
DECL|variable|ia64_mca_stackframe
id|u64
id|ia64_mca_stackframe
(braket
l_int|32
)braket
suffix:semicolon
DECL|variable|ia64_mca_bspstore
id|u64
id|ia64_mca_bspstore
(braket
l_int|1024
)braket
suffix:semicolon
DECL|variable|ia64_init_stack
id|u64
id|ia64_init_stack
(braket
id|INIT_TASK_SIZE
)braket
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|16
)paren
)paren
)paren
suffix:semicolon
r_static
r_void
id|ia64_mca_cmc_vector_setup
c_func
(paren
r_int
id|enable
comma
id|int_vector_t
id|cmc_vector
)paren
suffix:semicolon
r_static
r_void
id|ia64_mca_wakeup_ipi_wait
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ia64_mca_wakeup
c_func
(paren
r_int
id|cpu
)paren
suffix:semicolon
r_static
r_void
id|ia64_mca_wakeup_all
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ia64_log_init
c_func
(paren
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|ia64_log_get
c_func
(paren
r_int
comma
r_int
comma
id|prfunc_t
)paren
suffix:semicolon
r_static
r_void
id|ia64_log_clear
c_func
(paren
r_int
comma
r_int
comma
r_int
comma
id|prfunc_t
)paren
suffix:semicolon
r_extern
r_void
id|ia64_monarch_init_handler
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|ia64_slave_init_handler
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; * hack for now, add platform dependent handlers&n; * here&n; */
macro_line|#ifndef PLATFORM_MCA_HANDLERS
r_void
DECL|function|mca_handler_platform
id|mca_handler_platform
(paren
r_void
)paren
(brace
)brace
r_void
DECL|function|cmci_handler_platform
id|cmci_handler_platform
(paren
r_int
id|cmc_irq
comma
r_void
op_star
id|arg
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
)brace
multiline_comment|/*&n; * This routine will be used to deal with platform specific handling&n; * of the init, i.e. drop into the kernel debugger on server machine,&n; * or if the processor is part of some parallel machine without a&n; * console, then we would call the appropriate debug hooks here.&n; */
r_void
DECL|function|init_handler_platform
id|init_handler_platform
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
multiline_comment|/* if a kernel debugger is available call it here else just dump the registers */
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
multiline_comment|/* dump the state info */
)brace
r_void
DECL|function|log_print_platform
id|log_print_platform
(paren
r_void
op_star
id|cur_buff_ptr
comma
id|prfunc_t
id|prfunc
)paren
(brace
)brace
r_void
DECL|function|ia64_mca_init_platform
id|ia64_mca_init_platform
(paren
r_void
)paren
(brace
)brace
macro_line|#endif /* PLATFORM_MCA_HANDLERS */
DECL|variable|min_state_labels
r_static
r_char
op_star
id|min_state_labels
(braket
)braket
op_assign
(brace
l_string|&quot;nat&quot;
comma
l_string|&quot;r1&quot;
comma
l_string|&quot;r2&quot;
comma
l_string|&quot;r3&quot;
comma
l_string|&quot;r4&quot;
comma
l_string|&quot;r5&quot;
comma
l_string|&quot;r6&quot;
comma
l_string|&quot;r7&quot;
comma
l_string|&quot;r8&quot;
comma
l_string|&quot;r9&quot;
comma
l_string|&quot;r10&quot;
comma
l_string|&quot;r11&quot;
comma
l_string|&quot;r12&quot;
comma
l_string|&quot;r13&quot;
comma
l_string|&quot;r14&quot;
comma
l_string|&quot;r15&quot;
comma
l_string|&quot;b0r16&quot;
comma
l_string|&quot;b0r17&quot;
comma
l_string|&quot;b0r18&quot;
comma
l_string|&quot;b0r19&quot;
comma
l_string|&quot;b0r20&quot;
comma
l_string|&quot;b0r21&quot;
comma
l_string|&quot;b0r22&quot;
comma
l_string|&quot;b0r23&quot;
comma
l_string|&quot;b0r24&quot;
comma
l_string|&quot;b0r25&quot;
comma
l_string|&quot;b0r26&quot;
comma
l_string|&quot;b0r27&quot;
comma
l_string|&quot;b0r28&quot;
comma
l_string|&quot;b0r29&quot;
comma
l_string|&quot;b0r30&quot;
comma
l_string|&quot;b0r31&quot;
comma
l_string|&quot;r16&quot;
comma
l_string|&quot;r17&quot;
comma
l_string|&quot;r18&quot;
comma
l_string|&quot;r19&quot;
comma
l_string|&quot;r20&quot;
comma
l_string|&quot;r21&quot;
comma
l_string|&quot;r22&quot;
comma
l_string|&quot;r23&quot;
comma
l_string|&quot;r24&quot;
comma
l_string|&quot;r25&quot;
comma
l_string|&quot;r26&quot;
comma
l_string|&quot;r27&quot;
comma
l_string|&quot;r28&quot;
comma
l_string|&quot;r29&quot;
comma
l_string|&quot;r30&quot;
comma
l_string|&quot;r31&quot;
comma
l_string|&quot;preds&quot;
comma
l_string|&quot;br0&quot;
comma
l_string|&quot;rsc&quot;
comma
l_string|&quot;iip&quot;
comma
l_string|&quot;ipsr&quot;
comma
l_string|&quot;ifs&quot;
comma
l_string|&quot;xip&quot;
comma
l_string|&quot;xpsr&quot;
comma
l_string|&quot;xfs&quot;
)brace
suffix:semicolon
DECL|variable|ia64_pmss_dump_bank0
r_int
id|ia64_pmss_dump_bank0
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* dump bank 0 ? */
multiline_comment|/*&n; * routine to process and prepare to dump min_state_save&n; * information for debugging purposes.&n; *&n; */
r_void
DECL|function|ia64_process_min_state_save
id|ia64_process_min_state_save
(paren
id|pal_min_state_area_t
op_star
id|pmss
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
r_int
id|i
comma
id|max
op_assign
l_int|57
suffix:semicolon
id|u64
op_star
id|tpmss_ptr
op_assign
(paren
id|u64
op_star
)paren
id|pmss
suffix:semicolon
multiline_comment|/* dump out the min_state_area information */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ia64_pmss_dump_bank0
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;B0&quot;
comma
id|min_state_labels
(braket
id|i
)braket
comma
l_int|2
)paren
op_eq
l_int|0
)paren
(brace
id|tpmss_ptr
op_increment
suffix:semicolon
multiline_comment|/* skip to next entry */
r_continue
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;%5s=0x%16.16lx &quot;
comma
id|min_state_labels
(braket
id|i
)braket
comma
op_star
id|tpmss_ptr
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|3
)paren
op_eq
l_int|0
op_logical_or
(paren
(paren
op_logical_neg
id|strcmp
c_func
(paren
l_string|&quot;GR16&quot;
comma
id|min_state_labels
(braket
id|i
)braket
)paren
)paren
op_logical_and
op_logical_neg
id|ia64_pmss_dump_bank0
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* hang city for now, until we include debugger or copy to ptregs to show: */
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_cmc_vector_setup&n; *&t;Setup the correctable machine check vector register in the processor&n; * Inputs&n; *&t;Enable (1 - enable cmc interrupt , 0 - disable)&n; *&t;CMC handler entry point (if enabled)&n; *&n; * Outputs&n; *&t;None&n; */
r_static
r_void
DECL|function|ia64_mca_cmc_vector_setup
id|ia64_mca_cmc_vector_setup
c_func
(paren
r_int
id|enable
comma
id|int_vector_t
id|cmc_vector
)paren
(brace
id|cmcv_reg_t
id|cmcv
suffix:semicolon
id|cmcv.cmcv_regval
op_assign
l_int|0
suffix:semicolon
id|cmcv.cmcv_mask
op_assign
id|enable
suffix:semicolon
id|cmcv.cmcv_vector
op_assign
id|cmc_vector
suffix:semicolon
id|ia64_set_cmcv
c_func
(paren
id|cmcv.cmcv_regval
)paren
suffix:semicolon
)brace
macro_line|#if defined(MCA_TEST)
DECL|variable|slpi_buf
id|sal_log_processor_info_t
id|slpi_buf
suffix:semicolon
r_void
DECL|function|mca_test
id|mca_test
c_func
(paren
r_void
)paren
(brace
id|slpi_buf.slpi_valid.slpi_psi
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.slpi_valid.slpi_cache_check
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.slpi_valid.slpi_tlb_check
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.slpi_valid.slpi_bus_check
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.slpi_valid.slpi_minstate
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.slpi_valid.slpi_bank1_gr
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.slpi_valid.slpi_br
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.slpi_valid.slpi_cr
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.slpi_valid.slpi_ar
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.slpi_valid.slpi_rr
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.slpi_valid.slpi_fr
op_assign
l_int|1
suffix:semicolon
id|ia64_os_mca_dispatch
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* #if defined(MCA_TEST) */
multiline_comment|/*&n; * ia64_mca_init&n; *&t;Do all the mca specific initialization on a per-processor basis.&n; *&n; *&t;1. Register spinloop and wakeup request interrupt vectors&n; *&n; *&t;2. Register OS_MCA handler entry point&n; *&n; *&t;3. Register OS_INIT handler entry point&n; *&n; *&t;4. Initialize CMCV register to enable/disable CMC interrupt on the&n; *&t;   processor and hook a handler in the platform-specific ia64_mca_init.&n; *&n; *&t;5. Initialize MCA/CMC/INIT related log buffers maintained by the OS.&n; *&n; * Inputs&n; *&t;None&n; * Outputs&n; *&t;None&n; */
r_void
id|__init
DECL|function|ia64_mca_init
id|ia64_mca_init
c_func
(paren
r_void
)paren
(brace
id|ia64_fptr_t
op_star
id|mon_init_ptr
op_assign
(paren
id|ia64_fptr_t
op_star
)paren
id|ia64_monarch_init_handler
suffix:semicolon
id|ia64_fptr_t
op_star
id|slave_init_ptr
op_assign
(paren
id|ia64_fptr_t
op_star
)paren
id|ia64_slave_init_handler
suffix:semicolon
r_int
id|i
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init : begin&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Clear the Rendez checkin flag for all cpus */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IA64_MAXCPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ia64_mc_info.imi_rendez_checkin
(braket
id|i
)braket
op_assign
id|IA64_MCA_RENDEZ_CHECKIN_NOTDONE
suffix:semicolon
)brace
multiline_comment|/* NOTE : The actual irqs for the rendez, wakeup and &n;&t; * cmc interrupts are requested in the platform-specific&n;&t; * mca initialization code.&n;&t; */
multiline_comment|/* &n;&t; * Register the rendezvous spinloop and wakeup mechanism with SAL&n;&t; */
multiline_comment|/* Register the rendezvous interrupt vector with SAL */
r_if
c_cond
(paren
id|ia64_sal_mc_set_params
c_func
(paren
id|SAL_MC_PARAM_RENDEZ_INT
comma
id|SAL_MC_PARAM_MECHANISM_INT
comma
id|IA64_MCA_RENDEZ_INT_VECTOR
comma
id|IA64_MCA_RENDEZ_TIMEOUT
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* Register the wakeup interrupt vector with SAL */
r_if
c_cond
(paren
id|ia64_sal_mc_set_params
c_func
(paren
id|SAL_MC_PARAM_RENDEZ_WAKEUP
comma
id|SAL_MC_PARAM_MECHANISM_INT
comma
id|IA64_MCA_WAKEUP_INT_VECTOR
comma
l_int|0
)paren
)paren
r_return
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init : registered mca rendezvous spinloop and wakeup mech.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Setup the correctable machine check vector&n;&t; */
id|ia64_mca_cmc_vector_setup
c_func
(paren
id|IA64_CMC_INT_ENABLE
comma
id|IA64_MCA_CMC_INT_VECTOR
)paren
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init : correctable mca vector setup done&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_mc_info.imi_mca_handler
op_assign
id|__pa
c_func
(paren
id|ia64_os_mca_dispatch
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * XXX - disable SAL checksum by setting size to 0; should be&n;&t; *&t;__pa(ia64_os_mca_dispatch_end) - __pa(ia64_os_mca_dispatch);&n;&t; */
id|ia64_mc_info.imi_mca_handler_size
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Register the os mca handler with SAL */
r_if
c_cond
(paren
id|ia64_sal_set_vectors
c_func
(paren
id|SAL_VECTOR_OS_MCA
comma
id|ia64_mc_info.imi_mca_handler
comma
id|__pa
c_func
(paren
id|ia64_get_gp
c_func
(paren
)paren
)paren
comma
id|ia64_mc_info.imi_mca_handler_size
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
)paren
r_return
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init : registered os mca handler with SAL&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * XXX - disable SAL checksum by setting size to 0, should be&n;&t; * IA64_INIT_HANDLER_SIZE &n;&t; */
id|ia64_mc_info.imi_monarch_init_handler
op_assign
id|__pa
c_func
(paren
id|mon_init_ptr-&gt;fp
)paren
suffix:semicolon
id|ia64_mc_info.imi_monarch_init_handler_size
op_assign
l_int|0
suffix:semicolon
id|ia64_mc_info.imi_slave_init_handler
op_assign
id|__pa
c_func
(paren
id|slave_init_ptr-&gt;fp
)paren
suffix:semicolon
id|ia64_mc_info.imi_slave_init_handler_size
op_assign
l_int|0
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init : os init handler at %lx&bslash;n&quot;
comma
id|ia64_mc_info.imi_monarch_init_handler
)paren
suffix:semicolon
multiline_comment|/* Register the os init handler with SAL */
r_if
c_cond
(paren
id|ia64_sal_set_vectors
c_func
(paren
id|SAL_VECTOR_OS_INIT
comma
id|ia64_mc_info.imi_monarch_init_handler
comma
id|__pa
c_func
(paren
id|ia64_get_gp
c_func
(paren
)paren
)paren
comma
id|ia64_mc_info.imi_monarch_init_handler_size
comma
id|ia64_mc_info.imi_slave_init_handler
comma
id|__pa
c_func
(paren
id|ia64_get_gp
c_func
(paren
)paren
)paren
comma
id|ia64_mc_info.imi_slave_init_handler_size
)paren
)paren
r_return
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init : registered os init handler with SAL&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Initialize the areas set aside by the OS to buffer the &n;&t; * platform/processor error states for MCA/INIT/CMC&n;&t; * handling.&n;&t; */
id|ia64_log_init
c_func
(paren
id|SAL_INFO_TYPE_MCA
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
)paren
suffix:semicolon
id|ia64_log_init
c_func
(paren
id|SAL_INFO_TYPE_MCA
comma
id|SAL_SUB_INFO_TYPE_PLATFORM
)paren
suffix:semicolon
id|ia64_log_init
c_func
(paren
id|SAL_INFO_TYPE_INIT
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
)paren
suffix:semicolon
id|ia64_log_init
c_func
(paren
id|SAL_INFO_TYPE_INIT
comma
id|SAL_SUB_INFO_TYPE_PLATFORM
)paren
suffix:semicolon
id|ia64_log_init
c_func
(paren
id|SAL_INFO_TYPE_CMC
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
)paren
suffix:semicolon
id|ia64_log_init
c_func
(paren
id|SAL_INFO_TYPE_CMC
comma
id|SAL_SUB_INFO_TYPE_PLATFORM
)paren
suffix:semicolon
id|ia64_mca_init_platform
c_func
(paren
)paren
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init : platform-specific mca handling setup done&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if defined(MCA_TEST)
id|mca_test
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* #if defined(MCA_TEST) */
id|printk
c_func
(paren
l_string|&quot;Mca related initialization done&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_wakeup_ipi_wait&n; *&t;Wait for the inter-cpu interrupt to be sent by the&n; * &t;monarch processor once it is done with handling the&n; *&t;MCA.&n; * Inputs &n; *&t;None&n; * Outputs&n; *&t;None&n; */
r_void
DECL|function|ia64_mca_wakeup_ipi_wait
id|ia64_mca_wakeup_ipi_wait
c_func
(paren
r_void
)paren
(brace
r_int
id|irr_num
op_assign
(paren
id|IA64_MCA_WAKEUP_INT_VECTOR
op_rshift
l_int|6
)paren
suffix:semicolon
r_int
id|irr_bit
op_assign
(paren
id|IA64_MCA_WAKEUP_INT_VECTOR
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|u64
id|irr
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_switch
c_cond
(paren
id|irr_num
)paren
(brace
r_case
l_int|0
suffix:colon
id|irr
op_assign
id|ia64_get_irr0
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|irr
op_assign
id|ia64_get_irr1
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|irr
op_assign
id|ia64_get_irr2
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|irr
op_assign
id|ia64_get_irr3
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|irr
op_amp
(paren
l_int|1
op_lshift
id|irr_bit
)paren
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_wakeup&n; *&t;Send an inter-cpu interrupt to wake-up a particular cpu&n; * &t;and mark that cpu to be out of rendez.&n; * Inputs&n; *&t;cpuid&n; * Outputs&n; *&t;None&n; */
r_void
DECL|function|ia64_mca_wakeup
id|ia64_mca_wakeup
c_func
(paren
r_int
id|cpu
)paren
(brace
id|platform_send_ipi
c_func
(paren
id|cpu
comma
id|IA64_MCA_WAKEUP_INT_VECTOR
comma
id|IA64_IPI_DM_INT
comma
l_int|0
)paren
suffix:semicolon
id|ia64_mc_info.imi_rendez_checkin
(braket
id|cpu
)braket
op_assign
id|IA64_MCA_RENDEZ_CHECKIN_NOTDONE
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_wakeup_all&n; *&t;Wakeup all the cpus which have rendez&squot;ed previously.&n; * Inputs&n; *&t;None&n; * Outputs&n; *&t;None&n; */
r_void
DECL|function|ia64_mca_wakeup_all
id|ia64_mca_wakeup_all
c_func
(paren
r_void
)paren
(brace
r_int
id|cpu
suffix:semicolon
multiline_comment|/* Clear the Rendez checkin flag for all cpus */
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|smp_num_cpus
suffix:semicolon
id|cpu
op_increment
)paren
r_if
c_cond
(paren
id|ia64_mc_info.imi_rendez_checkin
(braket
id|cpu
)braket
op_eq
id|IA64_MCA_RENDEZ_CHECKIN_DONE
)paren
id|ia64_mca_wakeup
c_func
(paren
id|cpu
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_rendez_interrupt_handler&n; *&t;This is handler used to put slave processors into spinloop &n; *&t;while the monarch processor does the mca handling and later&n; *&t;wake each slave up once the monarch is done.&n; * Inputs &n; *&t;None&n; * Outputs&n; *&t;None&n; */
r_void
DECL|function|ia64_mca_rendez_int_handler
id|ia64_mca_rendez_int_handler
c_func
(paren
r_int
id|rendez_irq
comma
r_void
op_star
id|arg
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
r_int
id|flags
comma
id|cpu
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Mask all interrupts */
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
id|cpu
op_assign
id|cpu_logical_id
c_func
(paren
id|hard_smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
macro_line|#endif
id|ia64_mc_info.imi_rendez_checkin
(braket
id|cpu
)braket
op_assign
id|IA64_MCA_RENDEZ_CHECKIN_DONE
suffix:semicolon
multiline_comment|/* Register with the SAL monarch that the slave has&n;&t; * reached SAL&n;&t; */
id|ia64_sal_mc_rendez
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Wait for the wakeup IPI from the monarch &n;&t; * This waiting is done by polling on the wakeup-interrupt&n;&t; * vector bit in the processor&squot;s IRRs&n;&t; */
id|ia64_mca_wakeup_ipi_wait
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Enable all interrupts */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_wakeup_int_handler&n; *&t;The interrupt handler for processing the inter-cpu interrupt to the&n; * &t;slave cpu which was spinning in the rendez loop.&n; *&t;Since this spinning is done by turning off the interrupts and&n; *&t;polling on the wakeup-interrupt bit in the IRR, there is &n; *&t;nothing useful to be done in the handler.&n; *  Inputs&n; *&t;wakeup_irq&t;(Wakeup-interrupt bit)&n; *&t;arg&t;&t;(Interrupt handler specific argument)&n; *&t;ptregs&t;&t;(Exception frame at the time of the interrupt)&n; *  Outputs&n; *&t;&n; */
r_void
DECL|function|ia64_mca_wakeup_int_handler
id|ia64_mca_wakeup_int_handler
c_func
(paren
r_int
id|wakeup_irq
comma
r_void
op_star
id|arg
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
)brace
multiline_comment|/*&n; * ia64_return_to_sal_check&n; *&t;This is function called before going back from the OS_MCA handler&n; * &t;to the OS_MCA dispatch code which finally takes the control back&n; * &t;to the SAL.&n; *&t;The main purpose of this routine is to setup the OS_MCA to SAL&n; *&t;return state which can be used by the OS_MCA dispatch code &n; *&t;just before going back to SAL.&n; * Inputs&n; *&t;None&n; * Outputs&n; *&t;None&n; */
r_void
DECL|function|ia64_return_to_sal_check
id|ia64_return_to_sal_check
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Copy over some relevant stuff from the sal_to_os_mca_handoff&n;&t; * so that it can be used at the time of os_mca_to_sal_handoff&n;&t; */
id|ia64_os_to_sal_handoff_state.imots_sal_gp
op_assign
id|ia64_sal_to_os_handoff_state.imsto_sal_gp
suffix:semicolon
id|ia64_os_to_sal_handoff_state.imots_sal_check_ra
op_assign
id|ia64_sal_to_os_handoff_state.imsto_sal_check_ra
suffix:semicolon
multiline_comment|/* For now ignore the MCA */
id|ia64_os_to_sal_handoff_state.imots_os_status
op_assign
id|IA64_MCA_CORRECTED
suffix:semicolon
)brace
multiline_comment|/* &n; * ia64_mca_ucmc_handler&n; *&t;This is uncorrectable machine check handler called from OS_MCA&n; *&t;dispatch code which is in turn called from SAL_CHECK().&n; *&t;This is the place where the core of OS MCA handling is done.&n; *&t;Right now the logs are extracted and displayed in a well-defined&n; *&t;format. This handler code is supposed to be run only on the&n; *&t;monarch processor. Once the  monarch is done with MCA handling&n; *&t;further MCA logging is enabled by clearing logs.&n; *&t;Monarch also has the duty of sending wakeup-IPIs to pull the&n; *&t;slave processors out of rendez. spinloop.&n; * Inputs&n; *&t;None&n; * Outputs&n; *&t;None&n; */
r_void
DECL|function|ia64_mca_ucmc_handler
id|ia64_mca_ucmc_handler
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Get the MCA processor log */
id|ia64_log_get
c_func
(paren
id|SAL_INFO_TYPE_MCA
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
multiline_comment|/* Get the MCA platform log */
id|ia64_log_get
c_func
(paren
id|SAL_INFO_TYPE_MCA
comma
id|SAL_SUB_INFO_TYPE_PLATFORM
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
id|ia64_log_print
c_func
(paren
id|SAL_INFO_TYPE_MCA
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Do some error handling - Platform-specific mca handler is called at this point&n;&t; */
id|mca_handler_platform
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Clear the SAL MCA logs */
id|ia64_log_clear
c_func
(paren
id|SAL_INFO_TYPE_MCA
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
comma
l_int|1
comma
id|printk
)paren
suffix:semicolon
id|ia64_log_clear
c_func
(paren
id|SAL_INFO_TYPE_MCA
comma
id|SAL_SUB_INFO_TYPE_PLATFORM
comma
l_int|1
comma
id|printk
)paren
suffix:semicolon
multiline_comment|/* Wakeup all the processors which are spinning in the rendezvous&n;&t; * loop.&n;&t; */
id|ia64_mca_wakeup_all
c_func
(paren
)paren
suffix:semicolon
id|ia64_return_to_sal_check
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * ia64_mca_cmc_int_handler&n; *&t;This is correctable machine check interrupt handler.&n; *&t;Right now the logs are extracted and displayed in a well-defined&n; *&t;format. &n; * Inputs&n; *&t;None&n; * Outputs&n; *&t;None&n; */
r_void
DECL|function|ia64_mca_cmc_int_handler
id|ia64_mca_cmc_int_handler
c_func
(paren
r_int
id|cmc_irq
comma
r_void
op_star
id|arg
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
multiline_comment|/* Get the CMC processor log */
id|ia64_log_get
c_func
(paren
id|SAL_INFO_TYPE_CMC
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
multiline_comment|/* Get the CMC platform log */
id|ia64_log_get
c_func
(paren
id|SAL_INFO_TYPE_CMC
comma
id|SAL_SUB_INFO_TYPE_PLATFORM
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
id|ia64_log_print
c_func
(paren
id|SAL_INFO_TYPE_CMC
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
id|cmci_handler_platform
c_func
(paren
id|cmc_irq
comma
id|arg
comma
id|ptregs
)paren
suffix:semicolon
multiline_comment|/* Clear the CMC SAL logs now that they have been saved in the OS buffer */
id|ia64_sal_clear_state_info
c_func
(paren
id|SAL_INFO_TYPE_CMC
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
)paren
suffix:semicolon
id|ia64_sal_clear_state_info
c_func
(paren
id|SAL_INFO_TYPE_CMC
comma
id|SAL_SUB_INFO_TYPE_PLATFORM
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * IA64_MCA log support&n; */
DECL|macro|IA64_MAX_LOGS
mdefine_line|#define IA64_MAX_LOGS&t;&t;2&t;/* Double-buffering for nested MCAs */
DECL|macro|IA64_MAX_LOG_TYPES
mdefine_line|#define IA64_MAX_LOG_TYPES&t;3&t;/* MCA, CMC, INIT */
DECL|macro|IA64_MAX_LOG_SUBTYPES
mdefine_line|#define IA64_MAX_LOG_SUBTYPES&t;2&t;/* Processor, Platform */
DECL|struct|ia64_state_log_s
r_typedef
r_struct
id|ia64_state_log_s
(brace
DECL|member|isl_lock
id|spinlock_t
id|isl_lock
suffix:semicolon
DECL|member|isl_index
r_int
id|isl_index
suffix:semicolon
DECL|member|isl_log
id|ia64_psilog_t
id|isl_log
(braket
id|IA64_MAX_LOGS
)braket
suffix:semicolon
multiline_comment|/* need space to store header + error log */
DECL|typedef|ia64_state_log_t
)brace
id|ia64_state_log_t
suffix:semicolon
DECL|variable|ia64_state_log
r_static
id|ia64_state_log_t
id|ia64_state_log
(braket
id|IA64_MAX_LOG_TYPES
)braket
(braket
id|IA64_MAX_LOG_SUBTYPES
)braket
suffix:semicolon
DECL|macro|IA64_LOG_LOCK_INIT
mdefine_line|#define IA64_LOG_LOCK_INIT(it, sit)&t;spin_lock_init(&amp;ia64_state_log[it][sit].isl_lock)
DECL|macro|IA64_LOG_LOCK
mdefine_line|#define IA64_LOG_LOCK(it, sit)&t; &t;spin_lock_irqsave(&amp;ia64_state_log[it][sit].isl_lock, s)
DECL|macro|IA64_LOG_UNLOCK
mdefine_line|#define IA64_LOG_UNLOCK(it, sit) &t;spin_unlock_irqrestore(&amp;ia64_state_log[it][sit].isl_lock,&bslash;&n;&t;&t;&t;&t;&t;&t;&t;       s)
DECL|macro|IA64_LOG_NEXT_INDEX
mdefine_line|#define IA64_LOG_NEXT_INDEX(it, sit)&t;ia64_state_log[it][sit].isl_index
DECL|macro|IA64_LOG_CURR_INDEX
mdefine_line|#define IA64_LOG_CURR_INDEX(it, sit) &t;1 - ia64_state_log[it][sit].isl_index
DECL|macro|IA64_LOG_INDEX_INC
mdefine_line|#define IA64_LOG_INDEX_INC(it, sit)&t;&bslash;&n;&t;ia64_state_log[it][sit].isl_index = 1 - ia64_state_log[it][sit].isl_index
DECL|macro|IA64_LOG_INDEX_DEC
mdefine_line|#define IA64_LOG_INDEX_DEC(it, sit)&t;&bslash;&n;&t;ia64_state_log[it][sit].isl_index = 1 - ia64_state_log[it][sit].isl_index
DECL|macro|IA64_LOG_NEXT_BUFFER
mdefine_line|#define IA64_LOG_NEXT_BUFFER(it, sit) &t;(void *)(&amp;(ia64_state_log[it][sit].isl_log[IA64_LOG_NEXT_INDEX(it,sit)]))
DECL|macro|IA64_LOG_CURR_BUFFER
mdefine_line|#define IA64_LOG_CURR_BUFFER(it, sit) &t;(void *)(&amp;(ia64_state_log[it][sit].isl_log[IA64_LOG_CURR_INDEX(it,sit)]))
multiline_comment|/*&n; * C portion of the OS INIT handler&n; *&n; * Called from ia64_&lt;monarch/slave&gt;_init_handler&n; *&n; * Inputs: pointer to pt_regs where processor info was saved.&n; *&n; * Returns: &n; *   0 if SAL must warm boot the System&n; *   1 if SAL must retrun to interrupted context using PAL_MC_RESUME&n; *&n; */
r_void
DECL|function|ia64_init_handler
id|ia64_init_handler
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|sal_log_processor_info_t
op_star
id|proc_ptr
suffix:semicolon
id|ia64_psilog_t
op_star
id|plog_ptr
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Entered OS INIT handler&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Get the INIT processor log */
id|ia64_log_get
c_func
(paren
id|SAL_INFO_TYPE_INIT
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
multiline_comment|/* Get the INIT platform log */
id|ia64_log_get
c_func
(paren
id|SAL_INFO_TYPE_INIT
comma
id|SAL_SUB_INFO_TYPE_PLATFORM
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
macro_line|#ifdef IA64_DUMP_ALL_PROC_INFO 
id|ia64_log_print
c_func
(paren
id|SAL_INFO_TYPE_INIT
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
macro_line|#endif 
multiline_comment|/* &n;&t; * get pointer to min state save area&n;&t; *&n;&t; */
id|plog_ptr
op_assign
(paren
id|ia64_psilog_t
op_star
)paren
id|IA64_LOG_CURR_BUFFER
c_func
(paren
id|SAL_INFO_TYPE_INIT
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
)paren
suffix:semicolon
id|proc_ptr
op_assign
op_amp
id|plog_ptr-&gt;devlog.proclog
suffix:semicolon
id|ia64_process_min_state_save
c_func
(paren
op_amp
id|proc_ptr-&gt;slpi_min_state_area
comma
id|regs
)paren
suffix:semicolon
id|init_handler_platform
c_func
(paren
id|regs
)paren
suffix:semicolon
multiline_comment|/* call platform specific routines */
multiline_comment|/* Clear the INIT SAL logs now that they have been saved in the OS buffer */
id|ia64_sal_clear_state_info
c_func
(paren
id|SAL_INFO_TYPE_INIT
comma
id|SAL_SUB_INFO_TYPE_PROCESSOR
)paren
suffix:semicolon
id|ia64_sal_clear_state_info
c_func
(paren
id|SAL_INFO_TYPE_INIT
comma
id|SAL_SUB_INFO_TYPE_PLATFORM
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_init&n; * &t;Reset the OS ia64 log buffer&n; * Inputs &t;:&t;info_type &t;(SAL_INFO_TYPE_{MCA,INIT,CMC})&n; *&t;&t;&t;sub_info_type&t;(SAL_SUB_INFO_TYPE_{PROCESSOR,PLATFORM})&n; * Outputs&t;: &t;None&n; */
r_void
DECL|function|ia64_log_init
id|ia64_log_init
c_func
(paren
r_int
id|sal_info_type
comma
r_int
id|sal_sub_info_type
)paren
(brace
id|IA64_LOG_LOCK_INIT
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
suffix:semicolon
id|IA64_LOG_NEXT_INDEX
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|IA64_LOG_NEXT_BUFFER
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|ia64_psilog_t
)paren
op_star
id|IA64_MAX_LOGS
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * ia64_log_get&n; * &t;Get the current MCA log from SAL and copy it into the OS log buffer.&n; * Inputs &t;:&t;info_type &t;(SAL_INFO_TYPE_{MCA,INIT,CMC})&n; *&t;&t;&t;sub_info_type&t;(SAL_SUB_INFO_TYPE_{PROCESSOR,PLATFORM})&n; * Outputs&t;: &t;None&n; *&n; */
r_void
DECL|function|ia64_log_get
id|ia64_log_get
c_func
(paren
r_int
id|sal_info_type
comma
r_int
id|sal_sub_info_type
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|sal_log_header_t
op_star
id|log_buffer
suffix:semicolon
r_int
id|s
comma
id|total_len
op_assign
l_int|0
suffix:semicolon
id|IA64_LOG_LOCK
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
suffix:semicolon
multiline_comment|/* Get the process state information */
id|log_buffer
op_assign
id|IA64_LOG_NEXT_BUFFER
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|total_len
op_assign
id|ia64_sal_get_state_info
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
comma
(paren
id|u64
op_star
)paren
id|log_buffer
)paren
)paren
)paren
id|prfunc
c_func
(paren
l_string|&quot;ia64_mca_log_get : Getting processor log failed&bslash;n&quot;
)paren
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_log_get: retrieved %d bytes of error information&bslash;n&quot;
comma
id|total_len
)paren
suffix:semicolon
id|IA64_LOG_INDEX_INC
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
suffix:semicolon
id|IA64_LOG_UNLOCK
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * ia64_log_clear&n; * &t;Clear the current MCA log from SAL and dpending on the clear_os_buffer flags&n; *&t;clear the OS log buffer also&n; * Inputs &t;:&t;info_type &t;(SAL_INFO_TYPE_{MCA,INIT,CMC})&n; *&t;&t;&t;sub_info_type&t;(SAL_SUB_INFO_TYPE_{PROCESSOR,PLATFORM})&n; *&t;&t;&t;clear_os_buffer &n; *&t;&t;&t;prfunc&t;&t;(print function)&n; * Outputs&t;: &t;None&n; *&n; */
r_void
DECL|function|ia64_log_clear
id|ia64_log_clear
c_func
(paren
r_int
id|sal_info_type
comma
r_int
id|sal_sub_info_type
comma
r_int
id|clear_os_buffer
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_if
c_cond
(paren
id|ia64_sal_clear_state_info
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
)paren
id|prfunc
c_func
(paren
l_string|&quot;ia64_mca_log_get : Clearing processor log failed&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clear_os_buffer
)paren
(brace
id|sal_log_header_t
op_star
id|log_buffer
suffix:semicolon
r_int
id|s
suffix:semicolon
id|IA64_LOG_LOCK
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
suffix:semicolon
multiline_comment|/* Get the process state information */
id|log_buffer
op_assign
id|IA64_LOG_CURR_BUFFER
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
suffix:semicolon
id|memset
c_func
(paren
id|log_buffer
comma
l_int|0
comma
r_sizeof
(paren
id|ia64_psilog_t
)paren
)paren
suffix:semicolon
id|IA64_LOG_INDEX_DEC
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
suffix:semicolon
id|IA64_LOG_UNLOCK
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ia64_log_processor_regs_print&n; *&t;Print the contents of the saved processor register(s) in the format&n; *&t;&t;&lt;reg_prefix&gt;[&lt;index&gt;] &lt;value&gt;&n; *&t;&t;&n; * Inputs&t;:&t;regs &t;&t;(Register save buffer)&n; *&t;&t;&t;reg_num &t;(# of registers)&n; *&t;&t;&t;reg_class&t;(application/banked/control/bank1_general)&n; *&t;&t;&t;reg_prefix&t;(ar/br/cr/b1_gr)&n; * Outputs&t;: &t;None&n; *&n; */
r_void
DECL|function|ia64_log_processor_regs_print
id|ia64_log_processor_regs_print
c_func
(paren
id|u64
op_star
id|regs
comma
r_int
id|reg_num
comma
r_char
op_star
id|reg_class
comma
r_char
op_star
id|reg_prefix
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_int
id|i
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+%s Registers&bslash;n&quot;
comma
id|reg_class
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|reg_num
suffix:semicolon
id|i
op_increment
)paren
id|prfunc
c_func
(paren
l_string|&quot;+ %s[%d] 0x%lx&bslash;n&quot;
comma
id|reg_prefix
comma
id|i
comma
id|regs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
DECL|variable|pal_mesi_state
r_static
r_char
op_star
id|pal_mesi_state
(braket
)braket
op_assign
(brace
l_string|&quot;Invalid&quot;
comma
l_string|&quot;Shared&quot;
comma
l_string|&quot;Exclusive&quot;
comma
l_string|&quot;Modified&quot;
comma
l_string|&quot;Reserved1&quot;
comma
l_string|&quot;Reserved2&quot;
comma
l_string|&quot;Reserved3&quot;
comma
l_string|&quot;Reserved4&quot;
)brace
suffix:semicolon
DECL|variable|pal_cache_op
r_static
r_char
op_star
id|pal_cache_op
(braket
)braket
op_assign
(brace
l_string|&quot;Unknown&quot;
comma
l_string|&quot;Move in&quot;
comma
l_string|&quot;Cast out&quot;
comma
l_string|&quot;Coherency check&quot;
comma
l_string|&quot;Internal&quot;
comma
l_string|&quot;Instruction fetch&quot;
comma
l_string|&quot;Implicit Writeback&quot;
comma
l_string|&quot;Reserved&quot;
)brace
suffix:semicolon
multiline_comment|/*&n; * ia64_log_cache_check_info_print&n; *&t;Display the machine check information related to cache error(s).&n; * Inputs&t;:&t;i&t;&t;(Multiple errors are logged, i - index of logged error)&n; *&t;&t;&t;info&t;&t;(Machine check info logged by the PAL and later &n; *&t;&t;&t;&t;&t; captured by the SAL)&n; *&t;&t;&t;target_addr&t;(Address which caused the cache error)&n; * Outputs&t;: &t;None&n; */
r_void
DECL|function|ia64_log_cache_check_info_print
id|ia64_log_cache_check_info_print
c_func
(paren
r_int
id|i
comma
id|pal_cache_check_info_t
id|info
comma
id|u64
id|target_addr
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;+ Cache check info[%d]&bslash;n+&quot;
comma
id|i
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;  Level: L%d&quot;
comma
id|info.level
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.mv
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Mesi: %s&quot;
comma
id|pal_mesi_state
(braket
id|info.mesi
)braket
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Index: %d,&quot;
comma
id|info.index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.ic
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Cache: Instruction&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.dc
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Cache: Data&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.tl
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Line: Tag&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.dl
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Line: Data&quot;
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Operation: %s,&quot;
comma
id|pal_cache_op
(braket
id|info.op
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.wv
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Way: %d,&quot;
comma
id|info.way
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.tv
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Target Addr: 0x%lx&quot;
comma
id|target_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.mc
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,MC: Corrected&quot;
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_tlb_check_info_print&n; *&t;Display the machine check information related to tlb error(s).&n; * Inputs&t;:&t;i&t;&t;(Multiple errors are logged, i - index of logged error)&n; *&t;&t;&t;info&t;&t;(Machine check info logged by the PAL and later &n; *&t;&t;&t;&t;&t; captured by the SAL)&n; * Outputs&t;: &t;None&n; */
r_void
DECL|function|ia64_log_tlb_check_info_print
id|ia64_log_tlb_check_info_print
c_func
(paren
r_int
id|i
comma
id|pal_tlb_check_info_t
id|info
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;+ TLB Check Info [%d]&bslash;n+&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.itc
)paren
id|prfunc
c_func
(paren
l_string|&quot;  Failure: Instruction Translation Cache&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.dtc
)paren
id|prfunc
c_func
(paren
l_string|&quot;  Failure: Data Translation Cache&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.itr
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;  Failure: Instruction Translation Register&quot;
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Slot: %d&quot;
comma
id|info.tr_slot
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info.dtr
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;  Failure: Data Translation Register&quot;
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Slot: %d&quot;
comma
id|info.tr_slot
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info.mc
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,MC: Corrected&quot;
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_bus_check_info_print&n; *&t;Display the machine check information related to bus error(s).&n; * Inputs&t;:&t;i&t;&t;(Multiple errors are logged, i - index of logged error)&n; *&t;&t;&t;info&t;&t;(Machine check info logged by the PAL and later &n; *&t;&t;&t;&t;&t; captured by the SAL)&n; *&t;&t;&t;req_addr&t;(Address of the requestor of the transaction)&n; *&t;&t;&t;resp_addr&t;(Address of the responder of the transaction)&n; *&t;&t;&t;target_addr&t;(Address where the data was to be delivered to  or&n; *&t;&t;&t;&t;&t; obtained from)&n; * Outputs&t;: &t;None&n; */
r_void
DECL|function|ia64_log_bus_check_info_print
id|ia64_log_bus_check_info_print
c_func
(paren
r_int
id|i
comma
id|pal_bus_check_info_t
id|info
comma
id|u64
id|req_addr
comma
id|u64
id|resp_addr
comma
id|u64
id|targ_addr
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;+ BUS Check Info [%d]&bslash;n+&quot;
comma
id|i
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; Status Info: %d&quot;
comma
id|info.bsi
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Severity: %d&quot;
comma
id|info.sev
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Transaction Type: %d&quot;
comma
id|info.type
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Transaction Size: %d&quot;
comma
id|info.size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.cc
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Cache-cache-transfer&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.ib
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Error: Internal&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.eb
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Error: External&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.mc
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,MC: Corrected&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.tv
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Target Address: 0x%lx&quot;
comma
id|targ_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.rq
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Requestor Address: 0x%lx&quot;
comma
id|req_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.tv
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Responder Address: 0x%lx&quot;
comma
id|resp_addr
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_processor_info_print&n; *&t;Display the processor-specific information logged by PAL as a part&n; *&t;of MCA or INIT or CMC.&n; * Inputs &t;:&t;lh&t;(Pointer of the sal log header which specifies the format&n; *&t;&t;&t;&t; of SAL state info as specified by the SAL spec).&n; * Outputs&t;: &t;None&n; */
r_void
DECL|function|ia64_log_processor_info_print
id|ia64_log_processor_info_print
c_func
(paren
id|sal_log_header_t
op_star
id|lh
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|sal_log_processor_info_t
op_star
id|slpi
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lh
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|lh-&gt;slh_log_type
op_ne
id|SAL_SUB_INFO_TYPE_PROCESSOR
)paren
r_return
suffix:semicolon
id|slpi
op_assign
(paren
id|sal_log_processor_info_t
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|lh
op_plus
r_sizeof
(paren
id|sal_log_header_t
)paren
)paren
suffix:semicolon
multiline_comment|/* point to proc info */
r_if
c_cond
(paren
op_logical_neg
id|slpi
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;No Processor Error Log found&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Print branch register contents if valid */
r_if
c_cond
(paren
id|slpi-&gt;slpi_valid.slpi_br
)paren
id|ia64_log_processor_regs_print
c_func
(paren
id|slpi-&gt;slpi_br
comma
l_int|8
comma
l_string|&quot;Branch&quot;
comma
l_string|&quot;br&quot;
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print control register contents if valid */
r_if
c_cond
(paren
id|slpi-&gt;slpi_valid.slpi_cr
)paren
id|ia64_log_processor_regs_print
c_func
(paren
id|slpi-&gt;slpi_cr
comma
l_int|128
comma
l_string|&quot;Control&quot;
comma
l_string|&quot;cr&quot;
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print application register contents if valid */
r_if
c_cond
(paren
id|slpi-&gt;slpi_valid.slpi_ar
)paren
id|ia64_log_processor_regs_print
c_func
(paren
id|slpi-&gt;slpi_br
comma
l_int|128
comma
l_string|&quot;Application&quot;
comma
l_string|&quot;ar&quot;
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print region register contents if valid */
r_if
c_cond
(paren
id|slpi-&gt;slpi_valid.slpi_rr
)paren
id|ia64_log_processor_regs_print
c_func
(paren
id|slpi-&gt;slpi_rr
comma
l_int|8
comma
l_string|&quot;Region&quot;
comma
l_string|&quot;rr&quot;
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print floating-point register contents if valid */
r_if
c_cond
(paren
id|slpi-&gt;slpi_valid.slpi_fr
)paren
id|ia64_log_processor_regs_print
c_func
(paren
id|slpi-&gt;slpi_fr
comma
l_int|128
comma
l_string|&quot;Floating-point&quot;
comma
l_string|&quot;fr&quot;
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print the cache check information if any*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_CACHE_ERRORS
suffix:semicolon
id|i
op_increment
)paren
id|ia64_log_cache_check_info_print
c_func
(paren
id|i
comma
id|slpi-&gt;slpi_cache_check_info
(braket
id|i
)braket
dot
id|slpi_cache_check
comma
id|slpi-&gt;slpi_cache_check_info
(braket
id|i
)braket
dot
id|slpi_target_address
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print the tlb check information if any*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_TLB_ERRORS
suffix:semicolon
id|i
op_increment
)paren
id|ia64_log_tlb_check_info_print
c_func
(paren
id|i
comma
id|slpi-&gt;slpi_tlb_check_info
(braket
id|i
)braket
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print the bus check information if any*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_BUS_ERRORS
suffix:semicolon
id|i
op_increment
)paren
id|ia64_log_bus_check_info_print
c_func
(paren
id|i
comma
id|slpi-&gt;slpi_bus_check_info
(braket
id|i
)braket
dot
id|slpi_bus_check
comma
id|slpi-&gt;slpi_bus_check_info
(braket
id|i
)braket
dot
id|slpi_requestor_addr
comma
id|slpi-&gt;slpi_bus_check_info
(braket
id|i
)braket
dot
id|slpi_responder_addr
comma
id|slpi-&gt;slpi_bus_check_info
(braket
id|i
)braket
dot
id|slpi_target_addr
comma
id|prfunc
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_print&n; * &t;Display the contents of the OS error log information&n; * Inputs &t;:&t;info_type &t;(SAL_INFO_TYPE_{MCA,INIT,CMC})&n; *&t;&t;&t;sub_info_type&t;(SAL_SUB_INFO_TYPE_{PROCESSOR,PLATFORM})&n; * Outputs&t;: &t;None&n; */
r_void
DECL|function|ia64_log_print
id|ia64_log_print
c_func
(paren
r_int
id|sal_info_type
comma
r_int
id|sal_sub_info_type
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_char
op_star
id|info_type
comma
op_star
id|sub_info_type
suffix:semicolon
r_switch
c_cond
(paren
id|sal_info_type
)paren
(brace
r_case
id|SAL_INFO_TYPE_MCA
suffix:colon
id|info_type
op_assign
l_string|&quot;MCA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAL_INFO_TYPE_INIT
suffix:colon
id|info_type
op_assign
l_string|&quot;INIT&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAL_INFO_TYPE_CMC
suffix:colon
id|info_type
op_assign
l_string|&quot;CMC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|info_type
op_assign
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|sal_sub_info_type
)paren
(brace
r_case
id|SAL_SUB_INFO_TYPE_PROCESSOR
suffix:colon
id|sub_info_type
op_assign
l_string|&quot;PROCESSOR&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAL_SUB_INFO_TYPE_PLATFORM
suffix:colon
id|sub_info_type
op_assign
l_string|&quot;PLATFORM&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sub_info_type
op_assign
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|prfunc
c_func
(paren
l_string|&quot;+BEGIN HARDWARE ERROR STATE [%s %s]&bslash;n&quot;
comma
id|info_type
comma
id|sub_info_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sal_sub_info_type
op_eq
id|SAL_SUB_INFO_TYPE_PROCESSOR
)paren
id|ia64_log_processor_info_print
c_func
(paren
id|IA64_LOG_CURR_BUFFER
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
comma
id|prfunc
)paren
suffix:semicolon
r_else
id|log_print_platform
c_func
(paren
id|IA64_LOG_CURR_BUFFER
c_func
(paren
id|sal_info_type
comma
id|sal_sub_info_type
)paren
comma
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+END HARDWARE ERROR STATE [%s %s]&bslash;n&quot;
comma
id|info_type
comma
id|sub_info_type
)paren
suffix:semicolon
)brace
eof
