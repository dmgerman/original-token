multiline_comment|/*&n; * vreset.c&n; *&n; * Initialize the VGA control registers to 80x25 text mode.&n; *&n; * Adapted from a program by:&n; *                                      Steve Sellgren&n; *                                      San Francisco Indigo Company&n; *                                      sfindigo!sellgren@uunet.uu.net&n; *&n; * Original concept by:&n; *                                      Gary Thomas &lt;gdt@linuxppc.org&gt;&n; * Adapted for Moto boxes by:&n; *                                      Pat Kane &amp; Mark Scott, 1996&n; * Adapted for IBM portables by:&n; *                                      Takeshi Ishimoto&n; * Multi-console support:&n; *                                      Terje Malmedal &lt;terje.malmedal@usit.uio.no&gt;&n; */
macro_line|#include &quot;iso_font.h&quot;
macro_line|#include &lt;linux/delay.h&gt;
r_extern
r_char
op_star
id|vidmem
suffix:semicolon
r_extern
r_int
id|lines
comma
id|cols
suffix:semicolon
multiline_comment|/* estimate for delay */
DECL|variable|loops_per_sec
r_int
r_int
id|loops_per_sec
op_assign
l_int|50000000
suffix:semicolon
suffix:semicolon
multiline_comment|/*&n; * VGA Register  &n; */
DECL|struct|VgaRegs
r_struct
id|VgaRegs
(brace
DECL|member|io_port
r_int
r_int
id|io_port
suffix:semicolon
DECL|member|io_index
r_int
r_char
id|io_index
suffix:semicolon
DECL|member|io_value
r_int
r_char
id|io_value
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Default console text mode registers  used to reset&n; * graphics adapter.&n; */
DECL|macro|NREGS
mdefine_line|#define NREGS 54
DECL|macro|ENDMK
mdefine_line|#define ENDMK  0xFFFF  /* End marker */
DECL|macro|S3Vendor
mdefine_line|#define S3Vendor        0x5333
DECL|macro|CirrusVendor
mdefine_line|#define CirrusVendor    0x1013
DECL|macro|DiamondVendor
mdefine_line|#define DiamondVendor   0x100E
DECL|macro|MatroxVendor
mdefine_line|#define MatroxVendor    0x102B
DECL|macro|ParadiseVendor
mdefine_line|#define ParadiseVendor  0x101C
DECL|variable|GenVgaTextRegs
r_struct
id|VgaRegs
id|GenVgaTextRegs
(braket
id|NREGS
op_plus
l_int|1
)braket
op_assign
(brace
multiline_comment|/*      port    index   value  */
multiline_comment|/* SR Regs */
l_int|0x3c4
comma
l_int|0x1
comma
l_int|0x0
comma
l_int|0x3c4
comma
l_int|0x2
comma
l_int|0x3
comma
l_int|0x3c4
comma
l_int|0x3
comma
l_int|0x0
comma
l_int|0x3c4
comma
l_int|0x4
comma
l_int|0x2
comma
multiline_comment|/* CR Regs */
l_int|0x3d4
comma
l_int|0x0
comma
l_int|0x5f
comma
l_int|0x3d4
comma
l_int|0x1
comma
l_int|0x4f
comma
l_int|0x3d4
comma
l_int|0x2
comma
l_int|0x50
comma
l_int|0x3d4
comma
l_int|0x3
comma
l_int|0x82
comma
l_int|0x3d4
comma
l_int|0x4
comma
l_int|0x55
comma
l_int|0x3d4
comma
l_int|0x5
comma
l_int|0x81
comma
l_int|0x3d4
comma
l_int|0x6
comma
l_int|0xbf
comma
l_int|0x3d4
comma
l_int|0x7
comma
l_int|0x1f
comma
l_int|0x3d4
comma
l_int|0x8
comma
l_int|0x00
comma
l_int|0x3d4
comma
l_int|0x9
comma
l_int|0x4f
comma
l_int|0x3d4
comma
l_int|0xa
comma
l_int|0x0d
comma
l_int|0x3d4
comma
l_int|0xb
comma
l_int|0x0e
comma
l_int|0x3d4
comma
l_int|0xc
comma
l_int|0x00
comma
l_int|0x3d4
comma
l_int|0xd
comma
l_int|0x00
comma
l_int|0x3d4
comma
l_int|0xe
comma
l_int|0x00
comma
l_int|0x3d4
comma
l_int|0xf
comma
l_int|0x00
comma
l_int|0x3d4
comma
l_int|0x10
comma
l_int|0x9c
comma
l_int|0x3d4
comma
l_int|0x11
comma
l_int|0x8e
comma
l_int|0x3d4
comma
l_int|0x12
comma
l_int|0x8f
comma
l_int|0x3d4
comma
l_int|0x13
comma
l_int|0x28
comma
l_int|0x3d4
comma
l_int|0x14
comma
l_int|0x1f
comma
l_int|0x3d4
comma
l_int|0x15
comma
l_int|0x96
comma
l_int|0x3d4
comma
l_int|0x16
comma
l_int|0xb9
comma
l_int|0x3d4
comma
l_int|0x17
comma
l_int|0xa3
comma
multiline_comment|/* GR Regs */
l_int|0x3ce
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x1
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x2
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x3
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x4
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x5
comma
l_int|0x10
comma
l_int|0x3ce
comma
l_int|0x6
comma
l_int|0xe
comma
l_int|0x3ce
comma
l_int|0x7
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x8
comma
l_int|0xff
comma
id|ENDMK
)brace
suffix:semicolon
DECL|variable|S3TextRegs
r_struct
id|VgaRegs
id|S3TextRegs
(braket
id|NREGS
op_plus
l_int|1
)braket
op_assign
(brace
multiline_comment|/*&t;port&t;index&t;value  */
multiline_comment|/* SR Regs */
l_int|0x3c4
comma
l_int|0x1
comma
l_int|0x0
comma
l_int|0x3c4
comma
l_int|0x2
comma
l_int|0x3
comma
l_int|0x3c4
comma
l_int|0x3
comma
l_int|0x0
comma
l_int|0x3c4
comma
l_int|0x4
comma
l_int|0x2
comma
multiline_comment|/* CR Regs */
l_int|0x3d4
comma
l_int|0x0
comma
l_int|0x5f
comma
l_int|0x3d4
comma
l_int|0x1
comma
l_int|0x4f
comma
l_int|0x3d4
comma
l_int|0x2
comma
l_int|0x50
comma
l_int|0x3d4
comma
l_int|0x3
comma
l_int|0x82
comma
l_int|0x3d4
comma
l_int|0x4
comma
l_int|0x55
comma
l_int|0x3d4
comma
l_int|0x5
comma
l_int|0x81
comma
l_int|0x3d4
comma
l_int|0x6
comma
l_int|0xbf
comma
l_int|0x3d4
comma
l_int|0x7
comma
l_int|0x1f
comma
l_int|0x3d4
comma
l_int|0x8
comma
l_int|0x00
comma
l_int|0x3d4
comma
l_int|0x9
comma
l_int|0x4f
comma
l_int|0x3d4
comma
l_int|0xa
comma
l_int|0x0d
comma
l_int|0x3d4
comma
l_int|0xb
comma
l_int|0x0e
comma
l_int|0x3d4
comma
l_int|0xc
comma
l_int|0x00
comma
l_int|0x3d4
comma
l_int|0xd
comma
l_int|0x00
comma
l_int|0x3d4
comma
l_int|0xe
comma
l_int|0x00
comma
l_int|0x3d4
comma
l_int|0xf
comma
l_int|0x00
comma
l_int|0x3d4
comma
l_int|0x10
comma
l_int|0x9c
comma
l_int|0x3d4
comma
l_int|0x11
comma
l_int|0x8e
comma
l_int|0x3d4
comma
l_int|0x12
comma
l_int|0x8f
comma
l_int|0x3d4
comma
l_int|0x13
comma
l_int|0x28
comma
l_int|0x3d4
comma
l_int|0x14
comma
l_int|0x1f
comma
l_int|0x3d4
comma
l_int|0x15
comma
l_int|0x96
comma
l_int|0x3d4
comma
l_int|0x16
comma
l_int|0xb9
comma
l_int|0x3d4
comma
l_int|0x17
comma
l_int|0xa3
comma
multiline_comment|/* GR Regs */
l_int|0x3ce
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x1
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x2
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x3
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x4
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x5
comma
l_int|0x10
comma
l_int|0x3ce
comma
l_int|0x6
comma
l_int|0xe
comma
l_int|0x3ce
comma
l_int|0x7
comma
l_int|0x0
comma
l_int|0x3ce
comma
l_int|0x8
comma
l_int|0xff
comma
id|ENDMK
)brace
suffix:semicolon
DECL|struct|RGBColors
r_struct
id|RGBColors
(brace
DECL|member|r
DECL|member|g
DECL|member|b
r_int
r_char
id|r
comma
id|g
comma
id|b
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Default console text mode color table.&n; * These values were obtained by booting Linux with&n; * text mode firmware &amp; then dumping the registers.  &n; */
DECL|variable|TextCLUT
r_struct
id|RGBColors
id|TextCLUT
(braket
l_int|256
)braket
op_assign
(brace
multiline_comment|/*&t;red&t;green&t;blue  */
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x2a
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x0
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x2a
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x3f
comma
l_int|0x39
comma
l_int|0xc
comma
l_int|0x5
comma
l_int|0x15
comma
l_int|0x2c
comma
l_int|0xf
comma
l_int|0x26
comma
l_int|0x10
comma
l_int|0x3d
comma
l_int|0x29
comma
l_int|0x29
comma
l_int|0x38
comma
l_int|0x4
comma
l_int|0x1a
comma
l_int|0xe
comma
l_int|0x2
comma
l_int|0x1e
comma
l_int|0x3a
comma
l_int|0x3c
comma
l_int|0x25
comma
l_int|0x33
comma
l_int|0x3c
comma
l_int|0xc
comma
l_int|0x2c
comma
l_int|0x3f
comma
l_int|0x3
comma
l_int|0x2b
comma
l_int|0x1c
comma
l_int|0x9
comma
l_int|0x13
comma
l_int|0x25
comma
l_int|0x2a
comma
l_int|0x35
comma
l_int|0x1e
comma
l_int|0xa
comma
l_int|0x38
comma
l_int|0x24
comma
l_int|0x8
comma
l_int|0x3
comma
l_int|0x3
comma
l_int|0xe
comma
l_int|0x36
comma
l_int|0xc
comma
l_int|0x6
comma
l_int|0x2a
comma
l_int|0x26
comma
l_int|0x3
comma
l_int|0x32
comma
l_int|0x5
comma
l_int|0x2f
comma
l_int|0x33
comma
l_int|0x3c
comma
l_int|0x35
comma
l_int|0x2f
comma
l_int|0x2d
comma
l_int|0x26
comma
l_int|0x3e
comma
l_int|0xd
comma
l_int|0xa
comma
l_int|0x10
comma
l_int|0x25
comma
l_int|0x3c
comma
l_int|0x11
comma
l_int|0xd
comma
l_int|0x4
comma
l_int|0x2e
comma
l_int|0x5
comma
l_int|0x19
comma
l_int|0x3e
comma
l_int|0xc
comma
l_int|0x13
comma
l_int|0x34
comma
l_int|0x2b
comma
l_int|0x6
comma
l_int|0x24
comma
l_int|0x4
comma
l_int|0x3
comma
l_int|0xd
comma
l_int|0x2f
comma
l_int|0x3c
comma
l_int|0xc
comma
l_int|0x2a
comma
l_int|0x37
comma
l_int|0x1f
comma
l_int|0xf
comma
l_int|0x12
comma
l_int|0x38
comma
l_int|0x38
comma
l_int|0xe
comma
l_int|0x2a
comma
l_int|0x12
comma
l_int|0x2f
comma
l_int|0x19
comma
l_int|0x29
comma
l_int|0x2e
comma
l_int|0x31
comma
l_int|0x25
comma
l_int|0x13
comma
l_int|0x3e
comma
l_int|0x33
comma
l_int|0x3e
comma
l_int|0x33
comma
l_int|0x1d
comma
l_int|0x2c
comma
l_int|0x25
comma
l_int|0x15
comma
l_int|0x15
comma
l_int|0x5
comma
l_int|0x32
comma
l_int|0x25
comma
l_int|0x39
comma
l_int|0x1a
comma
l_int|0x7
comma
l_int|0x1f
comma
l_int|0x13
comma
l_int|0xe
comma
l_int|0x1d
comma
l_int|0x36
comma
l_int|0x17
comma
l_int|0x34
comma
l_int|0xf
comma
l_int|0x15
comma
l_int|0x23
comma
l_int|0x2
comma
l_int|0x35
comma
l_int|0xd
comma
l_int|0x15
comma
l_int|0x3f
comma
l_int|0xc
comma
l_int|0x14
comma
l_int|0x2f
comma
l_int|0xf
comma
l_int|0x19
comma
l_int|0x21
comma
l_int|0x3e
comma
l_int|0x27
comma
l_int|0x11
comma
l_int|0x2f
comma
l_int|0x38
comma
l_int|0x3f
comma
l_int|0x3c
comma
l_int|0x36
comma
l_int|0x2d
comma
l_int|0x15
comma
l_int|0x16
comma
l_int|0x17
comma
l_int|0x2
comma
l_int|0x1
comma
l_int|0xa
comma
l_int|0x3d
comma
l_int|0x1b
comma
l_int|0x11
comma
l_int|0x3f
comma
l_int|0x21
comma
l_int|0x3c
comma
l_int|0xd
comma
l_int|0x1a
comma
l_int|0x39
comma
l_int|0x3d
comma
l_int|0x8
comma
l_int|0xe
comma
l_int|0xe
comma
l_int|0x22
comma
l_int|0x21
comma
l_int|0x23
comma
l_int|0x1e
comma
l_int|0x30
comma
l_int|0x5
comma
l_int|0x1f
comma
l_int|0x22
comma
l_int|0x3d
comma
l_int|0x1e
comma
l_int|0x2f
comma
l_int|0xa
comma
l_int|0x0
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x0
comma
l_int|0x1c
comma
l_int|0x15
comma
l_int|0x0
comma
l_int|0x1c
comma
l_int|0x1c
comma
l_int|0x0
comma
l_int|0x15
comma
l_int|0x1c
comma
l_int|0x0
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x0
comma
l_int|0x7
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x11
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x15
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x18
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x18
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x15
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x11
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x11
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x15
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x18
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x18
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x15
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x11
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x11
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x15
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x18
comma
l_int|0xe
comma
l_int|0x1c
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x18
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x15
comma
l_int|0x1c
comma
l_int|0xe
comma
l_int|0x11
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x16
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x18
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x1a
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x1a
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x18
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x16
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x16
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x18
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x1a
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x1a
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x18
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x16
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x16
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x18
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x1a
comma
l_int|0x14
comma
l_int|0x1c
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x1a
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x18
comma
l_int|0x1c
comma
l_int|0x14
comma
l_int|0x16
comma
l_int|0x1c
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x4
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0xc
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0xc
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x4
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x4
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0xc
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0xc
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x4
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x4
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0xc
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0xc
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x4
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0xa
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0xc
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0xe
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0xe
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0xc
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0xa
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0xa
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0xc
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0xe
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0xe
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0xc
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0xa
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0xa
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0xc
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0xe
comma
l_int|0x8
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0xe
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0xc
comma
l_int|0x10
comma
l_int|0x8
comma
l_int|0xa
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0xc
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0xd
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0xf
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xf
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xd
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xc
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0xc
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0xd
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0xf
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xf
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xd
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xc
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0xc
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0xd
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0xf
comma
l_int|0xb
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xf
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xd
comma
l_int|0x10
comma
l_int|0xb
comma
l_int|0xc
comma
l_int|0x10
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
)brace
suffix:semicolon
DECL|variable|AC
r_int
r_char
id|AC
(braket
l_int|21
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x14
comma
l_int|0x07
comma
l_int|0x38
comma
l_int|0x39
comma
l_int|0x3A
comma
l_int|0x3B
comma
l_int|0x3C
comma
l_int|0x3D
comma
l_int|0x3E
comma
l_int|0x3F
comma
l_int|0x0C
comma
l_int|0x00
comma
l_int|0x0F
comma
l_int|0x08
comma
l_int|0x00
)brace
suffix:semicolon
r_static
r_int
id|scanPCI
c_func
(paren
r_int
id|start_slt
)paren
suffix:semicolon
r_static
r_int
id|PCIVendor
c_func
(paren
r_int
)paren
suffix:semicolon
r_static
r_void
id|printslots
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|puthex
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|puts
c_func
(paren
r_const
r_char
op_star
)paren
suffix:semicolon
r_static
r_void
id|unlockS3
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_inline
DECL|function|outw
id|outw
c_func
(paren
r_int
id|port
comma
r_int
r_int
id|val
)paren
(brace
id|outb
c_func
(paren
id|port
comma
id|val
op_rshift
l_int|8
)paren
suffix:semicolon
id|outb
c_func
(paren
id|port
op_plus
l_int|1
comma
id|val
)paren
suffix:semicolon
)brace
DECL|macro|PPC_601
mdefine_line|#define PPC_601 1
DECL|function|vga_init
id|vga_init
c_func
(paren
r_int
r_char
op_star
id|ISA_mem
)paren
(brace
r_int
id|slot
suffix:semicolon
r_struct
id|VgaRegs
op_star
id|VgaTextRegs
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
(paren
id|_get_PVR
c_func
(paren
)paren
op_rshift
l_int|16
)paren
op_eq
id|PPC_601
)paren
(brace
r_return
id|old_vga_init
c_func
(paren
id|ISA_mem
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* See if VGA already in TEXT mode - exit if so! */
id|outb
c_func
(paren
l_int|0x3CE
comma
l_int|0x06
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
l_int|0x3CF
)paren
op_amp
l_int|0x01
)paren
op_eq
l_int|0
)paren
(brace
id|puts
c_func
(paren
l_string|&quot;VGA already in text mode&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* If no VGA responding in text mode, then we have some work to do...&n;&t; */
id|slot
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
(paren
id|slot
op_assign
id|scanPCI
c_func
(paren
id|slot
)paren
)paren
OG
op_minus
l_int|1
)paren
(brace
multiline_comment|/* find video card in use  */
id|unlockVideo
c_func
(paren
id|slot
)paren
suffix:semicolon
multiline_comment|/* enable I/O to card      */
id|VgaTextRegs
op_assign
id|GenVgaTextRegs
suffix:semicolon
r_switch
c_cond
(paren
id|PCIVendor
c_func
(paren
id|slot
)paren
)paren
(brace
r_default
suffix:colon
r_break
suffix:semicolon
r_case
(paren
id|S3Vendor
)paren
suffix:colon
id|unlockS3
c_func
(paren
)paren
suffix:semicolon
id|VgaTextRegs
op_assign
id|S3TextRegs
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|CirrusVendor
)paren
suffix:colon
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0612
)paren
suffix:semicolon
multiline_comment|/* unlock ext regs */
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0700
)paren
suffix:semicolon
multiline_comment|/* reset ext sequence mode */
r_break
suffix:semicolon
r_case
(paren
id|ParadiseVendor
)paren
suffix:colon
multiline_comment|/* IBM Portable 850 */
id|outw
c_func
(paren
l_int|0x3ce
comma
l_int|0x0f05
)paren
suffix:semicolon
multiline_comment|/* unlock pardise registers */
id|outw
c_func
(paren
l_int|0x3c4
comma
l_int|0x0648
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x2985
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x34a6
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3ce
comma
l_int|0x0b
)paren
suffix:semicolon
multiline_comment|/* disable linear addressing */
id|outb
c_func
(paren
l_int|0x3cf
comma
id|inb
c_func
(paren
l_int|0x3cf
)paren
op_amp
op_complement
l_int|0x30
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3c4
comma
l_int|0x1400
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3ce
comma
l_int|0x0e
)paren
suffix:semicolon
multiline_comment|/* disable 256 color mode */
id|outb
c_func
(paren
l_int|0x3cf
comma
id|inb
c_func
(paren
l_int|0x3cf
)paren
op_amp
op_complement
l_int|0x01
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xd00
comma
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* enable auto-centering */
r_if
c_cond
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
l_int|0xd01
)paren
op_amp
l_int|0x03
)paren
)paren
(brace
id|outb
c_func
(paren
l_int|0x3d4
comma
l_int|0x33
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3d5
comma
id|inb
c_func
(paren
l_int|0x3d5
)paren
op_amp
op_complement
l_int|0x90
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3d4
comma
l_int|0x32
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3d5
comma
id|inb
c_func
(paren
l_int|0x3d5
)paren
op_or
l_int|0x04
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x0250
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x07ba
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x0900
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x15e7
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x2a95
)paren
suffix:semicolon
)brace
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x34a0
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0 /* Untested - probably doesn&squot;t work */
r_case
(paren
id|MatroxVendor
)paren
suffix:colon
r_case
(paren
id|DiamondVendor
)paren
suffix:colon
id|puts
c_func
(paren
l_string|&quot;VGA Chip Vendor ID: &quot;
)paren
suffix:semicolon
id|puthex
c_func
(paren
id|PCIVendor
c_func
(paren
id|slot
)paren
)paren
suffix:semicolon
id|puts
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0120
)paren
suffix:semicolon
multiline_comment|/* disable video              */
id|setTextRegs
c_func
(paren
id|VgaTextRegs
)paren
suffix:semicolon
multiline_comment|/* initial register setup     */
id|setTextCLUT
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* load color lookup table    */
id|loadFont
c_func
(paren
id|ISA_mem
)paren
suffix:semicolon
multiline_comment|/* load font                  */
id|setTextRegs
c_func
(paren
id|VgaTextRegs
)paren
suffix:semicolon
multiline_comment|/* reload registers           */
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0100
)paren
suffix:semicolon
multiline_comment|/* re-enable video            */
id|clearVideoMemory
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PCIVendor
c_func
(paren
id|slot
)paren
op_eq
id|S3Vendor
)paren
(brace
id|outb
c_func
(paren
l_int|0x3c2
comma
l_int|0x63
)paren
suffix:semicolon
multiline_comment|/* MISC */
)brace
multiline_comment|/* endif */
macro_line|#ifdef DEBUG
id|printslots
c_func
(paren
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
macro_line|#endif
id|mdelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* give time for the video monitor to come up */
)brace
r_return
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* &squot;CRT&squot; I/O supported */
)brace
multiline_comment|/*&n; * Write to VGA Attribute registers.  &n; */
DECL|function|writeAttr
id|writeAttr
c_func
(paren
id|index
comma
id|data
comma
id|videoOn
)paren
r_int
r_char
id|index
suffix:semicolon
r_int
r_char
id|data
suffix:semicolon
r_int
r_char
id|videoOn
suffix:semicolon
multiline_comment|/* video on flag */
(brace
r_int
r_char
id|v
suffix:semicolon
id|v
op_assign
id|inb
c_func
(paren
l_int|0x3da
)paren
suffix:semicolon
multiline_comment|/* reset attr. address toggle */
r_if
c_cond
(paren
id|videoOn
)paren
id|outb
c_func
(paren
l_int|0x3c0
comma
(paren
id|index
op_amp
l_int|0x1F
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
r_else
id|outb
c_func
(paren
l_int|0x3c0
comma
(paren
id|index
op_amp
l_int|0x1F
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3c0
comma
id|data
)paren
suffix:semicolon
)brace
DECL|function|setTextRegs
id|setTextRegs
c_func
(paren
r_struct
id|VgaRegs
op_star
id|svp
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; *  saved settings&n;&t; */
r_while
c_loop
(paren
id|svp-&gt;io_port
op_ne
id|ENDMK
)paren
(brace
id|outb
c_func
(paren
id|svp-&gt;io_port
comma
id|svp-&gt;io_index
)paren
suffix:semicolon
id|outb
c_func
(paren
id|svp-&gt;io_port
op_plus
l_int|1
comma
id|svp-&gt;io_value
)paren
suffix:semicolon
id|svp
op_increment
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0x3c2
comma
l_int|0x67
)paren
suffix:semicolon
multiline_comment|/* MISC */
id|outb
c_func
(paren
l_int|0x3c6
comma
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* MASK */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
id|i
op_increment
)paren
id|writeAttr
c_func
(paren
id|i
comma
id|AC
(braket
id|i
)braket
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* pallete */
id|writeAttr
c_func
(paren
l_int|0x10
comma
l_int|0x0c
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* text mode */
id|writeAttr
c_func
(paren
l_int|0x11
comma
l_int|0x00
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* overscan color (border) */
id|writeAttr
c_func
(paren
l_int|0x12
comma
l_int|0x0f
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* plane enable */
id|writeAttr
c_func
(paren
l_int|0x13
comma
l_int|0x08
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* pixel panning */
id|writeAttr
c_func
(paren
l_int|0x14
comma
l_int|0x00
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* color select; video on  */
)brace
DECL|function|setTextCLUT
id|setTextCLUT
c_func
(paren
r_int
id|shift
)paren
(brace
r_int
id|i
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C6
comma
l_int|0xFF
)paren
suffix:semicolon
id|i
op_assign
id|inb
c_func
(paren
l_int|0x3C7
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C8
comma
l_int|0
)paren
suffix:semicolon
id|i
op_assign
id|inb
c_func
(paren
l_int|0x3C7
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
l_int|0x3C9
comma
id|TextCLUT
(braket
id|i
)braket
dot
id|r
op_lshift
id|shift
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C9
comma
id|TextCLUT
(braket
id|i
)braket
dot
id|g
op_lshift
id|shift
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C9
comma
id|TextCLUT
(braket
id|i
)braket
dot
id|b
op_lshift
id|shift
)paren
suffix:semicolon
)brace
)brace
DECL|function|loadFont
id|loadFont
c_func
(paren
r_int
r_char
op_star
id|ISA_mem
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_char
op_star
id|font_page
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|ISA_mem
(braket
l_int|0xA0000
)braket
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C2
comma
l_int|0x67
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Load font &n;&t; */
id|i
op_assign
id|inb
c_func
(paren
l_int|0x3DA
)paren
suffix:semicolon
multiline_comment|/* Reset Attr toggle */
id|outb
c_func
(paren
l_int|0x3C0
comma
l_int|0x30
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C0
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* graphics mode */
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0001
)paren
suffix:semicolon
multiline_comment|/* reset sequencer */
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0204
)paren
suffix:semicolon
multiline_comment|/* write to plane 2 */
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0406
)paren
suffix:semicolon
multiline_comment|/* enable plane graphics */
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0003
)paren
suffix:semicolon
multiline_comment|/* reset sequencer */
id|outw
c_func
(paren
l_int|0x3CE
comma
l_int|0x0402
)paren
suffix:semicolon
multiline_comment|/* read plane 2 */
id|outw
c_func
(paren
l_int|0x3CE
comma
l_int|0x0500
)paren
suffix:semicolon
multiline_comment|/* write mode 0, read mode 0 */
id|outw
c_func
(paren
l_int|0x3CE
comma
l_int|0x0605
)paren
suffix:semicolon
multiline_comment|/* set graphics mode */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|font
)paren
suffix:semicolon
id|i
op_add_assign
l_int|16
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|__asm__
r_volatile
(paren
l_string|&quot;eieio&quot;
)paren
suffix:semicolon
id|font_page
(braket
(paren
l_int|2
op_star
id|i
)paren
op_plus
id|j
)braket
op_assign
id|font
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
)brace
)brace
)brace
r_static
r_void
DECL|function|unlockS3
id|unlockS3
c_func
(paren
r_void
)paren
(brace
r_int
id|s3_device_id
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x3848
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x39a5
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3d4
comma
l_int|0x2d
)paren
suffix:semicolon
id|s3_device_id
op_assign
id|inb
c_func
(paren
l_int|0x3d5
)paren
op_lshift
l_int|8
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3d4
comma
l_int|0x2e
)paren
suffix:semicolon
id|s3_device_id
op_or_assign
id|inb
c_func
(paren
l_int|0x3d5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s3_device_id
op_ne
l_int|0x8812
)paren
(brace
multiline_comment|/* From the S3 manual */
id|outb
c_func
(paren
l_int|0x46E8
comma
l_int|0x10
)paren
suffix:semicolon
multiline_comment|/* Put into setup mode */
id|outb
c_func
(paren
l_int|0x3C3
comma
l_int|0x10
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x102
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* Enable registers */
id|outb
c_func
(paren
l_int|0x46E8
comma
l_int|0x08
)paren
suffix:semicolon
multiline_comment|/* Enable video */
id|outb
c_func
(paren
l_int|0x3C3
comma
l_int|0x08
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x4AE8
comma
l_int|0x00
)paren
suffix:semicolon
macro_line|#if 0
id|outb
c_func
(paren
l_int|0x42E8
comma
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* Reset graphics engine? */
macro_line|#endif
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x38
)paren
suffix:semicolon
multiline_comment|/* Unlock all registers */
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x48
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x39
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0xA5
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x40
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|inb
c_func
(paren
l_int|0x3D5
)paren
op_or
l_int|0x01
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x33
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|inb
c_func
(paren
l_int|0x3D5
)paren
op_amp
op_complement
l_int|0x52
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x35
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|inb
c_func
(paren
l_int|0x3D5
)paren
op_amp
op_complement
l_int|0x30
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x3A
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x00
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x53
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x00
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x31
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|inb
c_func
(paren
l_int|0x3D5
)paren
op_amp
op_complement
l_int|0x4B
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x58
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x54
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x38
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x60
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x07
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x61
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x80
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x62
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0xA1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x69
)paren
suffix:semicolon
multiline_comment|/* High order bits for cursor address */
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x32
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|inb
c_func
(paren
l_int|0x3D5
)paren
op_amp
op_complement
l_int|0x10
)paren
suffix:semicolon
)brace
r_else
(brace
id|outw
c_func
(paren
l_int|0x3c4
comma
l_int|0x0806
)paren
suffix:semicolon
multiline_comment|/* IBM Portable 860 */
id|outw
c_func
(paren
l_int|0x3c4
comma
l_int|0x1041
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3c4
comma
l_int|0x1128
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x4000
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x3100
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x3a05
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x6688
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x5800
)paren
suffix:semicolon
multiline_comment|/* disable linear addressing */
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x4500
)paren
suffix:semicolon
multiline_comment|/* disable H/W cursor */
id|outw
c_func
(paren
l_int|0x3c4
comma
l_int|0x5410
)paren
suffix:semicolon
multiline_comment|/* enable auto-centering */
id|outw
c_func
(paren
l_int|0x3c4
comma
l_int|0x561f
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x3c4
comma
l_int|0x1b80
)paren
suffix:semicolon
multiline_comment|/* lock DCLK selection */
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x3900
)paren
suffix:semicolon
multiline_comment|/* lock S3 registers */
id|outw
c_func
(paren
l_int|0x3d4
comma
l_int|0x3800
)paren
suffix:semicolon
)brace
multiline_comment|/* endif */
)brace
multiline_comment|/*&n; * cursor() sets an offset (0-1999) into the 80x25 text area   &n; */
r_void
DECL|function|cursor
id|cursor
c_func
(paren
r_int
id|x
comma
r_int
id|y
)paren
(brace
r_int
id|pos
op_assign
(paren
id|y
op_star
id|cols
)paren
op_plus
id|x
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|14
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|pos
op_rshift
l_int|8
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|15
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|pos
)paren
suffix:semicolon
)brace
DECL|function|clearVideoMemory
id|clearVideoMemory
c_func
(paren
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|lines
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|cols
suffix:semicolon
id|j
op_increment
)paren
(brace
id|vidmem
(braket
(paren
(paren
id|i
op_star
id|cols
)paren
op_plus
id|j
)paren
op_star
l_int|2
)braket
op_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* fill with space character */
id|vidmem
(braket
(paren
(paren
id|i
op_star
id|cols
)paren
op_plus
id|j
)paren
op_star
l_int|2
op_plus
l_int|1
)braket
op_assign
l_int|0x07
suffix:semicolon
multiline_comment|/* set bg &amp; fg attributes */
)brace
)brace
)brace
multiline_comment|/* ============ */
DECL|macro|NSLOTS
mdefine_line|#define NSLOTS 8
DECL|macro|NPCIREGS
mdefine_line|#define NPCIREGS  5
multiline_comment|/* &n; should use devfunc number/indirect method to be totally safe on &n; all machines, this works for now on 3 slot Moto boxes &n;*/
DECL|struct|PCI_ConfigInfo
r_struct
id|PCI_ConfigInfo
(brace
DECL|member|config_addr
r_int
r_int
op_star
id|config_addr
suffix:semicolon
DECL|member|regs
r_int
r_int
id|regs
(braket
id|NPCIREGS
)braket
suffix:semicolon
DECL|variable|PCI_slots
)brace
id|PCI_slots
(braket
id|NSLOTS
)braket
op_assign
(brace
(brace
(paren
r_int
r_int
op_star
)paren
l_int|0x80808000
comma
l_int|0xDEADBEEF
)brace
comma
multiline_comment|/* onboard */
(brace
(paren
r_int
r_int
op_star
)paren
l_int|0x80800800
comma
l_int|0xDEADBEEF
)brace
comma
multiline_comment|/* onboard */
(brace
(paren
r_int
r_int
op_star
)paren
l_int|0x80801000
comma
l_int|0xDEADBEEF
)brace
comma
multiline_comment|/* onboard */
(brace
(paren
r_int
r_int
op_star
)paren
l_int|0x80802000
comma
l_int|0xDEADBEEF
)brace
comma
multiline_comment|/* onboard */
(brace
(paren
r_int
r_int
op_star
)paren
l_int|0x80804000
comma
l_int|0xDEADBEEF
)brace
comma
multiline_comment|/* onboard */
(brace
(paren
r_int
r_int
op_star
)paren
l_int|0x80810000
comma
l_int|0xDEADBEEF
)brace
comma
multiline_comment|/* slot A/1 */
(brace
(paren
r_int
r_int
op_star
)paren
l_int|0x80820000
comma
l_int|0xDEADBEEF
)brace
comma
multiline_comment|/* slot B/2 */
(brace
(paren
r_int
r_int
op_star
)paren
l_int|0x80840000
comma
l_int|0xDEADBEEF
)brace
multiline_comment|/* slot C/3 */
)brace
suffix:semicolon
multiline_comment|/*&n; * The following code modifies the PCI Command register&n; * to enable memory and I/O accesses.    &n; */
DECL|function|unlockVideo
id|unlockVideo
c_func
(paren
id|slot
)paren
(brace
r_volatile
r_int
r_char
op_star
id|ppci
suffix:semicolon
id|ppci
op_assign
(paren
r_int
r_char
op_star
)paren
id|PCI_slots
(braket
id|slot
)braket
dot
id|config_addr
suffix:semicolon
id|ppci
(braket
l_int|4
)braket
op_assign
l_int|0x0003
suffix:semicolon
multiline_comment|/* enable memory and I/O accesses */
id|ppci
(braket
l_int|0x10
)braket
op_assign
l_int|0x00000
suffix:semicolon
multiline_comment|/* turn off memory mapping */
id|ppci
(braket
l_int|0x11
)braket
op_assign
l_int|0x00000
suffix:semicolon
multiline_comment|/* mem_base = 0 */
id|ppci
(braket
l_int|0x12
)braket
op_assign
l_int|0x00000
suffix:semicolon
id|ppci
(braket
l_int|0x13
)braket
op_assign
l_int|0x00000
suffix:semicolon
id|__asm__
r_volatile
(paren
l_string|&quot;eieio&quot;
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3d4
comma
l_int|0x11
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3d5
comma
l_int|0x0e
)paren
suffix:semicolon
multiline_comment|/* unlock CR0-CR7 */
)brace
r_int
DECL|function|SwapBytes
id|SwapBytes
c_func
(paren
r_int
id|lv
)paren
multiline_comment|/* turn little endian into big indian long */
(brace
r_int
id|t
suffix:semicolon
id|t
op_assign
(paren
id|lv
op_amp
l_int|0x000000FF
)paren
op_lshift
l_int|24
suffix:semicolon
id|t
op_or_assign
(paren
id|lv
op_amp
l_int|0x0000FF00
)paren
op_lshift
l_int|8
suffix:semicolon
id|t
op_or_assign
(paren
id|lv
op_amp
l_int|0x00FF0000
)paren
op_rshift
l_int|8
suffix:semicolon
id|t
op_or_assign
(paren
id|lv
op_amp
l_int|0xFF000000
)paren
op_rshift
l_int|24
suffix:semicolon
r_return
id|t
suffix:semicolon
)brace
DECL|macro|DEVID
mdefine_line|#define DEVID   0
DECL|macro|CMD
mdefine_line|#define CMD     1
DECL|macro|CLASS
mdefine_line|#define CLASS   2
DECL|macro|MEMBASE
mdefine_line|#define MEMBASE 4
r_int
DECL|function|scanPCI
id|scanPCI
c_func
(paren
r_int
id|start_slt
)paren
(brace
r_int
id|slt
comma
id|r
suffix:semicolon
r_struct
id|PCI_ConfigInfo
op_star
id|pslot
suffix:semicolon
r_int
id|theSlot
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|highVgaSlot
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|slt
op_assign
id|start_slt
op_plus
l_int|1
suffix:semicolon
id|slt
OL
id|NSLOTS
suffix:semicolon
id|slt
op_increment
)paren
(brace
id|pslot
op_assign
op_amp
id|PCI_slots
(braket
id|slt
)braket
suffix:semicolon
r_for
c_loop
(paren
id|r
op_assign
l_int|0
suffix:semicolon
id|r
OL
id|NPCIREGS
suffix:semicolon
id|r
op_increment
)paren
(brace
id|pslot-&gt;regs
(braket
id|r
)braket
op_assign
id|SwapBytes
(paren
id|pslot-&gt;config_addr
(braket
id|r
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* card in slot ? */
r_if
c_cond
(paren
id|pslot-&gt;regs
(braket
id|DEVID
)braket
op_ne
l_int|0xFFFFFFFF
)paren
(brace
multiline_comment|/* VGA ? */
r_if
c_cond
(paren
(paren
(paren
id|pslot-&gt;regs
(braket
id|CLASS
)braket
op_amp
l_int|0xFFFFFF00
)paren
op_eq
l_int|0x03000000
)paren
op_logical_or
(paren
(paren
id|pslot-&gt;regs
(braket
id|CLASS
)braket
op_amp
l_int|0xFFFFFF00
)paren
op_eq
l_int|0x00010000
)paren
)paren
(brace
id|highVgaSlot
op_assign
id|slt
suffix:semicolon
multiline_comment|/* did firmware enable it ? */
r_if
c_cond
(paren
(paren
id|pslot-&gt;regs
(braket
id|CMD
)braket
op_amp
l_int|0x03
)paren
)paren
(brace
id|theSlot
op_assign
id|slt
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
r_return
(paren
id|theSlot
)paren
suffix:semicolon
)brace
multiline_comment|/* return Vendor ID of card in the slot */
r_static
DECL|function|PCIVendor
r_int
id|PCIVendor
c_func
(paren
r_int
id|slotnum
)paren
(brace
r_struct
id|PCI_ConfigInfo
op_star
id|pslot
suffix:semicolon
id|pslot
op_assign
op_amp
id|PCI_slots
(braket
id|slotnum
)braket
suffix:semicolon
r_return
(paren
id|pslot-&gt;regs
(braket
id|DEVID
)braket
op_amp
l_int|0xFFFF
)paren
suffix:semicolon
)brace
r_static
DECL|function|printslots
r_void
id|printslots
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|PCI_ConfigInfo
op_star
id|pslot
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NSLOTS
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#if 0
id|pslot
op_assign
op_amp
id|PCI_slots
(braket
id|i
)braket
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;Slot: %d, Addr: %x, Vendor: %08x, Class: %08x&bslash;n&quot;
comma
id|i
comma
id|pslot-&gt;config_addr
comma
id|pslot-&gt;regs
(braket
l_int|0
)braket
comma
id|pslot-&gt;regs
(braket
l_int|2
)braket
)paren
suffix:semicolon
macro_line|#else
id|puts
c_func
(paren
l_string|&quot;PCI Slot number: &quot;
)paren
suffix:semicolon
id|puthex
c_func
(paren
id|i
)paren
suffix:semicolon
id|puts
c_func
(paren
l_string|&quot; Vendor ID: &quot;
)paren
suffix:semicolon
id|puthex
c_func
(paren
id|PCIVendor
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|puts
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
eof
