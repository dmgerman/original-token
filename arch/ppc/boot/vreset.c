multiline_comment|/*&n; * vreset.c&n; *&n; * Initialize the VGA control registers to 80x25 text mode.&n; *&n; * Adapted from a program by:&n; *                                      Steve Sellgren&n; *                                      San Francisco Indigo Company&n; *                                      sfindigo!sellgren@uunet.uu.net&n; */
DECL|variable|CRTC
r_int
r_char
id|CRTC
(braket
l_int|24
)braket
op_assign
(brace
l_int|0x5F
comma
l_int|0x4F
comma
l_int|0x50
comma
l_int|0x82
comma
l_int|0x55
comma
l_int|0x81
comma
l_int|0xBF
comma
l_int|0x1F
comma
l_int|0x00
comma
l_int|0x4F
comma
l_int|0x0D
comma
l_int|0x0E
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/*0x07, 0x80, */
l_int|0x9C
comma
l_int|0xAE
comma
l_int|0x8F
comma
l_int|0x28
comma
l_int|0x1F
comma
l_int|0x96
comma
l_int|0xB9
comma
l_int|0xA3
)brace
suffix:semicolon
DECL|variable|SEQ
r_int
r_char
id|SEQ
(braket
l_int|5
)braket
op_assign
(brace
l_int|0x3
comma
l_int|0x0
comma
l_int|0x3
comma
l_int|0x0
comma
l_int|0x2
)brace
suffix:semicolon
DECL|variable|GC
r_int
r_char
id|GC
(braket
l_int|9
)braket
op_assign
(brace
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x10
comma
l_int|0xE
comma
l_int|0x0
comma
l_int|0xFF
)brace
suffix:semicolon
DECL|variable|AC
r_int
r_char
id|AC
(braket
l_int|21
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x14
comma
l_int|0x07
comma
l_int|0x38
comma
l_int|0x39
comma
l_int|0x3A
comma
l_int|0x3B
comma
l_int|0x3C
comma
l_int|0x3D
comma
l_int|0x3E
comma
l_int|0x3F
comma
l_int|0x0C
comma
l_int|0x00
comma
l_int|0x0F
comma
l_int|0x08
comma
l_int|0x00
)brace
suffix:semicolon
macro_line|#include &quot;iso_font.h&quot;
DECL|variable|color_LUT
r_static
r_const
r_int
r_char
id|color_LUT
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* 0 - black */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x2A
comma
multiline_comment|/* 1 - blue */
l_int|0x00
comma
l_int|0x2A
comma
l_int|0x00
comma
multiline_comment|/* 2 - green */
l_int|0x00
comma
l_int|0x2A
comma
l_int|0x2A
comma
multiline_comment|/* 3 - cyan */
l_int|0x2A
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* 4 - red */
l_int|0x2A
comma
l_int|0x00
comma
l_int|0x2A
comma
multiline_comment|/* 5 - magenta */
l_int|0x2A
comma
l_int|0x2A
comma
l_int|0x00
comma
multiline_comment|/* 6 - brown */
l_int|0x2A
comma
l_int|0x2A
comma
l_int|0x2A
comma
multiline_comment|/* 7 - white */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x15
comma
multiline_comment|/* 8 - gray */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x3F
comma
multiline_comment|/* 9 - light blue */
l_int|0x00
comma
l_int|0x2A
comma
l_int|0x15
comma
multiline_comment|/* 10 - light green */
l_int|0x00
comma
l_int|0x2A
comma
l_int|0x3F
comma
multiline_comment|/* 11 - light cyan */
l_int|0x2A
comma
l_int|0x00
comma
l_int|0x15
comma
multiline_comment|/* 12 - light red */
l_int|0x2A
comma
l_int|0x00
comma
l_int|0x3F
comma
multiline_comment|/* 13 - light magenta */
l_int|0x2A
comma
l_int|0x2A
comma
l_int|0x15
comma
multiline_comment|/* 14 - yellow */
l_int|0x2A
comma
l_int|0x2A
comma
l_int|0x3F
comma
multiline_comment|/* 15 - bright white */
)brace
suffix:semicolon
r_static
r_inline
DECL|function|outw
id|outw
c_func
(paren
r_int
id|port
comma
r_int
r_int
id|val
)paren
(brace
id|outb
c_func
(paren
id|port
comma
id|val
op_rshift
l_int|8
)paren
suffix:semicolon
id|outb
c_func
(paren
id|port
op_plus
l_int|1
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|vga_init
id|vga_init
c_func
(paren
r_int
r_char
op_star
id|ISA_mem
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
id|value
suffix:semicolon
r_int
r_char
op_star
id|font_page
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|ISA_mem
(braket
l_int|0xA0000
)braket
suffix:semicolon
multiline_comment|/* See if VGA already in TEXT mode - exit if so! */
id|outb
c_func
(paren
l_int|0x3CE
comma
l_int|0x06
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
l_int|0x3CF
)paren
op_amp
l_int|0x01
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* From the S3 manual */
id|outb
c_func
(paren
l_int|0x46E8
comma
l_int|0x10
)paren
suffix:semicolon
multiline_comment|/* Put into setup mode */
id|outb
c_func
(paren
l_int|0x3C3
comma
l_int|0x10
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x102
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* Enable registers */
id|outb
c_func
(paren
l_int|0x46E8
comma
l_int|0x08
)paren
suffix:semicolon
multiline_comment|/* Enable video */
id|outb
c_func
(paren
l_int|0x3C3
comma
l_int|0x08
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x4AE8
comma
l_int|0x00
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x42E8
comma
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* Reset graphics engine? */
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x38
)paren
suffix:semicolon
multiline_comment|/* Unlock all registers */
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x48
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x39
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0xA5
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x40
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|inb
c_func
(paren
l_int|0x3D5
)paren
op_or
l_int|0x01
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x33
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|inb
c_func
(paren
l_int|0x3D5
)paren
op_amp
op_complement
l_int|0x52
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x35
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|inb
c_func
(paren
l_int|0x3D5
)paren
op_amp
op_complement
l_int|0x30
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x3A
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x00
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x53
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x00
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x31
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|inb
c_func
(paren
l_int|0x3D5
)paren
op_amp
op_complement
l_int|0x4B
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x58
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x54
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x38
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x60
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x07
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x61
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0x80
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x62
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0xA1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x69
)paren
suffix:semicolon
multiline_comment|/* High order bits for cursor address */
id|outb
c_func
(paren
l_int|0x3D5
comma
l_int|0
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D4
comma
l_int|0x32
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|inb
c_func
(paren
l_int|0x3D5
)paren
op_amp
op_complement
l_int|0x10
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C2
comma
l_int|0x67
)paren
suffix:semicolon
multiline_comment|/* Initialize DAC */
id|outb
c_func
(paren
l_int|0x3C6
comma
l_int|0xFF
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x3C7
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C8
comma
l_int|0x00
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x3C7
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|color_LUT
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
l_int|0x3C9
comma
id|color_LUT
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
suffix:semicolon
id|i
OL
l_int|768
suffix:semicolon
id|i
op_add_assign
l_int|3
)paren
(brace
id|outb
c_func
(paren
l_int|0x3C9
comma
l_int|0x3F
)paren
suffix:semicolon
multiline_comment|/* White? */
id|outb
c_func
(paren
l_int|0x3C9
comma
l_int|0x3F
)paren
suffix:semicolon
multiline_comment|/* White? */
id|outb
c_func
(paren
l_int|0x3C9
comma
l_int|0x3F
)paren
suffix:semicolon
multiline_comment|/* White? */
)brace
multiline_comment|/* Load font */
id|NOP
c_func
(paren
id|inb
c_func
(paren
l_int|0x3DA
)paren
)paren
suffix:semicolon
multiline_comment|/* Reset Address/Data FlipFlop for Attribute ctlr */
id|outb
c_func
(paren
l_int|0x3C0
comma
l_int|0x30
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C0
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* graphics mode */
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0001
)paren
suffix:semicolon
multiline_comment|/* reset sequencer */
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0204
)paren
suffix:semicolon
multiline_comment|/* write to plane 2 */
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0407
)paren
suffix:semicolon
multiline_comment|/* enable plane graphics */
id|outw
c_func
(paren
l_int|0x3C4
comma
l_int|0x0003
)paren
suffix:semicolon
multiline_comment|/* reset sequencer */
id|outw
c_func
(paren
l_int|0x3CE
comma
l_int|0x0402
)paren
suffix:semicolon
multiline_comment|/* read plane 2 */
id|outw
c_func
(paren
l_int|0x3CE
comma
l_int|0x0500
)paren
suffix:semicolon
multiline_comment|/* write mode 0, read mode 0 */
id|outw
c_func
(paren
l_int|0x3CE
comma
l_int|0x0600
)paren
suffix:semicolon
multiline_comment|/* set graphics */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|font
)paren
suffix:semicolon
id|i
op_add_assign
l_int|16
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|font_page
(braket
(paren
l_int|2
op_star
id|i
)paren
op_plus
id|j
)braket
op_assign
id|font
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|24
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
l_int|0x3D4
comma
id|i
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3D5
comma
id|CRTC
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
l_int|0x3C4
comma
id|i
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C5
comma
id|SEQ
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
l_int|0x3CE
comma
id|i
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3CF
comma
id|GC
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|value
op_assign
id|inb
c_func
(paren
l_int|0x3DA
)paren
suffix:semicolon
multiline_comment|/* reset flip-flop */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
l_int|0x3C0
comma
id|i
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C0
comma
id|AC
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OL
l_int|21
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
l_int|0x3C0
comma
id|i
op_or
l_int|0x20
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x3C0
comma
id|AC
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0x3C2
comma
l_int|0x23
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|NOP
id|NOP
c_func
(paren
r_int
id|x
)paren
(brace
)brace
eof
