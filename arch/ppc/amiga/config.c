DECL|macro|m68k_debug_device
mdefine_line|#define m68k_debug_device debug_device
macro_line|#include &lt;linux/init.h&gt;
multiline_comment|/* machine dependent &quot;kbd-reset&quot; setup function */
r_void
(paren
op_star
id|mach_kbd_reset_setup
)paren
(paren
r_char
op_star
comma
r_int
)paren
id|__initdata
op_assign
l_int|0
suffix:semicolon
macro_line|#include &lt;asm/io.h&gt;
multiline_comment|/*&n; *  linux/arch/m68k/amiga/config.c&n; *&n; *  Copyright (C) 1993 Hamish Macdonald&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
multiline_comment|/*&n; * Miscellaneous Amiga stuff&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/amigahw.h&gt;
macro_line|#include &lt;asm/amigaints.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;linux/zorro.h&gt;
DECL|variable|powerup_PCI_present
r_int
r_int
id|powerup_PCI_present
suffix:semicolon
DECL|variable|amiga_model
r_int
r_int
id|amiga_model
suffix:semicolon
DECL|variable|amiga_eclock
r_int
r_int
id|amiga_eclock
suffix:semicolon
DECL|variable|amiga_masterclock
r_int
r_int
id|amiga_masterclock
suffix:semicolon
DECL|variable|amiga_colorclock
r_int
r_int
id|amiga_colorclock
suffix:semicolon
DECL|variable|amiga_chipset
r_int
r_int
id|amiga_chipset
suffix:semicolon
DECL|variable|amiga_vblank
r_int
r_char
id|amiga_vblank
suffix:semicolon
DECL|variable|amiga_psfreq
r_int
r_char
id|amiga_psfreq
suffix:semicolon
DECL|variable|amiga_hw_present
r_struct
id|amiga_hw_present
id|amiga_hw_present
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a500
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A500&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a500p
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A500+&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a600
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A600&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a1000
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A1000&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a1200
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A1200&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a2000
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A2000&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a2500
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A2500&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a3000
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A3000&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a3000t
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A3000T&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a3000p
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A3000+&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a4000
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A4000&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_a4000t
(braket
)braket
id|__initdata
op_assign
l_string|&quot;A4000T&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_cdtv
(braket
)braket
id|__initdata
op_assign
l_string|&quot;CDTV&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_cd32
(braket
)braket
id|__initdata
op_assign
l_string|&quot;CD32&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
id|s_draco
(braket
)braket
id|__initdata
op_assign
l_string|&quot;Draco&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_const
r_char
op_star
id|amiga_models
(braket
)braket
id|__initdata
op_assign
(brace
id|s_a500
comma
id|s_a500p
comma
id|s_a600
comma
id|s_a1000
comma
id|s_a1200
comma
id|s_a2000
comma
id|s_a2500
comma
id|s_a3000
comma
id|s_a3000t
comma
id|s_a3000p
comma
id|s_a4000
comma
id|s_a4000t
comma
id|s_cdtv
comma
id|s_cd32
comma
id|s_draco
comma
)brace
suffix:semicolon
DECL|variable|amiga_model_name
r_static
r_char
id|amiga_model_name
(braket
l_int|13
)braket
op_assign
l_string|&quot;Amiga &quot;
suffix:semicolon
r_extern
r_char
id|m68k_debug_device
(braket
)braket
suffix:semicolon
r_static
r_void
id|amiga_sched_init
c_func
(paren
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
)paren
suffix:semicolon
multiline_comment|/* amiga specific keyboard functions */
r_extern
r_int
id|amiga_keyb_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|amiga_kbdrate
(paren
r_struct
id|kbd_repeat
op_star
)paren
suffix:semicolon
multiline_comment|/* amiga specific irq functions */
r_extern
r_void
id|amiga_init_IRQ
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
(paren
op_star
id|amiga_default_handler
(braket
)braket
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
r_extern
r_int
id|amiga_request_irq
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|flags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
suffix:semicolon
r_extern
r_void
id|amiga_free_irq
(paren
r_int
r_int
id|irq
comma
r_void
op_star
id|dev_id
)paren
suffix:semicolon
r_extern
r_void
id|amiga_enable_irq
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|amiga_disable_irq
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
r_void
id|amiga_get_model
c_func
(paren
r_char
op_star
id|model
)paren
suffix:semicolon
r_static
r_int
id|amiga_get_hardware_list
c_func
(paren
r_char
op_star
id|buffer
)paren
suffix:semicolon
r_extern
r_int
id|amiga_get_irq_list
(paren
r_char
op_star
)paren
suffix:semicolon
multiline_comment|/* amiga specific timer functions */
r_static
r_int
r_int
id|amiga_gettimeoffset
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|a3000_gettod
(paren
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
)paren
suffix:semicolon
r_static
r_void
id|a2000_gettod
(paren
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
)paren
suffix:semicolon
r_static
r_int
id|amiga_hwclk
(paren
r_int
comma
r_struct
id|hwclk_time
op_star
)paren
suffix:semicolon
r_static
r_int
id|amiga_set_clock_mmss
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|amiga_mksound
c_func
(paren
r_int
r_int
id|count
comma
r_int
r_int
id|ticks
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_AMIGA_FLOPPY
r_extern
r_void
id|amiga_floppy_setup
c_func
(paren
r_char
op_star
comma
r_int
op_star
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|amiga_reset
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|amiga_wait_key
(paren
r_struct
id|console
op_star
id|co
)paren
suffix:semicolon
r_extern
r_void
id|amiga_init_sound
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|amiga_savekmsg_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|amiga_mem_console_write
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|b
comma
r_int
r_int
id|count
)paren
suffix:semicolon
r_void
id|amiga_serial_console_write
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|s
comma
r_int
r_int
id|count
)paren
suffix:semicolon
r_static
r_void
id|amiga_debug_init
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_HEARTBEAT
r_static
r_void
id|amiga_heartbeat
c_func
(paren
r_int
id|on
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|amiga_console_driver
r_static
r_struct
id|console
id|amiga_console_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;debug&quot;
comma
id|wait_key
suffix:colon
id|amiga_wait_key
comma
id|flags
suffix:colon
id|CON_PRINTBUFFER
comma
id|index
suffix:colon
op_minus
l_int|1
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_MAGIC_SYSRQ
DECL|variable|amiga_sysrq_xlate
r_static
r_char
id|amiga_sysrq_xlate
(braket
l_int|128
)braket
op_assign
l_string|&quot;&bslash;0001234567890-=&bslash;&bslash;&bslash;000&bslash;000&quot;
multiline_comment|/* 0x00 - 0x0f */
l_string|&quot;qwertyuiop[]&bslash;000123&quot;
multiline_comment|/* 0x10 - 0x1f */
l_string|&quot;asdfghjkl;&squot;&bslash;000&bslash;000456&quot;
multiline_comment|/* 0x20 - 0x2f */
l_string|&quot;&bslash;000zxcvbnm,./&bslash;000+789&quot;
multiline_comment|/* 0x30 - 0x3f */
l_string|&quot; &bslash;177&bslash;t&bslash;r&bslash;r&bslash;000&bslash;177&bslash;000&bslash;000&bslash;000-&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&quot;
multiline_comment|/* 0x40 - 0x4f */
l_string|&quot;&bslash;000&bslash;201&bslash;202&bslash;203&bslash;204&bslash;205&bslash;206&bslash;207&bslash;210&bslash;211()/*+&bslash;000&quot;
multiline_comment|/* 0x50 - 0x5f */
l_string|&quot;&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&quot;
multiline_comment|/* 0x60 - 0x6f */
l_string|&quot;&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&bslash;000&quot;
suffix:semicolon
multiline_comment|/* 0x70 - 0x7f */
macro_line|#endif
r_extern
r_void
(paren
op_star
id|kd_mksound
)paren
(paren
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
multiline_comment|/*&n;     *  Motherboard Resources present in all Amiga models&n;     */
DECL|variable|mb_res
r_static
r_struct
id|resource
id|mb_res
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Ranger Memory&quot;
comma
l_int|0x00c00000
comma
l_int|0x00c7ffff
)brace
comma
(brace
l_string|&quot;CIA B&quot;
comma
l_int|0x00bfd000
comma
l_int|0x00bfdfff
)brace
comma
(brace
l_string|&quot;CIA A&quot;
comma
l_int|0x00bfe000
comma
l_int|0x00bfefff
)brace
comma
(brace
l_string|&quot;Custom I/O&quot;
comma
l_int|0x00dff000
comma
l_int|0x00dfffff
)brace
comma
(brace
l_string|&quot;Kickstart ROM&quot;
comma
l_int|0x00f80000
comma
l_int|0x00ffffff
)brace
)brace
suffix:semicolon
DECL|variable|rtc_resource
r_static
r_struct
id|resource
id|rtc_resource
op_assign
(brace
l_string|&quot;A2000 RTC&quot;
comma
l_int|0x00dc0000
comma
l_int|0x00dcffff
)brace
suffix:semicolon
DECL|variable|ram_resource
r_static
r_struct
id|resource
id|ram_resource
(braket
id|NUM_MEMINFO
)braket
suffix:semicolon
multiline_comment|/*&n;     *  Parse an Amiga-specific record in the bootinfo&n;     */
DECL|function|amiga_parse_bootinfo
r_int
id|amiga_parse_bootinfo
c_func
(paren
r_const
r_struct
id|bi_record
op_star
id|record
)paren
(brace
r_int
id|unknown
op_assign
l_int|0
suffix:semicolon
r_const
r_int
r_int
op_star
id|data
op_assign
id|record-&gt;data
suffix:semicolon
r_switch
c_cond
(paren
id|record-&gt;tag
)paren
(brace
r_case
id|BI_AMIGA_MODEL
suffix:colon
(brace
r_int
r_int
id|d
op_assign
op_star
id|data
suffix:semicolon
id|powerup_PCI_present
op_assign
id|d
op_amp
l_int|0x100
suffix:semicolon
id|amiga_model
op_assign
id|d
op_amp
l_int|0xff
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|BI_AMIGA_ECLOCK
suffix:colon
id|amiga_eclock
op_assign
op_star
id|data
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BI_AMIGA_CHIPSET
suffix:colon
id|amiga_chipset
op_assign
op_star
id|data
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BI_AMIGA_CHIP_SIZE
suffix:colon
id|amiga_chip_size
op_assign
op_star
(paren
r_const
r_int
op_star
)paren
id|data
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BI_AMIGA_VBLANK
suffix:colon
id|amiga_vblank
op_assign
op_star
(paren
r_const
r_int
r_char
op_star
)paren
id|data
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BI_AMIGA_PSFREQ
suffix:colon
id|amiga_psfreq
op_assign
op_star
(paren
r_const
r_int
r_char
op_star
)paren
id|data
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BI_AMIGA_AUTOCON
suffix:colon
r_if
c_cond
(paren
id|zorro_num_autocon
OL
id|ZORRO_NUM_AUTO
)paren
(brace
r_const
r_struct
id|ConfigDev
op_star
id|cd
op_assign
(paren
r_struct
id|ConfigDev
op_star
)paren
id|data
suffix:semicolon
r_struct
id|zorro_dev
op_star
id|dev
op_assign
op_amp
id|zorro_autocon
(braket
id|zorro_num_autocon
op_increment
)braket
suffix:semicolon
id|dev-&gt;rom
op_assign
id|cd-&gt;cd_Rom
suffix:semicolon
id|dev-&gt;slotaddr
op_assign
id|cd-&gt;cd_SlotAddr
suffix:semicolon
id|dev-&gt;slotsize
op_assign
id|cd-&gt;cd_SlotSize
suffix:semicolon
id|dev-&gt;resource.start
op_assign
(paren
r_int
r_int
)paren
id|cd-&gt;cd_BoardAddr
suffix:semicolon
id|dev-&gt;resource.end
op_assign
id|dev-&gt;resource.start
op_plus
id|cd-&gt;cd_BoardSize
op_minus
l_int|1
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;amiga_parse_bootinfo: too many AutoConfig devices&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BI_AMIGA_SERPER
suffix:colon
multiline_comment|/* serial port period: ignored here */
r_break
suffix:semicolon
r_default
suffix:colon
id|unknown
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|unknown
suffix:semicolon
)brace
multiline_comment|/*&n;     *  Identify builtin hardware&n;     */
DECL|function|amiga_identify
r_static
r_void
id|__init
id|amiga_identify
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Fill in some default values, if necessary */
r_if
c_cond
(paren
id|amiga_eclock
op_eq
l_int|0
)paren
id|amiga_eclock
op_assign
l_int|709379
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|amiga_hw_present
comma
l_int|0
comma
r_sizeof
(paren
id|amiga_hw_present
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Amiga hardware found: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amiga_model
op_ge
id|AMI_500
op_logical_and
id|amiga_model
op_le
id|AMI_DRACO
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[%s] &quot;
comma
id|amiga_models
(braket
id|amiga_model
op_minus
id|AMI_500
)braket
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|amiga_model_name
comma
id|amiga_models
(braket
id|amiga_model
op_minus
id|AMI_500
)braket
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|amiga_model
)paren
(brace
r_case
id|AMI_UNKNOWN
suffix:colon
r_goto
id|Generic
suffix:semicolon
r_case
id|AMI_600
suffix:colon
r_case
id|AMI_1200
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A1200_IDE
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|PCMCIA
)paren
suffix:semicolon
r_case
id|AMI_500
suffix:colon
r_case
id|AMI_500PLUS
suffix:colon
r_case
id|AMI_1000
suffix:colon
r_case
id|AMI_2000
suffix:colon
r_case
id|AMI_2500
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A2000_CLK
)paren
suffix:semicolon
multiline_comment|/* Is this correct for all models? */
r_goto
id|Generic
suffix:semicolon
r_case
id|AMI_3000
suffix:colon
r_case
id|AMI_3000T
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AMBER_FF
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|MAGIC_REKICK
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|AMI_3000PLUS
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A3000_SCSI
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|A3000_CLK
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|ZORRO3
)paren
suffix:semicolon
r_goto
id|Generic
suffix:semicolon
r_case
id|AMI_4000T
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A4000_SCSI
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|AMI_4000
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A4000_IDE
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|A3000_CLK
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|ZORRO3
)paren
suffix:semicolon
r_goto
id|Generic
suffix:semicolon
r_case
id|AMI_CDTV
suffix:colon
r_case
id|AMI_CD32
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|CD_ROM
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|A2000_CLK
)paren
suffix:semicolon
multiline_comment|/* Is this correct? */
r_goto
id|Generic
suffix:semicolon
id|Generic
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AMI_VIDEO
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_BLITTER
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_AUDIO
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_FLOPPY
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_KEYBOARD
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_MOUSE
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_SERIAL
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_PARALLEL
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|CHIP_RAM
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|PAULA
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|amiga_chipset
)paren
(brace
r_case
id|CS_OCS
suffix:colon
r_case
id|CS_ECS
suffix:colon
r_case
id|CS_AGA
suffix:colon
r_switch
c_cond
(paren
id|custom.deniseid
op_amp
l_int|0xf
)paren
(brace
r_case
l_int|0x0c
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|DENISE_HR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x08
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|LISA
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|DENISE
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
(paren
id|custom.vposr
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
)paren
(brace
r_case
l_int|0x00
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AGNUS_PAL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x10
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AGNUS_NTSC
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x20
suffix:colon
r_case
l_int|0x21
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AGNUS_HR_PAL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x30
suffix:colon
r_case
l_int|0x31
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AGNUS_HR_NTSC
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x22
suffix:colon
r_case
l_int|0x23
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|ALICE_PAL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x32
suffix:colon
r_case
l_int|0x33
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|ALICE_NTSC
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|AMIGAHW_SET
c_func
(paren
id|ZORRO
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_DRACO
suffix:colon
id|panic
c_func
(paren
l_string|&quot;No support for Draco yet&quot;
)paren
suffix:semicolon
r_default
suffix:colon
id|panic
c_func
(paren
l_string|&quot;Unknown Amiga Model&quot;
)paren
suffix:semicolon
)brace
DECL|macro|AMIGAHW_ANNOUNCE
mdefine_line|#define AMIGAHW_ANNOUNCE(name, str)&t;&t;&t;&bslash;&n;  if (AMIGAHW_PRESENT(name))&t;&t;&t;&t;&bslash;&n;    printk(str)
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_VIDEO
comma
l_string|&quot;VIDEO &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_BLITTER
comma
l_string|&quot;BLITTER &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMBER_FF
comma
l_string|&quot;AMBER_FF &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_AUDIO
comma
l_string|&quot;AUDIO &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_FLOPPY
comma
l_string|&quot;FLOPPY &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A3000_SCSI
comma
l_string|&quot;A3000_SCSI &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A4000_SCSI
comma
l_string|&quot;A4000_SCSI &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A1200_IDE
comma
l_string|&quot;A1200_IDE &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A4000_IDE
comma
l_string|&quot;A4000_IDE &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|CD_ROM
comma
l_string|&quot;CD_ROM &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_KEYBOARD
comma
l_string|&quot;KEYBOARD &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_MOUSE
comma
l_string|&quot;MOUSE &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_SERIAL
comma
l_string|&quot;SERIAL &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_PARALLEL
comma
l_string|&quot;PARALLEL &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A2000_CLK
comma
l_string|&quot;A2000_CLK &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A3000_CLK
comma
l_string|&quot;A3000_CLK &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|CHIP_RAM
comma
l_string|&quot;CHIP_RAM &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|PAULA
comma
l_string|&quot;PAULA &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|DENISE
comma
l_string|&quot;DENISE &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|DENISE_HR
comma
l_string|&quot;DENISE_HR &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|LISA
comma
l_string|&quot;LISA &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_PAL
comma
l_string|&quot;AGNUS_PAL &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_NTSC
comma
l_string|&quot;AGNUS_NTSC &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_HR_PAL
comma
l_string|&quot;AGNUS_HR_PAL &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_HR_NTSC
comma
l_string|&quot;AGNUS_HR_NTSC &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|ALICE_PAL
comma
l_string|&quot;ALICE_PAL &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|ALICE_NTSC
comma
l_string|&quot;ALICE_NTSC &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|MAGIC_REKICK
comma
l_string|&quot;MAGIC_REKICK &quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|PCMCIA
comma
l_string|&quot;PCMCIA &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|ZORRO
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;ZORRO%s &quot;
comma
id|AMIGAHW_PRESENT
c_func
(paren
id|ZORRO3
)paren
ques
c_cond
l_string|&quot;3&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
DECL|macro|AMIGAHW_ANNOUNCE
macro_line|#undef AMIGAHW_ANNOUNCE
)brace
multiline_comment|/*&n;     *  Setup the Amiga configuration info&n;     */
DECL|function|config_amiga
r_void
id|__init
id|config_amiga
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|amiga_debug_init
c_func
(paren
)paren
suffix:semicolon
id|amiga_identify
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Some APUS boxes may have PCI memory, but ... */
id|iomem_resource.name
op_assign
l_string|&quot;Memory&quot;
suffix:semicolon
id|request_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|ranger_resource
)paren
suffix:semicolon
id|request_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|ciab_resource
)paren
suffix:semicolon
id|request_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|ciaa_resource
)paren
suffix:semicolon
id|request_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|custom_chips_resource
)paren
suffix:semicolon
id|request_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|kickstart_resource
)paren
suffix:semicolon
id|mach_sched_init
op_assign
id|amiga_sched_init
suffix:semicolon
id|mach_keyb_init
op_assign
id|amiga_keyb_init
suffix:semicolon
id|mach_kbdrate
op_assign
id|amiga_kbdrate
suffix:semicolon
id|mach_init_IRQ
op_assign
id|amiga_init_IRQ
suffix:semicolon
id|mach_default_handler
op_assign
op_amp
id|amiga_default_handler
suffix:semicolon
macro_line|#ifndef CONFIG_APUS
id|mach_request_irq
op_assign
id|amiga_request_irq
suffix:semicolon
id|mach_free_irq
op_assign
id|amiga_free_irq
suffix:semicolon
id|enable_irq
op_assign
id|amiga_enable_irq
suffix:semicolon
id|disable_irq
op_assign
id|amiga_disable_irq
suffix:semicolon
macro_line|#endif
id|mach_get_model
op_assign
id|amiga_get_model
suffix:semicolon
id|mach_get_hardware_list
op_assign
id|amiga_get_hardware_list
suffix:semicolon
id|mach_get_irq_list
op_assign
id|amiga_get_irq_list
suffix:semicolon
id|mach_gettimeoffset
op_assign
id|amiga_gettimeoffset
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|A3000_CLK
)paren
)paren
(brace
id|mach_gettod
op_assign
id|a3000_gettod
suffix:semicolon
id|rtc_resource.name
(braket
l_int|1
)braket
op_assign
l_char|&squot;3&squot;
suffix:semicolon
id|request_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|rtc_resource
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* if (AMIGAHW_PRESENT(A2000_CLK)) */
id|mach_gettod
op_assign
id|a2000_gettod
suffix:semicolon
id|request_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|rtc_resource
)paren
suffix:semicolon
)brace
id|mach_max_dma_address
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;      * default MAX_DMA=0xffffffff&n;&t;&t;&t;&t;      * on all machines. If we don&squot;t&n;&t;&t;&t;&t;      * do so, the SCSI code will not&n;&t;&t;&t;&t;      * be able to allocate any mem&n;&t;&t;&t;&t;      * for transfers, unless we are&n;&t;&t;&t;&t;      * dealing with a Z2 mem only&n;&t;&t;&t;&t;      * system.                  /Jes&n;&t;&t;&t;&t;      */
id|mach_hwclk
op_assign
id|amiga_hwclk
suffix:semicolon
id|mach_set_clock_mmss
op_assign
id|amiga_set_clock_mmss
suffix:semicolon
macro_line|#ifdef CONFIG_AMIGA_FLOPPY
id|mach_floppy_setup
op_assign
id|amiga_floppy_setup
suffix:semicolon
macro_line|#endif
id|mach_reset
op_assign
id|amiga_reset
suffix:semicolon
id|conswitchp
op_assign
op_amp
id|dummy_con
suffix:semicolon
id|kd_mksound
op_assign
id|amiga_mksound
suffix:semicolon
macro_line|#ifdef CONFIG_MAGIC_SYSRQ
id|mach_sysrq_key
op_assign
l_int|0x5f
suffix:semicolon
multiline_comment|/* HELP */
id|mach_sysrq_shift_state
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* SHIFT+ALTGR */
id|mach_sysrq_shift_mask
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* all modifiers except CapsLock */
id|mach_sysrq_xlate
op_assign
id|amiga_sysrq_xlate
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_HEARTBEAT
id|mach_heartbeat
op_assign
id|amiga_heartbeat
suffix:semicolon
macro_line|#endif
multiline_comment|/* Fill in the clock values (based on the 700 kHz E-Clock) */
id|amiga_masterclock
op_assign
l_int|40
op_star
id|amiga_eclock
suffix:semicolon
multiline_comment|/* 28 MHz */
id|amiga_colorclock
op_assign
l_int|5
op_star
id|amiga_eclock
suffix:semicolon
multiline_comment|/* 3.5 MHz */
multiline_comment|/* clear all DMA bits */
id|custom.dmacon
op_assign
id|DMAF_ALL
suffix:semicolon
multiline_comment|/* ensure that the DMA master bit is set */
id|custom.dmacon
op_assign
id|DMAF_SETCLR
op_or
id|DMAF_MASTER
suffix:semicolon
multiline_comment|/* request all RAM */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|m68k_num_memory
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ram_resource
(braket
id|i
)braket
dot
id|name
op_assign
(paren
id|m68k_memory
(braket
id|i
)braket
dot
id|addr
op_ge
l_int|0x01000000
)paren
ques
c_cond
l_string|&quot;32-bit Fast RAM&quot;
suffix:colon
(paren
id|m68k_memory
(braket
id|i
)braket
dot
id|addr
OL
l_int|0x00c00000
)paren
ques
c_cond
l_string|&quot;16-bit Fast RAM&quot;
suffix:colon
l_string|&quot;16-bit Slow RAM&quot;
suffix:semicolon
id|ram_resource
(braket
id|i
)braket
dot
id|start
op_assign
id|m68k_memory
(braket
id|i
)braket
dot
id|addr
suffix:semicolon
id|ram_resource
(braket
id|i
)braket
dot
id|end
op_assign
id|m68k_memory
(braket
id|i
)braket
dot
id|addr
op_plus
id|m68k_memory
(braket
id|i
)braket
dot
id|size
op_minus
l_int|1
suffix:semicolon
id|request_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|ram_resource
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* initialize chipram allocator */
id|amiga_chip_init
(paren
)paren
suffix:semicolon
multiline_comment|/* debugging using chipram */
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|m68k_debug_device
comma
l_string|&quot;mem&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|AMIGAHW_PRESENT
c_func
(paren
id|CHIP_RAM
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;Warning: no chipram present for debugging&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|amiga_savekmsg_init
c_func
(paren
)paren
suffix:semicolon
id|amiga_console_driver.write
op_assign
id|amiga_mem_console_write
suffix:semicolon
id|register_console
c_func
(paren
op_amp
id|amiga_console_driver
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* our beloved beeper */
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|AMI_AUDIO
)paren
)paren
id|amiga_init_sound
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;   * if it is an A3000, set the magic bit that forces&n;   * a hard rekick&n;   */
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|MAGIC_REKICK
)paren
)paren
op_star
(paren
r_int
r_char
op_star
)paren
id|ZTWO_VADDR
c_func
(paren
l_int|0xde0002
)paren
op_or_assign
l_int|0x80
suffix:semicolon
)brace
DECL|variable|jiffy_ticks
r_static
r_int
r_int
id|jiffy_ticks
suffix:semicolon
DECL|function|amiga_sched_init
r_static
r_void
id|__init
id|amiga_sched_init
c_func
(paren
r_void
(paren
op_star
id|timer_routine
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
)paren
(brace
id|jiffy_ticks
op_assign
(paren
id|amiga_eclock
op_plus
id|HZ
op_div
l_int|2
)paren
op_div
id|HZ
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|CIAB_PHYSADDR
op_plus
l_int|0x400
comma
l_int|0x200
comma
l_string|&quot;timer&quot;
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;Cannot allocate ciab.ta{lo,hi}&bslash;n&quot;
)paren
suffix:semicolon
id|ciab.cra
op_and_assign
l_int|0xC0
suffix:semicolon
multiline_comment|/* turn off timer A, continuous mode, from Eclk */
id|ciab.talo
op_assign
id|jiffy_ticks
op_mod
l_int|256
suffix:semicolon
id|ciab.tahi
op_assign
id|jiffy_ticks
op_div
l_int|256
suffix:semicolon
multiline_comment|/* install interrupt service routine for CIAB Timer A&n;&t; *&n;&t; * Please don&squot;t change this to use ciaa, as it interferes with the&n;&t; * SCSI code. We&squot;ll have to take a look at this later&n;&t; */
id|request_irq
c_func
(paren
id|IRQ_AMIGA_CIAB_TA
comma
id|timer_routine
comma
l_int|0
comma
l_string|&quot;timer&quot;
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* start timer */
id|ciab.cra
op_or_assign
l_int|0x11
suffix:semicolon
)brace
DECL|macro|TICK_SIZE
mdefine_line|#define TICK_SIZE 10000
r_extern
r_int
r_char
id|cia_get_irq_mask
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
multiline_comment|/* This is always executed with interrupts disabled.  */
DECL|function|amiga_gettimeoffset
r_static
r_int
r_int
id|amiga_gettimeoffset
(paren
r_void
)paren
(brace
r_int
r_int
id|hi
comma
id|lo
comma
id|hi2
suffix:semicolon
r_int
r_int
id|ticks
comma
id|offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* read CIA B timer A current value */
id|hi
op_assign
id|ciab.tahi
suffix:semicolon
id|lo
op_assign
id|ciab.talo
suffix:semicolon
id|hi2
op_assign
id|ciab.tahi
suffix:semicolon
r_if
c_cond
(paren
id|hi
op_ne
id|hi2
)paren
(brace
id|lo
op_assign
id|ciab.talo
suffix:semicolon
id|hi
op_assign
id|hi2
suffix:semicolon
)brace
id|ticks
op_assign
id|hi
op_lshift
l_int|8
op_or
id|lo
suffix:semicolon
r_if
c_cond
(paren
id|ticks
OG
id|jiffy_ticks
op_div
l_int|2
)paren
multiline_comment|/* check for pending interrupt */
r_if
c_cond
(paren
id|cia_get_irq_mask
c_func
(paren
id|IRQ_AMIGA_CIAB
)paren
op_amp
id|CIA_ICR_TA
)paren
id|offset
op_assign
l_int|10000
suffix:semicolon
id|ticks
op_assign
id|jiffy_ticks
op_minus
id|ticks
suffix:semicolon
id|ticks
op_assign
(paren
l_int|10000
op_star
id|ticks
)paren
op_div
id|jiffy_ticks
suffix:semicolon
r_return
id|ticks
op_plus
id|offset
suffix:semicolon
)brace
DECL|function|a3000_gettod
r_static
r_void
id|a3000_gettod
(paren
r_int
op_star
id|yearp
comma
r_int
op_star
id|monp
comma
r_int
op_star
id|dayp
comma
r_int
op_star
id|hourp
comma
r_int
op_star
id|minp
comma
r_int
op_star
id|secp
)paren
(brace
r_volatile
r_struct
id|tod3000
op_star
id|tod
op_assign
id|TOD_3000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_HOLD
suffix:semicolon
op_star
id|secp
op_assign
id|tod-&gt;second1
op_star
l_int|10
op_plus
id|tod-&gt;second2
suffix:semicolon
op_star
id|minp
op_assign
id|tod-&gt;minute1
op_star
l_int|10
op_plus
id|tod-&gt;minute2
suffix:semicolon
op_star
id|hourp
op_assign
id|tod-&gt;hour1
op_star
l_int|10
op_plus
id|tod-&gt;hour2
suffix:semicolon
op_star
id|dayp
op_assign
id|tod-&gt;day1
op_star
l_int|10
op_plus
id|tod-&gt;day2
suffix:semicolon
op_star
id|monp
op_assign
id|tod-&gt;month1
op_star
l_int|10
op_plus
id|tod-&gt;month2
suffix:semicolon
op_star
id|yearp
op_assign
id|tod-&gt;year1
op_star
l_int|10
op_plus
id|tod-&gt;year2
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_FREE
suffix:semicolon
)brace
DECL|function|a2000_gettod
r_static
r_void
id|a2000_gettod
(paren
r_int
op_star
id|yearp
comma
r_int
op_star
id|monp
comma
r_int
op_star
id|dayp
comma
r_int
op_star
id|hourp
comma
r_int
op_star
id|minp
comma
r_int
op_star
id|secp
)paren
(brace
r_volatile
r_struct
id|tod2000
op_star
id|tod
op_assign
id|TOD_2000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
r_while
c_loop
(paren
id|tod-&gt;cntrl1
op_amp
id|TOD2000_CNTRL1_BUSY
)paren
suffix:semicolon
op_star
id|secp
op_assign
id|tod-&gt;second1
op_star
l_int|10
op_plus
id|tod-&gt;second2
suffix:semicolon
op_star
id|minp
op_assign
id|tod-&gt;minute1
op_star
l_int|10
op_plus
id|tod-&gt;minute2
suffix:semicolon
op_star
id|hourp
op_assign
(paren
id|tod-&gt;hour1
op_amp
l_int|3
)paren
op_star
l_int|10
op_plus
id|tod-&gt;hour2
suffix:semicolon
op_star
id|dayp
op_assign
id|tod-&gt;day1
op_star
l_int|10
op_plus
id|tod-&gt;day2
suffix:semicolon
op_star
id|monp
op_assign
id|tod-&gt;month1
op_star
l_int|10
op_plus
id|tod-&gt;month2
suffix:semicolon
op_star
id|yearp
op_assign
id|tod-&gt;year1
op_star
l_int|10
op_plus
id|tod-&gt;year2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tod-&gt;cntrl3
op_amp
id|TOD2000_CNTRL3_24HMODE
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tod-&gt;hour1
op_amp
id|TOD2000_HOUR1_PM
)paren
op_logical_and
op_star
id|hourp
op_eq
l_int|12
)paren
op_star
id|hourp
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|tod-&gt;hour1
op_amp
id|TOD2000_HOUR1_PM
)paren
op_logical_and
op_star
id|hourp
op_ne
l_int|12
)paren
op_star
id|hourp
op_add_assign
l_int|12
suffix:semicolon
)brace
id|tod-&gt;cntrl1
op_and_assign
op_complement
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
)brace
DECL|function|amiga_hwclk
r_static
r_int
id|amiga_hwclk
c_func
(paren
r_int
id|op
comma
r_struct
id|hwclk_time
op_star
id|t
)paren
(brace
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|A3000_CLK
)paren
)paren
(brace
r_volatile
r_struct
id|tod3000
op_star
id|tod
op_assign
id|TOD_3000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_HOLD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|op
)paren
(brace
multiline_comment|/* read */
id|t-&gt;sec
op_assign
id|tod-&gt;second1
op_star
l_int|10
op_plus
id|tod-&gt;second2
suffix:semicolon
id|t-&gt;min
op_assign
id|tod-&gt;minute1
op_star
l_int|10
op_plus
id|tod-&gt;minute2
suffix:semicolon
id|t-&gt;hour
op_assign
id|tod-&gt;hour1
op_star
l_int|10
op_plus
id|tod-&gt;hour2
suffix:semicolon
id|t-&gt;day
op_assign
id|tod-&gt;day1
op_star
l_int|10
op_plus
id|tod-&gt;day2
suffix:semicolon
id|t-&gt;wday
op_assign
id|tod-&gt;weekday
suffix:semicolon
id|t-&gt;mon
op_assign
id|tod-&gt;month1
op_star
l_int|10
op_plus
id|tod-&gt;month2
op_minus
l_int|1
suffix:semicolon
id|t-&gt;year
op_assign
id|tod-&gt;year1
op_star
l_int|10
op_plus
id|tod-&gt;year2
suffix:semicolon
)brace
r_else
(brace
id|tod-&gt;second1
op_assign
id|t-&gt;sec
op_div
l_int|10
suffix:semicolon
id|tod-&gt;second2
op_assign
id|t-&gt;sec
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;minute1
op_assign
id|t-&gt;min
op_div
l_int|10
suffix:semicolon
id|tod-&gt;minute2
op_assign
id|t-&gt;min
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;hour1
op_assign
id|t-&gt;hour
op_div
l_int|10
suffix:semicolon
id|tod-&gt;hour2
op_assign
id|t-&gt;hour
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;day1
op_assign
id|t-&gt;day
op_div
l_int|10
suffix:semicolon
id|tod-&gt;day2
op_assign
id|t-&gt;day
op_mod
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;wday
op_ne
op_minus
l_int|1
)paren
id|tod-&gt;weekday
op_assign
id|t-&gt;wday
suffix:semicolon
id|tod-&gt;month1
op_assign
(paren
id|t-&gt;mon
op_plus
l_int|1
)paren
op_div
l_int|10
suffix:semicolon
id|tod-&gt;month2
op_assign
(paren
id|t-&gt;mon
op_plus
l_int|1
)paren
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;year1
op_assign
id|t-&gt;year
op_div
l_int|10
suffix:semicolon
id|tod-&gt;year2
op_assign
id|t-&gt;year
op_mod
l_int|10
suffix:semicolon
)brace
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_FREE
suffix:semicolon
)brace
r_else
multiline_comment|/* if (AMIGAHW_PRESENT(A2000_CLK)) */
(brace
r_volatile
r_struct
id|tod2000
op_star
id|tod
op_assign
id|TOD_2000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
r_while
c_loop
(paren
id|tod-&gt;cntrl1
op_amp
id|TOD2000_CNTRL1_BUSY
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|op
)paren
(brace
multiline_comment|/* read */
id|t-&gt;sec
op_assign
id|tod-&gt;second1
op_star
l_int|10
op_plus
id|tod-&gt;second2
suffix:semicolon
id|t-&gt;min
op_assign
id|tod-&gt;minute1
op_star
l_int|10
op_plus
id|tod-&gt;minute2
suffix:semicolon
id|t-&gt;hour
op_assign
(paren
id|tod-&gt;hour1
op_amp
l_int|3
)paren
op_star
l_int|10
op_plus
id|tod-&gt;hour2
suffix:semicolon
id|t-&gt;day
op_assign
id|tod-&gt;day1
op_star
l_int|10
op_plus
id|tod-&gt;day2
suffix:semicolon
id|t-&gt;wday
op_assign
id|tod-&gt;weekday
suffix:semicolon
id|t-&gt;mon
op_assign
id|tod-&gt;month1
op_star
l_int|10
op_plus
id|tod-&gt;month2
op_minus
l_int|1
suffix:semicolon
id|t-&gt;year
op_assign
id|tod-&gt;year1
op_star
l_int|10
op_plus
id|tod-&gt;year2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tod-&gt;cntrl3
op_amp
id|TOD2000_CNTRL3_24HMODE
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tod-&gt;hour1
op_amp
id|TOD2000_HOUR1_PM
)paren
op_logical_and
id|t-&gt;hour
op_eq
l_int|12
)paren
id|t-&gt;hour
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|tod-&gt;hour1
op_amp
id|TOD2000_HOUR1_PM
)paren
op_logical_and
id|t-&gt;hour
op_ne
l_int|12
)paren
id|t-&gt;hour
op_add_assign
l_int|12
suffix:semicolon
)brace
)brace
r_else
(brace
id|tod-&gt;second1
op_assign
id|t-&gt;sec
op_div
l_int|10
suffix:semicolon
id|tod-&gt;second2
op_assign
id|t-&gt;sec
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;minute1
op_assign
id|t-&gt;min
op_div
l_int|10
suffix:semicolon
id|tod-&gt;minute2
op_assign
id|t-&gt;min
op_mod
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|tod-&gt;cntrl3
op_amp
id|TOD2000_CNTRL3_24HMODE
)paren
id|tod-&gt;hour1
op_assign
id|t-&gt;hour
op_div
l_int|10
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;hour
op_ge
l_int|12
)paren
id|tod-&gt;hour1
op_assign
id|TOD2000_HOUR1_PM
op_plus
(paren
id|t-&gt;hour
op_minus
l_int|12
)paren
op_div
l_int|10
suffix:semicolon
r_else
id|tod-&gt;hour1
op_assign
id|t-&gt;hour
op_div
l_int|10
suffix:semicolon
id|tod-&gt;hour2
op_assign
id|t-&gt;hour
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;day1
op_assign
id|t-&gt;day
op_div
l_int|10
suffix:semicolon
id|tod-&gt;day2
op_assign
id|t-&gt;day
op_mod
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;wday
op_ne
op_minus
l_int|1
)paren
id|tod-&gt;weekday
op_assign
id|t-&gt;wday
suffix:semicolon
id|tod-&gt;month1
op_assign
(paren
id|t-&gt;mon
op_plus
l_int|1
)paren
op_div
l_int|10
suffix:semicolon
id|tod-&gt;month2
op_assign
(paren
id|t-&gt;mon
op_plus
l_int|1
)paren
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;year1
op_assign
id|t-&gt;year
op_div
l_int|10
suffix:semicolon
id|tod-&gt;year2
op_assign
id|t-&gt;year
op_mod
l_int|10
suffix:semicolon
)brace
id|tod-&gt;cntrl1
op_and_assign
op_complement
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|amiga_set_clock_mmss
r_static
r_int
id|amiga_set_clock_mmss
(paren
r_int
r_int
id|nowtime
)paren
(brace
r_int
id|real_seconds
op_assign
id|nowtime
op_mod
l_int|60
comma
id|real_minutes
op_assign
(paren
id|nowtime
op_div
l_int|60
)paren
op_mod
l_int|60
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|A3000_CLK
)paren
)paren
(brace
r_volatile
r_struct
id|tod3000
op_star
id|tod
op_assign
id|TOD_3000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_HOLD
suffix:semicolon
id|tod-&gt;second1
op_assign
id|real_seconds
op_div
l_int|10
suffix:semicolon
id|tod-&gt;second2
op_assign
id|real_seconds
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;minute1
op_assign
id|real_minutes
op_div
l_int|10
suffix:semicolon
id|tod-&gt;minute2
op_assign
id|real_minutes
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_FREE
suffix:semicolon
)brace
r_else
multiline_comment|/* if (AMIGAHW_PRESENT(A2000_CLK)) */
(brace
r_volatile
r_struct
id|tod2000
op_star
id|tod
op_assign
id|TOD_2000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
r_while
c_loop
(paren
id|tod-&gt;cntrl1
op_amp
id|TOD2000_CNTRL1_BUSY
)paren
suffix:semicolon
id|tod-&gt;second1
op_assign
id|real_seconds
op_div
l_int|10
suffix:semicolon
id|tod-&gt;second2
op_assign
id|real_seconds
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;minute1
op_assign
id|real_minutes
op_div
l_int|10
suffix:semicolon
id|tod-&gt;minute2
op_assign
id|real_minutes
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;cntrl1
op_and_assign
op_complement
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|amiga_wait_key
r_static
r_int
id|amiga_wait_key
(paren
r_struct
id|console
op_star
id|co
)paren
(brace
r_int
id|i
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_while
c_loop
(paren
id|ciaa.pra
op_amp
l_int|0x40
)paren
suffix:semicolon
multiline_comment|/* debounce */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ciaa.pra
op_amp
l_int|0x40
)paren
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/* wait for button up */
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|ciaa.pra
op_amp
l_int|0x40
)paren
)paren
suffix:semicolon
multiline_comment|/* debounce */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ciaa.pra
op_amp
l_int|0x40
)paren
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dbprintf
r_void
id|dbprintf
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
r_static
r_char
id|buf
(braket
l_int|1024
)braket
suffix:semicolon
id|va_list
id|args
suffix:semicolon
r_extern
r_void
id|console_print
(paren
r_const
r_char
op_star
id|str
)paren
suffix:semicolon
r_extern
r_int
id|vsprintf
c_func
(paren
r_char
op_star
id|buf
comma
r_const
r_char
op_star
id|fmt
comma
id|va_list
id|args
)paren
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|vsprintf
c_func
(paren
id|buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|console_print
(paren
id|buf
)paren
suffix:semicolon
)brace
r_static
id|NORET_TYPE
r_void
id|amiga_reset
c_func
(paren
r_void
)paren
id|ATTRIB_NORET
suffix:semicolon
DECL|function|amiga_reset
r_static
r_void
id|amiga_reset
(paren
r_void
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;     *  Debugging&n;     */
DECL|macro|SAVEKMSG_MAXMEM
mdefine_line|#define SAVEKMSG_MAXMEM&t;&t;128*1024
DECL|macro|SAVEKMSG_MAGIC1
mdefine_line|#define SAVEKMSG_MAGIC1&t;&t;0x53415645&t;/* &squot;SAVE&squot; */
DECL|macro|SAVEKMSG_MAGIC2
mdefine_line|#define SAVEKMSG_MAGIC2&t;&t;0x4B4D5347&t;/* &squot;KMSG&squot; */
DECL|struct|savekmsg
r_struct
id|savekmsg
(brace
DECL|member|magic1
r_int
r_int
id|magic1
suffix:semicolon
multiline_comment|/* SAVEKMSG_MAGIC1 */
DECL|member|magic2
r_int
r_int
id|magic2
suffix:semicolon
multiline_comment|/* SAVEKMSG_MAGIC2 */
DECL|member|magicptr
r_int
r_int
id|magicptr
suffix:semicolon
multiline_comment|/* address of magic1 */
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|data
r_char
id|data
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|savekmsg
r_static
r_struct
id|savekmsg
op_star
id|savekmsg
op_assign
l_int|NULL
suffix:semicolon
DECL|function|amiga_mem_console_write
r_static
r_void
id|amiga_mem_console_write
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|s
comma
r_int
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|savekmsg-&gt;size
op_plus
id|count
op_le
id|SAVEKMSG_MAXMEM
op_minus
r_sizeof
(paren
r_struct
id|savekmsg
)paren
)paren
(brace
id|memcpy
c_func
(paren
id|savekmsg-&gt;data
op_plus
id|savekmsg-&gt;size
comma
id|s
comma
id|count
)paren
suffix:semicolon
id|savekmsg-&gt;size
op_add_assign
id|count
suffix:semicolon
)brace
)brace
DECL|function|amiga_savekmsg_init
r_static
r_void
id|amiga_savekmsg_init
c_func
(paren
r_void
)paren
(brace
id|savekmsg
op_assign
(paren
r_struct
id|savekmsg
op_star
)paren
id|amiga_chip_alloc
c_func
(paren
id|SAVEKMSG_MAXMEM
comma
l_string|&quot;Debug&quot;
)paren
suffix:semicolon
id|savekmsg-&gt;magic1
op_assign
id|SAVEKMSG_MAGIC1
suffix:semicolon
id|savekmsg-&gt;magic2
op_assign
id|SAVEKMSG_MAGIC2
suffix:semicolon
id|savekmsg-&gt;magicptr
op_assign
id|virt_to_phys
c_func
(paren
id|savekmsg
)paren
suffix:semicolon
id|savekmsg-&gt;size
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|amiga_serial_putc
r_static
r_void
id|amiga_serial_putc
c_func
(paren
r_char
id|c
)paren
(brace
id|custom.serdat
op_assign
(paren
r_int
r_char
)paren
id|c
op_or
l_int|0x100
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|custom.serdatr
op_amp
l_int|0x2000
)paren
)paren
suffix:semicolon
)brace
DECL|function|amiga_serial_console_write
r_void
id|amiga_serial_console_write
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|s
comma
r_int
r_int
id|count
)paren
(brace
macro_line|#if 0 /* def CONFIG_KGDB */
multiline_comment|/* FIXME:APUS GDB doesn&squot;t seem to like O-packages before it is&n;           properly connected with the target. */
id|__gdb_output_string
(paren
id|s
comma
id|count
)paren
suffix:semicolon
macro_line|#else
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_star
id|s
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|amiga_serial_putc
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
id|amiga_serial_putc
c_func
(paren
op_star
id|s
op_increment
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
macro_line|#ifdef CONFIG_SERIAL_CONSOLE
DECL|function|amiga_serial_puts
r_void
id|amiga_serial_puts
c_func
(paren
r_const
r_char
op_star
id|s
)paren
(brace
id|amiga_serial_console_write
c_func
(paren
l_int|NULL
comma
id|s
comma
id|strlen
c_func
(paren
id|s
)paren
)paren
suffix:semicolon
)brace
DECL|function|amiga_serial_console_wait_key
r_int
id|amiga_serial_console_wait_key
c_func
(paren
r_struct
id|console
op_star
id|co
)paren
(brace
r_int
id|ch
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|custom.intreqr
op_amp
id|IF_RBF
)paren
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|ch
op_assign
id|custom.serdatr
op_amp
l_int|0xff
suffix:semicolon
multiline_comment|/* clear the interrupt, so that another character can be read */
id|custom.intreq
op_assign
id|IF_RBF
suffix:semicolon
r_return
id|ch
suffix:semicolon
)brace
DECL|function|amiga_serial_gets
r_void
id|amiga_serial_gets
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_char
op_star
id|s
comma
r_int
id|len
)paren
(brace
r_int
id|ch
comma
id|cnt
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|ch
op_assign
id|amiga_serial_console_wait_key
c_func
(paren
id|co
)paren
suffix:semicolon
multiline_comment|/* Check for backspace. */
r_if
c_cond
(paren
id|ch
op_eq
l_int|8
op_logical_or
id|ch
op_eq
l_int|127
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_eq
l_int|0
)paren
(brace
id|amiga_serial_putc
c_func
(paren
l_char|&squot;&bslash;007&squot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|cnt
op_decrement
suffix:semicolon
id|amiga_serial_puts
c_func
(paren
l_string|&quot;&bslash;010 &bslash;010&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* Check for enter. */
r_if
c_cond
(paren
id|ch
op_eq
l_int|10
op_logical_or
id|ch
op_eq
l_int|13
)paren
r_break
suffix:semicolon
multiline_comment|/* See if line is too long. */
r_if
c_cond
(paren
id|cnt
op_ge
id|len
op_plus
l_int|1
)paren
(brace
id|amiga_serial_putc
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|cnt
op_decrement
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* Store and echo character. */
id|s
(braket
id|cnt
op_increment
)braket
op_assign
id|ch
suffix:semicolon
id|amiga_serial_putc
c_func
(paren
id|ch
)paren
suffix:semicolon
)brace
multiline_comment|/* Print enter. */
id|amiga_serial_puts
c_func
(paren
l_string|&quot;&bslash;r&bslash;n&quot;
)paren
suffix:semicolon
id|s
(braket
id|cnt
)braket
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|amiga_debug_init
r_static
r_void
id|__init
id|amiga_debug_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|m68k_debug_device
comma
l_string|&quot;ser&quot;
)paren
)paren
(brace
multiline_comment|/* no initialization required (?) */
id|amiga_console_driver.write
op_assign
id|amiga_serial_console_write
suffix:semicolon
id|register_console
c_func
(paren
op_amp
id|amiga_console_driver
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_HEARTBEAT
DECL|function|amiga_heartbeat
r_static
r_void
id|amiga_heartbeat
c_func
(paren
r_int
id|on
)paren
(brace
r_if
c_cond
(paren
id|on
)paren
id|ciaa.pra
op_and_assign
op_complement
l_int|2
suffix:semicolon
r_else
id|ciaa.pra
op_or_assign
l_int|2
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;     *  Amiga specific parts of /proc&n;     */
DECL|function|amiga_get_model
r_static
r_void
id|amiga_get_model
c_func
(paren
r_char
op_star
id|model
)paren
(brace
id|strcpy
c_func
(paren
id|model
comma
id|amiga_model_name
)paren
suffix:semicolon
)brace
DECL|function|amiga_get_hardware_list
r_static
r_int
id|amiga_get_hardware_list
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|CHIP_RAM
)paren
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Chip RAM:&bslash;t%ldK&bslash;n&quot;
comma
id|amiga_chip_size
op_rshift
l_int|10
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;PS Freq:&bslash;t%dHz&bslash;nEClock Freq:&bslash;t%ldHz&bslash;n&quot;
comma
id|amiga_psfreq
comma
id|amiga_eclock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|AMI_VIDEO
)paren
)paren
(brace
r_char
op_star
id|type
suffix:semicolon
r_switch
c_cond
(paren
id|amiga_chipset
)paren
(brace
r_case
id|CS_OCS
suffix:colon
id|type
op_assign
l_string|&quot;OCS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_ECS
suffix:colon
id|type
op_assign
l_string|&quot;ECS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_AGA
suffix:colon
id|type
op_assign
l_string|&quot;AGA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|type
op_assign
l_string|&quot;Old or Unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Graphics:&bslash;t%s&bslash;n&quot;
comma
id|type
)paren
suffix:semicolon
)brace
DECL|macro|AMIGAHW_ANNOUNCE
mdefine_line|#define AMIGAHW_ANNOUNCE(name, str)&t;&t;&t;&bslash;&n;    if (AMIGAHW_PRESENT(name))&t;&t;&t;&t;&bslash;&n;&t;len += sprintf (buffer+len, &quot;&bslash;t%s&bslash;n&quot;, str)
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Detected hardware:&bslash;n&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_VIDEO
comma
l_string|&quot;Amiga Video&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_BLITTER
comma
l_string|&quot;Blitter&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMBER_FF
comma
l_string|&quot;Amber Flicker Fixer&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_AUDIO
comma
l_string|&quot;Amiga Audio&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_FLOPPY
comma
l_string|&quot;Floppy Controller&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A3000_SCSI
comma
l_string|&quot;SCSI Controller WD33C93 (A3000 style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A4000_SCSI
comma
l_string|&quot;SCSI Controller NCR53C710 (A4000T style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A1200_IDE
comma
l_string|&quot;IDE Interface (A1200 style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A4000_IDE
comma
l_string|&quot;IDE Interface (A4000 style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|CD_ROM
comma
l_string|&quot;Internal CD ROM drive&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_KEYBOARD
comma
l_string|&quot;Keyboard&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_MOUSE
comma
l_string|&quot;Mouse Port&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_SERIAL
comma
l_string|&quot;Serial Port&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_PARALLEL
comma
l_string|&quot;Parallel Port&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A2000_CLK
comma
l_string|&quot;Hardware Clock (A2000 style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A3000_CLK
comma
l_string|&quot;Hardware Clock (A3000 style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|CHIP_RAM
comma
l_string|&quot;Chip RAM&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|PAULA
comma
l_string|&quot;Paula 8364&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|DENISE
comma
l_string|&quot;Denise 8362&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|DENISE_HR
comma
l_string|&quot;Denise 8373&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|LISA
comma
l_string|&quot;Lisa 8375&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_PAL
comma
l_string|&quot;Normal/Fat PAL Agnus 8367/8371&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_NTSC
comma
l_string|&quot;Normal/Fat NTSC Agnus 8361/8370&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_HR_PAL
comma
l_string|&quot;Fat Hires PAL Agnus 8372&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_HR_NTSC
comma
l_string|&quot;Fat Hires NTSC Agnus 8372&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|ALICE_PAL
comma
l_string|&quot;PAL Alice 8374&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|ALICE_NTSC
comma
l_string|&quot;NTSC Alice 8374&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|MAGIC_REKICK
comma
l_string|&quot;Magic Hard Rekick&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|PCMCIA
comma
l_string|&quot;PCMCIA Slot&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|ZORRO
)paren
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tZorro%s AutoConfig: %d Expansion Device%s&bslash;n&quot;
comma
id|AMIGAHW_PRESENT
c_func
(paren
id|ZORRO3
)paren
ques
c_cond
l_string|&quot; III&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|zorro_num_autocon
comma
id|zorro_num_autocon
op_eq
l_int|1
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;s&quot;
)paren
suffix:semicolon
DECL|macro|AMIGAHW_ANNOUNCE
macro_line|#undef AMIGAHW_ANNOUNCE
r_return
id|len
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_APUS
DECL|function|get_hardware_list
r_int
id|get_hardware_list
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_extern
r_int
id|get_cpuinfo
c_func
(paren
r_char
op_star
id|buffer
)paren
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_char
id|model
(braket
l_int|80
)braket
suffix:semicolon
id|u_long
id|mem
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|mach_get_model
)paren
id|mach_get_model
c_func
(paren
id|model
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|model
comma
l_string|&quot;Unknown PowerPC&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Model:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|model
)paren
suffix:semicolon
id|len
op_add_assign
id|get_cpuinfo
c_func
(paren
id|buffer
op_plus
id|len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|mem
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|m68k_realnum_memory
suffix:semicolon
id|i
op_increment
)paren
id|mem
op_add_assign
id|m68k_memory
(braket
id|i
)braket
dot
id|size
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;System Memory:&bslash;t%ldK&bslash;n&quot;
comma
id|mem
op_rshift
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mach_get_hardware_list
)paren
id|len
op_add_assign
id|mach_get_hardware_list
c_func
(paren
id|buffer
op_plus
id|len
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
eof
