multiline_comment|/*&n; *  linux/arch/ppc/kernel/apus_setup.c&n; *&n; *  Copyright (C) 1998, 1999  Jesper Skov&n; *&n; *  Basically what is needed to replace functionality found in&n; *  arch/m68k allowing Amiga drivers to work under APUS.&n; *  Bits of code and/or ideas from arch/m68k and arch/ppc files.&n; *&n; * TODO:&n; *  This file needs a *really* good cleanup. Restructure and optimize.&n; *  Make sure it can be compiled for non-APUS configs. Begin to move&n; *  Amiga specific stuff into mach/amiga.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/hdreg.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#ifdef CONFIG_APUS
macro_line|#include &lt;asm/logging.h&gt;
macro_line|#endif
multiline_comment|/* Needs INITSERIAL call in head.S! */
DECL|macro|APUS_DEBUG
macro_line|#undef APUS_DEBUG
macro_line|#include &lt;linux/ide.h&gt;
DECL|macro|T_CHAR
mdefine_line|#define T_CHAR          (0x0000)        /* char:  don&squot;t touch  */
DECL|macro|T_SHORT
mdefine_line|#define T_SHORT         (0x4000)        /* short: 12 -&gt; 21     */
DECL|macro|T_INT
mdefine_line|#define T_INT           (0x8000)        /* int:   1234 -&gt; 4321 */
DECL|macro|T_TEXT
mdefine_line|#define T_TEXT          (0xc000)        /* text:  12 -&gt; 21     */
DECL|macro|T_MASK_TYPE
mdefine_line|#define T_MASK_TYPE     (0xc000)
DECL|macro|T_MASK_COUNT
mdefine_line|#define T_MASK_COUNT    (0x3fff)
DECL|macro|D_CHAR
mdefine_line|#define D_CHAR(cnt)     (T_CHAR  | (cnt))
DECL|macro|D_SHORT
mdefine_line|#define D_SHORT(cnt)    (T_SHORT | (cnt))
DECL|macro|D_INT
mdefine_line|#define D_INT(cnt)      (T_INT   | (cnt))
DECL|macro|D_TEXT
mdefine_line|#define D_TEXT(cnt)     (T_TEXT  | (cnt))
DECL|variable|driveid_types
r_static
id|u_short
id|driveid_types
(braket
)braket
op_assign
(brace
id|D_SHORT
c_func
(paren
l_int|10
)paren
comma
multiline_comment|/* config - vendor2 */
id|D_TEXT
c_func
(paren
l_int|20
)paren
comma
multiline_comment|/* serial_no */
id|D_SHORT
c_func
(paren
l_int|3
)paren
comma
multiline_comment|/* buf_type, buf_size - ecc_bytes */
id|D_TEXT
c_func
(paren
l_int|48
)paren
comma
multiline_comment|/* fw_rev - model */
id|D_CHAR
c_func
(paren
l_int|2
)paren
comma
multiline_comment|/* max_multsect - vendor3 */
id|D_SHORT
c_func
(paren
l_int|1
)paren
comma
multiline_comment|/* dword_io */
id|D_CHAR
c_func
(paren
l_int|2
)paren
comma
multiline_comment|/* vendor4 - capability */
id|D_SHORT
c_func
(paren
l_int|1
)paren
comma
multiline_comment|/* reserved50 */
id|D_CHAR
c_func
(paren
l_int|4
)paren
comma
multiline_comment|/* vendor5 - tDMA */
id|D_SHORT
c_func
(paren
l_int|4
)paren
comma
multiline_comment|/* field_valid - cur_sectors */
id|D_INT
c_func
(paren
l_int|1
)paren
comma
multiline_comment|/* cur_capacity */
id|D_CHAR
c_func
(paren
l_int|2
)paren
comma
multiline_comment|/* multsect - multsect_valid */
id|D_INT
c_func
(paren
l_int|1
)paren
comma
multiline_comment|/* lba_capacity */
id|D_SHORT
c_func
(paren
l_int|194
)paren
multiline_comment|/* dma_1word - reservedyy */
)brace
suffix:semicolon
DECL|macro|num_driveid_types
mdefine_line|#define num_driveid_types       (sizeof(driveid_types)/sizeof(*driveid_types))
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/amigahw.h&gt;
macro_line|#include &lt;asm/amigaints.h&gt;
macro_line|#include &lt;asm/amigappc.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/init.h&gt;
macro_line|#include &quot;local_irq.h&quot;
DECL|variable|__apusdata
r_int
r_int
id|m68k_machtype
id|__apusdata
suffix:semicolon
DECL|variable|__apusdata
r_char
id|debug_device
(braket
l_int|6
)braket
id|__apusdata
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_extern
r_void
id|amiga_init_IRQ
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
(paren
op_star
id|mach_sched_init
)paren
(paren
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
)paren
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* machine dependent keyboard functions */
r_int
(paren
op_star
id|mach_keyb_init
)paren
(paren
r_void
)paren
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
r_int
(paren
op_star
id|mach_kbdrate
)paren
(paren
r_struct
id|kbd_repeat
op_star
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
r_void
(paren
op_star
id|mach_kbd_leds
)paren
(paren
r_int
r_int
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* machine dependent irq functions */
r_void
(paren
op_star
id|mach_init_IRQ
)paren
(paren
r_void
)paren
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
r_void
(paren
op_star
(paren
op_star
id|mach_default_handler
)paren
(braket
)braket
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
r_void
(paren
op_star
id|mach_get_model
)paren
(paren
r_char
op_star
id|model
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
r_int
(paren
op_star
id|mach_get_hardware_list
)paren
(paren
r_char
op_star
id|buffer
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
r_int
(paren
op_star
id|mach_get_irq_list
)paren
(paren
r_char
op_star
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
r_void
(paren
op_star
id|mach_process_int
)paren
(paren
r_int
comma
r_struct
id|pt_regs
op_star
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* machine dependent timer functions */
r_int
r_int
(paren
op_star
id|mach_gettimeoffset
)paren
(paren
r_void
)paren
id|__apusdata
suffix:semicolon
r_void
(paren
op_star
id|mach_gettod
)paren
(paren
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
)paren
id|__apusdata
suffix:semicolon
r_int
(paren
op_star
id|mach_hwclk
)paren
(paren
r_int
comma
r_struct
id|hwclk_time
op_star
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
r_int
(paren
op_star
id|mach_set_clock_mmss
)paren
(paren
r_int
r_int
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
r_void
(paren
op_star
id|mach_reset
)paren
(paren
r_void
)paren
id|__apusdata
suffix:semicolon
DECL|variable|__apusdata
r_int
id|mach_max_dma_address
id|__apusdata
op_assign
l_int|0x00ffffff
suffix:semicolon
multiline_comment|/* default set to the lower 16MB */
macro_line|#if defined(CONFIG_AMIGA_FLOPPY)
r_void
(paren
op_star
id|mach_floppy_setup
)paren
(paren
r_char
op_star
comma
r_int
op_star
)paren
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
r_void
(paren
op_star
id|mach_floppy_eject
)paren
(paren
r_void
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_HEARTBEAT
r_void
(paren
op_star
id|mach_heartbeat
)paren
(paren
r_int
)paren
id|__apusdata
op_assign
l_int|NULL
suffix:semicolon
r_extern
r_void
id|apus_heartbeat
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
r_extern
r_int
r_int
id|amiga_model
suffix:semicolon
r_extern
r_int
id|decrementer_count
suffix:semicolon
multiline_comment|/* count value for 1e6/HZ microseconds */
r_extern
r_int
id|count_period_num
suffix:semicolon
multiline_comment|/* 1 decrementer count equals */
r_extern
r_int
id|count_period_den
suffix:semicolon
multiline_comment|/* count_period_num / count_period_den us */
DECL|variable|__apusdata
r_int
id|num_memory
id|__apusdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__apusdata
r_struct
id|mem_info
id|memory
(braket
id|NUM_MEMINFO
)braket
id|__apusdata
suffix:semicolon
multiline_comment|/* memory description */
multiline_comment|/* FIXME: Duplicate memory data to avoid conflicts with m68k shared code. */
DECL|variable|__apusdata
r_int
id|m68k_realnum_memory
id|__apusdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__apusdata
r_struct
id|mem_info
id|m68k_memory
(braket
id|NUM_MEMINFO
)braket
id|__apusdata
suffix:semicolon
multiline_comment|/* memory description */
DECL|variable|__apusdata
r_struct
id|mem_info
id|ramdisk
id|__apusdata
suffix:semicolon
r_extern
r_void
id|amiga_floppy_setup
c_func
(paren
r_char
op_star
comma
r_int
op_star
)paren
suffix:semicolon
r_extern
r_void
id|config_amiga
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|__apusdata
r_static
r_int
id|__60nsram
id|__apusdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* for cpuinfo */
DECL|variable|__apusdata
r_static
r_int
id|__bus_speed
id|__apusdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|__apusdata
r_static
r_int
id|__speed_test_failed
id|__apusdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/********************************************** COMPILE PROTECTION */
multiline_comment|/* Provide some stubs that links to Amiga specific functions. &n; * This allows CONFIG_APUS to be removed from generic PPC files while&n; * preventing link errors for other PPC targets.&n; */
id|__apus
DECL|function|apus_get_rtc_time
r_int
r_int
id|apus_get_rtc_time
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_APUS
r_extern
r_int
r_int
id|m68k_get_rtc_time
c_func
(paren
r_void
)paren
suffix:semicolon
r_return
id|m68k_get_rtc_time
(paren
)paren
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
id|__apus
DECL|function|apus_set_rtc_time
r_int
id|apus_set_rtc_time
c_func
(paren
r_int
r_int
id|nowtime
)paren
(brace
macro_line|#ifdef CONFIG_APUS
r_extern
r_int
id|m68k_set_rtc_time
c_func
(paren
r_int
r_int
id|nowtime
)paren
suffix:semicolon
r_return
id|m68k_set_rtc_time
(paren
id|nowtime
)paren
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* Here some functions we don&squot;t support, but which the other ports reference */
DECL|function|pckbd_setkeycode
r_int
id|pckbd_setkeycode
c_func
(paren
r_int
r_int
id|scancode
comma
r_int
r_int
id|keycode
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bogus call to &quot;
id|__FILE__
l_string|&quot;:&quot;
id|__FUNCTION__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pckbd_getkeycode
r_int
id|pckbd_getkeycode
c_func
(paren
r_int
r_int
id|scancode
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bogus call to &quot;
id|__FILE__
l_string|&quot;:&quot;
id|__FUNCTION__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pckbd_translate
r_int
id|pckbd_translate
c_func
(paren
r_int
r_char
id|scancode
comma
r_int
r_char
op_star
id|keycode
comma
r_char
id|raw_mode
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bogus call to &quot;
id|__FILE__
l_string|&quot;:&quot;
id|__FUNCTION__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pckbd_unexpected_up
r_char
id|pckbd_unexpected_up
c_func
(paren
r_int
r_char
id|keycode
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bogus call to &quot;
id|__FILE__
l_string|&quot;:&quot;
id|__FUNCTION__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pckbd_leds
r_void
id|pckbd_leds
c_func
(paren
r_int
r_char
id|leds
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bogus call to &quot;
id|__FILE__
l_string|&quot;:&quot;
id|__FUNCTION__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|pckbd_init_hw
r_void
id|pckbd_init_hw
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bogus call to &quot;
id|__FILE__
l_string|&quot;:&quot;
id|__FUNCTION__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|pckbd_sysrq_xlate
r_int
r_char
id|pckbd_sysrq_xlate
(braket
l_int|128
)braket
suffix:semicolon
DECL|function|pci_scan_peer_bridge
r_struct
id|pci_bus
op_star
id|__init
id|pci_scan_peer_bridge
c_func
(paren
r_int
id|bus
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bogus call to &quot;
id|__FILE__
l_string|&quot;:&quot;
id|__FUNCTION__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*********************************************************** SETUP */
multiline_comment|/* From arch/m68k/kernel/setup.c. */
DECL|function|apus_setup_arch
r_void
id|__init
id|apus_setup_arch
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_APUS
r_extern
r_char
id|cmd_line
(braket
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
multiline_comment|/* Let m68k-shared code know it should do the Amiga thing. */
id|m68k_machtype
op_assign
id|MACH_AMIGA
suffix:semicolon
multiline_comment|/* Parse the command line for arch-specific options.&n;&t; * For the m68k, this is currently only &quot;debug=xxx&quot; to enable printing&n;&t; * certain kernel messages to some machine-specific device.  */
r_for
c_loop
(paren
id|p
op_assign
id|cmd_line
suffix:semicolon
id|p
op_logical_and
op_star
id|p
suffix:semicolon
)paren
(brace
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|p
comma
l_string|&quot;debug=&quot;
comma
l_int|6
)paren
)paren
(brace
id|strncpy
c_func
(paren
id|debug_device
comma
id|p
op_plus
l_int|6
comma
r_sizeof
(paren
id|debug_device
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|debug_device
(braket
r_sizeof
(paren
id|debug_device
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|q
op_assign
id|strchr
c_func
(paren
id|debug_device
comma
l_char|&squot; &squot;
)paren
)paren
)paren
op_star
id|q
op_assign
l_int|0
suffix:semicolon
id|i
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|p
comma
l_string|&quot;60nsram&quot;
comma
l_int|7
)paren
)paren
(brace
id|APUS_WRITE
(paren
id|APUS_REG_WAITSTATE
comma
id|REGWAITSTATE_SETRESET
op_or
id|REGWAITSTATE_PPCR
op_or
id|REGWAITSTATE_PPCW
)paren
suffix:semicolon
id|__60nsram
op_assign
l_int|1
suffix:semicolon
id|i
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
)paren
(brace
multiline_comment|/* option processed, delete it */
r_if
c_cond
(paren
(paren
id|q
op_assign
id|strchr
c_func
(paren
id|p
comma
l_char|&squot; &squot;
)paren
)paren
)paren
id|strcpy
c_func
(paren
id|p
comma
id|q
op_plus
l_int|1
)paren
suffix:semicolon
r_else
op_star
id|p
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|p
op_assign
id|strchr
c_func
(paren
id|p
comma
l_char|&squot; &squot;
)paren
)paren
)paren
op_increment
id|p
suffix:semicolon
)brace
)brace
id|config_amiga
c_func
(paren
)paren
suffix:semicolon
macro_line|#if 0 /* Enable for logging - also include logging.o in Makefile rule */
(brace
mdefine_line|#define LOG_SIZE 4096
r_void
op_star
id|base
suffix:semicolon
multiline_comment|/* Throw away some memory - the P5 firmare stomps on top&n;&t;&t; * of CHIP memory during bootup.&n;&t;&t; */
id|amiga_chip_alloc
c_func
(paren
l_int|0x1000
)paren
suffix:semicolon
id|base
op_assign
id|amiga_chip_alloc
c_func
(paren
id|LOG_SIZE
op_plus
r_sizeof
(paren
id|klog_data_t
)paren
)paren
suffix:semicolon
id|LOG_INIT
c_func
(paren
id|base
comma
id|base
op_plus
r_sizeof
(paren
id|klog_data_t
)paren
comma
id|LOG_SIZE
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif
)brace
id|__apus
r_int
DECL|function|apus_get_cpuinfo
id|apus_get_cpuinfo
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
macro_line|#ifdef CONFIG_APUS
r_extern
r_int
id|__map_without_bats
suffix:semicolon
r_extern
r_int
r_int
id|powerup_PCI_present
suffix:semicolon
r_int
id|len
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;machine&bslash;t&bslash;t: Amiga&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;bus speed&bslash;t: %d%s&quot;
comma
id|__bus_speed
comma
(paren
id|__speed_test_failed
)paren
ques
c_cond
l_string|&quot; [failed]&bslash;n&quot;
suffix:colon
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;using BATs&bslash;t: %s&bslash;n&quot;
comma
(paren
id|__map_without_bats
)paren
ques
c_cond
l_string|&quot;No&quot;
suffix:colon
l_string|&quot;Yes&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;ram speed&bslash;t: %dns&bslash;n&quot;
comma
(paren
id|__60nsram
)paren
ques
c_cond
l_int|60
suffix:colon
l_int|70
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;PCI bridge&bslash;t: %s&bslash;n&quot;
comma
(paren
id|powerup_PCI_present
)paren
ques
c_cond
l_string|&quot;Yes&quot;
suffix:colon
l_string|&quot;No&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
macro_line|#endif
)brace
id|__apus
DECL|function|get_current_tb
r_static
r_void
id|get_current_tb
c_func
(paren
r_int
r_int
r_int
op_star
id|time
)paren
(brace
id|__asm
id|__volatile
(paren
l_string|&quot;1:mftbu 4      &bslash;n&bslash;t&quot;
l_string|&quot;  mftb  5      &bslash;n&bslash;t&quot;
l_string|&quot;  mftbu 6      &bslash;n&bslash;t&quot;
l_string|&quot;  cmpw  4,6    &bslash;n&bslash;t&quot;
l_string|&quot;  bne   1b     &bslash;n&bslash;t&quot;
l_string|&quot;  stw   4,0(%0)&bslash;n&bslash;t&quot;
l_string|&quot;  stw   5,4(%0)&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|time
)paren
suffix:colon
l_string|&quot;r4&quot;
comma
l_string|&quot;r5&quot;
comma
l_string|&quot;r6&quot;
)paren
suffix:semicolon
)brace
id|__apus
DECL|function|apus_calibrate_decr
r_void
id|apus_calibrate_decr
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_APUS
r_int
r_int
id|freq
suffix:semicolon
multiline_comment|/* This algorithm for determining the bus speed was&n;           contributed by Ralph Schmidt. */
r_int
r_int
r_int
id|start
comma
id|stop
suffix:semicolon
r_int
id|bus_speed
suffix:semicolon
r_int
id|speed_test_failed
op_assign
l_int|0
suffix:semicolon
(brace
r_int
r_int
id|loop
op_assign
id|amiga_eclock
op_div
l_int|10
suffix:semicolon
id|get_current_tb
(paren
op_amp
id|start
)paren
suffix:semicolon
r_while
c_loop
(paren
id|loop
op_decrement
)paren
(brace
r_int
r_char
id|tmp
suffix:semicolon
id|tmp
op_assign
id|ciaa.pra
suffix:semicolon
)brace
id|get_current_tb
(paren
op_amp
id|stop
)paren
suffix:semicolon
)brace
id|bus_speed
op_assign
(paren
(paren
(paren
r_int
r_int
)paren
(paren
id|stop
op_minus
id|start
)paren
)paren
op_star
l_int|10
op_star
l_int|4
)paren
op_div
l_int|1000000
suffix:semicolon
r_if
c_cond
(paren
id|AMI_1200
op_eq
id|amiga_model
)paren
id|bus_speed
op_div_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bus_speed
op_ge
l_int|47
)paren
op_logical_and
(paren
id|bus_speed
OL
l_int|53
)paren
)paren
(brace
id|bus_speed
op_assign
l_int|50
suffix:semicolon
id|freq
op_assign
l_int|12500000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|bus_speed
op_ge
l_int|57
)paren
op_logical_and
(paren
id|bus_speed
OL
l_int|63
)paren
)paren
(brace
id|bus_speed
op_assign
l_int|60
suffix:semicolon
id|freq
op_assign
l_int|15000000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|bus_speed
op_ge
l_int|63
)paren
op_logical_and
(paren
id|bus_speed
OL
l_int|69
)paren
)paren
(brace
id|bus_speed
op_assign
l_int|67
suffix:semicolon
id|freq
op_assign
l_int|16666667
suffix:semicolon
)brace
r_else
(brace
id|printk
(paren
l_string|&quot;APUS: Unable to determine bus speed (%d). &quot;
l_string|&quot;Defaulting to 50MHz&quot;
comma
id|bus_speed
)paren
suffix:semicolon
id|bus_speed
op_assign
l_int|50
suffix:semicolon
id|freq
op_assign
l_int|12500000
suffix:semicolon
id|speed_test_failed
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Ease diagnostics... */
(brace
r_extern
r_int
id|__map_without_bats
suffix:semicolon
r_extern
r_int
r_int
id|powerup_PCI_present
suffix:semicolon
id|printk
(paren
l_string|&quot;APUS: BATs=%d, BUS=%dMHz&quot;
comma
(paren
id|__map_without_bats
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
comma
id|bus_speed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|speed_test_failed
)paren
id|printk
(paren
l_string|&quot;[FAILED - please report]&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;, RAM=%dns, PCI bridge=%d&bslash;n&quot;
comma
(paren
id|__60nsram
)paren
ques
c_cond
l_int|60
suffix:colon
l_int|70
comma
(paren
id|powerup_PCI_present
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
multiline_comment|/* print a bit more if asked politely... */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ciaa.pra
op_amp
l_int|0x40
)paren
)paren
(brace
r_extern
r_int
r_int
id|bat_addrs
(braket
l_int|4
)braket
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|b
suffix:semicolon
r_for
c_loop
(paren
id|b
op_assign
l_int|0
suffix:semicolon
id|b
OL
l_int|4
suffix:semicolon
op_increment
id|b
)paren
(brace
id|printk
(paren
l_string|&quot;APUS: BAT%d &quot;
comma
id|b
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;%08x-%08x -&gt; %08x&bslash;n&quot;
comma
id|bat_addrs
(braket
id|b
)braket
(braket
l_int|0
)braket
comma
id|bat_addrs
(braket
id|b
)braket
(braket
l_int|1
)braket
comma
id|bat_addrs
(braket
id|b
)braket
(braket
l_int|2
)braket
)paren
suffix:semicolon
)brace
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;time_init: decrementer frequency = %lu.%.6lu MHz&bslash;n&quot;
comma
id|freq
op_div
l_int|1000000
comma
id|freq
op_mod
l_int|1000000
)paren
suffix:semicolon
id|tb_ticks_per_jiffy
op_assign
id|freq
op_div
id|HZ
suffix:semicolon
id|tb_to_us
op_assign
id|mulhwu_scale_factor
c_func
(paren
id|freq
comma
l_int|1000000
)paren
suffix:semicolon
id|__bus_speed
op_assign
id|bus_speed
suffix:semicolon
id|__speed_test_failed
op_assign
id|speed_test_failed
suffix:semicolon
macro_line|#endif
)brace
id|__apus
DECL|function|arch_gettod
r_void
id|arch_gettod
c_func
(paren
r_int
op_star
id|year
comma
r_int
op_star
id|mon
comma
r_int
op_star
id|day
comma
r_int
op_star
id|hour
comma
r_int
op_star
id|min
comma
r_int
op_star
id|sec
)paren
(brace
macro_line|#ifdef CONFIG_APUS
r_if
c_cond
(paren
id|mach_gettod
)paren
id|mach_gettod
c_func
(paren
id|year
comma
id|mon
comma
id|day
comma
id|hour
comma
id|min
comma
id|sec
)paren
suffix:semicolon
r_else
op_star
id|year
op_assign
op_star
id|mon
op_assign
op_star
id|day
op_assign
op_star
id|hour
op_assign
op_star
id|min
op_assign
op_star
id|sec
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* for &quot;kbd-reset&quot; cmdline param */
id|__init
DECL|function|kbd_reset_setup
r_void
id|kbd_reset_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
(brace
)brace
multiline_comment|/*********************************************************** FLOPPY */
macro_line|#if defined(CONFIG_AMIGA_FLOPPY)
id|__init
DECL|function|floppy_setup
r_void
id|floppy_setup
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
(brace
r_if
c_cond
(paren
id|mach_floppy_setup
)paren
id|mach_floppy_setup
(paren
id|str
comma
id|ints
)paren
suffix:semicolon
)brace
id|__apus
DECL|function|floppy_eject
r_void
id|floppy_eject
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|mach_floppy_eject
)paren
id|mach_floppy_eject
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*********************************************************** MEMORY */
DECL|macro|KMAP_MAX
mdefine_line|#define KMAP_MAX 32
DECL|variable|__apusdata
r_int
r_int
id|kmap_chunks
(braket
id|KMAP_MAX
op_star
l_int|3
)braket
id|__apusdata
suffix:semicolon
DECL|variable|__apusdata
r_int
id|kmap_chunk_count
id|__apusdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* From pgtable.h */
id|__apus
DECL|function|my_find_pte
r_static
id|__inline__
id|pte_t
op_star
id|my_find_pte
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|va
)paren
(brace
id|pgd_t
op_star
id|dir
op_assign
l_int|0
suffix:semicolon
id|pmd_t
op_star
id|pmd
op_assign
l_int|0
suffix:semicolon
id|pte_t
op_star
id|pte
op_assign
l_int|0
suffix:semicolon
id|va
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|dir
op_assign
id|pgd_offset
c_func
(paren
id|mm
comma
id|va
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dir
)paren
(brace
id|pmd
op_assign
id|pmd_offset
c_func
(paren
id|dir
comma
id|va
op_amp
id|PAGE_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmd
op_logical_and
id|pmd_present
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|pte
op_assign
id|pte_offset
c_func
(paren
id|pmd
comma
id|va
)paren
suffix:semicolon
)brace
)brace
r_return
id|pte
suffix:semicolon
)brace
multiline_comment|/* Again simulating an m68k/mm/kmap.c function. */
id|__apus
DECL|function|kernel_set_cachemode
r_void
id|kernel_set_cachemode
c_func
(paren
r_int
r_int
id|address
comma
r_int
r_int
id|size
comma
r_int
r_int
id|cmode
)paren
(brace
r_int
r_int
id|mask
comma
id|flags
suffix:semicolon
r_switch
c_cond
(paren
id|cmode
)paren
(brace
r_case
id|IOMAP_FULL_CACHING
suffix:colon
id|mask
op_assign
op_complement
(paren
id|_PAGE_NO_CACHE
op_or
id|_PAGE_GUARDED
)paren
suffix:semicolon
id|flags
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IOMAP_NOCACHE_SER
suffix:colon
id|mask
op_assign
op_complement
l_int|0
suffix:semicolon
id|flags
op_assign
(paren
id|_PAGE_NO_CACHE
op_or
id|_PAGE_GUARDED
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|panic
(paren
l_string|&quot;kernel_set_cachemode() doesn&squot;t support mode %d&bslash;n&quot;
comma
id|cmode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|size
op_div_assign
id|PAGE_SIZE
suffix:semicolon
id|address
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_while
c_loop
(paren
id|size
op_decrement
)paren
(brace
id|pte_t
op_star
id|pte
suffix:semicolon
id|pte
op_assign
id|my_find_pte
c_func
(paren
op_amp
id|init_mm
comma
id|address
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pte
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pte NULL in kernel_set_cachemode()&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pte_val
(paren
op_star
id|pte
)paren
op_and_assign
id|mask
suffix:semicolon
id|pte_val
(paren
op_star
id|pte
)paren
op_or_assign
id|flags
suffix:semicolon
id|flush_tlb_page
c_func
(paren
id|find_vma
c_func
(paren
op_amp
id|init_mm
comma
id|address
)paren
comma
id|address
)paren
suffix:semicolon
id|address
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
id|__apus
DECL|function|mm_ptov
r_int
r_int
id|mm_ptov
(paren
r_int
r_int
id|paddr
)paren
(brace
r_int
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|paddr
OL
l_int|16
op_star
l_int|1024
op_star
l_int|1024
)paren
id|ret
op_assign
id|ZTWO_VADDR
c_func
(paren
id|paddr
)paren
suffix:semicolon
r_else
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|kmap_chunk_count
suffix:semicolon
)paren
(brace
r_int
r_int
id|phys
op_assign
id|kmap_chunks
(braket
id|i
op_increment
)braket
suffix:semicolon
r_int
r_int
id|size
op_assign
id|kmap_chunks
(braket
id|i
op_increment
)braket
suffix:semicolon
r_int
r_int
id|virt
op_assign
id|kmap_chunks
(braket
id|i
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
id|paddr
op_ge
id|phys
op_logical_and
id|paddr
OL
(paren
id|phys
op_plus
id|size
)paren
)paren
(brace
id|ret
op_assign
id|virt
op_plus
id|paddr
op_minus
id|phys
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
)brace
id|ret
op_assign
(paren
r_int
r_int
)paren
id|__va
c_func
(paren
id|paddr
)paren
suffix:semicolon
)brace
m_exit
suffix:colon
macro_line|#ifdef DEBUGPV
id|printk
(paren
l_string|&quot;PTOV(%lx)=%lx&bslash;n&quot;
comma
id|paddr
comma
id|ret
)paren
suffix:semicolon
macro_line|#endif
r_return
id|ret
suffix:semicolon
)brace
id|__apus
DECL|function|mm_end_of_chunk
r_int
id|mm_end_of_chunk
(paren
r_int
r_int
id|addr
comma
r_int
id|len
)paren
(brace
r_if
c_cond
(paren
id|memory
(braket
l_int|0
)braket
dot
id|addr
op_plus
id|memory
(braket
l_int|0
)braket
dot
id|size
op_eq
id|addr
op_plus
id|len
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*********************************************************** CACHE */
DECL|macro|L1_CACHE_BYTES
mdefine_line|#define L1_CACHE_BYTES 32
DECL|macro|MAX_CACHE_SIZE
mdefine_line|#define MAX_CACHE_SIZE 8192
id|__apus
DECL|function|cache_push
r_void
id|cache_push
c_func
(paren
id|__u32
id|addr
comma
r_int
id|length
)paren
(brace
id|addr
op_assign
id|mm_ptov
c_func
(paren
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|MAX_CACHE_SIZE
OL
id|length
)paren
id|length
op_assign
id|MAX_CACHE_SIZE
suffix:semicolon
r_while
c_loop
(paren
id|length
OG
l_int|0
)paren
(brace
id|__asm
(paren
l_string|&quot;dcbf 0,%0&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
)paren
suffix:semicolon
id|addr
op_add_assign
id|L1_CACHE_BYTES
suffix:semicolon
id|length
op_sub_assign
id|L1_CACHE_BYTES
suffix:semicolon
)brace
multiline_comment|/* Also flush trailing block */
id|__asm
(paren
l_string|&quot;dcbf 0,%0&bslash;n&bslash;t&quot;
l_string|&quot;sync &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
)paren
suffix:semicolon
)brace
id|__apus
DECL|function|cache_clear
r_void
id|cache_clear
c_func
(paren
id|__u32
id|addr
comma
r_int
id|length
)paren
(brace
r_if
c_cond
(paren
id|MAX_CACHE_SIZE
OL
id|length
)paren
id|length
op_assign
id|MAX_CACHE_SIZE
suffix:semicolon
id|addr
op_assign
id|mm_ptov
c_func
(paren
id|addr
)paren
suffix:semicolon
id|__asm
(paren
l_string|&quot;dcbf 0,%0&bslash;n&bslash;t&quot;
l_string|&quot;sync &bslash;n&bslash;t&quot;
l_string|&quot;icbi 0,%0 &bslash;n&bslash;t&quot;
l_string|&quot;isync &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
)paren
suffix:semicolon
id|addr
op_add_assign
id|L1_CACHE_BYTES
suffix:semicolon
id|length
op_sub_assign
id|L1_CACHE_BYTES
suffix:semicolon
r_while
c_loop
(paren
id|length
OG
l_int|0
)paren
(brace
id|__asm
(paren
l_string|&quot;dcbf 0,%0&bslash;n&bslash;t&quot;
l_string|&quot;sync &bslash;n&bslash;t&quot;
l_string|&quot;icbi 0,%0 &bslash;n&bslash;t&quot;
l_string|&quot;isync &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
)paren
suffix:semicolon
id|addr
op_add_assign
id|L1_CACHE_BYTES
suffix:semicolon
id|length
op_sub_assign
id|L1_CACHE_BYTES
suffix:semicolon
)brace
id|__asm
(paren
l_string|&quot;dcbf 0,%0&bslash;n&bslash;t&quot;
l_string|&quot;sync &bslash;n&bslash;t&quot;
l_string|&quot;icbi 0,%0 &bslash;n&bslash;t&quot;
l_string|&quot;isync &bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************** from setup.c */
r_void
DECL|function|apus_restart
id|apus_restart
c_func
(paren
r_char
op_star
id|cmd
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_REG_LOCK
comma
id|REGLOCK_BLACKMAGICK1
op_or
id|REGLOCK_BLACKMAGICK2
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_REG_LOCK
comma
id|REGLOCK_BLACKMAGICK1
op_or
id|REGLOCK_BLACKMAGICK3
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_REG_LOCK
comma
id|REGLOCK_BLACKMAGICK2
op_or
id|REGLOCK_BLACKMAGICK3
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_REG_SHADOW
comma
id|REGSHADOW_SELFRESET
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_REG_RESET
comma
id|REGRESET_AMIGARESET
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
suffix:semicolon
)brace
)brace
r_void
DECL|function|apus_power_off
id|apus_power_off
c_func
(paren
r_void
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
suffix:semicolon
)brace
r_void
DECL|function|apus_halt
id|apus_halt
c_func
(paren
r_void
)paren
(brace
id|apus_restart
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************** from setup.c/IDE */
macro_line|#if defined(CONFIG_BLK_DEV_IDE) || defined(CONFIG_BLK_DEV_IDE_MODULE)
multiline_comment|/*&n; * IDE stuff.&n; */
r_void
id|ide_insw
c_func
(paren
id|ide_ioreg_t
id|port
comma
r_void
op_star
id|buf
comma
r_int
id|ns
)paren
suffix:semicolon
r_void
id|ide_outsw
c_func
(paren
id|ide_ioreg_t
id|port
comma
r_void
op_star
id|buf
comma
r_int
id|ns
)paren
suffix:semicolon
r_void
DECL|function|apus_ide_insw
id|apus_ide_insw
c_func
(paren
id|ide_ioreg_t
id|port
comma
r_void
op_star
id|buf
comma
r_int
id|ns
)paren
(brace
id|ide_insw
c_func
(paren
id|port
comma
id|buf
comma
id|ns
)paren
suffix:semicolon
)brace
r_void
DECL|function|apus_ide_outsw
id|apus_ide_outsw
c_func
(paren
id|ide_ioreg_t
id|port
comma
r_void
op_star
id|buf
comma
r_int
id|ns
)paren
(brace
id|ide_outsw
c_func
(paren
id|port
comma
id|buf
comma
id|ns
)paren
suffix:semicolon
)brace
r_int
DECL|function|apus_ide_default_irq
id|apus_ide_default_irq
c_func
(paren
id|ide_ioreg_t
id|base
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|ide_ioreg_t
DECL|function|apus_ide_default_io_base
id|apus_ide_default_io_base
c_func
(paren
r_int
id|index
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|apus_ide_check_region
id|apus_ide_check_region
c_func
(paren
id|ide_ioreg_t
id|from
comma
r_int
r_int
id|extent
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|apus_ide_request_region
id|apus_ide_request_region
c_func
(paren
id|ide_ioreg_t
id|from
comma
r_int
r_int
id|extent
comma
r_const
r_char
op_star
id|name
)paren
(brace
)brace
r_void
DECL|function|apus_ide_release_region
id|apus_ide_release_region
c_func
(paren
id|ide_ioreg_t
id|from
comma
r_int
r_int
id|extent
)paren
(brace
)brace
r_void
DECL|function|apus_ide_fix_driveid
id|apus_ide_fix_driveid
c_func
(paren
r_struct
id|hd_driveid
op_star
id|id
)paren
(brace
id|u_char
op_star
id|p
op_assign
(paren
id|u_char
op_star
)paren
id|id
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|cnt
suffix:semicolon
id|u_char
id|t
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MACH_IS_AMIGA
op_logical_and
op_logical_neg
id|MACH_IS_MAC
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_driveid_types
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cnt
op_assign
id|driveid_types
(braket
id|i
)braket
op_amp
id|T_MASK_COUNT
suffix:semicolon
r_switch
c_cond
(paren
id|driveid_types
(braket
id|i
)braket
op_amp
id|T_MASK_TYPE
)paren
(brace
r_case
id|T_CHAR
suffix:colon
id|p
op_add_assign
id|cnt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|T_SHORT
suffix:colon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|cnt
suffix:semicolon
id|j
op_increment
)paren
(brace
id|t
op_assign
id|p
(braket
l_int|0
)braket
suffix:semicolon
id|p
(braket
l_int|0
)braket
op_assign
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
id|t
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|T_INT
suffix:colon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|cnt
suffix:semicolon
id|j
op_increment
)paren
(brace
id|t
op_assign
id|p
(braket
l_int|0
)braket
suffix:semicolon
id|p
(braket
l_int|0
)braket
op_assign
id|p
(braket
l_int|3
)braket
suffix:semicolon
id|p
(braket
l_int|3
)braket
op_assign
id|t
suffix:semicolon
id|t
op_assign
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
id|p
(braket
l_int|2
)braket
suffix:semicolon
id|p
(braket
l_int|2
)braket
op_assign
id|t
suffix:semicolon
id|p
op_add_assign
l_int|4
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|T_TEXT
suffix:colon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|cnt
suffix:semicolon
id|j
op_add_assign
l_int|2
)paren
(brace
id|t
op_assign
id|p
(braket
l_int|0
)braket
suffix:semicolon
id|p
(braket
l_int|0
)braket
op_assign
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
id|t
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
)brace
id|__init
DECL|function|apus_ide_init_hwif_ports
r_void
id|apus_ide_init_hwif_ports
(paren
id|hw_regs_t
op_star
id|hw
comma
id|ide_ioreg_t
id|data_port
comma
id|ide_ioreg_t
id|ctrl_port
comma
r_int
op_star
id|irq
)paren
(brace
r_if
c_cond
(paren
id|data_port
op_logical_or
id|ctrl_port
)paren
id|printk
c_func
(paren
l_string|&quot;apus_ide_init_hwif_ports: must not be called&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/****************************************************** IRQ stuff */
id|__apus
DECL|function|apus_irq_cannonicalize
r_static
r_int
r_int
id|apus_irq_cannonicalize
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_return
id|irq
suffix:semicolon
)brace
id|__apus
DECL|function|apus_get_irq_list
r_int
id|apus_get_irq_list
c_func
(paren
r_char
op_star
id|buf
)paren
(brace
macro_line|#ifdef CONFIG_APUS
r_extern
r_int
id|amiga_get_irq_list
c_func
(paren
r_char
op_star
id|buf
)paren
suffix:semicolon
r_return
id|amiga_get_irq_list
(paren
id|buf
)paren
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* IPL must be between 0 and 7 */
id|__apus
DECL|function|apus_set_IPL
r_static
r_inline
r_void
id|apus_set_IPL
c_func
(paren
r_int
r_int
id|ipl
)paren
(brace
id|APUS_WRITE
c_func
(paren
id|APUS_IPL_EMU
comma
id|IPLEMU_SETRESET
op_or
id|IPLEMU_DISABLEINT
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_IPL_EMU
comma
id|IPLEMU_IPLMASK
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_IPL_EMU
comma
id|IPLEMU_SETRESET
op_or
(paren
(paren
op_complement
id|ipl
)paren
op_amp
id|IPLEMU_IPLMASK
)paren
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_IPL_EMU
comma
id|IPLEMU_DISABLEINT
)paren
suffix:semicolon
)brace
id|__apus
DECL|function|apus_get_IPL
r_static
r_inline
r_int
r_int
id|apus_get_IPL
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* This returns the present IPL emulation level. */
r_int
r_int
id|__f
suffix:semicolon
id|APUS_READ
c_func
(paren
id|APUS_IPL_EMU
comma
id|__f
)paren
suffix:semicolon
r_return
(paren
(paren
op_complement
id|__f
)paren
op_amp
id|IPLEMU_IPLMASK
)paren
suffix:semicolon
)brace
id|__apus
DECL|function|apus_get_prev_IPL
r_static
r_inline
r_int
r_int
id|apus_get_prev_IPL
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
multiline_comment|/* The value saved in mq is the IPL_EMU value at the time of&n;&t;   interrupt. The lower bits are the current interrupt level,&n;&t;   the upper bits the requested level. Thus, to restore the&n;&t;   IPL level to the post-interrupt state, we will need to use&n;&t;   the lower bits. */
r_int
r_int
id|__f
op_assign
id|regs-&gt;mq
suffix:semicolon
r_return
(paren
(paren
op_complement
id|__f
)paren
op_amp
id|IPLEMU_IPLMASK
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_APUS
DECL|function|free_irq
r_void
id|free_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
op_star
id|dev_id
)paren
(brace
r_extern
r_void
id|amiga_free_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
op_star
id|dev_id
)paren
suffix:semicolon
id|amiga_free_irq
(paren
id|irq
comma
id|dev_id
)paren
suffix:semicolon
)brace
DECL|function|request_irq
r_int
id|request_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|irqflags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
(brace
r_extern
r_int
id|amiga_request_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|flags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
suffix:semicolon
r_return
id|amiga_request_irq
(paren
id|irq
comma
id|handler
comma
id|irqflags
comma
id|devname
comma
id|dev_id
)paren
suffix:semicolon
)brace
multiline_comment|/* In Linux/m68k the sys_request_irq deals with vectors 0-7. That&squot;s what&n;   callers expect - but on Linux/APUS we actually use the IRQ_AMIGA_AUTO&n;   vectors (24-31), so we put this dummy function in between to adjust&n;   the vector argument (rather have cruft here than in the generic irq.c). */
DECL|function|sys_request_irq
r_int
id|sys_request_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|irqflags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
(brace
r_extern
r_int
id|request_sysirq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|irqflags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
suffix:semicolon
r_return
id|request_sysirq
c_func
(paren
id|irq
op_plus
id|IRQ_AMIGA_AUTO
comma
id|handler
comma
id|irqflags
comma
id|devname
comma
id|dev_id
)paren
suffix:semicolon
)brace
macro_line|#endif
id|__apus
DECL|function|apus_get_irq
r_int
id|apus_get_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
macro_line|#ifdef CONFIG_APUS
r_int
id|level
op_assign
id|apus_get_IPL
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef __INTERRUPT_DEBUG
id|printk
c_func
(paren
l_string|&quot;&lt;%d:%d&gt;&quot;
comma
id|level
comma
id|apus_get_prev_IPL
c_func
(paren
id|regs
)paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
l_int|0
op_eq
id|level
)paren
r_return
op_minus
l_int|8
suffix:semicolon
r_if
c_cond
(paren
l_int|7
op_eq
id|level
)paren
r_return
op_minus
l_int|9
suffix:semicolon
r_return
id|level
op_plus
id|IRQ_AMIGA_AUTO
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
id|__apus
DECL|function|apus_post_irq
r_void
id|apus_post_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|level
)paren
(brace
macro_line|#ifdef __INTERRUPT_DEBUG
id|printk
c_func
(paren
l_string|&quot;{%d}&quot;
comma
id|apus_get_prev_IPL
c_func
(paren
id|regs
)paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Restore IPL to the previous value */
id|apus_set_IPL
c_func
(paren
id|apus_get_prev_IPL
c_func
(paren
id|regs
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************** keyboard */
id|__apus
DECL|function|apus_kbd_setkeycode
r_static
r_int
id|apus_kbd_setkeycode
c_func
(paren
r_int
r_int
id|scancode
comma
r_int
r_int
id|keycode
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|__apus
DECL|function|apus_kbd_getkeycode
r_static
r_int
id|apus_kbd_getkeycode
c_func
(paren
r_int
r_int
id|scancode
)paren
(brace
r_return
id|scancode
OG
l_int|127
ques
c_cond
op_minus
id|EINVAL
suffix:colon
id|scancode
suffix:semicolon
)brace
id|__apus
DECL|function|apus_kbd_translate
r_static
r_int
id|apus_kbd_translate
c_func
(paren
r_int
r_char
id|keycode
comma
r_int
r_char
op_star
id|keycodep
comma
r_char
id|raw_mode
)paren
(brace
op_star
id|keycodep
op_assign
id|keycode
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__apus
DECL|function|apus_kbd_unexpected_up
r_static
r_char
id|apus_kbd_unexpected_up
c_func
(paren
r_int
r_char
id|keycode
)paren
(brace
r_return
l_int|0200
suffix:semicolon
)brace
id|__apus
DECL|function|apus_kbd_leds
r_static
r_void
id|apus_kbd_leds
c_func
(paren
r_int
r_char
id|leds
)paren
(brace
)brace
id|__apus
DECL|function|apus_kbd_init_hw
r_static
r_void
id|apus_kbd_init_hw
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_APUS
r_extern
r_int
id|amiga_keyb_init
c_func
(paren
r_void
)paren
suffix:semicolon
id|amiga_keyb_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/****************************************************** debugging */
multiline_comment|/* some serial hardware definitions */
DECL|macro|SDR_OVRUN
mdefine_line|#define SDR_OVRUN   (1&lt;&lt;15)
DECL|macro|SDR_RBF
mdefine_line|#define SDR_RBF     (1&lt;&lt;14)
DECL|macro|SDR_TBE
mdefine_line|#define SDR_TBE     (1&lt;&lt;13)
DECL|macro|SDR_TSRE
mdefine_line|#define SDR_TSRE    (1&lt;&lt;12)
DECL|macro|AC_SETCLR
mdefine_line|#define AC_SETCLR   (1&lt;&lt;15)
DECL|macro|AC_UARTBRK
mdefine_line|#define AC_UARTBRK  (1&lt;&lt;11)
DECL|macro|SER_DTR
mdefine_line|#define SER_DTR     (1&lt;&lt;7)
DECL|macro|SER_RTS
mdefine_line|#define SER_RTS     (1&lt;&lt;6)
DECL|macro|SER_DCD
mdefine_line|#define SER_DCD     (1&lt;&lt;5)
DECL|macro|SER_CTS
mdefine_line|#define SER_CTS     (1&lt;&lt;4)
DECL|macro|SER_DSR
mdefine_line|#define SER_DSR     (1&lt;&lt;3)
DECL|function|ser_RTSon
r_static
id|__inline__
r_void
id|ser_RTSon
c_func
(paren
r_void
)paren
(brace
id|ciab.pra
op_and_assign
op_complement
id|SER_RTS
suffix:semicolon
multiline_comment|/* active low */
)brace
id|__apus
DECL|function|__debug_ser_out
r_int
id|__debug_ser_out
c_func
(paren
r_int
r_char
id|c
)paren
(brace
id|custom.serdat
op_assign
id|c
op_or
l_int|0x100
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|custom.serdatr
op_amp
l_int|0x2000
)paren
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__apus
DECL|function|__debug_ser_in
r_int
r_char
id|__debug_ser_in
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|c
suffix:semicolon
multiline_comment|/* XXX: is that ok?? derived from amiga_ser.c... */
r_while
c_loop
(paren
op_logical_neg
(paren
id|custom.intreqr
op_amp
id|IF_RBF
)paren
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
)brace
id|c
op_assign
id|custom.serdatr
suffix:semicolon
multiline_comment|/* clear the interrupt, so that another character can be read */
id|custom.intreq
op_assign
id|IF_RBF
suffix:semicolon
r_return
id|c
suffix:semicolon
)brace
id|__apus
DECL|function|__debug_serinit
r_int
id|__debug_serinit
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* turn off Rx and Tx interrupts */
id|custom.intena
op_assign
id|IF_RBF
op_or
id|IF_TBE
suffix:semicolon
multiline_comment|/* clear any pending interrupt */
id|custom.intreq
op_assign
id|IF_RBF
op_or
id|IF_TBE
suffix:semicolon
id|restore_flags
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * set the appropriate directions for the modem control flags,&n;&t; * and clear RTS and DTR&n;&t; */
id|ciab.ddra
op_or_assign
(paren
id|SER_DTR
op_or
id|SER_RTS
)paren
suffix:semicolon
multiline_comment|/* outputs */
id|ciab.ddra
op_and_assign
op_complement
(paren
id|SER_DCD
op_or
id|SER_CTS
op_or
id|SER_DSR
)paren
suffix:semicolon
multiline_comment|/* inputs */
macro_line|#ifdef CONFIG_KGDB
multiline_comment|/* turn Rx interrupts on for GDB */
id|custom.intena
op_assign
id|IF_SETCLR
op_or
id|IF_RBF
suffix:semicolon
id|ser_RTSon
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
id|__apus
DECL|function|__debug_print_hex
r_void
id|__debug_print_hex
c_func
(paren
r_int
r_int
id|x
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
id|hexchars
(braket
)braket
op_assign
l_string|&quot;0123456789ABCDEF&quot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|__debug_ser_out
c_func
(paren
id|hexchars
(braket
(paren
id|x
op_rshift
l_int|28
)paren
op_amp
l_int|15
)braket
)paren
suffix:semicolon
id|x
op_lshift_assign
l_int|4
suffix:semicolon
)brace
id|__debug_ser_out
c_func
(paren
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|__debug_ser_out
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
)brace
id|__apus
DECL|function|__debug_print_string
r_void
id|__debug_print_string
c_func
(paren
r_char
op_star
id|s
)paren
(brace
r_int
r_char
id|c
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
op_assign
op_star
id|s
op_increment
)paren
)paren
(brace
id|__debug_ser_out
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
id|__debug_ser_out
c_func
(paren
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|__debug_ser_out
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
)brace
id|__apus
DECL|function|apus_progress
r_static
r_void
id|apus_progress
c_func
(paren
r_char
op_star
id|s
comma
r_int
r_int
id|value
)paren
(brace
id|__debug_print_string
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************** init */
multiline_comment|/* The number of spurious interrupts */
DECL|variable|num_spurious
r_volatile
r_int
r_int
id|num_spurious
suffix:semicolon
DECL|macro|NUM_IRQ_NODES
mdefine_line|#define NUM_IRQ_NODES 100
DECL|variable|nodes
r_static
id|irq_node_t
id|nodes
(braket
id|NUM_IRQ_NODES
)braket
suffix:semicolon
r_extern
r_void
(paren
op_star
id|amiga_default_handler
(braket
id|AUTO_IRQS
)braket
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
DECL|variable|default_names
r_static
r_const
r_char
op_star
id|default_names
(braket
id|SYS_IRQS
)braket
op_assign
(brace
l_string|&quot;spurious int&quot;
comma
l_string|&quot;int1 handler&quot;
comma
l_string|&quot;int2 handler&quot;
comma
l_string|&quot;int3 handler&quot;
comma
l_string|&quot;int4 handler&quot;
comma
l_string|&quot;int5 handler&quot;
comma
l_string|&quot;int6 handler&quot;
comma
l_string|&quot;int7 handler&quot;
)brace
suffix:semicolon
DECL|function|new_irq_node
id|irq_node_t
op_star
id|new_irq_node
c_func
(paren
r_void
)paren
(brace
id|irq_node_t
op_star
id|node
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|node
op_assign
id|nodes
comma
id|i
op_assign
id|NUM_IRQ_NODES
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|node
op_increment
comma
id|i
op_decrement
)paren
r_if
c_cond
(paren
op_logical_neg
id|node-&gt;handler
)paren
r_return
id|node
suffix:semicolon
id|printk
(paren
l_string|&quot;new_irq_node: out of nodes&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_extern
r_void
id|amiga_enable_irq
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_extern
r_void
id|amiga_disable_irq
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
DECL|variable|amiga_irqctrl
r_struct
id|hw_interrupt_type
id|amiga_irqctrl
op_assign
(brace
l_string|&quot; Amiga  &quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|amiga_enable_irq
comma
id|amiga_disable_irq
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|__init
DECL|function|apus_init_IRQ
r_void
id|apus_init_IRQ
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IRQS
suffix:semicolon
id|i
op_increment
)paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
op_amp
id|amiga_irqctrl
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_IRQ_NODES
suffix:semicolon
id|i
op_increment
)paren
id|nodes
(braket
id|i
)braket
dot
id|handler
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|AUTO_IRQS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|amiga_default_handler
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
id|sys_request_irq
c_func
(paren
id|i
comma
id|amiga_default_handler
(braket
id|i
)braket
comma
l_int|0
comma
id|default_names
(braket
id|i
)braket
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|amiga_init_IRQ
c_func
(paren
)paren
suffix:semicolon
id|int_control.int_sti
op_assign
id|__no_use_sti
suffix:semicolon
id|int_control.int_cli
op_assign
id|__no_use_cli
suffix:semicolon
id|int_control.int_save_flags
op_assign
id|__no_use_save_flags
suffix:semicolon
id|int_control.int_restore_flags
op_assign
id|__no_use_restore_flags
suffix:semicolon
)brace
id|__init
DECL|function|apus_init
r_void
id|apus_init
c_func
(paren
r_int
r_int
id|r3
comma
r_int
r_int
id|r4
comma
r_int
r_int
id|r5
comma
r_int
r_int
id|r6
comma
r_int
r_int
id|r7
)paren
(brace
r_extern
r_int
id|parse_bootinfo
c_func
(paren
r_const
r_struct
id|bi_record
op_star
)paren
suffix:semicolon
r_extern
r_char
id|_end
(braket
)braket
suffix:semicolon
multiline_comment|/* Parse bootinfo. The bootinfo is located right after&n;           the kernel bss */
id|parse_bootinfo
c_func
(paren
(paren
r_const
r_struct
id|bi_record
op_star
)paren
op_amp
id|_end
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
multiline_comment|/* Take care of initrd if we have one. Use data from&n;&t;   bootinfo to avoid the need to initialize PPC&n;&t;   registers when kernel is booted via a PPC reset. */
r_if
c_cond
(paren
id|ramdisk.addr
)paren
(brace
id|initrd_start
op_assign
(paren
r_int
r_int
)paren
id|__va
c_func
(paren
id|ramdisk.addr
)paren
suffix:semicolon
id|initrd_end
op_assign
(paren
r_int
r_int
)paren
id|__va
c_func
(paren
id|ramdisk.size
op_plus
id|ramdisk.addr
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_BLK_DEV_INITRD */
id|ISA_DMA_THRESHOLD
op_assign
l_int|0x00ffffff
suffix:semicolon
id|ppc_md.setup_arch
op_assign
id|apus_setup_arch
suffix:semicolon
id|ppc_md.setup_residual
op_assign
l_int|NULL
suffix:semicolon
id|ppc_md.get_cpuinfo
op_assign
id|apus_get_cpuinfo
suffix:semicolon
id|ppc_md.irq_cannonicalize
op_assign
id|apus_irq_cannonicalize
suffix:semicolon
id|ppc_md.init_IRQ
op_assign
id|apus_init_IRQ
suffix:semicolon
id|ppc_md.get_irq
op_assign
id|apus_get_irq
suffix:semicolon
id|ppc_md.post_irq
op_assign
id|apus_post_irq
suffix:semicolon
macro_line|#ifdef CONFIG_HEARTBEAT
id|ppc_md.heartbeat
op_assign
id|apus_heartbeat
suffix:semicolon
id|ppc_md.heartbeat_count
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
macro_line|#ifdef APUS_DEBUG
id|__debug_serinit
c_func
(paren
)paren
suffix:semicolon
id|ppc_md.progress
op_assign
id|apus_progress
suffix:semicolon
macro_line|#endif
id|ppc_md.init
op_assign
l_int|NULL
suffix:semicolon
id|ppc_md.restart
op_assign
id|apus_restart
suffix:semicolon
id|ppc_md.power_off
op_assign
id|apus_power_off
suffix:semicolon
id|ppc_md.halt
op_assign
id|apus_halt
suffix:semicolon
id|ppc_md.time_init
op_assign
l_int|NULL
suffix:semicolon
id|ppc_md.set_rtc_time
op_assign
id|apus_set_rtc_time
suffix:semicolon
id|ppc_md.get_rtc_time
op_assign
id|apus_get_rtc_time
suffix:semicolon
id|ppc_md.calibrate_decr
op_assign
id|apus_calibrate_decr
suffix:semicolon
id|ppc_md.nvram_read_val
op_assign
l_int|NULL
suffix:semicolon
id|ppc_md.nvram_write_val
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* These should not be used for the APUS yet, since it uses&n;&t;   the M68K keyboard now. */
id|ppc_md.kbd_setkeycode
op_assign
id|apus_kbd_setkeycode
suffix:semicolon
id|ppc_md.kbd_getkeycode
op_assign
id|apus_kbd_getkeycode
suffix:semicolon
id|ppc_md.kbd_translate
op_assign
id|apus_kbd_translate
suffix:semicolon
id|ppc_md.kbd_unexpected_up
op_assign
id|apus_kbd_unexpected_up
suffix:semicolon
id|ppc_md.kbd_leds
op_assign
id|apus_kbd_leds
suffix:semicolon
id|ppc_md.kbd_init_hw
op_assign
id|apus_kbd_init_hw
suffix:semicolon
macro_line|#ifdef CONFIG_MAGIC_SYSRQ
id|ppc_md.kbd_sysrq_xlate
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_BLK_DEV_IDE) || defined(CONFIG_BLK_DEV_IDE_MODULE)
id|ppc_ide_md.insw
op_assign
id|apus_ide_insw
suffix:semicolon
id|ppc_ide_md.outsw
op_assign
id|apus_ide_outsw
suffix:semicolon
id|ppc_ide_md.default_irq
op_assign
id|apus_ide_default_irq
suffix:semicolon
id|ppc_ide_md.default_io_base
op_assign
id|apus_ide_default_io_base
suffix:semicolon
id|ppc_ide_md.ide_check_region
op_assign
id|apus_ide_check_region
suffix:semicolon
id|ppc_ide_md.ide_request_region
op_assign
id|apus_ide_request_region
suffix:semicolon
id|ppc_ide_md.ide_release_region
op_assign
id|apus_ide_release_region
suffix:semicolon
id|ppc_ide_md.fix_driveid
op_assign
id|apus_ide_fix_driveid
suffix:semicolon
id|ppc_ide_md.ide_init_hwif
op_assign
id|apus_ide_init_hwif_ports
suffix:semicolon
id|ppc_ide_md.io_base
op_assign
id|_IO_BASE
suffix:semicolon
macro_line|#endif&t;&t;
)brace
multiline_comment|/*************************************************** coexistence */
DECL|function|adbdev_init
r_void
id|__init
id|adbdev_init
c_func
(paren
r_void
)paren
(brace
)brace
eof
