multiline_comment|/*&n; * I/O &squot;port&squot; access routines&n; */
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|inb_asm
mdefine_line|#define inb_asm(port) {( &bslash;&n;  unsigned char ret; &bslash;&n;  asm ( &quot;lbz %0,0(%1)&bslash;nnop&bslash;nnop&bslash;nnop&bslash;nnop&bslash;nnop&bslash;nnop&bslash;nnop&bslash;nnop&bslash;n&quot; : &quot;=r&quot; (ret) : &quot;r&quot; (port+_IO_BASE)); &bslash;&n;  return ret; &bslash;&n;})
r_inline
r_int
r_char
DECL|function|inb
id|inb
c_func
(paren
r_int
id|port
)paren
(brace
r_int
r_char
id|ret
suffix:semicolon
id|asm
c_func
(paren
l_string|&quot;/*inb*/&bslash;n&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;lbz %0,0(%1)&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|ret
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|port
op_plus
id|_IO_BASE
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_inline
r_int
r_int
DECL|function|inw
id|inw
c_func
(paren
r_int
id|port
)paren
(brace
r_int
r_int
id|ret
suffix:semicolon
id|asm
c_func
(paren
l_string|&quot;/*inw*/&bslash;n&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;lhbrx %0,%1,%2&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|ret
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
l_string|&quot;r&quot;
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_inline
r_int
r_int
DECL|function|inl
id|inl
c_func
(paren
r_int
id|port
)paren
(brace
r_int
r_int
id|ret
suffix:semicolon
id|asm
c_func
(paren
l_string|&quot;/*inl*/&bslash;n&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;lwbrx %0,%1,%2&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|ret
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
l_string|&quot;r&quot;
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_inline
r_int
r_char
DECL|function|outb
id|outb
c_func
(paren
r_int
r_char
id|val
comma
r_int
id|port
)paren
(brace
id|asm
c_func
(paren
l_string|&quot;/*outb*/&bslash;n&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;stb %0,0(%1)&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|val
)paren
comma
l_string|&quot;r&quot;
(paren
id|port
op_plus
id|_IO_BASE
)paren
)paren
suffix:semicolon
r_return
(paren
id|val
)paren
suffix:semicolon
)brace
r_inline
r_int
r_int
DECL|function|outw
id|outw
c_func
(paren
r_int
r_int
id|val
comma
r_int
id|port
)paren
(brace
id|asm
c_func
(paren
l_string|&quot;/*outw*/&bslash;n&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;sthbrx %0,%1,%2&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|val
)paren
comma
l_string|&quot;r&quot;
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
l_string|&quot;r&quot;
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
(paren
id|val
)paren
suffix:semicolon
)brace
r_inline
r_int
r_int
DECL|function|outl
id|outl
c_func
(paren
r_int
r_int
id|val
comma
r_int
id|port
)paren
(brace
id|asm
c_func
(paren
l_string|&quot;/*outl*/&bslash;n&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;stwbrx %0,%1,%2&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|val
)paren
comma
l_string|&quot;r&quot;
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
l_string|&quot;r&quot;
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
(paren
id|val
)paren
suffix:semicolon
)brace
DECL|function|insb
r_void
id|insb
c_func
(paren
r_int
id|port
comma
r_char
op_star
id|ptr
comma
r_int
id|len
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|ptr
comma
(paren
r_void
op_star
)paren
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|insw
r_void
id|insw
c_func
(paren
r_int
id|port
comma
r_int
op_star
id|ptr
comma
r_int
id|len
)paren
(brace
id|asm
(paren
l_string|&quot;mtctr&t;%2 &bslash;n&bslash;t&quot;
l_string|&quot;subi&t;%1,%1,2 &bslash;n&bslash;t&quot;
l_string|&quot;00:&bslash;n&bslash;t&quot;
l_string|&quot;lhbrx&t;%2,0,%0 &bslash;n&bslash;t&quot;
l_string|&quot;sthu&t;%2,2(%1) &bslash;n&bslash;t&quot;
l_string|&quot;bdnz 00b &bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
l_string|&quot;r&quot;
(paren
id|ptr
)paren
comma
l_string|&quot;r&quot;
(paren
id|len
)paren
)paren
suffix:semicolon
)brace
DECL|function|insw_unswapped
r_void
id|insw_unswapped
c_func
(paren
r_int
id|port
comma
r_int
op_star
id|ptr
comma
r_int
id|len
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|ptr
comma
(paren
r_void
op_star
)paren
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
(paren
id|len
op_star
r_sizeof
(paren
r_int
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|insl
r_void
id|insl
c_func
(paren
r_int
id|port
comma
r_int
op_star
id|ptr
comma
r_int
id|len
)paren
(brace
id|asm
(paren
l_string|&quot;mtctr&t;%2 &bslash;n&bslash;t&quot;
l_string|&quot;subi&t;%1,%1,4 &bslash;n&bslash;t&quot;
l_string|&quot;00:&bslash;n&bslash;t&quot;
l_string|&quot;lhbrx&t;%2,0,%0 &bslash;n&bslash;t&quot;
l_string|&quot;sthu&t;%2,4(%1) &bslash;n&bslash;t&quot;
l_string|&quot;bdnz 00b &bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
l_string|&quot;r&quot;
(paren
id|ptr
)paren
comma
l_string|&quot;r&quot;
(paren
id|len
)paren
)paren
suffix:semicolon
)brace
DECL|function|outsb
r_void
id|outsb
c_func
(paren
r_int
id|port
comma
r_char
op_star
id|ptr
comma
r_int
id|len
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|ptr
comma
(paren
r_void
op_star
)paren
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|outsw
r_void
id|outsw
c_func
(paren
r_int
id|port
comma
r_int
op_star
id|ptr
comma
r_int
id|len
)paren
(brace
id|asm
(paren
l_string|&quot;mtctr&t;%2&bslash;n&bslash;t&quot;
l_string|&quot;subi&t;%1,%1,2&bslash;n&bslash;t&quot;
l_string|&quot;00:lhzu&t;%2,2(%1)&bslash;n&bslash;t&quot;
l_string|&quot;sthbrx&t;%2,0,%0&bslash;n&bslash;t&quot;
l_string|&quot;bdnz&t;00b&bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
l_string|&quot;r&quot;
(paren
id|ptr
)paren
comma
l_string|&quot;r&quot;
(paren
id|len
)paren
)paren
suffix:semicolon
)brace
DECL|function|outsw_unswapped
r_void
id|outsw_unswapped
c_func
(paren
r_int
id|port
comma
r_int
op_star
id|ptr
comma
r_int
id|len
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|ptr
comma
(paren
r_void
op_star
)paren
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
id|len
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
)brace
DECL|function|outsl
r_void
id|outsl
c_func
(paren
r_int
id|port
comma
r_int
op_star
id|ptr
comma
r_int
id|len
)paren
(brace
id|asm
(paren
l_string|&quot;mtctr&t;%2&bslash;n&bslash;t&quot;
l_string|&quot;subi&t;%1,%1,4&bslash;n&bslash;t&quot;
l_string|&quot;00:lwzu&t;%2,4(%1)&bslash;n&bslash;t&quot;
l_string|&quot;sthbrx&t;%2,0,%0&bslash;n&bslash;t&quot;
l_string|&quot;bdnz&t;00b&bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|port
op_plus
id|_IO_BASE
)paren
comma
l_string|&quot;r&quot;
(paren
id|ptr
)paren
comma
l_string|&quot;r&quot;
(paren
id|len
)paren
)paren
suffix:semicolon
)brace
DECL|function|insl_unswapped
r_void
id|insl_unswapped
c_func
(paren
r_int
id|port
comma
r_int
op_star
id|ptr
comma
r_int
id|len
)paren
(brace
r_int
r_int
op_star
id|io_ptr
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|_IO_BASE
op_plus
id|port
)paren
suffix:semicolon
multiline_comment|/* Ensure I/O operations complete */
id|__asm__
r_volatile
(paren
l_string|&quot;eieio&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
op_decrement
OG
l_int|0
)paren
(brace
op_star
id|ptr
op_increment
op_assign
(paren
op_star
id|io_ptr
)paren
suffix:semicolon
)brace
)brace
DECL|function|outsl_unswapped
r_void
id|outsl_unswapped
c_func
(paren
r_int
id|port
comma
r_int
op_star
id|ptr
comma
r_int
id|len
)paren
(brace
r_int
r_int
op_star
id|io_ptr
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|_IO_BASE
op_plus
id|port
)paren
suffix:semicolon
multiline_comment|/* Ensure I/O operations complete */
id|__asm__
r_volatile
(paren
l_string|&quot;eieio&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
op_decrement
OG
l_int|0
)paren
(brace
op_star
id|io_ptr
op_assign
(paren
op_star
id|ptr
op_increment
)paren
suffix:semicolon
)brace
)brace
eof
