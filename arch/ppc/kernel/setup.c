multiline_comment|/*&n; * $Id: setup.c,v 1.95 1998/07/20 19:03:47 geert Exp $&n; * Common prep/pmac/chrp boot and setup code.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/reboot.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &lt;asm/adb.h&gt;
macro_line|#include &lt;asm/cuda.h&gt;
macro_line|#include &lt;asm/pmu.h&gt;
macro_line|#include &lt;asm/residual.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/ide.h&gt;
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/amigappc.h&gt;
macro_line|#ifdef CONFIG_MBX
macro_line|#include &lt;asm/mbx.h&gt;
macro_line|#endif
multiline_comment|/* APUS defs */
r_extern
r_int
r_int
id|m68k_machtype
suffix:semicolon
r_extern
r_struct
id|mem_info
id|ramdisk
suffix:semicolon
r_extern
r_int
id|parse_bootinfo
c_func
(paren
r_const
r_struct
id|bi_record
op_star
)paren
suffix:semicolon
r_extern
r_char
id|_end
(braket
)braket
suffix:semicolon
multiline_comment|/* END APUS defs */
r_extern
r_char
id|cmd_line
(braket
l_int|512
)braket
suffix:semicolon
DECL|variable|saved_command_line
r_char
id|saved_command_line
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|aux_device_present
r_int
r_char
id|aux_device_present
suffix:semicolon
macro_line|#if !defined(CONFIG_MACH_SPECIFIC)
DECL|variable|ISA_DMA_THRESHOLD
r_int
r_int
id|ISA_DMA_THRESHOLD
suffix:semicolon
DECL|variable|DMA_MODE_READ
DECL|variable|DMA_MODE_WRITE
r_int
r_int
id|DMA_MODE_READ
comma
id|DMA_MODE_WRITE
suffix:semicolon
DECL|variable|_machine
r_int
id|_machine
suffix:semicolon
multiline_comment|/* if we have openfirmware */
DECL|variable|have_of
r_int
r_int
id|have_of
suffix:semicolon
macro_line|#endif /* ! CONFIG_MACH_SPECIFIC */
multiline_comment|/* copy of the residual data */
DECL|variable|__prepdata
r_int
r_char
id|__res
(braket
r_sizeof
(paren
id|RESIDUAL
)paren
)braket
id|__prepdata
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|res
id|RESIDUAL
op_star
id|res
op_assign
(paren
id|RESIDUAL
op_star
)paren
op_amp
id|__res
suffix:semicolon
DECL|variable|_prep_type
r_int
id|_prep_type
suffix:semicolon
multiline_comment|/*&n; * Perhaps we can put the pmac screen_info[] here&n; * on pmac as well so we don&squot;t need the ifdef&squot;s.&n; * Until we get multiple-console support in here&n; * that is.  -- Cort&n; */
macro_line|#ifndef CONFIG_MBX
DECL|variable|screen_info
r_struct
id|screen_info
id|screen_info
op_assign
(brace
l_int|0
comma
l_int|25
comma
multiline_comment|/* orig-x, orig-y */
l_int|0
comma
multiline_comment|/* unused */
l_int|0
comma
multiline_comment|/* orig-video-page */
l_int|0
comma
multiline_comment|/* orig-video-mode */
l_int|80
comma
multiline_comment|/* orig-video-cols */
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* ega_ax, ega_bx, ega_cx */
l_int|25
comma
multiline_comment|/* orig-video-lines */
l_int|1
comma
multiline_comment|/* orig-video-isVGA */
l_int|16
multiline_comment|/* orig-video-points */
)brace
suffix:semicolon
multiline_comment|/*&n; * I really need to add multiple-console support... -- Cort&n; */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|pmac_display_supported
c_func
(paren
r_char
op_star
id|name
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pmac_find_display
c_func
(paren
r_void
)paren
)paren
(brace
)brace
macro_line|#else /* CONFIG_MBX */
multiline_comment|/* We need this to satisfy some external references until we can&n; * strip the kernel down.&n; */
DECL|variable|screen_info
r_struct
id|screen_info
id|screen_info
op_assign
(brace
l_int|0
comma
l_int|25
comma
multiline_comment|/* orig-x, orig-y */
l_int|0
comma
multiline_comment|/* unused */
l_int|0
comma
multiline_comment|/* orig-video-page */
l_int|0
comma
multiline_comment|/* orig-video-mode */
l_int|80
comma
multiline_comment|/* orig-video-cols */
l_int|0
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* ega_ax, ega_bx, ega_cx */
l_int|25
comma
multiline_comment|/* orig-video-lines */
l_int|0
comma
multiline_comment|/* orig-video-isVGA */
l_int|16
multiline_comment|/* orig-video-points */
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_MBX */
multiline_comment|/* cmd is ignored for now... */
DECL|function|machine_restart
r_void
id|machine_restart
c_func
(paren
r_char
op_star
id|cmd
)paren
(brace
macro_line|#ifndef CONFIG_MBX
r_struct
id|adb_request
id|req
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|i
op_assign
l_int|10000
suffix:semicolon
macro_line|#if 0
r_int
id|err
suffix:semicolon
macro_line|#endif&t;
r_switch
c_cond
(paren
id|_machine
)paren
(brace
r_case
id|_MACH_Pmac
suffix:colon
r_switch
c_cond
(paren
id|adb_hardware
)paren
(brace
r_case
id|ADB_VIACUDA
suffix:colon
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|2
comma
id|CUDA_PACKET
comma
id|CUDA_RESET_SYSTEM
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ADB_VIAPMU
suffix:colon
id|pmu_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|1
comma
id|PMU_RESET
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
id|pmu_poll
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
)brace
r_break
suffix:semicolon
r_case
id|_MACH_chrp
suffix:colon
macro_line|#if 0&t;&t;/* RTAS doesn&squot;t seem to work on Longtrail.&n;&t;&t;   For now, do it the same way as the PReP. */
multiline_comment|/*err = call_rtas(&quot;system-reboot&quot;, 0, 1, NULL);&n;&t;&t;printk(&quot;RTAS system-reboot returned %d&bslash;n&quot;, err);&n;&t;&t;for (;;);*/
(brace
r_extern
r_int
r_int
id|rtas_entry
comma
id|rtas_data
comma
id|rtas_size
suffix:semicolon
r_int
r_int
id|status
comma
id|value
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;rtas_entry: %08x rtas_data: %08x rtas_size: %08x&bslash;n&quot;
comma
id|rtas_entry
comma
id|rtas_data
comma
id|rtas_size
)paren
suffix:semicolon
)brace
macro_line|#endif
r_case
id|_MACH_prep
suffix:colon
id|_disable_interrupts
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set exception prefix high - to the prom */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
op_or
id|MSR_IP
)paren
suffix:semicolon
multiline_comment|/* make sure bit 0 (reset) is a 0 */
id|outb
c_func
(paren
id|inb
c_func
(paren
l_int|0x92
)paren
op_amp
op_complement
l_int|1L
comma
l_int|0x92
)paren
suffix:semicolon
multiline_comment|/* signal a reset to system control port A - soft reset */
id|outb
c_func
(paren
id|inb
c_func
(paren
l_int|0x92
)paren
op_or
l_int|1
comma
l_int|0x92
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_ne
l_int|0
)paren
id|i
op_increment
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;restart failed&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_MACH_apus
suffix:colon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_REG_LOCK
comma
id|REGLOCK_BLACKMAGICK1
op_or
id|REGLOCK_BLACKMAGICK2
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_REG_LOCK
comma
id|REGLOCK_BLACKMAGICK1
op_or
id|REGLOCK_BLACKMAGICK3
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_REG_LOCK
comma
id|REGLOCK_BLACKMAGICK2
op_or
id|REGLOCK_BLACKMAGICK3
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_REG_SHADOW
comma
id|REGSHADOW_SELFRESET
)paren
suffix:semicolon
id|APUS_WRITE
c_func
(paren
id|APUS_REG_RESET
comma
id|REGRESET_AMIGARESET
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
macro_line|#else /* CONFIG_MBX */
r_extern
r_void
id|MBX_gorom
c_func
(paren
r_void
)paren
suffix:semicolon
id|MBX_gorom
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_MBX */
)brace
DECL|function|machine_power_off
r_void
id|machine_power_off
c_func
(paren
r_void
)paren
(brace
macro_line|#ifndef CONFIG_MBX&t;
r_struct
id|adb_request
id|req
suffix:semicolon
macro_line|#if 0&t;
r_int
id|err
suffix:semicolon
macro_line|#endif&t;
r_switch
c_cond
(paren
id|_machine
)paren
(brace
r_case
id|_MACH_Pmac
suffix:colon
r_switch
c_cond
(paren
id|adb_hardware
)paren
(brace
r_case
id|ADB_VIACUDA
suffix:colon
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|2
comma
id|CUDA_PACKET
comma
id|CUDA_POWERDOWN
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ADB_VIAPMU
suffix:colon
id|pmu_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|PMU_SHUTDOWN
comma
l_char|&squot;M&squot;
comma
l_char|&squot;A&squot;
comma
l_char|&squot;T&squot;
comma
l_char|&squot;T&squot;
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
id|pmu_poll
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
)brace
r_break
suffix:semicolon
r_case
id|_MACH_chrp
suffix:colon
macro_line|#if 0&t;&t;/* RTAS doesn&squot;t seem to work on Longtrail.&n;&t;&t;   For now, do it the same way as the PReP. */
id|err
op_assign
id|call_rtas
c_func
(paren
l_string|&quot;power-off&quot;
comma
l_int|2
comma
l_int|1
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;RTAS system-reboot returned %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
suffix:semicolon
macro_line|#endif
r_case
id|_MACH_prep
suffix:colon
id|machine_restart
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
r_case
id|_MACH_apus
suffix:colon
macro_line|#if defined(CONFIG_APM) &amp;&amp; defined(CONFIG_APM_POWER_OFF)
id|apm_set_power_state
c_func
(paren
id|APM_STATE_OFF
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
suffix:semicolon
macro_line|#endif
)brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
suffix:semicolon
macro_line|#else /* CONFIG_MBX */
id|machine_restart
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_MBX */
)brace
DECL|function|machine_halt
r_void
id|machine_halt
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|_machine
op_eq
id|_MACH_Pmac
)paren
(brace
id|machine_power_off
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* prep, chrp or apus */
id|machine_restart
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BLK_DEV_IDE
DECL|function|ide_init_hwif_ports
r_void
id|ide_init_hwif_ports
(paren
id|ide_ioreg_t
op_star
id|p
comma
id|ide_ioreg_t
id|base
comma
r_int
op_star
id|irq
)paren
(brace
macro_line|#if !defined(CONFIG_MBX) &amp;&amp; !defined(CONFIG_APUS)
r_switch
c_cond
(paren
id|_machine
)paren
(brace
r_case
id|_MACH_Pmac
suffix:colon
id|pmac_ide_init_hwif_ports
c_func
(paren
id|p
comma
id|base
comma
id|irq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_MACH_chrp
suffix:colon
id|chrp_ide_init_hwif_ports
c_func
(paren
id|p
comma
id|base
comma
id|irq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_MACH_prep
suffix:colon
id|prep_ide_init_hwif_ports
c_func
(paren
id|p
comma
id|base
comma
id|irq
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
)brace
macro_line|#endif
DECL|function|cpu_temp
r_int
r_int
id|cpu_temp
c_func
(paren
r_void
)paren
(brace
macro_line|#if 0&t;
r_int
r_int
id|i
comma
id|temp
comma
id|thrm1
comma
id|dir
suffix:semicolon
r_int
id|sanity
suffix:semicolon
multiline_comment|/*&n;&t; * setup thrm3 - need to give TAU at least 20us&n;&t; * to do the compare so assume a 300MHz clock.&n;&t; * We need 300*20 ticks then.&n;&t; * -- Cort&n;&t; */
id|asm
c_func
(paren
l_string|&quot;mtspr 1020, %1&bslash;n&bslash;t&quot;
l_string|&quot;mtspr 1021, %1&bslash;n&bslash;t&quot;
l_string|&quot;mtspr 1022, %0&bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
(paren
(paren
l_int|300
op_star
l_int|20
)paren
op_lshift
l_int|18
)paren
op_or
id|THRM3_E
)paren
comma
l_string|&quot;r&quot;
(paren
l_int|0
)paren
)paren
suffix:semicolon
macro_line|#if 0
r_for
c_loop
(paren
id|i
op_assign
l_int|127
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|asm
c_func
(paren
l_string|&quot;mtspr 1020, %0&bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|THRM1_TID
op_or
id|THRM1_V
op_or
(paren
id|i
op_lshift
l_int|2
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* check value */
r_while
c_loop
(paren
op_logical_neg
(paren
id|thrm1
op_amp
id|THRM1_TIV
)paren
)paren
id|asm
c_func
(paren
l_string|&quot;mfspr %0, 1020 &bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|thrm1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|thrm1
op_amp
id|THRM1_TIN
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tin set: %x tiv %x&bslash;n&quot;
comma
id|thrm1
comma
id|thrm1
op_amp
id|THRM1_TIV
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#if 0
id|i
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* increment */
id|dir
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* direction we&squot;re checking 0=up 1=down */
id|temp
op_assign
l_int|64
suffix:semicolon
multiline_comment|/* threshold checking against */
r_while
c_loop
(paren
id|i
)paren
(brace
id|_set_THRM1
c_func
(paren
(paren
l_int|1
op_lshift
l_int|29
)paren
op_or
id|THRM1_V
op_or
(paren
id|temp
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;checking %d in dir %d thrm set to %x/%x&bslash;n&quot;
comma
id|temp
comma
id|dir
comma
(paren
(paren
l_int|1
op_lshift
l_int|29
)paren
op_or
id|THRM1_V
op_or
(paren
id|temp
op_lshift
l_int|2
)paren
)paren
comma
id|_get_THRM1
c_func
(paren
)paren
)paren
suffix:semicolon
multiline_comment|/* check value */
id|sanity
op_assign
l_int|0x0fffffff
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|thrm1
op_amp
id|THRM1_TIV
)paren
)paren
op_logical_and
(paren
id|sanity
op_decrement
)paren
)paren
id|thrm1
op_assign
id|_get_THRM1
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*asm(&quot;mfspr %0, 1020 &bslash;n&bslash;t&quot;: &quot;=r&quot; (thrm1) );*/
r_if
c_cond
(paren
op_logical_neg
id|sanity
op_logical_or
id|sanity
op_eq
l_int|0xffffffff
)paren
id|printk
c_func
(paren
l_string|&quot;no sanity&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* temp is not in that direction */
r_if
c_cond
(paren
op_logical_neg
(paren
id|thrm1
op_amp
id|THRM1_TIN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;not in that dir thrm1 %x&bslash;n&quot;
comma
id|thrm1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dir
op_eq
l_int|0
)paren
id|dir
op_assign
l_int|1
suffix:semicolon
r_else
id|dir
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dir
)paren
id|temp
op_sub_assign
id|i
suffix:semicolon
r_else
id|temp
op_add_assign
id|i
suffix:semicolon
id|i
op_div_assign
l_int|2
suffix:semicolon
)brace
id|asm
c_func
(paren
l_string|&quot;mtspr 1020, %0&bslash;n&bslash;t&quot;
l_string|&quot;mtspr 1022, %0&bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
l_int|0
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif&t;
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_cpuinfo
r_int
id|get_cpuinfo
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_extern
r_int
id|pmac_get_cpuinfo
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
id|chrp_get_cpuinfo
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
id|prep_get_cpuinfo
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
id|apus_get_cpuinfo
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
r_int
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|bogosum
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
r_int
id|cr
suffix:semicolon
macro_line|#ifdef __SMP__
r_extern
r_int
r_int
id|cpu_present_map
suffix:semicolon
r_extern
r_struct
id|cpuinfo_PPC
id|cpu_data
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|macro|GET_PVR
mdefine_line|#define GET_PVR ((long int)(cpu_data[i].pvr))
DECL|macro|CD
mdefine_line|#define CD(x) (cpu_data[i].x)
macro_line|#else
mdefine_line|#define cpu_present_map 1L
mdefine_line|#define smp_num_cpus 1
mdefine_line|#define GET_PVR ((long int)_get_PVR())
mdefine_line|#define CD(x) (x)
macro_line|#endif&t;
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|smp_num_cpus
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cpu_present_map
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;processor&bslash;t: %lu&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;cpu&bslash;t&bslash;t: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|GET_PVR
op_rshift
l_int|16
)paren
(brace
r_case
l_int|1
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;601&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;603&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;604&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;603e&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;603ev&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;750&bslash;n&quot;
)paren
suffix:semicolon
id|cr
op_assign
id|_get_L2CR
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cr
op_amp
(paren
l_int|0x1
op_lshift
l_int|28
)paren
)paren
id|cr
op_assign
l_int|256
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr
op_amp
(paren
l_int|0x2
op_lshift
l_int|28
)paren
)paren
id|cr
op_assign
l_int|512
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cr
op_amp
(paren
l_int|0x3
op_lshift
l_int|28
)paren
)paren
id|cr
op_assign
l_int|1024
suffix:semicolon
r_else
id|cr
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;on-chip l2&bslash;t: &quot;
l_string|&quot;%ld KB (%s)&bslash;n&quot;
comma
id|cr
comma
(paren
id|_get_L2CR
c_func
(paren
)paren
op_amp
l_int|0x80000000
)paren
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;temperature &bslash;t: %lu C&bslash;n&quot;
comma
id|cpu_temp
c_func
(paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;604e&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;604ev5 (MachV)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|50
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;821&bslash;n&quot;
)paren
suffix:semicolon
r_case
l_int|80
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;860&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;unknown (%lu)&bslash;n&quot;
comma
id|GET_PVR
op_rshift
l_int|16
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifndef CONFIG_MBX
multiline_comment|/*&n;&t;&t; * Assume here that all clock rates are the same in a&n;&t;&t; * smp system.  -- Cort&n;&t;&t; */
r_if
c_cond
(paren
id|have_of
)paren
(brace
r_struct
id|device_node
op_star
id|cpu_node
suffix:semicolon
r_int
op_star
id|fp
suffix:semicolon
id|cpu_node
op_assign
id|find_type_devices
c_func
(paren
l_string|&quot;cpu&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpu_node
)paren
r_break
suffix:semicolon
id|fp
op_assign
(paren
r_int
op_star
)paren
id|get_property
c_func
(paren
id|cpu_node
comma
l_string|&quot;clock-frequency&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fp
)paren
r_break
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;clock&bslash;t&bslash;t: %dMHz&bslash;n&quot;
comma
op_star
id|fp
op_div
l_int|1000000
)paren
suffix:semicolon
)brace
multiline_comment|/* PREP&squot;s without residual data for some reason will give&n;&t;&t;   incorrect values here */
r_if
c_cond
(paren
id|is_prep
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;clock&bslash;t&bslash;t: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res-&gt;ResidualLength
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;%ldMHz&bslash;n&quot;
comma
(paren
id|res-&gt;VitalProductData.ProcessorHz
OG
l_int|1024
)paren
ques
c_cond
id|res-&gt;VitalProductData.ProcessorHz
op_rshift
l_int|20
suffix:colon
id|res-&gt;VitalProductData.ProcessorHz
)paren
suffix:semicolon
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;???&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#else /* CONFIG_MBX */
(brace
id|bd_t
op_star
id|bp
suffix:semicolon
r_extern
id|RESIDUAL
id|res
suffix:semicolon
id|bp
op_assign
(paren
id|bd_t
op_star
)paren
op_amp
id|res
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;clock&bslash;t&bslash;t: %dMHz&bslash;n&quot;
l_string|&quot;bus clock&bslash;t: %dMHz&bslash;n&quot;
comma
id|bp-&gt;bi_intfreq
multiline_comment|/*/ 1000000*/
comma
id|bp-&gt;bi_busfreq
multiline_comment|/*/ 1000000*/
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_MBX */&t;&t;
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;revision&bslash;t: %ld.%ld&bslash;n&quot;
comma
(paren
id|GET_PVR
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
comma
id|GET_PVR
op_amp
l_int|0xff
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;bogomips&bslash;t: %lu.%02lu&bslash;n&quot;
comma
(paren
id|CD
c_func
(paren
id|loops_per_sec
)paren
op_plus
l_int|2500
)paren
op_div
l_int|500000
comma
(paren
id|CD
c_func
(paren
id|loops_per_sec
)paren
op_plus
l_int|2500
)paren
op_div
l_int|5000
op_mod
l_int|100
)paren
suffix:semicolon
id|bogosum
op_add_assign
id|CD
c_func
(paren
id|loops_per_sec
)paren
suffix:semicolon
)brace
macro_line|#ifdef __SMP__
r_if
c_cond
(paren
id|i
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;total bogomips&bslash;t: %lu.%02lu&bslash;n&quot;
comma
(paren
id|bogosum
op_plus
l_int|2500
)paren
op_div
l_int|500000
comma
(paren
id|bogosum
op_plus
l_int|2500
)paren
op_div
l_int|5000
op_mod
l_int|100
)paren
suffix:semicolon
macro_line|#endif /* __SMP__ */
multiline_comment|/*&n;&t; * Ooh&squot;s and aah&squot;s info about zero&squot;d pages in idle task&n;&t; */
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;zero pages&bslash;t: total %lu (%luKb) &quot;
l_string|&quot;current: %lu (%luKb) hits: %lu/%lu (%lu%%)&bslash;n&quot;
comma
id|quicklists.zerototal
comma
(paren
id|quicklists.zerototal
op_star
id|PAGE_SIZE
)paren
op_rshift
l_int|10
comma
id|quicklists.zero_sz
comma
(paren
id|quicklists.zero_sz
op_star
id|PAGE_SIZE
)paren
op_rshift
l_int|10
comma
id|quicklists.zeropage_hits
comma
id|quicklists.zeropage_calls
comma
multiline_comment|/* : 1 below is so we don&squot;t div by zero */
(paren
id|quicklists.zeropage_hits
op_star
l_int|100
)paren
op_div
(paren
(paren
id|quicklists.zeropage_calls
)paren
ques
c_cond
id|quicklists.zeropage_calls
suffix:colon
l_int|1
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifndef CONFIG_MBX
r_switch
c_cond
(paren
id|_machine
)paren
(brace
r_case
id|_MACH_Pmac
suffix:colon
id|len
op_add_assign
id|pmac_get_cpuinfo
c_func
(paren
id|buffer
op_plus
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_MACH_prep
suffix:colon
id|len
op_add_assign
id|prep_get_cpuinfo
c_func
(paren
id|buffer
op_plus
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_MACH_chrp
suffix:colon
id|len
op_add_assign
id|chrp_get_cpuinfo
c_func
(paren
id|buffer
op_plus
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_MACH_apus
suffix:colon
multiline_comment|/* Not much point in printing m68k info when it is not&n;                   used. */
r_break
suffix:semicolon
)brace
macro_line|#endif /* ndef CONFIG_MBX */&t;
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; * Find out what kind of machine we&squot;re on and save any data we need&n; * from the early boot process (devtree is copied on pmac by prom_init() )&n; */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
r_int
id|identify_machine
c_func
(paren
r_int
r_int
id|r3
comma
r_int
r_int
id|r4
comma
r_int
r_int
id|r5
comma
r_int
r_int
id|r6
comma
r_int
r_int
id|r7
)paren
)paren
(brace
r_extern
r_void
id|setup_pci_ptrs
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifndef CONFIG_MBX
macro_line|#ifndef CONFIG_MACH_SPECIFIC
r_char
op_star
id|model
suffix:semicolon
multiline_comment|/* prep boot loader tells us if we&squot;re prep or not */
r_if
c_cond
(paren
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|KERNELBASE
)paren
op_eq
(paren
l_int|0xdeadc0de
)paren
)paren
(brace
id|_machine
op_assign
id|_MACH_prep
suffix:semicolon
id|have_of
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* boot loader will tell us if we&squot;re APUS */
r_else
r_if
c_cond
(paren
id|r3
op_eq
l_int|0x61707573
)paren
(brace
id|_machine
op_assign
id|_MACH_apus
suffix:semicolon
id|have_of
op_assign
l_int|0
suffix:semicolon
id|r3
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|have_of
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* ask the OF info if we&squot;re a chrp or pmac */
id|model
op_assign
id|get_property
c_func
(paren
id|find_path_device
c_func
(paren
l_string|&quot;/&quot;
)paren
comma
l_string|&quot;type&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
l_string|&quot;chrp&quot;
comma
id|model
comma
l_int|4
)paren
)paren
id|_machine
op_assign
id|_MACH_chrp
suffix:semicolon
r_else
id|_machine
op_assign
id|_MACH_Pmac
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_MACH_SPECIFIC */&t;&t;
r_if
c_cond
(paren
id|have_of
)paren
(brace
multiline_comment|/* prom_init has already been called from __start */
id|finish_device_tree
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If we were booted via quik, r3 points to the physical&n;&t;&t; * address of the command-line parameters.&n;&t;&t; * If we were booted from an xcoff image (i.e. netbooted or&n;&t;&t; * booted from floppy), we get the command line from the&n;&t;&t; * bootargs property of the /chosen node.&n;&t;&t; * If an initial ramdisk is present, r3 and r4&n;&t;&t; * are used for initrd_start and initrd_size,&n;&t;&t; * otherwise they contain 0xdeadbeef.  &n;&t;&t; */
id|cmd_line
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|r3
op_ge
l_int|0x4000
op_logical_and
id|r3
OL
l_int|0x800000
op_logical_and
id|r4
op_eq
l_int|0
)paren
(brace
id|strncpy
c_func
(paren
id|cmd_line
comma
(paren
r_char
op_star
)paren
id|r3
op_plus
id|KERNELBASE
comma
r_sizeof
(paren
id|cmd_line
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|device_node
op_star
id|chosen
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
r_if
c_cond
(paren
id|r3
op_minus
id|KERNELBASE
OL
l_int|0x800000
op_logical_and
id|r4
op_ne
l_int|0
op_logical_and
id|r4
op_ne
l_int|0xdeadbeef
)paren
(brace
id|initrd_start
op_assign
id|r3
suffix:semicolon
id|initrd_end
op_assign
id|r3
op_plus
id|r4
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|RAMDISK_MAJOR
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
id|chosen
op_assign
id|find_devices
c_func
(paren
l_string|&quot;chosen&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chosen
op_ne
l_int|NULL
)paren
(brace
id|p
op_assign
id|get_property
c_func
(paren
id|chosen
comma
l_string|&quot;bootargs&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ne
l_int|NULL
)paren
id|strncpy
c_func
(paren
id|cmd_line
comma
id|p
comma
r_sizeof
(paren
id|cmd_line
)paren
)paren
suffix:semicolon
)brace
)brace
id|cmd_line
(braket
r_sizeof
(paren
id|cmd_line
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|_machine
)paren
(brace
r_case
id|_MACH_Pmac
suffix:colon
id|setup_pci_ptrs
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* isa_io_base gets set in pmac_find_bridges */
id|isa_mem_base
op_assign
id|PMAC_ISA_MEM_BASE
suffix:semicolon
id|pci_dram_offset
op_assign
id|PMAC_PCI_DRAM_OFFSET
suffix:semicolon
macro_line|#if !defined(CONFIG_MACH_SPECIFIC)
id|ISA_DMA_THRESHOLD
op_assign
op_complement
l_int|0L
suffix:semicolon
id|DMA_MODE_READ
op_assign
l_int|1
suffix:semicolon
id|DMA_MODE_WRITE
op_assign
l_int|2
suffix:semicolon
macro_line|#endif /* ! CONFIG_MACH_SPECIFIC */
r_break
suffix:semicolon
r_case
id|_MACH_prep
suffix:colon
multiline_comment|/* make a copy of residual data */
r_if
c_cond
(paren
id|r3
)paren
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|res
comma
(paren
r_void
op_star
)paren
(paren
id|r3
op_plus
id|KERNELBASE
)paren
comma
r_sizeof
(paren
id|RESIDUAL
)paren
)paren
suffix:semicolon
id|setup_pci_ptrs
c_func
(paren
)paren
suffix:semicolon
id|isa_io_base
op_assign
id|PREP_ISA_IO_BASE
suffix:semicolon
id|isa_mem_base
op_assign
id|PREP_ISA_MEM_BASE
suffix:semicolon
id|pci_dram_offset
op_assign
id|PREP_PCI_DRAM_OFFSET
suffix:semicolon
macro_line|#if !defined(CONFIG_MACH_SPECIFIC)
id|ISA_DMA_THRESHOLD
op_assign
l_int|0x00ffffff
suffix:semicolon
id|DMA_MODE_READ
op_assign
l_int|0x44
suffix:semicolon
id|DMA_MODE_WRITE
op_assign
l_int|0x48
suffix:semicolon
macro_line|#endif /* ! CONFIG_MACH_SPECIFIC */
multiline_comment|/* figure out what kind of prep workstation we are */
r_if
c_cond
(paren
id|res-&gt;ResidualLength
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|res-&gt;VitalProductData.PrintableModel
comma
l_string|&quot;IBM&quot;
comma
l_int|3
)paren
)paren
id|_prep_type
op_assign
id|_PREP_IBM
suffix:semicolon
r_else
id|_prep_type
op_assign
id|_PREP_Motorola
suffix:semicolon
)brace
r_else
multiline_comment|/* assume motorola if no residual (netboot?) */
id|_prep_type
op_assign
id|_PREP_Motorola
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
multiline_comment|/* take care of initrd if we have one */
r_if
c_cond
(paren
id|r4
)paren
(brace
id|initrd_start
op_assign
id|r4
op_plus
id|KERNELBASE
suffix:semicolon
id|initrd_end
op_assign
id|r5
op_plus
id|KERNELBASE
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_BLK_DEV_INITRD */
multiline_comment|/* take care of cmd line */
r_if
c_cond
(paren
id|r6
)paren
(brace
op_star
(paren
r_char
op_star
)paren
(paren
id|r7
op_plus
id|KERNELBASE
)paren
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd_line
comma
(paren
r_char
op_star
)paren
(paren
id|r6
op_plus
id|KERNELBASE
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_MACH_chrp
suffix:colon
id|setup_pci_ptrs
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
multiline_comment|/* take care of initrd if we have one */
r_if
c_cond
(paren
id|r3
)paren
(brace
id|initrd_start
op_assign
id|r3
op_plus
id|KERNELBASE
suffix:semicolon
id|initrd_end
op_assign
id|r3
op_plus
id|r4
op_plus
id|KERNELBASE
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_BLK_DEV_INITRD */
multiline_comment|/* isa_io_base set by setup_pci_ptrs() */
id|isa_mem_base
op_assign
id|CHRP_ISA_MEM_BASE
suffix:semicolon
id|pci_dram_offset
op_assign
id|CHRP_PCI_DRAM_OFFSET
suffix:semicolon
macro_line|#if !defined(CONFIG_MACH_SPECIFIC)
id|ISA_DMA_THRESHOLD
op_assign
op_complement
l_int|0L
suffix:semicolon
id|DMA_MODE_READ
op_assign
l_int|0x44
suffix:semicolon
id|DMA_MODE_WRITE
op_assign
l_int|0x48
suffix:semicolon
macro_line|#endif /* ! CONFIG_MACH_SPECIFIC */
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_APUS&t;&t;
r_case
id|_MACH_apus
suffix:colon
id|setup_pci_ptrs
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Parse bootinfo. The bootinfo is located right after&n;                   the kernel bss */
id|parse_bootinfo
c_func
(paren
(paren
r_const
r_struct
id|bi_record
op_star
)paren
op_amp
id|_end
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
multiline_comment|/* Take care of initrd if we have one. Use data from&n;&t;&t;   bootinfo to avoid the need to initialize PPC&n;&t;&t;   registers when kernel is booted via a PPC reset. */
r_if
c_cond
(paren
id|ramdisk.addr
)paren
(brace
id|initrd_start
op_assign
(paren
r_int
r_int
)paren
id|__va
c_func
(paren
id|ramdisk.addr
)paren
suffix:semicolon
id|initrd_end
op_assign
(paren
r_int
r_int
)paren
id|__va
c_func
(paren
id|ramdisk.size
op_plus
id|ramdisk.addr
)paren
suffix:semicolon
)brace
multiline_comment|/* Make sure code below is not executed. */
id|r4
op_assign
l_int|0
suffix:semicolon
id|r6
op_assign
l_int|0
suffix:semicolon
macro_line|#endif /* CONFIG_BLK_DEV_INITRD */
macro_line|#if !defined(CONFIG_MACH_SPECIFIC)
id|ISA_DMA_THRESHOLD
op_assign
l_int|0x00ffffff
suffix:semicolon
macro_line|#endif /* ! CONFIG_MACH_SPECIFIC */
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Unknown machine type in identify_machine!&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#else /* CONFIG_MBX */
r_if
c_cond
(paren
id|r3
)paren
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|res
comma
(paren
r_void
op_star
)paren
(paren
id|r3
op_plus
id|KERNELBASE
)paren
comma
r_sizeof
(paren
id|bd_t
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
id|setup_pci_ptrs
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
multiline_comment|/* take care of initrd if we have one */
r_if
c_cond
(paren
id|r4
)paren
(brace
id|initrd_start
op_assign
id|r4
op_plus
id|KERNELBASE
suffix:semicolon
id|initrd_end
op_assign
id|r5
op_plus
id|KERNELBASE
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_BLK_DEV_INITRD */
multiline_comment|/* take care of cmd line */
r_if
c_cond
(paren
id|r6
)paren
(brace
op_star
(paren
r_char
op_star
)paren
(paren
id|r7
op_plus
id|KERNELBASE
)paren
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd_line
comma
(paren
r_char
op_star
)paren
(paren
id|r6
op_plus
id|KERNELBASE
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_MBX */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|setup_arch
c_func
(paren
r_char
op_star
op_star
id|cmdline_p
comma
r_int
r_int
op_star
id|memory_start_p
comma
r_int
r_int
op_star
id|memory_end_p
)paren
)paren
(brace
r_extern
r_void
id|pmac_setup_arch
c_func
(paren
r_int
r_int
op_star
comma
r_int
r_int
op_star
)paren
suffix:semicolon
r_extern
r_void
id|chrp_setup_arch
c_func
(paren
r_int
r_int
op_star
comma
r_int
r_int
op_star
)paren
suffix:semicolon
r_extern
r_void
id|prep_setup_arch
c_func
(paren
r_int
r_int
op_star
comma
r_int
r_int
op_star
)paren
suffix:semicolon
r_extern
r_void
id|mbx_setup_arch
c_func
(paren
r_int
r_int
op_star
comma
r_int
r_int
op_star
)paren
suffix:semicolon
r_extern
r_void
id|apus_setup_arch
c_func
(paren
r_int
r_int
op_star
comma
r_int
r_int
op_star
)paren
suffix:semicolon
r_extern
r_int
id|panic_timeout
suffix:semicolon
r_extern
r_char
id|_etext
(braket
)braket
comma
id|_edata
(braket
)braket
suffix:semicolon
r_extern
r_char
op_star
id|klimit
suffix:semicolon
r_extern
r_int
r_int
id|find_available_memory
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
r_int
op_star
id|end_of_DRAM
suffix:semicolon
macro_line|#ifdef CONFIG_XMON
r_extern
r_void
id|xmon_map_scc
c_func
(paren
r_void
)paren
suffix:semicolon
id|xmon_map_scc
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_XMON */
multiline_comment|/* reboot on panic */
id|panic_timeout
op_assign
l_int|180
suffix:semicolon
id|init_task.mm-&gt;start_code
op_assign
id|PAGE_OFFSET
suffix:semicolon
id|init_task.mm-&gt;end_code
op_assign
(paren
r_int
r_int
)paren
id|_etext
suffix:semicolon
id|init_task.mm-&gt;end_data
op_assign
(paren
r_int
r_int
)paren
id|_edata
suffix:semicolon
id|init_task.mm-&gt;brk
op_assign
(paren
r_int
r_int
)paren
id|klimit
suffix:semicolon
multiline_comment|/* Save unparsed command line copy for /proc/cmdline */
id|strcpy
c_func
(paren
id|saved_command_line
comma
id|cmd_line
)paren
suffix:semicolon
op_star
id|cmdline_p
op_assign
id|cmd_line
suffix:semicolon
op_star
id|memory_start_p
op_assign
id|find_available_memory
c_func
(paren
)paren
suffix:semicolon
op_star
id|memory_end_p
op_assign
(paren
r_int
r_int
)paren
id|end_of_DRAM
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
multiline_comment|/* initrd_start and size are setup by boot/head.S and kernel/head.S */
r_if
c_cond
(paren
id|initrd_start
)paren
(brace
r_if
c_cond
(paren
id|initrd_end
OG
op_star
id|memory_end_p
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;initrd extends beyond end of memory &quot;
l_string|&quot;(0x%08lx &gt; 0x%08lx)&bslash;ndisabling initrd&bslash;n&quot;
comma
id|initrd_end
comma
op_star
id|memory_end_p
)paren
suffix:semicolon
id|initrd_start
op_assign
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_MBX
id|mbx_setup_arch
c_func
(paren
id|memory_start_p
comma
id|memory_end_p
)paren
suffix:semicolon
macro_line|#else /* CONFIG_MBX */&t;
r_switch
c_cond
(paren
id|_machine
)paren
(brace
r_case
id|_MACH_Pmac
suffix:colon
id|pmac_setup_arch
c_func
(paren
id|memory_start_p
comma
id|memory_end_p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_MACH_prep
suffix:colon
id|prep_setup_arch
c_func
(paren
id|memory_start_p
comma
id|memory_end_p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_MACH_chrp
suffix:colon
id|chrp_setup_arch
c_func
(paren
id|memory_start_p
comma
id|memory_end_p
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_APUS&t;&t;
r_case
id|_MACH_apus
suffix:colon
id|m68k_machtype
op_assign
id|MACH_AMIGA
suffix:semicolon
id|apus_setup_arch
c_func
(paren
id|memory_start_p
comma
id|memory_end_p
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif&t;&t;
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Unknown machine %d in setup_arch()&bslash;n&quot;
comma
id|_machine
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_MBX */&t;
)brace
eof
