multiline_comment|/*&n; *  linux/arch/ppc/kernel/setup.c&n; *&n; *  Copyright (C) 1995  Linus Torvalds&n; *  Adapted from &squot;alpha&squot; version by Gary Thomas&n; *  Modified by Cort Dougan (cort@cs.nmt.edu)&n; */
multiline_comment|/*&n; * bootup setup stuff..&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/user.h&gt;
macro_line|#include &lt;linux/a.out.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/reboot.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/openpic.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;asm/init.h&gt;
macro_line|#include &lt;asm/mmu.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/residual.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/cache.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/mk48t59.h&gt;
macro_line|#include &lt;asm/prep_nvram.h&gt;
macro_line|#include &lt;asm/raven.h&gt;
macro_line|#include &lt;asm/keyboard.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &quot;local_irq.h&quot;
macro_line|#include &quot;i8259.h&quot;
macro_line|#include &quot;open_pic.h&quot;
macro_line|#if defined(CONFIG_SOUND) || defined(CONFIG_SOUND_MODULE)
macro_line|#include &lt;../drivers/sound/sound_config.h&gt;
macro_line|#include &lt;../drivers/sound/dev_table.h&gt;
macro_line|#endif
DECL|variable|ucSystemType
r_int
r_char
id|ucSystemType
suffix:semicolon
DECL|variable|ucBoardRev
r_int
r_char
id|ucBoardRev
suffix:semicolon
DECL|variable|ucBoardRevMaj
DECL|variable|ucBoardRevMin
r_int
r_char
id|ucBoardRevMaj
comma
id|ucBoardRevMin
suffix:semicolon
r_extern
r_int
r_int
id|mc146818_get_rtc_time
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|mc146818_set_rtc_time
c_func
(paren
r_int
r_int
id|nowtime
)paren
suffix:semicolon
r_extern
r_int
r_int
id|mk48t59_get_rtc_time
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|mk48t59_set_rtc_time
c_func
(paren
r_int
r_int
id|nowtime
)paren
suffix:semicolon
r_extern
r_int
r_char
id|prep_nvram_read_val
c_func
(paren
r_int
id|addr
)paren
suffix:semicolon
r_extern
r_void
id|prep_nvram_write_val
c_func
(paren
r_int
id|addr
comma
r_int
r_char
id|val
)paren
suffix:semicolon
r_extern
r_int
r_char
id|rs_nvram_read_val
c_func
(paren
r_int
id|addr
)paren
suffix:semicolon
r_extern
r_void
id|rs_nvram_write_val
c_func
(paren
r_int
id|addr
comma
r_int
r_char
id|val
)paren
suffix:semicolon
r_extern
r_int
id|pckbd_setkeycode
c_func
(paren
r_int
r_int
id|scancode
comma
r_int
r_int
id|keycode
)paren
suffix:semicolon
r_extern
r_int
id|pckbd_getkeycode
c_func
(paren
r_int
r_int
id|scancode
)paren
suffix:semicolon
r_extern
r_int
id|pckbd_translate
c_func
(paren
r_int
r_char
id|scancode
comma
r_int
r_char
op_star
id|keycode
comma
r_char
id|raw_mode
)paren
suffix:semicolon
r_extern
r_char
id|pckbd_unexpected_up
c_func
(paren
r_int
r_char
id|keycode
)paren
suffix:semicolon
r_extern
r_void
id|pckbd_leds
c_func
(paren
r_int
r_char
id|leds
)paren
suffix:semicolon
r_extern
r_void
id|pckbd_init_hw
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
r_char
id|pckbd_sysrq_xlate
(braket
l_int|128
)braket
suffix:semicolon
r_extern
r_void
id|prep_setup_pci_ptrs
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_char
id|saved_command_line
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|_prep_type
r_int
id|_prep_type
suffix:semicolon
DECL|macro|cached_21
mdefine_line|#define cached_21&t;(((char *)(ppc_cached_irq_mask))[3])
DECL|macro|cached_A1
mdefine_line|#define cached_A1&t;(((char *)(ppc_cached_irq_mask))[2])
multiline_comment|/* for the mac fs */
DECL|variable|boot_dev
id|kdev_t
id|boot_dev
suffix:semicolon
multiline_comment|/* used in nasty hack for sound - see prep_setup_arch() -- Cort */
DECL|variable|ppc_cs4232_dma
DECL|variable|ppc_cs4232_dma2
r_int
id|ppc_cs4232_dma
comma
id|ppc_cs4232_dma2
suffix:semicolon
DECL|variable|empty_zero_page
r_int
r_int
id|empty_zero_page
(braket
l_int|1024
)braket
suffix:semicolon
r_extern
id|PTE
op_star
id|Hash
comma
op_star
id|Hash_end
suffix:semicolon
r_extern
r_int
r_int
id|Hash_size
comma
id|Hash_mask
suffix:semicolon
r_extern
r_int
id|probingmem
suffix:semicolon
r_extern
r_int
r_int
id|loops_per_sec
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_RAM
r_extern
r_int
id|rd_doload
suffix:semicolon
multiline_comment|/* 1 = load ramdisk, 0 = don&squot;t load */
r_extern
r_int
id|rd_prompt
suffix:semicolon
multiline_comment|/* 1 = prompt for ramdisk, 0 = don&squot;t prompt */
r_extern
r_int
id|rd_image_start
suffix:semicolon
multiline_comment|/* starting block # of image */
macro_line|#endif
macro_line|#ifdef CONFIG_VGA_CONSOLE
DECL|variable|vgacon_remap_base
r_int
r_int
id|vgacon_remap_base
suffix:semicolon
macro_line|#endif
r_int
id|__prep
DECL|function|prep_get_cpuinfo
id|prep_get_cpuinfo
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_extern
r_char
op_star
id|Motherboard_map_name
suffix:semicolon
r_int
id|len
comma
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
DECL|macro|CD
mdefine_line|#define CD(X)&t;&t;(cpu_data[n].X)  
macro_line|#else
mdefine_line|#define CD(X) (X)
macro_line|#endif
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;machine&bslash;t&bslash;t: PReP %s&bslash;n&quot;
comma
id|Motherboard_map_name
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|_prep_type
)paren
(brace
r_case
id|_PREP_IBM
suffix:colon
r_if
c_cond
(paren
(paren
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0x8000080c
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|6
)paren
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Upgrade CPU&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;L2&bslash;t&bslash;t: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0x8000080c
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|7
)paren
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;not present&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|no_l2
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%sKb,&quot;
comma
(paren
(paren
(paren
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0x8000080d
)paren
op_rshift
l_int|2
)paren
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;512&quot;
suffix:colon
l_string|&quot;256&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%sync&bslash;n&quot;
comma
(paren
(paren
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0x8000080d
)paren
op_rshift
l_int|7
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;a&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_PREP_Motorola
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;L2&bslash;t&bslash;t: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
op_star
(paren
(paren
r_int
r_char
op_star
)paren
id|CACHECRBA
)paren
op_amp
id|L2CACHE_MASK
)paren
(brace
r_case
id|L2CACHE_512KB
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;512Kb&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L2CACHE_256KB
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;256Kb&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L2CACHE_1MB
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;1MB&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L2CACHE_NONE
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;none&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|no_l2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%x&bslash;n&quot;
comma
op_star
(paren
(paren
r_int
r_char
op_star
)paren
id|CACHECRBA
)paren
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;,parity %s&quot;
comma
(paren
op_star
(paren
(paren
r_int
r_char
op_star
)paren
id|CACHECRBA
)paren
op_amp
id|L2CACHE_PARITY
)paren
ques
c_cond
l_string|&quot;enabled&quot;
suffix:colon
l_string|&quot;disabled&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; SRAM:&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
(paren
op_star
(paren
(paren
r_int
r_char
op_star
)paren
id|CACHECRBA
)paren
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
op_amp
op_complement
(paren
l_int|0x3
)paren
)paren
(brace
r_case
l_int|1
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;synchronous,parity,flow-through&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;asynchronous,no parity&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;asynchronous,parity&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;synchronous,pipelined,no parity&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|no_l2
suffix:colon
r_if
c_cond
(paren
id|res-&gt;ResidualLength
op_eq
l_int|0
)paren
r_return
id|len
suffix:semicolon
multiline_comment|/* print info about SIMMs */
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;simms&bslash;t&bslash;t: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|res-&gt;ActualNumMemories
)paren
op_logical_and
(paren
id|i
OL
id|MAX_MEMS
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
op_ne
l_int|0
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%d:%ldM &quot;
comma
id|i
comma
(paren
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
OG
l_int|1024
)paren
ques
c_cond
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
op_rshift
l_int|20
suffix:colon
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_void
id|__init
DECL|function|prep_setup_arch
id|prep_setup_arch
c_func
(paren
r_void
)paren
(brace
r_extern
r_char
id|cmd_line
(braket
)braket
suffix:semicolon
r_int
r_char
id|reg
suffix:semicolon
r_int
r_char
id|ucMothMemType
suffix:semicolon
r_int
r_char
id|ucEquipPres1
suffix:semicolon
multiline_comment|/* init to some ~sane value until calibrate_delay() runs */
id|loops_per_sec
op_assign
l_int|50000000
suffix:semicolon
multiline_comment|/* Set up floppy in PS/2 mode */
id|outb
c_func
(paren
l_int|0x09
comma
id|SIO_CONFIG_RA
)paren
suffix:semicolon
id|reg
op_assign
id|inb
c_func
(paren
id|SIO_CONFIG_RD
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|reg
op_amp
l_int|0x3F
)paren
op_or
l_int|0x40
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|SIO_CONFIG_RD
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|SIO_CONFIG_RD
)paren
suffix:semicolon
multiline_comment|/* Have to write twice to change! */
multiline_comment|/*&n;&t; * We need to set up the NvRAM access routines early as prep_init&n;&t; * has yet to be called&n;&t; */
id|ppc_md.nvram_read_val
op_assign
id|prep_nvram_read_val
suffix:semicolon
id|ppc_md.nvram_write_val
op_assign
id|prep_nvram_write_val
suffix:semicolon
multiline_comment|/* we should determine this according to what we find! -- Cort */
r_switch
c_cond
(paren
id|_prep_type
)paren
(brace
r_case
id|_PREP_IBM
suffix:colon
multiline_comment|/* Enable L2.  Assume we don&squot;t need to flush -- Cort*/
op_star
(paren
r_int
r_char
op_star
)paren
(paren
l_int|0x8000081c
)paren
op_or_assign
l_int|3
suffix:semicolon
id|ROOT_DEV
op_assign
id|to_kdev_t
c_func
(paren
l_int|0x0301
)paren
suffix:semicolon
multiline_comment|/* hda1 */
r_break
suffix:semicolon
r_case
id|_PREP_Motorola
suffix:colon
multiline_comment|/* Enable L2.  Assume we don&squot;t need to flush -- Cort*/
op_star
(paren
r_int
r_char
op_star
)paren
(paren
l_int|0x8000081c
)paren
op_or_assign
l_int|3
suffix:semicolon
id|ROOT_DEV
op_assign
id|to_kdev_t
c_func
(paren
l_int|0x0802
)paren
suffix:semicolon
multiline_comment|/* sda2 */
r_break
suffix:semicolon
r_case
id|_PREP_Radstone
suffix:colon
id|ROOT_DEV
op_assign
id|to_kdev_t
c_func
(paren
l_int|0x0801
)paren
suffix:semicolon
multiline_comment|/* sda1 */
multiline_comment|/*&n;&t;&t; * Determine system type&n;&t;&t; */
id|ucMothMemType
op_assign
id|inb
c_func
(paren
l_int|0x866
)paren
suffix:semicolon
id|ucEquipPres1
op_assign
id|inb
c_func
(paren
l_int|0x80c
)paren
suffix:semicolon
id|ucSystemType
op_assign
(paren
(paren
id|ucMothMemType
op_amp
l_int|0x03
)paren
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|ucEquipPres1
op_amp
l_int|0x80
)paren
op_rshift
l_int|7
)paren
suffix:semicolon
id|ucSystemType
op_xor_assign
l_int|7
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Determine board revision for use by&n;&t;&t; * rev. specific code&n;&t;&t; */
id|ucBoardRev
op_assign
id|inb
c_func
(paren
l_int|0x854
)paren
suffix:semicolon
id|ucBoardRevMaj
op_assign
id|ucBoardRev
op_rshift
l_int|5
suffix:semicolon
id|ucBoardRevMin
op_assign
id|ucBoardRev
op_amp
l_int|0x1f
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Most Radstone boards have memory mapped NvRAM&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|ucSystemType
op_eq
id|RS_SYS_TYPE_PPC1
)paren
op_logical_and
(paren
id|ucBoardRevMaj
OL
l_int|5
)paren
)paren
(brace
id|ppc_md.nvram_read_val
op_assign
id|prep_nvram_read_val
suffix:semicolon
id|ppc_md.nvram_write_val
op_assign
id|prep_nvram_write_val
suffix:semicolon
)brace
r_else
(brace
id|ppc_md.nvram_read_val
op_assign
id|rs_nvram_read_val
suffix:semicolon
id|ppc_md.nvram_write_val
op_assign
id|rs_nvram_write_val
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
multiline_comment|/* Read in NVRAM data */
id|init_prep_nvram
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* if no bootargs, look in NVRAM */
r_if
c_cond
(paren
id|cmd_line
(braket
l_int|0
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
(brace
r_char
op_star
id|bootargs
suffix:semicolon
id|bootargs
op_assign
id|prep_nvram_get_var
c_func
(paren
l_string|&quot;bootargs&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bootargs
op_ne
l_int|NULL
)paren
(brace
id|strcpy
c_func
(paren
id|cmd_line
comma
id|bootargs
)paren
suffix:semicolon
multiline_comment|/* again.. */
id|strcpy
c_func
(paren
id|saved_command_line
comma
id|cmd_line
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;Boot arguments: %s&bslash;n&quot;
comma
id|cmd_line
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SOUND_CS4232
multiline_comment|/*&n;&t; * setup proper values for the cs4232 driver so we don&squot;t have&n;&t; * to recompile for the motorola or ibm workstations sound systems.&n;&t; * This is a really nasty hack, but unless we change the driver&n;&t; * it&squot;s the only way to support both addrs from one binary.&n;&t; * -- Cort&n;&t; */
r_if
c_cond
(paren
id|_machine
op_eq
id|_MACH_prep
)paren
(brace
r_extern
r_struct
id|card_info
id|snd_installed_cards
(braket
)braket
suffix:semicolon
r_struct
id|card_info
op_star
id|snd_ptr
suffix:semicolon
r_for
c_loop
(paren
id|snd_ptr
op_assign
id|snd_installed_cards
suffix:semicolon
id|snd_ptr
OL
op_amp
id|snd_installed_cards
(braket
id|num_sound_cards
)braket
suffix:semicolon
id|snd_ptr
op_increment
)paren
(brace
r_if
c_cond
(paren
id|snd_ptr-&gt;card_type
op_eq
id|SNDCARD_CS4232
)paren
(brace
r_if
c_cond
(paren
id|_prep_type
op_eq
id|_PREP_Motorola
)paren
(brace
id|snd_ptr-&gt;config.io_base
op_assign
l_int|0x830
suffix:semicolon
id|snd_ptr-&gt;config.irq
op_assign
l_int|10
suffix:semicolon
id|snd_ptr-&gt;config.dma
op_assign
id|ppc_cs4232_dma
op_assign
l_int|6
suffix:semicolon
id|snd_ptr-&gt;config.dma2
op_assign
id|ppc_cs4232_dma2
op_assign
l_int|7
suffix:semicolon
)brace
r_if
c_cond
(paren
id|_prep_type
op_eq
id|_PREP_IBM
)paren
(brace
id|snd_ptr-&gt;config.io_base
op_assign
l_int|0x530
suffix:semicolon
id|snd_ptr-&gt;config.irq
op_assign
l_int|5
suffix:semicolon
id|snd_ptr-&gt;config.dma
op_assign
id|ppc_cs4232_dma
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* this is wrong - but leave it for now */
id|snd_ptr-&gt;config.dma2
op_assign
id|ppc_cs4232_dma2
op_assign
l_int|7
suffix:semicolon
)brace
)brace
)brace
)brace
macro_line|#endif /* CONFIG_SOUND_CS4232 */&t;
multiline_comment|/*print_residual_device_info();*/
id|request_region
c_func
(paren
l_int|0x20
comma
l_int|0x20
comma
l_string|&quot;pic1&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0xa0
comma
l_int|0x20
comma
l_string|&quot;pic2&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0x00
comma
l_int|0x20
comma
l_string|&quot;dma1&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0x40
comma
l_int|0x20
comma
l_string|&quot;timer&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0x80
comma
l_int|0x10
comma
l_string|&quot;dma page reg&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0xc0
comma
l_int|0x20
comma
l_string|&quot;dma2&quot;
)paren
suffix:semicolon
id|raven_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_VGA_CONSOLE
multiline_comment|/* remap the VGA memory */
id|vgacon_remap_base
op_assign
l_int|0xf0000000
suffix:semicolon
multiline_comment|/*vgacon_remap_base = ioremap(0xc0000000, 0xba000);*/
id|conswitchp
op_assign
op_amp
id|vga_con
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * Determine the decrementer frequency from the residual data&n; * This allows for a faster boot as we do not need to calibrate the&n; * decrementer against another clock. This is important for embedded systems.&n; */
DECL|function|prep_res_calibrate_decr
r_void
id|__init
id|prep_res_calibrate_decr
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|freq
comma
id|divisor
op_assign
l_int|4
suffix:semicolon
id|freq
op_assign
id|res-&gt;VitalProductData.ProcessorBusHz
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;time_init: decrementer frequency = %lu.%.6lu MHz&bslash;n&quot;
comma
(paren
id|freq
op_div
id|divisor
)paren
op_div
l_int|1000000
comma
(paren
id|freq
op_div
id|divisor
)paren
op_mod
l_int|1000000
)paren
suffix:semicolon
id|tb_ticks_per_jiffy
op_assign
id|freq
op_div
id|HZ
op_div
id|divisor
suffix:semicolon
id|tb_to_us
op_assign
id|mulhwu_scale_factor
c_func
(paren
id|freq
op_div
id|divisor
comma
l_int|1000000
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Uses the on-board timer to calibrate the on-chip decrementer register&n; * for prep systems.  On the pmac the OF tells us what the frequency is&n; * but on prep we have to figure it out.&n; * -- Cort&n; */
multiline_comment|/* Done with 3 interrupts: the first one primes the cache and the&n; * 2 following ones measure the interval. The precision of the method&n; * is still doubtful due to the short interval sampled.&n; */
DECL|variable|__initdata
r_static
r_volatile
r_int
id|calibrate_steps
id|__initdata
op_assign
l_int|3
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|tbstamp
id|__initdata
op_assign
l_int|0
suffix:semicolon
r_void
id|__init
DECL|function|prep_calibrate_decr_handler
id|prep_calibrate_decr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|t
comma
id|freq
suffix:semicolon
r_int
id|step
op_assign
op_decrement
id|calibrate_steps
suffix:semicolon
id|t
op_assign
id|get_tbl
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|step
OG
l_int|0
)paren
(brace
id|tbstamp
op_assign
id|t
suffix:semicolon
)brace
r_else
(brace
id|freq
op_assign
(paren
id|t
op_minus
id|tbstamp
)paren
op_star
id|HZ
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;time_init: decrementer frequency = %lu.%.6lu MHz&bslash;n&quot;
comma
id|freq
op_div
l_int|1000000
comma
id|freq
op_mod
l_int|1000000
)paren
suffix:semicolon
id|tb_ticks_per_jiffy
op_assign
id|freq
op_div
id|HZ
suffix:semicolon
id|tb_to_us
op_assign
id|mulhwu_scale_factor
c_func
(paren
id|freq
comma
l_int|1000000
)paren
suffix:semicolon
)brace
)brace
DECL|function|prep_calibrate_decr
r_void
id|__init
id|prep_calibrate_decr
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
DECL|macro|TIMER0_COUNT
mdefine_line|#define TIMER0_COUNT 0x40
DECL|macro|TIMER_CONTROL
mdefine_line|#define TIMER_CONTROL 0x43
multiline_comment|/* set timer to periodic mode */
id|outb_p
c_func
(paren
l_int|0x34
comma
id|TIMER_CONTROL
)paren
suffix:semicolon
multiline_comment|/* binary, mode 2, LSB/MSB, ch 0 */
multiline_comment|/* set the clock to ~100 Hz */
id|outb_p
c_func
(paren
id|LATCH
op_amp
l_int|0xff
comma
id|TIMER0_COUNT
)paren
suffix:semicolon
multiline_comment|/* LSB */
id|outb
c_func
(paren
id|LATCH
op_rshift
l_int|8
comma
id|TIMER0_COUNT
)paren
suffix:semicolon
multiline_comment|/* MSB */
r_if
c_cond
(paren
id|request_irq
c_func
(paren
l_int|0
comma
id|prep_calibrate_decr_handler
comma
l_int|0
comma
l_string|&quot;timer&quot;
comma
l_int|NULL
)paren
op_ne
l_int|0
)paren
id|panic
c_func
(paren
l_string|&quot;Could not allocate timer IRQ!&quot;
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|calibrate_steps
)paren
multiline_comment|/* nothing */
suffix:semicolon
multiline_comment|/* wait for calibrate */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|free_irq
c_func
(paren
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|mk48t59_init
r_static
r_int
id|__init
id|mk48t59_init
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|tmp
suffix:semicolon
id|tmp
op_assign
id|ppc_md
dot
id|nvram_read_val
c_func
(paren
id|MK48T59_RTC_CONTROLB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|MK48T59_RTC_CB_STOP
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Warning: RTC was stopped, date will be wrong.&bslash;n&quot;
)paren
suffix:semicolon
id|ppc_md
dot
id|nvram_write_val
c_func
(paren
id|MK48T59_RTC_CONTROLB
comma
id|tmp
op_amp
op_complement
id|MK48T59_RTC_CB_STOP
)paren
suffix:semicolon
multiline_comment|/* Low frequency crystal oscillators may take a very long&n;&t;&t; * time to startup and stabilize. For now just ignore the&n;&t;&t; * the issue, but attempting to calibrate the decrementer&n;&t;&t; * from the RTC just after this wakeup is likely to be very &n;&t;&t; * inaccurate. Firmware should not allow to load&n;&t;&t; * the OS with the clock stopped anyway...&n;&t;&t; */
)brace
multiline_comment|/* Ensure that the clock registers are updated */
id|tmp
op_assign
id|ppc_md
dot
id|nvram_read_val
c_func
(paren
id|MK48T59_RTC_CONTROLA
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|MK48T59_RTC_CA_READ
op_or
id|MK48T59_RTC_CA_WRITE
)paren
suffix:semicolon
id|ppc_md
dot
id|nvram_write_val
c_func
(paren
id|MK48T59_RTC_CONTROLA
comma
id|tmp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* We use the NVRAM RTC to time a second to calibrate the decrementer,&n; * the RTC registers have just been set up in the right state by the&n; * preceding routine.&n; */
DECL|function|mk48t59_calibrate_decr
r_void
id|__init
id|mk48t59_calibrate_decr
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|freq
suffix:semicolon
r_int
r_int
id|t1
suffix:semicolon
r_int
r_char
id|save_control
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_char
id|sec
suffix:semicolon
multiline_comment|/* Make sure the time is not stopped. */
id|save_control
op_assign
id|ppc_md
dot
id|nvram_read_val
c_func
(paren
id|MK48T59_RTC_CONTROLB
)paren
suffix:semicolon
id|ppc_md
dot
id|nvram_write_val
c_func
(paren
id|MK48T59_RTC_CONTROLA
comma
(paren
id|save_control
op_amp
(paren
op_complement
id|MK48T59_RTC_CB_STOP
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Now make sure the read bit is off so the value will change. */
id|save_control
op_assign
id|ppc_md
dot
id|nvram_read_val
c_func
(paren
id|MK48T59_RTC_CONTROLA
)paren
suffix:semicolon
id|save_control
op_and_assign
op_complement
id|MK48T59_RTC_CA_READ
suffix:semicolon
id|ppc_md
dot
id|nvram_write_val
c_func
(paren
id|MK48T59_RTC_CONTROLA
comma
id|save_control
)paren
suffix:semicolon
multiline_comment|/* Read the seconds value to see when it changes. */
id|sec
op_assign
id|ppc_md
dot
id|nvram_read_val
c_func
(paren
id|MK48T59_RTC_SECONDS
)paren
suffix:semicolon
multiline_comment|/* Actually this is bad for precision, we should have a loop in&n;&t; * which we only read the seconds counter. nvram_read_val writes&n;&t; * the address bytes on every call and this takes a lot of time.&n;&t; * Perhaps an nvram_wait_change method returning a time&n;&t; * stamp with a loop count as parameter would be the  solution.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000000
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* may take up to 1 second... */
id|t1
op_assign
id|get_tbl
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md
dot
id|nvram_read_val
c_func
(paren
id|MK48T59_RTC_SECONDS
)paren
op_ne
id|sec
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|sec
op_assign
id|ppc_md
dot
id|nvram_read_val
c_func
(paren
id|MK48T59_RTC_SECONDS
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000000
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Should take up 1 second... */
id|freq
op_assign
id|get_tbl
c_func
(paren
)paren
op_minus
id|t1
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md
dot
id|nvram_read_val
c_func
(paren
id|MK48T59_RTC_SECONDS
)paren
op_ne
id|sec
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;time_init: decrementer frequency = %lu.%.6lu MHz&bslash;n&quot;
comma
id|freq
op_div
l_int|1000000
comma
id|freq
op_mod
l_int|1000000
)paren
suffix:semicolon
id|tb_ticks_per_jiffy
op_assign
id|freq
op_div
id|HZ
suffix:semicolon
id|tb_to_us
op_assign
id|mulhwu_scale_factor
c_func
(paren
id|freq
comma
l_int|1000000
)paren
suffix:semicolon
)brace
r_void
id|__prep
DECL|function|prep_restart
id|prep_restart
c_func
(paren
r_char
op_star
id|cmd
)paren
(brace
r_int
r_int
id|i
op_assign
l_int|10000
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set exception prefix high - to the prom */
id|_nmask_and_or_msr
c_func
(paren
l_int|0
comma
id|MSR_IP
)paren
suffix:semicolon
multiline_comment|/* make sure bit 0 (reset) is a 0 */
id|outb
c_func
(paren
id|inb
c_func
(paren
l_int|0x92
)paren
op_amp
op_complement
l_int|1L
comma
l_int|0x92
)paren
suffix:semicolon
multiline_comment|/* signal a reset to system control port A - soft reset */
id|outb
c_func
(paren
id|inb
c_func
(paren
l_int|0x92
)paren
op_or
l_int|1
comma
l_int|0x92
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_ne
l_int|0
)paren
id|i
op_increment
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;restart failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This function will restart a board regardless of port 92 functionality&n; */
r_void
id|__prep
DECL|function|prep_direct_restart
id|prep_direct_restart
c_func
(paren
r_char
op_star
id|cmd
)paren
(brace
id|u32
id|jumpaddr
op_assign
l_int|0xfff00100
suffix:semicolon
id|u32
id|defaultmsr
op_assign
id|MSR_IP
suffix:semicolon
multiline_comment|/*&n;&t; * This will ALWAYS work regardless of port 92&n;&t; * functionality&n;&t; */
id|__cli
c_func
(paren
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
"&quot;&bslash;"
id|n
"&bslash;"
id|mtspr
l_int|26
comma
op_mod
l_int|1
multiline_comment|/* SRR0 */
id|mtspr
l_int|27
comma
op_mod
l_int|0
multiline_comment|/* SRR1 */
id|rfi
"&quot;"
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|defaultmsr
)paren
comma
l_string|&quot;r&quot;
(paren
id|jumpaddr
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Not reached&n;&t; */
)brace
r_void
id|__prep
DECL|function|prep_halt
id|prep_halt
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set exception prefix high - to the prom */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
op_or
id|MSR_IP
)paren
suffix:semicolon
multiline_comment|/* make sure bit 0 (reset) is a 0 */
id|outb
c_func
(paren
id|inb
c_func
(paren
l_int|0x92
)paren
op_amp
op_complement
l_int|1L
comma
l_int|0x92
)paren
suffix:semicolon
multiline_comment|/* signal a reset to system control port A - soft reset */
id|outb
c_func
(paren
id|inb
c_func
(paren
l_int|0x92
)paren
op_or
l_int|1
comma
l_int|0x92
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Not reached&n;&t; */
)brace
r_void
id|__prep
DECL|function|prep_power_off
id|prep_power_off
c_func
(paren
r_void
)paren
(brace
id|prep_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_int
id|__prep
DECL|function|prep_setup_residual
id|prep_setup_residual
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* PREP&squot;s without residual data will give incorrect values here */
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;clock&bslash;t&bslash;t: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res-&gt;ResidualLength
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;%ldMHz&bslash;n&quot;
comma
(paren
id|res-&gt;VitalProductData.ProcessorHz
OG
l_int|1024
)paren
ques
c_cond
id|res-&gt;VitalProductData.ProcessorHz
op_rshift
l_int|20
suffix:colon
id|res-&gt;VitalProductData.ProcessorHz
)paren
suffix:semicolon
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|len
op_plus
id|buffer
comma
l_string|&quot;???&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
id|u_int
id|__prep
DECL|function|prep_irq_cannonicalize
id|prep_irq_cannonicalize
c_func
(paren
id|u_int
id|irq
)paren
(brace
r_if
c_cond
(paren
id|irq
op_eq
l_int|2
)paren
(brace
r_return
l_int|9
suffix:semicolon
)brace
r_else
(brace
r_return
id|irq
suffix:semicolon
)brace
)brace
macro_line|#if 0
r_void
id|__prep
id|prep_do_IRQ
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|cpu
comma
r_int
id|isfake
)paren
(brace
r_int
id|irq
suffix:semicolon
r_if
c_cond
(paren
(paren
id|irq
op_assign
id|i8259_irq
c_func
(paren
l_int|0
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Bogus interrupt from PC = %lx&bslash;n&quot;
comma
id|regs-&gt;nip
)paren
suffix:semicolon
id|ppc_spurious_interrupts
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ppc_irq_dispatch_handler
c_func
(paren
id|regs
comma
id|irq
)paren
suffix:semicolon
)brace
macro_line|#endif
r_int
id|__prep
DECL|function|prep_get_irq
id|prep_get_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_return
id|i8259_irq
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|prep_init_IRQ
id|prep_init_IRQ
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|OpenPIC
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OL
l_int|36
suffix:semicolon
id|i
op_increment
)paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
op_amp
id|open_pic
suffix:semicolon
id|openpic_init
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
op_amp
id|i8259_pic
suffix:semicolon
id|i8259_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
id|request_irq
c_func
(paren
id|openpic_to_irq
c_func
(paren
id|OPENPIC_VEC_SPURIOUS
)paren
comma
id|openpic_ipi_action
comma
l_int|0
comma
l_string|&quot;IPI0&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_SMP */
)brace
macro_line|#if defined(CONFIG_BLK_DEV_IDE) || defined(CONFIG_BLK_DEV_IDE_MODULE)
multiline_comment|/*&n; * IDE stuff.&n; */
r_void
id|__prep
DECL|function|prep_ide_insw
id|prep_ide_insw
c_func
(paren
id|ide_ioreg_t
id|port
comma
r_void
op_star
id|buf
comma
r_int
id|ns
)paren
(brace
id|_insw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
(paren
id|port
)paren
op_plus
id|_IO_BASE
)paren
comma
id|buf
comma
id|ns
)paren
suffix:semicolon
)brace
r_void
id|__prep
DECL|function|prep_ide_outsw
id|prep_ide_outsw
c_func
(paren
id|ide_ioreg_t
id|port
comma
r_void
op_star
id|buf
comma
r_int
id|ns
)paren
(brace
id|_outsw
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
(paren
id|port
)paren
op_plus
id|_IO_BASE
)paren
comma
id|buf
comma
id|ns
)paren
suffix:semicolon
)brace
r_int
id|__prep
DECL|function|prep_ide_default_irq
id|prep_ide_default_irq
c_func
(paren
id|ide_ioreg_t
id|base
)paren
(brace
r_switch
c_cond
(paren
id|base
)paren
(brace
r_case
l_int|0x1f0
suffix:colon
r_return
l_int|13
suffix:semicolon
r_case
l_int|0x170
suffix:colon
r_return
l_int|13
suffix:semicolon
r_case
l_int|0x1e8
suffix:colon
r_return
l_int|11
suffix:semicolon
r_case
l_int|0x168
suffix:colon
r_return
l_int|10
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|ide_ioreg_t
id|__prep
DECL|function|prep_ide_default_io_base
id|prep_ide_default_io_base
c_func
(paren
r_int
id|index
)paren
(brace
r_switch
c_cond
(paren
id|index
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
l_int|0x1f0
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
l_int|0x170
suffix:semicolon
r_case
l_int|2
suffix:colon
r_return
l_int|0x1e8
suffix:semicolon
r_case
l_int|3
suffix:colon
r_return
l_int|0x168
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_int
id|__prep
DECL|function|prep_ide_check_region
id|prep_ide_check_region
c_func
(paren
id|ide_ioreg_t
id|from
comma
r_int
r_int
id|extent
)paren
(brace
r_return
id|check_region
c_func
(paren
id|from
comma
id|extent
)paren
suffix:semicolon
)brace
r_void
id|__prep
DECL|function|prep_ide_request_region
id|prep_ide_request_region
c_func
(paren
id|ide_ioreg_t
id|from
comma
r_int
r_int
id|extent
comma
r_const
r_char
op_star
id|name
)paren
(brace
id|request_region
c_func
(paren
id|from
comma
id|extent
comma
id|name
)paren
suffix:semicolon
)brace
r_void
id|__prep
DECL|function|prep_ide_release_region
id|prep_ide_release_region
c_func
(paren
id|ide_ioreg_t
id|from
comma
r_int
r_int
id|extent
)paren
(brace
id|release_region
c_func
(paren
id|from
comma
id|extent
)paren
suffix:semicolon
)brace
r_void
id|__prep
DECL|function|prep_ide_fix_driveid
id|prep_ide_fix_driveid
c_func
(paren
r_struct
id|hd_driveid
op_star
id|id
)paren
(brace
)brace
r_void
id|__init
DECL|function|prep_ide_init_hwif_ports
id|prep_ide_init_hwif_ports
(paren
id|hw_regs_t
op_star
id|hw
comma
id|ide_ioreg_t
id|data_port
comma
id|ide_ioreg_t
id|ctrl_port
comma
r_int
op_star
id|irq
)paren
(brace
id|ide_ioreg_t
id|reg
op_assign
id|data_port
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|IDE_DATA_OFFSET
suffix:semicolon
id|i
op_le
id|IDE_STATUS_OFFSET
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hw-&gt;io_ports
(braket
id|i
)braket
op_assign
id|reg
suffix:semicolon
id|reg
op_add_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctrl_port
)paren
(brace
id|hw-&gt;io_ports
(braket
id|IDE_CONTROL_OFFSET
)braket
op_assign
id|ctrl_port
suffix:semicolon
)brace
r_else
(brace
id|hw-&gt;io_ports
(braket
id|IDE_CONTROL_OFFSET
)braket
op_assign
id|hw-&gt;io_ports
(braket
id|IDE_DATA_OFFSET
)braket
op_plus
l_int|0x206
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq
op_ne
l_int|NULL
)paren
op_star
id|irq
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_void
id|__init
DECL|function|prep_init
id|prep_init
c_func
(paren
r_int
r_int
id|r3
comma
r_int
r_int
id|r4
comma
r_int
r_int
id|r5
comma
r_int
r_int
id|r6
comma
r_int
r_int
id|r7
)paren
(brace
multiline_comment|/* make a copy of residual data */
r_if
c_cond
(paren
id|r3
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|res
comma
(paren
r_void
op_star
)paren
(paren
id|r3
op_plus
id|KERNELBASE
)paren
comma
r_sizeof
(paren
id|RESIDUAL
)paren
)paren
suffix:semicolon
)brace
id|isa_io_base
op_assign
id|PREP_ISA_IO_BASE
suffix:semicolon
id|isa_mem_base
op_assign
id|PREP_ISA_MEM_BASE
suffix:semicolon
id|pci_dram_offset
op_assign
id|PREP_PCI_DRAM_OFFSET
suffix:semicolon
id|ISA_DMA_THRESHOLD
op_assign
l_int|0x00ffffff
suffix:semicolon
id|DMA_MODE_READ
op_assign
l_int|0x44
suffix:semicolon
id|DMA_MODE_WRITE
op_assign
l_int|0x48
suffix:semicolon
multiline_comment|/* figure out what kind of prep workstation we are */
r_if
c_cond
(paren
id|res-&gt;ResidualLength
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|res-&gt;VitalProductData.PrintableModel
comma
l_string|&quot;IBM&quot;
comma
l_int|3
)paren
)paren
id|_prep_type
op_assign
id|_PREP_IBM
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|res-&gt;VitalProductData.PrintableModel
comma
l_string|&quot;Radstone&quot;
comma
l_int|8
)paren
)paren
(brace
r_extern
r_char
op_star
id|Motherboard_map_name
suffix:semicolon
id|_prep_type
op_assign
id|_PREP_Radstone
suffix:semicolon
id|Motherboard_map_name
op_assign
id|res-&gt;VitalProductData.PrintableModel
suffix:semicolon
)brace
r_else
id|_prep_type
op_assign
id|_PREP_Motorola
suffix:semicolon
)brace
r_else
multiline_comment|/* assume motorola if no residual (netboot?) */
(brace
id|_prep_type
op_assign
id|_PREP_Motorola
suffix:semicolon
)brace
id|prep_setup_pci_ptrs
c_func
(paren
)paren
suffix:semicolon
id|ppc_md.setup_arch
op_assign
id|prep_setup_arch
suffix:semicolon
id|ppc_md.setup_residual
op_assign
id|prep_setup_residual
suffix:semicolon
id|ppc_md.get_cpuinfo
op_assign
id|prep_get_cpuinfo
suffix:semicolon
id|ppc_md.irq_cannonicalize
op_assign
id|prep_irq_cannonicalize
suffix:semicolon
id|ppc_md.init_IRQ
op_assign
id|prep_init_IRQ
suffix:semicolon
multiline_comment|/* this gets changed later on if we have an OpenPIC -- Cort */
id|ppc_md.get_irq
op_assign
id|prep_get_irq
suffix:semicolon
id|ppc_md.init
op_assign
l_int|NULL
suffix:semicolon
id|ppc_md.restart
op_assign
id|prep_restart
suffix:semicolon
id|ppc_md.power_off
op_assign
id|prep_power_off
suffix:semicolon
id|ppc_md.halt
op_assign
id|prep_halt
suffix:semicolon
id|ppc_md.time_init
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|_prep_type
op_eq
id|_PREP_Radstone
)paren
(brace
multiline_comment|/*&n;&t;&t; * We require a direct restart as port 92 does not work on&n;&t;&t; * all Radstone boards&n;&t;&t; */
id|ppc_md.restart
op_assign
id|prep_direct_restart
suffix:semicolon
multiline_comment|/*&n;&t;&t; * The RTC device used varies according to board type&n;&t;&t; */
r_if
c_cond
(paren
(paren
(paren
id|ucSystemType
op_eq
id|RS_SYS_TYPE_PPC1
)paren
op_logical_and
(paren
id|ucBoardRevMaj
op_ge
l_int|5
)paren
)paren
op_logical_or
(paren
id|ucSystemType
op_eq
id|RS_SYS_TYPE_PPC1a
)paren
)paren
(brace
id|ppc_md.set_rtc_time
op_assign
id|mk48t59_set_rtc_time
suffix:semicolon
id|ppc_md.get_rtc_time
op_assign
id|mk48t59_get_rtc_time
suffix:semicolon
id|ppc_md.time_init
op_assign
id|mk48t59_init
suffix:semicolon
)brace
r_else
(brace
id|ppc_md.set_rtc_time
op_assign
id|mc146818_set_rtc_time
suffix:semicolon
id|ppc_md.get_rtc_time
op_assign
id|mc146818_get_rtc_time
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Determine the decrementer rate from the residual data&n;&t;&t; */
id|ppc_md.calibrate_decr
op_assign
id|prep_res_calibrate_decr
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|_prep_type
op_eq
id|_PREP_IBM
)paren
(brace
id|ppc_md.set_rtc_time
op_assign
id|mc146818_set_rtc_time
suffix:semicolon
id|ppc_md.get_rtc_time
op_assign
id|mc146818_get_rtc_time
suffix:semicolon
id|ppc_md.calibrate_decr
op_assign
id|prep_calibrate_decr
suffix:semicolon
)brace
r_else
(brace
id|ppc_md.set_rtc_time
op_assign
id|mk48t59_set_rtc_time
suffix:semicolon
id|ppc_md.get_rtc_time
op_assign
id|mk48t59_get_rtc_time
suffix:semicolon
id|ppc_md.calibrate_decr
op_assign
id|mk48t59_calibrate_decr
suffix:semicolon
id|ppc_md.time_init
op_assign
id|mk48t59_init
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_BLK_DEV_IDE) || defined(CONFIG_BLK_DEV_IDE_MODULE)
id|ppc_ide_md.insw
op_assign
id|prep_ide_insw
suffix:semicolon
id|ppc_ide_md.outsw
op_assign
id|prep_ide_outsw
suffix:semicolon
id|ppc_ide_md.default_irq
op_assign
id|prep_ide_default_irq
suffix:semicolon
id|ppc_ide_md.default_io_base
op_assign
id|prep_ide_default_io_base
suffix:semicolon
id|ppc_ide_md.ide_check_region
op_assign
id|prep_ide_check_region
suffix:semicolon
id|ppc_ide_md.ide_request_region
op_assign
id|prep_ide_request_region
suffix:semicolon
id|ppc_ide_md.ide_release_region
op_assign
id|prep_ide_release_region
suffix:semicolon
id|ppc_ide_md.fix_driveid
op_assign
id|prep_ide_fix_driveid
suffix:semicolon
id|ppc_ide_md.ide_init_hwif
op_assign
id|prep_ide_init_hwif_ports
suffix:semicolon
macro_line|#endif&t;&t;
id|ppc_ide_md.io_base
op_assign
id|_IO_BASE
suffix:semicolon
macro_line|#ifdef CONFIG_VT
id|ppc_md.kbd_setkeycode
op_assign
id|pckbd_setkeycode
suffix:semicolon
id|ppc_md.kbd_getkeycode
op_assign
id|pckbd_getkeycode
suffix:semicolon
id|ppc_md.kbd_translate
op_assign
id|pckbd_translate
suffix:semicolon
id|ppc_md.kbd_unexpected_up
op_assign
id|pckbd_unexpected_up
suffix:semicolon
id|ppc_md.kbd_leds
op_assign
id|pckbd_leds
suffix:semicolon
id|ppc_md.kbd_init_hw
op_assign
id|pckbd_init_hw
suffix:semicolon
macro_line|#ifdef CONFIG_MAGIC_SYSRQ
id|ppc_md.ppc_kbd_sysrq_xlate
op_assign
id|pckbd_sysrq_xlate
suffix:semicolon
id|SYSRQ_KEY
op_assign
l_int|0x54
suffix:semicolon
macro_line|#endif
macro_line|#endif
)brace
macro_line|#ifdef CONFIG_SOUND_MODULE
DECL|variable|ppc_cs4232_dma
id|EXPORT_SYMBOL
c_func
(paren
id|ppc_cs4232_dma
)paren
suffix:semicolon
DECL|variable|ppc_cs4232_dma2
id|EXPORT_SYMBOL
c_func
(paren
id|ppc_cs4232_dma2
)paren
suffix:semicolon
macro_line|#endif
eof
