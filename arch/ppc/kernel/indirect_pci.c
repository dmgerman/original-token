multiline_comment|/*&n; * Support for indirect PCI bridges.&n; *&n; * Copyright (C) 1998 Gabriel Paubert.&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
DECL|variable|pci_config_address
r_int
r_int
op_star
id|pci_config_address
suffix:semicolon
DECL|variable|pci_config_data
r_int
r_char
op_star
id|pci_config_data
suffix:semicolon
DECL|function|indirect_pcibios_read_config_byte
r_int
id|indirect_pcibios_read_config_byte
c_func
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev_fn
comma
r_int
r_char
id|offset
comma
r_int
r_char
op_star
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|out_be32
c_func
(paren
id|pci_config_address
comma
(paren
(paren
id|offset
op_amp
l_int|0xfc
)paren
op_lshift
l_int|24
)paren
op_or
(paren
id|dev_fn
op_lshift
l_int|16
)paren
op_or
(paren
id|bus
op_lshift
l_int|8
)paren
op_or
l_int|0x80
)paren
suffix:semicolon
op_star
id|val
op_assign
id|in_8
c_func
(paren
id|pci_config_data
op_plus
(paren
id|offset
op_amp
l_int|3
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|indirect_pcibios_read_config_word
r_int
id|indirect_pcibios_read_config_word
c_func
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev_fn
comma
r_int
r_char
id|offset
comma
r_int
r_int
op_star
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_amp
l_int|1
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|out_be32
c_func
(paren
id|pci_config_address
comma
(paren
(paren
id|offset
op_amp
l_int|0xfc
)paren
op_lshift
l_int|24
)paren
op_or
(paren
id|dev_fn
op_lshift
l_int|16
)paren
op_or
(paren
id|bus
op_lshift
l_int|8
)paren
op_or
l_int|0x80
)paren
suffix:semicolon
op_star
id|val
op_assign
id|in_le16
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|pci_config_data
op_plus
(paren
id|offset
op_amp
l_int|3
)paren
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|indirect_pcibios_read_config_dword
r_int
id|indirect_pcibios_read_config_dword
c_func
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev_fn
comma
r_int
r_char
id|offset
comma
r_int
r_int
op_star
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_amp
l_int|3
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|out_be32
c_func
(paren
id|pci_config_address
comma
(paren
(paren
id|offset
op_amp
l_int|0xfc
)paren
op_lshift
l_int|24
)paren
op_or
(paren
id|dev_fn
op_lshift
l_int|16
)paren
op_or
(paren
id|bus
op_lshift
l_int|8
)paren
op_or
l_int|0x80
)paren
suffix:semicolon
op_star
id|val
op_assign
id|in_le32
c_func
(paren
(paren
r_int
op_star
)paren
id|pci_config_data
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|indirect_pcibios_write_config_byte
r_int
id|indirect_pcibios_write_config_byte
c_func
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev_fn
comma
r_int
r_char
id|offset
comma
r_int
r_char
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|out_be32
c_func
(paren
id|pci_config_address
comma
(paren
(paren
id|offset
op_amp
l_int|0xfc
)paren
op_lshift
l_int|24
)paren
op_or
(paren
id|dev_fn
op_lshift
l_int|16
)paren
op_or
(paren
id|bus
op_lshift
l_int|8
)paren
op_or
l_int|0x80
)paren
suffix:semicolon
id|out_8
c_func
(paren
id|pci_config_data
op_plus
(paren
id|offset
op_amp
l_int|3
)paren
comma
id|val
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|indirect_pcibios_write_config_word
r_int
id|indirect_pcibios_write_config_word
c_func
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev_fn
comma
r_int
r_char
id|offset
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_amp
l_int|1
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|out_be32
c_func
(paren
id|pci_config_address
comma
(paren
(paren
id|offset
op_amp
l_int|0xfc
)paren
op_lshift
l_int|24
)paren
op_or
(paren
id|dev_fn
op_lshift
l_int|16
)paren
op_or
(paren
id|bus
op_lshift
l_int|8
)paren
op_or
l_int|0x80
)paren
suffix:semicolon
id|out_le16
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|pci_config_data
op_plus
(paren
id|offset
op_amp
l_int|3
)paren
)paren
comma
id|val
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|indirect_pcibios_write_config_dword
r_int
id|indirect_pcibios_write_config_dword
c_func
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev_fn
comma
r_int
r_char
id|offset
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_amp
l_int|3
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|out_be32
c_func
(paren
id|pci_config_address
comma
(paren
(paren
id|offset
op_amp
l_int|0xfc
)paren
op_lshift
l_int|24
)paren
op_or
(paren
id|dev_fn
op_lshift
l_int|16
)paren
op_or
(paren
id|bus
op_lshift
l_int|8
)paren
op_or
l_int|0x80
)paren
suffix:semicolon
id|out_le32
c_func
(paren
(paren
r_int
op_star
)paren
id|pci_config_data
comma
id|val
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
eof
