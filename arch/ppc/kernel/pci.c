multiline_comment|/*&n; * PCI support&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/bios32.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
multiline_comment|/* #define PCI_DEBUG */
DECL|variable|PCI_conversions
r_int
id|PCI_conversions
(braket
l_int|2
)braket
suffix:semicolon
DECL|function|pcibios_init
r_int
r_int
id|pcibios_init
c_func
(paren
r_int
r_int
id|mem_start
comma
r_int
r_int
id|mem_end
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PPC init stub -- cort&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|mem_start
suffix:semicolon
)brace
DECL|function|pcibios_fixup
r_int
r_int
id|pcibios_fixup
c_func
(paren
r_int
r_int
id|mem_start
comma
r_int
r_int
id|mem_end
)paren
(brace
r_return
id|mem_start
suffix:semicolon
)brace
r_int
r_int
DECL|function|_LE_to_BE_long
id|_LE_to_BE_long
c_func
(paren
r_int
r_int
id|val
)paren
(brace
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|val
suffix:semicolon
id|PCI_conversions
(braket
l_int|0
)braket
op_increment
suffix:semicolon
r_return
(paren
(paren
id|p
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|p
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|p
(braket
l_int|0
)braket
op_lshift
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_int
r_int
DECL|function|_LE_to_BE_short
id|_LE_to_BE_short
c_func
(paren
r_int
r_int
id|val
)paren
(brace
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|val
suffix:semicolon
id|PCI_conversions
(braket
l_int|1
)braket
op_increment
suffix:semicolon
r_return
(paren
(paren
id|p
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_int
DECL|function|pcibios_present
id|pcibios_present
(paren
r_void
)paren
(brace
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;PCI [BIOS] present?&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_int
DECL|function|pcibios_read_config_dword
id|pcibios_read_config_dword
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
op_star
id|val
)paren
(brace
r_int
r_int
id|_val
suffix:semicolon
r_int
r_int
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;PCI Read config dword[%d.%d.%x] = &quot;
comma
id|bus
comma
id|dev
comma
id|offset
)paren
suffix:semicolon
macro_line|#endif&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
op_star
id|val
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
)paren
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;[%x] &quot;
comma
id|ptr
)paren
suffix:semicolon
macro_line|#endif&t;&t;
id|_val
op_assign
id|_LE_to_BE_long
c_func
(paren
op_star
id|ptr
)paren
suffix:semicolon
)brace
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;%x&bslash;n&quot;
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;
op_star
id|val
op_assign
id|_val
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_read_config_word
id|pcibios_read_config_word
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
op_star
id|val
)paren
(brace
r_int
r_int
id|_val
suffix:semicolon
r_int
r_int
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;PCI Read config word[%d.%d.%x] = &quot;
comma
id|bus
comma
id|dev
comma
id|offset
)paren
suffix:semicolon
macro_line|#endif&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
op_star
id|val
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
)paren
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;[%x] &quot;
comma
id|ptr
)paren
suffix:semicolon
macro_line|#endif&t;&t;
id|_val
op_assign
id|_LE_to_BE_short
c_func
(paren
op_star
id|ptr
)paren
suffix:semicolon
)brace
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;%x&bslash;n&quot;
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;&t;
op_star
id|val
op_assign
id|_val
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_read_config_byte
id|pcibios_read_config_byte
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_char
op_star
id|val
)paren
(brace
r_int
r_char
id|_val
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;PCI Read config byte[%d.%d.%x] = &quot;
comma
id|bus
comma
id|dev
comma
id|offset
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
op_star
id|val
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
op_xor
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;[%x] &quot;
comma
id|ptr
)paren
suffix:semicolon
macro_line|#endif&t;&t;
id|_val
op_assign
op_star
id|ptr
suffix:semicolon
)brace
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;%x&bslash;n&quot;
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;&t;
op_star
id|val
op_assign
id|_val
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_write_config_dword
id|pcibios_write_config_dword
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|_val
suffix:semicolon
r_int
r_int
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
id|_val
op_assign
id|_LE_to_BE_long
c_func
(paren
id|val
)paren
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;PCI Write config dword[%d.%d.%x] = %x&bslash;n&quot;
comma
id|bus
comma
id|dev
comma
id|offset
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|_val
suffix:semicolon
)brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_write_config_word
id|pcibios_write_config_word
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|_val
suffix:semicolon
r_int
r_int
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
id|_val
op_assign
id|_LE_to_BE_short
c_func
(paren
id|val
)paren
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;PCI Write config word[%d.%d.%x] = %x&bslash;n&quot;
comma
id|bus
comma
id|dev
comma
id|offset
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|_val
suffix:semicolon
)brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_write_config_byte
id|pcibios_write_config_byte
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_char
id|val
)paren
(brace
r_int
r_char
id|_val
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
id|_val
op_assign
id|val
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|_printk
c_func
(paren
l_string|&quot;PCI Write config byte[%d.%d.%x] = %x&bslash;n&quot;
comma
id|bus
comma
id|dev
comma
id|offset
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
op_xor
l_int|1
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|_val
suffix:semicolon
)brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_find_device
id|pcibios_find_device
(paren
r_int
r_int
id|vendor
comma
r_int
r_int
id|device_id
comma
r_int
r_int
id|index
comma
r_int
r_char
op_star
id|bus
comma
r_int
r_char
op_star
id|dev
)paren
(brace
r_int
r_int
id|w
comma
id|desired
op_assign
(paren
id|device_id
op_lshift
l_int|16
)paren
op_or
id|vendor
suffix:semicolon
r_int
id|devnr
suffix:semicolon
r_if
c_cond
(paren
id|vendor
op_eq
l_int|0xffff
)paren
(brace
r_return
id|PCIBIOS_BAD_VENDOR_ID
suffix:semicolon
)brace
r_for
c_loop
(paren
id|devnr
op_assign
l_int|11
suffix:semicolon
id|devnr
OL
l_int|16
suffix:semicolon
id|devnr
op_increment
)paren
(brace
id|pcibios_read_config_dword
c_func
(paren
l_int|0
comma
id|devnr
op_lshift
l_int|3
comma
id|PCI_VENDOR_ID
comma
op_amp
id|w
)paren
suffix:semicolon
r_if
c_cond
(paren
id|w
op_eq
id|desired
)paren
(brace
r_if
c_cond
(paren
id|index
op_eq
l_int|0
)paren
(brace
op_star
id|bus
op_assign
l_int|0
suffix:semicolon
op_star
id|dev
op_assign
id|devnr
op_lshift
l_int|3
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
op_decrement
id|index
suffix:semicolon
)brace
)brace
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_int
DECL|function|pcibios_find_class
id|pcibios_find_class
(paren
r_int
r_int
id|class_code
comma
r_int
r_int
id|index
comma
r_int
r_char
op_star
id|bus
comma
r_int
r_char
op_star
id|dev
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcibios_find_class&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|PCIBIOS_FUNC_NOT_SUPPORTED
suffix:semicolon
)brace
DECL|function|pcibios_strerror
r_const
r_char
op_star
id|pcibios_strerror
c_func
(paren
r_int
id|error
)paren
(brace
id|_panic
c_func
(paren
l_string|&quot;pcibios_strerror&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*int get_pci_list(char *buf) { _panic(&quot;get_pci_list&quot;); } */
eof
