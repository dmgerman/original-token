multiline_comment|/*&n; * PCI support&n; * -- rough emulation of &quot;PCI BIOS&quot; functions&n; *&n; * Note: these are very motherboard specific!  Some way needs to&n; * be worked out to handle the differences.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/bios32.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
multiline_comment|/*&n; * PCI interrupt configuration.  This is motherboard specific.&n; */
multiline_comment|/* Which PCI interrupt line does a given device [slot] use? */
multiline_comment|/* Note: This really should be two dimensional based in slot/pin used */
DECL|variable|Motherboard_map
r_int
r_char
op_star
id|Motherboard_map
suffix:semicolon
multiline_comment|/* How is the 82378 PIRQ mapping setup? */
DECL|variable|Motherboard_routes
r_int
r_char
op_star
id|Motherboard_routes
suffix:semicolon
multiline_comment|/* Tables for known hardware */
multiline_comment|/* Motorola PowerStack */
DECL|variable|Blackhawk_pci_IRQ_map
r_static
r_char
id|Blackhawk_pci_IRQ_map
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
multiline_comment|/* Slot 0  - unused */
l_int|0
comma
multiline_comment|/* Slot 1  - unused */
l_int|0
comma
multiline_comment|/* Slot 2  - unused */
l_int|0
comma
multiline_comment|/* Slot 3  - unused */
l_int|0
comma
multiline_comment|/* Slot 4  - unused */
l_int|0
comma
multiline_comment|/* Slot 5  - unused */
l_int|0
comma
multiline_comment|/* Slot 6  - unused */
l_int|0
comma
multiline_comment|/* Slot 7  - unused */
l_int|0
comma
multiline_comment|/* Slot 8  - unused */
l_int|0
comma
multiline_comment|/* Slot 9  - unused */
l_int|0
comma
multiline_comment|/* Slot 10 - unused */
l_int|0
comma
multiline_comment|/* Slot 11 - unused */
l_int|3
comma
multiline_comment|/* Slot 12 - SCSI */
l_int|0
comma
multiline_comment|/* Slot 13 - unused */
l_int|1
comma
multiline_comment|/* Slot 14 - Ethernet */
l_int|0
comma
multiline_comment|/* Slot 15 - unused */
)brace
suffix:semicolon
DECL|variable|Blackhawk_pci_IRQ_routes
r_static
r_char
id|Blackhawk_pci_IRQ_routes
(braket
)braket
op_assign
(brace
l_int|0
comma
multiline_comment|/* Line 0 - Unused */
l_int|9
comma
multiline_comment|/* Line 1 */
l_int|11
comma
multiline_comment|/* Line 2 */
l_int|14
comma
multiline_comment|/* Line 3 */
l_int|15
multiline_comment|/* Line 4 */
)brace
suffix:semicolon
multiline_comment|/* Motorola MVME16xx */
DECL|variable|Genesis_pci_IRQ_map
r_static
r_char
id|Genesis_pci_IRQ_map
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
multiline_comment|/* Slot 0  - unused */
l_int|0
comma
multiline_comment|/* Slot 1  - unused */
l_int|0
comma
multiline_comment|/* Slot 2  - unused */
l_int|0
comma
multiline_comment|/* Slot 3  - unused */
l_int|0
comma
multiline_comment|/* Slot 4  - unused */
l_int|0
comma
multiline_comment|/* Slot 5  - unused */
l_int|0
comma
multiline_comment|/* Slot 6  - unused */
l_int|0
comma
multiline_comment|/* Slot 7  - unused */
l_int|0
comma
multiline_comment|/* Slot 8  - unused */
l_int|0
comma
multiline_comment|/* Slot 9  - unused */
l_int|0
comma
multiline_comment|/* Slot 10 - unused */
l_int|0
comma
multiline_comment|/* Slot 11 - unused */
l_int|3
comma
multiline_comment|/* Slot 12 - SCSI */
l_int|0
comma
multiline_comment|/* Slot 13 - unused */
l_int|1
comma
multiline_comment|/* Slot 14 - Ethernet */
l_int|0
comma
multiline_comment|/* Slot 15 - unused */
)brace
suffix:semicolon
DECL|variable|Genesis_pci_IRQ_routes
r_static
r_char
id|Genesis_pci_IRQ_routes
(braket
)braket
op_assign
(brace
l_int|0
comma
multiline_comment|/* Line 0 - Unused */
l_int|10
comma
multiline_comment|/* Line 1 */
l_int|11
comma
multiline_comment|/* Line 2 */
l_int|14
comma
multiline_comment|/* Line 3 */
l_int|15
multiline_comment|/* Line 4 */
)brace
suffix:semicolon
multiline_comment|/* Motorola Series-E */
DECL|variable|Comet_pci_IRQ_map
r_static
r_char
id|Comet_pci_IRQ_map
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
multiline_comment|/* Slot 0  - unused */
l_int|0
comma
multiline_comment|/* Slot 1  - unused */
l_int|0
comma
multiline_comment|/* Slot 2  - unused */
l_int|0
comma
multiline_comment|/* Slot 3  - unused */
l_int|0
comma
multiline_comment|/* Slot 4  - unused */
l_int|0
comma
multiline_comment|/* Slot 5  - unused */
l_int|0
comma
multiline_comment|/* Slot 6  - unused */
l_int|0
comma
multiline_comment|/* Slot 7  - unused */
l_int|0
comma
multiline_comment|/* Slot 8  - unused */
l_int|0
comma
multiline_comment|/* Slot 9  - unused */
l_int|0
comma
multiline_comment|/* Slot 10 - unused */
l_int|0
comma
multiline_comment|/* Slot 11 - unused */
l_int|3
comma
multiline_comment|/* Slot 12 - SCSI */
l_int|0
comma
multiline_comment|/* Slot 13 - unused */
l_int|1
comma
multiline_comment|/* Slot 14 - Ethernet */
l_int|0
comma
multiline_comment|/* Slot 15 - unused */
)brace
suffix:semicolon
DECL|variable|Comet_pci_IRQ_routes
r_static
r_char
id|Comet_pci_IRQ_routes
(braket
)braket
op_assign
(brace
l_int|0
comma
multiline_comment|/* Line 0 - Unused */
l_int|10
comma
multiline_comment|/* Line 1 */
l_int|11
comma
multiline_comment|/* Line 2 */
l_int|14
comma
multiline_comment|/* Line 3 */
l_int|15
multiline_comment|/* Line 4 */
)brace
suffix:semicolon
multiline_comment|/* BeBox */
DECL|variable|BeBox_pci_IRQ_map
r_static
r_char
id|BeBox_pci_IRQ_map
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
multiline_comment|/* Slot 0  - unused */
l_int|0
comma
multiline_comment|/* Slot 1  - unused */
l_int|0
comma
multiline_comment|/* Slot 2  - unused */
l_int|0
comma
multiline_comment|/* Slot 3  - unused */
l_int|0
comma
multiline_comment|/* Slot 4  - unused */
l_int|0
comma
multiline_comment|/* Slot 5  - unused */
l_int|0
comma
multiline_comment|/* Slot 6  - unused */
l_int|0
comma
multiline_comment|/* Slot 7  - unused */
l_int|0
comma
multiline_comment|/* Slot 8  - unused */
l_int|0
comma
multiline_comment|/* Slot 9  - unused */
l_int|0
comma
multiline_comment|/* Slot 10 - unused */
l_int|0
comma
multiline_comment|/* Slot 11 - unused */
l_int|16
comma
multiline_comment|/* Slot 12 - SCSI */
l_int|0
comma
multiline_comment|/* Slot 13 - unused */
l_int|0
comma
multiline_comment|/* Slot 14 - unused */
l_int|0
comma
multiline_comment|/* Slot 15 - unused */
)brace
suffix:semicolon
DECL|variable|BeBox_pci_IRQ_routes
r_static
r_char
id|BeBox_pci_IRQ_routes
(braket
)braket
op_assign
(brace
l_int|0
comma
multiline_comment|/* Line 0 - Unused */
l_int|9
comma
multiline_comment|/* Line 1 */
l_int|11
comma
multiline_comment|/* Line 2 */
l_int|14
comma
multiline_comment|/* Line 3 */
l_int|15
multiline_comment|/* Line 4 */
)brace
suffix:semicolon
multiline_comment|/* #define PCI_DEBUG */
macro_line|#ifdef PCI_STATS
DECL|variable|PCI_conversions
r_int
id|PCI_conversions
(braket
l_int|2
)braket
suffix:semicolon
macro_line|#endif
DECL|function|pcibios_init
r_int
r_int
id|pcibios_init
c_func
(paren
r_int
r_int
id|mem_start
comma
r_int
r_int
id|mem_end
)paren
(brace
r_return
id|mem_start
suffix:semicolon
)brace
DECL|function|pcibios_fixup
r_int
r_int
id|pcibios_fixup
c_func
(paren
r_int
r_int
id|mem_start
comma
r_int
r_int
id|mem_end
)paren
(brace
r_return
id|mem_start
suffix:semicolon
)brace
r_int
r_int
DECL|function|_LE_to_BE_long
id|_LE_to_BE_long
c_func
(paren
r_int
r_int
id|val
)paren
(brace
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|val
suffix:semicolon
macro_line|#ifdef PCI_STATS
id|PCI_conversions
(braket
l_int|0
)braket
op_increment
suffix:semicolon
macro_line|#endif&t;
r_return
(paren
(paren
id|p
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|p
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|p
(braket
l_int|0
)braket
op_lshift
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_int
r_int
DECL|function|_LE_to_BE_short
id|_LE_to_BE_short
c_func
(paren
r_int
r_int
id|val
)paren
(brace
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|val
suffix:semicolon
macro_line|#ifdef PCI_STATS
id|PCI_conversions
(braket
l_int|1
)braket
op_increment
suffix:semicolon
macro_line|#endif&t;
r_return
(paren
(paren
id|p
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_int
DECL|function|pcibios_present
id|pcibios_present
(paren
r_void
)paren
(brace
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;PCI [BIOS] present?&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_int
DECL|function|pcibios_read_config_dword
id|pcibios_read_config_dword
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
op_star
id|val
)paren
(brace
r_int
r_int
id|_val
suffix:semicolon
r_int
r_int
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;PCI Read config dword[%d.%d.%x] = &quot;
comma
id|bus
comma
id|dev
comma
id|offset
)paren
suffix:semicolon
macro_line|#endif&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
op_star
id|val
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
)paren
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;[%x] &quot;
comma
id|ptr
)paren
suffix:semicolon
macro_line|#endif&t;&t;
id|_val
op_assign
id|_LE_to_BE_long
c_func
(paren
op_star
id|ptr
)paren
suffix:semicolon
)brace
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;%x&bslash;n&quot;
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;
op_star
id|val
op_assign
id|_val
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_read_config_word
id|pcibios_read_config_word
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
op_star
id|val
)paren
(brace
r_int
r_int
id|_val
suffix:semicolon
r_int
r_int
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;PCI Read config word[%d.%d.%x] = &quot;
comma
id|bus
comma
id|dev
comma
id|offset
)paren
suffix:semicolon
macro_line|#endif&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
op_star
id|val
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
)paren
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;[%x] &quot;
comma
id|ptr
)paren
suffix:semicolon
macro_line|#endif&t;&t;
id|_val
op_assign
id|_LE_to_BE_short
c_func
(paren
op_star
id|ptr
)paren
suffix:semicolon
)brace
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;%x&bslash;n&quot;
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;&t;
op_star
id|val
op_assign
id|_val
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_read_config_byte
id|pcibios_read_config_byte
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_char
op_star
id|val
)paren
(brace
r_int
r_char
id|_val
suffix:semicolon
r_volatile
r_int
r_char
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
multiline_comment|/* Note: the configuration registers don&squot;t always have this right! */
r_if
c_cond
(paren
id|offset
op_eq
id|PCI_INTERRUPT_LINE
)paren
(brace
r_if
c_cond
(paren
id|Motherboard_map
(braket
id|dev
)braket
op_le
l_int|4
)paren
(brace
op_star
id|val
op_assign
id|Motherboard_routes
(braket
id|Motherboard_map
(braket
id|dev
)braket
)braket
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Pseudo interrupts [for BeBox] */
op_star
id|val
op_assign
id|Motherboard_map
(braket
id|dev
)braket
suffix:semicolon
)brace
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;PCI Read Interrupt Line[%d.%d] = %d&bslash;n&quot;
comma
id|bus
comma
id|dev
comma
op_star
id|val
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;PCI Read config byte[%d.%d.%x] = &quot;
comma
id|bus
comma
id|dev
comma
id|offset
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
op_star
id|val
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
op_xor
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;[%x] &quot;
comma
id|ptr
)paren
suffix:semicolon
macro_line|#endif&t;&t;
id|_val
op_assign
op_star
id|ptr
suffix:semicolon
)brace
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;%x&bslash;n&quot;
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif
op_star
id|val
op_assign
id|_val
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_write_config_dword
id|pcibios_write_config_dword
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|_val
suffix:semicolon
r_int
r_int
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
id|_val
op_assign
id|_LE_to_BE_long
c_func
(paren
id|val
)paren
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;PCI Write config dword[%d.%d.%x] = %x&bslash;n&quot;
comma
id|bus
comma
id|dev
comma
id|offset
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|_val
suffix:semicolon
)brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_write_config_word
id|pcibios_write_config_word
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|_val
suffix:semicolon
r_int
r_int
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
id|_val
op_assign
id|_LE_to_BE_short
c_func
(paren
id|val
)paren
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;PCI Write config word[%d.%d.%x] = %x&bslash;n&quot;
comma
id|bus
comma
id|dev
comma
id|offset
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|_val
suffix:semicolon
)brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_write_config_byte
id|pcibios_write_config_byte
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_char
id|val
)paren
(brace
r_int
r_char
id|_val
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
id|_val
op_assign
id|val
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;PCI Write config byte[%d.%d.%x] = %x&bslash;n&quot;
comma
id|bus
comma
id|dev
comma
id|offset
comma
id|_val
)paren
suffix:semicolon
macro_line|#endif&t;&t;
r_if
c_cond
(paren
(paren
id|bus
op_ne
l_int|0
)paren
op_logical_or
(paren
id|dev
OL
l_int|11
)paren
op_logical_or
(paren
id|dev
OG
l_int|16
)paren
)paren
(brace
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
l_int|0x80800000
op_or
(paren
l_int|1
op_lshift
id|dev
)paren
op_or
id|offset
op_xor
l_int|1
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|_val
suffix:semicolon
)brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|pcibios_find_device
id|pcibios_find_device
(paren
r_int
r_int
id|vendor
comma
r_int
r_int
id|device_id
comma
r_int
r_int
id|index
comma
r_int
r_char
op_star
id|bus
comma
r_int
r_char
op_star
id|dev
)paren
(brace
r_int
r_int
id|w
comma
id|desired
op_assign
(paren
id|device_id
op_lshift
l_int|16
)paren
op_or
id|vendor
suffix:semicolon
r_int
id|devnr
suffix:semicolon
r_if
c_cond
(paren
id|vendor
op_eq
l_int|0xffff
)paren
(brace
r_return
id|PCIBIOS_BAD_VENDOR_ID
suffix:semicolon
)brace
r_for
c_loop
(paren
id|devnr
op_assign
l_int|11
suffix:semicolon
id|devnr
OL
l_int|16
suffix:semicolon
id|devnr
op_increment
)paren
(brace
id|pcibios_read_config_dword
c_func
(paren
l_int|0
comma
id|devnr
op_lshift
l_int|3
comma
id|PCI_VENDOR_ID
comma
op_amp
id|w
)paren
suffix:semicolon
r_if
c_cond
(paren
id|w
op_eq
id|desired
)paren
(brace
r_if
c_cond
(paren
id|index
op_eq
l_int|0
)paren
(brace
op_star
id|bus
op_assign
l_int|0
suffix:semicolon
op_star
id|dev
op_assign
id|devnr
op_lshift
l_int|3
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
op_decrement
id|index
suffix:semicolon
)brace
)brace
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_int
DECL|function|pcibios_find_class
id|pcibios_find_class
(paren
r_int
r_int
id|class_code
comma
r_int
r_int
id|index
comma
r_int
r_char
op_star
id|bus
comma
r_int
r_char
op_star
id|dev
)paren
(brace
r_int
id|dev_nr
comma
r_class
comma
id|indx
suffix:semicolon
id|indx
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef PCI_DEBUG&t;
id|printk
c_func
(paren
l_string|&quot;pcibios_find_class - class: %x, index: %x&quot;
comma
id|class_code
comma
id|index
)paren
suffix:semicolon
macro_line|#endif&t;
r_for
c_loop
(paren
id|dev_nr
op_assign
l_int|11
suffix:semicolon
id|dev_nr
OL
l_int|16
suffix:semicolon
id|dev_nr
op_increment
)paren
(brace
id|pcibios_read_config_dword
c_func
(paren
l_int|0
comma
id|dev_nr
op_lshift
l_int|3
comma
id|PCI_CLASS_REVISION
comma
op_amp
r_class
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_class
op_rshift
l_int|8
)paren
op_eq
id|class_code
)paren
(brace
r_if
c_cond
(paren
id|index
op_eq
id|indx
)paren
(brace
op_star
id|bus
op_assign
l_int|0
suffix:semicolon
op_star
id|dev
op_assign
id|dev_nr
op_lshift
l_int|3
suffix:semicolon
macro_line|#ifdef PCI_DEBUG
id|printk
c_func
(paren
l_string|&quot; - device: %x&bslash;n&quot;
comma
id|dev_nr
)paren
suffix:semicolon
macro_line|#endif&t;
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|indx
op_increment
suffix:semicolon
)brace
)brace
macro_line|#ifdef PCI_DEBUG
id|printk
c_func
(paren
l_string|&quot; - not found&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif&t;
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
DECL|function|pcibios_strerror
r_const
r_char
op_star
id|pcibios_strerror
c_func
(paren
r_int
id|error
)paren
(brace
r_static
r_char
id|buf
(braket
l_int|32
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|error
)paren
(brace
r_case
id|PCIBIOS_SUCCESSFUL
suffix:colon
r_return
(paren
l_string|&quot;PCI BIOS: no error&quot;
)paren
suffix:semicolon
r_case
id|PCIBIOS_FUNC_NOT_SUPPORTED
suffix:colon
r_return
(paren
l_string|&quot;PCI BIOS: function not supported&quot;
)paren
suffix:semicolon
r_case
id|PCIBIOS_BAD_VENDOR_ID
suffix:colon
r_return
(paren
l_string|&quot;PCI BIOS: bad vendor ID&quot;
)paren
suffix:semicolon
r_case
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:colon
r_return
(paren
l_string|&quot;PCI BIOS: device not found&quot;
)paren
suffix:semicolon
r_case
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:colon
r_return
(paren
l_string|&quot;PCI BIOS: bad register number&quot;
)paren
suffix:semicolon
r_case
id|PCIBIOS_SET_FAILED
suffix:colon
r_return
(paren
l_string|&quot;PCI BIOS: set failed&quot;
)paren
suffix:semicolon
r_case
id|PCIBIOS_BUFFER_TOO_SMALL
suffix:colon
r_return
(paren
l_string|&quot;PCI BIOS: buffer too small&quot;
)paren
suffix:semicolon
r_default
suffix:colon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;PCI BIOS: invalid error #%d&quot;
comma
id|error
)paren
suffix:semicolon
r_return
id|buf
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Note: This routine has to access the PCI configuration space&n; * for the PCI bridge chip (Intel 82378).&n; */
DECL|function|route_PCI_interrupts
r_void
id|route_PCI_interrupts
c_func
(paren
r_void
)paren
(brace
r_int
r_char
op_star
id|ibc_pirq
op_assign
(paren
r_int
r_char
op_star
)paren
l_int|0x80800860
suffix:semicolon
r_int
r_char
op_star
id|ibc_pcicon
op_assign
(paren
r_int
r_char
op_star
)paren
l_int|0x80800840
suffix:semicolon
r_extern
r_int
r_int
id|isBeBox
(braket
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Decide which motherboard this is &amp; how the PCI interrupts are routed */
r_if
c_cond
(paren
id|isBeBox
(braket
l_int|0
)braket
)paren
(brace
id|Motherboard_map
op_assign
id|BeBox_pci_IRQ_map
suffix:semicolon
id|Motherboard_routes
op_assign
id|BeBox_pci_IRQ_routes
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Motorola hardware */
r_switch
c_cond
(paren
id|inb
c_func
(paren
l_int|0x800
)paren
op_amp
l_int|0xF0
)paren
(brace
r_case
l_int|0x10
suffix:colon
multiline_comment|/* MVME16xx */
id|Motherboard_map
op_assign
id|Genesis_pci_IRQ_map
suffix:semicolon
id|Motherboard_routes
op_assign
id|Genesis_pci_IRQ_routes
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x20
suffix:colon
multiline_comment|/* Series E */
id|Motherboard_map
op_assign
id|Comet_pci_IRQ_map
suffix:semicolon
id|Motherboard_routes
op_assign
id|Comet_pci_IRQ_routes
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x40
suffix:colon
multiline_comment|/* PowerStack */
r_default
suffix:colon
multiline_comment|/* Can&squot;t hurt, can it? */
id|Motherboard_map
op_assign
id|Blackhawk_pci_IRQ_map
suffix:semicolon
id|Motherboard_routes
op_assign
id|Blackhawk_pci_IRQ_routes
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Set up mapping from slots */
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ibc_pirq
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|Motherboard_routes
(braket
id|i
)braket
suffix:semicolon
)brace
multiline_comment|/* Enable PCI interrupts */
op_star
id|ibc_pcicon
op_or_assign
l_int|0x20
suffix:semicolon
)brace
eof
