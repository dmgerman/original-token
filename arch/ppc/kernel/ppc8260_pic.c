macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/immap_8260.h&gt;
macro_line|#include &lt;asm/mpc8260.h&gt;
macro_line|#include &quot;ppc8260_pic.h&quot;
multiline_comment|/* The 8260 internal interrupt controller.  It is usually&n; * the only interrupt controller.&n; * There are two 32-bit registers (high/low) for up to 64&n; * possible interrupts.&n; *&n; * Now, the fun starts.....Interrupt Numbers DO NOT MAP&n; * in a simple arithmetic fashion to mask or pending registers.&n; * That is, interrupt 4 does not map to bit position 4.&n; * We create two tables, indexed by vector number, to indicate&n; * which register to use and which bit in the register to use.&n; */
DECL|variable|irq_to_siureg
r_static
id|u_char
id|irq_to_siureg
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|irq_to_siubit
r_static
id|u_char
id|irq_to_siubit
(braket
)braket
op_assign
(brace
l_int|31
comma
l_int|16
comma
l_int|17
comma
l_int|18
comma
l_int|19
comma
l_int|20
comma
l_int|21
comma
l_int|22
comma
l_int|23
comma
l_int|24
comma
l_int|25
comma
l_int|26
comma
l_int|27
comma
l_int|28
comma
l_int|29
comma
l_int|30
comma
l_int|29
comma
l_int|30
comma
l_int|16
comma
l_int|17
comma
l_int|18
comma
l_int|19
comma
l_int|20
comma
l_int|21
comma
l_int|22
comma
l_int|23
comma
l_int|24
comma
l_int|25
comma
l_int|26
comma
l_int|27
comma
l_int|28
comma
l_int|31
comma
l_int|0
comma
l_int|1
comma
l_int|2
comma
l_int|3
comma
l_int|4
comma
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|8
comma
l_int|9
comma
l_int|10
comma
l_int|11
comma
l_int|12
comma
l_int|13
comma
l_int|14
comma
l_int|15
comma
l_int|15
comma
l_int|14
comma
l_int|13
comma
l_int|12
comma
l_int|11
comma
l_int|10
comma
l_int|9
comma
l_int|8
comma
l_int|7
comma
l_int|6
comma
l_int|5
comma
l_int|4
comma
l_int|3
comma
l_int|2
comma
l_int|1
comma
l_int|0
)brace
suffix:semicolon
DECL|function|m8260_mask_irq
r_static
r_void
id|m8260_mask_irq
c_func
(paren
r_int
r_int
id|irq_nr
)paren
(brace
r_int
id|bit
comma
id|word
suffix:semicolon
r_volatile
id|uint
op_star
id|simr
suffix:semicolon
id|bit
op_assign
id|irq_to_siubit
(braket
id|irq_nr
)braket
suffix:semicolon
id|word
op_assign
id|irq_to_siureg
(braket
id|irq_nr
)braket
suffix:semicolon
id|simr
op_assign
op_amp
(paren
id|immr-&gt;im_intctl.ic_simrh
)paren
suffix:semicolon
id|ppc_cached_irq_mask
(braket
id|word
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
l_int|31
op_minus
id|bit
)paren
)paren
suffix:semicolon
id|simr
(braket
id|word
)braket
op_assign
id|ppc_cached_irq_mask
(braket
id|word
)braket
suffix:semicolon
)brace
DECL|function|m8260_unmask_irq
r_static
r_void
id|m8260_unmask_irq
c_func
(paren
r_int
r_int
id|irq_nr
)paren
(brace
r_int
id|bit
comma
id|word
suffix:semicolon
r_volatile
id|uint
op_star
id|simr
suffix:semicolon
id|bit
op_assign
id|irq_to_siubit
(braket
id|irq_nr
)braket
suffix:semicolon
id|word
op_assign
id|irq_to_siureg
(braket
id|irq_nr
)braket
suffix:semicolon
id|simr
op_assign
op_amp
(paren
id|immr-&gt;im_intctl.ic_simrh
)paren
suffix:semicolon
id|ppc_cached_irq_mask
(braket
id|word
)braket
op_or_assign
(paren
l_int|1
op_lshift
(paren
l_int|31
op_minus
id|bit
)paren
)paren
suffix:semicolon
id|simr
(braket
id|word
)braket
op_assign
id|ppc_cached_irq_mask
(braket
id|word
)braket
suffix:semicolon
)brace
DECL|function|m8260_mask_and_ack
r_static
r_void
id|m8260_mask_and_ack
c_func
(paren
r_int
r_int
id|irq_nr
)paren
(brace
r_int
id|bit
comma
id|word
suffix:semicolon
r_volatile
id|uint
op_star
id|simr
comma
op_star
id|sipnr
suffix:semicolon
id|bit
op_assign
id|irq_to_siubit
(braket
id|irq_nr
)braket
suffix:semicolon
id|word
op_assign
id|irq_to_siureg
(braket
id|irq_nr
)braket
suffix:semicolon
id|simr
op_assign
op_amp
(paren
id|immr-&gt;im_intctl.ic_simrh
)paren
suffix:semicolon
id|sipnr
op_assign
op_amp
(paren
id|immr-&gt;im_intctl.ic_sipnrh
)paren
suffix:semicolon
id|ppc_cached_irq_mask
(braket
id|word
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
l_int|31
op_minus
id|bit
)paren
)paren
suffix:semicolon
id|simr
(braket
id|word
)braket
op_assign
id|ppc_cached_irq_mask
(braket
id|word
)braket
suffix:semicolon
id|sipnr
(braket
id|word
)braket
op_assign
l_int|1
op_lshift
(paren
l_int|31
op_minus
id|bit
)paren
suffix:semicolon
)brace
DECL|variable|ppc8260_pic
r_struct
id|hw_interrupt_type
id|ppc8260_pic
op_assign
(brace
l_string|&quot; 8260 SIU  &quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|m8260_unmask_irq
comma
id|m8260_mask_irq
comma
id|m8260_mask_and_ack
comma
l_int|0
)brace
suffix:semicolon
r_int
DECL|function|m8260_get_irq
id|m8260_get_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|irq
suffix:semicolon
r_int
r_int
id|bits
suffix:semicolon
multiline_comment|/* For MPC8260, read the SIVEC register and shift the bits down&n;         * to get the irq number.         */
id|bits
op_assign
id|immr-&gt;im_intctl.ic_sivec
suffix:semicolon
id|irq
op_assign
id|bits
op_rshift
l_int|26
suffix:semicolon
macro_line|#if 0
id|irq
op_add_assign
id|ppc8260_pic.irq_offset
suffix:semicolon
macro_line|#endif
r_return
id|irq
suffix:semicolon
)brace
eof
