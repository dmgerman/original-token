multiline_comment|/*&n; *  linux/arch/ppc/kernel/traps.c&n; *&n; *  Copyright (C) 1995  Gary Thomas&n; *  Adapted for PowerPC by Gary Thomas&n; *  Modified by Cort Dougan (cort@cs.nmt.edu)&n; */
multiline_comment|/*&n; * This file handles the architecture-dependent parts of hardware exceptions&n; */
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/user.h&gt;
macro_line|#include &lt;linux/a.out.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
multiline_comment|/*&n; * Trap &amp; Exception support&n; */
r_void
DECL|function|trap_init
id|trap_init
c_func
(paren
r_void
)paren
(brace
)brace
r_void
DECL|function|_exception
id|_exception
c_func
(paren
r_int
id|signr
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|user_mode
c_func
(paren
id|regs
)paren
)paren
(brace
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
id|print_backtrace
c_func
(paren
id|regs-&gt;gpr
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Exception in kernel pc %x signal %d&quot;
comma
id|regs-&gt;nip
comma
id|signr
)paren
suffix:semicolon
)brace
id|force_sig
c_func
(paren
id|signr
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|MachineCheckException
id|MachineCheckException
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|user_mode
c_func
(paren
id|regs
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Machine check in kernel mode.&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Caused by (from msr): &quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;regs %08x &quot;
comma
id|regs
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|regs-&gt;msr
op_amp
l_int|0x0000F000
)paren
(brace
r_case
(paren
l_int|1
op_lshift
l_int|12
)paren
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Machine check signal - probably due to mm fault&bslash;n&quot;
l_string|&quot;with mmu off&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|1
op_lshift
l_int|13
)paren
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Transfer error ack signal&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|1
op_lshift
l_int|14
)paren
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Data parity signal&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|1
op_lshift
l_int|15
)paren
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Address parity signal&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Unknown values in msr&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
id|print_backtrace
c_func
(paren
id|regs-&gt;gpr
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
id|_exception
c_func
(paren
id|SIGSEGV
comma
id|regs
)paren
suffix:semicolon
)brace
r_void
DECL|function|UnknownException
id|UnknownException
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad trap at PC: %lx, SR: %lx, vector=%lx&bslash;n&quot;
comma
id|regs-&gt;nip
comma
id|regs-&gt;msr
comma
id|regs-&gt;trap
)paren
suffix:semicolon
id|_exception
c_func
(paren
id|SIGTRAP
comma
id|regs
)paren
suffix:semicolon
)brace
r_void
DECL|function|InstructionBreakpoint
id|InstructionBreakpoint
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
macro_line|#ifdef CONFIG_XMON
r_if
c_cond
(paren
id|xmon_iabr_match
c_func
(paren
id|regs
)paren
)paren
r_return
suffix:semicolon
macro_line|#endif
id|_exception
c_func
(paren
id|SIGTRAP
comma
id|regs
)paren
suffix:semicolon
)brace
r_void
DECL|function|RunModeException
id|RunModeException
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|_exception
c_func
(paren
id|SIGTRAP
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|ProgramCheckException
id|ProgramCheckException
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;flags
op_amp
id|PF_PTRACED
)paren
id|_exception
c_func
(paren
id|SIGTRAP
comma
id|regs
)paren
suffix:semicolon
r_else
id|_exception
c_func
(paren
id|SIGILL
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|SingleStepException
id|SingleStepException
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|regs-&gt;msr
op_and_assign
op_complement
id|MSR_SE
suffix:semicolon
multiline_comment|/* Turn off &squot;trace&squot; bit */
id|_exception
c_func
(paren
id|SIGTRAP
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|AlignmentException
id|AlignmentException
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|_exception
c_func
(paren
id|SIGBUS
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|trace_syscall
id|trace_syscall
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_static
r_int
id|count
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Task: %08X(%d), PC: %08X/%08X, Syscall: %3d, Result: %s%d&bslash;n&quot;
comma
id|current
comma
id|current-&gt;pid
comma
id|regs-&gt;nip
comma
id|regs-&gt;link
comma
id|regs-&gt;gpr
(braket
l_int|0
)braket
comma
id|regs-&gt;ccr
op_amp
l_int|0x10000000
ques
c_cond
l_string|&quot;Error=&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|regs-&gt;gpr
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|count
op_eq
l_int|20
)paren
(brace
id|count
op_assign
l_int|0
suffix:semicolon
)brace
)brace
eof
