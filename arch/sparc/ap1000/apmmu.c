multiline_comment|/*&n;   * Copyright 1996 The Australian National University.&n;   * Copyright 1996 Fujitsu Laboratories Limited&n;   * &n;   * This software may be distributed under the terms of the Gnu&n;   * Public License version 2 or later&n;  */
multiline_comment|/* &n; * apmmu.c:  mmu routines for the AP1000&n; *&n; * based on srmmu.c &n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/kdebug.h&gt;
macro_line|#include &lt;asm/vaddrs.h&gt;
macro_line|#include &lt;asm/traps.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/mbus.h&gt;
macro_line|#include &lt;asm/cache.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/iommu.h&gt;
macro_line|#include &lt;asm/asi.h&gt;
macro_line|#include &lt;asm/msi.h&gt;
macro_line|#include &lt;asm/a.out.h&gt;
macro_line|#include &lt;asm/ap1000/pgtapmmu.h&gt;
macro_line|#include &lt;asm/viking.h&gt;
DECL|variable|mmu_getpage
r_static
r_int
r_int
(paren
op_star
id|mmu_getpage
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|ctxd_set
r_static
r_void
(paren
op_star
id|ctxd_set
)paren
(paren
id|ctxd_t
op_star
id|ctxp
comma
id|pgd_t
op_star
id|pgdp
)paren
suffix:semicolon
DECL|variable|pmd_set
r_static
r_void
(paren
op_star
id|pmd_set
)paren
(paren
id|pmd_t
op_star
id|pmdp
comma
id|pte_t
op_star
id|ptep
)paren
suffix:semicolon
DECL|variable|flush_page_for_dma
r_static
r_void
(paren
op_star
id|flush_page_for_dma
)paren
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
DECL|variable|flush_cache_page_to_uncache
r_static
r_void
(paren
op_star
id|flush_cache_page_to_uncache
)paren
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
DECL|variable|flush_tlb_page_for_cbit
r_static
r_void
(paren
op_star
id|flush_tlb_page_for_cbit
)paren
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
r_extern
r_void
id|mc_tlb_flush_all
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|struct|apmmu_stats
r_static
r_struct
id|apmmu_stats
(brace
DECL|member|invall
r_int
id|invall
suffix:semicolon
DECL|member|invpg
r_int
id|invpg
suffix:semicolon
DECL|member|invrnge
r_int
id|invrnge
suffix:semicolon
DECL|member|invmm
r_int
id|invmm
suffix:semicolon
DECL|variable|module_stats
)brace
id|module_stats
suffix:semicolon
DECL|variable|apmmu_name
r_static
r_char
op_star
id|apmmu_name
suffix:semicolon
DECL|variable|apmmu_ctx_table_phys
r_static
id|ctxd_t
op_star
id|apmmu_ctx_table_phys
suffix:semicolon
DECL|variable|apmmu_context_table
r_static
id|ctxd_t
op_star
id|apmmu_context_table
suffix:semicolon
DECL|variable|ap_mem_size
r_static
r_int
r_int
id|ap_mem_size
suffix:semicolon
DECL|variable|mempool
r_static
r_int
r_int
id|mempool
suffix:semicolon
DECL|function|apmmu_v2p
r_static
r_inline
r_int
r_int
id|apmmu_v2p
c_func
(paren
r_int
r_int
id|vaddr
)paren
(brace
r_if
c_cond
(paren
id|KERNBASE
op_le
id|vaddr
op_logical_and
(paren
id|KERNBASE
op_plus
id|ap_mem_size
OG
id|vaddr
)paren
)paren
(brace
r_return
(paren
id|vaddr
op_minus
id|KERNBASE
)paren
suffix:semicolon
)brace
r_return
l_int|0xffffffffUL
suffix:semicolon
)brace
DECL|function|apmmu_p2v
r_static
r_inline
r_int
r_int
id|apmmu_p2v
c_func
(paren
r_int
r_int
id|paddr
)paren
(brace
r_if
c_cond
(paren
id|ap_mem_size
OG
id|paddr
)paren
r_return
(paren
id|paddr
op_plus
id|KERNBASE
)paren
suffix:semicolon
r_return
l_int|0xffffffffUL
suffix:semicolon
)brace
multiline_comment|/* In general all page table modifications should use the V8 atomic&n; * swap instruction.  This insures the mmu and the cpu are in sync&n; * with respect to ref/mod bits in the page tables.&n; */
DECL|function|apmmu_swap
r_static
r_inline
r_int
r_int
id|apmmu_swap
c_func
(paren
r_int
r_int
op_star
id|addr
comma
r_int
r_int
id|value
)paren
(brace
multiline_comment|/* the AP1000 has its memory on bus 8, not 0 like suns do */
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0xF0000000
)paren
op_eq
l_int|0
)paren
id|value
op_or_assign
id|MEM_BUS_SPACE
op_lshift
l_int|28
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;swap [%2], %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|value
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|value
)paren
comma
l_string|&quot;r&quot;
(paren
id|addr
)paren
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/* Functions really use this, not apmmu_swap directly. */
DECL|macro|apmmu_set_entry
mdefine_line|#define apmmu_set_entry(ptr, newentry) &bslash;&n;        apmmu_swap((unsigned long *) (ptr), (newentry))
multiline_comment|/* The very generic APMMU page table operations. */
DECL|function|apmmu_pmd_align
r_static
r_int
r_int
id|apmmu_pmd_align
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|APMMU_PMD_ALIGN
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pgdir_align
r_static
r_int
r_int
id|apmmu_pgdir_align
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|APMMU_PGDIR_ALIGN
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|apmmu_vmalloc_start
r_static
r_int
r_int
id|apmmu_vmalloc_start
c_func
(paren
r_void
)paren
(brace
r_return
id|APMMU_VMALLOC_START
suffix:semicolon
)brace
DECL|function|apmmu_device_memory
r_static
r_inline
r_int
id|apmmu_device_memory
c_func
(paren
r_int
r_int
id|x
)paren
(brace
r_return
(paren
(paren
id|x
op_amp
l_int|0xF0000000
)paren
op_ne
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pgd_page
r_static
r_int
r_int
id|apmmu_pgd_page
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
id|apmmu_device_memory
c_func
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
)paren
ques
c_cond
op_complement
l_int|0
suffix:colon
id|apmmu_p2v
c_func
(paren
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|APMMU_PTD_PMASK
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pmd_page
r_static
r_int
r_int
id|apmmu_pmd_page
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
id|apmmu_device_memory
c_func
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
)paren
ques
c_cond
op_complement
l_int|0
suffix:colon
id|apmmu_p2v
c_func
(paren
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|APMMU_PTD_PMASK
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_page
r_static
r_int
r_int
id|apmmu_pte_page
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|apmmu_device_memory
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
)paren
ques
c_cond
op_complement
l_int|0
suffix:colon
id|apmmu_p2v
c_func
(paren
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|APMMU_PTE_PMASK
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_none
r_static
r_int
id|apmmu_pte_none
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
op_logical_neg
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
l_int|0xFFFFFFF
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_present
r_static
r_int
id|apmmu_pte_present
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
(paren
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|APMMU_ET_MASK
)paren
op_eq
id|APMMU_ET_PTE
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_clear
r_static
r_void
id|apmmu_pte_clear
c_func
(paren
id|pte_t
op_star
id|ptep
)paren
(brace
id|set_pte
c_func
(paren
id|ptep
comma
id|__pte
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pmd_none
r_static
r_int
id|apmmu_pmd_none
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
op_logical_neg
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
l_int|0xFFFFFFF
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pmd_bad
r_static
r_int
id|apmmu_pmd_bad
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|APMMU_ET_MASK
)paren
op_ne
id|APMMU_ET_PTD
suffix:semicolon
)brace
DECL|function|apmmu_pmd_present
r_static
r_int
id|apmmu_pmd_present
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|APMMU_ET_MASK
)paren
op_eq
id|APMMU_ET_PTD
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pmd_clear
r_static
r_void
id|apmmu_pmd_clear
c_func
(paren
id|pmd_t
op_star
id|pmdp
)paren
(brace
id|set_pte
c_func
(paren
(paren
id|pte_t
op_star
)paren
id|pmdp
comma
id|__pte
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pgd_none
r_static
r_int
id|apmmu_pgd_none
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
op_logical_neg
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
l_int|0xFFFFFFF
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pgd_bad
r_static
r_int
id|apmmu_pgd_bad
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|APMMU_ET_MASK
)paren
op_ne
id|APMMU_ET_PTD
suffix:semicolon
)brace
DECL|function|apmmu_pgd_present
r_static
r_int
id|apmmu_pgd_present
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
(paren
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|APMMU_ET_MASK
)paren
op_eq
id|APMMU_ET_PTD
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pgd_clear
r_static
r_void
id|apmmu_pgd_clear
c_func
(paren
id|pgd_t
op_star
id|pgdp
)paren
(brace
id|set_pte
c_func
(paren
(paren
id|pte_t
op_star
)paren
id|pgdp
comma
id|__pte
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_write
r_static
r_int
id|apmmu_pte_write
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|APMMU_WRITE
suffix:semicolon
)brace
DECL|function|apmmu_pte_dirty
r_static
r_int
id|apmmu_pte_dirty
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|APMMU_DIRTY
suffix:semicolon
)brace
DECL|function|apmmu_pte_young
r_static
r_int
id|apmmu_pte_young
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|APMMU_REF
suffix:semicolon
)brace
DECL|function|apmmu_pte_wrprotect
r_static
id|pte_t
id|apmmu_pte_wrprotect
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
op_complement
id|APMMU_WRITE
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_mkclean
r_static
id|pte_t
id|apmmu_pte_mkclean
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
op_complement
id|APMMU_DIRTY
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_mkold
r_static
id|pte_t
id|apmmu_pte_mkold
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
op_complement
id|APMMU_REF
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_mkwrite
r_static
id|pte_t
id|apmmu_pte_mkwrite
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_or
id|APMMU_WRITE
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_mkdirty
r_static
id|pte_t
id|apmmu_pte_mkdirty
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_or
id|APMMU_DIRTY
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_mkyoung
r_static
id|pte_t
id|apmmu_pte_mkyoung
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_or
id|APMMU_REF
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Conversion functions: convert a page and protection to a page entry,&n; * and a page entry and page directory to the page they refer to.&n; */
DECL|function|apmmu_mk_pte
r_static
id|pte_t
id|apmmu_mk_pte
c_func
(paren
r_int
r_int
id|page
comma
id|pgprot_t
id|pgprot
)paren
(brace
r_return
id|__pte
c_func
(paren
(paren
(paren
id|apmmu_v2p
c_func
(paren
id|page
)paren
)paren
op_rshift
l_int|4
)paren
op_or
id|pgprot_val
c_func
(paren
id|pgprot
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_mk_pte_phys
r_static
id|pte_t
id|apmmu_mk_pte_phys
c_func
(paren
r_int
r_int
id|page
comma
id|pgprot_t
id|pgprot
)paren
(brace
r_return
id|__pte
c_func
(paren
(paren
(paren
id|page
)paren
op_rshift
l_int|4
)paren
op_or
id|pgprot_val
c_func
(paren
id|pgprot
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_mk_pte_io
r_static
id|pte_t
id|apmmu_mk_pte_io
c_func
(paren
r_int
r_int
id|page
comma
id|pgprot_t
id|pgprot
comma
r_int
id|space
)paren
(brace
r_return
id|__pte
c_func
(paren
(paren
(paren
id|page
)paren
op_rshift
l_int|4
)paren
op_or
(paren
id|space
op_lshift
l_int|28
)paren
op_or
id|pgprot_val
c_func
(paren
id|pgprot
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_ctxd_set
r_static
r_void
id|apmmu_ctxd_set
c_func
(paren
id|ctxd_t
op_star
id|ctxp
comma
id|pgd_t
op_star
id|pgdp
)paren
(brace
id|set_pte
c_func
(paren
(paren
id|pte_t
op_star
)paren
id|ctxp
comma
(paren
id|APMMU_ET_PTD
op_or
(paren
id|apmmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|pgdp
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pgd_set
r_static
r_void
id|apmmu_pgd_set
c_func
(paren
id|pgd_t
op_star
id|pgdp
comma
id|pmd_t
op_star
id|pmdp
)paren
(brace
id|set_pte
c_func
(paren
(paren
id|pte_t
op_star
)paren
id|pgdp
comma
(paren
id|APMMU_ET_PTD
op_or
(paren
id|apmmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|pmdp
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pmd_set
r_static
r_void
id|apmmu_pmd_set
c_func
(paren
id|pmd_t
op_star
id|pmdp
comma
id|pte_t
op_star
id|ptep
)paren
(brace
id|set_pte
c_func
(paren
(paren
id|pte_t
op_star
)paren
id|pmdp
comma
(paren
id|APMMU_ET_PTD
op_or
(paren
id|apmmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|ptep
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_modify
r_static
id|pte_t
id|apmmu_pte_modify
c_func
(paren
id|pte_t
id|pte
comma
id|pgprot_t
id|newprot
)paren
(brace
r_return
id|__pte
c_func
(paren
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|APMMU_CHG_MASK
)paren
op_or
id|pgprot_val
c_func
(paren
id|newprot
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* to find an entry in a top-level page table... */
DECL|function|apmmu_pgd_offset
r_static
id|pgd_t
op_star
id|apmmu_pgd_offset
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|address
)paren
(brace
r_return
id|mm-&gt;pgd
op_plus
(paren
(paren
id|address
op_rshift
id|APMMU_PGDIR_SHIFT
)paren
op_amp
(paren
id|APMMU_PTRS_PER_PGD
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Find an entry in the second-level page table.. */
DECL|function|apmmu_pmd_offset
r_static
id|pmd_t
op_star
id|apmmu_pmd_offset
c_func
(paren
id|pgd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pmd_t
op_star
)paren
id|apmmu_pgd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|APMMU_PMD_SHIFT
)paren
op_amp
(paren
id|APMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Find an entry in the third-level page table.. */
DECL|function|apmmu_pte_offset
r_static
id|pte_t
op_star
id|apmmu_pte_offset
c_func
(paren
id|pmd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pte_t
op_star
)paren
id|apmmu_pmd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|APMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* This must update the context table entry for this process. */
DECL|function|apmmu_update_rootmmu_dir
r_static
r_void
id|apmmu_update_rootmmu_dir
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
id|pgd_t
op_star
id|pgdp
)paren
(brace
r_if
c_cond
(paren
id|tsk-&gt;mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
id|flush_cache_mm
c_func
(paren
id|current-&gt;mm
)paren
suffix:semicolon
id|ctxd_set
c_func
(paren
op_amp
id|apmmu_context_table
(braket
id|tsk-&gt;mm-&gt;context
)braket
comma
id|pgdp
)paren
suffix:semicolon
id|flush_tlb_mm
c_func
(paren
id|current-&gt;mm
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Accessing the MMU control register. */
DECL|function|apmmu_get_mmureg
r_static
r_inline
r_int
r_int
id|apmmu_get_mmureg
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|retval
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lda [%%g0] %1, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|retval
)paren
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_M_MMUREGS
)paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|apmmu_set_mmureg
r_static
r_inline
r_void
id|apmmu_set_mmureg
c_func
(paren
r_int
r_int
id|regval
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %0, [%%g0] %1&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|regval
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_MMUREGS
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
DECL|function|apmmu_set_ctable_ptr
r_static
r_inline
r_void
id|apmmu_set_ctable_ptr
c_func
(paren
r_int
r_int
id|paddr
)paren
(brace
id|paddr
op_assign
(paren
(paren
id|paddr
op_rshift
l_int|4
)paren
op_amp
id|APMMU_CTX_PMASK
)paren
suffix:semicolon
id|paddr
op_or_assign
(paren
id|MEM_BUS_SPACE
op_lshift
l_int|28
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %0, [%1] %2&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|paddr
)paren
comma
l_string|&quot;r&quot;
(paren
id|APMMU_CTXTBL_PTR
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_MMUREGS
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
DECL|function|apmmu_flush_whole_tlb
r_static
r_inline
r_void
id|apmmu_flush_whole_tlb
c_func
(paren
r_void
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %%g0, [%0] %1&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
l_int|0x400
)paren
comma
multiline_comment|/* Flush entire TLB!! */
l_string|&quot;i&quot;
(paren
id|ASI_M_FLUSH_PROBE
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* These flush types are not available on all chips... */
DECL|function|apmmu_flush_tlb_ctx
r_static
r_inline
r_void
id|apmmu_flush_tlb_ctx
c_func
(paren
r_void
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %%g0, [%0] %1&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
l_int|0x300
)paren
comma
multiline_comment|/* Flush TLB ctx.. */
l_string|&quot;i&quot;
(paren
id|ASI_M_FLUSH_PROBE
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
DECL|function|apmmu_flush_tlb_region
r_static
r_inline
r_void
id|apmmu_flush_tlb_region
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|addr
op_and_assign
id|APMMU_PGDIR_MASK
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %%g0, [%0] %1&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
op_or
l_int|0x200
)paren
comma
multiline_comment|/* Flush TLB region.. */
l_string|&quot;i&quot;
(paren
id|ASI_M_FLUSH_PROBE
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
DECL|function|apmmu_flush_tlb_segment
r_static
r_inline
r_void
id|apmmu_flush_tlb_segment
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|addr
op_and_assign
id|APMMU_PMD_MASK
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %%g0, [%0] %1&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
op_or
l_int|0x100
)paren
comma
multiline_comment|/* Flush TLB segment.. */
l_string|&quot;i&quot;
(paren
id|ASI_M_FLUSH_PROBE
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
DECL|function|apmmu_flush_tlb_page
r_static
r_inline
r_void
id|apmmu_flush_tlb_page
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|page
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %%g0, [%0] %1&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|page
)paren
comma
multiline_comment|/* Flush TLB page.. */
l_string|&quot;i&quot;
(paren
id|ASI_M_FLUSH_PROBE
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
DECL|function|apmmu_hwprobe
r_static
r_inline
r_int
r_int
id|apmmu_hwprobe
c_func
(paren
r_int
r_int
id|vaddr
)paren
(brace
r_int
r_int
id|retval
suffix:semicolon
id|vaddr
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lda [%1] %2, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|retval
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|vaddr
op_or
l_int|0x400
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_FLUSH_PROBE
)paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|apmmu_uncache_page
r_static
r_inline
r_void
id|apmmu_uncache_page
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|pgd_t
op_star
id|pgdp
op_assign
id|apmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|addr
)paren
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pgd_val
c_func
(paren
op_star
id|pgdp
)paren
op_amp
id|APMMU_ET_MASK
)paren
op_eq
id|APMMU_ET_PTE
)paren
(brace
id|ptep
op_assign
(paren
id|pte_t
op_star
)paren
id|pgdp
suffix:semicolon
)brace
r_else
(brace
id|pmdp
op_assign
id|apmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pmd_val
c_func
(paren
op_star
id|pmdp
)paren
op_amp
id|APMMU_ET_MASK
)paren
op_eq
id|APMMU_ET_PTE
)paren
(brace
id|ptep
op_assign
(paren
id|pte_t
op_star
)paren
id|pmdp
suffix:semicolon
)brace
r_else
(brace
id|ptep
op_assign
id|apmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|addr
)paren
suffix:semicolon
)brace
)brace
id|flush_cache_page_to_uncache
c_func
(paren
id|addr
)paren
suffix:semicolon
id|set_pte
c_func
(paren
id|ptep
comma
id|__pte
c_func
(paren
(paren
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_amp
op_complement
id|APMMU_CACHE
)paren
)paren
)paren
suffix:semicolon
id|flush_tlb_page_for_cbit
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|apmmu_recache_page
r_static
r_inline
r_void
id|apmmu_recache_page
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|pgd_t
op_star
id|pgdp
op_assign
id|apmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|addr
)paren
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pgd_val
c_func
(paren
op_star
id|pgdp
)paren
op_amp
id|APMMU_ET_MASK
)paren
op_eq
id|APMMU_ET_PTE
)paren
(brace
id|ptep
op_assign
(paren
id|pte_t
op_star
)paren
id|pgdp
suffix:semicolon
)brace
r_else
(brace
id|pmdp
op_assign
id|apmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pmd_val
c_func
(paren
op_star
id|pmdp
)paren
op_amp
id|APMMU_ET_MASK
)paren
op_eq
id|APMMU_ET_PTE
)paren
(brace
id|ptep
op_assign
(paren
id|pte_t
op_star
)paren
id|pmdp
suffix:semicolon
)brace
r_else
(brace
id|ptep
op_assign
id|apmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|addr
)paren
suffix:semicolon
)brace
)brace
id|set_pte
c_func
(paren
id|ptep
comma
id|__pte
c_func
(paren
(paren
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_or
id|APMMU_CACHE
)paren
)paren
)paren
suffix:semicolon
id|flush_tlb_page_for_cbit
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|apmmu_getpage
r_static
r_int
r_int
id|apmmu_getpage
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|page
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_return
id|page
suffix:semicolon
)brace
DECL|function|apmmu_putpage
r_static
r_inline
r_void
id|apmmu_putpage
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|free_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
multiline_comment|/* The easy versions. */
DECL|macro|NEW_PGD
mdefine_line|#define NEW_PGD() (pgd_t *) mmu_getpage()
DECL|macro|NEW_PMD
mdefine_line|#define NEW_PMD() (pmd_t *) mmu_getpage()
DECL|macro|NEW_PTE
mdefine_line|#define NEW_PTE() (pte_t *) mmu_getpage()
DECL|macro|FREE_PGD
mdefine_line|#define FREE_PGD(chunk) apmmu_putpage((unsigned long)(chunk))
DECL|macro|FREE_PMD
mdefine_line|#define FREE_PMD(chunk) apmmu_putpage((unsigned long)(chunk))
DECL|macro|FREE_PTE
mdefine_line|#define FREE_PTE(chunk) apmmu_putpage((unsigned long)(chunk))
multiline_comment|/*&n; * Allocate and free page tables. The xxx_kernel() versions are&n; * used to allocate a kernel page table - this turns on ASN bits&n; * if any, and marks the page tables reserved.&n; */
DECL|function|apmmu_pte_free_kernel
r_static
r_void
id|apmmu_pte_free_kernel
c_func
(paren
id|pte_t
op_star
id|pte
)paren
(brace
id|FREE_PTE
c_func
(paren
id|pte
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_alloc_kernel
r_static
id|pte_t
op_star
id|apmmu_pte_alloc_kernel
c_func
(paren
id|pmd_t
op_star
id|pmd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|APMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|pte_t
op_star
id|page
op_assign
id|NEW_PTE
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|pmd_set
c_func
(paren
id|pmd
comma
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|pmd_set
c_func
(paren
id|pmd
comma
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|FREE_PTE
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|apmmu_pmd_bad
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pmd in pte_alloc: %08lx&bslash;n&quot;
comma
id|pmd_val
c_func
(paren
op_star
id|pmd
)paren
)paren
suffix:semicolon
id|pmd_set
c_func
(paren
id|pmd
comma
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pte_t
op_star
)paren
id|apmmu_pmd_page
c_func
(paren
op_star
id|pmd
)paren
op_plus
id|address
suffix:semicolon
)brace
DECL|function|apmmu_pmd_free_kernel
r_static
r_void
id|apmmu_pmd_free_kernel
c_func
(paren
id|pmd_t
op_star
id|pmd
)paren
(brace
id|FREE_PMD
c_func
(paren
id|pmd
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pmd_alloc_kernel
r_static
id|pmd_t
op_star
id|apmmu_pmd_alloc_kernel
c_func
(paren
id|pgd_t
op_star
id|pgd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|APMMU_PMD_SHIFT
)paren
op_amp
(paren
id|APMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|pmd_t
op_star
id|page
suffix:semicolon
id|page
op_assign
id|NEW_PMD
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|pgd_set
c_func
(paren
id|pgd
comma
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|FREE_PMD
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|apmmu_pgd_bad
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pgd in pmd_alloc: %08lx&bslash;n&quot;
comma
id|pgd_val
c_func
(paren
op_star
id|pgd
)paren
)paren
suffix:semicolon
id|pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pmd_t
op_star
)paren
id|pgd_page
c_func
(paren
op_star
id|pgd
)paren
op_plus
id|address
suffix:semicolon
)brace
DECL|function|apmmu_pte_free
r_static
r_void
id|apmmu_pte_free
c_func
(paren
id|pte_t
op_star
id|pte
)paren
(brace
id|FREE_PTE
c_func
(paren
id|pte
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pte_alloc
r_static
id|pte_t
op_star
id|apmmu_pte_alloc
c_func
(paren
id|pmd_t
op_star
id|pmd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|APMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|pte_t
op_star
id|page
op_assign
id|NEW_PTE
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|pmd_set
c_func
(paren
id|pmd
comma
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|pmd_set
c_func
(paren
id|pmd
comma
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|FREE_PTE
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|apmmu_pmd_bad
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pmd in pte_alloc: %08lx&bslash;n&quot;
comma
id|pmd_val
c_func
(paren
op_star
id|pmd
)paren
)paren
suffix:semicolon
id|pmd_set
c_func
(paren
id|pmd
comma
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
(paren
id|pte_t
op_star
)paren
id|apmmu_pmd_page
c_func
(paren
op_star
id|pmd
)paren
)paren
op_plus
id|address
suffix:semicolon
)brace
multiline_comment|/* Real three-level page tables on APMMU. */
DECL|function|apmmu_pmd_free
r_static
r_void
id|apmmu_pmd_free
c_func
(paren
id|pmd_t
op_star
id|pmd
)paren
(brace
id|FREE_PMD
c_func
(paren
id|pmd
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pmd_alloc
r_static
id|pmd_t
op_star
id|apmmu_pmd_alloc
c_func
(paren
id|pgd_t
op_star
id|pgd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|APMMU_PMD_SHIFT
)paren
op_amp
(paren
id|APMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|pmd_t
op_star
id|page
op_assign
id|NEW_PMD
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|pgd_set
c_func
(paren
id|pgd
comma
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|FREE_PMD
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|apmmu_pgd_bad
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pgd in pmd_alloc: %08lx&bslash;n&quot;
comma
id|pgd_val
c_func
(paren
op_star
id|pgd
)paren
)paren
suffix:semicolon
id|pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pmd_t
op_star
)paren
id|apmmu_pgd_page
c_func
(paren
op_star
id|pgd
)paren
op_plus
id|address
suffix:semicolon
)brace
DECL|function|apmmu_pgd_free
r_static
r_void
id|apmmu_pgd_free
c_func
(paren
id|pgd_t
op_star
id|pgd
)paren
(brace
id|FREE_PGD
c_func
(paren
id|pgd
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pgd_alloc
r_static
id|pgd_t
op_star
id|apmmu_pgd_alloc
c_func
(paren
r_void
)paren
(brace
r_return
id|NEW_PGD
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_pgd_flush
r_static
r_void
id|apmmu_pgd_flush
c_func
(paren
id|pgd_t
op_star
id|pgdp
)paren
(brace
)brace
DECL|function|apmmu_set_pte_cacheable
r_static
r_void
id|apmmu_set_pte_cacheable
c_func
(paren
id|pte_t
op_star
id|ptep
comma
id|pte_t
id|pteval
)paren
(brace
id|apmmu_set_entry
c_func
(paren
id|ptep
comma
id|pte_val
c_func
(paren
id|pteval
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_quick_kernel_fault
r_static
r_void
id|apmmu_quick_kernel_fault
c_func
(paren
r_int
r_int
id|address
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Kernel faults at addr=0x%08lx&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PTE=%08lx&bslash;n&quot;
comma
id|apmmu_hwprobe
c_func
(paren
(paren
id|address
op_amp
id|PAGE_MASK
)paren
)paren
)paren
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;APMMU bolixed...&quot;
comma
id|current-&gt;tss.kregs
)paren
suffix:semicolon
)brace
DECL|function|alloc_context
r_static
r_inline
r_void
id|alloc_context
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|tsk-&gt;mm
suffix:semicolon
r_struct
id|ctx_list
op_star
id|ctxp
suffix:semicolon
r_if
c_cond
(paren
id|tsk-&gt;taskid
op_ge
id|MPP_TASK_BASE
)paren
(brace
id|mm-&gt;context
op_assign
id|MPP_CONTEXT_BASE
op_plus
(paren
id|tsk-&gt;taskid
op_minus
id|MPP_TASK_BASE
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ctxp
op_assign
id|ctx_free.next
suffix:semicolon
r_if
c_cond
(paren
id|ctxp
op_ne
op_amp
id|ctx_free
)paren
(brace
id|remove_from_ctx_list
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|add_to_used_ctxlist
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|mm-&gt;context
op_assign
id|ctxp-&gt;ctx_number
suffix:semicolon
id|ctxp-&gt;ctx_mm
op_assign
id|mm
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ctxp
op_assign
id|ctx_used.next
suffix:semicolon
r_if
c_cond
(paren
id|ctxp-&gt;ctx_mm
op_eq
id|current-&gt;mm
)paren
(brace
id|ctxp
op_assign
id|ctxp-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctxp
op_eq
op_amp
id|ctx_used
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;out of mmu contexts&quot;
)paren
suffix:semicolon
)brace
id|flush_cache_mm
c_func
(paren
id|ctxp-&gt;ctx_mm
)paren
suffix:semicolon
id|flush_tlb_mm
c_func
(paren
id|ctxp-&gt;ctx_mm
)paren
suffix:semicolon
id|remove_from_ctx_list
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|add_to_used_ctxlist
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|ctxp-&gt;ctx_mm-&gt;context
op_assign
id|NO_CONTEXT
suffix:semicolon
id|ctxp-&gt;ctx_mm
op_assign
id|mm
suffix:semicolon
id|mm-&gt;context
op_assign
id|ctxp-&gt;ctx_number
suffix:semicolon
)brace
DECL|function|free_context
r_static
r_inline
r_void
id|free_context
c_func
(paren
r_int
id|context
)paren
(brace
r_struct
id|ctx_list
op_star
id|ctx_old
suffix:semicolon
r_if
c_cond
(paren
id|context
op_ge
id|MPP_CONTEXT_BASE
)paren
r_return
suffix:semicolon
multiline_comment|/* nothing to do! */
id|ctx_old
op_assign
id|ctx_list_pool
op_plus
id|context
suffix:semicolon
id|remove_from_ctx_list
c_func
(paren
id|ctx_old
)paren
suffix:semicolon
id|add_to_free_ctxlist
c_func
(paren
id|ctx_old
)paren
suffix:semicolon
)brace
DECL|function|apmmu_switch_to_context
r_static
r_void
id|apmmu_switch_to_context
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
r_if
c_cond
(paren
id|tsk-&gt;mm-&gt;context
op_eq
id|NO_CONTEXT
)paren
(brace
id|alloc_context
c_func
(paren
id|tsk
)paren
suffix:semicolon
id|flush_cache_mm
c_func
(paren
id|current-&gt;mm
)paren
suffix:semicolon
id|ctxd_set
c_func
(paren
op_amp
id|apmmu_context_table
(braket
id|tsk-&gt;mm-&gt;context
)braket
comma
id|tsk-&gt;mm-&gt;pgd
)paren
suffix:semicolon
id|flush_tlb_mm
c_func
(paren
id|current-&gt;mm
)paren
suffix:semicolon
)brace
id|apmmu_set_context
c_func
(paren
id|tsk-&gt;mm-&gt;context
)paren
suffix:semicolon
)brace
DECL|function|apmmu_lockarea
r_static
r_char
op_star
id|apmmu_lockarea
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
)paren
(brace
r_return
id|vaddr
suffix:semicolon
)brace
DECL|function|apmmu_unlockarea
r_static
r_void
id|apmmu_unlockarea
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
)paren
(brace
)brace
DECL|function|apmmu_alloc_task_struct
r_struct
id|task_struct
op_star
id|apmmu_alloc_task_struct
c_func
(paren
r_void
)paren
(brace
r_return
(paren
r_struct
id|task_struct
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|task_struct
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
DECL|function|apmmu_alloc_kernel_stack
r_static
r_int
r_int
id|apmmu_alloc_kernel_stack
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
r_int
r_int
id|kstk
op_assign
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kstk
)paren
(brace
id|kstk
op_assign
(paren
r_int
r_int
)paren
id|vmalloc
c_func
(paren
id|PAGE_SIZE
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
r_return
id|kstk
suffix:semicolon
)brace
DECL|function|apmmu_free_task_struct
r_static
r_void
id|apmmu_free_task_struct
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
id|kfree
c_func
(paren
id|tsk
)paren
suffix:semicolon
)brace
DECL|function|apmmu_free_kernel_stack
r_static
r_void
id|apmmu_free_kernel_stack
c_func
(paren
r_int
r_int
id|stack
)paren
(brace
r_if
c_cond
(paren
id|stack
OL
id|VMALLOC_START
)paren
(brace
id|free_pages
c_func
(paren
id|stack
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
id|vfree
c_func
(paren
(paren
r_char
op_star
)paren
id|stack
)paren
suffix:semicolon
)brace
DECL|function|apmmu_null_func
r_static
r_void
id|apmmu_null_func
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|mc_tlb_flush_all
r_static
r_inline
r_void
id|mc_tlb_flush_all
c_func
(paren
r_void
)paren
(brace
r_int
r_int
r_int
op_star
id|tlb4k
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tlb4k
op_assign
(paren
r_int
r_int
r_int
op_star
)paren
id|MC_MMU_TLB4K
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|MC_MMU_TLB4K_SIZE
op_div
l_int|4
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
op_decrement
id|i
)paren
(brace
id|tlb4k
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|tlb4k
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|tlb4k
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|tlb4k
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|tlb4k
op_add_assign
l_int|4
suffix:semicolon
)brace
)brace
DECL|function|mc_tlb_flush_page
r_static
r_inline
r_void
id|mc_tlb_flush_page
c_func
(paren
r_int
id|vaddr
comma
r_int
id|ctx
)paren
(brace
r_if
c_cond
(paren
id|ctx
op_eq
id|SYSTEM_CONTEXT
op_logical_or
id|MPP_IS_PAR_CTX
c_func
(paren
id|ctx
)paren
)paren
(brace
op_star
(paren
(paren
(paren
r_int
r_int
r_int
op_star
)paren
id|MC_MMU_TLB4K
)paren
op_plus
(paren
(paren
id|vaddr
op_rshift
l_int|12
)paren
op_amp
l_int|0xFF
)paren
)paren
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|mc_tlb_flush_ctx
r_static
r_inline
r_void
id|mc_tlb_flush_ctx
c_func
(paren
r_int
id|ctx
)paren
(brace
r_int
r_int
r_int
op_star
id|tlb4k
op_assign
(paren
r_int
r_int
r_int
op_star
)paren
id|MC_MMU_TLB4K
suffix:semicolon
r_if
c_cond
(paren
id|ctx
op_eq
id|SYSTEM_CONTEXT
op_logical_or
id|MPP_IS_PAR_CTX
c_func
(paren
id|ctx
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MC_MMU_TLB4K_SIZE
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
(paren
id|tlb4k
(braket
id|i
)braket
op_rshift
l_int|5
)paren
op_amp
l_int|0xFFF
)paren
op_eq
id|ctx
)paren
id|tlb4k
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|mc_tlb_flush_region
r_static
r_inline
r_void
id|mc_tlb_flush_region
c_func
(paren
r_int
id|start
comma
r_int
id|ctx
)paren
(brace
id|mc_tlb_flush_ctx
c_func
(paren
id|ctx
)paren
suffix:semicolon
)brace
DECL|function|mc_tlb_flush_segment
r_static
r_inline
r_void
id|mc_tlb_flush_segment
c_func
(paren
r_int
id|start
comma
r_int
id|ctx
)paren
(brace
id|mc_tlb_flush_ctx
c_func
(paren
id|ctx
)paren
suffix:semicolon
)brace
DECL|function|viking_flush_tlb_all
r_static
r_void
id|viking_flush_tlb_all
c_func
(paren
r_void
)paren
(brace
id|module_stats.invall
op_increment
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|apmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
id|mc_tlb_flush_all
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|viking_flush_tlb_mm
r_static
r_void
id|viking_flush_tlb_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_int
id|octx
suffix:semicolon
id|module_stats.invmm
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|octx
op_assign
id|apmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|octx
op_ne
id|mm-&gt;context
)paren
id|apmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|apmmu_flush_tlb_ctx
c_func
(paren
)paren
suffix:semicolon
id|mc_tlb_flush_ctx
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
r_if
c_cond
(paren
id|octx
op_ne
id|mm-&gt;context
)paren
id|apmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
)brace
)brace
DECL|function|viking_flush_tlb_range
r_static
r_void
id|viking_flush_tlb_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
r_int
id|octx
suffix:semicolon
id|module_stats.invrnge
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|octx
op_assign
id|apmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|octx
op_ne
id|mm-&gt;context
)paren
id|apmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|end
op_minus
id|start
)paren
OL
id|APMMU_PMD_SIZE
)paren
(brace
id|start
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|apmmu_flush_tlb_page
c_func
(paren
id|start
)paren
suffix:semicolon
id|mc_tlb_flush_page
c_func
(paren
id|start
comma
id|mm-&gt;context
)paren
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|end
op_minus
id|start
)paren
OL
id|APMMU_PGDIR_SIZE
)paren
(brace
id|start
op_and_assign
id|APMMU_PMD_MASK
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|apmmu_flush_tlb_segment
c_func
(paren
id|start
)paren
suffix:semicolon
id|mc_tlb_flush_segment
c_func
(paren
id|start
comma
id|mm-&gt;context
)paren
suffix:semicolon
id|start
op_add_assign
id|APMMU_PMD_SIZE
suffix:semicolon
)brace
)brace
r_else
(brace
id|start
op_and_assign
id|APMMU_PGDIR_MASK
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|apmmu_flush_tlb_region
c_func
(paren
id|start
)paren
suffix:semicolon
id|mc_tlb_flush_region
c_func
(paren
id|start
comma
id|mm-&gt;context
)paren
suffix:semicolon
id|start
op_add_assign
id|APMMU_PGDIR_SIZE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|octx
op_ne
id|mm-&gt;context
)paren
id|apmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
)brace
)brace
DECL|function|viking_flush_tlb_page
r_static
r_void
id|viking_flush_tlb_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
r_int
id|octx
suffix:semicolon
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
id|module_stats.invpg
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|octx
op_assign
id|apmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|octx
op_ne
id|mm-&gt;context
)paren
id|apmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|apmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|mc_tlb_flush_page
c_func
(paren
id|page
comma
id|mm-&gt;context
)paren
suffix:semicolon
r_if
c_cond
(paren
id|octx
op_ne
id|mm-&gt;context
)paren
id|apmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
)brace
)brace
DECL|function|viking_flush_tlb_page_for_cbit
r_static
r_void
id|viking_flush_tlb_page_for_cbit
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|apmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|mc_tlb_flush_page
c_func
(paren
id|page
comma
id|apmmu_get_context
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Some dirty hacks to abstract away the painful boot up init. */
DECL|function|apmmu_early_paddr
r_static
r_inline
r_int
r_int
id|apmmu_early_paddr
c_func
(paren
r_int
r_int
id|vaddr
)paren
(brace
r_return
(paren
id|vaddr
op_minus
id|KERNBASE
)paren
suffix:semicolon
)brace
DECL|function|apmmu_early_pgd_set
r_static
r_inline
r_void
id|apmmu_early_pgd_set
c_func
(paren
id|pgd_t
op_star
id|pgdp
comma
id|pmd_t
op_star
id|pmdp
)paren
(brace
id|set_pte
c_func
(paren
(paren
id|pte_t
op_star
)paren
id|pgdp
comma
id|__pte
c_func
(paren
(paren
id|APMMU_ET_PTD
op_or
(paren
id|apmmu_early_paddr
c_func
(paren
(paren
r_int
r_int
)paren
id|pmdp
)paren
op_rshift
l_int|4
)paren
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_early_pmd_set
r_static
r_inline
r_void
id|apmmu_early_pmd_set
c_func
(paren
id|pmd_t
op_star
id|pmdp
comma
id|pte_t
op_star
id|ptep
)paren
(brace
id|set_pte
c_func
(paren
(paren
id|pte_t
op_star
)paren
id|pmdp
comma
id|__pte
c_func
(paren
(paren
id|APMMU_ET_PTD
op_or
(paren
id|apmmu_early_paddr
c_func
(paren
(paren
r_int
r_int
)paren
id|ptep
)paren
op_rshift
l_int|4
)paren
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_early_pgd_page
r_static
r_inline
r_int
r_int
id|apmmu_early_pgd_page
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
(paren
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|APMMU_PTD_PMASK
)paren
op_lshift
l_int|4
)paren
op_plus
id|KERNBASE
suffix:semicolon
)brace
DECL|function|apmmu_early_pmd_page
r_static
r_inline
r_int
r_int
id|apmmu_early_pmd_page
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|APMMU_PTD_PMASK
)paren
op_lshift
l_int|4
)paren
op_plus
id|KERNBASE
suffix:semicolon
)brace
DECL|function|apmmu_early_pmd_offset
r_static
r_inline
id|pmd_t
op_star
id|apmmu_early_pmd_offset
c_func
(paren
id|pgd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pmd_t
op_star
)paren
id|apmmu_early_pgd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|APMMU_PMD_SHIFT
)paren
op_amp
(paren
id|APMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|apmmu_early_pte_offset
r_static
r_inline
id|pte_t
op_star
id|apmmu_early_pte_offset
c_func
(paren
id|pmd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pte_t
op_star
)paren
id|apmmu_early_pmd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|APMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_inline
r_void
id|apmmu_allocate_ptable_skeleton
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|pgdp
op_assign
id|apmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pgd_none
c_func
(paren
op_star
id|pgdp
)paren
)paren
(brace
id|pmdp
op_assign
id|sparc_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|APMMU_PMD_TABLE_SIZE
)paren
suffix:semicolon
id|apmmu_early_pgd_set
c_func
(paren
id|pgdp
comma
id|pmdp
)paren
suffix:semicolon
)brace
id|pmdp
op_assign
id|apmmu_early_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pmd_none
c_func
(paren
op_star
id|pmdp
)paren
)paren
(brace
id|ptep
op_assign
id|sparc_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|APMMU_PTE_TABLE_SIZE
)paren
suffix:semicolon
id|apmmu_early_pmd_set
c_func
(paren
id|pmdp
comma
id|ptep
)paren
suffix:semicolon
)brace
id|start
op_assign
(paren
id|start
op_plus
id|APMMU_PMD_SIZE
)paren
op_amp
id|APMMU_PMD_MASK
suffix:semicolon
)brace
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|make_page
c_func
(paren
r_int
id|virt_page
comma
r_int
id|phys_page
comma
r_int
id|prot
)paren
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_int
id|start
op_assign
id|virt_page
op_lshift
l_int|12
suffix:semicolon
id|pgdp
op_assign
id|apmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pgd_none
c_func
(paren
op_star
id|pgdp
)paren
)paren
(brace
id|pmdp
op_assign
id|sparc_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|APMMU_PMD_TABLE_SIZE
)paren
suffix:semicolon
id|apmmu_early_pgd_set
c_func
(paren
id|pgdp
comma
id|pmdp
)paren
suffix:semicolon
)brace
id|pmdp
op_assign
id|apmmu_early_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|apmmu_pmd_none
c_func
(paren
op_star
id|pmdp
)paren
)paren
(brace
id|ptep
op_assign
id|sparc_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|APMMU_PTE_TABLE_SIZE
)paren
suffix:semicolon
id|apmmu_early_pmd_set
c_func
(paren
id|pmdp
comma
id|ptep
)paren
suffix:semicolon
)brace
id|ptep
op_assign
id|apmmu_early_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
op_star
id|ptep
op_assign
id|__pte
c_func
(paren
(paren
id|phys_page
op_lshift
l_int|8
)paren
op_or
id|prot
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|make_large_page
c_func
(paren
r_int
id|virt_page
comma
r_int
id|phys_page
comma
r_int
id|prot
)paren
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
r_int
id|start
op_assign
id|virt_page
op_lshift
l_int|12
suffix:semicolon
id|pgdp
op_assign
id|apmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
op_star
id|pgdp
op_assign
id|__pgd
c_func
(paren
(paren
id|phys_page
op_lshift
l_int|8
)paren
op_or
id|prot
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|ap_setup_mappings
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|Srwe
op_assign
id|APMMU_PRIV
op_or
id|APMMU_VALID
suffix:semicolon
r_int
id|SrweUr
op_assign
l_int|0x14
op_or
id|APMMU_VALID
suffix:semicolon
multiline_comment|/* weird! */
multiline_comment|/* LBus */
id|make_large_page
c_func
(paren
l_int|0xfb000
comma
l_int|0x9fb000
comma
id|Srwe
)paren
suffix:semicolon
id|make_large_page
c_func
(paren
l_int|0xff000
comma
l_int|0x9ff000
comma
id|SrweUr
)paren
suffix:semicolon
id|make_large_page
c_func
(paren
l_int|0xfc000
comma
l_int|0x911000
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* MC Register */
id|make_page
c_func
(paren
l_int|0xfa000
comma
l_int|0xb00000
comma
id|SrweUr
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa001
comma
l_int|0xb00001
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa002
comma
l_int|0xb00002
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa003
comma
l_int|0xb00003
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa004
comma
l_int|0xb00004
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa005
comma
l_int|0xb00005
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa006
comma
l_int|0xb00006
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa007
comma
l_int|0xb00007
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* MSC+ Register */
id|make_page
c_func
(paren
l_int|0xfa008
comma
l_int|0xc00000
comma
id|SrweUr
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa009
comma
l_int|0xc00001
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa00a
comma
l_int|0xc00002
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa00b
comma
l_int|0xc00003
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa00c
comma
l_int|0xc00004
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
l_int|0xfa00d
comma
l_int|0xc00005
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* RBMPR 0 */
id|make_page
c_func
(paren
l_int|0xfa00e
comma
l_int|0xc00006
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* RBMPR 1 */
id|make_page
c_func
(paren
l_int|0xfa00f
comma
l_int|0xc00007
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* RBMPR 2 */
multiline_comment|/* user queues */
id|make_page
c_func
(paren
id|MSC_PUT_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa00000
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_GET_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa00001
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_SEND_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa00040
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_XY_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa00640
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_X_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa00240
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_Y_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa00440
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_XYG_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa00600
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_XG_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa00200
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_YG_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa00400
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_CSI_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa02004
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_FOP_QUEUE
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa02005
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* system queues */
id|make_page
c_func
(paren
id|MSC_PUT_QUEUE_S
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa02000
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* system put */
id|make_page
c_func
(paren
id|MSC_CPUT_QUEUE_S
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa02020
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* system creg put */
id|make_page
c_func
(paren
id|MSC_GET_QUEUE_S
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa02001
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* system get */
id|make_page
c_func
(paren
id|MSC_CGET_QUEUE_S
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa02021
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* system creg get */
id|make_page
c_func
(paren
id|MSC_SEND_QUEUE_S
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa02040
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* system send */
id|make_page
c_func
(paren
id|MSC_BSEND_QUEUE_S
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa02640
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* system send broad */
id|make_page
c_func
(paren
id|MSC_XYG_QUEUE_S
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa02600
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* system put broad */
id|make_page
c_func
(paren
id|MSC_CXYG_QUEUE_S
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa02620
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* system put broad */
multiline_comment|/* Direct queue access entries for refilling the MSC send queue */
id|make_page
c_func
(paren
id|MSC_SYSTEM_DIRECT
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa08000
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_USER_DIRECT
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa08001
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_REMOTE_DIRECT
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa08002
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_REPLY_DIRECT
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa08003
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_REMREPLY_DIRECT
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa08004
comma
id|Srwe
)paren
suffix:semicolon
multiline_comment|/* As above with end-bit set */
id|make_page
c_func
(paren
id|MSC_SYSTEM_DIRECT_END
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa0c000
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_USER_DIRECT_END
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa0c001
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_REMOTE_DIRECT_END
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa0c002
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_REPLY_DIRECT_END
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa0c003
comma
id|Srwe
)paren
suffix:semicolon
id|make_page
c_func
(paren
id|MSC_REMREPLY_DIRECT_END
op_rshift
id|PAGE_SHIFT
comma
l_int|0xa0c004
comma
id|Srwe
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|map_kernel
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|phys
suffix:semicolon
multiline_comment|/* the AP+ only ever has one bank of memory starting at address 0 */
id|ap_mem_size
op_assign
id|sp_banks
(braket
l_int|0
)braket
dot
id|num_bytes
suffix:semicolon
r_for
c_loop
(paren
id|phys
op_assign
l_int|0
suffix:semicolon
id|phys
OL
id|sp_banks
(braket
l_int|0
)braket
dot
id|num_bytes
suffix:semicolon
id|phys
op_add_assign
id|APMMU_PGDIR_SIZE
)paren
id|make_large_page
c_func
(paren
(paren
id|KERNBASE
op_plus
id|phys
)paren
op_rshift
l_int|12
comma
(paren
id|phys
op_rshift
l_int|12
)paren
comma
id|APMMU_CACHE
op_or
id|APMMU_PRIV
op_or
id|APMMU_VALID
)paren
suffix:semicolon
id|init_task.mm-&gt;mmap-&gt;vm_start
op_assign
id|page_offset
op_assign
id|KERNBASE
suffix:semicolon
id|stack_top
op_assign
id|page_offset
op_minus
id|PAGE_SIZE
suffix:semicolon
)brace
r_extern
r_int
r_int
id|free_area_init
c_func
(paren
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
r_int
id|sparc_context_init
c_func
(paren
r_int
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|physmem_mapped_contig
suffix:semicolon
r_extern
r_int
id|linux_num_cpus
suffix:semicolon
DECL|variable|poke_apmmu
r_void
(paren
op_star
id|poke_apmmu
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
r_int
id|apmmu_paging_init
c_func
(paren
r_int
r_int
id|start_mem
comma
r_int
r_int
id|end_mem
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
id|physmem_mapped_contig
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* for init.c:taint_real_pages()   */
id|num_contexts
op_assign
id|AP_NUM_CONTEXTS
suffix:semicolon
id|mempool
op_assign
id|PAGE_ALIGN
c_func
(paren
id|start_mem
)paren
suffix:semicolon
id|memset
c_func
(paren
id|swapper_pg_dir
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|apmmu_allocate_ptable_skeleton
c_func
(paren
id|KERNBASE
comma
id|end_mem
)paren
suffix:semicolon
id|mempool
op_assign
id|PAGE_ALIGN
c_func
(paren
id|mempool
)paren
suffix:semicolon
id|map_kernel
c_func
(paren
)paren
suffix:semicolon
id|ap_setup_mappings
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* the MSC wants this aligned on a 16k boundary */
id|apmmu_context_table
op_assign
id|sparc_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|num_contexts
op_star
r_sizeof
(paren
id|ctxd_t
)paren
OL
l_int|0x4000
ques
c_cond
l_int|0x4000
suffix:colon
id|num_contexts
op_star
r_sizeof
(paren
id|ctxd_t
)paren
)paren
suffix:semicolon
id|apmmu_ctx_table_phys
op_assign
(paren
id|ctxd_t
op_star
)paren
id|apmmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|apmmu_context_table
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_contexts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ctxd_set
c_func
(paren
op_amp
id|apmmu_context_table
(braket
id|i
)braket
comma
id|swapper_pg_dir
)paren
suffix:semicolon
)brace
id|start_mem
op_assign
id|PAGE_ALIGN
c_func
(paren
id|mempool
)paren
suffix:semicolon
id|flush_cache_all
c_func
(paren
)paren
suffix:semicolon
id|apmmu_set_ctable_ptr
c_func
(paren
(paren
r_int
r_int
)paren
id|apmmu_ctx_table_phys
)paren
suffix:semicolon
id|flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
id|poke_apmmu
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* on the AP we don&squot;t put the top few contexts into the free&n;&t;   context list as these are reserved for parallel tasks */
id|start_mem
op_assign
id|sparc_context_init
c_func
(paren
id|start_mem
comma
id|MPP_CONTEXT_BASE
)paren
suffix:semicolon
id|start_mem
op_assign
id|free_area_init
c_func
(paren
id|start_mem
comma
id|end_mem
)paren
suffix:semicolon
r_return
id|PAGE_ALIGN
c_func
(paren
id|start_mem
)paren
suffix:semicolon
)brace
DECL|variable|apmmuinfo
r_static
r_char
id|apmmuinfo
(braket
l_int|512
)braket
suffix:semicolon
DECL|function|apmmu_mmu_info
r_static
r_char
op_star
id|apmmu_mmu_info
c_func
(paren
r_void
)paren
(brace
id|sprintf
c_func
(paren
id|apmmuinfo
comma
l_string|&quot;MMU type&bslash;t: %s&bslash;n&quot;
l_string|&quot;invall&bslash;t&bslash;t: %d&bslash;n&quot;
l_string|&quot;invmm&bslash;t&bslash;t: %d&bslash;n&quot;
l_string|&quot;invrnge&bslash;t&bslash;t: %d&bslash;n&quot;
l_string|&quot;invpg&bslash;t&bslash;t: %d&bslash;n&quot;
l_string|&quot;contexts&bslash;t: %d&bslash;n&quot;
comma
id|apmmu_name
comma
id|module_stats.invall
comma
id|module_stats.invmm
comma
id|module_stats.invrnge
comma
id|module_stats.invpg
comma
id|num_contexts
)paren
suffix:semicolon
r_return
id|apmmuinfo
suffix:semicolon
)brace
DECL|function|apmmu_update_mmu_cache
r_static
r_void
id|apmmu_update_mmu_cache
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|address
comma
id|pte_t
id|pte
)paren
(brace
)brace
DECL|function|apmmu_exit_hook
r_static
r_void
id|apmmu_exit_hook
c_func
(paren
r_void
)paren
(brace
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|current-&gt;mm
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
op_logical_and
id|mm-&gt;count
op_eq
l_int|1
)paren
(brace
id|ctxd_set
c_func
(paren
op_amp
id|apmmu_context_table
(braket
id|mm-&gt;context
)braket
comma
id|swapper_pg_dir
)paren
suffix:semicolon
id|viking_flush_tlb_mm
c_func
(paren
id|mm
)paren
suffix:semicolon
id|free_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|mm-&gt;context
op_assign
id|NO_CONTEXT
suffix:semicolon
)brace
)brace
DECL|function|apmmu_flush_hook
r_static
r_void
id|apmmu_flush_hook
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;tss.flags
op_amp
id|SPARC_FLAG_KTHREAD
)paren
(brace
id|alloc_context
c_func
(paren
id|current
)paren
suffix:semicolon
id|ctxd_set
c_func
(paren
op_amp
id|apmmu_context_table
(braket
id|current-&gt;mm-&gt;context
)braket
comma
id|current-&gt;mm-&gt;pgd
)paren
suffix:semicolon
id|viking_flush_tlb_mm
c_func
(paren
id|current-&gt;mm
)paren
suffix:semicolon
id|apmmu_set_context
c_func
(paren
id|current-&gt;mm-&gt;context
)paren
suffix:semicolon
)brace
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|poke_viking
c_func
(paren
r_void
)paren
)paren
(brace
r_int
r_int
id|mreg
op_assign
id|apmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
id|mreg
op_or_assign
id|VIKING_SPENABLE
suffix:semicolon
id|mreg
op_or_assign
(paren
id|VIKING_ICENABLE
op_or
id|VIKING_DCENABLE
)paren
suffix:semicolon
id|mreg
op_and_assign
op_complement
id|VIKING_ACENABLE
suffix:semicolon
id|mreg
op_and_assign
op_complement
id|VIKING_SBENABLE
suffix:semicolon
id|mreg
op_or_assign
id|VIKING_TCENABLE
suffix:semicolon
id|apmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|init_viking
c_func
(paren
r_void
)paren
)paren
(brace
id|apmmu_name
op_assign
l_string|&quot;TI Viking/AP1000&quot;
suffix:semicolon
id|flush_cache_page_to_uncache
op_assign
id|apmmu_null_func
suffix:semicolon
id|flush_page_for_dma
op_assign
id|apmmu_null_func
suffix:semicolon
id|flush_cache_all
op_assign
id|apmmu_null_func
suffix:semicolon
id|flush_cache_mm
op_assign
id|apmmu_null_func
suffix:semicolon
id|flush_cache_page
op_assign
id|apmmu_null_func
suffix:semicolon
id|flush_cache_range
op_assign
id|apmmu_null_func
suffix:semicolon
id|flush_tlb_all
op_assign
id|viking_flush_tlb_all
suffix:semicolon
id|flush_tlb_mm
op_assign
id|viking_flush_tlb_mm
suffix:semicolon
id|flush_tlb_page
op_assign
id|viking_flush_tlb_page
suffix:semicolon
id|flush_tlb_range
op_assign
id|viking_flush_tlb_range
suffix:semicolon
id|flush_page_to_ram
op_assign
id|apmmu_null_func
suffix:semicolon
id|flush_sig_insns
op_assign
id|apmmu_null_func
suffix:semicolon
id|flush_tlb_page_for_cbit
op_assign
id|viking_flush_tlb_page_for_cbit
suffix:semicolon
id|poke_apmmu
op_assign
id|poke_viking
suffix:semicolon
)brace
r_extern
r_int
r_int
id|spwin_mmu_patchme
comma
id|fwin_mmu_patchme
comma
id|tsetup_mmu_patchme
comma
id|rtrap_mmu_patchme
suffix:semicolon
r_extern
r_int
r_int
id|spwin_srmmu_stackchk
comma
id|srmmu_fwin_stackchk
comma
id|tsetup_srmmu_stackchk
comma
id|srmmu_rett_stackchk
suffix:semicolon
r_extern
r_int
r_int
id|srmmu_fault
suffix:semicolon
DECL|macro|PATCH_BRANCH
mdefine_line|#define PATCH_BRANCH(insn, dest) do { &bslash;&n;&t;&t;iaddr = &amp;(insn); &bslash;&n;&t;&t;daddr = &amp;(dest); &bslash;&n;&t;&t;*iaddr = SPARC_BRANCH((unsigned long) daddr, (unsigned long) iaddr); &bslash;&n;        } while(0);
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|patch_window_trap_handlers
c_func
(paren
r_void
)paren
)paren
(brace
r_int
r_int
op_star
id|iaddr
comma
op_star
id|daddr
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|spwin_mmu_patchme
comma
id|spwin_srmmu_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|fwin_mmu_patchme
comma
id|srmmu_fwin_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|tsetup_mmu_patchme
comma
id|tsetup_srmmu_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|rtrap_mmu_patchme
comma
id|srmmu_rett_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|sparc_ttable
(braket
id|SP_TRAP_TFLT
)braket
dot
id|inst_three
comma
id|srmmu_fault
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|sparc_ttable
(braket
id|SP_TRAP_DFLT
)braket
dot
id|inst_three
comma
id|srmmu_fault
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|sparc_ttable
(braket
id|SP_TRAP_DACC
)braket
dot
id|inst_three
comma
id|srmmu_fault
)paren
suffix:semicolon
)brace
multiline_comment|/* Load up routines and constants for sun4m mmu */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|ld_mmu_apmmu
c_func
(paren
r_void
)paren
)paren
(brace
multiline_comment|/* First the constants */
id|pmd_shift
op_assign
id|APMMU_PMD_SHIFT
suffix:semicolon
id|pmd_size
op_assign
id|APMMU_PMD_SIZE
suffix:semicolon
id|pmd_mask
op_assign
id|APMMU_PMD_MASK
suffix:semicolon
id|pgdir_shift
op_assign
id|APMMU_PGDIR_SHIFT
suffix:semicolon
id|pgdir_size
op_assign
id|APMMU_PGDIR_SIZE
suffix:semicolon
id|pgdir_mask
op_assign
id|APMMU_PGDIR_MASK
suffix:semicolon
id|ptrs_per_pte
op_assign
id|APMMU_PTRS_PER_PTE
suffix:semicolon
id|ptrs_per_pmd
op_assign
id|APMMU_PTRS_PER_PMD
suffix:semicolon
id|ptrs_per_pgd
op_assign
id|APMMU_PTRS_PER_PGD
suffix:semicolon
id|page_none
op_assign
id|APMMU_PAGE_NONE
suffix:semicolon
id|page_shared
op_assign
id|APMMU_PAGE_SHARED
suffix:semicolon
id|page_copy
op_assign
id|APMMU_PAGE_COPY
suffix:semicolon
id|page_readonly
op_assign
id|APMMU_PAGE_RDONLY
suffix:semicolon
id|page_kernel
op_assign
id|APMMU_PAGE_KERNEL
suffix:semicolon
id|pg_iobits
op_assign
id|APMMU_VALID
op_or
id|APMMU_WRITE
op_or
id|APMMU_REF
suffix:semicolon
multiline_comment|/* Functions */
id|mmu_getpage
op_assign
id|apmmu_getpage
suffix:semicolon
id|set_pte
op_assign
id|apmmu_set_pte_cacheable
suffix:semicolon
id|switch_to_context
op_assign
id|apmmu_switch_to_context
suffix:semicolon
id|pmd_align
op_assign
id|apmmu_pmd_align
suffix:semicolon
id|pgdir_align
op_assign
id|apmmu_pgdir_align
suffix:semicolon
id|vmalloc_start
op_assign
id|apmmu_vmalloc_start
suffix:semicolon
id|pte_page
op_assign
id|apmmu_pte_page
suffix:semicolon
id|pmd_page
op_assign
id|apmmu_pmd_page
suffix:semicolon
id|pgd_page
op_assign
id|apmmu_pgd_page
suffix:semicolon
id|sparc_update_rootmmu_dir
op_assign
id|apmmu_update_rootmmu_dir
suffix:semicolon
id|pte_none
op_assign
id|apmmu_pte_none
suffix:semicolon
id|pte_present
op_assign
id|apmmu_pte_present
suffix:semicolon
id|pte_clear
op_assign
id|apmmu_pte_clear
suffix:semicolon
id|pmd_none
op_assign
id|apmmu_pmd_none
suffix:semicolon
id|pmd_bad
op_assign
id|apmmu_pmd_bad
suffix:semicolon
id|pmd_present
op_assign
id|apmmu_pmd_present
suffix:semicolon
id|pmd_clear
op_assign
id|apmmu_pmd_clear
suffix:semicolon
id|pgd_none
op_assign
id|apmmu_pgd_none
suffix:semicolon
id|pgd_bad
op_assign
id|apmmu_pgd_bad
suffix:semicolon
id|pgd_present
op_assign
id|apmmu_pgd_present
suffix:semicolon
id|pgd_clear
op_assign
id|apmmu_pgd_clear
suffix:semicolon
id|mk_pte
op_assign
id|apmmu_mk_pte
suffix:semicolon
id|mk_pte_phys
op_assign
id|apmmu_mk_pte_phys
suffix:semicolon
id|pgd_set
op_assign
id|apmmu_pgd_set
suffix:semicolon
id|mk_pte_io
op_assign
id|apmmu_mk_pte_io
suffix:semicolon
id|pte_modify
op_assign
id|apmmu_pte_modify
suffix:semicolon
id|pgd_offset
op_assign
id|apmmu_pgd_offset
suffix:semicolon
id|pmd_offset
op_assign
id|apmmu_pmd_offset
suffix:semicolon
id|pte_offset
op_assign
id|apmmu_pte_offset
suffix:semicolon
id|pte_free_kernel
op_assign
id|apmmu_pte_free_kernel
suffix:semicolon
id|pmd_free_kernel
op_assign
id|apmmu_pmd_free_kernel
suffix:semicolon
id|pte_alloc_kernel
op_assign
id|apmmu_pte_alloc_kernel
suffix:semicolon
id|pmd_alloc_kernel
op_assign
id|apmmu_pmd_alloc_kernel
suffix:semicolon
id|pte_free
op_assign
id|apmmu_pte_free
suffix:semicolon
id|pte_alloc
op_assign
id|apmmu_pte_alloc
suffix:semicolon
id|pmd_free
op_assign
id|apmmu_pmd_free
suffix:semicolon
id|pmd_alloc
op_assign
id|apmmu_pmd_alloc
suffix:semicolon
id|pgd_free
op_assign
id|apmmu_pgd_free
suffix:semicolon
id|pgd_alloc
op_assign
id|apmmu_pgd_alloc
suffix:semicolon
id|pgd_flush
op_assign
id|apmmu_pgd_flush
suffix:semicolon
id|pte_write
op_assign
id|apmmu_pte_write
suffix:semicolon
id|pte_dirty
op_assign
id|apmmu_pte_dirty
suffix:semicolon
id|pte_young
op_assign
id|apmmu_pte_young
suffix:semicolon
id|pte_wrprotect
op_assign
id|apmmu_pte_wrprotect
suffix:semicolon
id|pte_mkclean
op_assign
id|apmmu_pte_mkclean
suffix:semicolon
id|pte_mkold
op_assign
id|apmmu_pte_mkold
suffix:semicolon
id|pte_mkwrite
op_assign
id|apmmu_pte_mkwrite
suffix:semicolon
id|pte_mkdirty
op_assign
id|apmmu_pte_mkdirty
suffix:semicolon
id|pte_mkyoung
op_assign
id|apmmu_pte_mkyoung
suffix:semicolon
id|update_mmu_cache
op_assign
id|apmmu_update_mmu_cache
suffix:semicolon
id|mmu_exit_hook
op_assign
id|apmmu_exit_hook
suffix:semicolon
id|mmu_flush_hook
op_assign
id|apmmu_flush_hook
suffix:semicolon
id|mmu_lockarea
op_assign
id|apmmu_lockarea
suffix:semicolon
id|mmu_unlockarea
op_assign
id|apmmu_unlockarea
suffix:semicolon
id|mmu_get_scsi_one
op_assign
l_int|NULL
suffix:semicolon
id|mmu_get_scsi_sgl
op_assign
l_int|NULL
suffix:semicolon
id|mmu_release_scsi_one
op_assign
l_int|NULL
suffix:semicolon
id|mmu_release_scsi_sgl
op_assign
l_int|NULL
suffix:semicolon
id|mmu_info
op_assign
id|apmmu_mmu_info
suffix:semicolon
id|mmu_v2p
op_assign
id|apmmu_v2p
suffix:semicolon
id|mmu_p2v
op_assign
id|apmmu_p2v
suffix:semicolon
multiline_comment|/* Task struct and kernel stack allocating/freeing. */
id|alloc_kernel_stack
op_assign
id|apmmu_alloc_kernel_stack
suffix:semicolon
id|alloc_task_struct
op_assign
id|apmmu_alloc_task_struct
suffix:semicolon
id|free_kernel_stack
op_assign
id|apmmu_free_kernel_stack
suffix:semicolon
id|free_task_struct
op_assign
id|apmmu_free_task_struct
suffix:semicolon
id|quick_kernel_fault
op_assign
id|apmmu_quick_kernel_fault
suffix:semicolon
id|ctxd_set
op_assign
id|apmmu_ctxd_set
suffix:semicolon
id|pmd_set
op_assign
id|apmmu_pmd_set
suffix:semicolon
id|init_viking
c_func
(paren
)paren
suffix:semicolon
id|patch_window_trap_handlers
c_func
(paren
)paren
suffix:semicolon
)brace
eof
