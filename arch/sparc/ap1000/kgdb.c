multiline_comment|/*&n;   * Copyright 1996 The Australian National University.&n;   * Copyright 1996 Fujitsu Laboratories Limited&n;   * &n;   * This software may be distributed under the terms of the Gnu&n;   * Public License version 2 or later&n;  */
multiline_comment|/* routines to support remote kgdb to Linux/AP+ cells */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;asm/ap1000/apservice.h&gt;
macro_line|#include &lt;asm/ap1000/apreg.h&gt;
DECL|variable|out_buf
r_static
r_char
id|out_buf
(braket
l_int|0x100
)braket
suffix:semicolon
DECL|variable|out_buf_pos
r_static
r_int
id|out_buf_pos
op_assign
l_int|0
suffix:semicolon
DECL|variable|in_buf
r_static
r_char
id|in_buf
(braket
l_int|0x100
)braket
suffix:semicolon
DECL|variable|in_buf_pos
r_static
r_int
id|in_buf_pos
op_assign
l_int|0
suffix:semicolon
DECL|variable|in_buf_count
r_static
r_int
id|in_buf_count
op_assign
l_int|0
suffix:semicolon
DECL|variable|hash_pos
r_static
r_int
id|hash_pos
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|function|ap_dbg_flush
r_void
id|ap_dbg_flush
c_func
(paren
r_void
)paren
(brace
r_struct
id|cap_request
id|req
suffix:semicolon
r_if
c_cond
(paren
id|out_buf_pos
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|req.cid
op_assign
id|mpp_cid
c_func
(paren
)paren
suffix:semicolon
id|req.type
op_assign
id|REQ_PUTDEBUGSTRING
suffix:semicolon
id|req.size
op_assign
r_sizeof
(paren
id|req
)paren
op_plus
id|out_buf_pos
suffix:semicolon
id|req.header
op_assign
id|MAKE_HEADER
c_func
(paren
id|HOST_CID
)paren
suffix:semicolon
id|write_bif_polled
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|req
comma
r_sizeof
(paren
id|req
)paren
comma
(paren
r_char
op_star
)paren
id|out_buf
comma
id|out_buf_pos
)paren
suffix:semicolon
id|out_buf_pos
op_assign
l_int|0
suffix:semicolon
id|hash_pos
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* called by the gdb stuff */
DECL|function|putDebugChar
r_void
id|putDebugChar
c_func
(paren
r_char
id|c
)paren
(brace
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;#&squot;
)paren
id|hash_pos
op_assign
id|out_buf_pos
suffix:semicolon
id|out_buf
(braket
id|out_buf_pos
op_increment
)braket
op_assign
id|c
suffix:semicolon
r_if
c_cond
(paren
id|out_buf_pos
op_eq
r_sizeof
(paren
id|out_buf
)paren
)paren
(brace
id|ap_dbg_flush
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* used by gdb to get input */
DECL|function|getDebugChar
r_char
id|getDebugChar
c_func
(paren
r_void
)paren
(brace
r_int
id|flags
suffix:semicolon
r_struct
id|cap_request
id|req
suffix:semicolon
id|ap_dbg_flush
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_buf_count
op_eq
l_int|0
)paren
(brace
id|req.cid
op_assign
id|mpp_cid
c_func
(paren
)paren
suffix:semicolon
id|req.type
op_assign
id|REQ_GETDEBUGCHAR
suffix:semicolon
id|req.size
op_assign
r_sizeof
(paren
id|req
)paren
suffix:semicolon
id|req.header
op_assign
id|MAKE_HEADER
c_func
(paren
id|HOST_CID
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|write_bif_polled
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|req
comma
r_sizeof
(paren
id|req
)paren
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|ap_wait_request
c_func
(paren
op_amp
id|req
comma
id|REQ_GETDEBUGCHAR
)paren
suffix:semicolon
id|read_bif
c_func
(paren
id|in_buf
comma
id|req.size
op_minus
r_sizeof
(paren
id|req
)paren
)paren
suffix:semicolon
id|in_buf_pos
op_assign
l_int|0
suffix:semicolon
id|in_buf_count
op_assign
id|req.size
op_minus
r_sizeof
(paren
id|req
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|in_buf_count
op_decrement
suffix:semicolon
r_return
id|in_buf
(braket
id|in_buf_pos
op_increment
)braket
suffix:semicolon
)brace
eof
