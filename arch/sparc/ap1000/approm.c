multiline_comment|/*&n;   * Copyright 1996 The Australian National University.&n;   * Copyright 1996 Fujitsu Laboratories Limited&n;   * &n;   * This software may be distributed under the terms of the Gnu&n;   * Public License version 2 or later&n;  */
multiline_comment|/*&n; * fake a really simple Sun prom for the AP+&n; *&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/idprom.h&gt; 
macro_line|#include &lt;asm/machines.h&gt; 
macro_line|#include &lt;asm/ap1000/apservice.h&gt; 
DECL|variable|ap_romvec
r_static
r_struct
id|linux_romvec
id|ap_romvec
suffix:semicolon
DECL|variable|ap_idprom
r_static
r_struct
id|idprom
id|ap_idprom
suffix:semicolon
DECL|struct|property
r_struct
id|property
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|value
r_char
op_star
id|value
suffix:semicolon
DECL|member|length
r_int
id|length
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|node
r_struct
id|node
(brace
DECL|member|level
r_int
id|level
suffix:semicolon
DECL|member|properties
r_struct
id|property
op_star
id|properties
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|null_properties
r_struct
id|property
id|null_properties
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|root_properties
r_struct
id|property
id|root_properties
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;device_type&quot;
comma
l_string|&quot;cpu&quot;
comma
l_int|4
)brace
comma
(brace
l_string|&quot;idprom&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|ap_idprom
comma
r_sizeof
(paren
id|ap_idprom
)paren
)brace
comma
(brace
l_string|&quot;banner-name&quot;
comma
l_string|&quot;Fujitsu AP1000+&quot;
comma
l_int|16
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
op_minus
l_int|1
)brace
)brace
suffix:semicolon
DECL|variable|nodes
r_struct
id|node
id|nodes
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
op_amp
id|null_properties
)brace
comma
(brace
l_int|0
comma
id|root_properties
)brace
comma
(brace
op_minus
l_int|1
comma
op_amp
id|null_properties
)brace
)brace
suffix:semicolon
DECL|function|no_nextnode
r_static
r_int
id|no_nextnode
c_func
(paren
r_int
id|node
)paren
(brace
r_if
c_cond
(paren
id|nodes
(braket
id|node
)braket
dot
id|level
op_eq
id|nodes
(braket
id|node
op_plus
l_int|1
)braket
dot
id|level
)paren
r_return
id|node
op_plus
l_int|1
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|no_child
r_static
r_int
id|no_child
c_func
(paren
r_int
id|node
)paren
(brace
r_if
c_cond
(paren
id|nodes
(braket
id|node
)braket
dot
id|level
op_eq
id|nodes
(braket
id|node
op_plus
l_int|1
)braket
dot
id|level
op_minus
l_int|1
)paren
r_return
id|node
op_plus
l_int|1
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|find_property
r_static
r_struct
id|property
op_star
id|find_property
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|property
op_star
id|prop
op_assign
op_amp
id|nodes
(braket
id|node
)braket
dot
id|properties
(braket
l_int|0
)braket
suffix:semicolon
r_while
c_loop
(paren
id|prop
op_logical_and
id|prop-&gt;name
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|prop-&gt;name
comma
id|name
)paren
op_eq
l_int|0
)paren
r_return
id|prop
suffix:semicolon
id|prop
op_increment
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|no_proplen
r_static
r_int
id|no_proplen
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|property
op_star
id|prop
op_assign
id|find_property
c_func
(paren
id|node
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop
)paren
r_return
id|prop-&gt;length
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|no_getprop
r_static
r_int
id|no_getprop
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
comma
r_char
op_star
id|value
)paren
(brace
r_struct
id|property
op_star
id|prop
op_assign
id|find_property
c_func
(paren
id|node
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop
)paren
(brace
id|memcpy
c_func
(paren
id|value
comma
id|prop-&gt;value
comma
id|prop-&gt;length
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|no_setprop
r_static
r_int
id|no_setprop
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
comma
r_char
op_star
id|value
comma
r_int
id|len
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|no_nextprop
r_static
r_char
op_star
id|no_nextprop
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|property
op_star
id|prop
op_assign
id|find_property
c_func
(paren
id|node
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop
)paren
r_return
id|prop
(braket
l_int|1
)braket
dot
id|name
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|variable|ap_nodeops
r_static
r_struct
id|linux_nodeops
id|ap_nodeops
op_assign
(brace
id|no_nextnode
comma
id|no_child
comma
id|no_proplen
comma
id|no_getprop
comma
id|no_setprop
comma
id|no_nextprop
)brace
suffix:semicolon
DECL|function|calc_idprom_cksum
r_static
r_int
r_char
id|calc_idprom_cksum
c_func
(paren
r_struct
id|idprom
op_star
id|idprom
)paren
(brace
r_int
r_char
id|cksum
comma
id|i
comma
op_star
id|ptr
op_assign
(paren
r_int
r_char
op_star
)paren
id|idprom
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cksum
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x0E
suffix:semicolon
id|i
op_increment
)paren
id|cksum
op_xor_assign
op_star
id|ptr
op_increment
suffix:semicolon
r_return
id|cksum
suffix:semicolon
)brace
DECL|variable|synch_hook
r_static
r_int
id|synch_hook
suffix:semicolon
DECL|function|ap_prom_init
r_struct
id|linux_romvec
op_star
id|ap_prom_init
c_func
(paren
r_void
)paren
(brace
id|memset
c_func
(paren
op_amp
id|ap_romvec
comma
l_int|0
comma
r_sizeof
(paren
id|ap_romvec
)paren
)paren
suffix:semicolon
id|ap_romvec.pv_romvers
op_assign
l_int|42
suffix:semicolon
id|ap_romvec.pv_nodeops
op_assign
op_amp
id|ap_nodeops
suffix:semicolon
id|ap_romvec.pv_reboot
op_assign
id|ap_reboot
suffix:semicolon
id|ap_romvec.pv_synchook
op_assign
op_amp
id|synch_hook
suffix:semicolon
id|ap_idprom.id_format
op_assign
l_int|1
suffix:semicolon
id|ap_idprom.id_sernum
op_assign
id|mpp_cid
c_func
(paren
)paren
suffix:semicolon
id|ap_idprom.id_machtype
op_assign
id|SM_SUN4M_OBP
suffix:semicolon
id|ap_idprom.id_cksum
op_assign
id|calc_idprom_cksum
c_func
(paren
op_amp
id|ap_idprom
)paren
suffix:semicolon
r_return
op_amp
id|ap_romvec
suffix:semicolon
)brace
eof
