multiline_comment|/* $Id: iommu.c,v 1.9 1998/04/15 14:58:37 jj Exp $&n; * iommu.c:  IOMMU specific routines for memory management.&n; *&n; * Copyright (C) 1995 David S. Miller  (davem@caip.rutgers.edu)&n; * Copyright (C) 1995 Peter A. Zaitcev (zaitcev@ithil.mcst.ru)&n; * Copyright (C) 1996 Eddie C. Dost    (ecd@skynet.be)&n; * Copyright (C) 1997,1998 Jakub Jelinek    (jj@sunsite.mff.cuni.cz)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/mxcc.h&gt;
multiline_comment|/* srmmu.c */
r_extern
r_int
id|viking_mxcc_present
suffix:semicolon
id|BTFIXUPDEF_CALL
c_func
(paren
r_void
comma
id|flush_page_for_dma
comma
r_int
r_int
)paren
DECL|macro|flush_page_for_dma
mdefine_line|#define flush_page_for_dma(page) BTFIXUP_CALL(flush_page_for_dma)(page)
r_extern
r_int
id|flush_page_for_dma_global
suffix:semicolon
DECL|variable|viking_flush
r_static
r_int
id|viking_flush
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* viking.S */
r_extern
r_void
id|viking_flush_page
c_func
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
r_extern
r_void
id|viking_mxcc_flush_page
c_func
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
DECL|macro|IOPERM
mdefine_line|#define IOPERM        (IOPTE_CACHE | IOPTE_WRITE | IOPTE_VALID)
DECL|macro|MKIOPTE
mdefine_line|#define MKIOPTE(phys) (((((phys)&gt;&gt;4) &amp; IOPTE_PAGE) | IOPERM) &amp; ~IOPTE_WAZ)
DECL|function|iommu_map_dvma_pages_for_iommu
r_static
r_inline
r_void
id|iommu_map_dvma_pages_for_iommu
c_func
(paren
r_struct
id|iommu_struct
op_star
id|iommu
)paren
(brace
r_int
r_int
id|kern_end
op_assign
(paren
r_int
r_int
)paren
id|high_memory
suffix:semicolon
r_int
r_int
id|first
op_assign
id|page_offset
suffix:semicolon
r_int
r_int
id|last
op_assign
id|kern_end
suffix:semicolon
id|iopte_t
op_star
id|iopte
op_assign
id|iommu-&gt;page_table
suffix:semicolon
id|iopte
op_add_assign
(paren
(paren
id|first
op_minus
id|iommu-&gt;start
)paren
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
r_while
c_loop
(paren
id|first
op_le
id|last
)paren
(brace
op_star
id|iopte
op_increment
op_assign
id|__iopte
c_func
(paren
id|MKIOPTE
c_func
(paren
id|mmu_v2p
c_func
(paren
id|first
)paren
)paren
)paren
suffix:semicolon
id|first
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|iommu_init
c_func
(paren
r_int
id|iommund
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
)paren
(brace
r_int
r_int
id|impl
comma
id|vers
comma
id|ptsize
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_struct
id|iommu_struct
op_star
id|iommu
suffix:semicolon
r_struct
id|linux_prom_registers
id|iommu_promregs
(braket
id|PROMREG_MAX
)braket
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|k
comma
id|l
comma
id|m
suffix:semicolon
r_struct
id|iommu_alloc
(brace
r_int
r_int
id|addr
suffix:semicolon
r_int
id|next
suffix:semicolon
)brace
op_star
id|ia
suffix:semicolon
id|iommu
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|iommu_struct
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|prom_getproperty
c_func
(paren
id|iommund
comma
l_string|&quot;reg&quot;
comma
(paren
r_void
op_star
)paren
id|iommu_promregs
comma
r_sizeof
(paren
id|iommu_promregs
)paren
)paren
suffix:semicolon
id|iommu-&gt;regs
op_assign
(paren
r_struct
id|iommu_regs
op_star
)paren
id|sparc_alloc_io
c_func
(paren
id|iommu_promregs
(braket
l_int|0
)braket
dot
id|phys_addr
comma
l_int|0
comma
(paren
id|PAGE_SIZE
op_star
l_int|3
)paren
comma
l_string|&quot;IOMMU registers&quot;
comma
id|iommu_promregs
(braket
l_int|0
)braket
dot
id|which_io
comma
l_int|0x0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iommu-&gt;regs
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Cannot map IOMMU registers.&quot;
)paren
suffix:semicolon
)brace
id|impl
op_assign
(paren
id|iommu-&gt;regs-&gt;control
op_amp
id|IOMMU_CTRL_IMPL
)paren
op_rshift
l_int|28
suffix:semicolon
id|vers
op_assign
(paren
id|iommu-&gt;regs-&gt;control
op_amp
id|IOMMU_CTRL_VERS
)paren
op_rshift
l_int|24
suffix:semicolon
id|tmp
op_assign
id|iommu-&gt;regs-&gt;control
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|IOMMU_CTRL_RNGE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|page_offset
op_amp
l_int|0xf0000000
)paren
(brace
r_case
l_int|0xf0000000
suffix:colon
id|tmp
op_or_assign
(paren
id|IOMMU_RNGE_256MB
op_or
id|IOMMU_CTRL_ENAB
)paren
suffix:semicolon
id|iommu-&gt;plow
op_assign
id|iommu-&gt;start
op_assign
l_int|0xf0000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xe0000000
suffix:colon
id|tmp
op_or_assign
(paren
id|IOMMU_RNGE_512MB
op_or
id|IOMMU_CTRL_ENAB
)paren
suffix:semicolon
id|iommu-&gt;plow
op_assign
id|iommu-&gt;start
op_assign
l_int|0xe0000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xd0000000
suffix:colon
r_case
l_int|0xc0000000
suffix:colon
id|tmp
op_or_assign
(paren
id|IOMMU_RNGE_1GB
op_or
id|IOMMU_CTRL_ENAB
)paren
suffix:semicolon
id|iommu-&gt;plow
op_assign
id|iommu-&gt;start
op_assign
l_int|0xc0000000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xb0000000
suffix:colon
r_case
l_int|0xa0000000
suffix:colon
r_case
l_int|0x90000000
suffix:colon
r_case
l_int|0x80000000
suffix:colon
id|tmp
op_or_assign
(paren
id|IOMMU_RNGE_2GB
op_or
id|IOMMU_CTRL_ENAB
)paren
suffix:semicolon
id|iommu-&gt;plow
op_assign
id|iommu-&gt;start
op_assign
l_int|0x80000000
suffix:semicolon
r_break
suffix:semicolon
)brace
id|iommu-&gt;regs-&gt;control
op_assign
id|tmp
suffix:semicolon
id|iommu_invalidate
c_func
(paren
id|iommu-&gt;regs
)paren
suffix:semicolon
id|iommu-&gt;end
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Allocate IOMMU page table */
id|ptsize
op_assign
id|iommu-&gt;end
op_minus
id|iommu-&gt;start
op_plus
l_int|1
suffix:semicolon
id|ptsize
op_assign
(paren
id|ptsize
op_rshift
id|PAGE_SHIFT
)paren
op_star
r_sizeof
(paren
id|iopte_t
)paren
suffix:semicolon
multiline_comment|/* Stupid alignment constraints give me a headache. &n;&t;   We want to get very large aligned memory area, larger than&n;&t;   maximum what get_free_pages gives us (128K): we need&n;&t;   256K or 512K or 1M or 2M aligned to its size. */
id|ia
op_assign
(paren
r_struct
id|iommu_alloc
op_star
)paren
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|iommu_alloc
)paren
op_star
l_int|128
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ia
(braket
id|i
)braket
dot
id|addr
op_assign
l_int|0
suffix:semicolon
id|ia
(braket
id|i
)braket
dot
id|next
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|k
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ia
(braket
id|i
)braket
dot
id|addr
op_assign
id|__get_free_pages
c_func
(paren
id|GFP_DMA
comma
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ia
(braket
id|i
)braket
dot
id|addr
op_le
id|ia
(braket
id|k
)braket
dot
id|addr
)paren
(brace
r_if
c_cond
(paren
id|i
)paren
(brace
id|ia
(braket
id|i
)braket
dot
id|next
op_assign
id|k
suffix:semicolon
id|k
op_assign
id|i
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|m
op_assign
id|k
comma
id|l
op_assign
id|ia
(braket
id|k
)braket
dot
id|next
suffix:semicolon
id|l
op_ne
op_minus
l_int|1
suffix:semicolon
id|m
op_assign
id|l
comma
id|l
op_assign
id|ia
(braket
id|l
)braket
dot
id|next
)paren
r_if
c_cond
(paren
id|ia
(braket
id|i
)braket
dot
id|addr
op_le
id|ia
(braket
id|l
)braket
dot
id|addr
)paren
(brace
id|ia
(braket
id|i
)braket
dot
id|next
op_assign
id|l
suffix:semicolon
id|ia
(braket
id|m
)braket
dot
id|next
op_assign
id|i
suffix:semicolon
)brace
r_if
c_cond
(paren
id|l
op_eq
op_minus
l_int|1
)paren
id|ia
(braket
id|m
)braket
dot
id|next
op_assign
id|i
suffix:semicolon
)brace
r_for
c_loop
(paren
id|m
op_assign
op_minus
l_int|1
comma
id|j
op_assign
l_int|0
comma
id|l
op_assign
id|k
suffix:semicolon
id|l
op_ne
op_minus
l_int|1
suffix:semicolon
id|l
op_assign
id|ia
(braket
id|l
)braket
dot
id|next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ia
(braket
id|l
)braket
dot
id|addr
op_amp
(paren
id|ptsize
op_minus
l_int|1
)paren
)paren
)paren
(brace
id|tmp
op_assign
id|ia
(braket
id|l
)braket
dot
id|addr
suffix:semicolon
id|m
op_assign
id|l
suffix:semicolon
id|j
op_assign
l_int|128
op_star
l_int|1024
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|m
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ia
(braket
id|l
)braket
dot
id|addr
op_ne
id|tmp
op_plus
id|j
)paren
id|m
op_assign
op_minus
l_int|1
suffix:semicolon
r_else
(brace
id|j
op_add_assign
l_int|128
op_star
l_int|1024
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
id|ptsize
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|l
op_ne
op_minus
l_int|1
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|128
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Could not allocate iopte of size 0x%08x&bslash;n&quot;
comma
id|ptsize
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|l
op_assign
id|m
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ptsize
suffix:semicolon
id|j
op_add_assign
l_int|128
op_star
l_int|1024
comma
id|l
op_assign
id|ia
(braket
id|l
)braket
dot
id|next
)paren
id|ia
(braket
id|l
)braket
dot
id|addr
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
id|k
suffix:semicolon
id|l
op_ne
op_minus
l_int|1
suffix:semicolon
id|l
op_assign
id|ia
(braket
id|l
)braket
dot
id|next
)paren
r_if
c_cond
(paren
id|ia
(braket
id|l
)braket
dot
id|addr
)paren
id|free_pages
c_func
(paren
id|ia
(braket
id|l
)braket
dot
id|addr
comma
l_int|5
)paren
suffix:semicolon
id|kfree
(paren
id|ia
)paren
suffix:semicolon
id|iommu-&gt;lowest
op_assign
id|iommu-&gt;page_table
op_assign
(paren
id|iopte_t
op_star
)paren
id|tmp
suffix:semicolon
multiline_comment|/* Initialize new table. */
id|flush_cache_all
c_func
(paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|iommu-&gt;page_table
comma
l_int|0
comma
id|ptsize
)paren
suffix:semicolon
id|iommu_map_dvma_pages_for_iommu
c_func
(paren
id|iommu
)paren
suffix:semicolon
r_if
c_cond
(paren
id|viking_mxcc_present
)paren
(brace
r_int
r_int
id|start
op_assign
(paren
r_int
r_int
)paren
id|iommu-&gt;page_table
suffix:semicolon
r_int
r_int
id|end
op_assign
(paren
id|start
op_plus
id|ptsize
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|viking_mxcc_flush_page
c_func
(paren
id|start
)paren
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|viking_flush
)paren
(brace
r_int
r_int
id|start
op_assign
(paren
r_int
r_int
)paren
id|iommu-&gt;page_table
suffix:semicolon
r_int
r_int
id|end
op_assign
(paren
id|start
op_plus
id|ptsize
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|viking_flush_page
c_func
(paren
id|start
)paren
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
id|flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
id|iommu-&gt;regs-&gt;base
op_assign
id|mmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|iommu-&gt;page_table
)paren
op_rshift
l_int|4
suffix:semicolon
id|iommu_invalidate
c_func
(paren
id|iommu-&gt;regs
)paren
suffix:semicolon
id|sbus-&gt;iommu
op_assign
id|iommu
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IOMMU: impl %d vers %d page table at %p of size %d bytes&bslash;n&quot;
comma
id|impl
comma
id|vers
comma
id|iommu-&gt;page_table
comma
id|ptsize
)paren
suffix:semicolon
)brace
DECL|function|iommu_get_scsi_one_noflush
r_static
id|__u32
id|iommu_get_scsi_one_noflush
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_return
(paren
id|__u32
)paren
id|vaddr
suffix:semicolon
)brace
DECL|function|iommu_get_scsi_one_gflush
r_static
id|__u32
id|iommu_get_scsi_one_gflush
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
id|flush_page_for_dma
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|__u32
)paren
id|vaddr
suffix:semicolon
)brace
DECL|function|iommu_get_scsi_one_pflush
r_static
id|__u32
id|iommu_get_scsi_one_pflush
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_int
r_int
id|page
op_assign
(paren
(paren
r_int
r_int
)paren
id|vaddr
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
r_while
c_loop
(paren
id|page
OL
(paren
(paren
r_int
r_int
)paren
(paren
id|vaddr
op_plus
id|len
)paren
)paren
)paren
(brace
id|flush_page_for_dma
c_func
(paren
id|page
)paren
suffix:semicolon
id|page
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_return
(paren
id|__u32
)paren
id|vaddr
suffix:semicolon
)brace
DECL|function|iommu_get_scsi_sgl_noflush
r_static
r_void
id|iommu_get_scsi_sgl_noflush
c_func
(paren
r_struct
id|mmu_sglist
op_star
id|sg
comma
r_int
id|sz
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|sz
op_ge
l_int|0
suffix:semicolon
id|sz
op_decrement
)paren
id|sg
(braket
id|sz
)braket
dot
id|dvma_addr
op_assign
(paren
id|__u32
)paren
(paren
id|sg
(braket
id|sz
)braket
dot
id|addr
)paren
suffix:semicolon
)brace
DECL|function|iommu_get_scsi_sgl_gflush
r_static
r_void
id|iommu_get_scsi_sgl_gflush
c_func
(paren
r_struct
id|mmu_sglist
op_star
id|sg
comma
r_int
id|sz
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
id|flush_page_for_dma
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|sz
op_ge
l_int|0
suffix:semicolon
id|sz
op_decrement
)paren
id|sg
(braket
id|sz
)braket
dot
id|dvma_addr
op_assign
(paren
id|__u32
)paren
(paren
id|sg
(braket
id|sz
)braket
dot
id|addr
)paren
suffix:semicolon
)brace
DECL|function|iommu_get_scsi_sgl_pflush
r_static
r_void
id|iommu_get_scsi_sgl_pflush
c_func
(paren
r_struct
id|mmu_sglist
op_star
id|sg
comma
r_int
id|sz
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_int
r_int
id|page
comma
id|oldpage
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|sz
op_ge
l_int|0
)paren
(brace
id|page
op_assign
(paren
(paren
r_int
r_int
)paren
id|sg
(braket
id|sz
)braket
dot
id|addr
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
id|oldpage
op_eq
id|page
)paren
id|page
op_add_assign
id|PAGE_SIZE
suffix:semicolon
multiline_comment|/* We flushed that page already */
r_while
c_loop
(paren
id|page
OL
(paren
r_int
r_int
)paren
(paren
id|sg
(braket
id|sz
)braket
dot
id|addr
op_plus
id|sg
(braket
id|sz
)braket
dot
id|len
)paren
)paren
(brace
id|flush_page_for_dma
c_func
(paren
id|page
)paren
suffix:semicolon
id|page
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|sg
(braket
id|sz
)braket
dot
id|dvma_addr
op_assign
(paren
id|__u32
)paren
(paren
id|sg
(braket
id|sz
)braket
dot
id|addr
)paren
suffix:semicolon
id|sz
op_decrement
suffix:semicolon
id|oldpage
op_assign
id|page
op_minus
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
DECL|function|iommu_release_scsi_one
r_static
r_void
id|iommu_release_scsi_one
c_func
(paren
id|__u32
id|vaddr
comma
r_int
r_int
id|len
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
)brace
DECL|function|iommu_release_scsi_sgl
r_static
r_void
id|iommu_release_scsi_sgl
c_func
(paren
r_struct
id|mmu_sglist
op_star
id|sg
comma
r_int
id|sz
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
)brace
macro_line|#ifdef CONFIG_SBUS
DECL|function|iommu_map_dma_area
r_static
r_void
id|iommu_map_dma_area
c_func
(paren
r_int
r_int
id|addr
comma
r_int
id|len
)paren
(brace
r_int
r_int
id|page
comma
id|end
suffix:semicolon
id|pgprot_t
id|dvma_prot
suffix:semicolon
r_struct
id|iommu_struct
op_star
id|iommu
op_assign
id|SBus_chain-&gt;iommu
suffix:semicolon
id|iopte_t
op_star
id|iopte
op_assign
id|iommu-&gt;page_table
suffix:semicolon
id|iopte_t
op_star
id|first
suffix:semicolon
r_if
c_cond
(paren
id|viking_mxcc_present
)paren
(brace
id|dvma_prot
op_assign
id|__pgprot
c_func
(paren
id|SRMMU_CACHE
op_or
id|SRMMU_ET_PTE
op_or
id|SRMMU_PRIV
)paren
suffix:semicolon
)brace
r_else
id|dvma_prot
op_assign
id|__pgprot
c_func
(paren
id|SRMMU_ET_PTE
op_or
id|SRMMU_PRIV
)paren
suffix:semicolon
id|iopte
op_add_assign
(paren
(paren
id|addr
op_minus
id|iommu-&gt;start
)paren
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
id|first
op_assign
id|iopte
suffix:semicolon
id|end
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|addr
op_plus
id|len
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|addr
OL
id|end
)paren
(brace
id|page
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;alloc_dvma: Cannot get a dvma page&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
id|pgdp
op_assign
id|pgd_offset
c_func
(paren
id|init_task.mm
comma
id|addr
)paren
suffix:semicolon
id|pmdp
op_assign
id|pmd_offset
c_func
(paren
id|pgdp
comma
id|addr
)paren
suffix:semicolon
id|ptep
op_assign
id|pte_offset
c_func
(paren
id|pmdp
comma
id|addr
)paren
suffix:semicolon
id|set_pte
c_func
(paren
id|ptep
comma
id|pte_val
c_func
(paren
id|mk_pte
c_func
(paren
id|page
comma
id|dvma_prot
)paren
)paren
)paren
suffix:semicolon
id|iopte_val
c_func
(paren
op_star
id|iopte
op_increment
)paren
op_assign
id|MKIOPTE
c_func
(paren
id|mmu_v2p
c_func
(paren
id|page
)paren
)paren
suffix:semicolon
)brace
id|addr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|flush_cache_all
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|viking_mxcc_present
)paren
(brace
r_int
r_int
id|start
op_assign
(paren
(paren
r_int
r_int
)paren
id|first
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
r_int
r_int
id|end
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
(paren
r_int
r_int
)paren
id|iopte
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|viking_mxcc_flush_page
c_func
(paren
id|start
)paren
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|viking_flush
)paren
(brace
r_int
r_int
id|start
op_assign
(paren
(paren
r_int
r_int
)paren
id|first
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
r_int
r_int
id|end
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
(paren
r_int
r_int
)paren
id|iopte
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|viking_flush_page
c_func
(paren
id|start
)paren
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
id|flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
id|iommu_invalidate
c_func
(paren
id|iommu-&gt;regs
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|iommu_lockarea
r_static
r_char
op_star
id|iommu_lockarea
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
)paren
(brace
r_return
id|vaddr
suffix:semicolon
)brace
DECL|function|iommu_unlockarea
r_static
r_void
id|iommu_unlockarea
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
)paren
(brace
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|ld_mmu_iommu
c_func
(paren
r_void
)paren
)paren
(brace
id|viking_flush
op_assign
(paren
id|BTFIXUPVAL_CALL
c_func
(paren
id|flush_page_for_dma
)paren
op_eq
(paren
r_int
r_int
)paren
id|viking_flush_page
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_lockarea
comma
id|iommu_lockarea
comma
id|BTFIXUPCALL_RETO0
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_unlockarea
comma
id|iommu_unlockarea
comma
id|BTFIXUPCALL_NOP
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|BTFIXUPVAL_CALL
c_func
(paren
id|flush_page_for_dma
)paren
)paren
(brace
multiline_comment|/* IO coherent chip */
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_get_scsi_one
comma
id|iommu_get_scsi_one_noflush
comma
id|BTFIXUPCALL_RETO0
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_get_scsi_sgl
comma
id|iommu_get_scsi_sgl_noflush
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|flush_page_for_dma_global
)paren
(brace
multiline_comment|/* flush_page_for_dma flushes everything, no matter of what page is it */
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_get_scsi_one
comma
id|iommu_get_scsi_one_gflush
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_get_scsi_sgl
comma
id|iommu_get_scsi_sgl_gflush
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
)brace
r_else
(brace
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_get_scsi_one
comma
id|iommu_get_scsi_one_pflush
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_get_scsi_sgl
comma
id|iommu_get_scsi_sgl_pflush
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
)brace
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_release_scsi_one
comma
id|iommu_release_scsi_one
comma
id|BTFIXUPCALL_NOP
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_release_scsi_sgl
comma
id|iommu_release_scsi_sgl
comma
id|BTFIXUPCALL_NOP
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SBUS
id|BTFIXUPSET_CALL
c_func
(paren
id|mmu_map_dma_area
comma
id|iommu_map_dma_area
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
