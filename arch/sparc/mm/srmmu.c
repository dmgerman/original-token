multiline_comment|/* $Id: srmmu.c,v 1.34 1996/03/01 07:16:23 davem Exp $&n; * srmmu.c:  SRMMU specific routines for memory management.&n; *&n; * Copyright (C) 1995 David S. Miller  (davem@caip.rutgers.edu)&n; * Copyright (C) 1995 Peter A. Zaitcev (zaitcev@ithil.mcst.ru)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/kdebug.h&gt;
macro_line|#include &lt;asm/vaddrs.h&gt;
macro_line|#include &lt;asm/traps.h&gt;
macro_line|#include &lt;asm/mp.h&gt;
macro_line|#include &lt;asm/mbus.h&gt;
macro_line|#include &lt;asm/cache.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/iommu.h&gt;
multiline_comment|/* Now the cpu specific definitions. */
macro_line|#include &lt;asm/viking.h&gt;
macro_line|#include &lt;asm/ross.h&gt;
macro_line|#include &lt;asm/tsunami.h&gt;
macro_line|#include &lt;asm/swift.h&gt;
DECL|variable|srmmu_modtype
r_enum
id|mbus_module
id|srmmu_modtype
suffix:semicolon
DECL|variable|hwbug_bitmask
r_int
r_int
id|hwbug_bitmask
suffix:semicolon
DECL|variable|hyper_cache_size
r_int
id|hyper_cache_size
suffix:semicolon
DECL|variable|srmmu_context_table
id|ctxd_t
op_star
id|srmmu_context_table
suffix:semicolon
multiline_comment|/* In general all page table modifications should use the V8 atomic&n; * swap instruction.  This insures the mmu and the cpu are in sync&n; * with respect to ref/mod bits in the page tables.&n; */
DECL|function|srmmu_swap
r_static
r_inline
r_int
r_int
id|srmmu_swap
c_func
(paren
r_int
r_int
op_star
id|addr
comma
r_int
r_int
id|value
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;swap [%1], %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|value
)paren
comma
l_string|&quot;=&amp;r&quot;
(paren
id|addr
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|value
)paren
comma
l_string|&quot;1&quot;
(paren
id|addr
)paren
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/* Functions really use this, not srmmu_swap directly. */
DECL|macro|srmmu_set_entry
mdefine_line|#define srmmu_set_entry(ptr, newentry) &bslash;&n;        srmmu_swap((unsigned long *) (ptr), (newentry))
multiline_comment|/* We still don&squot;t use these at all, perhaps we don&squot;t need them&n; * at all.&n; */
DECL|variable|srmmu_read_physical
r_int
r_int
(paren
op_star
id|srmmu_read_physical
)paren
(paren
r_int
r_int
id|paddr
)paren
suffix:semicolon
DECL|variable|srmmu_write_physical
r_void
(paren
op_star
id|srmmu_write_physical
)paren
(paren
r_int
r_int
id|paddr
comma
r_int
r_int
id|word
)paren
suffix:semicolon
DECL|function|gensrmmu_read_physical
r_static
r_int
r_int
id|gensrmmu_read_physical
c_func
(paren
r_int
r_int
id|paddr
)paren
(brace
r_int
r_int
id|word
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lda [%1] %2, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|word
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|paddr
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_BYPASS
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
r_return
id|word
suffix:semicolon
)brace
DECL|function|msparc_read_physical
r_static
r_int
r_int
id|msparc_read_physical
c_func
(paren
r_int
r_int
id|paddr
)paren
(brace
r_int
r_int
id|word
comma
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lda [%%g0] %3, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;or  %%g1, %4, %%g2&bslash;n&bslash;t&quot;
l_string|&quot;sta %%g2, [%%g0] %3&bslash;n&bslash;t&quot;
l_string|&quot;lda [%1] %2, %0&bslash;n&bslash;t&quot;
l_string|&quot;sta %%g1, [%%g0] %3&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|word
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|paddr
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_BYPASS
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_MMUREGS
)paren
comma
l_string|&quot;r&quot;
(paren
id|VIKING_ACENABLE
)paren
suffix:colon
l_string|&quot;g1&quot;
comma
l_string|&quot;g2&quot;
comma
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|word
suffix:semicolon
)brace
DECL|function|gensrmmu_write_physical
r_static
r_void
id|gensrmmu_write_physical
c_func
(paren
r_int
r_int
id|paddr
comma
r_int
r_int
id|word
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %0, [%1] %2&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|word
)paren
comma
l_string|&quot;r&quot;
(paren
id|paddr
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_BYPASS
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
DECL|function|msparc_write_physical
r_static
r_void
id|msparc_write_physical
c_func
(paren
r_int
r_int
id|paddr
comma
r_int
r_int
id|word
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lda [%%g0] %3, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;or  %%g1, %4, %%g2&bslash;n&bslash;t&quot;
l_string|&quot;sta %%g2, [%%g0] %3&bslash;n&bslash;t&quot;
l_string|&quot;sta %0, [%1] %2&bslash;n&bslash;t&quot;
l_string|&quot;sta %%g1, [%%g0] %3&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|word
)paren
comma
l_string|&quot;r&quot;
(paren
id|paddr
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_BYPASS
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_MMUREGS
)paren
comma
l_string|&quot;r&quot;
(paren
id|VIKING_ACENABLE
)paren
suffix:colon
l_string|&quot;g1&quot;
comma
l_string|&quot;g2&quot;
comma
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_align
r_static
r_int
r_int
id|srmmu_pmd_align
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|SRMMU_PMD_ALIGN
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgdir_align
r_static
r_int
r_int
id|srmmu_pgdir_align
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|SRMMU_PGDIR_ALIGN
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|srmmu_vmalloc_start
r_static
r_int
r_int
id|srmmu_vmalloc_start
c_func
(paren
r_void
)paren
(brace
r_return
id|SRMMU_VMALLOC_START
suffix:semicolon
)brace
DECL|function|srmmu_pgd_page
r_static
r_int
r_int
id|srmmu_pgd_page
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
id|PAGE_OFFSET
op_plus
(paren
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|SRMMU_PTD_PMASK
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_page
r_static
r_int
r_int
id|srmmu_pmd_page
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
id|PAGE_OFFSET
op_plus
(paren
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|SRMMU_PTD_PMASK
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_page
r_static
r_int
r_int
id|srmmu_pte_page
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|PAGE_OFFSET
op_plus
(paren
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|SRMMU_PTE_PMASK
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_none
r_static
r_int
id|srmmu_pte_none
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
op_logical_neg
id|pte_val
c_func
(paren
id|pte
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_present
r_static
r_int
id|srmmu_pte_present
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
(paren
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_eq
id|SRMMU_ET_PTE
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_inuse
r_static
r_int
id|srmmu_pte_inuse
c_func
(paren
id|pte_t
op_star
id|ptep
)paren
(brace
r_return
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|ptep
)paren
)braket
dot
id|reserved
op_logical_or
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|ptep
)paren
)braket
dot
id|count
op_ne
l_int|1
suffix:semicolon
)brace
DECL|function|srmmu_pte_clear
r_static
r_void
id|srmmu_pte_clear
c_func
(paren
id|pte_t
op_star
id|ptep
)paren
(brace
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|srmmu_pte_reuse
r_static
r_void
id|srmmu_pte_reuse
c_func
(paren
id|pte_t
op_star
id|ptep
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|ptep
)paren
)braket
dot
id|reserved
)paren
(brace
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|ptep
)paren
)braket
dot
id|count
op_increment
suffix:semicolon
)brace
)brace
DECL|function|srmmu_pmd_none
r_static
r_int
id|srmmu_pmd_none
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
op_logical_neg
id|pmd_val
c_func
(paren
id|pmd
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_bad
r_static
r_int
id|srmmu_pmd_bad
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_ne
id|SRMMU_ET_PTD
suffix:semicolon
)brace
DECL|function|srmmu_pmd_present
r_static
r_int
id|srmmu_pmd_present
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_eq
id|SRMMU_ET_PTD
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_inuse
r_static
r_int
id|srmmu_pmd_inuse
c_func
(paren
id|pmd_t
op_star
id|pmdp
)paren
(brace
r_return
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|pmdp
)paren
)braket
dot
id|reserved
op_logical_or
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|pmdp
)paren
)braket
dot
id|count
op_ne
l_int|1
suffix:semicolon
)brace
DECL|function|srmmu_pmd_clear
r_static
r_void
id|srmmu_pmd_clear
c_func
(paren
id|pmd_t
op_star
id|pmdp
)paren
(brace
id|pmd_val
c_func
(paren
op_star
id|pmdp
)paren
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|srmmu_pmd_reuse
r_static
r_void
id|srmmu_pmd_reuse
c_func
(paren
id|pmd_t
op_star
id|pmdp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|pmdp
)paren
)braket
dot
id|reserved
)paren
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|pmdp
)paren
)braket
dot
id|count
op_increment
suffix:semicolon
)brace
DECL|function|srmmu_pgd_none
r_static
r_int
id|srmmu_pgd_none
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
op_logical_neg
id|pgd_val
c_func
(paren
id|pgd
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgd_bad
r_static
r_int
id|srmmu_pgd_bad
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_ne
id|SRMMU_ET_PTD
suffix:semicolon
)brace
DECL|function|srmmu_pgd_present
r_static
r_int
id|srmmu_pgd_present
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
(paren
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_eq
id|SRMMU_ET_PTD
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgd_inuse
r_static
r_int
id|srmmu_pgd_inuse
c_func
(paren
id|pgd_t
op_star
id|pgdp
)paren
(brace
r_return
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|pgdp
)paren
)braket
dot
id|reserved
suffix:semicolon
)brace
DECL|function|srmmu_pgd_clear
r_static
r_void
id|srmmu_pgd_clear
c_func
(paren
id|pgd_t
op_star
id|pgdp
)paren
(brace
id|pgd_val
c_func
(paren
op_star
id|pgdp
)paren
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|srmmu_pgd_reuse
r_static
r_void
id|srmmu_pgd_reuse
c_func
(paren
id|pgd_t
op_star
id|pgdp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|pgdp
)paren
)braket
dot
id|reserved
)paren
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|pgdp
)paren
)braket
dot
id|count
op_increment
suffix:semicolon
)brace
DECL|function|srmmu_pte_write
r_static
r_int
id|srmmu_pte_write
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|SRMMU_WRITE
suffix:semicolon
)brace
DECL|function|srmmu_pte_dirty
r_static
r_int
id|srmmu_pte_dirty
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|SRMMU_DIRTY
suffix:semicolon
)brace
DECL|function|srmmu_pte_young
r_static
r_int
id|srmmu_pte_young
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|SRMMU_REF
suffix:semicolon
)brace
DECL|function|srmmu_pte_wrprotect
r_static
id|pte_t
id|srmmu_pte_wrprotect
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_and_assign
op_complement
id|SRMMU_WRITE
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_pte_mkclean
r_static
id|pte_t
id|srmmu_pte_mkclean
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_and_assign
op_complement
id|SRMMU_DIRTY
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_pte_mkold
r_static
id|pte_t
id|srmmu_pte_mkold
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_and_assign
op_complement
id|SRMMU_REF
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_pte_mkwrite
r_static
id|pte_t
id|srmmu_pte_mkwrite
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_or_assign
id|SRMMU_WRITE
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_pte_mkdirty
r_static
id|pte_t
id|srmmu_pte_mkdirty
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_or_assign
id|SRMMU_DIRTY
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_pte_mkyoung
r_static
id|pte_t
id|srmmu_pte_mkyoung
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_or_assign
id|SRMMU_REF
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
multiline_comment|/*&n; * Conversion functions: convert a page and protection to a page entry,&n; * and a page entry and page directory to the page they refer to.&n; */
DECL|function|srmmu_mk_pte
r_static
id|pte_t
id|srmmu_mk_pte
c_func
(paren
r_int
r_int
id|page
comma
id|pgprot_t
id|pgprot
)paren
(brace
id|pte_t
id|pte
suffix:semicolon
id|pte_val
c_func
(paren
id|pte
)paren
op_assign
(paren
(paren
id|page
op_minus
id|PAGE_OFFSET
)paren
op_rshift
l_int|4
)paren
op_or
id|pgprot_val
c_func
(paren
id|pgprot
)paren
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_mk_pte_io
r_static
id|pte_t
id|srmmu_mk_pte_io
c_func
(paren
r_int
r_int
id|page
comma
id|pgprot_t
id|pgprot
)paren
(brace
id|pte_t
id|pte
suffix:semicolon
id|pte_val
c_func
(paren
id|pte
)paren
op_assign
(paren
(paren
id|page
)paren
op_rshift
l_int|4
)paren
op_or
id|pgprot_val
c_func
(paren
id|pgprot
)paren
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_ctxd_set
r_static
r_void
id|srmmu_ctxd_set
c_func
(paren
id|ctxd_t
op_star
id|ctxp
comma
id|pgd_t
op_star
id|pgdp
)paren
(brace
id|srmmu_set_entry
c_func
(paren
id|ctxp
comma
(paren
id|SRMMU_ET_PTD
op_or
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|pgdp
)paren
op_minus
id|PAGE_OFFSET
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgd_set
r_static
r_void
id|srmmu_pgd_set
c_func
(paren
id|pgd_t
op_star
id|pgdp
comma
id|pmd_t
op_star
id|pmdp
)paren
(brace
id|srmmu_set_entry
c_func
(paren
id|pgdp
comma
(paren
id|SRMMU_ET_PTD
op_or
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|pmdp
)paren
op_minus
id|PAGE_OFFSET
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_set
r_static
r_void
id|srmmu_pmd_set
c_func
(paren
id|pmd_t
op_star
id|pmdp
comma
id|pte_t
op_star
id|ptep
)paren
(brace
id|srmmu_set_entry
c_func
(paren
id|pmdp
comma
(paren
id|SRMMU_ET_PTD
op_or
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|ptep
)paren
op_minus
id|PAGE_OFFSET
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_modify
r_static
id|pte_t
id|srmmu_pte_modify
c_func
(paren
id|pte_t
id|pte
comma
id|pgprot_t
id|newprot
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_assign
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
op_complement
l_int|0xff
)paren
op_or
id|pgprot_val
c_func
(paren
id|newprot
)paren
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
multiline_comment|/* to find an entry in a top-level page table... */
DECL|function|srmmu_pgd_offset
r_static
id|pgd_t
op_star
id|srmmu_pgd_offset
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|address
)paren
(brace
r_return
id|mm-&gt;pgd
op_plus
(paren
(paren
id|address
op_rshift
id|SRMMU_PGDIR_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PGD
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Find an entry in the second-level page table.. */
DECL|function|srmmu_pmd_offset
r_static
id|pmd_t
op_star
id|srmmu_pmd_offset
c_func
(paren
id|pgd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pmd_t
op_star
)paren
id|pgd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|SRMMU_PMD_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Find an entry in the third-level page table.. */
DECL|function|srmmu_pte_offset
r_static
id|pte_t
op_star
id|srmmu_pte_offset
c_func
(paren
id|pmd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pte_t
op_star
)paren
id|pmd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* This must update the context table entry for this process. */
DECL|function|srmmu_update_rootmmu_dir
r_static
r_void
id|srmmu_update_rootmmu_dir
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
id|pgd_t
op_star
id|pgdp
)paren
(brace
r_if
c_cond
(paren
id|tsk-&gt;mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
id|srmmu_ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|tsk-&gt;mm-&gt;context
)braket
comma
id|pgdp
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Allocate and free page tables. The xxx_kernel() versions are&n; * used to allocate a kernel page table - this turns on ASN bits&n; * if any, and marks the page tables reserved.&n; */
DECL|function|srmmu_pte_free_kernel
r_static
r_void
id|srmmu_pte_free_kernel
c_func
(paren
id|pte_t
op_star
id|pte
)paren
(brace
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|pte
)paren
)braket
dot
id|reserved
op_assign
l_int|0
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|pte
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_alloc_kernel
r_static
id|pte_t
op_star
id|srmmu_pte_alloc_kernel
c_func
(paren
id|pmd_t
op_star
id|pmd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|pte_t
op_star
id|page
op_assign
(paren
id|pte_t
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|srmmu_pmd_set
c_func
(paren
id|pmd
comma
id|page
)paren
suffix:semicolon
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|page
)paren
)braket
dot
id|reserved
op_assign
l_int|1
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|srmmu_pmd_set
c_func
(paren
id|pmd
comma
(paren
id|pte_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srmmu_pmd_bad
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pmd in pte_alloc: %08lx&bslash;n&quot;
comma
id|pmd_val
c_func
(paren
op_star
id|pmd
)paren
)paren
suffix:semicolon
id|srmmu_pmd_set
c_func
(paren
id|pmd
comma
(paren
id|pte_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pte_t
op_star
)paren
id|srmmu_pmd_page
c_func
(paren
op_star
id|pmd
)paren
op_plus
id|address
suffix:semicolon
)brace
DECL|function|srmmu_pmd_free_kernel
r_static
r_void
id|srmmu_pmd_free_kernel
c_func
(paren
id|pmd_t
op_star
id|pmd
)paren
(brace
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|pmd
)paren
)braket
dot
id|reserved
op_assign
l_int|0
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|pmd
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_alloc_kernel
r_static
id|pmd_t
op_star
id|srmmu_pmd_alloc_kernel
c_func
(paren
id|pgd_t
op_star
id|pgd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|SRMMU_PMD_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|pmd_t
op_star
id|page
op_assign
(paren
id|pmd_t
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|srmmu_pgd_set
c_func
(paren
id|pgd
comma
id|page
)paren
suffix:semicolon
id|mem_map
(braket
id|MAP_NR
c_func
(paren
id|page
)paren
)braket
dot
id|reserved
op_assign
l_int|1
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|srmmu_pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srmmu_pgd_bad
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pgd in pmd_alloc: %08lx&bslash;n&quot;
comma
id|pgd_val
c_func
(paren
op_star
id|pgd
)paren
)paren
suffix:semicolon
id|srmmu_pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pmd_t
op_star
)paren
id|pgd_page
c_func
(paren
op_star
id|pgd
)paren
op_plus
id|address
suffix:semicolon
)brace
DECL|function|srmmu_pte_free
r_static
r_void
id|srmmu_pte_free
c_func
(paren
id|pte_t
op_star
id|pte
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|pte
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_alloc
r_static
id|pte_t
op_star
id|srmmu_pte_alloc
c_func
(paren
id|pmd_t
op_star
id|pmd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|pte_t
op_star
id|page
op_assign
(paren
id|pte_t
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|srmmu_pmd_set
c_func
(paren
id|pmd
comma
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|srmmu_pmd_set
c_func
(paren
id|pmd
comma
(paren
id|pte_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srmmu_pmd_bad
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pmd in pte_alloc: %08lx&bslash;n&quot;
comma
id|pmd_val
c_func
(paren
op_star
id|pmd
)paren
)paren
suffix:semicolon
id|srmmu_pmd_set
c_func
(paren
id|pmd
comma
(paren
id|pte_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pte_t
op_star
)paren
id|pmd_page
c_func
(paren
op_star
id|pmd
)paren
op_plus
id|address
suffix:semicolon
)brace
multiline_comment|/* Real three-level page tables on SRMMU. */
DECL|function|srmmu_pmd_free
r_static
r_void
id|srmmu_pmd_free
c_func
(paren
id|pmd_t
op_star
id|pmd
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|pmd
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_alloc
r_static
id|pmd_t
op_star
id|srmmu_pmd_alloc
c_func
(paren
id|pgd_t
op_star
id|pgd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|SRMMU_PMD_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|pmd_t
op_star
id|page
op_assign
(paren
id|pmd_t
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|srmmu_pgd_set
c_func
(paren
id|pgd
comma
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|srmmu_pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srmmu_pgd_bad
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pgd in pmd_alloc: %08lx&bslash;n&quot;
comma
id|pgd_val
c_func
(paren
op_star
id|pgd
)paren
)paren
suffix:semicolon
id|srmmu_pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pmd_t
op_star
)paren
id|srmmu_pgd_page
c_func
(paren
op_star
id|pgd
)paren
op_plus
id|address
suffix:semicolon
)brace
DECL|function|srmmu_pgd_free
r_static
r_void
id|srmmu_pgd_free
c_func
(paren
id|pgd_t
op_star
id|pgd
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|pgd
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgd_alloc
r_static
id|pgd_t
op_star
id|srmmu_pgd_alloc
c_func
(paren
r_void
)paren
(brace
r_return
(paren
id|pgd_t
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
multiline_comment|/* Tsunami invalidates.  It&squot;s page level tlb invalidation is not very&n; * useful at all, you must be in the context that page exists in to&n; * get a match.  It might be worthwhile to try someday though...&n; */
DECL|function|tsunami_invalidate_all
multiline_comment|/* static */
r_inline
r_void
id|tsunami_invalidate_all
c_func
(paren
r_void
)paren
(brace
id|tsunami_invalidate_icache
c_func
(paren
)paren
suffix:semicolon
id|tsunami_invalidate_dcache
c_func
(paren
)paren
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|tsunami_invalidate_mm
r_static
r_void
id|tsunami_invalidate_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
id|tsunami_invalidate_all
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|tsunami_invalidate_range
r_static
r_void
id|tsunami_invalidate_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|tsunami_invalidate_all
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* XXX do page level tlb flushes at some point XXX */
DECL|function|tsunami_invalidate_page
r_static
r_void
id|tsunami_invalidate_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vmp
comma
r_int
r_int
id|page
)paren
(brace
id|tsunami_invalidate_all
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Swift invalidates.  It has the recommended SRMMU specification flushing&n; * facilities, so we can do things in a more fine grained fashion than we&n; * could on the tsunami.  Let&squot;s watch out for HARDWARE BUGS...&n; */
DECL|function|swift_invalidate_all
r_static
r_inline
r_void
id|swift_invalidate_all
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|addr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Invalidate all cache tags */
r_for
c_loop
(paren
id|addr
op_assign
l_int|0
suffix:semicolon
id|addr
OL
(paren
id|PAGE_SIZE
op_lshift
l_int|2
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|16
)paren
(brace
id|swift_inv_insn_tag
c_func
(paren
id|addr
)paren
suffix:semicolon
multiline_comment|/* whiz- */
id|swift_inv_data_tag
c_func
(paren
id|addr
)paren
suffix:semicolon
multiline_comment|/* bang */
)brace
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|swift_invalidate_mm
r_static
r_void
id|swift_invalidate_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|cc
comma
id|ncc
op_assign
id|mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|ncc
op_eq
id|NO_CONTEXT
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/* have context will travel... */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cc
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|ncc
)paren
suffix:semicolon
)brace
id|swift_flush_context
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* POOF! */
id|srmmu_flush_tlb_ctx
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* POW! */
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|cc
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|swift_invalidate_range
r_static
r_void
id|swift_invalidate_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
r_int
r_int
id|flags
comma
id|addr
suffix:semicolon
r_int
id|cc
comma
id|ncc
op_assign
id|mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|ncc
op_eq
id|NO_CONTEXT
)paren
(brace
r_return
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cc
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|ncc
)paren
suffix:semicolon
)brace
multiline_comment|/* XXX Inefficient, we don&squot;t do the best we can... XXX */
id|addr
op_assign
id|start
op_amp
id|SRMMU_PGDIR_MASK
suffix:semicolon
r_while
c_loop
(paren
id|addr
OL
id|end
)paren
(brace
id|swift_flush_region
c_func
(paren
id|addr
)paren
suffix:semicolon
id|srmmu_flush_tlb_region
c_func
(paren
id|addr
)paren
suffix:semicolon
id|addr
op_add_assign
id|SRMMU_PGDIR_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|cc
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|swift_invalidate_page
r_static
r_void
id|swift_invalidate_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vmp
comma
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|cc
comma
id|ncc
op_assign
id|vmp-&gt;vm_mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|ncc
op_eq
id|NO_CONTEXT
)paren
(brace
r_return
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cc
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|ncc
)paren
suffix:semicolon
)brace
id|swift_flush_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|srmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|cc
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* The following are all MBUS based SRMMU modules, and therefore could&n; * be found in a multiprocessor configuration.&n; */
multiline_comment|/* Viking invalidates.  For Sun&squot;s mainline MBUS processor it is pretty much&n; * a crappy mmu.  The on-chip I&amp;D caches only have full flushes, no fine&n; * grained cache invalidations.  It only has these &quot;flash clear&quot; things&n; * just like the MicroSparcI.  Added to this many revs of the chip are&n; * teaming with hardware buggery.&n; *&n; * XXX need to handle SMP broadcast invalidations! XXX&n; */
DECL|function|viking_invalidate_all
r_static
r_inline
r_void
id|viking_invalidate_all
c_func
(paren
r_void
)paren
(brace
id|viking_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|viking_flush_dcache
c_func
(paren
)paren
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|viking_invalidate_mm
r_static
r_void
id|viking_invalidate_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|cc
comma
id|ncc
op_assign
id|mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|ncc
op_eq
id|NO_CONTEXT
)paren
(brace
r_return
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cc
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|ncc
)paren
suffix:semicolon
)brace
id|viking_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|viking_flush_dcache
c_func
(paren
)paren
suffix:semicolon
id|srmmu_flush_tlb_ctx
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|cc
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|viking_invalidate_range
r_static
r_void
id|viking_invalidate_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
r_int
r_int
id|flags
comma
id|addr
suffix:semicolon
r_int
id|cc
comma
id|ncc
op_assign
id|mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|ncc
op_eq
id|NO_CONTEXT
)paren
(brace
r_return
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cc
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|ncc
)paren
suffix:semicolon
)brace
multiline_comment|/* XXX Inefficient, we don&squot;t do the best we can... XXX */
id|viking_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|viking_flush_dcache
c_func
(paren
)paren
suffix:semicolon
id|addr
op_assign
id|start
op_amp
id|SRMMU_PGDIR_MASK
suffix:semicolon
r_while
c_loop
(paren
id|addr
OL
id|end
)paren
(brace
id|srmmu_flush_tlb_region
c_func
(paren
id|addr
)paren
suffix:semicolon
id|addr
op_add_assign
id|SRMMU_PGDIR_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|cc
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|viking_invalidate_page
r_static
r_void
id|viking_invalidate_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vmp
comma
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|cc
comma
id|ncc
op_assign
id|vmp-&gt;vm_mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|ncc
op_eq
id|NO_CONTEXT
)paren
(brace
r_return
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cc
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|ncc
)paren
suffix:semicolon
)brace
id|viking_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|viking_flush_dcache
c_func
(paren
)paren
suffix:semicolon
id|srmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|cc
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Cypress invalidates. */
DECL|function|cypress_invalidate_all
r_static
r_inline
r_void
id|cypress_invalidate_all
c_func
(paren
r_void
)paren
(brace
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cypress_invalidate_mm
r_static
r_void
id|cypress_invalidate_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|cc
comma
id|ncc
op_assign
id|mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|ncc
op_eq
id|NO_CONTEXT
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/* have context will travel... */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cc
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|ncc
)paren
suffix:semicolon
)brace
id|cypress_flush_context
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* POOF! */
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* POW! */
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|cc
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cypress_invalidate_range
r_static
r_void
id|cypress_invalidate_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
r_int
r_int
id|flags
comma
id|addr
suffix:semicolon
r_int
id|cc
comma
id|ncc
op_assign
id|mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|ncc
op_eq
id|NO_CONTEXT
)paren
(brace
r_return
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cc
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|ncc
)paren
suffix:semicolon
)brace
multiline_comment|/* XXX Inefficient, we don&squot;t do the best we can... XXX */
id|addr
op_assign
id|start
op_amp
id|SRMMU_PGDIR_MASK
suffix:semicolon
r_while
c_loop
(paren
id|addr
OL
id|end
)paren
(brace
id|cypress_flush_region
c_func
(paren
id|addr
)paren
suffix:semicolon
id|addr
op_add_assign
id|SRMMU_PGDIR_SIZE
suffix:semicolon
)brace
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|cc
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cypress_invalidate_page
r_static
r_void
id|cypress_invalidate_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vmp
comma
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|cc
comma
id|ncc
op_assign
id|vmp-&gt;vm_mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|ncc
op_eq
id|NO_CONTEXT
)paren
(brace
r_return
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|cc
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|ncc
)paren
suffix:semicolon
)brace
id|swift_flush_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ncc
)paren
(brace
id|srmmu_set_context
c_func
(paren
id|cc
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Hypersparc invalidates. */
DECL|function|hypersparc_invalidate_all
r_static
r_inline
r_void
id|hypersparc_invalidate_all
c_func
(paren
r_void
)paren
(brace
id|hyper_flush_whole_icache
c_func
(paren
)paren
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|hypersparc_invalidate_mm
r_static
r_void
id|hypersparc_invalidate_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
)brace
DECL|function|hypersparc_invalidate_range
r_static
r_void
id|hypersparc_invalidate_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
)brace
DECL|function|hypersparc_invalidate_page
r_static
r_void
id|hypersparc_invalidate_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vmp
comma
r_int
r_int
id|page
)paren
(brace
)brace
DECL|function|srmmu_set_pte
r_static
r_void
id|srmmu_set_pte
c_func
(paren
id|pte_t
op_star
id|ptep
comma
id|pte_t
id|pteval
)paren
(brace
id|srmmu_set_entry
c_func
(paren
id|ptep
comma
id|pte_val
c_func
(paren
id|pteval
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_quick_kernel_fault
r_static
r_void
id|srmmu_quick_kernel_fault
c_func
(paren
r_int
r_int
id|address
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;SRMMU: quick_kernel_fault called for %08lx&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Srmmu bolixed...&quot;
)paren
suffix:semicolon
)brace
DECL|function|alloc_context
r_static
r_inline
r_void
id|alloc_context
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_struct
id|ctx_list
op_star
id|ctxp
suffix:semicolon
id|ctxp
op_assign
id|ctx_free.next
suffix:semicolon
r_if
c_cond
(paren
id|ctxp
op_ne
op_amp
id|ctx_free
)paren
(brace
id|remove_from_ctx_list
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|add_to_used_ctxlist
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|mm-&gt;context
op_assign
id|ctxp-&gt;ctx_number
suffix:semicolon
id|ctxp-&gt;ctx_mm
op_assign
id|mm
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ctxp
op_assign
id|ctx_used.next
suffix:semicolon
r_if
c_cond
(paren
id|ctxp-&gt;ctx_mm
op_eq
id|current-&gt;mm
)paren
(brace
id|ctxp
op_assign
id|ctxp-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctxp
op_eq
op_amp
id|ctx_used
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;out of mmu contexts&quot;
)paren
suffix:semicolon
)brace
id|remove_from_ctx_list
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|add_to_used_ctxlist
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|ctxp-&gt;ctx_mm-&gt;context
op_assign
id|NO_CONTEXT
suffix:semicolon
id|ctxp-&gt;ctx_mm
op_assign
id|mm
suffix:semicolon
id|mm-&gt;context
op_assign
id|ctxp-&gt;ctx_number
suffix:semicolon
)brace
DECL|function|srmmu_switch_to_context
r_static
r_void
id|srmmu_switch_to_context
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
multiline_comment|/* Kernel threads can execute in any context and so can tasks&n;&t; * sleeping in the middle of exiting. If this task has already&n;&t; * been allocated a piece of the mmu realestate, just jump to&n;&t; * it.&n;&t; */
r_if
c_cond
(paren
(paren
id|tsk-&gt;tss.flags
op_amp
id|SPARC_FLAG_KTHREAD
)paren
op_logical_or
(paren
id|tsk-&gt;flags
op_amp
id|PF_EXITING
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tsk-&gt;mm-&gt;context
op_eq
id|NO_CONTEXT
)paren
(brace
id|alloc_context
c_func
(paren
id|tsk-&gt;mm
)paren
suffix:semicolon
id|srmmu_ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|tsk-&gt;mm-&gt;context
)braket
comma
id|tsk-&gt;mm-&gt;pgd
)paren
suffix:semicolon
)brace
id|srmmu_set_context
c_func
(paren
id|tsk-&gt;mm-&gt;context
)paren
suffix:semicolon
)brace
multiline_comment|/* Low level IO area allocation on the SRMMU. */
DECL|function|srmmu_mapioaddr
r_void
id|srmmu_mapioaddr
c_func
(paren
r_int
r_int
id|physaddr
comma
r_int
r_int
id|virt_addr
comma
r_int
id|bus_type
comma
r_int
id|rdonly
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|physaddr
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|virt_addr
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|virt_addr
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|virt_addr
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|physaddr
op_rshift
l_int|4
)paren
op_or
id|SRMMU_ET_PTE
suffix:semicolon
multiline_comment|/* I need to test whether this is consistant over all&n;&t; * sun4m&squot;s.  The bus_type represents the upper 4 bits of&n;&t; * 36-bit physical address on the I/O space lines...&n;&t; */
id|tmp
op_or_assign
(paren
id|bus_type
op_lshift
l_int|28
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rdonly
)paren
(brace
id|tmp
op_or_assign
id|SRMMU_PRIV_RDONLY
suffix:semicolon
)brace
r_else
id|tmp
op_or_assign
id|SRMMU_PRIV
suffix:semicolon
id|srmmu_set_entry
c_func
(paren
id|ptep
comma
id|tmp
)paren
suffix:semicolon
id|invalidate_all
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_lockarea
r_static
r_char
op_star
id|srmmu_lockarea
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
)paren
(brace
r_return
id|vaddr
suffix:semicolon
)brace
DECL|function|srmmu_unlockarea
r_static
r_void
id|srmmu_unlockarea
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
)paren
(brace
)brace
multiline_comment|/* IOMMU things go here. */
DECL|macro|LONG_ALIGN
mdefine_line|#define LONG_ALIGN(x) (((x)+(sizeof(long))-1)&amp;~((sizeof(long))-1))
DECL|variable|first_dvma_page
DECL|variable|last_dvma_page
r_static
r_int
r_int
id|first_dvma_page
comma
id|last_dvma_page
suffix:semicolon
DECL|function|srmmu_map_dvma_pages_for_iommu
r_static
r_inline
r_void
id|srmmu_map_dvma_pages_for_iommu
c_func
(paren
r_struct
id|iommu_struct
op_star
id|iommu
)paren
(brace
r_int
r_int
id|first
op_assign
id|first_dvma_page
suffix:semicolon
r_int
r_int
id|last
op_assign
id|last_dvma_page
suffix:semicolon
id|iopte_t
op_star
id|iopte
suffix:semicolon
id|iopte
op_assign
id|iommu-&gt;page_table
suffix:semicolon
id|iopte
op_add_assign
(paren
(paren
id|DVMA_VADDR
op_minus
id|iommu-&gt;start
)paren
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
r_while
c_loop
(paren
id|first
op_le
id|last
)paren
(brace
id|iopte_val
c_func
(paren
op_star
id|iopte
op_increment
)paren
op_assign
(paren
(paren
(paren
(paren
id|first
op_minus
id|PAGE_OFFSET
)paren
op_rshift
l_int|4
)paren
op_amp
id|IOPTE_PAGE
)paren
op_or
(paren
id|IOPTE_WRITE
op_or
id|IOPTE_VALID
)paren
)paren
op_amp
op_complement
(paren
id|IOPTE_WAZ
)paren
suffix:semicolon
id|first
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
DECL|function|srmmu_uncache_iommu_page_table
r_void
id|srmmu_uncache_iommu_page_table
c_func
(paren
r_int
r_int
id|start
comma
r_int
id|size
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_int
r_int
id|end
op_assign
id|start
op_plus
id|size
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_and_assign
op_complement
id|SRMMU_CACHE
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
DECL|function|iommu_init
r_int
r_int
id|iommu_init
c_func
(paren
r_int
id|iommund
comma
r_int
r_int
id|memory_start
comma
r_int
r_int
id|memory_end
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_int
id|impl
comma
id|vers
comma
id|ptsize
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_struct
id|iommu_struct
op_star
id|iommu
suffix:semicolon
r_struct
id|linux_prom_registers
id|iommu_promregs
(braket
id|PROMREG_MAX
)braket
suffix:semicolon
id|memory_start
op_assign
id|LONG_ALIGN
c_func
(paren
id|memory_start
)paren
suffix:semicolon
id|iommu
op_assign
(paren
r_struct
id|iommu_struct
op_star
)paren
id|memory_start
suffix:semicolon
id|memory_start
op_add_assign
r_sizeof
(paren
r_struct
id|iommu_struct
)paren
suffix:semicolon
id|prom_getproperty
c_func
(paren
id|iommund
comma
l_string|&quot;reg&quot;
comma
(paren
r_void
op_star
)paren
id|iommu_promregs
comma
r_sizeof
(paren
id|iommu_promregs
)paren
)paren
suffix:semicolon
id|iommu-&gt;regs
op_assign
(paren
r_struct
id|iommu_regs
op_star
)paren
id|sparc_alloc_io
c_func
(paren
id|iommu_promregs
(braket
l_int|0
)braket
dot
id|phys_addr
comma
l_int|0
comma
(paren
id|PAGE_SIZE
op_star
l_int|3
)paren
comma
l_string|&quot;IOMMU registers&quot;
comma
id|iommu_promregs
(braket
l_int|0
)braket
dot
id|which_io
comma
l_int|0x0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iommu-&gt;regs
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Cannot map IOMMU registers.&quot;
)paren
suffix:semicolon
)brace
id|impl
op_assign
(paren
id|iommu-&gt;regs-&gt;control
op_amp
id|IOMMU_CTRL_IMPL
)paren
op_rshift
l_int|28
suffix:semicolon
id|vers
op_assign
(paren
id|iommu-&gt;regs-&gt;control
op_amp
id|IOMMU_CTRL_VERS
)paren
op_rshift
l_int|24
suffix:semicolon
id|tmp
op_assign
id|iommu-&gt;regs-&gt;control
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|IOMMU_CTRL_RNGE
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|IOMMU_RNGE_64MB
op_or
id|IOMMU_CTRL_ENAB
)paren
suffix:semicolon
id|iommu-&gt;regs-&gt;control
op_assign
id|tmp
suffix:semicolon
id|iommu_invalidate
c_func
(paren
id|iommu-&gt;regs
)paren
suffix:semicolon
id|iommu-&gt;start
op_assign
l_int|0xfc000000
suffix:semicolon
id|iommu-&gt;end
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Allocate IOMMU page table */
id|ptsize
op_assign
id|iommu-&gt;end
op_minus
id|iommu-&gt;start
op_plus
l_int|1
suffix:semicolon
id|ptsize
op_assign
(paren
id|ptsize
op_rshift
id|PAGE_SHIFT
)paren
op_star
r_sizeof
(paren
id|iopte_t
)paren
suffix:semicolon
multiline_comment|/* Stupid alignment constraints give me a headache. */
id|memory_start
op_assign
id|PAGE_ALIGN
c_func
(paren
id|memory_start
)paren
suffix:semicolon
id|memory_start
op_assign
(paren
(paren
(paren
id|memory_start
)paren
op_plus
(paren
id|ptsize
op_minus
l_int|1
)paren
)paren
op_amp
op_complement
(paren
id|ptsize
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|iommu-&gt;page_table
op_assign
(paren
id|iopte_t
op_star
)paren
id|memory_start
suffix:semicolon
id|memory_start
op_add_assign
id|ptsize
suffix:semicolon
multiline_comment|/* Initialize new table. */
id|memset
c_func
(paren
id|iommu-&gt;page_table
comma
l_int|0
comma
id|ptsize
)paren
suffix:semicolon
id|srmmu_map_dvma_pages_for_iommu
c_func
(paren
id|iommu
)paren
suffix:semicolon
id|iommu-&gt;regs-&gt;base
op_assign
(paren
(paren
(paren
r_int
r_int
)paren
id|iommu-&gt;page_table
)paren
op_minus
id|PAGE_OFFSET
)paren
op_rshift
l_int|4
suffix:semicolon
id|srmmu_uncache_iommu_page_table
c_func
(paren
(paren
r_int
r_int
)paren
id|iommu-&gt;page_table
comma
id|ptsize
)paren
suffix:semicolon
id|iommu_invalidate
c_func
(paren
id|iommu-&gt;regs
)paren
suffix:semicolon
id|invalidate_all
c_func
(paren
)paren
suffix:semicolon
id|sbus-&gt;iommu
op_assign
id|iommu
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IOMMU: impl %d vers %d page table at %p of size %d bytes&bslash;n&quot;
comma
id|impl
comma
id|vers
comma
id|iommu-&gt;page_table
comma
id|ptsize
)paren
suffix:semicolon
r_return
id|memory_start
suffix:semicolon
)brace
DECL|function|srmmu_get_scsi_buffer
r_static
r_char
op_star
id|srmmu_get_scsi_buffer
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_struct
id|iommu_struct
op_star
id|iommu
op_assign
id|sbus-&gt;iommu
suffix:semicolon
r_int
r_int
id|page
op_assign
(paren
r_int
r_int
)paren
id|vaddr
suffix:semicolon
r_int
r_int
id|start
comma
id|end
comma
id|offset
suffix:semicolon
id|iopte_t
op_star
id|iopte
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|PAGE_SIZE
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Can only handle page sized iommu mappings.&quot;
)paren
suffix:semicolon
)brace
id|offset
op_assign
id|page
op_amp
op_complement
id|PAGE_MASK
suffix:semicolon
id|page
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|start
op_assign
id|iommu-&gt;start
suffix:semicolon
id|end
op_assign
id|KADB_DEBUGGER_BEGVM
suffix:semicolon
multiline_comment|/* Don&squot;t step on kadb/prom. */
id|iopte
op_assign
id|iommu-&gt;page_table
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|iopte_val
c_func
(paren
op_star
id|iopte
)paren
op_amp
id|IOPTE_VALID
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|iopte
op_increment
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|start
op_eq
id|KADB_DEBUGGER_BEGVM
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Could not find free iommu entry in get_scsi_buffer.&quot;
)paren
suffix:semicolon
)brace
id|vaddr
op_assign
(paren
r_char
op_star
)paren
(paren
id|start
op_or
id|offset
)paren
suffix:semicolon
id|iopte_val
c_func
(paren
op_star
id|iopte
)paren
op_assign
(paren
(paren
(paren
(paren
id|page
op_minus
id|PAGE_OFFSET
)paren
op_rshift
l_int|4
)paren
op_amp
id|IOPTE_PAGE
)paren
op_or
(paren
id|IOPTE_WRITE
op_or
id|IOPTE_VALID
)paren
)paren
op_amp
op_complement
(paren
id|IOPTE_WAZ
)paren
suffix:semicolon
id|iommu_invalidate
c_func
(paren
id|iommu-&gt;regs
)paren
suffix:semicolon
id|invalidate_all
c_func
(paren
)paren
suffix:semicolon
r_return
id|vaddr
suffix:semicolon
)brace
DECL|function|srmmu_release_scsi_buffer
r_static
r_void
id|srmmu_release_scsi_buffer
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_struct
id|iommu_struct
op_star
id|iommu
op_assign
id|sbus-&gt;iommu
suffix:semicolon
r_int
r_int
id|page
op_assign
(paren
r_int
r_int
)paren
id|vaddr
suffix:semicolon
id|iopte_t
op_star
id|iopte
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|PAGE_SIZE
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Can only handle page sized IOMMU mappings.&quot;
)paren
suffix:semicolon
)brace
id|page
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|iopte
op_assign
id|iommu-&gt;page_table
op_plus
(paren
(paren
id|page
op_minus
id|iommu-&gt;start
)paren
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
id|iopte_val
c_func
(paren
op_star
id|iopte
)paren
op_assign
l_int|0
suffix:semicolon
id|iommu_invalidate
c_func
(paren
id|iommu-&gt;regs
)paren
suffix:semicolon
id|invalidate_all
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* On the SRMMU we do not have the problems with limited tlb entries&n; * for mapping kernel pages, so we just take things from the free page&n; * pool.  As a side effect we are putting a little too much pressure&n; * on the gfp() subsystem and we don&squot;t catch stack overflow like we&n; * did on the sun4c with virtual kstack mappings.  This setup also&n; * makes the logic of the iommu mapping code a lot easier as we can&n; * transparently handle mappings on the kernel stack without any&n; * special code as we did need on the sun4c.&n; */
DECL|function|srmmu_alloc_task_struct
r_struct
id|task_struct
op_star
id|srmmu_alloc_task_struct
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|page
suffix:semicolon
id|page
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
(brace
r_return
(paren
r_struct
id|task_struct
op_star
)paren
l_int|0
suffix:semicolon
)brace
r_return
(paren
r_struct
id|task_struct
op_star
)paren
id|page
suffix:semicolon
)brace
DECL|function|srmmu_alloc_kernel_stack
r_int
r_int
id|srmmu_alloc_kernel_stack
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
r_int
r_int
id|pages
suffix:semicolon
id|pages
op_assign
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pages
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|pages
comma
l_int|0
comma
(paren
id|PAGE_SIZE
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
r_return
id|pages
suffix:semicolon
)brace
DECL|function|srmmu_free_task_struct
r_static
r_void
id|srmmu_free_task_struct
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tsk
)paren
suffix:semicolon
)brace
DECL|function|srmmu_free_kernel_stack
r_static
r_void
id|srmmu_free_kernel_stack
c_func
(paren
r_int
r_int
id|stack
)paren
(brace
id|free_pages
c_func
(paren
id|stack
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|mempool
r_static
r_int
r_int
id|mempool
suffix:semicolon
multiline_comment|/* Allocate a block of RAM which is aligned to its size.&n; * This procedure can be used until the call to mem_init().&n; */
DECL|function|srmmu_init_alloc
r_static
r_void
op_star
id|srmmu_init_alloc
c_func
(paren
r_int
r_int
op_star
id|kbrk
comma
r_int
id|size
)paren
(brace
r_register
r_int
id|mask
op_assign
id|size
op_minus
l_int|1
suffix:semicolon
r_register
r_int
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
l_int|0
)paren
(brace
r_return
l_int|0x0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_amp
id|mask
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;panic: srmmu_init_alloc botch&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|ret
op_assign
(paren
op_star
id|kbrk
op_plus
id|mask
)paren
op_amp
op_complement
id|mask
suffix:semicolon
op_star
id|kbrk
op_assign
id|ret
op_plus
id|size
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|ret
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_return
(paren
r_void
op_star
)paren
id|ret
suffix:semicolon
)brace
DECL|function|srmmu_allocate_ptable_skeleton
r_static
r_inline
r_void
id|srmmu_allocate_ptable_skeleton
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgdp
)paren
)paren
(brace
id|pmdp
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|SRMMU_PMD_TABLE_SIZE
)paren
suffix:semicolon
id|srmmu_pgd_set
c_func
(paren
id|pgdp
comma
id|pmdp
)paren
suffix:semicolon
)brace
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmdp
)paren
)paren
(brace
id|ptep
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|SRMMU_PTE_TABLE_SIZE
)paren
suffix:semicolon
id|srmmu_pmd_set
c_func
(paren
id|pmdp
comma
id|ptep
)paren
suffix:semicolon
)brace
id|start
op_assign
(paren
id|start
op_plus
id|SRMMU_PMD_SIZE
)paren
op_amp
id|SRMMU_PMD_MASK
suffix:semicolon
)brace
)brace
multiline_comment|/* This is much cleaner than poking around physical address space&n; * looking at the prom&squot;s page table directly which is what most&n; * other OS&squot;s do.  Yuck... this is much better.&n; */
DECL|function|srmmu_inherit_prom_mappings
r_static
r_inline
r_void
id|srmmu_inherit_prom_mappings
c_func
(paren
r_void
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_int
r_int
id|start
comma
id|end
suffix:semicolon
r_int
r_int
id|prompte
suffix:semicolon
id|start
op_assign
id|KADB_DEBUGGER_BEGVM
suffix:semicolon
id|end
op_assign
id|LINUX_OPPROM_ENDVM
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
multiline_comment|/* Something going wrong here on some ss5&squot;s... */
id|prompte
op_assign
id|srmmu_hwprobe
c_func
(paren
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|prompte
op_amp
id|SRMMU_ET_MASK
)paren
op_eq
id|SRMMU_ET_PTE
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgdp
)paren
)paren
(brace
id|pmdp
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|SRMMU_PMD_TABLE_SIZE
)paren
suffix:semicolon
id|srmmu_pgd_set
c_func
(paren
id|pgdp
comma
id|pmdp
)paren
suffix:semicolon
)brace
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmdp
)paren
)paren
(brace
id|ptep
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|SRMMU_PTE_TABLE_SIZE
)paren
suffix:semicolon
id|srmmu_pmd_set
c_func
(paren
id|pmdp
comma
id|ptep
)paren
suffix:semicolon
)brace
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_assign
id|prompte
suffix:semicolon
)brace
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
DECL|function|srmmu_map_dvma_pages_for_cpu
r_static
r_inline
r_void
id|srmmu_map_dvma_pages_for_cpu
c_func
(paren
r_int
r_int
id|first
comma
r_int
r_int
id|last
)paren
(brace
r_int
r_int
id|start
suffix:semicolon
id|pgprot_t
id|dvma_prot
suffix:semicolon
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
id|start
op_assign
id|DVMA_VADDR
suffix:semicolon
id|dvma_prot
op_assign
id|__pgprot
c_func
(paren
id|SRMMU_ET_PTE
op_or
id|SRMMU_PRIV
)paren
suffix:semicolon
r_while
c_loop
(paren
id|first
op_le
id|last
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
multiline_comment|/* Map with cacheable bit clear. */
id|srmmu_set_entry
c_func
(paren
id|ptep
comma
id|pte_val
c_func
(paren
id|srmmu_mk_pte
c_func
(paren
id|first
comma
id|dvma_prot
)paren
)paren
)paren
suffix:semicolon
id|first
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
DECL|function|srmmu_map_kernel
r_static
r_void
id|srmmu_map_kernel
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
id|end
op_assign
(paren
id|PAGE_ALIGN
c_func
(paren
id|end
)paren
op_plus
id|PAGE_SIZE
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgdp
)paren
)paren
(brace
id|pmdp
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|SRMMU_PMD_TABLE_SIZE
)paren
suffix:semicolon
id|srmmu_pgd_set
c_func
(paren
id|pgdp
comma
id|pmdp
)paren
suffix:semicolon
)brace
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmdp
)paren
)paren
(brace
id|ptep
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|SRMMU_PTE_TABLE_SIZE
)paren
suffix:semicolon
id|srmmu_pmd_set
c_func
(paren
id|pmdp
comma
id|ptep
)paren
suffix:semicolon
)brace
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
op_star
id|ptep
op_assign
id|srmmu_mk_pte
c_func
(paren
id|start
comma
id|SRMMU_PAGE_KERNEL
)paren
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
multiline_comment|/* Paging initialization on the Sparc Reference MMU. */
r_extern
r_int
r_int
id|free_area_init
c_func
(paren
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
r_int
id|sparc_context_init
c_func
(paren
r_int
r_int
comma
r_int
)paren
suffix:semicolon
DECL|function|srmmu_paging_init
r_int
r_int
id|srmmu_paging_init
c_func
(paren
r_int
r_int
id|start_mem
comma
r_int
r_int
id|end_mem
)paren
(brace
r_int
id|i
comma
id|cpunode
suffix:semicolon
r_char
id|node_str
(braket
l_int|128
)braket
suffix:semicolon
multiline_comment|/* Find the number of contexts on the srmmu. */
id|cpunode
op_assign
id|prom_getchild
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
id|num_contexts
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cpunode
op_assign
id|prom_getsibling
c_func
(paren
id|cpunode
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|prom_getstring
c_func
(paren
id|cpunode
comma
l_string|&quot;device_type&quot;
comma
id|node_str
comma
r_sizeof
(paren
id|node_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|node_str
comma
l_string|&quot;cpu&quot;
)paren
)paren
(brace
id|num_contexts
op_assign
id|prom_getintdefault
c_func
(paren
id|cpunode
comma
l_string|&quot;mmu-nctx&quot;
comma
l_int|0x8
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|num_contexts
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Something wrong, cant find cpu node in paging_init.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|prom_printf
c_func
(paren
l_string|&quot;Number of MMU contexts %d&bslash;n&quot;
comma
id|num_contexts
)paren
suffix:semicolon
id|mempool
op_assign
id|start_mem
suffix:semicolon
id|memset
c_func
(paren
id|swapper_pg_dir
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|srmmu_map_kernel
c_func
(paren
id|KERNBASE
comma
id|end_mem
)paren
suffix:semicolon
id|srmmu_allocate_ptable_skeleton
c_func
(paren
id|IOBASE_VADDR
comma
id|IOBASE_END
)paren
suffix:semicolon
id|srmmu_allocate_ptable_skeleton
c_func
(paren
id|DVMA_VADDR
comma
id|DVMA_END
)paren
suffix:semicolon
id|mempool
op_assign
id|PAGE_ALIGN
c_func
(paren
id|mempool
)paren
suffix:semicolon
id|first_dvma_page
op_assign
id|mempool
suffix:semicolon
id|last_dvma_page
op_assign
(paren
id|mempool
op_plus
(paren
id|DVMA_LEN
)paren
op_minus
id|PAGE_SIZE
)paren
suffix:semicolon
id|mempool
op_assign
id|last_dvma_page
op_plus
id|PAGE_SIZE
suffix:semicolon
id|srmmu_map_dvma_pages_for_cpu
c_func
(paren
id|first_dvma_page
comma
id|last_dvma_page
)paren
suffix:semicolon
id|srmmu_inherit_prom_mappings
c_func
(paren
)paren
suffix:semicolon
id|srmmu_context_table
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|num_contexts
op_star
r_sizeof
(paren
id|ctxd_t
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_contexts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|srmmu_ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|i
)braket
comma
id|swapper_pg_dir
)paren
suffix:semicolon
)brace
id|prom_printf
c_func
(paren
l_string|&quot;Taking over MMU from PROM.&bslash;n&quot;
)paren
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_ctable_ptr
c_func
(paren
(paren
(paren
r_int
)paren
id|srmmu_context_table
)paren
op_minus
id|PAGE_OFFSET
)paren
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
id|start_mem
op_assign
id|PAGE_ALIGN
c_func
(paren
id|mempool
)paren
suffix:semicolon
id|start_mem
op_assign
id|sparc_context_init
c_func
(paren
id|start_mem
comma
id|num_contexts
)paren
suffix:semicolon
id|start_mem
op_assign
id|free_area_init
c_func
(paren
id|start_mem
comma
id|end_mem
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;survived...&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|PAGE_ALIGN
c_func
(paren
id|start_mem
)paren
suffix:semicolon
)brace
multiline_comment|/* Test the WP bit on the Sparc Reference MMU. */
DECL|function|srmmu_test_wp
r_void
id|srmmu_test_wp
c_func
(paren
r_void
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|wp_works_ok
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* We mapped page zero as a read-only page in paging_init()&n;&t; * So fire up the test, then invalidate the pgd for page zero.&n;&t; * It is no longer needed.&n;&t; */
multiline_comment|/* Let it rip... */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;st %%g0, [0x0]&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wp_works_ok
OL
l_int|0
)paren
id|wp_works_ok
op_assign
l_int|0
suffix:semicolon
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
l_int|0x0
)paren
suffix:semicolon
id|pgd_val
c_func
(paren
op_star
id|pgdp
)paren
op_assign
l_int|0x0
suffix:semicolon
)brace
DECL|function|srmmu_mmu_info
r_static
r_char
op_star
id|srmmu_mmu_info
c_func
(paren
r_void
)paren
(brace
r_return
l_string|&quot;&quot;
suffix:semicolon
)brace
DECL|function|srmmu_update_mmu_cache
r_static
r_void
id|srmmu_update_mmu_cache
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|address
comma
id|pte_t
id|pte
)paren
(brace
)brace
DECL|function|srmmu_exit_hook
r_static
r_void
id|srmmu_exit_hook
c_func
(paren
r_void
)paren
(brace
r_struct
id|ctx_list
op_star
id|ctx_old
suffix:semicolon
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|current-&gt;mm
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
id|srmmu_ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|mm-&gt;context
)braket
comma
id|swapper_pg_dir
)paren
suffix:semicolon
id|ctx_old
op_assign
id|ctx_list_pool
op_plus
id|mm-&gt;context
suffix:semicolon
id|remove_from_ctx_list
c_func
(paren
id|ctx_old
)paren
suffix:semicolon
id|add_to_free_ctxlist
c_func
(paren
id|ctx_old
)paren
suffix:semicolon
id|mm-&gt;context
op_assign
id|NO_CONTEXT
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|srmmu_flush_hook
id|srmmu_flush_hook
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;tss.flags
op_amp
id|SPARC_FLAG_KTHREAD
)paren
(brace
id|alloc_context
c_func
(paren
id|current-&gt;mm
)paren
suffix:semicolon
id|srmmu_ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|current-&gt;mm-&gt;context
)braket
comma
id|current-&gt;mm-&gt;pgd
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|current-&gt;mm-&gt;context
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Init various srmmu chip types. */
DECL|function|srmmu_is_bad
r_void
id|srmmu_is_bad
c_func
(paren
r_void
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Could not determine SRMMU chip type.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|init_hypersparc
r_void
id|init_hypersparc
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;HyperSparc MMU detected.&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mreg
op_amp
id|HYPERSPARC_CSIZE
)paren
(brace
id|hyper_cache_size
op_assign
(paren
l_int|256
op_star
l_int|1024
)paren
suffix:semicolon
)brace
r_else
id|hyper_cache_size
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
id|srmmu_modtype
op_assign
id|HyperSparc
suffix:semicolon
id|hwbug_bitmask
op_or_assign
id|HWBUG_VACFLUSH_BITROT
suffix:semicolon
id|hyper_flush_whole_icache
c_func
(paren
)paren
suffix:semicolon
id|hyper_flush_all_combined
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Keep things sane for now, cache in write-through mode. */
id|mreg
op_and_assign
op_complement
(paren
id|HYPERSPARC_CWENABLE
op_or
id|HYPERSPARC_CMODE
op_or
id|HYPERSPARC_WBENABLE
)paren
suffix:semicolon
id|mreg
op_or_assign
id|HYPERSPARC_CENABLE
suffix:semicolon
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
id|put_ross_icr
c_func
(paren
id|get_ross_icr
c_func
(paren
)paren
op_or
l_int|0x3
)paren
suffix:semicolon
id|invalidate_all
op_assign
id|hypersparc_invalidate_all
suffix:semicolon
id|invalidate_mm
op_assign
id|hypersparc_invalidate_mm
suffix:semicolon
id|invalidate_page
op_assign
id|hypersparc_invalidate_page
suffix:semicolon
id|invalidate_range
op_assign
id|hypersparc_invalidate_range
suffix:semicolon
)brace
DECL|function|init_cypress_common
r_void
id|init_cypress_common
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
id|mreg
op_and_assign
op_complement
id|CYPRESS_CMODE
suffix:semicolon
id|mreg
op_or_assign
id|CYPRESS_CENABLE
suffix:semicolon
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
id|invalidate_all
op_assign
id|cypress_invalidate_all
suffix:semicolon
id|invalidate_mm
op_assign
id|cypress_invalidate_mm
suffix:semicolon
id|invalidate_page
op_assign
id|cypress_invalidate_page
suffix:semicolon
id|invalidate_range
op_assign
id|cypress_invalidate_range
suffix:semicolon
)brace
DECL|function|init_cypress_604
r_void
id|init_cypress_604
c_func
(paren
r_void
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Cypress 604(UP) MMU detected.&bslash;n&quot;
)paren
suffix:semicolon
id|srmmu_modtype
op_assign
id|Cypress
suffix:semicolon
id|init_cypress_common
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|init_cypress_605
r_void
id|init_cypress_605
c_func
(paren
r_int
r_int
id|mrev
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Cypress 605(MP) MMU detected.&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mrev
op_eq
l_int|0xe
)paren
(brace
id|srmmu_modtype
op_assign
id|Cypress_vE
suffix:semicolon
id|hwbug_bitmask
op_or_assign
id|HWBUG_COPYBACK_BROKEN
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|mrev
op_eq
l_int|0xd
)paren
(brace
id|srmmu_modtype
op_assign
id|Cypress_vD
suffix:semicolon
id|hwbug_bitmask
op_or_assign
id|HWBUG_ASIFLUSH_BROKEN
suffix:semicolon
)brace
r_else
(brace
id|srmmu_modtype
op_assign
id|Cypress
suffix:semicolon
)brace
)brace
id|init_cypress_common
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|macro|SWIFT_REVISION_ADDR
mdefine_line|#define SWIFT_REVISION_ADDR  0x10003000
DECL|function|init_swift
r_void
id|init_swift
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|swift_rev
comma
id|addr
suffix:semicolon
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;Swift MMU detected.&bslash;n&quot;
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lda [%1] %2, %0&bslash;n&bslash;t&quot;
l_string|&quot;srl %0, 0x18, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|swift_rev
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|SWIFT_REVISION_ADDR
)paren
comma
l_string|&quot;i&quot;
(paren
l_int|0x20
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|swift_rev
)paren
(brace
r_case
l_int|0x11
suffix:colon
r_case
l_int|0x20
suffix:colon
r_case
l_int|0x23
suffix:colon
r_case
l_int|0x30
suffix:colon
id|srmmu_modtype
op_assign
id|Swift_lots_o_bugs
suffix:semicolon
id|hwbug_bitmask
op_or_assign
(paren
id|HWBUG_KERN_ACCBROKEN
op_or
id|HWBUG_KERN_CBITBROKEN
)paren
suffix:semicolon
multiline_comment|/* Gee george, I wonder why Sun is so hush hush about&n;&t;&t; * this hardware bug... really braindamage stuff going&n;&t;&t; * on here.  However I think we can find a way to avoid&n;&t;&t; * all of the workaround overhead under Linux.  Basically,&n;&t;&t; * any page fault can cause kernel pages to become user&n;&t;&t; * accessible (the mmu gets confused and clears some of&n;&t;&t; * the ACC bits in kernel ptes).  Aha, sounds pretty&n;&t;&t; * horrible eh?  But wait, after extensive testing it appears&n;&t;&t; * that if you use pgd_t level large kernel pte&squot;s (like the&n;&t;&t; * 4MB pages on the Pentium) the bug does not get tripped&n;&t;&t; * at all.  This avoids almost all of the major overhead.&n;&t;&t; * Welcome to a world where your vendor tells you to,&n;&t;&t; * &quot;apply this kernel patch&quot; instead of &quot;sorry for the&n;&t;&t; * broken hardware, send it back and we&squot;ll give you&n;&t;&t; * properly functioning parts&quot;&n;&t;&t; */
r_break
suffix:semicolon
r_case
l_int|0x25
suffix:colon
r_case
l_int|0x31
suffix:colon
id|srmmu_modtype
op_assign
id|Swift_bad_c
suffix:semicolon
id|hwbug_bitmask
op_or_assign
id|HWBUG_KERN_CBITBROKEN
suffix:semicolon
multiline_comment|/* You see Sun allude to this hardware bug but never&n;&t;&t; * admit things directly, they&squot;ll say things like,&n;&t;&t; * &quot;the Swift chip cache problems&quot; or similar.&n;&t;&t; */
r_break
suffix:semicolon
r_default
suffix:colon
id|srmmu_modtype
op_assign
id|Swift_ok
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Clear any crap from the cache or else... */
r_for
c_loop
(paren
id|addr
op_assign
l_int|0
suffix:semicolon
id|addr
OL
(paren
id|PAGE_SIZE
op_star
l_int|4
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|16
)paren
(brace
id|swift_inv_insn_tag
c_func
(paren
id|addr
)paren
suffix:semicolon
multiline_comment|/* whiz- */
id|swift_inv_data_tag
c_func
(paren
id|addr
)paren
suffix:semicolon
multiline_comment|/* bang */
)brace
id|mreg
op_or_assign
(paren
id|SWIFT_IE
op_or
id|SWIFT_DE
)paren
suffix:semicolon
multiline_comment|/* I &amp; D caches on */
multiline_comment|/* The Swift branch folding logic is completely broken.  At&n;&t; * trap time, if things are just right, if can mistakedly&n;&t; * thing that a trap is coming from kernel mode when in fact&n;&t; * it is coming from user mode (it misexecutes the branch in&n;&t; * the trap code).  So you see things like crashme completely&n;&t; * hosing your machine which is completely unacceptable.  Turn&n;&t; * this crap off... nice job Fujitsu.&n;&t; */
id|mreg
op_and_assign
op_complement
(paren
id|SWIFT_BF
)paren
suffix:semicolon
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
id|invalidate_all
op_assign
id|swift_invalidate_all
suffix:semicolon
id|invalidate_mm
op_assign
id|swift_invalidate_mm
suffix:semicolon
id|invalidate_page
op_assign
id|swift_invalidate_page
suffix:semicolon
id|invalidate_range
op_assign
id|swift_invalidate_range
suffix:semicolon
multiline_comment|/* Are you now convinced that the Swift is one of the&n;&t; * biggest VLSI abortions of all time?  Bravo Fujitsu!&n;&t; */
)brace
DECL|function|init_tsunami
r_void
id|init_tsunami
c_func
(paren
r_int
r_int
id|mreg
)paren
(brace
multiline_comment|/* Tsunami&squot;s pretty sane, Sun and TI actually got it&n;&t; * somewhat right this time.  Fujitsu should have&n;&t; * taken some lessons from them.&n;&t; */
id|prom_printf
c_func
(paren
l_string|&quot;Tsunami MMU detected.&bslash;n&quot;
)paren
suffix:semicolon
id|srmmu_modtype
op_assign
id|Tsunami
suffix:semicolon
id|tsunami_invalidate_icache
c_func
(paren
)paren
suffix:semicolon
id|tsunami_invalidate_dcache
c_func
(paren
)paren
suffix:semicolon
id|mreg
op_and_assign
op_complement
id|TSUNAMI_ITD
suffix:semicolon
id|mreg
op_or_assign
(paren
id|TSUNAMI_IENAB
op_or
id|TSUNAMI_DENAB
)paren
suffix:semicolon
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
id|invalidate_all
op_assign
id|tsunami_invalidate_all
suffix:semicolon
id|invalidate_mm
op_assign
id|tsunami_invalidate_mm
suffix:semicolon
id|invalidate_page
op_assign
id|tsunami_invalidate_page
suffix:semicolon
id|invalidate_range
op_assign
id|tsunami_invalidate_range
suffix:semicolon
)brace
DECL|function|init_viking
r_void
id|init_viking
c_func
(paren
r_int
r_int
id|psr_vers
comma
r_int
r_int
id|mod_rev
)paren
(brace
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Ahhh, the viking.  SRMMU VLSI abortion number two... */
id|prom_printf
c_func
(paren
l_string|&quot;Viking MMU detected.&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|psr_vers
op_logical_and
op_logical_neg
id|mod_rev
)paren
(brace
id|srmmu_modtype
op_assign
id|Viking_12
suffix:semicolon
id|hwbug_bitmask
op_or_assign
(paren
id|HWBUG_MODIFIED_BITROT
op_or
id|HWBUG_PC_BADFAULT_ADDR
)paren
suffix:semicolon
multiline_comment|/* On a fault, the chip gets entirely confused.  It will&n;&t;&t; * do one of two things.  Either it will set the modified&n;&t;&t; * bit for a read-only page (!!!) or it will improperly&n;&t;&t; * report a fault when a dcti/loadstore sequence is the&n;&t;&t; * last two instructions on a page.  Oh baby...&n;&t;&t; */
)brace
r_else
(brace
r_if
c_cond
(paren
id|psr_vers
)paren
(brace
id|srmmu_modtype
op_assign
id|Viking_2x
suffix:semicolon
id|hwbug_bitmask
op_or_assign
id|HWBUG_PC_BADFAULT_ADDR
suffix:semicolon
multiline_comment|/* see above */
)brace
r_else
(brace
r_if
c_cond
(paren
id|mod_rev
op_eq
l_int|1
)paren
(brace
id|srmmu_modtype
op_assign
id|Viking_30
suffix:semicolon
id|hwbug_bitmask
op_or_assign
id|HWBUG_PACINIT_BITROT
suffix:semicolon
multiline_comment|/* At boot time the physical cache&n;&t;&t;&t;&t; * has cherry bombs in it, so you&n;&t;&t;&t;&t; * have to scrape it by hand before&n;&t;&t;&t;&t; * enabling it.  Nice CAD tools guys.&n;&t;&t;&t;&t; */
)brace
r_else
(brace
r_if
c_cond
(paren
id|mod_rev
OL
l_int|8
)paren
(brace
id|srmmu_modtype
op_assign
id|Viking_35
suffix:semicolon
)brace
r_else
id|srmmu_modtype
op_assign
id|Viking_new
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* XXX Dave, play with the MXCC you pinhead XXX */
id|viking_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|viking_flush_dcache
c_func
(paren
)paren
suffix:semicolon
id|mreg
op_or_assign
(paren
id|VIKING_DCENABLE
op_or
id|VIKING_ICENABLE
op_or
id|VIKING_SBENABLE
op_or
id|VIKING_TCENABLE
op_or
id|VIKING_DPENABLE
)paren
suffix:semicolon
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
id|invalidate_all
op_assign
id|viking_invalidate_all
suffix:semicolon
id|invalidate_mm
op_assign
id|viking_invalidate_mm
suffix:semicolon
id|invalidate_page
op_assign
id|viking_invalidate_page
suffix:semicolon
id|invalidate_range
op_assign
id|viking_invalidate_range
suffix:semicolon
)brace
multiline_comment|/* Probe for the srmmu chip version. */
DECL|function|get_srmmu_type
r_static
r_void
id|get_srmmu_type
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mreg
comma
id|psr
suffix:semicolon
r_int
r_int
id|mod_typ
comma
id|mod_rev
comma
id|psr_typ
comma
id|psr_vers
suffix:semicolon
id|srmmu_modtype
op_assign
id|SRMMU_INVAL_MOD
suffix:semicolon
id|hwbug_bitmask
op_assign
l_int|0
suffix:semicolon
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
id|psr
op_assign
id|get_psr
c_func
(paren
)paren
suffix:semicolon
id|mod_typ
op_assign
(paren
id|mreg
op_amp
l_int|0xf0000000
)paren
op_rshift
l_int|28
suffix:semicolon
id|mod_rev
op_assign
(paren
id|mreg
op_amp
l_int|0x0f000000
)paren
op_rshift
l_int|24
suffix:semicolon
id|psr_typ
op_assign
(paren
id|psr
op_rshift
l_int|28
)paren
op_amp
l_int|0xf
suffix:semicolon
id|psr_vers
op_assign
(paren
id|psr
op_rshift
l_int|24
)paren
op_amp
l_int|0xf
suffix:semicolon
multiline_comment|/* First, check for HyperSparc or Cypress. */
r_if
c_cond
(paren
id|mod_typ
op_eq
l_int|1
)paren
(brace
r_switch
c_cond
(paren
id|mod_rev
)paren
(brace
r_case
l_int|7
suffix:colon
multiline_comment|/* UP or MP Hypersparc */
id|init_hypersparc
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* Uniprocessor Cypress */
id|init_cypress_604
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|13
suffix:colon
r_case
l_int|14
suffix:colon
r_case
l_int|15
suffix:colon
multiline_comment|/* MP Cypress mmu/cache-controller */
id|init_cypress_605
c_func
(paren
id|mod_rev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|srmmu_is_bad
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Next check for Fujitsu Swift. */
r_if
c_cond
(paren
id|psr_typ
op_eq
l_int|0
op_logical_and
id|psr_vers
op_eq
l_int|4
)paren
(brace
id|init_swift
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Now the Viking family of srmmu. */
r_if
c_cond
(paren
id|psr_typ
op_eq
l_int|4
op_logical_and
(paren
(paren
id|psr_vers
op_eq
l_int|0
)paren
op_logical_or
(paren
(paren
id|psr_vers
op_eq
l_int|1
)paren
op_logical_and
(paren
id|mod_typ
op_eq
l_int|0
)paren
op_logical_and
(paren
id|mod_rev
op_eq
l_int|0
)paren
)paren
)paren
)paren
(brace
id|init_viking
c_func
(paren
id|psr_vers
comma
id|mod_rev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Finally the Tsunami. */
r_if
c_cond
(paren
id|psr_typ
op_eq
l_int|4
op_logical_and
id|psr_vers
op_eq
l_int|1
op_logical_and
(paren
id|mod_typ
op_logical_or
id|mod_rev
)paren
)paren
(brace
id|init_tsunami
c_func
(paren
id|mreg
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Oh well */
id|srmmu_is_bad
c_func
(paren
)paren
suffix:semicolon
)brace
r_extern
r_int
r_int
id|spwin_mmu_patchme
comma
id|fwin_mmu_patchme
comma
id|tsetup_mmu_patchme
comma
id|rtrap_mmu_patchme
suffix:semicolon
r_extern
r_int
r_int
id|spwin_srmmu_stackchk
comma
id|srmmu_fwin_stackchk
comma
id|tsetup_srmmu_stackchk
comma
id|srmmu_rett_stackchk
suffix:semicolon
r_extern
r_int
r_int
id|srmmu_fault
suffix:semicolon
DECL|macro|PATCH_BRANCH
mdefine_line|#define PATCH_BRANCH(insn, dest) do { &bslash;&n;&t;&t;iaddr = &amp;(insn); &bslash;&n;&t;&t;daddr = &amp;(dest); &bslash;&n;&t;&t;*iaddr = SPARC_BRANCH((unsigned long) daddr, (unsigned long) iaddr); &bslash;&n;        } while(0);
DECL|function|patch_window_trap_handlers
r_static
r_void
id|patch_window_trap_handlers
c_func
(paren
r_void
)paren
(brace
r_int
r_int
op_star
id|iaddr
comma
op_star
id|daddr
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|spwin_mmu_patchme
comma
id|spwin_srmmu_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|fwin_mmu_patchme
comma
id|srmmu_fwin_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|tsetup_mmu_patchme
comma
id|tsetup_srmmu_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|rtrap_mmu_patchme
comma
id|srmmu_rett_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|sparc_ttable
(braket
id|SP_TRAP_TFLT
)braket
dot
id|inst_three
comma
id|srmmu_fault
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|sparc_ttable
(braket
id|SP_TRAP_DFLT
)braket
dot
id|inst_three
comma
id|srmmu_fault
)paren
suffix:semicolon
)brace
multiline_comment|/* Load up routines and constants for sun4m mmu */
DECL|function|ld_mmu_srmmu
r_void
id|ld_mmu_srmmu
c_func
(paren
r_void
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Loading srmmu MMU routines&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* First the constants */
id|pmd_shift
op_assign
id|SRMMU_PMD_SHIFT
suffix:semicolon
id|pmd_size
op_assign
id|SRMMU_PMD_SIZE
suffix:semicolon
id|pmd_mask
op_assign
id|SRMMU_PMD_MASK
suffix:semicolon
id|pgdir_shift
op_assign
id|SRMMU_PGDIR_SHIFT
suffix:semicolon
id|pgdir_size
op_assign
id|SRMMU_PGDIR_SIZE
suffix:semicolon
id|pgdir_mask
op_assign
id|SRMMU_PGDIR_MASK
suffix:semicolon
id|ptrs_per_pte
op_assign
id|SRMMU_PTRS_PER_PTE
suffix:semicolon
id|ptrs_per_pmd
op_assign
id|SRMMU_PTRS_PER_PMD
suffix:semicolon
id|ptrs_per_pgd
op_assign
id|SRMMU_PTRS_PER_PGD
suffix:semicolon
id|page_none
op_assign
id|SRMMU_PAGE_NONE
suffix:semicolon
id|page_shared
op_assign
id|SRMMU_PAGE_SHARED
suffix:semicolon
id|page_copy
op_assign
id|SRMMU_PAGE_COPY
suffix:semicolon
id|page_readonly
op_assign
id|SRMMU_PAGE_RDONLY
suffix:semicolon
id|page_kernel
op_assign
id|SRMMU_PAGE_KERNEL
suffix:semicolon
id|pg_iobits
op_assign
id|SRMMU_VALID
op_or
id|SRMMU_WRITE
op_or
id|SRMMU_REF
suffix:semicolon
multiline_comment|/* Functions */
id|set_pte
op_assign
id|srmmu_set_pte
suffix:semicolon
id|switch_to_context
op_assign
id|srmmu_switch_to_context
suffix:semicolon
id|pmd_align
op_assign
id|srmmu_pmd_align
suffix:semicolon
id|pgdir_align
op_assign
id|srmmu_pgdir_align
suffix:semicolon
id|vmalloc_start
op_assign
id|srmmu_vmalloc_start
suffix:semicolon
id|pte_page
op_assign
id|srmmu_pte_page
suffix:semicolon
id|pmd_page
op_assign
id|srmmu_pmd_page
suffix:semicolon
id|pgd_page
op_assign
id|srmmu_pgd_page
suffix:semicolon
id|sparc_update_rootmmu_dir
op_assign
id|srmmu_update_rootmmu_dir
suffix:semicolon
id|pte_none
op_assign
id|srmmu_pte_none
suffix:semicolon
id|pte_present
op_assign
id|srmmu_pte_present
suffix:semicolon
id|pte_inuse
op_assign
id|srmmu_pte_inuse
suffix:semicolon
id|pte_clear
op_assign
id|srmmu_pte_clear
suffix:semicolon
id|pte_reuse
op_assign
id|srmmu_pte_reuse
suffix:semicolon
id|pmd_none
op_assign
id|srmmu_pmd_none
suffix:semicolon
id|pmd_bad
op_assign
id|srmmu_pmd_bad
suffix:semicolon
id|pmd_present
op_assign
id|srmmu_pmd_present
suffix:semicolon
id|pmd_inuse
op_assign
id|srmmu_pmd_inuse
suffix:semicolon
id|pmd_clear
op_assign
id|srmmu_pmd_clear
suffix:semicolon
id|pmd_reuse
op_assign
id|srmmu_pmd_reuse
suffix:semicolon
id|pgd_none
op_assign
id|srmmu_pgd_none
suffix:semicolon
id|pgd_bad
op_assign
id|srmmu_pgd_bad
suffix:semicolon
id|pgd_present
op_assign
id|srmmu_pgd_present
suffix:semicolon
id|pgd_inuse
op_assign
id|srmmu_pgd_inuse
suffix:semicolon
id|pgd_clear
op_assign
id|srmmu_pgd_clear
suffix:semicolon
id|pgd_reuse
op_assign
id|srmmu_pgd_reuse
suffix:semicolon
id|mk_pte
op_assign
id|srmmu_mk_pte
suffix:semicolon
id|pgd_set
op_assign
id|srmmu_pgd_set
suffix:semicolon
id|mk_pte_io
op_assign
id|srmmu_mk_pte_io
suffix:semicolon
id|pte_modify
op_assign
id|srmmu_pte_modify
suffix:semicolon
id|pgd_offset
op_assign
id|srmmu_pgd_offset
suffix:semicolon
id|pmd_offset
op_assign
id|srmmu_pmd_offset
suffix:semicolon
id|pte_offset
op_assign
id|srmmu_pte_offset
suffix:semicolon
id|pte_free_kernel
op_assign
id|srmmu_pte_free_kernel
suffix:semicolon
id|pmd_free_kernel
op_assign
id|srmmu_pmd_free_kernel
suffix:semicolon
id|pte_alloc_kernel
op_assign
id|srmmu_pte_alloc_kernel
suffix:semicolon
id|pmd_alloc_kernel
op_assign
id|srmmu_pmd_alloc_kernel
suffix:semicolon
id|pte_free
op_assign
id|srmmu_pte_free
suffix:semicolon
id|pte_alloc
op_assign
id|srmmu_pte_alloc
suffix:semicolon
id|pmd_free
op_assign
id|srmmu_pmd_free
suffix:semicolon
id|pmd_alloc
op_assign
id|srmmu_pmd_alloc
suffix:semicolon
id|pgd_free
op_assign
id|srmmu_pgd_free
suffix:semicolon
id|pgd_alloc
op_assign
id|srmmu_pgd_alloc
suffix:semicolon
id|pte_write
op_assign
id|srmmu_pte_write
suffix:semicolon
id|pte_dirty
op_assign
id|srmmu_pte_dirty
suffix:semicolon
id|pte_young
op_assign
id|srmmu_pte_young
suffix:semicolon
id|pte_wrprotect
op_assign
id|srmmu_pte_wrprotect
suffix:semicolon
id|pte_mkclean
op_assign
id|srmmu_pte_mkclean
suffix:semicolon
id|pte_mkold
op_assign
id|srmmu_pte_mkold
suffix:semicolon
id|pte_mkwrite
op_assign
id|srmmu_pte_mkwrite
suffix:semicolon
id|pte_mkdirty
op_assign
id|srmmu_pte_mkdirty
suffix:semicolon
id|pte_mkyoung
op_assign
id|srmmu_pte_mkyoung
suffix:semicolon
id|update_mmu_cache
op_assign
id|srmmu_update_mmu_cache
suffix:semicolon
id|mmu_exit_hook
op_assign
id|srmmu_exit_hook
suffix:semicolon
id|mmu_flush_hook
op_assign
id|srmmu_flush_hook
suffix:semicolon
id|mmu_lockarea
op_assign
id|srmmu_lockarea
suffix:semicolon
id|mmu_unlockarea
op_assign
id|srmmu_unlockarea
suffix:semicolon
id|mmu_get_scsi_buffer
op_assign
id|srmmu_get_scsi_buffer
suffix:semicolon
id|mmu_release_scsi_buffer
op_assign
id|srmmu_release_scsi_buffer
suffix:semicolon
id|mmu_info
op_assign
id|srmmu_mmu_info
suffix:semicolon
multiline_comment|/* Task struct and kernel stack allocating/freeing. */
id|alloc_kernel_stack
op_assign
id|srmmu_alloc_kernel_stack
suffix:semicolon
id|alloc_task_struct
op_assign
id|srmmu_alloc_task_struct
suffix:semicolon
id|free_kernel_stack
op_assign
id|srmmu_free_kernel_stack
suffix:semicolon
id|free_task_struct
op_assign
id|srmmu_free_task_struct
suffix:semicolon
id|quick_kernel_fault
op_assign
id|srmmu_quick_kernel_fault
suffix:semicolon
id|get_srmmu_type
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|srmmu_get_mmureg
c_func
(paren
)paren
op_amp
l_int|0x800
)paren
)paren
(brace
id|srmmu_read_physical
op_assign
id|msparc_read_physical
suffix:semicolon
id|srmmu_write_physical
op_assign
id|msparc_write_physical
suffix:semicolon
)brace
r_else
(brace
id|srmmu_read_physical
op_assign
id|gensrmmu_read_physical
suffix:semicolon
id|srmmu_write_physical
op_assign
id|gensrmmu_write_physical
suffix:semicolon
)brace
id|patch_window_trap_handlers
c_func
(paren
)paren
suffix:semicolon
)brace
eof
