multiline_comment|/* $Id: srmmu.c,v 1.59 1996/04/21 10:32:21 davem Exp $&n; * srmmu.c:  SRMMU specific routines for memory management.&n; *&n; * Copyright (C) 1995 David S. Miller  (davem@caip.rutgers.edu)&n; * Copyright (C) 1995 Peter A. Zaitcev (zaitcev@ithil.mcst.ru)&n; * Copyright (C) 1996 Eddie C. Dost    (ecd@pool.informatik.rwth-aachen.de)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/kdebug.h&gt;
macro_line|#include &lt;asm/vaddrs.h&gt;
macro_line|#include &lt;asm/traps.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/mbus.h&gt;
macro_line|#include &lt;asm/cache.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/iommu.h&gt;
macro_line|#include &lt;asm/asi.h&gt;
macro_line|#include &lt;asm/msi.h&gt;
multiline_comment|/* Now the cpu specific definitions. */
macro_line|#include &lt;asm/viking.h&gt;
macro_line|#include &lt;asm/mxcc.h&gt;
macro_line|#include &lt;asm/ross.h&gt;
macro_line|#include &lt;asm/tsunami.h&gt;
macro_line|#include &lt;asm/swift.h&gt;
DECL|variable|srmmu_modtype
r_enum
id|mbus_module
id|srmmu_modtype
suffix:semicolon
DECL|variable|hwbug_bitmask
r_int
r_int
id|hwbug_bitmask
suffix:semicolon
DECL|variable|hyper_cache_size
r_int
id|hyper_cache_size
suffix:semicolon
DECL|variable|hyper_line_size
r_int
id|hyper_line_size
suffix:semicolon
macro_line|#ifdef __SMP__
r_extern
r_void
id|smp_capture
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|smp_release
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#else
DECL|macro|smp_capture
mdefine_line|#define smp_capture()
DECL|macro|smp_release
mdefine_line|#define smp_release()
macro_line|#endif /* !(__SMP__) */
DECL|variable|ctxd_set
r_static
r_void
(paren
op_star
id|ctxd_set
)paren
(paren
id|ctxd_t
op_star
id|ctxp
comma
id|pgd_t
op_star
id|pgdp
)paren
suffix:semicolon
DECL|variable|pmd_set
r_static
r_void
(paren
op_star
id|pmd_set
)paren
(paren
id|pmd_t
op_star
id|pmdp
comma
id|pte_t
op_star
id|ptep
)paren
suffix:semicolon
DECL|variable|flush_page_for_dma
r_static
r_void
(paren
op_star
id|flush_page_for_dma
)paren
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
DECL|variable|flush_cache_page_to_uncache
r_static
r_void
(paren
op_star
id|flush_cache_page_to_uncache
)paren
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
DECL|variable|flush_tlb_page_for_cbit
r_static
r_void
(paren
op_star
id|flush_tlb_page_for_cbit
)paren
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
macro_line|#ifdef __SMP__
DECL|variable|local_flush_page_for_dma
r_static
r_void
(paren
op_star
id|local_flush_page_for_dma
)paren
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
DECL|variable|local_flush_cache_page_to_uncache
r_static
r_void
(paren
op_star
id|local_flush_cache_page_to_uncache
)paren
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
DECL|variable|local_flush_tlb_page_for_cbit
r_static
r_void
(paren
op_star
id|local_flush_tlb_page_for_cbit
)paren
(paren
r_int
r_int
id|page
)paren
suffix:semicolon
macro_line|#endif
DECL|struct|srmmu_stats
r_static
r_struct
id|srmmu_stats
(brace
DECL|member|invall
r_int
id|invall
suffix:semicolon
DECL|member|invpg
r_int
id|invpg
suffix:semicolon
DECL|member|invrnge
r_int
id|invrnge
suffix:semicolon
DECL|member|invmm
r_int
id|invmm
suffix:semicolon
DECL|variable|module_stats
)brace
id|module_stats
suffix:semicolon
DECL|variable|srmmu_name
r_static
r_char
op_star
id|srmmu_name
suffix:semicolon
DECL|variable|srmmu_ctx_table_phys
id|ctxd_t
op_star
id|srmmu_ctx_table_phys
suffix:semicolon
DECL|variable|srmmu_context_table
id|ctxd_t
op_star
id|srmmu_context_table
suffix:semicolon
DECL|struct|srmmu_trans
r_static
r_struct
id|srmmu_trans
(brace
DECL|member|vbase
r_int
r_int
id|vbase
suffix:semicolon
DECL|member|pbase
r_int
r_int
id|pbase
suffix:semicolon
DECL|member|size
r_int
id|size
suffix:semicolon
DECL|variable|srmmu_map
)brace
id|srmmu_map
(braket
id|SPARC_PHYS_BANKS
)braket
suffix:semicolon
DECL|variable|can_cache_ptables
r_static
r_int
id|can_cache_ptables
op_assign
l_int|0
suffix:semicolon
DECL|variable|viking_mxcc_present
r_static
r_int
id|viking_mxcc_present
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Physical memory can be _very_ non-contiguous on the sun4m, especially&n; * the SS10/20 class machines and with the latest openprom revisions.&n; * So we have to crunch the free page pool.&n; */
DECL|function|srmmu_v2p
r_static
r_inline
r_int
r_int
id|srmmu_v2p
c_func
(paren
r_int
r_int
id|vaddr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|srmmu_map
(braket
id|i
)braket
dot
id|size
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|srmmu_map
(braket
id|i
)braket
dot
id|vbase
op_le
id|vaddr
op_logical_and
(paren
id|srmmu_map
(braket
id|i
)braket
dot
id|vbase
op_plus
id|srmmu_map
(braket
id|i
)braket
dot
id|size
OG
id|vaddr
)paren
)paren
(brace
r_return
(paren
id|vaddr
op_minus
id|srmmu_map
(braket
id|i
)braket
dot
id|vbase
)paren
op_plus
id|srmmu_map
(braket
id|i
)braket
dot
id|pbase
suffix:semicolon
)brace
)brace
r_return
l_int|0xffffffffUL
suffix:semicolon
)brace
DECL|function|srmmu_p2v
r_static
r_inline
r_int
r_int
id|srmmu_p2v
c_func
(paren
r_int
r_int
id|paddr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|srmmu_map
(braket
id|i
)braket
dot
id|size
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|srmmu_map
(braket
id|i
)braket
dot
id|pbase
op_le
id|paddr
op_logical_and
(paren
id|srmmu_map
(braket
id|i
)braket
dot
id|pbase
op_plus
id|srmmu_map
(braket
id|i
)braket
dot
id|size
OG
id|paddr
)paren
)paren
(brace
r_return
(paren
id|paddr
op_minus
id|srmmu_map
(braket
id|i
)braket
dot
id|pbase
)paren
op_plus
id|srmmu_map
(braket
id|i
)braket
dot
id|vbase
suffix:semicolon
)brace
)brace
r_return
l_int|0xffffffffUL
suffix:semicolon
)brace
multiline_comment|/* In general all page table modifications should use the V8 atomic&n; * swap instruction.  This insures the mmu and the cpu are in sync&n; * with respect to ref/mod bits in the page tables.&n; */
DECL|function|srmmu_swap
r_static
r_inline
r_int
r_int
id|srmmu_swap
c_func
(paren
r_int
r_int
op_star
id|addr
comma
r_int
r_int
id|value
)paren
(brace
macro_line|#if CONFIG_AP1000
multiline_comment|/* the AP1000 has its memory on bus 8, not 0 like suns do */
r_if
c_cond
(paren
op_logical_neg
(paren
id|value
op_amp
l_int|0xf0000000
)paren
)paren
id|value
op_or_assign
l_int|0x80000000
suffix:semicolon
r_if
c_cond
(paren
id|value
op_eq
l_int|0x80000000
)paren
id|value
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;swap [%2], %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|value
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|value
)paren
comma
l_string|&quot;r&quot;
(paren
id|addr
)paren
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/* Functions really use this, not srmmu_swap directly. */
DECL|macro|srmmu_set_entry
mdefine_line|#define srmmu_set_entry(ptr, newentry) &bslash;&n;        srmmu_swap((unsigned long *) (ptr), (newentry))
multiline_comment|/* The very generic SRMMU page table operations. */
DECL|function|srmmu_pmd_align
r_static
r_int
r_int
id|srmmu_pmd_align
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|SRMMU_PMD_ALIGN
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgdir_align
r_static
r_int
r_int
id|srmmu_pgdir_align
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|SRMMU_PGDIR_ALIGN
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|srmmu_vmalloc_start
r_static
r_int
r_int
id|srmmu_vmalloc_start
c_func
(paren
r_void
)paren
(brace
r_return
id|SRMMU_VMALLOC_START
suffix:semicolon
)brace
DECL|function|srmmu_pgd_page
r_static
r_int
r_int
id|srmmu_pgd_page
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
id|srmmu_p2v
c_func
(paren
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|SRMMU_PTD_PMASK
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_page
r_static
r_int
r_int
id|srmmu_pmd_page
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
id|srmmu_p2v
c_func
(paren
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|SRMMU_PTD_PMASK
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_page
r_static
r_int
r_int
id|srmmu_pte_page
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|srmmu_p2v
c_func
(paren
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|SRMMU_PTE_PMASK
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_none
r_static
r_int
id|srmmu_pte_none
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
op_logical_neg
id|pte_val
c_func
(paren
id|pte
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_present
r_static
r_int
id|srmmu_pte_present
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
(paren
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_eq
id|SRMMU_ET_PTE
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_clear
r_static
r_void
id|srmmu_pte_clear
c_func
(paren
id|pte_t
op_star
id|ptep
)paren
(brace
id|set_pte
c_func
(paren
id|ptep
comma
id|__pte
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_none
r_static
r_int
id|srmmu_pmd_none
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
op_logical_neg
id|pmd_val
c_func
(paren
id|pmd
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_bad
r_static
r_int
id|srmmu_pmd_bad
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_ne
id|SRMMU_ET_PTD
suffix:semicolon
)brace
DECL|function|srmmu_pmd_present
r_static
r_int
id|srmmu_pmd_present
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_eq
id|SRMMU_ET_PTD
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_clear
r_static
r_void
id|srmmu_pmd_clear
c_func
(paren
id|pmd_t
op_star
id|pmdp
)paren
(brace
id|set_pte
c_func
(paren
(paren
id|pte_t
op_star
)paren
id|pmdp
comma
id|__pte
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgd_none
r_static
r_int
id|srmmu_pgd_none
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
op_logical_neg
id|pgd_val
c_func
(paren
id|pgd
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgd_bad
r_static
r_int
id|srmmu_pgd_bad
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_ne
id|SRMMU_ET_PTD
suffix:semicolon
)brace
DECL|function|srmmu_pgd_present
r_static
r_int
id|srmmu_pgd_present
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
(paren
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_eq
id|SRMMU_ET_PTD
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgd_clear
r_static
r_void
id|srmmu_pgd_clear
c_func
(paren
id|pgd_t
op_star
id|pgdp
)paren
(brace
id|set_pte
c_func
(paren
(paren
id|pte_t
op_star
)paren
id|pgdp
comma
id|__pte
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_write
r_static
r_int
id|srmmu_pte_write
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|SRMMU_WRITE
suffix:semicolon
)brace
DECL|function|srmmu_pte_dirty
r_static
r_int
id|srmmu_pte_dirty
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|SRMMU_DIRTY
suffix:semicolon
)brace
DECL|function|srmmu_pte_young
r_static
r_int
id|srmmu_pte_young
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|SRMMU_REF
suffix:semicolon
)brace
DECL|function|srmmu_pte_wrprotect
r_static
id|pte_t
id|srmmu_pte_wrprotect
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_and_assign
op_complement
id|SRMMU_WRITE
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_pte_mkclean
r_static
id|pte_t
id|srmmu_pte_mkclean
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_and_assign
op_complement
id|SRMMU_DIRTY
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_pte_mkold
r_static
id|pte_t
id|srmmu_pte_mkold
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_and_assign
op_complement
id|SRMMU_REF
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_pte_mkwrite
r_static
id|pte_t
id|srmmu_pte_mkwrite
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_or_assign
id|SRMMU_WRITE
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_pte_mkdirty
r_static
id|pte_t
id|srmmu_pte_mkdirty
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_or_assign
id|SRMMU_DIRTY
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_pte_mkyoung
r_static
id|pte_t
id|srmmu_pte_mkyoung
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_or_assign
id|SRMMU_REF
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
multiline_comment|/*&n; * Conversion functions: convert a page and protection to a page entry,&n; * and a page entry and page directory to the page they refer to.&n; */
DECL|function|srmmu_mk_pte
r_static
id|pte_t
id|srmmu_mk_pte
c_func
(paren
r_int
r_int
id|page
comma
id|pgprot_t
id|pgprot
)paren
(brace
id|pte_t
id|pte
suffix:semicolon
id|pte_val
c_func
(paren
id|pte
)paren
op_assign
(paren
(paren
id|srmmu_v2p
c_func
(paren
id|page
)paren
)paren
op_rshift
l_int|4
)paren
op_or
id|pgprot_val
c_func
(paren
id|pgprot
)paren
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_mk_pte_io
r_static
id|pte_t
id|srmmu_mk_pte_io
c_func
(paren
r_int
r_int
id|page
comma
id|pgprot_t
id|pgprot
comma
r_int
id|space
)paren
(brace
id|pte_t
id|pte
suffix:semicolon
id|pte_val
c_func
(paren
id|pte
)paren
op_assign
(paren
(paren
id|page
)paren
op_rshift
l_int|4
)paren
op_or
(paren
id|space
op_lshift
l_int|28
)paren
op_or
id|pgprot_val
c_func
(paren
id|pgprot
)paren
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|srmmu_ctxd_set
r_static
r_void
id|srmmu_ctxd_set
c_func
(paren
id|ctxd_t
op_star
id|ctxp
comma
id|pgd_t
op_star
id|pgdp
)paren
(brace
id|srmmu_set_entry
c_func
(paren
id|ctxp
comma
(paren
id|SRMMU_ET_PTD
op_or
(paren
id|srmmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|pgdp
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgd_set
r_static
r_void
id|srmmu_pgd_set
c_func
(paren
id|pgd_t
op_star
id|pgdp
comma
id|pmd_t
op_star
id|pmdp
)paren
(brace
id|srmmu_set_entry
c_func
(paren
id|pgdp
comma
(paren
id|SRMMU_ET_PTD
op_or
(paren
id|srmmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|pmdp
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_set
r_static
r_void
id|srmmu_pmd_set
c_func
(paren
id|pmd_t
op_star
id|pmdp
comma
id|pte_t
op_star
id|ptep
)paren
(brace
id|srmmu_set_entry
c_func
(paren
id|pmdp
comma
(paren
id|SRMMU_ET_PTD
op_or
(paren
id|srmmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|ptep
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_modify
r_static
id|pte_t
id|srmmu_pte_modify
c_func
(paren
id|pte_t
id|pte
comma
id|pgprot_t
id|newprot
)paren
(brace
id|pte_val
c_func
(paren
id|pte
)paren
op_assign
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
op_complement
l_int|0xff
)paren
op_or
id|pgprot_val
c_func
(paren
id|newprot
)paren
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
multiline_comment|/* to find an entry in a top-level page table... */
DECL|function|srmmu_pgd_offset
r_static
id|pgd_t
op_star
id|srmmu_pgd_offset
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|address
)paren
(brace
r_return
id|mm-&gt;pgd
op_plus
(paren
(paren
id|address
op_rshift
id|SRMMU_PGDIR_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PGD
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Find an entry in the second-level page table.. */
DECL|function|srmmu_pmd_offset
r_static
id|pmd_t
op_star
id|srmmu_pmd_offset
c_func
(paren
id|pgd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pmd_t
op_star
)paren
id|srmmu_pgd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|SRMMU_PMD_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Find an entry in the third-level page table.. */
DECL|function|srmmu_pte_offset
r_static
id|pte_t
op_star
id|srmmu_pte_offset
c_func
(paren
id|pmd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pte_t
op_star
)paren
id|srmmu_pmd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* This must update the context table entry for this process. */
DECL|function|srmmu_update_rootmmu_dir
r_static
r_void
id|srmmu_update_rootmmu_dir
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
id|pgd_t
op_star
id|pgdp
)paren
(brace
r_if
c_cond
(paren
id|tsk-&gt;mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
id|ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|tsk-&gt;mm-&gt;context
)braket
comma
id|pgdp
)paren
suffix:semicolon
)brace
)brace
DECL|function|srmmu_uncache_page
r_static
r_inline
r_void
id|srmmu_uncache_page
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|pgd_t
op_star
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|addr
)paren
suffix:semicolon
id|pmd_t
op_star
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|addr
)paren
suffix:semicolon
id|pte_t
op_star
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|addr
)paren
suffix:semicolon
id|flush_cache_page_to_uncache
c_func
(paren
id|addr
)paren
suffix:semicolon
id|set_pte
c_func
(paren
id|ptep
comma
id|__pte
c_func
(paren
(paren
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_amp
op_complement
id|SRMMU_CACHE
)paren
)paren
)paren
suffix:semicolon
id|flush_tlb_page_for_cbit
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|srmmu_recache_page
r_static
r_inline
r_void
id|srmmu_recache_page
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|pgd_t
op_star
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|addr
)paren
suffix:semicolon
id|pmd_t
op_star
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|addr
)paren
suffix:semicolon
id|pte_t
op_star
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|addr
)paren
suffix:semicolon
id|set_pte
c_func
(paren
id|ptep
comma
id|__pte
c_func
(paren
(paren
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_or
id|SRMMU_CACHE
)paren
)paren
)paren
suffix:semicolon
id|flush_tlb_page_for_cbit
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|srmmu_getpage
r_static
r_inline
r_int
r_int
id|srmmu_getpage
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|page
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|can_cache_ptables
)paren
r_return
id|page
suffix:semicolon
r_if
c_cond
(paren
id|page
)paren
(brace
id|srmmu_uncache_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_return
id|page
suffix:semicolon
)brace
DECL|function|srmmu_putpage
r_static
r_inline
r_void
id|srmmu_putpage
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|can_cache_ptables
)paren
id|srmmu_recache_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|free_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
multiline_comment|/* The easy versions. */
DECL|macro|NEW_PGD
mdefine_line|#define NEW_PGD() (pgd_t *) srmmu_getpage()
DECL|macro|NEW_PMD
mdefine_line|#define NEW_PMD() (pmd_t *) srmmu_getpage()
DECL|macro|NEW_PTE
mdefine_line|#define NEW_PTE() (pte_t *) srmmu_getpage()
DECL|macro|FREE_PGD
mdefine_line|#define FREE_PGD(chunk) srmmu_putpage((unsigned long)(chunk))
DECL|macro|FREE_PMD
mdefine_line|#define FREE_PMD(chunk) srmmu_putpage((unsigned long)(chunk))
DECL|macro|FREE_PTE
mdefine_line|#define FREE_PTE(chunk) srmmu_putpage((unsigned long)(chunk))
multiline_comment|/*&n; * Allocate and free page tables. The xxx_kernel() versions are&n; * used to allocate a kernel page table - this turns on ASN bits&n; * if any, and marks the page tables reserved.&n; */
DECL|function|srmmu_pte_free_kernel
r_static
r_void
id|srmmu_pte_free_kernel
c_func
(paren
id|pte_t
op_star
id|pte
)paren
(brace
id|FREE_PTE
c_func
(paren
id|pte
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_alloc_kernel
r_static
id|pte_t
op_star
id|srmmu_pte_alloc_kernel
c_func
(paren
id|pmd_t
op_star
id|pmd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|pte_t
op_star
id|page
op_assign
id|NEW_PTE
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|pmd_set
c_func
(paren
id|pmd
comma
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|pmd_set
c_func
(paren
id|pmd
comma
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|FREE_PTE
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srmmu_pmd_bad
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pmd in pte_alloc: %08lx&bslash;n&quot;
comma
id|pmd_val
c_func
(paren
op_star
id|pmd
)paren
)paren
suffix:semicolon
id|pmd_set
c_func
(paren
id|pmd
comma
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pte_t
op_star
)paren
id|srmmu_pmd_page
c_func
(paren
op_star
id|pmd
)paren
op_plus
id|address
suffix:semicolon
)brace
DECL|function|srmmu_pmd_free_kernel
r_static
r_void
id|srmmu_pmd_free_kernel
c_func
(paren
id|pmd_t
op_star
id|pmd
)paren
(brace
id|FREE_PMD
c_func
(paren
id|pmd
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_alloc_kernel
r_static
id|pmd_t
op_star
id|srmmu_pmd_alloc_kernel
c_func
(paren
id|pgd_t
op_star
id|pgd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|SRMMU_PMD_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|pmd_t
op_star
id|page
op_assign
id|NEW_PMD
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|pgd_set
c_func
(paren
id|pgd
comma
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|FREE_PMD
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srmmu_pgd_bad
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pgd in pmd_alloc: %08lx&bslash;n&quot;
comma
id|pgd_val
c_func
(paren
op_star
id|pgd
)paren
)paren
suffix:semicolon
id|pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pmd_t
op_star
)paren
id|pgd_page
c_func
(paren
op_star
id|pgd
)paren
op_plus
id|address
suffix:semicolon
)brace
DECL|function|srmmu_pte_free
r_static
r_void
id|srmmu_pte_free
c_func
(paren
id|pte_t
op_star
id|pte
)paren
(brace
id|FREE_PTE
c_func
(paren
id|pte
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pte_alloc
r_static
id|pte_t
op_star
id|srmmu_pte_alloc
c_func
(paren
id|pmd_t
op_star
id|pmd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|pte_t
op_star
id|page
op_assign
id|NEW_PTE
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|pmd_set
c_func
(paren
id|pmd
comma
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|pmd_set
c_func
(paren
id|pmd
comma
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|FREE_PTE
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srmmu_pmd_bad
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pmd in pte_alloc: %08lx&bslash;n&quot;
comma
id|pmd_val
c_func
(paren
op_star
id|pmd
)paren
)paren
suffix:semicolon
id|pmd_set
c_func
(paren
id|pmd
comma
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
(paren
id|pte_t
op_star
)paren
id|srmmu_pmd_page
c_func
(paren
op_star
id|pmd
)paren
)paren
op_plus
id|address
suffix:semicolon
)brace
multiline_comment|/* Real three-level page tables on SRMMU. */
DECL|function|srmmu_pmd_free
r_static
r_void
id|srmmu_pmd_free
c_func
(paren
id|pmd_t
op_star
id|pmd
)paren
(brace
id|FREE_PMD
c_func
(paren
id|pmd
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pmd_alloc
r_static
id|pmd_t
op_star
id|srmmu_pmd_alloc
c_func
(paren
id|pgd_t
op_star
id|pgd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|SRMMU_PMD_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|pmd_t
op_star
id|page
op_assign
id|NEW_PMD
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
id|pgd_set
c_func
(paren
id|pgd
comma
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
id|pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|FREE_PMD
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srmmu_pgd_bad
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pgd in pmd_alloc: %08lx&bslash;n&quot;
comma
id|pgd_val
c_func
(paren
op_star
id|pgd
)paren
)paren
suffix:semicolon
id|pgd_set
c_func
(paren
id|pgd
comma
(paren
id|pmd_t
op_star
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pmd_t
op_star
)paren
id|srmmu_pgd_page
c_func
(paren
op_star
id|pgd
)paren
op_plus
id|address
suffix:semicolon
)brace
DECL|function|srmmu_pgd_free
r_static
r_void
id|srmmu_pgd_free
c_func
(paren
id|pgd_t
op_star
id|pgd
)paren
(brace
id|FREE_PGD
c_func
(paren
id|pgd
)paren
suffix:semicolon
)brace
DECL|function|srmmu_pgd_alloc
r_static
id|pgd_t
op_star
id|srmmu_pgd_alloc
c_func
(paren
r_void
)paren
(brace
r_return
id|NEW_PGD
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_set_pte
r_static
r_void
id|srmmu_set_pte
c_func
(paren
id|pte_t
op_star
id|ptep
comma
id|pte_t
id|pteval
)paren
(brace
id|srmmu_set_entry
c_func
(paren
id|ptep
comma
id|pte_val
c_func
(paren
id|pteval
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_quick_kernel_fault
r_static
r_void
id|srmmu_quick_kernel_fault
c_func
(paren
r_int
r_int
id|address
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Penguin faults at address %08lx&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Srmmu bolixed...&quot;
)paren
suffix:semicolon
)brace
DECL|function|alloc_context
r_static
r_inline
r_void
id|alloc_context
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_struct
id|ctx_list
op_star
id|ctxp
suffix:semicolon
id|ctxp
op_assign
id|ctx_free.next
suffix:semicolon
r_if
c_cond
(paren
id|ctxp
op_ne
op_amp
id|ctx_free
)paren
(brace
id|remove_from_ctx_list
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|add_to_used_ctxlist
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|mm-&gt;context
op_assign
id|ctxp-&gt;ctx_number
suffix:semicolon
id|ctxp-&gt;ctx_mm
op_assign
id|mm
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ctxp
op_assign
id|ctx_used.next
suffix:semicolon
r_if
c_cond
(paren
id|ctxp-&gt;ctx_mm
op_eq
id|current-&gt;mm
)paren
(brace
id|ctxp
op_assign
id|ctxp-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctxp
op_eq
op_amp
id|ctx_used
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;out of mmu contexts&quot;
)paren
suffix:semicolon
)brace
id|flush_cache_mm
c_func
(paren
id|ctxp-&gt;ctx_mm
)paren
suffix:semicolon
id|flush_tlb_mm
c_func
(paren
id|ctxp-&gt;ctx_mm
)paren
suffix:semicolon
id|remove_from_ctx_list
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|add_to_used_ctxlist
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|ctxp-&gt;ctx_mm-&gt;context
op_assign
id|NO_CONTEXT
suffix:semicolon
id|ctxp-&gt;ctx_mm
op_assign
id|mm
suffix:semicolon
id|mm-&gt;context
op_assign
id|ctxp-&gt;ctx_number
suffix:semicolon
)brace
DECL|function|srmmu_switch_to_context
r_static
r_void
id|srmmu_switch_to_context
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
multiline_comment|/* Kernel threads can execute in any context and so can tasks&n;&t; * sleeping in the middle of exiting. If this task has already&n;&t; * been allocated a piece of the mmu realestate, just jump to&n;&t; * it.&n;&t; */
r_if
c_cond
(paren
(paren
id|tsk-&gt;tss.flags
op_amp
id|SPARC_FLAG_KTHREAD
)paren
op_logical_or
(paren
id|tsk-&gt;flags
op_amp
id|PF_EXITING
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tsk-&gt;mm-&gt;context
op_eq
id|NO_CONTEXT
)paren
(brace
id|alloc_context
c_func
(paren
id|tsk-&gt;mm
)paren
suffix:semicolon
id|ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|tsk-&gt;mm-&gt;context
)braket
comma
id|tsk-&gt;mm-&gt;pgd
)paren
suffix:semicolon
)brace
id|srmmu_set_context
c_func
(paren
id|tsk-&gt;mm-&gt;context
)paren
suffix:semicolon
)brace
multiline_comment|/* Low level IO area allocation on the SRMMU. */
DECL|function|srmmu_mapioaddr
r_void
id|srmmu_mapioaddr
c_func
(paren
r_int
r_int
id|physaddr
comma
r_int
r_int
id|virt_addr
comma
r_int
id|bus_type
comma
r_int
id|rdonly
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|physaddr
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|virt_addr
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|virt_addr
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|virt_addr
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|physaddr
op_rshift
l_int|4
)paren
op_or
id|SRMMU_ET_PTE
suffix:semicolon
multiline_comment|/* I need to test whether this is consistent over all&n;&t; * sun4m&squot;s.  The bus_type represents the upper 4 bits of&n;&t; * 36-bit physical address on the I/O space lines...&n;&t; */
id|tmp
op_or_assign
(paren
id|bus_type
op_lshift
l_int|28
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rdonly
)paren
(brace
id|tmp
op_or_assign
id|SRMMU_PRIV_RDONLY
suffix:semicolon
)brace
r_else
id|tmp
op_or_assign
id|SRMMU_PRIV
suffix:semicolon
id|flush_page_to_ram
c_func
(paren
id|virt_addr
)paren
suffix:semicolon
id|srmmu_set_entry
c_func
(paren
id|ptep
comma
id|tmp
)paren
suffix:semicolon
id|flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_lockarea
r_static
r_char
op_star
id|srmmu_lockarea
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
)paren
(brace
r_return
id|vaddr
suffix:semicolon
)brace
DECL|function|srmmu_unlockarea
r_static
r_void
id|srmmu_unlockarea
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
)paren
(brace
)brace
multiline_comment|/* On the SRMMU we do not have the problems with limited tlb entries&n; * for mapping kernel pages, so we just take things from the free page&n; * pool.  As a side effect we are putting a little too much pressure&n; * on the gfp() subsystem.  This setup also makes the logic of the&n; * iommu mapping code a lot easier as we can transparently handle&n; * mappings on the kernel stack without any special code as we did&n; * need on the sun4c.&n; */
DECL|function|srmmu_alloc_task_struct
r_struct
id|task_struct
op_star
id|srmmu_alloc_task_struct
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|page
suffix:semicolon
id|page
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
(brace
r_return
(paren
r_struct
id|task_struct
op_star
)paren
l_int|0
suffix:semicolon
)brace
r_return
(paren
r_struct
id|task_struct
op_star
)paren
id|page
suffix:semicolon
)brace
DECL|function|srmmu_alloc_kernel_stack
r_int
r_int
id|srmmu_alloc_kernel_stack
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
r_int
r_int
id|pages
suffix:semicolon
id|pages
op_assign
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|2
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pages
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|pages
comma
l_int|0
comma
(paren
id|PAGE_SIZE
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_return
id|pages
suffix:semicolon
)brace
DECL|function|srmmu_free_task_struct
r_static
r_void
id|srmmu_free_task_struct
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|tsk
)paren
suffix:semicolon
)brace
DECL|function|srmmu_free_kernel_stack
r_static
r_void
id|srmmu_free_kernel_stack
c_func
(paren
r_int
r_int
id|stack
)paren
(brace
id|free_pages
c_func
(paren
id|stack
comma
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/* Tsunami flushes.  It&squot;s page level tlb invalidation is not very&n; * useful at all, you must be in the context that page exists in to&n; * get a match.&n; */
DECL|function|tsunami_flush_cache_all
r_static
r_void
id|tsunami_flush_cache_all
c_func
(paren
r_void
)paren
(brace
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|tsunami_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|tsunami_flush_dcache
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|tsunami_flush_cache_mm
r_static
r_void
id|tsunami_flush_cache_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|tsunami_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|tsunami_flush_dcache
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|tsunami_flush_cache_range
r_static
r_void
id|tsunami_flush_cache_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|tsunami_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|tsunami_flush_dcache
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|tsunami_flush_cache_page
r_static
r_void
id|tsunami_flush_cache_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
macro_line|#ifndef __SMP__
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|tsunami_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|tsunami_flush_dcache
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|tsunami_flush_cache_page_to_uncache
r_static
r_void
id|tsunami_flush_cache_page_to_uncache
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|tsunami_flush_dcache
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Tsunami does not have a Copy-back style virtual cache. */
DECL|function|tsunami_flush_page_to_ram
r_static
r_void
id|tsunami_flush_page_to_ram
c_func
(paren
r_int
r_int
id|page
)paren
(brace
)brace
multiline_comment|/* However, Tsunami is not IO coherent. */
DECL|function|tsunami_flush_page_for_dma
r_static
r_void
id|tsunami_flush_page_for_dma
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|tsunami_flush_dcache
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* TLB flushes seem to upset the tsunami sometimes, I can&squot;t figure out&n; * what the hell is going on.  All I see is a tlb flush (page or whole,&n; * there is no consistent pattern) and then total local variable corruption&n; * in the procedure who called us after return.  Usually triggerable&n; * by &quot;cool&quot; programs like crashme and bonnie.  I played around a bit&n; * and adding a bunch of forced nops seems to make the problems all&n; * go away. (missed instruction fetches possibly? ugh...)&n; */
DECL|macro|TSUNAMI_SUCKS
mdefine_line|#define TSUNAMI_SUCKS do { nop(); nop(); nop(); nop(); nop(); &bslash;&n;&t;                   nop(); nop(); nop(); nop(); nop(); } while(0)
DECL|function|tsunami_flush_tlb_all
r_static
r_void
id|tsunami_flush_tlb_all
c_func
(paren
r_void
)paren
(brace
id|module_stats.invall
op_increment
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
id|TSUNAMI_SUCKS
suffix:semicolon
)brace
DECL|function|tsunami_flush_tlb_mm
r_static
r_void
id|tsunami_flush_tlb_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
id|module_stats.invmm
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
id|TSUNAMI_SUCKS
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|tsunami_flush_tlb_range
r_static
r_void
id|tsunami_flush_tlb_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|module_stats.invrnge
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
id|TSUNAMI_SUCKS
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|tsunami_flush_tlb_page
r_static
r_void
id|tsunami_flush_tlb_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
r_int
id|octx
suffix:semicolon
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|srmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|TSUNAMI_SUCKS
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
id|module_stats.invpg
op_increment
suffix:semicolon
)brace
DECL|function|tsunami_flush_tlb_page_for_cbit
r_static
r_void
id|tsunami_flush_tlb_page_for_cbit
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|srmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
multiline_comment|/* Swift flushes.  It has the recommended SRMMU specification flushing&n; * facilities, so we can do things in a more fine grained fashion than we&n; * could on the tsunami.  Let&squot;s watch out for HARDWARE BUGS...&n; */
DECL|function|swift_flush_cache_all
r_static
r_void
id|swift_flush_cache_all
c_func
(paren
r_void
)paren
(brace
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|swift_idflash_clear
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|swift_flush_cache_mm
r_static
r_void
id|swift_flush_cache_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|swift_idflash_clear
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|swift_flush_cache_range
r_static
r_void
id|swift_flush_cache_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|swift_idflash_clear
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|swift_flush_cache_page
r_static
r_void
id|swift_flush_cache_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
macro_line|#ifndef __SMP__
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_EXEC
)paren
(brace
id|swift_flush_icache
c_func
(paren
)paren
suffix:semicolon
)brace
id|swift_flush_dcache
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
multiline_comment|/* Not copy-back on swift. */
DECL|function|swift_flush_page_to_ram
r_static
r_void
id|swift_flush_page_to_ram
c_func
(paren
r_int
r_int
id|page
)paren
(brace
)brace
multiline_comment|/* But not IO coherent either. */
DECL|function|swift_flush_page_for_dma
r_static
r_void
id|swift_flush_page_for_dma
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|swift_flush_dcache
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|swift_flush_cache_page_to_uncache
r_static
r_void
id|swift_flush_cache_page_to_uncache
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|swift_flush_dcache
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|swift_flush_tlb_all
r_static
r_void
id|swift_flush_tlb_all
c_func
(paren
r_void
)paren
(brace
id|module_stats.invall
op_increment
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|swift_flush_tlb_mm
r_static
r_void
id|swift_flush_tlb_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
id|module_stats.invmm
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|swift_flush_tlb_range
r_static
r_void
id|swift_flush_tlb_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|module_stats.invrnge
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|swift_flush_tlb_page
r_static
r_void
id|swift_flush_tlb_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
macro_line|#ifndef __SMP__
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
id|module_stats.invpg
op_increment
suffix:semicolon
)brace
DECL|function|swift_flush_tlb_page_for_cbit
r_static
r_void
id|swift_flush_tlb_page_for_cbit
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* The following are all MBUS based SRMMU modules, and therefore could&n; * be found in a multiprocessor configuration.  On the whole, these&n; * chips seems to be much more touchy about DVMA and page tables&n; * with respect to cache coherency.&n; */
multiline_comment|/* Viking flushes.  For Sun&squot;s mainline MBUS processor it is pretty much&n; * a crappy mmu.  The on-chip I&amp;D caches only have full flushes, no fine&n; * grained cache invalidations.  It only has these &quot;flash clear&quot; things&n; * just like the MicroSparcI.  Added to this many revs of the chip are&n; * teaming with hardware buggery.  Someday maybe we&squot;ll do direct&n; * diagnostic tag accesses for page level flushes as those should&n; * be painless and will increase performance due to the frequency of&n; * page level flushes. This is a must to _really_ flush the caches,&n; * crazy hardware ;-)&n; */
DECL|function|viking_flush_cache_all
r_static
r_void
id|viking_flush_cache_all
c_func
(paren
r_void
)paren
(brace
id|viking_flush_icache
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|viking_flush_cache_mm
r_static
r_void
id|viking_flush_cache_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|viking_flush_icache
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|viking_flush_cache_range
r_static
r_void
id|viking_flush_cache_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|viking_flush_icache
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|viking_flush_cache_page
r_static
r_void
id|viking_flush_cache_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
macro_line|#ifndef __SMP__
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_EXEC
)paren
(brace
id|viking_flush_icache
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
multiline_comment|/* Non-mxcc vikings are copy-back but are pure-physical so no flushing. */
DECL|function|viking_flush_page_to_ram
r_static
r_void
id|viking_flush_page_to_ram
c_func
(paren
r_int
r_int
id|page
)paren
(brace
)brace
multiline_comment|/* Viking is IO cache coherent. */
DECL|function|viking_flush_page_for_dma
r_static
r_void
id|viking_flush_page_for_dma
c_func
(paren
r_int
r_int
id|page
)paren
(brace
)brace
DECL|function|viking_mxcc_flush_page
r_static
r_void
id|viking_mxcc_flush_page
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|ppage
op_assign
id|srmmu_hwprobe
c_func
(paren
id|page
)paren
suffix:semicolon
r_int
r_int
id|paddr0
comma
id|paddr1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ppage
)paren
r_return
suffix:semicolon
id|paddr0
op_assign
(paren
id|ppage
op_rshift
l_int|28
)paren
op_or
l_int|0x10
suffix:semicolon
multiline_comment|/* Set cacheable bit. */
id|paddr1
op_assign
(paren
id|ppage
op_lshift
l_int|4
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
multiline_comment|/* Read the page&squot;s data through the stream registers,&n;&t; * and write it back to memory. This will issue&n;&t; * coherent write invalidates to all other caches, thus&n;         * should also be sufficient in an MP system.&n;&t; */
id|__asm__
id|__volatile__
(paren
l_string|&quot;or %%g0, %0, %%g2&bslash;n&bslash;t&quot;
l_string|&quot;or %%g0, %1, %%g3&bslash;n&quot;
l_string|&quot;1:&bslash;n&bslash;t&quot;
l_string|&quot;stda %%g2, [%2] %5&bslash;n&bslash;t&quot;
l_string|&quot;stda %%g2, [%3] %5&bslash;n&bslash;t&quot;
l_string|&quot;add %%g3, %4, %%g3&bslash;n&bslash;t&quot;
l_string|&quot;btst 0xfff, %%g3&bslash;n&bslash;t&quot;
l_string|&quot;bne 1b&bslash;n&bslash;t&quot;
l_string|&quot;nop&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|paddr0
)paren
comma
l_string|&quot;r&quot;
(paren
id|paddr1
)paren
comma
l_string|&quot;r&quot;
(paren
id|MXCC_SRCSTREAM
)paren
comma
l_string|&quot;r&quot;
(paren
id|MXCC_DESSTREAM
)paren
comma
l_string|&quot;r&quot;
(paren
id|MXCC_STREAM_SIZE
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_MXCC
)paren
suffix:colon
l_string|&quot;g2&quot;
comma
l_string|&quot;g3&quot;
)paren
suffix:semicolon
multiline_comment|/* This was handcoded after a look at the gcc output from&n;&t; *&n;&t; *&t;do {&n;&t; *&t;&t;mxcc_set_stream_src(paddr);&n;&t; *&t;&t;mxcc_set_stream_dst(paddr);&n;&t; *&t;&t;paddr[1] += MXCC_STREAM_SIZE;&n;&t; *&t;} while (paddr[1] &amp; ~PAGE_MASK);&n;&t; */
)brace
DECL|function|viking_no_mxcc_flush_page
r_static
r_void
id|viking_no_mxcc_flush_page
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|ppage
op_assign
id|srmmu_hwprobe
c_func
(paren
id|page
)paren
op_rshift
l_int|8
suffix:semicolon
r_int
id|set
comma
id|block
suffix:semicolon
r_int
r_int
id|ptag
(braket
l_int|2
)braket
suffix:semicolon
r_int
r_int
id|vaddr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ppage
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|set
op_assign
l_int|0
suffix:semicolon
id|set
OL
l_int|128
suffix:semicolon
id|set
op_increment
)paren
(brace
r_for
c_loop
(paren
id|block
op_assign
l_int|0
suffix:semicolon
id|block
OL
l_int|4
suffix:semicolon
id|block
op_increment
)paren
(brace
id|viking_get_dcache_ptag
c_func
(paren
id|set
comma
id|block
comma
id|ptag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptag
(braket
l_int|1
)braket
op_ne
id|ppage
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ptag
(braket
l_int|0
)braket
op_amp
id|VIKING_PTAG_VALID
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ptag
(braket
l_int|0
)braket
op_amp
id|VIKING_PTAG_DIRTY
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* There was a great cache from TI&n;&t;&t;&t; * with comfort as much as vi,&n;&t;&t;&t; * 4 pages to flush,&n;&t;&t;&t; * 4 pages, no rush,&n;&t;&t;&t; * since anything else makes him die.&n;&t;&t;&t; */
id|vaddr
op_assign
(paren
id|KERNBASE
op_plus
id|PAGE_SIZE
)paren
op_or
(paren
id|set
op_lshift
l_int|5
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|__asm__
id|__volatile__
(paren
l_string|&quot;ld [%0], %%g2&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|vaddr
)paren
suffix:colon
l_string|&quot;g2&quot;
)paren
suffix:semicolon
id|vaddr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
multiline_comment|/* Continue with next set. */
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|viking_flush_tlb_all
r_static
r_void
id|viking_flush_tlb_all
c_func
(paren
r_void
)paren
(brace
id|module_stats.invall
op_increment
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|viking_flush_tlb_mm
r_static
r_void
id|viking_flush_tlb_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_int
id|octx
suffix:semicolon
id|module_stats.invmm
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|srmmu_flush_tlb_ctx
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|viking_flush_tlb_range
r_static
r_void
id|viking_flush_tlb_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
r_int
id|octx
suffix:semicolon
id|module_stats.invrnge
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|start
op_and_assign
id|SRMMU_PMD_MASK
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|srmmu_flush_tlb_segment
c_func
(paren
id|start
)paren
suffix:semicolon
id|start
op_add_assign
id|SRMMU_PMD_SIZE
suffix:semicolon
)brace
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|viking_flush_tlb_page
r_static
r_void
id|viking_flush_tlb_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
r_int
id|octx
suffix:semicolon
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
id|module_stats.invpg
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|srmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|viking_flush_tlb_page_for_cbit
r_static
r_void
id|viking_flush_tlb_page_for_cbit
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|srmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
multiline_comment|/* Cypress flushes. */
DECL|function|cypress_flush_tlb_all
r_static
r_void
id|cypress_flush_tlb_all
c_func
(paren
r_void
)paren
(brace
id|module_stats.invall
op_increment
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cypress_flush_tlb_mm
r_static
r_void
id|cypress_flush_tlb_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_int
id|octx
suffix:semicolon
id|module_stats.invmm
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|srmmu_flush_tlb_ctx
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|cypress_flush_tlb_range
r_static
r_void
id|cypress_flush_tlb_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
r_int
id|octx
suffix:semicolon
id|module_stats.invrnge
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|start
op_and_assign
id|SRMMU_PMD_MASK
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|srmmu_flush_tlb_segment
c_func
(paren
id|start
)paren
suffix:semicolon
id|start
op_add_assign
id|SRMMU_PMD_SIZE
suffix:semicolon
)brace
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|cypress_flush_tlb_page
r_static
r_void
id|cypress_flush_tlb_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
r_int
id|octx
suffix:semicolon
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
id|module_stats.invpg
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|srmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
multiline_comment|/* Hypersparc flushes.  Very nice chip... */
DECL|function|hypersparc_flush_cache_all
r_static
r_void
id|hypersparc_flush_cache_all
c_func
(paren
r_void
)paren
(brace
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|hyper_flush_unconditional_combined
c_func
(paren
)paren
suffix:semicolon
id|hyper_flush_whole_icache
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|hypersparc_flush_cache_mm
r_static
r_void
id|hypersparc_flush_cache_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|hyper_flush_unconditional_combined
c_func
(paren
)paren
suffix:semicolon
id|hyper_flush_whole_icache
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|hypersparc_flush_cache_range
r_static
r_void
id|hypersparc_flush_cache_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|hyper_flush_unconditional_combined
c_func
(paren
)paren
suffix:semicolon
id|hyper_flush_whole_icache
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
multiline_comment|/* HyperSparc requires a valid mapping where we are about to flush&n; * in order to check for a physical tag match during the flush.&n; */
DECL|function|hypersparc_flush_cache_page
r_static
r_void
id|hypersparc_flush_cache_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
r_volatile
r_int
r_int
id|clear
suffix:semicolon
r_int
id|octx
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|hyper_flush_whole_icache
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|srmmu_hwprobe
c_func
(paren
id|page
)paren
)paren
(brace
r_goto
id|no_mapping
suffix:semicolon
)brace
id|hyper_flush_cache_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|no_mapping
suffix:colon
id|clear
op_assign
id|srmmu_get_fstatus
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
multiline_comment|/* HyperSparc is copy-back. */
DECL|function|hypersparc_flush_page_to_ram
r_static
r_void
id|hypersparc_flush_page_to_ram
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_volatile
r_int
r_int
id|clear
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_hwprobe
c_func
(paren
id|page
)paren
)paren
(brace
id|hyper_flush_cache_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
id|clear
op_assign
id|srmmu_get_fstatus
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* HyperSparc is IO cache coherent. */
DECL|function|hypersparc_flush_page_for_dma
r_static
r_void
id|hypersparc_flush_page_for_dma
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_volatile
r_int
r_int
id|clear
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_hwprobe
c_func
(paren
id|page
)paren
)paren
(brace
id|hyper_flush_cache_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
id|clear
op_assign
id|srmmu_get_fstatus
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|hypersparc_flush_cache_page_to_uncache
r_static
r_void
id|hypersparc_flush_cache_page_to_uncache
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_volatile
r_int
r_int
id|clear
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_hwprobe
c_func
(paren
id|page
)paren
)paren
(brace
id|hyper_flush_cache_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
id|clear
op_assign
id|srmmu_get_fstatus
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|hypersparc_flush_tlb_all
r_static
r_void
id|hypersparc_flush_tlb_all
c_func
(paren
r_void
)paren
(brace
id|module_stats.invall
op_increment
suffix:semicolon
id|srmmu_flush_whole_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|hypersparc_flush_tlb_mm
r_static
r_void
id|hypersparc_flush_tlb_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_int
id|octx
suffix:semicolon
id|module_stats.invmm
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|srmmu_flush_tlb_ctx
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|hypersparc_flush_tlb_range
r_static
r_void
id|hypersparc_flush_tlb_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
r_int
id|octx
suffix:semicolon
id|module_stats.invrnge
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|start
op_and_assign
id|SRMMU_PMD_MASK
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|srmmu_flush_tlb_segment
c_func
(paren
id|start
)paren
suffix:semicolon
id|start
op_add_assign
id|SRMMU_PMD_SIZE
suffix:semicolon
)brace
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|hypersparc_flush_tlb_page
r_static
r_void
id|hypersparc_flush_tlb_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
r_int
id|octx
suffix:semicolon
id|module_stats.invpg
op_increment
suffix:semicolon
macro_line|#ifndef __SMP__
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
macro_line|#endif
id|octx
op_assign
id|srmmu_get_context
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|mm-&gt;context
)paren
suffix:semicolon
id|srmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
macro_line|#ifndef __SMP__
)brace
macro_line|#endif
)brace
DECL|function|hypersparc_flush_tlb_page_for_cbit
r_static
r_void
id|hypersparc_flush_tlb_page_for_cbit
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|srmmu_flush_tlb_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
DECL|function|hypersparc_ctxd_set
r_static
r_void
id|hypersparc_ctxd_set
c_func
(paren
id|ctxd_t
op_star
id|ctxp
comma
id|pgd_t
op_star
id|pgdp
)paren
(brace
id|hyper_flush_whole_icache
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_entry
c_func
(paren
id|ctxp
comma
(paren
id|SRMMU_ET_PTD
op_or
(paren
id|srmmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|pgdp
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|hypersparc_update_rootmmu_dir
r_static
r_void
id|hypersparc_update_rootmmu_dir
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
id|pgd_t
op_star
id|pgdp
)paren
(brace
r_if
c_cond
(paren
id|tsk-&gt;mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
id|hyper_flush_whole_icache
c_func
(paren
)paren
suffix:semicolon
id|ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|tsk-&gt;mm-&gt;context
)braket
comma
id|pgdp
)paren
suffix:semicolon
)brace
)brace
DECL|function|hypersparc_set_pte
r_static
r_void
id|hypersparc_set_pte
c_func
(paren
id|pte_t
op_star
id|ptep
comma
id|pte_t
id|pteval
)paren
(brace
multiline_comment|/* xor is your friend */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;rd&t;%%psr, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;wr&t;%%g1, %4, %%psr&bslash;n&bslash;t&quot;
l_string|&quot;nop; nop; nop;&bslash;n&bslash;t&quot;
l_string|&quot;swap&t;[%0], %1&bslash;n&bslash;t&quot;
l_string|&quot;wr&t;%%g1, 0x0, %%psr&bslash;n&bslash;t&quot;
l_string|&quot;nop; nop; nop;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|ptep
)paren
comma
l_string|&quot;=r&quot;
(paren
id|pteval
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|ptep
)paren
comma
l_string|&quot;1&quot;
(paren
id|pteval
)paren
comma
l_string|&quot;i&quot;
(paren
id|PSR_ET
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
)brace
DECL|function|hypersparc_switch_to_context
r_static
r_void
id|hypersparc_switch_to_context
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
multiline_comment|/* Kernel threads can execute in any context and so can tasks&n;&t; * sleeping in the middle of exiting. If this task has already&n;&t; * been allocated a piece of the mmu realestate, just jump to&n;&t; * it.&n;&t; */
id|hyper_flush_whole_icache
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tsk-&gt;tss.flags
op_amp
id|SPARC_FLAG_KTHREAD
)paren
op_logical_or
(paren
id|tsk-&gt;flags
op_amp
id|PF_EXITING
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tsk-&gt;mm-&gt;context
op_eq
id|NO_CONTEXT
)paren
(brace
id|alloc_context
c_func
(paren
id|tsk-&gt;mm
)paren
suffix:semicolon
id|ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|tsk-&gt;mm-&gt;context
)braket
comma
id|tsk-&gt;mm-&gt;pgd
)paren
suffix:semicolon
)brace
id|srmmu_set_context
c_func
(paren
id|tsk-&gt;mm-&gt;context
)paren
suffix:semicolon
)brace
multiline_comment|/* IOMMU things go here. */
DECL|macro|LONG_ALIGN
mdefine_line|#define LONG_ALIGN(x) (((x)+(sizeof(long))-1)&amp;~((sizeof(long))-1))
DECL|variable|first_dvma_page
DECL|variable|last_dvma_page
r_static
r_int
r_int
id|first_dvma_page
comma
id|last_dvma_page
suffix:semicolon
DECL|macro|IOPERM
mdefine_line|#define IOPERM        (IOPTE_CACHE | IOPTE_WRITE | IOPTE_VALID)
DECL|macro|MKIOPTE
mdefine_line|#define MKIOPTE(phys) (((((phys)&gt;&gt;4) &amp; IOPTE_PAGE) | IOPERM) &amp; ~IOPTE_WAZ)
DECL|function|srmmu_map_dvma_pages_for_iommu
r_static
r_inline
r_void
id|srmmu_map_dvma_pages_for_iommu
c_func
(paren
r_struct
id|iommu_struct
op_star
id|iommu
)paren
(brace
r_int
r_int
id|first
op_assign
id|first_dvma_page
suffix:semicolon
r_int
r_int
id|last
op_assign
id|last_dvma_page
suffix:semicolon
id|iopte_t
op_star
id|iopte
suffix:semicolon
id|iopte
op_assign
id|iommu-&gt;page_table
suffix:semicolon
id|iopte
op_add_assign
(paren
(paren
id|DVMA_VADDR
op_minus
id|iommu-&gt;start
)paren
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
r_while
c_loop
(paren
id|first
op_le
id|last
)paren
(brace
id|iopte_val
c_func
(paren
op_star
id|iopte
op_increment
)paren
op_assign
id|MKIOPTE
c_func
(paren
id|srmmu_v2p
c_func
(paren
id|first
)paren
)paren
suffix:semicolon
id|first
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
DECL|function|srmmu_uncache_iommu_page_table
r_void
id|srmmu_uncache_iommu_page_table
c_func
(paren
r_int
r_int
id|start
comma
r_int
id|size
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_int
r_int
id|end
op_assign
id|start
op_plus
id|size
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_and_assign
op_complement
id|SRMMU_CACHE
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
DECL|function|iommu_init
r_int
r_int
id|iommu_init
c_func
(paren
r_int
id|iommund
comma
r_int
r_int
id|memory_start
comma
r_int
r_int
id|memory_end
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_int
id|impl
comma
id|vers
comma
id|ptsize
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_struct
id|iommu_struct
op_star
id|iommu
suffix:semicolon
r_struct
id|linux_prom_registers
id|iommu_promregs
(braket
id|PROMREG_MAX
)braket
suffix:semicolon
id|memory_start
op_assign
id|LONG_ALIGN
c_func
(paren
id|memory_start
)paren
suffix:semicolon
id|iommu
op_assign
(paren
r_struct
id|iommu_struct
op_star
)paren
id|memory_start
suffix:semicolon
id|memory_start
op_add_assign
r_sizeof
(paren
r_struct
id|iommu_struct
)paren
suffix:semicolon
id|prom_getproperty
c_func
(paren
id|iommund
comma
l_string|&quot;reg&quot;
comma
(paren
r_void
op_star
)paren
id|iommu_promregs
comma
r_sizeof
(paren
id|iommu_promregs
)paren
)paren
suffix:semicolon
id|iommu-&gt;regs
op_assign
(paren
r_struct
id|iommu_regs
op_star
)paren
id|sparc_alloc_io
c_func
(paren
id|iommu_promregs
(braket
l_int|0
)braket
dot
id|phys_addr
comma
l_int|0
comma
(paren
id|PAGE_SIZE
op_star
l_int|3
)paren
comma
l_string|&quot;IOMMU registers&quot;
comma
id|iommu_promregs
(braket
l_int|0
)braket
dot
id|which_io
comma
l_int|0x0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iommu-&gt;regs
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Cannot map IOMMU registers.&quot;
)paren
suffix:semicolon
)brace
id|impl
op_assign
(paren
id|iommu-&gt;regs-&gt;control
op_amp
id|IOMMU_CTRL_IMPL
)paren
op_rshift
l_int|28
suffix:semicolon
id|vers
op_assign
(paren
id|iommu-&gt;regs-&gt;control
op_amp
id|IOMMU_CTRL_VERS
)paren
op_rshift
l_int|24
suffix:semicolon
id|tmp
op_assign
id|iommu-&gt;regs-&gt;control
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
id|IOMMU_CTRL_RNGE
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|IOMMU_RNGE_64MB
op_or
id|IOMMU_CTRL_ENAB
)paren
suffix:semicolon
id|iommu-&gt;regs-&gt;control
op_assign
id|tmp
suffix:semicolon
id|iommu_invalidate
c_func
(paren
id|iommu-&gt;regs
)paren
suffix:semicolon
id|iommu-&gt;plow
op_assign
id|iommu-&gt;start
op_assign
l_int|0xfc000000
suffix:semicolon
id|iommu-&gt;end
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Allocate IOMMU page table */
id|ptsize
op_assign
id|iommu-&gt;end
op_minus
id|iommu-&gt;start
op_plus
l_int|1
suffix:semicolon
id|ptsize
op_assign
(paren
id|ptsize
op_rshift
id|PAGE_SHIFT
)paren
op_star
r_sizeof
(paren
id|iopte_t
)paren
suffix:semicolon
multiline_comment|/* Stupid alignment constraints give me a headache. */
id|memory_start
op_assign
id|PAGE_ALIGN
c_func
(paren
id|memory_start
)paren
suffix:semicolon
id|memory_start
op_assign
(paren
(paren
(paren
id|memory_start
)paren
op_plus
(paren
id|ptsize
op_minus
l_int|1
)paren
)paren
op_amp
op_complement
(paren
id|ptsize
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|iommu-&gt;lowest
op_assign
id|iommu-&gt;page_table
op_assign
(paren
id|iopte_t
op_star
)paren
id|memory_start
suffix:semicolon
id|memory_start
op_add_assign
id|ptsize
suffix:semicolon
multiline_comment|/* Initialize new table. */
id|flush_cache_all
c_func
(paren
)paren
suffix:semicolon
id|srmmu_uncache_iommu_page_table
c_func
(paren
(paren
r_int
r_int
)paren
id|iommu-&gt;page_table
comma
id|ptsize
)paren
suffix:semicolon
id|flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|iommu-&gt;page_table
comma
l_int|0
comma
id|ptsize
)paren
suffix:semicolon
id|srmmu_map_dvma_pages_for_iommu
c_func
(paren
id|iommu
)paren
suffix:semicolon
id|iommu-&gt;regs-&gt;base
op_assign
id|srmmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|iommu-&gt;page_table
)paren
op_rshift
l_int|4
suffix:semicolon
id|iommu_invalidate
c_func
(paren
id|iommu-&gt;regs
)paren
suffix:semicolon
id|sbus-&gt;iommu
op_assign
id|iommu
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IOMMU: impl %d vers %d page table at %p of size %d bytes&bslash;n&quot;
comma
id|impl
comma
id|vers
comma
id|iommu-&gt;page_table
comma
id|ptsize
)paren
suffix:semicolon
r_return
id|memory_start
suffix:semicolon
)brace
DECL|function|srmmu_get_scsi_one
r_static
r_char
op_star
id|srmmu_get_scsi_one
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_struct
id|iommu_struct
op_star
id|iommu
op_assign
id|sbus-&gt;iommu
suffix:semicolon
r_int
r_int
id|page
op_assign
(paren
r_int
r_int
)paren
id|vaddr
suffix:semicolon
r_int
r_int
id|start
comma
id|end
comma
id|offset
suffix:semicolon
id|iopte_t
op_star
id|iopte
suffix:semicolon
id|offset
op_assign
id|page
op_amp
op_complement
id|PAGE_MASK
suffix:semicolon
id|page
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|start
op_assign
id|iommu-&gt;plow
suffix:semicolon
id|end
op_assign
id|KADB_DEBUGGER_BEGVM
suffix:semicolon
multiline_comment|/* Don&squot;t step on kadb/prom. */
id|iopte
op_assign
id|iommu-&gt;lowest
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|iopte_val
c_func
(paren
op_star
id|iopte
)paren
op_amp
id|IOPTE_VALID
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|iopte
op_increment
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|flush_page_for_dma
c_func
(paren
id|page
)paren
suffix:semicolon
id|vaddr
op_assign
(paren
r_char
op_star
)paren
(paren
id|start
op_or
id|offset
)paren
suffix:semicolon
id|iopte_val
c_func
(paren
op_star
id|iopte
)paren
op_assign
id|MKIOPTE
c_func
(paren
id|srmmu_v2p
c_func
(paren
id|page
)paren
)paren
suffix:semicolon
id|iommu_invalidate_page
c_func
(paren
id|iommu-&gt;regs
comma
id|start
)paren
suffix:semicolon
id|iommu-&gt;lowest
op_assign
id|iopte
op_plus
l_int|1
suffix:semicolon
id|iommu-&gt;plow
op_assign
id|start
op_plus
id|PAGE_SIZE
suffix:semicolon
r_return
id|vaddr
suffix:semicolon
)brace
DECL|function|srmmu_get_scsi_sgl
r_static
r_void
id|srmmu_get_scsi_sgl
c_func
(paren
r_struct
id|mmu_sglist
op_star
id|sg
comma
r_int
id|sz
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_struct
id|iommu_struct
op_star
id|iommu
op_assign
id|sbus-&gt;iommu
suffix:semicolon
r_int
r_int
id|page
comma
id|start
comma
id|end
comma
id|offset
suffix:semicolon
id|iopte_t
op_star
id|iopte
op_assign
id|iommu-&gt;lowest
suffix:semicolon
id|start
op_assign
id|iommu-&gt;plow
suffix:semicolon
id|end
op_assign
id|KADB_DEBUGGER_BEGVM
suffix:semicolon
r_while
c_loop
(paren
id|sz
op_ge
l_int|0
)paren
(brace
id|page
op_assign
(paren
(paren
r_int
r_int
)paren
id|sg
(braket
id|sz
)braket
dot
id|addr
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
id|offset
op_assign
(paren
(paren
r_int
r_int
)paren
id|sg
(braket
id|sz
)braket
dot
id|addr
)paren
op_amp
op_complement
id|PAGE_MASK
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|iopte_val
c_func
(paren
op_star
id|iopte
)paren
op_amp
id|IOPTE_VALID
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|iopte
op_increment
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|start
op_eq
id|KADB_DEBUGGER_BEGVM
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Wheee, iomapping overflow.&quot;
)paren
suffix:semicolon
)brace
id|flush_page_for_dma
c_func
(paren
id|page
)paren
suffix:semicolon
id|sg
(braket
id|sz
)braket
dot
id|alt_addr
op_assign
(paren
r_char
op_star
)paren
(paren
id|start
op_or
id|offset
)paren
suffix:semicolon
id|iopte_val
c_func
(paren
op_star
id|iopte
)paren
op_assign
id|MKIOPTE
c_func
(paren
id|srmmu_v2p
c_func
(paren
id|page
)paren
)paren
suffix:semicolon
id|iommu_invalidate_page
c_func
(paren
id|iommu-&gt;regs
comma
id|start
)paren
suffix:semicolon
id|iopte
op_increment
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|sz
op_decrement
suffix:semicolon
)brace
id|iommu-&gt;lowest
op_assign
id|iopte
suffix:semicolon
id|iommu-&gt;plow
op_assign
id|start
suffix:semicolon
)brace
DECL|function|srmmu_release_scsi_one
r_static
r_void
id|srmmu_release_scsi_one
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|len
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_struct
id|iommu_struct
op_star
id|iommu
op_assign
id|sbus-&gt;iommu
suffix:semicolon
r_int
r_int
id|page
op_assign
(paren
r_int
r_int
)paren
id|vaddr
suffix:semicolon
id|iopte_t
op_star
id|iopte
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|PAGE_SIZE
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Can only handle page sized IOMMU mappings.&quot;
)paren
suffix:semicolon
)brace
id|page
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|iopte
op_assign
id|iommu-&gt;page_table
op_plus
(paren
(paren
id|page
op_minus
id|iommu-&gt;start
)paren
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
id|iopte_val
c_func
(paren
op_star
id|iopte
)paren
op_assign
l_int|0
suffix:semicolon
id|iommu_invalidate_page
c_func
(paren
id|iommu-&gt;regs
comma
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iopte
OL
id|iommu-&gt;lowest
)paren
(brace
id|iommu-&gt;lowest
op_assign
id|iopte
suffix:semicolon
id|iommu-&gt;plow
op_assign
id|page
suffix:semicolon
)brace
)brace
DECL|function|srmmu_release_scsi_sgl
r_static
r_void
id|srmmu_release_scsi_sgl
c_func
(paren
r_struct
id|mmu_sglist
op_star
id|sg
comma
r_int
id|sz
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_struct
id|iommu_struct
op_star
id|iommu
op_assign
id|sbus-&gt;iommu
suffix:semicolon
r_int
r_int
id|page
suffix:semicolon
id|iopte_t
op_star
id|iopte
suffix:semicolon
r_while
c_loop
(paren
id|sz
op_ge
l_int|0
)paren
(brace
id|page
op_assign
(paren
(paren
r_int
r_int
)paren
id|sg
(braket
id|sz
)braket
dot
id|alt_addr
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
id|iopte
op_assign
id|iommu-&gt;page_table
op_plus
(paren
(paren
id|page
op_minus
id|iommu-&gt;start
)paren
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
id|iopte_val
c_func
(paren
op_star
id|iopte
)paren
op_assign
l_int|0
suffix:semicolon
id|iommu_invalidate_page
c_func
(paren
id|iommu-&gt;regs
comma
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iopte
OL
id|iommu-&gt;lowest
)paren
(brace
id|iommu-&gt;lowest
op_assign
id|iopte
suffix:semicolon
id|iommu-&gt;plow
op_assign
id|page
suffix:semicolon
)brace
id|sg
(braket
id|sz
)braket
dot
id|alt_addr
op_assign
l_int|0
suffix:semicolon
id|sz
op_decrement
suffix:semicolon
)brace
)brace
DECL|variable|mempool
r_static
r_int
r_int
id|mempool
suffix:semicolon
multiline_comment|/* NOTE: All of this startup code assumes the low 16mb (approx.) of&n; *       kernel mappings are done with one single contiguous chunk of&n; *       ram.  On small ram machines (classics mainly) we only get&n; *       around 8mb mapped for us.&n; */
DECL|variable|kbpage
r_static
r_int
r_int
id|kbpage
suffix:semicolon
multiline_comment|/* Some dirty hacks to abstract away the painful boot up init. */
DECL|function|srmmu_early_paddr
r_static
r_inline
r_int
r_int
id|srmmu_early_paddr
c_func
(paren
r_int
r_int
id|vaddr
)paren
(brace
r_return
(paren
(paren
id|vaddr
op_minus
id|PAGE_OFFSET
)paren
op_plus
id|kbpage
)paren
suffix:semicolon
)brace
DECL|function|srmmu_early_pgd_set
r_static
r_inline
r_void
id|srmmu_early_pgd_set
c_func
(paren
id|pgd_t
op_star
id|pgdp
comma
id|pmd_t
op_star
id|pmdp
)paren
(brace
id|srmmu_set_entry
c_func
(paren
id|pgdp
comma
(paren
id|SRMMU_ET_PTD
op_or
(paren
id|srmmu_early_paddr
c_func
(paren
(paren
r_int
r_int
)paren
id|pmdp
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_early_pmd_set
r_static
r_inline
r_void
id|srmmu_early_pmd_set
c_func
(paren
id|pmd_t
op_star
id|pmdp
comma
id|pte_t
op_star
id|ptep
)paren
(brace
id|srmmu_set_entry
c_func
(paren
id|pmdp
comma
(paren
id|SRMMU_ET_PTD
op_or
(paren
id|srmmu_early_paddr
c_func
(paren
(paren
r_int
r_int
)paren
id|ptep
)paren
op_rshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_early_pgd_page
r_static
r_inline
r_int
r_int
id|srmmu_early_pgd_page
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
(paren
(paren
(paren
id|pgd_val
c_func
(paren
id|pgd
)paren
op_amp
id|SRMMU_PTD_PMASK
)paren
op_lshift
l_int|4
)paren
op_minus
id|kbpage
)paren
op_plus
id|PAGE_OFFSET
suffix:semicolon
)brace
DECL|function|srmmu_early_pmd_page
r_static
r_inline
r_int
r_int
id|srmmu_early_pmd_page
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
(paren
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|SRMMU_PTD_PMASK
)paren
op_lshift
l_int|4
)paren
op_minus
id|kbpage
)paren
op_plus
id|PAGE_OFFSET
suffix:semicolon
)brace
DECL|function|srmmu_early_pmd_offset
r_static
r_inline
id|pmd_t
op_star
id|srmmu_early_pmd_offset
c_func
(paren
id|pgd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pmd_t
op_star
)paren
id|srmmu_early_pgd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|SRMMU_PMD_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PMD
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|srmmu_early_pte_offset
r_static
r_inline
id|pte_t
op_star
id|srmmu_early_pte_offset
c_func
(paren
id|pmd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pte_t
op_star
)paren
id|srmmu_early_pmd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|SRMMU_PTRS_PER_PTE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Allocate a block of RAM which is aligned to its size.&n; * This procedure can be used until the call to mem_init().&n; */
DECL|function|srmmu_init_alloc
r_static
r_void
op_star
id|srmmu_init_alloc
c_func
(paren
r_int
r_int
op_star
id|kbrk
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|mask
op_assign
id|size
op_minus
l_int|1
suffix:semicolon
r_int
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|size
)paren
(brace
r_return
l_int|0x0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_amp
id|mask
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;panic: srmmu_init_alloc botch&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|ret
op_assign
(paren
op_star
id|kbrk
op_plus
id|mask
)paren
op_amp
op_complement
id|mask
suffix:semicolon
op_star
id|kbrk
op_assign
id|ret
op_plus
id|size
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|ret
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_return
(paren
r_void
op_star
)paren
id|ret
suffix:semicolon
)brace
DECL|function|srmmu_allocate_ptable_skeleton
r_static
r_inline
r_void
id|srmmu_allocate_ptable_skeleton
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgdp
)paren
)paren
(brace
id|pmdp
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|SRMMU_PMD_TABLE_SIZE
)paren
suffix:semicolon
id|srmmu_early_pgd_set
c_func
(paren
id|pgdp
comma
id|pmdp
)paren
suffix:semicolon
)brace
id|pmdp
op_assign
id|srmmu_early_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmdp
)paren
)paren
(brace
id|ptep
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|SRMMU_PTE_TABLE_SIZE
)paren
suffix:semicolon
id|srmmu_early_pmd_set
c_func
(paren
id|pmdp
comma
id|ptep
)paren
suffix:semicolon
)brace
id|start
op_assign
(paren
id|start
op_plus
id|SRMMU_PMD_SIZE
)paren
op_amp
id|SRMMU_PMD_MASK
suffix:semicolon
)brace
)brace
multiline_comment|/* This is much cleaner than poking around physical address space&n; * looking at the prom&squot;s page table directly which is what most&n; * other OS&squot;s do.  Yuck... this is much better.&n; */
DECL|function|srmmu_inherit_prom_mappings
r_void
id|srmmu_inherit_prom_mappings
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
r_int
id|what
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 0 = normal-pte, 1 = pmd-level pte, 2 = pgd-level pte */
r_int
r_int
id|prompte
suffix:semicolon
r_while
c_loop
(paren
id|start
op_le
id|end
)paren
(brace
r_if
c_cond
(paren
id|start
op_eq
l_int|0
)paren
r_break
suffix:semicolon
multiline_comment|/* probably wrap around */
r_if
c_cond
(paren
id|start
op_eq
l_int|0xfef00000
)paren
(brace
id|start
op_assign
id|KADB_DEBUGGER_BEGVM
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|prompte
op_assign
id|srmmu_hwprobe
c_func
(paren
id|start
)paren
)paren
)paren
(brace
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* A red snapper, see what it really is. */
id|what
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|start
op_amp
op_complement
(paren
id|SRMMU_PMD_MASK
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|srmmu_hwprobe
c_func
(paren
(paren
id|start
op_minus
id|PAGE_SIZE
)paren
op_plus
id|SRMMU_PMD_SIZE
)paren
op_eq
id|prompte
)paren
(brace
id|what
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|start
op_amp
op_complement
(paren
id|SRMMU_PGDIR_MASK
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|srmmu_hwprobe
c_func
(paren
(paren
id|start
op_minus
id|PAGE_SIZE
)paren
op_plus
id|SRMMU_PGDIR_SIZE
)paren
op_eq
id|prompte
)paren
(brace
id|what
op_assign
l_int|2
suffix:semicolon
)brace
)brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|what
op_eq
l_int|2
)paren
(brace
id|pgd_val
c_func
(paren
op_star
id|pgdp
)paren
op_assign
id|prompte
suffix:semicolon
id|start
op_add_assign
id|SRMMU_PGDIR_SIZE
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srmmu_pgd_none
c_func
(paren
op_star
id|pgdp
)paren
)paren
(brace
id|pmdp
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|SRMMU_PMD_TABLE_SIZE
)paren
suffix:semicolon
id|srmmu_early_pgd_set
c_func
(paren
id|pgdp
comma
id|pmdp
)paren
suffix:semicolon
)brace
id|pmdp
op_assign
id|srmmu_early_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
id|what
op_eq
l_int|1
)paren
(brace
id|pmd_val
c_func
(paren
op_star
id|pmdp
)paren
op_assign
id|prompte
suffix:semicolon
id|start
op_add_assign
id|SRMMU_PMD_SIZE
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|srmmu_pmd_none
c_func
(paren
op_star
id|pmdp
)paren
)paren
(brace
id|ptep
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|SRMMU_PTE_TABLE_SIZE
)paren
suffix:semicolon
id|srmmu_early_pmd_set
c_func
(paren
id|pmdp
comma
id|ptep
)paren
suffix:semicolon
)brace
id|ptep
op_assign
id|srmmu_early_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_assign
id|prompte
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
DECL|function|srmmu_map_dvma_pages_for_cpu
r_static
r_inline
r_void
id|srmmu_map_dvma_pages_for_cpu
c_func
(paren
r_int
r_int
id|first
comma
r_int
r_int
id|last
)paren
(brace
r_int
r_int
id|start
suffix:semicolon
id|pgprot_t
id|dvma_prot
suffix:semicolon
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
id|start
op_assign
id|DVMA_VADDR
suffix:semicolon
r_if
c_cond
(paren
id|viking_mxcc_present
)paren
id|dvma_prot
op_assign
id|__pgprot
c_func
(paren
id|SRMMU_CACHE
op_or
id|SRMMU_ET_PTE
op_or
id|SRMMU_PRIV
)paren
suffix:semicolon
r_else
id|dvma_prot
op_assign
id|__pgprot
c_func
(paren
id|SRMMU_ET_PTE
op_or
id|SRMMU_PRIV
)paren
suffix:semicolon
r_while
c_loop
(paren
id|first
op_le
id|last
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
id|srmmu_set_entry
c_func
(paren
id|ptep
comma
id|pte_val
c_func
(paren
id|srmmu_mk_pte
c_func
(paren
id|first
comma
id|dvma_prot
)paren
)paren
)paren
suffix:semicolon
id|first
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
multiline_comment|/* Uncache DVMA pages. */
r_if
c_cond
(paren
op_logical_neg
id|viking_mxcc_present
)paren
(brace
id|first
op_assign
id|first_dvma_page
suffix:semicolon
id|last
op_assign
id|last_dvma_page
suffix:semicolon
r_while
c_loop
(paren
id|first
op_le
id|last
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|first
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_pmd_offset
c_func
(paren
id|pgdp
comma
id|first
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_pte_offset
c_func
(paren
id|pmdp
comma
id|first
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_and_assign
op_complement
id|SRMMU_CACHE
suffix:semicolon
id|first
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
)brace
DECL|function|srmmu_map_kernel
r_static
r_void
id|srmmu_map_kernel
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
r_int
r_int
id|last_page
suffix:semicolon
r_int
id|srmmu_bank
comma
id|phys_bank
comma
id|i
suffix:semicolon
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
id|end
op_assign
id|PAGE_ALIGN
c_func
(paren
id|end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
op_eq
(paren
id|KERNBASE
op_plus
id|PAGE_SIZE
)paren
)paren
(brace
r_int
r_int
id|pte
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|KERNBASE
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_early_pmd_offset
c_func
(paren
id|pgdp
comma
id|KERNBASE
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_early_pte_offset
c_func
(paren
id|pmdp
comma
id|KERNBASE
)paren
suffix:semicolon
multiline_comment|/* Put a real mapping in for the KERNBASE page. */
id|tmp
op_assign
id|kbpage
suffix:semicolon
id|pte
op_assign
(paren
id|tmp
)paren
op_rshift
l_int|4
suffix:semicolon
id|pte
op_or_assign
(paren
id|SRMMU_CACHE
op_or
id|SRMMU_PRIV
op_or
id|SRMMU_VALID
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_assign
id|pte
suffix:semicolon
)brace
multiline_comment|/* Copy over mappings prom already gave us. */
id|last_page
op_assign
(paren
id|srmmu_hwprobe
c_func
(paren
id|start
)paren
op_amp
id|SRMMU_PTE_PMASK
)paren
op_lshift
l_int|4
suffix:semicolon
r_while
c_loop
(paren
(paren
id|srmmu_hwprobe
c_func
(paren
id|start
)paren
op_amp
id|SRMMU_ET_MASK
)paren
op_eq
id|SRMMU_ET_PTE
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_early_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_early_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
id|tmp
op_assign
id|srmmu_hwprobe
c_func
(paren
id|start
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
l_int|0xff
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|SRMMU_CACHE
op_or
id|SRMMU_PRIV
op_or
id|SRMMU_VALID
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_assign
id|tmp
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|tmp
op_assign
(paren
id|srmmu_hwprobe
c_func
(paren
id|start
)paren
op_amp
id|SRMMU_PTE_PMASK
)paren
op_lshift
l_int|4
suffix:semicolon
multiline_comment|/* Never a cross bank boundary, thank you. */
r_if
c_cond
(paren
id|tmp
op_ne
id|last_page
op_plus
id|PAGE_SIZE
)paren
(brace
r_break
suffix:semicolon
)brace
id|last_page
op_assign
id|tmp
suffix:semicolon
)brace
multiline_comment|/* Ok, that was assumed to be one full bank, begin&n;&t; * construction of srmmu_map[].&n;&t; */
r_for
c_loop
(paren
id|phys_bank
op_assign
l_int|0
suffix:semicolon
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|num_bytes
op_ne
l_int|0
suffix:semicolon
id|phys_bank
op_increment
)paren
(brace
r_if
c_cond
(paren
id|kbpage
op_ge
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|base_addr
op_logical_and
(paren
id|kbpage
OL
(paren
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|base_addr
op_plus
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|num_bytes
)paren
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
multiline_comment|/* found it */
)brace
id|srmmu_bank
op_assign
l_int|0
suffix:semicolon
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|vbase
op_assign
id|KERNBASE
suffix:semicolon
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|pbase
op_assign
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|base_addr
suffix:semicolon
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|size
op_assign
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|num_bytes
suffix:semicolon
r_if
c_cond
(paren
id|kbpage
op_ne
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|base_addr
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Detected PenguinPages, getting out of here.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
macro_line|#if 0
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|pbase
op_assign
id|kbpage
suffix:semicolon
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|size
op_sub_assign
(paren
id|kbpage
op_minus
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|base_addr
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* Prom didn&squot;t map all of this first bank, fill&n;&t; * in the rest by hand.&n;&t; */
r_while
c_loop
(paren
id|start
OL
(paren
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|vbase
op_plus
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|size
)paren
)paren
(brace
r_int
r_int
id|pteval
suffix:semicolon
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_early_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_early_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
id|pteval
op_assign
(paren
id|start
op_minus
id|KERNBASE
op_plus
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|pbase
)paren
op_rshift
l_int|4
suffix:semicolon
id|pteval
op_or_assign
(paren
id|SRMMU_VALID
op_or
id|SRMMU_CACHE
op_or
id|SRMMU_PRIV
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_assign
id|pteval
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
multiline_comment|/* Mark this sp_bank invalid... */
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|base_addr
op_or_assign
l_int|1
suffix:semicolon
id|srmmu_bank
op_increment
suffix:semicolon
multiline_comment|/* Now, deal with what is left. */
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
r_int
r_int
id|baddr
suffix:semicolon
r_int
id|btg
suffix:semicolon
multiline_comment|/* Find a usable cluster of physical ram. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|sp_banks
(braket
id|i
)braket
dot
id|base_addr
op_amp
l_int|1
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
multiline_comment|/* Add it to srmmu_map */
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|vbase
op_assign
id|start
suffix:semicolon
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|pbase
op_assign
id|sp_banks
(braket
id|i
)braket
dot
id|base_addr
suffix:semicolon
id|srmmu_map
(braket
id|srmmu_bank
)braket
dot
id|size
op_assign
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
suffix:semicolon
id|srmmu_bank
op_increment
suffix:semicolon
id|btg
op_assign
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
suffix:semicolon
id|baddr
op_assign
id|sp_banks
(braket
id|i
)braket
dot
id|base_addr
suffix:semicolon
r_while
c_loop
(paren
id|btg
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|start
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_early_pmd_offset
c_func
(paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_early_pte_offset
c_func
(paren
id|pmdp
comma
id|start
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_assign
(paren
id|SRMMU_VALID
op_or
id|SRMMU_CACHE
op_or
id|SRMMU_PRIV
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_or_assign
(paren
id|baddr
op_rshift
l_int|4
)paren
suffix:semicolon
id|baddr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|btg
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|sp_banks
(braket
id|i
)braket
dot
id|base_addr
op_or_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|start
OL
id|end
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;weird, didn&squot;t use all of physical memory... &quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|phys_bank
op_assign
l_int|0
suffix:semicolon
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|num_bytes
op_ne
l_int|0
suffix:semicolon
id|phys_bank
op_increment
)paren
(brace
id|sp_banks
(braket
id|phys_bank
)braket
dot
id|base_addr
op_and_assign
op_complement
l_int|1
suffix:semicolon
)brace
macro_line|#if 0
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|srmmu_map
(braket
id|i
)braket
dot
id|size
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;srmmu_map[%d]: vbase=%08lx pbase=%08lx size=%d&bslash;n&quot;
comma
id|i
comma
id|srmmu_map
(braket
id|i
)braket
dot
id|vbase
comma
id|srmmu_map
(braket
id|i
)braket
dot
id|pbase
comma
id|srmmu_map
(braket
id|i
)braket
dot
id|size
)paren
suffix:semicolon
)brace
id|prom_getchar
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;sp_banks[%d]: base_addr=%08lx num_bytes=%d&bslash;n&quot;
comma
id|i
comma
id|sp_banks
(braket
id|i
)braket
dot
id|base_addr
comma
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
)paren
suffix:semicolon
)brace
id|prom_getchar
c_func
(paren
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* Paging initialization on the Sparc Reference MMU. */
r_extern
r_int
r_int
id|free_area_init
c_func
(paren
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
r_int
id|sparc_context_init
c_func
(paren
r_int
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|physmem_mapped_contig
suffix:semicolon
r_extern
r_int
id|linux_num_cpus
suffix:semicolon
DECL|variable|poke_srmmu
r_void
(paren
op_star
id|poke_srmmu
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|function|srmmu_paging_init
r_int
r_int
id|srmmu_paging_init
c_func
(paren
r_int
r_int
id|start_mem
comma
r_int
r_int
id|end_mem
)paren
(brace
r_int
r_int
id|ptables_start
comma
id|first_mapped_page
suffix:semicolon
r_int
id|i
comma
id|cpunode
suffix:semicolon
r_char
id|node_str
(braket
l_int|128
)braket
suffix:semicolon
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pmd_t
op_star
id|pmdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
id|physmem_mapped_contig
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* for init.c:taint_real_pages() */
macro_line|#if CONFIG_AP1000
id|printk
c_func
(paren
l_string|&quot;Forcing num_contexts to 1024&bslash;n&quot;
)paren
suffix:semicolon
id|num_contexts
op_assign
l_int|1024
suffix:semicolon
macro_line|#else
multiline_comment|/* Find the number of contexts on the srmmu. */
id|cpunode
op_assign
id|prom_getchild
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
id|num_contexts
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cpunode
op_assign
id|prom_getsibling
c_func
(paren
id|cpunode
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|prom_getstring
c_func
(paren
id|cpunode
comma
l_string|&quot;device_type&quot;
comma
id|node_str
comma
r_sizeof
(paren
id|node_str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|node_str
comma
l_string|&quot;cpu&quot;
)paren
)paren
(brace
id|num_contexts
op_assign
id|prom_getintdefault
c_func
(paren
id|cpunode
comma
l_string|&quot;mmu-nctx&quot;
comma
l_int|0x8
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|num_contexts
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Something wrong, cant find cpu node in paging_init.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|ptables_start
op_assign
id|mempool
op_assign
id|PAGE_ALIGN
c_func
(paren
id|start_mem
)paren
suffix:semicolon
id|memset
c_func
(paren
id|swapper_pg_dir
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|first_mapped_page
op_assign
id|KERNBASE
suffix:semicolon
id|kbpage
op_assign
id|srmmu_hwprobe
c_func
(paren
id|KERNBASE
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|kbpage
op_amp
id|SRMMU_ET_MASK
)paren
op_ne
id|SRMMU_ET_PTE
)paren
(brace
id|kbpage
op_assign
id|srmmu_hwprobe
c_func
(paren
id|KERNBASE
op_plus
id|PAGE_SIZE
)paren
suffix:semicolon
id|kbpage
op_assign
(paren
id|kbpage
op_amp
id|SRMMU_PTE_PMASK
)paren
op_lshift
l_int|4
suffix:semicolon
id|kbpage
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
id|first_mapped_page
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_else
id|kbpage
op_assign
(paren
id|kbpage
op_amp
id|SRMMU_PTE_PMASK
)paren
op_lshift
l_int|4
suffix:semicolon
id|srmmu_allocate_ptable_skeleton
c_func
(paren
id|KERNBASE
comma
id|end_mem
)paren
suffix:semicolon
macro_line|#if CONFIG_SUN_IO
id|srmmu_allocate_ptable_skeleton
c_func
(paren
id|IOBASE_VADDR
comma
id|IOBASE_END
)paren
suffix:semicolon
id|srmmu_allocate_ptable_skeleton
c_func
(paren
id|DVMA_VADDR
comma
id|DVMA_END
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Steal DVMA pages now, I still don&squot;t like how we waste all this. */
id|mempool
op_assign
id|PAGE_ALIGN
c_func
(paren
id|mempool
)paren
suffix:semicolon
id|first_dvma_page
op_assign
id|mempool
suffix:semicolon
id|last_dvma_page
op_assign
(paren
id|mempool
op_plus
(paren
id|DVMA_LEN
)paren
op_minus
id|PAGE_SIZE
)paren
suffix:semicolon
id|mempool
op_assign
id|last_dvma_page
op_plus
id|PAGE_SIZE
suffix:semicolon
macro_line|#if CONFIG_AP1000
id|ap_inherit_mappings
c_func
(paren
)paren
suffix:semicolon
macro_line|#else
id|srmmu_inherit_prom_mappings
c_func
(paren
l_int|0xfe400000
comma
(paren
id|LINUX_OPPROM_ENDVM
op_minus
id|PAGE_SIZE
)paren
)paren
suffix:semicolon
macro_line|#endif
id|srmmu_map_kernel
c_func
(paren
id|first_mapped_page
comma
id|end_mem
)paren
suffix:semicolon
macro_line|#if CONFIG_SUN_IO
id|srmmu_map_dvma_pages_for_cpu
c_func
(paren
id|first_dvma_page
comma
id|last_dvma_page
)paren
suffix:semicolon
macro_line|#endif
id|srmmu_context_table
op_assign
id|srmmu_init_alloc
c_func
(paren
op_amp
id|mempool
comma
id|num_contexts
op_star
r_sizeof
(paren
id|ctxd_t
)paren
)paren
suffix:semicolon
id|srmmu_ctx_table_phys
op_assign
(paren
id|ctxd_t
op_star
)paren
id|srmmu_v2p
c_func
(paren
(paren
r_int
r_int
)paren
id|srmmu_context_table
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_contexts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|i
)braket
comma
id|swapper_pg_dir
)paren
suffix:semicolon
)brace
id|start_mem
op_assign
id|PAGE_ALIGN
c_func
(paren
id|mempool
)paren
suffix:semicolon
multiline_comment|/* Some SRMMU&squot;s are _very_ stupid indeed. */
r_if
c_cond
(paren
op_logical_neg
id|can_cache_ptables
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|ptables_start
OL
id|start_mem
suffix:semicolon
id|ptables_start
op_add_assign
id|PAGE_SIZE
)paren
(brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
id|ptables_start
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_early_pmd_offset
c_func
(paren
id|pgdp
comma
id|ptables_start
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_early_pte_offset
c_func
(paren
id|pmdp
comma
id|ptables_start
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_and_assign
op_complement
id|SRMMU_CACHE
suffix:semicolon
)brace
id|pgdp
op_assign
id|srmmu_pgd_offset
c_func
(paren
id|init_task.mm
comma
(paren
r_int
r_int
)paren
id|swapper_pg_dir
)paren
suffix:semicolon
id|pmdp
op_assign
id|srmmu_early_pmd_offset
c_func
(paren
id|pgdp
comma
(paren
r_int
r_int
)paren
id|swapper_pg_dir
)paren
suffix:semicolon
id|ptep
op_assign
id|srmmu_early_pte_offset
c_func
(paren
id|pmdp
comma
(paren
r_int
r_int
)paren
id|swapper_pg_dir
)paren
suffix:semicolon
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_and_assign
op_complement
id|SRMMU_CACHE
suffix:semicolon
)brace
id|flush_cache_all
c_func
(paren
)paren
suffix:semicolon
id|srmmu_set_ctable_ptr
c_func
(paren
(paren
r_int
r_int
)paren
id|srmmu_ctx_table_phys
)paren
suffix:semicolon
id|flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
id|poke_srmmu
c_func
(paren
)paren
suffix:semicolon
id|start_mem
op_assign
id|sparc_context_init
c_func
(paren
id|start_mem
comma
id|num_contexts
)paren
suffix:semicolon
id|start_mem
op_assign
id|free_area_init
c_func
(paren
id|start_mem
comma
id|end_mem
)paren
suffix:semicolon
r_return
id|PAGE_ALIGN
c_func
(paren
id|start_mem
)paren
suffix:semicolon
)brace
DECL|variable|srmmuinfo
r_static
r_char
id|srmmuinfo
(braket
l_int|512
)braket
suffix:semicolon
DECL|function|srmmu_mmu_info
r_static
r_char
op_star
id|srmmu_mmu_info
c_func
(paren
r_void
)paren
(brace
id|sprintf
c_func
(paren
id|srmmuinfo
comma
l_string|&quot;MMU type&bslash;t: %s&bslash;n&quot;
l_string|&quot;invall&bslash;t&bslash;t: %d&bslash;n&quot;
l_string|&quot;invmm&bslash;t&bslash;t: %d&bslash;n&quot;
l_string|&quot;invrnge&bslash;t&bslash;t: %d&bslash;n&quot;
l_string|&quot;invpg&bslash;t&bslash;t: %d&bslash;n&quot;
l_string|&quot;contexts&bslash;t: %d&bslash;n&quot;
l_string|&quot;big_chunks&bslash;t: %d&bslash;n&quot;
l_string|&quot;little_chunks&bslash;t: %d&bslash;n&quot;
comma
id|srmmu_name
comma
id|module_stats.invall
comma
id|module_stats.invmm
comma
id|module_stats.invrnge
comma
id|module_stats.invpg
comma
id|num_contexts
comma
macro_line|#if 0
id|num_big_chunks
comma
id|num_little_chunks
macro_line|#else
l_int|0
comma
l_int|0
macro_line|#endif
)paren
suffix:semicolon
r_return
id|srmmuinfo
suffix:semicolon
)brace
DECL|function|srmmu_update_mmu_cache
r_static
r_void
id|srmmu_update_mmu_cache
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|address
comma
id|pte_t
id|pte
)paren
(brace
)brace
DECL|function|srmmu_exit_hook
r_static
r_void
id|srmmu_exit_hook
c_func
(paren
r_void
)paren
(brace
r_struct
id|ctx_list
op_star
id|ctx_old
suffix:semicolon
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|current-&gt;mm
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
id|flush_cache_mm
c_func
(paren
id|mm
)paren
suffix:semicolon
id|ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|mm-&gt;context
)braket
comma
id|swapper_pg_dir
)paren
suffix:semicolon
id|flush_tlb_mm
c_func
(paren
id|mm
)paren
suffix:semicolon
id|ctx_old
op_assign
id|ctx_list_pool
op_plus
id|mm-&gt;context
suffix:semicolon
id|remove_from_ctx_list
c_func
(paren
id|ctx_old
)paren
suffix:semicolon
id|add_to_free_ctxlist
c_func
(paren
id|ctx_old
)paren
suffix:semicolon
id|mm-&gt;context
op_assign
id|NO_CONTEXT
suffix:semicolon
)brace
)brace
DECL|function|srmmu_flush_hook
r_static
r_void
id|srmmu_flush_hook
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;tss.flags
op_amp
id|SPARC_FLAG_KTHREAD
)paren
(brace
id|alloc_context
c_func
(paren
id|current-&gt;mm
)paren
suffix:semicolon
id|ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|current-&gt;mm-&gt;context
)braket
comma
id|current-&gt;mm-&gt;pgd
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|current-&gt;mm-&gt;context
)paren
suffix:semicolon
)brace
)brace
DECL|function|hypersparc_exit_hook
r_static
r_void
id|hypersparc_exit_hook
c_func
(paren
r_void
)paren
(brace
r_struct
id|ctx_list
op_star
id|ctx_old
suffix:semicolon
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|current-&gt;mm
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
)paren
(brace
multiline_comment|/* HyperSparc is copy-back, any data for this&n;&t;&t; * process in a modified cache line is stale&n;&t;&t; * and must be written back to main memory now&n;&t;&t; * else we eat shit later big time.&n;&t;&t; */
id|flush_cache_mm
c_func
(paren
id|mm
)paren
suffix:semicolon
id|ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|mm-&gt;context
)braket
comma
id|swapper_pg_dir
)paren
suffix:semicolon
id|flush_tlb_mm
c_func
(paren
id|mm
)paren
suffix:semicolon
id|ctx_old
op_assign
id|ctx_list_pool
op_plus
id|mm-&gt;context
suffix:semicolon
id|remove_from_ctx_list
c_func
(paren
id|ctx_old
)paren
suffix:semicolon
id|add_to_free_ctxlist
c_func
(paren
id|ctx_old
)paren
suffix:semicolon
id|mm-&gt;context
op_assign
id|NO_CONTEXT
suffix:semicolon
)brace
)brace
DECL|function|hypersparc_flush_hook
r_static
r_void
id|hypersparc_flush_hook
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;tss.flags
op_amp
id|SPARC_FLAG_KTHREAD
)paren
(brace
id|alloc_context
c_func
(paren
id|current-&gt;mm
)paren
suffix:semicolon
id|flush_cache_mm
c_func
(paren
id|current-&gt;mm
)paren
suffix:semicolon
id|ctxd_set
c_func
(paren
op_amp
id|srmmu_context_table
(braket
id|current-&gt;mm-&gt;context
)braket
comma
id|current-&gt;mm-&gt;pgd
)paren
suffix:semicolon
id|srmmu_set_context
c_func
(paren
id|current-&gt;mm-&gt;context
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Init various srmmu chip types. */
DECL|function|srmmu_is_bad
r_void
id|srmmu_is_bad
c_func
(paren
r_void
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Could not determine SRMMU chip type.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|poke_hypersparc
r_void
id|poke_hypersparc
c_func
(paren
r_void
)paren
(brace
r_volatile
r_int
r_int
id|clear
suffix:semicolon
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
id|hyper_flush_unconditional_combined
c_func
(paren
)paren
suffix:semicolon
id|mreg
op_and_assign
op_complement
(paren
id|HYPERSPARC_CWENABLE
)paren
suffix:semicolon
id|mreg
op_or_assign
(paren
id|HYPERSPARC_CENABLE
op_or
id|HYPERSPARC_WBENABLE
)paren
suffix:semicolon
id|mreg
op_or_assign
(paren
id|HYPERSPARC_CMODE
)paren
suffix:semicolon
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
id|hyper_clear_all_tags
c_func
(paren
)paren
suffix:semicolon
id|put_ross_icr
c_func
(paren
id|HYPERSPARC_ICCR_FTD
op_or
id|HYPERSPARC_ICCR_ICE
)paren
suffix:semicolon
id|hyper_flush_whole_icache
c_func
(paren
)paren
suffix:semicolon
id|clear
op_assign
id|srmmu_get_faddr
c_func
(paren
)paren
suffix:semicolon
id|clear
op_assign
id|srmmu_get_fstatus
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|init_hypersparc
r_void
id|init_hypersparc
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
id|srmmu_name
op_assign
l_string|&quot;ROSS HyperSparc&quot;
suffix:semicolon
id|can_cache_ptables
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mreg
op_amp
id|HYPERSPARC_CSIZE
)paren
(brace
id|hyper_cache_size
op_assign
(paren
l_int|256
op_star
l_int|1024
)paren
suffix:semicolon
id|hyper_line_size
op_assign
l_int|64
suffix:semicolon
)brace
r_else
(brace
id|hyper_cache_size
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
id|hyper_line_size
op_assign
l_int|32
suffix:semicolon
)brace
id|flush_cache_all
op_assign
id|hypersparc_flush_cache_all
suffix:semicolon
id|flush_cache_mm
op_assign
id|hypersparc_flush_cache_mm
suffix:semicolon
id|flush_cache_range
op_assign
id|hypersparc_flush_cache_range
suffix:semicolon
id|flush_cache_page
op_assign
id|hypersparc_flush_cache_page
suffix:semicolon
id|flush_tlb_all
op_assign
id|hypersparc_flush_tlb_all
suffix:semicolon
id|flush_tlb_mm
op_assign
id|hypersparc_flush_tlb_mm
suffix:semicolon
id|flush_tlb_range
op_assign
id|hypersparc_flush_tlb_range
suffix:semicolon
id|flush_tlb_page
op_assign
id|hypersparc_flush_tlb_page
suffix:semicolon
id|flush_page_to_ram
op_assign
id|hypersparc_flush_page_to_ram
suffix:semicolon
id|flush_page_for_dma
op_assign
id|hypersparc_flush_page_for_dma
suffix:semicolon
id|flush_cache_page_to_uncache
op_assign
id|hypersparc_flush_cache_page_to_uncache
suffix:semicolon
id|flush_tlb_page_for_cbit
op_assign
id|hypersparc_flush_tlb_page_for_cbit
suffix:semicolon
id|ctxd_set
op_assign
id|hypersparc_ctxd_set
suffix:semicolon
id|switch_to_context
op_assign
id|hypersparc_switch_to_context
suffix:semicolon
id|mmu_exit_hook
op_assign
id|hypersparc_exit_hook
suffix:semicolon
id|mmu_flush_hook
op_assign
id|hypersparc_flush_hook
suffix:semicolon
id|sparc_update_rootmmu_dir
op_assign
id|hypersparc_update_rootmmu_dir
suffix:semicolon
id|set_pte
op_assign
id|hypersparc_set_pte
suffix:semicolon
id|poke_srmmu
op_assign
id|poke_hypersparc
suffix:semicolon
)brace
DECL|function|poke_cypress
r_void
id|poke_cypress
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
id|mreg
op_and_assign
op_complement
id|CYPRESS_CMODE
suffix:semicolon
id|mreg
op_or_assign
id|CYPRESS_CENABLE
suffix:semicolon
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
)brace
DECL|function|init_cypress_common
r_void
id|init_cypress_common
c_func
(paren
r_void
)paren
(brace
id|can_cache_ptables
op_assign
l_int|0
suffix:semicolon
id|flush_tlb_all
op_assign
id|cypress_flush_tlb_all
suffix:semicolon
id|flush_tlb_mm
op_assign
id|cypress_flush_tlb_mm
suffix:semicolon
id|flush_tlb_page
op_assign
id|cypress_flush_tlb_page
suffix:semicolon
id|flush_tlb_range
op_assign
id|cypress_flush_tlb_range
suffix:semicolon
id|poke_srmmu
op_assign
id|poke_cypress
suffix:semicolon
multiline_comment|/* XXX Need to write cache flushes for this one... XXX */
)brace
DECL|function|init_cypress_604
r_void
id|init_cypress_604
c_func
(paren
r_void
)paren
(brace
id|srmmu_name
op_assign
l_string|&quot;ROSS Cypress-604(UP)&quot;
suffix:semicolon
id|srmmu_modtype
op_assign
id|Cypress
suffix:semicolon
id|init_cypress_common
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|init_cypress_605
r_void
id|init_cypress_605
c_func
(paren
r_int
r_int
id|mrev
)paren
(brace
id|srmmu_name
op_assign
l_string|&quot;ROSS Cypress-605(MP)&quot;
suffix:semicolon
r_if
c_cond
(paren
id|mrev
op_eq
l_int|0xe
)paren
(brace
id|srmmu_modtype
op_assign
id|Cypress_vE
suffix:semicolon
id|hwbug_bitmask
op_or_assign
id|HWBUG_COPYBACK_BROKEN
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|mrev
op_eq
l_int|0xd
)paren
(brace
id|srmmu_modtype
op_assign
id|Cypress_vD
suffix:semicolon
id|hwbug_bitmask
op_or_assign
id|HWBUG_ASIFLUSH_BROKEN
suffix:semicolon
)brace
r_else
(brace
id|srmmu_modtype
op_assign
id|Cypress
suffix:semicolon
)brace
)brace
id|init_cypress_common
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|poke_swift
r_void
id|poke_swift
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Clear any crap from the cache or else... */
id|swift_idflash_clear
c_func
(paren
)paren
suffix:semicolon
id|mreg
op_or_assign
(paren
id|SWIFT_IE
op_or
id|SWIFT_DE
)paren
suffix:semicolon
multiline_comment|/* I &amp; D caches on */
multiline_comment|/* The Swift branch folding logic is completely broken.  At&n;&t; * trap time, if things are just right, if can mistakenly&n;&t; * think that a trap is coming from kernel mode when in fact&n;&t; * it is coming from user mode (it mis-executes the branch in&n;&t; * the trap code).  So you see things like crashme completely&n;&t; * hosing your machine which is completely unacceptable.  Turn&n;&t; * this shit off... nice job Fujitsu.&n;&t; */
id|mreg
op_and_assign
op_complement
(paren
id|SWIFT_BF
)paren
suffix:semicolon
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
)brace
DECL|macro|SWIFT_MASKID_ADDR
mdefine_line|#define SWIFT_MASKID_ADDR  0x10003018
DECL|function|init_swift
r_void
id|init_swift
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|swift_rev
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lda [%1] %2, %0&bslash;n&bslash;t&quot;
l_string|&quot;srl %0, 0x18, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|swift_rev
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|SWIFT_MASKID_ADDR
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_BYPASS
)paren
)paren
suffix:semicolon
id|srmmu_name
op_assign
l_string|&quot;Fujitsu Swift&quot;
suffix:semicolon
r_switch
c_cond
(paren
id|swift_rev
)paren
(brace
r_case
l_int|0x11
suffix:colon
r_case
l_int|0x20
suffix:colon
r_case
l_int|0x23
suffix:colon
r_case
l_int|0x30
suffix:colon
id|srmmu_modtype
op_assign
id|Swift_lots_o_bugs
suffix:semicolon
id|hwbug_bitmask
op_or_assign
(paren
id|HWBUG_KERN_ACCBROKEN
op_or
id|HWBUG_KERN_CBITBROKEN
)paren
suffix:semicolon
multiline_comment|/* Gee george, I wonder why Sun is so hush hush about&n;&t;&t; * this hardware bug... really braindamage stuff going&n;&t;&t; * on here.  However I think we can find a way to avoid&n;&t;&t; * all of the workaround overhead under Linux.  Basically,&n;&t;&t; * any page fault can cause kernel pages to become user&n;&t;&t; * accessible (the mmu gets confused and clears some of&n;&t;&t; * the ACC bits in kernel ptes).  Aha, sounds pretty&n;&t;&t; * horrible eh?  But wait, after extensive testing it appears&n;&t;&t; * that if you use pgd_t level large kernel pte&squot;s (like the&n;&t;&t; * 4MB pages on the Pentium) the bug does not get tripped&n;&t;&t; * at all.  This avoids almost all of the major overhead.&n;&t;&t; * Welcome to a world where your vendor tells you to,&n;&t;&t; * &quot;apply this kernel patch&quot; instead of &quot;sorry for the&n;&t;&t; * broken hardware, send it back and we&squot;ll give you&n;&t;&t; * properly functioning parts&quot;&n;&t;&t; */
r_break
suffix:semicolon
r_case
l_int|0x25
suffix:colon
r_case
l_int|0x31
suffix:colon
id|srmmu_modtype
op_assign
id|Swift_bad_c
suffix:semicolon
id|hwbug_bitmask
op_or_assign
id|HWBUG_KERN_CBITBROKEN
suffix:semicolon
multiline_comment|/* You see Sun allude to this hardware bug but never&n;&t;&t; * admit things directly, they&squot;ll say things like,&n;&t;&t; * &quot;the Swift chip cache problems&quot; or similar.&n;&t;&t; */
r_break
suffix:semicolon
r_default
suffix:colon
id|srmmu_modtype
op_assign
id|Swift_ok
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|flush_cache_all
op_assign
id|swift_flush_cache_all
suffix:semicolon
id|flush_cache_mm
op_assign
id|swift_flush_cache_mm
suffix:semicolon
id|flush_cache_page
op_assign
id|swift_flush_cache_page
suffix:semicolon
id|flush_cache_range
op_assign
id|swift_flush_cache_range
suffix:semicolon
id|flush_tlb_all
op_assign
id|swift_flush_tlb_all
suffix:semicolon
id|flush_tlb_mm
op_assign
id|swift_flush_tlb_mm
suffix:semicolon
id|flush_tlb_page
op_assign
id|swift_flush_tlb_page
suffix:semicolon
id|flush_tlb_range
op_assign
id|swift_flush_tlb_range
suffix:semicolon
id|flush_page_to_ram
op_assign
id|swift_flush_page_to_ram
suffix:semicolon
id|flush_page_for_dma
op_assign
id|swift_flush_page_for_dma
suffix:semicolon
id|flush_cache_page_to_uncache
op_assign
id|swift_flush_cache_page_to_uncache
suffix:semicolon
id|flush_tlb_page_for_cbit
op_assign
id|swift_flush_tlb_page_for_cbit
suffix:semicolon
multiline_comment|/* Are you now convinced that the Swift is one of the&n;&t; * biggest VLSI abortions of all time?  Bravo Fujitsu!&n;&t; * Fujitsu, the !#?!%$&squot;d up processor people.  I bet if&n;&t; * you examined the microcode of the Swift you&squot;d find&n;&t; * XXX&squot;s all over the place.&n;&t; */
id|poke_srmmu
op_assign
id|poke_swift
suffix:semicolon
)brace
DECL|function|poke_tsunami
r_void
id|poke_tsunami
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
id|tsunami_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|tsunami_flush_dcache
c_func
(paren
)paren
suffix:semicolon
id|mreg
op_and_assign
op_complement
id|TSUNAMI_ITD
suffix:semicolon
id|mreg
op_or_assign
(paren
id|TSUNAMI_IENAB
op_or
id|TSUNAMI_DENAB
)paren
suffix:semicolon
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
)brace
DECL|function|init_tsunami
r_void
id|init_tsunami
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Tsunami&squot;s pretty sane, Sun and TI actually got it&n;&t; * somewhat right this time.  Fujitsu should have&n;&t; * taken some lessons from them.&n;&t; */
id|srmmu_name
op_assign
l_string|&quot;TI Tsunami&quot;
suffix:semicolon
id|srmmu_modtype
op_assign
id|Tsunami
suffix:semicolon
id|can_cache_ptables
op_assign
l_int|1
suffix:semicolon
id|flush_cache_all
op_assign
id|tsunami_flush_cache_all
suffix:semicolon
id|flush_cache_mm
op_assign
id|tsunami_flush_cache_mm
suffix:semicolon
id|flush_cache_page
op_assign
id|tsunami_flush_cache_page
suffix:semicolon
id|flush_cache_range
op_assign
id|tsunami_flush_cache_range
suffix:semicolon
id|flush_tlb_all
op_assign
id|tsunami_flush_tlb_all
suffix:semicolon
id|flush_tlb_mm
op_assign
id|tsunami_flush_tlb_mm
suffix:semicolon
id|flush_tlb_page
op_assign
id|tsunami_flush_tlb_page
suffix:semicolon
id|flush_tlb_range
op_assign
id|tsunami_flush_tlb_range
suffix:semicolon
id|flush_page_to_ram
op_assign
id|tsunami_flush_page_to_ram
suffix:semicolon
id|flush_page_for_dma
op_assign
id|tsunami_flush_page_for_dma
suffix:semicolon
id|flush_cache_page_to_uncache
op_assign
id|tsunami_flush_cache_page_to_uncache
suffix:semicolon
id|flush_tlb_page_for_cbit
op_assign
id|tsunami_flush_tlb_page_for_cbit
suffix:semicolon
id|poke_srmmu
op_assign
id|poke_tsunami
suffix:semicolon
)brace
DECL|function|poke_viking
r_void
id|poke_viking
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
r_static
r_int
id|smp_catch
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|viking_mxcc_present
)paren
(brace
r_int
r_int
id|mxcc_control
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;set -1, %%g2&bslash;n&bslash;t&quot;
l_string|&quot;set -1, %%g3&bslash;n&bslash;t&quot;
l_string|&quot;stda %%g2, [%1] %2&bslash;n&bslash;t&quot;
l_string|&quot;lda [%3] %2, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|mxcc_control
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|MXCC_EREG
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_MXCC
)paren
comma
l_string|&quot;r&quot;
(paren
id|MXCC_CREG
)paren
suffix:colon
l_string|&quot;g2&quot;
comma
l_string|&quot;g3&quot;
)paren
suffix:semicolon
id|mxcc_control
op_or_assign
(paren
id|MXCC_CTL_ECE
op_or
id|MXCC_CTL_PRE
op_or
id|MXCC_CTL_MCE
)paren
suffix:semicolon
id|mxcc_control
op_and_assign
op_complement
(paren
id|MXCC_CTL_PARE
op_or
id|MXCC_CTL_RRC
)paren
suffix:semicolon
id|mreg
op_and_assign
op_complement
(paren
id|VIKING_PCENABLE
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %0, [%1] %2&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|mxcc_control
)paren
comma
l_string|&quot;r&quot;
(paren
id|MXCC_CREG
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_M_MXCC
)paren
)paren
suffix:semicolon
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
id|mreg
op_or_assign
id|VIKING_TCENABLE
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|bpreg
suffix:semicolon
id|mreg
op_and_assign
op_complement
(paren
id|VIKING_TCENABLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smp_catch
op_increment
)paren
(brace
multiline_comment|/* Must disable mixed-cmd mode here for&n;&t;&t;&t; * other cpu&squot;s.&n;&t;&t;&t; */
id|bpreg
op_assign
id|viking_get_bpreg
c_func
(paren
)paren
suffix:semicolon
id|bpreg
op_and_assign
op_complement
(paren
id|VIKING_ACTION_MIX
)paren
suffix:semicolon
id|viking_set_bpreg
c_func
(paren
id|bpreg
)paren
suffix:semicolon
multiline_comment|/* Just in case PROM does something funny. */
id|msi_set_sync
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
id|viking_unlock_icache
c_func
(paren
)paren
suffix:semicolon
id|viking_flush_icache
c_func
(paren
)paren
suffix:semicolon
macro_line|#if 0
id|viking_unlock_dcache
c_func
(paren
)paren
suffix:semicolon
id|viking_flush_dcache
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|mreg
op_or_assign
id|VIKING_SPENABLE
suffix:semicolon
id|mreg
op_or_assign
(paren
id|VIKING_ICENABLE
op_or
id|VIKING_DCENABLE
)paren
suffix:semicolon
id|mreg
op_or_assign
id|VIKING_SBENABLE
suffix:semicolon
id|mreg
op_and_assign
op_complement
(paren
id|VIKING_ACENABLE
)paren
suffix:semicolon
macro_line|#if CONFIG_AP1000
id|mreg
op_and_assign
op_complement
(paren
id|VIKING_SBENABLE
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef __SMP__
id|mreg
op_and_assign
op_complement
(paren
id|VIKING_SBENABLE
)paren
suffix:semicolon
macro_line|#endif
id|srmmu_set_mmureg
c_func
(paren
id|mreg
)paren
suffix:semicolon
)brace
DECL|function|init_viking
r_void
id|init_viking
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Ahhh, the viking.  SRMMU VLSI abortion number two... */
r_if
c_cond
(paren
id|mreg
op_amp
id|VIKING_MMODE
)paren
(brace
r_int
r_int
id|bpreg
suffix:semicolon
id|srmmu_name
op_assign
l_string|&quot;TI Viking&quot;
suffix:semicolon
id|viking_mxcc_present
op_assign
l_int|0
suffix:semicolon
id|can_cache_ptables
op_assign
l_int|0
suffix:semicolon
id|bpreg
op_assign
id|viking_get_bpreg
c_func
(paren
)paren
suffix:semicolon
id|bpreg
op_and_assign
op_complement
(paren
id|VIKING_ACTION_MIX
)paren
suffix:semicolon
id|viking_set_bpreg
c_func
(paren
id|bpreg
)paren
suffix:semicolon
id|msi_set_sync
c_func
(paren
)paren
suffix:semicolon
id|flush_cache_page_to_uncache
op_assign
id|viking_no_mxcc_flush_page
suffix:semicolon
)brace
r_else
(brace
id|srmmu_name
op_assign
l_string|&quot;TI Viking/MXCC&quot;
suffix:semicolon
id|viking_mxcc_present
op_assign
l_int|1
suffix:semicolon
id|can_cache_ptables
op_assign
l_int|1
suffix:semicolon
id|flush_cache_page_to_uncache
op_assign
id|viking_mxcc_flush_page
suffix:semicolon
)brace
id|flush_cache_all
op_assign
id|viking_flush_cache_all
suffix:semicolon
id|flush_cache_mm
op_assign
id|viking_flush_cache_mm
suffix:semicolon
id|flush_cache_page
op_assign
id|viking_flush_cache_page
suffix:semicolon
id|flush_cache_range
op_assign
id|viking_flush_cache_range
suffix:semicolon
id|flush_tlb_all
op_assign
id|viking_flush_tlb_all
suffix:semicolon
id|flush_tlb_mm
op_assign
id|viking_flush_tlb_mm
suffix:semicolon
id|flush_tlb_page
op_assign
id|viking_flush_tlb_page
suffix:semicolon
id|flush_tlb_range
op_assign
id|viking_flush_tlb_range
suffix:semicolon
id|flush_page_to_ram
op_assign
id|viking_flush_page_to_ram
suffix:semicolon
id|flush_page_for_dma
op_assign
id|viking_flush_page_for_dma
suffix:semicolon
id|flush_tlb_page_for_cbit
op_assign
id|viking_flush_tlb_page_for_cbit
suffix:semicolon
id|poke_srmmu
op_assign
id|poke_viking
suffix:semicolon
)brace
multiline_comment|/* Probe for the srmmu chip version. */
DECL|function|get_srmmu_type
r_static
r_void
id|get_srmmu_type
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mreg
comma
id|psr
suffix:semicolon
r_int
r_int
id|mod_typ
comma
id|mod_rev
comma
id|psr_typ
comma
id|psr_vers
suffix:semicolon
id|srmmu_modtype
op_assign
id|SRMMU_INVAL_MOD
suffix:semicolon
id|hwbug_bitmask
op_assign
l_int|0
suffix:semicolon
id|mreg
op_assign
id|srmmu_get_mmureg
c_func
(paren
)paren
suffix:semicolon
id|psr
op_assign
id|get_psr
c_func
(paren
)paren
suffix:semicolon
id|mod_typ
op_assign
(paren
id|mreg
op_amp
l_int|0xf0000000
)paren
op_rshift
l_int|28
suffix:semicolon
id|mod_rev
op_assign
(paren
id|mreg
op_amp
l_int|0x0f000000
)paren
op_rshift
l_int|24
suffix:semicolon
id|psr_typ
op_assign
(paren
id|psr
op_rshift
l_int|28
)paren
op_amp
l_int|0xf
suffix:semicolon
id|psr_vers
op_assign
(paren
id|psr
op_rshift
l_int|24
)paren
op_amp
l_int|0xf
suffix:semicolon
multiline_comment|/* First, check for HyperSparc or Cypress. */
r_if
c_cond
(paren
id|mod_typ
op_eq
l_int|1
)paren
(brace
r_switch
c_cond
(paren
id|mod_rev
)paren
(brace
r_case
l_int|7
suffix:colon
multiline_comment|/* UP or MP Hypersparc */
id|init_hypersparc
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* Uniprocessor Cypress */
id|init_cypress_604
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|13
suffix:colon
r_case
l_int|14
suffix:colon
r_case
l_int|15
suffix:colon
multiline_comment|/* MP Cypress mmu/cache-controller */
id|init_cypress_605
c_func
(paren
id|mod_rev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|srmmu_is_bad
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Next check for Fujitsu Swift. */
r_if
c_cond
(paren
id|psr_typ
op_eq
l_int|0
op_logical_and
id|psr_vers
op_eq
l_int|4
)paren
(brace
id|init_swift
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Now the Viking family of srmmu. */
r_if
c_cond
(paren
id|psr_typ
op_eq
l_int|4
op_logical_and
(paren
(paren
id|psr_vers
op_eq
l_int|0
)paren
op_logical_or
(paren
(paren
id|psr_vers
op_eq
l_int|1
)paren
op_logical_and
(paren
id|mod_typ
op_eq
l_int|0
)paren
op_logical_and
(paren
id|mod_rev
op_eq
l_int|0
)paren
)paren
)paren
)paren
(brace
id|init_viking
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Finally the Tsunami. */
r_if
c_cond
(paren
id|psr_typ
op_eq
l_int|4
op_logical_and
id|psr_vers
op_eq
l_int|1
op_logical_and
(paren
id|mod_typ
op_logical_or
id|mod_rev
)paren
)paren
(brace
id|init_tsunami
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Oh well */
id|srmmu_is_bad
c_func
(paren
)paren
suffix:semicolon
)brace
r_extern
r_int
r_int
id|spwin_mmu_patchme
comma
id|fwin_mmu_patchme
comma
id|tsetup_mmu_patchme
comma
id|rtrap_mmu_patchme
suffix:semicolon
r_extern
r_int
r_int
id|spwin_srmmu_stackchk
comma
id|srmmu_fwin_stackchk
comma
id|tsetup_srmmu_stackchk
comma
id|srmmu_rett_stackchk
suffix:semicolon
macro_line|#ifdef __SMP__
r_extern
r_int
r_int
id|rirq_mmu_patchme
comma
id|srmmu_reti_stackchk
suffix:semicolon
macro_line|#endif
r_extern
r_int
r_int
id|srmmu_fault
suffix:semicolon
DECL|macro|PATCH_BRANCH
mdefine_line|#define PATCH_BRANCH(insn, dest) do { &bslash;&n;&t;&t;iaddr = &amp;(insn); &bslash;&n;&t;&t;daddr = &amp;(dest); &bslash;&n;&t;&t;*iaddr = SPARC_BRANCH((unsigned long) daddr, (unsigned long) iaddr); &bslash;&n;        } while(0);
DECL|function|patch_window_trap_handlers
r_static
r_void
id|patch_window_trap_handlers
c_func
(paren
r_void
)paren
(brace
r_int
r_int
op_star
id|iaddr
comma
op_star
id|daddr
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|spwin_mmu_patchme
comma
id|spwin_srmmu_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|fwin_mmu_patchme
comma
id|srmmu_fwin_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|tsetup_mmu_patchme
comma
id|tsetup_srmmu_stackchk
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|rtrap_mmu_patchme
comma
id|srmmu_rett_stackchk
)paren
suffix:semicolon
macro_line|#ifdef __SMP__
id|PATCH_BRANCH
c_func
(paren
id|rirq_mmu_patchme
comma
id|srmmu_reti_stackchk
)paren
suffix:semicolon
macro_line|#endif
id|PATCH_BRANCH
c_func
(paren
id|sparc_ttable
(braket
id|SP_TRAP_TFLT
)braket
dot
id|inst_three
comma
id|srmmu_fault
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|sparc_ttable
(braket
id|SP_TRAP_DFLT
)braket
dot
id|inst_three
comma
id|srmmu_fault
)paren
suffix:semicolon
id|PATCH_BRANCH
c_func
(paren
id|sparc_ttable
(braket
id|SP_TRAP_DACC
)braket
dot
id|inst_three
comma
id|srmmu_fault
)paren
suffix:semicolon
)brace
macro_line|#ifdef __SMP__
multiline_comment|/* Local cross-calls. */
DECL|function|smp_flush_page_for_dma
r_static
r_void
id|smp_flush_page_for_dma
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|xc1
c_func
(paren
(paren
id|smpfunc_t
)paren
id|local_flush_page_for_dma
comma
id|page
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_cache_page_to_uncache
r_static
r_void
id|smp_flush_cache_page_to_uncache
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|xc1
c_func
(paren
(paren
id|smpfunc_t
)paren
id|local_flush_cache_page_to_uncache
comma
id|page
)paren
suffix:semicolon
)brace
DECL|function|smp_flush_tlb_page_for_cbit
r_static
r_void
id|smp_flush_tlb_page_for_cbit
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|xc1
c_func
(paren
(paren
id|smpfunc_t
)paren
id|local_flush_tlb_page_for_cbit
comma
id|page
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Load up routines and constants for sun4m mmu */
DECL|function|ld_mmu_srmmu
r_void
id|ld_mmu_srmmu
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* First the constants */
id|pmd_shift
op_assign
id|SRMMU_PMD_SHIFT
suffix:semicolon
id|pmd_size
op_assign
id|SRMMU_PMD_SIZE
suffix:semicolon
id|pmd_mask
op_assign
id|SRMMU_PMD_MASK
suffix:semicolon
id|pgdir_shift
op_assign
id|SRMMU_PGDIR_SHIFT
suffix:semicolon
id|pgdir_size
op_assign
id|SRMMU_PGDIR_SIZE
suffix:semicolon
id|pgdir_mask
op_assign
id|SRMMU_PGDIR_MASK
suffix:semicolon
id|ptrs_per_pte
op_assign
id|SRMMU_PTRS_PER_PTE
suffix:semicolon
id|ptrs_per_pmd
op_assign
id|SRMMU_PTRS_PER_PMD
suffix:semicolon
id|ptrs_per_pgd
op_assign
id|SRMMU_PTRS_PER_PGD
suffix:semicolon
id|page_none
op_assign
id|SRMMU_PAGE_NONE
suffix:semicolon
id|page_shared
op_assign
id|SRMMU_PAGE_SHARED
suffix:semicolon
id|page_copy
op_assign
id|SRMMU_PAGE_COPY
suffix:semicolon
id|page_readonly
op_assign
id|SRMMU_PAGE_RDONLY
suffix:semicolon
id|page_kernel
op_assign
id|SRMMU_PAGE_KERNEL
suffix:semicolon
id|pg_iobits
op_assign
id|SRMMU_VALID
op_or
id|SRMMU_WRITE
op_or
id|SRMMU_REF
suffix:semicolon
multiline_comment|/* Functions */
id|set_pte
op_assign
id|srmmu_set_pte
suffix:semicolon
id|switch_to_context
op_assign
id|srmmu_switch_to_context
suffix:semicolon
id|pmd_align
op_assign
id|srmmu_pmd_align
suffix:semicolon
id|pgdir_align
op_assign
id|srmmu_pgdir_align
suffix:semicolon
id|vmalloc_start
op_assign
id|srmmu_vmalloc_start
suffix:semicolon
id|pte_page
op_assign
id|srmmu_pte_page
suffix:semicolon
id|pmd_page
op_assign
id|srmmu_pmd_page
suffix:semicolon
id|pgd_page
op_assign
id|srmmu_pgd_page
suffix:semicolon
id|sparc_update_rootmmu_dir
op_assign
id|srmmu_update_rootmmu_dir
suffix:semicolon
id|pte_none
op_assign
id|srmmu_pte_none
suffix:semicolon
id|pte_present
op_assign
id|srmmu_pte_present
suffix:semicolon
id|pte_clear
op_assign
id|srmmu_pte_clear
suffix:semicolon
id|pmd_none
op_assign
id|srmmu_pmd_none
suffix:semicolon
id|pmd_bad
op_assign
id|srmmu_pmd_bad
suffix:semicolon
id|pmd_present
op_assign
id|srmmu_pmd_present
suffix:semicolon
id|pmd_clear
op_assign
id|srmmu_pmd_clear
suffix:semicolon
id|pgd_none
op_assign
id|srmmu_pgd_none
suffix:semicolon
id|pgd_bad
op_assign
id|srmmu_pgd_bad
suffix:semicolon
id|pgd_present
op_assign
id|srmmu_pgd_present
suffix:semicolon
id|pgd_clear
op_assign
id|srmmu_pgd_clear
suffix:semicolon
id|mk_pte
op_assign
id|srmmu_mk_pte
suffix:semicolon
id|pgd_set
op_assign
id|srmmu_pgd_set
suffix:semicolon
id|mk_pte_io
op_assign
id|srmmu_mk_pte_io
suffix:semicolon
id|pte_modify
op_assign
id|srmmu_pte_modify
suffix:semicolon
id|pgd_offset
op_assign
id|srmmu_pgd_offset
suffix:semicolon
id|pmd_offset
op_assign
id|srmmu_pmd_offset
suffix:semicolon
id|pte_offset
op_assign
id|srmmu_pte_offset
suffix:semicolon
id|pte_free_kernel
op_assign
id|srmmu_pte_free_kernel
suffix:semicolon
id|pmd_free_kernel
op_assign
id|srmmu_pmd_free_kernel
suffix:semicolon
id|pte_alloc_kernel
op_assign
id|srmmu_pte_alloc_kernel
suffix:semicolon
id|pmd_alloc_kernel
op_assign
id|srmmu_pmd_alloc_kernel
suffix:semicolon
id|pte_free
op_assign
id|srmmu_pte_free
suffix:semicolon
id|pte_alloc
op_assign
id|srmmu_pte_alloc
suffix:semicolon
id|pmd_free
op_assign
id|srmmu_pmd_free
suffix:semicolon
id|pmd_alloc
op_assign
id|srmmu_pmd_alloc
suffix:semicolon
id|pgd_free
op_assign
id|srmmu_pgd_free
suffix:semicolon
id|pgd_alloc
op_assign
id|srmmu_pgd_alloc
suffix:semicolon
id|pte_write
op_assign
id|srmmu_pte_write
suffix:semicolon
id|pte_dirty
op_assign
id|srmmu_pte_dirty
suffix:semicolon
id|pte_young
op_assign
id|srmmu_pte_young
suffix:semicolon
id|pte_wrprotect
op_assign
id|srmmu_pte_wrprotect
suffix:semicolon
id|pte_mkclean
op_assign
id|srmmu_pte_mkclean
suffix:semicolon
id|pte_mkold
op_assign
id|srmmu_pte_mkold
suffix:semicolon
id|pte_mkwrite
op_assign
id|srmmu_pte_mkwrite
suffix:semicolon
id|pte_mkdirty
op_assign
id|srmmu_pte_mkdirty
suffix:semicolon
id|pte_mkyoung
op_assign
id|srmmu_pte_mkyoung
suffix:semicolon
id|update_mmu_cache
op_assign
id|srmmu_update_mmu_cache
suffix:semicolon
id|mmu_exit_hook
op_assign
id|srmmu_exit_hook
suffix:semicolon
id|mmu_flush_hook
op_assign
id|srmmu_flush_hook
suffix:semicolon
id|mmu_lockarea
op_assign
id|srmmu_lockarea
suffix:semicolon
id|mmu_unlockarea
op_assign
id|srmmu_unlockarea
suffix:semicolon
id|mmu_get_scsi_one
op_assign
id|srmmu_get_scsi_one
suffix:semicolon
id|mmu_get_scsi_sgl
op_assign
id|srmmu_get_scsi_sgl
suffix:semicolon
id|mmu_release_scsi_one
op_assign
id|srmmu_release_scsi_one
suffix:semicolon
id|mmu_release_scsi_sgl
op_assign
id|srmmu_release_scsi_sgl
suffix:semicolon
id|mmu_info
op_assign
id|srmmu_mmu_info
suffix:semicolon
id|mmu_v2p
op_assign
id|srmmu_v2p
suffix:semicolon
id|mmu_p2v
op_assign
id|srmmu_p2v
suffix:semicolon
multiline_comment|/* Task struct and kernel stack allocating/freeing. */
id|alloc_kernel_stack
op_assign
id|srmmu_alloc_kernel_stack
suffix:semicolon
id|alloc_task_struct
op_assign
id|srmmu_alloc_task_struct
suffix:semicolon
id|free_kernel_stack
op_assign
id|srmmu_free_kernel_stack
suffix:semicolon
id|free_task_struct
op_assign
id|srmmu_free_task_struct
suffix:semicolon
id|quick_kernel_fault
op_assign
id|srmmu_quick_kernel_fault
suffix:semicolon
multiline_comment|/* SRMMU specific. */
id|ctxd_set
op_assign
id|srmmu_ctxd_set
suffix:semicolon
id|pmd_set
op_assign
id|srmmu_pmd_set
suffix:semicolon
id|get_srmmu_type
c_func
(paren
)paren
suffix:semicolon
id|patch_window_trap_handlers
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef __SMP__
multiline_comment|/* El switcheroo... */
id|local_flush_cache_all
op_assign
id|flush_cache_all
suffix:semicolon
id|local_flush_cache_mm
op_assign
id|flush_cache_mm
suffix:semicolon
id|local_flush_cache_range
op_assign
id|flush_cache_range
suffix:semicolon
id|local_flush_cache_page
op_assign
id|flush_cache_page
suffix:semicolon
id|local_flush_tlb_all
op_assign
id|flush_tlb_all
suffix:semicolon
id|local_flush_tlb_mm
op_assign
id|flush_tlb_mm
suffix:semicolon
id|local_flush_tlb_range
op_assign
id|flush_tlb_range
suffix:semicolon
id|local_flush_tlb_page
op_assign
id|flush_tlb_page
suffix:semicolon
id|local_flush_page_to_ram
op_assign
id|flush_page_to_ram
suffix:semicolon
id|local_flush_page_for_dma
op_assign
id|flush_page_for_dma
suffix:semicolon
id|local_flush_cache_page_to_uncache
op_assign
id|flush_cache_page_to_uncache
suffix:semicolon
id|local_flush_tlb_page_for_cbit
op_assign
id|flush_tlb_page_for_cbit
suffix:semicolon
id|flush_cache_all
op_assign
id|smp_flush_cache_all
suffix:semicolon
id|flush_cache_mm
op_assign
id|smp_flush_cache_mm
suffix:semicolon
id|flush_cache_range
op_assign
id|smp_flush_cache_range
suffix:semicolon
id|flush_cache_page
op_assign
id|smp_flush_cache_page
suffix:semicolon
id|flush_tlb_all
op_assign
id|smp_flush_tlb_all
suffix:semicolon
id|flush_tlb_mm
op_assign
id|smp_flush_tlb_mm
suffix:semicolon
id|flush_tlb_range
op_assign
id|smp_flush_tlb_range
suffix:semicolon
id|flush_tlb_page
op_assign
id|smp_flush_tlb_page
suffix:semicolon
id|flush_page_to_ram
op_assign
id|smp_flush_page_to_ram
suffix:semicolon
id|flush_page_for_dma
op_assign
id|smp_flush_page_for_dma
suffix:semicolon
id|flush_cache_page_to_uncache
op_assign
id|smp_flush_cache_page_to_uncache
suffix:semicolon
id|flush_tlb_page_for_cbit
op_assign
id|smp_flush_tlb_page_for_cbit
suffix:semicolon
macro_line|#endif
)brace
eof
