multiline_comment|/* vac.c:   Routines for flushing various amount of the Sparc VAC&n;            (virtual address cache).&n;&n;   Copyright (C) 1994 David S. Miller (davem@caip.rutgers.edu)&n;*/
macro_line|#include &lt;asm/vac-ops.h&gt;
multiline_comment|/* Flush all VAC entries for the current context */
r_extern
r_int
id|do_hw_vac_flushes
comma
id|vac_size
comma
id|vac_linesize
suffix:semicolon
r_extern
r_int
id|vac_entries_per_context
comma
id|vac_entries_per_segment
suffix:semicolon
r_extern
r_int
id|vac_entries_per_page
suffix:semicolon
r_void
DECL|function|flush_vac_context
id|flush_vac_context
c_func
(paren
)paren
(brace
r_register
r_int
id|entries_left
comma
id|offset
suffix:semicolon
r_register
r_char
op_star
id|address
suffix:semicolon
id|entries_left
op_assign
id|vac_entries_per_context
suffix:semicolon
id|address
op_assign
(paren
r_char
op_star
)paren
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|do_hw_vac_flushes
)paren
(brace
r_while
c_loop
(paren
id|entries_left
op_decrement
op_ge
l_int|0
)paren
(brace
id|hw_flush_vac_context_entry
c_func
(paren
id|address
)paren
suffix:semicolon
id|address
op_add_assign
l_int|4096
suffix:semicolon
)brace
)brace
r_else
(brace
id|offset
op_assign
id|vac_linesize
suffix:semicolon
r_while
c_loop
(paren
id|entries_left
op_decrement
op_ge
l_int|0
)paren
(brace
id|sw_flush_vac_context_entry
c_func
(paren
id|address
)paren
suffix:semicolon
id|address
op_add_assign
id|offset
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|flush_vac_segment
id|flush_vac_segment
c_func
(paren
r_register
r_int
r_int
id|segment
)paren
(brace
r_register
r_int
id|entries_left
comma
id|offset
suffix:semicolon
r_register
r_char
op_star
id|address
suffix:semicolon
id|entries_left
op_assign
id|vac_entries_per_segment
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sll %0, 18, %1&bslash;n&bslash;t&quot;
l_string|&quot;sra %1, 0x2, %1&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|segment
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|address
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_hw_vac_flushes
)paren
(brace
r_while
c_loop
(paren
id|entries_left
op_decrement
op_ge
l_int|0
)paren
(brace
id|hw_flush_vac_segment_entry
c_func
(paren
id|address
)paren
suffix:semicolon
id|address
op_add_assign
l_int|4096
suffix:semicolon
)brace
)brace
r_else
(brace
id|offset
op_assign
id|vac_linesize
suffix:semicolon
r_while
c_loop
(paren
id|entries_left
op_decrement
op_ge
l_int|0
)paren
(brace
id|sw_flush_vac_segment_entry
c_func
(paren
id|address
)paren
suffix:semicolon
id|address
op_add_assign
id|offset
suffix:semicolon
)brace
)brace
)brace
r_void
DECL|function|flush_vac_page
id|flush_vac_page
c_func
(paren
r_register
r_int
r_int
id|addr
)paren
(brace
r_register
r_int
id|entries_left
comma
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|do_hw_vac_flushes
)paren
(brace
id|hw_flush_vac_page_entry
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
r_else
(brace
id|entries_left
op_assign
id|vac_entries_per_page
suffix:semicolon
id|offset
op_assign
id|vac_linesize
suffix:semicolon
r_while
c_loop
(paren
id|entries_left
op_decrement
op_ge
l_int|0
)paren
(brace
id|sw_flush_vac_page_entry
c_func
(paren
id|addr
)paren
suffix:semicolon
id|addr
op_add_assign
id|offset
suffix:semicolon
)brace
)brace
)brace
eof
