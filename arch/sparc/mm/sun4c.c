multiline_comment|/* $Id: sun4c.c,v 1.135 1996/12/23 05:27:50 davem Exp $&n; * sun4c.c: Doing in software what should be done in hardware.&n; *&n; * Copyright (C) 1996 David S. Miller (davem@caip.rutgers.edu)&n; * Copyright (C) 1996 Eddie C. Dost (ecd@skynet.be)&n; * Copyright (C) 1996 Andrew Tridgell (Andrew.Tridgell@anu.edu.au)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/vaddrs.h&gt;
macro_line|#include &lt;asm/idprom.h&gt;
macro_line|#include &lt;asm/machines.h&gt;
macro_line|#include &lt;asm/memreg.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/auxio.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
r_extern
r_int
id|num_segmaps
comma
id|num_contexts
suffix:semicolon
DECL|macro|SUN4C_KERNEL_BUCKETS
mdefine_line|#define SUN4C_KERNEL_BUCKETS 32
macro_line|#ifndef MAX
DECL|macro|MAX
mdefine_line|#define MAX(a,b) ((a)&lt;(b)?(b):(a))
macro_line|#endif
macro_line|#ifndef MIN
DECL|macro|MIN
mdefine_line|#define MIN(a,b) ((a)&lt;(b)?(a):(b))
macro_line|#endif
DECL|macro|KGPROF_PROFILING
mdefine_line|#define KGPROF_PROFILING 0
macro_line|#if KGPROF_PROFILING
DECL|macro|KGPROF_DEPTH
mdefine_line|#define KGPROF_DEPTH 3 /* this needs to match the code below */
DECL|macro|KGPROF_SIZE
mdefine_line|#define KGPROF_SIZE 100
r_static
r_struct
(brace
DECL|member|addr
r_int
id|addr
(braket
id|KGPROF_DEPTH
)braket
suffix:semicolon
DECL|member|count
r_int
id|count
suffix:semicolon
DECL|variable|kgprof_counters
)brace
id|kgprof_counters
(braket
id|KGPROF_SIZE
)braket
suffix:semicolon
multiline_comment|/* just call this function from whatever function you think needs it then&n;   look at /proc/cpuinfo to see where the function is being called from&n;   and how often. This gives a type of &quot;kernel gprof&quot; */
DECL|macro|NEXT_PROF
mdefine_line|#define NEXT_PROF(prev,lvl) (prev&gt;PAGE_OFFSET?__builtin_return_address(lvl):0)
DECL|function|kgprof_profile
r_static
r_inline
r_void
id|kgprof_profile
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
(braket
id|KGPROF_DEPTH
)braket
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
multiline_comment|/* you can&squot;t use a variable argument to __builtin_return_address() */
id|ret
(braket
l_int|0
)braket
op_assign
(paren
r_int
)paren
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ret
(braket
l_int|1
)braket
op_assign
(paren
r_int
)paren
id|NEXT_PROF
c_func
(paren
id|ret
(braket
l_int|0
)braket
comma
l_int|1
)paren
suffix:semicolon
id|ret
(braket
l_int|2
)braket
op_assign
(paren
r_int
)paren
id|NEXT_PROF
c_func
(paren
id|ret
(braket
l_int|1
)braket
comma
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|KGPROF_SIZE
op_logical_and
id|kgprof_counters
(braket
id|i
)braket
dot
id|addr
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|KGPROF_DEPTH
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|ret
(braket
id|j
)braket
op_ne
id|kgprof_counters
(braket
id|i
)braket
dot
id|addr
(braket
id|j
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
id|KGPROF_DEPTH
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
id|KGPROF_SIZE
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|KGPROF_DEPTH
suffix:semicolon
id|j
op_increment
)paren
id|kgprof_counters
(braket
id|i
)braket
dot
id|addr
(braket
id|j
)braket
op_assign
id|ret
(braket
id|j
)braket
suffix:semicolon
id|kgprof_counters
(braket
id|i
)braket
dot
id|count
op_increment
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* Flushing the cache. */
DECL|variable|sun4c_vacinfo
r_struct
id|sun4c_vac_props
id|sun4c_vacinfo
suffix:semicolon
DECL|variable|ctxflushes
DECL|variable|segflushes
DECL|variable|pageflushes
r_static
r_int
id|ctxflushes
comma
id|segflushes
comma
id|pageflushes
suffix:semicolon
DECL|variable|sun4c_kernel_faults
r_int
r_int
id|sun4c_kernel_faults
suffix:semicolon
multiline_comment|/* convert a virtual address to a physical address and vice&n;   versa. Easy on the 4c */
DECL|function|sun4c_v2p
r_static
r_int
r_int
id|sun4c_v2p
c_func
(paren
r_int
r_int
id|vaddr
)paren
(brace
r_return
id|vaddr
op_minus
id|PAGE_OFFSET
suffix:semicolon
)brace
DECL|function|sun4c_p2v
r_static
r_int
r_int
id|sun4c_p2v
c_func
(paren
r_int
r_int
id|vaddr
)paren
(brace
r_return
id|vaddr
op_plus
id|PAGE_OFFSET
suffix:semicolon
)brace
multiline_comment|/* Invalidate every sun4c cache line tag. */
DECL|function|sun4c_flush_all
r_void
id|sun4c_flush_all
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|begin
comma
id|end
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_vacinfo.on
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;SUN4C: AIEEE, trying to invalidate vac while&quot;
l_string|&quot; it is on.&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear &squot;valid&squot; bit in all cache line tags */
id|begin
op_assign
id|AC_CACHETAGS
suffix:semicolon
id|end
op_assign
(paren
id|AC_CACHETAGS
op_plus
id|sun4c_vacinfo.num_bytes
)paren
suffix:semicolon
r_while
c_loop
(paren
id|begin
OL
id|end
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %%g0, [%0] %1&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|begin
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_CONTROL
)paren
)paren
suffix:semicolon
id|begin
op_add_assign
id|sun4c_vacinfo.linesize
suffix:semicolon
)brace
)brace
multiline_comment|/* Blow the entire current context out of the virtual cache. */
DECL|function|sun4c_flush_context
r_static
r_inline
r_void
id|sun4c_flush_context
c_func
(paren
r_void
)paren
(brace
r_extern
r_int
r_int
id|bcopy
suffix:semicolon
r_int
r_int
id|begin
comma
id|end
comma
id|flags
suffix:semicolon
id|ctxflushes
op_increment
suffix:semicolon
id|begin
op_assign
(paren
(paren
r_int
r_int
)paren
op_amp
id|bcopy
)paren
suffix:semicolon
id|end
op_assign
(paren
id|begin
op_plus
id|sun4c_vacinfo.num_bytes
)paren
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_vacinfo.linesize
op_eq
l_int|32
)paren
(brace
r_while
c_loop
(paren
id|begin
OL
id|end
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
"&quot;"
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x00
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x20
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x40
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x60
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x80
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xa0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xc0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xe0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x100
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x120
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x140
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x160
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x180
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x1a0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x1c0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x1e0
)braket
comma
op_mod
op_mod
id|g0
l_string|&quot; : : &quot;
id|r
"&quot;"
(paren
id|begin
)paren
)paren
suffix:semicolon
id|begin
op_add_assign
l_int|512
suffix:semicolon
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
id|begin
OL
id|end
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
"&quot;"
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x00
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x10
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x20
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x30
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x40
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x50
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x60
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x70
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x80
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x90
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xa0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xb0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xc0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xd0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xe0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xf0
)braket
comma
op_mod
op_mod
id|g0
l_string|&quot; : : &quot;
id|r
"&quot;"
(paren
id|begin
)paren
)paren
suffix:semicolon
id|begin
op_add_assign
l_int|256
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Scrape the segment starting at ADDR from the virtual cache. */
DECL|function|sun4c_flush_segment
r_static
r_inline
r_void
id|sun4c_flush_segment
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|segflushes
op_increment
suffix:semicolon
id|addr
op_and_assign
id|SUN4C_REAL_PGDIR_MASK
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_get_segmap
c_func
(paren
id|addr
)paren
op_eq
id|invalid_segment
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sun4c_vacinfo.do_hwflushes
)paren
(brace
r_int
r_int
id|end
op_assign
(paren
id|addr
op_plus
id|sun4c_vacinfo.num_bytes
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|addr
OL
id|end
suffix:semicolon
id|addr
op_add_assign
id|PAGE_SIZE
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %%g0, [%0] %1&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_HWFLUSHSEG
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_int
r_int
id|nbytes
op_assign
id|sun4c_vacinfo.num_bytes
suffix:semicolon
r_int
r_int
id|lsize
op_assign
id|sun4c_vacinfo.linesize
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;add&t;%2, %2, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%g1, %%g2&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%g2, %%g3&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%g3, %%g4&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%g4, %%g5&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%g5, %%o4&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%o4, %%o5&bslash;n&quot;
l_string|&quot;1:&bslash;n&bslash;t&quot;
l_string|&quot;subcc&t;%1, %%o5, %1&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %2] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%g1] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%g2] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%g3] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%g4] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%g5] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%o4] %6&bslash;n&bslash;t&quot;
l_string|&quot;bg&t;1b&bslash;n&bslash;t&quot;
l_string|&quot; add&t;%0, %%o5, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;=&amp;r&quot;
(paren
id|nbytes
)paren
comma
l_string|&quot;=&amp;r&quot;
(paren
id|lsize
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|addr
)paren
comma
l_string|&quot;1&quot;
(paren
id|nbytes
)paren
comma
l_string|&quot;2&quot;
(paren
id|lsize
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_FLUSHSEG
)paren
suffix:colon
l_string|&quot;g1&quot;
comma
l_string|&quot;g2&quot;
comma
l_string|&quot;g3&quot;
comma
l_string|&quot;g4&quot;
comma
l_string|&quot;g5&quot;
comma
l_string|&quot;o4&quot;
comma
l_string|&quot;o5&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Bolix one page from the virtual cache. */
DECL|function|sun4c_flush_page
r_static
r_inline
r_void
id|sun4c_flush_page
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|addr
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sun4c_get_pte
c_func
(paren
id|addr
)paren
op_amp
(paren
id|_SUN4C_PAGE_NOCACHE
op_or
id|_SUN4C_PAGE_VALID
)paren
)paren
op_ne
id|_SUN4C_PAGE_VALID
)paren
(brace
r_return
suffix:semicolon
)brace
id|pageflushes
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_vacinfo.do_hwflushes
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sta %%g0, [%0] %1&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_HWFLUSHPAGE
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|left
op_assign
id|PAGE_SIZE
suffix:semicolon
r_int
r_int
id|lsize
op_assign
id|sun4c_vacinfo.linesize
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;add&t;%2, %2, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%g1, %%g2&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%g2, %%g3&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%g3, %%g4&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%g4, %%g5&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%g5, %%o4&bslash;n&bslash;t&quot;
l_string|&quot;add&t;%2, %%o4, %%o5&bslash;n&quot;
l_string|&quot;1:&bslash;n&bslash;t&quot;
l_string|&quot;subcc&t;%1, %%o5, %1&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %2] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%g1] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%g2] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%g3] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%g4] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%g5] %6&bslash;n&bslash;t&quot;
l_string|&quot;sta&t;%%g0, [%0 + %%o4] %6&bslash;n&bslash;t&quot;
l_string|&quot;bg&t;1b&bslash;n&bslash;t&quot;
l_string|&quot; add&t;%0, %%o5, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;=&amp;r&quot;
(paren
id|left
)paren
comma
l_string|&quot;=&amp;r&quot;
(paren
id|lsize
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|addr
)paren
comma
l_string|&quot;1&quot;
(paren
id|left
)paren
comma
l_string|&quot;2&quot;
(paren
id|lsize
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_FLUSHPG
)paren
suffix:colon
l_string|&quot;g1&quot;
comma
l_string|&quot;g2&quot;
comma
l_string|&quot;g3&quot;
comma
l_string|&quot;g4&quot;
comma
l_string|&quot;g5&quot;
comma
l_string|&quot;o4&quot;
comma
l_string|&quot;o5&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* The sun4c&squot;s do have an on chip store buffer.  And the way you&n; * clear them out isn&squot;t so obvious.  The only way I can think of&n; * to accomplish this is to read the current context register,&n; * store the same value there, then read an external hardware&n; * register.&n; */
DECL|function|sun4c_complete_all_stores
r_void
id|sun4c_complete_all_stores
c_func
(paren
r_void
)paren
(brace
r_volatile
r_int
id|_unused
suffix:semicolon
id|_unused
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|_unused
)paren
suffix:semicolon
id|_unused
op_assign
op_star
id|AUXREG
suffix:semicolon
)brace
multiline_comment|/* Bootup utility functions. */
DECL|function|sun4c_init_clean_segmap
r_static
r_inline
r_void
id|sun4c_init_clean_segmap
c_func
(paren
r_int
r_char
id|pseg
)paren
(brace
r_int
r_int
id|vaddr
suffix:semicolon
id|sun4c_put_segmap
c_func
(paren
l_int|0
comma
id|pseg
)paren
suffix:semicolon
r_for
c_loop
(paren
id|vaddr
op_assign
l_int|0
suffix:semicolon
id|vaddr
OL
id|SUN4C_REAL_PGDIR_SIZE
suffix:semicolon
id|vaddr
op_add_assign
id|PAGE_SIZE
)paren
(brace
id|sun4c_put_pte
c_func
(paren
id|vaddr
comma
l_int|0
)paren
suffix:semicolon
)brace
id|sun4c_put_segmap
c_func
(paren
l_int|0
comma
id|invalid_segment
)paren
suffix:semicolon
)brace
DECL|function|sun4c_init_clean_mmu
r_static
r_inline
r_void
id|sun4c_init_clean_mmu
c_func
(paren
r_int
r_int
id|kernel_end
)paren
(brace
r_int
r_int
id|vaddr
suffix:semicolon
r_int
r_char
id|savectx
comma
id|ctx
suffix:semicolon
id|savectx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|kernel_end
op_assign
id|SUN4C_REAL_PGDIR_ALIGN
c_func
(paren
id|kernel_end
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ctx
op_assign
l_int|0
suffix:semicolon
id|ctx
OL
id|num_contexts
suffix:semicolon
id|ctx
op_increment
)paren
(brace
id|sun4c_set_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
r_for
c_loop
(paren
id|vaddr
op_assign
l_int|0
suffix:semicolon
id|vaddr
OL
l_int|0x20000000
suffix:semicolon
id|vaddr
op_add_assign
id|SUN4C_REAL_PGDIR_SIZE
)paren
(brace
id|sun4c_put_segmap
c_func
(paren
id|vaddr
comma
id|invalid_segment
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|vaddr
op_assign
l_int|0xe0000000
suffix:semicolon
id|vaddr
OL
id|KERNBASE
suffix:semicolon
id|vaddr
op_add_assign
id|SUN4C_REAL_PGDIR_SIZE
)paren
(brace
id|sun4c_put_segmap
c_func
(paren
id|vaddr
comma
id|invalid_segment
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|vaddr
op_assign
id|kernel_end
suffix:semicolon
id|vaddr
OL
id|KADB_DEBUGGER_BEGVM
suffix:semicolon
id|vaddr
op_add_assign
id|SUN4C_REAL_PGDIR_SIZE
)paren
(brace
id|sun4c_put_segmap
c_func
(paren
id|vaddr
comma
id|invalid_segment
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|vaddr
op_assign
id|LINUX_OPPROM_ENDVM
suffix:semicolon
id|vaddr
suffix:semicolon
id|vaddr
op_add_assign
id|SUN4C_REAL_PGDIR_SIZE
)paren
(brace
id|sun4c_put_segmap
c_func
(paren
id|vaddr
comma
id|invalid_segment
)paren
suffix:semicolon
)brace
)brace
id|sun4c_set_context
c_func
(paren
id|savectx
)paren
suffix:semicolon
)brace
DECL|function|sun4c_probe_vac
r_void
id|sun4c_probe_vac
c_func
(paren
r_void
)paren
(brace
id|sun4c_disable_vac
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|idprom-&gt;id_machtype
op_eq
(paren
id|SM_SUN4C
op_or
id|SM_4C_SS1
)paren
)paren
op_logical_or
(paren
id|idprom-&gt;id_machtype
op_eq
(paren
id|SM_SUN4C
op_or
id|SM_4C_SS1PLUS
)paren
)paren
)paren
(brace
multiline_comment|/* PROM on SS1 lacks this info, to be super safe we&n;&t;&t; * hard code it here since this arch is cast in stone.&n;&t;&t; */
id|sun4c_vacinfo.num_bytes
op_assign
l_int|65536
suffix:semicolon
id|sun4c_vacinfo.linesize
op_assign
l_int|16
suffix:semicolon
)brace
r_else
(brace
id|sun4c_vacinfo.num_bytes
op_assign
id|prom_getintdefault
c_func
(paren
id|prom_root_node
comma
l_string|&quot;vac-size&quot;
comma
l_int|65536
)paren
suffix:semicolon
id|sun4c_vacinfo.linesize
op_assign
id|prom_getintdefault
c_func
(paren
id|prom_root_node
comma
l_string|&quot;vac-linesize&quot;
comma
l_int|16
)paren
suffix:semicolon
)brace
id|sun4c_vacinfo.num_lines
op_assign
(paren
id|sun4c_vacinfo.num_bytes
op_div
id|sun4c_vacinfo.linesize
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sun4c_vacinfo.linesize
)paren
(brace
r_case
l_int|16
suffix:colon
id|sun4c_vacinfo.log2lsize
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|sun4c_vacinfo.log2lsize
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|prom_printf
c_func
(paren
l_string|&quot;probe_vac: Didn&squot;t expect vac-linesize of %d, halting&bslash;n&quot;
comma
id|sun4c_vacinfo.linesize
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
suffix:semicolon
id|sun4c_vacinfo.do_hwflushes
op_assign
id|prom_getintdefault
c_func
(paren
id|prom_root_node
comma
l_string|&quot;vac-hwflush&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_vacinfo.do_hwflushes
op_eq
l_int|0
)paren
(brace
id|sun4c_vacinfo.do_hwflushes
op_assign
id|prom_getintdefault
c_func
(paren
id|prom_root_node
comma
l_string|&quot;vac_hwflush&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sun4c_vacinfo.num_bytes
op_ne
l_int|65536
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;WEIRD Sun4C VAC cache size, tell davem&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|sun4c_flush_all
c_func
(paren
)paren
suffix:semicolon
id|sun4c_enable_vac
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Patch instructions for the low level kernel fault handler. */
r_extern
r_int
r_int
id|invalid_segment_patch1
comma
id|invalid_segment_patch1_ff
suffix:semicolon
r_extern
r_int
r_int
id|invalid_segment_patch2
comma
id|invalid_segment_patch2_ff
suffix:semicolon
r_extern
r_int
r_int
id|num_context_patch1
comma
id|num_context_patch1_16
suffix:semicolon
r_extern
r_int
r_int
id|num_context_patch2
comma
id|num_context_patch2_16
suffix:semicolon
r_extern
r_int
r_int
id|vac_linesize_patch
comma
id|vac_linesize_patch_32
suffix:semicolon
r_extern
r_int
r_int
id|vac_hwflush_patch1
comma
id|vac_hwflush_patch1_on
suffix:semicolon
r_extern
r_int
r_int
id|vac_hwflush_patch2
comma
id|vac_hwflush_patch2_on
suffix:semicolon
DECL|macro|PATCH_INSN
mdefine_line|#define PATCH_INSN(src, dst) do {&t;&bslash;&n;&t;&t;daddr = &amp;(dst);&t;&t;&bslash;&n;&t;&t;iaddr = &amp;(src);&t;&t;&bslash;&n;&t;&t;*daddr = *iaddr;&t;&bslash;&n;&t;} while (0);
DECL|function|patch_kernel_fault_handler
r_static
r_void
id|patch_kernel_fault_handler
c_func
(paren
r_void
)paren
(brace
r_int
r_int
op_star
id|iaddr
comma
op_star
id|daddr
suffix:semicolon
r_switch
c_cond
(paren
id|num_segmaps
)paren
(brace
r_case
l_int|128
suffix:colon
multiline_comment|/* Default, nothing to do. */
r_break
suffix:semicolon
r_case
l_int|256
suffix:colon
id|PATCH_INSN
c_func
(paren
id|invalid_segment_patch1_ff
comma
id|invalid_segment_patch1
)paren
suffix:semicolon
id|PATCH_INSN
c_func
(paren
id|invalid_segment_patch2_ff
comma
id|invalid_segment_patch2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|prom_printf
c_func
(paren
l_string|&quot;Unhandled number of segmaps: %d&bslash;n&quot;
comma
id|num_segmaps
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|num_contexts
)paren
(brace
r_case
l_int|8
suffix:colon
multiline_comment|/* Default, nothing to do. */
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|PATCH_INSN
c_func
(paren
id|num_context_patch1_16
comma
id|num_context_patch1
)paren
suffix:semicolon
id|PATCH_INSN
c_func
(paren
id|num_context_patch2_16
comma
id|num_context_patch2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|prom_printf
c_func
(paren
l_string|&quot;Unhandled number of contexts: %d&bslash;n&quot;
comma
id|num_contexts
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sun4c_vacinfo.do_hwflushes
op_ne
l_int|0
)paren
(brace
id|PATCH_INSN
c_func
(paren
id|vac_hwflush_patch1_on
comma
id|vac_hwflush_patch1
)paren
suffix:semicolon
id|PATCH_INSN
c_func
(paren
id|vac_hwflush_patch2_on
comma
id|vac_hwflush_patch2
)paren
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|sun4c_vacinfo.linesize
)paren
(brace
r_case
l_int|16
suffix:colon
multiline_comment|/* Default, nothing to do. */
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|PATCH_INSN
c_func
(paren
id|vac_linesize_patch_32
comma
id|vac_linesize_patch
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|prom_printf
c_func
(paren
l_string|&quot;Impossible VAC linesize %d, halting...&bslash;n&quot;
comma
id|sun4c_vacinfo.linesize
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
suffix:semicolon
)brace
)brace
DECL|function|sun4c_probe_mmu
r_static
r_void
id|sun4c_probe_mmu
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
(paren
id|idprom-&gt;id_machtype
op_eq
(paren
id|SM_SUN4C
op_or
id|SM_4C_SS1
)paren
)paren
op_logical_or
(paren
id|idprom-&gt;id_machtype
op_eq
(paren
id|SM_SUN4C
op_or
id|SM_4C_SS1PLUS
)paren
)paren
)paren
(brace
multiline_comment|/* Hardcode these just to be safe, PROM on SS1 does&n;&t;&t; * not have this info available in the root node.&n;&t;&t; */
id|num_segmaps
op_assign
l_int|128
suffix:semicolon
id|num_contexts
op_assign
l_int|8
suffix:semicolon
)brace
r_else
(brace
id|num_segmaps
op_assign
id|prom_getintdefault
c_func
(paren
id|prom_root_node
comma
l_string|&quot;mmu-npmg&quot;
comma
l_int|128
)paren
suffix:semicolon
id|num_contexts
op_assign
id|prom_getintdefault
c_func
(paren
id|prom_root_node
comma
l_string|&quot;mmu-nctx&quot;
comma
l_int|0x8
)paren
suffix:semicolon
)brace
id|patch_kernel_fault_handler
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|sun4c_memerr_reg
r_volatile
r_int
r_int
op_star
id|sun4c_memerr_reg
op_assign
l_int|0
suffix:semicolon
DECL|function|sun4c_probe_memerr_reg
r_void
id|sun4c_probe_memerr_reg
c_func
(paren
r_void
)paren
(brace
r_int
id|node
suffix:semicolon
r_struct
id|linux_prom_registers
id|regs
(braket
l_int|1
)braket
suffix:semicolon
id|node
op_assign
id|prom_getchild
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
id|node
op_assign
id|prom_searchsiblings
c_func
(paren
id|prom_root_node
comma
l_string|&quot;memory-error&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|node
)paren
r_return
suffix:semicolon
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;reg&quot;
comma
(paren
r_char
op_star
)paren
id|regs
comma
r_sizeof
(paren
id|regs
)paren
)paren
suffix:semicolon
id|sun4c_memerr_reg
op_assign
id|sparc_alloc_io
c_func
(paren
id|regs
(braket
l_int|0
)braket
dot
id|phys_addr
comma
l_int|0
comma
id|regs
(braket
l_int|0
)braket
dot
id|reg_size
comma
l_string|&quot;memory parity error&quot;
comma
id|regs
(braket
l_int|0
)braket
dot
id|which_io
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sun4c_init_ss2_cache_bug
r_static
r_inline
r_void
id|sun4c_init_ss2_cache_bug
c_func
(paren
r_void
)paren
(brace
r_extern
r_int
r_int
id|start
suffix:semicolon
r_if
c_cond
(paren
(paren
id|idprom-&gt;id_machtype
op_eq
(paren
id|SM_SUN4C
op_or
id|SM_4C_SS2
)paren
)paren
op_logical_or
(paren
id|idprom-&gt;id_machtype
op_eq
(paren
id|SM_SUN4C
op_or
id|SM_4C_IPX
)paren
)paren
op_logical_or
(paren
id|idprom-&gt;id_machtype
op_eq
(paren
id|SM_SUN4C
op_or
id|SM_4C_ELC
)paren
)paren
)paren
(brace
multiline_comment|/* Whee.. */
id|printk
c_func
(paren
l_string|&quot;SS2 cache bug detected, uncaching trap table page&bslash;n&quot;
)paren
suffix:semicolon
id|sun4c_flush_page
c_func
(paren
(paren
r_int
r_int
)paren
op_amp
id|start
)paren
suffix:semicolon
id|sun4c_put_pte
c_func
(paren
(paren
(paren
r_int
r_int
)paren
op_amp
id|start
)paren
comma
(paren
id|sun4c_get_pte
c_func
(paren
(paren
r_int
r_int
)paren
op_amp
id|start
)paren
op_or
id|_SUN4C_PAGE_NOCACHE
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Addr is always aligned on a page boundry for us already. */
DECL|function|sun4c_map_dma_area
r_static
r_void
id|sun4c_map_dma_area
c_func
(paren
r_int
r_int
id|addr
comma
r_int
id|len
)paren
(brace
r_int
r_int
id|page
comma
id|end
suffix:semicolon
id|end
op_assign
id|PAGE_ALIGN
c_func
(paren
(paren
id|addr
op_plus
id|len
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|addr
OL
id|end
)paren
(brace
id|page
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;alloc_dvma: Cannot get a dvma page&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|sun4c_flush_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|page
op_sub_assign
id|PAGE_OFFSET
suffix:semicolon
id|page
op_rshift_assign
id|PAGE_SHIFT
suffix:semicolon
id|page
op_or_assign
(paren
id|_SUN4C_PAGE_VALID
op_or
id|_SUN4C_PAGE_DIRTY
op_or
id|_SUN4C_PAGE_NOCACHE
op_or
id|_SUN4C_PAGE_PRIV
)paren
suffix:semicolon
id|sun4c_put_pte
c_func
(paren
id|addr
comma
id|page
)paren
suffix:semicolon
id|addr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
multiline_comment|/* TLB management. */
multiline_comment|/* Don&squot;t change this struct without changing entry.S. This is used&n; * in the in-window kernel fault handler, and you don&squot;t want to mess&n; * with that. (See sun4c_fault in entry.S).&n; */
DECL|struct|sun4c_mmu_entry
r_struct
id|sun4c_mmu_entry
(brace
DECL|member|next
r_struct
id|sun4c_mmu_entry
op_star
id|next
suffix:semicolon
DECL|member|prev
r_struct
id|sun4c_mmu_entry
op_star
id|prev
suffix:semicolon
DECL|member|vaddr
r_int
r_int
id|vaddr
suffix:semicolon
DECL|member|pseg
r_int
r_char
id|pseg
suffix:semicolon
DECL|member|locked
r_int
r_char
id|locked
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|mmu_entry_pool
r_static
r_struct
id|sun4c_mmu_entry
id|mmu_entry_pool
(braket
l_int|256
)braket
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|sun4c_init_mmu_entry_pool
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|pseg
op_assign
id|i
suffix:semicolon
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|next
op_assign
l_int|0
suffix:semicolon
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|prev
op_assign
l_int|0
suffix:semicolon
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|vaddr
op_assign
l_int|0
suffix:semicolon
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|locked
op_assign
l_int|0
suffix:semicolon
)brace
id|mmu_entry_pool
(braket
id|invalid_segment
)braket
dot
id|locked
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|fix_permissions
r_static
r_inline
r_void
id|fix_permissions
c_func
(paren
r_int
r_int
id|vaddr
comma
r_int
r_int
id|bits_on
comma
r_int
r_int
id|bits_off
)paren
(brace
r_int
r_int
id|start
comma
id|end
suffix:semicolon
id|end
op_assign
id|vaddr
op_plus
id|SUN4C_REAL_PGDIR_SIZE
suffix:semicolon
r_for
c_loop
(paren
id|start
op_assign
id|vaddr
suffix:semicolon
id|start
OL
id|end
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
)paren
r_if
c_cond
(paren
id|sun4c_get_pte
c_func
(paren
id|start
)paren
op_amp
id|_SUN4C_PAGE_VALID
)paren
(brace
id|sun4c_put_pte
c_func
(paren
id|start
comma
(paren
id|sun4c_get_pte
c_func
(paren
id|start
)paren
op_or
id|bits_on
)paren
op_amp
op_complement
id|bits_off
)paren
suffix:semicolon
)brace
)brace
DECL|function|sun4c_init_map_kernelprom
r_static
r_inline
r_void
id|sun4c_init_map_kernelprom
c_func
(paren
r_int
r_int
id|kernel_end
)paren
(brace
r_int
r_int
id|vaddr
suffix:semicolon
r_int
r_char
id|pseg
comma
id|ctx
suffix:semicolon
r_for
c_loop
(paren
id|vaddr
op_assign
id|KADB_DEBUGGER_BEGVM
suffix:semicolon
id|vaddr
OL
id|LINUX_OPPROM_ENDVM
suffix:semicolon
id|vaddr
op_add_assign
id|SUN4C_REAL_PGDIR_SIZE
)paren
(brace
id|pseg
op_assign
id|sun4c_get_segmap
c_func
(paren
id|vaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pseg
op_ne
id|invalid_segment
)paren
(brace
id|mmu_entry_pool
(braket
id|pseg
)braket
dot
id|locked
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|ctx
op_assign
l_int|0
suffix:semicolon
id|ctx
OL
id|num_contexts
suffix:semicolon
id|ctx
op_increment
)paren
(brace
id|prom_putsegment
c_func
(paren
id|ctx
comma
id|vaddr
comma
id|pseg
)paren
suffix:semicolon
)brace
id|fix_permissions
c_func
(paren
id|vaddr
comma
id|_SUN4C_PAGE_PRIV
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|vaddr
op_assign
id|KERNBASE
suffix:semicolon
id|vaddr
OL
id|kernel_end
suffix:semicolon
id|vaddr
op_add_assign
id|SUN4C_REAL_PGDIR_SIZE
)paren
(brace
id|pseg
op_assign
id|sun4c_get_segmap
c_func
(paren
id|vaddr
)paren
suffix:semicolon
id|mmu_entry_pool
(braket
id|pseg
)braket
dot
id|locked
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|ctx
op_assign
l_int|0
suffix:semicolon
id|ctx
OL
id|num_contexts
suffix:semicolon
id|ctx
op_increment
)paren
(brace
id|prom_putsegment
c_func
(paren
id|ctx
comma
id|vaddr
comma
id|pseg
)paren
suffix:semicolon
)brace
id|fix_permissions
c_func
(paren
id|vaddr
comma
id|_SUN4C_PAGE_PRIV
comma
id|_SUN4C_PAGE_NOCACHE
)paren
suffix:semicolon
)brace
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|sun4c_init_lock_area
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
)paren
(brace
r_int
id|i
comma
id|ctx
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|invalid_segment
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|locked
)paren
(brace
r_break
suffix:semicolon
)brace
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|locked
op_assign
l_int|1
suffix:semicolon
id|sun4c_init_clean_segmap
c_func
(paren
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ctx
op_assign
l_int|0
suffix:semicolon
id|ctx
OL
id|num_contexts
suffix:semicolon
id|ctx
op_increment
)paren
(brace
id|prom_putsegment
c_func
(paren
id|ctx
comma
id|start
comma
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|pseg
)paren
suffix:semicolon
)brace
id|start
op_add_assign
id|SUN4C_REAL_PGDIR_SIZE
suffix:semicolon
)brace
)brace
multiline_comment|/* Don&squot;t change this struct without changing entry.S. This is used&n; * in the in-window kernel fault handler, and you don&squot;t want to mess&n; * with that. (See sun4c_fault in entry.S).&n; */
DECL|struct|sun4c_mmu_ring
r_struct
id|sun4c_mmu_ring
(brace
DECL|member|ringhd
r_struct
id|sun4c_mmu_entry
id|ringhd
suffix:semicolon
DECL|member|num_entries
r_int
id|num_entries
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|sun4c_context_ring
r_static
r_struct
id|sun4c_mmu_ring
id|sun4c_context_ring
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* used user entries */
DECL|variable|sun4c_ufree_ring
r_static
r_struct
id|sun4c_mmu_ring
id|sun4c_ufree_ring
suffix:semicolon
multiline_comment|/* free user entries */
DECL|variable|sun4c_kernel_ring
r_struct
id|sun4c_mmu_ring
id|sun4c_kernel_ring
suffix:semicolon
multiline_comment|/* used kernel entries */
DECL|variable|sun4c_kfree_ring
r_struct
id|sun4c_mmu_ring
id|sun4c_kfree_ring
suffix:semicolon
multiline_comment|/* free kernel entries */
DECL|function|sun4c_init_rings
r_static
r_inline
r_void
id|sun4c_init_rings
c_func
(paren
r_int
r_int
op_star
id|mempool
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sun4c_context_ring
(braket
id|i
)braket
dot
id|ringhd.next
op_assign
id|sun4c_context_ring
(braket
id|i
)braket
dot
id|ringhd.prev
op_assign
op_amp
id|sun4c_context_ring
(braket
id|i
)braket
dot
id|ringhd
suffix:semicolon
id|sun4c_context_ring
(braket
id|i
)braket
dot
id|num_entries
op_assign
l_int|0
suffix:semicolon
)brace
id|sun4c_ufree_ring.ringhd.next
op_assign
id|sun4c_ufree_ring.ringhd.prev
op_assign
op_amp
id|sun4c_ufree_ring.ringhd
suffix:semicolon
id|sun4c_ufree_ring.num_entries
op_assign
l_int|0
suffix:semicolon
id|sun4c_kernel_ring.ringhd.next
op_assign
id|sun4c_kernel_ring.ringhd.prev
op_assign
op_amp
id|sun4c_kernel_ring.ringhd
suffix:semicolon
id|sun4c_kernel_ring.num_entries
op_assign
l_int|0
suffix:semicolon
id|sun4c_kfree_ring.ringhd.next
op_assign
id|sun4c_kfree_ring.ringhd.prev
op_assign
op_amp
id|sun4c_kfree_ring.ringhd
suffix:semicolon
id|sun4c_kfree_ring.num_entries
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|add_ring
r_static
r_inline
r_void
id|add_ring
c_func
(paren
r_struct
id|sun4c_mmu_ring
op_star
id|ring
comma
r_struct
id|sun4c_mmu_entry
op_star
id|entry
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|head
op_assign
op_amp
id|ring-&gt;ringhd
suffix:semicolon
id|entry-&gt;prev
op_assign
id|head
suffix:semicolon
(paren
id|entry-&gt;next
op_assign
id|head-&gt;next
)paren
op_member_access_from_pointer
id|prev
op_assign
id|entry
suffix:semicolon
id|head-&gt;next
op_assign
id|entry
suffix:semicolon
id|ring-&gt;num_entries
op_increment
suffix:semicolon
)brace
DECL|function|remove_ring
r_static
r_inline
r_void
id|remove_ring
c_func
(paren
r_struct
id|sun4c_mmu_ring
op_star
id|ring
comma
r_struct
id|sun4c_mmu_entry
op_star
id|entry
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
(paren
id|next-&gt;prev
op_assign
id|entry-&gt;prev
)paren
op_member_access_from_pointer
id|next
op_assign
id|next
suffix:semicolon
id|ring-&gt;num_entries
op_decrement
suffix:semicolon
)brace
DECL|function|recycle_ring
r_static
r_inline
r_void
id|recycle_ring
c_func
(paren
r_struct
id|sun4c_mmu_ring
op_star
id|ring
comma
r_struct
id|sun4c_mmu_entry
op_star
id|entry
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|head
op_assign
op_amp
id|ring-&gt;ringhd
suffix:semicolon
r_struct
id|sun4c_mmu_entry
op_star
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
(paren
id|next-&gt;prev
op_assign
id|entry-&gt;prev
)paren
op_member_access_from_pointer
id|next
op_assign
id|next
suffix:semicolon
id|entry-&gt;prev
op_assign
id|head
suffix:semicolon
(paren
id|entry-&gt;next
op_assign
id|head-&gt;next
)paren
op_member_access_from_pointer
id|prev
op_assign
id|entry
suffix:semicolon
id|head-&gt;next
op_assign
id|entry
suffix:semicolon
multiline_comment|/* num_entries stays the same */
)brace
DECL|function|free_user_entry
r_static
r_inline
r_void
id|free_user_entry
c_func
(paren
r_int
id|ctx
comma
r_struct
id|sun4c_mmu_entry
op_star
id|entry
)paren
(brace
id|remove_ring
c_func
(paren
id|sun4c_context_ring
op_plus
id|ctx
comma
id|entry
)paren
suffix:semicolon
id|add_ring
c_func
(paren
op_amp
id|sun4c_ufree_ring
comma
id|entry
)paren
suffix:semicolon
)brace
DECL|function|assign_user_entry
r_static
r_inline
r_void
id|assign_user_entry
c_func
(paren
r_int
id|ctx
comma
r_struct
id|sun4c_mmu_entry
op_star
id|entry
)paren
(brace
id|remove_ring
c_func
(paren
op_amp
id|sun4c_ufree_ring
comma
id|entry
)paren
suffix:semicolon
id|add_ring
c_func
(paren
id|sun4c_context_ring
op_plus
id|ctx
comma
id|entry
)paren
suffix:semicolon
)brace
DECL|function|free_kernel_entry
r_static
r_inline
r_void
id|free_kernel_entry
c_func
(paren
r_struct
id|sun4c_mmu_entry
op_star
id|entry
comma
r_struct
id|sun4c_mmu_ring
op_star
id|ring
)paren
(brace
id|remove_ring
c_func
(paren
id|ring
comma
id|entry
)paren
suffix:semicolon
id|add_ring
c_func
(paren
op_amp
id|sun4c_kfree_ring
comma
id|entry
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|sun4c_init_fill_kernel_ring
c_func
(paren
r_int
id|howmany
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
r_while
c_loop
(paren
id|howmany
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|invalid_segment
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|locked
)paren
(brace
r_break
suffix:semicolon
)brace
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|locked
op_assign
l_int|1
suffix:semicolon
id|sun4c_init_clean_segmap
c_func
(paren
id|i
)paren
suffix:semicolon
id|add_ring
c_func
(paren
op_amp
id|sun4c_kfree_ring
comma
op_amp
id|mmu_entry_pool
(braket
id|i
)braket
)paren
suffix:semicolon
id|howmany
op_decrement
suffix:semicolon
)brace
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|sun4c_init_fill_user_ring
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|invalid_segment
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|locked
)paren
(brace
r_continue
suffix:semicolon
)brace
id|sun4c_init_clean_segmap
c_func
(paren
id|i
)paren
suffix:semicolon
id|add_ring
c_func
(paren
op_amp
id|sun4c_ufree_ring
comma
op_amp
id|mmu_entry_pool
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
DECL|function|sun4c_kernel_unmap
r_static
r_inline
r_void
id|sun4c_kernel_unmap
c_func
(paren
r_struct
id|sun4c_mmu_entry
op_star
id|kentry
)paren
(brace
r_int
id|savectx
comma
id|ctx
suffix:semicolon
id|savectx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ctx
op_assign
l_int|0
suffix:semicolon
id|ctx
OL
id|num_contexts
suffix:semicolon
id|ctx
op_increment
)paren
(brace
id|sun4c_set_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
id|sun4c_put_segmap
c_func
(paren
id|kentry-&gt;vaddr
comma
id|invalid_segment
)paren
suffix:semicolon
)brace
id|sun4c_set_context
c_func
(paren
id|savectx
)paren
suffix:semicolon
)brace
DECL|function|sun4c_kernel_map
r_static
r_inline
r_void
id|sun4c_kernel_map
c_func
(paren
r_struct
id|sun4c_mmu_entry
op_star
id|kentry
)paren
(brace
r_int
id|savectx
comma
id|ctx
suffix:semicolon
id|savectx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ctx
op_assign
l_int|0
suffix:semicolon
id|ctx
OL
id|num_contexts
suffix:semicolon
id|ctx
op_increment
)paren
(brace
id|sun4c_set_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
id|sun4c_put_segmap
c_func
(paren
id|kentry-&gt;vaddr
comma
id|kentry-&gt;pseg
)paren
suffix:semicolon
)brace
id|sun4c_set_context
c_func
(paren
id|savectx
)paren
suffix:semicolon
)brace
DECL|function|sun4c_user_unmap
r_static
r_inline
r_void
id|sun4c_user_unmap
c_func
(paren
r_struct
id|sun4c_mmu_entry
op_star
id|uentry
)paren
(brace
id|sun4c_put_segmap
c_func
(paren
id|uentry-&gt;vaddr
comma
id|invalid_segment
)paren
suffix:semicolon
)brace
DECL|function|sun4c_user_map
r_static
r_inline
r_void
id|sun4c_user_map
c_func
(paren
r_struct
id|sun4c_mmu_entry
op_star
id|uentry
)paren
(brace
r_int
r_int
id|start
op_assign
id|uentry-&gt;vaddr
suffix:semicolon
r_int
r_int
id|end
op_assign
id|start
op_plus
id|SUN4C_REAL_PGDIR_SIZE
suffix:semicolon
id|sun4c_put_segmap
c_func
(paren
id|uentry-&gt;vaddr
comma
id|uentry-&gt;pseg
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|sun4c_put_pte
c_func
(paren
id|start
comma
l_int|0
)paren
suffix:semicolon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
DECL|function|sun4c_demap_context
r_static
r_inline
r_void
id|sun4c_demap_context
c_func
(paren
r_struct
id|sun4c_mmu_ring
op_star
id|crp
comma
r_int
r_char
id|ctx
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|this_entry
comma
op_star
id|next_entry
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|savectx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|this_entry
op_assign
id|crp-&gt;ringhd.next
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
r_while
c_loop
(paren
id|crp-&gt;num_entries
)paren
(brace
id|next_entry
op_assign
id|this_entry-&gt;next
suffix:semicolon
id|sun4c_flush_segment
c_func
(paren
id|this_entry-&gt;vaddr
)paren
suffix:semicolon
id|sun4c_user_unmap
c_func
(paren
id|this_entry
)paren
suffix:semicolon
id|free_user_entry
c_func
(paren
id|ctx
comma
id|this_entry
)paren
suffix:semicolon
id|this_entry
op_assign
id|next_entry
suffix:semicolon
)brace
id|sun4c_set_context
c_func
(paren
id|savectx
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sun4c_demap_one
r_static
r_inline
r_void
id|sun4c_demap_one
c_func
(paren
r_struct
id|sun4c_mmu_ring
op_star
id|crp
comma
r_int
r_char
id|ctx
)paren
(brace
multiline_comment|/* by using .prev we get a kind of &quot;lru&quot; algorithm */
r_struct
id|sun4c_mmu_entry
op_star
id|entry
op_assign
id|crp-&gt;ringhd.prev
suffix:semicolon
r_int
id|savectx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
id|sun4c_flush_segment
c_func
(paren
id|entry-&gt;vaddr
)paren
suffix:semicolon
id|sun4c_user_unmap
c_func
(paren
id|entry
)paren
suffix:semicolon
id|free_user_entry
c_func
(paren
id|ctx
comma
id|entry
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|savectx
)paren
suffix:semicolon
)brace
DECL|variable|sun4c_user_taken_entries
r_static
r_int
id|sun4c_user_taken_entries
op_assign
l_int|0
suffix:semicolon
DECL|function|sun4c_kernel_strategy
r_static
r_inline
r_struct
id|sun4c_mmu_entry
op_star
id|sun4c_kernel_strategy
c_func
(paren
r_void
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|this_entry
suffix:semicolon
multiline_comment|/* If some are free, return first one. */
r_if
c_cond
(paren
id|sun4c_kfree_ring.num_entries
)paren
(brace
id|this_entry
op_assign
id|sun4c_kfree_ring.ringhd.next
suffix:semicolon
r_return
id|this_entry
suffix:semicolon
)brace
multiline_comment|/* Else free one up. */
id|this_entry
op_assign
id|sun4c_kernel_ring.ringhd.prev
suffix:semicolon
id|sun4c_flush_segment
c_func
(paren
id|this_entry-&gt;vaddr
)paren
suffix:semicolon
id|sun4c_kernel_unmap
c_func
(paren
id|this_entry
)paren
suffix:semicolon
id|free_kernel_entry
c_func
(paren
id|this_entry
comma
op_amp
id|sun4c_kernel_ring
)paren
suffix:semicolon
id|this_entry
op_assign
id|sun4c_kfree_ring.ringhd.next
suffix:semicolon
r_return
id|this_entry
suffix:semicolon
)brace
DECL|function|sun4c_shrink_kernel_ring
r_void
id|sun4c_shrink_kernel_ring
c_func
(paren
r_void
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|entry
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* If an interrupt comes in here, we die... */
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_user_taken_entries
)paren
(brace
id|entry
op_assign
id|sun4c_kernel_strategy
c_func
(paren
)paren
suffix:semicolon
id|remove_ring
c_func
(paren
op_amp
id|sun4c_kfree_ring
comma
id|entry
)paren
suffix:semicolon
id|add_ring
c_func
(paren
op_amp
id|sun4c_ufree_ring
comma
id|entry
)paren
suffix:semicolon
id|sun4c_user_taken_entries
op_decrement
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;shrink: ufree= %d, kfree= %d, kernel= %d&bslash;n&quot;
comma
id|sun4c_ufree_ring.num_entries
comma
id|sun4c_kfree_ring.num_entries
comma
id|sun4c_kernel_ring.num_entries
)paren
suffix:semicolon
macro_line|#endif
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Using this method to free up mmu entries eliminates a lot of&n; * potential races since we have a kernel that incurs tlb&n; * replacement faults.  There may be performance penalties.&n; */
DECL|function|sun4c_user_strategy
r_static
r_inline
r_struct
id|sun4c_mmu_entry
op_star
id|sun4c_user_strategy
c_func
(paren
r_void
)paren
(brace
r_struct
id|ctx_list
op_star
id|next_one
suffix:semicolon
r_struct
id|sun4c_mmu_ring
op_star
id|rp
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|ctx
suffix:semicolon
multiline_comment|/* If some are free, return first one. */
r_if
c_cond
(paren
id|sun4c_ufree_ring.num_entries
)paren
(brace
r_return
id|sun4c_ufree_ring.ringhd.next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sun4c_user_taken_entries
)paren
(brace
id|sun4c_shrink_kernel_ring
c_func
(paren
)paren
suffix:semicolon
r_return
id|sun4c_ufree_ring.ringhd.next
suffix:semicolon
)brace
multiline_comment|/* Grab one from the LRU context. */
id|next_one
op_assign
id|ctx_used.next
suffix:semicolon
r_while
c_loop
(paren
id|sun4c_context_ring
(braket
id|next_one-&gt;ctx_number
)braket
dot
id|num_entries
op_eq
l_int|0
)paren
id|next_one
op_assign
id|next_one-&gt;next
suffix:semicolon
id|ctx
op_assign
id|next_one-&gt;ctx_number
suffix:semicolon
id|rp
op_assign
op_amp
id|sun4c_context_ring
(braket
id|ctx
)braket
suffix:semicolon
id|sun4c_demap_one
c_func
(paren
id|rp
comma
id|ctx
)paren
suffix:semicolon
r_return
id|sun4c_ufree_ring.ringhd.next
suffix:semicolon
)brace
DECL|function|sun4c_grow_kernel_ring
r_void
id|sun4c_grow_kernel_ring
c_func
(paren
r_void
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_ufree_ring.num_entries
)paren
(brace
id|entry
op_assign
id|sun4c_ufree_ring.ringhd.next
suffix:semicolon
id|remove_ring
c_func
(paren
op_amp
id|sun4c_ufree_ring
comma
id|entry
)paren
suffix:semicolon
id|add_ring
c_func
(paren
op_amp
id|sun4c_kfree_ring
comma
id|entry
)paren
suffix:semicolon
id|sun4c_user_taken_entries
op_increment
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;grow: ufree= %d, kfree= %d, kernel= %d&bslash;n&quot;
comma
id|sun4c_ufree_ring.num_entries
comma
id|sun4c_kfree_ring.num_entries
comma
id|sun4c_kernel_ring.num_entries
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
DECL|function|alloc_user_segment
r_static
r_inline
r_void
id|alloc_user_segment
c_func
(paren
r_int
r_int
id|address
comma
r_int
r_char
id|ctx
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|entry
suffix:semicolon
id|address
op_and_assign
id|SUN4C_REAL_PGDIR_MASK
suffix:semicolon
id|entry
op_assign
id|sun4c_user_strategy
c_func
(paren
)paren
suffix:semicolon
id|assign_user_entry
c_func
(paren
id|ctx
comma
id|entry
)paren
suffix:semicolon
id|entry-&gt;vaddr
op_assign
id|address
suffix:semicolon
id|sun4c_user_map
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
multiline_comment|/* This is now a fast in-window trap handler to avoid any and all races. */
DECL|function|sun4c_quick_kernel_fault
r_static
r_void
id|sun4c_quick_kernel_fault
c_func
(paren
r_int
r_int
id|address
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Kernel faults at addr 0x%08lx&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;sun4c kernel fault handler bolixed...&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * 4 page buckets for task struct and kernel stack allocation.&n; *&n; * TASK_STACK_BEGIN&n; * bucket[0]&n; * bucket[1]&n; *   [ ... ]&n; * bucket[NR_TASKS-1]&n; * TASK_STACK_BEGIN + (sizeof(struct task_bucket) * NR_TASKS)&n; *&n; * Each slot looks like:&n; *&n; *  page 1   --  task struct&n; *  page 2   --  unmapped, for stack redzone (maybe use for pgd)&n; *  page 3/4 --  kernel stack&n; */
DECL|struct|task_bucket
r_struct
id|task_bucket
(brace
DECL|member|task
r_struct
id|task_struct
id|task
suffix:semicolon
DECL|member|_unused1
r_char
id|_unused1
(braket
id|PAGE_SIZE
op_minus
r_sizeof
(paren
r_struct
id|task_struct
)paren
)braket
suffix:semicolon
DECL|member|kstack
r_char
id|kstack
(braket
(paren
id|PAGE_SIZE
op_star
l_int|3
)paren
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|sun4c_bucket
r_struct
id|task_bucket
op_star
id|sun4c_bucket
(braket
id|NR_TASKS
)braket
suffix:semicolon
DECL|macro|BUCKET_EMPTY
mdefine_line|#define BUCKET_EMPTY     ((struct task_bucket *) 0)
DECL|macro|BUCKET_SIZE
mdefine_line|#define BUCKET_SIZE      (PAGE_SIZE &lt;&lt; 2)
DECL|macro|BUCKET_SHIFT
mdefine_line|#define BUCKET_SHIFT     14        /* log2(sizeof(struct task_bucket)) */
DECL|macro|BUCKET_NUM
mdefine_line|#define BUCKET_NUM(addr) ((((addr) - SUN4C_LOCK_VADDR) &gt;&gt; BUCKET_SHIFT))
DECL|macro|BUCKET_ADDR
mdefine_line|#define BUCKET_ADDR(num) (((num) &lt;&lt; BUCKET_SHIFT) + SUN4C_LOCK_VADDR)
DECL|macro|BUCKET_PTE
mdefine_line|#define BUCKET_PTE(page)       &bslash;&n;        ((((page) - PAGE_OFFSET) &gt;&gt; PAGE_SHIFT) | pgprot_val(SUN4C_PAGE_KERNEL))
DECL|macro|BUCKET_PTE_PAGE
mdefine_line|#define BUCKET_PTE_PAGE(pte)   &bslash;&n;        (PAGE_OFFSET + (((pte) &amp; 0xffff) &lt;&lt; PAGE_SHIFT))
DECL|function|get_locked_segment
r_static
r_inline
r_void
id|get_locked_segment
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|stolen
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|addr
op_and_assign
id|SUN4C_REAL_PGDIR_MASK
suffix:semicolon
id|stolen
op_assign
id|sun4c_user_strategy
c_func
(paren
)paren
suffix:semicolon
id|remove_ring
c_func
(paren
op_amp
id|sun4c_ufree_ring
comma
id|stolen
)paren
suffix:semicolon
id|stolen-&gt;vaddr
op_assign
id|addr
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|sun4c_kernel_map
c_func
(paren
id|stolen
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|free_locked_segment
r_static
r_inline
r_void
id|free_locked_segment
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|entry
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|pseg
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|addr
op_and_assign
id|SUN4C_REAL_PGDIR_MASK
suffix:semicolon
id|pseg
op_assign
id|sun4c_get_segmap
c_func
(paren
id|addr
)paren
suffix:semicolon
id|entry
op_assign
op_amp
id|mmu_entry_pool
(braket
id|pseg
)braket
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|sun4c_flush_segment
c_func
(paren
id|addr
)paren
suffix:semicolon
id|sun4c_kernel_unmap
c_func
(paren
id|entry
)paren
suffix:semicolon
id|add_ring
c_func
(paren
op_amp
id|sun4c_ufree_ring
comma
id|entry
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|garbage_collect
r_static
r_inline
r_void
id|garbage_collect
c_func
(paren
r_int
id|entry
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|start
comma
id|end
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* 16 buckets per segment... */
id|entry
op_and_assign
op_complement
l_int|15
suffix:semicolon
id|start
op_assign
id|entry
suffix:semicolon
r_for
c_loop
(paren
id|end
op_assign
(paren
id|start
op_plus
l_int|16
)paren
suffix:semicolon
id|start
OL
id|end
suffix:semicolon
id|start
op_increment
)paren
r_if
c_cond
(paren
id|sun4c_bucket
(braket
id|start
)braket
op_ne
id|BUCKET_EMPTY
)paren
(brace
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* Entire segment empty, release it. */
id|free_locked_segment
c_func
(paren
id|BUCKET_ADDR
c_func
(paren
id|entry
)paren
)paren
suffix:semicolon
id|done
suffix:colon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sun4c_alloc_task_struct
r_static
r_struct
id|task_struct
op_star
id|sun4c_alloc_task_struct
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|addr
comma
id|page
comma
id|flags
suffix:semicolon
r_int
id|entry
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|page
op_assign
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
r_struct
id|task_struct
op_star
)paren
l_int|0
suffix:semicolon
)brace
multiline_comment|/* XXX Bahh, linear search too slow, use hash&n;&t; * XXX table in final implementation.  Or&n;&t; * XXX keep track of first free when we free&n;&t; * XXX a bucket... anything but this.&n;&t; */
r_for
c_loop
(paren
id|entry
op_assign
l_int|0
suffix:semicolon
id|entry
OL
id|NR_TASKS
suffix:semicolon
id|entry
op_increment
)paren
r_if
c_cond
(paren
id|sun4c_bucket
(braket
id|entry
)braket
op_eq
id|BUCKET_EMPTY
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry
op_eq
id|NR_TASKS
)paren
(brace
id|free_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
r_struct
id|task_struct
op_star
)paren
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Prevent an alias from occurring while the page is ours. */
id|sun4c_flush_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|addr
op_assign
id|BUCKET_ADDR
c_func
(paren
id|entry
)paren
suffix:semicolon
id|sun4c_bucket
(braket
id|entry
)braket
op_assign
(paren
r_struct
id|task_bucket
op_star
)paren
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_get_segmap
c_func
(paren
id|addr
)paren
op_eq
id|invalid_segment
)paren
(brace
id|get_locked_segment
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
id|sun4c_put_pte
c_func
(paren
id|addr
comma
id|BUCKET_PTE
c_func
(paren
id|page
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
r_struct
id|task_struct
op_star
)paren
id|addr
suffix:semicolon
)brace
DECL|function|sun4c_alloc_kernel_stack
r_static
r_int
r_int
id|sun4c_alloc_kernel_stack
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
r_int
r_int
id|saddr
op_assign
(paren
r_int
r_int
)paren
id|tsk
suffix:semicolon
r_int
r_int
id|page
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|saddr
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|page
(braket
l_int|0
)braket
op_assign
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
(braket
l_int|0
)braket
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|page
(braket
l_int|1
)braket
op_assign
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
(braket
l_int|1
)braket
)paren
(brace
id|free_page
c_func
(paren
id|page
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Prevent aliases from occurring while the pages are ours. */
id|sun4c_flush_page
c_func
(paren
id|page
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|sun4c_flush_page
c_func
(paren
id|page
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|saddr
op_add_assign
id|PAGE_SIZE
op_lshift
l_int|1
suffix:semicolon
id|sun4c_put_pte
c_func
(paren
id|saddr
comma
id|BUCKET_PTE
c_func
(paren
id|page
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|sun4c_put_pte
c_func
(paren
id|saddr
op_plus
id|PAGE_SIZE
comma
id|BUCKET_PTE
c_func
(paren
id|page
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
r_return
id|saddr
suffix:semicolon
)brace
DECL|function|sun4c_free_kernel_stack
r_static
r_void
id|sun4c_free_kernel_stack
c_func
(paren
r_int
r_int
id|stack
)paren
(brace
r_int
r_int
id|page
(braket
l_int|2
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|page
(braket
l_int|0
)braket
op_assign
id|BUCKET_PTE_PAGE
c_func
(paren
id|sun4c_get_pte
c_func
(paren
id|stack
)paren
)paren
suffix:semicolon
id|page
(braket
l_int|1
)braket
op_assign
id|BUCKET_PTE_PAGE
c_func
(paren
id|sun4c_get_pte
c_func
(paren
id|stack
op_plus
id|PAGE_SIZE
)paren
)paren
suffix:semicolon
id|sun4c_flush_page
c_func
(paren
id|stack
)paren
suffix:semicolon
id|sun4c_flush_page
c_func
(paren
id|stack
op_plus
id|PAGE_SIZE
)paren
suffix:semicolon
id|sun4c_put_pte
c_func
(paren
id|stack
comma
l_int|0
)paren
suffix:semicolon
id|sun4c_put_pte
c_func
(paren
id|stack
op_plus
id|PAGE_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|free_page
c_func
(paren
id|page
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|free_page
c_func
(paren
id|page
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sun4c_free_task_struct
r_static
r_void
id|sun4c_free_task_struct
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
r_int
r_int
id|tsaddr
op_assign
(paren
r_int
r_int
)paren
id|tsk
suffix:semicolon
r_int
r_int
id|page
op_assign
id|BUCKET_PTE_PAGE
c_func
(paren
id|sun4c_get_pte
c_func
(paren
id|tsaddr
)paren
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|entry
op_assign
id|BUCKET_NUM
c_func
(paren
id|tsaddr
)paren
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|sun4c_flush_page
c_func
(paren
id|tsaddr
)paren
suffix:semicolon
id|sun4c_put_pte
c_func
(paren
id|tsaddr
comma
l_int|0
)paren
suffix:semicolon
id|sun4c_bucket
(braket
id|entry
)braket
op_assign
id|BUCKET_EMPTY
suffix:semicolon
id|free_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|garbage_collect
c_func
(paren
id|entry
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|sun4c_init_buckets
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|entry
suffix:semicolon
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|task_bucket
)paren
op_ne
(paren
id|PAGE_SIZE
op_lshift
l_int|2
)paren
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;task bucket not 4 pages!&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|entry
op_assign
l_int|0
suffix:semicolon
id|entry
OL
id|NR_TASKS
suffix:semicolon
id|entry
op_increment
)paren
(brace
id|sun4c_bucket
(braket
id|entry
)braket
op_assign
id|BUCKET_EMPTY
suffix:semicolon
)brace
)brace
DECL|variable|sun4c_iobuffer_start
r_static
r_int
r_int
id|sun4c_iobuffer_start
suffix:semicolon
DECL|variable|sun4c_iobuffer_end
r_static
r_int
r_int
id|sun4c_iobuffer_end
suffix:semicolon
DECL|variable|sun4c_iobuffer_high
r_static
r_int
r_int
id|sun4c_iobuffer_high
suffix:semicolon
DECL|variable|sun4c_iobuffer_map
r_static
r_int
r_int
op_star
id|sun4c_iobuffer_map
suffix:semicolon
DECL|variable|iobuffer_map_size
r_static
r_int
id|iobuffer_map_size
suffix:semicolon
multiline_comment|/*&n; * Alias our pages so they do not cause a trap.&n; * Also one page may be aliased into several I/O areas and we may&n; * finish these I/O separately.&n; */
DECL|function|sun4c_lockarea
r_static
r_char
op_star
id|sun4c_lockarea
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|base
comma
id|scan
suffix:semicolon
r_int
r_int
id|npages
suffix:semicolon
r_int
r_int
id|vpage
suffix:semicolon
r_int
r_int
id|pte
suffix:semicolon
r_int
r_int
id|apage
suffix:semicolon
r_int
r_int
id|high
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|npages
op_assign
(paren
(paren
(paren
r_int
r_int
)paren
id|vaddr
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|size
op_plus
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|scan
op_assign
l_int|0
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|scan
op_assign
id|find_next_zero_bit
c_func
(paren
id|sun4c_iobuffer_map
comma
id|iobuffer_map_size
comma
id|scan
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|base
op_assign
id|scan
)paren
op_plus
id|npages
OG
id|iobuffer_map_size
)paren
r_goto
id|abend
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|scan
op_ge
id|base
op_plus
id|npages
)paren
r_goto
id|found
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|scan
comma
id|sun4c_iobuffer_map
)paren
)paren
r_break
suffix:semicolon
id|scan
op_increment
suffix:semicolon
)brace
)brace
id|found
suffix:colon
id|high
op_assign
(paren
(paren
id|base
op_plus
id|npages
)paren
op_lshift
id|PAGE_SHIFT
)paren
op_plus
id|sun4c_iobuffer_start
suffix:semicolon
id|high
op_assign
id|SUN4C_REAL_PGDIR_ALIGN
c_func
(paren
id|high
)paren
suffix:semicolon
r_while
c_loop
(paren
id|high
OG
id|sun4c_iobuffer_high
)paren
(brace
id|get_locked_segment
c_func
(paren
id|sun4c_iobuffer_high
)paren
suffix:semicolon
id|sun4c_iobuffer_high
op_add_assign
id|SUN4C_REAL_PGDIR_SIZE
suffix:semicolon
)brace
id|vpage
op_assign
(paren
(paren
r_int
r_int
)paren
id|vaddr
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
r_for
c_loop
(paren
id|scan
op_assign
id|base
suffix:semicolon
id|scan
OL
id|base
op_plus
id|npages
suffix:semicolon
id|scan
op_increment
)paren
(brace
id|pte
op_assign
(paren
(paren
id|vpage
op_minus
id|PAGE_OFFSET
)paren
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
id|pte
op_or_assign
id|pgprot_val
c_func
(paren
id|SUN4C_PAGE_KERNEL
)paren
suffix:semicolon
id|pte
op_or_assign
id|_SUN4C_PAGE_NOCACHE
suffix:semicolon
id|set_bit
c_func
(paren
id|scan
comma
id|sun4c_iobuffer_map
)paren
suffix:semicolon
id|apage
op_assign
(paren
id|scan
op_lshift
id|PAGE_SHIFT
)paren
op_plus
id|sun4c_iobuffer_start
suffix:semicolon
multiline_comment|/* Flush original mapping so we see the right things later. */
id|sun4c_flush_page
c_func
(paren
id|vpage
)paren
suffix:semicolon
id|sun4c_put_pte
c_func
(paren
id|apage
comma
id|pte
)paren
suffix:semicolon
id|vpage
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
(paren
r_char
op_star
)paren
(paren
(paren
id|base
op_lshift
id|PAGE_SHIFT
)paren
op_plus
id|sun4c_iobuffer_start
op_plus
(paren
(paren
(paren
r_int
r_int
)paren
id|vaddr
)paren
op_amp
op_complement
id|PAGE_MASK
)paren
)paren
suffix:semicolon
id|abend
suffix:colon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DMA vaddr=0x%p size=%08lx&bslash;n&quot;
comma
id|vaddr
comma
id|size
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Out of iobuffer table&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sun4c_unlockarea
r_static
r_void
id|sun4c_unlockarea
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|vpage
comma
id|npages
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|scan
comma
id|high
suffix:semicolon
id|vpage
op_assign
(paren
r_int
r_int
)paren
id|vaddr
op_amp
id|PAGE_MASK
suffix:semicolon
id|npages
op_assign
(paren
(paren
(paren
r_int
r_int
)paren
id|vaddr
op_amp
op_complement
id|PAGE_MASK
)paren
op_plus
id|size
op_plus
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|npages
op_ne
l_int|0
)paren
(brace
op_decrement
id|npages
suffix:semicolon
id|sun4c_put_pte
c_func
(paren
id|vpage
comma
l_int|0
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
(paren
id|vpage
op_minus
id|sun4c_iobuffer_start
)paren
op_rshift
id|PAGE_SHIFT
comma
id|sun4c_iobuffer_map
)paren
suffix:semicolon
id|vpage
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
multiline_comment|/* garbage collect */
id|scan
op_assign
(paren
id|sun4c_iobuffer_high
op_minus
id|sun4c_iobuffer_start
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
r_while
c_loop
(paren
id|scan
op_ge
l_int|0
op_logical_and
op_logical_neg
id|sun4c_iobuffer_map
(braket
id|scan
op_rshift
l_int|5
)braket
)paren
id|scan
op_sub_assign
l_int|32
suffix:semicolon
id|scan
op_add_assign
l_int|32
suffix:semicolon
id|high
op_assign
id|sun4c_iobuffer_start
op_plus
(paren
id|scan
op_lshift
id|PAGE_SHIFT
)paren
suffix:semicolon
id|high
op_assign
id|SUN4C_REAL_PGDIR_ALIGN
c_func
(paren
id|high
)paren
op_plus
id|SUN4C_REAL_PGDIR_SIZE
suffix:semicolon
r_while
c_loop
(paren
id|high
OL
id|sun4c_iobuffer_high
)paren
(brace
id|sun4c_iobuffer_high
op_sub_assign
id|SUN4C_REAL_PGDIR_SIZE
suffix:semicolon
id|free_locked_segment
c_func
(paren
id|sun4c_iobuffer_high
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Note the scsi code at init time passes to here buffers&n; * which sit on the kernel stack, those are already locked&n; * by implication and fool the page locking code above&n; * if passed to by mistake.&n; */
DECL|function|sun4c_get_scsi_one
r_static
r_char
op_star
id|sun4c_get_scsi_one
c_func
(paren
r_char
op_star
id|bufptr
comma
r_int
r_int
id|len
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_int
r_int
id|page
suffix:semicolon
id|page
op_assign
(paren
(paren
r_int
r_int
)paren
id|bufptr
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
id|MAP_NR
c_func
(paren
id|page
)paren
OG
id|max_mapnr
)paren
(brace
id|sun4c_flush_page
c_func
(paren
id|page
)paren
suffix:semicolon
r_return
id|bufptr
suffix:semicolon
multiline_comment|/* already locked */
)brace
r_return
id|sun4c_lockarea
c_func
(paren
id|bufptr
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|sun4c_get_scsi_sgl
r_static
r_void
id|sun4c_get_scsi_sgl
c_func
(paren
r_struct
id|mmu_sglist
op_star
id|sg
comma
r_int
id|sz
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_while
c_loop
(paren
id|sz
op_ge
l_int|0
)paren
(brace
id|sg
(braket
id|sz
)braket
dot
id|dvma_addr
op_assign
id|sun4c_lockarea
c_func
(paren
id|sg
(braket
id|sz
)braket
dot
id|addr
comma
id|sg
(braket
id|sz
)braket
dot
id|len
)paren
suffix:semicolon
id|sz
op_decrement
suffix:semicolon
)brace
)brace
DECL|function|sun4c_release_scsi_one
r_static
r_void
id|sun4c_release_scsi_one
c_func
(paren
r_char
op_star
id|bufptr
comma
r_int
r_int
id|len
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_int
r_int
id|page
op_assign
(paren
r_int
r_int
)paren
id|bufptr
suffix:semicolon
r_if
c_cond
(paren
id|page
OL
id|sun4c_iobuffer_start
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/* On kernel stack or similar, see above */
id|sun4c_unlockarea
c_func
(paren
id|bufptr
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|sun4c_release_scsi_sgl
r_static
r_void
id|sun4c_release_scsi_sgl
c_func
(paren
r_struct
id|mmu_sglist
op_star
id|sg
comma
r_int
id|sz
comma
r_struct
id|linux_sbus
op_star
id|sbus
)paren
(brace
r_while
c_loop
(paren
id|sz
op_ge
l_int|0
)paren
(brace
id|sun4c_unlockarea
c_func
(paren
id|sg
(braket
id|sz
)braket
dot
id|dvma_addr
comma
id|sg
(braket
id|sz
)braket
dot
id|len
)paren
suffix:semicolon
id|sz
op_decrement
suffix:semicolon
)brace
)brace
DECL|macro|TASK_ENTRY_SIZE
mdefine_line|#define TASK_ENTRY_SIZE    BUCKET_SIZE /* see above */
DECL|macro|LONG_ALIGN
mdefine_line|#define LONG_ALIGN(x) (((x)+(sizeof(long))-1)&amp;~((sizeof(long))-1))
DECL|variable|sun4c_kstack_vma
r_struct
id|vm_area_struct
id|sun4c_kstack_vma
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
r_int
id|sun4c_init_lock_areas
c_func
(paren
r_int
r_int
id|start_mem
)paren
)paren
(brace
r_int
r_int
id|sun4c_taskstack_start
suffix:semicolon
r_int
r_int
id|sun4c_taskstack_end
suffix:semicolon
r_int
id|bitmap_size
suffix:semicolon
id|sun4c_init_buckets
c_func
(paren
)paren
suffix:semicolon
id|sun4c_taskstack_start
op_assign
id|SUN4C_LOCK_VADDR
suffix:semicolon
id|sun4c_taskstack_end
op_assign
(paren
id|sun4c_taskstack_start
op_plus
(paren
id|TASK_ENTRY_SIZE
op_star
id|NR_TASKS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_taskstack_end
op_ge
id|SUN4C_LOCK_END
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Too many tasks, decrease NR_TASKS please.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|sun4c_iobuffer_start
op_assign
id|sun4c_iobuffer_high
op_assign
id|SUN4C_REAL_PGDIR_ALIGN
c_func
(paren
id|sun4c_taskstack_end
)paren
suffix:semicolon
id|sun4c_iobuffer_end
op_assign
id|SUN4C_LOCK_END
suffix:semicolon
id|bitmap_size
op_assign
(paren
id|sun4c_iobuffer_end
op_minus
id|sun4c_iobuffer_start
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|bitmap_size
op_assign
(paren
id|bitmap_size
op_plus
l_int|7
)paren
op_rshift
l_int|3
suffix:semicolon
id|bitmap_size
op_assign
id|LONG_ALIGN
c_func
(paren
id|bitmap_size
)paren
suffix:semicolon
id|iobuffer_map_size
op_assign
id|bitmap_size
op_lshift
l_int|3
suffix:semicolon
id|sun4c_iobuffer_map
op_assign
(paren
r_int
r_int
op_star
)paren
id|start_mem
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|start_mem
comma
l_int|0
comma
id|bitmap_size
)paren
suffix:semicolon
id|start_mem
op_add_assign
id|bitmap_size
suffix:semicolon
id|sun4c_kstack_vma.vm_mm
op_assign
id|init_task.mm
suffix:semicolon
id|sun4c_kstack_vma.vm_start
op_assign
id|sun4c_taskstack_start
suffix:semicolon
id|sun4c_kstack_vma.vm_end
op_assign
id|sun4c_taskstack_end
suffix:semicolon
id|sun4c_kstack_vma.vm_page_prot
op_assign
id|PAGE_SHARED
suffix:semicolon
id|sun4c_kstack_vma.vm_flags
op_assign
id|VM_READ
op_or
id|VM_WRITE
op_or
id|VM_EXEC
suffix:semicolon
id|insert_vm_struct
c_func
(paren
op_amp
id|init_mm
comma
op_amp
id|sun4c_kstack_vma
)paren
suffix:semicolon
r_return
id|start_mem
suffix:semicolon
)brace
multiline_comment|/* Cache flushing on the sun4c. */
DECL|function|sun4c_flush_cache_all
r_static
r_void
id|sun4c_flush_cache_all
c_func
(paren
r_void
)paren
(brace
r_extern
r_int
r_int
id|bcopy
suffix:semicolon
r_int
r_int
id|begin
comma
id|end
comma
id|flags
suffix:semicolon
id|begin
op_assign
(paren
(paren
r_int
r_int
)paren
op_amp
id|bcopy
)paren
suffix:semicolon
id|end
op_assign
(paren
id|begin
op_plus
id|sun4c_vacinfo.num_bytes
)paren
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_vacinfo.linesize
op_eq
l_int|32
)paren
(brace
r_while
c_loop
(paren
id|begin
OL
id|end
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
"&quot;"
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x00
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x20
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x40
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x60
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x80
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xa0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xc0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xe0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x100
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x120
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x140
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x160
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x180
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x1a0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x1c0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x1e0
)braket
comma
op_mod
op_mod
id|g0
l_string|&quot; : : &quot;
id|r
"&quot;"
(paren
id|begin
)paren
)paren
suffix:semicolon
id|begin
op_add_assign
l_int|512
suffix:semicolon
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
id|begin
OL
id|end
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
"&quot;"
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x00
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x10
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x20
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x30
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x40
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x50
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x60
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x70
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x80
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0x90
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xa0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xb0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xc0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xd0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xe0
)braket
comma
op_mod
op_mod
id|g0
id|ld
(braket
op_mod
l_int|0
op_plus
l_int|0xf0
)braket
comma
op_mod
op_mod
id|g0
l_string|&quot; : : &quot;
id|r
"&quot;"
(paren
id|begin
)paren
)paren
suffix:semicolon
id|begin
op_add_assign
l_int|256
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sun4c_flush_cache_mm
r_static
r_void
id|sun4c_flush_cache_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|octx
comma
id|new_ctx
op_assign
id|mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|new_ctx
op_ne
id|NO_CONTEXT
)paren
(brace
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|octx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|new_ctx
)paren
suffix:semicolon
id|sun4c_flush_context
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|sun4c_flush_cache_range
r_static
r_void
id|sun4c_flush_cache_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
r_int
id|size
comma
id|size2
comma
id|octx
comma
id|i
comma
id|new_ctx
op_assign
id|mm-&gt;context
suffix:semicolon
r_int
r_int
id|start2
comma
id|end2
comma
id|flags
suffix:semicolon
r_struct
id|sun4c_mmu_entry
op_star
id|entry
comma
op_star
id|entry2
suffix:semicolon
macro_line|#if KGPROF_PROFILING
id|kgprof_profile
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|new_ctx
op_ne
id|NO_CONTEXT
)paren
(brace
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|size
op_assign
id|end
op_minus
id|start
suffix:semicolon
id|octx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|new_ctx
)paren
suffix:semicolon
id|entry
op_assign
id|sun4c_context_ring
(braket
id|new_ctx
)braket
dot
id|ringhd.next
suffix:semicolon
id|i
op_assign
id|sun4c_context_ring
(braket
id|new_ctx
)braket
dot
id|num_entries
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
)paren
(brace
id|entry2
op_assign
id|entry-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;vaddr
OL
id|start
op_logical_or
id|entry-&gt;vaddr
op_ge
id|end
)paren
r_goto
id|next_entry
suffix:semicolon
id|start2
op_assign
id|MAX
c_func
(paren
id|start
comma
id|entry-&gt;vaddr
)paren
suffix:semicolon
id|end2
op_assign
id|MIN
c_func
(paren
id|end
comma
id|entry-&gt;vaddr
op_plus
id|SUN4C_REAL_PGDIR_SIZE
)paren
suffix:semicolon
id|size2
op_assign
id|end2
op_minus
id|start2
suffix:semicolon
r_if
c_cond
(paren
id|size2
op_le
(paren
id|PAGE_SIZE
op_lshift
l_int|3
)paren
)paren
(brace
id|start2
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_while
c_loop
(paren
id|start2
OL
id|end2
)paren
(brace
id|sun4c_flush_page
c_func
(paren
id|start2
)paren
suffix:semicolon
id|start2
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
r_else
(brace
id|start2
op_and_assign
id|SUN4C_REAL_PGDIR_MASK
suffix:semicolon
id|sun4c_flush_segment
c_func
(paren
id|start2
)paren
suffix:semicolon
multiline_comment|/* We are betting that the entry will not be &n;&t;&t;&t;&t; * needed for a while.&n;&t;&t;&t;&t; */
id|sun4c_user_unmap
c_func
(paren
id|entry
)paren
suffix:semicolon
id|free_user_entry
c_func
(paren
id|new_ctx
comma
id|entry
)paren
suffix:semicolon
)brace
id|next_entry
suffix:colon
id|entry
op_assign
id|entry2
suffix:semicolon
)brace
id|sun4c_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|sun4c_flush_cache_page
r_static
r_void
id|sun4c_flush_cache_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
r_int
id|octx
comma
id|new_ctx
op_assign
id|mm-&gt;context
suffix:semicolon
multiline_comment|/* Sun4c has no separate I/D caches so cannot optimize for non&n;&t; * text page flushes.&n;&t; */
r_if
c_cond
(paren
id|new_ctx
op_ne
id|NO_CONTEXT
)paren
(brace
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|octx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|new_ctx
)paren
suffix:semicolon
id|sun4c_flush_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|octx
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Even though sun4c is write through, a virtual cache alias inconsistancy&n; * can still occur with COW page handling so we must flush anyways.&n; */
DECL|function|sun4c_flush_page_to_ram
r_static
r_void
id|sun4c_flush_page_to_ram
c_func
(paren
r_int
r_int
id|page
)paren
(brace
id|sun4c_flush_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
multiline_comment|/* Sun4c cache is unified, both instructions and data live there, so&n; * no need to flush the on-stack instructions for new signal handlers.&n; */
DECL|function|sun4c_flush_sig_insns
r_static
r_void
id|sun4c_flush_sig_insns
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|insn_addr
)paren
(brace
)brace
multiline_comment|/* TLB flushing on the sun4c.  These routines count on the cache&n; * flushing code to flush the user register windows so that we need&n; * not do so when we get here.&n; */
DECL|function|sun4c_flush_tlb_all
r_static
r_void
id|sun4c_flush_tlb_all
c_func
(paren
r_void
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|this_entry
comma
op_star
id|next_entry
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|savectx
comma
id|ctx
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|this_entry
op_assign
id|sun4c_kernel_ring.ringhd.next
suffix:semicolon
id|savectx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|sun4c_kernel_ring.num_entries
)paren
(brace
id|next_entry
op_assign
id|this_entry-&gt;next
suffix:semicolon
id|sun4c_flush_segment
c_func
(paren
id|this_entry-&gt;vaddr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ctx
op_assign
l_int|0
suffix:semicolon
id|ctx
OL
id|num_contexts
suffix:semicolon
id|ctx
op_increment
)paren
(brace
id|sun4c_set_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
id|sun4c_put_segmap
c_func
(paren
id|this_entry-&gt;vaddr
comma
id|invalid_segment
)paren
suffix:semicolon
)brace
id|free_kernel_entry
c_func
(paren
id|this_entry
comma
op_amp
id|sun4c_kernel_ring
)paren
suffix:semicolon
id|this_entry
op_assign
id|next_entry
suffix:semicolon
)brace
id|sun4c_set_context
c_func
(paren
id|savectx
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sun4c_flush_tlb_mm
r_static
r_void
id|sun4c_flush_tlb_mm
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|this_entry
comma
op_star
id|next_entry
suffix:semicolon
r_struct
id|sun4c_mmu_ring
op_star
id|crp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|savectx
comma
id|new_ctx
op_assign
id|mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|new_ctx
op_ne
id|NO_CONTEXT
)paren
(brace
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|crp
op_assign
op_amp
id|sun4c_context_ring
(braket
id|new_ctx
)braket
suffix:semicolon
id|savectx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|this_entry
op_assign
id|crp-&gt;ringhd.next
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|new_ctx
)paren
suffix:semicolon
r_while
c_loop
(paren
id|crp-&gt;num_entries
)paren
(brace
id|next_entry
op_assign
id|this_entry-&gt;next
suffix:semicolon
id|sun4c_flush_segment
c_func
(paren
id|this_entry-&gt;vaddr
)paren
suffix:semicolon
id|sun4c_user_unmap
c_func
(paren
id|this_entry
)paren
suffix:semicolon
id|free_user_entry
c_func
(paren
id|new_ctx
comma
id|this_entry
)paren
suffix:semicolon
id|this_entry
op_assign
id|next_entry
suffix:semicolon
)brace
id|sun4c_set_context
c_func
(paren
id|savectx
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|sun4c_flush_tlb_range
r_static
r_void
id|sun4c_flush_tlb_range
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
)paren
(brace
r_struct
id|sun4c_mmu_entry
op_star
id|entry
comma
op_star
id|entry2
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|savectx
comma
id|new_ctx
op_assign
id|mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|new_ctx
op_eq
id|NO_CONTEXT
)paren
(brace
r_return
suffix:semicolon
)brace
macro_line|#if KGPROF_PROFILING
id|kgprof_profile
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|savectx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|new_ctx
)paren
suffix:semicolon
id|start
op_and_assign
id|SUN4C_REAL_PGDIR_MASK
suffix:semicolon
id|entry
op_assign
id|sun4c_context_ring
(braket
id|new_ctx
)braket
dot
id|ringhd.next
suffix:semicolon
id|i
op_assign
id|sun4c_context_ring
(braket
id|new_ctx
)braket
dot
id|num_entries
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
)paren
(brace
id|entry2
op_assign
id|entry-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;vaddr
op_ge
id|start
op_logical_and
id|entry-&gt;vaddr
OL
id|end
)paren
(brace
id|sun4c_flush_segment
c_func
(paren
id|entry-&gt;vaddr
)paren
suffix:semicolon
id|sun4c_user_unmap
c_func
(paren
id|entry
)paren
suffix:semicolon
id|free_user_entry
c_func
(paren
id|new_ctx
comma
id|entry
)paren
suffix:semicolon
)brace
id|entry
op_assign
id|entry2
suffix:semicolon
)brace
id|sun4c_set_context
c_func
(paren
id|savectx
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sun4c_flush_tlb_page
r_static
r_void
id|sun4c_flush_tlb_page
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|page
)paren
(brace
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|vma-&gt;vm_mm
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|savectx
comma
id|new_ctx
op_assign
id|mm-&gt;context
suffix:semicolon
r_if
c_cond
(paren
id|new_ctx
op_ne
id|NO_CONTEXT
)paren
(brace
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|savectx
op_assign
id|sun4c_get_context
c_func
(paren
)paren
suffix:semicolon
id|flush_user_windows
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|new_ctx
)paren
suffix:semicolon
id|page
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|sun4c_flush_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|sun4c_put_pte
c_func
(paren
id|page
comma
l_int|0
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|savectx
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|sun4c_set_pte
r_static
r_void
id|sun4c_set_pte
c_func
(paren
id|pte_t
op_star
id|ptep
comma
id|pte_t
id|pte
)paren
(brace
op_star
id|ptep
op_assign
id|pte
suffix:semicolon
)brace
DECL|function|sun4c_mapioaddr
r_void
id|sun4c_mapioaddr
c_func
(paren
r_int
r_int
id|physaddr
comma
r_int
r_int
id|virt_addr
comma
r_int
id|bus_type
comma
r_int
id|rdonly
)paren
(brace
r_int
r_int
id|page_entry
suffix:semicolon
id|page_entry
op_assign
(paren
(paren
id|physaddr
op_rshift
id|PAGE_SHIFT
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|page_entry
op_or_assign
(paren
(paren
id|pg_iobits
op_or
id|_SUN4C_PAGE_PRIV
)paren
op_amp
op_complement
(paren
id|_SUN4C_PAGE_PRESENT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rdonly
)paren
(brace
id|page_entry
op_and_assign
op_complement
id|_SUN4C_WRITEABLE
suffix:semicolon
)brace
id|sun4c_put_pte
c_func
(paren
id|virt_addr
comma
id|page_entry
)paren
suffix:semicolon
)brace
DECL|function|sun4c_unmapioaddr
r_void
id|sun4c_unmapioaddr
c_func
(paren
r_int
r_int
id|virt_addr
)paren
(brace
id|sun4c_put_pte
c_func
(paren
id|virt_addr
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sun4c_alloc_context
r_static
r_inline
r_void
id|sun4c_alloc_context
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
)paren
(brace
r_struct
id|ctx_list
op_star
id|ctxp
suffix:semicolon
id|ctxp
op_assign
id|ctx_free.next
suffix:semicolon
r_if
c_cond
(paren
id|ctxp
op_ne
op_amp
id|ctx_free
)paren
(brace
id|remove_from_ctx_list
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|add_to_used_ctxlist
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|mm-&gt;context
op_assign
id|ctxp-&gt;ctx_number
suffix:semicolon
id|ctxp-&gt;ctx_mm
op_assign
id|mm
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ctxp
op_assign
id|ctx_used.next
suffix:semicolon
r_if
c_cond
(paren
id|ctxp-&gt;ctx_mm
op_eq
id|current-&gt;mm
)paren
(brace
id|ctxp
op_assign
id|ctxp-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctxp
op_eq
op_amp
id|ctx_used
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;out of mmu contexts&quot;
)paren
suffix:semicolon
)brace
id|remove_from_ctx_list
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|add_to_used_ctxlist
c_func
(paren
id|ctxp
)paren
suffix:semicolon
id|ctxp-&gt;ctx_mm-&gt;context
op_assign
id|NO_CONTEXT
suffix:semicolon
id|ctxp-&gt;ctx_mm
op_assign
id|mm
suffix:semicolon
id|mm-&gt;context
op_assign
id|ctxp-&gt;ctx_number
suffix:semicolon
id|sun4c_demap_context
c_func
(paren
op_amp
id|sun4c_context_ring
(braket
id|ctxp-&gt;ctx_number
)braket
comma
id|ctxp-&gt;ctx_number
)paren
suffix:semicolon
)brace
macro_line|#if some_day_soon /* We need some tweaking to start using this */
r_extern
r_void
id|force_user_fault
c_func
(paren
r_int
r_int
comma
r_int
)paren
suffix:semicolon
DECL|function|sun4c_switch_heuristic
r_void
id|sun4c_switch_heuristic
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|sp
op_assign
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
suffix:semicolon
r_int
r_int
id|sp2
op_assign
id|sp
op_plus
id|REGWIN_SZ
op_minus
l_int|0x8
suffix:semicolon
id|force_user_fault
c_func
(paren
id|regs-&gt;pc
comma
l_int|0
)paren
suffix:semicolon
id|force_user_fault
c_func
(paren
id|sp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sp
op_amp
id|PAGE_MASK
)paren
op_ne
(paren
id|sp2
op_amp
id|PAGE_MASK
)paren
)paren
(brace
id|force_user_fault
c_func
(paren
id|sp2
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|sun4c_switch_to_context
r_static
r_void
id|sun4c_switch_to_context
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
r_struct
id|ctx_list
op_star
id|ctx
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tsk-&gt;mm-&gt;context
op_eq
id|NO_CONTEXT
)paren
(brace
id|sun4c_alloc_context
c_func
(paren
id|tsk-&gt;mm
)paren
suffix:semicolon
r_goto
id|set_context
suffix:semicolon
)brace
multiline_comment|/* Update the LRU ring of contexts. */
id|ctx
op_assign
id|ctx_list_pool
op_plus
id|tsk-&gt;mm-&gt;context
suffix:semicolon
id|remove_from_ctx_list
c_func
(paren
id|ctx
)paren
suffix:semicolon
id|add_to_used_ctxlist
c_func
(paren
id|ctx
)paren
suffix:semicolon
id|set_context
suffix:colon
id|sun4c_set_context
c_func
(paren
id|tsk-&gt;mm-&gt;context
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sun4c_flush_hook
r_static
r_void
id|sun4c_flush_hook
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;tss.flags
op_amp
id|SPARC_FLAG_KTHREAD
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|sun4c_alloc_context
c_func
(paren
id|current-&gt;mm
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
id|current-&gt;mm-&gt;context
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|sun4c_exit_hook
r_static
r_void
id|sun4c_exit_hook
c_func
(paren
r_void
)paren
(brace
r_struct
id|ctx_list
op_star
id|ctx_old
suffix:semicolon
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|current-&gt;mm
suffix:semicolon
r_if
c_cond
(paren
id|mm-&gt;context
op_ne
id|NO_CONTEXT
op_logical_and
id|mm-&gt;count
op_eq
l_int|1
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|sun4c_demap_context
c_func
(paren
op_amp
id|sun4c_context_ring
(braket
id|mm-&gt;context
)braket
comma
id|mm-&gt;context
)paren
suffix:semicolon
id|ctx_old
op_assign
id|ctx_list_pool
op_plus
id|mm-&gt;context
suffix:semicolon
id|remove_from_ctx_list
c_func
(paren
id|ctx_old
)paren
suffix:semicolon
id|add_to_free_ctxlist
c_func
(paren
id|ctx_old
)paren
suffix:semicolon
id|mm-&gt;context
op_assign
id|NO_CONTEXT
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
)brace
macro_line|#if KGPROF_PROFILING
DECL|variable|s4cinfo
r_static
r_char
id|s4cinfo
(braket
l_int|10240
)braket
suffix:semicolon
macro_line|#else
DECL|variable|s4cinfo
r_static
r_char
id|s4cinfo
(braket
l_int|512
)braket
suffix:semicolon
macro_line|#endif
DECL|function|sun4c_mmu_info
r_static
r_char
op_star
id|sun4c_mmu_info
c_func
(paren
r_void
)paren
(brace
r_int
id|used_user_entries
comma
id|i
suffix:semicolon
id|used_user_entries
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_contexts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|used_user_entries
op_add_assign
id|sun4c_context_ring
(braket
id|i
)braket
dot
id|num_entries
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|s4cinfo
comma
l_string|&quot;vacsize&bslash;t&bslash;t: %d bytes&bslash;n&quot;
l_string|&quot;vachwflush&bslash;t: %s&bslash;n&quot;
l_string|&quot;vaclinesize&bslash;t: %d bytes&bslash;n&quot;
l_string|&quot;mmuctxs&bslash;t&bslash;t: %d&bslash;n&quot;
l_string|&quot;mmupsegs&bslash;t: %d&bslash;n&quot;
l_string|&quot;kernelpsegs&bslash;t: %d&bslash;n&quot;
l_string|&quot;kfreepsegs&bslash;t: %d&bslash;n&quot;
l_string|&quot;usedpsegs&bslash;t: %d&bslash;n&quot;
l_string|&quot;ufreepsegs&bslash;t: %d&bslash;n&quot;
l_string|&quot;context&bslash;t&bslash;t: %d flushes&bslash;n&quot;
l_string|&quot;segment&bslash;t&bslash;t: %d flushes&bslash;n&quot;
l_string|&quot;page&bslash;t&bslash;t: %d flushes&bslash;n&quot;
comma
id|sun4c_vacinfo.num_bytes
comma
(paren
id|sun4c_vacinfo.do_hwflushes
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
comma
id|sun4c_vacinfo.linesize
comma
id|num_contexts
comma
(paren
id|invalid_segment
op_plus
l_int|1
)paren
comma
id|sun4c_kernel_ring.num_entries
comma
id|sun4c_kfree_ring.num_entries
comma
id|used_user_entries
comma
id|sun4c_ufree_ring.num_entries
comma
id|ctxflushes
comma
id|segflushes
comma
id|pageflushes
)paren
suffix:semicolon
macro_line|#if KGPROF_PROFILING
(brace
r_char
op_star
id|p
op_assign
id|s4cinfo
op_plus
id|strlen
c_func
(paren
id|s4cinfo
)paren
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;kgprof profiling:&bslash;n&quot;
)paren
suffix:semicolon
id|p
op_add_assign
id|strlen
c_func
(paren
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|KGPROF_SIZE
op_logical_and
id|kgprof_counters
(braket
id|i
)braket
dot
id|addr
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%5d  &quot;
comma
id|kgprof_counters
(braket
id|i
)braket
dot
id|count
)paren
suffix:semicolon
id|p
op_add_assign
id|strlen
c_func
(paren
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|KGPROF_DEPTH
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%08x &quot;
comma
id|kgprof_counters
(braket
id|i
)braket
dot
id|addr
(braket
id|j
)braket
)paren
suffix:semicolon
id|p
op_add_assign
id|strlen
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|p
op_add_assign
id|strlen
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
id|s4cinfo
suffix:semicolon
)brace
multiline_comment|/* Nothing below here should touch the mmu hardware nor the mmu_entry&n; * data structures.&n; */
DECL|function|sun4c_pmd_align
r_static
r_int
r_int
id|sun4c_pmd_align
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|SUN4C_PMD_ALIGN
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pgdir_align
r_static
r_int
r_int
id|sun4c_pgdir_align
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|SUN4C_PGDIR_ALIGN
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
multiline_comment|/* First the functions which the mid-level code uses to directly&n; * manipulate the software page tables.  Some defines since we are&n; * emulating the i386 page directory layout.&n; */
DECL|macro|PGD_PRESENT
mdefine_line|#define PGD_PRESENT  0x001
DECL|macro|PGD_RW
mdefine_line|#define PGD_RW       0x002
DECL|macro|PGD_USER
mdefine_line|#define PGD_USER     0x004
DECL|macro|PGD_ACCESSED
mdefine_line|#define PGD_ACCESSED 0x020
DECL|macro|PGD_DIRTY
mdefine_line|#define PGD_DIRTY    0x040
DECL|macro|PGD_TABLE
mdefine_line|#define PGD_TABLE    (PGD_PRESENT | PGD_RW | PGD_USER | PGD_ACCESSED | PGD_DIRTY)
DECL|function|sun4c_vmalloc_start
r_static
r_int
r_int
id|sun4c_vmalloc_start
c_func
(paren
r_void
)paren
(brace
r_return
id|SUN4C_VMALLOC_START
suffix:semicolon
)brace
DECL|function|sun4c_pte_none
r_static
r_int
id|sun4c_pte_none
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
op_logical_neg
id|pte_val
c_func
(paren
id|pte
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pte_present
r_static
r_int
id|sun4c_pte_present
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
(paren
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
(paren
id|_SUN4C_PAGE_PRESENT
op_or
id|_SUN4C_PAGE_PRIV
)paren
)paren
op_ne
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pte_clear
r_static
r_void
id|sun4c_pte_clear
c_func
(paren
id|pte_t
op_star
id|ptep
)paren
(brace
op_star
id|ptep
op_assign
id|__pte
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pmd_none
r_static
r_int
id|sun4c_pmd_none
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
op_logical_neg
id|pmd_val
c_func
(paren
id|pmd
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pmd_bad
r_static
r_int
id|sun4c_pmd_bad
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
(paren
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
op_complement
id|PAGE_MASK
)paren
op_ne
id|PGD_TABLE
)paren
op_logical_or
(paren
id|MAP_NR
c_func
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
)paren
OG
id|max_mapnr
)paren
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pmd_present
r_static
r_int
id|sun4c_pmd_present
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|PGD_PRESENT
)paren
op_ne
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pmd_clear
r_static
r_void
id|sun4c_pmd_clear
c_func
(paren
id|pmd_t
op_star
id|pmdp
)paren
(brace
op_star
id|pmdp
op_assign
id|__pmd
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pgd_none
r_static
r_int
id|sun4c_pgd_none
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sun4c_pgd_bad
r_static
r_int
id|sun4c_pgd_bad
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sun4c_pgd_present
r_static
r_int
id|sun4c_pgd_present
c_func
(paren
id|pgd_t
id|pgd
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|sun4c_pgd_clear
r_static
r_void
id|sun4c_pgd_clear
c_func
(paren
id|pgd_t
op_star
id|pgdp
)paren
(brace
)brace
multiline_comment|/*&n; * The following only work if pte_present() is true.&n; * Undefined behaviour if not..&n; */
DECL|function|sun4c_pte_write
r_static
r_int
id|sun4c_pte_write
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|_SUN4C_PAGE_WRITE
suffix:semicolon
)brace
DECL|function|sun4c_pte_dirty
r_static
r_int
id|sun4c_pte_dirty
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|_SUN4C_PAGE_MODIFIED
suffix:semicolon
)brace
DECL|function|sun4c_pte_young
r_static
r_int
id|sun4c_pte_young
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|_SUN4C_PAGE_ACCESSED
suffix:semicolon
)brace
DECL|function|sun4c_pte_wrprotect
r_static
id|pte_t
id|sun4c_pte_wrprotect
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
op_complement
(paren
id|_SUN4C_PAGE_WRITE
op_or
id|_SUN4C_PAGE_SILENT_WRITE
)paren
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pte_mkclean
r_static
id|pte_t
id|sun4c_pte_mkclean
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
op_complement
(paren
id|_SUN4C_PAGE_MODIFIED
op_or
id|_SUN4C_PAGE_SILENT_WRITE
)paren
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pte_mkold
r_static
id|pte_t
id|sun4c_pte_mkold
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
op_complement
(paren
id|_SUN4C_PAGE_ACCESSED
op_or
id|_SUN4C_PAGE_SILENT_READ
)paren
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pte_mkwrite
r_static
id|pte_t
id|sun4c_pte_mkwrite
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte
op_assign
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_or
id|_SUN4C_PAGE_WRITE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|_SUN4C_PAGE_MODIFIED
)paren
id|pte
op_assign
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_or
id|_SUN4C_PAGE_SILENT_WRITE
)paren
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|sun4c_pte_mkdirty
r_static
id|pte_t
id|sun4c_pte_mkdirty
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte
op_assign
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_or
id|_SUN4C_PAGE_MODIFIED
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|_SUN4C_PAGE_WRITE
)paren
id|pte
op_assign
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_or
id|_SUN4C_PAGE_SILENT_WRITE
)paren
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
DECL|function|sun4c_pte_mkyoung
r_static
id|pte_t
id|sun4c_pte_mkyoung
c_func
(paren
id|pte_t
id|pte
)paren
(brace
id|pte
op_assign
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_or
id|_SUN4C_PAGE_ACCESSED
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|_SUN4C_PAGE_READ
)paren
id|pte
op_assign
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_or
id|_SUN4C_PAGE_SILENT_READ
)paren
suffix:semicolon
r_return
id|pte
suffix:semicolon
)brace
multiline_comment|/*&n; * Conversion functions: convert a page and protection to a page entry,&n; * and a page entry and page directory to the page they refer to.&n; */
DECL|function|sun4c_mk_pte
r_static
id|pte_t
id|sun4c_mk_pte
c_func
(paren
r_int
r_int
id|page
comma
id|pgprot_t
id|pgprot
)paren
(brace
r_return
id|__pte
c_func
(paren
(paren
(paren
id|page
op_minus
id|PAGE_OFFSET
)paren
op_rshift
id|PAGE_SHIFT
)paren
op_or
id|pgprot_val
c_func
(paren
id|pgprot
)paren
)paren
suffix:semicolon
)brace
DECL|function|sun4c_mk_pte_phys
r_static
id|pte_t
id|sun4c_mk_pte_phys
c_func
(paren
r_int
r_int
id|phys_page
comma
id|pgprot_t
id|pgprot
)paren
(brace
r_return
id|__pte
c_func
(paren
(paren
id|phys_page
op_rshift
id|PAGE_SHIFT
)paren
op_or
id|pgprot_val
c_func
(paren
id|pgprot
)paren
)paren
suffix:semicolon
)brace
DECL|function|sun4c_mk_pte_io
r_static
id|pte_t
id|sun4c_mk_pte_io
c_func
(paren
r_int
r_int
id|page
comma
id|pgprot_t
id|pgprot
comma
r_int
id|space
)paren
(brace
r_return
id|__pte
c_func
(paren
(paren
(paren
id|page
op_minus
id|PAGE_OFFSET
)paren
op_rshift
id|PAGE_SHIFT
)paren
op_or
id|pgprot_val
c_func
(paren
id|pgprot
)paren
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pte_modify
r_static
id|pte_t
id|sun4c_pte_modify
c_func
(paren
id|pte_t
id|pte
comma
id|pgprot_t
id|newprot
)paren
(brace
r_return
id|__pte
c_func
(paren
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|_SUN4C_PAGE_CHG_MASK
)paren
op_or
id|pgprot_val
c_func
(paren
id|newprot
)paren
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pte_page
r_static
r_int
r_int
id|sun4c_pte_page
c_func
(paren
id|pte_t
id|pte
)paren
(brace
r_return
(paren
id|PAGE_OFFSET
op_plus
(paren
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
l_int|0xffff
)paren
op_lshift
(paren
id|PAGE_SHIFT
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pmd_page
r_static
r_int
r_int
id|sun4c_pmd_page
c_func
(paren
id|pmd_t
id|pmd
)paren
(brace
r_return
(paren
id|pmd_val
c_func
(paren
id|pmd
)paren
op_amp
id|PAGE_MASK
)paren
suffix:semicolon
)brace
multiline_comment|/* to find an entry in a page-table-directory */
DECL|function|sun4c_pgd_offset
id|pgd_t
op_star
id|sun4c_pgd_offset
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|address
)paren
(brace
r_return
id|mm-&gt;pgd
op_plus
(paren
id|address
op_rshift
id|SUN4C_PGDIR_SHIFT
)paren
suffix:semicolon
)brace
multiline_comment|/* Find an entry in the second-level page table.. */
DECL|function|sun4c_pmd_offset
r_static
id|pmd_t
op_star
id|sun4c_pmd_offset
c_func
(paren
id|pgd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pmd_t
op_star
)paren
id|dir
suffix:semicolon
)brace
multiline_comment|/* Find an entry in the third-level page table.. */
DECL|function|sun4c_pte_offset
id|pte_t
op_star
id|sun4c_pte_offset
c_func
(paren
id|pmd_t
op_star
id|dir
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pte_t
op_star
)paren
id|sun4c_pmd_page
c_func
(paren
op_star
id|dir
)paren
op_plus
(paren
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|SUN4C_PTRS_PER_PTE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Update the root mmu directory. */
DECL|function|sun4c_update_rootmmu_dir
r_static
r_void
id|sun4c_update_rootmmu_dir
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
id|pgd_t
op_star
id|pgdir
)paren
(brace
)brace
multiline_comment|/* Please take special note on the foo_kernel() routines below, our&n; * fast in window fault handler wants to get at the pte&squot;s for vmalloc&n; * area with traps off, therefore they _MUST_ be locked down to prevent&n; * a watchdog from happening.  It only takes 4 pages of pte&squot;s to lock&n; * down the maximum vmalloc space possible on sun4c so we statically&n; * allocate these page table pieces in the kernel image.  Therefore&n; * we should never have to really allocate or free any kernel page&n; * table information.&n; */
multiline_comment|/* Allocate and free page tables. The xxx_kernel() versions are&n; * used to allocate a kernel page table - this turns on ASN bits&n; * if any, and marks the page tables reserved.&n; */
DECL|function|sun4c_pte_free_kernel
r_static
r_void
id|sun4c_pte_free_kernel
c_func
(paren
id|pte_t
op_star
id|pte
)paren
(brace
multiline_comment|/* This should never get called. */
id|panic
c_func
(paren
l_string|&quot;sun4c_pte_free_kernel called, can&squot;t happen...&quot;
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pte_alloc_kernel
r_static
id|pte_t
op_star
id|sun4c_pte_alloc_kernel
c_func
(paren
id|pmd_t
op_star
id|pmd
comma
r_int
r_int
id|address
)paren
(brace
r_if
c_cond
(paren
id|address
op_ge
id|SUN4C_LOCK_VADDR
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sun4c_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;sun4c_pmd_none for kernel pmd, can&squot;t happen...&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_pmd_bad
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pmd in pte_alloc_kernel: %08lx&bslash;n&quot;
comma
id|pmd_val
c_func
(paren
op_star
id|pmd
)paren
)paren
suffix:semicolon
op_star
id|pmd
op_assign
id|__pmd
c_func
(paren
id|PGD_TABLE
op_or
(paren
r_int
r_int
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pte_t
op_star
)paren
id|sun4c_pmd_page
c_func
(paren
op_star
id|pmd
)paren
op_plus
id|address
suffix:semicolon
)brace
multiline_comment|/*&n; * allocating and freeing a pmd is trivial: the 1-entry pmd is&n; * inside the pgd, so has no extra memory associated with it.&n; */
DECL|function|sun4c_pmd_free_kernel
r_static
r_void
id|sun4c_pmd_free_kernel
c_func
(paren
id|pmd_t
op_star
id|pmd
)paren
(brace
)brace
DECL|function|sun4c_pmd_alloc_kernel
r_static
id|pmd_t
op_star
id|sun4c_pmd_alloc_kernel
c_func
(paren
id|pgd_t
op_star
id|pgd
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pmd_t
op_star
)paren
id|pgd
suffix:semicolon
)brace
DECL|function|sun4c_pte_free
r_static
r_void
id|sun4c_pte_free
c_func
(paren
id|pte_t
op_star
id|pte
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|pte
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pte_alloc
r_static
id|pte_t
op_star
id|sun4c_pte_alloc
c_func
(paren
id|pmd_t
op_star
id|pmd
comma
r_int
r_int
id|address
)paren
(brace
id|address
op_assign
(paren
id|address
op_rshift
id|PAGE_SHIFT
)paren
op_amp
(paren
id|SUN4C_PTRS_PER_PTE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|pte_t
op_star
id|page
op_assign
(paren
id|pte_t
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
r_if
c_cond
(paren
id|page
)paren
(brace
op_star
id|pmd
op_assign
id|__pmd
c_func
(paren
id|PGD_TABLE
op_or
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|page
op_plus
id|address
suffix:semicolon
)brace
op_star
id|pmd
op_assign
id|__pmd
c_func
(paren
id|PGD_TABLE
op_or
(paren
r_int
r_int
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sun4c_pmd_bad
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bad pmd in pte_alloc: %08lx&bslash;n&quot;
comma
id|pmd_val
c_func
(paren
op_star
id|pmd
)paren
)paren
suffix:semicolon
op_star
id|pmd
op_assign
id|__pmd
c_func
(paren
id|PGD_TABLE
op_or
(paren
r_int
r_int
)paren
id|BAD_PAGETABLE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
(paren
id|pte_t
op_star
)paren
id|sun4c_pmd_page
c_func
(paren
op_star
id|pmd
)paren
op_plus
id|address
suffix:semicolon
)brace
multiline_comment|/*&n; * allocating and freeing a pmd is trivial: the 1-entry pmd is&n; * inside the pgd, so has no extra memory associated with it.&n; */
DECL|function|sun4c_pmd_free
r_static
r_void
id|sun4c_pmd_free
c_func
(paren
id|pmd_t
op_star
id|pmd
)paren
(brace
op_star
id|pmd
op_assign
id|__pmd
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pmd_alloc
r_static
id|pmd_t
op_star
id|sun4c_pmd_alloc
c_func
(paren
id|pgd_t
op_star
id|pgd
comma
r_int
r_int
id|address
)paren
(brace
r_return
(paren
id|pmd_t
op_star
)paren
id|pgd
suffix:semicolon
)brace
DECL|function|sun4c_pgd_free
r_static
r_void
id|sun4c_pgd_free
c_func
(paren
id|pgd_t
op_star
id|pgd
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|pgd
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pgd_alloc
r_static
id|pgd_t
op_star
id|sun4c_pgd_alloc
c_func
(paren
r_void
)paren
(brace
r_return
(paren
id|pgd_t
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
multiline_comment|/* There are really two cases of aliases to watch out for, and these&n; * are:&n; *&n; *     1) A user&squot;s page which can be aliased with the kernels virtual&n; *        mapping of the physical page.&n; *&n; *     2) Multiple user mappings of the same inode/anonymous object&n; *        such that two copies of the same data for the same phys page&n; *        can live (writable) in the cache at the same time.&n; *&n; * We handle number 1 by flushing the kernel copy of the page always&n; * after COW page operations.&n; *&n; * NOTE: We are a bit slowed down now because the VMA arg is indeed used&n; *       now, so our ref/mod bit tracking quick userfaults eat a few more&n; *       cycles than they used to.&n; */
DECL|function|sun4c_update_mmu_cache
r_void
id|sun4c_update_mmu_cache
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|address
comma
id|pte_t
id|pte
)paren
(brace
r_int
r_int
id|offset
comma
id|vaddr
comma
id|start
comma
id|flags
suffix:semicolon
id|pgd_t
op_star
id|pgdp
suffix:semicolon
id|pte_t
op_star
id|ptep
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|address
op_and_assign
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
id|sun4c_get_segmap
c_func
(paren
id|address
)paren
op_eq
id|invalid_segment
)paren
(brace
id|alloc_user_segment
c_func
(paren
id|address
comma
id|sun4c_get_context
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|vma-&gt;vm_flags
op_amp
(paren
id|VM_WRITE
op_or
id|VM_SHARED
)paren
)paren
op_eq
(paren
id|VM_WRITE
op_or
id|VM_SHARED
)paren
)paren
(brace
r_struct
id|vm_area_struct
op_star
id|vmaring
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_int
id|alias_found
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* While on the other hand, this is very uncommon... */
id|inode
op_assign
id|vma-&gt;vm_inode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
r_goto
id|done
suffix:semicolon
)brace
id|offset
op_assign
(paren
id|address
op_amp
id|PAGE_MASK
)paren
op_minus
id|vma-&gt;vm_start
suffix:semicolon
id|vmaring
op_assign
id|inode-&gt;i_mmap
suffix:semicolon
r_do
(brace
id|vaddr
op_assign
id|vmaring-&gt;vm_start
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|S4CVAC_BADALIAS
c_func
(paren
id|vaddr
comma
id|address
)paren
)paren
(brace
id|alias_found
op_increment
suffix:semicolon
id|start
op_assign
id|vmaring-&gt;vm_start
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|vmaring-&gt;vm_end
)paren
(brace
id|pgdp
op_assign
id|sun4c_pgd_offset
c_func
(paren
id|vmaring-&gt;vm_mm
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pgdp
)paren
(brace
r_goto
id|next
suffix:semicolon
)brace
id|ptep
op_assign
id|sun4c_pte_offset
c_func
(paren
(paren
id|pmd_t
op_star
)paren
id|pgdp
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ptep
)paren
(brace
r_goto
id|next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_amp
id|_SUN4C_PAGE_PRESENT
)paren
(brace
macro_line|#if 1
id|printk
c_func
(paren
l_string|&quot;Fixing USER/USER alias [%d:%08lx]&bslash;n&quot;
comma
id|vmaring-&gt;vm_mm-&gt;context
comma
id|start
)paren
suffix:semicolon
macro_line|#endif
id|sun4c_flush_cache_page
c_func
(paren
id|vmaring
comma
id|start
)paren
suffix:semicolon
op_star
id|ptep
op_assign
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_or
id|_SUN4C_PAGE_NOCACHE
)paren
suffix:semicolon
id|sun4c_flush_tlb_page
c_func
(paren
id|vmaring
comma
id|start
)paren
suffix:semicolon
)brace
id|next
suffix:colon
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
)brace
r_while
c_loop
(paren
(paren
id|vmaring
op_assign
id|vmaring-&gt;vm_next_share
)paren
op_ne
id|inode-&gt;i_mmap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|alias_found
op_logical_and
op_logical_neg
(paren
id|pte_val
c_func
(paren
id|pte
)paren
op_amp
id|_SUN4C_PAGE_NOCACHE
)paren
)paren
(brace
id|pgdp
op_assign
id|sun4c_pgd_offset
c_func
(paren
id|vma-&gt;vm_mm
comma
id|address
)paren
suffix:semicolon
id|ptep
op_assign
id|sun4c_pte_offset
c_func
(paren
(paren
id|pmd_t
op_star
)paren
id|pgdp
comma
id|address
)paren
suffix:semicolon
op_star
id|ptep
op_assign
id|__pte
c_func
(paren
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
op_or
id|_SUN4C_PAGE_NOCACHE
)paren
suffix:semicolon
id|pte
op_assign
id|pte_val
c_func
(paren
op_star
id|ptep
)paren
suffix:semicolon
)brace
)brace
id|done
suffix:colon
id|sun4c_put_pte
c_func
(paren
id|address
comma
id|pte_val
c_func
(paren
id|pte
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sun4c_pgd_flush
r_static
r_void
id|sun4c_pgd_flush
c_func
(paren
id|pgd_t
op_star
id|pgdp
)paren
(brace
)brace
r_extern
r_int
r_int
id|free_area_init
c_func
(paren
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
r_int
id|sparc_context_init
c_func
(paren
r_int
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
r_int
id|end
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
r_int
id|sun4c_paging_init
c_func
(paren
r_int
r_int
id|start_mem
comma
r_int
r_int
id|end_mem
)paren
)paren
(brace
r_int
id|i
comma
id|cnt
suffix:semicolon
r_int
r_int
id|kernel_end
comma
id|vaddr
suffix:semicolon
r_extern
r_int
r_int
id|sparc_iobase_vaddr
suffix:semicolon
id|kernel_end
op_assign
(paren
r_int
r_int
)paren
op_amp
id|end
suffix:semicolon
id|kernel_end
op_add_assign
(paren
id|SUN4C_REAL_PGDIR_SIZE
op_star
l_int|3
)paren
suffix:semicolon
id|kernel_end
op_assign
id|SUN4C_REAL_PGDIR_ALIGN
c_func
(paren
id|kernel_end
)paren
suffix:semicolon
id|sun4c_probe_mmu
c_func
(paren
)paren
suffix:semicolon
id|invalid_segment
op_assign
(paren
id|num_segmaps
op_minus
l_int|1
)paren
suffix:semicolon
id|sun4c_init_mmu_entry_pool
c_func
(paren
)paren
suffix:semicolon
id|sun4c_init_rings
c_func
(paren
op_amp
id|start_mem
)paren
suffix:semicolon
id|sun4c_init_map_kernelprom
c_func
(paren
id|kernel_end
)paren
suffix:semicolon
id|sun4c_init_clean_mmu
c_func
(paren
id|kernel_end
)paren
suffix:semicolon
id|sun4c_init_fill_kernel_ring
c_func
(paren
id|SUN4C_KERNEL_BUCKETS
)paren
suffix:semicolon
id|sun4c_init_lock_area
c_func
(paren
id|sparc_iobase_vaddr
comma
id|IOBASE_END
)paren
suffix:semicolon
id|sun4c_init_lock_area
c_func
(paren
id|DVMA_VADDR
comma
id|DVMA_END
)paren
suffix:semicolon
id|start_mem
op_assign
id|sun4c_init_lock_areas
c_func
(paren
id|start_mem
)paren
suffix:semicolon
id|sun4c_init_fill_user_ring
c_func
(paren
)paren
suffix:semicolon
id|sun4c_set_context
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|memset
c_func
(paren
id|swapper_pg_dir
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|memset
c_func
(paren
id|pg0
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|memset
c_func
(paren
id|pg1
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|memset
c_func
(paren
id|pg2
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|memset
c_func
(paren
id|pg3
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
multiline_comment|/* Save work later. */
id|vaddr
op_assign
id|SUN4C_VMALLOC_START
suffix:semicolon
id|swapper_pg_dir
(braket
id|vaddr
op_rshift
id|SUN4C_PGDIR_SHIFT
)braket
op_assign
id|__pgd
c_func
(paren
id|PGD_TABLE
op_or
(paren
r_int
r_int
)paren
id|pg0
)paren
suffix:semicolon
id|vaddr
op_add_assign
id|SUN4C_PGDIR_SIZE
suffix:semicolon
id|swapper_pg_dir
(braket
id|vaddr
op_rshift
id|SUN4C_PGDIR_SHIFT
)braket
op_assign
id|__pgd
c_func
(paren
id|PGD_TABLE
op_or
(paren
r_int
r_int
)paren
id|pg1
)paren
suffix:semicolon
id|vaddr
op_add_assign
id|SUN4C_PGDIR_SIZE
suffix:semicolon
id|swapper_pg_dir
(braket
id|vaddr
op_rshift
id|SUN4C_PGDIR_SHIFT
)braket
op_assign
id|__pgd
c_func
(paren
id|PGD_TABLE
op_or
(paren
r_int
r_int
)paren
id|pg2
)paren
suffix:semicolon
id|vaddr
op_add_assign
id|SUN4C_PGDIR_SIZE
suffix:semicolon
id|swapper_pg_dir
(braket
id|vaddr
op_rshift
id|SUN4C_PGDIR_SHIFT
)braket
op_assign
id|__pgd
c_func
(paren
id|PGD_TABLE
op_or
(paren
r_int
r_int
)paren
id|pg3
)paren
suffix:semicolon
id|sun4c_init_ss2_cache_bug
c_func
(paren
)paren
suffix:semicolon
id|start_mem
op_assign
id|PAGE_ALIGN
c_func
(paren
id|start_mem
)paren
suffix:semicolon
id|start_mem
op_assign
id|sparc_context_init
c_func
(paren
id|start_mem
comma
id|num_contexts
)paren
suffix:semicolon
id|start_mem
op_assign
id|free_area_init
c_func
(paren
id|start_mem
comma
id|end_mem
)paren
suffix:semicolon
id|cnt
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_segmaps
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mmu_entry_pool
(braket
id|i
)braket
dot
id|locked
)paren
(brace
id|cnt
op_increment
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;SUN4C: %d mmu entries for the kernel&bslash;n&quot;
comma
id|cnt
)paren
suffix:semicolon
r_return
id|start_mem
suffix:semicolon
)brace
multiline_comment|/* Load up routines and constants for sun4c mmu */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|ld_mmu_sun4c
c_func
(paren
r_void
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Loading sun4c MMU routines&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* First the constants */
id|pmd_shift
op_assign
id|SUN4C_PMD_SHIFT
suffix:semicolon
id|pmd_size
op_assign
id|SUN4C_PMD_SIZE
suffix:semicolon
id|pmd_mask
op_assign
id|SUN4C_PMD_MASK
suffix:semicolon
id|pgdir_shift
op_assign
id|SUN4C_PGDIR_SHIFT
suffix:semicolon
id|pgdir_size
op_assign
id|SUN4C_PGDIR_SIZE
suffix:semicolon
id|pgdir_mask
op_assign
id|SUN4C_PGDIR_MASK
suffix:semicolon
id|ptrs_per_pte
op_assign
id|SUN4C_PTRS_PER_PTE
suffix:semicolon
id|ptrs_per_pmd
op_assign
id|SUN4C_PTRS_PER_PMD
suffix:semicolon
id|ptrs_per_pgd
op_assign
id|SUN4C_PTRS_PER_PGD
suffix:semicolon
id|page_none
op_assign
id|SUN4C_PAGE_NONE
suffix:semicolon
id|page_shared
op_assign
id|SUN4C_PAGE_SHARED
suffix:semicolon
id|page_copy
op_assign
id|SUN4C_PAGE_COPY
suffix:semicolon
id|page_readonly
op_assign
id|SUN4C_PAGE_READONLY
suffix:semicolon
id|page_kernel
op_assign
id|SUN4C_PAGE_KERNEL
suffix:semicolon
id|pg_iobits
op_assign
id|_SUN4C_PAGE_PRESENT
op_or
id|_SUN4C_READABLE
op_or
id|_SUN4C_WRITEABLE
op_or
id|_SUN4C_PAGE_IO
op_or
id|_SUN4C_PAGE_NOCACHE
suffix:semicolon
multiline_comment|/* Functions */
id|flush_cache_all
op_assign
id|sun4c_flush_cache_all
suffix:semicolon
id|flush_cache_mm
op_assign
id|sun4c_flush_cache_mm
suffix:semicolon
id|flush_cache_range
op_assign
id|sun4c_flush_cache_range
suffix:semicolon
id|flush_cache_page
op_assign
id|sun4c_flush_cache_page
suffix:semicolon
id|flush_tlb_all
op_assign
id|sun4c_flush_tlb_all
suffix:semicolon
id|flush_tlb_mm
op_assign
id|sun4c_flush_tlb_mm
suffix:semicolon
id|flush_tlb_range
op_assign
id|sun4c_flush_tlb_range
suffix:semicolon
id|flush_tlb_page
op_assign
id|sun4c_flush_tlb_page
suffix:semicolon
id|flush_page_to_ram
op_assign
id|sun4c_flush_page_to_ram
suffix:semicolon
id|flush_sig_insns
op_assign
id|sun4c_flush_sig_insns
suffix:semicolon
id|set_pte
op_assign
id|sun4c_set_pte
suffix:semicolon
id|switch_to_context
op_assign
id|sun4c_switch_to_context
suffix:semicolon
id|pmd_align
op_assign
id|sun4c_pmd_align
suffix:semicolon
id|pgdir_align
op_assign
id|sun4c_pgdir_align
suffix:semicolon
id|vmalloc_start
op_assign
id|sun4c_vmalloc_start
suffix:semicolon
id|pte_page
op_assign
id|sun4c_pte_page
suffix:semicolon
id|pmd_page
op_assign
id|sun4c_pmd_page
suffix:semicolon
id|sparc_update_rootmmu_dir
op_assign
id|sun4c_update_rootmmu_dir
suffix:semicolon
id|pte_none
op_assign
id|sun4c_pte_none
suffix:semicolon
id|pte_present
op_assign
id|sun4c_pte_present
suffix:semicolon
id|pte_clear
op_assign
id|sun4c_pte_clear
suffix:semicolon
id|pmd_none
op_assign
id|sun4c_pmd_none
suffix:semicolon
id|pmd_bad
op_assign
id|sun4c_pmd_bad
suffix:semicolon
id|pmd_present
op_assign
id|sun4c_pmd_present
suffix:semicolon
id|pmd_clear
op_assign
id|sun4c_pmd_clear
suffix:semicolon
id|pgd_none
op_assign
id|sun4c_pgd_none
suffix:semicolon
id|pgd_bad
op_assign
id|sun4c_pgd_bad
suffix:semicolon
id|pgd_present
op_assign
id|sun4c_pgd_present
suffix:semicolon
id|pgd_clear
op_assign
id|sun4c_pgd_clear
suffix:semicolon
id|mk_pte
op_assign
id|sun4c_mk_pte
suffix:semicolon
id|mk_pte_phys
op_assign
id|sun4c_mk_pte_phys
suffix:semicolon
id|mk_pte_io
op_assign
id|sun4c_mk_pte_io
suffix:semicolon
id|pte_modify
op_assign
id|sun4c_pte_modify
suffix:semicolon
id|pgd_offset
op_assign
id|sun4c_pgd_offset
suffix:semicolon
id|pmd_offset
op_assign
id|sun4c_pmd_offset
suffix:semicolon
id|pte_offset
op_assign
id|sun4c_pte_offset
suffix:semicolon
id|pte_free_kernel
op_assign
id|sun4c_pte_free_kernel
suffix:semicolon
id|pmd_free_kernel
op_assign
id|sun4c_pmd_free_kernel
suffix:semicolon
id|pte_alloc_kernel
op_assign
id|sun4c_pte_alloc_kernel
suffix:semicolon
id|pmd_alloc_kernel
op_assign
id|sun4c_pmd_alloc_kernel
suffix:semicolon
id|pte_free
op_assign
id|sun4c_pte_free
suffix:semicolon
id|pte_alloc
op_assign
id|sun4c_pte_alloc
suffix:semicolon
id|pmd_free
op_assign
id|sun4c_pmd_free
suffix:semicolon
id|pmd_alloc
op_assign
id|sun4c_pmd_alloc
suffix:semicolon
id|pgd_free
op_assign
id|sun4c_pgd_free
suffix:semicolon
id|pgd_alloc
op_assign
id|sun4c_pgd_alloc
suffix:semicolon
id|pgd_flush
op_assign
id|sun4c_pgd_flush
suffix:semicolon
id|pte_write
op_assign
id|sun4c_pte_write
suffix:semicolon
id|pte_dirty
op_assign
id|sun4c_pte_dirty
suffix:semicolon
id|pte_young
op_assign
id|sun4c_pte_young
suffix:semicolon
id|pte_wrprotect
op_assign
id|sun4c_pte_wrprotect
suffix:semicolon
id|pte_mkclean
op_assign
id|sun4c_pte_mkclean
suffix:semicolon
id|pte_mkold
op_assign
id|sun4c_pte_mkold
suffix:semicolon
id|pte_mkwrite
op_assign
id|sun4c_pte_mkwrite
suffix:semicolon
id|pte_mkdirty
op_assign
id|sun4c_pte_mkdirty
suffix:semicolon
id|pte_mkyoung
op_assign
id|sun4c_pte_mkyoung
suffix:semicolon
id|update_mmu_cache
op_assign
id|sun4c_update_mmu_cache
suffix:semicolon
id|mmu_exit_hook
op_assign
id|sun4c_exit_hook
suffix:semicolon
id|mmu_flush_hook
op_assign
id|sun4c_flush_hook
suffix:semicolon
id|mmu_lockarea
op_assign
id|sun4c_lockarea
suffix:semicolon
id|mmu_unlockarea
op_assign
id|sun4c_unlockarea
suffix:semicolon
id|mmu_get_scsi_one
op_assign
id|sun4c_get_scsi_one
suffix:semicolon
id|mmu_get_scsi_sgl
op_assign
id|sun4c_get_scsi_sgl
suffix:semicolon
id|mmu_release_scsi_one
op_assign
id|sun4c_release_scsi_one
suffix:semicolon
id|mmu_release_scsi_sgl
op_assign
id|sun4c_release_scsi_sgl
suffix:semicolon
id|mmu_map_dma_area
op_assign
id|sun4c_map_dma_area
suffix:semicolon
id|mmu_v2p
op_assign
id|sun4c_v2p
suffix:semicolon
id|mmu_p2v
op_assign
id|sun4c_p2v
suffix:semicolon
multiline_comment|/* Task struct and kernel stack allocating/freeing. */
id|alloc_kernel_stack
op_assign
id|sun4c_alloc_kernel_stack
suffix:semicolon
id|alloc_task_struct
op_assign
id|sun4c_alloc_task_struct
suffix:semicolon
id|free_kernel_stack
op_assign
id|sun4c_free_kernel_stack
suffix:semicolon
id|free_task_struct
op_assign
id|sun4c_free_task_struct
suffix:semicolon
id|quick_kernel_fault
op_assign
id|sun4c_quick_kernel_fault
suffix:semicolon
id|mmu_info
op_assign
id|sun4c_mmu_info
suffix:semicolon
multiline_comment|/* These should _never_ get called with two level tables. */
id|pgd_set
op_assign
l_int|0
suffix:semicolon
id|pgd_page
op_assign
l_int|0
suffix:semicolon
)brace
eof
