multiline_comment|/* $Id: init_me.c,v 1.2 1995/11/25 00:57:44 davem Exp $&n; * init_me.c:  Initialize imperical constants and gather some info from&n; *             the boot prom.&n; *&n; * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;asm/openprom.h&gt;  /* For property declarations and the prom structs */
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/vac-ops.h&gt;
macro_line|#include &quot;imperical.h&quot;   /* Don&squot;t ask... */
DECL|macro|DEBUG_INIT_ME
mdefine_line|#define DEBUG_INIT_ME    /* Tell me whats goin on */
DECL|variable|nwindows
r_int
r_int
id|nwindows
suffix:semicolon
multiline_comment|/* Set in bare.S */
DECL|variable|nwindowsm1
r_int
r_int
id|nwindowsm1
suffix:semicolon
DECL|variable|pac_or_vac
r_int
r_int
id|pac_or_vac
suffix:semicolon
multiline_comment|/* 0 means &quot;dunno&quot; 1 means &quot;VAC&quot; 2 means &quot;PAC&quot; */
DECL|variable|pvac_size
r_int
r_int
id|pvac_size
suffix:semicolon
multiline_comment|/* Use the same two variables for a PAC and VAC */
DECL|variable|pvac_linesize
r_int
r_int
id|pvac_linesize
suffix:semicolon
DECL|variable|pac_size
r_int
r_int
id|pac_size
suffix:semicolon
DECL|variable|num_segmaps
r_int
id|num_segmaps
suffix:semicolon
DECL|variable|num_contexts
r_int
id|num_contexts
suffix:semicolon
DECL|variable|BOGOMIPS
r_int
r_int
id|BOGOMIPS
suffix:semicolon
multiline_comment|/* bogosity without the VAC cache on */
DECL|variable|BOGOMIPS_WCACHE
r_int
r_int
id|BOGOMIPS_WCACHE
suffix:semicolon
multiline_comment|/* bogosity with the VAC cache */
DECL|variable|delay_factor
r_int
r_int
id|delay_factor
suffix:semicolon
r_extern
r_int
id|prom_node_root
suffix:semicolon
DECL|variable|printk
r_void
(paren
op_star
id|printk
)paren
(paren
r_const
r_char
op_star
id|str
comma
dot
dot
dot
)paren
suffix:semicolon
DECL|function|init_me
r_void
id|init_me
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|grrr
suffix:semicolon
id|printk
op_assign
id|romvec-&gt;pv_printf
suffix:semicolon
id|prom_node_root
op_assign
id|prom_nextnode
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|prom_getprop
c_func
(paren
id|prom_node_root
comma
l_string|&quot;mmu-npmg&quot;
comma
op_amp
id|num_segmaps
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|pvac_size
op_assign
id|prom_getint_default
c_func
(paren
id|prom_node_root
comma
l_string|&quot;vac-size&quot;
comma
l_int|65536
)paren
suffix:semicolon
id|pvac_linesize
op_assign
id|prom_getint_default
c_func
(paren
id|prom_node_root
comma
l_string|&quot;vac-linesize&quot;
comma
l_int|16
)paren
suffix:semicolon
id|grrr
op_assign
id|prom_getint_default
c_func
(paren
id|prom_node_root
comma
l_string|&quot;mips-on&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|grrr
)paren
(brace
id|grrr
op_assign
id|prom_getint_default
c_func
(paren
id|prom_node_root
comma
l_string|&quot;clock-frequency&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|grrr
OG
l_int|15000000
op_logical_and
id|grrr
OL
l_int|100000000
)paren
(brace
id|BOGOMIPS
op_assign
l_int|3
suffix:semicolon
id|BOGOMIPS_WCACHE
op_assign
id|grrr
op_div
l_int|1000000
suffix:semicolon
)brace
r_else
(brace
id|BOGOMIPS
op_assign
id|DEF_BOGO
suffix:semicolon
id|BOGOMIPS_WCACHE
op_assign
id|DEF_BOGO
suffix:semicolon
)brace
)brace
r_else
(paren
id|BOGOMIPS_WCACHE
op_assign
id|grrr
comma
id|BOGOMIPS
op_assign
id|prom_getint
c_func
(paren
id|prom_node_root
comma
l_string|&quot;mips-off&quot;
)paren
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_INIT_ME
(paren
op_star
(paren
id|romvec-&gt;pv_printf
)paren
)paren
(paren
l_string|&quot;&bslash;nBOGOMIPS        %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|BOGOMIPS
)paren
suffix:semicolon
(paren
op_star
(paren
id|romvec-&gt;pv_printf
)paren
)paren
(paren
l_string|&quot;BOGOMIPS_WCACHE %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|BOGOMIPS_WCACHE
)paren
suffix:semicolon
(paren
op_star
(paren
id|romvec-&gt;pv_printf
)paren
)paren
(paren
l_string|&quot;pvac_size        %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|pvac_size
)paren
suffix:semicolon
(paren
op_star
(paren
id|romvec-&gt;pv_printf
)paren
)paren
(paren
l_string|&quot;pvac_linesize    %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|pvac_linesize
)paren
suffix:semicolon
(paren
op_star
(paren
id|romvec-&gt;pv_printf
)paren
)paren
(paren
l_string|&quot;num_segmaps     %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|num_segmaps
)paren
suffix:semicolon
macro_line|#endif
id|delay_factor
op_assign
(paren
id|BOGOMIPS
OG
l_int|3
)paren
ques
c_cond
(paren
(paren
id|BOGOMIPS
op_minus
l_int|2
)paren
op_rshift
l_int|1
)paren
suffix:colon
l_int|11
suffix:semicolon
(paren
op_star
(paren
id|romvec-&gt;pv_printf
)paren
)paren
(paren
l_string|&quot;&bslash;nLILO: &bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
