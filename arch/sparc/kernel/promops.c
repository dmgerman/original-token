multiline_comment|/* promops.c:  Prom node tree operations and Prom Vector initialization&n; *             initialization routines.&n; *&n; * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
DECL|macro|DEBUG_PROMOPS
mdefine_line|#define DEBUG_PROMOPS
DECL|macro|MAX_PR_LEN
mdefine_line|#define MAX_PR_LEN   16           /* exotic hardware probably overshoots this */
DECL|variable|prom_node_root
r_int
id|prom_node_root
suffix:semicolon
multiline_comment|/* initialized in init_prom */
r_extern
r_struct
id|linux_romvec
op_star
id|romvec
suffix:semicolon
multiline_comment|/* These two functions return and siblings and direct child descendents&n; * in the prom device tree respectively.&n; */
r_int
DECL|function|node_get_sibling
id|node_get_sibling
c_func
(paren
r_int
id|node
)paren
(brace
r_return
(paren
op_star
(paren
id|romvec-&gt;pv_nodeops-&gt;no_nextnode
)paren
)paren
(paren
id|node
)paren
suffix:semicolon
)brace
r_int
DECL|function|node_get_child
id|node_get_child
c_func
(paren
r_int
id|node
)paren
(brace
r_return
(paren
op_star
(paren
id|romvec-&gt;pv_nodeops-&gt;no_child
)paren
)paren
(paren
id|node
)paren
suffix:semicolon
)brace
multiline_comment|/* The following routine is used during device probing to determine&n; * an integer value property about a (perhaps virtual) device. This&n; * could be anything, like the size of the mmu cache lines, etc.&n; * the default return value is -1 is the prom has nothing interesting.&n; */
r_int
r_int
op_star
DECL|function|get_int_from_prom
id|get_int_from_prom
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|nd_prop
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_int
r_int
id|pr_len
suffix:semicolon
op_star
id|value
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* duh, I was returning -1 as an unsigned int, prom_panic() */
id|pr_len
op_assign
id|romvec-&gt;pv_nodeops
op_member_access_from_pointer
id|no_proplen
c_func
(paren
id|node
comma
id|nd_prop
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pr_len
OG
id|MAX_PR_LEN
)paren
(brace
macro_line|#ifdef DEBUG_PROMOPS
id|printk
c_func
(paren
l_string|&quot;Bad pr_len in promops -- node: %d nd_prop: %s pr_len: %d&quot;
comma
id|node
comma
id|nd_prop
comma
(paren
r_int
)paren
id|pr_len
)paren
suffix:semicolon
macro_line|#endif
r_return
id|value
suffix:semicolon
multiline_comment|/* XXX */
)brace
id|romvec-&gt;pv_nodeops
op_member_access_from_pointer
id|no_getprop
c_func
(paren
id|node
comma
id|nd_prop
comma
(paren
r_char
op_star
)paren
id|value
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/* This routine returns what is termed a property string as opposed&n; * to a property integer as above. This can be used to extract the&n; * &squot;type&squot; of device from the prom. An example could be the clock timer&n; * chip type. By default you get returned a null string if garbage&n; * is returned from the prom.&n; */
r_char
op_star
DECL|function|get_str_from_prom
id|get_str_from_prom
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|nd_prop
comma
r_char
op_star
id|value
)paren
(brace
r_int
r_int
id|pr_len
suffix:semicolon
op_star
id|value
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|pr_len
op_assign
id|romvec-&gt;pv_nodeops
op_member_access_from_pointer
id|no_proplen
c_func
(paren
id|node
comma
id|nd_prop
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pr_len
OG
id|MAX_PR_LEN
)paren
(brace
macro_line|#ifdef DEBUG_PROMOPS
id|printk
c_func
(paren
l_string|&quot;Bad pr_len in promops -- node: %d nd_prop: %s pr_len: %d&quot;
comma
id|node
comma
id|nd_prop
comma
id|pr_len
)paren
suffix:semicolon
macro_line|#endif
r_return
id|value
suffix:semicolon
multiline_comment|/* XXX */
)brace
id|romvec-&gt;pv_nodeops
op_member_access_from_pointer
id|no_getprop
c_func
(paren
id|node
comma
id|nd_prop
comma
id|value
)paren
suffix:semicolon
id|value
(braket
id|pr_len
)braket
op_assign
l_int|0
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/* This gets called from head.S upon bootup to initialize the&n; * prom vector pointer for the rest of the kernel.&n; */
r_void
DECL|function|init_prom
id|init_prom
c_func
(paren
r_struct
id|linux_romvec
op_star
id|r_ptr
)paren
(brace
id|romvec
op_assign
id|r_ptr
suffix:semicolon
id|prom_node_root
op_assign
id|romvec-&gt;pv_nodeops
op_member_access_from_pointer
id|no_nextnode
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
