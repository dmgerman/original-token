multiline_comment|/* probe.c: Preliminary device tree probing routines...&n;&n;   Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n;*/
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/vac-ops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/vaddrs.h&gt;
macro_line|#include &lt;asm/param.h&gt;
macro_line|#include &lt;asm/clock.h&gt;
macro_line|#include &lt;asm/system.h&gt;
multiline_comment|/* #define DEBUG_PROBING */
DECL|variable|promstr_buf
r_char
id|promstr_buf
(braket
l_int|64
)braket
suffix:semicolon
multiline_comment|/* overkill */
DECL|variable|promint_buf
r_int
r_int
id|promint_buf
(braket
l_int|1
)braket
suffix:semicolon
r_extern
r_int
id|prom_node_root
suffix:semicolon
r_extern
r_int
id|num_segmaps
comma
id|num_contexts
suffix:semicolon
r_extern
r_int
id|node_get_sibling
c_func
(paren
r_int
id|node
)paren
suffix:semicolon
r_extern
r_int
id|node_get_child
c_func
(paren
r_int
id|node
)paren
suffix:semicolon
r_extern
r_char
op_star
id|get_str_from_prom
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
comma
r_char
op_star
id|value
)paren
suffix:semicolon
r_extern
r_int
r_int
op_star
id|get_int_from_prom
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
comma
r_int
r_int
op_star
id|value
)paren
suffix:semicolon
DECL|variable|first_descent
r_int
id|first_descent
suffix:semicolon
multiline_comment|/* Cpu-type information and manufacturer strings */
DECL|struct|cpu_iu_info
r_struct
id|cpu_iu_info
(brace
DECL|member|psr_impl
r_int
id|psr_impl
suffix:semicolon
DECL|member|psr_vers
r_int
id|psr_vers
suffix:semicolon
DECL|member|cpu_name
r_char
op_star
id|cpu_name
suffix:semicolon
multiline_comment|/* should be enough I hope... */
)brace
suffix:semicolon
DECL|struct|cpu_fp_info
r_struct
id|cpu_fp_info
(brace
DECL|member|psr_impl
r_int
id|psr_impl
suffix:semicolon
DECL|member|fp_vers
r_int
id|fp_vers
suffix:semicolon
DECL|member|fp_name
r_char
op_star
id|fp_name
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|linux_sparc_fpu
r_struct
id|cpu_fp_info
id|linux_sparc_fpu
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_string|&quot;Fujitsu MB86910 or Weitek WTL1164/5&quot;
)brace
comma
(brace
l_int|0
comma
l_int|1
comma
l_string|&quot;Fujitsu MB86911 or Weitek WTL1164/5&quot;
)brace
comma
(brace
l_int|0
comma
l_int|2
comma
l_string|&quot;LSI Logic L64802 or Texas Instruments ACT8847&quot;
)brace
comma
(brace
l_int|0
comma
l_int|3
comma
l_string|&quot;Weitek WTL3170/2&quot;
)brace
comma
(brace
l_int|0
comma
l_int|4
comma
l_string|&quot;Lsi Logic/Meiko L64804&quot;
)brace
comma
(brace
l_int|0
comma
l_int|5
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|0
comma
l_int|6
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|0
comma
l_int|7
comma
l_string|&quot;No FPU&quot;
)brace
comma
(brace
l_int|1
comma
l_int|0
comma
l_string|&quot;Lsi Logic L64812 or Texas Instruments ACT8847&quot;
)brace
comma
(brace
l_int|1
comma
l_int|1
comma
l_string|&quot;Lsi Logic L64814&quot;
)brace
comma
(brace
l_int|1
comma
l_int|2
comma
l_string|&quot;Texas Instruments TMS390-C602A&quot;
)brace
comma
(brace
l_int|1
comma
l_int|3
comma
l_string|&quot;Weitek WTL3171&quot;
)brace
comma
(brace
l_int|1
comma
l_int|4
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|1
comma
l_int|5
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|1
comma
l_int|6
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|1
comma
l_int|7
comma
l_string|&quot;No FPU&quot;
)brace
comma
(brace
l_int|2
comma
l_int|0
comma
l_string|&quot;BIT B5010 or B5110/20 or B5210&quot;
)brace
comma
(brace
l_int|2
comma
l_int|1
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|2
comma
l_int|2
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|2
comma
l_int|3
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|2
comma
l_int|4
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|2
comma
l_int|5
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|2
comma
l_int|6
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|2
comma
l_int|7
comma
l_string|&quot;No FPU&quot;
)brace
comma
(brace
l_int|5
comma
l_int|0
comma
l_string|&quot;Matsushita MN10501&quot;
)brace
comma
(brace
l_int|5
comma
l_int|1
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|5
comma
l_int|2
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|5
comma
l_int|3
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|5
comma
l_int|4
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|5
comma
l_int|5
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|5
comma
l_int|6
comma
l_string|&quot;reserved&quot;
)brace
comma
(brace
l_int|5
comma
l_int|7
comma
l_string|&quot;No FPU&quot;
)brace
comma
)brace
suffix:semicolon
DECL|variable|linux_sparc_chips
r_struct
id|cpu_iu_info
id|linux_sparc_chips
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_string|&quot;Fujitsu Microelectronics, Inc. - MB86900/1A&quot;
)brace
comma
(brace
l_int|1
comma
l_int|0
comma
l_string|&quot;Cypress CY7C601&quot;
)brace
comma
(brace
l_int|1
comma
l_int|1
comma
l_string|&quot;LSI Logic Corporation - L64811&quot;
)brace
comma
(brace
l_int|1
comma
l_int|3
comma
l_string|&quot;Cypress CY7C611&quot;
)brace
comma
(brace
l_int|2
comma
l_int|0
comma
l_string|&quot;Bipolar Integrated Technology - B5010&quot;
)brace
comma
(brace
l_int|3
comma
l_int|0
comma
l_string|&quot;LSI Logic Corporation - unknown-type&quot;
)brace
comma
(brace
l_int|4
comma
l_int|0
comma
l_string|&quot;Texas Instruments, Inc. - unknown&quot;
)brace
comma
(brace
l_int|4
comma
l_int|1
comma
l_string|&quot;Texas Instruments, Inc. - Sparc Classic&quot;
)brace
comma
(brace
l_int|4
comma
l_int|2
comma
l_string|&quot;Texas Instruments, Inc. - unknown&quot;
)brace
comma
(brace
l_int|4
comma
l_int|3
comma
l_string|&quot;Texas Instruments, Inc. - unknown&quot;
)brace
comma
(brace
l_int|4
comma
l_int|4
comma
l_string|&quot;Texas Instruments, Inc. - unknown&quot;
)brace
comma
(brace
l_int|4
comma
l_int|5
comma
l_string|&quot;Texas Instruments, Inc. - unknown&quot;
)brace
comma
(brace
l_int|5
comma
l_int|0
comma
l_string|&quot;Matsushita - MN10501&quot;
)brace
comma
(brace
l_int|6
comma
l_int|0
comma
l_string|&quot;Philips Corporation - unknown&quot;
)brace
comma
(brace
l_int|7
comma
l_int|0
comma
l_string|&quot;Harvest VLSI Design Center, Inc. - unknown&quot;
)brace
comma
(brace
l_int|8
comma
l_int|0
comma
l_string|&quot;Systems and Processes Engineering Corporation (SPEC)&quot;
)brace
comma
(brace
l_int|9
comma
l_int|0
comma
l_string|&quot;UNKNOWN CPU-VENDOR/TYPE&quot;
)brace
comma
(brace
l_int|0xa
comma
l_int|0
comma
l_string|&quot;UNKNOWN CPU-VENDOR/TYPE&quot;
)brace
comma
(brace
l_int|0xb
comma
l_int|0
comma
l_string|&quot;UNKNOWN CPU-VENDOR/TYPE&quot;
)brace
comma
(brace
l_int|0xc
comma
l_int|0
comma
l_string|&quot;UNKNOWN CPU-VENDOR/TYPE&quot;
)brace
comma
(brace
l_int|0xd
comma
l_int|0
comma
l_string|&quot;UNKNOWN CPU-VENDOR/TYPE&quot;
)brace
comma
(brace
l_int|0xe
comma
l_int|0
comma
l_string|&quot;UNKNOWN CPU-VENDOR/TYPE&quot;
)brace
comma
(brace
l_int|0xf
comma
l_int|0
comma
l_string|&quot;UNKNOWN CPU-VENDOR/TYPE&quot;
)brace
comma
)brace
suffix:semicolon
DECL|variable|sparc_cpu_type
r_char
op_star
id|sparc_cpu_type
op_assign
l_string|&quot;cpu-oops&quot;
suffix:semicolon
DECL|variable|sparc_fpu_type
r_char
op_star
id|sparc_fpu_type
op_assign
l_string|&quot;fpu-oops&quot;
suffix:semicolon
multiline_comment|/* various Virtual Address Cache parameters we find at boot time... */
r_extern
r_int
id|vac_size
comma
id|vac_linesize
comma
id|vac_do_hw_vac_flushes
suffix:semicolon
r_extern
r_int
id|vac_entries_per_context
comma
id|vac_entries_per_segment
suffix:semicolon
r_extern
r_int
id|vac_entries_per_page
suffix:semicolon
r_extern
r_int
id|find_vac_size
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|find_vac_linesize
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|find_vac_hwflushes
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|find_mmu_num_segmaps
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|find_mmu_num_contexts
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
DECL|function|probe_cpu
id|probe_cpu
c_func
(paren
r_void
)paren
(brace
r_register
r_int
id|psr_impl
op_assign
l_int|0
suffix:semicolon
r_register
r_int
id|psr_vers
op_assign
l_int|0
suffix:semicolon
r_register
r_int
id|fpu_vers
op_assign
l_int|0
suffix:semicolon
r_register
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|tmp_fsr
suffix:semicolon
op_amp
id|tmp_fsr
suffix:semicolon
multiline_comment|/* GCC grrr... */
id|__asm__
c_func
(paren
l_string|&quot;rd %%psr, %0&bslash;n&bslash;t&quot;
l_string|&quot;mov %0, %1&bslash;n&bslash;t&quot;
l_string|&quot;srl %0, 28, %0&bslash;n&bslash;t&quot;
l_string|&quot;srl %1, 24, %1&bslash;n&bslash;t&quot;
l_string|&quot;and %0, 0xf, %0&bslash;n&bslash;t&quot;
l_string|&quot;and %1, 0xf, %1&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|psr_impl
)paren
comma
l_string|&quot;=r&quot;
(paren
id|psr_vers
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|psr_impl
)paren
comma
l_string|&quot;1&quot;
(paren
id|psr_vers
)paren
)paren
suffix:semicolon
id|__asm__
c_func
(paren
l_string|&quot;st %%fsr, %1&bslash;n&bslash;t&quot;
l_string|&quot;ld %1, %0&bslash;n&bslash;t&quot;
l_string|&quot;srl %0, 17, %0&bslash;n&bslash;t&quot;
l_string|&quot;and %0, 0x7, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|fpu_vers
)paren
comma
l_string|&quot;=m&quot;
(paren
id|tmp_fsr
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|fpu_vers
)paren
comma
l_string|&quot;1&quot;
(paren
id|tmp_fsr
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;fpu_vers: %d &quot;
comma
id|fpu_vers
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psr_impl: %d &quot;
comma
id|psr_impl
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;psr_vers: %d &bslash;n&bslash;n&quot;
comma
id|psr_vers
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|23
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|linux_sparc_chips
(braket
id|i
)braket
dot
id|psr_impl
op_eq
id|psr_impl
)paren
r_if
c_cond
(paren
id|linux_sparc_chips
(braket
id|i
)braket
dot
id|psr_vers
op_eq
id|psr_vers
)paren
(brace
id|sparc_cpu_type
op_assign
id|linux_sparc_chips
(braket
id|i
)braket
dot
id|cpu_name
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|23
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;No CPU type! You lose&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: psr.impl = 0x%x   psr.vers = 0x%x&bslash;n&quot;
comma
id|psr_impl
comma
id|psr_vers
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|linux_sparc_fpu
(braket
id|i
)braket
dot
id|psr_impl
op_eq
id|psr_impl
)paren
r_if
c_cond
(paren
id|linux_sparc_fpu
(braket
id|i
)braket
dot
id|fp_vers
op_eq
id|fpu_vers
)paren
(brace
id|sparc_fpu_type
op_assign
id|linux_sparc_fpu
(braket
id|i
)braket
dot
id|fp_name
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|32
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;No FPU type! You don&squot;t completely lose though...&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: psr.impl = 0x%x  fsr.vers = 0x%x&bslash;n&quot;
comma
id|psr_impl
comma
id|fpu_vers
)paren
suffix:semicolon
id|sparc_fpu_type
op_assign
id|linux_sparc_fpu
(braket
l_int|31
)braket
dot
id|fp_name
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;CPU: %s &bslash;n&quot;
comma
id|sparc_cpu_type
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;FPU: %s &bslash;n&quot;
comma
id|sparc_fpu_type
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_void
DECL|function|probe_vac
id|probe_vac
c_func
(paren
r_void
)paren
(brace
r_register
r_int
r_int
id|x
comma
id|y
suffix:semicolon
macro_line|#ifndef CONFIG_SRMMU
id|vac_size
op_assign
id|find_vac_size
c_func
(paren
)paren
suffix:semicolon
id|vac_linesize
op_assign
id|find_vac_linesize
c_func
(paren
)paren
suffix:semicolon
id|vac_do_hw_vac_flushes
op_assign
id|find_vac_hwflushes
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Calculate various constants that make the cache-flushing code&n;   * mode speedy.&n;   */
id|vac_entries_per_segment
op_assign
id|vac_entries_per_context
op_assign
id|vac_size
op_rshift
l_int|12
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0
comma
id|y
op_assign
id|vac_linesize
suffix:semicolon
(paren
(paren
l_int|1
op_lshift
id|x
)paren
OL
id|y
)paren
suffix:semicolon
id|x
op_increment
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
l_int|1
op_lshift
id|x
)paren
op_ne
id|vac_linesize
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Warning BOGUS VAC linesize 0x%x&quot;
comma
id|vac_size
)paren
suffix:semicolon
)brace
id|vac_entries_per_page
op_assign
id|x
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Sparc VAC cache: Size=%d bytes  Line-Size=%d bytes ... &quot;
comma
id|vac_size
comma
id|vac_linesize
)paren
suffix:semicolon
multiline_comment|/* Here we want to &squot;invalidate&squot; all the software VAC &quot;tags&quot;&n;   * just in case there is garbage in there. Then we enable it.&n;   */
r_for
c_loop
(paren
id|x
op_assign
l_int|0x80000000
comma
id|y
op_assign
(paren
id|x
op_plus
id|vac_size
)paren
suffix:semicolon
id|x
OL
id|y
suffix:semicolon
id|x
op_add_assign
id|vac_linesize
)paren
(brace
id|__asm__
c_func
(paren
l_string|&quot;sta %0, [%1] %2&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
l_int|0
)paren
comma
l_string|&quot;r&quot;
(paren
id|x
)paren
comma
l_string|&quot;n&quot;
(paren
l_int|0x2
)paren
)paren
suffix:semicolon
)brace
id|x
op_assign
id|enable_vac
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ENABLED&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
r_void
DECL|function|probe_mmu
id|probe_mmu
c_func
(paren
r_void
)paren
(brace
id|find_mmu_num_segmaps
c_func
(paren
)paren
suffix:semicolon
id|find_mmu_num_contexts
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;MMU segmaps: %d     MMU contexts: %d&bslash;n&quot;
comma
id|num_segmaps
comma
id|num_contexts
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_void
DECL|function|probe_clock
id|probe_clock
c_func
(paren
r_int
id|fchild
)paren
(brace
r_register
r_int
id|node
comma
id|type
suffix:semicolon
r_register
r_char
op_star
id|node_str
suffix:semicolon
multiline_comment|/* This will basically traverse the node-tree of the prom to see&n;   * which timer chip is on this machine.&n;   */
id|printk
c_func
(paren
l_string|&quot;Probing timer chip... &quot;
)paren
suffix:semicolon
id|type
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|node
op_assign
id|fchild
suffix:semicolon
suffix:semicolon
)paren
(brace
id|node_str
op_assign
id|get_str_from_prom
c_func
(paren
id|node
comma
l_string|&quot;model&quot;
comma
id|promstr_buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|node_str
comma
l_string|&quot;mk48t02&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|type
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|node_str
comma
l_string|&quot;mk48t08&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|type
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
)brace
id|node
op_assign
id|node_get_sibling
c_func
(paren
id|node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|node
op_eq
id|fchild
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Aieee, could not find timer chip type&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;Mostek %s&bslash;n&quot;
comma
id|node_str
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;At OBIO address: 0x%x Virtual address: 0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|TIMER_PHYSADDR
comma
(paren
r_int
r_int
)paren
id|TIMER_STRUCT
)paren
suffix:semicolon
id|mapioaddr
c_func
(paren
(paren
r_int
r_int
)paren
id|TIMER_PHYSADDR
comma
(paren
r_int
r_int
)paren
id|TIMER_STRUCT
)paren
suffix:semicolon
id|TIMER_STRUCT-&gt;timer_limit14
op_assign
(paren
(paren
(paren
l_int|1000000
op_div
id|HZ
)paren
op_lshift
l_int|10
)paren
op_or
l_int|0x80000000
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_void
DECL|function|probe_esp
id|probe_esp
c_func
(paren
r_register
r_int
id|esp_node
)paren
(brace
r_register
r_int
id|nd
suffix:semicolon
r_register
r_char
op_star
id|lbuf
suffix:semicolon
id|nd
op_assign
id|node_get_child
c_func
(paren
id|esp_node
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;nProbing ESP:&bslash;n&quot;
)paren
suffix:semicolon
id|lbuf
op_assign
id|get_str_from_prom
c_func
(paren
id|nd
comma
l_string|&quot;name&quot;
comma
id|promstr_buf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|get_int_from_prom
c_func
(paren
id|nd
comma
l_string|&quot;name&quot;
comma
id|promint_buf
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Node: 0x%x Name: %s&bslash;n&quot;
comma
id|nd
comma
id|lbuf
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|nd
op_assign
id|node_get_sibling
c_func
(paren
id|nd
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|lbuf
op_assign
id|get_str_from_prom
c_func
(paren
id|nd
comma
l_string|&quot;name&quot;
comma
id|promstr_buf
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Node: 0x%x Name: %s&bslash;n&quot;
comma
id|nd
comma
id|lbuf
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_void
DECL|function|probe_sbus
id|probe_sbus
c_func
(paren
r_register
r_int
id|cpu_child_node
)paren
(brace
r_register
r_int
id|nd
comma
id|savend
suffix:semicolon
r_register
r_char
op_star
id|lbuf
suffix:semicolon
id|nd
op_assign
id|cpu_child_node
suffix:semicolon
id|lbuf
op_assign
(paren
r_char
op_star
)paren
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|nd
op_assign
id|node_get_sibling
c_func
(paren
id|nd
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|lbuf
op_assign
id|get_str_from_prom
c_func
(paren
id|nd
comma
l_string|&quot;name&quot;
comma
id|promstr_buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|lbuf
comma
l_string|&quot;sbus&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
suffix:semicolon
id|nd
op_assign
id|node_get_child
c_func
(paren
id|nd
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Node: 0x%x Name: %s&bslash;n&quot;
comma
id|nd
comma
id|get_str_from_prom
c_func
(paren
id|nd
comma
l_string|&quot;name&quot;
comma
id|promstr_buf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|lbuf
comma
l_string|&quot;esp&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|probe_esp
c_func
(paren
id|nd
)paren
suffix:semicolon
)brace
suffix:semicolon
r_while
c_loop
(paren
(paren
id|nd
op_assign
id|node_get_sibling
c_func
(paren
id|nd
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Node: 0x%x Name: %s&bslash;n&quot;
comma
id|nd
comma
id|lbuf
op_assign
id|get_str_from_prom
c_func
(paren
id|nd
comma
l_string|&quot;name&quot;
comma
id|promstr_buf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|lbuf
comma
l_string|&quot;esp&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|savend
op_assign
id|nd
suffix:semicolon
id|probe_esp
c_func
(paren
id|nd
)paren
suffix:semicolon
id|nd
op_assign
id|savend
suffix:semicolon
)brace
suffix:semicolon
)brace
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_extern
r_int
r_int
id|probe_memory
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_struct
id|sparc_phys_banks
id|sp_banks
(braket
l_int|14
)braket
suffix:semicolon
DECL|variable|phys_bytes_of_ram
DECL|variable|end_of_phys_memory
r_int
r_int
id|phys_bytes_of_ram
comma
id|end_of_phys_memory
suffix:semicolon
r_void
DECL|function|probe_devices
id|probe_devices
c_func
(paren
r_void
)paren
(brace
r_register
r_int
id|nd
comma
id|i
suffix:semicolon
r_register
r_char
op_star
id|str
suffix:semicolon
id|nd
op_assign
id|prom_node_root
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PROBING DEVICES:&bslash;n&quot;
)paren
suffix:semicolon
id|str
op_assign
id|get_str_from_prom
c_func
(paren
id|nd
comma
l_string|&quot;device_type&quot;
comma
id|promstr_buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|str
comma
l_string|&quot;cpu&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Found CPU root prom device tree node.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Root node in device tree was not &squot;cpu&squot; cannot continue.&bslash;n&quot;
)paren
suffix:semicolon
id|halt
c_func
(paren
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#ifdef DEBUG_PROBING
id|printk
c_func
(paren
l_string|&quot;String address for d_type: 0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|str
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;str[0] = %c  str[1] = %c  str[2] = %c &bslash;n&quot;
comma
id|str
(braket
l_int|0
)braket
comma
id|str
(braket
l_int|1
)braket
comma
id|str
(braket
l_int|2
)braket
)paren
suffix:semicolon
macro_line|#endif
id|str
op_assign
id|get_str_from_prom
c_func
(paren
id|nd
comma
l_string|&quot;name&quot;
comma
id|promstr_buf
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_PROBING
id|printk
c_func
(paren
l_string|&quot;String address for name: 0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|str
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;str[0] = %c  str[1] = %c  str[2] = %c &bslash;n&quot;
comma
id|str
(braket
l_int|0
)braket
comma
id|str
(braket
l_int|1
)braket
comma
id|str
(braket
l_int|2
)braket
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;Name: %s &bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
id|first_descent
op_assign
id|nd
op_assign
id|node_get_child
c_func
(paren
id|nd
)paren
suffix:semicolon
multiline_comment|/* Ok, here will go a call to each specific device probe. We can&n; * call these now that we have the &squot;root&squot; node and the child of&n; * this node to send to the routines. ORDER IS IMPORTANT!&n; */
id|probe_cpu
c_func
(paren
)paren
suffix:semicolon
id|probe_vac
c_func
(paren
)paren
suffix:semicolon
id|probe_mmu
c_func
(paren
)paren
suffix:semicolon
id|phys_bytes_of_ram
op_assign
id|probe_memory
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Physical Memory: %d bytes&bslash;n&quot;
comma
(paren
r_int
)paren
id|phys_bytes_of_ram
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Bank %d:  base 0x%x  bytes %d&bslash;n&quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|sp_banks
(braket
id|i
)braket
dot
id|base_addr
comma
(paren
r_int
)paren
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
)paren
suffix:semicolon
id|end_of_phys_memory
op_assign
id|sp_banks
(braket
id|i
)braket
dot
id|base_addr
op_plus
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;PROM Root Child Node: 0x%x Name: %s &bslash;n&quot;
comma
id|nd
comma
id|get_str_from_prom
c_func
(paren
id|nd
comma
l_string|&quot;name&quot;
comma
id|promstr_buf
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|nd
op_assign
id|node_get_sibling
c_func
(paren
id|nd
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Node: 0x%x Name: %s&quot;
comma
id|nd
comma
id|get_str_from_prom
c_func
(paren
id|nd
comma
l_string|&quot;name&quot;
comma
id|promstr_buf
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;nProbing SBUS:&bslash;n&quot;
)paren
suffix:semicolon
id|probe_sbus
c_func
(paren
id|first_descent
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
