multiline_comment|/* tick14.c&n; * linux/arch/sparc/kernel/tick14.c&n; *&n; * Copyright (C) 1996 David Redman (djhr@tadpole.co.uk)&n; *&n; * This file handles the Sparc specific level14 ticker&n; * This is really useful for profiling OBP uses it for keyboard&n; * aborts and other stuff.&n; *&n; *&n; */
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/param.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/timer.h&gt;
macro_line|#include &lt;asm/mostek.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
r_extern
r_int
r_int
id|lvl14_save
(braket
l_int|5
)braket
suffix:semicolon
DECL|variable|linux_lvl14
r_static
r_int
r_int
op_star
id|linux_lvl14
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|obp_lvl14
r_static
r_int
r_int
id|obp_lvl14
(braket
l_int|4
)braket
suffix:semicolon
DECL|function|install_linux_ticker
r_void
id|install_linux_ticker
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|linux_lvl14
)paren
r_return
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|linux_lvl14
(braket
l_int|0
)braket
op_assign
id|lvl14_save
(braket
l_int|0
)braket
suffix:semicolon
id|linux_lvl14
(braket
l_int|1
)braket
op_assign
id|lvl14_save
(braket
l_int|1
)braket
suffix:semicolon
id|linux_lvl14
(braket
l_int|2
)braket
op_assign
id|lvl14_save
(braket
l_int|2
)braket
suffix:semicolon
id|linux_lvl14
(braket
l_int|3
)braket
op_assign
id|lvl14_save
(braket
l_int|3
)braket
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|install_obp_ticker
r_void
id|install_obp_ticker
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|linux_lvl14
)paren
r_return
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|linux_lvl14
(braket
l_int|0
)braket
op_assign
id|obp_lvl14
(braket
l_int|0
)braket
suffix:semicolon
id|linux_lvl14
(braket
l_int|1
)braket
op_assign
id|obp_lvl14
(braket
l_int|1
)braket
suffix:semicolon
id|linux_lvl14
(braket
l_int|2
)braket
op_assign
id|obp_lvl14
(braket
l_int|2
)braket
suffix:semicolon
id|linux_lvl14
(braket
l_int|3
)braket
op_assign
id|obp_lvl14
(braket
l_int|3
)braket
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|claim_ticker14
r_void
id|claim_ticker14
c_func
(paren
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
id|irq_nr
comma
r_int
r_int
id|timeout
)paren
(brace
r_int
id|cpu
op_assign
id|smp_processor_id
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* first we copy the obp handler instructions&n;&t; */
id|disable_irq
c_func
(paren
id|irq_nr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|handler
)paren
r_return
suffix:semicolon
id|linux_lvl14
op_assign
(paren
r_int
r_int
op_star
)paren
id|lvl14_save
(braket
l_int|4
)braket
suffix:semicolon
id|obp_lvl14
(braket
l_int|0
)braket
op_assign
id|linux_lvl14
(braket
l_int|0
)braket
suffix:semicolon
id|obp_lvl14
(braket
l_int|1
)braket
op_assign
id|linux_lvl14
(braket
l_int|1
)braket
suffix:semicolon
id|obp_lvl14
(braket
l_int|2
)braket
op_assign
id|linux_lvl14
(braket
l_int|2
)braket
suffix:semicolon
id|obp_lvl14
(braket
l_int|3
)braket
op_assign
id|linux_lvl14
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_irq
c_func
(paren
id|irq_nr
comma
id|handler
comma
(paren
id|SA_INTERRUPT
op_or
id|SA_STATIC_ALLOC
)paren
comma
l_string|&quot;counter14&quot;
comma
l_int|NULL
)paren
)paren
(brace
id|install_linux_ticker
c_func
(paren
)paren
suffix:semicolon
id|load_profile_irq
c_func
(paren
id|cpu
comma
id|timeout
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|irq_nr
)paren
suffix:semicolon
)brace
)brace
eof
