multiline_comment|/* $Id: pcic.c,v 1.2 1998/09/29 03:21:56 jj Exp $&n; * pcic.c: Sparc/PCI controller support&n; *&n; * Copyright (C) 1998 V. Roganov and G. Raiko&n; *&n; * Code is derived from Ultra/PCI PSYCHO controller support, see that&n; * for author info.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;asm/ebus.h&gt;
macro_line|#include &lt;asm/sbus.h&gt; /* for sanity check... */
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|PROM_DEBUG
macro_line|#undef PROM_DEBUG
DECL|macro|FIXUP_REGS_DEBUG
macro_line|#undef FIXUP_REGS_DEBUG
DECL|macro|FIXUP_IRQ_DEBUG
macro_line|#undef FIXUP_IRQ_DEBUG
DECL|macro|FIXUP_VMA_DEBUG
macro_line|#undef FIXUP_VMA_DEBUG
macro_line|#ifdef PROM_DEBUG
DECL|macro|dprintf
mdefine_line|#define dprintf&t;prom_printf
macro_line|#else
DECL|macro|dprintf
mdefine_line|#define dprintf printk
macro_line|#endif
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/pcic.h&gt;
macro_line|#include &lt;asm/timer.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifndef CONFIG_PCI
DECL|function|pcibios_present
r_int
id|pcibios_present
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sys_pciconfig_read
id|asmlinkage
r_int
id|sys_pciconfig_read
c_func
(paren
r_int
r_int
id|bus
comma
r_int
r_int
id|dfn
comma
r_int
r_int
id|off
comma
r_int
r_int
id|len
comma
r_int
r_char
op_star
id|buf
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sys_pciconfig_write
id|asmlinkage
r_int
id|sys_pciconfig_write
c_func
(paren
r_int
r_int
id|bus
comma
r_int
r_int
id|dfn
comma
r_int
r_int
id|off
comma
r_int
r_int
id|len
comma
r_int
r_char
op_star
id|buf
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else
DECL|variable|PCIC
r_static
r_struct
id|linux_pcic
id|PCIC
suffix:semicolon
DECL|variable|pcic
r_static
r_struct
id|linux_pcic
op_star
id|pcic
op_assign
l_int|NULL
suffix:semicolon
r_static
r_void
id|pci_do_gettimeofday
c_func
(paren
r_struct
id|timeval
op_star
id|tv
)paren
suffix:semicolon
r_static
r_void
id|pci_do_settimeofday
c_func
(paren
r_struct
id|timeval
op_star
id|tv
)paren
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pcic_probe
c_func
(paren
r_void
)paren
)paren
(brace
r_struct
id|linux_prom_registers
id|regs
(braket
id|PROMREG_MAX
)braket
suffix:semicolon
r_struct
id|linux_pbm_info
op_star
id|pbm
suffix:semicolon
r_char
id|namebuf
(braket
l_int|64
)braket
suffix:semicolon
r_int
id|node
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|pci_present
c_func
(paren
)paren
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;PCIC: called twice!&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|node
op_assign
id|prom_getchild
(paren
id|prom_root_node
)paren
suffix:semicolon
id|node
op_assign
id|prom_searchsiblings
(paren
id|node
comma
l_string|&quot;pci&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|node
op_eq
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t; * Map in PCIC register set, config space, and IO base&n;&t; */
id|err
op_assign
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;reg&quot;
comma
(paren
r_char
op_star
)paren
id|regs
comma
r_sizeof
(paren
id|regs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
op_logical_or
id|err
op_eq
op_minus
l_int|1
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;PCIC: Error, cannot get PCIC registers &quot;
l_string|&quot;from PROM.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|pcic
op_assign
op_amp
id|PCIC
suffix:semicolon
id|pcic-&gt;pcic_regs
op_assign
(paren
r_int
r_int
)paren
id|sparc_alloc_io
c_func
(paren
id|regs
(braket
l_int|0
)braket
dot
id|phys_addr
comma
l_int|NULL
comma
id|regs
(braket
l_int|0
)braket
dot
id|reg_size
comma
l_string|&quot;PCIC Registers&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcic-&gt;pcic_regs
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;PCIC: Error, cannot map PCIC registers.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|pcic-&gt;pcic_io_phys
op_assign
id|regs
(braket
l_int|1
)braket
dot
id|phys_addr
suffix:semicolon
id|pcic-&gt;pcic_io
op_assign
(paren
r_int
r_int
)paren
id|sparc_alloc_io
c_func
(paren
id|regs
(braket
l_int|1
)braket
dot
id|phys_addr
comma
l_int|NULL
comma
id|regs
(braket
l_int|1
)braket
dot
id|reg_size
comma
l_string|&quot;PCIC IO Base&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcic-&gt;pcic_io
op_eq
l_int|0UL
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;PCIC: Error, cannot map PCIC IO Base.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|pcic-&gt;pcic_config_space_addr
op_assign
(paren
r_int
r_int
)paren
id|sparc_alloc_io
(paren
id|regs
(braket
l_int|2
)braket
dot
id|phys_addr
comma
l_int|NULL
comma
id|regs
(braket
l_int|2
)braket
dot
id|reg_size
op_star
l_int|2
comma
l_string|&quot;PCI Config Space Address&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcic-&gt;pcic_config_space_addr
op_eq
l_int|0UL
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;PCIC: Error, cannot map&quot;
l_string|&quot;PCI Configuration Space Address.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Docs say three least significant bits in address and data&n;&t; * must be the same. Thus, we need adjust size of data.&n;&t; */
id|pcic-&gt;pcic_config_space_data
op_assign
(paren
r_int
r_int
)paren
id|sparc_alloc_io
(paren
id|regs
(braket
l_int|3
)braket
dot
id|phys_addr
comma
l_int|NULL
comma
id|regs
(braket
l_int|3
)braket
dot
id|reg_size
op_star
l_int|2
comma
l_string|&quot;PCI Config Space Data&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcic-&gt;pcic_config_space_data
op_eq
l_int|0UL
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;PCIC: Error, cannot map&quot;
l_string|&quot;PCI Configuration Space Data.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|pbm
op_assign
op_amp
id|pcic-&gt;pbm
suffix:semicolon
id|pbm-&gt;prom_node
op_assign
id|node
suffix:semicolon
id|prom_getstring
c_func
(paren
id|node
comma
l_string|&quot;name&quot;
comma
id|namebuf
comma
r_sizeof
(paren
id|namebuf
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|pbm-&gt;prom_name
comma
id|namebuf
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pcibios_init
c_func
(paren
r_void
)paren
)paren
(brace
multiline_comment|/*&n;&t; * PCIC should be initialized at start of the timer.&n;&t; * So, here we report the presence of PCIC and do some magic passes.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|pcic
)paren
(brace
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;PCIC MAP: config addr=0x%lx; config data=0x%lx, &quot;
l_string|&quot;regs=0x%lx io=0x%lx&bslash;n&quot;
comma
id|pcic-&gt;pcic_config_space_addr
comma
id|pcic-&gt;pcic_config_space_data
comma
id|pcic-&gt;pcic_regs
comma
id|pcic-&gt;pcic_io
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * FIXME:&n;&t; *      Switch off IOTLB translation.&n;&t; *      It&squot;ll be great to use IOMMU to handle HME&squot;s rings&n;&t; *      but we couldn&squot;t. Thus, we have to flush CPU cache&n;&t; *      in HME.&n;&t; */
id|writeb
c_func
(paren
id|PCI_DVMA_CONTROL_IOTLB_DISABLE
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_DVMA_CONTROL
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * FIXME:&n;&t; *      Increase mapped size for PCI memory space (DMA access).&n;&t; *      Should be done in that order (size first, address second).&n;&t; *      Why we couldn&squot;t set up 4GB and forget about it ?&n;&t; */
id|writel
c_func
(paren
l_int|0xF0000000UL
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_SIZE_0
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
op_plus
id|PCI_BASE_ADDRESS_SPACE_MEMORY
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_BASE_ADDRESS_0
)paren
suffix:semicolon
)brace
DECL|function|pcibios_present
r_int
id|pcibios_present
c_func
(paren
r_void
)paren
(brace
r_return
id|pcic
op_ne
l_int|NULL
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|pdev_to_pnode
c_func
(paren
r_struct
id|linux_pbm_info
op_star
id|pbm
comma
r_struct
id|pci_dev
op_star
id|pdev
)paren
)paren
(brace
r_struct
id|linux_prom_pci_registers
id|regs
(braket
id|PROMREG_MAX
)braket
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|node
op_assign
id|prom_getchild
c_func
(paren
id|pbm-&gt;prom_node
)paren
suffix:semicolon
r_while
c_loop
(paren
id|node
)paren
(brace
id|err
op_assign
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;reg&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|regs
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|regs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
op_logical_and
id|err
op_ne
op_minus
l_int|1
)paren
(brace
r_int
r_int
id|devfn
op_assign
(paren
id|regs
(braket
l_int|0
)braket
dot
id|which_io
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|devfn
op_eq
id|pdev-&gt;devfn
)paren
(brace
r_return
id|node
suffix:semicolon
)brace
multiline_comment|/* Match */
)brace
id|node
op_assign
id|prom_getsibling
c_func
(paren
id|node
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pci_devcookie_alloc
r_static
r_inline
r_struct
id|pcidev_cookie
op_star
id|pci_devcookie_alloc
c_func
(paren
r_void
)paren
(brace
r_return
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pcidev_cookie
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
DECL|function|pcic_map_pci_device
r_static
r_void
id|pcic_map_pci_device
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_int
id|node
comma
id|pcinode
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
multiline_comment|/* Is any valid address present ? */
id|i
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|6
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;base_address
(braket
id|j
)braket
)paren
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
r_return
suffix:semicolon
multiline_comment|/* nothing to do */
multiline_comment|/*&n;&t; * find related address and get it&squot;s window length&n;&t; */
id|pcinode
op_assign
id|prom_getchild
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
id|pcinode
op_assign
id|prom_searchsiblings
c_func
(paren
id|pcinode
comma
l_string|&quot;pci&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcinode
)paren
id|panic
c_func
(paren
l_string|&quot;PCIC: failed to locate &squot;pci&squot; node&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|node
op_assign
id|prom_getchild
c_func
(paren
id|pcinode
)paren
suffix:semicolon
id|node
suffix:semicolon
id|node
op_assign
id|prom_getsibling
c_func
(paren
id|node
)paren
)paren
(brace
r_struct
id|linux_prom_pci_assigned_addresses
id|addrs
(braket
l_int|6
)braket
suffix:semicolon
r_int
id|addrlen
op_assign
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;assigned-addresses&quot;
comma
(paren
r_char
op_star
)paren
id|addrs
comma
r_sizeof
(paren
id|addrs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addrlen
op_eq
op_minus
l_int|1
)paren
r_continue
suffix:semicolon
id|addrlen
op_div_assign
r_sizeof
(paren
r_struct
id|linux_prom_pci_assigned_addresses
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|addrlen
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|6
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;base_address
(braket
id|j
)braket
op_logical_or
op_logical_neg
id|addrs
(braket
id|i
)braket
dot
id|phys_lo
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|addrs
(braket
id|i
)braket
dot
id|phys_lo
op_eq
id|dev-&gt;base_address
(braket
id|j
)braket
)paren
(brace
r_int
r_int
id|address
op_assign
id|dev-&gt;base_address
(braket
id|j
)braket
suffix:semicolon
r_int
id|length
op_assign
id|addrs
(braket
id|i
)braket
dot
id|size_lo
suffix:semicolon
r_char
id|namebuf
(braket
l_int|128
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_int
r_int
id|mapaddr
comma
id|addrflags
suffix:semicolon
id|prom_getstring
c_func
(paren
id|node
comma
l_string|&quot;name&quot;
comma
id|namebuf
comma
r_sizeof
(paren
id|namebuf
)paren
)paren
suffix:semicolon
multiline_comment|/* FIXME:&n;&t;&t;&t;     *      failure in allocation too large space&n;&t;&t;&t;     */
r_if
c_cond
(paren
id|length
OG
l_int|0x200000
)paren
(brace
id|length
op_assign
l_int|0x200000
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;PCIC: map window for device &squot;%s&squot; &quot;
l_string|&quot;reduced to 2MB !&bslash;n&quot;
comma
id|namebuf
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;     *  Be careful with MEM/IO address flags&n;&t;&t;&t;     */
r_if
c_cond
(paren
(paren
id|address
op_amp
id|PCI_BASE_ADDRESS_SPACE
)paren
op_eq
id|PCI_BASE_ADDRESS_SPACE_IO
)paren
(brace
id|mapaddr
op_assign
id|address
op_amp
id|PCI_BASE_ADDRESS_IO_MASK
suffix:semicolon
)brace
r_else
(brace
id|mapaddr
op_assign
id|address
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
suffix:semicolon
)brace
id|addrflags
op_assign
id|address
op_xor
id|mapaddr
suffix:semicolon
id|dev-&gt;base_address
(braket
id|j
)braket
op_assign
(paren
r_int
r_int
)paren
id|sparc_alloc_io
c_func
(paren
id|address
comma
l_int|0
comma
id|length
comma
id|namebuf
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;base_address
(braket
id|j
)braket
op_eq
l_int|0
)paren
id|panic
c_func
(paren
l_string|&quot;PCIC: failed make mapping for &quot;
l_string|&quot;pci device &squot;%s&squot; with address %lx&bslash;n&quot;
comma
id|namebuf
comma
id|address
)paren
suffix:semicolon
id|dev-&gt;base_address
(braket
id|j
)braket
op_xor_assign
id|addrflags
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
id|panic
c_func
(paren
l_string|&quot;PCIC: unable to locate prom node for pci device (%x,%x) &bslash;n&quot;
comma
id|dev-&gt;device
comma
id|dev-&gt;vendor
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Assign IO space for a device.&n; * This is a chance for devices which have the same IO and Mem Space to&n; * fork access to IO and Mem.&n; *&n; * Now, we assume there is one such device only (IGA 1682) but code below&n; * should work in cases when space of all such devices is less then 16MB.&n; */
DECL|function|pcic_alloc_io
r_int
r_int
id|pcic_alloc_io
c_func
(paren
r_int
r_int
op_star
id|addr
)paren
(brace
r_int
r_int
id|paddr
op_assign
op_star
id|addr
suffix:semicolon
r_int
r_int
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|pcic-&gt;pcic_mapped_io
op_eq
l_int|0
)paren
(brace
id|pcic-&gt;pcic_mapped_io
op_assign
id|paddr
op_amp
op_complement
(paren
id|PCI_SPACE_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|writeb
c_func
(paren
(paren
id|pcic-&gt;pcic_mapped_io
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_PIBAR
)paren
suffix:semicolon
id|writeb
c_func
(paren
(paren
id|pcic-&gt;pcic_io_phys
op_rshift
l_int|24
)paren
op_amp
id|PCI_SIBAR_ADDRESS_MASK
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_SIBAR
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|PCI_ISIZE_16M
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_ISIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|paddr
template_param
id|pcic-&gt;pcic_mapped_io
op_plus
id|PCI_SPACE_SIZE
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|offset
op_assign
id|paddr
op_minus
id|pcic-&gt;pcic_mapped_io
suffix:semicolon
op_star
id|addr
op_assign
id|pcic-&gt;pcic_io_phys
op_plus
id|offset
suffix:semicolon
r_return
id|pcic-&gt;pcic_io
op_plus
id|offset
suffix:semicolon
)brace
multiline_comment|/*&n; * Stolen from both i386 and sparc64 branch &n; */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pcibios_fixup
c_func
(paren
r_void
)paren
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_int
id|i
comma
id|has_io
comma
id|has_mem
suffix:semicolon
r_int
r_int
id|cmd
suffix:semicolon
r_if
c_cond
(paren
id|pcic
op_eq
l_int|NULL
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;PCI: Error, PCIC not found.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|dev
op_assign
id|pci_devices
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
multiline_comment|/*&n;&t;&t; * Comment from i386 branch:&n;&t;&t; *     There are buggy BIOSes that forget to enable I/O and memory&n;&t;&t; *     access to PCI devices. We try to fix this, but we need to&n;&t;&t; *     be sure that the BIOS didn&squot;t forget to assign an address&n;&t;&t; *     to the device. [mj]&n;&t;&t; * OBP is a case of such BIOS :-)&n;&t;&t; */
id|has_io
op_assign
id|has_mem
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|a
op_assign
id|dev-&gt;base_address
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|a
op_amp
id|PCI_BASE_ADDRESS_SPACE_IO
)paren
(brace
id|has_io
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|a
op_amp
id|PCI_BASE_ADDRESS_MEM_MASK
)paren
id|has_mem
op_assign
l_int|1
suffix:semicolon
)brace
id|pci_read_config_word
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
op_amp
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|has_io
op_logical_and
op_logical_neg
(paren
id|cmd
op_amp
id|PCI_COMMAND_IO
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PCI: Enabling I/O for device %02x:%02x&bslash;n&quot;
comma
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
)paren
suffix:semicolon
id|cmd
op_or_assign
id|PCI_COMMAND_IO
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
id|cmd
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|has_mem
op_logical_and
op_logical_neg
(paren
id|cmd
op_amp
id|PCI_COMMAND_MEMORY
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PCI: Enabling memory for device %02x:%02x&bslash;n&quot;
comma
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
)paren
suffix:semicolon
id|cmd
op_or_assign
id|PCI_COMMAND_MEMORY
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
id|cmd
)paren
suffix:semicolon
)brace
multiline_comment|/* cookies */
(brace
r_struct
id|pcidev_cookie
op_star
id|pcp
suffix:semicolon
r_struct
id|linux_pbm_info
op_star
id|pbm
op_assign
op_amp
id|pcic-&gt;pbm
suffix:semicolon
r_int
id|node
op_assign
id|pdev_to_pnode
c_func
(paren
id|pbm
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|node
op_eq
l_int|0
)paren
(brace
id|node
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|pcp
op_assign
id|pci_devcookie_alloc
c_func
(paren
)paren
suffix:semicolon
id|pcp-&gt;pbm
op_assign
id|pbm
suffix:semicolon
id|pcp-&gt;prom_node
op_assign
id|node
suffix:semicolon
id|dev-&gt;sysdata
op_assign
id|pcp
suffix:semicolon
)brace
multiline_comment|/* memory mapping */
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_SUN
op_logical_and
id|dev-&gt;device
op_eq
id|PCI_DEVICE_ID_SUN_EBUS
)paren
)paren
(brace
id|pcic_map_pci_device
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* irq */
DECL|macro|SETIRQ
mdefine_line|#define SETIRQ(vend,devid,irqn) &bslash;&n;&t;if (dev-&gt;vendor==vend &amp;&amp; dev-&gt;device==devid) dev-&gt;irq = irqn;
id|SETIRQ
c_func
(paren
id|PCI_VENDOR_ID_SUN
comma
id|PCI_DEVICE_ID_SUN_HAPPYMEAL
comma
l_int|3
)paren
suffix:semicolon
)brace
id|ebus_init
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Makes compiler happy */
DECL|variable|pcic_timer_dummy
r_static
r_volatile
r_int
id|pcic_timer_dummy
suffix:semicolon
DECL|function|pcic_clear_clock_irq
r_static
r_void
id|pcic_clear_clock_irq
c_func
(paren
r_void
)paren
(brace
id|pcic_timer_dummy
op_assign
id|readl
c_func
(paren
id|pcic-&gt;pcic_regs
op_plus
id|PCI_SYS_LIMIT
)paren
suffix:semicolon
)brace
DECL|function|pcic_timer_handler
r_static
r_void
id|pcic_timer_handler
(paren
r_int
id|irq
comma
r_void
op_star
id|h
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|pcic_clear_clock_irq
c_func
(paren
)paren
suffix:semicolon
id|do_timer
c_func
(paren
id|regs
)paren
suffix:semicolon
)brace
DECL|macro|USECS_PER_JIFFY
mdefine_line|#define USECS_PER_JIFFY  10000  /* We have 100HZ &quot;standard&quot; timer for sparc */
DECL|macro|TICK_TIMER_LIMIT
mdefine_line|#define TICK_TIMER_LIMIT ((100*1000000/4)/100)
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pci_time_init
c_func
(paren
r_void
)paren
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
r_int
id|timer_irq
comma
id|irq
suffix:semicolon
id|do_get_fast_time
op_assign
id|pci_do_gettimeofday
suffix:semicolon
multiline_comment|/* A hack until do_gettimeofday prototype is moved to arch specific headers&n;&t;   and btfixupped. Patch do_gettimeofday with ba pci_do_gettimeofday; nop */
(paren
(paren
r_int
r_int
op_star
)paren
id|do_gettimeofday
)paren
(braket
l_int|0
)braket
op_assign
l_int|0x10800000
op_or
(paren
(paren
(paren
r_int
r_int
)paren
id|pci_do_gettimeofday
op_minus
(paren
r_int
r_int
)paren
id|do_gettimeofday
)paren
op_amp
l_int|0x003fffff
)paren
suffix:semicolon
(paren
(paren
r_int
r_int
op_star
)paren
id|do_gettimeofday
)paren
(braket
l_int|1
)braket
op_assign
l_int|0x01000000
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|bus_do_settimeofday
comma
id|pci_do_settimeofday
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
id|btfixup
c_func
(paren
)paren
suffix:semicolon
id|writel
(paren
id|TICK_TIMER_LIMIT
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_SYS_LIMIT
)paren
suffix:semicolon
multiline_comment|/* PROM should set appropriate irq */
id|v
op_assign
id|readb
c_func
(paren
id|pcic-&gt;pcic_regs
op_plus
id|PCI_COUNTER_IRQ
)paren
suffix:semicolon
id|timer_irq
op_assign
id|PCI_COUNTER_IRQ_SYS
c_func
(paren
id|v
)paren
suffix:semicolon
id|writel
(paren
id|PCI_COUNTER_IRQ_SET
c_func
(paren
id|timer_irq
comma
l_int|0
)paren
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_COUNTER_IRQ
)paren
suffix:semicolon
id|irq
op_assign
id|request_irq
c_func
(paren
id|timer_irq
comma
id|pcic_timer_handler
comma
(paren
id|SA_INTERRUPT
op_or
id|SA_STATIC_ALLOC
)paren
comma
l_string|&quot;timer&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;time_init: unable to attach IRQ%d&bslash;n&quot;
comma
id|timer_irq
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|__sti
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|do_gettimeoffset
r_static
id|__inline__
r_int
r_int
id|do_gettimeoffset
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* &n;&t; * We devide all to 100&n;&t; * to have microsecond resolution and to avoid overflow&n;&t; */
r_int
r_int
id|count
op_assign
id|readl
c_func
(paren
id|pcic-&gt;pcic_regs
op_plus
id|PCI_SYS_COUNTER
)paren
op_amp
op_complement
id|PCI_SYS_COUNTER_OVERFLOW
suffix:semicolon
id|count
op_assign
(paren
(paren
id|count
op_div
l_int|100
)paren
op_star
id|USECS_PER_JIFFY
)paren
op_div
(paren
id|TICK_TIMER_LIMIT
op_div
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|TIMER_BH
comma
op_amp
id|bh_active
)paren
)paren
(brace
id|offset
op_assign
l_int|1000000
suffix:semicolon
)brace
r_return
id|offset
op_plus
id|count
suffix:semicolon
)brace
r_extern
r_volatile
r_int
r_int
id|lost_ticks
suffix:semicolon
DECL|function|pci_do_gettimeofday
r_static
r_void
id|pci_do_gettimeofday
c_func
(paren
r_struct
id|timeval
op_star
id|tv
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
op_star
id|tv
op_assign
id|xtime
suffix:semicolon
id|tv-&gt;tv_usec
op_add_assign
id|do_gettimeoffset
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * xtime is atomically updated in timer_bh. lost_ticks is&n;&t; * nonzero if the timer bottom half hasnt executed yet.&n;&t; */
r_if
c_cond
(paren
id|lost_ticks
)paren
id|tv-&gt;tv_usec
op_add_assign
id|USECS_PER_JIFFY
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tv-&gt;tv_usec
op_ge
l_int|1000000
)paren
(brace
id|tv-&gt;tv_usec
op_sub_assign
l_int|1000000
suffix:semicolon
id|tv-&gt;tv_sec
op_increment
suffix:semicolon
)brace
)brace
DECL|function|pci_do_settimeofday
r_static
r_void
id|pci_do_settimeofday
c_func
(paren
r_struct
id|timeval
op_star
id|tv
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|tv-&gt;tv_usec
op_sub_assign
id|do_gettimeoffset
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tv-&gt;tv_usec
OL
l_int|0
)paren
(brace
id|tv-&gt;tv_usec
op_add_assign
l_int|1000000
suffix:semicolon
id|tv-&gt;tv_sec
op_decrement
suffix:semicolon
)brace
id|xtime
op_assign
op_star
id|tv
suffix:semicolon
id|time_state
op_assign
id|TIME_BAD
suffix:semicolon
id|time_maxerror
op_assign
l_int|0x70000000
suffix:semicolon
id|time_esterror
op_assign
l_int|0x70000000
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|watchdog_reset
c_func
(paren
)paren
(brace
id|writeb
c_func
(paren
l_int|0
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_SYS_STATUS
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|macro|CONFIG_CMD
mdefine_line|#define CONFIG_CMD(bus, device_fn, where) (0x80000000 | (((unsigned int)bus) &lt;&lt; 16) | (((unsigned int)device_fn) &lt;&lt; 8) | (where &amp; ~3))
DECL|function|pcibios_read_config_byte
r_int
id|pcibios_read_config_byte
c_func
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|device_fn
comma
r_int
r_char
id|where
comma
r_int
r_char
op_star
id|value
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
id|pcibios_read_config_dword
(paren
id|bus
comma
id|device_fn
comma
id|where
op_amp
op_complement
l_int|3
comma
op_amp
id|v
)paren
suffix:semicolon
op_star
id|value
op_assign
l_int|0xff
op_amp
(paren
id|v
op_rshift
(paren
l_int|8
op_star
(paren
id|where
op_amp
l_int|3
)paren
)paren
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|pcibios_read_config_word
r_int
id|pcibios_read_config_word
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|device_fn
comma
r_int
r_char
id|where
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
r_if
c_cond
(paren
id|where
op_amp
l_int|1
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
id|pcibios_read_config_dword
(paren
id|bus
comma
id|device_fn
comma
id|where
op_amp
op_complement
l_int|3
comma
op_amp
id|v
)paren
suffix:semicolon
op_star
id|value
op_assign
l_int|0xffff
op_amp
(paren
id|v
op_rshift
(paren
l_int|8
op_star
(paren
id|where
op_amp
l_int|3
)paren
)paren
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|pcibios_read_config_dword
r_int
id|pcibios_read_config_dword
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|device_fn
comma
r_int
r_char
id|where
comma
r_int
r_int
op_star
id|value
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|where
op_amp
l_int|3
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
r_if
c_cond
(paren
id|bus
op_ne
l_int|0
op_logical_or
(paren
id|device_fn
op_ne
l_int|0
op_logical_and
id|device_fn
op_ne
l_int|1
op_logical_and
id|device_fn
op_ne
l_int|0x80
)paren
)paren
(brace
op_star
id|value
op_assign
l_int|0xffffffff
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
multiline_comment|/* FIXME: IGA haven&squot;t got high config memory addresses !!! */
r_if
c_cond
(paren
id|device_fn
op_eq
l_int|0x80
op_logical_and
id|where
OG
id|PCI_INTERRUPT_LINE
)paren
(brace
op_star
id|value
op_assign
l_int|0xffffffff
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|CONFIG_CMD
c_func
(paren
id|bus
comma
id|device_fn
comma
id|where
)paren
comma
id|pcic-&gt;pcic_config_space_addr
)paren
suffix:semicolon
op_star
id|value
op_assign
id|readl
c_func
(paren
id|pcic-&gt;pcic_config_space_data
op_plus
(paren
id|where
op_amp
l_int|4
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|pcibios_write_config_byte
r_int
id|pcibios_write_config_byte
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|devfn
comma
r_int
r_char
id|where
comma
r_int
r_char
id|value
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
id|pcibios_read_config_dword
(paren
id|bus
comma
id|devfn
comma
id|where
op_amp
op_complement
l_int|3
comma
op_amp
id|v
)paren
suffix:semicolon
id|v
op_assign
(paren
id|v
op_amp
op_complement
(paren
l_int|0xff
op_lshift
(paren
l_int|8
op_star
(paren
id|where
op_amp
l_int|3
)paren
)paren
)paren
)paren
op_or
(paren
(paren
l_int|0xff
op_amp
(paren
r_int
)paren
id|value
)paren
op_lshift
(paren
l_int|8
op_star
(paren
id|where
op_amp
l_int|3
)paren
)paren
)paren
suffix:semicolon
r_return
id|pcibios_write_config_dword
(paren
id|bus
comma
id|devfn
comma
id|where
op_amp
op_complement
l_int|3
comma
id|v
)paren
suffix:semicolon
)brace
DECL|function|pcibios_write_config_word
r_int
id|pcibios_write_config_word
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|devfn
comma
r_int
r_char
id|where
comma
r_int
r_int
id|value
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
r_if
c_cond
(paren
id|where
op_amp
l_int|1
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
id|pcibios_read_config_dword
(paren
id|bus
comma
id|devfn
comma
id|where
op_amp
op_complement
l_int|3
comma
op_amp
id|v
)paren
suffix:semicolon
id|v
op_assign
(paren
id|v
op_amp
op_complement
(paren
l_int|0xffff
op_lshift
(paren
l_int|8
op_star
(paren
id|where
op_amp
l_int|3
)paren
)paren
)paren
)paren
op_or
(paren
(paren
l_int|0xffff
op_amp
(paren
r_int
)paren
id|value
)paren
op_lshift
(paren
l_int|8
op_star
(paren
id|where
op_amp
l_int|3
)paren
)paren
)paren
suffix:semicolon
r_return
id|pcibios_write_config_dword
(paren
id|bus
comma
id|devfn
comma
id|where
op_amp
op_complement
l_int|3
comma
id|v
)paren
suffix:semicolon
)brace
DECL|function|pcibios_write_config_dword
r_int
id|pcibios_write_config_dword
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|devfn
comma
r_int
r_char
id|where
comma
r_int
r_int
id|value
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|where
op_amp
l_int|3
)paren
op_logical_or
id|bus
op_ne
l_int|0
op_logical_or
(paren
id|devfn
op_ne
l_int|0
op_logical_and
id|devfn
op_ne
l_int|1
op_logical_and
id|devfn
op_ne
l_int|0x80
)paren
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|CONFIG_CMD
c_func
(paren
id|bus
comma
id|devfn
comma
id|where
)paren
comma
id|pcic-&gt;pcic_config_space_addr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|value
comma
id|pcic-&gt;pcic_config_space_data
op_plus
(paren
id|where
op_amp
l_int|4
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_char
op_star
id|pcibios_setup
c_func
(paren
r_char
op_star
id|str
)paren
)paren
(brace
r_return
id|str
suffix:semicolon
)brace
multiline_comment|/*&n; *  Following code added to handle extra PCI-related system calls &n; */
DECL|function|sys_pciconfig_read
id|asmlinkage
r_int
id|sys_pciconfig_read
c_func
(paren
r_int
r_int
id|bus
comma
r_int
r_int
id|dfn
comma
r_int
r_int
id|off
comma
r_int
r_int
id|len
comma
r_int
r_char
op_star
id|buf
)paren
(brace
r_int
r_char
id|ubyte
suffix:semicolon
r_int
r_int
id|ushort
suffix:semicolon
r_int
r_int
id|uint
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|len
)paren
(brace
r_case
l_int|1
suffix:colon
id|pcibios_read_config_byte
c_func
(paren
id|bus
comma
id|dfn
comma
id|off
comma
op_amp
id|ubyte
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|ubyte
comma
(paren
r_int
r_char
op_star
)paren
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|pcibios_read_config_word
c_func
(paren
id|bus
comma
id|dfn
comma
id|off
comma
op_amp
id|ushort
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|ushort
comma
(paren
r_int
r_int
op_star
)paren
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|pcibios_read_config_dword
c_func
(paren
id|bus
comma
id|dfn
comma
id|off
comma
op_amp
id|uint
)paren
suffix:semicolon
id|put_user
c_func
(paren
id|uint
comma
(paren
r_int
r_int
op_star
)paren
id|buf
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|sys_pciconfig_write
id|asmlinkage
r_int
id|sys_pciconfig_write
c_func
(paren
r_int
r_int
id|bus
comma
r_int
r_int
id|dfn
comma
r_int
r_int
id|off
comma
r_int
r_int
id|len
comma
r_int
r_char
op_star
id|buf
)paren
(brace
r_int
r_char
id|ubyte
suffix:semicolon
r_int
r_int
id|ushort
suffix:semicolon
r_int
r_int
id|uint
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|len
)paren
(brace
r_case
l_int|1
suffix:colon
id|err
op_assign
id|get_user
c_func
(paren
id|ubyte
comma
(paren
r_int
r_char
op_star
)paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_break
suffix:semicolon
)brace
id|pcibios_write_config_byte
c_func
(paren
id|bus
comma
id|dfn
comma
id|off
comma
id|ubyte
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|err
op_assign
id|get_user
c_func
(paren
id|ushort
comma
(paren
r_int
r_int
op_star
)paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_break
suffix:semicolon
)brace
id|pcibios_write_config_byte
c_func
(paren
id|bus
comma
id|dfn
comma
id|off
comma
id|ushort
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|err
op_assign
id|get_user
c_func
(paren
id|uint
comma
(paren
r_int
r_int
op_star
)paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_break
suffix:semicolon
)brace
id|pcibios_write_config_byte
c_func
(paren
id|bus
comma
id|dfn
comma
id|off
comma
id|uint
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|get_irqmask
r_static
r_inline
r_int
r_int
id|get_irqmask
c_func
(paren
r_int
id|irq_nr
)paren
(brace
r_return
l_int|1
op_lshift
id|irq_nr
suffix:semicolon
)brace
DECL|function|pcic_irq_itoa
r_static
r_inline
r_char
op_star
id|pcic_irq_itoa
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_static
r_char
id|buff
(braket
l_int|16
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|buff
comma
l_string|&quot;%d&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
id|buff
suffix:semicolon
)brace
DECL|function|pcic_disable_irq
r_static
r_void
id|pcic_disable_irq
c_func
(paren
r_int
r_int
id|irq_nr
)paren
(brace
r_int
r_int
id|mask
comma
id|flags
suffix:semicolon
id|mask
op_assign
id|get_irqmask
c_func
(paren
id|irq_nr
)paren
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mask
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_SYS_INT_TARGET_MASK_SET
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|pcic_enable_irq
r_static
r_void
id|pcic_enable_irq
c_func
(paren
r_int
r_int
id|irq_nr
)paren
(brace
r_int
r_int
id|mask
comma
id|flags
suffix:semicolon
id|mask
op_assign
id|get_irqmask
c_func
(paren
id|irq_nr
)paren
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mask
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_SYS_INT_TARGET_MASK_CLEAR
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|pcic_clear_profile_irq
r_static
r_void
id|pcic_clear_profile_irq
c_func
(paren
r_int
id|cpu
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PCIC: unimplemented code: FILE=%s LINE=%d&quot;
comma
id|__FILE__
comma
id|__LINE__
)paren
suffix:semicolon
)brace
DECL|function|pcic_load_profile_irq
r_static
r_void
id|pcic_load_profile_irq
c_func
(paren
r_int
id|cpu
comma
r_int
r_int
id|limit
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PCIC: unimplemented code: FILE=%s LINE=%d&quot;
comma
id|__FILE__
comma
id|__LINE__
)paren
suffix:semicolon
)brace
multiline_comment|/* We assume the caller is local cli()&squot;d when these are called, or else&n; * very bizarre behavior will result.&n; */
DECL|function|pcic_disable_pil_irq
r_static
r_void
id|pcic_disable_pil_irq
c_func
(paren
r_int
r_int
id|pil
)paren
(brace
id|writel
c_func
(paren
id|get_irqmask
c_func
(paren
id|pil
)paren
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_SYS_INT_TARGET_MASK_SET
)paren
suffix:semicolon
)brace
DECL|function|pcic_enable_pil_irq
r_static
r_void
id|pcic_enable_pil_irq
c_func
(paren
r_int
r_int
id|pil
)paren
(brace
id|writel
c_func
(paren
id|get_irqmask
c_func
(paren
id|pil
)paren
comma
id|pcic-&gt;pcic_regs
op_plus
id|PCI_SYS_INT_TARGET_MASK_CLEAR
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|sun4m_pci_init_IRQ
c_func
(paren
r_void
)paren
)paren
(brace
id|BTFIXUPSET_CALL
c_func
(paren
id|enable_irq
comma
id|pcic_enable_irq
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|disable_irq
comma
id|pcic_disable_irq
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|enable_pil_irq
comma
id|pcic_enable_pil_irq
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|disable_pil_irq
comma
id|pcic_disable_pil_irq
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|clear_clock_irq
comma
id|pcic_clear_clock_irq
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|clear_profile_irq
comma
id|pcic_clear_profile_irq
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|load_profile_irq
comma
id|pcic_load_profile_irq
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
id|BTFIXUPSET_CALL
c_func
(paren
id|__irq_itoa
comma
id|pcic_irq_itoa
comma
id|BTFIXUPCALL_NORM
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pcibios_fixup_bus
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
)paren
)paren
(brace
)brace
macro_line|#endif
eof
