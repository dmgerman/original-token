multiline_comment|/* $Id: palloc.c,v 1.4 1996/04/25 06:09:48 davem Exp $&n; * palloc.c:  Memory allocation from the Sun PROM.&n; *&n; * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;asm/openprom.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
multiline_comment|/* You should not call these routines after memory management&n; * has been initialized in the kernel, if fact you should not&n; * use these if at all possible in the kernel.  They are mainly&n; * to be used for a bootloader for temporary allocations which&n; * it will free before jumping into the kernel it has loaded.&n; *&n; * Also, these routines don&squot;t work on V0 proms, only V2 and later.&n; */
multiline_comment|/* Allocate a chunk of memory of size &squot;num_bytes&squot; giving a suggestion&n; * of virtual_hint as the preferred virtual base address of this chunk.&n; * There are no guarantees that you will get the allocation, or that&n; * the prom will abide by your &quot;hint&quot;.  So check your return value.&n; */
r_char
op_star
DECL|function|prom_alloc
id|prom_alloc
c_func
(paren
r_char
op_star
id|virtual_hint
comma
r_int
r_int
id|num_bytes
)paren
(brace
r_if
c_cond
(paren
id|prom_vers
op_eq
id|PROM_V0
)paren
(brace
r_return
(paren
r_char
op_star
)paren
l_int|0x0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|num_bytes
op_eq
l_int|0x0
)paren
(brace
r_return
(paren
r_char
op_star
)paren
l_int|0x0
suffix:semicolon
)brace
r_return
(paren
op_star
(paren
id|romvec-&gt;pv_v2devops.v2_dumb_mem_alloc
)paren
)paren
(paren
id|virtual_hint
comma
id|num_bytes
)paren
suffix:semicolon
)brace
multiline_comment|/* Free a previously allocated chunk back to the prom at virtual address&n; * &squot;vaddr&squot; of size &squot;num_bytes&squot;.  NOTE: This vaddr is not the hint you&n; * used for the allocation, but the virtual address the prom actually&n; * returned to you.  They may be have been the same, they may have not,&n; * doesn&squot;t matter.&n; */
r_void
DECL|function|prom_free
id|prom_free
c_func
(paren
r_char
op_star
id|vaddr
comma
r_int
r_int
id|num_bytes
)paren
(brace
r_if
c_cond
(paren
(paren
id|prom_vers
op_eq
id|PROM_V0
)paren
op_logical_or
(paren
id|num_bytes
op_eq
l_int|0x0
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
(paren
op_star
(paren
id|romvec-&gt;pv_v2devops.v2_dumb_mem_free
)paren
)paren
(paren
id|vaddr
comma
id|num_bytes
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
