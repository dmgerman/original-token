multiline_comment|/* $Id: mp.c,v 1.6 1996/09/19 20:27:25 davem Exp $&n; * mp.c:  OpenBoot Prom Multiprocessor support routines.  Don&squot;t call&n; *        these on a UP or else you will halt and catch fire. ;)&n; *&n; * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
multiline_comment|/* Start cpu with prom-tree node &squot;cpunode&squot; using context described&n; * by &squot;ctable_reg&squot; in context &squot;ctx&squot; at program counter &squot;pc&squot;.&n; *&n; * XXX Have to look into what the return values mean. XXX&n; */
r_int
DECL|function|prom_startcpu
id|prom_startcpu
c_func
(paren
r_int
id|cpunode
comma
r_struct
id|linux_prom_registers
op_star
id|ctable_reg
comma
r_int
id|ctx
comma
r_char
op_star
id|pc
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|prom_vers
)paren
(brace
r_case
id|PROM_V0
suffix:colon
r_case
id|PROM_V2
suffix:colon
r_case
id|PROM_AP1000
suffix:colon
r_default
suffix:colon
id|ret
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PROM_V3
suffix:colon
r_case
id|PROM_P1275
suffix:colon
id|ret
op_assign
(paren
op_star
(paren
id|romvec-&gt;v3_cpustart
)paren
)paren
(paren
id|cpunode
comma
(paren
r_int
)paren
id|ctable_reg
comma
id|ctx
comma
id|pc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ld [%0], %%g6&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
op_amp
id|current_set
(braket
id|smp_processor_id
c_func
(paren
)paren
)braket
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Stop CPU with device prom-tree node &squot;cpunode&squot;.&n; * XXX Again, what does the return value really mean? XXX&n; */
r_int
DECL|function|prom_stopcpu
id|prom_stopcpu
c_func
(paren
r_int
id|cpunode
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|prom_vers
)paren
(brace
r_case
id|PROM_V0
suffix:colon
r_case
id|PROM_V2
suffix:colon
r_case
id|PROM_AP1000
suffix:colon
r_default
suffix:colon
id|ret
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PROM_V3
suffix:colon
r_case
id|PROM_P1275
suffix:colon
id|ret
op_assign
(paren
op_star
(paren
id|romvec-&gt;v3_cpustop
)paren
)paren
(paren
id|cpunode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ld [%0], %%g6&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
op_amp
id|current_set
(braket
id|smp_processor_id
c_func
(paren
)paren
)braket
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Make CPU with device prom-tree node &squot;cpunode&squot; idle.&n; * XXX Return value, anyone? XXX&n; */
r_int
DECL|function|prom_idlecpu
id|prom_idlecpu
c_func
(paren
r_int
id|cpunode
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|prom_vers
)paren
(brace
r_case
id|PROM_V0
suffix:colon
r_case
id|PROM_V2
suffix:colon
r_case
id|PROM_AP1000
suffix:colon
r_default
suffix:colon
id|ret
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PROM_V3
suffix:colon
r_case
id|PROM_P1275
suffix:colon
id|ret
op_assign
(paren
op_star
(paren
id|romvec-&gt;v3_cpuidle
)paren
)paren
(paren
id|cpunode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ld [%0], %%g6&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
op_amp
id|current_set
(braket
id|smp_processor_id
c_func
(paren
)paren
)braket
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Resume the execution of CPU with nodeid &squot;cpunode&squot;.&n; * XXX Come on, somebody has to know... XXX&n; */
r_int
DECL|function|prom_restartcpu
id|prom_restartcpu
c_func
(paren
r_int
id|cpunode
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|prom_vers
)paren
(brace
r_case
id|PROM_V0
suffix:colon
r_case
id|PROM_V2
suffix:colon
r_case
id|PROM_AP1000
suffix:colon
r_default
suffix:colon
id|ret
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PROM_V3
suffix:colon
r_case
id|PROM_P1275
suffix:colon
id|ret
op_assign
(paren
op_star
(paren
id|romvec-&gt;v3_cpuresume
)paren
)paren
(paren
id|cpunode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ld [%0], %%g6&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
op_amp
id|current_set
(braket
id|smp_processor_id
c_func
(paren
)paren
)braket
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
eof
