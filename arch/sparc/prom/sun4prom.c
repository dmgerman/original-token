multiline_comment|/*&n; * Copyright (C) 1996 The Australian National University.&n; * Copyright (C) 1996 Fujitsu Laboratories Limited&n; * Copyright (C) 1997 Michael A. Griffith (grif@acm.org)&n; * Copyright (C) 1997 Sun Weenie (ko@ko.reno.nv.us)&n; * Copyright (C) 1998 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; * &n; * This software may be distributed under the terms of the Gnu&n; * Public License version 2 or later&n; *&n; * fake a really simple Sun prom for the SUN4&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/idprom.h&gt; 
macro_line|#include &lt;asm/machines.h&gt; 
macro_line|#include &lt;asm/sun4prom.h&gt;
macro_line|#include &lt;asm/asi.h&gt;
macro_line|#include &lt;asm/contregs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
DECL|variable|sun4romvec
r_static
r_struct
id|linux_romvec
id|sun4romvec
suffix:semicolon
DECL|variable|sun4_idprom
r_static
r_struct
id|idprom
id|sun4_idprom
suffix:semicolon
DECL|struct|property
r_struct
id|property
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|value
r_char
op_star
id|value
suffix:semicolon
DECL|member|length
r_int
id|length
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|node
r_struct
id|node
(brace
DECL|member|level
r_int
id|level
suffix:semicolon
DECL|member|properties
r_struct
id|property
op_star
id|properties
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|null_properties
r_struct
id|property
id|null_properties
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|root_properties
r_struct
id|property
id|root_properties
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;device_type&quot;
comma
l_string|&quot;cpu&quot;
comma
l_int|4
)brace
comma
(brace
l_string|&quot;idprom&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|sun4_idprom
comma
r_sizeof
(paren
r_struct
id|idprom
)paren
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
op_minus
l_int|1
)brace
)brace
suffix:semicolon
DECL|variable|nodes
r_struct
id|node
id|nodes
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
op_amp
id|null_properties
)brace
comma
(brace
l_int|0
comma
id|root_properties
)brace
comma
(brace
op_minus
l_int|1
comma
op_amp
id|null_properties
)brace
)brace
suffix:semicolon
DECL|function|no_nextnode
r_static
r_int
id|no_nextnode
c_func
(paren
r_int
id|node
)paren
(brace
r_if
c_cond
(paren
id|nodes
(braket
id|node
)braket
dot
id|level
op_eq
id|nodes
(braket
id|node
op_plus
l_int|1
)braket
dot
id|level
)paren
r_return
id|node
op_plus
l_int|1
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|no_child
r_static
r_int
id|no_child
c_func
(paren
r_int
id|node
)paren
(brace
r_if
c_cond
(paren
id|nodes
(braket
id|node
)braket
dot
id|level
op_eq
id|nodes
(braket
id|node
op_plus
l_int|1
)braket
dot
id|level
op_minus
l_int|1
)paren
r_return
id|node
op_plus
l_int|1
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|find_property
r_static
r_struct
id|property
op_star
id|find_property
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|property
op_star
id|prop
op_assign
op_amp
id|nodes
(braket
id|node
)braket
dot
id|properties
(braket
l_int|0
)braket
suffix:semicolon
r_while
c_loop
(paren
id|prop
op_logical_and
id|prop-&gt;name
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|prop-&gt;name
comma
id|name
)paren
op_eq
l_int|0
)paren
r_return
id|prop
suffix:semicolon
id|prop
op_increment
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|no_proplen
r_static
r_int
id|no_proplen
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|property
op_star
id|prop
op_assign
id|find_property
c_func
(paren
id|node
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop
)paren
r_return
id|prop-&gt;length
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|no_getprop
r_static
r_int
id|no_getprop
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
comma
r_char
op_star
id|value
)paren
(brace
r_struct
id|property
op_star
id|prop
op_assign
id|find_property
c_func
(paren
id|node
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop
)paren
(brace
id|memcpy
c_func
(paren
id|value
comma
id|prop-&gt;value
comma
id|prop-&gt;length
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|no_setprop
r_static
r_int
id|no_setprop
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
comma
r_char
op_star
id|value
comma
r_int
id|len
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|no_nextprop
r_static
r_char
op_star
id|no_nextprop
c_func
(paren
r_int
id|node
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|property
op_star
id|prop
op_assign
id|find_property
c_func
(paren
id|node
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop
)paren
r_return
id|prop
(braket
l_int|1
)braket
dot
id|name
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|variable|sun4_nodeops
r_static
r_struct
id|linux_nodeops
id|sun4_nodeops
op_assign
(brace
id|no_nextnode
comma
id|no_child
comma
id|no_proplen
comma
id|no_getprop
comma
id|no_setprop
comma
id|no_nextprop
)brace
suffix:semicolon
DECL|variable|synch_hook
r_static
r_int
id|synch_hook
suffix:semicolon
DECL|function|sun4_prom_init
r_struct
id|linux_romvec
op_star
id|__init
id|sun4_prom_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
id|x
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
id|p
op_assign
(paren
r_char
op_star
)paren
op_amp
id|sun4_idprom
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|sun4_idprom
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|__asm__
id|__volatile__
(paren
l_string|&quot;lduba [%1] %2, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|x
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|AC_IDPROM
op_plus
id|i
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_CONTROL
)paren
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|x
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|sun4romvec
comma
l_int|0
comma
r_sizeof
(paren
id|sun4romvec
)paren
)paren
suffix:semicolon
id|sun4_romvec
op_assign
(paren
id|linux_sun4_romvec
op_star
)paren
id|SUN4_PROM_VECTOR
suffix:semicolon
id|sun4romvec.pv_romvers
op_assign
l_int|40
suffix:semicolon
id|sun4romvec.pv_nodeops
op_assign
op_amp
id|sun4_nodeops
suffix:semicolon
id|sun4romvec.pv_reboot
op_assign
id|sun4_romvec-&gt;reboot
suffix:semicolon
id|sun4romvec.pv_abort
op_assign
id|sun4_romvec-&gt;abortentry
suffix:semicolon
id|sun4romvec.pv_halt
op_assign
id|sun4_romvec-&gt;exittomon
suffix:semicolon
id|sun4romvec.pv_synchook
op_assign
(paren
r_void
(paren
op_star
op_star
)paren
(paren
r_void
)paren
)paren
op_amp
id|synch_hook
suffix:semicolon
id|sun4romvec.pv_setctxt
op_assign
id|sun4_romvec-&gt;setcxsegmap
suffix:semicolon
id|sun4romvec.pv_v0bootargs
op_assign
id|sun4_romvec-&gt;bootParam
suffix:semicolon
id|sun4romvec.pv_nbgetchar
op_assign
id|sun4_romvec-&gt;mayget
suffix:semicolon
id|sun4romvec.pv_nbputchar
op_assign
id|sun4_romvec-&gt;mayput
suffix:semicolon
id|sun4romvec.pv_stdin
op_assign
id|sun4_romvec-&gt;insource
suffix:semicolon
id|sun4romvec.pv_stdout
op_assign
id|sun4_romvec-&gt;outsink
suffix:semicolon
multiline_comment|/*&n;&t; * We turn on the LEDs to let folks without monitors or&n;&t; * terminals know we booted.   Nothing too fancy now.  They&n;&t; * are all on, except for LED 5, which blinks.   When we&n;&t; * have more time, we can teach the penguin to say &quot;By your&n;&t; * command&quot; or &quot;Activating turbo boost, Michael&quot;. :-)&n;&t; */
id|sun4_romvec
op_member_access_from_pointer
id|setLEDs
c_func
(paren
l_int|0x0
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PROMLIB: Old Sun4 boot PROM monitor %s, romvec version %d&bslash;n&quot;
comma
id|sun4_romvec-&gt;monid
comma
id|sun4_romvec-&gt;romvecversion
)paren
suffix:semicolon
r_return
op_amp
id|sun4romvec
suffix:semicolon
)brace
eof
