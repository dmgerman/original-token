multiline_comment|/* $Id: init.c,v 1.14 2000/01/29 01:09:12 anton Exp $&n; * init.c:  Initialize internal variables used by the PROM&n; *          library functions.&n; *&n; * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n; * Copyright (C) 1998 Jakub Jelinek (jj@sunsite.mff.cuni.cz)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/sun4prom.h&gt;
DECL|variable|romvec
r_struct
id|linux_romvec
op_star
id|romvec
suffix:semicolon
DECL|variable|prom_vers
r_enum
id|prom_major_version
id|prom_vers
suffix:semicolon
DECL|variable|prom_rev
DECL|variable|prom_prev
r_int
r_int
id|prom_rev
comma
id|prom_prev
suffix:semicolon
DECL|variable|sun4_romvec
id|linux_sun4_romvec
op_star
id|sun4_romvec
suffix:semicolon
multiline_comment|/* The root node of the prom device tree. */
DECL|variable|prom_root_node
r_int
id|prom_root_node
suffix:semicolon
DECL|variable|prom_stdin
DECL|variable|prom_stdout
r_int
id|prom_stdin
comma
id|prom_stdout
suffix:semicolon
multiline_comment|/* Pointer to the device tree operations structure. */
DECL|variable|prom_nodeops
r_struct
id|linux_nodeops
op_star
id|prom_nodeops
suffix:semicolon
multiline_comment|/* You must call prom_init() before you attempt to use any of the&n; * routines in the prom library.  It returns 0 on success, 1 on&n; * failure.  It gets passed the pointer to the PROM vector.&n; */
r_extern
r_void
id|prom_meminit
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|prom_ranges_init
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|prom_init
r_void
id|__init
id|prom_init
c_func
(paren
r_struct
id|linux_romvec
op_star
id|rp
)paren
(brace
macro_line|#ifdef CONFIG_SUN4
r_extern
r_struct
id|linux_romvec
op_star
id|sun4_prom_init
c_func
(paren
r_void
)paren
suffix:semicolon
id|rp
op_assign
id|sun4_prom_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|romvec
op_assign
id|rp
suffix:semicolon
r_switch
c_cond
(paren
id|romvec-&gt;pv_romvers
)paren
(brace
r_case
l_int|0
suffix:colon
id|prom_vers
op_assign
id|PROM_V0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|prom_vers
op_assign
id|PROM_V2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|prom_vers
op_assign
id|PROM_V3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|40
suffix:colon
id|prom_vers
op_assign
id|PROM_SUN4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|prom_printf
c_func
(paren
l_string|&quot;PROMLIB: Bad PROM version %d&bslash;n&quot;
comma
id|romvec-&gt;pv_romvers
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|prom_rev
op_assign
id|romvec-&gt;pv_plugin_revision
suffix:semicolon
id|prom_prev
op_assign
id|romvec-&gt;pv_printrev
suffix:semicolon
id|prom_nodeops
op_assign
id|romvec-&gt;pv_nodeops
suffix:semicolon
id|prom_root_node
op_assign
id|prom_getsibling
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|prom_root_node
op_eq
l_int|0
)paren
op_logical_or
(paren
id|prom_root_node
op_eq
op_minus
l_int|1
)paren
)paren
(brace
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|prom_nodeops
)paren
op_eq
l_int|0
)paren
op_logical_or
(paren
(paren
(paren
r_int
r_int
)paren
id|prom_nodeops
)paren
op_eq
op_minus
l_int|1
)paren
)paren
(brace
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prom_vers
op_eq
id|PROM_V2
op_logical_or
id|prom_vers
op_eq
id|PROM_V3
)paren
(brace
id|prom_stdout
op_assign
op_star
id|romvec-&gt;pv_v2bootargs.fd_stdout
suffix:semicolon
id|prom_stdin
op_assign
op_star
id|romvec-&gt;pv_v2bootargs.fd_stdin
suffix:semicolon
)brace
id|prom_meminit
c_func
(paren
)paren
suffix:semicolon
id|prom_ranges_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef CONFIG_SUN4
multiline_comment|/* SUN4 prints this in sun4_prom_init */
id|printk
c_func
(paren
l_string|&quot;PROMLIB: Sun Boot Prom Version %d Revision %d&bslash;n&quot;
comma
id|romvec-&gt;pv_romvers
comma
id|prom_rev
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Initialization successful. */
r_return
suffix:semicolon
)brace
eof
