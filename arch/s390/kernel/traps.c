multiline_comment|/*&n; *  arch/s390/kernel/traps.c&n; *&n; *  S390 version&n; *    Copyright (C) 1999,2000 IBM Deutschland Entwicklung GmbH, IBM Corporation&n; *    Author(s): Martin Schwidefsky (schwidefsky@de.ibm.com),&n; *               Denis Joseph Barrow (djbarrow@de.ibm.com,barrow_dj@yahoo.com),&n; *&n; *  Derived from &quot;arch/i386/kernel/traps.c&quot;&n; *    Copyright (C) 1991, 1992 Linus Torvalds&n; */
multiline_comment|/*&n; * &squot;Traps.c&squot; handles hardware traps and faults after we have saved some&n; * state in &squot;asm.s&squot;.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/mathemu.h&gt;
macro_line|#if CONFIG_REMOTE_DEBUG
macro_line|#include &lt;asm/gdb-stub.h&gt;
macro_line|#endif
multiline_comment|/* Called from entry.S only */
r_extern
r_void
id|handle_per_exception
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
DECL|typedef|pgm_check_handler_t
r_typedef
r_void
id|pgm_check_handler_t
c_func
(paren
r_struct
id|pt_regs
op_star
comma
r_int
)paren
suffix:semicolon
DECL|variable|pgm_check_table
id|pgm_check_handler_t
op_star
id|pgm_check_table
(braket
l_int|128
)braket
suffix:semicolon
r_extern
id|pgm_check_handler_t
id|default_trap_handler
suffix:semicolon
r_extern
id|pgm_check_handler_t
id|do_page_fault
suffix:semicolon
id|asmlinkage
r_int
id|system_call
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|macro|DO_ERROR
mdefine_line|#define DO_ERROR(trapnr, signr, str, name, tsk) &bslash;&n;asmlinkage void name(struct pt_regs * regs, long error_code) &bslash;&n;{ &bslash;&n;        tsk-&gt;thread.error_code = error_code; &bslash;&n;        tsk-&gt;thread.trap_no = trapnr; &bslash;&n;&t;die_if_no_fixup(str,regs,error_code); &bslash;&n;        force_sig(signr, tsk); &bslash;&n;}
multiline_comment|/* TODO: define these as &squot;pgm_check_handler_t xxx;&squot;&n;asmlinkage void divide_error(void);&n;asmlinkage void debug(void);&n;asmlinkage void nmi(void);&n;asmlinkage void int3(void);&n;asmlinkage void overflow(void);&n;asmlinkage void bounds(void);&n;asmlinkage void invalid_op(void);&n;asmlinkage void device_not_available(void);&n;asmlinkage void double_fault(void);&n;asmlinkage void coprocessor_segment_overrun(void);&n;asmlinkage void invalid_TSS(void);&n;asmlinkage void segment_not_present(void);&n;asmlinkage void stack_segment(void);&n;asmlinkage void general_protection(void);&n;asmlinkage void coprocessor_error(void);&n;asmlinkage void reserved(void);&n;asmlinkage void alignment_check(void);&n;asmlinkage void spurious_interrupt_bug(void);&n;*/
DECL|variable|kstack_depth_to_print
r_int
id|kstack_depth_to_print
op_assign
l_int|24
suffix:semicolon
multiline_comment|/*&n; * These constants are for searching for possible module text&n; * segments.  VMALLOC_OFFSET comes from mm/vmalloc.c; MODULE_RANGE is&n; * a guess of how much space is likely to be vmalloced.&n; */
DECL|macro|VMALLOC_OFFSET
mdefine_line|#define VMALLOC_OFFSET (8*1024*1024)
DECL|macro|MODULE_RANGE
mdefine_line|#define MODULE_RANGE (8*1024*1024)
DECL|function|show_crashed_task_info
r_void
id|show_crashed_task_info
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;CPU:    %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Process %s (pid: %d, stackpage=%08X)&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
l_int|4096
op_plus
(paren
id|addr_t
)paren
id|current
)paren
suffix:semicolon
id|show_regs
c_func
(paren
id|current
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|show_registers
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;CPU:    %d&bslash;nPSW:    %08lx %08lx&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
(paren
r_int
r_int
)paren
id|regs-&gt;psw.mask
comma
(paren
r_int
r_int
)paren
id|regs-&gt;psw.addr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GPRS:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%08lx  %08lx  %08lx  %08lx&bslash;n&quot;
comma
id|regs-&gt;gprs
(braket
l_int|0
)braket
comma
id|regs-&gt;gprs
(braket
l_int|1
)braket
comma
id|regs-&gt;gprs
(braket
l_int|2
)braket
comma
id|regs-&gt;gprs
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%08lx  %08lx  %08lx  %08lx&bslash;n&quot;
comma
id|regs-&gt;gprs
(braket
l_int|4
)braket
comma
id|regs-&gt;gprs
(braket
l_int|5
)braket
comma
id|regs-&gt;gprs
(braket
l_int|6
)braket
comma
id|regs-&gt;gprs
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%08lx  %08lx  %08lx  %08lx&bslash;n&quot;
comma
id|regs-&gt;gprs
(braket
l_int|8
)braket
comma
id|regs-&gt;gprs
(braket
l_int|9
)braket
comma
id|regs-&gt;gprs
(braket
l_int|10
)braket
comma
id|regs-&gt;gprs
(braket
l_int|11
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%08lx  %08lx  %08lx  %08lx&bslash;n&quot;
comma
id|regs-&gt;gprs
(braket
l_int|12
)braket
comma
id|regs-&gt;gprs
(braket
l_int|13
)braket
comma
id|regs-&gt;gprs
(braket
l_int|14
)braket
comma
id|regs-&gt;gprs
(braket
l_int|15
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Process %s (pid: %d, stackpage=%08lx)&bslash;nStack: &quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
l_int|4096
op_plus
(paren
r_int
r_int
)paren
id|current
)paren
suffix:semicolon
multiline_comment|/*&n;        stack = (unsigned long *) esp;&n;        for(i=0; i &lt; kstack_depth_to_print; i++) {&n;                if (((long) stack &amp; 4095) == 0)&n;                        break;&n;                if (i &amp;&amp; ((i % 8) == 0))&n;                        printk(&quot;&bslash;n       &quot;);&n;                printk(&quot;%08lx &quot;, get_seg_long(ss,stack++));&n;        }&n;        printk(&quot;&bslash;nCall Trace: &quot;);&n;        stack = (unsigned long *) esp;&n;        i = 1;&n;        module_start = PAGE_OFFSET + (max_mapnr &lt;&lt; PAGE_SHIFT);&n;        module_start = ((module_start + VMALLOC_OFFSET) &amp; ~(VMALLOC_OFFSET-1));&n;        module_end = module_start + MODULE_RANGE;&n;        while (((long) stack &amp; 4095) != 0) {&n;                addr = get_seg_long(ss, stack++); */
multiline_comment|/*&n;                 * If the address is either in the text segment of the&n;                 * kernel, or in the region which contains vmalloc&squot;ed&n;                 * memory, it *may* be the address of a calling&n;                 * routine; if so, print it so that someone tracing&n;                 * down the cause of the crash will be able to figure&n;                 * out the call path that was taken.&n;                 */
multiline_comment|/*                if (((addr &gt;= (unsigned long) &amp;_stext) &amp;&amp;&n;                     (addr &lt;= (unsigned long) &amp;_etext)) ||&n;                    ((addr &gt;= module_start) &amp;&amp; (addr &lt;= module_end))) {&n;                        if (i &amp;&amp; ((i % 8) == 0))&n;                                printk(&quot;&bslash;n       &quot;);&n;                        printk(&quot;[&lt;%08lx&gt;] &quot;, addr);&n;                        i++;&n;                }&n;        }&n;        printk(&quot;&bslash;nCode: &quot;);&n;        for(i=0;i&lt;20;i++)&n;                printk(&quot;%02x &quot;,0xff &amp; get_seg_byte(regs-&gt;xcs &amp; 0xffff,(i+(char *)regs-&gt;eip)));&n;        printk(&quot;&bslash;n&quot;);&n;*/
)brace
macro_line|#endif
DECL|variable|die_lock
id|spinlock_t
id|die_lock
suffix:semicolon
DECL|function|die
r_void
id|die
c_func
(paren
r_const
r_char
op_star
id|str
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|err
)paren
(brace
id|console_verbose
c_func
(paren
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|die_lock
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %04lx&bslash;n&quot;
comma
id|str
comma
id|err
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|show_crashed_task_info
c_func
(paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|die_lock
)paren
suffix:semicolon
id|do_exit
c_func
(paren
id|SIGSEGV
)paren
suffix:semicolon
)brace
DECL|function|check_for_fixup
r_int
id|check_for_fixup
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|regs-&gt;psw.mask
op_amp
id|PSW_PROBLEM_STATE
)paren
)paren
(brace
r_int
r_int
id|fixup
suffix:semicolon
id|fixup
op_assign
id|search_exception_table
c_func
(paren
id|regs-&gt;psw.addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fixup
)paren
(brace
id|regs-&gt;psw.addr
op_assign
id|fixup
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|do_debugger_trap
r_int
id|do_debugger_trap
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|signal
)paren
(brace
r_if
c_cond
(paren
id|regs-&gt;psw.mask
op_amp
id|PSW_PROBLEM_STATE
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;flags
op_amp
id|PF_PTRACED
)paren
(brace
id|force_sig
c_func
(paren
id|signal
comma
id|current
)paren
suffix:semicolon
)brace
r_else
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
macro_line|#if CONFIG_REMOTE_DEBUG
r_if
c_cond
(paren
id|gdb_stub_initialised
)paren
(brace
id|gdb_stub_handle_exception
c_func
(paren
(paren
id|gdb_pt_regs
op_star
)paren
id|regs
comma
id|signal
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|die_if_no_fixup
r_static
r_void
id|die_if_no_fixup
c_func
(paren
r_const
r_char
op_star
id|str
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|err
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|regs-&gt;psw.mask
op_amp
id|PSW_PROBLEM_STATE
)paren
)paren
(brace
r_int
r_int
id|fixup
suffix:semicolon
id|fixup
op_assign
id|search_exception_table
c_func
(paren
id|regs-&gt;psw.addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fixup
)paren
(brace
id|regs-&gt;psw.addr
op_assign
id|fixup
suffix:semicolon
r_return
suffix:semicolon
)brace
id|die
c_func
(paren
id|str
comma
id|regs
comma
id|err
)paren
suffix:semicolon
)brace
)brace
DECL|function|default_trap_handler
id|asmlinkage
r_void
id|default_trap_handler
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|error_code
)paren
(brace
id|current-&gt;thread.error_code
op_assign
id|error_code
suffix:semicolon
id|current-&gt;thread.trap_no
op_assign
id|error_code
suffix:semicolon
id|die_if_no_fixup
c_func
(paren
l_string|&quot;Unknown program exception&quot;
comma
id|regs
comma
id|error_code
)paren
suffix:semicolon
id|force_sig
c_func
(paren
id|SIGSEGV
comma
id|current
)paren
suffix:semicolon
)brace
id|DO_ERROR
c_func
(paren
l_int|2
comma
id|SIGILL
comma
l_string|&quot;privileged operation&quot;
comma
id|privileged_op
comma
id|current
)paren
id|DO_ERROR
c_func
(paren
l_int|3
comma
id|SIGILL
comma
l_string|&quot;execute exception&quot;
comma
id|execute_exception
comma
id|current
)paren
id|DO_ERROR
c_func
(paren
l_int|5
comma
id|SIGSEGV
comma
l_string|&quot;addressing exception&quot;
comma
id|addressing_exception
comma
id|current
)paren
id|DO_ERROR
c_func
(paren
l_int|9
comma
id|SIGFPE
comma
l_string|&quot;fixpoint divide exception&quot;
comma
id|divide_exception
comma
id|current
)paren
id|DO_ERROR
c_func
(paren
l_int|0x12
comma
id|SIGILL
comma
l_string|&quot;translation exception&quot;
comma
id|translation_exception
comma
id|current
)paren
id|DO_ERROR
c_func
(paren
l_int|0x13
comma
id|SIGILL
comma
l_string|&quot;special operand exception&quot;
comma
id|special_op_exception
comma
id|current
)paren
id|DO_ERROR
c_func
(paren
l_int|0x15
comma
id|SIGILL
comma
l_string|&quot;operand exception&quot;
comma
id|operand_exception
comma
id|current
)paren
multiline_comment|/* need to define&n;DO_ERROR( 6, SIGILL,  &quot;invalid operand&quot;, invalid_op, current)&n;DO_ERROR( 8, SIGSEGV, &quot;double fault&quot;, double_fault, current)&n;DO_ERROR( 9, SIGFPE,  &quot;coprocessor segment overrun&quot;, coprocessor_segment_overrun, last_task_used_math)&n;DO_ERROR(10, SIGSEGV, &quot;invalid TSS&quot;, invalid_TSS, current)&n;DO_ERROR(11, SIGBUS,  &quot;segment not present&quot;, segment_not_present, current)&n;DO_ERROR(12, SIGBUS,  &quot;stack segment&quot;, stack_segment, current)&n;DO_ERROR(17, SIGSEGV, &quot;alignment check&quot;, alignment_check, current)&n;DO_ERROR(18, SIGSEGV, &quot;reserved&quot;, reserved, current)&n;DO_ERROR(19, SIGSEGV, &quot;cache flush denied&quot;, cache_flush_denied, current)&n;*/
macro_line|#ifdef CONFIG_IEEEFPU_EMULATION
DECL|function|illegal_op
id|asmlinkage
r_void
id|illegal_op
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|error_code
)paren
(brace
id|__u8
id|opcode
(braket
l_int|6
)braket
suffix:semicolon
id|__u16
op_star
id|location
suffix:semicolon
r_int
id|do_sig
op_assign
l_int|0
suffix:semicolon
r_int
id|problem_state
op_assign
(paren
id|regs-&gt;psw.mask
op_amp
id|PSW_PROBLEM_STATE
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|location
op_assign
(paren
id|__u16
op_star
)paren
(paren
id|regs-&gt;psw.addr
op_minus
id|S390_lowcore.pgm_ilc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|problem_state
)paren
(brace
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
id|opcode
)paren
comma
id|location
)paren
suffix:semicolon
)brace
r_else
op_star
(paren
(paren
id|__u16
op_star
)paren
id|opcode
)paren
op_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
id|location
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
id|opcode
)paren
op_eq
id|S390_BREAKPOINT_U16
)paren
(brace
r_if
c_cond
(paren
id|do_debugger_trap
c_func
(paren
id|regs
comma
id|SIGTRAP
)paren
)paren
(brace
id|do_sig
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|problem_state
)paren
(brace
r_if
c_cond
(paren
id|opcode
(braket
l_int|0
)braket
op_eq
l_int|0xb3
)paren
(brace
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|do_sig
op_assign
id|math_emu_b3
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|opcode
(braket
l_int|0
)braket
op_eq
l_int|0xed
)paren
(brace
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u32
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
(paren
id|__u32
op_star
)paren
(paren
id|location
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|do_sig
op_assign
id|math_emu_ed
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
id|opcode
)paren
op_eq
l_int|0xb299
)paren
(brace
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|do_sig
op_assign
id|math_emu_srnm
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
id|opcode
)paren
op_eq
l_int|0xb29c
)paren
(brace
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|do_sig
op_assign
id|math_emu_stfpc
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
id|opcode
)paren
op_eq
l_int|0xb29d
)paren
(brace
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|do_sig
op_assign
id|math_emu_lfpc
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
id|do_sig
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|do_sig
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|do_sig
)paren
(brace
id|current-&gt;thread.error_code
op_assign
id|error_code
suffix:semicolon
id|current-&gt;thread.trap_no
op_assign
l_int|1
suffix:semicolon
id|force_sig
c_func
(paren
id|SIGILL
comma
id|current
)paren
suffix:semicolon
id|die_if_no_fixup
c_func
(paren
l_string|&quot;illegal operation&quot;
comma
id|regs
comma
id|error_code
)paren
suffix:semicolon
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|specification_exception
id|asmlinkage
r_void
id|specification_exception
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|error_code
)paren
(brace
id|__u8
id|opcode
(braket
l_int|6
)braket
suffix:semicolon
id|__u16
op_star
id|location
suffix:semicolon
r_int
id|do_sig
op_assign
l_int|0
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;psw.mask
op_amp
l_int|0x00010000L
)paren
(brace
id|location
op_assign
(paren
id|__u16
op_star
)paren
(paren
id|regs-&gt;psw.addr
op_minus
id|S390_lowcore.pgm_ilc
)paren
suffix:semicolon
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
id|opcode
)paren
comma
id|location
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|opcode
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|0x28
suffix:colon
multiline_comment|/* LDR Rx,Ry   */
id|math_emu_ldr
c_func
(paren
id|opcode
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x38
suffix:colon
multiline_comment|/* LER Rx,Ry   */
id|math_emu_ler
c_func
(paren
id|opcode
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x60
suffix:colon
multiline_comment|/* STD R,D(X,B) */
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|math_emu_std
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x68
suffix:colon
multiline_comment|/* LD R,D(X,B) */
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|math_emu_ld
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x70
suffix:colon
multiline_comment|/* STE R,D(X,B) */
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|math_emu_ste
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x78
suffix:colon
multiline_comment|/* LE R,D(X,B) */
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|math_emu_le
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|do_sig
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|do_sig
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|do_sig
)paren
(brace
id|current-&gt;thread.error_code
op_assign
id|error_code
suffix:semicolon
id|current-&gt;thread.trap_no
op_assign
l_int|1
suffix:semicolon
id|force_sig
c_func
(paren
id|SIGILL
comma
id|current
)paren
suffix:semicolon
id|die_if_no_fixup
c_func
(paren
l_string|&quot;illegal operation&quot;
comma
id|regs
comma
id|error_code
)paren
suffix:semicolon
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|data_exception
id|asmlinkage
r_void
id|data_exception
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|error_code
)paren
(brace
id|__u8
id|opcode
(braket
l_int|6
)braket
suffix:semicolon
id|__u16
op_star
id|location
suffix:semicolon
r_int
id|do_sig
op_assign
l_int|0
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;psw.mask
op_amp
l_int|0x00010000L
)paren
(brace
id|location
op_assign
(paren
id|__u16
op_star
)paren
(paren
id|regs-&gt;psw.addr
op_minus
id|S390_lowcore.pgm_ilc
)paren
suffix:semicolon
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
id|opcode
)paren
comma
id|location
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|opcode
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|0x28
suffix:colon
multiline_comment|/* LDR Rx,Ry   */
id|math_emu_ldr
c_func
(paren
id|opcode
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x38
suffix:colon
multiline_comment|/* LER Rx,Ry   */
id|math_emu_ler
c_func
(paren
id|opcode
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x60
suffix:colon
multiline_comment|/* STD R,D(X,B) */
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|math_emu_std
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x68
suffix:colon
multiline_comment|/* LD R,D(X,B) */
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|math_emu_ld
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x70
suffix:colon
multiline_comment|/* STE R,D(X,B) */
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|math_emu_ste
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x78
suffix:colon
multiline_comment|/* LE R,D(X,B) */
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|math_emu_le
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xb3
suffix:colon
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|do_sig
op_assign
id|math_emu_b3
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xed
suffix:colon
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u32
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
(paren
id|__u32
op_star
)paren
(paren
id|location
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|do_sig
op_assign
id|math_emu_ed
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xb2
suffix:colon
r_if
c_cond
(paren
id|opcode
(braket
l_int|1
)braket
op_eq
l_int|0x99
)paren
(brace
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|do_sig
op_assign
id|math_emu_srnm
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|opcode
(braket
l_int|1
)braket
op_eq
l_int|0x9c
)paren
(brace
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|do_sig
op_assign
id|math_emu_stfpc
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|opcode
(braket
l_int|1
)braket
op_eq
l_int|0x9d
)paren
(brace
id|get_user
c_func
(paren
op_star
(paren
(paren
id|__u16
op_star
)paren
(paren
id|opcode
op_plus
l_int|2
)paren
)paren
comma
id|location
op_plus
l_int|1
)paren
suffix:semicolon
id|do_sig
op_assign
id|math_emu_lfpc
c_func
(paren
id|opcode
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
id|do_sig
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|do_sig
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|do_sig
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|do_sig
)paren
(brace
id|current-&gt;thread.error_code
op_assign
id|error_code
suffix:semicolon
id|current-&gt;thread.trap_no
op_assign
l_int|1
suffix:semicolon
id|force_sig
c_func
(paren
id|SIGILL
comma
id|current
)paren
suffix:semicolon
id|die_if_no_fixup
c_func
(paren
l_string|&quot;illegal operation&quot;
comma
id|regs
comma
id|error_code
)paren
suffix:semicolon
)brace
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#else
id|DO_ERROR
c_func
(paren
l_int|1
comma
id|SIGILL
comma
l_string|&quot;illegal operation&quot;
comma
id|illegal_op
comma
id|current
)paren
id|DO_ERROR
c_func
(paren
l_int|6
comma
id|SIGILL
comma
l_string|&quot;specification exception&quot;
comma
id|specification_exception
comma
id|current
)paren
id|DO_ERROR
c_func
(paren
l_int|7
comma
id|SIGILL
comma
l_string|&quot;data exception&quot;
comma
id|data_exception
comma
id|current
)paren
macro_line|#endif /* CONFIG_IEEEFPU_EMULATION */
multiline_comment|/* init is done in lowcore.S and head.S */
DECL|function|trap_init
r_void
id|__init
id|trap_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
id|pgm_check_table
(braket
id|i
)braket
op_assign
op_amp
id|default_trap_handler
suffix:semicolon
id|pgm_check_table
(braket
l_int|1
)braket
op_assign
op_amp
id|illegal_op
suffix:semicolon
id|pgm_check_table
(braket
l_int|2
)braket
op_assign
op_amp
id|privileged_op
suffix:semicolon
id|pgm_check_table
(braket
l_int|3
)braket
op_assign
op_amp
id|execute_exception
suffix:semicolon
id|pgm_check_table
(braket
l_int|5
)braket
op_assign
op_amp
id|addressing_exception
suffix:semicolon
id|pgm_check_table
(braket
l_int|6
)braket
op_assign
op_amp
id|specification_exception
suffix:semicolon
id|pgm_check_table
(braket
l_int|7
)braket
op_assign
op_amp
id|data_exception
suffix:semicolon
id|pgm_check_table
(braket
l_int|9
)braket
op_assign
op_amp
id|divide_exception
suffix:semicolon
id|pgm_check_table
(braket
l_int|0x12
)braket
op_assign
op_amp
id|translation_exception
suffix:semicolon
id|pgm_check_table
(braket
l_int|0x13
)braket
op_assign
op_amp
id|special_op_exception
suffix:semicolon
id|pgm_check_table
(braket
l_int|0x15
)braket
op_assign
op_amp
id|operand_exception
suffix:semicolon
id|pgm_check_table
(braket
l_int|4
)braket
op_assign
op_amp
id|do_page_fault
suffix:semicolon
id|pgm_check_table
(braket
l_int|0x10
)braket
op_assign
op_amp
id|do_page_fault
suffix:semicolon
id|pgm_check_table
(braket
l_int|0x11
)braket
op_assign
op_amp
id|do_page_fault
suffix:semicolon
id|pgm_check_table
(braket
l_int|0x1C
)braket
op_assign
op_amp
id|privileged_op
suffix:semicolon
)brace
DECL|function|handle_per_exception
r_void
id|handle_per_exception
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|regs-&gt;psw.mask
op_amp
id|PSW_PROBLEM_STATE
)paren
(brace
id|per_struct
op_star
id|per_info
op_assign
op_amp
id|current-&gt;thread.per_info
suffix:semicolon
id|per_info-&gt;lowcore.words.perc_atmid
op_assign
id|S390_lowcore.per_perc_atmid
suffix:semicolon
id|per_info-&gt;lowcore.words.address
op_assign
id|S390_lowcore.per_address
suffix:semicolon
id|per_info-&gt;lowcore.words.access_id
op_assign
id|S390_lowcore.per_access_id
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_debugger_trap
c_func
(paren
id|regs
comma
id|SIGTRAP
)paren
)paren
(brace
multiline_comment|/* I&squot;ve seen this possibly a task structure being reused ? */
id|printk
c_func
(paren
l_string|&quot;Spurious per exception detected&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;switching off per tracing for this task.&bslash;n&quot;
)paren
suffix:semicolon
id|show_crashed_task_info
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Hopefully switching off per tracing will help us survive */
id|regs-&gt;psw.mask
op_and_assign
op_complement
id|PSW_PER_MASK
suffix:semicolon
)brace
)brace
eof
