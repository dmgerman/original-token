multiline_comment|/*&n; *  arch/s390/boot/silo.c&n; *&n; *  S390 version&n; *    Copyright (C) 1999,2000 IBM Deutschland Entwicklung GmbH, IBM Corporation&n; *&n; *    Report bugs to: &lt;linux390@de.ibm.com&gt;&n; *&n; *    Author(s): Holger Smolinski &lt;Holger.Smolinski@de.ibm.com&gt;&n; *               Fritz Elfert &lt;felfert@to.com&gt; contributed support for&n; *                &t;/etc/silo.conf based on Intel&squot;s lilo&n; */
macro_line|#include &lt;stddef.h&gt;
macro_line|#include &lt;stdlib.h&gt;
macro_line|#include &lt;stdio.h&gt;
macro_line|#include &lt;string.h&gt;
macro_line|#include &lt;unistd.h&gt;
macro_line|#include &lt;fcntl.h&gt;
macro_line|#include &lt;errno.h&gt;
macro_line|#include &lt;limits.h&gt;
macro_line|#include &lt;dirent.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;sys/types.h&gt;
macro_line|#include &lt;sys/stat.h&gt;
macro_line|#include &lt;sys/ioctl.h&gt;
macro_line|#include &lt;asm/ioctl.h&gt;
macro_line|#include &quot;cfg.h&quot;
DECL|variable|cf_options
id|CONFIG
id|cf_options
(braket
)braket
op_assign
(brace
(brace
id|cft_strg
comma
l_string|&quot;append&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_strg
comma
l_string|&quot;image&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_strg
comma
l_string|&quot;ipldevice&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_strg
comma
l_string|&quot;bootsect&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_strg
comma
l_string|&quot;map&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_strg
comma
l_string|&quot;parmfile&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_strg
comma
l_string|&quot;ramdisk&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_strg
comma
l_string|&quot;root&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_flag
comma
l_string|&quot;readonly&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_strg
comma
l_string|&quot;verbose&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_strg
comma
l_string|&quot;testlevel&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|cft_end
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
)brace
suffix:semicolon
multiline_comment|/* from dasd.h */
DECL|macro|DASD_PARTN_BITS
mdefine_line|#define DASD_PARTN_BITS 2
DECL|macro|BIODASDRWTB
mdefine_line|#define BIODASDRWTB _IOWR(&squot;D&squot;,5,int)
multiline_comment|/* end */
DECL|macro|SILO_CFG
mdefine_line|#define SILO_CFG &quot;/etc/silo.conf&quot;
DECL|macro|SILO_IMAGE
mdefine_line|#define SILO_IMAGE &quot;./image&quot;
DECL|macro|SILO_BOOTMAP
mdefine_line|#define SILO_BOOTMAP &quot;./boot.map&quot;
DECL|macro|SILO_PARMFILE
mdefine_line|#define SILO_PARMFILE &quot;./parmfile&quot;
DECL|macro|SILO_BOOTSECT
mdefine_line|#define SILO_BOOTSECT &quot;/boot/ipleckd.boot&quot;
DECL|macro|PRINT_LEVEL
mdefine_line|#define PRINT_LEVEL(x,y...) if ( silo_options.verbosity &gt;= x ) printf(y)
DECL|macro|ERROR_LEVEL
mdefine_line|#define ERROR_LEVEL(x,y...) if ( silo_options.verbosity &gt;= x ) fprintf(stderr,y)
DECL|macro|TOGGLE
mdefine_line|#define TOGGLE(x) ((x)=((x)?(0):(1)))
DECL|macro|GETARG
mdefine_line|#define GETARG(x) {int len=strlen(optarg);x=malloc(len);strncpy(x,optarg,len);PRINT_LEVEL(1,&quot;%s set to %s&bslash;n&quot;,#x,optarg);}
DECL|macro|ITRY
mdefine_line|#define ITRY(x) if ( (x) == -1 ) { ERROR_LEVEL(0,&quot;%s (line:%d) &squot;%s&squot; returned %d=&squot;%s&squot;&bslash;n&quot;, __FILE__,__LINE__,#x,errno,strerror(errno)); usage(); exit(1); }
DECL|macro|NTRY
mdefine_line|#define NTRY(x) if ( (x) == 0 ) { ERROR_LEVEL(0,&quot;%s (line:%d) &squot;%s&squot; returned %d=&squot;%s&squot;&bslash;n&quot;, __FILE__,__LINE__,#x,errno,strerror(errno)); usage(); exit(1); }
DECL|macro|MAX_CLUSTERS
mdefine_line|#define MAX_CLUSTERS 256
DECL|macro|PARTN_MASK
mdefine_line|#define PARTN_MASK ((1 &lt;&lt; DASD_PARTN_BITS) - 1)
DECL|macro|SILO_VERSION
mdefine_line|#define SILO_VERSION &quot;1.1&quot;
DECL|struct|silo_options
r_struct
id|silo_options
(brace
DECL|member|verbosity
r_int
r_int
id|verbosity
suffix:semicolon
DECL|member|testlevel
r_int
r_int
id|testlevel
suffix:semicolon
DECL|member|image
r_char
op_star
id|image
suffix:semicolon
DECL|member|ipldevice
r_char
op_star
id|ipldevice
suffix:semicolon
DECL|member|parmfile
r_char
op_star
id|parmfile
suffix:semicolon
DECL|member|ramdisk
r_char
op_star
id|ramdisk
suffix:semicolon
DECL|member|bootsect
r_char
op_star
id|bootsect
suffix:semicolon
DECL|member|conffile
r_char
op_star
id|conffile
suffix:semicolon
DECL|member|bootmap
r_char
op_star
id|bootmap
suffix:semicolon
)brace
DECL|variable|silo_options
id|silo_options
op_assign
(brace
l_int|1
comma
multiline_comment|/* verbosity */
l_int|2
comma
multiline_comment|/* testlevel */
id|SILO_IMAGE
comma
multiline_comment|/* image */
l_int|NULL
comma
multiline_comment|/* ipldevice */
id|SILO_PARMFILE
comma
multiline_comment|/* parmfile */
l_int|NULL
comma
multiline_comment|/* initrd */
id|SILO_BOOTSECT
comma
multiline_comment|/* bootsector */
id|SILO_CFG
comma
multiline_comment|/* silo.conf file */
id|SILO_BOOTMAP
comma
multiline_comment|/* boot.map */
)brace
suffix:semicolon
DECL|struct|blockdesc
r_struct
id|blockdesc
(brace
DECL|member|off
r_int
r_int
id|off
suffix:semicolon
DECL|member|ct
r_int
r_int
id|ct
suffix:semicolon
DECL|member|addr
r_int
r_int
id|addr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|blocklist
r_struct
id|blocklist
(brace
DECL|member|blk
r_struct
id|blockdesc
id|blk
(braket
id|MAX_CLUSTERS
)braket
suffix:semicolon
DECL|member|ix
r_int
r_int
id|ix
suffix:semicolon
)brace
suffix:semicolon
r_void
DECL|function|usage
id|usage
(paren
r_void
)paren
(brace
id|printf
(paren
l_string|&quot;Usage:&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;silo -d ipldevice [additional options]&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-d /dev/node : set ipldevice to /dev/node&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-f image : set image to image&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-F conffile : specify configuration file (/etc/silo.conf)&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-p parmfile : set parameter file to parmfile&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-b bootsect : set bootsector to bootsect&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;Additional options&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-B bootmap:&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-v: increase verbosity level&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-v#: set verbosity level to #&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-t: decrease testing level&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-h: print this message&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-?: print this message&bslash;n&quot;
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;-V: print version&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_int
DECL|function|read_cfg
id|read_cfg
c_func
(paren
r_struct
id|silo_options
op_star
id|o
)paren
(brace
r_char
op_star
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|access
c_func
(paren
id|o-&gt;conffile
comma
id|R_OK
)paren
op_logical_and
(paren
id|errno
op_eq
id|ENOENT
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* If errno != ENOENT, let cfg_open report an error */
id|cfg_open
c_func
(paren
id|o-&gt;conffile
)paren
suffix:semicolon
id|cfg_parse
c_func
(paren
id|cf_options
)paren
suffix:semicolon
id|tmp
op_assign
id|cfg_get_strg
c_func
(paren
id|cf_options
comma
l_string|&quot;ipldevice&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|o-&gt;ipldevice
op_logical_and
id|tmp
)paren
id|o-&gt;ipldevice
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
id|cfg_get_strg
c_func
(paren
id|cf_options
comma
l_string|&quot;image&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|o
op_member_access_from_pointer
id|image
comma
id|SILO_IMAGE
comma
id|strlen
c_func
(paren
id|SILO_IMAGE
)paren
)paren
op_logical_and
id|tmp
)paren
id|o-&gt;image
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
id|cfg_get_strg
c_func
(paren
id|cf_options
comma
l_string|&quot;parmfile&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|o-&gt;parmfile
comma
id|SILO_PARMFILE
comma
id|strlen
c_func
(paren
id|SILO_PARMFILE
)paren
)paren
op_logical_and
id|tmp
)paren
id|o-&gt;parmfile
op_assign
id|tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|o
op_member_access_from_pointer
id|ramdisk
)paren
id|o-&gt;ramdisk
op_assign
id|cfg_get_strg
c_func
(paren
id|cf_options
comma
l_string|&quot;ramdisk&quot;
)paren
suffix:semicolon
id|tmp
op_assign
id|cfg_get_strg
c_func
(paren
id|cf_options
comma
l_string|&quot;bootsect&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|o
op_member_access_from_pointer
id|bootsect
comma
id|SILO_BOOTSECT
comma
id|strlen
c_func
(paren
id|SILO_BOOTSECT
)paren
)paren
op_logical_and
id|tmp
)paren
id|o-&gt;bootsect
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
id|cfg_get_strg
c_func
(paren
id|cf_options
comma
l_string|&quot;map&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|o
op_member_access_from_pointer
id|bootmap
comma
id|SILO_BOOTMAP
comma
id|strlen
c_func
(paren
id|SILO_BOOTMAP
)paren
)paren
op_logical_and
id|tmp
)paren
id|o-&gt;bootmap
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
id|cfg_get_strg
c_func
(paren
id|cf_options
comma
l_string|&quot;verbose&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
id|sscanf
(paren
id|tmp
comma
l_string|&quot;%hu&quot;
comma
op_amp
id|v
)paren
suffix:semicolon
id|o-&gt;verbosity
op_assign
id|v
suffix:semicolon
)brace
id|tmp
op_assign
id|cfg_get_strg
c_func
(paren
id|cf_options
comma
l_string|&quot;testlevel&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
)paren
(brace
r_int
r_int
id|t
suffix:semicolon
id|sscanf
(paren
id|tmp
comma
l_string|&quot;%hu&quot;
comma
op_amp
id|t
)paren
suffix:semicolon
id|o-&gt;testlevel
op_add_assign
id|t
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_char
op_star
DECL|function|gen_tmpparm
id|gen_tmpparm
c_func
(paren
r_char
op_star
id|pfile
)paren
(brace
r_char
op_star
id|append
op_assign
id|cfg_get_strg
c_func
(paren
id|cf_options
comma
l_string|&quot;append&quot;
)paren
suffix:semicolon
r_char
op_star
id|root
op_assign
id|cfg_get_strg
c_func
(paren
id|cf_options
comma
l_string|&quot;root&quot;
)paren
suffix:semicolon
r_int
id|ro
op_assign
id|cfg_get_flag
c_func
(paren
id|cf_options
comma
l_string|&quot;readonly&quot;
)paren
suffix:semicolon
id|FILE
op_star
id|f
comma
op_star
id|of
suffix:semicolon
r_char
op_star
id|fn
suffix:semicolon
r_char
id|c
suffix:semicolon
r_char
op_star
id|tmpdir
op_assign
l_int|NULL
comma
op_star
id|save
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|append
op_logical_and
op_logical_neg
id|root
op_logical_and
op_logical_neg
id|ro
)paren
r_return
id|pfile
suffix:semicolon
id|of
op_assign
id|fopen
c_func
(paren
id|pfile
comma
l_string|&quot;r&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|of
)paren
(brace
id|NTRY
c_func
(paren
id|fn
op_assign
id|tempnam
c_func
(paren
l_int|NULL
comma
l_string|&quot;parm.&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|fn
op_assign
id|pfile
suffix:semicolon
)brace
id|NTRY
c_func
(paren
id|f
op_assign
id|fopen
c_func
(paren
id|fn
comma
l_string|&quot;a+&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|of
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|feof
(paren
id|of
)paren
)paren
(brace
id|c
op_assign
id|fgetc
c_func
(paren
id|of
)paren
suffix:semicolon
id|fputc
c_func
(paren
id|c
comma
id|f
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|root
)paren
id|fprintf
c_func
(paren
id|f
comma
l_string|&quot; root=%s&quot;
comma
id|root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ro
)paren
id|fprintf
c_func
(paren
id|f
comma
l_string|&quot; ro&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|append
)paren
id|fprintf
c_func
(paren
id|f
comma
l_string|&quot; %s&quot;
comma
id|append
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|f
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|fclose
c_func
(paren
id|f
)paren
suffix:semicolon
id|fclose
c_func
(paren
id|of
)paren
suffix:semicolon
id|printf
(paren
l_string|&quot;tempfile is %s&bslash;n&quot;
comma
id|fn
)paren
suffix:semicolon
r_return
id|strdup
c_func
(paren
id|fn
)paren
suffix:semicolon
)brace
r_int
DECL|function|parse_options
id|parse_options
(paren
r_struct
id|silo_options
op_star
id|o
comma
r_int
id|argc
comma
r_char
op_star
id|argv
(braket
)braket
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|oc
suffix:semicolon
r_while
c_loop
(paren
(paren
id|oc
op_assign
id|getopt
(paren
id|argc
comma
id|argv
comma
l_string|&quot;Vf:F:d:p:r:b:B:h?v::t::&quot;
)paren
)paren
op_ne
op_minus
l_int|1
)paren
(brace
r_switch
c_cond
(paren
id|oc
)paren
(brace
r_case
l_char|&squot;V&squot;
suffix:colon
id|printf
c_func
(paren
l_string|&quot;silo version: %s&bslash;n&quot;
comma
id|SILO_VERSION
)paren
suffix:semicolon
m_exit
(paren
l_int|0
)paren
suffix:semicolon
r_case
l_char|&squot;v&squot;
suffix:colon
(brace
r_int
r_int
id|v
suffix:semicolon
r_if
c_cond
(paren
id|optarg
op_logical_and
id|sscanf
(paren
id|optarg
comma
l_string|&quot;%hu&quot;
comma
op_amp
id|v
)paren
)paren
id|o-&gt;verbosity
op_assign
id|v
suffix:semicolon
r_else
id|o-&gt;verbosity
op_increment
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;Verbosity value is now %hu&bslash;n&quot;
comma
id|o-&gt;verbosity
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
l_char|&squot;t&squot;
suffix:colon
(brace
r_int
r_int
id|t
suffix:semicolon
r_if
c_cond
(paren
id|optarg
op_logical_and
id|sscanf
(paren
id|optarg
comma
l_string|&quot;%hu&quot;
comma
op_amp
id|t
)paren
)paren
id|o-&gt;testlevel
op_sub_assign
id|t
suffix:semicolon
r_else
id|o-&gt;testlevel
op_decrement
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;Testonly flag is now %d&bslash;n&quot;
comma
id|o-&gt;testlevel
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
l_char|&squot;h&squot;
suffix:colon
r_case
l_char|&squot;?&squot;
suffix:colon
id|usage
(paren
)paren
suffix:semicolon
m_exit
(paren
l_int|0
)paren
suffix:semicolon
r_case
l_char|&squot;d&squot;
suffix:colon
id|GETARG
(paren
id|o-&gt;ipldevice
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;f&squot;
suffix:colon
id|GETARG
(paren
id|o-&gt;image
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;F&squot;
suffix:colon
id|GETARG
(paren
id|o-&gt;conffile
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;p&squot;
suffix:colon
id|GETARG
(paren
id|o-&gt;parmfile
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;r&squot;
suffix:colon
id|GETARG
(paren
id|o-&gt;ramdisk
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;b&squot;
suffix:colon
id|GETARG
(paren
id|o-&gt;bootsect
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;B&squot;
suffix:colon
id|GETARG
(paren
id|o-&gt;bootmap
)paren
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|read_cfg
c_func
(paren
id|o
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|verify_device
id|verify_device
(paren
r_char
op_star
id|name
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|stat
id|dst
suffix:semicolon
r_struct
id|stat
id|st
suffix:semicolon
id|ITRY
(paren
id|stat
(paren
id|name
comma
op_amp
id|dst
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISBLK
(paren
id|dst.st_mode
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|MINOR
(paren
id|dst.st_rdev
)paren
op_amp
id|PARTN_MASK
)paren
)paren
(brace
id|rc
op_assign
id|dst.st_rdev
suffix:semicolon
)brace
r_else
multiline_comment|/* invalid MINOR &amp; PARTN_MASK */
(brace
id|ERROR_LEVEL
(paren
l_int|1
comma
l_string|&quot;Cannot boot from partition %d %d %d&quot;
comma
(paren
r_int
)paren
id|PARTN_MASK
comma
(paren
r_int
)paren
id|MINOR
(paren
id|dst.st_rdev
)paren
comma
(paren
r_int
)paren
(paren
id|PARTN_MASK
op_amp
id|MINOR
(paren
id|dst.st_rdev
)paren
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
id|errno
op_assign
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* error S_ISBLK */
(brace
id|ERROR_LEVEL
(paren
l_int|1
comma
l_string|&quot;%s is no block device&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
id|errno
op_assign
id|EINVAL
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|verify_file
id|verify_file
(paren
r_char
op_star
id|name
comma
r_int
id|dev
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|stat
id|dst
suffix:semicolon
r_struct
id|stat
id|st
suffix:semicolon
r_int
id|bs
op_assign
l_int|1024
suffix:semicolon
r_int
id|l
suffix:semicolon
id|ITRY
c_func
(paren
id|stat
(paren
id|name
comma
op_amp
id|dst
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISREG
(paren
id|dst.st_mode
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|MAJOR
(paren
id|dev
)paren
op_eq
(paren
r_int
)paren
id|MAJOR
(paren
id|dst.st_dev
)paren
op_logical_and
(paren
r_int
)paren
id|MINOR
(paren
id|dev
)paren
op_eq
(paren
r_int
)paren
(paren
id|MINOR
(paren
id|dst.st_dev
)paren
op_amp
op_complement
id|PARTN_MASK
)paren
)paren
(brace
multiline_comment|/* whatever to do if all is ok... */
)brace
r_else
multiline_comment|/* devicenumber doesn&squot;t match */
(brace
id|ERROR_LEVEL
(paren
l_int|1
comma
l_string|&quot;%s is not on device (%d/%d) but on (%d/%d)&bslash;n&quot;
comma
id|name
comma
(paren
r_int
)paren
id|MAJOR
(paren
id|dev
)paren
comma
(paren
r_int
)paren
id|MINOR
(paren
id|dev
)paren
comma
(paren
r_int
)paren
id|MAJOR
(paren
id|dst.st_dev
)paren
comma
(paren
r_int
)paren
(paren
id|MINOR
(paren
id|dst.st_dev
)paren
op_amp
op_complement
id|PARTN_MASK
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
id|errno
op_assign
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* error S_ISREG */
(brace
id|ERROR_LEVEL
(paren
l_int|1
comma
l_string|&quot;%s is neither regular file nor linkto one&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
id|errno
op_assign
id|EINVAL
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|verify_options
id|verify_options
(paren
r_struct
id|silo_options
op_star
id|o
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|dev
op_assign
l_int|0
suffix:semicolon
r_int
id|crc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|o-&gt;ipldevice
op_logical_or
op_logical_neg
id|o-&gt;image
op_logical_or
op_logical_neg
id|o-&gt;bootsect
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|o-&gt;ipldevice
)paren
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;ipldevice&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|o-&gt;image
)paren
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;image&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|o-&gt;bootsect
)paren
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;bootsect&bslash;n&quot;
)paren
suffix:semicolon
id|usage
(paren
)paren
suffix:semicolon
m_exit
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;Testlevel is set to %d&bslash;n&quot;
comma
id|o-&gt;testlevel
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;IPL device is: &squot;%s&squot;&quot;
comma
id|o-&gt;ipldevice
)paren
suffix:semicolon
id|ITRY
(paren
id|dev
op_assign
id|verify_device
(paren
id|o-&gt;ipldevice
)paren
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|2
comma
l_string|&quot;...ok...(%d/%d)&quot;
comma
(paren
r_int
r_int
)paren
id|MAJOR
(paren
id|dev
)paren
comma
(paren
r_int
r_int
)paren
id|MINOR
(paren
id|dev
)paren
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;bootsector is: &squot;%s&squot;&quot;
comma
id|o-&gt;bootsect
)paren
suffix:semicolon
id|ITRY
(paren
id|verify_file
(paren
id|o-&gt;bootsect
comma
id|dev
)paren
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;...ok...&quot;
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|o
op_member_access_from_pointer
id|testlevel
OG
l_int|0
op_logical_and
op_logical_neg
id|strncmp
c_func
(paren
id|o-&gt;bootmap
comma
id|SILO_BOOTMAP
comma
id|strlen
c_func
(paren
id|SILO_BOOTMAP
)paren
)paren
)paren
(brace
id|NTRY
c_func
(paren
id|o
op_member_access_from_pointer
id|bootmap
op_assign
id|tempnam
c_func
(paren
l_int|NULL
comma
l_string|&quot;boot.&quot;
)paren
)paren
suffix:semicolon
)brace
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;bootmap is set to: &squot;%s&squot;&quot;
comma
id|o-&gt;bootmap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|access
(paren
id|o-&gt;bootmap
comma
id|O_RDWR
)paren
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|errno
op_eq
id|ENOENT
)paren
(brace
id|ITRY
(paren
id|creat
(paren
id|o
op_member_access_from_pointer
id|bootmap
comma
id|O_RDWR
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|PRINT_LEVEL
c_func
(paren
l_int|1
comma
l_string|&quot;Cannot acces bootmap file &squot;%s&squot;: %s&bslash;n&quot;
comma
id|o-&gt;bootmap
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
)brace
)brace
id|ITRY
(paren
id|verify_file
(paren
id|o-&gt;bootmap
comma
id|dev
)paren
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;...ok...&quot;
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;Kernel image is: &squot;%s&squot;&quot;
comma
id|o-&gt;image
)paren
suffix:semicolon
id|ITRY
(paren
id|verify_file
(paren
id|o-&gt;image
comma
id|dev
)paren
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;...ok...&quot;
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;original parameterfile is: &squot;%s&squot;&quot;
comma
id|o-&gt;parmfile
)paren
suffix:semicolon
id|ITRY
(paren
id|verify_file
(paren
id|o-&gt;parmfile
comma
id|dev
)paren
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;...ok...&quot;
)paren
suffix:semicolon
id|o-&gt;parmfile
op_assign
id|gen_tmpparm
c_func
(paren
id|o-&gt;parmfile
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;final parameterfile is: &squot;%s&squot;&quot;
comma
id|o-&gt;parmfile
)paren
suffix:semicolon
id|ITRY
(paren
id|verify_file
(paren
id|o-&gt;parmfile
comma
id|dev
)paren
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;...ok...&quot;
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|o-&gt;ramdisk
)paren
(brace
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;initialramdisk is: &squot;%s&squot;&quot;
comma
id|o-&gt;ramdisk
)paren
suffix:semicolon
id|ITRY
(paren
id|verify_file
(paren
id|o-&gt;ramdisk
comma
id|dev
)paren
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;...ok...&quot;
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|0
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|crc
suffix:semicolon
)brace
r_int
DECL|function|add_file_to_blocklist
id|add_file_to_blocklist
(paren
r_char
op_star
id|name
comma
r_struct
id|blocklist
op_star
id|lst
comma
r_int
id|addr
)paren
(brace
r_int
id|fd
suffix:semicolon
r_int
id|devfd
suffix:semicolon
r_struct
id|stat
id|fst
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|blk
suffix:semicolon
r_int
id|bs
suffix:semicolon
r_int
id|blocks
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|ITRY
(paren
id|fd
op_assign
id|open
(paren
id|name
comma
id|O_RDONLY
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|fstat
(paren
id|fd
comma
op_amp
id|fst
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|mknod
(paren
l_string|&quot;/tmp/silodev&quot;
comma
id|S_IFBLK
op_or
id|S_IRUSR
op_or
id|S_IWUSR
comma
id|fst.st_dev
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|devfd
op_assign
id|open
(paren
l_string|&quot;/tmp/silodev&quot;
comma
id|O_RDONLY
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|ioctl
(paren
id|fd
comma
id|FIGETBSZ
comma
op_amp
id|bs
)paren
)paren
suffix:semicolon
id|blocks
op_assign
(paren
id|fst.st_size
op_plus
id|bs
op_minus
l_int|1
)paren
op_div
id|bs
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|blocks
suffix:semicolon
id|i
op_increment
)paren
(brace
id|blk
op_assign
id|i
suffix:semicolon
id|ITRY
(paren
id|ioctl
(paren
id|fd
comma
id|FIBMAP
comma
op_amp
id|blk
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blk
)paren
(brace
r_int
id|oldblk
op_assign
id|blk
suffix:semicolon
id|ITRY
(paren
id|ioctl
(paren
id|devfd
comma
id|BIODASDRWTB
comma
op_amp
id|blk
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blk
op_le
l_int|0
)paren
(brace
id|ERROR_LEVEL
(paren
l_int|0
comma
l_string|&quot;BIODASDRWTB on blk %d returned %d&bslash;n&quot;
comma
id|oldblk
comma
id|blk
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;Filled hole on blk %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lst-&gt;ix
op_eq
l_int|0
op_logical_or
id|i
op_eq
l_int|0
op_logical_or
id|lst-&gt;blk
(braket
id|lst-&gt;ix
op_minus
l_int|1
)braket
dot
id|ct
op_ge
l_int|128
op_logical_or
(paren
id|lst-&gt;blk
(braket
id|lst-&gt;ix
op_minus
l_int|1
)braket
dot
id|off
op_plus
id|lst-&gt;blk
(braket
id|lst-&gt;ix
op_minus
l_int|1
)braket
dot
id|ct
op_ne
id|blk
op_logical_and
op_logical_neg
(paren
id|lst-&gt;blk
(braket
id|lst-&gt;ix
op_minus
l_int|1
)braket
dot
id|off
op_eq
l_int|0
op_logical_and
id|blk
op_eq
l_int|0
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|lst-&gt;ix
op_ge
id|MAX_CLUSTERS
)paren
(brace
id|rc
op_assign
l_int|1
suffix:semicolon
id|errno
op_assign
id|ENOMEM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|lst-&gt;blk
(braket
id|lst-&gt;ix
)braket
dot
id|off
op_assign
id|blk
suffix:semicolon
id|lst-&gt;blk
(braket
id|lst-&gt;ix
)braket
dot
id|ct
op_assign
l_int|1
suffix:semicolon
id|lst-&gt;blk
(braket
id|lst-&gt;ix
)braket
dot
id|addr
op_assign
id|addr
op_plus
id|i
op_star
id|bs
suffix:semicolon
id|lst-&gt;ix
op_increment
suffix:semicolon
)brace
r_else
(brace
id|lst-&gt;blk
(braket
id|lst-&gt;ix
op_minus
l_int|1
)braket
dot
id|ct
op_increment
suffix:semicolon
)brace
)brace
id|ITRY
c_func
(paren
id|unlink
c_func
(paren
l_string|&quot;/tmp/silodev&quot;
)paren
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|write_bootsect
id|write_bootsect
(paren
r_struct
id|silo_options
op_star
id|o
comma
r_struct
id|blocklist
op_star
id|blklst
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|s_fd
comma
id|d_fd
comma
id|b_fd
comma
id|bd_fd
suffix:semicolon
r_struct
id|stat
id|s_st
comma
id|d_st
comma
id|b_st
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|bs
comma
id|boots
suffix:semicolon
r_char
op_star
id|tmpdev
suffix:semicolon
r_char
id|buffer
(braket
l_int|4096
)braket
op_assign
initialization_block
suffix:semicolon
id|ITRY
(paren
id|d_fd
op_assign
id|open
(paren
id|o-&gt;ipldevice
comma
id|O_RDWR
op_or
id|O_SYNC
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|fstat
(paren
id|d_fd
comma
op_amp
id|d_st
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|s_fd
op_assign
id|open
(paren
id|o-&gt;bootmap
comma
id|O_RDWR
op_or
id|O_TRUNC
op_or
id|O_CREAT
op_or
id|O_SYNC
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|verify_file
(paren
id|o-&gt;bootsect
comma
id|d_st.st_rdev
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|blklst-&gt;ix
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|offset
op_assign
id|blklst-&gt;blk
(braket
id|i
)braket
dot
id|off
suffix:semicolon
r_int
id|addrct
op_assign
id|blklst-&gt;blk
(braket
id|i
)braket
dot
id|addr
op_or
(paren
id|blklst-&gt;blk
(braket
id|i
)braket
dot
id|ct
op_amp
l_int|0xff
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;ix %i: offset: %06x count: %02x address: 0x%08x&bslash;n&quot;
comma
id|i
comma
id|offset
comma
id|blklst-&gt;blk
(braket
id|i
)braket
dot
id|ct
op_amp
l_int|0xff
comma
id|blklst-&gt;blk
(braket
id|i
)braket
dot
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|o-&gt;testlevel
op_le
l_int|1
)paren
(brace
id|NTRY
(paren
id|write
(paren
id|s_fd
comma
op_amp
id|offset
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
suffix:semicolon
id|NTRY
(paren
id|write
(paren
id|s_fd
comma
op_amp
id|addrct
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
id|ITRY
(paren
id|ioctl
(paren
id|s_fd
comma
id|FIGETBSZ
comma
op_amp
id|bs
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|stat
(paren
id|o-&gt;bootmap
comma
op_amp
id|s_st
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s_st.st_size
OG
id|bs
)paren
(brace
id|ERROR_LEVEL
(paren
l_int|0
comma
l_string|&quot;%s is larger than one block&bslash;n&quot;
comma
id|o-&gt;bootmap
)paren
suffix:semicolon
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
id|errno
op_assign
id|EINVAL
suffix:semicolon
)brace
id|boots
op_assign
l_int|0
suffix:semicolon
id|NTRY
(paren
id|tmpdev
op_assign
id|tmpnam
c_func
(paren
l_int|NULL
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|mknod
(paren
id|tmpdev
comma
id|S_IFBLK
op_or
id|S_IRUSR
op_or
id|S_IWUSR
comma
id|s_st.st_dev
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|bd_fd
op_assign
id|open
(paren
id|tmpdev
comma
id|O_RDONLY
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|ioctl
c_func
(paren
id|s_fd
comma
id|FIBMAP
comma
op_amp
id|boots
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|ioctl
(paren
id|bd_fd
comma
id|BIODASDRWTB
comma
op_amp
id|boots
)paren
)paren
suffix:semicolon
id|PRINT_LEVEL
(paren
l_int|1
comma
l_string|&quot;Bootmap is in block no: 0x%08x&bslash;n&quot;
comma
id|boots
)paren
suffix:semicolon
id|close
(paren
id|bd_fd
)paren
suffix:semicolon
id|close
c_func
(paren
id|s_fd
)paren
suffix:semicolon
id|ITRY
(paren
id|unlink
c_func
(paren
id|tmpdev
)paren
)paren
suffix:semicolon
multiline_comment|/* Now patch the bootsector */
id|ITRY
(paren
id|b_fd
op_assign
id|open
(paren
id|o-&gt;bootsect
comma
id|O_RDONLY
)paren
)paren
suffix:semicolon
id|NTRY
(paren
id|read
(paren
id|b_fd
comma
id|buffer
comma
l_int|4096
)paren
)paren
suffix:semicolon
id|memset
(paren
id|buffer
op_plus
l_int|0xe0
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
op_star
(paren
r_int
op_star
)paren
(paren
id|buffer
op_plus
l_int|0xe0
)paren
op_assign
id|boots
suffix:semicolon
r_if
c_cond
(paren
id|o
op_member_access_from_pointer
id|testlevel
op_le
l_int|0
)paren
(brace
id|NTRY
(paren
id|write
(paren
id|d_fd
comma
id|buffer
comma
l_int|4096
)paren
)paren
suffix:semicolon
id|NTRY
(paren
id|write
(paren
id|d_fd
comma
id|buffer
comma
l_int|4096
)paren
)paren
suffix:semicolon
)brace
id|close
(paren
id|b_fd
)paren
suffix:semicolon
id|close
(paren
id|d_fd
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|do_silo
id|do_silo
(paren
r_struct
id|silo_options
op_star
id|o
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|device_fd
suffix:semicolon
r_int
id|image_fd
suffix:semicolon
r_struct
id|blocklist
id|blklist
suffix:semicolon
id|memset
(paren
op_amp
id|blklist
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|blocklist
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|add_file_to_blocklist
(paren
id|o-&gt;image
comma
op_amp
id|blklist
comma
l_int|0x00000000
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|o-&gt;parmfile
)paren
(brace
id|ITRY
(paren
id|add_file_to_blocklist
(paren
id|o-&gt;parmfile
comma
op_amp
id|blklist
comma
l_int|0x00008000
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|o-&gt;ramdisk
)paren
(brace
id|ITRY
(paren
id|add_file_to_blocklist
(paren
id|o-&gt;ramdisk
comma
op_amp
id|blklist
comma
l_int|0x00800000
)paren
)paren
suffix:semicolon
)brace
id|ITRY
(paren
id|write_bootsect
(paren
id|o
comma
op_amp
id|blklist
)paren
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|main
id|main
(paren
r_int
id|argct
comma
r_char
op_star
id|argv
(braket
)braket
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|save
suffix:semicolon
r_char
op_star
id|tmpdir
op_assign
id|getenv
c_func
(paren
l_string|&quot;TMPDIR&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmpdir
)paren
(brace
id|NTRY
c_func
(paren
id|save
op_assign
(paren
r_char
op_star
)paren
id|malloc
c_func
(paren
id|strlen
c_func
(paren
id|tmpdir
)paren
)paren
)paren
suffix:semicolon
id|NTRY
c_func
(paren
id|strncpy
c_func
(paren
id|save
comma
id|tmpdir
comma
id|strlen
c_func
(paren
id|tmpdir
)paren
)paren
)paren
suffix:semicolon
)brace
id|ITRY
c_func
(paren
id|setenv
c_func
(paren
l_string|&quot;TMPDIR&quot;
comma
l_string|&quot;.&quot;
comma
l_int|1
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|parse_options
(paren
op_amp
id|silo_options
comma
id|argct
comma
id|argv
)paren
)paren
suffix:semicolon
id|ITRY
(paren
id|verify_options
(paren
op_amp
id|silo_options
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|silo_options.testlevel
OG
l_int|0
)paren
(brace
id|printf
(paren
l_string|&quot;WARNING: silo does not modify your volume. Use -t2 to change IPL records&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|ITRY
(paren
id|do_silo
(paren
op_amp
id|silo_options
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|save
)paren
id|ITRY
c_func
(paren
id|setenv
c_func
(paren
l_string|&quot;TMPDIR&quot;
comma
id|save
comma
l_int|1
)paren
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
eof
