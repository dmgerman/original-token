multiline_comment|/*&n; *  arch/m68k/mvme16x/config.c&n; *&n; *  Copyright (C) 1995 Richard Hirst [richard@sleepie.demon.co.uk]&n; *&n; * Based on:&n; *&n; *  linux/amiga/config.c&n; *&n; *  Copyright (C) 1993 Hamish Macdonald&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file README.legal in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;stdarg.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/linkage.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/traps.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/mvme16xhw.h&gt;
r_typedef
r_struct
(brace
r_int
r_char
DECL|member|ctrl
id|ctrl
comma
DECL|member|bcd_sec
id|bcd_sec
comma
DECL|member|bcd_min
id|bcd_min
comma
DECL|member|bcd_hr
id|bcd_hr
comma
DECL|member|bcd_dow
id|bcd_dow
comma
DECL|member|bcd_dom
id|bcd_dom
comma
DECL|member|bcd_mth
id|bcd_mth
comma
DECL|member|bcd_year
id|bcd_year
suffix:semicolon
DECL|typedef|MK48T08
)brace
id|MK48T08
suffix:semicolon
DECL|macro|RTC_WRITE
mdefine_line|#define RTC_WRITE&t;0x80
DECL|macro|RTC_READ
mdefine_line|#define RTC_READ&t;0x40
DECL|macro|RTC_STOP
mdefine_line|#define RTC_STOP&t;0x20
DECL|variable|atari_SCC_reset_done
r_int
id|atari_SCC_reset_done
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* So SCC doesn&squot;t get reset */
DECL|variable|atari_mch_cookie
id|u_long
id|atari_mch_cookie
op_assign
l_int|0
suffix:semicolon
DECL|variable|rtc
id|MK48T08
op_star
r_volatile
id|rtc
op_assign
(paren
id|MK48T08
op_star
)paren
l_int|0xfffc1ff8
suffix:semicolon
r_extern
r_void
id|mvme16x_process_int
(paren
r_int
id|level
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_extern
r_void
id|mvme16x_init_IRQ
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|mvme16x_free_irq
(paren
r_int
r_int
comma
r_void
op_star
)paren
suffix:semicolon
r_extern
r_int
id|mvme16x_get_irq_list
(paren
r_char
op_star
)paren
suffix:semicolon
r_extern
r_void
id|mvme16x_enable_irq
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|mvme16x_disable_irq
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
r_void
id|mvme16x_get_model
c_func
(paren
r_char
op_star
id|model
)paren
suffix:semicolon
r_static
r_int
id|mvme16x_get_hardware_list
c_func
(paren
r_char
op_star
id|buffer
)paren
suffix:semicolon
r_extern
r_int
id|mvme16x_request_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|flags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
suffix:semicolon
r_extern
r_void
id|mvme16x_sched_init
c_func
(paren
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
)paren
suffix:semicolon
r_extern
r_int
id|mvme16x_keyb_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|mvme16x_kbdrate
(paren
r_struct
id|kbd_repeat
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|mvme16x_gettimeoffset
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|mvme16x_gettod
(paren
r_int
op_star
id|year
comma
r_int
op_star
id|mon
comma
r_int
op_star
id|day
comma
r_int
op_star
id|hour
comma
r_int
op_star
id|min
comma
r_int
op_star
id|sec
)paren
suffix:semicolon
r_extern
r_int
id|mvme16x_hwclk
(paren
r_int
comma
r_struct
id|hwclk_time
op_star
)paren
suffix:semicolon
r_extern
r_int
id|mvme16x_set_clock_mmss
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|mvme16x_check_partition
(paren
r_struct
id|gendisk
op_star
id|hd
comma
r_int
r_int
id|dev
)paren
suffix:semicolon
r_extern
r_void
id|mvme16x_mksound
c_func
(paren
r_int
r_int
id|count
comma
r_int
r_int
id|ticks
)paren
suffix:semicolon
r_extern
r_void
id|mvme16x_reset
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|mvme16x_waitbut
c_func
(paren
r_void
)paren
suffix:semicolon
r_int
id|bcd2int
(paren
r_int
r_char
id|b
)paren
suffix:semicolon
multiline_comment|/* Save tick handler routine pointer, will point to do_timer() in&n; * kernel/sched.c, called via mvme16x_process_int() */
DECL|variable|tick_handler
r_static
r_void
(paren
op_star
id|tick_handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
DECL|variable|mvme16x_config
r_int
r_int
id|mvme16x_config
suffix:semicolon
DECL|function|mvme16x_kbdrate
r_int
id|mvme16x_kbdrate
(paren
r_struct
id|kbd_repeat
op_star
id|k
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mvme16x_mksound
r_void
id|mvme16x_mksound
c_func
(paren
r_int
r_int
id|count
comma
r_int
r_int
id|ticks
)paren
(brace
)brace
DECL|function|mvme16x_reset
r_void
id|mvme16x_reset
c_func
(paren
)paren
(brace
id|printk
(paren
l_string|&quot;&bslash;r&bslash;n&bslash;nCalled mvme16x_reset&bslash;r&bslash;n&quot;
l_string|&quot;&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&bslash;r&quot;
)paren
suffix:semicolon
multiline_comment|/* The string of returns is to delay the reset until the whole&n;&t; * message is output.  Assert reset bit in GCSR */
op_star
(paren
r_volatile
r_char
op_star
)paren
l_int|0xfff40107
op_assign
l_int|0x80
suffix:semicolon
)brace
DECL|function|mvme16x_get_model
r_static
r_void
id|mvme16x_get_model
c_func
(paren
r_char
op_star
id|model
)paren
(brace
id|p_bdid
id|p
op_assign
(paren
id|p_bdid
)paren
id|mvme_bdid_ptr
suffix:semicolon
r_char
id|suf
(braket
l_int|4
)braket
suffix:semicolon
id|suf
(braket
l_int|1
)braket
op_assign
id|p-&gt;brdsuffix
(braket
l_int|0
)braket
suffix:semicolon
id|suf
(braket
l_int|2
)braket
op_assign
id|p-&gt;brdsuffix
(braket
l_int|1
)braket
suffix:semicolon
id|suf
(braket
l_int|3
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|suf
(braket
l_int|0
)braket
op_assign
id|suf
(braket
l_int|1
)braket
ques
c_cond
l_char|&squot;-&squot;
suffix:colon
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|sprintf
c_func
(paren
id|model
comma
l_string|&quot;Motorola MVME%x%s&quot;
comma
id|p-&gt;brdno
comma
id|suf
)paren
suffix:semicolon
)brace
DECL|function|mvme16x_get_hardware_list
r_static
r_int
id|mvme16x_get_hardware_list
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
id|p_bdid
id|p
op_assign
(paren
id|p_bdid
)paren
id|mvme_bdid_ptr
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;brdno
op_eq
l_int|0x0162
op_logical_or
id|p-&gt;brdno
op_eq
l_int|0x0172
)paren
(brace
r_int
r_char
id|rev
op_assign
op_star
(paren
r_int
r_char
op_star
)paren
id|MVME162_VERSION_REG
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;VMEchip2        %spresent&bslash;n&quot;
comma
id|rev
op_amp
id|MVME16x_CONFIG_NO_VMECHIP2
ques
c_cond
l_string|&quot;NOT &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;SCSI interface  %spresent&bslash;n&quot;
comma
id|rev
op_amp
id|MVME16x_CONFIG_NO_SCSICHIP
ques
c_cond
l_string|&quot;NOT &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Ethernet i/f    %spresent&bslash;n&quot;
comma
id|rev
op_amp
id|MVME16x_CONFIG_NO_ETHERNET
ques
c_cond
l_string|&quot;NOT &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_else
op_star
id|buffer
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
(paren
id|len
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|config_mvme16x
c_func
(paren
r_void
)paren
)paren
(brace
id|p_bdid
id|p
op_assign
(paren
id|p_bdid
)paren
id|mvme_bdid_ptr
suffix:semicolon
r_char
id|id
(braket
l_int|40
)braket
suffix:semicolon
id|mach_sched_init
op_assign
id|mvme16x_sched_init
suffix:semicolon
id|mach_keyb_init
op_assign
id|mvme16x_keyb_init
suffix:semicolon
id|mach_kbdrate
op_assign
id|mvme16x_kbdrate
suffix:semicolon
id|mach_init_IRQ
op_assign
id|mvme16x_init_IRQ
suffix:semicolon
id|mach_gettimeoffset
op_assign
id|mvme16x_gettimeoffset
suffix:semicolon
id|mach_gettod
op_assign
id|mvme16x_gettod
suffix:semicolon
id|mach_hwclk
op_assign
id|mvme16x_hwclk
suffix:semicolon
id|mach_set_clock_mmss
op_assign
id|mvme16x_set_clock_mmss
suffix:semicolon
multiline_comment|/*  kd_mksound           = mvme16x_mksound; */
id|mach_reset
op_assign
id|mvme16x_reset
suffix:semicolon
id|mach_free_irq
op_assign
id|mvme16x_free_irq
suffix:semicolon
id|mach_process_int
op_assign
id|mvme16x_process_int
suffix:semicolon
id|mach_get_irq_list
op_assign
id|mvme16x_get_irq_list
suffix:semicolon
id|mach_request_irq
op_assign
id|mvme16x_request_irq
suffix:semicolon
id|enable_irq
op_assign
id|mvme16x_enable_irq
suffix:semicolon
id|disable_irq
op_assign
id|mvme16x_disable_irq
suffix:semicolon
id|mach_get_model
op_assign
id|mvme16x_get_model
suffix:semicolon
id|mach_get_hardware_list
op_assign
id|mvme16x_get_hardware_list
suffix:semicolon
multiline_comment|/* Report board revision */
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;BDID&quot;
comma
id|p-&gt;bdid
comma
l_int|4
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;&bslash;n&bslash;nBug call .BRD_ID returned garbage - giving up&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|mvme16x_get_model
c_func
(paren
id|id
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;&bslash;nBRD_ID: %s   BUG %x.%x %02x/%02x/%02x&bslash;n&quot;
comma
id|id
comma
id|p-&gt;rev
op_rshift
l_int|4
comma
id|p-&gt;rev
op_amp
l_int|0xf
comma
id|p-&gt;yr
comma
id|p-&gt;mth
comma
id|p-&gt;day
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;brdno
op_eq
l_int|0x0162
op_logical_or
id|p-&gt;brdno
op_eq
l_int|0x172
)paren
(brace
r_int
r_char
id|rev
op_assign
op_star
(paren
r_int
r_char
op_star
)paren
id|MVME162_VERSION_REG
suffix:semicolon
id|mvme16x_config
op_assign
id|rev
op_or
id|MVME16x_CONFIG_GOT_SCCA
suffix:semicolon
id|printk
(paren
l_string|&quot;MVME%x Hardware status:&bslash;n&quot;
comma
id|p-&gt;brdno
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;    CPU Type           68%s040&bslash;n&quot;
comma
id|rev
op_amp
id|MVME16x_CONFIG_GOT_FPU
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;LC&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;    CPU clock          %dMHz&bslash;n&quot;
comma
id|rev
op_amp
id|MVME16x_CONFIG_SPEED_32
ques
c_cond
l_int|32
suffix:colon
l_int|25
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;    VMEchip2           %spresent&bslash;n&quot;
comma
id|rev
op_amp
id|MVME16x_CONFIG_NO_VMECHIP2
ques
c_cond
l_string|&quot;NOT &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;    SCSI interface     %spresent&bslash;n&quot;
comma
id|rev
op_amp
id|MVME16x_CONFIG_NO_SCSICHIP
ques
c_cond
l_string|&quot;NOT &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;    Ethernet interface %spresent&bslash;n&quot;
comma
id|rev
op_amp
id|MVME16x_CONFIG_NO_ETHERNET
ques
c_cond
l_string|&quot;NOT &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_else
id|mvme16x_config
op_assign
id|MVME16x_CONFIG_GOT_LP
op_or
id|MVME16x_CONFIG_GOT_CD2401
suffix:semicolon
)brace
DECL|function|mvme16x_timer_int
r_static
r_void
id|mvme16x_timer_int
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
l_int|0xfff4201b
op_or_assign
l_int|8
suffix:semicolon
id|tick_handler
c_func
(paren
id|irq
comma
id|dev_id
comma
id|fp
)paren
suffix:semicolon
)brace
DECL|function|mvme16x_sched_init
r_void
id|mvme16x_sched_init
(paren
r_void
(paren
op_star
id|timer_routine
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
)paren
(brace
id|tick_handler
op_assign
id|timer_routine
suffix:semicolon
multiline_comment|/* Using PCCchip2 or MC2 chip tick timer 1 */
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xfff42008
op_assign
l_int|0
suffix:semicolon
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xfff42004
op_assign
l_int|10000
suffix:semicolon
multiline_comment|/* 10ms */
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
l_int|0xfff42017
op_or_assign
l_int|3
suffix:semicolon
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
l_int|0xfff4201b
op_assign
l_int|0x16
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|IRQ_MVME16x_TIMER
comma
id|mvme16x_timer_int
comma
l_int|0
comma
l_string|&quot;timer&quot;
comma
id|mvme16x_timer_int
)paren
)paren
id|panic
(paren
l_string|&quot;Couldn&squot;t register timer int&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* This is always executed with interrupts disabled.  */
DECL|function|mvme16x_gettimeoffset
r_int
r_int
id|mvme16x_gettimeoffset
(paren
r_void
)paren
(brace
r_return
(paren
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xfff42008
)paren
suffix:semicolon
)brace
DECL|function|mvme16x_gettod
r_extern
r_void
id|mvme16x_gettod
(paren
r_int
op_star
id|year
comma
r_int
op_star
id|mon
comma
r_int
op_star
id|day
comma
r_int
op_star
id|hour
comma
r_int
op_star
id|min
comma
r_int
op_star
id|sec
)paren
(brace
id|rtc-&gt;ctrl
op_assign
id|RTC_READ
suffix:semicolon
op_star
id|year
op_assign
id|bcd2int
(paren
id|rtc-&gt;bcd_year
)paren
suffix:semicolon
op_star
id|mon
op_assign
id|bcd2int
(paren
id|rtc-&gt;bcd_mth
)paren
suffix:semicolon
op_star
id|day
op_assign
id|bcd2int
(paren
id|rtc-&gt;bcd_dom
)paren
suffix:semicolon
op_star
id|hour
op_assign
id|bcd2int
(paren
id|rtc-&gt;bcd_hr
)paren
suffix:semicolon
op_star
id|min
op_assign
id|bcd2int
(paren
id|rtc-&gt;bcd_min
)paren
suffix:semicolon
op_star
id|sec
op_assign
id|bcd2int
(paren
id|rtc-&gt;bcd_sec
)paren
suffix:semicolon
id|rtc-&gt;ctrl
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|bcd2int
r_int
id|bcd2int
(paren
r_int
r_char
id|b
)paren
(brace
r_return
(paren
(paren
id|b
op_rshift
l_int|4
)paren
op_star
l_int|10
op_plus
(paren
id|b
op_amp
l_int|15
)paren
)paren
suffix:semicolon
)brace
DECL|function|mvme16x_hwclk
r_int
id|mvme16x_hwclk
c_func
(paren
r_int
id|op
comma
r_struct
id|hwclk_time
op_star
id|t
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mvme16x_set_clock_mmss
r_int
id|mvme16x_set_clock_mmss
(paren
r_int
r_int
id|nowtime
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * console_map_init(), here to avoid having to modify drivers/block/genhd.c&n; */
DECL|function|console_map_init
r_void
id|console_map_init
c_func
(paren
r_void
)paren
(brace
)brace
multiline_comment|/*&n; * fbmem_init(), here to avoid having to modify drivers/char/mem.c&n; */
DECL|function|fbmem_init
r_void
id|fbmem_init
c_func
(paren
r_void
)paren
(brace
)brace
multiline_comment|/* Avoid mods to drivers/char/tty_io.c */
DECL|function|con_init
r_int
r_int
id|con_init
c_func
(paren
r_int
r_int
id|kmem_start
)paren
(brace
r_return
(paren
id|kmem_start
)paren
suffix:semicolon
)brace
multiline_comment|/* Avoid mods to drivers/char/tty_io.c */
DECL|function|vcs_init
r_int
id|vcs_init
c_func
(paren
r_void
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Avoid mods to drivers/char/tty_io.c */
DECL|function|kbd_init
r_int
id|kbd_init
c_func
(paren
r_void
)paren
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Avoid mods to init/main.c */
DECL|function|no_scroll
r_void
id|no_scroll
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|ints
)paren
(brace
)brace
multiline_comment|/* Avoid mods to kernel/panic.c */
DECL|function|do_unblank_screen
r_void
id|do_unblank_screen
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|mvme16x_keyb_init
r_int
id|mvme16x_keyb_init
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mvme16x_set_vectors
r_void
id|mvme16x_set_vectors
(paren
r_void
)paren
(brace
id|p_bdid
id|p
op_assign
(paren
id|p_bdid
)paren
id|mvme_bdid_ptr
suffix:semicolon
r_int
r_int
op_star
r_new
op_assign
(paren
r_int
r_int
op_star
)paren
id|vectors
suffix:semicolon
r_int
r_int
op_star
id|old
op_assign
(paren
r_int
r_int
op_star
)paren
l_int|0xffe00000
suffix:semicolon
suffix:semicolon
op_star
(paren
r_new
op_plus
l_int|4
)paren
op_assign
op_star
(paren
id|old
op_plus
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Illegal instruction */
op_star
(paren
r_new
op_plus
l_int|9
)paren
op_assign
op_star
(paren
id|old
op_plus
l_int|9
)paren
suffix:semicolon
multiline_comment|/* Trace */
op_star
(paren
r_new
op_plus
l_int|47
)paren
op_assign
op_star
(paren
id|old
op_plus
l_int|47
)paren
suffix:semicolon
multiline_comment|/* Trap #15 */
r_if
c_cond
(paren
id|p-&gt;brdno
op_eq
l_int|0x0162
op_logical_or
id|p-&gt;brdno
op_eq
l_int|0x172
)paren
op_star
(paren
r_new
op_plus
l_int|0x5e
)paren
op_assign
op_star
(paren
id|old
op_plus
l_int|0x5e
)paren
suffix:semicolon
multiline_comment|/* ABORT switch */
r_else
op_star
(paren
r_new
op_plus
l_int|0x6e
)paren
op_assign
op_star
(paren
id|old
op_plus
l_int|0x6e
)paren
suffix:semicolon
multiline_comment|/* ABORT switch */
)brace
multiline_comment|/*-------------------  Serial console stuff ------------------------*/
r_extern
r_void
id|mvme167_serial_console_setup
c_func
(paren
r_int
id|cflag
)paren
suffix:semicolon
r_extern
r_void
id|serial167_write
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|str
comma
r_int
id|cnt
)paren
suffix:semicolon
r_extern
r_void
id|vme_scc_write
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|str
comma
r_int
id|cnt
)paren
suffix:semicolon
DECL|function|mvme16x_init_console_port
r_void
id|mvme16x_init_console_port
(paren
r_struct
id|console
op_star
id|co
comma
r_int
id|cflag
)paren
(brace
id|p_bdid
id|p
op_assign
(paren
id|p_bdid
)paren
id|mvme_bdid_ptr
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;brdno
)paren
(brace
macro_line|#ifdef CONFIG_MVME162_SCC
r_case
l_int|0x0162
suffix:colon
r_case
l_int|0x0172
suffix:colon
id|co-&gt;write
op_assign
id|vme_scc_write
suffix:semicolon
r_return
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SERIAL167
r_case
l_int|0x0166
suffix:colon
r_case
l_int|0x0167
suffix:colon
r_case
l_int|0x0176
suffix:colon
r_case
l_int|0x0177
suffix:colon
id|co-&gt;write
op_assign
id|serial167_write
suffix:semicolon
id|mvme167_serial_console_setup
(paren
id|cflag
)paren
suffix:semicolon
r_return
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|panic
(paren
l_string|&quot;No console support for MVME%x&bslash;n&quot;
comma
id|p-&gt;brdno
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_MVME162_SCC
DECL|function|scc_delay
r_static
r_void
id|scc_delay
(paren
r_void
)paren
(brace
r_int
id|n
suffix:semicolon
r_char
id|i
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
l_int|20
suffix:semicolon
id|n
op_increment
)paren
id|i
op_assign
op_star
(paren
r_volatile
r_char
op_star
)paren
l_int|0
suffix:semicolon
)brace
DECL|function|scc_write
r_static
r_void
id|scc_write
(paren
r_char
id|ch
)paren
(brace
r_volatile
r_char
op_star
id|p
op_assign
(paren
r_volatile
r_char
op_star
)paren
id|SCC_A_ADDR
suffix:semicolon
r_do
(brace
id|scc_delay
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
op_star
id|p
op_amp
l_int|4
)paren
)paren
suffix:semicolon
id|scc_delay
c_func
(paren
)paren
suffix:semicolon
op_star
id|p
op_assign
l_int|8
suffix:semicolon
id|scc_delay
c_func
(paren
)paren
suffix:semicolon
op_star
id|p
op_assign
id|ch
suffix:semicolon
)brace
DECL|function|vme_scc_write
r_void
id|vme_scc_write
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|str
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_star
id|str
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|scc_write
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
id|scc_write
(paren
op_star
id|str
op_increment
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
