multiline_comment|/*&n; * linux/arch/m68k/console/fbcon.c -- Low level frame buffer based console&n; *                                    driver&n; *&n; *    Copyright (C) 1995 Geert Uytterhoeven&n; *&n; *&n; * This file is based on the original Amiga console driver (amicon.c):&n; *&n; *    Copyright (C) 1993 Hamish Macdonald&n; *                       Greg Harp&n; *    Copyright (C) 1994 David Carter [carter@compsci.bristol.ac.uk]&n; *&n; *          with work by William Rucklidge (wjr@cs.cornell.edu)&n; *                       Geert Uytterhoeven&n; *                       Jes Sorensen (jds@kom.auc.dk)&n; *                       Martin Apel&n; *&n; * and on the original Atari console driver (atacon.c):&n; *&n; *    Copyright (C) 1993 Bjoern Brauel&n; *                       Roman Hodek&n; *&n; *          with work by Guenther Kelleter&n; *                       Martin Schaller&n; *                       Andreas Schwab&n; *&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
multiline_comment|/*&n; * To do:&n; *  - Implement 16 plane mode.&n; *  - Add support for 16/24/32 bit packed pixels&n; *  - Hardware cursor&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#ifdef CONFIG_AMIGA
macro_line|#include &lt;asm/amigahw.h&gt;
macro_line|#include &lt;asm/amigaints.h&gt;
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_ATARI
macro_line|#include &lt;asm/atariints.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_FB_CYBER
macro_line|#include &quot;../amiga/s3blit.h&quot;
macro_line|#endif /* CONFIG_FB_CYBER */
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;asm/font.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;../../../drivers/char/vt_kern.h&quot;   /* vt_cons and vc_resize_con() */
multiline_comment|/* Import console_blanked from console.c */
r_extern
r_int
id|console_blanked
suffix:semicolon
multiline_comment|/*&n;    *    The following symbols select what modes are supported. They should&n;    *    be settable by the user (&quot;make config&quot;) later.&n;    */
multiline_comment|/* Clear all definitions */
DECL|macro|CONFIG_FBCON_MONO
macro_line|#undef CONFIG_FBCON_MONO
DECL|macro|CONFIG_FBCON_ILBM
macro_line|#undef CONFIG_FBCON_ILBM
DECL|macro|CONFIG_FBCON_PLANES
macro_line|#undef CONFIG_FBCON_PLANES
DECL|macro|CONFIG_FBCON_2PLANE
macro_line|#undef CONFIG_FBCON_2PLANE
DECL|macro|CONFIG_FBCON_4PLANE
macro_line|#undef CONFIG_FBCON_4PLANE
DECL|macro|CONFIG_FBCON_8PLANE
macro_line|#undef CONFIG_FBCON_8PLANE
DECL|macro|CONFIG_FBCON_8PACKED
macro_line|#undef CONFIG_FBCON_8PACKED
DECL|macro|CONFIG_FBCON_16PACKED
macro_line|#undef CONFIG_FBCON_16PACKED
DECL|macro|CONFIG_FBCON_24PACKED
macro_line|#undef CONFIG_FBCON_24PACKED
DECL|macro|CONFIG_FBCON_32PACKED
macro_line|#undef CONFIG_FBCON_32PACKED
DECL|macro|CONFIG_FBCON_CYBER
macro_line|#undef CONFIG_FBCON_CYBER
multiline_comment|/* Monochrome is default */
DECL|macro|CONFIG_FBCON_MONO
mdefine_line|#define CONFIG_FBCON_MONO
multiline_comment|/* Amiga support */
macro_line|#ifdef CONFIG_AMIGA
macro_line|#ifndef CONFIG_FBCON_ILBM
DECL|macro|CONFIG_FBCON_ILBM
mdefine_line|#define CONFIG_FBCON_ILBM
macro_line|#endif
macro_line|#ifndef CONFIG_FBCON_PLANES
DECL|macro|CONFIG_FBCON_PLANES
mdefine_line|#define CONFIG_FBCON_PLANES
macro_line|#endif
multiline_comment|/* Cybervision Graphics Board */
macro_line|#ifdef CONFIG_FB_CYBER
macro_line|#ifndef CONFIG_FBCON_CYBER
DECL|macro|CONFIG_FBCON_CYBER
mdefine_line|#define CONFIG_FBCON_CYBER
macro_line|#endif
macro_line|#endif /* CONFIG_FB_CYBER */
macro_line|#endif /* CONFIG_AMIGA */
multiline_comment|/* Atari support */
macro_line|#ifdef CONFIG_ATARI
macro_line|#ifndef CONFIG_FBCON_2PLANE
DECL|macro|CONFIG_FBCON_2PLANE
mdefine_line|#define CONFIG_FBCON_2PLANE
macro_line|#endif
macro_line|#ifndef CONFIG_FBCON_4PLANE
DECL|macro|CONFIG_FBCON_4PLANE
mdefine_line|#define CONFIG_FBCON_4PLANE
macro_line|#endif
macro_line|#ifndef CONFIG_FBCON_8PLANE
DECL|macro|CONFIG_FBCON_8PLANE
mdefine_line|#define CONFIG_FBCON_8PLANE
macro_line|#endif
macro_line|#ifndef CONFIG_FBCON_8PACKED
DECL|macro|CONFIG_FBCON_8PACKED
mdefine_line|#define CONFIG_FBCON_8PACKED
macro_line|#endif
macro_line|#ifndef CONFIG_FBCON_16PACKED
DECL|macro|CONFIG_FBCON_16PACKED
mdefine_line|#define CONFIG_FBCON_16PACKED
macro_line|#endif
macro_line|#endif /* CONFIG_ATARI */
multiline_comment|/* Extra definitions to make the code more readable */
macro_line|#if defined(CONFIG_FBCON_2PLANE) || defined(CONFIG_FBCON_4PLANE) || &bslash;&n;    defined(CONFIG_FBCON_8PLANE)
DECL|macro|CONFIG_FBCON_IPLAN2
mdefine_line|#define CONFIG_FBCON_IPLAN2
macro_line|#else
DECL|macro|CONFIG_FBCON_IPLAN2
macro_line|#undef CONFIG_FBCON_IPLAN2
macro_line|#endif
macro_line|#if defined(CONFIG_FBCON_CYBER) || defined(CONFIG_FBCON_8PACKED) || &bslash;&n;    defined(CONFIG_FBCON_16PACKED) || defined(CONFIG_FBCON_24PACKED) || &bslash;&n;    defined(CONFIG_FBCON_32PACKED)
DECL|macro|CONFIG_FBCON_PACKED
mdefine_line|#define CONFIG_FBCON_PACKED
macro_line|#else
DECL|macro|CONFIG_FBCON_PACKED
macro_line|#undef CONFIG_FBCON_PACKED
macro_line|#endif
DECL|variable|fb_info
r_struct
id|fb_info
op_star
id|fb_info
suffix:semicolon
DECL|variable|disp
r_struct
id|display
op_star
id|disp
suffix:semicolon
multiline_comment|/* ++Geert: Sorry, no hardware cursor support at the moment;&n;   use Atari alike software cursor */
DECL|variable|cursor_drawn
r_static
r_int
id|cursor_drawn
op_assign
l_int|0
suffix:semicolon
DECL|macro|CURSOR_DRAW_DELAY
mdefine_line|#define CURSOR_DRAW_DELAY           (2)
multiline_comment|/* # VBL ints between cursor state changes */
DECL|macro|AMIGA_CURSOR_BLINK_RATE
mdefine_line|#define AMIGA_CURSOR_BLINK_RATE   (20)
DECL|macro|ATARI_CURSOR_BLINK_RATE
mdefine_line|#define ATARI_CURSOR_BLINK_RATE   (42)
DECL|variable|vbl_cursor_cnt
r_static
r_int
id|vbl_cursor_cnt
op_assign
l_int|0
suffix:semicolon
DECL|variable|cursor_on
r_static
r_int
id|cursor_on
op_assign
l_int|0
suffix:semicolon
DECL|variable|cursor_blink_rate
r_static
r_int
id|cursor_blink_rate
suffix:semicolon
DECL|function|CURSOR_UNDRAWN
r_static
id|__inline__
r_int
id|CURSOR_UNDRAWN
c_func
(paren
r_void
)paren
(brace
r_int
id|cursor_was_drawn
suffix:semicolon
id|vbl_cursor_cnt
op_assign
l_int|0
suffix:semicolon
id|cursor_was_drawn
op_assign
id|cursor_drawn
suffix:semicolon
id|cursor_drawn
op_assign
l_int|0
suffix:semicolon
r_return
id|cursor_was_drawn
suffix:semicolon
)brace
multiline_comment|/*&n;    *    Attribute Decoding&n;    */
multiline_comment|/* Color */
DECL|macro|attr_fgcol
mdefine_line|#define attr_fgcol(p,conp)    &bslash;&n;&t;(((conp)-&gt;vc_attr &gt;&gt; ((p)-&gt;inverse ? 4 : 0)) &amp; 0x0f)
DECL|macro|attr_bgcol
mdefine_line|#define attr_bgcol(p,conp)    &bslash;&n;&t;(((conp)-&gt;vc_attr &gt;&gt; ((p)-&gt;inverse ? 0 : 4)) &amp; 0x0f)
DECL|macro|attr_bgcol_ec
mdefine_line|#define&t;attr_bgcol_ec(p,conp) &bslash;&n;&t;(((conp)-&gt;vc_video_erase_char &gt;&gt; ((p)-&gt;inverse ? 8 : 12)) &amp; 0x0f)
multiline_comment|/* Monochrome */
DECL|macro|attr_bold
mdefine_line|#define attr_bold(p,conp)     &bslash;&n;&t;(((conp)-&gt;vc_attr &amp; 3) == 2)
DECL|macro|attr_reverse
mdefine_line|#define attr_reverse(p,conp)  &bslash;&n;&t;(((conp)-&gt;vc_attr &amp; 8) ^ ((p)-&gt;inverse ? 8 : 0))
DECL|macro|attr_underline
mdefine_line|#define attr_underline(p,conp) &bslash;&n;&t;(((conp)-&gt;vc_attr) &amp; 4)
multiline_comment|/*&n;    *    Scroll Method&n;    */
DECL|macro|SCROLL_YWRAP
mdefine_line|#define SCROLL_YWRAP          (0)
DECL|macro|SCROLL_YPAN
mdefine_line|#define SCROLL_YPAN           (1)
DECL|macro|SCROLL_YMOVE
mdefine_line|#define SCROLL_YMOVE          (2)
DECL|macro|divides
mdefine_line|#define divides(a, b)         ((!(a) || (b)%(a)) ? 0 : 1)
multiline_comment|/*&n;    *    Interface used by the world&n;    */
r_static
id|u_long
id|fbcon_startup
c_func
(paren
id|u_long
id|kmem_start
comma
r_char
op_star
op_star
id|display_desc
)paren
suffix:semicolon
r_static
r_void
id|fbcon_init
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
suffix:semicolon
r_static
r_int
id|fbcon_deinit
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
suffix:semicolon
r_static
r_int
id|fbcon_changevar
c_func
(paren
r_int
id|con
)paren
suffix:semicolon
r_static
r_int
id|fbcon_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_int
id|fbcon_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_int
id|fbcon_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_int
id|fbcon_cursor
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|mode
)paren
suffix:semicolon
r_static
r_int
id|fbcon_scroll
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|t
comma
r_int
id|b
comma
r_int
id|dir
comma
r_int
id|count
)paren
suffix:semicolon
r_static
r_int
id|fbcon_bmove
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_int
id|fbcon_switch
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
suffix:semicolon
r_static
r_int
id|fbcon_blank
c_func
(paren
r_int
id|blank
)paren
suffix:semicolon
multiline_comment|/*&n;    *    Internal routines&n;    */
r_static
r_void
id|fbcon_setup
c_func
(paren
r_int
id|con
comma
r_int
id|setcol
comma
r_int
id|init
)paren
suffix:semicolon
r_static
id|__inline__
r_void
op_star
id|mymemclear_small
c_func
(paren
r_void
op_star
id|s
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|__inline__
r_void
op_star
id|mymemclear
c_func
(paren
r_void
op_star
id|s
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|__inline__
r_void
op_star
id|mymemset
c_func
(paren
r_void
op_star
id|s
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|__inline__
r_void
op_star
id|mymemmove
c_func
(paren
r_void
op_star
id|d
comma
r_void
op_star
id|s
comma
r_int
id|count
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|fast_memmove
c_func
(paren
r_char
op_star
id|dst
comma
r_char
op_star
id|src
comma
r_int
id|size
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|memclear_4p_col
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|h
comma
id|u_long
id|val
comma
r_int
id|bpr
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|memset_even_4p
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|count
comma
id|u_long
id|val1
comma
id|u_long
id|val2
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|memmove_4p_col
c_func
(paren
r_void
op_star
id|d
comma
r_void
op_star
id|s
comma
r_int
id|h
comma
r_int
id|bpr
)paren
suffix:semicolon
r_static
id|__inline__
id|u_long
id|expand4l
c_func
(paren
id|u_char
id|c
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|expand4dl
c_func
(paren
id|u_char
id|c
comma
id|u_long
op_star
id|ret1
comma
id|u_long
op_star
id|ret2
)paren
suffix:semicolon
r_static
id|__inline__
id|u_long
id|dup4l
c_func
(paren
id|u_char
id|c
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|memclear_8p_col
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|h
comma
id|u_long
id|val1
comma
id|u_long
id|val2
comma
r_int
id|bpr
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|memset_even_8p
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|count
comma
id|u_long
id|val1
comma
id|u_long
id|val2
comma
id|u_long
id|val3
comma
id|u_long
id|val4
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|memmove_8p_col
c_func
(paren
r_void
op_star
id|d
comma
r_void
op_star
id|s
comma
r_int
id|h
comma
r_int
id|bpr
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|expand8dl
c_func
(paren
id|u_char
id|c
comma
id|u_long
op_star
id|ret1
comma
id|u_long
op_star
id|ret2
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|memclear_2p_col
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|h
comma
id|u_short
id|val
comma
r_int
id|bpr
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|memset_even_2p
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|count
comma
id|u_long
id|val
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|memmove_2p_col
c_func
(paren
r_void
op_star
id|d
comma
r_void
op_star
id|s
comma
r_int
id|h
comma
r_int
id|bpr
)paren
suffix:semicolon
r_static
id|__inline__
id|u_short
id|expand2w
c_func
(paren
id|u_char
id|c
)paren
suffix:semicolon
r_static
id|__inline__
id|u_long
id|expand2l
c_func
(paren
id|u_char
id|c
)paren
suffix:semicolon
r_static
id|__inline__
id|u_short
id|dup2w
c_func
(paren
id|u_char
id|c
)paren
suffix:semicolon
r_static
id|__inline__
r_int
id|real_y
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|y
)paren
suffix:semicolon
r_static
r_void
id|fbcon_vbl_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
suffix:semicolon
r_static
r_void
id|fbcon_bmove_rec
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
comma
id|u_int
id|y_break
)paren
suffix:semicolon
multiline_comment|/*&n;    *    Monochrome&n;    */
macro_line|#ifdef CONFIG_FBCON_MONO
r_static
r_void
id|bmove_mono
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|clear_mono
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|putc_mono
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|putcs_mono
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|rev_char_mono
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_MONO */
multiline_comment|/*&n;    *    Color Interleaved Planes&n;    */
macro_line|#ifdef CONFIG_FBCON_ILBM
r_static
r_void
id|bmove_ilbm
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|clear_ilbm
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|putc_ilbm
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|putcs_ilbm
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|rev_char_ilbm
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_ILBM */
multiline_comment|/*&n;    *    Color Planes&n;    */
macro_line|#ifdef CONFIG_FBCON_PLANES
r_static
r_void
id|bmove_plan
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|clear_plan
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|putc_plan
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|putcs_plan
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|rev_char_plan
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_PLANES */
multiline_comment|/*&n;    *    2 Planes (2-bytes interleave)&n;    */
macro_line|#ifdef CONFIG_FBCON_2PLANE
r_static
r_void
id|bmove_2_plane
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|clear_2_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|putc_2_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|putcs_2_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|rev_char_2_plane
c_func
(paren
r_struct
id|display
op_star
id|display
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_2PLANE */
multiline_comment|/*&n;    *    4 Planes (2-bytes interleave)&n;    */
macro_line|#ifdef CONFIG_FBCON_4PLANE
r_static
r_void
id|bmove_4_plane
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|clear_4_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|putc_4_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|putcs_4_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|rev_char_4_plane
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_4PLANE */
multiline_comment|/*&n;    *    8 Planes (2-bytes interleave)&n;    */
macro_line|#ifdef CONFIG_FBCON_8PLANE
r_static
r_void
id|bmove_8_plane
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|clear_8_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|putc_8_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|putcs_8_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|rev_char_8_plane
c_func
(paren
r_struct
id|display
op_star
id|display
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_8PLANE */
multiline_comment|/*&n;    *    8 bpp Packed Pixels&n;    */
macro_line|#ifdef CONFIG_FBCON_8PACKED
r_static
r_void
id|bmove_8_packed
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|clear_8_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|putc_8_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|putcs_8_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|rev_char_8_packed
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_8PACKED */
multiline_comment|/*&n;    *    16 bpp Packed Pixels&n;    */
macro_line|#ifdef CONFIG_FBCON_16PACKED
r_static
r_void
id|bmove_16_packed
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|clear_16_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|putc_16_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|putcs_16_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|rev_char_16_packed
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
macro_line|#endif */ CONFIG_FBCON_8PACKED */
multiline_comment|/*&n;    *    Cybervision (accelerated)&n;    */
macro_line|#ifdef CONFIG_FBCON_CYBER
r_static
r_void
id|bmove_cyber
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|clear_cyber
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
r_static
r_void
id|putc_cyber
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|putcs_cyber
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
r_static
r_void
id|rev_char_cyber
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
r_extern
r_void
id|Cyber_WaitQueue
c_func
(paren
id|u_short
id|fifo
)paren
suffix:semicolon
r_extern
r_void
id|Cyber_WaitBlit
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|Cyber_BitBLT
c_func
(paren
id|u_short
id|curx
comma
id|u_short
id|cury
comma
id|u_short
id|destx
comma
id|u_short
id|desty
comma
id|u_short
id|width
comma
id|u_short
id|height
comma
id|u_short
id|mode
)paren
suffix:semicolon
r_extern
r_void
id|Cyber_RectFill
c_func
(paren
id|u_short
id|x
comma
id|u_short
id|y
comma
id|u_short
id|width
comma
id|u_short
id|height
comma
id|u_short
id|mode
comma
id|u_short
id|color
)paren
suffix:semicolon
r_extern
r_void
id|Cyber_MoveCursor
c_func
(paren
id|u_short
id|x
comma
id|u_short
id|y
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_CYBER */
multiline_comment|/*&n;    *    `switch&squot; for the Low Level Operations&n;    */
DECL|struct|display_switch
r_struct
id|display_switch
(brace
DECL|member|bmove
r_void
(paren
op_star
id|bmove
)paren
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
DECL|member|clear
r_void
(paren
op_star
id|clear
)paren
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
suffix:semicolon
DECL|member|putc
r_void
(paren
op_star
id|putc
)paren
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
DECL|member|putcs
r_void
(paren
op_star
id|putcs
)paren
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
suffix:semicolon
DECL|member|rev_char
r_void
(paren
op_star
id|rev_char
)paren
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_FBCON_MONO
DECL|variable|dispsw_mono
r_struct
id|display_switch
id|dispsw_mono
op_assign
(brace
id|bmove_mono
comma
id|clear_mono
comma
id|putc_mono
comma
id|putcs_mono
comma
id|rev_char_mono
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_MONO */
macro_line|#ifdef CONFIG_FBCON_ILBM
DECL|variable|dispsw_ilbm
r_struct
id|display_switch
id|dispsw_ilbm
op_assign
(brace
id|bmove_ilbm
comma
id|clear_ilbm
comma
id|putc_ilbm
comma
id|putcs_ilbm
comma
id|rev_char_ilbm
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_ILBM */
macro_line|#ifdef CONFIG_FBCON_PLANES
DECL|variable|dispsw_plan
r_struct
id|display_switch
id|dispsw_plan
op_assign
(brace
id|bmove_plan
comma
id|clear_plan
comma
id|putc_plan
comma
id|putcs_plan
comma
id|rev_char_plan
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_PLANES */
macro_line|#ifdef CONFIG_FBCON_2PLANE
DECL|variable|dispsw_2_plane
r_struct
id|display_switch
id|dispsw_2_plane
op_assign
(brace
id|bmove_2_plane
comma
id|clear_2_plane
comma
id|putc_2_plane
comma
id|putcs_2_plane
comma
id|rev_char_2_plane
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_2PLANE */
macro_line|#ifdef CONFIG_FBCON_4PLANE
DECL|variable|dispsw_4_plane
r_struct
id|display_switch
id|dispsw_4_plane
op_assign
(brace
id|bmove_4_plane
comma
id|clear_4_plane
comma
id|putc_4_plane
comma
id|putcs_4_plane
comma
id|rev_char_4_plane
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_4PLANE */
macro_line|#ifdef CONFIG_FBCON_8PLANE
DECL|variable|dispsw_8_plane
r_struct
id|display_switch
id|dispsw_8_plane
op_assign
(brace
id|bmove_8_plane
comma
id|clear_8_plane
comma
id|putc_8_plane
comma
id|putcs_8_plane
comma
id|rev_char_8_plane
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_8PLANE */
macro_line|#ifdef CONFIG_FBCON_8PACKED
DECL|variable|dispsw_8_packed
r_struct
id|display_switch
id|dispsw_8_packed
op_assign
(brace
id|bmove_8_packed
comma
id|clear_8_packed
comma
id|putc_8_packed
comma
id|putcs_8_packed
comma
id|rev_char_8_packed
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_8PACKED */
macro_line|#ifdef CONFIG_FBCON_16PACKED
DECL|variable|dispsw_16_packed
r_struct
id|display_switch
id|dispsw_16_packed
op_assign
(brace
id|bmove_16_packed
comma
id|clear_16_packed
comma
id|putc_16_packed
comma
id|putcs_16_packed
comma
id|rev_char_16_packed
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_16PACKED */
macro_line|#ifdef CONFIG_FBCON_CYBER
DECL|variable|dispsw_cyber
r_struct
id|display_switch
id|dispsw_cyber
op_assign
(brace
id|bmove_cyber
comma
id|clear_cyber
comma
id|putc_cyber
comma
id|putcs_cyber
comma
id|rev_char_cyber
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_CYBER */
DECL|function|fbcon_startup
r_static
id|u_long
id|fbcon_startup
c_func
(paren
id|u_long
id|kmem_start
comma
r_char
op_star
op_star
id|display_desc
)paren
(brace
r_int
id|irqres
op_assign
l_int|0
suffix:semicolon
id|fb_info
op_assign
id|mach_fb_init
c_func
(paren
op_amp
id|kmem_start
)paren
suffix:semicolon
id|disp
op_assign
id|fb_info-&gt;disp
suffix:semicolon
op_star
id|display_desc
op_assign
id|fb_info-&gt;modename
suffix:semicolon
id|fb_info-&gt;changevar
op_assign
op_amp
id|fbcon_changevar
suffix:semicolon
macro_line|#ifdef CONFIG_AMIGA
r_if
c_cond
(paren
id|MACH_IS_AMIGA
)paren
(brace
id|cursor_blink_rate
op_assign
id|AMIGA_CURSOR_BLINK_RATE
suffix:semicolon
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_AMIGA_VERTB
comma
id|fbcon_vbl_handler
comma
l_int|0
comma
l_string|&quot;console/cursor&quot;
comma
id|fbcon_vbl_handler
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AMIGA */
macro_line|#ifdef CONFIG_ATARI
r_if
c_cond
(paren
id|MACH_IS_ATARI
)paren
(brace
id|cursor_blink_rate
op_assign
id|ATARI_CURSOR_BLINK_RATE
suffix:semicolon
id|irqres
op_assign
id|request_irq
c_func
(paren
id|IRQ_AUTO_4
comma
id|fbcon_vbl_handler
comma
id|IRQ_TYPE_PRIO
comma
l_string|&quot;console/cursor&quot;
comma
id|fbcon_vbl_handler
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ATARI */
r_if
c_cond
(paren
id|irqres
)paren
id|panic
c_func
(paren
l_string|&quot;fbcon_startup: Couldn&squot;t add vblank interrupt&quot;
)paren
suffix:semicolon
r_return
id|kmem_start
suffix:semicolon
)brace
DECL|function|fbcon_init
r_static
r_void
id|fbcon_init
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_if
c_cond
(paren
id|unit
)paren
id|disp
(braket
id|unit
)braket
op_assign
id|disp
(braket
l_int|0
)braket
suffix:semicolon
id|disp
(braket
id|unit
)braket
dot
id|conp
op_assign
id|conp
suffix:semicolon
id|fbcon_setup
c_func
(paren
id|unit
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|fbcon_deinit
r_static
r_int
id|fbcon_deinit
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
id|disp
(braket
id|conp-&gt;vc_num
)braket
dot
id|conp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_changevar
r_static
r_int
id|fbcon_changevar
c_func
(paren
r_int
id|con
)paren
(brace
id|fbcon_setup
c_func
(paren
id|con
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_setup
r_static
r_void
id|fbcon_setup
c_func
(paren
r_int
id|con
comma
r_int
id|setcol
comma
r_int
id|init
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|disp
(braket
id|con
)braket
suffix:semicolon
r_struct
id|vc_data
op_star
id|conp
op_assign
id|p-&gt;conp
suffix:semicolon
r_int
id|nr_rows
comma
id|nr_cols
suffix:semicolon
id|p-&gt;var.xoffset
op_assign
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reset wrap/pan */
r_if
c_cond
(paren
op_logical_neg
id|fb_info-&gt;fontname
(braket
l_int|0
)braket
op_logical_or
op_logical_neg
id|findsoftfont
c_func
(paren
id|fb_info-&gt;fontname
comma
op_amp
id|p-&gt;fontwidth
comma
op_amp
id|p-&gt;fontheight
comma
op_amp
id|p-&gt;fontdata
)paren
op_logical_or
id|p-&gt;fontwidth
op_ne
l_int|8
)paren
id|getdefaultfont
c_func
(paren
id|p-&gt;var.xres
comma
id|p-&gt;var.yres
comma
l_int|NULL
comma
op_amp
id|p-&gt;fontwidth
comma
op_amp
id|p-&gt;fontheight
comma
op_amp
id|p-&gt;fontdata
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;fontwidth
op_ne
l_int|8
)paren
id|panic
c_func
(paren
l_string|&quot;fbcon_setup: No support for fontwidth != 8&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|divides
c_func
(paren
id|p-&gt;ywrapstep
comma
id|p-&gt;fontheight
)paren
op_logical_and
id|divides
c_func
(paren
id|p-&gt;fontheight
comma
id|p-&gt;var.yres_virtual
)paren
)paren
id|p-&gt;scrollmode
op_assign
id|SCROLL_YWRAP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|divides
c_func
(paren
id|p-&gt;ypanstep
comma
id|p-&gt;fontheight
)paren
op_logical_and
id|p-&gt;var.yres_virtual
op_ge
id|p-&gt;var.yres
op_plus
id|p-&gt;fontheight
)paren
id|p-&gt;scrollmode
op_assign
id|SCROLL_YPAN
suffix:semicolon
r_else
id|p-&gt;scrollmode
op_assign
id|SCROLL_YMOVE
suffix:semicolon
id|nr_cols
op_assign
id|p-&gt;var.xres
op_div
id|p-&gt;fontwidth
suffix:semicolon
id|nr_rows
op_assign
id|p-&gt;var.yres
op_div
id|p-&gt;fontheight
suffix:semicolon
multiline_comment|/* ++guenther: console.c:vc_allocate() relies on initializing vc_{cols,rows},&n;    * but we must not set those if we are only resizing the console.&n;    */
r_if
c_cond
(paren
id|init
)paren
(brace
id|conp-&gt;vc_cols
op_assign
id|nr_cols
suffix:semicolon
id|conp-&gt;vc_rows
op_assign
id|nr_rows
suffix:semicolon
)brace
id|p-&gt;vrows
op_assign
id|p-&gt;var.yres_virtual
op_div
id|p-&gt;fontheight
suffix:semicolon
id|conp-&gt;vc_can_do_color
op_assign
id|p-&gt;var.bits_per_pixel
op_ne
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_FBCON_MONO
r_if
c_cond
(paren
id|p-&gt;var.bits_per_pixel
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;line_length
)paren
id|p-&gt;next_line
op_assign
id|p-&gt;line_length
suffix:semicolon
r_else
id|p-&gt;next_line
op_assign
id|p-&gt;var.xres_virtual
op_rshift
l_int|3
suffix:semicolon
id|p-&gt;next_plane
op_assign
l_int|0
suffix:semicolon
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_mono
suffix:semicolon
)brace
r_else
macro_line|#endif /* CONFIG_FBCON_MONO */
macro_line|#ifdef CONFIG_FBCON_IPLAN2
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|FB_TYPE_INTERLEAVED_PLANES
op_logical_and
id|p-&gt;type_aux
op_eq
l_int|2
)paren
(brace
id|p-&gt;next_line
op_assign
id|p-&gt;var.xres_virtual
op_star
id|p-&gt;var.bits_per_pixel
op_rshift
l_int|3
suffix:semicolon
id|p-&gt;next_plane
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_FBCON_2PLANE
r_if
c_cond
(paren
id|p-&gt;var.bits_per_pixel
op_eq
l_int|2
)paren
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_2_plane
suffix:semicolon
r_else
macro_line|#endif /* CONFIG_FBCON_2PLANE */
macro_line|#ifdef CONFIG_FBCON_4PLANE
r_if
c_cond
(paren
id|p-&gt;var.bits_per_pixel
op_eq
l_int|4
)paren
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_4_plane
suffix:semicolon
r_else
macro_line|#endif /* CONFIG_FBCON_4PLANE */
macro_line|#ifdef CONFIG_FBCON_8PLANE
r_if
c_cond
(paren
id|p-&gt;var.bits_per_pixel
op_eq
l_int|8
)paren
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_8_plane
suffix:semicolon
r_else
macro_line|#endif /* CONFIG_FBCON_8PLANE */
r_goto
id|fail
suffix:semicolon
)brace
r_else
macro_line|#endif /* CONFIG_FBCON_IPLAN2 */
macro_line|#ifdef CONFIG_FBCON_ILBM
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|FB_TYPE_INTERLEAVED_PLANES
op_logical_and
id|p-&gt;type_aux
op_ne
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;line_length
)paren
(brace
id|p-&gt;next_line
op_assign
id|p-&gt;line_length
op_star
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|p-&gt;next_plane
op_assign
id|p-&gt;line_length
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;next_line
op_assign
id|p-&gt;type_aux
suffix:semicolon
id|p-&gt;next_plane
op_assign
id|p-&gt;type_aux
op_div
id|p-&gt;var.bits_per_pixel
suffix:semicolon
)brace
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_ilbm
suffix:semicolon
)brace
r_else
macro_line|#endif /* CONFIG_FBCON_ILBM */
macro_line|#ifdef CONFIG_FBCON_PLANES
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|FB_TYPE_PLANES
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;line_length
)paren
id|p-&gt;next_line
op_assign
id|p-&gt;line_length
suffix:semicolon
r_else
id|p-&gt;next_line
op_assign
id|p-&gt;var.xres_virtual
op_rshift
l_int|3
suffix:semicolon
id|p-&gt;next_plane
op_assign
id|p-&gt;var.yres_virtual
op_star
id|p-&gt;next_line
suffix:semicolon
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_plan
suffix:semicolon
)brace
r_else
macro_line|#endif /* CONFIG_FBCON_PLANES */
macro_line|#ifdef CONFIG_FBCON_PACKED
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|FB_TYPE_PACKED_PIXELS
)paren
(brace
id|p-&gt;next_line
op_assign
id|p-&gt;var.xres_virtual
op_star
id|p-&gt;var.bits_per_pixel
op_rshift
l_int|3
suffix:semicolon
id|p-&gt;next_plane
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_FBCON_CYBER
r_if
c_cond
(paren
id|p-&gt;var.accel
op_eq
id|FB_ACCEL_CYBERVISION
)paren
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_cyber
suffix:semicolon
r_else
macro_line|#endif /* CONFIG_FBCON_CYBER */
macro_line|#ifdef CONFIG_FBCON_8PACKED
r_if
c_cond
(paren
id|p-&gt;var.bits_per_pixel
op_eq
l_int|8
)paren
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_8_packed
suffix:semicolon
r_else
macro_line|#endif /* CONFIG_FBCON_8PACKED */
macro_line|#ifdef CONFIG_FBCON_16PACKED
r_if
c_cond
(paren
id|p-&gt;var.bits_per_pixel
op_eq
l_int|16
)paren
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_16_packed
suffix:semicolon
r_else
macro_line|#endif /* CONFIG_FBCON_16PACKED */
macro_line|#ifdef CONFIG_FBCON_24PACKED
r_if
c_cond
(paren
id|p-&gt;var.bits_per_pixel
op_eq
l_int|24
)paren
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_24_packed
suffix:semicolon
r_else
macro_line|#endif /* CONFIG_FBCON_24PACKED */
macro_line|#ifdef CONFIG_FBCON_32PACKED
r_if
c_cond
(paren
id|p-&gt;var.bits_per_pixel
op_eq
l_int|32
)paren
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_32_packed
suffix:semicolon
r_else
macro_line|#endif /* CONFIG_FBCON_32PACKED */
r_goto
id|fail
suffix:semicolon
)brace
r_else
macro_line|#endif /* CONFIG_FBCON_PACKED */
(brace
id|fail
suffix:colon
macro_line|#ifdef CONFIG_FBCON_MONO
id|printk
c_func
(paren
l_string|&quot;fbcon_setup: type %d (aux %d) not supported, trying mono&bslash;n&quot;
comma
id|p-&gt;type
comma
id|p-&gt;type_aux
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;line_length
)paren
id|p-&gt;next_line
op_assign
id|p-&gt;line_length
suffix:semicolon
r_else
id|p-&gt;next_line
op_assign
id|p-&gt;var.xres_virtual
op_rshift
l_int|3
suffix:semicolon
id|p-&gt;next_plane
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.bits_per_pixel
op_assign
l_int|1
suffix:semicolon
id|p-&gt;dispsw
op_assign
op_amp
id|dispsw_mono
suffix:semicolon
macro_line|#else /* CONFIG_FBCON_MONO */
id|panic
c_func
(paren
l_string|&quot;fbcon_setup: no default driver&quot;
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_FBCON_MONO */
)brace
r_if
c_cond
(paren
id|setcol
)paren
(brace
id|p-&gt;fgcol
op_assign
id|p-&gt;var.bits_per_pixel
OG
l_int|2
ques
c_cond
l_int|7
suffix:colon
(paren
l_int|1
op_lshift
id|p-&gt;var.bits_per_pixel
)paren
op_minus
l_int|1
suffix:semicolon
id|p-&gt;bgcol
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|init
)paren
id|vc_resize_con
c_func
(paren
id|nr_rows
comma
id|nr_cols
comma
id|con
)paren
suffix:semicolon
)brace
multiline_comment|/* ================================================================= */
multiline_comment|/*                      Utility Assembler Functions                  */
multiline_comment|/* ================================================================= */
multiline_comment|/* ====================================================================== */
multiline_comment|/* Those of a delicate disposition might like to skip the next couple of&n; * pages.&n; *&n; * These functions are drop in replacements for memmove and&n; * memset(_, 0, _). However their five instances add at least a kilobyte&n; * to the object file. You have been warned.&n; *&n; * Not a great fan of assembler for the sake of it, but I think&n; * that these routines are at least 10 times faster than their C&n; * equivalents for large blits, and that&squot;s important to the lowest level of&n; * a graphics driver. Question is whether some scheme with the blitter&n; * would be faster. I suspect not for simple text system - not much&n; * asynchrony.&n; *&n; * Code is very simple, just gruesome expansion. Basic strategy is to&n; * increase data moved/cleared at each step to 16 bytes to reduce&n; * instruction per data move overhead. movem might be faster still&n; * For more than 15 bytes, we try to align the write direction on a&n; * longword boundary to get maximum speed. This is even more gruesome.&n; * Unaligned read/write used requires 68020+ - think this is a problem?&n; *&n; * Sorry!&n; */
multiline_comment|/* ++roman: I&squot;ve optimized Robert&squot;s original versions in some minor&n; * aspects, e.g. moveq instead of movel, let gcc choose the registers,&n; * use movem in some places...&n; * For other modes than 1 plane, lots of more such assembler functions&n; * were needed (e.g. the ones using movep or expanding color values).&n; */
multiline_comment|/* ++andreas: more optimizations:&n;   subl #65536,d0 replaced by clrw d0; subql #1,d0 for dbcc&n;   addal is faster than addaw&n;   movep is rather expensive compared to ordinary move&squot;s&n;   some functions rewritten in C for clarity, no speed loss */
DECL|function|mymemclear_small
r_static
id|__inline__
r_void
op_star
id|mymemclear_small
c_func
(paren
r_void
op_star
id|s
comma
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_return
l_int|0
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lsrl   #1,%1 ; jcc 1f ; moveb %2,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%1 ; jcc 1f ; movew %2,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%1 ; jcc 1f ; movel %2,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%1 ; jcc 1f ; movel %2,%0@- ; movel %2,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: subql  #1,%1 ; jcs 3f&bslash;n&bslash;t&quot;
l_string|&quot;2: moveml %2/%3/%4/%5,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;dbra %1,2b&bslash;n&bslash;t&quot;
l_string|&quot;3:&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|s
)paren
comma
l_string|&quot;=d&quot;
(paren
id|count
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
l_int|0
)paren
comma
l_string|&quot;d&quot;
(paren
l_int|0
)paren
comma
l_string|&quot;d&quot;
(paren
l_int|0
)paren
comma
l_string|&quot;d&quot;
(paren
l_int|0
)paren
comma
l_string|&quot;0&quot;
(paren
(paren
r_char
op_star
)paren
id|s
op_plus
id|count
)paren
comma
l_string|&quot;1&quot;
(paren
id|count
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mymemclear
r_static
id|__inline__
r_void
op_star
id|mymemclear
c_func
(paren
r_void
op_star
id|s
comma
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|16
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lsrl   #1,%1 ; jcc 1f ; clrb %0@+&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%1 ; jcc 1f ; clrw %0@+&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%1 ; jcc 1f ; clrl %0@+&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%1 ; jcc 1f ; clrl %0@+ ; clrl %0@+&bslash;n&bslash;t&quot;
l_string|&quot;1:&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|s
)paren
comma
l_string|&quot;=d&quot;
(paren
id|count
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|s
)paren
comma
l_string|&quot;1&quot;
(paren
id|count
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|tmp
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;movel %1,%2&bslash;n&bslash;t&quot;
l_string|&quot;lsrl   #1,%2 ; jcc 1f ; clrb %0@+ ; subqw #1,%1&bslash;n&bslash;t&quot;
l_string|&quot;lsrl   #1,%2 ; jcs 2f&bslash;n&bslash;t&quot;
multiline_comment|/* %0 increased=&gt;bit 2 switched*/
l_string|&quot;clrw   %0@+  ; subqw  #2,%1 ; jra 2f&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%2 ; jcc 2f&bslash;n&bslash;t&quot;
l_string|&quot;clrw   %0@+  ; subqw  #2,%1&bslash;n&bslash;t&quot;
l_string|&quot;2: movew %1,%2; lsrl #2,%1 ; jeq 6f&bslash;n&bslash;t&quot;
l_string|&quot;lsrl   #1,%1 ; jcc 3f ; clrl %0@+&bslash;n&bslash;t&quot;
l_string|&quot;3: lsrl   #1,%1 ; jcc 4f ; clrl %0@+ ; clrl %0@+&bslash;n&bslash;t&quot;
l_string|&quot;4: subql  #1,%1 ; jcs 6f&bslash;n&bslash;t&quot;
l_string|&quot;5: clrl %0@+; clrl %0@+ ; clrl %0@+ ; clrl %0@+&bslash;n&bslash;t&quot;
l_string|&quot;dbra %1,5b   ; clrw %1; subql #1,%1; jcc 5b&bslash;n&bslash;t&quot;
l_string|&quot;6: movew %2,%1; btst #1,%1 ; jeq 7f ; clrw %0@+&bslash;n&bslash;t&quot;
l_string|&quot;7:            ; btst #0,%1 ; jeq 8f ; clrb %0@+&bslash;n&bslash;t&quot;
l_string|&quot;8:&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|s
)paren
comma
l_string|&quot;=d&quot;
(paren
id|count
)paren
comma
l_string|&quot;=d&quot;
(paren
id|tmp
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|s
)paren
comma
l_string|&quot;1&quot;
(paren
id|count
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mymemset
r_static
id|__inline__
r_void
op_star
id|mymemset
c_func
(paren
r_void
op_star
id|s
comma
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_return
l_int|0
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lsrl   #1,%1 ; jcc 1f ; moveb %2,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%1 ; jcc 1f ; movew %2,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%1 ; jcc 1f ; movel %2,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%1 ; jcc 1f ; movel %2,%0@- ; movel %2,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: subql  #1,%1 ; jcs 3f&bslash;n&bslash;t&quot;
l_string|&quot;2: moveml %2/%3/%4/%5,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;dbra %1,2b&bslash;n&bslash;t&quot;
l_string|&quot;3:&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|s
)paren
comma
l_string|&quot;=d&quot;
(paren
id|count
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
op_minus
l_int|1
)paren
comma
l_string|&quot;d&quot;
(paren
op_minus
l_int|1
)paren
comma
l_string|&quot;d&quot;
(paren
op_minus
l_int|1
)paren
comma
l_string|&quot;d&quot;
(paren
op_minus
l_int|1
)paren
comma
l_string|&quot;0&quot;
(paren
(paren
r_char
op_star
)paren
id|s
op_plus
id|count
)paren
comma
l_string|&quot;1&quot;
(paren
id|count
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mymemmove
r_static
id|__inline__
r_void
op_star
id|mymemmove
c_func
(paren
r_void
op_star
id|d
comma
r_void
op_star
id|s
comma
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|d
OL
id|s
)paren
(brace
r_if
c_cond
(paren
id|count
OL
l_int|16
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lsrl   #1,%2 ; jcc 1f ; moveb %1@+,%0@+&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%2 ; jcc 1f ; movew %1@+,%0@+&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%2 ; jcc 1f ; movel %1@+,%0@+&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%2 ; jcc 1f ; movel %1@+,%0@+ ; movel %1@+,%0@+&bslash;n&bslash;t&quot;
l_string|&quot;1:&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|d
)paren
comma
l_string|&quot;=a&quot;
(paren
id|s
)paren
comma
l_string|&quot;=d&quot;
(paren
id|count
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|d
)paren
comma
l_string|&quot;1&quot;
(paren
id|s
)paren
comma
l_string|&quot;2&quot;
(paren
id|count
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|tmp
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;movel  %0,%3&bslash;n&bslash;t&quot;
l_string|&quot;lsrl   #1,%3 ; jcc 1f ; moveb %1@+,%0@+ ; subqw #1,%2&bslash;n&bslash;t&quot;
l_string|&quot;lsrl   #1,%3 ; jcs 2f&bslash;n&bslash;t&quot;
multiline_comment|/* %0 increased=&gt;bit 2 switched*/
l_string|&quot;movew  %1@+,%0@+  ; subqw  #2,%2 ; jra 2f&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%3 ; jcc 2f&bslash;n&bslash;t&quot;
l_string|&quot;movew  %1@+,%0@+  ; subqw  #2,%2&bslash;n&bslash;t&quot;
l_string|&quot;2: movew  %2,%-; lsrl #2,%2 ; jeq 6f&bslash;n&bslash;t&quot;
l_string|&quot;lsrl   #1,%2 ; jcc 3f ; movel %1@+,%0@+&bslash;n&bslash;t&quot;
l_string|&quot;3: lsrl   #1,%2 ; jcc 4f ; movel %1@+,%0@+ ; movel %1@+,%0@+&bslash;n&bslash;t&quot;
l_string|&quot;4: subql  #1,%2 ; jcs 6f&bslash;n&bslash;t&quot;
l_string|&quot;5: movel  %1@+,%0@+;movel %1@+,%0@+&bslash;n&bslash;t&quot;
l_string|&quot;movel  %1@+,%0@+;movel %1@+,%0@+&bslash;n&bslash;t&quot;
l_string|&quot;dbra   %2,5b ; clrw %2; subql #1,%2; jcc 5b&bslash;n&bslash;t&quot;
l_string|&quot;6: movew  %+,%2; btst #1,%2 ; jeq 7f ; movew %1@+,%0@+&bslash;n&bslash;t&quot;
l_string|&quot;7:              ; btst #0,%2 ; jeq 8f ; moveb %1@+,%0@+&bslash;n&bslash;t&quot;
l_string|&quot;8:&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|d
)paren
comma
l_string|&quot;=a&quot;
(paren
id|s
)paren
comma
l_string|&quot;=d&quot;
(paren
id|count
)paren
comma
l_string|&quot;=d&quot;
(paren
id|tmp
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|d
)paren
comma
l_string|&quot;1&quot;
(paren
id|s
)paren
comma
l_string|&quot;2&quot;
(paren
id|count
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|count
OL
l_int|16
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;lsrl   #1,%2 ; jcc 1f ; moveb %1@-,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%2 ; jcc 1f ; movew %1@-,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%2 ; jcc 1f ; movel %1@-,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%2 ; jcc 1f ; movel %1@-,%0@- ; movel %1@-,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;1:&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|d
)paren
comma
l_string|&quot;=a&quot;
(paren
id|s
)paren
comma
l_string|&quot;=d&quot;
(paren
id|count
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
(paren
r_char
op_star
)paren
id|d
op_plus
id|count
)paren
comma
l_string|&quot;1&quot;
(paren
(paren
r_char
op_star
)paren
id|s
op_plus
id|count
)paren
comma
l_string|&quot;2&quot;
(paren
id|count
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|tmp
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;movel %0,%3&bslash;n&bslash;t&quot;
l_string|&quot;lsrl   #1,%3 ; jcc 1f ; moveb %1@-,%0@- ; subqw #1,%2&bslash;n&bslash;t&quot;
l_string|&quot;lsrl   #1,%3 ; jcs 2f&bslash;n&bslash;t&quot;
multiline_comment|/* %0 increased=&gt;bit 2 switched*/
l_string|&quot;movew  %1@-,%0@-  ; subqw  #2,%2 ; jra 2f&bslash;n&bslash;t&quot;
l_string|&quot;1: lsrl   #1,%3 ; jcc 2f&bslash;n&bslash;t&quot;
l_string|&quot;movew  %1@-,%0@-  ; subqw  #2,%2&bslash;n&bslash;t&quot;
l_string|&quot;2: movew %2,%-; lsrl #2,%2 ; jeq 6f&bslash;n&bslash;t&quot;
l_string|&quot;lsrl   #1,%2 ; jcc 3f ; movel %1@-,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;3: lsrl   #1,%2 ; jcc 4f ; movel %1@-,%0@- ; movel %1@-,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;4: subql  #1,%2 ; jcs 6f&bslash;n&bslash;t&quot;
l_string|&quot;5: movel %1@-,%0@-;movel %1@-,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;movel %1@-,%0@-;movel %1@-,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;dbra %2,5b ; clrw %2; subql #1,%2; jcc 5b&bslash;n&bslash;t&quot;
l_string|&quot;6: movew %+,%2; btst #1,%2 ; jeq 7f ; movew %1@-,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;7:              ; btst #0,%2 ; jeq 8f ; moveb %1@-,%0@-&bslash;n&bslash;t&quot;
l_string|&quot;8:&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|d
)paren
comma
l_string|&quot;=a&quot;
(paren
id|s
)paren
comma
l_string|&quot;=d&quot;
(paren
id|count
)paren
comma
l_string|&quot;=d&quot;
(paren
id|tmp
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
(paren
r_char
op_star
)paren
id|d
op_plus
id|count
)paren
comma
l_string|&quot;1&quot;
(paren
(paren
r_char
op_star
)paren
id|s
op_plus
id|count
)paren
comma
l_string|&quot;2&quot;
(paren
id|count
)paren
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ++andreas: Simple and fast version of memmove, assumes size is&n;   divisible by 16, suitable for moving the whole screen bitplane */
DECL|function|fast_memmove
r_static
id|__inline__
r_void
id|fast_memmove
c_func
(paren
r_char
op_star
id|dst
comma
r_char
op_star
id|src
comma
r_int
id|size
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|size
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|dst
OL
id|src
)paren
id|__asm__
id|__volatile__
(paren
l_string|&quot;1:&quot;
l_string|&quot;  moveml %0@+,%/d0/%/d1/%/a0/%/a1&bslash;n&quot;
l_string|&quot;  moveml %/d0/%/d1/%/a0/%/a1,%1@&bslash;n&quot;
l_string|&quot;  addql #8,%1; addql #8,%1&bslash;n&quot;
l_string|&quot;  dbra %2,1b&bslash;n&quot;
l_string|&quot;  clrw %2; subql #1,%2&bslash;n&quot;
l_string|&quot;  jcc 1b&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|src
)paren
comma
l_string|&quot;=a&quot;
(paren
id|dst
)paren
comma
l_string|&quot;=d&quot;
(paren
id|size
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|src
)paren
comma
l_string|&quot;1&quot;
(paren
id|dst
)paren
comma
l_string|&quot;2&quot;
(paren
id|size
op_div
l_int|16
op_minus
l_int|1
)paren
suffix:colon
l_string|&quot;d0&quot;
comma
l_string|&quot;d1&quot;
comma
l_string|&quot;a0&quot;
comma
l_string|&quot;a1&quot;
comma
l_string|&quot;memory&quot;
)paren
suffix:semicolon
r_else
id|__asm__
id|__volatile__
(paren
l_string|&quot;1:&quot;
l_string|&quot;  subql #8,%0; subql #8,%0&bslash;n&quot;
l_string|&quot;  moveml %0@,%/d0/%/d1/%/a0/%/a1&bslash;n&quot;
l_string|&quot;  moveml %/d0/%/d1/%/a0/%/a1,%1@-&bslash;n&quot;
l_string|&quot;  dbra %2,1b&bslash;n&quot;
l_string|&quot;  clrw %2; subql #1,%2&bslash;n&quot;
l_string|&quot;  jcc 1b&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|src
)paren
comma
l_string|&quot;=a&quot;
(paren
id|dst
)paren
comma
l_string|&quot;=d&quot;
(paren
id|size
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|src
op_plus
id|size
)paren
comma
l_string|&quot;1&quot;
(paren
id|dst
op_plus
id|size
)paren
comma
l_string|&quot;2&quot;
(paren
id|size
op_div
l_int|16
op_minus
l_int|1
)paren
suffix:colon
l_string|&quot;d0&quot;
comma
l_string|&quot;d1&quot;
comma
l_string|&quot;a0&quot;
comma
l_string|&quot;a1&quot;
comma
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Sets the bytes in the visible column at d, height h, to the value&n; * val for a 4 plane screen. The the bis of the color in &squot;color&squot; are&n; * moved (8 times) to the respective bytes. This means:&n; *&n; * for(h times; d += bpr)&n; *   *d     = (color &amp; 1) ? 0xff : 0;&n; *   *(d+2) = (color &amp; 2) ? 0xff : 0;&n; *   *(d+4) = (color &amp; 4) ? 0xff : 0;&n; *   *(d+6) = (color &amp; 8) ? 0xff : 0;&n; */
DECL|function|memclear_4p_col
r_static
id|__inline__
r_void
id|memclear_4p_col
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|h
comma
id|u_long
id|val
comma
r_int
id|bpr
)paren
(brace
id|__asm__
id|__volatile__
(paren
l_string|&quot;1: movepl %4,%0@(0)&bslash;n&bslash;t&quot;
l_string|&quot;addal  %5,%0&bslash;n&bslash;t&quot;
l_string|&quot;dbra&t;  %1,1b&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|d
)paren
comma
l_string|&quot;=d&quot;
(paren
id|h
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|d
)paren
comma
l_string|&quot;1&quot;
(paren
id|h
op_minus
l_int|1
)paren
comma
l_string|&quot;d&quot;
(paren
id|val
)paren
comma
l_string|&quot;r&quot;
(paren
id|bpr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Sets a 4 plane region from &squot;d&squot;, length &squot;count&squot; bytes, to the color&n; * in val1/val2. &squot;d&squot; has to be an even address and count must be divisible&n; * by 8, because only whole words and all planes are accessed. I.e.:&n; *&n; * for(count/8 times)&n; *   *d     = *(d+1) = (color &amp; 1) ? 0xff : 0;&n; *   *(d+2) = *(d+3) = (color &amp; 2) ? 0xff : 0;&n; *   *(d+4) = *(d+5) = (color &amp; 4) ? 0xff : 0;&n; *   *(d+6) = *(d+7) = (color &amp; 8) ? 0xff : 0;&n; */
DECL|function|memset_even_4p
r_static
id|__inline__
r_void
id|memset_even_4p
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|count
comma
id|u_long
id|val1
comma
id|u_long
id|val2
)paren
(brace
id|u_long
op_star
id|dd
op_assign
id|d
suffix:semicolon
id|count
op_div_assign
l_int|8
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
op_star
id|dd
op_increment
op_assign
id|val1
suffix:semicolon
op_star
id|dd
op_increment
op_assign
id|val2
suffix:semicolon
)brace
)brace
multiline_comment|/* Copies a 4 plane column from &squot;s&squot;, height &squot;h&squot;, to &squot;d&squot;. */
DECL|function|memmove_4p_col
r_static
id|__inline__
r_void
id|memmove_4p_col
(paren
r_void
op_star
id|d
comma
r_void
op_star
id|s
comma
r_int
id|h
comma
r_int
id|bpr
)paren
(brace
id|u_char
op_star
id|dd
op_assign
id|d
comma
op_star
id|ss
op_assign
id|s
suffix:semicolon
r_while
c_loop
(paren
id|h
op_decrement
)paren
(brace
id|dd
(braket
l_int|0
)braket
op_assign
id|ss
(braket
l_int|0
)braket
suffix:semicolon
id|dd
(braket
l_int|2
)braket
op_assign
id|ss
(braket
l_int|2
)braket
suffix:semicolon
id|dd
(braket
l_int|4
)braket
op_assign
id|ss
(braket
l_int|4
)braket
suffix:semicolon
id|dd
(braket
l_int|6
)braket
op_assign
id|ss
(braket
l_int|6
)braket
suffix:semicolon
id|dd
op_add_assign
id|bpr
suffix:semicolon
id|ss
op_add_assign
id|bpr
suffix:semicolon
)brace
)brace
multiline_comment|/* This expands a 4 bit color into a long for movepl (4 plane) operations. */
DECL|function|expand4l
r_static
id|__inline__
id|u_long
id|expand4l
c_func
(paren
id|u_char
id|c
)paren
(brace
id|u_long
id|rv
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;lsrb&t; #1,%2&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsll&t; #8,%0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%2&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsll&t; #8,%0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%2&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsll&t; #8,%0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%2&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;d&quot;
(paren
id|rv
)paren
comma
l_string|&quot;=d&quot;
(paren
id|c
)paren
suffix:colon
l_string|&quot;1&quot;
(paren
id|c
)paren
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
multiline_comment|/* This expands a 4 bit color into two longs for two movel operations&n; * (4 planes).&n; */
DECL|function|expand4dl
r_static
id|__inline__
r_void
id|expand4dl
c_func
(paren
id|u_char
id|c
comma
id|u_long
op_star
id|ret1
comma
id|u_long
op_star
id|ret2
)paren
(brace
id|u_long
id|rv1
comma
id|rv2
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;extw&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;swap&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;extw&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %1&bslash;n&bslash;t&quot;
l_string|&quot;extw&t; %1&bslash;n&bslash;t&quot;
l_string|&quot;swap&t; %1&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs   %1&bslash;n&bslash;t&quot;
l_string|&quot;extw&t; %1&quot;
suffix:colon
l_string|&quot;=&amp;d&quot;
(paren
id|rv1
)paren
comma
l_string|&quot;=&amp;d&quot;
(paren
id|rv2
)paren
comma
l_string|&quot;=d&quot;
(paren
id|c
)paren
suffix:colon
l_string|&quot;2&quot;
(paren
id|c
)paren
)paren
suffix:semicolon
op_star
id|ret1
op_assign
id|rv1
suffix:semicolon
op_star
id|ret2
op_assign
id|rv2
suffix:semicolon
)brace
multiline_comment|/* This duplicates a byte 4 times into a long. */
DECL|function|dup4l
r_static
id|__inline__
id|u_long
id|dup4l
c_func
(paren
id|u_char
id|c
)paren
(brace
id|ushort
id|tmp
suffix:semicolon
id|ulong
id|rv
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;moveb  %2,%0&bslash;n&bslash;t&quot;
l_string|&quot;lslw   #8,%0&bslash;n&bslash;t&quot;
l_string|&quot;moveb  %2,%0&bslash;n&bslash;t&quot;
l_string|&quot;movew  %0,%1&bslash;n&bslash;t&quot;
l_string|&quot;swap   %0&bslash;n&bslash;t&quot;
l_string|&quot;movew  %1,%0&quot;
suffix:colon
l_string|&quot;=&amp;d&quot;
(paren
id|rv
)paren
comma
l_string|&quot;=d&quot;
(paren
id|tmp
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
id|c
)paren
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
multiline_comment|/* Sets the bytes in the visible column at d, height h, to the value&n; * val1,val2 for a 8 plane screen. The the bis of the color in &squot;color&squot; are&n; * moved (8 times) to the respective bytes. This means:&n; *&n; * for(h times; d += bpr)&n; *   *d      = (color &amp; 1) ? 0xff : 0;&n; *   *(d+2)  = (color &amp; 2) ? 0xff : 0;&n; *   *(d+4)  = (color &amp; 4) ? 0xff : 0;&n; *   *(d+6)  = (color &amp; 8) ? 0xff : 0;&n; *   *(d+8)  = (color &amp; 16) ? 0xff : 0;&n; *   *(d+10) = (color &amp; 32) ? 0xff : 0;&n; *   *(d+12) = (color &amp; 64) ? 0xff : 0;&n; *   *(d+14) = (color &amp; 128) ? 0xff : 0;&n; */
DECL|function|memclear_8p_col
r_static
id|__inline__
r_void
id|memclear_8p_col
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|h
comma
id|u_long
id|val1
comma
id|u_long
id|val2
comma
r_int
id|bpr
)paren
(brace
id|__asm__
id|__volatile__
(paren
l_string|&quot;1: movepl %4,%0@(0)&bslash;n&bslash;t&quot;
l_string|&quot;movepl %5,%0@(8)&bslash;n&bslash;t&quot;
l_string|&quot;addal  %6,%0&bslash;n&bslash;t&quot;
l_string|&quot;dbra&t;  %1,1b&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|d
)paren
comma
l_string|&quot;=d&quot;
(paren
id|h
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|d
)paren
comma
l_string|&quot;1&quot;
(paren
id|h
op_minus
l_int|1
)paren
comma
l_string|&quot;d&quot;
(paren
id|val1
)paren
comma
l_string|&quot;d&quot;
(paren
id|val2
)paren
comma
l_string|&quot;r&quot;
(paren
id|bpr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Sets a 8 plane region from &squot;d&squot;, length &squot;count&squot; bytes, to the color&n; * val1..val4. &squot;d&squot; has to be an even address and count must be divisible&n; * by 16, because only whole words and all planes are accessed. I.e.:&n; *&n; * for(count/16 times)&n; *   *d      = *(d+1)  = (color &amp; 1) ? 0xff : 0;&n; *   *(d+2)  = *(d+3)  = (color &amp; 2) ? 0xff : 0;&n; *   *(d+4)  = *(d+5)  = (color &amp; 4) ? 0xff : 0;&n; *   *(d+6)  = *(d+7)  = (color &amp; 8) ? 0xff : 0;&n; *   *(d+8)  = *(d+9)  = (color &amp; 16) ? 0xff : 0;&n; *   *(d+10) = *(d+11) = (color &amp; 32) ? 0xff : 0;&n; *   *(d+12) = *(d+13) = (color &amp; 64) ? 0xff : 0;&n; *   *(d+14) = *(d+15) = (color &amp; 128) ? 0xff : 0;&n; */
DECL|function|memset_even_8p
r_static
id|__inline__
r_void
id|memset_even_8p
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|count
comma
id|u_long
id|val1
comma
id|u_long
id|val2
comma
id|u_long
id|val3
comma
id|u_long
id|val4
)paren
(brace
id|u_long
op_star
id|dd
op_assign
id|d
suffix:semicolon
id|count
op_div_assign
l_int|16
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
op_star
id|dd
op_increment
op_assign
id|val1
suffix:semicolon
op_star
id|dd
op_increment
op_assign
id|val2
suffix:semicolon
op_star
id|dd
op_increment
op_assign
id|val3
suffix:semicolon
op_star
id|dd
op_increment
op_assign
id|val4
suffix:semicolon
)brace
)brace
multiline_comment|/* Copies a 8 plane column from &squot;s&squot;, height &squot;h&squot;, to &squot;d&squot;. */
DECL|function|memmove_8p_col
r_static
id|__inline__
r_void
id|memmove_8p_col
(paren
r_void
op_star
id|d
comma
r_void
op_star
id|s
comma
r_int
id|h
comma
r_int
id|bpr
)paren
(brace
id|u_char
op_star
id|dd
op_assign
id|d
comma
op_star
id|ss
op_assign
id|s
suffix:semicolon
r_while
c_loop
(paren
id|h
op_decrement
)paren
(brace
id|dd
(braket
l_int|0
)braket
op_assign
id|ss
(braket
l_int|0
)braket
suffix:semicolon
id|dd
(braket
l_int|2
)braket
op_assign
id|ss
(braket
l_int|2
)braket
suffix:semicolon
id|dd
(braket
l_int|4
)braket
op_assign
id|ss
(braket
l_int|4
)braket
suffix:semicolon
id|dd
(braket
l_int|6
)braket
op_assign
id|ss
(braket
l_int|6
)braket
suffix:semicolon
id|dd
(braket
l_int|8
)braket
op_assign
id|ss
(braket
l_int|8
)braket
suffix:semicolon
id|dd
(braket
l_int|10
)braket
op_assign
id|ss
(braket
l_int|10
)braket
suffix:semicolon
id|dd
(braket
l_int|12
)braket
op_assign
id|ss
(braket
l_int|12
)braket
suffix:semicolon
id|dd
(braket
l_int|14
)braket
op_assign
id|ss
(braket
l_int|14
)braket
suffix:semicolon
id|dd
op_add_assign
id|bpr
suffix:semicolon
id|ss
op_add_assign
id|bpr
suffix:semicolon
)brace
)brace
multiline_comment|/* This expands a 8 bit color into two longs for two movepl (8 plane)&n; * operations.&n; */
DECL|function|expand8dl
r_static
id|__inline__
r_void
id|expand8dl
c_func
(paren
id|u_char
id|c
comma
id|u_long
op_star
id|ret1
comma
id|u_long
op_star
id|ret2
)paren
(brace
id|u_long
id|rv1
comma
id|rv2
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsll&t; #8,%0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsll&t; #8,%0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsll&t; #8,%0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %1&bslash;n&bslash;t&quot;
l_string|&quot;lsll&t; #8,%1&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %1&bslash;n&bslash;t&quot;
l_string|&quot;lsll&t; #8,%1&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %1&bslash;n&bslash;t&quot;
l_string|&quot;lsll&t; #8,%1&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%3&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %1&quot;
suffix:colon
l_string|&quot;=&amp;d&quot;
(paren
id|rv1
)paren
comma
l_string|&quot;=&amp;d&quot;
(paren
id|rv2
)paren
comma
l_string|&quot;=d&quot;
(paren
id|c
)paren
suffix:colon
l_string|&quot;2&quot;
(paren
id|c
)paren
)paren
suffix:semicolon
op_star
id|ret1
op_assign
id|rv1
suffix:semicolon
op_star
id|ret2
op_assign
id|rv2
suffix:semicolon
)brace
multiline_comment|/* This expands a 8 bit color into four longs for four movel operations&n; * (8 planes).&n; */
multiline_comment|/* ++andreas: use macro to avoid taking address of return values */
DECL|macro|expand8ql
mdefine_line|#define expand8ql(c, rv1, rv2, rv3, rv4) &bslash;&n;do {&t;u_char tmp = c;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;__asm__ __volatile__&t;&t;&t;&t;&t;&bslash;&n;&t;&t;(&quot;lsrb&t; #1,%5&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;scs&t; %0&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;extw&t; %0&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;swap&t; %0&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;lsrb&t; #1,%5&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;scs&t; %0&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;extw&t; %0&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;lsrb&t; #1,%5&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;scs&t; %1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;extw&t; %1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;swap&t; %1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;lsrb&t; #1,%5&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;scs   %1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;extw&t; %1&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;lsrb&t; #1,%5&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;scs&t; %2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;extw&t; %2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;swap&t; %2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;lsrb&t; #1,%5&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;scs&t; %2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;extw&t; %2&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;lsrb&t; #1,%5&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;scs&t; %3&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;extw&t; %3&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;swap&t; %3&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;lsrb&t; #1,%5&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;scs   %3&bslash;n&bslash;t&quot;&t;&t;&t;&t;&bslash;&n;&t;&t;  &quot;extw&t; %3&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;  : &quot;=&amp;d&quot; (rv1), &quot;=&amp;d&quot; (rv2), &quot;=&amp;d&quot; (rv3),&t;&bslash;&n;&t;&t;    &quot;=&amp;d&quot; (rv4), &quot;=d&quot; (tmp)&t;&t;&t;&bslash;&n;&t;&t;  : &quot;4&quot; (tmp)&t;&t;&t;&t;&t;&bslash;&n;&t;&t;);&t;&t;&t;&t;&t;&t;&bslash;&n;} while (0)
multiline_comment|/* Sets the bytes in the visible column at d, height h, to the value&n; * val for a 2 plane screen. The the bis of the color in &squot;color&squot; are&n; * moved (8 times) to the respective bytes. This means:&n; *&n; * for(h times; d += bpr)&n; *   *d     = (color &amp; 1) ? 0xff : 0;&n; *   *(d+2) = (color &amp; 2) ? 0xff : 0;&n; */
DECL|function|memclear_2p_col
r_static
id|__inline__
r_void
id|memclear_2p_col
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|h
comma
id|u_short
id|val
comma
r_int
id|bpr
)paren
(brace
id|__asm__
id|__volatile__
(paren
l_string|&quot;1: movepw %4,%0@(0)&bslash;n&bslash;t&quot;
l_string|&quot;addal  %5,%0&bslash;n&bslash;t&quot;
l_string|&quot;dbra&t;  %1,1b&quot;
suffix:colon
l_string|&quot;=a&quot;
(paren
id|d
)paren
comma
l_string|&quot;=d&quot;
(paren
id|h
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|d
)paren
comma
l_string|&quot;1&quot;
(paren
id|h
op_minus
l_int|1
)paren
comma
l_string|&quot;d&quot;
(paren
id|val
)paren
comma
l_string|&quot;r&quot;
(paren
id|bpr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Sets a 2 plane region from &squot;d&squot;, length &squot;count&squot; bytes, to the color&n; * in val1. &squot;d&squot; has to be an even address and count must be divisible&n; * by 8, because only whole words and all planes are accessed. I.e.:&n; *&n; * for(count/4 times)&n; *   *d     = *(d+1) = (color &amp; 1) ? 0xff : 0;&n; *   *(d+2) = *(d+3) = (color &amp; 2) ? 0xff : 0;&n; */
DECL|function|memset_even_2p
r_static
id|__inline__
r_void
id|memset_even_2p
c_func
(paren
r_void
op_star
id|d
comma
r_int
id|count
comma
id|u_long
id|val
)paren
(brace
id|u_long
op_star
id|dd
op_assign
id|d
suffix:semicolon
id|count
op_div_assign
l_int|4
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
id|dd
op_increment
op_assign
id|val
suffix:semicolon
)brace
multiline_comment|/* Copies a 2 plane column from &squot;s&squot;, height &squot;h&squot;, to &squot;d&squot;. */
DECL|function|memmove_2p_col
r_static
id|__inline__
r_void
id|memmove_2p_col
(paren
r_void
op_star
id|d
comma
r_void
op_star
id|s
comma
r_int
id|h
comma
r_int
id|bpr
)paren
(brace
id|u_char
op_star
id|dd
op_assign
id|d
comma
op_star
id|ss
op_assign
id|s
suffix:semicolon
r_while
c_loop
(paren
id|h
op_decrement
)paren
(brace
id|dd
(braket
l_int|0
)braket
op_assign
id|ss
(braket
l_int|0
)braket
suffix:semicolon
id|dd
(braket
l_int|2
)braket
op_assign
id|ss
(braket
l_int|2
)braket
suffix:semicolon
id|dd
op_add_assign
id|bpr
suffix:semicolon
id|ss
op_add_assign
id|bpr
suffix:semicolon
)brace
)brace
multiline_comment|/* This expands a 2 bit color into a short for movepw (2 plane) operations. */
DECL|function|expand2w
r_static
id|__inline__
id|u_short
id|expand2w
c_func
(paren
id|u_char
id|c
)paren
(brace
id|u_short
id|rv
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;lsrb&t; #1,%2&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsll&t; #8,%0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%2&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;d&quot;
(paren
id|rv
)paren
comma
l_string|&quot;=d&quot;
(paren
id|c
)paren
suffix:colon
l_string|&quot;1&quot;
(paren
id|c
)paren
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
multiline_comment|/* This expands a 2 bit color into one long for a movel operation&n; * (2 planes).&n; */
DECL|function|expand2l
r_static
id|__inline__
id|u_long
id|expand2l
c_func
(paren
id|u_char
id|c
)paren
(brace
id|u_long
id|rv
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;lsrb&t; #1,%2&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;extw&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;swap&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;lsrb&t; #1,%2&bslash;n&bslash;t&quot;
l_string|&quot;scs&t; %0&bslash;n&bslash;t&quot;
l_string|&quot;extw&t; %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;d&quot;
(paren
id|rv
)paren
comma
l_string|&quot;=d&quot;
(paren
id|c
)paren
suffix:colon
l_string|&quot;1&quot;
(paren
id|c
)paren
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
multiline_comment|/* This duplicates a byte 2 times into a short. */
DECL|function|dup2w
r_static
id|__inline__
id|u_short
id|dup2w
c_func
(paren
id|u_char
id|c
)paren
(brace
id|ushort
id|rv
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;moveb  %1,%0&bslash;n&bslash;t&quot;
l_string|&quot;lslw   #8,%0&bslash;n&bslash;t&quot;
l_string|&quot;moveb  %1,%0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;d&quot;
(paren
id|rv
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
id|c
)paren
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/* fbcon_XXX routines - interface used by the world&n; *&n; * This system is now divided into two levels because of complications&n; * caused by hardware scrolling. Top level functions:&n; *&n; *    fbcon_bmove(), fbcon_clear(), fbcon_putc()&n; *&n; * handles y values in range [0, scr_height-1] that correspond to real&n; * screen positions. y_wrap shift means that first line of bitmap may be&n; * anywhere on this display. These functions convert lineoffsets to&n; * bitmap offsets and deal with the wrap-around case by splitting blits.&n; *&n; *    fbcon_bmove_physical_8()   -- These functions fast implementations&n; *    fbcon_clear_physical_8()   -- of original fbcon_XXX fns.&n; *    fbcon_putc_physical_8()    -- (fontwidth != 8) may be added later&n; *&n; * WARNING:&n; *&n; * At the moment fbcon_putc() cannot blit across vertical wrap boundary&n; * Implies should only really hardware scroll in rows. Only reason for&n; * restriction is simplicity &amp; efficiency at the moment.&n; */
DECL|function|real_y
r_static
id|__inline__
r_int
id|real_y
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|y
)paren
(brace
r_int
id|rows
op_assign
id|p-&gt;vrows
suffix:semicolon
id|y
op_add_assign
id|p-&gt;yscroll
suffix:semicolon
r_return
id|y
OL
id|rows
ques
c_cond
id|y
suffix:colon
id|y
op_minus
id|rows
suffix:semicolon
)brace
DECL|function|fbcon_clear
r_static
r_int
id|fbcon_clear
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|disp
(braket
id|unit
)braket
suffix:semicolon
id|u_int
id|y_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sy
op_le
id|p-&gt;cursor_y
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
OL
id|sy
op_plus
id|height
)paren
op_logical_and
(paren
id|sx
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
id|sx
op_plus
id|width
)paren
)paren
id|CURSOR_UNDRAWN
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Split blits that cross physical y_wrap boundary */
id|y_break
op_assign
id|p-&gt;vrows
op_minus
id|p-&gt;yscroll
suffix:semicolon
r_if
c_cond
(paren
id|sy
OL
id|y_break
op_logical_and
id|sy
op_plus
id|height
op_minus
l_int|1
op_ge
id|y_break
)paren
(brace
id|u_int
id|b
op_assign
id|y_break
op_minus
id|sy
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
)paren
comma
id|sx
comma
id|b
comma
id|width
)paren
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
)paren
comma
id|sx
comma
id|height
op_minus
id|b
comma
id|width
)paren
suffix:semicolon
)brace
r_else
id|p-&gt;dispsw
op_member_access_from_pointer
id|clear
c_func
(paren
id|conp
comma
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
)paren
comma
id|sx
comma
id|height
comma
id|width
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_putc
r_static
r_int
id|fbcon_putc
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|disp
(braket
id|unit
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;cursor_x
op_eq
id|x
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
op_eq
id|y
)paren
)paren
id|CURSOR_UNDRAWN
c_func
(paren
)paren
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|putc
c_func
(paren
id|conp
comma
id|p
comma
id|c
comma
id|real_y
c_func
(paren
id|p
comma
id|y
)paren
comma
id|x
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_putcs
r_static
r_int
id|fbcon_putcs
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|disp
(braket
id|unit
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;cursor_y
op_eq
id|y
)paren
op_logical_and
(paren
id|x
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
id|x
op_plus
id|count
)paren
)paren
id|CURSOR_UNDRAWN
c_func
(paren
)paren
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|putcs
c_func
(paren
id|conp
comma
id|p
comma
id|s
comma
id|count
comma
id|real_y
c_func
(paren
id|p
comma
id|y
)paren
comma
id|x
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_cursor
r_static
r_int
id|fbcon_cursor
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|mode
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|disp
(braket
id|unit
)braket
suffix:semicolon
multiline_comment|/* Avoid flickering if there&squot;s no real change. */
r_if
c_cond
(paren
id|p-&gt;cursor_x
op_eq
id|conp-&gt;vc_x
op_logical_and
id|p-&gt;cursor_y
op_eq
id|conp-&gt;vc_y
op_logical_and
(paren
id|mode
op_eq
id|CM_ERASE
)paren
op_eq
op_logical_neg
id|cursor_on
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|CURSOR_UNDRAWN
(paren
)paren
)paren
id|p-&gt;dispsw
op_member_access_from_pointer
id|rev_char
c_func
(paren
id|p
comma
id|p-&gt;cursor_x
comma
id|real_y
c_func
(paren
id|p
comma
id|p-&gt;cursor_y
)paren
)paren
suffix:semicolon
id|p-&gt;cursor_x
op_assign
id|conp-&gt;vc_x
suffix:semicolon
id|p-&gt;cursor_y
op_assign
id|conp-&gt;vc_y
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|CM_ERASE
suffix:colon
id|cursor_on
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CM_MOVE
suffix:colon
r_case
id|CM_DRAW
suffix:colon
id|vbl_cursor_cnt
op_assign
id|CURSOR_DRAW_DELAY
suffix:semicolon
id|cursor_on
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_vbl_handler
r_static
r_void
id|fbcon_vbl_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dummy
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
r_struct
id|display
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cursor_on
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|vbl_cursor_cnt
op_logical_and
op_decrement
id|vbl_cursor_cnt
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Here no check is possible for console changing. The console&n;       * switching code should set vbl_cursor_cnt to an appropriate value.&n;       */
id|p
op_assign
op_amp
id|disp
(braket
id|fg_console
)braket
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|rev_char
c_func
(paren
id|p
comma
id|p-&gt;cursor_x
comma
id|real_y
c_func
(paren
id|p
comma
id|p-&gt;cursor_y
)paren
)paren
suffix:semicolon
id|cursor_drawn
op_xor_assign
l_int|1
suffix:semicolon
id|vbl_cursor_cnt
op_assign
id|cursor_blink_rate
suffix:semicolon
)brace
)brace
DECL|function|fbcon_scroll
r_static
r_int
id|fbcon_scroll
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|t
comma
r_int
id|b
comma
r_int
id|dir
comma
r_int
id|count
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|disp
(braket
id|unit
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
r_return
l_int|0
suffix:semicolon
id|fbcon_cursor
c_func
(paren
id|conp
comma
id|CM_ERASE
)paren
suffix:semicolon
multiline_comment|/*&n;    * ++Geert: Only use ywrap/ypan if the console is in text mode&n;    */
r_switch
c_cond
(paren
id|dir
)paren
(brace
r_case
id|SM_UP
suffix:colon
r_if
c_cond
(paren
id|t
op_eq
l_int|0
op_logical_and
id|b
op_eq
id|conp-&gt;vc_rows
op_logical_and
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_TEXT
)paren
(brace
r_if
c_cond
(paren
id|count
OG
id|conp-&gt;vc_rows
)paren
multiline_comment|/* Maximum realistic size */
id|count
op_assign
id|conp-&gt;vc_rows
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;scrollmode
)paren
(brace
r_case
id|SCROLL_YWRAP
suffix:colon
id|p-&gt;yscroll
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
op_ge
id|p-&gt;vrows
)paren
multiline_comment|/* Deal with wrap */
id|p-&gt;yscroll
op_sub_assign
id|p-&gt;vrows
suffix:semicolon
id|p-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|p-&gt;fontheight
suffix:semicolon
id|p-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
id|fb_info
op_member_access_from_pointer
id|updatevar
c_func
(paren
id|unit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_YPAN
suffix:colon
id|p-&gt;yscroll
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
op_plus
id|conp-&gt;vc_rows
OG
id|p-&gt;vrows
)paren
(brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|bmove
c_func
(paren
id|p
comma
id|p-&gt;yscroll
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|b
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
)brace
id|p-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|p-&gt;fontheight
suffix:semicolon
id|p-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|fb_info
op_member_access_from_pointer
id|updatevar
c_func
(paren
id|unit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_YMOVE
suffix:colon
id|p-&gt;dispsw
op_member_access_from_pointer
id|bmove
c_func
(paren
id|p
comma
id|count
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|b
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|t
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|conp
comma
id|b
op_minus
id|count
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SM_DOWN
suffix:colon
r_if
c_cond
(paren
id|t
op_eq
l_int|0
op_logical_and
id|b
op_eq
id|conp-&gt;vc_rows
op_logical_and
id|vt_cons
(braket
id|unit
)braket
op_member_access_from_pointer
id|vc_mode
op_eq
id|KD_TEXT
)paren
(brace
r_if
c_cond
(paren
id|count
OG
id|conp-&gt;vc_rows
)paren
multiline_comment|/* Maximum realistic size */
id|count
op_assign
id|conp-&gt;vc_rows
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;scrollmode
)paren
(brace
r_case
id|SCROLL_YWRAP
suffix:colon
id|p-&gt;yscroll
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
OL
l_int|0
)paren
multiline_comment|/* Deal with wrap */
id|p-&gt;yscroll
op_add_assign
id|p-&gt;vrows
suffix:semicolon
id|p-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|p-&gt;fontheight
suffix:semicolon
id|p-&gt;var.vmode
op_or_assign
id|FB_VMODE_YWRAP
suffix:semicolon
id|fb_info
op_member_access_from_pointer
id|updatevar
c_func
(paren
id|unit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_YPAN
suffix:colon
id|p-&gt;yscroll
op_sub_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;yscroll
OL
l_int|0
)paren
(brace
id|p-&gt;yscroll
op_assign
id|p-&gt;vrows
op_minus
id|conp-&gt;vc_rows
suffix:semicolon
id|p-&gt;dispsw
op_member_access_from_pointer
id|bmove
c_func
(paren
id|p
comma
l_int|0
comma
l_int|0
comma
id|p-&gt;yscroll
op_plus
id|count
comma
l_int|0
comma
id|b
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
)brace
id|p-&gt;var.xoffset
op_assign
l_int|0
suffix:semicolon
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_star
id|p-&gt;fontheight
suffix:semicolon
id|p-&gt;var.vmode
op_and_assign
op_complement
id|FB_VMODE_YWRAP
suffix:semicolon
id|fb_info
op_member_access_from_pointer
id|updatevar
c_func
(paren
id|unit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCROLL_YMOVE
suffix:colon
id|p-&gt;dispsw
op_member_access_from_pointer
id|bmove
c_func
(paren
id|p
comma
l_int|0
comma
l_int|0
comma
id|count
comma
l_int|0
comma
id|b
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|fbcon_bmove
c_func
(paren
id|conp
comma
id|t
comma
l_int|0
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|b
op_minus
id|t
op_minus
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
multiline_comment|/* Fixed bmove() should end Arno&squot;s frustration with copying?&n;          * Confucius says:&n;          *    Man who copies in wrong direction, end up with trashed data&n;          */
id|fbcon_clear
c_func
(paren
id|conp
comma
id|t
comma
l_int|0
comma
id|count
comma
id|conp-&gt;vc_cols
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SM_LEFT
suffix:colon
id|fbcon_bmove
c_func
(paren
id|conp
comma
l_int|0
comma
id|t
op_plus
id|count
comma
l_int|0
comma
id|t
comma
id|conp-&gt;vc_rows
comma
id|b
op_minus
id|t
op_minus
id|count
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|conp
comma
l_int|0
comma
id|b
op_minus
id|count
comma
id|conp-&gt;vc_rows
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SM_RIGHT
suffix:colon
id|fbcon_bmove
c_func
(paren
id|conp
comma
l_int|0
comma
id|t
comma
l_int|0
comma
id|t
op_plus
id|count
comma
id|conp-&gt;vc_rows
comma
id|b
op_minus
id|t
op_minus
id|count
)paren
suffix:semicolon
id|fbcon_clear
c_func
(paren
id|conp
comma
l_int|0
comma
id|t
comma
id|conp-&gt;vc_rows
comma
id|count
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_bmove
r_static
r_int
id|fbcon_bmove
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|disp
(braket
id|unit
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
op_logical_and
id|console_blanked
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|sy
op_le
id|p-&gt;cursor_y
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
OL
id|sy
op_plus
id|height
)paren
op_logical_and
(paren
id|sx
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
id|sx
op_plus
id|width
)paren
)paren
op_logical_or
(paren
(paren
id|dy
op_le
id|p-&gt;cursor_y
)paren
op_logical_and
(paren
id|p-&gt;cursor_y
OL
id|dy
op_plus
id|height
)paren
op_logical_and
(paren
id|dx
op_le
id|p-&gt;cursor_x
)paren
op_logical_and
(paren
id|p-&gt;cursor_x
OL
id|dx
op_plus
id|width
)paren
)paren
)paren
id|fbcon_cursor
c_func
(paren
id|conp
comma
id|CM_ERASE
)paren
suffix:semicolon
multiline_comment|/* Split blits that cross physical y_wrap case.&n;    * Pathological case involves 4 blits, better to use recursive&n;    * code rather than unrolled case&n;    *&n;    * Recursive invocations don&squot;t need to erase the cursor over and&n;    * over again, so we use fbcon_bmove_rec()&n;    */
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|height
comma
id|width
comma
id|p-&gt;vrows
op_minus
id|p-&gt;yscroll
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_bmove_rec
r_static
r_void
id|fbcon_bmove_rec
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
comma
id|u_int
id|y_break
)paren
(brace
id|u_int
id|b
suffix:semicolon
r_if
c_cond
(paren
id|sy
template_param
id|y_break
)paren
(brace
id|b
op_assign
id|y_break
op_minus
id|sy
suffix:semicolon
r_if
c_cond
(paren
id|dy
OL
id|sy
)paren
(brace
multiline_comment|/* Avoid trashing self */
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_else
(brace
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dy
template_param
id|y_break
)paren
(brace
id|b
op_assign
id|y_break
op_minus
id|dy
suffix:semicolon
r_if
c_cond
(paren
id|dy
OL
id|sy
)paren
(brace
multiline_comment|/* Avoid trashing self */
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_else
(brace
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
op_plus
id|b
comma
id|sx
comma
id|dy
op_plus
id|b
comma
id|dx
comma
id|height
op_minus
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
id|fbcon_bmove_rec
c_func
(paren
id|p
comma
id|sy
comma
id|sx
comma
id|dy
comma
id|dx
comma
id|b
comma
id|width
comma
id|y_break
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|p-&gt;dispsw
op_member_access_from_pointer
id|bmove
c_func
(paren
id|p
comma
id|real_y
c_func
(paren
id|p
comma
id|sy
)paren
comma
id|sx
comma
id|real_y
c_func
(paren
id|p
comma
id|dy
)paren
comma
id|dx
comma
id|height
comma
id|width
)paren
suffix:semicolon
)brace
DECL|function|fbcon_switch
r_static
r_int
id|fbcon_switch
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
)paren
(brace
r_if
c_cond
(paren
id|fb_info
op_logical_and
id|fb_info-&gt;switch_con
)paren
(paren
op_star
id|fb_info-&gt;switch_con
)paren
(paren
id|conp-&gt;vc_num
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_blank
r_static
r_int
id|fbcon_blank
c_func
(paren
r_int
id|blank
)paren
(brace
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|disp
(braket
id|fg_console
)braket
suffix:semicolon
id|fbcon_cursor
c_func
(paren
id|p-&gt;conp
comma
id|blank
ques
c_cond
id|CM_ERASE
suffix:colon
id|CM_DRAW
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;can_soft_blank
)paren
r_if
c_cond
(paren
id|blank
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;visual
op_eq
id|FB_VISUAL_MONO01
)paren
id|mymemset
c_func
(paren
id|p-&gt;screen_base
comma
id|p-&gt;var.xres_virtual
op_star
id|p-&gt;var.yres_virtual
op_star
id|p-&gt;var.bits_per_pixel
op_rshift
l_int|3
)paren
suffix:semicolon
r_else
id|mymemclear
c_func
(paren
id|p-&gt;screen_base
comma
id|p-&gt;var.xres_virtual
op_star
id|p-&gt;var.yres_virtual
op_star
id|p-&gt;var.bits_per_pixel
op_rshift
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Tell console.c that it has to restore the screen itself */
r_return
l_int|1
suffix:semicolon
)brace
(paren
op_star
id|fb_info-&gt;blank
)paren
(paren
id|blank
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fbcon_get_font
r_static
r_int
id|fbcon_get_font
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
op_star
id|w
comma
r_int
op_star
id|h
comma
r_char
op_star
id|data
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|disp
(braket
id|unit
)braket
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|size
comma
id|alloc
suffix:semicolon
id|size
op_assign
(paren
id|p-&gt;fontwidth
op_plus
l_int|7
)paren
op_div
l_int|8
op_star
id|p-&gt;fontheight
op_star
l_int|256
suffix:semicolon
id|alloc
op_assign
(paren
op_star
id|w
op_plus
l_int|7
)paren
op_div
l_int|8
op_star
op_star
id|h
op_star
l_int|256
suffix:semicolon
op_star
id|w
op_assign
id|p-&gt;fontwidth
suffix:semicolon
op_star
id|h
op_assign
id|p-&gt;fontheight
suffix:semicolon
r_if
c_cond
(paren
id|alloc
OL
id|size
)paren
multiline_comment|/* allocation length not sufficient */
r_return
op_minus
id|ENAMETOOLONG
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|p-&gt;fontheight
suffix:semicolon
id|j
op_increment
)paren
id|data
(braket
id|i
op_star
l_int|32
op_plus
id|j
)braket
op_assign
id|p-&gt;fontdata
(braket
id|i
op_star
id|p-&gt;fontheight
op_plus
id|j
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|REFCOUNT
mdefine_line|#define REFCOUNT(fd)&t;(((int *)(fd))[-1])
DECL|function|fbcon_set_font
r_static
r_int
id|fbcon_set_font
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_int
id|w
comma
r_int
id|h
comma
r_char
op_star
id|data
)paren
(brace
r_int
id|unit
op_assign
id|conp-&gt;vc_num
suffix:semicolon
r_struct
id|display
op_star
id|p
op_assign
op_amp
id|disp
(braket
id|unit
)braket
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|size
comma
id|userspace
op_assign
l_int|1
comma
id|resize
suffix:semicolon
r_char
op_star
id|old_data
op_assign
l_int|NULL
comma
op_star
id|new_data
suffix:semicolon
r_if
c_cond
(paren
id|w
OL
l_int|0
)paren
id|w
op_assign
id|p-&gt;fontwidth
suffix:semicolon
r_if
c_cond
(paren
id|h
OL
l_int|0
)paren
id|h
op_assign
id|p-&gt;fontheight
suffix:semicolon
r_if
c_cond
(paren
id|w
op_eq
l_int|0
)paren
(brace
multiline_comment|/* engage predefined font, name in &squot;data&squot; */
r_char
id|name
(braket
id|MAX_FONT_NAME
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
(paren
r_void
op_star
)paren
id|data
comma
id|MAX_FONT_NAME
)paren
)paren
)paren
r_return
id|i
suffix:semicolon
id|copy_from_user
c_func
(paren
id|name
comma
id|data
comma
id|MAX_FONT_NAME
)paren
suffix:semicolon
id|name
(braket
r_sizeof
(paren
id|name
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|findsoftfont
c_func
(paren
id|name
comma
op_amp
id|w
comma
op_amp
id|h
comma
(paren
id|u_char
op_star
op_star
)paren
op_amp
id|data
)paren
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|userspace
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|w
op_eq
l_int|1
)paren
(brace
multiline_comment|/* copy font from some other console in &squot;h&squot;*/
r_struct
id|display
op_star
id|op
suffix:semicolon
r_if
c_cond
(paren
id|h
OL
l_int|0
op_logical_or
op_logical_neg
id|vc_cons_allocated
c_func
(paren
id|h
)paren
)paren
r_return
op_minus
id|ENOTTY
suffix:semicolon
r_if
c_cond
(paren
id|h
op_eq
id|unit
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* nothing to do */
id|op
op_assign
op_amp
id|disp
(braket
id|h
)braket
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;fontdata
op_eq
id|p-&gt;fontdata
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* already the same font... */
id|resize
op_assign
(paren
id|op-&gt;fontwidth
op_ne
id|p-&gt;fontwidth
)paren
op_logical_or
(paren
id|op-&gt;fontheight
op_ne
id|p-&gt;fontheight
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;userfont
)paren
id|old_data
op_assign
id|p-&gt;fontdata
suffix:semicolon
id|p-&gt;fontdata
op_assign
id|op-&gt;fontdata
suffix:semicolon
id|w
op_assign
id|p-&gt;fontwidth
op_assign
id|op-&gt;fontwidth
suffix:semicolon
id|h
op_assign
id|p-&gt;fontheight
op_assign
id|op-&gt;fontheight
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;userfont
op_assign
id|op-&gt;userfont
)paren
)paren
id|REFCOUNT
c_func
(paren
id|p-&gt;fontdata
)paren
op_increment
suffix:semicolon
multiline_comment|/* increment usage counter */
r_goto
id|activate
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w
op_ne
l_int|8
)paren
multiline_comment|/* Currently only fontwidth == 8 supported */
r_return
op_minus
id|ENXIO
suffix:semicolon
id|resize
op_assign
(paren
id|w
op_ne
id|p-&gt;fontwidth
)paren
op_logical_or
(paren
id|h
op_ne
id|p-&gt;fontheight
)paren
suffix:semicolon
id|size
op_assign
(paren
id|w
op_plus
l_int|7
)paren
op_div
l_int|8
op_star
id|h
op_star
l_int|256
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;userfont
)paren
id|old_data
op_assign
id|p-&gt;fontdata
suffix:semicolon
r_if
c_cond
(paren
id|userspace
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|new_data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_plus
id|size
comma
id|GFP_USER
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|new_data
op_add_assign
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|REFCOUNT
c_func
(paren
id|new_data
)paren
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* usage counter */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|h
suffix:semicolon
id|j
op_increment
)paren
id|new_data
(braket
id|i
op_star
id|h
op_plus
id|j
)braket
op_assign
id|data
(braket
id|i
op_star
l_int|32
op_plus
id|j
)braket
suffix:semicolon
id|p-&gt;fontdata
op_assign
id|new_data
suffix:semicolon
id|p-&gt;userfont
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;fontdata
op_assign
id|data
suffix:semicolon
id|p-&gt;userfont
op_assign
l_int|0
suffix:semicolon
)brace
id|p-&gt;fontwidth
op_assign
id|w
suffix:semicolon
id|p-&gt;fontheight
op_assign
id|h
suffix:semicolon
id|activate
suffix:colon
r_if
c_cond
(paren
id|resize
)paren
(brace
id|p-&gt;var.xoffset
op_assign
id|p-&gt;var.yoffset
op_assign
id|p-&gt;yscroll
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reset wrap/pan */
multiline_comment|/* Adjust the virtual screen-size to fontheight*rows */
id|p-&gt;var.yres_virtual
op_assign
(paren
id|p-&gt;var.yres
op_div
id|h
)paren
op_star
id|h
suffix:semicolon
id|p-&gt;vrows
op_assign
id|p-&gt;var.yres_virtual
op_div
id|h
suffix:semicolon
r_if
c_cond
(paren
id|divides
c_func
(paren
id|p-&gt;ywrapstep
comma
id|p-&gt;fontheight
)paren
)paren
id|p-&gt;scrollmode
op_assign
id|SCROLL_YWRAP
suffix:semicolon
r_else
r_if
c_cond
(paren
id|divides
c_func
(paren
id|p-&gt;ypanstep
comma
id|p-&gt;fontheight
)paren
op_logical_and
id|p-&gt;var.yres_virtual
op_ge
id|p-&gt;var.yres
op_plus
id|p-&gt;fontheight
)paren
id|p-&gt;scrollmode
op_assign
id|SCROLL_YPAN
suffix:semicolon
r_else
id|p-&gt;scrollmode
op_assign
id|SCROLL_YMOVE
suffix:semicolon
id|vc_resize_con
c_func
(paren
id|p-&gt;var.yres
op_div
id|h
comma
id|p-&gt;var.xres
op_div
id|w
comma
id|unit
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|unit
op_eq
id|fg_console
)paren
id|update_screen
c_func
(paren
id|unit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|old_data
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|REFCOUNT
c_func
(paren
id|old_data
)paren
op_eq
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|old_data
op_minus
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ====================================================================== */
multiline_comment|/*&n; *    Low Level Operations for the various display memory organizations.&n; *&n; *    Currently only the following organizations are supported here:&n; *&n; *      - Monochrome&n; *      - Color Interleaved Planes &#xfffd; la Amiga&n; *      - Color Normal Planes&n; *      - Color Interleaved Planes &#xfffd; la Atari (2, 4 and 8 planes)&n; *      - Color Packed Pixels (8 and 16 bpp)&n; *      - Cybervision Color Packed Pixels (accelerated)&n; */
macro_line|#ifdef CONFIG_FBCON_MONO
multiline_comment|/*&n;    *    Monochrome&n;    */
DECL|function|bmove_mono
r_static
r_void
id|bmove_mono
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_char
op_star
id|src
comma
op_star
id|dest
suffix:semicolon
id|u_int
id|rows
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|sy
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|p-&gt;next_line
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;fontheight
op_star
id|width
suffix:semicolon
id|mymemmove
c_func
(paren
id|dest
comma
id|src
comma
id|height
op_star
id|p-&gt;fontheight
op_star
id|width
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dy
op_le
id|sy
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|sx
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|dx
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|mymemmove
c_func
(paren
id|dest
comma
id|src
comma
id|width
)paren
suffix:semicolon
id|src
op_add_assign
id|p-&gt;next_line
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
suffix:semicolon
)brace
)brace
r_else
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
(paren
(paren
id|sy
op_plus
id|height
)paren
op_star
id|p-&gt;fontheight
op_minus
l_int|1
)paren
op_star
id|p-&gt;next_line
op_plus
id|sx
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
(paren
(paren
id|dy
op_plus
id|height
)paren
op_star
id|p-&gt;fontheight
op_minus
l_int|1
)paren
op_star
id|p-&gt;next_line
op_plus
id|dx
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|mymemmove
c_func
(paren
id|dest
comma
id|src
comma
id|width
)paren
suffix:semicolon
id|src
op_sub_assign
id|p-&gt;next_line
suffix:semicolon
id|dest
op_sub_assign
id|p-&gt;next_line
suffix:semicolon
)brace
)brace
)brace
DECL|function|clear_mono
r_static
r_void
id|clear_mono
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
id|u_int
id|rows
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|sx
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|p-&gt;next_line
)paren
r_if
c_cond
(paren
id|attr_reverse
c_func
(paren
id|p
comma
id|conp
)paren
)paren
id|mymemset
c_func
(paren
id|dest
comma
id|height
op_star
id|p-&gt;fontheight
op_star
id|width
)paren
suffix:semicolon
r_else
id|mymemclear
c_func
(paren
id|dest
comma
id|height
op_star
id|p-&gt;fontheight
op_star
id|width
)paren
suffix:semicolon
r_else
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
r_if
c_cond
(paren
id|attr_reverse
c_func
(paren
id|p
comma
id|conp
)paren
)paren
id|mymemset
c_func
(paren
id|dest
comma
id|width
)paren
suffix:semicolon
r_else
id|mymemclear_small
c_func
(paren
id|dest
comma
id|width
)paren
suffix:semicolon
)brace
DECL|function|putc_mono
r_static
r_void
id|putc_mono
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|cdat
suffix:semicolon
id|u_int
id|rows
comma
id|bold
comma
id|reverse
comma
id|underline
suffix:semicolon
id|u_char
id|d
suffix:semicolon
id|c
op_and_assign
l_int|0xff
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|x
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|p-&gt;fontheight
suffix:semicolon
id|bold
op_assign
id|attr_bold
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|reverse
op_assign
id|attr_reverse
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|underline
op_assign
id|attr_underline
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
(brace
id|d
op_assign
op_star
id|cdat
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|underline
op_logical_and
op_logical_neg
id|rows
)paren
id|d
op_assign
l_int|0xff
suffix:semicolon
r_else
r_if
c_cond
(paren
id|bold
)paren
id|d
op_or_assign
id|d
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|reverse
)paren
id|d
op_assign
op_complement
id|d
suffix:semicolon
op_star
id|dest
op_assign
id|d
suffix:semicolon
)brace
)brace
DECL|function|putcs_mono
r_static
r_void
id|putcs_mono
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|dest0
comma
op_star
id|cdat
suffix:semicolon
id|u_int
id|rows
comma
id|bold
comma
id|reverse
comma
id|underline
suffix:semicolon
id|u_char
id|c
comma
id|d
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|x
suffix:semicolon
id|bold
op_assign
id|attr_bold
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|reverse
op_assign
id|attr_reverse
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|underline
op_assign
id|attr_underline
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|c
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|dest
op_assign
id|dest0
op_increment
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|p-&gt;fontheight
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
(brace
id|d
op_assign
op_star
id|cdat
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|underline
op_logical_and
op_logical_neg
id|rows
)paren
id|d
op_assign
l_int|0xff
suffix:semicolon
r_else
r_if
c_cond
(paren
id|bold
)paren
id|d
op_or_assign
id|d
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|reverse
)paren
id|d
op_assign
op_complement
id|d
suffix:semicolon
op_star
id|dest
op_assign
id|d
suffix:semicolon
)brace
)brace
)brace
DECL|function|rev_char_mono
r_static
r_void
id|rev_char_mono
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
id|u_int
id|rows
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|x
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
op_star
id|dest
op_assign
op_complement
op_star
id|dest
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FBCON_MONO */
multiline_comment|/* ====================================================================== */
macro_line|#ifdef CONFIG_FBCON_ILBM
multiline_comment|/*&n;    *    Color Interleaved Planes&n;    *&n;    *    This code heavily relies on the fact that&n;    *&n;    *       next_line == interleave == next_plane*bits_per_pixel&n;    *&n;    *    But maybe it can be merged with the code for normal bitplanes without&n;    *    much performance loss?&n;    */
DECL|function|bmove_ilbm
r_static
r_void
id|bmove_ilbm
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|sy
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|p-&gt;next_plane
)paren
id|mymemmove
c_func
(paren
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
comma
id|p-&gt;screen_base
comma
id|height
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
)paren
suffix:semicolon
r_else
(brace
id|u_char
op_star
id|src
comma
op_star
id|dest
suffix:semicolon
id|u_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dy
op_le
id|sy
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|sx
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|dx
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
op_star
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
id|mymemmove
c_func
(paren
id|dest
comma
id|src
comma
id|width
)paren
suffix:semicolon
id|src
op_add_assign
id|p-&gt;next_plane
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_plane
suffix:semicolon
)brace
)brace
r_else
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
(paren
id|sy
op_plus
id|height
)paren
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|sx
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
(paren
id|dy
op_plus
id|height
)paren
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|dx
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
op_star
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
id|src
op_sub_assign
id|p-&gt;next_plane
suffix:semicolon
id|dest
op_sub_assign
id|p-&gt;next_plane
suffix:semicolon
id|mymemmove
c_func
(paren
id|dest
comma
id|src
comma
id|width
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|clear_ilbm
r_static
r_void
id|clear_ilbm
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
id|u_int
id|i
comma
id|rows
suffix:semicolon
r_int
id|bg
comma
id|bg0
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|sx
suffix:semicolon
id|bg0
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|bg
op_assign
id|bg0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_plane
)paren
(brace
r_if
c_cond
(paren
id|bg
op_amp
l_int|1
)paren
id|mymemset
c_func
(paren
id|dest
comma
id|width
)paren
suffix:semicolon
r_else
id|mymemclear
c_func
(paren
id|dest
comma
id|width
)paren
suffix:semicolon
id|bg
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
DECL|function|putc_ilbm
r_static
r_void
id|putc_ilbm
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|cdat
suffix:semicolon
id|u_int
id|rows
comma
id|i
suffix:semicolon
id|u_char
id|d
suffix:semicolon
r_int
id|fg0
comma
id|bg0
comma
id|fg
comma
id|bg
suffix:semicolon
id|c
op_and_assign
l_int|0xff
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|x
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|p-&gt;fontheight
suffix:semicolon
id|fg0
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bg0
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|d
op_assign
op_star
id|cdat
op_increment
suffix:semicolon
id|fg
op_assign
id|fg0
suffix:semicolon
id|bg
op_assign
id|bg0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_plane
)paren
(brace
r_if
c_cond
(paren
id|bg
op_amp
l_int|1
)paren
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
id|dest
op_assign
l_int|0xff
suffix:semicolon
r_else
op_star
id|dest
op_assign
op_complement
id|d
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
id|dest
op_assign
id|d
suffix:semicolon
r_else
op_star
id|dest
op_assign
l_int|0x00
suffix:semicolon
id|bg
op_rshift_assign
l_int|1
suffix:semicolon
id|fg
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *    I split the console character loop in two parts:&n; *&n; *      - slow version: this blits one character at a time&n; *&n; *      - fast version: this blits 4 characters at a time at a longword aligned&n; *                      address, to reduce the number of expensive Chip RAM&n; *                      accesses.&n; *&n; *    Experiments on my A4000/040 revealed that this makes a console switch on a&n; *    640x400 screen with 256 colors about 3 times faster.&n; *&n; *                                                                Geert&n; */
DECL|function|putcs_ilbm
r_static
r_void
id|putcs_ilbm
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest0
comma
op_star
id|dest
comma
op_star
id|cdat1
comma
op_star
id|cdat2
comma
op_star
id|cdat3
comma
op_star
id|cdat4
suffix:semicolon
id|u_int
id|rows
comma
id|i
suffix:semicolon
id|u_char
id|c1
comma
id|c2
comma
id|c3
comma
id|c4
suffix:semicolon
id|u_long
id|d
suffix:semicolon
r_int
id|fg0
comma
id|bg0
comma
id|fg
comma
id|bg
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|x
suffix:semicolon
id|fg0
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bg0
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
r_if
c_cond
(paren
id|x
op_amp
l_int|3
op_logical_or
id|count
OL
l_int|3
)paren
(brace
multiline_comment|/* Slow version */
id|c1
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|dest
op_assign
id|dest0
op_increment
suffix:semicolon
id|x
op_increment
suffix:semicolon
id|cdat1
op_assign
id|p-&gt;fontdata
op_plus
id|c1
op_star
id|p-&gt;fontheight
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|d
op_assign
op_star
id|cdat1
op_increment
suffix:semicolon
id|fg
op_assign
id|fg0
suffix:semicolon
id|bg
op_assign
id|bg0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_plane
)paren
(brace
r_if
c_cond
(paren
id|bg
op_amp
l_int|1
)paren
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
id|dest
op_assign
l_int|0xff
suffix:semicolon
r_else
op_star
id|dest
op_assign
op_complement
id|d
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
id|dest
op_assign
id|d
suffix:semicolon
r_else
op_star
id|dest
op_assign
l_int|0x00
suffix:semicolon
id|bg
op_rshift_assign
l_int|1
suffix:semicolon
id|fg
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* Fast version */
id|c1
op_assign
id|s
(braket
l_int|0
)braket
suffix:semicolon
id|c2
op_assign
id|s
(braket
l_int|1
)braket
suffix:semicolon
id|c3
op_assign
id|s
(braket
l_int|2
)braket
suffix:semicolon
id|c4
op_assign
id|s
(braket
l_int|3
)braket
suffix:semicolon
id|dest
op_assign
id|dest0
suffix:semicolon
id|cdat1
op_assign
id|p-&gt;fontdata
op_plus
id|c1
op_star
id|p-&gt;fontheight
suffix:semicolon
id|cdat2
op_assign
id|p-&gt;fontdata
op_plus
id|c2
op_star
id|p-&gt;fontheight
suffix:semicolon
id|cdat3
op_assign
id|p-&gt;fontdata
op_plus
id|c3
op_star
id|p-&gt;fontheight
suffix:semicolon
id|cdat4
op_assign
id|p-&gt;fontdata
op_plus
id|c4
op_star
id|p-&gt;fontheight
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|d
op_assign
op_star
id|cdat1
op_increment
op_lshift
l_int|24
op_or
op_star
id|cdat2
op_increment
op_lshift
l_int|16
op_or
op_star
id|cdat3
op_increment
op_lshift
l_int|8
op_or
op_star
id|cdat4
op_increment
suffix:semicolon
id|fg
op_assign
id|fg0
suffix:semicolon
id|bg
op_assign
id|bg0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_plane
)paren
(brace
r_if
c_cond
(paren
id|bg
op_amp
l_int|1
)paren
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
(paren
id|u_long
op_star
)paren
id|dest
op_assign
l_int|0xffffffff
suffix:semicolon
r_else
op_star
(paren
id|u_long
op_star
)paren
id|dest
op_assign
op_complement
id|d
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
(paren
id|u_long
op_star
)paren
id|dest
op_assign
id|d
suffix:semicolon
r_else
op_star
(paren
id|u_long
op_star
)paren
id|dest
op_assign
l_int|0x00000000
suffix:semicolon
id|bg
op_rshift_assign
l_int|1
suffix:semicolon
id|fg
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
id|s
op_add_assign
l_int|4
suffix:semicolon
id|dest0
op_add_assign
l_int|4
suffix:semicolon
id|x
op_add_assign
l_int|4
suffix:semicolon
id|count
op_sub_assign
l_int|3
suffix:semicolon
)brace
)brace
DECL|function|rev_char_ilbm
r_static
r_void
id|rev_char_ilbm
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|dest0
suffix:semicolon
id|u_int
id|rows
comma
id|i
suffix:semicolon
r_int
id|mask
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|x
suffix:semicolon
id|mask
op_assign
id|p-&gt;fgcol
op_xor
id|p-&gt;bgcol
suffix:semicolon
multiline_comment|/*&n;    *    This should really obey the individual character&squot;s&n;    *    background and foreground colors instead of simply&n;    *    inverting.&n;    */
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|dest0
op_add_assign
id|p-&gt;next_plane
)paren
(brace
r_if
c_cond
(paren
id|mask
op_amp
l_int|1
)paren
(brace
id|dest
op_assign
id|dest0
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
op_star
id|dest
op_assign
op_complement
op_star
id|dest
suffix:semicolon
)brace
id|mask
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FBCON_ILBM */
multiline_comment|/* ====================================================================== */
macro_line|#ifdef CONFIG_FBCON_PLANES
multiline_comment|/*&n;    *    Color Planes&n;    */
DECL|function|bmove_plan
r_static
r_void
id|bmove_plan
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_char
op_star
id|src
comma
op_star
id|dest
comma
op_star
id|src0
comma
op_star
id|dest0
suffix:semicolon
id|u_int
id|i
comma
id|rows
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|sy
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|p-&gt;next_line
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;fontheight
op_star
id|width
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
id|mymemmove
c_func
(paren
id|dest
comma
id|src
comma
id|height
op_star
id|p-&gt;fontheight
op_star
id|width
)paren
suffix:semicolon
id|src
op_add_assign
id|p-&gt;next_plane
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_plane
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|dy
op_le
id|sy
)paren
(brace
id|src0
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|sx
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|dx
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
id|src
op_assign
id|src0
suffix:semicolon
id|dest
op_assign
id|dest0
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|mymemmove
c_func
(paren
id|dest
comma
id|src
comma
id|width
)paren
suffix:semicolon
id|src
op_add_assign
id|p-&gt;next_line
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
suffix:semicolon
)brace
id|src0
op_add_assign
id|p-&gt;next_plane
suffix:semicolon
id|dest0
op_add_assign
id|p-&gt;next_plane
suffix:semicolon
)brace
)brace
r_else
(brace
id|src0
op_assign
id|p-&gt;screen_base
op_plus
(paren
id|sy
op_plus
id|height
)paren
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|sx
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
(paren
id|dy
op_plus
id|height
)paren
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|dx
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
)paren
(brace
id|src
op_assign
id|src0
suffix:semicolon
id|dest
op_assign
id|dest0
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|src
op_sub_assign
id|p-&gt;next_line
suffix:semicolon
id|dest
op_sub_assign
id|p-&gt;next_line
suffix:semicolon
id|mymemmove
c_func
(paren
id|dest
comma
id|src
comma
id|width
)paren
suffix:semicolon
)brace
id|src0
op_add_assign
id|p-&gt;next_plane
suffix:semicolon
id|dest0
op_add_assign
id|p-&gt;next_plane
suffix:semicolon
)brace
)brace
)brace
DECL|function|clear_plan
r_static
r_void
id|clear_plan
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|dest0
suffix:semicolon
id|u_int
id|i
comma
id|rows
suffix:semicolon
r_int
id|bg
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|sx
suffix:semicolon
id|bg
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|dest0
op_add_assign
id|p-&gt;next_plane
)paren
(brace
id|dest
op_assign
id|dest0
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
r_if
c_cond
(paren
id|bg
op_amp
l_int|1
)paren
id|mymemset
c_func
(paren
id|dest
comma
id|width
)paren
suffix:semicolon
r_else
id|mymemclear
c_func
(paren
id|dest
comma
id|width
)paren
suffix:semicolon
id|bg
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|putc_plan
r_static
r_void
id|putc_plan
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|dest0
comma
op_star
id|cdat
comma
op_star
id|cdat0
suffix:semicolon
id|u_int
id|rows
comma
id|i
suffix:semicolon
id|u_char
id|d
suffix:semicolon
r_int
id|fg
comma
id|bg
suffix:semicolon
id|c
op_and_assign
l_int|0xff
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|x
suffix:semicolon
id|cdat0
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|p-&gt;fontheight
suffix:semicolon
id|fg
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bg
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|dest0
op_add_assign
id|p-&gt;next_plane
)paren
(brace
id|dest
op_assign
id|dest0
suffix:semicolon
id|cdat
op_assign
id|cdat0
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
(brace
id|d
op_assign
op_star
id|cdat
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|bg
op_amp
l_int|1
)paren
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
id|dest
op_assign
l_int|0xff
suffix:semicolon
r_else
op_star
id|dest
op_assign
op_complement
id|d
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
id|dest
op_assign
id|d
suffix:semicolon
r_else
op_star
id|dest
op_assign
l_int|0x00
suffix:semicolon
)brace
id|bg
op_rshift_assign
l_int|1
suffix:semicolon
id|fg
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *    I split the console character loop in two parts&n; *    (cfr. fbcon_putcs_ilbm())&n; */
DECL|function|putcs_plan
r_static
r_void
id|putcs_plan
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|dest0
comma
op_star
id|dest1
suffix:semicolon
id|u_char
op_star
id|cdat1
comma
op_star
id|cdat2
comma
op_star
id|cdat3
comma
op_star
id|cdat4
comma
op_star
id|cdat10
comma
op_star
id|cdat20
comma
op_star
id|cdat30
comma
op_star
id|cdat40
suffix:semicolon
id|u_int
id|rows
comma
id|i
suffix:semicolon
id|u_char
id|c1
comma
id|c2
comma
id|c3
comma
id|c4
suffix:semicolon
id|u_long
id|d
suffix:semicolon
r_int
id|fg0
comma
id|bg0
comma
id|fg
comma
id|bg
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|x
suffix:semicolon
id|fg0
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bg0
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
r_if
c_cond
(paren
id|x
op_amp
l_int|3
op_logical_or
id|count
OL
l_int|3
)paren
(brace
multiline_comment|/* Slow version */
id|c1
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|dest1
op_assign
id|dest0
op_increment
suffix:semicolon
id|x
op_increment
suffix:semicolon
id|cdat10
op_assign
id|p-&gt;fontdata
op_plus
id|c1
op_star
id|p-&gt;fontheight
suffix:semicolon
id|fg
op_assign
id|fg0
suffix:semicolon
id|bg
op_assign
id|bg0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|dest1
op_add_assign
id|p-&gt;next_plane
)paren
(brace
id|dest
op_assign
id|dest1
suffix:semicolon
id|cdat1
op_assign
id|cdat10
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
(brace
id|d
op_assign
op_star
id|cdat1
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|bg
op_amp
l_int|1
)paren
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
id|dest
op_assign
l_int|0xff
suffix:semicolon
r_else
op_star
id|dest
op_assign
op_complement
id|d
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
id|dest
op_assign
id|d
suffix:semicolon
r_else
op_star
id|dest
op_assign
l_int|0x00
suffix:semicolon
)brace
id|bg
op_rshift_assign
l_int|1
suffix:semicolon
id|fg
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Fast version */
id|c1
op_assign
id|s
(braket
l_int|0
)braket
suffix:semicolon
id|c2
op_assign
id|s
(braket
l_int|1
)braket
suffix:semicolon
id|c3
op_assign
id|s
(braket
l_int|2
)braket
suffix:semicolon
id|c4
op_assign
id|s
(braket
l_int|3
)braket
suffix:semicolon
id|dest1
op_assign
id|dest0
suffix:semicolon
id|cdat10
op_assign
id|p-&gt;fontdata
op_plus
id|c1
op_star
id|p-&gt;fontheight
suffix:semicolon
id|cdat20
op_assign
id|p-&gt;fontdata
op_plus
id|c2
op_star
id|p-&gt;fontheight
suffix:semicolon
id|cdat30
op_assign
id|p-&gt;fontdata
op_plus
id|c3
op_star
id|p-&gt;fontheight
suffix:semicolon
id|cdat40
op_assign
id|p-&gt;fontdata
op_plus
id|c4
op_star
id|p-&gt;fontheight
suffix:semicolon
id|fg
op_assign
id|fg0
suffix:semicolon
id|bg
op_assign
id|bg0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|dest1
op_add_assign
id|p-&gt;next_plane
)paren
(brace
id|dest
op_assign
id|dest1
suffix:semicolon
id|cdat1
op_assign
id|cdat10
suffix:semicolon
id|cdat2
op_assign
id|cdat20
suffix:semicolon
id|cdat3
op_assign
id|cdat30
suffix:semicolon
id|cdat4
op_assign
id|cdat40
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
(brace
id|d
op_assign
op_star
id|cdat1
op_increment
op_lshift
l_int|24
op_or
op_star
id|cdat2
op_increment
op_lshift
l_int|16
op_or
op_star
id|cdat3
op_increment
op_lshift
l_int|8
op_or
op_star
id|cdat4
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|bg
op_amp
l_int|1
)paren
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
(paren
id|u_long
op_star
)paren
id|dest
op_assign
l_int|0xffffffff
suffix:semicolon
r_else
op_star
(paren
id|u_long
op_star
)paren
id|dest
op_assign
op_complement
id|d
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fg
op_amp
l_int|1
)paren
op_star
(paren
id|u_long
op_star
)paren
id|dest
op_assign
id|d
suffix:semicolon
r_else
op_star
(paren
id|u_long
op_star
)paren
id|dest
op_assign
l_int|0x00000000
suffix:semicolon
)brace
id|bg
op_rshift_assign
l_int|1
suffix:semicolon
id|fg
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|s
op_add_assign
l_int|4
suffix:semicolon
id|dest0
op_add_assign
l_int|4
suffix:semicolon
id|x
op_add_assign
l_int|4
suffix:semicolon
id|count
op_sub_assign
l_int|3
suffix:semicolon
)brace
)brace
DECL|function|rev_char_plan
r_static
r_void
id|rev_char_plan
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|dest0
suffix:semicolon
id|u_int
id|rows
comma
id|i
suffix:semicolon
r_int
id|mask
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
id|x
suffix:semicolon
id|mask
op_assign
id|p-&gt;fgcol
op_xor
id|p-&gt;bgcol
suffix:semicolon
multiline_comment|/*&n;    *    This should really obey the individual character&squot;s&n;    *    background and foreground colors instead of simply&n;    *    inverting.&n;    */
r_for
c_loop
(paren
id|i
op_assign
id|p-&gt;var.bits_per_pixel
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|dest0
op_add_assign
id|p-&gt;next_plane
)paren
(brace
r_if
c_cond
(paren
id|mask
op_amp
l_int|1
)paren
(brace
id|dest
op_assign
id|dest0
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
op_star
id|dest
op_assign
op_complement
op_star
id|dest
suffix:semicolon
)brace
id|mask
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FBCON_PLANES */
multiline_comment|/* ====================================================================== */
macro_line|#ifdef CONFIG_FBCON_2PLANE
multiline_comment|/*&n;    *    2 Planes (2-bytes interleave)&n;    */
multiline_comment|/* Increment/decrement 2 plane addresses */
DECL|macro|INC_2P
mdefine_line|#define&t;INC_2P(p)&t;do { if (!((long)(++(p)) &amp; 1)) (p) += 2; } while(0)
DECL|macro|DEC_2P
mdefine_line|#define&t;DEC_2P(p)&t;do { if ((long)(--(p)) &amp; 1) (p) -= 2; } while(0)
multiline_comment|/* Convert a standard 4 bit color to our 2 bit color assignment:&n; * If at least two RGB channels are active, the low bit is turned on;&n; * The intensity bit (b3) is shifted into b1.&n; */
DECL|macro|COLOR_2P
mdefine_line|#define&t;COLOR_2P(c)&t;(((c &amp; 7) &gt;= 3 &amp;&amp; (c &amp; 7) != 4) | (c &amp; 8) &gt;&gt; 2)
DECL|function|bmove_2_plane
r_static
r_void
id|bmove_2_plane
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
multiline_comment|/* bmove() has to distinguish two major cases: If both, source and&n;&t; * destination, start at even addresses or both are at odd&n;&t; * addresses, just the first odd and last even column (if present)&n;&t; * require special treatment (memmove_col()). The rest between&n;&t; * then can be copied by normal operations, because all adjacent&n;&t; * bytes are affected and are to be stored in the same order.&n;&t; *   The pathological case is when the move should go from an odd&n;&t; * address to an even or vice versa. Since the bytes in the plane&n;&t; * words must be assembled in new order, it seems wisest to make&n;&t; * all movements by memmove_col().&n;&t; */
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|dx
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|p-&gt;next_line
op_div
l_int|2
)paren
(brace
multiline_comment|/* Special (but often used) case: Moving whole lines can be&n;&t;&t; * done with memmove()&n;&t;&t; */
id|mymemmove
c_func
(paren
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;next_line
op_star
id|p-&gt;fontheight
comma
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;next_line
op_star
id|p-&gt;fontheight
comma
id|p-&gt;next_line
op_star
id|height
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|rows
comma
id|cols
suffix:semicolon
id|u_char
op_star
id|src
suffix:semicolon
id|u_char
op_star
id|dst
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
r_int
id|linesize
op_assign
id|bytes
op_star
id|p-&gt;fontheight
suffix:semicolon
id|u_int
id|colsize
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|u_int
id|upwards
op_assign
(paren
id|dy
OL
id|sy
)paren
op_logical_or
(paren
id|dy
op_eq
id|sy
op_logical_and
id|dx
OL
id|sx
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sx
op_amp
l_int|1
)paren
op_eq
(paren
id|dx
op_amp
l_int|1
)paren
)paren
(brace
multiline_comment|/* odd-&gt;odd or even-&gt;even */
r_if
c_cond
(paren
id|upwards
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_amp
l_int|1
)paren
(brace
id|memmove_2p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
id|src
op_add_assign
l_int|3
suffix:semicolon
id|dst
op_add_assign
l_int|3
suffix:semicolon
op_decrement
id|width
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
OG
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|rows
op_assign
id|colsize
suffix:semicolon
id|rows
OG
l_int|0
suffix:semicolon
op_decrement
id|rows
)paren
(brace
id|mymemmove
c_func
(paren
id|dst
comma
id|src
comma
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|4
)paren
suffix:semicolon
id|src
op_add_assign
id|bytes
suffix:semicolon
id|dst
op_add_assign
id|bytes
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|src
op_sub_assign
id|colsize
op_star
id|bytes
suffix:semicolon
id|dst
op_sub_assign
id|colsize
op_star
id|bytes
suffix:semicolon
id|memmove_2p_col
c_func
(paren
id|dst
op_plus
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|4
comma
id|src
op_plus
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|4
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|sx
op_plus
id|width
op_minus
l_int|1
)paren
op_amp
l_int|1
)paren
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
(paren
id|sx
op_plus
id|width
op_minus
l_int|1
)paren
op_rshift
l_int|1
)paren
op_star
l_int|4
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
(paren
id|dx
op_plus
id|width
op_minus
l_int|1
)paren
op_rshift
l_int|1
)paren
op_star
l_int|4
suffix:semicolon
id|memmove_2p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
op_decrement
id|width
suffix:semicolon
)brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|width
OG
l_int|1
)paren
(brace
id|src
op_add_assign
id|colsize
op_star
id|bytes
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
op_star
l_int|3
suffix:semicolon
id|dst
op_add_assign
id|colsize
op_star
id|bytes
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
op_star
l_int|3
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|colsize
suffix:semicolon
id|rows
OG
l_int|0
suffix:semicolon
op_decrement
id|rows
)paren
(brace
id|src
op_sub_assign
id|bytes
suffix:semicolon
id|dst
op_sub_assign
id|bytes
suffix:semicolon
id|mymemmove
c_func
(paren
id|dst
comma
id|src
comma
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|4
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|memmove_2p_col
c_func
(paren
id|dst
op_minus
l_int|3
comma
id|src
op_minus
l_int|3
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* odd-&gt;even or even-&gt;odd */
r_if
c_cond
(paren
id|upwards
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cols
op_assign
id|width
suffix:semicolon
id|cols
OG
l_int|0
suffix:semicolon
op_decrement
id|cols
)paren
(brace
id|memmove_2p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
id|INC_2P
c_func
(paren
id|src
)paren
suffix:semicolon
id|INC_2P
c_func
(paren
id|dst
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|sx
op_add_assign
id|width
op_minus
l_int|1
suffix:semicolon
id|dx
op_add_assign
id|width
op_minus
l_int|1
suffix:semicolon
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cols
op_assign
id|width
suffix:semicolon
id|cols
OG
l_int|0
suffix:semicolon
op_decrement
id|cols
)paren
(brace
id|memmove_2p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
id|DEC_2P
c_func
(paren
id|src
)paren
suffix:semicolon
id|DEC_2P
c_func
(paren
id|dst
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|function|clear_2_plane
r_static
r_void
id|clear_2_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|ulong
id|offset
suffix:semicolon
id|u_char
op_star
id|start
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
r_int
id|lines
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|ulong
id|size
suffix:semicolon
id|u_long
id|cval
suffix:semicolon
id|u_short
id|pcval
suffix:semicolon
id|cval
op_assign
id|expand2l
(paren
id|COLOR_2P
(paren
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|bytes
op_div
l_int|2
)paren
(brace
id|offset
op_assign
id|sy
op_star
id|bytes
op_star
id|p-&gt;fontheight
suffix:semicolon
id|size
op_assign
id|lines
op_star
id|bytes
suffix:semicolon
id|memset_even_2p
c_func
(paren
id|p-&gt;screen_base
op_plus
id|offset
comma
id|size
comma
id|cval
)paren
suffix:semicolon
)brace
r_else
(brace
id|offset
op_assign
(paren
id|sy
op_star
id|bytes
op_star
id|p-&gt;fontheight
)paren
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|start
op_assign
id|p-&gt;screen_base
op_plus
id|offset
suffix:semicolon
id|pcval
op_assign
id|expand2w
c_func
(paren
id|COLOR_2P
c_func
(paren
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Clears are split if the region starts at an odd column or&n;&t;&t; * end at an even column. These extra columns are spread&n;&t;&t; * across the interleaved planes. All in between can be&n;&t;&t; * cleared by normal mymemclear_small(), because both bytes of&n;&t;&t; * the single plane words are affected.&n;&t;&t; */
r_if
c_cond
(paren
id|sx
op_amp
l_int|1
)paren
(brace
id|memclear_2p_col
c_func
(paren
id|start
comma
id|lines
comma
id|pcval
comma
id|bytes
)paren
suffix:semicolon
id|start
op_add_assign
l_int|3
suffix:semicolon
id|width
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|memclear_2p_col
c_func
(paren
id|start
op_plus
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|4
comma
id|lines
comma
id|pcval
comma
id|bytes
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
)paren
(brace
r_for
c_loop
(paren
id|rows
op_assign
id|lines
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|start
op_add_assign
id|bytes
)paren
(brace
id|memset_even_2p
c_func
(paren
id|start
comma
id|width
op_star
l_int|2
comma
id|cval
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|putc_2_plane
r_static
r_void
id|putc_2_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
id|u_char
op_star
id|cdat
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
id|ulong
id|eorx
comma
id|fgx
comma
id|bgx
comma
id|fdx
suffix:semicolon
id|c
op_and_assign
l_int|0xff
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
(paren
id|x
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|x
op_amp
l_int|1
)paren
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
id|fgx
op_assign
id|expand2w
c_func
(paren
id|COLOR_2P
c_func
(paren
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
)paren
)paren
suffix:semicolon
id|bgx
op_assign
id|expand2w
c_func
(paren
id|COLOR_2P
c_func
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
)paren
)paren
suffix:semicolon
id|eorx
op_assign
id|fgx
op_xor
id|bgx
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
id|fdx
op_assign
id|dup2w
c_func
(paren
op_star
id|cdat
op_increment
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;movepw %1,%0@(0)&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;a&quot;
(paren
id|dest
)paren
comma
l_string|&quot;d&quot;
(paren
(paren
id|fdx
op_amp
id|eorx
)paren
op_xor
id|bgx
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|putcs_2_plane
r_static
r_void
id|putcs_2_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|dest0
suffix:semicolon
id|u_char
op_star
id|cdat
comma
id|c
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_int
id|bytes
suffix:semicolon
id|ulong
id|eorx
comma
id|fgx
comma
id|bgx
comma
id|fdx
suffix:semicolon
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
(paren
id|x
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|x
op_amp
l_int|1
)paren
suffix:semicolon
id|fgx
op_assign
id|expand2w
c_func
(paren
id|COLOR_2P
c_func
(paren
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
)paren
)paren
suffix:semicolon
id|bgx
op_assign
id|expand2w
c_func
(paren
id|COLOR_2P
c_func
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
)paren
)paren
suffix:semicolon
id|eorx
op_assign
id|fgx
op_xor
id|bgx
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|c
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
comma
id|dest
op_assign
id|dest0
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
id|fdx
op_assign
id|dup2w
c_func
(paren
op_star
id|cdat
op_increment
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;movepw %1,%0@(0)&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;a&quot;
(paren
id|dest
)paren
comma
l_string|&quot;d&quot;
(paren
(paren
id|fdx
op_amp
id|eorx
)paren
op_xor
id|bgx
)paren
)paren
suffix:semicolon
)brace
id|INC_2P
c_func
(paren
id|dest0
)paren
suffix:semicolon
)brace
)brace
DECL|function|rev_char_2_plane
r_static
r_void
id|rev_char_2_plane
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
r_int
id|j
suffix:semicolon
r_int
id|bytes
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
(paren
id|x
op_rshift
l_int|1
)paren
op_star
l_int|4
op_plus
(paren
id|x
op_amp
l_int|1
)paren
suffix:semicolon
id|j
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
r_while
c_loop
(paren
id|j
op_decrement
)paren
(brace
multiline_comment|/* This should really obey the individual character&squot;s&n;       * background and foreground colors instead of simply&n;       * inverting.&n;       */
id|dest
(braket
l_int|0
)braket
op_assign
op_complement
id|dest
(braket
l_int|0
)braket
suffix:semicolon
id|dest
(braket
l_int|2
)braket
op_assign
op_complement
id|dest
(braket
l_int|2
)braket
suffix:semicolon
id|dest
op_add_assign
id|bytes
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FBCON_2PLANE */
multiline_comment|/* ====================================================================== */
macro_line|#ifdef CONFIG_FBCON_4PLANE
multiline_comment|/*&n;    *    4 Planes (2-bytes interleave)&n;    */
multiline_comment|/* Increment/decrement 4 plane addresses */
DECL|macro|INC_4P
mdefine_line|#define&t;INC_4P(p)&t;do { if (!((long)(++(p)) &amp; 1)) (p) += 6; } while(0)
DECL|macro|DEC_4P
mdefine_line|#define&t;DEC_4P(p)&t;do { if ((long)(--(p)) &amp; 1) (p) -= 6; } while(0)
DECL|function|bmove_4_plane
r_static
r_void
id|bmove_4_plane
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
multiline_comment|/* bmove() has to distinguish two major cases: If both, source and&n;&t; * destination, start at even addresses or both are at odd&n;&t; * addresses, just the first odd and last even column (if present)&n;&t; * require special treatment (memmove_col()). The rest between&n;&t; * then can be copied by normal operations, because all adjacent&n;&t; * bytes are affected and are to be stored in the same order.&n;&t; *   The pathological case is when the move should go from an odd&n;&t; * address to an even or vice versa. Since the bytes in the plane&n;&t; * words must be assembled in new order, it seems wisest to make&n;&t; * all movements by memmove_col().&n;&t; */
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|dx
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|p-&gt;next_line
op_div
l_int|4
)paren
(brace
multiline_comment|/* Special (but often used) case: Moving whole lines can be&n;&t;&t; * done with memmove()&n;&t;&t; */
id|mymemmove
c_func
(paren
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;next_line
op_star
id|p-&gt;fontheight
comma
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;next_line
op_star
id|p-&gt;fontheight
comma
id|p-&gt;next_line
op_star
id|height
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|rows
comma
id|cols
suffix:semicolon
id|u_char
op_star
id|src
suffix:semicolon
id|u_char
op_star
id|dst
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
r_int
id|linesize
op_assign
id|bytes
op_star
id|p-&gt;fontheight
suffix:semicolon
id|u_int
id|colsize
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|u_int
id|upwards
op_assign
(paren
id|dy
OL
id|sy
)paren
op_logical_or
(paren
id|dy
op_eq
id|sy
op_logical_and
id|dx
OL
id|sx
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sx
op_amp
l_int|1
)paren
op_eq
(paren
id|dx
op_amp
l_int|1
)paren
)paren
(brace
multiline_comment|/* odd-&gt;odd or even-&gt;even */
r_if
c_cond
(paren
id|upwards
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_amp
l_int|1
)paren
(brace
id|memmove_4p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
id|src
op_add_assign
l_int|7
suffix:semicolon
id|dst
op_add_assign
l_int|7
suffix:semicolon
op_decrement
id|width
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
OG
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|rows
op_assign
id|colsize
suffix:semicolon
id|rows
OG
l_int|0
suffix:semicolon
op_decrement
id|rows
)paren
(brace
id|mymemmove
c_func
(paren
id|dst
comma
id|src
comma
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|8
)paren
suffix:semicolon
id|src
op_add_assign
id|bytes
suffix:semicolon
id|dst
op_add_assign
id|bytes
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|src
op_sub_assign
id|colsize
op_star
id|bytes
suffix:semicolon
id|dst
op_sub_assign
id|colsize
op_star
id|bytes
suffix:semicolon
id|memmove_4p_col
c_func
(paren
id|dst
op_plus
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|8
comma
id|src
op_plus
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|8
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|sx
op_plus
id|width
op_minus
l_int|1
)paren
op_amp
l_int|1
)paren
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
(paren
id|sx
op_plus
id|width
op_minus
l_int|1
)paren
op_rshift
l_int|1
)paren
op_star
l_int|8
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
(paren
id|dx
op_plus
id|width
op_minus
l_int|1
)paren
op_rshift
l_int|1
)paren
op_star
l_int|8
suffix:semicolon
id|memmove_4p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
op_decrement
id|width
suffix:semicolon
)brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|width
OG
l_int|1
)paren
(brace
id|src
op_add_assign
id|colsize
op_star
id|bytes
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
op_star
l_int|7
suffix:semicolon
id|dst
op_add_assign
id|colsize
op_star
id|bytes
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
op_star
l_int|7
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|colsize
suffix:semicolon
id|rows
OG
l_int|0
suffix:semicolon
op_decrement
id|rows
)paren
(brace
id|src
op_sub_assign
id|bytes
suffix:semicolon
id|dst
op_sub_assign
id|bytes
suffix:semicolon
id|mymemmove
c_func
(paren
id|dst
comma
id|src
comma
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|8
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|memmove_4p_col
c_func
(paren
id|dst
op_minus
l_int|7
comma
id|src
op_minus
l_int|7
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* odd-&gt;even or even-&gt;odd */
r_if
c_cond
(paren
id|upwards
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cols
op_assign
id|width
suffix:semicolon
id|cols
OG
l_int|0
suffix:semicolon
op_decrement
id|cols
)paren
(brace
id|memmove_4p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
id|INC_4P
c_func
(paren
id|src
)paren
suffix:semicolon
id|INC_4P
c_func
(paren
id|dst
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|sx
op_add_assign
id|width
op_minus
l_int|1
suffix:semicolon
id|dx
op_add_assign
id|width
op_minus
l_int|1
suffix:semicolon
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cols
op_assign
id|width
suffix:semicolon
id|cols
OG
l_int|0
suffix:semicolon
op_decrement
id|cols
)paren
(brace
id|memmove_4p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
id|DEC_4P
c_func
(paren
id|src
)paren
suffix:semicolon
id|DEC_4P
c_func
(paren
id|dst
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|function|clear_4_plane
r_static
r_void
id|clear_4_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|ulong
id|offset
suffix:semicolon
id|u_char
op_star
id|start
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
r_int
id|lines
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|ulong
id|size
suffix:semicolon
id|u_long
id|cval1
comma
id|cval2
comma
id|pcval
suffix:semicolon
id|expand4dl
c_func
(paren
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
comma
op_amp
id|cval1
comma
op_amp
id|cval2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|bytes
op_div
l_int|4
)paren
(brace
id|offset
op_assign
id|sy
op_star
id|bytes
op_star
id|p-&gt;fontheight
suffix:semicolon
id|size
op_assign
id|lines
op_star
id|bytes
suffix:semicolon
id|memset_even_4p
c_func
(paren
id|p-&gt;screen_base
op_plus
id|offset
comma
id|size
comma
id|cval1
comma
id|cval2
)paren
suffix:semicolon
)brace
r_else
(brace
id|offset
op_assign
(paren
id|sy
op_star
id|bytes
op_star
id|p-&gt;fontheight
)paren
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|start
op_assign
id|p-&gt;screen_base
op_plus
id|offset
suffix:semicolon
id|pcval
op_assign
id|expand4l
c_func
(paren
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
)paren
suffix:semicolon
multiline_comment|/* Clears are split if the region starts at an odd column or&n;&t;&t; * end at an even column. These extra columns are spread&n;&t;&t; * across the interleaved planes. All in between can be&n;&t;&t; * cleared by normal mymemclear_small(), because both bytes of&n;&t;&t; * the single plane words are affected.&n;&t;&t; */
r_if
c_cond
(paren
id|sx
op_amp
l_int|1
)paren
(brace
id|memclear_4p_col
c_func
(paren
id|start
comma
id|lines
comma
id|pcval
comma
id|bytes
)paren
suffix:semicolon
id|start
op_add_assign
l_int|7
suffix:semicolon
id|width
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|memclear_4p_col
c_func
(paren
id|start
op_plus
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|8
comma
id|lines
comma
id|pcval
comma
id|bytes
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
)paren
(brace
r_for
c_loop
(paren
id|rows
op_assign
id|lines
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|start
op_add_assign
id|bytes
)paren
(brace
id|memset_even_4p
c_func
(paren
id|start
comma
id|width
op_star
l_int|4
comma
id|cval1
comma
id|cval2
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|putc_4_plane
r_static
r_void
id|putc_4_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
id|u_char
op_star
id|cdat
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
id|ulong
id|eorx
comma
id|fgx
comma
id|bgx
comma
id|fdx
suffix:semicolon
id|c
op_and_assign
l_int|0xff
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
(paren
id|x
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|x
op_amp
l_int|1
)paren
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
id|fgx
op_assign
id|expand4l
c_func
(paren
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
)paren
suffix:semicolon
id|bgx
op_assign
id|expand4l
c_func
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
)paren
suffix:semicolon
id|eorx
op_assign
id|fgx
op_xor
id|bgx
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
id|fdx
op_assign
id|dup4l
c_func
(paren
op_star
id|cdat
op_increment
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;movepl %1,%0@(0)&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;a&quot;
(paren
id|dest
)paren
comma
l_string|&quot;d&quot;
(paren
(paren
id|fdx
op_amp
id|eorx
)paren
op_xor
id|bgx
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|putcs_4_plane
r_static
r_void
id|putcs_4_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|dest0
suffix:semicolon
id|u_char
op_star
id|cdat
comma
id|c
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_int
id|bytes
suffix:semicolon
id|ulong
id|eorx
comma
id|fgx
comma
id|bgx
comma
id|fdx
suffix:semicolon
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
(paren
id|x
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|x
op_amp
l_int|1
)paren
suffix:semicolon
id|fgx
op_assign
id|expand4l
c_func
(paren
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
)paren
suffix:semicolon
id|bgx
op_assign
id|expand4l
c_func
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
)paren
suffix:semicolon
id|eorx
op_assign
id|fgx
op_xor
id|bgx
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
multiline_comment|/* I think, unrolling the loops like in the 1 plane case isn&squot;t&n;&t;&t; * practicable here, because the body is much longer for 4&n;&t;&t; * planes (mostly the dup4l()). I guess, unrolling this would&n;&t;&t; * need more than 256 bytes and so exceed the instruction&n;&t;&t; * cache :-(&n;&t;&t; */
id|c
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
comma
id|dest
op_assign
id|dest0
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
id|fdx
op_assign
id|dup4l
c_func
(paren
op_star
id|cdat
op_increment
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;movepl %1,%0@(0)&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;a&quot;
(paren
id|dest
)paren
comma
l_string|&quot;d&quot;
(paren
(paren
id|fdx
op_amp
id|eorx
)paren
op_xor
id|bgx
)paren
)paren
suffix:semicolon
)brace
id|INC_4P
c_func
(paren
id|dest0
)paren
suffix:semicolon
)brace
)brace
DECL|function|rev_char_4_plane
r_static
r_void
id|rev_char_4_plane
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
r_int
id|j
suffix:semicolon
r_int
id|bytes
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
(paren
id|x
op_rshift
l_int|1
)paren
op_star
l_int|8
op_plus
(paren
id|x
op_amp
l_int|1
)paren
suffix:semicolon
id|j
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
r_while
c_loop
(paren
id|j
op_decrement
)paren
(brace
multiline_comment|/* This should really obey the individual character&squot;s&n;       * background and foreground colors instead of simply&n;       * inverting.&n;       */
id|dest
(braket
l_int|0
)braket
op_assign
op_complement
id|dest
(braket
l_int|0
)braket
suffix:semicolon
id|dest
(braket
l_int|2
)braket
op_assign
op_complement
id|dest
(braket
l_int|2
)braket
suffix:semicolon
id|dest
(braket
l_int|4
)braket
op_assign
op_complement
id|dest
(braket
l_int|4
)braket
suffix:semicolon
id|dest
(braket
l_int|6
)braket
op_assign
op_complement
id|dest
(braket
l_int|6
)braket
suffix:semicolon
id|dest
op_add_assign
id|bytes
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FBCON_4PLANE */
multiline_comment|/* ====================================================================== */
macro_line|#ifdef CONFIG_FBCON_8PLANE
multiline_comment|/*&n;    *    8 Planes (2-bytes interleave)&n;    */
multiline_comment|/* In 8 plane mode, 256 colors would be possible, but only the first&n; * 16 are used by the console code (the upper 4 bits are&n; * background/unused). For that, the following functions mask off the&n; * higher 4 bits of each color.&n; */
multiline_comment|/* Increment/decrement 8 plane addresses */
DECL|macro|INC_8P
mdefine_line|#define&t;INC_8P(p)&t;do { if (!((long)(++(p)) &amp; 1)) (p) += 14; } while(0)
DECL|macro|DEC_8P
mdefine_line|#define&t;DEC_8P(p)&t;do { if ((long)(--(p)) &amp; 1) (p) -= 14; } while(0)
DECL|function|bmove_8_plane
r_static
r_void
id|bmove_8_plane
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
multiline_comment|/* bmove() has to distinguish two major cases: If both, source and&n;&t; * destination, start at even addresses or both are at odd&n;&t; * addresses, just the first odd and last even column (if present)&n;&t; * require special treatment (memmove_col()). The rest between&n;&t; * then can be copied by normal operations, because all adjacent&n;&t; * bytes are affected and are to be stored in the same order.&n;&t; *   The pathological case is when the move should go from an odd&n;&t; * address to an even or vice versa. Since the bytes in the plane&n;&t; * words must be assembled in new order, it seems wisest to make&n;&t; * all movements by memmove_col().&n;&t; */
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|dx
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|p-&gt;next_line
op_div
l_int|8
)paren
(brace
multiline_comment|/* Special (but often used) case: Moving whole lines can be&n;&t;&t; * done with memmove()&n;&t;&t; */
id|fast_memmove
(paren
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|p-&gt;next_line
op_star
id|p-&gt;fontheight
comma
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;next_line
op_star
id|p-&gt;fontheight
comma
id|p-&gt;next_line
op_star
id|height
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|rows
comma
id|cols
suffix:semicolon
id|u_char
op_star
id|src
suffix:semicolon
id|u_char
op_star
id|dst
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
r_int
id|linesize
op_assign
id|bytes
op_star
id|p-&gt;fontheight
suffix:semicolon
id|u_int
id|colsize
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|u_int
id|upwards
op_assign
(paren
id|dy
OL
id|sy
)paren
op_logical_or
(paren
id|dy
op_eq
id|sy
op_logical_and
id|dx
OL
id|sx
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sx
op_amp
l_int|1
)paren
op_eq
(paren
id|dx
op_amp
l_int|1
)paren
)paren
(brace
multiline_comment|/* odd-&gt;odd or even-&gt;even */
r_if
c_cond
(paren
id|upwards
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_amp
l_int|1
)paren
(brace
id|memmove_8p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
id|src
op_add_assign
l_int|15
suffix:semicolon
id|dst
op_add_assign
l_int|15
suffix:semicolon
op_decrement
id|width
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
OG
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|rows
op_assign
id|colsize
suffix:semicolon
id|rows
OG
l_int|0
suffix:semicolon
op_decrement
id|rows
)paren
(brace
id|fast_memmove
(paren
id|dst
comma
id|src
comma
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|16
)paren
suffix:semicolon
id|src
op_add_assign
id|bytes
suffix:semicolon
id|dst
op_add_assign
id|bytes
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|src
op_sub_assign
id|colsize
op_star
id|bytes
suffix:semicolon
id|dst
op_sub_assign
id|colsize
op_star
id|bytes
suffix:semicolon
id|memmove_8p_col
c_func
(paren
id|dst
op_plus
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|16
comma
id|src
op_plus
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|16
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|sx
op_plus
id|width
op_minus
l_int|1
)paren
op_amp
l_int|1
)paren
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
(paren
id|sx
op_plus
id|width
op_minus
l_int|1
)paren
op_rshift
l_int|1
)paren
op_star
l_int|16
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
(paren
id|dx
op_plus
id|width
op_minus
l_int|1
)paren
op_rshift
l_int|1
)paren
op_star
l_int|16
suffix:semicolon
id|memmove_8p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
op_decrement
id|width
suffix:semicolon
)brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|width
OG
l_int|1
)paren
(brace
id|src
op_add_assign
id|colsize
op_star
id|bytes
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
op_star
l_int|15
suffix:semicolon
id|dst
op_add_assign
id|colsize
op_star
id|bytes
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
op_star
l_int|15
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|colsize
suffix:semicolon
id|rows
OG
l_int|0
suffix:semicolon
op_decrement
id|rows
)paren
(brace
id|src
op_sub_assign
id|bytes
suffix:semicolon
id|dst
op_sub_assign
id|bytes
suffix:semicolon
id|fast_memmove
(paren
id|dst
comma
id|src
comma
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|16
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|memmove_8p_col
c_func
(paren
id|dst
op_minus
l_int|15
comma
id|src
op_minus
l_int|15
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* odd-&gt;even or even-&gt;odd */
r_if
c_cond
(paren
id|upwards
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cols
op_assign
id|width
suffix:semicolon
id|cols
OG
l_int|0
suffix:semicolon
op_decrement
id|cols
)paren
(brace
id|memmove_8p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
id|INC_8P
c_func
(paren
id|src
)paren
suffix:semicolon
id|INC_8P
c_func
(paren
id|dst
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|sx
op_add_assign
id|width
op_minus
l_int|1
suffix:semicolon
id|dx
op_add_assign
id|width
op_minus
l_int|1
suffix:semicolon
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
(paren
id|dx
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|dx
op_amp
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cols
op_assign
id|width
suffix:semicolon
id|cols
OG
l_int|0
suffix:semicolon
op_decrement
id|cols
)paren
(brace
id|memmove_8p_col
c_func
(paren
id|dst
comma
id|src
comma
id|colsize
comma
id|bytes
)paren
suffix:semicolon
id|DEC_8P
c_func
(paren
id|src
)paren
suffix:semicolon
id|DEC_8P
c_func
(paren
id|dst
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|function|clear_8_plane
r_static
r_void
id|clear_8_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|ulong
id|offset
suffix:semicolon
id|u_char
op_star
id|start
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
r_int
id|lines
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|ulong
id|size
suffix:semicolon
id|u_long
id|cval1
comma
id|cval2
comma
id|cval3
comma
id|cval4
comma
id|pcval1
comma
id|pcval2
suffix:semicolon
id|expand8ql
c_func
(paren
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
comma
id|cval1
comma
id|cval2
comma
id|cval3
comma
id|cval4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|width
op_eq
id|bytes
op_div
l_int|8
)paren
(brace
id|offset
op_assign
id|sy
op_star
id|bytes
op_star
id|p-&gt;fontheight
suffix:semicolon
id|size
op_assign
id|lines
op_star
id|bytes
suffix:semicolon
id|memset_even_8p
c_func
(paren
id|p-&gt;screen_base
op_plus
id|offset
comma
id|size
comma
id|cval1
comma
id|cval2
comma
id|cval3
comma
id|cval4
)paren
suffix:semicolon
)brace
r_else
(brace
id|offset
op_assign
(paren
id|sy
op_star
id|bytes
op_star
id|p-&gt;fontheight
)paren
op_plus
(paren
id|sx
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|sx
op_amp
l_int|1
)paren
suffix:semicolon
id|start
op_assign
id|p-&gt;screen_base
op_plus
id|offset
suffix:semicolon
id|expand8dl
c_func
(paren
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
comma
op_amp
id|pcval1
comma
op_amp
id|pcval2
)paren
suffix:semicolon
multiline_comment|/* Clears are split if the region starts at an odd column or&n;&t;&t; * end at an even column. These extra columns are spread&n;&t;&t; * across the interleaved planes. All in between can be&n;&t;&t; * cleared by normal mymemclear_small(), because both bytes of&n;&t;&t; * the single plane words are affected.&n;&t;&t; */
r_if
c_cond
(paren
id|sx
op_amp
l_int|1
)paren
(brace
id|memclear_8p_col
c_func
(paren
id|start
comma
id|lines
comma
id|pcval1
comma
id|pcval2
comma
id|bytes
)paren
suffix:semicolon
id|start
op_add_assign
l_int|7
suffix:semicolon
id|width
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
op_amp
l_int|1
)paren
(brace
id|memclear_8p_col
c_func
(paren
id|start
op_plus
(paren
id|width
op_rshift
l_int|1
)paren
op_star
l_int|16
comma
id|lines
comma
id|pcval1
comma
id|pcval2
comma
id|bytes
)paren
suffix:semicolon
id|width
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width
)paren
(brace
r_for
c_loop
(paren
id|rows
op_assign
id|lines
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|start
op_add_assign
id|bytes
)paren
(brace
id|memset_even_8p
c_func
(paren
id|start
comma
id|width
op_star
l_int|8
comma
id|cval1
comma
id|cval2
comma
id|cval3
comma
id|cval4
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|putc_8_plane
r_static
r_void
id|putc_8_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
id|u_char
op_star
id|cdat
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
id|ulong
id|eorx1
comma
id|eorx2
comma
id|fgx1
comma
id|fgx2
comma
id|bgx1
comma
id|bgx2
comma
id|fdx
suffix:semicolon
id|c
op_and_assign
l_int|0xff
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
(paren
id|x
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|x
op_amp
l_int|1
)paren
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
id|expand8dl
c_func
(paren
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
comma
op_amp
id|fgx1
comma
op_amp
id|fgx2
)paren
suffix:semicolon
id|expand8dl
c_func
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
comma
op_amp
id|bgx1
comma
op_amp
id|bgx2
)paren
suffix:semicolon
id|eorx1
op_assign
id|fgx1
op_xor
id|bgx1
suffix:semicolon
id|eorx2
op_assign
id|fgx2
op_xor
id|bgx2
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
id|fdx
op_assign
id|dup4l
c_func
(paren
op_star
id|cdat
op_increment
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;movepl %1,%0@(0)&bslash;n&bslash;t&quot;
l_string|&quot;movepl %2,%0@(8)&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;a&quot;
(paren
id|dest
)paren
comma
l_string|&quot;d&quot;
(paren
(paren
id|fdx
op_amp
id|eorx1
)paren
op_xor
id|bgx1
)paren
comma
l_string|&quot;d&quot;
(paren
(paren
id|fdx
op_amp
id|eorx2
)paren
op_xor
id|bgx2
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|putcs_8_plane
r_static
r_void
id|putcs_8_plane
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|dest0
suffix:semicolon
id|u_char
op_star
id|cdat
comma
id|c
suffix:semicolon
r_int
id|rows
suffix:semicolon
r_int
id|bytes
suffix:semicolon
id|ulong
id|eorx1
comma
id|eorx2
comma
id|fgx1
comma
id|fgx2
comma
id|bgx1
comma
id|bgx2
comma
id|fdx
suffix:semicolon
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
(paren
id|x
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|x
op_amp
l_int|1
)paren
suffix:semicolon
id|expand8dl
c_func
(paren
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
comma
op_amp
id|fgx1
comma
op_amp
id|fgx2
)paren
suffix:semicolon
id|expand8dl
c_func
(paren
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
comma
op_amp
id|bgx1
comma
op_amp
id|bgx2
)paren
suffix:semicolon
id|eorx1
op_assign
id|fgx1
op_xor
id|bgx1
suffix:semicolon
id|eorx2
op_assign
id|fgx2
op_xor
id|bgx2
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
multiline_comment|/* I think, unrolling the loops like in the 1 plane case isn&squot;t&n;&t;&t; * practicable here, because the body is much longer for 4&n;&t;&t; * planes (mostly the dup4l()). I guess, unrolling this would&n;&t;&t; * need more than 256 bytes and so exceed the instruction&n;&t;&t; * cache :-(&n;&t;&t; */
id|c
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
comma
id|dest
op_assign
id|dest0
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
id|fdx
op_assign
id|dup4l
c_func
(paren
op_star
id|cdat
op_increment
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;movepl %1,%0@(0)&bslash;n&bslash;t&quot;
l_string|&quot;movepl %2,%0@(8)&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;a&quot;
(paren
id|dest
)paren
comma
l_string|&quot;d&quot;
(paren
(paren
id|fdx
op_amp
id|eorx1
)paren
op_xor
id|bgx1
)paren
comma
l_string|&quot;d&quot;
(paren
(paren
id|fdx
op_amp
id|eorx2
)paren
op_xor
id|bgx2
)paren
)paren
suffix:semicolon
)brace
id|INC_8P
c_func
(paren
id|dest0
)paren
suffix:semicolon
)brace
)brace
DECL|function|rev_char_8_plane
r_static
r_void
id|rev_char_8_plane
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
r_int
id|j
suffix:semicolon
r_int
id|bytes
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
(paren
id|x
op_rshift
l_int|1
)paren
op_star
l_int|16
op_plus
(paren
id|x
op_amp
l_int|1
)paren
suffix:semicolon
id|j
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
r_while
c_loop
(paren
id|j
op_decrement
)paren
(brace
multiline_comment|/* This should really obey the individual character&squot;s&n;       * background and foreground colors instead of simply&n;       * inverting. For 8 plane mode, only the lower 4 bits of the&n;       * color are inverted, because only that color registers have&n;       * been set up.&n;       */
id|dest
(braket
l_int|0
)braket
op_assign
op_complement
id|dest
(braket
l_int|0
)braket
suffix:semicolon
id|dest
(braket
l_int|2
)braket
op_assign
op_complement
id|dest
(braket
l_int|2
)braket
suffix:semicolon
id|dest
(braket
l_int|4
)braket
op_assign
op_complement
id|dest
(braket
l_int|4
)braket
suffix:semicolon
id|dest
(braket
l_int|6
)braket
op_assign
op_complement
id|dest
(braket
l_int|6
)braket
suffix:semicolon
id|dest
op_add_assign
id|bytes
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FBCON_8PLANE */
multiline_comment|/* ====================================================================== */
macro_line|#ifdef CONFIG_FBCON_8PACKED
multiline_comment|/*&n;    *    8 bpp Packed Pixels&n;    */
DECL|variable|nibbletab_8_packed
r_static
id|u_long
id|nibbletab_8_packed
(braket
)braket
op_assign
initialization_block
suffix:semicolon
DECL|function|bmove_8_packed
r_static
r_void
id|bmove_8_packed
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|bytes
op_assign
id|p-&gt;next_line
comma
id|linesize
op_assign
id|bytes
op_star
id|p-&gt;fontheight
comma
id|rows
suffix:semicolon
id|u_char
op_star
id|src
comma
op_star
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|dx
op_eq
l_int|0
op_logical_and
id|width
op_star
l_int|8
op_eq
id|bytes
)paren
(brace
id|mymemmove
c_func
(paren
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
comma
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
comma
id|height
op_star
id|linesize
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dy
OL
id|sy
op_logical_or
(paren
id|dy
op_eq
id|sy
op_logical_and
id|dx
OL
id|sx
)paren
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
id|sx
op_star
l_int|8
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
id|dx
op_star
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|mymemmove
c_func
(paren
id|dst
comma
id|src
comma
id|width
op_star
l_int|8
)paren
suffix:semicolon
id|src
op_add_assign
id|bytes
suffix:semicolon
id|dst
op_add_assign
id|bytes
suffix:semicolon
)brace
)brace
r_else
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
(paren
id|sy
op_plus
id|height
)paren
op_star
id|linesize
op_plus
id|sx
op_star
l_int|8
op_minus
id|bytes
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
(paren
id|dy
op_plus
id|height
)paren
op_star
id|linesize
op_plus
id|dx
op_star
l_int|8
op_minus
id|bytes
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|mymemmove
c_func
(paren
id|dst
comma
id|src
comma
id|width
op_star
l_int|8
)paren
suffix:semicolon
id|src
op_sub_assign
id|bytes
suffix:semicolon
id|dst
op_sub_assign
id|bytes
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|clear_8_packed
r_static
r_void
id|clear_8_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_char
op_star
id|dest0
comma
op_star
id|dest
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
comma
id|lines
op_assign
id|height
op_star
id|p-&gt;fontheight
comma
id|rows
comma
id|i
suffix:semicolon
id|u_long
id|bgx
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
id|sx
op_star
l_int|8
suffix:semicolon
id|bgx
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|8
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|width
op_star
l_int|8
op_eq
id|bytes
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|lines
op_star
id|width
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|0
)braket
op_assign
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|1
)braket
op_assign
id|bgx
suffix:semicolon
id|dest
op_add_assign
l_int|8
suffix:semicolon
)brace
)brace
r_else
(brace
id|dest0
op_assign
id|dest
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|lines
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest0
op_add_assign
id|bytes
)paren
(brace
id|dest
op_assign
id|dest0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|width
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|0
)braket
op_assign
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|1
)braket
op_assign
id|bgx
suffix:semicolon
id|dest
op_add_assign
l_int|8
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|putc_8_packed
r_static
r_void
id|putc_8_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|cdat
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
comma
id|rows
suffix:semicolon
id|ulong
id|eorx
comma
id|fgx
comma
id|bgx
suffix:semicolon
id|c
op_and_assign
l_int|0xff
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
id|x
op_star
l_int|8
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|p-&gt;fontheight
suffix:semicolon
id|fgx
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bgx
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|8
)paren
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|8
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|eorx
op_assign
id|fgx
op_xor
id|bgx
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|0
)braket
op_assign
(paren
id|nibbletab_8_packed
(braket
op_star
id|cdat
op_rshift
l_int|4
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|1
)braket
op_assign
(paren
id|nibbletab_8_packed
(braket
op_star
id|cdat
op_increment
op_amp
l_int|0xf
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
)brace
)brace
DECL|function|putcs_8_packed
r_static
r_void
id|putcs_8_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|cdat
comma
id|c
comma
op_star
id|dest
comma
op_star
id|dest0
suffix:semicolon
r_int
id|rows
comma
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
id|u_long
id|eorx
comma
id|fgx
comma
id|bgx
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
id|x
op_star
l_int|8
suffix:semicolon
id|fgx
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bgx
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|8
)paren
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|8
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|eorx
op_assign
id|fgx
op_xor
id|bgx
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|c
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|p-&gt;fontheight
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
comma
id|dest
op_assign
id|dest0
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|0
)braket
op_assign
(paren
id|nibbletab_8_packed
(braket
op_star
id|cdat
op_rshift
l_int|4
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|1
)braket
op_assign
(paren
id|nibbletab_8_packed
(braket
op_star
id|cdat
op_increment
op_amp
l_int|0xf
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
)brace
id|dest0
op_add_assign
l_int|8
suffix:semicolon
)brace
)brace
DECL|function|rev_char_8_packed
r_static
r_void
id|rev_char_8_packed
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
comma
id|rows
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
id|x
op_star
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|0
)braket
op_xor_assign
l_int|0x0f0f0f0f
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|1
)braket
op_xor_assign
l_int|0x0f0f0f0f
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FBCON_8PACKED */
multiline_comment|/* ====================================================================== */
macro_line|#ifdef CONFIG_FBCON_16PACKED
multiline_comment|/*&n;    *    16 bpp Packed Pixels&n;    */
DECL|variable|packed16_cmap
id|u_short
id|packed16_cmap
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|tab_16_packed
r_static
id|u_long
id|tab_16_packed
(braket
)braket
op_assign
initialization_block
suffix:semicolon
DECL|function|bmove_16_packed
r_static
r_void
id|bmove_16_packed
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
r_int
id|bytes
op_assign
id|p-&gt;next_line
comma
id|linesize
op_assign
id|bytes
op_star
id|p-&gt;fontheight
comma
id|rows
suffix:semicolon
id|u_char
op_star
id|src
comma
op_star
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|dx
op_eq
l_int|0
op_logical_and
id|width
op_star
l_int|16
op_eq
id|bytes
)paren
(brace
id|mymemmove
c_func
(paren
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
comma
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
comma
id|height
op_star
id|linesize
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dy
OL
id|sy
op_logical_or
(paren
id|dy
op_eq
id|sy
op_logical_and
id|dx
OL
id|sx
)paren
)paren
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|linesize
op_plus
id|sx
op_star
l_int|16
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
id|dy
op_star
id|linesize
op_plus
id|dx
op_star
l_int|16
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|mymemmove
c_func
(paren
id|dst
comma
id|src
comma
id|width
op_star
l_int|16
)paren
suffix:semicolon
id|src
op_add_assign
id|bytes
suffix:semicolon
id|dst
op_add_assign
id|bytes
suffix:semicolon
)brace
)brace
r_else
(brace
id|src
op_assign
id|p-&gt;screen_base
op_plus
(paren
id|sy
op_plus
id|height
)paren
op_star
id|linesize
op_plus
id|sx
op_star
l_int|16
op_minus
id|bytes
suffix:semicolon
id|dst
op_assign
id|p-&gt;screen_base
op_plus
(paren
id|dy
op_plus
id|height
)paren
op_star
id|linesize
op_plus
id|dx
op_star
l_int|16
op_minus
id|bytes
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|height
op_star
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
)paren
(brace
id|mymemmove
c_func
(paren
id|dst
comma
id|src
comma
id|width
op_star
l_int|16
)paren
suffix:semicolon
id|src
op_sub_assign
id|bytes
suffix:semicolon
id|dst
op_sub_assign
id|bytes
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|clear_16_packed
r_static
r_void
id|clear_16_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_char
op_star
id|dest0
comma
op_star
id|dest
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
comma
id|lines
op_assign
id|height
op_star
id|p-&gt;fontheight
comma
id|rows
comma
id|i
suffix:semicolon
id|u_long
id|bgx
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|sy
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
id|sx
op_star
l_int|16
suffix:semicolon
id|bgx
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bgx
op_assign
id|packed16_cmap
(braket
id|bgx
)braket
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sx
op_eq
l_int|0
op_logical_and
id|width
op_star
l_int|16
op_eq
id|bytes
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|lines
op_star
id|width
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|0
)braket
op_assign
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|1
)braket
op_assign
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|2
)braket
op_assign
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|3
)braket
op_assign
id|bgx
suffix:semicolon
id|dest
op_add_assign
l_int|16
suffix:semicolon
)brace
)brace
r_else
(brace
id|dest0
op_assign
id|dest
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|lines
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest0
op_add_assign
id|bytes
)paren
(brace
id|dest
op_assign
id|dest0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|width
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|0
)braket
op_assign
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|1
)braket
op_assign
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|2
)braket
op_assign
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|3
)braket
op_assign
id|bgx
suffix:semicolon
id|dest
op_add_assign
l_int|16
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|putc_16_packed
r_static
r_void
id|putc_16_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|cdat
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
comma
id|rows
suffix:semicolon
id|ulong
id|eorx
comma
id|fgx
comma
id|bgx
suffix:semicolon
id|c
op_and_assign
l_int|0xff
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
id|x
op_star
l_int|16
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|p-&gt;fontheight
suffix:semicolon
id|fgx
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|fgx
op_assign
id|packed16_cmap
(braket
id|fgx
)braket
suffix:semicolon
id|bgx
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bgx
op_assign
id|packed16_cmap
(braket
id|bgx
)braket
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|eorx
op_assign
id|fgx
op_xor
id|bgx
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|0
)braket
op_assign
(paren
id|tab_16_packed
(braket
op_star
id|cdat
op_rshift
l_int|6
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|1
)braket
op_assign
(paren
id|tab_16_packed
(braket
op_star
id|cdat
op_rshift
l_int|4
op_amp
l_int|0x3
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|2
)braket
op_assign
(paren
id|tab_16_packed
(braket
op_star
id|cdat
op_rshift
l_int|2
op_amp
l_int|0x3
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|3
)braket
op_assign
(paren
id|tab_16_packed
(braket
op_star
id|cdat
op_increment
op_amp
l_int|0x3
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
)brace
)brace
multiline_comment|/* TODO */
DECL|function|putcs_16_packed
r_static
r_void
id|putcs_16_packed
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|cdat
comma
id|c
comma
op_star
id|dest
comma
op_star
id|dest0
suffix:semicolon
r_int
id|rows
comma
id|bytes
op_assign
id|p-&gt;next_line
suffix:semicolon
id|u_long
id|eorx
comma
id|fgx
comma
id|bgx
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
id|x
op_star
l_int|16
suffix:semicolon
id|fgx
op_assign
id|attr_fgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|fgx
op_assign
id|packed16_cmap
(braket
id|fgx
)braket
suffix:semicolon
id|bgx
op_assign
id|attr_bgcol
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|bgx
op_assign
id|packed16_cmap
(braket
id|bgx
)braket
suffix:semicolon
id|fgx
op_or_assign
(paren
id|fgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|bgx
op_or_assign
(paren
id|bgx
op_lshift
l_int|16
)paren
suffix:semicolon
id|eorx
op_assign
id|fgx
op_xor
id|bgx
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|c
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
id|c
op_star
id|p-&gt;fontheight
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
comma
id|dest
op_assign
id|dest0
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|0
)braket
op_assign
(paren
id|tab_16_packed
(braket
op_star
id|cdat
op_rshift
l_int|6
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|1
)braket
op_assign
(paren
id|tab_16_packed
(braket
op_star
id|cdat
op_rshift
l_int|4
op_amp
l_int|0x3
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|2
)braket
op_assign
(paren
id|tab_16_packed
(braket
op_star
id|cdat
op_rshift
l_int|2
op_amp
l_int|0x3
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|3
)braket
op_assign
(paren
id|tab_16_packed
(braket
op_star
id|cdat
op_increment
op_amp
l_int|0x3
)braket
op_amp
id|eorx
)paren
op_xor
id|bgx
suffix:semicolon
)brace
id|dest0
op_add_assign
l_int|16
suffix:semicolon
)brace
)brace
DECL|function|rev_char_16_packed
r_static
r_void
id|rev_char_16_packed
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
r_int
id|bytes
op_assign
id|p-&gt;next_line
comma
id|rows
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|bytes
op_plus
id|x
op_star
l_int|16
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|bytes
)paren
(brace
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|0
)braket
op_xor_assign
l_int|0xffffffff
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|1
)braket
op_xor_assign
l_int|0xffffffff
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|2
)braket
op_xor_assign
l_int|0xffffffff
suffix:semicolon
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
(braket
l_int|3
)braket
op_xor_assign
l_int|0xffffffff
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FBCON_16PACKED */
multiline_comment|/* ====================================================================== */
macro_line|#ifdef CONFIG_FBCON_CYBER
multiline_comment|/*&n;    *    Cybervision (accelerated)&n;    */
DECL|function|bmove_cyber
r_static
r_void
id|bmove_cyber
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|dy
comma
r_int
id|dx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|sx
op_mul_assign
l_int|8
suffix:semicolon
id|dx
op_mul_assign
l_int|8
suffix:semicolon
id|width
op_mul_assign
l_int|8
suffix:semicolon
id|Cyber_BitBLT
c_func
(paren
(paren
id|u_short
)paren
id|sx
comma
(paren
id|u_short
)paren
(paren
id|sy
op_star
id|p-&gt;fontheight
)paren
comma
(paren
id|u_short
)paren
id|dx
comma
(paren
id|u_short
)paren
(paren
id|dy
op_star
id|p-&gt;fontheight
)paren
comma
(paren
id|u_short
)paren
id|width
comma
(paren
id|u_short
)paren
(paren
id|height
op_star
id|p-&gt;fontheight
)paren
comma
(paren
id|u_short
)paren
id|S3_NEW
)paren
suffix:semicolon
)brace
DECL|function|clear_cyber
r_static
r_void
id|clear_cyber
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|sy
comma
r_int
id|sx
comma
r_int
id|height
comma
r_int
id|width
)paren
(brace
id|u_char
id|bg
suffix:semicolon
id|sx
op_mul_assign
l_int|8
suffix:semicolon
id|width
op_mul_assign
l_int|8
suffix:semicolon
id|bg
op_assign
id|attr_bgcol_ec
c_func
(paren
id|p
comma
id|conp
)paren
suffix:semicolon
id|Cyber_RectFill
c_func
(paren
(paren
id|u_short
)paren
id|sx
comma
(paren
id|u_short
)paren
(paren
id|sy
op_star
id|p-&gt;fontheight
)paren
comma
(paren
id|u_short
)paren
id|width
comma
(paren
id|u_short
)paren
(paren
id|height
op_star
id|p-&gt;fontheight
)paren
comma
(paren
id|u_short
)paren
id|S3_NEW
comma
(paren
id|u_short
)paren
id|bg
)paren
suffix:semicolon
)brace
DECL|function|putc_cyber
r_static
r_void
id|putc_cyber
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_int
id|c
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|cdat
suffix:semicolon
id|u_long
id|tmp
suffix:semicolon
id|u_int
id|rows
comma
id|reverse
comma
id|underline
suffix:semicolon
id|u_char
id|d
suffix:semicolon
id|u_char
id|fg
comma
id|bg
suffix:semicolon
id|c
op_and_assign
l_int|0xff
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
l_int|8
op_star
id|x
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
id|fg
op_assign
id|disp-&gt;fgcol
suffix:semicolon
id|bg
op_assign
id|disp-&gt;bgcol
suffix:semicolon
id|reverse
op_assign
id|conp-&gt;vc_reverse
suffix:semicolon
id|underline
op_assign
id|conp-&gt;vc_underline
suffix:semicolon
id|Cyber_WaitBlit
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
(brace
id|d
op_assign
op_star
id|cdat
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|underline
op_logical_and
op_logical_neg
id|rows
)paren
id|d
op_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|reverse
)paren
id|d
op_assign
op_complement
id|d
suffix:semicolon
id|tmp
op_assign
(paren
(paren
id|d
op_amp
l_int|0x80
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|24
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x40
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|16
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x20
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|8
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x10
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
suffix:semicolon
op_star
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
(paren
id|d
op_amp
l_int|0x8
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|24
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x4
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|16
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x2
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|8
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x1
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
suffix:semicolon
op_star
(paren
(paren
id|u_long
op_star
)paren
id|dest
op_plus
l_int|1
)paren
op_assign
id|tmp
suffix:semicolon
)brace
)brace
DECL|function|putcs_cyber
r_static
r_void
id|putcs_cyber
c_func
(paren
r_struct
id|vc_data
op_star
id|conp
comma
r_struct
id|display
op_star
id|p
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
comma
r_int
id|y
comma
r_int
id|x
)paren
(brace
id|u_char
op_star
id|dest
comma
op_star
id|dest0
comma
op_star
id|cdat
suffix:semicolon
id|u_long
id|tmp
suffix:semicolon
id|u_int
id|rows
comma
id|reverse
comma
id|underline
suffix:semicolon
id|u_char
id|c
comma
id|d
suffix:semicolon
id|u_char
id|fg
comma
id|bg
suffix:semicolon
id|dest0
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
l_int|8
op_star
id|x
suffix:semicolon
id|fg
op_assign
id|disp-&gt;fgcol
suffix:semicolon
id|bg
op_assign
id|disp-&gt;bgcol
suffix:semicolon
id|reverse
op_assign
id|conp-&gt;vc_reverse
suffix:semicolon
id|underline
op_assign
id|conp-&gt;vc_underline
suffix:semicolon
id|Cyber_WaitBlit
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|c
op_assign
op_star
id|s
op_increment
suffix:semicolon
id|dest
op_assign
id|dest0
suffix:semicolon
id|dest0
op_add_assign
l_int|8
suffix:semicolon
id|cdat
op_assign
id|p-&gt;fontdata
op_plus
(paren
id|c
op_star
id|p-&gt;fontheight
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
(brace
id|d
op_assign
op_star
id|cdat
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|underline
op_logical_and
op_logical_neg
id|rows
)paren
id|d
op_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|reverse
)paren
id|d
op_assign
op_complement
id|d
suffix:semicolon
id|tmp
op_assign
(paren
(paren
id|d
op_amp
l_int|0x80
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|24
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x40
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|16
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x20
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|8
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x10
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
suffix:semicolon
op_star
(paren
(paren
id|u_long
op_star
)paren
id|dest
)paren
op_assign
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
(paren
id|d
op_amp
l_int|0x8
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|24
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x4
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|16
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x2
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
op_lshift
l_int|8
suffix:semicolon
id|tmp
op_or_assign
(paren
(paren
id|d
op_amp
l_int|0x1
)paren
ques
c_cond
id|fg
suffix:colon
id|bg
)paren
suffix:semicolon
op_star
(paren
(paren
id|u_long
op_star
)paren
id|dest
op_plus
l_int|1
)paren
op_assign
id|tmp
suffix:semicolon
)brace
)brace
)brace
DECL|function|rev_char_cyber
r_static
r_void
id|rev_char_cyber
c_func
(paren
r_struct
id|display
op_star
id|p
comma
r_int
id|x
comma
r_int
id|y
)paren
(brace
id|u_char
op_star
id|dest
suffix:semicolon
id|u_int
id|rows
suffix:semicolon
id|u_char
id|fg
comma
id|bg
suffix:semicolon
id|fg
op_assign
id|disp-&gt;fgcol
suffix:semicolon
id|bg
op_assign
id|disp-&gt;bgcol
suffix:semicolon
id|dest
op_assign
id|p-&gt;screen_base
op_plus
id|y
op_star
id|p-&gt;fontheight
op_star
id|p-&gt;next_line
op_plus
l_int|8
op_star
id|x
suffix:semicolon
id|Cyber_WaitBlit
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rows
op_assign
id|p-&gt;fontheight
suffix:semicolon
id|rows
op_decrement
suffix:semicolon
id|dest
op_add_assign
id|p-&gt;next_line
)paren
(brace
op_star
id|dest
op_assign
(paren
op_star
id|dest
op_eq
id|fg
)paren
ques
c_cond
id|bg
suffix:colon
id|fg
suffix:semicolon
op_star
(paren
id|dest
op_plus
l_int|1
)paren
op_assign
(paren
op_star
(paren
id|dest
op_plus
l_int|1
)paren
op_eq
id|fg
)paren
ques
c_cond
id|bg
suffix:colon
id|fg
suffix:semicolon
op_star
(paren
id|dest
op_plus
l_int|2
)paren
op_assign
(paren
op_star
(paren
id|dest
op_plus
l_int|2
)paren
op_eq
id|fg
)paren
ques
c_cond
id|bg
suffix:colon
id|fg
suffix:semicolon
op_star
(paren
id|dest
op_plus
l_int|3
)paren
op_assign
(paren
op_star
(paren
id|dest
op_plus
l_int|3
)paren
op_eq
id|fg
)paren
ques
c_cond
id|bg
suffix:colon
id|fg
suffix:semicolon
op_star
(paren
id|dest
op_plus
l_int|4
)paren
op_assign
(paren
op_star
(paren
id|dest
op_plus
l_int|4
)paren
op_eq
id|fg
)paren
ques
c_cond
id|bg
suffix:colon
id|fg
suffix:semicolon
op_star
(paren
id|dest
op_plus
l_int|5
)paren
op_assign
(paren
op_star
(paren
id|dest
op_plus
l_int|5
)paren
op_eq
id|fg
)paren
ques
c_cond
id|bg
suffix:colon
id|fg
suffix:semicolon
op_star
(paren
id|dest
op_plus
l_int|6
)paren
op_assign
(paren
op_star
(paren
id|dest
op_plus
l_int|6
)paren
op_eq
id|fg
)paren
ques
c_cond
id|bg
suffix:colon
id|fg
suffix:semicolon
op_star
(paren
id|dest
op_plus
l_int|7
)paren
op_assign
(paren
op_star
(paren
id|dest
op_plus
l_int|7
)paren
op_eq
id|fg
)paren
ques
c_cond
id|bg
suffix:colon
id|fg
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_FBCON_CYBER */
multiline_comment|/* ====================================================================== */
multiline_comment|/*&n;    *    The console `switch&squot; structure for the frame buffer based console&n;    */
DECL|variable|fb_con
r_struct
id|consw
id|fb_con
op_assign
(brace
id|fbcon_startup
comma
id|fbcon_init
comma
id|fbcon_deinit
comma
id|fbcon_clear
comma
id|fbcon_putc
comma
id|fbcon_putcs
comma
id|fbcon_cursor
comma
id|fbcon_scroll
comma
id|fbcon_bmove
comma
id|fbcon_switch
comma
id|fbcon_blank
comma
id|fbcon_get_font
comma
id|fbcon_set_font
)brace
suffix:semicolon
eof
