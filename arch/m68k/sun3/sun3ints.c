multiline_comment|/*&n; * linux/arch/m68k/sun3/sun3ints.c -- Sun-3 Linux interrupt handling code&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel_stat.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/intersil.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/sun3ints.h&gt;
r_extern
r_void
id|sun3_leds
(paren
r_int
r_char
)paren
suffix:semicolon
DECL|function|sun3_disable_interrupts
r_void
id|sun3_disable_interrupts
c_func
(paren
r_void
)paren
(brace
id|sun3_disable_irq
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sun3_enable_interrupts
r_void
id|sun3_enable_interrupts
c_func
(paren
r_void
)paren
(brace
id|sun3_enable_irq
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|variable|led_pattern
r_int
id|led_pattern
(braket
l_int|8
)braket
op_assign
(brace
op_complement
(paren
l_int|0x80
)paren
comma
op_complement
(paren
l_int|0x01
)paren
comma
op_complement
(paren
l_int|0x40
)paren
comma
op_complement
(paren
l_int|0x02
)paren
comma
op_complement
(paren
l_int|0x20
)paren
comma
op_complement
(paren
l_int|0x04
)paren
comma
op_complement
(paren
l_int|0x10
)paren
comma
op_complement
(paren
l_int|0x08
)paren
)brace
suffix:semicolon
DECL|variable|sun3_intreg
r_int
r_char
op_star
id|sun3_intreg
suffix:semicolon
DECL|function|sun3_insert_irq
r_void
id|sun3_insert_irq
c_func
(paren
id|irq_node_t
op_star
op_star
id|list
comma
id|irq_node_t
op_star
id|node
)paren
(brace
)brace
DECL|function|sun3_delete_irq
r_void
id|sun3_delete_irq
c_func
(paren
id|irq_node_t
op_star
op_star
id|list
comma
r_void
op_star
id|dev_id
)paren
(brace
)brace
DECL|function|sun3_free_irq
r_void
id|sun3_free_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
op_star
id|dev_id
)paren
(brace
)brace
DECL|function|sun3_enable_irq
r_void
id|sun3_enable_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
op_star
id|sun3_intreg
op_or_assign
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
)brace
DECL|function|sun3_disable_irq
r_void
id|sun3_disable_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
op_star
id|sun3_intreg
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
)brace
DECL|function|sun3_do_irq
r_inline
r_void
id|sun3_do_irq
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
id|kstat.irqs
(braket
l_int|0
)braket
(braket
id|SYS_IRQS
op_plus
id|irq
)braket
op_increment
suffix:semicolon
op_star
id|sun3_intreg
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
op_star
id|sun3_intreg
op_or_assign
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
)brace
DECL|function|sun3_get_irq_list
r_int
id|sun3_get_irq_list
c_func
(paren
r_char
op_star
id|buf
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sun3_int5
r_static
r_void
id|sun3_int5
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
id|kstat.irqs
(braket
l_int|0
)braket
(braket
id|SYS_IRQS
op_plus
id|irq
)braket
op_increment
suffix:semicolon
op_star
id|sun3_intreg
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
id|intersil_clear
c_func
(paren
)paren
suffix:semicolon
op_star
id|sun3_intreg
op_or_assign
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
id|do_timer
c_func
(paren
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|kstat.irqs
(braket
l_int|0
)braket
(braket
id|SYS_IRQS
op_plus
id|irq
)braket
op_mod
l_int|20
)paren
)paren
(brace
id|sun3_leds
c_func
(paren
id|led_pattern
(braket
(paren
id|kstat.irqs
(braket
l_int|0
)braket
(braket
id|SYS_IRQS
op_plus
id|irq
)braket
op_mod
l_int|160
)paren
op_div
l_int|20
)braket
)paren
suffix:semicolon
)brace
)brace
DECL|function|sun3_int7
r_static
r_void
id|sun3_int7
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
id|sun3_do_irq
c_func
(paren
id|irq
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|kstat.irqs
(braket
l_int|0
)braket
(braket
id|SYS_IRQS
op_plus
id|irq
)braket
op_mod
l_int|2000
)paren
)paren
(brace
id|sun3_leds
c_func
(paren
id|led_pattern
(braket
(paren
id|kstat.irqs
(braket
l_int|0
)braket
(braket
id|SYS_IRQS
op_plus
id|irq
)braket
op_mod
l_int|16000
)paren
op_div
l_int|2000
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* handle requested ints, excepting 5 and 7, which always do the same&n;   thing */
DECL|variable|dev_ids
r_static
r_void
op_star
id|dev_ids
(braket
id|SYS_IRQS
)braket
suffix:semicolon
DECL|variable|inthandler
r_static
r_void
(paren
op_star
id|inthandler
(braket
id|SYS_IRQS
)braket
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
id|sun3_int5
comma
l_int|NULL
comma
id|sun3_int7
)brace
suffix:semicolon
DECL|function|sun3_inthandle
r_static
r_void
id|sun3_inthandle
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
r_if
c_cond
(paren
id|inthandler
(braket
id|irq
)braket
op_eq
l_int|NULL
)paren
(brace
id|panic
(paren
l_string|&quot;bad interrupt %d received (id %p)&bslash;n&quot;
comma
id|irq
comma
id|dev_id
)paren
suffix:semicolon
)brace
id|kstat.irqs
(braket
l_int|0
)braket
(braket
id|SYS_IRQS
op_plus
id|irq
)braket
op_increment
suffix:semicolon
op_star
id|sun3_intreg
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
id|inthandler
(braket
id|irq
)braket
(paren
id|irq
comma
id|dev_ids
(braket
id|irq
)braket
comma
id|fp
)paren
suffix:semicolon
)brace
DECL|variable|sun3_default_handler
r_void
(paren
op_star
id|sun3_default_handler
(braket
id|SYS_IRQS
)braket
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
op_assign
(brace
id|sun3_inthandle
comma
id|sun3_inthandle
comma
id|sun3_inthandle
comma
id|sun3_inthandle
comma
id|sun3_inthandle
comma
id|sun3_int5
comma
id|sun3_inthandle
comma
id|sun3_int7
)brace
suffix:semicolon
DECL|variable|dev_names
r_static
r_char
op_star
id|dev_names
(braket
id|SYS_IRQS
)braket
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;timer&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|sun3_init_IRQ
r_void
id|sun3_init_IRQ
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYS_IRQS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev_names
(braket
id|i
)braket
)paren
(brace
id|sys_request_irq
c_func
(paren
id|i
comma
id|sun3_default_handler
(braket
id|i
)braket
comma
l_int|0
comma
id|dev_names
(braket
id|i
)braket
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|sun3_request_irq
r_int
id|sun3_request_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|flags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
(brace
r_if
c_cond
(paren
id|inthandler
(braket
id|irq
)braket
op_ne
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sun3_request_irq: request for irq %d -- already taken!&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|inthandler
(braket
id|irq
)braket
op_assign
id|handler
suffix:semicolon
id|dev_ids
(braket
id|irq
)braket
op_assign
id|dev_id
suffix:semicolon
id|dev_names
(braket
id|irq
)braket
op_assign
id|devname
suffix:semicolon
multiline_comment|/* setting devname would be nice */
id|sys_request_irq
c_func
(paren
id|irq
comma
id|sun3_default_handler
(braket
id|irq
)braket
comma
l_int|0
comma
id|devname
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
