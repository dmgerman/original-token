multiline_comment|/* $Id: misc.c,v 1.15 1997/05/14 20:45:00 davem Exp $&n; * misc.c:  Miscellaneous prom functions that don&squot;t belong&n; *          anywhere else.&n; *&n; * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/sun3-head.h&gt;
macro_line|#include &lt;asm/idprom.h&gt;
macro_line|#include &lt;asm/openprom.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/movs.h&gt;
multiline_comment|/* Reset and reboot the machine with the command &squot;bcommand&squot;. */
r_void
DECL|function|prom_reboot
id|prom_reboot
c_func
(paren
r_char
op_star
id|bcommand
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
(paren
op_star
(paren
id|romvec-&gt;pv_reboot
)paren
)paren
(paren
id|bcommand
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Drop into the prom, with the chance to continue with the &squot;go&squot;&n; * prom command.&n; */
r_void
DECL|function|prom_cmdline
id|prom_cmdline
c_func
(paren
r_void
)paren
(brace
)brace
multiline_comment|/* Drop into the prom, but completely terminate the program.&n; * No chance of continuing.&n; */
r_void
DECL|function|prom_halt
id|prom_halt
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|again
suffix:colon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
(paren
op_star
(paren
id|romvec-&gt;pv_halt
)paren
)paren
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_goto
id|again
suffix:semicolon
multiline_comment|/* PROM is out to get me -DaveM */
)brace
DECL|typedef|sfunc_t
r_typedef
r_void
(paren
op_star
id|sfunc_t
)paren
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* Get the idprom and stuff it into buffer &squot;idbuf&squot;.  Returns the&n; * format type.  &squot;num_bytes&squot; is the number of bytes that your idbuf&n; * has space for.  Returns 0xff on error.&n; */
r_int
r_char
DECL|function|prom_get_idprom
id|prom_get_idprom
c_func
(paren
r_char
op_star
id|idbuf
comma
r_int
id|num_bytes
)paren
(brace
r_int
id|i
comma
id|oldsfc
suffix:semicolon
id|GET_SFC
c_func
(paren
id|oldsfc
)paren
suffix:semicolon
id|SET_SFC
c_func
(paren
id|FC_CONTROL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_bytes
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* There is a problem with the GET_CONTROL_BYTE&n;&t;&t;macro; defining the extra variable&n;&t;&t;gets around it.&n;&t;&t;*/
r_int
id|c
suffix:semicolon
id|GET_CONTROL_BYTE
c_func
(paren
id|SUN3_IDPROM_BASE
op_plus
id|i
comma
id|c
)paren
suffix:semicolon
id|idbuf
(braket
id|i
)braket
op_assign
id|c
suffix:semicolon
)brace
id|SET_SFC
c_func
(paren
id|oldsfc
)paren
suffix:semicolon
r_return
id|idbuf
(braket
l_int|0
)braket
suffix:semicolon
)brace
multiline_comment|/* Get the major prom version number. */
r_int
DECL|function|prom_version
id|prom_version
c_func
(paren
r_void
)paren
(brace
r_return
id|romvec-&gt;pv_romvers
suffix:semicolon
)brace
multiline_comment|/* Get the prom plugin-revision. */
r_int
DECL|function|prom_getrev
id|prom_getrev
c_func
(paren
r_void
)paren
(brace
r_return
id|prom_rev
suffix:semicolon
)brace
multiline_comment|/* Get the prom firmware print revision. */
r_int
DECL|function|prom_getprev
id|prom_getprev
c_func
(paren
r_void
)paren
(brace
r_return
id|prom_prev
suffix:semicolon
)brace
eof
