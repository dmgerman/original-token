multiline_comment|/*&n; *  linux/arch/m68k/tools/amiga/dmesg.c -- Retrieve the kernel messages stored&n; *&t;&t;&t;&t;&t;   in Chip RAM with the kernel command&n; *&t;&t;&t;&t;&t;   line option `debug=mem&squot;.&n; *&n; *  &#xfffd; Copyright 1996 by Geert Uytterhoeven &lt;geert@linux-m68k.org&gt;&n; *&n; *&n; *  Usage:&n; *&n; *&t;dmesg&n; *&t;dmesg &lt;CHIPMEM_END&gt;&n; *&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of the Linux&n; *  distribution for more details.&n; */
macro_line|#include &lt;stdio.h&gt;
macro_line|#include &lt;stdlib.h&gt;
macro_line|#include &lt;unistd.h&gt;
DECL|macro|CHIPMEM_START
mdefine_line|#define CHIPMEM_START&t;0x00000000
DECL|macro|CHIPMEM_END
mdefine_line|#define CHIPMEM_END&t;0x00200000&t;/* overridden by argv[1] */
DECL|macro|SAVEKMSG_MAGIC1
mdefine_line|#define SAVEKMSG_MAGIC1&t;0x53415645&t;/* &squot;SAVE&squot; */
DECL|macro|SAVEKMSG_MAGIC2
mdefine_line|#define SAVEKMSG_MAGIC2&t;0x4B4D5347&t;/* &squot;KMSG&squot; */
DECL|struct|savekmsg
r_struct
id|savekmsg
(brace
DECL|member|magic1
id|u_long
id|magic1
suffix:semicolon
multiline_comment|/* SAVEKMSG_MAGIC1 */
DECL|member|magic2
id|u_long
id|magic2
suffix:semicolon
multiline_comment|/* SAVEKMSG_MAGIC2 */
DECL|member|magicptr
id|u_long
id|magicptr
suffix:semicolon
multiline_comment|/* address of magic1 */
DECL|member|size
id|u_long
id|size
suffix:semicolon
DECL|member|data
r_char
id|data
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|main
r_int
id|main
c_func
(paren
r_int
id|argc
comma
r_char
op_star
id|argv
(braket
)braket
)paren
(brace
id|u_long
id|start
op_assign
id|CHIPMEM_START
comma
id|end
op_assign
id|CHIPMEM_END
comma
id|p
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_struct
id|savekmsg
op_star
id|m
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|argc
op_ge
l_int|2
)paren
id|end
op_assign
id|strtoul
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;Searching for SAVEKMSG magic...&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|start
suffix:semicolon
id|p
op_le
id|end
op_minus
r_sizeof
(paren
r_struct
id|savekmsg
)paren
suffix:semicolon
id|p
op_add_assign
l_int|4
)paren
(brace
id|m
op_assign
(paren
r_struct
id|savekmsg
op_star
)paren
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|m-&gt;magic1
op_eq
id|SAVEKMSG_MAGIC1
)paren
op_logical_and
(paren
id|m-&gt;magic2
op_eq
id|SAVEKMSG_MAGIC2
)paren
op_logical_and
(paren
id|m-&gt;magicptr
op_eq
id|p
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
id|printf
c_func
(paren
l_string|&quot;Not found&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|printf
c_func
(paren
l_string|&quot;Found %ld bytes at 0x%08lx&bslash;n&quot;
comma
id|m-&gt;size
comma
(paren
id|u_long
)paren
op_amp
id|m-&gt;data
)paren
suffix:semicolon
id|puts
c_func
(paren
l_string|&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;
)paren
suffix:semicolon
id|fflush
c_func
(paren
id|stdout
)paren
suffix:semicolon
id|write
c_func
(paren
l_int|1
comma
op_amp
id|m-&gt;data
comma
id|m-&gt;size
)paren
suffix:semicolon
id|fflush
c_func
(paren
id|stdout
)paren
suffix:semicolon
id|puts
c_func
(paren
l_string|&quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
