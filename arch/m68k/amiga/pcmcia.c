multiline_comment|/*&n;** asm-m68k/pcmcia.c -- Amiga Linux PCMCIA support&n;**                      most information was found by disassembling card.resource&n;**                      I&squot;m still looking for an official doc !&n;**&n;** Copyright 1997 by Alain Malek&n;**&n;** This file is subject to the terms and conditions of the GNU General Public&n;** License.  See the file COPYING in the main directory of this archive&n;** for more details.&n;**&n;** Created: 12/10/97 by Alain Malek&n;*/
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;asm/amigayle.h&gt;
macro_line|#include &lt;asm/amipcmcia.h&gt;
multiline_comment|/* gayle config byte for program voltage and access speed */
DECL|variable|cfg_byte
r_static
id|u_char
id|cfg_byte
op_assign
id|GAYLE_CFG_0V
op_or
id|GAYLE_CFG_150NS
suffix:semicolon
DECL|function|pcmcia_reset
r_void
id|pcmcia_reset
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|reset_start_time
op_assign
id|jiffies
suffix:semicolon
r_int
r_char
id|b
suffix:semicolon
id|gayle_reset
op_assign
l_int|0x00
suffix:semicolon
r_while
c_loop
(paren
id|time_before
c_func
(paren
id|jiffies
comma
id|reset_start_time
op_plus
l_int|1
op_star
id|HZ
op_div
l_int|100
)paren
)paren
suffix:semicolon
id|b
op_assign
id|gayle_reset
suffix:semicolon
)brace
multiline_comment|/* copy a tuple, including tuple header. return nb bytes copied */
multiline_comment|/* be carefull as this may trigger a GAYLE_IRQ_WR interrupt ! */
DECL|function|pcmcia_copy_tuple
r_int
id|pcmcia_copy_tuple
c_func
(paren
r_int
r_char
id|tuple_id
comma
r_void
op_star
id|tuple
comma
r_int
id|max_len
)paren
(brace
r_int
r_char
id|id
comma
op_star
id|dest
suffix:semicolon
r_int
id|cnt
comma
id|pos
comma
id|len
suffix:semicolon
id|dest
op_assign
id|tuple
suffix:semicolon
id|pos
op_assign
l_int|0
suffix:semicolon
id|id
op_assign
id|gayle_attribute
(braket
id|pos
)braket
suffix:semicolon
r_while
c_loop
(paren
(paren
id|id
op_ne
id|CISTPL_END
)paren
op_logical_and
(paren
id|pos
OL
l_int|0x10000
)paren
)paren
(brace
id|len
op_assign
(paren
r_int
)paren
id|gayle_attribute
(braket
id|pos
op_plus
l_int|2
)braket
op_plus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|tuple_id
)paren
(brace
id|len
op_assign
(paren
id|len
OG
id|max_len
)paren
ques
c_cond
id|max_len
suffix:colon
id|len
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|len
suffix:semicolon
id|cnt
op_increment
)paren
(brace
op_star
id|dest
op_increment
op_assign
id|gayle_attribute
(braket
id|pos
op_plus
(paren
id|cnt
op_lshift
l_int|1
)paren
)braket
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
id|pos
op_add_assign
id|len
op_lshift
l_int|1
suffix:semicolon
id|id
op_assign
id|gayle_attribute
(braket
id|pos
)braket
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pcmcia_program_voltage
r_void
id|pcmcia_program_voltage
c_func
(paren
r_int
id|voltage
)paren
(brace
id|u_char
id|v
suffix:semicolon
r_switch
c_cond
(paren
id|voltage
)paren
(brace
r_case
id|PCMCIA_0V
suffix:colon
id|v
op_assign
id|GAYLE_CFG_0V
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCMCIA_5V
suffix:colon
id|v
op_assign
id|GAYLE_CFG_5V
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCMCIA_12V
suffix:colon
id|v
op_assign
id|GAYLE_CFG_12V
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|v
op_assign
id|GAYLE_CFG_0V
suffix:semicolon
)brace
id|cfg_byte
op_assign
(paren
id|cfg_byte
op_amp
l_int|0xfc
)paren
op_or
id|v
suffix:semicolon
id|gayle.config
op_assign
id|cfg_byte
suffix:semicolon
)brace
DECL|function|pcmcia_access_speed
r_void
id|pcmcia_access_speed
c_func
(paren
r_int
id|speed
)paren
(brace
id|u_char
id|s
suffix:semicolon
r_if
c_cond
(paren
id|speed
op_le
id|PCMCIA_SPEED_100NS
)paren
id|s
op_assign
id|GAYLE_CFG_100NS
suffix:semicolon
r_else
r_if
c_cond
(paren
id|speed
op_le
id|PCMCIA_SPEED_150NS
)paren
id|s
op_assign
id|GAYLE_CFG_150NS
suffix:semicolon
r_else
r_if
c_cond
(paren
id|speed
op_le
id|PCMCIA_SPEED_250NS
)paren
id|s
op_assign
id|GAYLE_CFG_250NS
suffix:semicolon
r_else
id|s
op_assign
id|GAYLE_CFG_720NS
suffix:semicolon
id|cfg_byte
op_assign
(paren
id|cfg_byte
op_amp
l_int|0xf3
)paren
op_or
id|s
suffix:semicolon
id|gayle.config
op_assign
id|cfg_byte
suffix:semicolon
)brace
DECL|function|pcmcia_write_enable
r_void
id|pcmcia_write_enable
c_func
(paren
r_void
)paren
(brace
id|gayle.cardstatus
op_assign
id|GAYLE_CS_WR
op_or
id|GAYLE_CS_DA
suffix:semicolon
)brace
DECL|function|pcmcia_write_disable
r_void
id|pcmcia_write_disable
c_func
(paren
r_void
)paren
(brace
id|gayle.cardstatus
op_assign
l_int|0
suffix:semicolon
)brace
eof
