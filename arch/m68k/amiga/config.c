multiline_comment|/*&n; *  linux/arch/m68k/amiga/config.c&n; *&n; *  Copyright (C) 1993 Hamish Macdonald&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
multiline_comment|/*&n; * Miscellaneous Amiga stuff&n; */
macro_line|#include &lt;stdarg.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/amigahw.h&gt;
macro_line|#include &lt;asm/amigaints.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
DECL|variable|amiga_masterclock
id|u_long
id|amiga_masterclock
suffix:semicolon
DECL|variable|amiga_colorclock
id|u_long
id|amiga_colorclock
suffix:semicolon
r_extern
r_char
id|m68k_debug_device
(braket
)braket
suffix:semicolon
r_extern
r_void
id|amiga_sched_init
c_func
(paren
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
)paren
suffix:semicolon
multiline_comment|/* amiga specific keyboard functions */
r_extern
r_int
id|amiga_keyb_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|amiga_kbdrate
(paren
r_struct
id|kbd_repeat
op_star
)paren
suffix:semicolon
multiline_comment|/* amiga specific irq functions */
r_extern
r_void
id|amiga_init_IRQ
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
(paren
op_star
id|amiga_default_handler
(braket
)braket
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
r_extern
r_int
id|amiga_request_irq
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|flags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
suffix:semicolon
r_extern
r_int
id|amiga_free_irq
(paren
r_int
r_int
id|irq
comma
r_void
op_star
id|dev_id
)paren
suffix:semicolon
r_extern
r_void
id|amiga_enable_irq
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|amiga_disable_irq
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
id|amiga_get_irq_list
(paren
r_char
op_star
)paren
suffix:semicolon
multiline_comment|/* amiga specific timer functions */
r_extern
r_int
r_int
id|amiga_gettimeoffset
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|a3000_gettod
(paren
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
)paren
suffix:semicolon
r_extern
r_void
id|a2000_gettod
(paren
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
comma
r_int
op_star
)paren
suffix:semicolon
r_extern
r_int
id|amiga_hwclk
(paren
r_int
comma
r_struct
id|hwclk_time
op_star
)paren
suffix:semicolon
r_extern
r_int
id|amiga_set_clock_mmss
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|amiga_mksound
c_func
(paren
r_int
r_int
id|count
comma
r_int
r_int
id|ticks
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_FD
r_extern
r_int
id|amiga_floppy_init
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|amiga_floppy_setup
c_func
(paren
r_char
op_star
comma
r_int
op_star
)paren
suffix:semicolon
macro_line|#endif
r_extern
r_void
id|amiga_reset
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|amiga_waitbut
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_struct
id|consw
id|fb_con
suffix:semicolon
r_extern
r_struct
id|fb_info
op_star
id|amiga_fb_init
c_func
(paren
r_int
op_star
)paren
suffix:semicolon
r_extern
r_void
id|zorro_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ami_savekmsg_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ami_mem_print
c_func
(paren
r_const
r_char
op_star
id|b
)paren
suffix:semicolon
r_extern
r_void
id|amiga_debug_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|amiga_video_setup
c_func
(paren
r_char
op_star
comma
r_int
op_star
)paren
suffix:semicolon
r_extern
r_void
(paren
op_star
id|kd_mksound
)paren
(paren
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
DECL|function|config_amiga
r_void
id|config_amiga
c_func
(paren
r_void
)paren
(brace
r_char
op_star
id|type
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|boot_info.bi_amiga.model
)paren
(brace
r_case
id|AMI_500
suffix:colon
id|type
op_assign
l_string|&quot;A500&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_500PLUS
suffix:colon
id|type
op_assign
l_string|&quot;A500+&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_600
suffix:colon
id|type
op_assign
l_string|&quot;A600&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_1000
suffix:colon
id|type
op_assign
l_string|&quot;A1000&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_1200
suffix:colon
id|type
op_assign
l_string|&quot;A1200&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_2000
suffix:colon
id|type
op_assign
l_string|&quot;A2000&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_2500
suffix:colon
id|type
op_assign
l_string|&quot;A2500&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_3000
suffix:colon
id|type
op_assign
l_string|&quot;A3000&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_3000T
suffix:colon
id|type
op_assign
l_string|&quot;A3000T&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_3000PLUS
suffix:colon
id|type
op_assign
l_string|&quot;A3000+&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_4000
suffix:colon
id|type
op_assign
l_string|&quot;A4000&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_4000T
suffix:colon
id|type
op_assign
l_string|&quot;A4000T&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_CDTV
suffix:colon
id|type
op_assign
l_string|&quot;CDTV&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_CD32
suffix:colon
id|type
op_assign
l_string|&quot;CD32&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_DRACO
suffix:colon
id|type
op_assign
l_string|&quot;Draco&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Amiga hardware found: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
)paren
id|printk
c_func
(paren
l_string|&quot;[%s] &quot;
comma
id|type
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|boot_info.bi_amiga.model
)paren
(brace
r_case
id|AMI_UNKNOWN
suffix:colon
r_goto
id|Generic
suffix:semicolon
r_case
id|AMI_500
suffix:colon
r_case
id|AMI_500PLUS
suffix:colon
r_case
id|AMI_1000
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A2000_CLK
)paren
suffix:semicolon
multiline_comment|/* Is this correct? */
id|printk
c_func
(paren
l_string|&quot;A2000_CLK &quot;
)paren
suffix:semicolon
r_goto
id|Generic
suffix:semicolon
r_case
id|AMI_600
suffix:colon
r_case
id|AMI_1200
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A1200_IDE
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;A1200_IDE &quot;
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|A2000_CLK
)paren
suffix:semicolon
multiline_comment|/* Is this correct? */
id|printk
c_func
(paren
l_string|&quot;A2000_CLK &quot;
)paren
suffix:semicolon
r_goto
id|Generic
suffix:semicolon
r_case
id|AMI_2000
suffix:colon
r_case
id|AMI_2500
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A2000_CLK
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;A2000_CLK &quot;
)paren
suffix:semicolon
r_goto
id|Generic
suffix:semicolon
r_case
id|AMI_3000
suffix:colon
r_case
id|AMI_3000T
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AMBER_FF
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;AMBER_FF &quot;
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|MAGIC_REKICK
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;MAGIC_REKICK &quot;
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|AMI_3000PLUS
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A3000_SCSI
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;A3000_SCSI &quot;
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|A3000_CLK
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;A3000_CLK &quot;
)paren
suffix:semicolon
r_goto
id|Generic
suffix:semicolon
r_case
id|AMI_4000T
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A4000_SCSI
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;A4000_SCSI &quot;
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|AMI_4000
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|A4000_IDE
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;A4000_IDE &quot;
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|A3000_CLK
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;A3000_CLK &quot;
)paren
suffix:semicolon
r_goto
id|Generic
suffix:semicolon
r_case
id|AMI_CDTV
suffix:colon
r_case
id|AMI_CD32
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|CD_ROM
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CD_ROM &quot;
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|A2000_CLK
)paren
suffix:semicolon
multiline_comment|/* Is this correct? */
id|printk
c_func
(paren
l_string|&quot;A2000_CLK &quot;
)paren
suffix:semicolon
r_goto
id|Generic
suffix:semicolon
id|Generic
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AMI_VIDEO
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_BLITTER
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_AUDIO
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_FLOPPY
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_KEYBOARD
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_MOUSE
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_SERIAL
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|AMI_PARALLEL
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|CHIP_RAM
)paren
suffix:semicolon
id|AMIGAHW_SET
c_func
(paren
id|PAULA
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;VIDEO BLITTER AUDIO FLOPPY KEYBOARD MOUSE SERIAL PARALLEL &quot;
l_string|&quot;CHIP_RAM PAULA &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|boot_info.bi_amiga.chipset
)paren
(brace
r_case
id|CS_OCS
suffix:colon
r_case
id|CS_ECS
suffix:colon
r_case
id|CS_AGA
suffix:colon
r_switch
c_cond
(paren
id|custom.deniseid
op_amp
l_int|0xf
)paren
(brace
r_case
l_int|0x0c
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|DENISE_HR
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DENISE_HR &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x08
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|LISA
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;LISA &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|DENISE
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DENISE &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
(paren
id|custom.vposr
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
)paren
(brace
r_case
l_int|0x00
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AGNUS_PAL
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;AGNUS_PAL &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x10
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AGNUS_NTSC
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;AGNUS_NTSC &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x20
suffix:colon
r_case
l_int|0x21
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AGNUS_HR_PAL
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;AGNUS_HR_PAL &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x30
suffix:colon
r_case
l_int|0x31
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|AGNUS_HR_NTSC
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;AGNUS_HR_NTSC &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x22
suffix:colon
r_case
l_int|0x23
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|ALICE_PAL
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ALICE_PAL &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x32
suffix:colon
r_case
l_int|0x33
suffix:colon
id|AMIGAHW_SET
c_func
(paren
id|ALICE_NTSC
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ALICE_NTSC &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|AMIGAHW_SET
c_func
(paren
id|ZORRO
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ZORRO &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_DRACO
suffix:colon
id|panic
c_func
(paren
l_string|&quot;No support for Draco yet&quot;
)paren
suffix:semicolon
r_default
suffix:colon
id|panic
c_func
(paren
l_string|&quot;Unknown Amiga Model&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|mach_sched_init
op_assign
id|amiga_sched_init
suffix:semicolon
id|mach_keyb_init
op_assign
id|amiga_keyb_init
suffix:semicolon
id|mach_kbdrate
op_assign
id|amiga_kbdrate
suffix:semicolon
id|mach_init_IRQ
op_assign
id|amiga_init_IRQ
suffix:semicolon
id|mach_default_handler
op_assign
op_amp
id|amiga_default_handler
suffix:semicolon
id|mach_request_irq
op_assign
id|amiga_request_irq
suffix:semicolon
id|mach_free_irq
op_assign
id|amiga_free_irq
suffix:semicolon
id|mach_enable_irq
op_assign
id|amiga_enable_irq
suffix:semicolon
id|mach_disable_irq
op_assign
id|amiga_disable_irq
suffix:semicolon
id|mach_get_irq_list
op_assign
id|amiga_get_irq_list
suffix:semicolon
id|mach_gettimeoffset
op_assign
id|amiga_gettimeoffset
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|A3000_CLK
)paren
)paren
(brace
id|mach_gettod
op_assign
id|a3000_gettod
suffix:semicolon
id|mach_max_dma_address
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t;* default MAX_DMA 0xffffffff&n;&t;&t;&t;&t;&t;* on Z3 machines - we should&n;&t;&t;&t;&t;&t;* consider adding something&n;&t;&t;&t;&t;&t;* like a dma_mask in kmalloc&n;&t;&t;&t;&t;&t;* later on, so people using Z2&n;&t;&t;&t;&t;&t;* boards in Z3 machines won&squot;t&n;&t;&t;&t;&t;&t;* get into trouble - Jes&n;&t;&t;&t;&t;&t;*/
)brace
r_else
(brace
multiline_comment|/* if (AMIGAHW_PRESENT(A2000_CLK)) */
id|mach_gettod
op_assign
id|a2000_gettod
suffix:semicolon
id|mach_max_dma_address
op_assign
l_int|0x00ffffff
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t;* default MAX_DMA 0x00ffffff&n;&t;&t;&t;&t;&t;* on Z2 machines.&n;&t;&t;&t;&t;&t;*/
)brace
id|mach_hwclk
op_assign
id|amiga_hwclk
suffix:semicolon
id|mach_set_clock_mmss
op_assign
id|amiga_set_clock_mmss
suffix:semicolon
id|mach_mksound
op_assign
id|amiga_mksound
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_FD
id|mach_floppy_init
op_assign
id|amiga_floppy_init
suffix:semicolon
id|mach_floppy_setup
op_assign
id|amiga_floppy_setup
suffix:semicolon
macro_line|#endif
id|mach_reset
op_assign
id|amiga_reset
suffix:semicolon
id|waitbut
op_assign
id|amiga_waitbut
suffix:semicolon
id|conswitchp
op_assign
op_amp
id|fb_con
suffix:semicolon
id|mach_fb_init
op_assign
id|amiga_fb_init
suffix:semicolon
id|mach_debug_init
op_assign
id|amiga_debug_init
suffix:semicolon
id|mach_video_setup
op_assign
id|amiga_video_setup
suffix:semicolon
id|kd_mksound
op_assign
id|amiga_mksound
suffix:semicolon
multiline_comment|/* Fill in the clock values (based on the 700 kHz E-Clock) */
id|amiga_masterclock
op_assign
l_int|40
op_star
id|amiga_eclock
suffix:semicolon
multiline_comment|/* 28 MHz */
id|amiga_colorclock
op_assign
l_int|5
op_star
id|amiga_eclock
suffix:semicolon
multiline_comment|/* 3.5 MHz */
multiline_comment|/* clear all DMA bits */
id|custom.dmacon
op_assign
id|DMAF_ALL
suffix:semicolon
multiline_comment|/* ensure that the DMA master bit is set */
id|custom.dmacon
op_assign
id|DMAF_SETCLR
op_or
id|DMAF_MASTER
suffix:semicolon
multiline_comment|/* initialize chipram allocator */
id|amiga_chip_init
(paren
)paren
suffix:semicolon
multiline_comment|/* initialize only once here, not every time the debug level is raised */
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|m68k_debug_device
comma
l_string|&quot;mem&quot;
)paren
)paren
id|ami_savekmsg_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;   * if it is an A3000, set the magic bit that forces&n;   * a hard rekick&n;   */
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|MAGIC_REKICK
)paren
)paren
op_star
(paren
id|u_char
op_star
)paren
id|ZTWO_VADDR
c_func
(paren
l_int|0xde0002
)paren
op_or_assign
l_int|0x80
suffix:semicolon
id|zorro_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ZORRO
multiline_comment|/*&n;   * Identify all known AutoConfig Expansion Devices&n;   */
id|zorro_identify
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ZORRO */
)brace
DECL|variable|jiffy_ticks
r_static
r_int
r_int
id|jiffy_ticks
suffix:semicolon
DECL|function|amiga_sched_init
r_void
id|amiga_sched_init
c_func
(paren
r_void
(paren
op_star
id|timer_routine
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
)paren
(brace
id|jiffy_ticks
op_assign
(paren
id|amiga_eclock
op_plus
id|HZ
op_div
l_int|2
)paren
op_div
id|HZ
suffix:semicolon
id|ciab.cra
op_and_assign
l_int|0xC0
suffix:semicolon
multiline_comment|/* turn off timer A, continuous mode, from Eclk */
id|ciab.talo
op_assign
id|jiffy_ticks
op_mod
l_int|256
suffix:semicolon
id|ciab.tahi
op_assign
id|jiffy_ticks
op_div
l_int|256
suffix:semicolon
multiline_comment|/* install interrupt service routine for CIAB Timer A&n;&t; *&n;&t; * Please don&squot;t change this to use ciaa, as it interferes with the&n;&t; * SCSI code. We&squot;ll have to take a look at this later&n;&t; */
id|request_irq
c_func
(paren
id|IRQ_AMIGA_CIAB_TA
comma
id|timer_routine
comma
id|IRQ_FLG_LOCK
comma
l_string|&quot;timer&quot;
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* start timer */
id|ciab.cra
op_or_assign
l_int|0x11
suffix:semicolon
)brace
DECL|macro|TICK_SIZE
mdefine_line|#define TICK_SIZE 10000
multiline_comment|/* This is always executed with interrupts disabled.  */
DECL|function|amiga_gettimeoffset
r_int
r_int
id|amiga_gettimeoffset
(paren
r_void
)paren
(brace
r_int
r_int
id|hi
comma
id|lo
comma
id|hi2
suffix:semicolon
r_int
r_int
id|ticks
comma
id|offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* read CIA B timer A current value */
id|hi
op_assign
id|ciab.tahi
suffix:semicolon
id|lo
op_assign
id|ciab.talo
suffix:semicolon
id|hi2
op_assign
id|ciab.tahi
suffix:semicolon
r_if
c_cond
(paren
id|hi
op_ne
id|hi2
)paren
(brace
id|lo
op_assign
id|ciab.talo
suffix:semicolon
id|hi
op_assign
id|hi2
suffix:semicolon
)brace
id|ticks
op_assign
id|hi
op_lshift
l_int|8
op_or
id|lo
suffix:semicolon
r_if
c_cond
(paren
id|ticks
OG
id|jiffy_ticks
op_div
l_int|2
)paren
multiline_comment|/* check for pending interrupt */
r_if
c_cond
(paren
id|cia_set_irq
c_func
(paren
op_amp
id|ciab_base
comma
l_int|0
)paren
op_amp
id|CIA_ICR_TA
)paren
id|offset
op_assign
l_int|10000
suffix:semicolon
id|ticks
op_assign
id|jiffy_ticks
op_minus
id|ticks
suffix:semicolon
id|ticks
op_assign
(paren
l_int|10000
op_star
id|ticks
)paren
op_div
id|jiffy_ticks
suffix:semicolon
r_return
id|ticks
op_plus
id|offset
suffix:semicolon
)brace
DECL|function|a3000_gettod
r_void
id|a3000_gettod
(paren
r_int
op_star
id|yearp
comma
r_int
op_star
id|monp
comma
r_int
op_star
id|dayp
comma
r_int
op_star
id|hourp
comma
r_int
op_star
id|minp
comma
r_int
op_star
id|secp
)paren
(brace
r_volatile
r_struct
id|tod3000
op_star
id|tod
op_assign
id|TOD_3000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_HOLD
suffix:semicolon
op_star
id|secp
op_assign
id|tod-&gt;second1
op_star
l_int|10
op_plus
id|tod-&gt;second2
suffix:semicolon
op_star
id|minp
op_assign
id|tod-&gt;minute1
op_star
l_int|10
op_plus
id|tod-&gt;minute2
suffix:semicolon
op_star
id|hourp
op_assign
id|tod-&gt;hour1
op_star
l_int|10
op_plus
id|tod-&gt;hour2
suffix:semicolon
op_star
id|dayp
op_assign
id|tod-&gt;day1
op_star
l_int|10
op_plus
id|tod-&gt;day2
suffix:semicolon
op_star
id|monp
op_assign
id|tod-&gt;month1
op_star
l_int|10
op_plus
id|tod-&gt;month2
suffix:semicolon
op_star
id|yearp
op_assign
id|tod-&gt;year1
op_star
l_int|10
op_plus
id|tod-&gt;year2
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_FREE
suffix:semicolon
)brace
DECL|function|a2000_gettod
r_void
id|a2000_gettod
(paren
r_int
op_star
id|yearp
comma
r_int
op_star
id|monp
comma
r_int
op_star
id|dayp
comma
r_int
op_star
id|hourp
comma
r_int
op_star
id|minp
comma
r_int
op_star
id|secp
)paren
(brace
r_volatile
r_struct
id|tod2000
op_star
id|tod
op_assign
id|TOD_2000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
r_while
c_loop
(paren
id|tod-&gt;cntrl1
op_amp
id|TOD2000_CNTRL1_BUSY
)paren
suffix:semicolon
op_star
id|secp
op_assign
id|tod-&gt;second1
op_star
l_int|10
op_plus
id|tod-&gt;second2
suffix:semicolon
op_star
id|minp
op_assign
id|tod-&gt;minute1
op_star
l_int|10
op_plus
id|tod-&gt;minute2
suffix:semicolon
op_star
id|hourp
op_assign
(paren
id|tod-&gt;hour1
op_amp
l_int|3
)paren
op_star
l_int|10
op_plus
id|tod-&gt;hour2
suffix:semicolon
op_star
id|dayp
op_assign
id|tod-&gt;day1
op_star
l_int|10
op_plus
id|tod-&gt;day2
suffix:semicolon
op_star
id|monp
op_assign
id|tod-&gt;month1
op_star
l_int|10
op_plus
id|tod-&gt;month2
suffix:semicolon
op_star
id|yearp
op_assign
id|tod-&gt;year1
op_star
l_int|10
op_plus
id|tod-&gt;year2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tod-&gt;cntrl3
op_amp
id|TOD2000_CNTRL3_24HMODE
)paren
)paren
r_if
c_cond
(paren
(paren
op_logical_neg
id|tod-&gt;hour1
op_amp
id|TOD2000_HOUR1_PM
)paren
op_logical_and
op_star
id|hourp
op_eq
l_int|12
)paren
op_star
id|hourp
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|tod-&gt;hour1
op_amp
id|TOD2000_HOUR1_PM
)paren
op_logical_and
op_star
id|hourp
op_ne
l_int|12
)paren
op_star
id|hourp
op_add_assign
l_int|12
suffix:semicolon
id|tod-&gt;cntrl1
op_and_assign
op_complement
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
)brace
DECL|function|amiga_hwclk
r_int
id|amiga_hwclk
c_func
(paren
r_int
id|op
comma
r_struct
id|hwclk_time
op_star
id|t
)paren
(brace
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|A3000_CLK
)paren
)paren
(brace
r_volatile
r_struct
id|tod3000
op_star
id|tod
op_assign
id|TOD_3000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_HOLD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|op
)paren
(brace
multiline_comment|/* read */
id|t-&gt;sec
op_assign
id|tod-&gt;second1
op_star
l_int|10
op_plus
id|tod-&gt;second2
suffix:semicolon
id|t-&gt;min
op_assign
id|tod-&gt;minute1
op_star
l_int|10
op_plus
id|tod-&gt;minute2
suffix:semicolon
id|t-&gt;hour
op_assign
id|tod-&gt;hour1
op_star
l_int|10
op_plus
id|tod-&gt;hour2
suffix:semicolon
id|t-&gt;day
op_assign
id|tod-&gt;day1
op_star
l_int|10
op_plus
id|tod-&gt;day2
suffix:semicolon
id|t-&gt;wday
op_assign
id|tod-&gt;weekday
suffix:semicolon
id|t-&gt;mon
op_assign
id|tod-&gt;month1
op_star
l_int|10
op_plus
id|tod-&gt;month2
op_minus
l_int|1
suffix:semicolon
id|t-&gt;year
op_assign
id|tod-&gt;year1
op_star
l_int|10
op_plus
id|tod-&gt;year2
suffix:semicolon
)brace
r_else
(brace
id|tod-&gt;second1
op_assign
id|t-&gt;sec
op_div
l_int|10
suffix:semicolon
id|tod-&gt;second2
op_assign
id|t-&gt;sec
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;minute1
op_assign
id|t-&gt;min
op_div
l_int|10
suffix:semicolon
id|tod-&gt;minute2
op_assign
id|t-&gt;min
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;hour1
op_assign
id|t-&gt;hour
op_div
l_int|10
suffix:semicolon
id|tod-&gt;hour2
op_assign
id|t-&gt;hour
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;day1
op_assign
id|t-&gt;day
op_div
l_int|10
suffix:semicolon
id|tod-&gt;day2
op_assign
id|t-&gt;day
op_mod
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;wday
op_ne
op_minus
l_int|1
)paren
id|tod-&gt;weekday
op_assign
id|t-&gt;wday
suffix:semicolon
id|tod-&gt;month1
op_assign
(paren
id|t-&gt;mon
op_plus
l_int|1
)paren
op_div
l_int|10
suffix:semicolon
id|tod-&gt;month2
op_assign
(paren
id|t-&gt;mon
op_plus
l_int|1
)paren
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;year1
op_assign
id|t-&gt;year
op_div
l_int|10
suffix:semicolon
id|tod-&gt;year2
op_assign
id|t-&gt;year
op_mod
l_int|10
suffix:semicolon
)brace
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_FREE
suffix:semicolon
)brace
r_else
multiline_comment|/* if (AMIGAHW_PRESENT(A2000_CLK)) */
(brace
r_volatile
r_struct
id|tod2000
op_star
id|tod
op_assign
id|TOD_2000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
r_while
c_loop
(paren
id|tod-&gt;cntrl1
op_amp
id|TOD2000_CNTRL1_BUSY
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|op
)paren
(brace
multiline_comment|/* read */
id|t-&gt;sec
op_assign
id|tod-&gt;second1
op_star
l_int|10
op_plus
id|tod-&gt;second2
suffix:semicolon
id|t-&gt;min
op_assign
id|tod-&gt;minute1
op_star
l_int|10
op_plus
id|tod-&gt;minute2
suffix:semicolon
id|t-&gt;hour
op_assign
(paren
id|tod-&gt;hour1
op_amp
l_int|3
)paren
op_star
l_int|10
op_plus
id|tod-&gt;hour2
suffix:semicolon
id|t-&gt;day
op_assign
id|tod-&gt;day1
op_star
l_int|10
op_plus
id|tod-&gt;day2
suffix:semicolon
id|t-&gt;wday
op_assign
id|tod-&gt;weekday
suffix:semicolon
id|t-&gt;mon
op_assign
id|tod-&gt;month1
op_star
l_int|10
op_plus
id|tod-&gt;month2
op_minus
l_int|1
suffix:semicolon
id|t-&gt;year
op_assign
id|tod-&gt;year1
op_star
l_int|10
op_plus
id|tod-&gt;year2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tod-&gt;cntrl3
op_amp
id|TOD2000_CNTRL3_24HMODE
)paren
)paren
r_if
c_cond
(paren
(paren
op_logical_neg
id|tod-&gt;hour1
op_amp
id|TOD2000_HOUR1_PM
)paren
op_logical_and
id|t-&gt;hour
op_eq
l_int|12
)paren
id|t-&gt;hour
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|tod-&gt;hour1
op_amp
id|TOD2000_HOUR1_PM
)paren
op_logical_and
id|t-&gt;hour
op_ne
l_int|12
)paren
id|t-&gt;hour
op_add_assign
l_int|12
suffix:semicolon
)brace
r_else
(brace
id|tod-&gt;second1
op_assign
id|t-&gt;sec
op_div
l_int|10
suffix:semicolon
id|tod-&gt;second2
op_assign
id|t-&gt;sec
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;minute1
op_assign
id|t-&gt;min
op_div
l_int|10
suffix:semicolon
id|tod-&gt;minute2
op_assign
id|t-&gt;min
op_mod
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|tod-&gt;cntrl3
op_amp
id|TOD2000_CNTRL3_24HMODE
)paren
id|tod-&gt;hour1
op_assign
id|t-&gt;hour
op_div
l_int|10
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t-&gt;hour
op_ge
l_int|12
)paren
id|tod-&gt;hour1
op_assign
id|TOD2000_HOUR1_PM
op_plus
(paren
id|t-&gt;hour
op_minus
l_int|12
)paren
op_div
l_int|10
suffix:semicolon
r_else
id|tod-&gt;hour1
op_assign
id|t-&gt;hour
op_div
l_int|10
suffix:semicolon
id|tod-&gt;hour2
op_assign
id|t-&gt;hour
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;day1
op_assign
id|t-&gt;day
op_div
l_int|10
suffix:semicolon
id|tod-&gt;day2
op_assign
id|t-&gt;day
op_mod
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;wday
op_ne
op_minus
l_int|1
)paren
id|tod-&gt;weekday
op_assign
id|t-&gt;wday
suffix:semicolon
id|tod-&gt;month1
op_assign
(paren
id|t-&gt;mon
op_plus
l_int|1
)paren
op_div
l_int|10
suffix:semicolon
id|tod-&gt;month2
op_assign
(paren
id|t-&gt;mon
op_plus
l_int|1
)paren
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;year1
op_assign
id|t-&gt;year
op_div
l_int|10
suffix:semicolon
id|tod-&gt;year2
op_assign
id|t-&gt;year
op_mod
l_int|10
suffix:semicolon
)brace
id|tod-&gt;cntrl1
op_and_assign
op_complement
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|amiga_set_clock_mmss
r_int
id|amiga_set_clock_mmss
(paren
r_int
r_int
id|nowtime
)paren
(brace
r_int
id|real_seconds
op_assign
id|nowtime
op_mod
l_int|60
comma
id|real_minutes
op_assign
(paren
id|nowtime
op_div
l_int|60
)paren
op_mod
l_int|60
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|A3000_CLK
)paren
)paren
(brace
r_volatile
r_struct
id|tod3000
op_star
id|tod
op_assign
id|TOD_3000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_HOLD
suffix:semicolon
id|tod-&gt;second1
op_assign
id|real_seconds
op_div
l_int|10
suffix:semicolon
id|tod-&gt;second2
op_assign
id|real_seconds
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;minute1
op_assign
id|real_minutes
op_div
l_int|10
suffix:semicolon
id|tod-&gt;minute2
op_assign
id|real_minutes
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD3000_CNTRL1_FREE
suffix:semicolon
)brace
r_else
multiline_comment|/* if (AMIGAHW_PRESENT(A2000_CLK)) */
(brace
r_volatile
r_struct
id|tod2000
op_star
id|tod
op_assign
id|TOD_2000
suffix:semicolon
id|tod-&gt;cntrl1
op_assign
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
r_while
c_loop
(paren
id|tod-&gt;cntrl1
op_amp
id|TOD2000_CNTRL1_BUSY
)paren
suffix:semicolon
id|tod-&gt;second1
op_assign
id|real_seconds
op_div
l_int|10
suffix:semicolon
id|tod-&gt;second2
op_assign
id|real_seconds
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;minute1
op_assign
id|real_minutes
op_div
l_int|10
suffix:semicolon
id|tod-&gt;minute2
op_assign
id|real_minutes
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;cntrl1
op_and_assign
op_complement
id|TOD2000_CNTRL1_HOLD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|amiga_waitbut
r_void
id|amiga_waitbut
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_while
c_loop
(paren
id|ciaa.pra
op_amp
l_int|0x40
)paren
suffix:semicolon
multiline_comment|/* debounce */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ciaa.pra
op_amp
l_int|0x40
)paren
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/* wait for button up */
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|ciaa.pra
op_amp
l_int|0x40
)paren
)paren
suffix:semicolon
multiline_comment|/* debounce */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ciaa.pra
op_amp
l_int|0x40
)paren
r_break
suffix:semicolon
)brace
)brace
DECL|function|ami_serial_print
r_void
id|ami_serial_print
(paren
r_const
r_char
op_star
id|str
)paren
(brace
r_while
c_loop
(paren
op_star
id|str
)paren
(brace
r_if
c_cond
(paren
op_star
id|str
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
id|custom.serdat
op_assign
(paren
r_int
r_char
)paren
l_char|&squot;&bslash;r&squot;
op_or
l_int|0x100
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|custom.serdatr
op_amp
l_int|0x2000
)paren
)paren
suffix:semicolon
)brace
id|custom.serdat
op_assign
(paren
r_int
r_char
)paren
op_star
id|str
op_increment
op_or
l_int|0x100
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|custom.serdatr
op_amp
l_int|0x2000
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|amiga_debug_init
r_void
id|amiga_debug_init
(paren
r_void
)paren
(brace
r_extern
r_void
(paren
op_star
id|debug_print_proc
)paren
(paren
r_const
r_char
op_star
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|m68k_debug_device
comma
l_string|&quot;ser&quot;
)paren
)paren
(brace
multiline_comment|/* no initialization required (?) */
id|debug_print_proc
op_assign
id|ami_serial_print
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|m68k_debug_device
comma
l_string|&quot;mem&quot;
)paren
)paren
(brace
multiline_comment|/* already initialized by config_amiga() (needed only once) */
id|debug_print_proc
op_assign
id|ami_mem_print
suffix:semicolon
)brace
)brace
DECL|function|dbprintf
r_void
id|dbprintf
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
r_static
r_char
id|buf
(braket
l_int|1024
)braket
suffix:semicolon
id|va_list
id|args
suffix:semicolon
r_extern
r_void
id|console_print
(paren
r_const
r_char
op_star
id|str
)paren
suffix:semicolon
r_extern
r_int
id|vsprintf
c_func
(paren
r_char
op_star
id|buf
comma
r_const
r_char
op_star
id|fmt
comma
id|va_list
id|args
)paren
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|vsprintf
c_func
(paren
id|buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|console_print
(paren
id|buf
)paren
suffix:semicolon
)brace
id|NORET_TYPE
r_void
id|amiga_reset
c_func
(paren
r_void
)paren
id|ATTRIB_NORET
suffix:semicolon
DECL|function|amiga_reset
r_void
id|amiga_reset
(paren
r_void
)paren
(brace
r_int
r_int
id|jmp_addr040
op_assign
id|VTOP
c_func
(paren
op_logical_and
id|jmp_addr_label040
)paren
suffix:semicolon
r_int
r_int
id|jmp_addr
op_assign
id|VTOP
c_func
(paren
op_logical_and
id|jmp_addr_label
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CPU_IS_040_OR_060
)paren
multiline_comment|/* Setup transparent translation registers for mapping&n;     * of 16 MB kernel segment before disabling translation&n;     */
id|__asm__
id|__volatile__
(paren
l_string|&quot;movel    %0,%/d0&bslash;n&bslash;t&quot;
l_string|&quot;andl     #0xff000000,%/d0&bslash;n&bslash;t&quot;
l_string|&quot;orw      #0xe020,%/d0&bslash;n&bslash;t&quot;
multiline_comment|/* map 16 MB, enable, cacheable */
l_string|&quot;.long    0x4e7b0004&bslash;n&bslash;t&quot;
multiline_comment|/* movec d0,itt0 */
l_string|&quot;.long    0x4e7b0006&bslash;n&bslash;t&quot;
multiline_comment|/* movec d0,dtt0 */
l_string|&quot;jmp      %0@&bslash;n&bslash;t&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;a&quot;
(paren
id|jmp_addr040
)paren
)paren
suffix:semicolon
r_else
multiline_comment|/* for 680[23]0, just disable translation and jump to the physical&n;     * address of the label&n;     */
id|__asm__
id|__volatile__
(paren
l_string|&quot;pmove  %/tc,%@&bslash;n&bslash;t&quot;
l_string|&quot;bclr   #7,%@&bslash;n&bslash;t&quot;
l_string|&quot;pmove  %@,%/tc&bslash;n&bslash;t&quot;
l_string|&quot;jmp    %0@&bslash;n&bslash;t&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;a&quot;
(paren
id|jmp_addr
)paren
)paren
suffix:semicolon
id|jmp_addr_label040
suffix:colon
multiline_comment|/* disable translation on &squot;040 now */
id|__asm__
id|__volatile__
(paren
l_string|&quot;moveq #0,%/d0&bslash;n&bslash;t&quot;
l_string|&quot;.long 0x4e7b0003&bslash;n&bslash;t&quot;
multiline_comment|/* movec d0,tc; disable MMU */
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
multiline_comment|/* no inputs */
suffix:colon
l_string|&quot;d0&quot;
)paren
suffix:semicolon
id|jmp_addr_label
suffix:colon
multiline_comment|/* pickup reset address from AmigaOS ROM, reset devices and jump&n;   * to reset address&n;   */
id|__asm__
id|__volatile__
(paren
l_string|&quot;movew #0x2700,%/sr&bslash;n&bslash;t&quot;
l_string|&quot;leal  0x01000000,%/a0&bslash;n&bslash;t&quot;
l_string|&quot;subl  %/a0@(-0x14),%/a0&bslash;n&bslash;t&quot;
l_string|&quot;movel %/a0@(4),%/a0&bslash;n&bslash;t&quot;
l_string|&quot;subql #2,%/a0&bslash;n&bslash;t&quot;
l_string|&quot;bra   1f&bslash;n&bslash;t&quot;
multiline_comment|/* align on a longword boundary */
id|__ALIGN_STR
l_string|&quot;&bslash;n&quot;
l_string|&quot;1:&bslash;n&bslash;t&quot;
l_string|&quot;reset&bslash;n&bslash;t&quot;
l_string|&quot;jmp   %/a0@&quot;
suffix:colon
multiline_comment|/* Just that gcc scans it for % escapes */
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
suffix:semicolon
)brace
r_extern
r_void
op_star
id|amiga_chip_alloc
c_func
(paren
r_int
id|size
)paren
suffix:semicolon
DECL|macro|SAVEKMSG_MAXMEM
mdefine_line|#define SAVEKMSG_MAXMEM&t;&t;128*1024
DECL|macro|SAVEKMSG_MAGIC1
mdefine_line|#define SAVEKMSG_MAGIC1&t;&t;0x53415645&t;/* &squot;SAVE&squot; */
DECL|macro|SAVEKMSG_MAGIC2
mdefine_line|#define SAVEKMSG_MAGIC2&t;&t;0x4B4D5347&t;/* &squot;KMSG&squot; */
DECL|struct|savekmsg
r_struct
id|savekmsg
(brace
DECL|member|magic1
id|u_long
id|magic1
suffix:semicolon
multiline_comment|/* SAVEKMSG_MAGIC1 */
DECL|member|magic2
id|u_long
id|magic2
suffix:semicolon
multiline_comment|/* SAVEKMSG_MAGIC2 */
DECL|member|magicptr
id|u_long
id|magicptr
suffix:semicolon
multiline_comment|/* address of magic1 */
DECL|member|size
id|u_long
id|size
suffix:semicolon
DECL|member|data
r_char
id|data
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|savekmsg
r_static
r_struct
id|savekmsg
op_star
id|savekmsg
op_assign
l_int|NULL
suffix:semicolon
DECL|function|ami_savekmsg_init
r_static
r_void
id|ami_savekmsg_init
c_func
(paren
r_void
)paren
(brace
id|savekmsg
op_assign
(paren
r_struct
id|savekmsg
op_star
)paren
id|amiga_chip_alloc
c_func
(paren
id|SAVEKMSG_MAXMEM
)paren
suffix:semicolon
id|savekmsg-&gt;magic1
op_assign
id|SAVEKMSG_MAGIC1
suffix:semicolon
id|savekmsg-&gt;magic2
op_assign
id|SAVEKMSG_MAGIC2
suffix:semicolon
id|savekmsg-&gt;magicptr
op_assign
id|VTOP
c_func
(paren
id|savekmsg
)paren
suffix:semicolon
id|savekmsg-&gt;size
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ami_mem_print
r_static
r_void
id|ami_mem_print
c_func
(paren
r_const
r_char
op_star
id|b
)paren
(brace
r_int
id|len
suffix:semicolon
r_for
c_loop
(paren
id|len
op_assign
l_int|0
suffix:semicolon
id|b
(braket
id|len
)braket
suffix:semicolon
id|len
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|savekmsg-&gt;size
op_plus
id|len
op_le
id|SAVEKMSG_MAXMEM
)paren
(brace
id|memcpy
c_func
(paren
id|savekmsg-&gt;data
op_plus
id|savekmsg-&gt;size
comma
id|b
comma
id|len
)paren
suffix:semicolon
id|savekmsg-&gt;size
op_add_assign
id|len
suffix:semicolon
)brace
)brace
DECL|function|amiga_get_model
r_void
id|amiga_get_model
c_func
(paren
r_char
op_star
id|model
)paren
(brace
id|strcpy
c_func
(paren
id|model
comma
l_string|&quot;Amiga &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|boot_info.bi_amiga.model
)paren
(brace
r_case
id|AMI_500
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;500&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_500PLUS
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;500+&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_600
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;600&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_1000
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;1000&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_1200
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;1200&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_2000
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;2000&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_2500
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;2500&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_3000
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;3000&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_3000T
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;3000T&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_3000PLUS
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;3000+&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_4000
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;4000&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_4000T
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;4000T&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_CDTV
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;CDTV&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_CD32
suffix:colon
id|strcat
c_func
(paren
id|model
comma
l_string|&quot;CD32&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AMI_DRACO
suffix:colon
id|strcpy
c_func
(paren
id|model
comma
l_string|&quot;DRACO&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|amiga_get_hardware_list
r_int
id|amiga_get_hardware_list
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|CHIP_RAM
)paren
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Chip RAM:&bslash;t%ldK&bslash;n&quot;
comma
id|boot_info.bi_amiga.chip_size
op_rshift
l_int|10
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;PS Freq:&bslash;t%dHz&bslash;nEClock Freq:&bslash;t%ldHz&bslash;n&quot;
comma
id|boot_info.bi_amiga.psfreq
comma
id|amiga_eclock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|AMI_VIDEO
)paren
)paren
(brace
r_char
op_star
id|type
suffix:semicolon
r_switch
c_cond
(paren
id|boot_info.bi_amiga.chipset
)paren
(brace
r_case
id|CS_OCS
suffix:colon
id|type
op_assign
l_string|&quot;OCS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_ECS
suffix:colon
id|type
op_assign
l_string|&quot;ECS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_AGA
suffix:colon
id|type
op_assign
l_string|&quot;AGA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|type
op_assign
l_string|&quot;Old or Unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Graphics:&bslash;t%s&bslash;n&quot;
comma
id|type
)paren
suffix:semicolon
)brace
DECL|macro|AMIGAHW_ANNOUNCE
mdefine_line|#define AMIGAHW_ANNOUNCE(name, str)&t;&t;&t;&t;&bslash;&n;    if (AMIGAHW_PRESENT(name))&t;&t;&t;&t;&bslash;&n;&t;len += sprintf (buffer+len, &quot;&bslash;t%s&bslash;n&quot;, str)
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;Detected hardware:&bslash;n&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_VIDEO
comma
l_string|&quot;Amiga Video&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_BLITTER
comma
l_string|&quot;Blitter&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMBER_FF
comma
l_string|&quot;Amber Flicker Fixer&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_AUDIO
comma
l_string|&quot;Amiga Audio&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_FLOPPY
comma
l_string|&quot;Floppy Controller&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A3000_SCSI
comma
l_string|&quot;SCSI Controller WD33C93 (A3000 style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A4000_SCSI
comma
l_string|&quot;SCSI Controller NCR53C710 (A4000T style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A1200_IDE
comma
l_string|&quot;IDE Interface (A1200 style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A4000_IDE
comma
l_string|&quot;IDE Interface (A4000 style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|CD_ROM
comma
l_string|&quot;Internal CD ROM drive&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_KEYBOARD
comma
l_string|&quot;Keyboard&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_MOUSE
comma
l_string|&quot;Mouse Port&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_SERIAL
comma
l_string|&quot;Serial Port&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AMI_PARALLEL
comma
l_string|&quot;Parallel Port&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A2000_CLK
comma
l_string|&quot;Hardware Clock (A2000 style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|A3000_CLK
comma
l_string|&quot;Hardware Clock (A3000 style)&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|CHIP_RAM
comma
l_string|&quot;Chip RAM&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|PAULA
comma
l_string|&quot;Paula 8364&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|DENISE
comma
l_string|&quot;Denise 8362&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|DENISE_HR
comma
l_string|&quot;Denise 8373&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|LISA
comma
l_string|&quot;Lisa 8375&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_PAL
comma
l_string|&quot;Normal/Fat PAL Agnus 8367/8371&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_NTSC
comma
l_string|&quot;Normal/Fat NTSC Agnus 8361/8370&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_HR_PAL
comma
l_string|&quot;Fat Hires PAL Agnus 8372&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|AGNUS_HR_NTSC
comma
l_string|&quot;Fat Hires NTSC Agnus 8372&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|ALICE_PAL
comma
l_string|&quot;PAL Alice 8374&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|ALICE_NTSC
comma
l_string|&quot;NTSC Alice 8374&quot;
)paren
suffix:semicolon
id|AMIGAHW_ANNOUNCE
c_func
(paren
id|MAGIC_REKICK
comma
l_string|&quot;Magic Hard Rekick&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|AMIGAHW_PRESENT
c_func
(paren
id|ZORRO
)paren
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;tZorro AutoConfig: %d Expansion Device%s&bslash;n&quot;
comma
id|boot_info.bi_amiga.num_autocon
comma
id|boot_info.bi_amiga.num_autocon
op_eq
l_int|1
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;s&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
eof
