multiline_comment|/* &n; * linux/arch/m68k/mm/sun3mmu.c&n; *&n; * Implementations of mm routines specific to the sun3 MMU.&n; *&n; * Moved here 8/20/1999 Sam Creasey&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/swap.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#ifdef CONFIG_BLK_DEV_RAM
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/io.h&gt;
r_extern
r_void
id|mmu_emu_init
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
r_int
id|free_area_init
c_func
(paren
r_int
r_int
op_star
id|zones_size
)paren
suffix:semicolon
DECL|variable|bad_pmd_string
r_const
r_char
id|bad_pmd_string
(braket
)braket
op_assign
l_string|&quot;Bad pmd in pte_alloc: %08lx&bslash;n&quot;
suffix:semicolon
r_extern
r_int
r_int
id|empty_bad_page_table
suffix:semicolon
r_extern
r_int
r_int
id|empty_bad_page
suffix:semicolon
DECL|function|free_initmem
r_void
id|free_initmem
c_func
(paren
r_void
)paren
(brace
)brace
multiline_comment|/* For the sun3 we try to follow the i386 paging_init() more closely */
multiline_comment|/* start_mem and end_mem have PAGE_OFFSET added already */
multiline_comment|/* now sets up tables using sun3 PTEs rather than i386 as before. --m */
DECL|function|paging_init
r_int
r_int
id|__init
id|paging_init
c_func
(paren
r_int
r_int
id|start_mem
comma
r_int
r_int
id|end_mem
)paren
(brace
id|pgd_t
op_star
id|pg_dir
suffix:semicolon
id|pte_t
op_star
id|pg_table
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|address
suffix:semicolon
macro_line|#ifdef TEST_VERIFY_AREA
id|wp_works_ok
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|start_mem
op_assign
id|PAGE_ALIGN
c_func
(paren
id|start_mem
)paren
suffix:semicolon
id|empty_bad_page_table
op_assign
id|start_mem
suffix:semicolon
id|start_mem
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|empty_bad_page
op_assign
id|start_mem
suffix:semicolon
id|start_mem
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|empty_zero_page
op_assign
id|start_mem
suffix:semicolon
id|start_mem
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|empty_zero_page
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|address
op_assign
id|PAGE_OFFSET
suffix:semicolon
id|pg_dir
op_assign
id|swapper_pg_dir
suffix:semicolon
id|memset
(paren
id|swapper_pg_dir
comma
l_int|0
comma
r_sizeof
(paren
id|swapper_pg_dir
)paren
)paren
suffix:semicolon
id|memset
(paren
id|kernel_pg_dir
comma
l_int|0
comma
r_sizeof
(paren
id|kernel_pg_dir
)paren
)paren
suffix:semicolon
multiline_comment|/* Map whole memory from PAGE_OFFSET (0x0E000000) */
id|pg_dir
op_add_assign
id|PAGE_OFFSET
op_rshift
id|PGDIR_SHIFT
suffix:semicolon
r_while
c_loop
(paren
id|address
OL
id|end_mem
)paren
(brace
id|pg_table
op_assign
(paren
id|pte_t
op_star
)paren
id|__pa
(paren
id|start_mem
)paren
suffix:semicolon
id|start_mem
op_add_assign
id|PTRS_PER_PTE
op_star
r_sizeof
(paren
id|pte_t
)paren
suffix:semicolon
id|pgd_val
c_func
(paren
op_star
id|pg_dir
)paren
op_assign
(paren
r_int
r_int
)paren
id|pg_table
suffix:semicolon
id|pg_dir
op_increment
suffix:semicolon
multiline_comment|/* now change pg_table to kernel virtual addresses */
id|pg_table
op_assign
(paren
id|pte_t
op_star
)paren
id|__va
(paren
(paren
r_int
r_int
)paren
id|pg_table
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PTRS_PER_PTE
suffix:semicolon
op_increment
id|i
comma
op_increment
id|pg_table
)paren
(brace
id|pte_t
id|pte
op_assign
id|__mk_pte
c_func
(paren
id|address
comma
id|PAGE_INIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|address
op_ge
id|end_mem
)paren
id|pte_val
(paren
id|pte
)paren
op_assign
l_int|0
suffix:semicolon
id|set_pte
(paren
id|pg_table
comma
id|pte
)paren
suffix:semicolon
id|address
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
id|mmu_emu_init
c_func
(paren
)paren
suffix:semicolon
id|current-&gt;mm
op_assign
l_int|NULL
suffix:semicolon
r_return
id|PAGE_ALIGN
c_func
(paren
id|free_area_init
c_func
(paren
id|start_mem
comma
id|end_mem
)paren
)paren
suffix:semicolon
)brace
eof
