multiline_comment|/* $Id: ip22-hpc.c,v 1.2 1999/10/19 20:51:52 ralf Exp $&n; *&n; * ip22-hpc.c: Routines for generic manipulation of the HPC controllers.&n; *&n; * Copyright (C) 1996 David S. Miller (dm@engr.sgi.com)&n; * Copyright (C) 1998, 1999 Ralf Baechle&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/addrspace.h&gt;
macro_line|#include &lt;asm/sgi/sgihpc.h&gt;
macro_line|#include &lt;asm/sgi/sgint23.h&gt;
macro_line|#include &lt;asm/sgialib.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
DECL|macro|DEBUG_SGIHPC
macro_line|#undef DEBUG_SGIHPC
DECL|variable|hpc3c0
DECL|variable|hpc3c1
r_struct
id|hpc3_regs
op_star
id|hpc3c0
comma
op_star
id|hpc3c1
suffix:semicolon
DECL|variable|hpc3mregs
r_struct
id|hpc3_miscregs
op_star
id|hpc3mregs
suffix:semicolon
multiline_comment|/* We need software copies of these because they are write only. */
DECL|variable|sgi_hpc_write1
DECL|variable|sgi_hpc_write2
r_int
r_int
id|sgi_hpc_write1
comma
id|sgi_hpc_write2
suffix:semicolon
multiline_comment|/* Machine specific identifier knobs. */
DECL|variable|sgi_has_ioc2
r_int
id|sgi_has_ioc2
op_assign
l_int|0
suffix:semicolon
DECL|variable|sgi_guiness
r_int
id|sgi_guiness
op_assign
l_int|0
suffix:semicolon
DECL|variable|sgi_boardid
r_int
id|sgi_boardid
suffix:semicolon
DECL|function|sgihpc_init
r_void
id|__init
id|sgihpc_init
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|sid
comma
id|crev
comma
id|brev
suffix:semicolon
id|hpc3c0
op_assign
(paren
r_struct
id|hpc3_regs
op_star
)paren
(paren
id|KSEG1
op_plus
id|HPC3_CHIP0_PBASE
)paren
suffix:semicolon
id|hpc3c1
op_assign
(paren
r_struct
id|hpc3_regs
op_star
)paren
(paren
id|KSEG1
op_plus
id|HPC3_CHIP1_PBASE
)paren
suffix:semicolon
id|hpc3mregs
op_assign
(paren
r_struct
id|hpc3_miscregs
op_star
)paren
(paren
id|KSEG1
op_plus
id|HPC3_MREGS_PBASE
)paren
suffix:semicolon
id|sid
op_assign
id|hpc3mregs-&gt;sysid
suffix:semicolon
id|sid
op_and_assign
l_int|0xff
suffix:semicolon
id|crev
op_assign
(paren
id|sid
op_amp
l_int|0xe0
)paren
op_rshift
l_int|5
suffix:semicolon
id|brev
op_assign
(paren
id|sid
op_amp
l_int|0x1e
)paren
op_rshift
l_int|1
suffix:semicolon
macro_line|#ifdef DEBUG_SGIHPC
id|prom_printf
c_func
(paren
l_string|&quot;sgihpc_init: crev&lt;%2x&gt; brev&lt;%2x&gt;&bslash;n&quot;
comma
id|crev
comma
id|brev
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;sgihpc_init: &quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* This test works now thanks to William J. Earl */
r_if
c_cond
(paren
(paren
id|sid
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef DEBUG_SGIHPC
id|prom_printf
c_func
(paren
l_string|&quot;GUINESS &quot;
)paren
suffix:semicolon
macro_line|#endif
id|sgi_guiness
op_assign
l_int|1
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_SGI_INDY
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef DEBUG_SGIHPC
id|prom_printf
c_func
(paren
l_string|&quot;FULLHOUSE &quot;
)paren
suffix:semicolon
macro_line|#endif
id|mips_machtype
op_assign
id|MACH_SGI_INDIGO2
suffix:semicolon
id|sgi_guiness
op_assign
l_int|0
suffix:semicolon
)brace
id|sgi_boardid
op_assign
id|brev
suffix:semicolon
macro_line|#ifdef DEBUG_SGIHPC
id|prom_printf
c_func
(paren
l_string|&quot;sgi_boardid&lt;%d&gt; &quot;
comma
id|sgi_boardid
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|crev
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|sid
op_amp
l_int|1
)paren
op_logical_or
(paren
id|brev
op_ge
l_int|2
)paren
)paren
(brace
macro_line|#ifdef DEBUG_SGIHPC
id|prom_printf
c_func
(paren
l_string|&quot;IOC2 &quot;
)paren
suffix:semicolon
macro_line|#endif
id|sgi_has_ioc2
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef DEBUG_SGIHPC
id|prom_printf
c_func
(paren
l_string|&quot;IOC1 revision 1 &quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_else
(brace
macro_line|#ifdef DEBUG_SGIHPC
id|prom_printf
c_func
(paren
l_string|&quot;IOC1 revision 0 &quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef DEBUG_SGIHPC
id|prom_printf
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|sgi_hpc_write1
op_assign
(paren
id|HPC3_WRITE1_PRESET
op_or
id|HPC3_WRITE1_KMRESET
op_or
id|HPC3_WRITE1_ERESET
op_or
id|HPC3_WRITE1_LC0OFF
)paren
suffix:semicolon
id|sgi_hpc_write2
op_assign
(paren
id|HPC3_WRITE2_EASEL
op_or
id|HPC3_WRITE2_NTHRESH
op_or
id|HPC3_WRITE2_TPSPEED
op_or
id|HPC3_WRITE2_EPSEL
op_or
id|HPC3_WRITE2_U0AMODE
op_or
id|HPC3_WRITE2_U1AMODE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sgi_guiness
)paren
(brace
id|sgi_hpc_write1
op_or_assign
id|HPC3_WRITE1_GRESET
suffix:semicolon
)brace
id|hpc3mregs-&gt;write1
op_assign
id|sgi_hpc_write1
suffix:semicolon
id|hpc3mregs-&gt;write2
op_assign
id|sgi_hpc_write2
suffix:semicolon
id|hpc3c0-&gt;pbus_piocfgs
(braket
l_int|0
)braket
(braket
l_int|6
)braket
op_or_assign
id|HPC3_PIOPCFG_HW
suffix:semicolon
)brace
eof
