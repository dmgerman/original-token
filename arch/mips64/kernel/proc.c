multiline_comment|/* $Id: proc.c,v 1.1 1999/09/28 22:25:51 ralf Exp $&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 1995, 1996, 1999 Ralf Baechle&n; *&n; * XXX Rewrite this mess.&n; */
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/mipsregs.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/watch.h&gt;
DECL|variable|unaligned_instructions
r_int
r_int
id|unaligned_instructions
suffix:semicolon
DECL|variable|vced_count
DECL|variable|vcei_count
r_int
r_int
id|vced_count
comma
id|vcei_count
suffix:semicolon
multiline_comment|/*&n; * BUFFER is PAGE_SIZE bytes long.&n; *&n; * Currently /proc/cpuinfo is being abused to print data about the&n; * number of date/instruction cacheflushes.&n; */
DECL|function|get_cpuinfo
r_int
id|get_cpuinfo
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|count
)paren
(brace
r_char
id|fmt
(braket
l_int|64
)braket
suffix:semicolon
r_struct
id|cpuinfo_mips
op_star
id|c
op_assign
id|cpu_data
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|smp_num_cpus
suffix:semicolon
id|n
op_increment
comma
id|c
op_increment
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;processor&bslash;t&bslash;t: %d&bslash;n&quot;
comma
id|n
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;vendor_id&bslash;t&bslash;t: MIPS&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;model name&bslash;t&bslash;t: R10000&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&t;&t;len += sprintf(buffer + len, &quot;cpu model&bslash;t&bslash;t: %s V%d.%d&bslash;n&quot;,&n;&t;               cpu_name[mips_cputype &lt;= CPU_LAST ?&n;&t;                        mips_cputype :&n;&t;                        CPU_UNKNOWN],&n;&t;               (version &gt;&gt; 4) &amp; 0x0f,&n;&t;               version &amp; 0x0f);&n;&t;&t;len += sprintf(buffer + len, &quot;system type&bslash;t&bslash;t: %s %s&bslash;n&quot;,&n;&t;&t;       mach_group_names[mips_machgroup],&n;&t;&t;       mach_group_to_name[mips_machgroup][mips_machtype]);&n;*/
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;BogoMIPS&bslash;t&bslash;t: %lu.%02lu&bslash;n&quot;
comma
(paren
id|loops_per_sec
op_plus
l_int|2500
)paren
op_div
l_int|500000
comma
(paren
(paren
id|loops_per_sec
op_plus
l_int|2500
)paren
op_div
l_int|5000
)paren
op_mod
l_int|100
)paren
suffix:semicolon
multiline_comment|/*&t;&t;len += sprintf(buffer + len, &quot;Number of cpus&bslash;t&bslash;t: %d&bslash;n&quot;, smp_num_cpus);*/
macro_line|#if defined (__MIPSEB__)
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;byteorder&bslash;t&bslash;t: big endian&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined (__MIPSEL__)
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;byteorder&bslash;t&bslash;t: little endian&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;unaligned accesses&bslash;t: %lu&bslash;n&quot;
comma
id|unaligned_instructions
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;wait instruction&bslash;t: %s&bslash;n&quot;
comma
id|wait_available
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;microsecond timers&bslash;t: %s&bslash;n&quot;
comma
id|cyclecounter_available
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;extra interrupt vector&bslash;t: %s&bslash;n&quot;
comma
id|dedicated_iv_available
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;hardware watchpoint&bslash;t: %s&bslash;n&quot;
comma
id|watch_available
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|fmt
comma
l_string|&quot;VCE%%c exceptions&bslash;t&bslash;t: %s&bslash;n&quot;
comma
id|vce_available
ques
c_cond
l_string|&quot;%d&quot;
suffix:colon
l_string|&quot;not available&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
id|fmt
comma
l_char|&squot;D&squot;
comma
id|vced_count
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
id|fmt
comma
l_char|&squot;I&squot;
comma
id|vcei_count
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|offset
)paren
id|offset
op_sub_assign
id|len
comma
id|len
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|len
op_ge
id|offset
op_plus
id|count
)paren
r_goto
id|leave_loop
suffix:semicolon
)brace
id|leave_loop
suffix:colon
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
suffix:semicolon
id|len
op_sub_assign
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_return
id|len
OG
id|count
ques
c_cond
id|count
suffix:colon
id|len
suffix:semicolon
)brace
DECL|function|init_irq_proc
r_void
id|init_irq_proc
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Nothing, for now.  */
)brace
eof
