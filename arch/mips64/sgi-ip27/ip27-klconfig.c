multiline_comment|/* $Id$&n; *&n; * Copyright (C) 1999, 2000 Ralf Baechle (ralf@gnu.org)&n; * Copyright (C) 1999, 2000 Silicon Graphics, Inc.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/kernel_stat.h&gt;
macro_line|#include &lt;linux/param.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;linux/mm.h&gt;&t;&t;
macro_line|#include &lt;asm/sn/klconfig.h&gt;
macro_line|#include &lt;asm/sn/arch.h&gt;
macro_line|#include &lt;asm/sn/gda.h&gt;
DECL|function|find_component
id|klinfo_t
op_star
id|find_component
c_func
(paren
id|lboard_t
op_star
id|brd
comma
id|klinfo_t
op_star
id|kli
comma
r_int
r_char
id|struct_type
)paren
(brace
r_int
id|index
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
id|kli
op_eq
(paren
id|klinfo_t
op_star
)paren
l_int|NULL
)paren
(brace
id|index
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|KLCF_NUM_COMPS
c_func
(paren
id|brd
)paren
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|kli
op_eq
id|KLCF_COMP
c_func
(paren
id|brd
comma
id|j
)paren
)paren
r_break
suffix:semicolon
id|index
op_assign
id|j
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
id|KLCF_NUM_COMPS
c_func
(paren
id|brd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;find_component: Bad pointer: 0x%p&bslash;n&quot;
comma
id|kli
)paren
suffix:semicolon
r_return
(paren
id|klinfo_t
op_star
)paren
l_int|NULL
suffix:semicolon
)brace
id|index
op_increment
suffix:semicolon
multiline_comment|/* next component */
)brace
r_for
c_loop
(paren
suffix:semicolon
id|index
OL
id|KLCF_NUM_COMPS
c_func
(paren
id|brd
)paren
suffix:semicolon
id|index
op_increment
)paren
(brace
id|kli
op_assign
id|KLCF_COMP
c_func
(paren
id|brd
comma
id|index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|KLCF_COMP_TYPE
c_func
(paren
id|kli
)paren
op_eq
id|struct_type
)paren
r_return
id|kli
suffix:semicolon
)brace
multiline_comment|/* Didn&squot;t find it. */
r_return
(paren
id|klinfo_t
op_star
)paren
l_int|NULL
suffix:semicolon
)brace
DECL|function|find_first_component
id|klinfo_t
op_star
id|find_first_component
c_func
(paren
id|lboard_t
op_star
id|brd
comma
r_int
r_char
id|struct_type
)paren
(brace
r_return
id|find_component
c_func
(paren
id|brd
comma
(paren
id|klinfo_t
op_star
)paren
l_int|NULL
comma
id|struct_type
)paren
suffix:semicolon
)brace
DECL|function|find_lboard
id|lboard_t
op_star
id|find_lboard
c_func
(paren
id|lboard_t
op_star
id|start
comma
r_int
r_char
id|brd_type
)paren
(brace
multiline_comment|/* Search all boards stored on this node. */
r_while
c_loop
(paren
id|start
)paren
(brace
r_if
c_cond
(paren
id|start-&gt;brd_type
op_eq
id|brd_type
)paren
r_return
id|start
suffix:semicolon
id|start
op_assign
id|KLCF_NEXT
c_func
(paren
id|start
)paren
suffix:semicolon
)brace
multiline_comment|/* Didn&squot;t find it. */
r_return
(paren
id|lboard_t
op_star
)paren
l_int|NULL
suffix:semicolon
)brace
DECL|function|get_cpu_cnode
id|cnodeid_t
id|get_cpu_cnode
c_func
(paren
id|cpuid_t
id|cpu
)paren
(brace
r_return
id|CPUID_TO_COMPACT_NODEID
c_func
(paren
id|cpu
)paren
suffix:semicolon
)brace
DECL|function|nasid_slice_to_cpuinfo
id|klcpu_t
op_star
id|nasid_slice_to_cpuinfo
c_func
(paren
id|nasid_t
id|nasid
comma
r_int
id|slice
)paren
(brace
id|lboard_t
op_star
id|brd
suffix:semicolon
id|klcpu_t
op_star
id|acpu
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|brd
op_assign
id|find_lboard
c_func
(paren
(paren
id|lboard_t
op_star
)paren
id|KL_CONFIG_INFO
c_func
(paren
id|nasid
)paren
comma
id|KLTYPE_IP27
)paren
)paren
)paren
r_return
(paren
id|klcpu_t
op_star
)paren
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|acpu
op_assign
(paren
id|klcpu_t
op_star
)paren
id|find_first_component
c_func
(paren
id|brd
comma
id|KLSTRUCT_CPU
)paren
)paren
)paren
r_return
(paren
id|klcpu_t
op_star
)paren
l_int|NULL
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|acpu-&gt;cpu_info.physid
)paren
op_eq
id|slice
)paren
r_return
id|acpu
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|acpu
op_assign
(paren
id|klcpu_t
op_star
)paren
id|find_component
c_func
(paren
id|brd
comma
(paren
id|klinfo_t
op_star
)paren
id|acpu
comma
id|KLSTRUCT_CPU
)paren
)paren
)paren
suffix:semicolon
r_return
(paren
id|klcpu_t
op_star
)paren
l_int|NULL
suffix:semicolon
)brace
DECL|function|sn_get_cpuinfo
id|klcpu_t
op_star
id|sn_get_cpuinfo
c_func
(paren
id|cpuid_t
id|cpu
)paren
(brace
id|nasid_t
id|nasid
suffix:semicolon
r_int
id|slice
suffix:semicolon
id|klcpu_t
op_star
id|acpu
suffix:semicolon
id|gda_t
op_star
id|gdap
op_assign
id|GDA
suffix:semicolon
id|cnodeid_t
id|cnode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cpu
OL
id|MAXCPUS
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sn_get_cpuinfo: illegal cpuid 0x%lx&bslash;n&quot;
comma
id|cpu
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|cnode
op_assign
id|get_cpu_cnode
c_func
(paren
id|cpu
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnode
op_eq
id|INVALID_CNODEID
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|nasid
op_assign
id|gdap-&gt;g_nasidtable
(braket
id|cnode
)braket
)paren
op_eq
id|INVALID_NASID
)paren
r_return
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|slice
op_assign
l_int|0
suffix:semicolon
id|slice
OL
id|CPUS_PER_NODE
suffix:semicolon
id|slice
op_increment
)paren
(brace
id|acpu
op_assign
id|nasid_slice_to_cpuinfo
c_func
(paren
id|nasid
comma
id|slice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpu
op_logical_and
id|acpu-&gt;cpu_info.virtid
op_eq
id|cpu
)paren
r_return
id|acpu
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|get_cpu_slice
r_int
id|get_cpu_slice
c_func
(paren
id|cpuid_t
id|cpu
)paren
(brace
id|klcpu_t
op_star
id|acpu
suffix:semicolon
r_if
c_cond
(paren
(paren
id|acpu
op_assign
id|sn_get_cpuinfo
c_func
(paren
id|cpu
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
id|acpu-&gt;cpu_info.physid
suffix:semicolon
)brace
eof
