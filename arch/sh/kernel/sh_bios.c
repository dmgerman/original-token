multiline_comment|/* $Id: sh_bios.c,v 1.3 2000/09/30 03:43:30 gniibe Exp $&n; *&n; *  linux/arch/sh/kernel/sh_bios.c&n; *  C interface for trapping into the standard LinuxSH BIOS.&n; *&n; *  Copyright (C) 2000 Greg Banks, Mitch Davis&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/sh_bios.h&gt;
macro_line|#ifdef CONFIG_SH_STANDARD_BIOS
DECL|macro|BIOS_CALL_CONSOLE_WRITE
mdefine_line|#define BIOS_CALL_CONSOLE_WRITE     &t;0
DECL|macro|BIOS_CALL_READ_BLOCK
mdefine_line|#define BIOS_CALL_READ_BLOCK     &t;1   &t;/* not implemented */
DECL|macro|BIOS_CALL_CHAR_OUT
mdefine_line|#define BIOS_CALL_CHAR_OUT     &t;    &t;0x1f  &t;/* TODO: hack */
DECL|macro|BIOS_CALL_GDB_GET_MODE_PTR
mdefine_line|#define BIOS_CALL_GDB_GET_MODE_PTR     &t;0xfe
DECL|macro|BIOS_CALL_GDB_DETACH
mdefine_line|#define BIOS_CALL_GDB_DETACH     &t;0xff
DECL|function|sh_bios_call
r_static
id|__inline__
r_int
id|sh_bios_call
c_func
(paren
r_int
id|func
comma
r_int
id|arg0
comma
r_int
id|arg1
comma
r_int
id|arg2
comma
r_int
id|arg3
)paren
(brace
r_register
r_int
id|r0
id|__asm__
c_func
(paren
l_string|&quot;r0&quot;
)paren
op_assign
id|func
suffix:semicolon
r_register
r_int
id|r4
id|__asm__
c_func
(paren
l_string|&quot;r4&quot;
)paren
op_assign
id|arg0
suffix:semicolon
r_register
r_int
id|r5
id|__asm__
c_func
(paren
l_string|&quot;r5&quot;
)paren
op_assign
id|arg1
suffix:semicolon
r_register
r_int
id|r6
id|__asm__
c_func
(paren
l_string|&quot;r6&quot;
)paren
op_assign
id|arg2
suffix:semicolon
r_register
r_int
id|r7
id|__asm__
c_func
(paren
l_string|&quot;r7&quot;
)paren
op_assign
id|arg3
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;trapa&t;#0x3f&quot;
suffix:colon
l_string|&quot;=z&quot;
(paren
id|r0
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|r0
)paren
comma
l_string|&quot;r&quot;
(paren
id|r4
)paren
comma
l_string|&quot;r&quot;
(paren
id|r5
)paren
comma
l_string|&quot;r&quot;
(paren
id|r6
)paren
comma
l_string|&quot;r&quot;
(paren
id|r7
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
r_return
id|r0
suffix:semicolon
)brace
DECL|function|sh_bios_console_write
r_void
id|sh_bios_console_write
c_func
(paren
r_const
r_char
op_star
id|buf
comma
r_int
r_int
id|len
)paren
(brace
id|sh_bios_call
c_func
(paren
id|BIOS_CALL_CONSOLE_WRITE
comma
(paren
r_int
)paren
id|buf
comma
(paren
r_int
)paren
id|len
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sh_bios_char_out
r_void
id|sh_bios_char_out
c_func
(paren
r_char
id|ch
)paren
(brace
id|sh_bios_call
c_func
(paren
id|BIOS_CALL_CHAR_OUT
comma
id|ch
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sh_bios_in_gdb_mode
r_int
id|sh_bios_in_gdb_mode
c_func
(paren
r_void
)paren
(brace
r_static
r_char
id|queried
op_assign
l_int|0
suffix:semicolon
r_static
r_char
op_star
id|gdb_mode_p
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|queried
)paren
(brace
multiline_comment|/* Query the gdb stub for address of its gdb mode variable */
r_int
id|r
op_assign
id|sh_bios_call
c_func
(paren
id|BIOS_CALL_GDB_GET_MODE_PTR
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_ne
op_complement
l_int|0
)paren
multiline_comment|/* BIOS returns -1 for unknown function */
id|gdb_mode_p
op_assign
(paren
r_char
op_star
)paren
id|r
suffix:semicolon
id|queried
op_assign
l_int|1
suffix:semicolon
)brace
r_return
(paren
id|gdb_mode_p
op_ne
l_int|0
ques
c_cond
op_star
id|gdb_mode_p
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|sh_bios_gdb_detach
r_void
id|sh_bios_gdb_detach
c_func
(paren
r_void
)paren
(brace
id|sh_bios_call
c_func
(paren
id|BIOS_CALL_GDB_DETACH
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
