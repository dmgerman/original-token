multiline_comment|/* $Id: io_se.c,v 1.5 2000/06/08 05:50:10 gniibe Exp $&n; *&n; * linux/arch/sh/kernel/io_se.c&n; *&n; * Copyright (C) 2000  Kazumoto Kojima&n; *&n; * I/O routine for Hitachi SolutionEngine.&n; *&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/hitachi_se.h&gt;
multiline_comment|/* SH pcmcia io window base, start and end.  */
DECL|variable|sh_pcic_io_wbase
r_int
id|sh_pcic_io_wbase
op_assign
l_int|0xb8400000
suffix:semicolon
DECL|variable|sh_pcic_io_start
r_int
id|sh_pcic_io_start
suffix:semicolon
DECL|variable|sh_pcic_io_stop
r_int
id|sh_pcic_io_stop
suffix:semicolon
DECL|variable|sh_pcic_io_type
r_int
id|sh_pcic_io_type
suffix:semicolon
DECL|variable|sh_pcic_io_dummy
r_int
id|sh_pcic_io_dummy
suffix:semicolon
DECL|function|delay
r_static
r_inline
r_void
id|delay
c_func
(paren
r_void
)paren
(brace
id|ctrl_inw
c_func
(paren
l_int|0xa0000000
)paren
suffix:semicolon
)brace
multiline_comment|/* MS7750 requires special versions of in*, out* routines, since&n;   PC-like io ports are located at upper half byte of 16-bit word which&n;   can be accessed only with 16-bit wide.  */
r_static
r_inline
r_volatile
id|__u16
op_star
DECL|function|port2adr
id|port2adr
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|port
op_ge
l_int|0x2000
)paren
r_return
(paren
r_volatile
id|__u16
op_star
)paren
(paren
id|PA_MRSHPC
op_plus
(paren
id|port
op_minus
l_int|0x2000
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|port
op_ge
l_int|0x1000
)paren
r_return
(paren
r_volatile
id|__u16
op_star
)paren
(paren
id|PA_83902
op_plus
(paren
id|port
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sh_pcic_io_start
op_le
id|port
op_logical_and
id|port
op_le
id|sh_pcic_io_stop
)paren
r_return
(paren
r_volatile
id|__u16
op_star
)paren
(paren
id|sh_pcic_io_wbase
op_plus
(paren
id|port
op_amp
op_complement
l_int|1
)paren
)paren
suffix:semicolon
r_else
r_return
(paren
r_volatile
id|__u16
op_star
)paren
(paren
id|PA_SUPERIO
op_plus
(paren
id|port
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|shifted_port
id|shifted_port
c_func
(paren
r_int
r_int
id|port
)paren
(brace
multiline_comment|/* For IDE registers, value is not shifted */
r_if
c_cond
(paren
(paren
l_int|0x1f0
op_le
id|port
op_logical_and
id|port
OL
l_int|0x1f8
)paren
op_logical_or
id|port
op_eq
l_int|0x3f6
)paren
r_return
l_int|0
suffix:semicolon
r_else
r_return
l_int|1
suffix:semicolon
)brace
DECL|macro|maybebadio
mdefine_line|#define maybebadio(name,port) &bslash;&n;  printk(&quot;bad PC-like io %s for port 0x%x at 0x%08x&bslash;n&quot;, &bslash;&n;&t; #name, (port), (__u32) __builtin_return_address(0))
DECL|function|se_inb
r_int
r_int
id|se_inb
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|sh_pcic_io_start
op_le
id|port
op_logical_and
id|port
op_le
id|sh_pcic_io_stop
)paren
r_return
op_star
(paren
id|__u8
op_star
)paren
(paren
id|sh_pcic_io_wbase
op_plus
l_int|0x40000
op_plus
id|port
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|shifted_port
c_func
(paren
id|port
)paren
)paren
r_return
(paren
op_star
id|port2adr
c_func
(paren
id|port
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_else
r_return
(paren
op_star
id|port2adr
c_func
(paren
id|port
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
DECL|function|se_inb_p
r_int
r_int
id|se_inb_p
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_int
r_int
id|v
suffix:semicolon
r_if
c_cond
(paren
id|sh_pcic_io_start
op_le
id|port
op_logical_and
id|port
op_le
id|sh_pcic_io_stop
)paren
id|v
op_assign
op_star
(paren
id|__u8
op_star
)paren
(paren
id|sh_pcic_io_wbase
op_plus
l_int|0x40000
op_plus
id|port
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|shifted_port
c_func
(paren
id|port
)paren
)paren
id|v
op_assign
(paren
op_star
id|port2adr
c_func
(paren
id|port
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_else
id|v
op_assign
(paren
op_star
id|port2adr
c_func
(paren
id|port
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
id|delay
c_func
(paren
)paren
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
DECL|function|se_inw
r_int
r_int
id|se_inw
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|port
op_ge
l_int|0x2000
op_logical_or
(paren
id|sh_pcic_io_start
op_le
id|port
op_logical_and
id|port
op_le
id|sh_pcic_io_stop
)paren
)paren
r_return
op_star
id|port2adr
c_func
(paren
id|port
)paren
suffix:semicolon
r_else
id|maybebadio
c_func
(paren
id|inw
comma
id|port
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|se_inl
r_int
r_int
id|se_inl
c_func
(paren
r_int
r_int
id|port
)paren
(brace
id|maybebadio
c_func
(paren
id|inl
comma
id|port
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|se_outb
r_void
id|se_outb
c_func
(paren
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|sh_pcic_io_start
op_le
id|port
op_logical_and
id|port
op_le
id|sh_pcic_io_stop
)paren
op_star
(paren
id|__u8
op_star
)paren
(paren
id|sh_pcic_io_wbase
op_plus
id|port
)paren
op_assign
id|value
suffix:semicolon
r_else
r_if
c_cond
(paren
id|shifted_port
c_func
(paren
id|port
)paren
)paren
op_star
(paren
id|port2adr
c_func
(paren
id|port
)paren
)paren
op_assign
id|value
op_lshift
l_int|8
suffix:semicolon
r_else
op_star
(paren
id|port2adr
c_func
(paren
id|port
)paren
)paren
op_assign
id|value
suffix:semicolon
)brace
DECL|function|se_outb_p
r_void
id|se_outb_p
c_func
(paren
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|sh_pcic_io_start
op_le
id|port
op_logical_and
id|port
op_le
id|sh_pcic_io_stop
)paren
op_star
(paren
id|__u8
op_star
)paren
(paren
id|sh_pcic_io_wbase
op_plus
id|port
)paren
op_assign
id|value
suffix:semicolon
r_else
r_if
c_cond
(paren
id|shifted_port
c_func
(paren
id|port
)paren
)paren
op_star
(paren
id|port2adr
c_func
(paren
id|port
)paren
)paren
op_assign
id|value
op_lshift
l_int|8
suffix:semicolon
r_else
op_star
(paren
id|port2adr
c_func
(paren
id|port
)paren
)paren
op_assign
id|value
suffix:semicolon
id|delay
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|se_outw
r_void
id|se_outw
c_func
(paren
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|port
op_ge
l_int|0x2000
op_logical_or
(paren
id|sh_pcic_io_start
op_le
id|port
op_logical_and
id|port
op_le
id|sh_pcic_io_stop
)paren
)paren
op_star
id|port2adr
c_func
(paren
id|port
)paren
op_assign
id|value
suffix:semicolon
r_else
id|maybebadio
c_func
(paren
id|outw
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|se_outl
r_void
id|se_outl
c_func
(paren
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
(brace
id|maybebadio
c_func
(paren
id|outl
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|se_insb
r_void
id|se_insb
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_volatile
id|__u16
op_star
id|p
op_assign
id|port2adr
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sh_pcic_io_start
op_le
id|port
op_logical_and
id|port
op_le
id|sh_pcic_io_stop
)paren
(brace
r_volatile
id|__u8
op_star
id|bp
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|sh_pcic_io_wbase
op_plus
l_int|0x40000
op_plus
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
(paren
(paren
id|__u8
op_star
)paren
id|addr
)paren
op_increment
op_assign
op_star
id|bp
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|shifted_port
c_func
(paren
id|port
)paren
)paren
(brace
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
(paren
(paren
id|__u8
op_star
)paren
id|addr
)paren
op_increment
op_assign
op_star
id|p
op_rshift
l_int|8
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
(paren
(paren
id|__u8
op_star
)paren
id|addr
)paren
op_increment
op_assign
op_star
id|p
suffix:semicolon
)brace
)brace
DECL|function|se_insw
r_void
id|se_insw
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_volatile
id|__u16
op_star
id|p
op_assign
id|port2adr
c_func
(paren
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
(paren
(paren
id|__u16
op_star
)paren
id|addr
)paren
op_increment
op_assign
op_star
id|p
suffix:semicolon
)brace
DECL|function|se_insl
r_void
id|se_insl
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
id|maybebadio
c_func
(paren
id|insl
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|se_outsb
r_void
id|se_outsb
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_volatile
id|__u16
op_star
id|p
op_assign
id|port2adr
c_func
(paren
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sh_pcic_io_start
op_le
id|port
op_logical_and
id|port
op_le
id|sh_pcic_io_stop
)paren
(brace
r_volatile
id|__u8
op_star
id|bp
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|sh_pcic_io_wbase
op_plus
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
id|bp
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|addr
)paren
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|shifted_port
c_func
(paren
id|port
)paren
)paren
(brace
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
id|p
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|addr
)paren
op_increment
op_lshift
l_int|8
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
id|p
op_assign
op_star
(paren
(paren
id|__u8
op_star
)paren
id|addr
)paren
op_increment
suffix:semicolon
)brace
)brace
DECL|function|se_outsw
r_void
id|se_outsw
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_volatile
id|__u16
op_star
id|p
op_assign
id|port2adr
c_func
(paren
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
id|p
op_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
id|addr
)paren
op_increment
suffix:semicolon
)brace
DECL|function|se_outsl
r_void
id|se_outsl
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
id|maybebadio
c_func
(paren
id|outsw
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|se_readb
r_int
r_int
id|se_readb
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
)brace
DECL|function|se_readw
r_int
r_int
id|se_readw
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|addr
suffix:semicolon
)brace
DECL|function|se_readl
r_int
r_int
id|se_readl
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|addr
suffix:semicolon
)brace
DECL|function|se_writeb
r_void
id|se_writeb
c_func
(paren
r_int
r_char
id|b
comma
r_int
r_int
id|addr
)paren
(brace
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
id|addr
op_assign
id|b
suffix:semicolon
)brace
DECL|function|se_writew
r_void
id|se_writew
c_func
(paren
r_int
r_int
id|b
comma
r_int
r_int
id|addr
)paren
(brace
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|addr
op_assign
id|b
suffix:semicolon
)brace
DECL|function|se_writel
r_void
id|se_writel
c_func
(paren
r_int
r_int
id|b
comma
r_int
r_int
id|addr
)paren
(brace
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|addr
op_assign
id|b
suffix:semicolon
)brace
"&f;"
multiline_comment|/* Map ISA bus address to the real address. Only for PCMCIA.  */
multiline_comment|/* ISA page descriptor.  */
DECL|variable|sh_isa_memmap
r_static
id|__u32
id|sh_isa_memmap
(braket
l_int|256
)braket
suffix:semicolon
r_static
r_int
DECL|function|sh_isa_mmap
id|sh_isa_mmap
c_func
(paren
id|__u32
id|start
comma
id|__u32
id|length
comma
id|__u32
id|offset
)paren
(brace
r_int
id|idx
suffix:semicolon
r_if
c_cond
(paren
id|start
op_ge
l_int|0x100000
op_logical_or
(paren
id|start
op_amp
l_int|0xfff
)paren
op_logical_or
(paren
id|length
op_ne
l_int|0x1000
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|idx
op_assign
id|start
op_rshift
l_int|12
suffix:semicolon
id|sh_isa_memmap
(braket
id|idx
)braket
op_assign
l_int|0xb8000000
op_plus
(paren
id|offset
op_amp
op_complement
l_int|0xfff
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;sh_isa_mmap: start %x len %x offset %x (idx %x paddr %x)&bslash;n&quot;
comma
id|start
comma
id|length
comma
id|offset
comma
id|idx
comma
id|sh_isa_memmap
(braket
id|idx
)braket
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_int
r_int
DECL|function|se_isa_port2addr
id|se_isa_port2addr
c_func
(paren
r_int
r_int
id|offset
)paren
(brace
r_int
id|idx
suffix:semicolon
id|idx
op_assign
(paren
id|offset
op_rshift
l_int|12
)paren
op_amp
l_int|0xff
suffix:semicolon
id|offset
op_and_assign
l_int|0xfff
suffix:semicolon
r_return
id|sh_isa_memmap
(braket
id|idx
)braket
op_plus
id|offset
suffix:semicolon
)brace
eof
