multiline_comment|/*---------------------------------------------------------------------------+&n; |  fpu_etc.c                                                                |&n; |                                                                           |&n; | Implement a few FPU instructions.                                         |&n; |                                                                           |&n; | Copyright (C) 1992,1993,1994,1997                                         |&n; |                       W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |&n; |                       Australia.  E-mail   billm@suburbia.net             |&n; |                                                                           |&n; |                                                                           |&n; +---------------------------------------------------------------------------*/
macro_line|#include &quot;fpu_system.h&quot;
macro_line|#include &quot;exception.h&quot;
macro_line|#include &quot;fpu_emu.h&quot;
macro_line|#include &quot;status_w.h&quot;
macro_line|#include &quot;reg_constant.h&quot;
DECL|function|fchs
r_static
r_void
id|fchs
c_func
(paren
id|FPU_REG
op_star
id|st0_ptr
comma
id|u_char
id|st0tag
)paren
(brace
r_if
c_cond
(paren
id|st0tag
op_xor
id|TAG_Empty
)paren
(brace
id|signbyte
c_func
(paren
id|st0_ptr
)paren
op_xor_assign
id|SIGN_NEG
suffix:semicolon
id|clear_C1
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
id|FPU_stack_underflow
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|fabs
r_static
r_void
id|fabs
c_func
(paren
id|FPU_REG
op_star
id|st0_ptr
comma
id|u_char
id|st0tag
)paren
(brace
r_if
c_cond
(paren
id|st0tag
op_xor
id|TAG_Empty
)paren
(brace
id|setpositive
c_func
(paren
id|st0_ptr
)paren
suffix:semicolon
id|clear_C1
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
id|FPU_stack_underflow
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ftst_
r_static
r_void
id|ftst_
c_func
(paren
id|FPU_REG
op_star
id|st0_ptr
comma
id|u_char
id|st0tag
)paren
(brace
r_switch
c_cond
(paren
id|st0tag
)paren
(brace
r_case
id|TAG_Zero
suffix:colon
id|setcc
c_func
(paren
id|SW_C3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TAG_Valid
suffix:colon
r_if
c_cond
(paren
id|getsign
c_func
(paren
id|st0_ptr
)paren
op_eq
id|SIGN_POS
)paren
id|setcc
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_else
id|setcc
c_func
(paren
id|SW_C0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TAG_Special
suffix:colon
r_switch
c_cond
(paren
id|FPU_Special
c_func
(paren
id|st0_ptr
)paren
)paren
(brace
r_case
id|TW_Denormal
suffix:colon
r_if
c_cond
(paren
id|getsign
c_func
(paren
id|st0_ptr
)paren
op_eq
id|SIGN_POS
)paren
id|setcc
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_else
id|setcc
c_func
(paren
id|SW_C0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|denormal_operand
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef PECULIAR_486
multiline_comment|/* This is weird! */
r_if
c_cond
(paren
id|getsign
c_func
(paren
id|st0_ptr
)paren
op_eq
id|SIGN_POS
)paren
id|setcc
c_func
(paren
id|SW_C3
)paren
suffix:semicolon
macro_line|#endif PECULIAR_486
r_return
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TW_NaN
suffix:colon
id|setcc
c_func
(paren
id|SW_C0
op_or
id|SW_C2
op_or
id|SW_C3
)paren
suffix:semicolon
multiline_comment|/* Operand is not comparable */
id|EXCEPTION
c_func
(paren
id|EX_Invalid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TW_Infinity
suffix:colon
r_if
c_cond
(paren
id|getsign
c_func
(paren
id|st0_ptr
)paren
op_eq
id|SIGN_POS
)paren
id|setcc
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_else
id|setcc
c_func
(paren
id|SW_C0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|setcc
c_func
(paren
id|SW_C0
op_or
id|SW_C2
op_or
id|SW_C3
)paren
suffix:semicolon
multiline_comment|/* Operand is not comparable */
id|EXCEPTION
c_func
(paren
id|EX_INTERNAL
op_or
l_int|0x14
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TAG_Empty
suffix:colon
id|setcc
c_func
(paren
id|SW_C0
op_or
id|SW_C2
op_or
id|SW_C3
)paren
suffix:semicolon
id|EXCEPTION
c_func
(paren
id|EX_StackUnder
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|fxam
r_static
r_void
id|fxam
c_func
(paren
id|FPU_REG
op_star
id|st0_ptr
comma
id|u_char
id|st0tag
)paren
(brace
r_int
id|c
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|st0tag
)paren
(brace
r_case
id|TAG_Empty
suffix:colon
id|c
op_assign
id|SW_C3
op_or
id|SW_C0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TAG_Zero
suffix:colon
id|c
op_assign
id|SW_C3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TAG_Valid
suffix:colon
id|c
op_assign
id|SW_C2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TAG_Special
suffix:colon
r_switch
c_cond
(paren
id|FPU_Special
c_func
(paren
id|st0_ptr
)paren
)paren
(brace
r_case
id|TW_Denormal
suffix:colon
id|c
op_assign
id|SW_C2
op_or
id|SW_C3
suffix:semicolon
multiline_comment|/* Denormal */
r_break
suffix:semicolon
r_case
id|TW_NaN
suffix:colon
multiline_comment|/* We also use NaN for unsupported types. */
r_if
c_cond
(paren
(paren
id|st0_ptr-&gt;sigh
op_amp
l_int|0x80000000
)paren
op_logical_and
(paren
id|exponent
c_func
(paren
id|st0_ptr
)paren
op_eq
id|EXP_OVER
)paren
)paren
id|c
op_assign
id|SW_C0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TW_Infinity
suffix:colon
id|c
op_assign
id|SW_C2
op_or
id|SW_C0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|getsign
c_func
(paren
id|st0_ptr
)paren
op_eq
id|SIGN_NEG
)paren
id|c
op_or_assign
id|SW_C1
suffix:semicolon
id|setcc
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
DECL|variable|fp_etc_table
r_static
id|FUNC_ST0
r_const
id|fp_etc_table
(braket
)braket
op_assign
(brace
id|fchs
comma
id|fabs
comma
(paren
id|FUNC_ST0
)paren
id|FPU_illegal
comma
(paren
id|FUNC_ST0
)paren
id|FPU_illegal
comma
id|ftst_
comma
id|fxam
comma
(paren
id|FUNC_ST0
)paren
id|FPU_illegal
comma
(paren
id|FUNC_ST0
)paren
id|FPU_illegal
)brace
suffix:semicolon
DECL|function|FPU_etc
r_void
id|FPU_etc
c_func
(paren
)paren
(brace
(paren
id|fp_etc_table
(braket
id|FPU_rm
)braket
)paren
(paren
op_amp
id|st
c_func
(paren
l_int|0
)paren
comma
id|FPU_gettag0
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
eof
