multiline_comment|/*&n; *&t;Low-Level PCI Support for SGI Visual Workstation&n; *&n; *&t;(c) 1999--2000 Martin Mares &lt;mj@suse.cz&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/lithium.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;pci-i386.h&quot;
DECL|variable|pci_probe
r_int
r_int
id|pci_probe
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n; *  The VISWS uses configuration access type 1 only.&n; */
DECL|macro|CONFIG_CMD
mdefine_line|#define CONFIG_CMD(dev, where)   (0x80000000 | (dev-&gt;bus-&gt;number &lt;&lt; 16) | (dev-&gt;devfn &lt;&lt; 8) | (where &amp; ~3))
DECL|function|pci_conf1_read_config_byte
r_static
r_int
id|pci_conf1_read_config_byte
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u8
op_star
id|value
)paren
(brace
id|outl
c_func
(paren
id|CONFIG_CMD
c_func
(paren
id|dev
comma
id|where
)paren
comma
l_int|0xCF8
)paren
suffix:semicolon
op_star
id|value
op_assign
id|inb
c_func
(paren
l_int|0xCFC
op_plus
(paren
id|where
op_amp
l_int|3
)paren
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|pci_conf1_read_config_word
r_static
r_int
id|pci_conf1_read_config_word
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u16
op_star
id|value
)paren
(brace
id|outl
c_func
(paren
id|CONFIG_CMD
c_func
(paren
id|dev
comma
id|where
)paren
comma
l_int|0xCF8
)paren
suffix:semicolon
op_star
id|value
op_assign
id|inw
c_func
(paren
l_int|0xCFC
op_plus
(paren
id|where
op_amp
l_int|2
)paren
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|pci_conf1_read_config_dword
r_static
r_int
id|pci_conf1_read_config_dword
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u32
op_star
id|value
)paren
(brace
id|outl
c_func
(paren
id|CONFIG_CMD
c_func
(paren
id|dev
comma
id|where
)paren
comma
l_int|0xCF8
)paren
suffix:semicolon
op_star
id|value
op_assign
id|inl
c_func
(paren
l_int|0xCFC
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|pci_conf1_write_config_byte
r_static
r_int
id|pci_conf1_write_config_byte
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u8
id|value
)paren
(brace
id|outl
c_func
(paren
id|CONFIG_CMD
c_func
(paren
id|dev
comma
id|where
)paren
comma
l_int|0xCF8
)paren
suffix:semicolon
id|outb
c_func
(paren
id|value
comma
l_int|0xCFC
op_plus
(paren
id|where
op_amp
l_int|3
)paren
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|pci_conf1_write_config_word
r_static
r_int
id|pci_conf1_write_config_word
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u16
id|value
)paren
(brace
id|outl
c_func
(paren
id|CONFIG_CMD
c_func
(paren
id|dev
comma
id|where
)paren
comma
l_int|0xCF8
)paren
suffix:semicolon
id|outw
c_func
(paren
id|value
comma
l_int|0xCFC
op_plus
(paren
id|where
op_amp
l_int|2
)paren
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|pci_conf1_write_config_dword
r_static
r_int
id|pci_conf1_write_config_dword
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u32
id|value
)paren
(brace
id|outl
c_func
(paren
id|CONFIG_CMD
c_func
(paren
id|dev
comma
id|where
)paren
comma
l_int|0xCF8
)paren
suffix:semicolon
id|outl
c_func
(paren
id|value
comma
l_int|0xCFC
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|macro|CONFIG_CMD
macro_line|#undef CONFIG_CMD
DECL|variable|visws_pci_ops
r_static
r_struct
id|pci_ops
id|visws_pci_ops
op_assign
(brace
id|pci_conf1_read_config_byte
comma
id|pci_conf1_read_config_word
comma
id|pci_conf1_read_config_dword
comma
id|pci_conf1_write_config_byte
comma
id|pci_conf1_write_config_word
comma
id|pci_conf1_write_config_dword
)brace
suffix:semicolon
DECL|function|pcibios_fixup_irqs
r_static
r_void
id|__init
id|pcibios_fixup_irqs
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
comma
op_star
id|p
suffix:semicolon
id|u8
id|pin
suffix:semicolon
r_int
id|irq
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|dev
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_INTERRUPT_PIN
comma
op_amp
id|pin
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pin
)paren
r_continue
suffix:semicolon
id|pin
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;bus-&gt;parent
)paren
(brace
id|p
op_assign
id|dev-&gt;bus-&gt;parent-&gt;self
suffix:semicolon
id|pin
op_assign
(paren
id|pin
op_plus
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
)paren
op_mod
l_int|4
suffix:semicolon
)brace
r_else
id|p
op_assign
id|dev
suffix:semicolon
id|irq
op_assign
id|visws_get_PCI_irq_vector
c_func
(paren
id|p-&gt;bus-&gt;number
comma
id|PCI_SLOT
c_func
(paren
id|p-&gt;devfn
)paren
comma
id|pin
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_ge
l_int|0
)paren
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|DBG
c_func
(paren
l_string|&quot;PCI IRQ: %s pin %d -&gt; %d&bslash;n&quot;
comma
id|dev-&gt;slot_name
comma
id|pin
comma
id|irq
)paren
suffix:semicolon
)brace
)brace
DECL|function|pcibios_fixup_bus
r_void
id|__init
id|pcibios_fixup_bus
c_func
(paren
r_struct
id|pci_bus
op_star
id|b
)paren
(brace
id|pci_read_bridge_bases
c_func
(paren
id|b
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_struct
id|resource
id|visws_pci_bus_resources
(braket
l_int|2
)braket
op_assign
(brace
(brace
l_string|&quot;Host bus 1&quot;
comma
l_int|0xf4000000
comma
l_int|0xf7ffffff
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Host bus 2&quot;
comma
l_int|0xf0000000
comma
l_int|0xf3ffffff
comma
l_int|0
)brace
)brace
suffix:semicolon
macro_line|#endif
DECL|function|pcibios_init
r_void
id|__init
id|pcibios_init
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|sec_bus
op_assign
id|li_pcib_read16
c_func
(paren
id|LI_PCI_BUSNUM
)paren
op_amp
l_int|0xff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PCI: Probing PCI hardware on host buses 00 and %02x&bslash;n&quot;
comma
id|sec_bus
)paren
suffix:semicolon
id|pci_scan_bus
c_func
(paren
l_int|0
comma
op_amp
id|visws_pci_ops
comma
l_int|NULL
)paren
suffix:semicolon
id|pci_scan_bus
c_func
(paren
id|sec_bus
comma
op_amp
id|visws_pci_ops
comma
l_int|NULL
)paren
suffix:semicolon
id|pcibios_fixup_irqs
c_func
(paren
)paren
suffix:semicolon
id|pcibios_resource_survey
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|pcibios_setup
r_char
op_star
id|__init
id|pcibios_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_return
id|str
suffix:semicolon
)brace
DECL|function|pcibios_enable_device
r_int
id|pcibios_enable_device
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_return
id|pcibios_enable_resources
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|pcibios_penalize_isa_irq
r_void
id|__init
id|pcibios_penalize_isa_irq
c_func
(paren
id|irq
)paren
(brace
)brace
eof
