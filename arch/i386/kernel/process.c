multiline_comment|/*&n; *  linux/arch/i386/kernel/process.c&n; *&n; *  Copyright (C) 1995  Linus Torvalds&n; */
multiline_comment|/*&n; * This file handles the architecture-dependent parts of process handling..&n; */
DECL|macro|__KERNEL_SYSCALLS__
mdefine_line|#define __KERNEL_SYSCALLS__
macro_line|#include &lt;stdarg.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/ldt.h&gt;
macro_line|#include &lt;linux/user.h&gt;
macro_line|#include &lt;linux/a.out.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
id|asmlinkage
r_void
id|ret_from_sys_call
c_func
(paren
r_void
)paren
id|__asm__
c_func
(paren
l_string|&quot;ret_from_sys_call&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_APM
r_extern
r_int
id|apm_do_idle
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|apm_do_busy
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|hlt_counter
r_static
r_int
id|hlt_counter
op_assign
l_int|0
suffix:semicolon
DECL|macro|HARD_IDLE_TIMEOUT
mdefine_line|#define HARD_IDLE_TIMEOUT (HZ / 3)
DECL|function|disable_hlt
r_void
id|disable_hlt
c_func
(paren
r_void
)paren
(brace
id|hlt_counter
op_increment
suffix:semicolon
)brace
DECL|function|enable_hlt
r_void
id|enable_hlt
c_func
(paren
r_void
)paren
(brace
id|hlt_counter
op_decrement
suffix:semicolon
)brace
macro_line|#ifndef __SMP__
DECL|function|hard_idle
r_static
r_void
id|hard_idle
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|need_resched
)paren
(brace
r_if
c_cond
(paren
id|hlt_works_ok
op_logical_and
op_logical_neg
id|hlt_counter
)paren
(brace
macro_line|#ifdef CONFIG_APM
multiline_comment|/* If the APM BIOS is not enabled, or there&n;&t;&t;&t;&t; is an error calling the idle routine, we&n;&t;&t;&t;&t; should hlt if possible.  We need to check&n;&t;&t;&t;&t; need_resched again because an interrupt&n;&t;&t;&t;&t; may have occurred in apm_do_idle(). */
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|apm_do_idle
c_func
(paren
)paren
op_logical_and
op_logical_neg
id|need_resched
)paren
id|__asm__
c_func
(paren
l_string|&quot;hlt&quot;
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
macro_line|#else
id|__asm__
c_func
(paren
l_string|&quot;hlt&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|need_resched
)paren
r_break
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_APM
id|apm_do_busy
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * The idle loop on a uniprocessor i386..&n; */
DECL|function|sys_idle
id|asmlinkage
r_int
id|sys_idle
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|start_idle
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;pid
op_ne
l_int|0
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
multiline_comment|/* endless idle loop with no priority at all */
id|current-&gt;counter
op_assign
op_minus
l_int|100
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;We are locked at this point. So we can safely call&n;&t;&t; *&t;the APM bios knowing only one CPU at a time will do&n;&t;&t; *&t;so.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|start_idle
)paren
id|start_idle
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|jiffies
op_minus
id|start_idle
OG
id|HARD_IDLE_TIMEOUT
)paren
(brace
id|hard_idle
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|hlt_works_ok
op_logical_and
op_logical_neg
id|hlt_counter
op_logical_and
op_logical_neg
id|need_resched
)paren
id|__asm__
c_func
(paren
l_string|&quot;hlt&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|need_resched
)paren
id|start_idle
op_assign
l_int|0
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#else
multiline_comment|/*&n; *&t;In the SMP world we hlt outside of kernel syscall rather than within&n; *&t;so as to get the right locking semantics.&n; */
DECL|function|sys_idle
id|asmlinkage
r_int
id|sys_idle
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;pid
op_ne
l_int|0
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
macro_line|#ifdef __SMP_PROF__
id|smp_spins_sys_idle
(braket
id|smp_processor_id
c_func
(paren
)paren
)braket
op_add_assign
id|smp_spins_syscall_cur
(braket
id|smp_processor_id
c_func
(paren
)paren
)braket
suffix:semicolon
macro_line|#endif
id|current-&gt;counter
op_assign
op_minus
l_int|100
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This is being executed in task 0 &squot;user space&squot;.&n; */
DECL|function|cpu_idle
r_int
id|cpu_idle
c_func
(paren
r_void
op_star
id|unused
)paren
(brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|cpu_data
(braket
id|smp_processor_id
c_func
(paren
)paren
)braket
dot
id|hlt_works_ok
op_logical_and
op_logical_neg
id|hlt_counter
op_logical_and
op_logical_neg
id|need_resched
)paren
(brace
id|__asm
c_func
(paren
l_string|&quot;hlt&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0
op_eq
(paren
l_int|0x7fffffff
op_amp
id|smp_process_available
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|0x80000000
op_amp
id|smp_process_available
)paren
(brace
suffix:semicolon
)brace
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|set_bit
c_func
(paren
l_int|31
comma
op_amp
id|smp_process_available
)paren
)paren
r_while
c_loop
(paren
id|test_bit
c_func
(paren
l_int|31
comma
op_amp
id|smp_process_available
)paren
)paren
(brace
multiline_comment|/*&n;                &t; *&t;Oops.. This is kind of important in some cases...&n;                &t; */
r_if
c_cond
(paren
id|clear_bit
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
comma
op_amp
id|smp_invalidate_needed
)paren
)paren
(brace
id|local_flush_tlb
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
l_int|0
op_eq
(paren
l_int|0x7fffffff
op_amp
id|smp_process_available
)paren
)paren
(brace
id|clear_bit
c_func
(paren
l_int|31
comma
op_amp
id|smp_process_available
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|smp_process_available
op_decrement
suffix:semicolon
id|clear_bit
c_func
(paren
l_int|31
comma
op_amp
id|smp_process_available
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|idle
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*&n; * This routine reboots the machine by asking the keyboard&n; * controller to pulse the reset-line low. We try that for a while,&n; * and if it doesn&squot;t work, we do some other stupid things.&n; */
DECL|variable|no_idt
r_static
r_int
id|no_idt
(braket
l_int|2
)braket
op_assign
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|function|kb_wait
r_static
r_inline
r_void
id|kb_wait
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10000
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|inb_p
c_func
(paren
l_int|0x64
)paren
op_amp
l_int|0x02
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
DECL|function|hard_reset_now
r_void
id|hard_reset_now
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* rebooting needs to touch the page at absolute addr 0 */
id|pg0
(braket
l_int|0
)braket
op_assign
l_int|7
suffix:semicolon
op_star
(paren
(paren
r_int
r_int
op_star
)paren
l_int|0x472
)paren
op_assign
l_int|0x1234
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
id|kb_wait
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|100000
suffix:semicolon
id|j
op_increment
)paren
(brace
multiline_comment|/* nothing */
suffix:semicolon
)brace
id|outb
c_func
(paren
l_int|0xfe
comma
l_int|0x64
)paren
suffix:semicolon
multiline_comment|/* pulse reset low */
)brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;&bslash;tlidt %0&quot;
suffix:colon
l_string|&quot;=m&quot;
(paren
id|no_idt
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|show_regs
r_void
id|show_regs
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;EIP: %04x:[&lt;%08lx&gt;]&quot;
comma
l_int|0xffff
op_amp
id|regs-&gt;cs
comma
id|regs-&gt;eip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;cs
op_amp
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot; ESP: %04x:%08lx&quot;
comma
l_int|0xffff
op_amp
id|regs-&gt;ss
comma
id|regs-&gt;esp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; EFLAGS: %08lx&bslash;n&quot;
comma
id|regs-&gt;eflags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;EAX: %08lx EBX: %08lx ECX: %08lx EDX: %08lx&bslash;n&quot;
comma
id|regs-&gt;eax
comma
id|regs-&gt;ebx
comma
id|regs-&gt;ecx
comma
id|regs-&gt;edx
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ESI: %08lx EDI: %08lx EBP: %08lx&quot;
comma
id|regs-&gt;esi
comma
id|regs-&gt;edi
comma
id|regs-&gt;ebp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; DS: %04x ES: %04x FS: %04x GS: %04x&bslash;n&quot;
comma
l_int|0xffff
op_amp
id|regs-&gt;ds
comma
l_int|0xffff
op_amp
id|regs-&gt;es
comma
l_int|0xffff
op_amp
id|regs-&gt;fs
comma
l_int|0xffff
op_amp
id|regs-&gt;gs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Free current thread data structures etc..&n; */
DECL|function|exit_thread
r_void
id|exit_thread
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* forget lazy i387 state */
r_if
c_cond
(paren
id|last_task_used_math
op_eq
id|current
)paren
id|last_task_used_math
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* forget local segments */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;mov %w0,%%fs ; mov %w0,%%gs ; lldt %w0&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|current-&gt;tss.ldt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;ldt
)paren
(brace
r_void
op_star
id|ldt
op_assign
id|current-&gt;ldt
suffix:semicolon
id|current-&gt;ldt
op_assign
l_int|NULL
suffix:semicolon
id|vfree
c_func
(paren
id|ldt
)paren
suffix:semicolon
)brace
)brace
DECL|function|flush_thread
r_void
id|flush_thread
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;ldt
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|current-&gt;ldt
)paren
suffix:semicolon
id|current-&gt;ldt
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|NR_TASKS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|task
(braket
id|i
)braket
op_eq
id|current
)paren
(brace
id|set_ldt_desc
c_func
(paren
id|gdt
op_plus
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
id|FIRST_LDT_ENTRY
comma
op_amp
id|default_ldt
comma
l_int|1
)paren
suffix:semicolon
id|load_ldt
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|current-&gt;debugreg
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Forget coprocessor state..&n;&t; */
macro_line|#ifdef __SMP__
r_if
c_cond
(paren
id|current-&gt;flags
op_amp
id|PF_USEDFPU
)paren
(brace
id|stts
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
id|last_task_used_math
op_eq
id|current
)paren
(brace
id|last_task_used_math
op_assign
l_int|NULL
suffix:semicolon
id|stts
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|current-&gt;used_math
op_assign
l_int|0
suffix:semicolon
id|current-&gt;flags
op_and_assign
op_complement
id|PF_USEDFPU
suffix:semicolon
)brace
DECL|function|release_thread
r_void
id|release_thread
c_func
(paren
r_struct
id|task_struct
op_star
id|dead_task
)paren
(brace
)brace
DECL|function|copy_thread
r_void
id|copy_thread
c_func
(paren
r_int
id|nr
comma
r_int
r_int
id|clone_flags
comma
r_int
r_int
id|esp
comma
r_struct
id|task_struct
op_star
id|p
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|pt_regs
op_star
id|childregs
suffix:semicolon
id|p-&gt;tss.es
op_assign
id|KERNEL_DS
suffix:semicolon
id|p-&gt;tss.cs
op_assign
id|KERNEL_CS
suffix:semicolon
id|p-&gt;tss.ss
op_assign
id|KERNEL_DS
suffix:semicolon
id|p-&gt;tss.ds
op_assign
id|KERNEL_DS
suffix:semicolon
id|p-&gt;tss.fs
op_assign
id|USER_DS
suffix:semicolon
id|p-&gt;tss.gs
op_assign
id|KERNEL_DS
suffix:semicolon
id|p-&gt;tss.ss0
op_assign
id|KERNEL_DS
suffix:semicolon
id|p-&gt;tss.esp0
op_assign
id|p-&gt;kernel_stack_page
op_plus
id|PAGE_SIZE
suffix:semicolon
id|p-&gt;tss.tr
op_assign
id|_TSS
c_func
(paren
id|nr
)paren
suffix:semicolon
id|childregs
op_assign
(paren
(paren
r_struct
id|pt_regs
op_star
)paren
(paren
id|p-&gt;kernel_stack_page
op_plus
id|PAGE_SIZE
)paren
)paren
op_minus
l_int|1
suffix:semicolon
id|p-&gt;tss.esp
op_assign
(paren
r_int
r_int
)paren
id|childregs
suffix:semicolon
id|p-&gt;tss.eip
op_assign
(paren
r_int
r_int
)paren
id|ret_from_sys_call
suffix:semicolon
op_star
id|childregs
op_assign
op_star
id|regs
suffix:semicolon
id|childregs-&gt;eax
op_assign
l_int|0
suffix:semicolon
id|childregs-&gt;esp
op_assign
id|esp
suffix:semicolon
id|p-&gt;tss.back_link
op_assign
l_int|0
suffix:semicolon
id|p-&gt;tss.eflags
op_assign
id|regs-&gt;eflags
op_amp
l_int|0xffffcfff
suffix:semicolon
multiline_comment|/* iopl is always 0 for a new process */
id|p-&gt;tss.ldt
op_assign
id|_LDT
c_func
(paren
id|nr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;ldt
)paren
(brace
id|p-&gt;ldt
op_assign
(paren
r_struct
id|desc_struct
op_star
)paren
id|vmalloc
c_func
(paren
id|LDT_ENTRIES
op_star
id|LDT_ENTRY_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;ldt
op_ne
l_int|NULL
)paren
id|memcpy
c_func
(paren
id|p-&gt;ldt
comma
id|current-&gt;ldt
comma
id|LDT_ENTRIES
op_star
id|LDT_ENTRY_SIZE
)paren
suffix:semicolon
)brace
id|set_tss_desc
c_func
(paren
id|gdt
op_plus
(paren
id|nr
op_lshift
l_int|1
)paren
op_plus
id|FIRST_TSS_ENTRY
comma
op_amp
(paren
id|p-&gt;tss
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;ldt
)paren
id|set_ldt_desc
c_func
(paren
id|gdt
op_plus
(paren
id|nr
op_lshift
l_int|1
)paren
op_plus
id|FIRST_LDT_ENTRY
comma
id|p-&gt;ldt
comma
l_int|512
)paren
suffix:semicolon
r_else
id|set_ldt_desc
c_func
(paren
id|gdt
op_plus
(paren
id|nr
op_lshift
l_int|1
)paren
op_plus
id|FIRST_LDT_ENTRY
comma
op_amp
id|default_ldt
comma
l_int|1
)paren
suffix:semicolon
id|p-&gt;tss.bitmap
op_assign
m_offsetof
(paren
r_struct
id|thread_struct
comma
id|io_bitmap
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IO_BITMAP_SIZE
op_plus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* IO bitmap is actually SIZE+1 */
id|p-&gt;tss.io_bitmap
(braket
id|i
)braket
op_assign
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|last_task_used_math
op_eq
id|current
)paren
id|__asm__
c_func
(paren
l_string|&quot;clts ; fnsave %0 ; frstor %0&quot;
suffix:colon
l_string|&quot;=m&quot;
(paren
id|p-&gt;tss.i387
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * fill in the fpu structure for a core dump..&n; */
DECL|function|dump_fpu
r_int
id|dump_fpu
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_struct
id|user_i387_struct
op_star
id|fpu
)paren
(brace
r_int
id|fpvalid
suffix:semicolon
multiline_comment|/* Flag indicating the math stuff is valid. We don&squot;t support this for the&n;   soft-float routines yet */
r_if
c_cond
(paren
id|hard_math
)paren
(brace
r_if
c_cond
(paren
(paren
id|fpvalid
op_assign
id|current-&gt;used_math
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|last_task_used_math
op_eq
id|current
)paren
id|__asm__
c_func
(paren
l_string|&quot;clts ; fnsave %0&quot;
suffix:colon
suffix:colon
l_string|&quot;m&quot;
(paren
op_star
id|fpu
)paren
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|fpu
comma
op_amp
id|current-&gt;tss.i387.hard
comma
r_sizeof
(paren
op_star
id|fpu
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* we should dump the emulator state here, but we need to&n;&t;&t;   convert it into standard 387 format first.. */
id|fpvalid
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|fpvalid
suffix:semicolon
)brace
multiline_comment|/*&n; * fill in the user structure for a core dump..&n; */
DECL|function|dump_thread
r_void
id|dump_thread
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_struct
id|user
op_star
id|dump
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* changed the size calculations - should hopefully work better. lbt */
id|dump-&gt;magic
op_assign
id|CMAGIC
suffix:semicolon
id|dump-&gt;start_code
op_assign
l_int|0
suffix:semicolon
id|dump-&gt;start_stack
op_assign
id|regs-&gt;esp
op_amp
op_complement
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|dump-&gt;u_tsize
op_assign
(paren
(paren
r_int
r_int
)paren
id|current-&gt;mm-&gt;end_code
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|dump-&gt;u_dsize
op_assign
(paren
(paren
r_int
r_int
)paren
(paren
id|current-&gt;mm-&gt;brk
op_plus
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|dump-&gt;u_dsize
op_sub_assign
id|dump-&gt;u_tsize
suffix:semicolon
id|dump-&gt;u_ssize
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|dump-&gt;u_debugreg
(braket
id|i
)braket
op_assign
id|current-&gt;debugreg
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dump-&gt;start_stack
OL
id|TASK_SIZE
)paren
id|dump-&gt;u_ssize
op_assign
(paren
(paren
r_int
r_int
)paren
(paren
id|TASK_SIZE
op_minus
id|dump-&gt;start_stack
)paren
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|dump-&gt;regs
op_assign
op_star
id|regs
suffix:semicolon
id|dump-&gt;u_fpvalid
op_assign
id|dump_fpu
(paren
id|regs
comma
op_amp
id|dump-&gt;i387
)paren
suffix:semicolon
)brace
DECL|function|sys_fork
id|asmlinkage
r_int
id|sys_fork
c_func
(paren
r_struct
id|pt_regs
id|regs
)paren
(brace
r_return
id|do_fork
c_func
(paren
id|SIGCHLD
comma
id|regs.esp
comma
op_amp
id|regs
)paren
suffix:semicolon
)brace
DECL|function|sys_clone
id|asmlinkage
r_int
id|sys_clone
c_func
(paren
r_struct
id|pt_regs
id|regs
)paren
(brace
r_int
r_int
id|clone_flags
suffix:semicolon
r_int
r_int
id|newsp
suffix:semicolon
id|clone_flags
op_assign
id|regs.ebx
suffix:semicolon
id|newsp
op_assign
id|regs.ecx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newsp
)paren
id|newsp
op_assign
id|regs.esp
suffix:semicolon
r_return
id|do_fork
c_func
(paren
id|clone_flags
comma
id|newsp
comma
op_amp
id|regs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * sys_execve() executes a new program.&n; */
DECL|function|sys_execve
id|asmlinkage
r_int
id|sys_execve
c_func
(paren
r_struct
id|pt_regs
id|regs
)paren
(brace
r_int
id|error
suffix:semicolon
r_char
op_star
id|filename
suffix:semicolon
id|error
op_assign
id|getname
c_func
(paren
(paren
r_char
op_star
)paren
id|regs.ebx
comma
op_amp
id|filename
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|error
op_assign
id|do_execve
c_func
(paren
id|filename
comma
(paren
r_char
op_star
op_star
)paren
id|regs.ecx
comma
(paren
r_char
op_star
op_star
)paren
id|regs.edx
comma
op_amp
id|regs
)paren
suffix:semicolon
id|putname
c_func
(paren
id|filename
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
eof
