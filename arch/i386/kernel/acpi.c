multiline_comment|/*&n; *  acpi.c - Linux ACPI driver&n; *&n; *  Copyright (C) 1999 Andrew Henroid&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
multiline_comment|/*&n; * See http://www.geocities.com/SiliconValley/Hardware/3165/&n; * for the user-level ACPI stuff&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/miscdevice.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/acpi.h&gt;
multiline_comment|/*&n; * Yes, it&squot;s unfortunate that we are relying on get_cmos_time&n; * because it is slow (&gt; 1 sec.) and i386 only.&t; It might be better&n; * to use some of the code from drivers/char/rtc.c in the near future&n; */
r_extern
r_int
r_int
id|get_cmos_time
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|acpi_control_thread
c_func
(paren
r_void
op_star
id|context
)paren
suffix:semicolon
r_static
r_int
id|acpi_do_ulong
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
suffix:semicolon
r_static
r_int
id|acpi_do_event_reg
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
suffix:semicolon
r_static
r_int
id|acpi_do_event
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
suffix:semicolon
r_static
r_int
id|acpi_do_sleep
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
suffix:semicolon
DECL|variable|acpi_control_wait
id|DECLARE_WAIT_QUEUE_HEAD
c_func
(paren
id|acpi_control_wait
)paren
suffix:semicolon
DECL|variable|acpi_sysctl
r_static
r_struct
id|ctl_table_header
op_star
id|acpi_sysctl
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|acpi_facp
r_static
r_struct
id|acpi_facp
op_star
id|acpi_facp
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|acpi_fake_facp
r_static
r_int
id|acpi_fake_facp
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_facs
r_static
r_struct
id|acpi_facs
op_star
id|acpi_facs
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|acpi_facp_addr
r_static
r_int
r_int
id|acpi_facp_addr
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_dsdt_addr
r_static
r_int
r_int
id|acpi_dsdt_addr
op_assign
l_int|0
suffix:semicolon
singleline_comment|// current system sleep state (S0 - S4)
DECL|variable|acpi_sleep_state
r_static
id|acpi_sstate_t
id|acpi_sleep_state
op_assign
id|ACPI_S0
suffix:semicolon
singleline_comment|// time sleep began
DECL|variable|acpi_sleep_start
r_static
r_int
r_int
id|acpi_sleep_start
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_event_lock
r_static
id|spinlock_t
id|acpi_event_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|acpi_pm1_status
r_static
r_volatile
id|u32
id|acpi_pm1_status
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_gpe_status
r_static
r_volatile
id|u32
id|acpi_gpe_status
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_gpe_level
r_static
r_volatile
id|u32
id|acpi_gpe_level
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_event_state
r_static
r_volatile
id|acpi_sstate_t
id|acpi_event_state
op_assign
id|ACPI_S0
suffix:semicolon
r_static
id|DECLARE_WAIT_QUEUE_HEAD
c_func
(paren
id|acpi_event_wait
)paren
suffix:semicolon
multiline_comment|/* Make it impossible to enter C2/C3 until after we&squot;ve initialized */
DECL|variable|acpi_enter_lvl2_lat
r_static
r_int
r_int
id|acpi_enter_lvl2_lat
op_assign
id|ACPI_INFINITE_LAT
suffix:semicolon
DECL|variable|acpi_enter_lvl3_lat
r_static
r_int
r_int
id|acpi_enter_lvl3_lat
op_assign
id|ACPI_INFINITE_LAT
suffix:semicolon
DECL|variable|acpi_p_lvl2_lat
r_static
r_int
r_int
id|acpi_p_lvl2_lat
op_assign
id|ACPI_INFINITE_LAT
suffix:semicolon
DECL|variable|acpi_p_lvl3_lat
r_static
r_int
r_int
id|acpi_p_lvl3_lat
op_assign
id|ACPI_INFINITE_LAT
suffix:semicolon
DECL|variable|acpi_p_blk
r_static
r_int
r_int
id|acpi_p_blk
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_p_lvl2_tested
r_static
r_int
id|acpi_p_lvl2_tested
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_p_lvl3_tested
r_static
r_int
id|acpi_p_lvl3_tested
op_assign
l_int|0
suffix:semicolon
DECL|variable|acpi_disabled
r_static
r_int
id|acpi_disabled
op_assign
l_int|0
suffix:semicolon
singleline_comment|// bits 8-15 are SLP_TYPa, bits 0-7 are SLP_TYPb
DECL|variable|acpi_slp_typ
r_static
r_int
r_int
id|acpi_slp_typ
(braket
)braket
op_assign
(brace
id|ACPI_SLP_TYP_DISABLED
comma
multiline_comment|/* S0 */
id|ACPI_SLP_TYP_DISABLED
comma
multiline_comment|/* S1 */
id|ACPI_SLP_TYP_DISABLED
comma
multiline_comment|/* S2 */
id|ACPI_SLP_TYP_DISABLED
comma
multiline_comment|/* S3 */
id|ACPI_SLP_TYP_DISABLED
comma
multiline_comment|/* S4 */
id|ACPI_SLP_TYP_DISABLED
multiline_comment|/* S5 */
)brace
suffix:semicolon
DECL|variable|acpi_table
r_static
r_struct
id|ctl_table
id|acpi_table
(braket
)braket
op_assign
(brace
(brace
id|ACPI_FACP
comma
l_string|&quot;facp&quot;
comma
op_amp
id|acpi_facp_addr
comma
r_sizeof
(paren
id|acpi_facp_addr
)paren
comma
l_int|0400
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_DSDT
comma
l_string|&quot;dsdt&quot;
comma
op_amp
id|acpi_dsdt_addr
comma
r_sizeof
(paren
id|acpi_dsdt_addr
)paren
comma
l_int|0400
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_PM1_ENABLE
comma
l_string|&quot;pm1_enable&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0600
comma
l_int|NULL
comma
op_amp
id|acpi_do_event_reg
)brace
comma
(brace
id|ACPI_GPE_ENABLE
comma
l_string|&quot;gpe_enable&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0600
comma
l_int|NULL
comma
op_amp
id|acpi_do_event_reg
)brace
comma
(brace
id|ACPI_GPE_LEVEL
comma
l_string|&quot;gpe_level&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0600
comma
l_int|NULL
comma
op_amp
id|acpi_do_event_reg
)brace
comma
(brace
id|ACPI_EVENT
comma
l_string|&quot;event&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0400
comma
l_int|NULL
comma
op_amp
id|acpi_do_event
)brace
comma
(brace
id|ACPI_P_BLK
comma
l_string|&quot;p_blk&quot;
comma
op_amp
id|acpi_p_blk
comma
r_sizeof
(paren
id|acpi_p_blk
)paren
comma
l_int|0600
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_P_LVL2_LAT
comma
l_string|&quot;p_lvl2_lat&quot;
comma
op_amp
id|acpi_p_lvl2_lat
comma
r_sizeof
(paren
id|acpi_p_lvl2_lat
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_P_LVL3_LAT
comma
l_string|&quot;p_lvl3_lat&quot;
comma
op_amp
id|acpi_p_lvl3_lat
comma
r_sizeof
(paren
id|acpi_p_lvl3_lat
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_P_LVL2_LAT
comma
l_string|&quot;enter_lvl2_lat&quot;
comma
op_amp
id|acpi_enter_lvl2_lat
comma
r_sizeof
(paren
id|acpi_enter_lvl2_lat
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_ENTER_LVL3_LAT
comma
l_string|&quot;enter_lvl3_lat&quot;
comma
op_amp
id|acpi_enter_lvl3_lat
comma
r_sizeof
(paren
id|acpi_enter_lvl3_lat
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_S0_SLP_TYP
comma
l_string|&quot;s0_slp_typ&quot;
comma
op_amp
id|acpi_slp_typ
(braket
id|ACPI_S0
)braket
comma
r_sizeof
(paren
id|acpi_slp_typ
(braket
id|ACPI_S0
)braket
)paren
comma
l_int|0600
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_S1_SLP_TYP
comma
l_string|&quot;s1_slp_typ&quot;
comma
op_amp
id|acpi_slp_typ
(braket
id|ACPI_S1
)braket
comma
r_sizeof
(paren
id|acpi_slp_typ
(braket
id|ACPI_S1
)braket
)paren
comma
l_int|0600
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_S5_SLP_TYP
comma
l_string|&quot;s5_slp_typ&quot;
comma
op_amp
id|acpi_slp_typ
(braket
id|ACPI_S5
)braket
comma
r_sizeof
(paren
id|acpi_slp_typ
(braket
id|ACPI_S5
)braket
)paren
comma
l_int|0600
comma
l_int|NULL
comma
op_amp
id|acpi_do_ulong
)brace
comma
(brace
id|ACPI_SLEEP
comma
l_string|&quot;sleep&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0600
comma
l_int|NULL
comma
op_amp
id|acpi_do_sleep
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|acpi_dir_table
r_static
r_struct
id|ctl_table
id|acpi_dir_table
(braket
)braket
op_assign
(brace
(brace
id|CTL_ACPI
comma
l_string|&quot;acpi&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|acpi_table
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
r_static
id|u32
id|FASTCALL
c_func
(paren
id|acpi_read_pm1_control
c_func
(paren
r_struct
id|acpi_facp
op_star
)paren
)paren
suffix:semicolon
r_static
id|u32
id|FASTCALL
c_func
(paren
id|acpi_read_pm1_status
c_func
(paren
r_struct
id|acpi_facp
op_star
)paren
)paren
suffix:semicolon
r_static
id|u32
id|FASTCALL
c_func
(paren
id|acpi_read_pm1_enable
c_func
(paren
r_struct
id|acpi_facp
op_star
)paren
)paren
suffix:semicolon
r_static
id|u32
id|FASTCALL
c_func
(paren
id|acpi_read_gpe_status
c_func
(paren
r_struct
id|acpi_facp
op_star
)paren
)paren
suffix:semicolon
r_static
id|u32
id|FASTCALL
c_func
(paren
id|acpi_read_gpe_enable
c_func
(paren
r_struct
id|acpi_facp
op_star
)paren
)paren
suffix:semicolon
r_static
r_void
id|FASTCALL
c_func
(paren
id|acpi_write_pm1_control
c_func
(paren
r_struct
id|acpi_facp
op_star
comma
id|u32
)paren
)paren
suffix:semicolon
r_static
r_void
id|FASTCALL
c_func
(paren
id|acpi_write_pm1_status
c_func
(paren
r_struct
id|acpi_facp
op_star
comma
id|u32
)paren
)paren
suffix:semicolon
r_static
r_void
id|FASTCALL
c_func
(paren
id|acpi_write_pm1_enable
c_func
(paren
r_struct
id|acpi_facp
op_star
comma
id|u32
)paren
)paren
suffix:semicolon
r_static
r_void
id|FASTCALL
c_func
(paren
id|acpi_write_gpe_status
c_func
(paren
r_struct
id|acpi_facp
op_star
comma
id|u32
)paren
)paren
suffix:semicolon
r_static
r_void
id|FASTCALL
c_func
(paren
id|acpi_write_gpe_enable
c_func
(paren
r_struct
id|acpi_facp
op_star
comma
id|u32
)paren
)paren
suffix:semicolon
multiline_comment|/*&n; * Get the value of the PM1 control register (SCI_EN, ...)&n; */
DECL|function|acpi_read_pm1_control
r_static
id|u32
id|acpi_read_pm1_control
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|u32
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1a_cnt
)paren
id|value
op_assign
id|inw
c_func
(paren
id|facp-&gt;pm1a_cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1b_cnt
)paren
id|value
op_or_assign
id|inw
c_func
(paren
id|facp-&gt;pm1b_cnt
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the value of the PM1 control register (BM_RLD, ...)&n; */
DECL|function|acpi_write_pm1_control
r_static
r_void
id|acpi_write_pm1_control
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
comma
id|u32
id|value
)paren
(brace
r_if
c_cond
(paren
id|facp-&gt;pm1a_cnt
)paren
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1a_cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1b_cnt
)paren
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1b_cnt
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the value of the fixed event status register&n; */
DECL|function|acpi_read_pm1_status
r_static
id|u32
id|acpi_read_pm1_status
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|u32
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1a_evt
)paren
id|value
op_assign
id|inw
c_func
(paren
id|facp-&gt;pm1a_evt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1b_evt
)paren
id|value
op_or_assign
id|inw
c_func
(paren
id|facp-&gt;pm1b_evt
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the value of the fixed event status register (clear events)&n; */
DECL|function|acpi_write_pm1_status
r_static
r_void
id|acpi_write_pm1_status
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
comma
id|u32
id|value
)paren
(brace
r_if
c_cond
(paren
id|facp-&gt;pm1a_evt
)paren
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1a_evt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1b_evt
)paren
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1b_evt
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the value of the fixed event enable register&n; */
DECL|function|acpi_read_pm1_enable
r_static
id|u32
id|acpi_read_pm1_enable
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
r_int
id|offset
op_assign
id|facp-&gt;pm1_evt_len
op_rshift
l_int|1
suffix:semicolon
id|u32
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1a_evt
)paren
id|value
op_assign
id|inw
c_func
(paren
id|facp-&gt;pm1a_evt
op_plus
id|offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1b_evt
)paren
id|value
op_or_assign
id|inw
c_func
(paren
id|facp-&gt;pm1b_evt
op_plus
id|offset
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the value of the fixed event enable register (enable events)&n; */
DECL|function|acpi_write_pm1_enable
r_static
r_void
id|acpi_write_pm1_enable
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
comma
id|u32
id|value
)paren
(brace
r_int
id|offset
op_assign
id|facp-&gt;pm1_evt_len
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1a_evt
)paren
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1a_evt
op_plus
id|offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm1b_evt
)paren
id|outw
c_func
(paren
id|value
comma
id|facp-&gt;pm1b_evt
op_plus
id|offset
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the value of the general-purpose event status register&n; */
DECL|function|acpi_read_gpe_status
r_static
id|u32
id|acpi_read_gpe_status
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|u32
id|value
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|size
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;gpe1
)paren
(brace
id|size
op_assign
id|facp-&gt;gpe1_len
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|size
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|value
op_assign
(paren
id|value
op_lshift
l_int|8
)paren
op_or
id|inb
c_func
(paren
id|facp-&gt;gpe1
op_plus
id|i
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|facp-&gt;gpe0
)paren
(brace
id|size
op_assign
id|facp-&gt;gpe0_len
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|size
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|value
op_assign
(paren
id|value
op_lshift
l_int|8
)paren
op_or
id|inb
c_func
(paren
id|facp-&gt;gpe0
op_plus
id|i
)paren
suffix:semicolon
)brace
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the value of the general-purpose event status register (clear events)&n; */
DECL|function|acpi_write_gpe_status
r_static
r_void
id|acpi_write_gpe_status
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
comma
id|u32
id|value
)paren
(brace
r_int
id|i
comma
id|size
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;gpe0
)paren
(brace
id|size
op_assign
id|facp-&gt;gpe0_len
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
id|value
op_amp
l_int|0xff
comma
id|facp-&gt;gpe0
op_plus
id|i
)paren
suffix:semicolon
id|value
op_rshift_assign
l_int|8
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|facp-&gt;gpe1
)paren
(brace
id|size
op_assign
id|facp-&gt;gpe1_len
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
id|value
op_amp
l_int|0xff
comma
id|facp-&gt;gpe1
op_plus
id|i
)paren
suffix:semicolon
id|value
op_rshift_assign
l_int|8
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * Get the value of the general-purpose event enable register&n; */
DECL|function|acpi_read_gpe_enable
r_static
id|u32
id|acpi_read_gpe_enable
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|u32
id|value
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|size
comma
id|offset
suffix:semicolon
id|offset
op_assign
id|facp-&gt;gpe0_len
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;gpe1
)paren
(brace
id|size
op_assign
id|facp-&gt;gpe1_len
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|size
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|value
op_assign
(paren
id|value
op_lshift
l_int|8
)paren
op_or
id|inb
c_func
(paren
id|facp-&gt;gpe1
op_plus
id|offset
op_plus
id|i
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|facp-&gt;gpe0
)paren
(brace
id|size
op_assign
id|facp-&gt;gpe0_len
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|size
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|value
op_assign
(paren
id|value
op_lshift
l_int|8
)paren
op_or
id|inb
c_func
(paren
id|facp-&gt;gpe0
op_plus
id|offset
op_plus
id|i
)paren
suffix:semicolon
)brace
r_return
id|value
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the value of the general-purpose event enable register (enable events)&n; */
DECL|function|acpi_write_gpe_enable
r_static
r_void
id|acpi_write_gpe_enable
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
comma
id|u32
id|value
)paren
(brace
r_int
id|i
comma
id|offset
suffix:semicolon
id|offset
op_assign
id|facp-&gt;gpe0_len
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;gpe0
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|offset
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
id|value
op_amp
l_int|0xff
comma
id|facp-&gt;gpe0
op_plus
id|offset
op_plus
id|i
)paren
suffix:semicolon
id|value
op_rshift_assign
l_int|8
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|facp-&gt;gpe1
)paren
(brace
id|offset
op_assign
id|facp-&gt;gpe1_len
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|offset
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
id|value
op_amp
l_int|0xff
comma
id|facp-&gt;gpe1
op_plus
id|offset
op_plus
id|i
)paren
suffix:semicolon
id|value
op_rshift_assign
l_int|8
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * Map an ACPI table into virtual memory&n; */
DECL|function|acpi_map_table
r_static
r_struct
id|acpi_table
op_star
id|__init
id|acpi_map_table
c_func
(paren
id|u32
id|addr
)paren
(brace
r_struct
id|acpi_table
op_star
id|table
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|addr
)paren
(brace
singleline_comment|// map table header to determine size
id|table
op_assign
(paren
r_struct
id|acpi_table
op_star
)paren
id|ioremap
c_func
(paren
(paren
r_int
r_int
)paren
id|addr
comma
r_sizeof
(paren
r_struct
id|acpi_table
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|table
)paren
(brace
r_int
r_int
id|table_size
op_assign
id|table-&gt;length
suffix:semicolon
id|iounmap
c_func
(paren
id|table
)paren
suffix:semicolon
singleline_comment|// remap entire table
id|table
op_assign
(paren
r_struct
id|acpi_table
op_star
)paren
id|ioremap
c_func
(paren
(paren
r_int
r_int
)paren
id|addr
comma
id|table_size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|table
)paren
(brace
multiline_comment|/* ioremap is a pain, it returns NULL if the&n;&t;&t;&t; * table starts within mapped physical memory.&n;&t;&t;&t; * Hopefully, no table straddles a mapped/unmapped&n;&t;&t;&t; * physical memory boundary, ugh&n;&t;&t;&t; */
id|table
op_assign
(paren
r_struct
id|acpi_table
op_star
)paren
id|phys_to_virt
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
)brace
r_return
id|table
suffix:semicolon
)brace
multiline_comment|/*&n; * Unmap an ACPI table from virtual memory&n; */
DECL|function|acpi_unmap_table
r_static
r_void
id|acpi_unmap_table
c_func
(paren
r_struct
id|acpi_table
op_star
id|table
)paren
(brace
singleline_comment|// iounmap ignores addresses within physical memory
r_if
c_cond
(paren
id|table
)paren
id|iounmap
c_func
(paren
id|table
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Locate and map ACPI tables&n; */
DECL|function|acpi_find_tables
r_static
r_int
id|__init
id|acpi_find_tables
c_func
(paren
r_void
)paren
(brace
r_struct
id|acpi_rsdp
op_star
id|rsdp
suffix:semicolon
r_struct
id|acpi_table
op_star
id|rsdt
suffix:semicolon
id|u32
op_star
id|rsdt_entry
suffix:semicolon
r_int
id|rsdt_entry_count
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
singleline_comment|// search BIOS memory for RSDP
r_for
c_loop
(paren
id|i
op_assign
id|ACPI_BIOS_ROM_BASE
suffix:semicolon
id|i
OL
id|ACPI_BIOS_ROM_END
suffix:semicolon
id|i
op_add_assign
l_int|16
)paren
(brace
id|rsdp
op_assign
(paren
r_struct
id|acpi_rsdp
op_star
)paren
id|phys_to_virt
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rsdp-&gt;signature
(braket
l_int|0
)braket
op_eq
id|ACPI_RSDP1_SIG
op_logical_and
id|rsdp-&gt;signature
(braket
l_int|1
)braket
op_eq
id|ACPI_RSDP2_SIG
)paren
(brace
r_char
id|oem
(braket
l_int|7
)braket
suffix:semicolon
r_int
id|j
suffix:semicolon
singleline_comment|// strip trailing space and print OEM identifier
id|memcpy
c_func
(paren
id|oem
comma
id|rsdp-&gt;oem
comma
l_int|6
)paren
suffix:semicolon
id|oem
(braket
l_int|6
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|5
suffix:semicolon
id|j
OG
l_int|0
op_logical_and
(paren
id|oem
(braket
id|j
)braket
op_eq
l_char|&squot;&bslash;0&squot;
op_logical_or
id|oem
(braket
id|j
)braket
op_eq
l_char|&squot; &squot;
)paren
suffix:semicolon
id|j
op_decrement
)paren
(brace
id|oem
(braket
id|j
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: &bslash;&quot;%s&bslash;&quot; found at 0x%p&bslash;n&quot;
comma
id|oem
comma
(paren
r_void
op_star
)paren
id|i
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_ge
id|ACPI_BIOS_ROM_END
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
singleline_comment|// fetch RSDT from RSDP
id|rsdt
op_assign
id|acpi_map_table
c_func
(paren
id|rsdp-&gt;rsdt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rsdt
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: missing RSDT at 0x%p&bslash;n&quot;
comma
(paren
r_void
op_star
)paren
id|rsdp-&gt;rsdt
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rsdt-&gt;signature
op_ne
id|ACPI_RSDT_SIG
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: bad RSDT at 0x%p (%08x)&bslash;n&quot;
comma
(paren
r_void
op_star
)paren
id|rsdp-&gt;rsdt
comma
(paren
r_int
)paren
id|rsdt-&gt;signature
)paren
suffix:semicolon
id|acpi_unmap_table
c_func
(paren
id|rsdt
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
singleline_comment|// search RSDT for FACP
id|acpi_facp
op_assign
l_int|NULL
suffix:semicolon
id|rsdt_entry
op_assign
(paren
id|u32
op_star
)paren
(paren
id|rsdt
op_plus
l_int|1
)paren
suffix:semicolon
id|rsdt_entry_count
op_assign
(paren
r_int
)paren
(paren
(paren
id|rsdt-&gt;length
op_minus
r_sizeof
(paren
op_star
id|rsdt
)paren
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rsdt_entry_count
)paren
(brace
r_struct
id|acpi_table
op_star
id|dt
op_assign
id|acpi_map_table
c_func
(paren
op_star
id|rsdt_entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dt
op_logical_and
id|dt-&gt;signature
op_eq
id|ACPI_FACP_SIG
)paren
(brace
id|acpi_facp
op_assign
(paren
r_struct
id|acpi_facp
op_star
)paren
id|dt
suffix:semicolon
id|acpi_facp_addr
op_assign
op_star
id|rsdt_entry
suffix:semicolon
id|acpi_dsdt_addr
op_assign
id|acpi_facp-&gt;dsdt
suffix:semicolon
singleline_comment|// map FACS if it exists
r_if
c_cond
(paren
id|acpi_facp-&gt;facs
)paren
(brace
id|dt
op_assign
id|acpi_map_table
c_func
(paren
id|acpi_facp-&gt;facs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dt
op_logical_and
id|dt-&gt;signature
op_eq
id|ACPI_FACS_SIG
)paren
(brace
id|acpi_facs
op_assign
(paren
r_struct
id|acpi_facs
op_star
)paren
id|dt
suffix:semicolon
)brace
r_else
(brace
id|acpi_unmap_table
c_func
(paren
id|dt
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|acpi_unmap_table
c_func
(paren
id|dt
)paren
suffix:semicolon
)brace
id|rsdt_entry
op_increment
suffix:semicolon
id|rsdt_entry_count
op_decrement
suffix:semicolon
)brace
id|acpi_unmap_table
c_func
(paren
id|rsdt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_facp
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: missing FACP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Unmap or destroy ACPI tables&n; */
DECL|function|acpi_destroy_tables
r_static
r_void
id|acpi_destroy_tables
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_fake_facp
)paren
id|acpi_unmap_table
c_func
(paren
(paren
r_struct
id|acpi_table
op_star
)paren
id|acpi_facp
)paren
suffix:semicolon
r_else
id|kfree
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
id|acpi_unmap_table
c_func
(paren
(paren
r_struct
id|acpi_table
op_star
)paren
id|acpi_facs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Init PIIX4 device, create a fake FACP&n; */
DECL|function|acpi_init_piix4
r_static
r_int
id|__init
id|acpi_init_piix4
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|u32
id|base
suffix:semicolon
id|u16
id|cmd
suffix:semicolon
id|u8
id|pmregmisc
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|dev
comma
id|PCI_COMMAND
comma
op_amp
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd
op_amp
id|PCI_COMMAND_IO
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|ACPI_PIIX4_PMREGMISC
comma
op_amp
id|pmregmisc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pmregmisc
op_amp
id|ACPI_PIIX4_PMIOSE
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|dev
comma
l_int|0x40
comma
op_amp
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|base
op_amp
id|PCI_BASE_ADDRESS_SPACE_IO
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|base
op_and_assign
id|PCI_BASE_ADDRESS_IO_MASK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|base
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: found PIIX4 at 0x%04x&bslash;n&quot;
comma
id|base
)paren
suffix:semicolon
id|acpi_facp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|acpi_facp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_facp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|acpi_fake_facp
op_assign
l_int|1
suffix:semicolon
id|memset
c_func
(paren
id|acpi_facp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|acpi_facp
)paren
)paren
suffix:semicolon
id|acpi_facp-&gt;int_model
op_assign
id|ACPI_PIIX4_INT_MODEL
suffix:semicolon
id|acpi_facp-&gt;sci_int
op_assign
id|ACPI_PIIX4_SCI_INT
suffix:semicolon
id|acpi_facp-&gt;smi_cmd
op_assign
id|ACPI_PIIX4_SMI_CMD
suffix:semicolon
id|acpi_facp-&gt;acpi_enable
op_assign
id|ACPI_PIIX4_ACPI_ENABLE
suffix:semicolon
id|acpi_facp-&gt;acpi_disable
op_assign
id|ACPI_PIIX4_ACPI_DISABLE
suffix:semicolon
id|acpi_facp-&gt;s4bios_req
op_assign
id|ACPI_PIIX4_S4BIOS_REQ
suffix:semicolon
id|acpi_facp-&gt;pm1a_evt
op_assign
id|base
op_plus
id|ACPI_PIIX4_PM1_EVT
suffix:semicolon
id|acpi_facp-&gt;pm1a_cnt
op_assign
id|base
op_plus
id|ACPI_PIIX4_PM1_CNT
suffix:semicolon
id|acpi_facp-&gt;pm2_cnt
op_assign
id|ACPI_PIIX4_PM2_CNT
suffix:semicolon
id|acpi_facp-&gt;pm_tmr
op_assign
id|base
op_plus
id|ACPI_PIIX4_PM_TMR
suffix:semicolon
id|acpi_facp-&gt;gpe0
op_assign
id|base
op_plus
id|ACPI_PIIX4_GPE0
suffix:semicolon
id|acpi_facp-&gt;pm1_evt_len
op_assign
id|ACPI_PIIX4_PM1_EVT_LEN
suffix:semicolon
id|acpi_facp-&gt;pm1_cnt_len
op_assign
id|ACPI_PIIX4_PM1_CNT_LEN
suffix:semicolon
id|acpi_facp-&gt;pm2_cnt_len
op_assign
id|ACPI_PIIX4_PM2_CNT_LEN
suffix:semicolon
id|acpi_facp-&gt;pm_tm_len
op_assign
id|ACPI_PIIX4_PM_TM_LEN
suffix:semicolon
id|acpi_facp-&gt;gpe0_len
op_assign
id|ACPI_PIIX4_GPE0_LEN
suffix:semicolon
id|acpi_facp-&gt;p_lvl2_lat
op_assign
(paren
id|__u16
)paren
id|ACPI_INFINITE_LAT
suffix:semicolon
id|acpi_facp-&gt;p_lvl3_lat
op_assign
(paren
id|__u16
)paren
id|ACPI_INFINITE_LAT
suffix:semicolon
id|acpi_facp_addr
op_assign
id|virt_to_phys
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
id|acpi_dsdt_addr
op_assign
l_int|0
suffix:semicolon
id|acpi_p_blk
op_assign
id|base
op_plus
id|ACPI_PIIX4_P_BLK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Init VIA ACPI device and create a fake FACP&n; */
DECL|function|acpi_init_via
r_static
r_int
id|__init
id|acpi_init_via
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|u32
id|base
suffix:semicolon
id|u8
id|tmp
comma
id|irq
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|dev
comma
l_int|0x41
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
l_int|0x80
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|tmp
op_amp
l_int|0x10
ques
c_cond
l_int|0x48
suffix:colon
l_int|0x20
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|dev
comma
id|tmp
comma
op_amp
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|base
op_amp
id|PCI_BASE_ADDRESS_SPACE_IO
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|base
op_and_assign
id|PCI_BASE_ADDRESS_IO_MASK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|base
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|dev
comma
l_int|0x42
comma
op_amp
id|irq
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: found %s at 0x%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|base
)paren
suffix:semicolon
id|acpi_facp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|acpi_facp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_facp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|acpi_fake_facp
op_assign
l_int|1
suffix:semicolon
id|memset
c_func
(paren
id|acpi_facp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|acpi_facp
)paren
)paren
suffix:semicolon
id|acpi_facp-&gt;int_model
op_assign
id|ACPI_VIA_INT_MODEL
suffix:semicolon
id|acpi_facp-&gt;sci_int
op_assign
id|irq
suffix:semicolon
id|acpi_facp-&gt;smi_cmd
op_assign
id|base
op_plus
id|ACPI_VIA_SMI_CMD
suffix:semicolon
id|acpi_facp-&gt;acpi_enable
op_assign
id|ACPI_VIA_ACPI_ENABLE
suffix:semicolon
id|acpi_facp-&gt;acpi_disable
op_assign
id|ACPI_VIA_ACPI_DISABLE
suffix:semicolon
id|acpi_facp-&gt;pm1a_evt
op_assign
id|base
op_plus
id|ACPI_VIA_PM1_EVT
suffix:semicolon
id|acpi_facp-&gt;pm1a_cnt
op_assign
id|base
op_plus
id|ACPI_VIA_PM1_CNT
suffix:semicolon
id|acpi_facp-&gt;pm_tmr
op_assign
id|base
op_plus
id|ACPI_VIA_PM_TMR
suffix:semicolon
id|acpi_facp-&gt;gpe0
op_assign
id|base
op_plus
id|ACPI_VIA_GPE0
suffix:semicolon
id|acpi_facp-&gt;pm1_evt_len
op_assign
id|ACPI_VIA_PM1_EVT_LEN
suffix:semicolon
id|acpi_facp-&gt;pm1_cnt_len
op_assign
id|ACPI_VIA_PM1_CNT_LEN
suffix:semicolon
id|acpi_facp-&gt;pm_tm_len
op_assign
id|ACPI_VIA_PM_TM_LEN
suffix:semicolon
id|acpi_facp-&gt;gpe0_len
op_assign
id|ACPI_VIA_GPE0_LEN
suffix:semicolon
id|acpi_facp-&gt;p_lvl2_lat
op_assign
(paren
id|__u16
)paren
id|ACPI_INFINITE_LAT
suffix:semicolon
id|acpi_facp-&gt;p_lvl3_lat
op_assign
(paren
id|__u16
)paren
id|ACPI_INFINITE_LAT
suffix:semicolon
id|acpi_facp-&gt;duty_offset
op_assign
id|ACPI_VIA_DUTY_OFFSET
suffix:semicolon
id|acpi_facp-&gt;duty_width
op_assign
id|ACPI_VIA_DUTY_WIDTH
suffix:semicolon
id|acpi_facp-&gt;day_alarm
op_assign
id|ACPI_VIA_DAY_ALARM
suffix:semicolon
id|acpi_facp-&gt;mon_alarm
op_assign
id|ACPI_VIA_MON_ALARM
suffix:semicolon
id|acpi_facp-&gt;century
op_assign
id|ACPI_VIA_CENTURY
suffix:semicolon
id|acpi_facp_addr
op_assign
id|virt_to_phys
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
id|acpi_dsdt_addr
op_assign
l_int|0
suffix:semicolon
id|acpi_p_blk
op_assign
id|base
op_plus
id|ACPI_VIA_P_BLK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_typedef
r_enum
(brace
DECL|enumerator|CH_UNKNOWN
id|CH_UNKNOWN
op_assign
l_int|0
comma
DECL|enumerator|CH_INTEL_PIIX4
id|CH_INTEL_PIIX4
comma
DECL|enumerator|CH_VIA_586
id|CH_VIA_586
comma
DECL|enumerator|CH_VIA_686A
id|CH_VIA_686A
comma
DECL|typedef|acpi_chip_t
)brace
id|acpi_chip_t
suffix:semicolon
multiline_comment|/* indexed by value of each enum in acpi_chip_t */
r_const
r_static
r_struct
(brace
DECL|member|chip_init
r_int
(paren
op_star
id|chip_init
)paren
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
suffix:semicolon
DECL|variable|acpi_chip_info
)brace
id|acpi_chip_info
(braket
)braket
op_assign
(brace
(brace
l_int|NULL
comma
)brace
comma
(brace
id|acpi_init_piix4
)brace
comma
(brace
id|acpi_init_via
)brace
comma
(brace
id|acpi_init_via
)brace
comma
)brace
suffix:semicolon
DECL|variable|acpi_pci_tbl
r_const
r_static
r_struct
id|pci_device_id
id|acpi_pci_tbl
(braket
)braket
op_assign
(brace
(brace
l_int|0x8086
comma
l_int|0x7113
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_INTEL_PIIX4
)brace
comma
(brace
l_int|0x1106
comma
l_int|0x3040
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_VIA_586
)brace
comma
(brace
l_int|0x1106
comma
l_int|0x3057
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CH_VIA_686A
)brace
comma
(brace
l_int|0
comma
)brace
comma
multiline_comment|/* terminate list */
)brace
suffix:semicolon
DECL|function|acpi_probe
r_static
r_int
id|__init
id|acpi_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_return
id|acpi_chip_info
(braket
id|id-&gt;driver_data
)braket
dot
id|chip_init
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|acpi_driver
r_static
r_struct
id|pci_driver
id|acpi_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;acpi&quot;
comma
id|id_table
suffix:colon
id|acpi_pci_tbl
comma
id|probe
suffix:colon
id|acpi_probe
comma
)brace
suffix:semicolon
DECL|variable|pci_driver_registered
r_static
r_int
id|pci_driver_registered
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n; * Locate a known ACPI chipset&n; */
DECL|function|acpi_find_chipset
r_static
r_int
id|__init
id|acpi_find_chipset
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|pci_register_driver
c_func
(paren
op_amp
id|acpi_driver
)paren
OL
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|pci_driver_registered
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Handle an ACPI SCI (fixed or general purpose event)&n; */
DECL|function|acpi_irq
r_static
r_void
id|acpi_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u32
id|pm1_status
comma
id|gpe_status
comma
id|gpe_level
comma
id|gpe_edge
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
singleline_comment|// detect and clear fixed events
id|pm1_status
op_assign
(paren
id|acpi_read_pm1_status
c_func
(paren
id|acpi_facp
)paren
op_amp
id|acpi_read_pm1_enable
c_func
(paren
id|acpi_facp
)paren
)paren
suffix:semicolon
id|acpi_write_pm1_status
c_func
(paren
id|acpi_facp
comma
id|pm1_status
)paren
suffix:semicolon
singleline_comment|// detect and handle general-purpose events
id|gpe_status
op_assign
(paren
id|acpi_read_gpe_status
c_func
(paren
id|acpi_facp
)paren
op_amp
id|acpi_read_gpe_enable
c_func
(paren
id|acpi_facp
)paren
)paren
suffix:semicolon
id|gpe_level
op_assign
id|gpe_status
op_amp
id|acpi_gpe_level
suffix:semicolon
r_if
c_cond
(paren
id|gpe_level
)paren
(brace
singleline_comment|// disable level-triggered events (re-enabled after handling)
id|acpi_write_gpe_enable
c_func
(paren
id|acpi_facp
comma
id|acpi_read_gpe_enable
c_func
(paren
id|acpi_facp
)paren
op_amp
op_complement
id|gpe_level
)paren
suffix:semicolon
)brace
id|gpe_edge
op_assign
id|gpe_status
op_amp
op_complement
id|gpe_level
suffix:semicolon
r_if
c_cond
(paren
id|gpe_edge
)paren
(brace
singleline_comment|// clear edge-triggered events
r_while
c_loop
(paren
id|acpi_read_gpe_status
c_func
(paren
id|acpi_facp
)paren
op_amp
id|gpe_edge
)paren
id|acpi_write_gpe_status
c_func
(paren
id|acpi_facp
comma
id|gpe_edge
)paren
suffix:semicolon
)brace
singleline_comment|// notify process waiting on /dev/acpi
id|spin_lock_irqsave
c_func
(paren
op_amp
id|acpi_event_lock
comma
id|flags
)paren
suffix:semicolon
id|acpi_pm1_status
op_or_assign
id|pm1_status
suffix:semicolon
id|acpi_gpe_status
op_or_assign
id|gpe_status
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|acpi_event_lock
comma
id|flags
)paren
suffix:semicolon
id|acpi_event_state
op_assign
id|acpi_sleep_state
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|acpi_event_wait
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Is ACPI enabled or not?&n; */
DECL|function|acpi_is_enabled
r_static
r_inline
r_int
id|acpi_is_enabled
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
r_return
(paren
(paren
id|acpi_read_pm1_control
c_func
(paren
id|facp
)paren
op_amp
id|ACPI_SCI_EN
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Enable SCI&n; */
DECL|function|acpi_enable
r_static
r_int
id|acpi_enable
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
r_if
c_cond
(paren
id|facp-&gt;smi_cmd
)paren
id|outb
c_func
(paren
id|facp-&gt;acpi_enable
comma
id|facp-&gt;smi_cmd
)paren
suffix:semicolon
r_return
(paren
id|acpi_is_enabled
c_func
(paren
id|facp
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Disable SCI&n; */
DECL|function|acpi_disable
r_static
r_int
id|acpi_disable
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
singleline_comment|// disable and clear any pending events
id|acpi_write_gpe_enable
c_func
(paren
id|facp
comma
l_int|0
)paren
suffix:semicolon
r_while
c_loop
(paren
id|acpi_read_gpe_status
c_func
(paren
id|facp
)paren
)paren
id|acpi_write_gpe_status
c_func
(paren
id|facp
comma
id|acpi_read_gpe_status
c_func
(paren
id|facp
)paren
)paren
suffix:semicolon
id|acpi_write_pm1_enable
c_func
(paren
id|facp
comma
l_int|0
)paren
suffix:semicolon
id|acpi_write_pm1_status
c_func
(paren
id|facp
comma
id|acpi_read_pm1_status
c_func
(paren
id|facp
)paren
)paren
suffix:semicolon
multiline_comment|/* writing acpi_disable to smi_cmd would be appropriate&n;&t; * here but this causes a nasty crash on many systems&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bm_activity
r_static
r_inline
r_int
id|bm_activity
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
r_return
id|acpi_read_pm1_status
c_func
(paren
id|facp
)paren
op_amp
id|ACPI_BM
suffix:semicolon
)brace
DECL|function|clear_bm_activity
r_static
r_inline
r_void
id|clear_bm_activity
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|acpi_write_pm1_status
c_func
(paren
id|facp
comma
id|ACPI_BM
)paren
suffix:semicolon
)brace
DECL|function|sleep_on_busmaster
r_static
r_void
id|sleep_on_busmaster
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|u32
id|pm1_cntr
op_assign
id|acpi_read_pm1_control
c_func
(paren
id|facp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pm1_cntr
op_amp
id|ACPI_BM_RLD
)paren
(brace
id|pm1_cntr
op_and_assign
op_complement
id|ACPI_BM_RLD
suffix:semicolon
id|acpi_write_pm1_control
c_func
(paren
id|facp
comma
id|pm1_cntr
)paren
suffix:semicolon
)brace
)brace
DECL|function|wake_on_busmaster
r_static
r_void
id|wake_on_busmaster
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
id|u32
id|pm1_cntr
op_assign
id|acpi_read_pm1_control
c_func
(paren
id|facp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pm1_cntr
op_amp
id|ACPI_BM_RLD
)paren
)paren
(brace
id|pm1_cntr
op_or_assign
id|ACPI_BM_RLD
suffix:semicolon
id|acpi_write_pm1_control
c_func
(paren
id|facp
comma
id|pm1_cntr
)paren
suffix:semicolon
)brace
id|clear_bm_activity
c_func
(paren
id|facp
)paren
suffix:semicolon
)brace
multiline_comment|/* The ACPI timer is just the low 24 bits */
DECL|macro|TIME_BEGIN
mdefine_line|#define TIME_BEGIN(tmr)&t;&t;&t;inl(tmr)
DECL|macro|TIME_END
mdefine_line|#define TIME_END(tmr, begin)&t;&t;((inl(tmr) - (begin)) &amp; 0x00ffffff)
multiline_comment|/*&n; * Idle loop (uniprocessor only)&n; */
DECL|function|acpi_idle
r_static
r_void
id|acpi_idle
c_func
(paren
r_void
)paren
(brace
r_static
r_int
id|sleep_level
op_assign
l_int|1
suffix:semicolon
r_struct
id|acpi_facp
op_star
id|facp
op_assign
id|acpi_facp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|facp
op_logical_or
op_logical_neg
id|facp-&gt;pm_tmr
op_logical_or
op_logical_neg
id|acpi_p_blk
)paren
r_goto
id|not_initialized
suffix:semicolon
multiline_comment|/*&n;&t; * start from the previous sleep level..&n;&t; */
r_if
c_cond
(paren
id|sleep_level
op_eq
l_int|1
)paren
r_goto
id|sleep1
suffix:semicolon
r_if
c_cond
(paren
id|sleep_level
op_eq
l_int|2
)paren
r_goto
id|sleep2
suffix:semicolon
id|sleep3
suffix:colon
id|sleep_level
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_p_lvl3_tested
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI C3 works&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_p_lvl3_tested
op_assign
l_int|1
suffix:semicolon
)brace
id|wake_on_busmaster
c_func
(paren
id|facp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|facp-&gt;pm2_cnt
)paren
r_goto
id|sleep3_with_arbiter
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|time
suffix:semicolon
r_int
r_int
id|pm_tmr
op_assign
id|facp-&gt;pm_tmr
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;need_resched
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|bm_activity
c_func
(paren
id|facp
)paren
)paren
r_goto
id|sleep2
suffix:semicolon
id|time
op_assign
id|TIME_BEGIN
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|inb
c_func
(paren
id|acpi_p_blk
op_plus
id|ACPI_P_LVL3
)paren
suffix:semicolon
id|inl
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
multiline_comment|/* Dummy read, force synchronization with the PMU */
id|time
op_assign
id|TIME_END
c_func
(paren
id|pm_tmr
comma
id|time
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time
OL
id|acpi_p_lvl3_lat
)paren
r_goto
id|sleep2
suffix:semicolon
)brace
id|sleep3_with_arbiter
suffix:colon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|time
suffix:semicolon
id|u8
id|arbiter
suffix:semicolon
r_int
r_int
id|pm2_cntr
op_assign
id|facp-&gt;pm2_cnt
suffix:semicolon
r_int
r_int
id|pm_tmr
op_assign
id|facp-&gt;pm_tmr
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;need_resched
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|bm_activity
c_func
(paren
id|facp
)paren
)paren
r_goto
id|sleep2
suffix:semicolon
id|time
op_assign
id|TIME_BEGIN
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|arbiter
op_assign
id|inb
c_func
(paren
id|pm2_cntr
)paren
op_amp
op_complement
id|ACPI_ARB_DIS
suffix:semicolon
id|outb
c_func
(paren
id|arbiter
op_or
id|ACPI_ARB_DIS
comma
id|pm2_cntr
)paren
suffix:semicolon
multiline_comment|/* Disable arbiter, park on CPU */
id|inb
c_func
(paren
id|acpi_p_blk
op_plus
id|ACPI_P_LVL3
)paren
suffix:semicolon
id|inl
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
multiline_comment|/* Dummy read, force synchronization with the PMU */
id|time
op_assign
id|TIME_END
c_func
(paren
id|pm_tmr
comma
id|time
)paren
suffix:semicolon
id|outb
c_func
(paren
id|arbiter
comma
id|pm2_cntr
)paren
suffix:semicolon
multiline_comment|/* Enable arbiter again.. */
id|__sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time
OL
id|acpi_p_lvl3_lat
)paren
r_goto
id|sleep2
suffix:semicolon
)brace
id|sleep2
suffix:colon
id|sleep_level
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_p_lvl2_tested
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI C2 works&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_p_lvl2_tested
op_assign
l_int|1
suffix:semicolon
)brace
id|wake_on_busmaster
c_func
(paren
id|facp
)paren
suffix:semicolon
multiline_comment|/* Required to track BM activity.. */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|time
suffix:semicolon
r_int
r_int
id|pm_tmr
op_assign
id|facp-&gt;pm_tmr
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;need_resched
)paren
r_goto
id|out
suffix:semicolon
id|time
op_assign
id|TIME_BEGIN
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|inb
c_func
(paren
id|acpi_p_blk
op_plus
id|ACPI_P_LVL2
)paren
suffix:semicolon
id|inl
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
multiline_comment|/* Dummy read, force synchronization with the PMU */
id|time
op_assign
id|TIME_END
c_func
(paren
id|pm_tmr
comma
id|time
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time
OL
id|acpi_p_lvl2_lat
)paren
r_goto
id|sleep1
suffix:semicolon
r_if
c_cond
(paren
id|bm_activity
c_func
(paren
id|facp
)paren
)paren
(brace
id|clear_bm_activity
c_func
(paren
id|facp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|time
OG
id|acpi_enter_lvl3_lat
)paren
r_goto
id|sleep3
suffix:semicolon
)brace
id|sleep1
suffix:colon
id|sleep_level
op_assign
l_int|1
suffix:semicolon
id|sleep_on_busmaster
c_func
(paren
id|facp
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|time
suffix:semicolon
r_int
r_int
id|pm_tmr
op_assign
id|facp-&gt;pm_tmr
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;need_resched
)paren
r_goto
id|out
suffix:semicolon
id|time
op_assign
id|TIME_BEGIN
c_func
(paren
id|pm_tmr
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sti ; hlt&quot;
suffix:colon
suffix:colon
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|time
op_assign
id|TIME_END
c_func
(paren
id|pm_tmr
comma
id|time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time
OG
id|acpi_enter_lvl2_lat
)paren
r_goto
id|sleep2
suffix:semicolon
)brace
id|not_initialized
suffix:colon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;need_resched
)paren
r_goto
id|out
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sti ; hlt&quot;
suffix:colon
suffix:colon
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|__sti
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Put all devices into specified D-state&n; */
DECL|function|acpi_enter_dx
r_static
r_int
id|acpi_enter_dx
c_func
(paren
id|acpi_dstate_t
id|state
)paren
(brace
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
id|ACPI_D0
)paren
id|status
op_assign
id|pm_send_request
c_func
(paren
id|PM_RESUME
comma
(paren
r_void
op_star
)paren
id|state
)paren
suffix:semicolon
r_else
id|status
op_assign
id|pm_send_request
c_func
(paren
id|PM_SUSPEND
comma
(paren
r_void
op_star
)paren
id|state
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Update system time from real-time clock&n; */
DECL|function|acpi_update_clock
r_static
r_void
id|acpi_update_clock
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|acpi_sleep_start
)paren
(brace
r_int
r_int
id|delta
suffix:semicolon
r_struct
id|timeval
id|tv
suffix:semicolon
id|delta
op_assign
id|get_cmos_time
c_func
(paren
)paren
op_minus
id|acpi_sleep_start
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|tv
)paren
suffix:semicolon
id|tv.tv_sec
op_add_assign
id|delta
suffix:semicolon
id|do_settimeofday
c_func
(paren
op_amp
id|tv
)paren
suffix:semicolon
id|acpi_sleep_start
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Enter system sleep state&n; */
DECL|function|acpi_enter_sx
r_static
r_void
id|acpi_enter_sx
c_func
(paren
id|acpi_sstate_t
id|state
)paren
(brace
r_int
r_int
id|slp_typ
op_assign
id|acpi_slp_typ
(braket
(paren
r_int
)paren
id|state
)braket
suffix:semicolon
r_if
c_cond
(paren
id|slp_typ
op_ne
id|ACPI_SLP_TYP_DISABLED
)paren
(brace
id|u16
id|typa
comma
id|typb
comma
id|value
suffix:semicolon
singleline_comment|// bits 8-15 are SLP_TYPa, bits 0-7 are SLP_TYPb
id|typa
op_assign
(paren
id|slp_typ
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|typb
op_assign
id|slp_typ
op_amp
l_int|0xff
suffix:semicolon
id|typa
op_assign
(paren
(paren
id|typa
op_lshift
id|ACPI_SLP_TYP_SHIFT
)paren
op_amp
id|ACPI_SLP_TYP_MASK
)paren
suffix:semicolon
id|typb
op_assign
(paren
(paren
id|typb
op_lshift
id|ACPI_SLP_TYP_SHIFT
)paren
op_amp
id|ACPI_SLP_TYP_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_ne
id|ACPI_S0
)paren
(brace
id|acpi_sleep_start
op_assign
id|get_cmos_time
c_func
(paren
)paren
suffix:semicolon
id|acpi_enter_dx
c_func
(paren
id|ACPI_D3
)paren
suffix:semicolon
id|acpi_sleep_state
op_assign
id|state
suffix:semicolon
)brace
singleline_comment|// clear wake status
id|acpi_write_pm1_status
c_func
(paren
id|acpi_facp
comma
id|ACPI_WAK
)paren
suffix:semicolon
singleline_comment|// set SLP_TYPa/b and SLP_EN
r_if
c_cond
(paren
id|acpi_facp-&gt;pm1a_cnt
)paren
(brace
id|value
op_assign
id|inw
c_func
(paren
id|acpi_facp-&gt;pm1a_cnt
)paren
op_amp
op_complement
id|ACPI_SLP_TYP_MASK
suffix:semicolon
id|outw
c_func
(paren
id|value
op_or
id|typa
op_or
id|ACPI_SLP_EN
comma
id|acpi_facp-&gt;pm1a_cnt
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_facp-&gt;pm1b_cnt
)paren
(brace
id|value
op_assign
id|inw
c_func
(paren
id|acpi_facp-&gt;pm1b_cnt
)paren
op_amp
op_complement
id|ACPI_SLP_TYP_MASK
suffix:semicolon
id|outw
c_func
(paren
id|value
op_or
id|typb
op_or
id|ACPI_SLP_EN
comma
id|acpi_facp-&gt;pm1b_cnt
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state
op_eq
id|ACPI_S0
)paren
(brace
id|acpi_sleep_state
op_assign
id|state
suffix:semicolon
id|acpi_enter_dx
c_func
(paren
id|ACPI_D0
)paren
suffix:semicolon
id|acpi_sleep_start
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|state
op_eq
id|ACPI_S1
)paren
(brace
singleline_comment|// wait until S1 is entered
r_while
c_loop
(paren
op_logical_neg
(paren
id|acpi_read_pm1_status
c_func
(paren
id|acpi_facp
)paren
op_amp
id|ACPI_WAK
)paren
)paren
suffix:semicolon
singleline_comment|// finished sleeping, update system time
id|acpi_update_clock
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * Enter soft-off (S5)&n; */
DECL|function|acpi_power_off
r_static
r_void
id|acpi_power_off
c_func
(paren
r_void
)paren
(brace
id|acpi_enter_sx
c_func
(paren
id|ACPI_S5
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Claim I/O port if available&n; */
DECL|function|acpi_claim
r_static
r_int
id|acpi_claim
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|size
)paren
(brace
r_if
c_cond
(paren
id|start
op_logical_and
id|size
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|start
comma
id|size
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|request_region
c_func
(paren
id|start
comma
id|size
comma
l_string|&quot;acpi&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Claim ACPI I/O ports&n; */
DECL|function|acpi_claim_ioports
r_static
r_int
id|acpi_claim_ioports
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
singleline_comment|// we don&squot;t get a guarantee of contiguity for any of the ACPI registers
r_if
c_cond
(paren
id|acpi_claim
c_func
(paren
id|facp-&gt;pm1a_evt
comma
id|facp-&gt;pm1_evt_len
)paren
op_logical_or
id|acpi_claim
c_func
(paren
id|facp-&gt;pm1b_evt
comma
id|facp-&gt;pm1_evt_len
)paren
op_logical_or
id|acpi_claim
c_func
(paren
id|facp-&gt;pm1a_cnt
comma
id|facp-&gt;pm1_cnt_len
)paren
op_logical_or
id|acpi_claim
c_func
(paren
id|facp-&gt;pm1b_cnt
comma
id|facp-&gt;pm1_cnt_len
)paren
op_logical_or
id|acpi_claim
c_func
(paren
id|facp-&gt;pm_tmr
comma
id|facp-&gt;pm_tm_len
)paren
op_logical_or
id|acpi_claim
c_func
(paren
id|facp-&gt;gpe0
comma
id|facp-&gt;gpe0_len
)paren
op_logical_or
id|acpi_claim
c_func
(paren
id|facp-&gt;gpe1
comma
id|facp-&gt;gpe1_len
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Release I/O port if claimed&n; */
DECL|function|acpi_release
r_static
r_void
id|acpi_release
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|size
)paren
(brace
r_if
c_cond
(paren
id|start
op_logical_and
id|size
)paren
id|release_region
c_func
(paren
id|start
comma
id|size
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Free ACPI I/O ports&n; */
DECL|function|acpi_release_ioports
r_static
r_int
id|acpi_release_ioports
c_func
(paren
r_struct
id|acpi_facp
op_star
id|facp
)paren
(brace
singleline_comment|// we don&squot;t get a guarantee of contiguity for any of the ACPI registers
id|acpi_release
c_func
(paren
id|facp-&gt;gpe1
comma
id|facp-&gt;gpe1_len
)paren
suffix:semicolon
id|acpi_release
c_func
(paren
id|facp-&gt;gpe0
comma
id|facp-&gt;gpe0_len
)paren
suffix:semicolon
id|acpi_release
c_func
(paren
id|facp-&gt;pm_tmr
comma
id|facp-&gt;pm_tm_len
)paren
suffix:semicolon
id|acpi_release
c_func
(paren
id|facp-&gt;pm1b_cnt
comma
id|facp-&gt;pm1_cnt_len
)paren
suffix:semicolon
id|acpi_release
c_func
(paren
id|facp-&gt;pm1a_cnt
comma
id|facp-&gt;pm1_cnt_len
)paren
suffix:semicolon
id|acpi_release
c_func
(paren
id|facp-&gt;pm1b_evt
comma
id|facp-&gt;pm1_evt_len
)paren
suffix:semicolon
id|acpi_release
c_func
(paren
id|facp-&gt;pm1a_evt
comma
id|facp-&gt;pm1_evt_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Examine/modify value&n; */
DECL|function|acpi_do_ulong
r_static
r_int
id|acpi_do_ulong
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
(brace
r_char
id|str
(braket
l_int|2
op_star
r_sizeof
(paren
r_int
r_int
)paren
op_plus
l_int|4
)braket
comma
op_star
id|strend
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|write
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_pos
)paren
(brace
op_star
id|len
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|val
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|ctl-&gt;data
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;0x%08lx&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|len
op_ge
id|size
)paren
(brace
id|copy_to_user
c_func
(paren
id|buffer
comma
id|str
comma
id|size
)paren
suffix:semicolon
op_star
id|len
op_assign
id|size
suffix:semicolon
)brace
r_else
op_star
id|len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|size
op_assign
r_sizeof
(paren
id|str
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
op_star
id|len
)paren
id|size
op_assign
op_star
id|len
suffix:semicolon
id|copy_from_user
c_func
(paren
id|str
comma
id|buffer
comma
id|size
)paren
suffix:semicolon
id|str
(braket
id|size
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
op_amp
id|strend
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strend
op_eq
id|str
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
op_star
(paren
r_int
r_int
op_star
)paren
id|ctl-&gt;data
op_assign
id|val
suffix:semicolon
)brace
id|file-&gt;f_pos
op_add_assign
op_star
id|len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Examine/modify event register&n; */
DECL|function|acpi_do_event_reg
r_static
r_int
id|acpi_do_event_reg
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
(brace
r_char
id|str
(braket
l_int|2
op_star
r_sizeof
(paren
id|u32
)paren
op_plus
l_int|4
)braket
comma
op_star
id|strend
suffix:semicolon
id|u32
id|val
comma
id|enabling
suffix:semicolon
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|write
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_pos
)paren
(brace
op_star
id|len
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|val
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|ctl-&gt;ctl_name
)paren
(brace
r_case
id|ACPI_PM1_ENABLE
suffix:colon
id|val
op_assign
id|acpi_read_pm1_enable
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_GPE_ENABLE
suffix:colon
id|val
op_assign
id|acpi_read_gpe_enable
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_GPE_LEVEL
suffix:colon
id|val
op_assign
id|acpi_gpe_level
suffix:semicolon
r_break
suffix:semicolon
)brace
id|size
op_assign
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;0x%08x&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|len
op_ge
id|size
)paren
(brace
id|copy_to_user
c_func
(paren
id|buffer
comma
id|str
comma
id|size
)paren
suffix:semicolon
op_star
id|len
op_assign
id|size
suffix:semicolon
)brace
r_else
op_star
id|len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// fetch user value
id|size
op_assign
r_sizeof
(paren
id|str
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
op_star
id|len
)paren
id|size
op_assign
op_star
id|len
suffix:semicolon
id|copy_from_user
c_func
(paren
id|str
comma
id|buffer
comma
id|size
)paren
suffix:semicolon
id|str
(braket
id|size
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|val
op_assign
(paren
id|u32
)paren
id|simple_strtoul
c_func
(paren
id|str
comma
op_amp
id|strend
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strend
op_eq
id|str
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
singleline_comment|// store value in register
r_switch
c_cond
(paren
id|ctl-&gt;ctl_name
)paren
(brace
r_case
id|ACPI_PM1_ENABLE
suffix:colon
singleline_comment|// clear previously disabled events
id|enabling
op_assign
(paren
id|val
op_amp
op_complement
id|acpi_read_pm1_enable
c_func
(paren
id|acpi_facp
)paren
)paren
suffix:semicolon
id|acpi_write_pm1_status
c_func
(paren
id|acpi_facp
comma
id|enabling
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
(brace
singleline_comment|// enable ACPI unless it is already
r_if
c_cond
(paren
op_logical_neg
id|acpi_is_enabled
c_func
(paren
id|acpi_facp
)paren
)paren
id|acpi_enable
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|acpi_read_gpe_enable
c_func
(paren
id|acpi_facp
)paren
)paren
(brace
singleline_comment|// disable ACPI unless it is already
r_if
c_cond
(paren
id|acpi_is_enabled
c_func
(paren
id|acpi_facp
)paren
)paren
id|acpi_disable
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
)brace
id|acpi_write_pm1_enable
c_func
(paren
id|acpi_facp
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_GPE_ENABLE
suffix:colon
singleline_comment|// clear previously disabled events
id|enabling
op_assign
(paren
id|val
op_amp
op_complement
id|acpi_read_gpe_enable
c_func
(paren
id|acpi_facp
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|acpi_read_gpe_status
c_func
(paren
id|acpi_facp
)paren
op_amp
id|enabling
)paren
id|acpi_write_gpe_status
c_func
(paren
id|acpi_facp
comma
id|enabling
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
(brace
singleline_comment|// enable ACPI unless it is already
r_if
c_cond
(paren
op_logical_neg
id|acpi_is_enabled
c_func
(paren
id|acpi_facp
)paren
)paren
id|acpi_enable
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|acpi_read_pm1_enable
c_func
(paren
id|acpi_facp
)paren
)paren
(brace
singleline_comment|// disable ACPI unless it is already
r_if
c_cond
(paren
id|acpi_is_enabled
c_func
(paren
id|acpi_facp
)paren
)paren
id|acpi_disable
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
)brace
id|acpi_write_gpe_enable
c_func
(paren
id|acpi_facp
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_GPE_LEVEL
suffix:colon
id|acpi_gpe_level
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|file-&gt;f_pos
op_add_assign
op_star
id|len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Wait for next event&n; */
DECL|function|acpi_do_event
r_static
r_int
id|acpi_do_event
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
(brace
id|u32
id|pm1_status
op_assign
l_int|0
comma
id|gpe_status
op_assign
l_int|0
suffix:semicolon
id|acpi_sstate_t
id|event_state
op_assign
l_int|0
suffix:semicolon
r_char
id|str
(braket
l_int|27
)braket
suffix:semicolon
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
id|write
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_star
id|len
OL
r_sizeof
(paren
id|str
)paren
)paren
(brace
op_star
id|len
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
singleline_comment|// we need an atomic exchange here
id|spin_lock_irqsave
c_func
(paren
op_amp
id|acpi_event_lock
comma
id|flags
)paren
suffix:semicolon
id|pm1_status
op_assign
id|acpi_pm1_status
suffix:semicolon
id|acpi_pm1_status
op_assign
l_int|0
suffix:semicolon
id|gpe_status
op_assign
id|acpi_gpe_status
suffix:semicolon
id|acpi_gpe_status
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|acpi_event_lock
comma
id|flags
)paren
suffix:semicolon
id|event_state
op_assign
id|acpi_event_state
suffix:semicolon
r_if
c_cond
(paren
id|pm1_status
op_logical_or
id|gpe_status
)paren
r_break
suffix:semicolon
singleline_comment|// wait for an event to arrive
id|interruptible_sleep_on
c_func
(paren
op_amp
id|acpi_event_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|size
op_assign
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;0x%08x 0x%08x 0x%01x&bslash;n&quot;
comma
id|pm1_status
comma
id|gpe_status
comma
id|event_state
)paren
suffix:semicolon
id|copy_to_user
c_func
(paren
id|buffer
comma
id|str
comma
id|size
)paren
suffix:semicolon
op_star
id|len
op_assign
id|size
suffix:semicolon
id|file-&gt;f_pos
op_add_assign
id|size
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Enter system sleep state&n; */
DECL|function|acpi_do_sleep
r_static
r_int
id|acpi_do_sleep
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|len
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|write
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_pos
)paren
(brace
op_star
id|len
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
macro_line|#ifdef CONFIG_ACPI_S1_SLEEP
id|acpi_enter_sx
c_func
(paren
id|ACPI_S1
)paren
suffix:semicolon
id|acpi_enter_sx
c_func
(paren
id|ACPI_S0
)paren
suffix:semicolon
macro_line|#endif
)brace
id|file-&gt;f_pos
op_add_assign
op_star
id|len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialize and enable ACPI&n; */
DECL|function|acpi_init
r_static
r_int
id|__init
id|acpi_init
c_func
(paren
r_void
)paren
(brace
r_int
id|pid
suffix:semicolon
r_if
c_cond
(paren
id|acpi_disabled
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|acpi_find_tables
c_func
(paren
)paren
op_logical_and
id|acpi_find_chipset
c_func
(paren
)paren
)paren
(brace
singleline_comment|// no ACPI tables and not recognized chipset
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Internally we always keep latencies in timer&n;&t; * ticks, which is simpler and more consistent (what is&n;&t; * an uS to us?). Besides, that gives people more&n;&t; * control in the /proc interfaces.&n;&t; */
r_if
c_cond
(paren
id|acpi_facp-&gt;p_lvl2_lat
op_logical_and
id|acpi_facp-&gt;p_lvl2_lat
op_le
id|ACPI_MAX_P_LVL2_LAT
)paren
(brace
id|acpi_p_lvl2_lat
op_assign
id|ACPI_uS_TO_TMR_TICKS
c_func
(paren
id|acpi_facp-&gt;p_lvl2_lat
)paren
suffix:semicolon
id|acpi_enter_lvl2_lat
op_assign
id|ACPI_uS_TO_TMR_TICKS
c_func
(paren
id|ACPI_TMR_HZ
op_div
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_facp-&gt;p_lvl3_lat
op_logical_and
id|acpi_facp-&gt;p_lvl3_lat
op_le
id|ACPI_MAX_P_LVL3_LAT
)paren
(brace
id|acpi_p_lvl3_lat
op_assign
id|ACPI_uS_TO_TMR_TICKS
c_func
(paren
id|acpi_facp-&gt;p_lvl3_lat
)paren
suffix:semicolon
id|acpi_enter_lvl3_lat
op_assign
id|ACPI_uS_TO_TMR_TICKS
c_func
(paren
id|acpi_facp-&gt;p_lvl3_lat
op_star
l_int|5
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_claim_ioports
c_func
(paren
id|acpi_facp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: I/O port allocation failed&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_driver_registered
)paren
id|pci_unregister_driver
c_func
(paren
op_amp
id|acpi_driver
)paren
suffix:semicolon
id|acpi_destroy_tables
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_facp-&gt;sci_int
op_logical_and
id|request_irq
c_func
(paren
id|acpi_facp-&gt;sci_int
comma
id|acpi_irq
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;acpi&quot;
comma
id|acpi_facp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: SCI (IRQ%d) allocation failed&bslash;n&quot;
comma
id|acpi_facp-&gt;sci_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_driver_registered
)paren
id|pci_unregister_driver
c_func
(paren
op_amp
id|acpi_driver
)paren
suffix:semicolon
id|acpi_destroy_tables
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|acpi_sysctl
op_assign
id|register_sysctl_table
c_func
(paren
id|acpi_dir_table
comma
l_int|1
)paren
suffix:semicolon
id|pid
op_assign
id|kernel_thread
c_func
(paren
id|acpi_control_thread
comma
l_int|NULL
comma
id|CLONE_FS
op_or
id|CLONE_FILES
op_or
id|CLONE_SIGHAND
)paren
suffix:semicolon
id|pm_power_off
op_assign
id|acpi_power_off
suffix:semicolon
id|pm_active
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Set up the ACPI idle function. Note that we can&squot;t really&n;&t; * do this with multiple CPU&squot;s, we&squot;d need a per-CPU ACPI&n;&t; * device..&n;&t; */
macro_line|#ifdef CONFIG_SMP
r_if
c_cond
(paren
id|smp_num_cpus
OG
l_int|1
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|acpi_facp-&gt;pm_tmr
)paren
id|pm_idle
op_assign
id|acpi_idle
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Disable and deinitialize ACPI&n; */
DECL|function|acpi_exit
r_static
r_void
id|__exit
id|acpi_exit
c_func
(paren
r_void
)paren
(brace
id|pm_idle
op_assign
l_int|NULL
suffix:semicolon
id|pm_power_off
op_assign
l_int|NULL
suffix:semicolon
id|unregister_sysctl_table
c_func
(paren
id|acpi_sysctl
)paren
suffix:semicolon
id|acpi_disable
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
id|acpi_release_ioports
c_func
(paren
id|acpi_facp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpi_facp-&gt;sci_int
)paren
id|free_irq
c_func
(paren
id|acpi_facp-&gt;sci_int
comma
id|acpi_facp
)paren
suffix:semicolon
id|acpi_destroy_tables
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_driver_registered
)paren
id|pci_unregister_driver
c_func
(paren
op_amp
id|acpi_driver
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Parse kernel command line options&n; */
DECL|function|acpi_setup
r_static
r_int
id|__init
id|acpi_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_while
c_loop
(paren
id|str
op_logical_and
op_star
id|str
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|str
comma
l_string|&quot;off&quot;
comma
l_int|3
)paren
op_eq
l_int|0
)paren
id|acpi_disabled
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|str
comma
l_string|&quot;on&quot;
comma
l_int|2
)paren
op_eq
l_int|0
)paren
id|acpi_disabled
op_assign
l_int|0
suffix:semicolon
id|str
op_assign
id|strpbrk
c_func
(paren
id|str
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|str
)paren
id|str
op_add_assign
id|strspn
c_func
(paren
id|str
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;acpi=&quot;
comma
id|acpi_setup
)paren
suffix:semicolon
multiline_comment|/*&n; * Manage idle devices&n; */
DECL|function|acpi_control_thread
r_static
r_int
id|acpi_control_thread
c_func
(paren
r_void
op_star
id|context
)paren
(brace
id|exit_mm
c_func
(paren
id|current
)paren
suffix:semicolon
id|exit_files
c_func
(paren
id|current
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|current-&gt;comm
comma
l_string|&quot;acpi&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|interruptible_sleep_on
c_func
(paren
op_amp
id|acpi_control_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
singleline_comment|// find all idle devices and set idle timer
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|acpi_init
id|__initcall
c_func
(paren
id|acpi_init
)paren
suffix:semicolon
eof
