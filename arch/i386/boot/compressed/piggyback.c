multiline_comment|/*&n; *&t;linux/zBoot/piggyback.c&n; *&n; *&t;(C) 1993 Hannu Savolainen&n; */
multiline_comment|/*&n; *&t;This program reads the compressed system image from stdin and&n; *&t;encapsulates it into an object file written to the stdout.&n; */
macro_line|#include &lt;stdio.h&gt;
macro_line|#include &lt;unistd.h&gt;
macro_line|#include &lt;a.out.h&gt;
DECL|function|main
r_int
id|main
c_func
(paren
r_int
id|argc
comma
r_char
op_star
id|argv
(braket
)braket
)paren
(brace
r_int
id|c
comma
id|n
op_assign
l_int|0
comma
id|len
op_assign
l_int|0
suffix:semicolon
r_char
id|tmp_buf
(braket
l_int|512
op_star
l_int|1024
)braket
suffix:semicolon
r_struct
id|exec
id|obj
op_assign
(brace
l_int|0x00640107
)brace
suffix:semicolon
multiline_comment|/* object header */
r_char
id|string_names
(braket
)braket
op_assign
(brace
l_string|&quot;_input_data&bslash;0_input_len&bslash;0&quot;
)brace
suffix:semicolon
r_struct
id|nlist
id|var_names
(braket
l_int|2
)braket
op_assign
multiline_comment|/* Symbol table */
(brace
(brace
multiline_comment|/* _input_data&t;*/
(paren
r_char
op_star
)paren
l_int|4
comma
l_int|7
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
multiline_comment|/* _input_len */
(paren
r_char
op_star
)paren
l_int|16
comma
l_int|7
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|n
op_assign
id|read
c_func
(paren
l_int|0
comma
op_amp
id|tmp_buf
(braket
id|len
)braket
comma
r_sizeof
(paren
id|tmp_buf
)paren
op_minus
id|len
op_plus
l_int|1
)paren
)paren
OG
l_int|0
)paren
id|len
op_add_assign
id|n
suffix:semicolon
r_if
c_cond
(paren
id|n
op_eq
op_minus
l_int|1
)paren
(brace
id|perror
c_func
(paren
l_string|&quot;stdin&quot;
)paren
suffix:semicolon
m_exit
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_ge
r_sizeof
(paren
id|tmp_buf
)paren
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;%s: Input too large&bslash;n&quot;
comma
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
m_exit
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;Compressed size %d.&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Output object header&n; */
id|obj.a_data
op_assign
id|len
op_plus
r_sizeof
(paren
r_int
)paren
suffix:semicolon
id|obj.a_syms
op_assign
r_sizeof
(paren
id|var_names
)paren
suffix:semicolon
id|write
c_func
(paren
l_int|1
comma
(paren
r_char
op_star
)paren
op_amp
id|obj
comma
r_sizeof
(paren
id|obj
)paren
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Output data segment (compressed system &amp; len)&n; */
id|write
c_func
(paren
l_int|1
comma
id|tmp_buf
comma
id|len
)paren
suffix:semicolon
id|write
c_func
(paren
l_int|1
comma
(paren
r_char
op_star
)paren
op_amp
id|len
comma
r_sizeof
(paren
id|len
)paren
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Output symbol table&n; */
id|var_names
(braket
l_int|1
)braket
dot
id|n_value
op_assign
id|len
suffix:semicolon
id|write
c_func
(paren
l_int|1
comma
(paren
r_char
op_star
)paren
op_amp
id|var_names
comma
r_sizeof
(paren
id|var_names
)paren
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Output string table&n; */
id|len
op_assign
r_sizeof
(paren
id|string_names
)paren
op_plus
r_sizeof
(paren
id|len
)paren
suffix:semicolon
id|write
c_func
(paren
l_int|1
comma
(paren
r_char
op_star
)paren
op_amp
id|len
comma
r_sizeof
(paren
id|len
)paren
)paren
suffix:semicolon
id|write
c_func
(paren
l_int|1
comma
id|string_names
comma
r_sizeof
(paren
id|string_names
)paren
)paren
suffix:semicolon
m_exit
(paren
l_int|0
)paren
suffix:semicolon
)brace
eof
