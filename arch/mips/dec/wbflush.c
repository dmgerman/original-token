multiline_comment|/*&n; * Setup the right wbflush routine for the different DECstations.&n; *&n; * Created with information from:&n; *      DECstation 3100 Desktop Workstation Functional Specification&n; *      DECstation 5000/200 KN02 System Module Functional Specification&n; *      mipsel-linux-objdump --disassemble vmunix | grep &quot;wbflush&quot; :-)&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 1998 Harald Koerfgen&n; */
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;linux/init.h&gt;
r_static
r_void
id|wbflush_kn01
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|wbflush_kn210
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|wbflush_kn02ba
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|wbflush_kn03
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|__wbflush
r_void
(paren
op_star
id|__wbflush
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|function|wbflush_setup
r_void
id|__init
id|wbflush_setup
c_func
(paren
r_void
)paren
(brace
r_switch
c_cond
(paren
id|mips_machtype
)paren
(brace
r_case
id|MACH_DS23100
suffix:colon
id|__wbflush
op_assign
id|wbflush_kn01
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MACH_DS5100
suffix:colon
multiline_comment|/*  DS5100 MIPSMATE */
id|__wbflush
op_assign
id|wbflush_kn210
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MACH_DS5000_200
suffix:colon
multiline_comment|/* DS5000 3max */
id|__wbflush
op_assign
id|wbflush_kn01
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MACH_DS5000_1XX
suffix:colon
multiline_comment|/* DS5000/100 3min */
id|__wbflush
op_assign
id|wbflush_kn02ba
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MACH_DS5000_2X0
suffix:colon
multiline_comment|/* DS5000/240 3max+ */
id|__wbflush
op_assign
id|wbflush_kn03
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MACH_DS5000_XX
suffix:colon
multiline_comment|/* Personal DS5000/2x */
id|__wbflush
op_assign
id|wbflush_kn02ba
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * For the DS3100 and DS5000/200 the writeback buffer functions&n; * as part of Coprocessor 0.&n; */
DECL|function|wbflush_kn01
r_static
r_void
id|wbflush_kn01
c_func
(paren
r_void
)paren
(brace
id|asm
c_func
(paren
l_string|&quot;.set&bslash;tpush&bslash;n&bslash;t&quot;
l_string|&quot;.set&bslash;tnoreorder&bslash;n&bslash;t&quot;
l_string|&quot;1:&bslash;tbc0f&bslash;t1b&bslash;n&bslash;t&quot;
l_string|&quot;nop&bslash;n&bslash;t&quot;
l_string|&quot;.set&bslash;tpop&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * For the DS5100 the writeback buffer seems to be a part of Coprocessor 3.&n; * But CP3 has to enabled first.&n; */
DECL|function|wbflush_kn210
r_static
r_void
id|wbflush_kn210
c_func
(paren
r_void
)paren
(brace
id|asm
c_func
(paren
l_string|&quot;.set&bslash;tpush&bslash;n&bslash;t&quot;
l_string|&quot;.set&bslash;tnoreorder&bslash;n&bslash;t&quot;
l_string|&quot;mfc0&bslash;t$2,$12&bslash;n&bslash;t&quot;
l_string|&quot;lui&bslash;t$3,0x8000&bslash;n&bslash;t&quot;
l_string|&quot;or&bslash;t$3,$2,$3&bslash;n&bslash;t&quot;
l_string|&quot;mtc0&bslash;t$3,$12&bslash;n&bslash;t&quot;
l_string|&quot;nop&bslash;n&quot;
l_string|&quot;1:&bslash;tbc3f&bslash;t1b&bslash;n&bslash;t&quot;
l_string|&quot;nop&bslash;n&bslash;t&quot;
l_string|&quot;mtc0&bslash;t$2,$12&bslash;n&bslash;t&quot;
l_string|&quot;nop&bslash;n&bslash;t&quot;
l_string|&quot;.set&bslash;tpop&quot;
suffix:colon
suffix:colon
suffix:colon
l_string|&quot;$2&quot;
comma
l_string|&quot;$3&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Looks like some magic with the System Interrupt Mask Register&n; * in the famous IOASIC for kmins and maxines.&n; */
DECL|function|wbflush_kn02ba
r_static
r_void
id|wbflush_kn02ba
c_func
(paren
r_void
)paren
(brace
id|asm
c_func
(paren
l_string|&quot;.set&bslash;tpush&bslash;n&bslash;t&quot;
l_string|&quot;.set&bslash;tnoreorder&bslash;n&bslash;t&quot;
l_string|&quot;lui&bslash;t$2,0xbc04&bslash;n&bslash;t&quot;
l_string|&quot;lw&bslash;t$3,0x120($2)&bslash;n&bslash;t&quot;
l_string|&quot;lw&bslash;t$3,0x120($2)&bslash;n&bslash;t&quot;
l_string|&quot;.set&bslash;tpop&quot;
suffix:colon
suffix:colon
suffix:colon
l_string|&quot;$2&quot;
comma
l_string|&quot;$3&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * The DS500/2x0 doesnt need to write back the WB.&n; */
DECL|function|wbflush_kn03
r_static
r_void
id|wbflush_kn03
c_func
(paren
r_void
)paren
(brace
)brace
macro_line|#ifdef EXPORT_SYMTAB
macro_line|#include &lt;linux/module.h&gt;
DECL|variable|__wbflush
id|EXPORT_SYMBOL
c_func
(paren
id|__wbflush
)paren
suffix:semicolon
macro_line|#endif
eof
