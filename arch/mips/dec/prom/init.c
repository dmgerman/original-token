multiline_comment|/*&n; * init.c: PROM library initialisation code.&n; *&n; * Copyright (C) 1998 Harald Koerfgen&n; *&n; * $Id: init.c,v 1.3 1999/08/09 19:43:13 harald Exp $&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &quot;prom.h&quot;
multiline_comment|/*&n; * PROM Interface (whichprom.c)&n; */
r_typedef
r_struct
(brace
DECL|member|pagesize
r_int
id|pagesize
suffix:semicolon
DECL|member|bitmap
r_int
r_char
id|bitmap
(braket
l_int|0
)braket
suffix:semicolon
DECL|typedef|memmap
)brace
id|memmap
suffix:semicolon
DECL|variable|rex_bootinit
r_int
(paren
op_star
id|rex_bootinit
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|rex_bootread
r_int
(paren
op_star
id|rex_bootread
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|rex_getbitmap
r_int
(paren
op_star
id|rex_getbitmap
)paren
(paren
id|memmap
op_star
)paren
suffix:semicolon
DECL|variable|rex_slot_address
r_int
r_int
op_star
(paren
op_star
id|rex_slot_address
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|variable|rex_gettcinfo
r_void
op_star
(paren
op_star
id|rex_gettcinfo
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|rex_getsysid
r_int
(paren
op_star
id|rex_getsysid
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|rex_clear_cache
r_void
(paren
op_star
id|rex_clear_cache
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|prom_getchar
r_int
(paren
op_star
id|prom_getchar
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|prom_getenv
r_char
op_star
(paren
op_star
id|prom_getenv
)paren
(paren
r_char
op_star
)paren
suffix:semicolon
DECL|variable|prom_printf
r_int
(paren
op_star
id|prom_printf
)paren
(paren
r_char
op_star
comma
dot
dot
dot
)paren
suffix:semicolon
DECL|variable|pmax_open
r_int
(paren
op_star
id|pmax_open
)paren
(paren
r_char
op_star
comma
r_int
)paren
suffix:semicolon
DECL|variable|pmax_lseek
r_int
(paren
op_star
id|pmax_lseek
)paren
(paren
r_int
comma
r_int
comma
r_int
)paren
suffix:semicolon
DECL|variable|pmax_read
r_int
(paren
op_star
id|pmax_read
)paren
(paren
r_int
comma
r_void
op_star
comma
r_int
)paren
suffix:semicolon
DECL|variable|pmax_close
r_int
(paren
op_star
id|pmax_close
)paren
(paren
r_int
)paren
suffix:semicolon
r_extern
r_void
id|prom_meminit
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|prom_identify_arch
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_void
id|prom_init_cmdline
c_func
(paren
r_int
comma
r_char
op_star
op_star
comma
r_int
r_int
)paren
suffix:semicolon
multiline_comment|/*&n; * Detect which PROM&squot;s the DECSTATION has, and set the callback vectors&n; * appropriately.&n; */
DECL|function|which_prom
r_void
id|__init
id|which_prom
c_func
(paren
r_int
r_int
id|magic
comma
r_int
op_star
id|prom_vec
)paren
(brace
multiline_comment|/*&n;&t; * No sign of the REX PROM&squot;s magic number means we assume a non-REX&n;&t; * machine (i.e. we&squot;re on a DS2100/3100, DS5100 or DS5000/2xx)&n;&t; */
r_if
c_cond
(paren
id|magic
op_eq
id|REX_PROM_MAGIC
)paren
(brace
multiline_comment|/*&n;&t;&t; * Set up prom abstraction structure with REX entry points.&n;&t;&t; */
id|rex_bootinit
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_void
)paren
)paren
op_star
(paren
id|prom_vec
op_plus
id|REX_PROM_BOOTINIT
)paren
suffix:semicolon
id|rex_bootread
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_void
)paren
)paren
op_star
(paren
id|prom_vec
op_plus
id|REX_PROM_BOOTREAD
)paren
suffix:semicolon
id|rex_getbitmap
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
id|memmap
op_star
)paren
)paren
op_star
(paren
id|prom_vec
op_plus
id|REX_PROM_GETBITMAP
)paren
suffix:semicolon
id|prom_getchar
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_void
)paren
)paren
op_star
(paren
id|prom_vec
op_plus
id|REX_PROM_GETCHAR
)paren
suffix:semicolon
id|prom_getenv
op_assign
(paren
r_char
op_star
(paren
op_star
)paren
(paren
r_char
op_star
)paren
)paren
op_star
(paren
id|prom_vec
op_plus
id|REX_PROM_GETENV
)paren
suffix:semicolon
id|rex_getsysid
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_void
)paren
)paren
op_star
(paren
id|prom_vec
op_plus
id|REX_PROM_GETSYSID
)paren
suffix:semicolon
id|rex_gettcinfo
op_assign
(paren
r_void
op_star
(paren
op_star
)paren
(paren
r_void
)paren
)paren
op_star
(paren
id|prom_vec
op_plus
id|REX_PROM_GETTCINFO
)paren
suffix:semicolon
id|prom_printf
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_char
op_star
comma
dot
dot
dot
)paren
)paren
op_star
(paren
id|prom_vec
op_plus
id|REX_PROM_PRINTF
)paren
suffix:semicolon
id|rex_slot_address
op_assign
(paren
r_int
r_int
op_star
(paren
op_star
)paren
(paren
r_int
)paren
)paren
op_star
(paren
id|prom_vec
op_plus
id|REX_PROM_SLOTADDR
)paren
suffix:semicolon
id|rex_clear_cache
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_void
)paren
)paren
op_star
(paren
id|prom_vec
op_plus
id|REX_PROM_CLEARCACHE
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Set up prom abstraction structure with non-REX entry points.&n;&t;&t; */
id|prom_getchar
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_void
)paren
)paren
id|PMAX_PROM_GETCHAR
suffix:semicolon
id|prom_getenv
op_assign
(paren
r_char
op_star
(paren
op_star
)paren
(paren
r_char
op_star
)paren
)paren
id|PMAX_PROM_GETENV
suffix:semicolon
id|prom_printf
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_char
op_star
comma
dot
dot
dot
)paren
)paren
id|PMAX_PROM_PRINTF
suffix:semicolon
id|pmax_open
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_char
op_star
comma
r_int
)paren
)paren
id|PMAX_PROM_OPEN
suffix:semicolon
id|pmax_lseek
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
comma
r_int
comma
r_int
)paren
)paren
id|PMAX_PROM_LSEEK
suffix:semicolon
id|pmax_read
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
comma
r_void
op_star
comma
r_int
)paren
)paren
id|PMAX_PROM_READ
suffix:semicolon
id|pmax_close
op_assign
(paren
r_int
(paren
op_star
)paren
(paren
r_int
)paren
)paren
id|PMAX_PROM_CLOSE
suffix:semicolon
)brace
)brace
DECL|function|prom_init
r_int
id|__init
id|prom_init
c_func
(paren
r_int
id|argc
comma
r_char
op_star
op_star
id|argv
comma
r_int
r_int
id|magic
comma
r_int
op_star
id|prom_vec
)paren
(brace
r_extern
r_void
id|dec_machine_halt
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* Determine which PROM&squot;s we have (and therefore which machine we&squot;re on!) */
id|which_prom
c_func
(paren
id|magic
comma
id|prom_vec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|magic
op_eq
id|REX_PROM_MAGIC
)paren
id|rex_clear_cache
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Were we compiled with the right CPU option? */
macro_line|#if defined(CONFIG_CPU_R3000)
r_if
c_cond
(paren
(paren
id|mips_cputype
op_eq
id|CPU_R4000SC
)paren
op_logical_or
(paren
id|mips_cputype
op_eq
id|CPU_R4400SC
)paren
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Sorry, this kernel is compiled for the wrong CPU type!&bslash;n&quot;
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;Please recompile with &bslash;&quot;CONFIG_CPU_R4x00 = y&bslash;&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|dec_machine_halt
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_CPU_R4x00)
r_if
c_cond
(paren
(paren
id|mips_cputype
op_eq
id|CPU_R3000
)paren
op_logical_or
(paren
id|mips_cputype
op_eq
id|CPU_R3000A
)paren
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Sorry, this kernel is compiled for the wrong CPU type!&bslash;n&quot;
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;Please recompile with &bslash;&quot;CONFIG_CPU_R3000 = y&bslash;&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|dec_machine_halt
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|prom_meminit
c_func
(paren
id|magic
)paren
suffix:semicolon
id|prom_identify_arch
c_func
(paren
id|magic
)paren
suffix:semicolon
id|prom_init_cmdline
c_func
(paren
id|argc
comma
id|argv
comma
id|magic
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
