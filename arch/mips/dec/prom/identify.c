multiline_comment|/*&n; * identify.c: machine identification code.&n; *&n; * Copyright (C) 1998 Harald Koerfgen and Paul M. Antoine&n; *&n; * $Id: identify.c,v 1.2 1999/10/09 00:00:58 ralf Exp $&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &quot;dectypes.h&quot;
macro_line|#include &quot;prom.h&quot;
r_extern
r_char
op_star
(paren
op_star
id|prom_getenv
)paren
(paren
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
(paren
op_star
id|prom_printf
)paren
(paren
r_char
op_star
comma
dot
dot
dot
)paren
suffix:semicolon
r_extern
r_int
(paren
op_star
id|rex_getsysid
)paren
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
r_int
id|mips_machgroup
suffix:semicolon
r_extern
r_int
r_int
id|mips_machtype
suffix:semicolon
DECL|function|prom_identify_arch
r_void
id|__init
id|prom_identify_arch
(paren
r_int
r_int
id|magic
)paren
(brace
r_int
r_char
id|dec_cpunum
comma
id|dec_firmrev
comma
id|dec_etc
suffix:semicolon
r_int
id|dec_systype
suffix:semicolon
r_int
r_int
id|dec_sysid
suffix:semicolon
r_if
c_cond
(paren
id|magic
op_ne
id|REX_PROM_MAGIC
)paren
(brace
id|dec_sysid
op_assign
id|simple_strtoul
c_func
(paren
id|prom_getenv
c_func
(paren
l_string|&quot;systype&quot;
)paren
comma
(paren
r_char
op_star
op_star
)paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|dec_sysid
op_assign
id|rex_getsysid
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dec_sysid
op_eq
l_int|0
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;Zero sysid returned from PROMs! Assuming PMAX-like machine.&bslash;n&quot;
)paren
suffix:semicolon
id|dec_sysid
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|dec_cpunum
op_assign
(paren
id|dec_sysid
op_amp
l_int|0xff000000
)paren
op_rshift
l_int|24
suffix:semicolon
id|dec_systype
op_assign
(paren
id|dec_sysid
op_amp
l_int|0xff0000
)paren
op_rshift
l_int|16
suffix:semicolon
id|dec_firmrev
op_assign
(paren
id|dec_sysid
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
suffix:semicolon
id|dec_etc
op_assign
id|dec_sysid
op_amp
l_int|0xff
suffix:semicolon
multiline_comment|/* We&squot;re obviously one of the DEC machines */
id|mips_machgroup
op_assign
id|MACH_GROUP_DEC
suffix:semicolon
multiline_comment|/*&n;&t; * FIXME: This may not be an exhaustive list of DECStations/Servers!&n;&t; * Put all model-specific initialisation calls here.&n;&t; */
id|prom_printf
c_func
(paren
l_string|&quot;This DECstation is a &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dec_systype
)paren
(brace
r_case
id|DS2100_3100
suffix:colon
id|prom_printf
c_func
(paren
l_string|&quot;DS2100/3100&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_DS23100
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DS5100
suffix:colon
multiline_comment|/* DS5100 MIPSMATE */
id|prom_printf
c_func
(paren
l_string|&quot;DS5100&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_DS5100
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DS5000_200
suffix:colon
multiline_comment|/* DS5000 3max */
id|prom_printf
c_func
(paren
l_string|&quot;DS5000/200&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_DS5000_200
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DS5000_1XX
suffix:colon
multiline_comment|/* DS5000/100 3min */
id|prom_printf
c_func
(paren
l_string|&quot;DS5000/1xx&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_DS5000_1XX
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DS5000_2X0
suffix:colon
multiline_comment|/* DS5000/240 3max+ */
id|prom_printf
c_func
(paren
l_string|&quot;DS5000/2x0&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_DS5000_2X0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DS5000_XX
suffix:colon
multiline_comment|/* Personal DS5000/2x */
id|prom_printf
c_func
(paren
l_string|&quot;Personal DS5000/xx&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_DS5000_XX
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DS5800
suffix:colon
multiline_comment|/* DS5800 Isis */
id|prom_printf
c_func
(paren
l_string|&quot;DS5800&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_DS5800
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DS5400
suffix:colon
multiline_comment|/* DS5400 MIPSfair */
id|prom_printf
c_func
(paren
l_string|&quot;DS5400&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_DS5400
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DS5500
suffix:colon
multiline_comment|/* DS5500 MIPSfair-2 */
id|prom_printf
c_func
(paren
l_string|&quot;DS5500&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_DS5500
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|prom_printf
c_func
(paren
l_string|&quot;unknown, id is %x&quot;
comma
id|dec_systype
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_DSUNKNOWN
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
eof
