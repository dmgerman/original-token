multiline_comment|/* $Id: print.c,v 1.1 1999/01/17 03:49:38 ralf Exp $&n; *&n; * print.c: Simple print fascility&n; *&n; * Copyright (C) 1998 Gleb Raiko &amp; Vladimir Roganov&n; *&n; */
macro_line|#include &lt;stdarg.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/baget/baget.h&gt;
multiline_comment|/*&n; *  Define this to see &squot;baget_printk&squot; (debug) messages&n; */
singleline_comment|// #define BAGET_PRINTK
multiline_comment|/* &n; *  This function is same for BALO and Linux baget_printk,&n; *  and normally prints characted to second (UART A) console.&n; */
DECL|function|delay
r_static
r_void
id|delay
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|outc_low
r_static
r_void
id|outc_low
c_func
(paren
r_char
id|c
)paren
(brace
r_int
id|i
suffix:semicolon
id|vac_outb
c_func
(paren
id|c
comma
id|VAC_UART_B_TX
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
id|delay
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|outc
r_void
id|outc
c_func
(paren
r_char
id|c
)paren
(brace
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|outc_low
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
id|outc_low
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
DECL|function|outs
r_void
id|outs
c_func
(paren
r_char
op_star
id|s
)paren
(brace
r_while
c_loop
(paren
op_star
id|s
)paren
(brace
id|outc
c_func
(paren
op_star
id|s
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|function|baget_write
r_void
id|baget_write
c_func
(paren
r_char
op_star
id|s
comma
r_int
id|l
)paren
(brace
r_while
c_loop
(paren
id|l
op_decrement
)paren
(brace
id|outc
c_func
(paren
op_star
id|s
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|function|baget_printk
r_int
id|baget_printk
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
macro_line|#ifdef BAGET_PRINTK
id|va_list
id|args
suffix:semicolon
r_int
id|i
suffix:semicolon
r_static
r_char
id|buf
(braket
l_int|1024
)braket
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|i
op_assign
id|vsprintf
c_func
(paren
id|buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
multiline_comment|/* hopefully i &lt; sizeof(buf)-4 */
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|baget_write
c_func
(paren
id|buf
comma
id|i
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
macro_line|#else
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
DECL|function|puthex
r_static
id|__inline__
r_void
id|puthex
c_func
(paren
r_int
id|a
)paren
(brace
r_static
r_char
id|s
(braket
l_int|9
)braket
suffix:semicolon
r_static
r_char
id|e
(braket
)braket
op_assign
l_string|&quot;0123456789ABCDEF&quot;
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|7
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
comma
id|a
op_rshift_assign
l_int|4
)paren
(brace
id|s
(braket
id|i
)braket
op_assign
id|e
(braket
id|a
op_amp
l_int|0x0F
)braket
suffix:semicolon
)brace
id|s
(braket
l_int|8
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|outs
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|balo_printf
r_void
id|__init
id|balo_printf
c_func
(paren
r_char
op_star
id|f
comma
dot
dot
dot
)paren
(brace
r_int
op_star
id|arg
op_assign
(paren
r_int
op_star
)paren
op_amp
id|f
op_plus
l_int|1
suffix:semicolon
r_char
id|c
suffix:semicolon
r_int
id|format
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
op_assign
op_star
id|f
op_increment
)paren
op_ne
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|c
)paren
(brace
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|format
)paren
(brace
id|outc
c_func
(paren
l_char|&squot;%&squot;
)paren
suffix:semicolon
id|format
op_assign
l_int|0
suffix:semicolon
)brace
id|outc
c_func
(paren
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;%&squot;
suffix:colon
r_if
c_cond
(paren
id|format
)paren
(brace
id|format
op_assign
l_int|0
suffix:semicolon
id|outc
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
r_else
id|format
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;x&squot;
suffix:colon
r_if
c_cond
(paren
id|format
)paren
(brace
id|puthex
c_func
(paren
op_star
id|arg
op_increment
)paren
suffix:semicolon
)brace
r_else
id|outc
c_func
(paren
id|c
)paren
suffix:semicolon
id|format
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;s&squot;
suffix:colon
r_if
c_cond
(paren
id|format
)paren
(brace
id|outs
c_func
(paren
(paren
r_char
op_star
)paren
op_star
id|arg
op_increment
)paren
suffix:semicolon
)brace
r_else
id|outc
c_func
(paren
id|c
)paren
suffix:semicolon
id|format
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|balo_hungup
r_void
id|__init
id|balo_hungup
c_func
(paren
r_void
)paren
(brace
id|outs
c_func
(paren
l_string|&quot;Hunging up.&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
eof
