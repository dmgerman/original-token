multiline_comment|/*&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Cobalt Qube specific PCI support.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/bios32.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/cobalt.h&gt;
macro_line|#include &lt;asm/pci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|PCI_DEBUG
macro_line|#undef PCI_DEBUG 
macro_line|#ifdef CONFIG_PCI
DECL|function|qube_expansion_slot_bist
r_static
r_void
id|qube_expansion_slot_bist
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|ctrl
suffix:semicolon
r_int
id|timeout
op_assign
l_int|100000
suffix:semicolon
id|pcibios_read_config_byte
c_func
(paren
l_int|0
comma
(paren
l_int|0x0a
op_lshift
l_int|3
)paren
comma
id|PCI_BIST
comma
op_amp
id|ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ctrl
op_amp
id|PCI_BIST_CAPABLE
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
(paren
l_int|0x0a
op_lshift
l_int|3
)paren
comma
id|PCI_BIST
comma
id|ctrl
op_or
id|PCI_BIST_START
)paren
suffix:semicolon
r_do
(brace
id|pcibios_read_config_byte
c_func
(paren
l_int|0
comma
(paren
l_int|0x0a
op_lshift
l_int|3
)paren
comma
id|PCI_BIST
comma
op_amp
id|ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ctrl
op_amp
id|PCI_BIST_START
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_decrement
id|timeout
OG
l_int|0
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|timeout
op_le
l_int|0
)paren
op_logical_or
(paren
id|ctrl
op_amp
id|PCI_BIST_CODE_MASK
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PCI: Expansion slot card failed BIST with code %x&bslash;n&quot;
comma
(paren
id|ctrl
op_amp
id|PCI_BIST_CODE_MASK
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|qube_expansion_slot_fixup
r_static
r_void
id|qube_expansion_slot_fixup
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|pci_cmd
suffix:semicolon
r_int
r_int
id|ioaddr_base
op_assign
l_int|0x10108000
suffix:semicolon
multiline_comment|/* It&squot;s magic, ask Doug. */
r_int
r_int
id|memaddr_base
op_assign
l_int|0x12000000
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Enable bits in COMMAND so driver can talk to it. */
id|pcibios_read_config_word
c_func
(paren
l_int|0
comma
(paren
l_int|0x0a
op_lshift
l_int|3
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|pci_cmd
)paren
suffix:semicolon
id|pci_cmd
op_or_assign
(paren
id|PCI_COMMAND_IO
op_or
id|PCI_COMMAND_MEMORY
op_or
id|PCI_COMMAND_MASTER
)paren
suffix:semicolon
id|pcibios_write_config_word
c_func
(paren
l_int|0
comma
(paren
l_int|0x0a
op_lshift
l_int|3
)paren
comma
id|PCI_COMMAND
comma
id|pci_cmd
)paren
suffix:semicolon
multiline_comment|/* Give it a working IRQ. */
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
(paren
l_int|0x0a
op_lshift
l_int|3
)paren
comma
id|PCI_INTERRUPT_LINE
comma
l_int|9
)paren
suffix:semicolon
multiline_comment|/* Fixup base addresses, we only support I/O at the moment. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|regaddr
op_assign
(paren
id|PCI_BASE_ADDRESS_0
op_plus
(paren
id|i
op_star
l_int|4
)paren
)paren
suffix:semicolon
r_int
r_int
id|rval
comma
id|mask
comma
id|size
comma
id|alignme
comma
id|aspace
suffix:semicolon
r_int
r_int
op_star
id|basep
op_assign
op_amp
id|ioaddr_base
suffix:semicolon
multiline_comment|/* Check type first, punt if non-IO. */
id|pcibios_read_config_dword
c_func
(paren
l_int|0
comma
(paren
l_int|0x0a
op_lshift
l_int|3
)paren
comma
id|regaddr
comma
op_amp
id|rval
)paren
suffix:semicolon
id|aspace
op_assign
(paren
id|rval
op_amp
id|PCI_BASE_ADDRESS_SPACE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aspace
op_ne
id|PCI_BASE_ADDRESS_SPACE_IO
)paren
(brace
id|basep
op_assign
op_amp
id|memaddr_base
suffix:semicolon
)brace
multiline_comment|/* Figure out how much it wants, if anything. */
id|pcibios_write_config_dword
c_func
(paren
l_int|0
comma
(paren
l_int|0x0a
op_lshift
l_int|3
)paren
comma
id|regaddr
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|pcibios_read_config_dword
c_func
(paren
l_int|0
comma
(paren
l_int|0x0a
op_lshift
l_int|3
)paren
comma
id|regaddr
comma
op_amp
id|rval
)paren
suffix:semicolon
multiline_comment|/* Unused? */
r_if
c_cond
(paren
id|rval
op_eq
l_int|0
)paren
(brace
r_continue
suffix:semicolon
)brace
id|rval
op_and_assign
id|PCI_BASE_ADDRESS_IO_MASK
suffix:semicolon
id|mask
op_assign
(paren
op_complement
id|rval
op_lshift
l_int|1
)paren
op_or
l_int|0x1
suffix:semicolon
id|size
op_assign
(paren
id|mask
op_amp
id|rval
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|alignme
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|alignme
OL
l_int|0x400
)paren
(brace
id|alignme
op_assign
l_int|0x400
suffix:semicolon
)brace
id|rval
op_assign
(paren
(paren
op_star
id|basep
op_plus
(paren
id|alignme
op_minus
l_int|1
)paren
)paren
op_amp
op_complement
(paren
id|alignme
op_minus
l_int|1
)paren
)paren
suffix:semicolon
op_star
id|basep
op_assign
(paren
id|rval
op_plus
id|size
)paren
suffix:semicolon
id|pcibios_write_config_dword
c_func
(paren
l_int|0
comma
(paren
l_int|0x0a
op_lshift
l_int|3
)paren
comma
id|regaddr
comma
id|rval
op_or
id|aspace
)paren
suffix:semicolon
)brace
id|qube_expansion_slot_bist
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|qube_raq_tulip_fixup
r_static
r_void
id|qube_raq_tulip_fixup
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|pci_cmd
suffix:semicolon
multiline_comment|/* Enable the device. */
id|pcibios_read_config_word
c_func
(paren
l_int|0
comma
(paren
l_int|0x0c
op_lshift
l_int|3
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|pci_cmd
)paren
suffix:semicolon
id|pci_cmd
op_or_assign
(paren
id|PCI_COMMAND_IO
op_or
id|PCI_COMMAND_MASTER
)paren
suffix:semicolon
id|pcibios_write_config_word
c_func
(paren
l_int|0
comma
(paren
l_int|0x0c
op_lshift
l_int|3
)paren
comma
id|PCI_COMMAND
comma
id|pci_cmd
)paren
suffix:semicolon
multiline_comment|/* Give it it&squot;s IRQ. */
multiline_comment|/* NOTE: RaQ board #1 has a bunch of green wires which swapped the&n;&t; *       IRQ line values of Tulip 0 and Tulip 1.  All other&n;&t; *       boards have eth0=4,eth1=13.  -DaveM&n;&t; */
macro_line|#ifndef RAQ_BOARD_1_WITH_HWHACKS
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
(paren
l_int|0x0c
op_lshift
l_int|3
)paren
comma
id|PCI_INTERRUPT_LINE
comma
l_int|13
)paren
suffix:semicolon
macro_line|#else
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
(paren
l_int|0x0c
op_lshift
l_int|3
)paren
comma
id|PCI_INTERRUPT_LINE
comma
l_int|4
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* And finally, a usable I/O space allocation, right after what&n;&t; * the first Tulip uses.&n;&t; */
id|pcibios_write_config_dword
c_func
(paren
l_int|0
comma
(paren
l_int|0x0c
op_lshift
l_int|3
)paren
comma
id|PCI_BASE_ADDRESS_0
comma
l_int|0x10101001
)paren
suffix:semicolon
)brace
DECL|function|qube_raq_scsi_fixup
r_static
r_void
id|qube_raq_scsi_fixup
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|pci_cmd
suffix:semicolon
multiline_comment|/* Enable the device. */
id|pcibios_read_config_word
c_func
(paren
l_int|0
comma
(paren
l_int|0x08
op_lshift
l_int|3
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|pci_cmd
)paren
suffix:semicolon
id|pci_cmd
op_or_assign
(paren
id|PCI_COMMAND_IO
op_or
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_MEMORY
op_or
id|PCI_COMMAND_INVALIDATE
)paren
suffix:semicolon
id|pcibios_write_config_word
c_func
(paren
l_int|0
comma
(paren
l_int|0x08
op_lshift
l_int|3
)paren
comma
id|PCI_COMMAND
comma
id|pci_cmd
)paren
suffix:semicolon
multiline_comment|/* Give it it&squot;s IRQ. */
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
(paren
l_int|0x08
op_lshift
l_int|3
)paren
comma
id|PCI_INTERRUPT_LINE
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* And finally, a usable I/O space allocation, right after what&n;&t; * the second Tulip uses.&n;&t; */
id|pcibios_write_config_dword
c_func
(paren
l_int|0
comma
(paren
l_int|0x08
op_lshift
l_int|3
)paren
comma
id|PCI_BASE_ADDRESS_0
comma
l_int|0x10102001
)paren
suffix:semicolon
id|pcibios_write_config_dword
c_func
(paren
l_int|0
comma
(paren
l_int|0x08
op_lshift
l_int|3
)paren
comma
id|PCI_BASE_ADDRESS_1
comma
l_int|0x00002000
)paren
suffix:semicolon
id|pcibios_write_config_dword
c_func
(paren
l_int|0
comma
(paren
l_int|0x08
op_lshift
l_int|3
)paren
comma
id|PCI_BASE_ADDRESS_2
comma
l_int|0x00100000
)paren
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|qube_pcibios_fixup
id|qube_pcibios_fixup
c_func
(paren
r_int
r_int
id|mem_start
comma
r_int
r_int
id|mem_end
)paren
(brace
r_extern
r_int
id|cobalt_is_raq
suffix:semicolon
r_int
id|raq_p
op_assign
id|cobalt_is_raq
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
multiline_comment|/* Fixup I/O and Memory space decoding on Galileo.  */
id|isa_slot_offset
op_assign
id|COBALT_LOCAL_IO_SPACE
suffix:semicolon
multiline_comment|/* Fix PCI latency-timer and cache-line-size values in Galileo&n;&t; * host bridge.&n;&t; */
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_LATENCY_TIMER
comma
l_int|64
)paren
suffix:semicolon
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_CACHE_LINE_SIZE
comma
l_int|7
)paren
suffix:semicolon
multiline_comment|/*&n;         * Now tell the SCSI device that we expect an interrupt at&n;         * IRQ 7 and not the default 0.&n;         */
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
l_int|0x08
op_lshift
l_int|3
comma
id|PCI_INTERRUPT_LINE
comma
id|COBALT_SCSI_IRQ
)paren
suffix:semicolon
multiline_comment|/*&n;         * Now tell the Ethernet device that we expect an interrupt at&n;         * IRQ 13 and not the default 189.&n;&t; *&n;&t; * The IRQ of the first Tulip is different on Qube and RaQ&n;&t; * hardware except for the weird first RaQ bringup board,&n;&t; * see above for details.  -DaveM&n;         */
r_if
c_cond
(paren
op_logical_neg
id|raq_p
)paren
(brace
multiline_comment|/* All Qube&squot;s route this the same way. */
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
l_int|0x07
op_lshift
l_int|3
comma
id|PCI_INTERRUPT_LINE
comma
id|COBALT_ETHERNET_IRQ
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifndef RAQ_BOARD_1_WITH_HWHACKS
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
(paren
l_int|0x07
op_lshift
l_int|3
)paren
comma
id|PCI_INTERRUPT_LINE
comma
l_int|4
)paren
suffix:semicolon
macro_line|#else
id|pcibios_write_config_byte
c_func
(paren
l_int|0
comma
(paren
l_int|0x07
op_lshift
l_int|3
)paren
comma
id|PCI_INTERRUPT_LINE
comma
l_int|13
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
op_logical_neg
id|raq_p
)paren
(brace
multiline_comment|/* See if there is a device in the expansion slot, if so&n;&t;&t; * fixup IRQ, fix base addresses, and enable master +&n;&t;&t; * I/O + memory accesses in config space.&n;&t;&t; */
id|pcibios_read_config_dword
c_func
(paren
l_int|0
comma
l_int|0x0a
op_lshift
l_int|3
comma
id|PCI_VENDOR_ID
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
l_int|0xffffffff
op_logical_and
id|tmp
op_ne
l_int|0x00000000
)paren
(brace
id|qube_expansion_slot_fixup
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* If this is a RAQ, we may need to setup the second Tulip&n;&t;&t; * and SCSI as well.  Due to the different configurations&n;&t;&t; * a RaQ can have, we need to explicitly check for the&n;&t;&t; * presence of each of these (optional) devices.  -DaveM&n;&t;&t; */
id|pcibios_read_config_dword
c_func
(paren
l_int|0
comma
l_int|0x0c
op_lshift
l_int|3
comma
id|PCI_VENDOR_ID
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
l_int|0xffffffff
op_logical_and
id|tmp
op_ne
l_int|0x00000000
)paren
(brace
id|qube_raq_tulip_fixup
c_func
(paren
)paren
suffix:semicolon
)brace
id|pcibios_read_config_dword
c_func
(paren
l_int|0
comma
l_int|0x08
op_lshift
l_int|3
comma
id|PCI_VENDOR_ID
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
l_int|0xffffffff
op_logical_and
id|tmp
op_ne
l_int|0x00000000
)paren
(brace
id|qube_raq_scsi_fixup
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* And if we are a 2800 we have to setup the expansion slot&n;&t;&t; * too.&n;&t;&t; */
id|pcibios_read_config_dword
c_func
(paren
l_int|0
comma
l_int|0x0a
op_lshift
l_int|3
comma
id|PCI_VENDOR_ID
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
l_int|0xffffffff
op_logical_and
id|tmp
op_ne
l_int|0x00000000
)paren
(brace
id|qube_expansion_slot_fixup
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_return
id|mem_start
suffix:semicolon
)brace
DECL|function|pci_range_ck
r_static
id|__inline__
r_int
id|pci_range_ck
c_func
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
)paren
(brace
r_if
c_cond
(paren
(paren
id|bus
op_eq
l_int|0
)paren
op_logical_and
(paren
(paren
id|dev
op_eq
l_int|0
)paren
op_logical_or
(paren
(paren
id|dev
OG
l_int|6
)paren
op_logical_and
(paren
id|dev
op_le
l_int|12
)paren
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* OK device number  */
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* NOT ok device number */
)brace
DECL|macro|PCI_CFG_DATA
mdefine_line|#define PCI_CFG_DATA&t;((volatile unsigned long *)0xb4000cfc)
DECL|macro|PCI_CFG_CTRL
mdefine_line|#define PCI_CFG_CTRL&t;((volatile unsigned long *)0xb4000cf8)
DECL|macro|PCI_CFG_SET
mdefine_line|#define PCI_CFG_SET(dev,fun,off) &bslash;&n;&t;((*PCI_CFG_CTRL) = (0x80000000 | ((dev)&lt;&lt;11) | &bslash;&n;&t;&t;&t;    ((fun)&lt;&lt;8) | (off)))
DECL|function|qube_pcibios_read_config_dword
r_static
r_int
id|qube_pcibios_read_config_dword
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
op_star
id|val
)paren
(brace
r_int
r_char
id|fun
op_assign
id|dev
op_amp
l_int|0x07
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_amp
l_int|0x3
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
r_if
c_cond
(paren
id|pci_range_ck
c_func
(paren
id|bus
comma
id|dev
)paren
)paren
(brace
op_star
id|val
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
id|PCI_CFG_SET
c_func
(paren
id|dev
comma
id|fun
comma
id|offset
)paren
suffix:semicolon
op_star
id|val
op_assign
op_star
id|PCI_CFG_DATA
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|qube_pcibios_read_config_word
r_static
r_int
id|qube_pcibios_read_config_word
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
op_star
id|val
)paren
(brace
r_int
r_char
id|fun
op_assign
id|dev
op_amp
l_int|0x07
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_amp
l_int|0x1
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
r_if
c_cond
(paren
id|pci_range_ck
c_func
(paren
id|bus
comma
id|dev
)paren
)paren
(brace
op_star
id|val
op_assign
l_int|0xffff
suffix:semicolon
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
id|PCI_CFG_SET
c_func
(paren
id|dev
comma
id|fun
comma
(paren
id|offset
op_amp
op_complement
l_int|0x3
)paren
)paren
suffix:semicolon
op_star
id|val
op_assign
op_star
id|PCI_CFG_DATA
op_rshift
(paren
(paren
id|offset
op_amp
l_int|3
)paren
op_star
l_int|8
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|qube_pcibios_read_config_byte
r_static
r_int
id|qube_pcibios_read_config_byte
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_char
op_star
id|val
)paren
(brace
r_int
r_char
id|fun
op_assign
id|dev
op_amp
l_int|0x07
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|pci_range_ck
c_func
(paren
id|bus
comma
id|dev
)paren
)paren
(brace
op_star
id|val
op_assign
l_int|0xff
suffix:semicolon
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
id|PCI_CFG_SET
c_func
(paren
id|dev
comma
id|fun
comma
(paren
id|offset
op_amp
op_complement
l_int|0x3
)paren
)paren
suffix:semicolon
op_star
id|val
op_assign
op_star
id|PCI_CFG_DATA
op_rshift
(paren
(paren
id|offset
op_amp
l_int|3
)paren
op_star
l_int|8
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|qube_pcibios_write_config_dword
r_static
r_int
id|qube_pcibios_write_config_dword
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_char
id|fun
op_assign
id|dev
op_amp
l_int|0x07
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_amp
l_int|0x3
)paren
(brace
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_range_ck
c_func
(paren
id|bus
comma
id|dev
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
id|PCI_CFG_SET
c_func
(paren
id|dev
comma
id|fun
comma
id|offset
)paren
suffix:semicolon
op_star
id|PCI_CFG_DATA
op_assign
id|val
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_static
r_int
DECL|function|qube_pcibios_write_config_word
id|qube_pcibios_write_config_word
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_char
id|fun
op_assign
id|dev
op_amp
l_int|0x07
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_amp
l_int|0x1
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
r_if
c_cond
(paren
id|pci_range_ck
c_func
(paren
id|bus
comma
id|dev
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
id|PCI_CFG_SET
c_func
(paren
id|dev
comma
id|fun
comma
(paren
id|offset
op_amp
op_complement
l_int|0x3
)paren
)paren
suffix:semicolon
id|tmp
op_assign
op_star
id|PCI_CFG_DATA
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
l_int|0xffff
op_lshift
(paren
(paren
id|offset
op_amp
l_int|0x3
)paren
op_star
l_int|8
)paren
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|val
op_lshift
(paren
(paren
id|offset
op_amp
l_int|0x3
)paren
op_star
l_int|8
)paren
)paren
suffix:semicolon
op_star
id|PCI_CFG_DATA
op_assign
id|tmp
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_static
r_int
DECL|function|qube_pcibios_write_config_byte
id|qube_pcibios_write_config_byte
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|dev
comma
r_int
r_char
id|offset
comma
r_int
r_char
id|val
)paren
(brace
r_int
r_char
id|fun
op_assign
id|dev
op_amp
l_int|0x07
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|dev
op_rshift_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|pci_range_ck
c_func
(paren
id|bus
comma
id|dev
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
id|PCI_CFG_SET
c_func
(paren
id|dev
comma
id|fun
comma
(paren
id|offset
op_amp
op_complement
l_int|0x3
)paren
)paren
suffix:semicolon
id|tmp
op_assign
op_star
id|PCI_CFG_DATA
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
l_int|0xff
op_lshift
(paren
(paren
id|offset
op_amp
l_int|0x3
)paren
op_star
l_int|8
)paren
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|val
op_lshift
(paren
(paren
id|offset
op_amp
l_int|0x3
)paren
op_star
l_int|8
)paren
)paren
suffix:semicolon
op_star
id|PCI_CFG_DATA
op_assign
id|tmp
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|variable|qube_pci_ops
r_struct
id|pci_ops
id|qube_pci_ops
op_assign
(brace
id|qube_pcibios_fixup
comma
id|qube_pcibios_read_config_byte
comma
id|qube_pcibios_read_config_word
comma
id|qube_pcibios_read_config_dword
comma
id|qube_pcibios_write_config_byte
comma
id|qube_pcibios_write_config_word
comma
id|qube_pcibios_write_config_dword
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PCI */
eof
