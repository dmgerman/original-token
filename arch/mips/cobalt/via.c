multiline_comment|/*&n; * Interrupt handling for the VIA ISA bridge.&n; *&n; * Everything the same ... just different ...&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/cobalt.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/io.h&gt;
r_extern
id|asmlinkage
r_void
id|do_IRQ
c_func
(paren
r_int
id|irq
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_extern
r_int
r_char
id|cache_21
suffix:semicolon
r_extern
r_int
r_char
id|cache_A1
suffix:semicolon
multiline_comment|/*&n; * (un)mask_irq, disable_irq() and enable_irq() only handle (E)ISA and&n; * PCI devices.  Other onboard hardware needs specific routines.&n; */
DECL|function|mask_irq
r_void
id|mask_irq
c_func
(paren
r_int
r_int
id|irq_nr
)paren
(brace
r_int
r_char
id|mask
suffix:semicolon
id|mask
op_assign
l_int|1
op_lshift
(paren
id|irq_nr
op_amp
l_int|7
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_nr
OL
l_int|8
)paren
(brace
id|cache_21
op_or_assign
id|mask
suffix:semicolon
id|outb
c_func
(paren
id|cache_21
comma
l_int|0x10000021
)paren
suffix:semicolon
)brace
r_else
(brace
id|cache_A1
op_or_assign
id|mask
suffix:semicolon
id|outb
c_func
(paren
id|cache_A1
comma
l_int|0x100000a1
)paren
suffix:semicolon
)brace
)brace
DECL|function|unmask_irq
r_void
id|unmask_irq
c_func
(paren
r_int
r_int
id|irq_nr
)paren
(brace
r_int
r_char
id|mask
suffix:semicolon
id|mask
op_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|irq_nr
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_nr
OL
l_int|8
)paren
(brace
id|cache_21
op_and_assign
id|mask
suffix:semicolon
id|outb
c_func
(paren
id|cache_21
comma
l_int|0x10000021
)paren
suffix:semicolon
)brace
r_else
(brace
id|cache_A1
op_and_assign
id|mask
suffix:semicolon
id|outb
c_func
(paren
id|cache_A1
comma
l_int|0x100000a1
)paren
suffix:semicolon
)brace
)brace
DECL|function|via_irq
id|asmlinkage
r_void
id|via_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_char
id|mstat
comma
id|sstat
suffix:semicolon
multiline_comment|/* Read Master Status */
id|VIA_PORT_WRITE
c_func
(paren
l_int|0x20
comma
l_int|0x0C
)paren
suffix:semicolon
id|mstat
op_assign
id|VIA_PORT_READ
c_func
(paren
l_int|0x20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mstat
OL
l_int|0
)paren
(brace
id|mstat
op_and_assign
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|mstat
op_ne
l_int|2
)paren
(brace
id|do_IRQ
c_func
(paren
id|mstat
comma
id|regs
)paren
suffix:semicolon
id|VIA_PORT_WRITE
c_func
(paren
l_int|0x20
comma
id|mstat
op_or
l_int|0x20
)paren
suffix:semicolon
)brace
r_else
(brace
id|sstat
op_assign
id|VIA_PORT_READ
c_func
(paren
l_int|0xA0
)paren
suffix:semicolon
multiline_comment|/* Slave interrupt */
id|VIA_PORT_WRITE
c_func
(paren
l_int|0xA0
comma
l_int|0x0C
)paren
suffix:semicolon
id|sstat
op_assign
id|VIA_PORT_READ
c_func
(paren
l_int|0xA0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sstat
OL
l_int|0
)paren
(brace
id|do_IRQ
c_func
(paren
(paren
id|sstat
op_plus
l_int|8
)paren
op_amp
l_int|0x7f
comma
id|regs
)paren
suffix:semicolon
id|VIA_PORT_WRITE
c_func
(paren
l_int|0x20
comma
l_int|0x22
)paren
suffix:semicolon
id|VIA_PORT_WRITE
c_func
(paren
l_int|0xA0
comma
(paren
id|sstat
op_amp
l_int|0x7f
)paren
op_or
l_int|0x20
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Spurious slave interrupt...&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;Spurious master interrupt...&quot;
)paren
suffix:semicolon
)brace
DECL|function|galileo_irq
id|asmlinkage
r_void
id|galileo_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|irq_src
op_assign
op_star
(paren
(paren
r_int
r_int
op_star
)paren
l_int|0xb4000c18
)paren
suffix:semicolon
multiline_comment|/* Check for timer irq ... */
r_if
c_cond
(paren
id|irq_src
op_amp
l_int|0x00000100
)paren
(brace
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xb4000c18
)paren
op_assign
l_int|0
suffix:semicolon
id|do_IRQ
c_func
(paren
l_int|0
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;Spurious Galileo interrupt...&bslash;n&quot;
)paren
suffix:semicolon
)brace
eof
