multiline_comment|/*&n; * irixsig.c: WHEEE, IRIX signals!  YOW, am I compatable or what?!?!&n; *&n; * Copyright (C) 1996 David S. Miller (dm@engr.sgi.com)&n; * Copyright (C) 1997 - 2000 Ralf Baechle (ralf@gnu.org)&n; * Copyright (C) 2000 Silicon Graphics, Inc.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
id|asmlinkage
r_int
id|sys_wait4
c_func
(paren
id|pid_t
id|pid
comma
r_int
r_int
op_star
id|stat_addr
comma
r_int
id|options
comma
r_int
r_int
op_star
id|ru
)paren
suffix:semicolon
r_extern
id|asmlinkage
r_void
id|syscall_trace
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|macro|DEBUG_SIG
macro_line|#undef DEBUG_SIG
DECL|macro|_S
mdefine_line|#define _S(nr) (1&lt;&lt;((nr)-1))
DECL|macro|_BLOCKABLE
mdefine_line|#define _BLOCKABLE (~(_S(SIGKILL) | _S(SIGSTOP)))
r_typedef
r_struct
(brace
DECL|member|sig
r_int
r_int
id|sig
(braket
l_int|4
)braket
suffix:semicolon
DECL|typedef|irix_sigset_t
)brace
id|irix_sigset_t
suffix:semicolon
DECL|struct|sigctx_irix5
r_struct
id|sigctx_irix5
(brace
DECL|member|rmask
DECL|member|cp0_status
id|u32
id|rmask
comma
id|cp0_status
suffix:semicolon
DECL|member|pc
id|u64
id|pc
suffix:semicolon
DECL|member|regs
id|u64
id|regs
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|fpregs
id|u64
id|fpregs
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|usedfp
DECL|member|fpcsr
DECL|member|fpeir
DECL|member|sstk_flags
id|u32
id|usedfp
comma
id|fpcsr
comma
id|fpeir
comma
id|sstk_flags
suffix:semicolon
DECL|member|hi
DECL|member|lo
id|u64
id|hi
comma
id|lo
suffix:semicolon
DECL|member|cp0_cause
DECL|member|cp0_badvaddr
DECL|member|_unused0
id|u64
id|cp0_cause
comma
id|cp0_badvaddr
comma
id|_unused0
suffix:semicolon
DECL|member|sigset
id|irix_sigset_t
id|sigset
suffix:semicolon
DECL|member|weird_fpu_thing
id|u64
id|weird_fpu_thing
suffix:semicolon
DECL|member|_unused1
id|u64
id|_unused1
(braket
l_int|31
)braket
suffix:semicolon
)brace
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
multiline_comment|/* Debugging */
DECL|function|dump_irix5_sigctx
r_static
r_inline
r_void
id|dump_irix5_sigctx
c_func
(paren
r_struct
id|sigctx_irix5
op_star
id|c
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;misc: rmask[%08lx] status[%08lx] pc[%08lx]&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|c-&gt;rmask
comma
(paren
r_int
r_int
)paren
id|c-&gt;cp0_status
comma
(paren
r_int
r_int
)paren
id|c-&gt;pc
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;regs: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[%d]&lt;%08lx&gt; &quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|c-&gt;regs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nregs: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[%d]&lt;%08lx&gt; &quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|c-&gt;regs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nfpregs: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[%d]&lt;%08lx&gt; &quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|c-&gt;fpregs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nfpregs: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[%d]&lt;%08lx&gt; &quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|c-&gt;fpregs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;misc: usedfp[%d] fpcsr[%08lx] fpeir[%08lx] stk_flgs[%08lx]&bslash;n&quot;
comma
(paren
r_int
)paren
id|c-&gt;usedfp
comma
(paren
r_int
r_int
)paren
id|c-&gt;fpcsr
comma
(paren
r_int
r_int
)paren
id|c-&gt;fpeir
comma
(paren
r_int
r_int
)paren
id|c-&gt;sstk_flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;misc: hi[%08lx] lo[%08lx] cause[%08lx] badvaddr[%08lx]&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|c-&gt;hi
comma
(paren
r_int
r_int
)paren
id|c-&gt;lo
comma
(paren
r_int
r_int
)paren
id|c-&gt;cp0_cause
comma
(paren
r_int
r_int
)paren
id|c-&gt;cp0_badvaddr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;misc: sigset&lt;0&gt;[%08lx] sigset&lt;1&gt;[%08lx] sigset&lt;2&gt;[%08lx] &quot;
l_string|&quot;sigset&lt;3&gt;[%08lx]&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|c-&gt;sigset.sig
(braket
l_int|0
)braket
comma
(paren
r_int
r_int
)paren
id|c-&gt;sigset.sig
(braket
l_int|1
)braket
comma
(paren
r_int
r_int
)paren
id|c-&gt;sigset.sig
(braket
l_int|2
)braket
comma
(paren
r_int
r_int
)paren
id|c-&gt;sigset.sig
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|setup_irix_frame
r_static
r_void
id|setup_irix_frame
c_func
(paren
r_struct
id|k_sigaction
op_star
id|ka
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|signr
comma
id|sigset_t
op_star
id|oldmask
)paren
(brace
r_int
r_int
id|sp
suffix:semicolon
r_struct
id|sigctx_irix5
op_star
id|ctx
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sp
op_assign
id|regs-&gt;regs
(braket
l_int|29
)braket
suffix:semicolon
id|sp
op_sub_assign
r_sizeof
(paren
r_struct
id|sigctx_irix5
)paren
suffix:semicolon
id|sp
op_and_assign
op_complement
(paren
l_int|0xf
)paren
suffix:semicolon
id|ctx
op_assign
(paren
r_struct
id|sigctx_irix5
op_star
)paren
id|sp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|ctx
comma
r_sizeof
(paren
op_star
id|ctx
)paren
)paren
)paren
r_goto
id|segv_and_exit
suffix:semicolon
id|__put_user
c_func
(paren
l_int|0
comma
op_amp
id|ctx-&gt;weird_fpu_thing
)paren
suffix:semicolon
id|__put_user
c_func
(paren
op_complement
(paren
l_int|0x00000001
)paren
comma
op_amp
id|ctx-&gt;rmask
)paren
suffix:semicolon
id|__put_user
c_func
(paren
l_int|0
comma
op_amp
id|ctx-&gt;regs
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|__put_user
c_func
(paren
(paren
id|u64
)paren
id|regs-&gt;regs
(braket
id|i
)braket
comma
op_amp
id|ctx-&gt;regs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|__put_user
c_func
(paren
(paren
id|u64
)paren
id|regs-&gt;hi
comma
op_amp
id|ctx-&gt;hi
)paren
suffix:semicolon
id|__put_user
c_func
(paren
(paren
id|u64
)paren
id|regs-&gt;lo
comma
op_amp
id|ctx-&gt;lo
)paren
suffix:semicolon
id|__put_user
c_func
(paren
(paren
id|u64
)paren
id|regs-&gt;cp0_epc
comma
op_amp
id|ctx-&gt;pc
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|current-&gt;used_math
comma
op_amp
id|ctx-&gt;usedfp
)paren
suffix:semicolon
id|__put_user
c_func
(paren
(paren
id|u64
)paren
id|regs-&gt;cp0_cause
comma
op_amp
id|ctx-&gt;cp0_cause
)paren
suffix:semicolon
id|__put_user
c_func
(paren
(paren
id|u64
)paren
id|regs-&gt;cp0_badvaddr
comma
op_amp
id|ctx-&gt;cp0_badvaddr
)paren
suffix:semicolon
id|__put_user
c_func
(paren
l_int|0
comma
op_amp
id|ctx-&gt;sstk_flags
)paren
suffix:semicolon
multiline_comment|/* XXX sigstack unimp... todo... */
id|__copy_to_user
c_func
(paren
op_amp
id|ctx-&gt;sigset
comma
id|oldmask
comma
r_sizeof
(paren
id|irix_sigset_t
)paren
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
id|dump_irix5_sigctx
c_func
(paren
id|ctx
)paren
suffix:semicolon
macro_line|#endif
id|regs-&gt;regs
(braket
l_int|4
)braket
op_assign
(paren
r_int
r_int
)paren
id|signr
suffix:semicolon
id|regs-&gt;regs
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* XXX sigcode XXX */
id|regs-&gt;regs
(braket
l_int|6
)braket
op_assign
id|regs-&gt;regs
(braket
l_int|29
)braket
op_assign
id|sp
suffix:semicolon
id|regs-&gt;regs
(braket
l_int|7
)braket
op_assign
(paren
r_int
r_int
)paren
id|ka-&gt;sa.sa_handler
suffix:semicolon
id|regs-&gt;regs
(braket
l_int|25
)braket
op_assign
id|regs-&gt;cp0_epc
op_assign
(paren
r_int
r_int
)paren
id|ka-&gt;sa.sa_restorer
suffix:semicolon
r_return
suffix:semicolon
id|segv_and_exit
suffix:colon
r_if
c_cond
(paren
id|signr
op_eq
id|SIGSEGV
)paren
id|ka-&gt;sa.sa_handler
op_assign
id|SIG_DFL
suffix:semicolon
id|force_sig
c_func
(paren
id|SIGSEGV
comma
id|current
)paren
suffix:semicolon
)brace
r_static
r_void
r_inline
DECL|function|setup_irix_rt_frame
id|setup_irix_rt_frame
c_func
(paren
r_struct
id|k_sigaction
op_star
id|ka
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|signr
comma
id|sigset_t
op_star
id|oldmask
comma
id|siginfo_t
op_star
id|info
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Aiee: setup_tr_frame wants to be written&quot;
)paren
suffix:semicolon
id|do_exit
c_func
(paren
id|SIGSEGV
)paren
suffix:semicolon
)brace
DECL|function|handle_signal
r_static
r_inline
r_void
id|handle_signal
c_func
(paren
r_int
r_int
id|sig
comma
r_struct
id|k_sigaction
op_star
id|ka
comma
id|siginfo_t
op_star
id|info
comma
id|sigset_t
op_star
id|oldset
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|ka-&gt;sa.sa_flags
op_amp
id|SA_SIGINFO
)paren
id|setup_irix_rt_frame
c_func
(paren
id|ka
comma
id|regs
comma
id|sig
comma
id|oldset
comma
id|info
)paren
suffix:semicolon
r_else
id|setup_irix_frame
c_func
(paren
id|ka
comma
id|regs
comma
id|sig
comma
id|oldset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ka-&gt;sa.sa_flags
op_amp
id|SA_ONESHOT
)paren
id|ka-&gt;sa.sa_handler
op_assign
id|SIG_DFL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ka-&gt;sa.sa_flags
op_amp
id|SA_NODEFER
)paren
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
id|sigorsets
c_func
(paren
op_amp
id|current-&gt;blocked
comma
op_amp
id|current-&gt;blocked
comma
op_amp
id|ka-&gt;sa.sa_mask
)paren
suffix:semicolon
id|sigaddset
c_func
(paren
op_amp
id|current-&gt;blocked
comma
id|sig
)paren
suffix:semicolon
id|recalc_sigpending
c_func
(paren
id|current
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
)brace
)brace
DECL|function|syscall_restart
r_static
r_inline
r_void
id|syscall_restart
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_struct
id|k_sigaction
op_star
id|ka
)paren
(brace
r_switch
c_cond
(paren
id|regs-&gt;regs
(braket
l_int|0
)braket
)paren
(brace
r_case
id|ERESTARTNOHAND
suffix:colon
id|regs-&gt;regs
(braket
l_int|2
)braket
op_assign
id|EINTR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ERESTARTSYS
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ka-&gt;sa.sa_flags
op_amp
id|SA_RESTART
)paren
)paren
(brace
id|regs-&gt;regs
(braket
l_int|2
)braket
op_assign
id|EINTR
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* fallthrough */
r_case
id|ERESTARTNOINTR
suffix:colon
multiline_comment|/* Userland will reload $v0.  */
id|regs-&gt;cp0_epc
op_sub_assign
l_int|8
suffix:semicolon
)brace
id|regs-&gt;regs
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Don&squot;t deal with this again.  */
)brace
DECL|function|do_irix_signal
id|asmlinkage
r_int
id|do_irix_signal
c_func
(paren
id|sigset_t
op_star
id|oldset
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|k_sigaction
op_star
id|ka
suffix:semicolon
id|siginfo_t
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|oldset
)paren
id|oldset
op_assign
op_amp
id|current-&gt;blocked
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|signr
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
id|signr
op_assign
id|dequeue_signal
c_func
(paren
op_amp
id|current-&gt;blocked
comma
op_amp
id|info
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|signr
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|current-&gt;ptrace
op_amp
id|PT_PTRACED
)paren
op_logical_and
id|signr
op_ne
id|SIGKILL
)paren
(brace
multiline_comment|/* Let the debugger run.  */
id|current-&gt;exit_code
op_assign
id|signr
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_STOPPED
suffix:semicolon
id|notify_parent
c_func
(paren
id|current
comma
id|SIGCHLD
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* We&squot;re back.  Did the debugger cancel the sig?  */
r_if
c_cond
(paren
op_logical_neg
(paren
id|signr
op_assign
id|current-&gt;exit_code
)paren
)paren
r_continue
suffix:semicolon
id|current-&gt;exit_code
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* The debugger continued.  Ignore SIGSTOP.  */
r_if
c_cond
(paren
id|signr
op_eq
id|SIGSTOP
)paren
r_continue
suffix:semicolon
multiline_comment|/* Update the siginfo structure.  Is this good?  */
r_if
c_cond
(paren
id|signr
op_ne
id|info.si_signo
)paren
(brace
id|info.si_signo
op_assign
id|signr
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|SI_USER
suffix:semicolon
id|info.si_pid
op_assign
id|current-&gt;p_pptr-&gt;pid
suffix:semicolon
id|info.si_uid
op_assign
id|current-&gt;p_pptr-&gt;uid
suffix:semicolon
)brace
multiline_comment|/* If the (new) signal is now blocked, requeue it.  */
r_if
c_cond
(paren
id|sigismember
c_func
(paren
op_amp
id|current-&gt;blocked
comma
id|signr
)paren
)paren
(brace
id|send_sig_info
c_func
(paren
id|signr
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
id|ka
op_assign
op_amp
id|current-&gt;sig-&gt;action
(braket
id|signr
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ka-&gt;sa.sa_handler
op_eq
id|SIG_IGN
)paren
(brace
r_if
c_cond
(paren
id|signr
op_ne
id|SIGCHLD
)paren
r_continue
suffix:semicolon
multiline_comment|/* Check for SIGCHLD: it&squot;s special.  */
r_while
c_loop
(paren
id|sys_wait4
c_func
(paren
op_minus
l_int|1
comma
l_int|NULL
comma
id|WNOHANG
comma
l_int|NULL
)paren
OG
l_int|0
)paren
multiline_comment|/* nothing */
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ka-&gt;sa.sa_handler
op_eq
id|SIG_DFL
)paren
(brace
r_int
id|exit_code
op_assign
id|signr
suffix:semicolon
multiline_comment|/* Init gets no signals it doesn&squot;t want.  */
r_if
c_cond
(paren
id|current-&gt;pid
op_eq
l_int|1
)paren
r_continue
suffix:semicolon
r_switch
c_cond
(paren
id|signr
)paren
(brace
r_case
id|SIGCONT
suffix:colon
r_case
id|SIGCHLD
suffix:colon
r_case
id|SIGWINCH
suffix:colon
r_continue
suffix:semicolon
r_case
id|SIGTSTP
suffix:colon
r_case
id|SIGTTIN
suffix:colon
r_case
id|SIGTTOU
suffix:colon
r_if
c_cond
(paren
id|is_orphaned_pgrp
c_func
(paren
id|current-&gt;pgrp
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* FALLTHRU */
r_case
id|SIGSTOP
suffix:colon
id|current-&gt;state
op_assign
id|TASK_STOPPED
suffix:semicolon
id|current-&gt;exit_code
op_assign
id|signr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|current-&gt;p_pptr-&gt;sig-&gt;action
(braket
id|SIGCHLD
op_minus
l_int|1
)braket
dot
id|sa.sa_flags
op_amp
id|SA_NOCLDSTOP
)paren
)paren
id|notify_parent
c_func
(paren
id|current
comma
id|SIGCHLD
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
r_case
id|SIGQUIT
suffix:colon
r_case
id|SIGILL
suffix:colon
r_case
id|SIGTRAP
suffix:colon
r_case
id|SIGABRT
suffix:colon
r_case
id|SIGFPE
suffix:colon
r_case
id|SIGSEGV
suffix:colon
r_if
c_cond
(paren
id|do_coredump
c_func
(paren
id|signr
comma
id|regs
)paren
)paren
id|exit_code
op_or_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* FALLTHRU */
r_default
suffix:colon
id|sigaddset
c_func
(paren
op_amp
id|current-&gt;pending.signal
comma
id|signr
)paren
suffix:semicolon
id|recalc_sigpending
c_func
(paren
id|current
)paren
suffix:semicolon
id|current-&gt;flags
op_or_assign
id|PF_SIGNALED
suffix:semicolon
id|do_exit
c_func
(paren
id|exit_code
)paren
suffix:semicolon
multiline_comment|/* NOTREACHED */
)brace
)brace
r_if
c_cond
(paren
id|regs-&gt;regs
(braket
l_int|0
)braket
)paren
id|syscall_restart
c_func
(paren
id|regs
comma
id|ka
)paren
suffix:semicolon
multiline_comment|/* Whee!  Actually deliver the signal.  */
id|handle_signal
c_func
(paren
id|signr
comma
id|ka
comma
op_amp
id|info
comma
id|oldset
comma
id|regs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Who&squot;s code doesn&squot;t conform to the restartable syscall convention&n;&t; * dies here!!!  The li instruction, a single machine instruction,&n;&t; * must directly be followed by the syscall instruction.&n;&t; */
r_if
c_cond
(paren
id|regs-&gt;regs
(braket
l_int|0
)braket
)paren
(brace
r_if
c_cond
(paren
id|regs-&gt;regs
(braket
l_int|2
)braket
op_eq
id|ERESTARTNOHAND
op_logical_or
id|regs-&gt;regs
(braket
l_int|2
)braket
op_eq
id|ERESTARTSYS
op_logical_or
id|regs-&gt;regs
(braket
l_int|2
)braket
op_eq
id|ERESTARTNOINTR
)paren
(brace
id|regs-&gt;cp0_epc
op_sub_assign
l_int|8
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|asmlinkage
r_void
DECL|function|irix_sigreturn
id|irix_sigreturn
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|sigctx_irix5
op_star
id|context
comma
op_star
id|magic
suffix:semicolon
r_int
r_int
id|umask
comma
id|mask
suffix:semicolon
id|u64
op_star
id|fregs
suffix:semicolon
r_int
id|sig
comma
id|i
comma
id|base
op_assign
l_int|0
suffix:semicolon
id|sigset_t
id|blocked
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;regs
(braket
l_int|2
)braket
op_eq
l_int|1000
)paren
(brace
id|base
op_assign
l_int|1
suffix:semicolon
)brace
id|context
op_assign
(paren
r_struct
id|sigctx_irix5
op_star
)paren
id|regs-&gt;regs
(braket
id|base
op_plus
l_int|4
)braket
suffix:semicolon
id|magic
op_assign
(paren
r_struct
id|sigctx_irix5
op_star
)paren
id|regs-&gt;regs
(braket
id|base
op_plus
l_int|5
)braket
suffix:semicolon
id|sig
op_assign
(paren
r_int
)paren
id|regs-&gt;regs
(braket
id|base
op_plus
l_int|6
)braket
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
id|printk
c_func
(paren
l_string|&quot;[%s:%d] IRIX sigreturn(scp[%p],ucp[%p],sig[%d])&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
id|context
comma
id|magic
comma
id|sig
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|context
)paren
id|context
op_assign
id|magic
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|context
comma
r_sizeof
(paren
r_struct
id|sigctx_irix5
)paren
)paren
)paren
r_goto
id|badframe
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
id|dump_irix5_sigctx
c_func
(paren
id|context
)paren
suffix:semicolon
macro_line|#endif
id|__get_user
c_func
(paren
id|regs-&gt;cp0_epc
comma
op_amp
id|context-&gt;pc
)paren
suffix:semicolon
id|umask
op_assign
id|context-&gt;rmask
suffix:semicolon
id|mask
op_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
comma
id|mask
op_lshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|umask
op_amp
id|mask
)paren
(brace
id|__get_user
c_func
(paren
id|regs-&gt;regs
(braket
id|i
)braket
comma
op_amp
id|context-&gt;regs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
id|__get_user
c_func
(paren
id|regs-&gt;hi
comma
op_amp
id|context-&gt;hi
)paren
suffix:semicolon
id|__get_user
c_func
(paren
id|regs-&gt;lo
comma
op_amp
id|context-&gt;lo
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|umask
op_amp
l_int|1
)paren
op_logical_and
id|context-&gt;usedfp
)paren
(brace
id|fregs
op_assign
(paren
id|u64
op_star
)paren
op_amp
id|current-&gt;thread.fpu
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fregs
(braket
id|i
)braket
op_assign
(paren
id|u64
)paren
id|context-&gt;fpregs
(braket
id|i
)braket
suffix:semicolon
)brace
id|__get_user
c_func
(paren
id|current-&gt;thread.fpu.hard.control
comma
op_amp
id|context-&gt;fpcsr
)paren
suffix:semicolon
)brace
multiline_comment|/* XXX do sigstack crapola here... XXX */
r_if
c_cond
(paren
id|__copy_from_user
c_func
(paren
op_amp
id|blocked
comma
op_amp
id|context-&gt;sigset
comma
r_sizeof
(paren
id|blocked
)paren
)paren
)paren
r_goto
id|badframe
suffix:semicolon
id|sigdelsetmask
c_func
(paren
op_amp
id|blocked
comma
op_complement
id|_BLOCKABLE
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
id|current-&gt;blocked
op_assign
id|blocked
suffix:semicolon
id|recalc_sigpending
c_func
(paren
id|current
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Don&squot;t let your children do this ...&n;&t; */
r_if
c_cond
(paren
id|current-&gt;ptrace
op_amp
id|PT_TRACESYS
)paren
id|syscall_trace
c_func
(paren
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;move&bslash;t$29,%0&bslash;n&bslash;t&quot;
l_string|&quot;j&bslash;tret_from_sys_call&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
op_amp
id|regs
)paren
)paren
suffix:semicolon
multiline_comment|/* Unreached */
id|badframe
suffix:colon
id|force_sig
c_func
(paren
id|SIGSEGV
comma
id|current
)paren
suffix:semicolon
)brace
DECL|struct|sigact_irix5
r_struct
id|sigact_irix5
(brace
DECL|member|flags
r_int
id|flags
suffix:semicolon
DECL|member|handler
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
)paren
suffix:semicolon
DECL|member|sigset
id|u32
id|sigset
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|_unused0
r_int
id|_unused0
(braket
l_int|2
)braket
suffix:semicolon
)brace
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
DECL|function|dump_sigact_irix5
r_static
r_inline
r_void
id|dump_sigact_irix5
c_func
(paren
r_struct
id|sigact_irix5
op_star
id|p
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&lt;f[%d] hndlr[%08lx] msk[%08lx]&gt;&quot;
comma
id|p-&gt;flags
comma
(paren
r_int
r_int
)paren
id|p-&gt;handler
comma
(paren
r_int
r_int
)paren
id|p-&gt;sigset
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif
id|asmlinkage
r_int
DECL|function|irix_sigaction
id|irix_sigaction
c_func
(paren
r_int
id|sig
comma
r_const
r_struct
id|sigaction
op_star
id|act
comma
r_struct
id|sigaction
op_star
id|oact
comma
r_void
op_star
id|trampoline
)paren
(brace
r_struct
id|k_sigaction
id|new_ka
comma
id|old_ka
suffix:semicolon
r_int
id|ret
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
id|printk
c_func
(paren
l_string|&quot; (%d,%s,%s,%08lx) &quot;
comma
id|sig
comma
(paren
op_logical_neg
r_new
ques
c_cond
l_string|&quot;0&quot;
suffix:colon
l_string|&quot;NEW&quot;
)paren
comma
(paren
op_logical_neg
id|old
ques
c_cond
l_string|&quot;0&quot;
suffix:colon
l_string|&quot;OLD&quot;
)paren
comma
id|trampoline
)paren
suffix:semicolon
r_if
c_cond
(paren
r_new
)paren
(brace
id|dump_sigact_irix5
c_func
(paren
r_new
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|act
)paren
(brace
id|sigset_t
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|act
comma
r_sizeof
(paren
op_star
id|act
)paren
)paren
op_logical_or
id|__get_user
c_func
(paren
id|new_ka.sa.sa_handler
comma
op_amp
id|act-&gt;sa_handler
)paren
op_logical_or
id|__get_user
c_func
(paren
id|new_ka.sa.sa_flags
comma
op_amp
id|act-&gt;sa_flags
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|__copy_from_user
c_func
(paren
op_amp
id|mask
comma
op_amp
id|act-&gt;sa_mask
comma
r_sizeof
(paren
id|sigset_t
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Hmmm... methinks IRIX libc always passes a valid trampoline&n;&t;&t; * value for all invocations of sigaction.  Will have to&n;&t;&t; * investigate.  POSIX POSIX, die die die...&n;&t;&t; */
id|new_ka.sa.sa_restorer
op_assign
id|trampoline
suffix:semicolon
)brace
multiline_comment|/* XXX Implement SIG_SETMASK32 for IRIX compatibility */
id|ret
op_assign
id|do_sigaction
c_func
(paren
id|sig
comma
id|act
ques
c_cond
op_amp
id|new_ka
suffix:colon
l_int|NULL
comma
id|oact
ques
c_cond
op_amp
id|old_ka
suffix:colon
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
op_logical_and
id|oact
)paren
(brace
r_if
c_cond
(paren
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|oact
comma
r_sizeof
(paren
op_star
id|oact
)paren
)paren
op_logical_or
id|__put_user
c_func
(paren
id|old_ka.sa.sa_handler
comma
op_amp
id|oact-&gt;sa_handler
)paren
op_logical_or
id|__put_user
c_func
(paren
id|old_ka.sa.sa_flags
comma
op_amp
id|oact-&gt;sa_flags
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|__copy_to_user
c_func
(paren
op_amp
id|old_ka.sa.sa_mask
comma
op_amp
id|oact-&gt;sa_mask
comma
r_sizeof
(paren
id|sigset_t
)paren
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|irix_sigpending
id|asmlinkage
r_int
id|irix_sigpending
c_func
(paren
id|irix_sigset_t
op_star
id|set
)paren
(brace
r_return
id|do_sigpending
c_func
(paren
id|set
comma
r_sizeof
(paren
op_star
id|set
)paren
)paren
suffix:semicolon
)brace
DECL|function|irix_sigprocmask
id|asmlinkage
r_int
id|irix_sigprocmask
c_func
(paren
r_int
id|how
comma
id|irix_sigset_t
op_star
r_new
comma
id|irix_sigset_t
op_star
id|old
)paren
(brace
id|sigset_t
id|oldbits
comma
id|newbits
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
r_new
)paren
(brace
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
r_new
comma
r_sizeof
(paren
op_star
r_new
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|__copy_from_user
c_func
(paren
op_amp
id|newbits
comma
r_new
comma
r_sizeof
(paren
r_int
r_int
)paren
op_star
l_int|4
)paren
suffix:semicolon
id|sigdelsetmask
c_func
(paren
op_amp
id|newbits
comma
op_complement
id|_BLOCKABLE
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
id|oldbits
op_assign
id|current-&gt;blocked
suffix:semicolon
r_switch
c_cond
(paren
id|how
)paren
(brace
r_case
l_int|1
suffix:colon
id|sigorsets
c_func
(paren
op_amp
id|newbits
comma
op_amp
id|oldbits
comma
op_amp
id|newbits
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|sigandsets
c_func
(paren
op_amp
id|newbits
comma
op_amp
id|oldbits
comma
op_amp
id|newbits
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
r_break
suffix:semicolon
r_case
l_int|256
suffix:colon
id|siginitset
c_func
(paren
op_amp
id|newbits
comma
id|newbits.sig
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|recalc_sigpending
c_func
(paren
id|current
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|old
)paren
(brace
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|old
comma
r_sizeof
(paren
op_star
id|old
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_return
id|error
suffix:semicolon
)brace
id|__copy_to_user
c_func
(paren
id|old
comma
op_amp
id|current-&gt;blocked
comma
r_sizeof
(paren
r_int
r_int
)paren
op_star
l_int|4
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|irix_sigsuspend
id|asmlinkage
r_int
id|irix_sigsuspend
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|sigset_t
op_star
id|uset
comma
id|saveset
comma
id|newset
suffix:semicolon
id|uset
op_assign
(paren
id|sigset_t
op_star
)paren
id|regs-&gt;regs
(braket
l_int|4
)braket
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|newset
comma
id|uset
comma
r_sizeof
(paren
id|sigset_t
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|sigdelsetmask
c_func
(paren
op_amp
id|newset
comma
op_complement
id|_BLOCKABLE
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
id|saveset
op_assign
id|current-&gt;blocked
suffix:semicolon
id|current-&gt;blocked
op_assign
id|newset
suffix:semicolon
id|recalc_sigpending
c_func
(paren
id|current
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|current-&gt;sigmask_lock
)paren
suffix:semicolon
id|regs-&gt;regs
(braket
l_int|2
)braket
op_assign
op_minus
id|EINTR
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_irix_signal
c_func
(paren
op_amp
id|saveset
comma
id|regs
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
)brace
multiline_comment|/* hate hate hate... */
DECL|struct|irix5_siginfo
r_struct
id|irix5_siginfo
(brace
DECL|member|sig
DECL|member|code
DECL|member|error
r_int
id|sig
comma
id|code
comma
id|error
suffix:semicolon
r_union
(brace
DECL|member|unused
r_char
id|unused
(braket
l_int|128
op_minus
(paren
l_int|3
op_star
l_int|4
)paren
)braket
suffix:semicolon
multiline_comment|/* Safety net. */
r_struct
(brace
DECL|member|pid
r_int
id|pid
suffix:semicolon
r_union
(brace
DECL|member|uid
r_int
id|uid
suffix:semicolon
r_struct
(brace
DECL|member|utime
DECL|member|status
DECL|member|stime
r_int
id|utime
comma
id|status
comma
id|stime
suffix:semicolon
DECL|member|child
)brace
id|child
suffix:semicolon
DECL|member|procdata
)brace
id|procdata
suffix:semicolon
DECL|member|procinfo
)brace
id|procinfo
suffix:semicolon
DECL|member|fault_addr
r_int
r_int
id|fault_addr
suffix:semicolon
r_struct
(brace
DECL|member|fd
r_int
id|fd
suffix:semicolon
DECL|member|band
r_int
id|band
suffix:semicolon
DECL|member|fileinfo
)brace
id|fileinfo
suffix:semicolon
DECL|member|sigval
r_int
r_int
id|sigval
suffix:semicolon
DECL|member|stuff
)brace
id|stuff
suffix:semicolon
)brace
suffix:semicolon
DECL|function|timespectojiffies
r_static
r_inline
r_int
r_int
id|timespectojiffies
c_func
(paren
r_struct
id|timespec
op_star
id|value
)paren
(brace
r_int
r_int
id|sec
op_assign
(paren
r_int
)paren
id|value-&gt;tv_sec
suffix:semicolon
r_int
id|nsec
op_assign
id|value-&gt;tv_nsec
suffix:semicolon
r_if
c_cond
(paren
id|sec
OG
(paren
id|LONG_MAX
op_div
id|HZ
)paren
)paren
r_return
id|LONG_MAX
suffix:semicolon
id|nsec
op_add_assign
l_int|1000000000L
op_div
id|HZ
op_minus
l_int|1
suffix:semicolon
id|nsec
op_div_assign
l_int|1000000000L
op_div
id|HZ
suffix:semicolon
r_return
id|HZ
op_star
id|sec
op_plus
id|nsec
suffix:semicolon
)brace
DECL|function|irix_sigpoll_sys
id|asmlinkage
r_int
id|irix_sigpoll_sys
c_func
(paren
r_int
r_int
op_star
id|set
comma
r_struct
id|irix5_siginfo
op_star
id|info
comma
r_struct
id|timespec
op_star
id|tp
)paren
(brace
r_int
id|expire
op_assign
id|MAX_SCHEDULE_TIMEOUT
suffix:semicolon
id|sigset_t
id|kset
suffix:semicolon
r_int
id|i
comma
id|sig
comma
id|error
comma
id|timeo
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
id|printk
c_func
(paren
l_string|&quot;[%s:%d] irix_sigpoll_sys(%p,%p,%p)&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
id|set
comma
id|info
comma
id|tp
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Must always specify the signal set. */
r_if
c_cond
(paren
op_logical_neg
id|set
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|set
comma
r_sizeof
(paren
id|kset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out
suffix:semicolon
id|__copy_from_user
c_func
(paren
op_amp
id|kset
comma
id|set
comma
r_sizeof
(paren
id|set
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|info
op_logical_and
id|clear_user
c_func
(paren
id|info
comma
r_sizeof
(paren
op_star
id|info
)paren
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp
)paren
(brace
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|tp
comma
r_sizeof
(paren
op_star
id|tp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;tv_sec
op_logical_and
op_logical_neg
id|tp-&gt;tv_nsec
)paren
(brace
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|expire
op_assign
id|timespectojiffies
c_func
(paren
id|tp
)paren
op_plus
(paren
id|tp-&gt;tv_sec
op_logical_or
id|tp-&gt;tv_nsec
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_int
id|tmp
op_assign
l_int|0
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|expire
op_assign
id|schedule_timeout
c_func
(paren
id|expire
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|tmp
op_or_assign
(paren
id|current-&gt;pending.signal.sig
(braket
id|i
)braket
op_amp
id|kset.sig
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|expire
)paren
(brace
id|timeo
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|timeo
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_for
c_loop
(paren
id|sig
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|65
multiline_comment|/* IRIX_NSIG */
suffix:semicolon
id|sig
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sigismember
(paren
op_amp
id|kset
comma
id|sig
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|sigismember
(paren
op_amp
id|current-&gt;pending.signal
comma
id|sig
)paren
)paren
(brace
multiline_comment|/* XXX need more than this... */
r_if
c_cond
(paren
id|info
)paren
id|info-&gt;sig
op_assign
id|sig
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
multiline_comment|/* Should not get here, but do something sane if we do. */
id|error
op_assign
op_minus
id|EINTR
suffix:semicolon
id|out
suffix:colon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/* This is here because of irix5_siginfo definition. */
DECL|macro|P_PID
mdefine_line|#define P_PID    0
DECL|macro|P_PGID
mdefine_line|#define P_PGID   2
DECL|macro|P_ALL
mdefine_line|#define P_ALL    7
r_extern
r_int
id|getrusage
c_func
(paren
r_struct
id|task_struct
op_star
comma
r_int
comma
r_struct
id|rusage
op_star
)paren
suffix:semicolon
DECL|macro|W_EXITED
mdefine_line|#define W_EXITED     1
DECL|macro|W_TRAPPED
mdefine_line|#define W_TRAPPED    2
DECL|macro|W_STOPPED
mdefine_line|#define W_STOPPED    4
DECL|macro|W_CONT
mdefine_line|#define W_CONT       8
DECL|macro|W_NOHANG
mdefine_line|#define W_NOHANG    64
DECL|macro|W_MASK
mdefine_line|#define W_MASK      (W_EXITED | W_TRAPPED | W_STOPPED | W_CONT | W_NOHANG)
DECL|function|irix_waitsys
id|asmlinkage
r_int
id|irix_waitsys
c_func
(paren
r_int
id|type
comma
r_int
id|pid
comma
r_struct
id|irix5_siginfo
op_star
id|info
comma
r_int
id|options
comma
r_struct
id|rusage
op_star
id|ru
)paren
(brace
r_int
id|flag
comma
id|retval
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|task_struct
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
(brace
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|retval
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|info
comma
r_sizeof
(paren
op_star
id|info
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ru
)paren
(brace
id|retval
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|ru
comma
r_sizeof
(paren
op_star
id|ru
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|options
op_amp
op_complement
(paren
id|W_MASK
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|type
op_ne
id|P_PID
op_logical_and
id|type
op_ne
id|P_PGID
op_logical_and
id|type
op_ne
id|P_ALL
)paren
(brace
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|current-&gt;wait_chldexit
comma
op_amp
id|wait
)paren
suffix:semicolon
id|repeat
suffix:colon
id|flag
op_assign
l_int|0
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|tasklist_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|current-&gt;p_cptr
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;p_osptr
)paren
(brace
r_if
c_cond
(paren
(paren
id|type
op_eq
id|P_PID
)paren
op_logical_and
id|p-&gt;pid
op_ne
id|pid
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|type
op_eq
id|P_PGID
)paren
op_logical_and
id|p-&gt;pgrp
op_ne
id|pid
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;exit_signal
op_ne
id|SIGCHLD
)paren
)paren
r_continue
suffix:semicolon
id|flag
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;state
)paren
(brace
r_case
id|TASK_STOPPED
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;exit_code
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|options
op_amp
(paren
id|W_TRAPPED
op_or
id|W_STOPPED
)paren
)paren
op_logical_and
op_logical_neg
(paren
id|p-&gt;ptrace
op_amp
id|PT_PTRACED
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ru
op_ne
l_int|NULL
)paren
id|getrusage
c_func
(paren
id|p
comma
id|RUSAGE_BOTH
comma
id|ru
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|SIGCHLD
comma
op_amp
id|info-&gt;sig
)paren
suffix:semicolon
id|__put_user
c_func
(paren
l_int|0
comma
op_amp
id|info-&gt;code
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|p-&gt;pid
comma
op_amp
id|info-&gt;stuff.procinfo.pid
)paren
suffix:semicolon
id|__put_user
c_func
(paren
(paren
id|p-&gt;exit_code
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
op_amp
id|info-&gt;stuff.procinfo.procdata.child.status
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|p-&gt;times.tms_utime
comma
op_amp
id|info-&gt;stuff.procinfo.procdata.child.utime
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|p-&gt;times.tms_stime
comma
op_amp
id|info-&gt;stuff.procinfo.procdata.child.stime
)paren
suffix:semicolon
id|p-&gt;exit_code
op_assign
l_int|0
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|end_waitsys
suffix:semicolon
r_case
id|TASK_ZOMBIE
suffix:colon
id|current-&gt;times.tms_cutime
op_add_assign
id|p-&gt;times.tms_utime
op_plus
id|p-&gt;times.tms_cutime
suffix:semicolon
id|current-&gt;times.tms_cstime
op_add_assign
id|p-&gt;times.tms_stime
op_plus
id|p-&gt;times.tms_cstime
suffix:semicolon
r_if
c_cond
(paren
id|ru
op_ne
l_int|NULL
)paren
id|getrusage
c_func
(paren
id|p
comma
id|RUSAGE_BOTH
comma
id|ru
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|SIGCHLD
comma
op_amp
id|info-&gt;sig
)paren
suffix:semicolon
id|__put_user
c_func
(paren
l_int|1
comma
op_amp
id|info-&gt;code
)paren
suffix:semicolon
multiline_comment|/* CLD_EXITED */
id|__put_user
c_func
(paren
id|p-&gt;pid
comma
op_amp
id|info-&gt;stuff.procinfo.pid
)paren
suffix:semicolon
id|__put_user
c_func
(paren
(paren
id|p-&gt;exit_code
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
op_amp
id|info-&gt;stuff.procinfo.procdata.child.status
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|p-&gt;times.tms_utime
comma
op_amp
id|info-&gt;stuff.procinfo.procdata.child.utime
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|p-&gt;times.tms_stime
comma
op_amp
id|info-&gt;stuff.procinfo.procdata.child.stime
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;p_opptr
op_ne
id|p-&gt;p_pptr
)paren
(brace
id|REMOVE_LINKS
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;p_pptr
op_assign
id|p-&gt;p_opptr
suffix:semicolon
id|SET_LINKS
c_func
(paren
id|p
)paren
suffix:semicolon
id|notify_parent
c_func
(paren
id|p
comma
id|SIGCHLD
)paren
suffix:semicolon
)brace
r_else
id|release
c_func
(paren
id|p
)paren
suffix:semicolon
r_goto
id|end_waitsys
suffix:semicolon
r_default
suffix:colon
r_continue
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|tasklist_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
)paren
(brace
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|options
op_amp
id|W_NOHANG
)paren
r_goto
id|end_waitsys
suffix:semicolon
id|retval
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_goto
id|end_waitsys
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_goto
id|repeat
suffix:semicolon
)brace
id|retval
op_assign
op_minus
id|ECHILD
suffix:semicolon
id|end_waitsys
suffix:colon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|current-&gt;wait_chldexit
comma
op_amp
id|wait
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
DECL|struct|irix5_context
r_struct
id|irix5_context
(brace
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|member|link
id|u32
id|link
suffix:semicolon
DECL|member|sigmask
id|u32
id|sigmask
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|sp
DECL|member|size
DECL|member|flags
DECL|member|stack
r_struct
(brace
id|u32
id|sp
comma
id|size
comma
id|flags
suffix:semicolon
)brace
id|stack
suffix:semicolon
DECL|member|regs
r_int
id|regs
(braket
l_int|36
)braket
suffix:semicolon
DECL|member|fpregs
id|u32
id|fpregs
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|fpcsr
id|u32
id|fpcsr
suffix:semicolon
DECL|member|_unused0
id|u32
id|_unused0
suffix:semicolon
DECL|member|_unused1
id|u32
id|_unused1
(braket
l_int|47
)braket
suffix:semicolon
DECL|member|weird_graphics_thing
id|u32
id|weird_graphics_thing
suffix:semicolon
)brace
suffix:semicolon
DECL|function|irix_getcontext
id|asmlinkage
r_int
id|irix_getcontext
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|error
comma
id|i
comma
id|base
op_assign
l_int|0
suffix:semicolon
r_struct
id|irix5_context
op_star
id|ctx
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;regs
(braket
l_int|2
)braket
op_eq
l_int|1000
)paren
id|base
op_assign
l_int|1
suffix:semicolon
id|ctx
op_assign
(paren
r_struct
id|irix5_context
op_star
)paren
id|regs-&gt;regs
(braket
id|base
op_plus
l_int|4
)braket
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
id|printk
c_func
(paren
l_string|&quot;[%s:%d] irix_getcontext(%p)&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
id|ctx
)paren
suffix:semicolon
macro_line|#endif
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|ctx
comma
r_sizeof
(paren
op_star
id|ctx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|__put_user
c_func
(paren
id|current-&gt;thread.irix_oldctx
comma
op_amp
id|ctx-&gt;link
)paren
suffix:semicolon
id|__copy_to_user
c_func
(paren
op_amp
id|ctx-&gt;sigmask
comma
op_amp
id|current-&gt;blocked
comma
r_sizeof
(paren
id|irix_sigset_t
)paren
)paren
suffix:semicolon
multiline_comment|/* XXX Do sigstack stuff someday... */
id|__put_user
c_func
(paren
l_int|0
comma
op_amp
id|ctx-&gt;stack.sp
)paren
suffix:semicolon
id|__put_user
c_func
(paren
l_int|0
comma
op_amp
id|ctx-&gt;stack.size
)paren
suffix:semicolon
id|__put_user
c_func
(paren
l_int|0
comma
op_amp
id|ctx-&gt;stack.flags
)paren
suffix:semicolon
id|__put_user
c_func
(paren
l_int|0
comma
op_amp
id|ctx-&gt;weird_graphics_thing
)paren
suffix:semicolon
id|__put_user
c_func
(paren
l_int|0
comma
op_amp
id|ctx-&gt;regs
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
id|__put_user
c_func
(paren
id|regs-&gt;regs
(braket
id|i
)braket
comma
op_amp
id|ctx-&gt;regs
(braket
id|i
)braket
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|regs-&gt;lo
comma
op_amp
id|ctx-&gt;regs
(braket
l_int|32
)braket
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|regs-&gt;hi
comma
op_amp
id|ctx-&gt;regs
(braket
l_int|33
)braket
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|regs-&gt;cp0_cause
comma
op_amp
id|ctx-&gt;regs
(braket
l_int|34
)braket
)paren
suffix:semicolon
id|__put_user
c_func
(paren
id|regs-&gt;cp0_epc
comma
op_amp
id|ctx-&gt;regs
(braket
l_int|35
)braket
)paren
suffix:semicolon
id|flags
op_assign
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|current-&gt;used_math
)paren
(brace
id|flags
op_and_assign
op_complement
(paren
l_int|0x08
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* XXX wheee... */
id|printk
c_func
(paren
l_string|&quot;Wheee, no code for saving IRIX FPU context yet.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|__put_user
c_func
(paren
id|flags
comma
op_amp
id|ctx-&gt;flags
)paren
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|error
suffix:semicolon
)brace
DECL|function|irix_setcontext
id|asmlinkage
r_int
r_int
id|irix_setcontext
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|error
comma
id|base
op_assign
l_int|0
suffix:semicolon
r_struct
id|irix5_context
op_star
id|ctx
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;regs
(braket
l_int|2
)braket
op_eq
l_int|1000
)paren
(brace
id|base
op_assign
l_int|1
suffix:semicolon
)brace
id|ctx
op_assign
(paren
r_struct
id|irix5_context
op_star
)paren
id|regs-&gt;regs
(braket
id|base
op_plus
l_int|4
)braket
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
id|printk
c_func
(paren
l_string|&quot;[%s:%d] irix_setcontext(%p)&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
id|ctx
)paren
suffix:semicolon
macro_line|#endif
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|ctx
comma
r_sizeof
(paren
op_star
id|ctx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|ctx-&gt;flags
op_amp
l_int|0x02
)paren
(brace
multiline_comment|/* XXX sigstack garbage, todo... */
id|printk
c_func
(paren
l_string|&quot;Wheee, cannot do sigstack stuff in setcontext&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctx-&gt;flags
op_amp
l_int|0x04
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* XXX extra control block stuff... todo... */
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|regs-&gt;regs
(braket
id|i
)braket
op_assign
id|ctx-&gt;regs
(braket
id|i
)braket
suffix:semicolon
)brace
id|regs-&gt;lo
op_assign
id|ctx-&gt;regs
(braket
l_int|32
)braket
suffix:semicolon
id|regs-&gt;hi
op_assign
id|ctx-&gt;regs
(braket
l_int|33
)braket
suffix:semicolon
id|regs-&gt;cp0_epc
op_assign
id|ctx-&gt;regs
(braket
l_int|35
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctx-&gt;flags
op_amp
l_int|0x08
)paren
(brace
multiline_comment|/* XXX fpu context, blah... */
id|printk
c_func
(paren
l_string|&quot;Wheee, cannot restore FPU context yet...&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|current-&gt;thread.irix_oldctx
op_assign
id|ctx-&gt;link
suffix:semicolon
id|error
op_assign
id|regs-&gt;regs
(braket
l_int|2
)braket
suffix:semicolon
id|out
suffix:colon
r_return
id|error
suffix:semicolon
)brace
DECL|struct|irix_sigstack
DECL|member|sp
DECL|member|status
r_struct
id|irix_sigstack
(brace
r_int
r_int
id|sp
suffix:semicolon
r_int
id|status
suffix:semicolon
)brace
suffix:semicolon
DECL|function|irix_sigstack
id|asmlinkage
r_int
id|irix_sigstack
c_func
(paren
r_struct
id|irix_sigstack
op_star
r_new
comma
r_struct
id|irix_sigstack
op_star
id|old
)paren
(brace
r_int
id|error
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
id|printk
c_func
(paren
l_string|&quot;[%s:%d] irix_sigstack(%p,%p)&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
r_new
comma
id|old
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
r_new
)paren
(brace
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
r_new
comma
r_sizeof
(paren
op_star
r_new
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|old
)paren
(brace
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|old
comma
r_sizeof
(paren
op_star
id|old
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
)brace
id|error
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|error
suffix:semicolon
)brace
DECL|struct|irix_sigaltstack
DECL|member|sp
DECL|member|size
DECL|member|status
r_struct
id|irix_sigaltstack
(brace
r_int
r_int
id|sp
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|status
suffix:semicolon
)brace
suffix:semicolon
DECL|function|irix_sigaltstack
id|asmlinkage
r_int
id|irix_sigaltstack
c_func
(paren
r_struct
id|irix_sigaltstack
op_star
r_new
comma
r_struct
id|irix_sigaltstack
op_star
id|old
)paren
(brace
r_int
id|error
suffix:semicolon
macro_line|#ifdef DEBUG_SIG
id|printk
c_func
(paren
l_string|&quot;[%s:%d] irix_sigaltstack(%p,%p)&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
r_new
comma
id|old
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
r_new
)paren
(brace
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
r_new
comma
r_sizeof
(paren
op_star
r_new
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|old
)paren
(brace
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|old
comma
r_sizeof
(paren
op_star
id|old
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
)brace
id|error
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|error
op_assign
l_int|0
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|struct|irix_procset
r_struct
id|irix_procset
(brace
DECL|member|cmd
DECL|member|ltype
DECL|member|lid
DECL|member|rtype
DECL|member|rid
r_int
id|cmd
comma
id|ltype
comma
id|lid
comma
id|rtype
comma
id|rid
suffix:semicolon
)brace
suffix:semicolon
DECL|function|irix_sigsendset
id|asmlinkage
r_int
id|irix_sigsendset
c_func
(paren
r_struct
id|irix_procset
op_star
id|pset
comma
r_int
id|sig
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|pset
comma
r_sizeof
(paren
op_star
id|pset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
macro_line|#ifdef DEBUG_SIG
id|printk
c_func
(paren
l_string|&quot;[%s:%d] irix_sigsendset([%d,%d,%d,%d,%d],%d)&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
id|pset-&gt;cmd
comma
id|pset-&gt;ltype
comma
id|pset-&gt;lid
comma
id|pset-&gt;rtype
comma
id|pset-&gt;rid
comma
id|sig
)paren
suffix:semicolon
macro_line|#endif
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|out
suffix:colon
r_return
id|error
suffix:semicolon
)brace
eof
