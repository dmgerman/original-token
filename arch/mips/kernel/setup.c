multiline_comment|/*&n; *  linux/arch/mips/kernel/setup.c&n; *&n; *  Copyright (C) 1995  Linus Torvalds&n; *  Copyright (C) 1995  Ralf Baechle&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/ldt.h&gt;
macro_line|#include &lt;linux/user.h&gt;
macro_line|#include &lt;linux/a.out.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;asm/asm.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/vector.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/stackframe.h&gt;
macro_line|#include &lt;asm/system.h&gt;
multiline_comment|/*&n; * How to handle the machine&squot;s features&n; */
DECL|variable|feature
r_struct
id|feature
op_star
id|feature
suffix:semicolon
macro_line|#ifdef CONFIG_ACER_PICA_61
r_void
id|acer_pica_61_handle_int
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; * How to access the floppy controller&squot;s ports&n; */
r_int
r_char
id|jazz_fd_inb
c_func
(paren
r_int
r_int
id|port
)paren
suffix:semicolon
r_void
id|jazz_fd_outb
c_func
(paren
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
suffix:semicolon
multiline_comment|/*&n; * How to access the floppy DMA functions.&n; */
r_void
id|jazz_fd_enable_dma
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_disable_dma
c_func
(paren
r_void
)paren
suffix:semicolon
r_int
id|jazz_fd_request_dma
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_free_dma
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_clear_dma_ff
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_set_dma_mode
c_func
(paren
r_char
id|mode
)paren
suffix:semicolon
r_void
id|jazz_fd_set_dma_addr
c_func
(paren
r_int
r_int
id|a
)paren
suffix:semicolon
r_void
id|jazz_fd_set_dma_count
c_func
(paren
r_int
r_int
id|count
)paren
suffix:semicolon
r_int
id|jazz_fd_get_dma_residue
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_enable_irq
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_disable_irq
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_cacheflush
c_func
(paren
r_int
r_char
op_star
id|addr
comma
r_int
r_int
id|size
)paren
suffix:semicolon
multiline_comment|/*&n; * How to access the RTC functions.&n; */
r_int
r_char
id|jazz_rtc_read_data
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_rtc_write_data
c_func
(paren
r_int
r_char
id|data
)paren
suffix:semicolon
DECL|variable|acer_pica_61_feature
r_struct
id|feature
id|acer_pica_61_feature
op_assign
(brace
id|acer_pica_61_handle_int
comma
multiline_comment|/*&n;&t; * How to access the floppy controller&squot;s ports&n;&t; */
id|jazz_fd_inb
comma
id|jazz_fd_outb
comma
multiline_comment|/*&n;&t; * How to access the floppy DMA functions.&n;&t; */
id|jazz_fd_enable_dma
comma
id|jazz_fd_disable_dma
comma
id|jazz_fd_request_dma
comma
id|jazz_fd_free_dma
comma
id|jazz_fd_clear_dma_ff
comma
id|jazz_fd_set_dma_mode
comma
id|jazz_fd_set_dma_addr
comma
id|jazz_fd_set_dma_count
comma
id|jazz_fd_get_dma_residue
comma
id|jazz_fd_enable_irq
comma
id|jazz_fd_disable_irq
comma
id|jazz_fd_cacheflush
comma
multiline_comment|/*&n;&t; * How to access the RTC functions.&n;&t; */
id|jazz_rtc_read_data
comma
id|jazz_rtc_write_data
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_DECSTATION
r_void
id|decstation_handle_handle_int
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|isa_outb
c_func
(paren
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
suffix:semicolon
r_int
r_char
id|isa_inb
c_func
(paren
r_int
r_int
id|port
)paren
suffix:semicolon
DECL|variable|decstation_feature
r_struct
id|feature
id|decstation_feature
op_assign
(brace
id|decstation_handle_handle_int
comma
id|isa_inb
multiline_comment|/* Dummy - dunno how to handle this yet */
id|isa_outb
comma
multiline_comment|/* Dummy - dunno how to handle this yet */
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_DESKSTATION_RPC44
r_void
id|deskstation_rpc44_handle_int
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|isa_outb
c_func
(paren
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
suffix:semicolon
r_int
r_char
id|isa_inb
c_func
(paren
r_int
r_int
id|port
)paren
suffix:semicolon
DECL|variable|deskstation_rpc44_feature
r_struct
id|feature
id|deskstation_rpc44_feature
op_assign
(brace
id|deskstation_rpc44_handle_int
comma
id|isa_inb
id|isa_outb
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_DESKSTATION_TYNE
r_void
id|deskstation_tyne_handle_int
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|isa_outb
c_func
(paren
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
suffix:semicolon
r_int
r_char
id|isa_inb
c_func
(paren
r_int
r_int
id|port
)paren
suffix:semicolon
DECL|variable|deskstation_tyne_feature
r_struct
id|feature
id|deskstation_tyne_feature
op_assign
(brace
id|deskstation_tyne_handle_int
comma
id|isa_inb
comma
id|isa_outb
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_MIPS_MAGNUM_4000
r_void
id|mips_magnum_4000_handle_int
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; * How to access the floppy controller&squot;s ports&n; */
r_int
r_char
id|jazz_fd_inb
c_func
(paren
r_int
r_int
id|port
)paren
suffix:semicolon
r_void
id|jazz_fd_outb
c_func
(paren
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
suffix:semicolon
multiline_comment|/*&n; * How to access the floppy DMA functions.&n; */
r_void
id|jazz_fd_enable_dma
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_disable_dma
c_func
(paren
r_void
)paren
suffix:semicolon
r_int
id|jazz_fd_request_dma
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_free_dma
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_clear_dma_ff
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_set_dma_mode
c_func
(paren
r_char
id|mode
)paren
suffix:semicolon
r_void
id|jazz_fd_set_dma_addr
c_func
(paren
r_int
r_int
id|a
)paren
suffix:semicolon
r_void
id|jazz_fd_set_dma_count
c_func
(paren
r_int
r_int
id|count
)paren
suffix:semicolon
r_int
id|jazz_fd_get_dma_residue
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_enable_irq
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_disable_irq
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_fd_cacheflush
c_func
(paren
r_int
r_char
op_star
id|addr
comma
r_int
r_int
id|size
)paren
suffix:semicolon
multiline_comment|/*&n; * How to access the RTC functions.&n; */
r_int
r_char
id|jazz_rtc_read_data
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|jazz_rtc_write_data
c_func
(paren
r_int
r_char
id|data
)paren
suffix:semicolon
DECL|variable|mips_magnum_4000_feature
r_struct
id|feature
id|mips_magnum_4000_feature
op_assign
(brace
id|mips_magnum_4000_handle_int
comma
multiline_comment|/*&n;&t; * How to access the floppy controller&squot;s ports&n;&t; */
id|jazz_fd_inb
comma
id|jazz_fd_outb
comma
multiline_comment|/*&n;&t; * How to access the floppy DMA functions.&n;&t; */
id|jazz_fd_enable_dma
comma
id|jazz_fd_disable_dma
comma
id|jazz_fd_request_dma
comma
id|jazz_fd_free_dma
comma
id|jazz_fd_clear_dma_ff
comma
id|jazz_fd_set_dma_mode
comma
id|jazz_fd_set_dma_addr
comma
id|jazz_fd_set_dma_count
comma
id|jazz_fd_get_dma_residue
comma
id|jazz_fd_enable_irq
comma
id|jazz_fd_disable_irq
comma
id|jazz_fd_cacheflush
comma
multiline_comment|/*&n;&t; * How to access the RTC functions.&n;&t; */
id|jazz_rtc_read_data
comma
id|jazz_rtc_write_data
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * Tell us the machine setup..&n; */
DECL|variable|wait_available
r_char
id|wait_available
suffix:semicolon
multiline_comment|/* set if the &quot;wait&quot; instruction available */
multiline_comment|/*&n; * Bus types ..&n; */
DECL|variable|EISA_bus
r_int
id|EISA_bus
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n; * Setup options&n; */
DECL|variable|drive_info
r_struct
id|drive_info_struct
id|drive_info
suffix:semicolon
DECL|variable|screen_info
r_struct
id|screen_info
id|screen_info
op_assign
id|SCREEN_INFO
suffix:semicolon
DECL|variable|aux_device_present
r_int
r_char
id|aux_device_present
suffix:semicolon
r_extern
r_int
id|ramdisk_size
suffix:semicolon
r_extern
r_int
id|root_mountflags
suffix:semicolon
r_extern
r_int
id|_end
suffix:semicolon
r_extern
r_char
id|empty_zero_page
(braket
id|PAGE_SIZE
)braket
suffix:semicolon
multiline_comment|/*&n; * Initialise this structure so that it will be placed in the&n; * .data section of the object file&n; */
DECL|variable|boot_info
r_struct
id|bootinfo
id|boot_info
op_assign
id|BOOT_INFO
suffix:semicolon
multiline_comment|/*&n; * This is set up by the setup-routine at boot-time&n; */
DECL|macro|PARAM
mdefine_line|#define PARAM&t;empty_zero_page
macro_line|#if 0
mdefine_line|#define ORIG_ROOT_DEV (*(unsigned short *) (PARAM+0x1FC))
mdefine_line|#define AUX_DEVICE_INFO (*(unsigned char *) (PARAM+0x1FF))
macro_line|#endif
DECL|variable|command_line
r_static
r_char
id|command_line
(braket
id|CL_SIZE
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
macro_line|#if 0
multiline_comment|/*&n; * Code for easy access to new style bootinfo&n; *&n; * Parameter:  tag      -- taglist entry&n; *&n; * returns  :  (tag *) -- pointer to taglist entry, NULL for not found&n; */
id|tag
op_star
id|bi_TagFind
c_func
(paren
r_enum
id|bi_tag
id|tag
)paren
(brace
multiline_comment|/* TBD */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Only for taglist creators (bootloaders)&n; *&n; * Parameter:  tag       -- (enum bi_tag) taglist entry&n; *&n; * returns  :  1         -- success&n; *             0         -- failure&n; */
r_int
id|bi_TagAdd
c_func
(paren
r_enum
id|bi_tag
id|tag
comma
r_int
r_int
id|size
comma
r_void
op_star
id|tagdata
)paren
(brace
multiline_comment|/* TBD */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* 0 */
DECL|function|setup_arch
r_void
id|setup_arch
c_func
(paren
r_char
op_star
op_star
id|cmdline_p
comma
r_int
r_int
op_star
id|memory_start_p
comma
r_int
r_int
op_star
id|memory_end_p
)paren
(brace
r_int
r_int
id|memory_start
comma
id|memory_end
suffix:semicolon
r_switch
c_cond
(paren
id|boot_info.machtype
)paren
(brace
macro_line|#ifdef CONFIG_ACER_PICA_61
r_case
id|MACH_ACER_PICA_61
suffix:colon
id|feature
op_assign
op_amp
id|acer_pica_61_feature
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_DECSTATION
r_case
id|MACH_DECSTATION
suffix:colon
id|feature
op_assign
op_amp
id|decstation_feature
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_DESKSTATION_RPC
r_case
id|MACH_DESKSTATION_RPC
suffix:colon
id|feature
op_assign
op_amp
id|deskstation_rpc44_feature
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_DESKSTATION_TYNE
r_case
id|MACH_DESKSTATION_TYNE
suffix:colon
id|feature
op_assign
op_amp
id|deskstation_tyne_feature
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_MIPS_MAGNUM_4000
r_case
id|MACH_MIPS_MAGNUM_4000
suffix:colon
id|feature
op_assign
op_amp
id|mips_magnum_4000_feature
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|panic
c_func
(paren
l_string|&quot;Unsupported architecture&quot;
)paren
suffix:semicolon
)brace
macro_line|#if 0
id|ROOT_DEV
op_assign
id|to_kdev_t
c_func
(paren
id|ORIG_ROOT_DEV
)paren
suffix:semicolon
macro_line|#else
macro_line|#ifdef CONFIG_BLK_DEV_FD
id|ROOT_DEV
op_assign
id|to_kdev_t
c_func
(paren
l_int|0x021c
)paren
suffix:semicolon
multiline_comment|/* fd0H1440 */
macro_line|#else
id|ROOT_DEV
op_assign
id|to_kdev_t
c_func
(paren
l_int|0x0101
)paren
suffix:semicolon
multiline_comment|/* ram */
macro_line|#endif
multiline_comment|/*&t;ROOT_DEV = to_kdev_t(0x00ff); */
multiline_comment|/* NFS */
macro_line|#endif
id|memcpy
c_func
(paren
op_amp
id|drive_info
comma
op_amp
id|boot_info.drive_info
comma
r_sizeof
(paren
id|drive_info
)paren
)paren
suffix:semicolon
macro_line|#if 0
id|aux_device_present
op_assign
id|AUX_DEVICE_INFO
suffix:semicolon
macro_line|#endif
id|memory_end
op_assign
id|boot_info.memupper
suffix:semicolon
id|memory_end
op_and_assign
id|PAGE_MASK
suffix:semicolon
id|ramdisk_size
op_assign
id|boot_info.ramdisk_size
suffix:semicolon
r_if
c_cond
(paren
id|boot_info.mount_root_rdonly
)paren
id|root_mountflags
op_or_assign
id|MS_RDONLY
suffix:semicolon
id|memory_start
op_assign
(paren
r_int
r_int
)paren
op_amp
id|_end
suffix:semicolon
id|memory_start
op_add_assign
(paren
id|ramdisk_size
op_lshift
l_int|10
)paren
suffix:semicolon
op_star
id|cmdline_p
op_assign
id|command_line
suffix:semicolon
op_star
id|memory_start_p
op_assign
id|memory_start
suffix:semicolon
op_star
id|memory_end_p
op_assign
id|memory_end
suffix:semicolon
macro_line|#if 0
multiline_comment|/*&n;&t; * Check that struct pt_regs is defined properly&n;&t; * (Should be optimized away, but gcc 2.6.3 is too bad..)&n;&t; */
r_if
c_cond
(paren
id|FR_SIZE
op_ne
r_sizeof
(paren
r_struct
id|pt_regs
)paren
op_logical_or
id|FR_SIZE
op_amp
l_int|7
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Check_definition_of_struct_pt_regs&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
macro_line|#ifdef CONFIG_PROC_FS
multiline_comment|/*&n; * BUFFER is PAGE_SIZE bytes long.&n; */
DECL|function|get_cpuinfo
r_int
id|get_cpuinfo
c_func
(paren
r_char
op_star
id|buffer
)paren
(brace
r_const
r_char
op_star
id|cpu_name
(braket
)braket
op_assign
id|CPU_NAMES
suffix:semicolon
r_const
r_char
op_star
id|mach_name
(braket
)braket
op_assign
id|MACH_NAMES
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;cpu&bslash;t&bslash;t&bslash;t: MIPS&bslash;n&quot;
l_string|&quot;cpu model&bslash;t&bslash;t: %s&bslash;n&quot;
l_string|&quot;system type&bslash;t&bslash;t: %s&bslash;n&quot;
l_string|&quot;BogoMIPS&bslash;t&bslash;t: %lu.%02lu&bslash;n&quot;
comma
id|cpu_name
(braket
id|boot_info.cputype
OL
id|CPU_LAST
ques
c_cond
id|boot_info.cputype
suffix:colon
id|CPU_UNKNOWN
)braket
comma
id|mach_name
(braket
id|boot_info.machtype
OL
id|CPU_LAST
ques
c_cond
id|boot_info.machtype
suffix:colon
id|CPU_UNKNOWN
)braket
comma
id|loops_per_sec
op_div
l_int|500000
comma
(paren
id|loops_per_sec
op_div
l_int|5000
)paren
op_mod
l_int|100
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
eof
