multiline_comment|/*&n; * The real floating point exception handler.  While it doesn&squot;t really&n; * make sense to have this in a module, it makes debugging of this code&n; * in the kernel space a lot easier.  So far this handler in the released&n; * kernel source is just a dummy.&n; *&n; * Copyright (C) 1997, 2000 Ralf Baechle&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;asm/branch.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ralf Baechle &lt;ralf@gnu.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Experimental floating point exception handler&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;MIPS FPU&quot;
)paren
suffix:semicolon
DECL|function|do_fpe
r_static
r_void
id|do_fpe
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|fcr31
)paren
(brace
macro_line|#ifdef CONF_DEBUG_EXCEPTIONS
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;Caught floating exception at epc == %08lx, fcr31 == %08x&bslash;n&quot;
comma
id|regs-&gt;cp0_epc
comma
id|fcr31
)paren
suffix:semicolon
r_if
c_cond
(paren
id|compute_return_epc
c_func
(paren
id|regs
)paren
)paren
r_goto
id|out
suffix:semicolon
id|force_sig
c_func
(paren
id|SIGFPE
comma
id|current
)paren
suffix:semicolon
id|out
suffix:colon
)brace
multiline_comment|/*&n; * For easier experimentation we never increment/decrement&n; * the module usable counter.&n; */
r_int
id|register_fpe
c_func
(paren
r_void
(paren
op_star
id|handler
)paren
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|fcr31
)paren
)paren
suffix:semicolon
r_int
id|unregister_fpe
c_func
(paren
r_void
(paren
op_star
id|handler
)paren
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|fcr31
)paren
)paren
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|register_fpe
c_func
(paren
id|do_fpe
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|unregister_fpe
c_func
(paren
id|do_fpe
)paren
suffix:semicolon
)brace
eof
