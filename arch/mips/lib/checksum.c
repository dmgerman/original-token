multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;MIPS specific IP/TCP/UDP checksumming routines&n; *&n; * Authors:&t;Ralf Baechle, &lt;ralf@waldorf-gmbh.de&gt;&n; *&t;&t;Lots of code moved from tcp.c and ip.c; see those files&n; *&t;&t;for more names.&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;net/checksum.h&gt;
macro_line|#include &lt;asm/string.h&gt;
multiline_comment|/*&n; * computes a partial checksum, e.g. for TCP/UDP fragments&n; */
DECL|function|csum_partial
r_int
r_int
id|csum_partial
c_func
(paren
r_const
r_int
r_char
op_star
id|buff
comma
r_int
id|len
comma
r_int
r_int
id|sum
)paren
(brace
r_int
r_int
id|scratch1
suffix:semicolon
r_int
r_int
id|scratch2
suffix:semicolon
multiline_comment|/*&n;&t; * The GCC generated code for handling carry bits makes&n;&t; * it strongly desireable to do this in assembler!&n;&t; */
id|__asm__
c_func
(paren
"&quot;"
dot
id|set
id|noreorder
dot
id|set
id|noat
id|andi
"$"
l_int|1
comma
op_mod
l_int|5
comma
l_int|2
macro_line|# Check alignment
id|beqz
"$"
l_int|1
comma
l_float|2f
macro_line|# Branch if ok
id|subu
"$"
l_int|1
comma
op_mod
l_int|4
comma
l_int|2
macro_line|# delay slot, Alignment uses up two bytes
id|bgez
"$"
l_int|1
comma
l_float|1f
macro_line|# Jump if we had at least two bytes
id|move
op_mod
l_int|4
comma
"$"
l_int|1
macro_line|# delay slot
id|j
l_float|4f
id|addiu
op_mod
l_int|4
comma
l_int|2
macro_line|# delay slot; len was &lt; 2.  Deal with it
l_int|1
suffix:colon
id|lw
op_mod
l_int|2
comma
(paren
op_mod
l_int|5
)paren
id|addiu
op_mod
l_int|4
comma
l_int|2
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
l_int|2
suffix:colon
id|move
op_mod
l_int|1
comma
op_mod
l_int|4
id|srl
op_mod
l_int|1
comma
op_mod
l_int|1
comma
l_int|5
id|beqz
op_mod
l_int|1
comma
l_float|2f
id|sll
op_mod
l_int|1
comma
op_mod
l_int|1
comma
l_int|5
macro_line|# delay slot
id|addu
op_mod
l_int|1
comma
op_mod
l_int|5
l_int|1
suffix:colon
id|lw
op_mod
l_int|2
comma
l_int|0
(paren
op_mod
l_int|5
)paren
id|addu
op_mod
l_int|5
comma
l_int|32
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|lw
op_mod
l_int|2
comma
op_minus
l_int|28
(paren
op_mod
l_int|5
)paren
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|lw
op_mod
l_int|2
comma
op_minus
l_int|24
(paren
op_mod
l_int|5
)paren
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|lw
op_mod
l_int|2
comma
op_minus
l_int|20
(paren
op_mod
l_int|5
)paren
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|lw
op_mod
l_int|2
comma
op_minus
l_int|16
(paren
op_mod
l_int|5
)paren
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|lw
op_mod
l_int|2
comma
op_minus
l_int|12
(paren
op_mod
l_int|5
)paren
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|lw
op_mod
l_int|2
comma
op_minus
l_int|8
(paren
op_mod
l_int|5
)paren
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|lw
op_mod
l_int|2
comma
op_minus
l_int|4
(paren
op_mod
l_int|5
)paren
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|bne
op_mod
l_int|5
comma
op_mod
l_int|1
comma
l_int|1
id|b
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
macro_line|# delay slot
l_int|2
suffix:colon
id|andi
op_mod
l_int|1
comma
op_mod
l_int|4
comma
l_int|0x1c
id|srl
op_mod
l_int|1
comma
op_mod
l_int|1
comma
l_int|2
id|beqz
op_mod
l_int|1
comma
l_float|4f
id|addu
op_mod
l_int|1
comma
op_mod
l_int|5
macro_line|# delay slot
l_int|3
suffix:colon
id|lw
op_mod
l_int|2
comma
l_int|0
(paren
op_mod
l_int|5
)paren
id|addu
op_mod
l_int|5
comma
l_int|4
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|bne
op_mod
l_int|5
comma
op_mod
l_int|1
comma
l_int|3
id|b
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
macro_line|# delay slot
l_int|4
suffix:colon
id|andi
"$"
l_int|1
comma
op_mod
l_int|3
comma
l_int|2
id|beqz
"$"
l_int|1
comma
l_float|5f
id|move
op_mod
l_int|2
comma
"$"
l_int|0
macro_line|# delay slot
id|lhu
op_mod
l_int|2
comma
(paren
op_mod
l_int|5
)paren
id|addiu
op_mod
l_int|5
comma
l_int|2
l_int|5
suffix:colon
id|andi
"$"
l_int|1
comma
op_mod
l_int|3
comma
l_int|1
id|beqz
"$"
l_int|1
comma
l_float|6f
id|sll
op_mod
l_int|1
comma
l_int|16
macro_line|# delay slot
id|lbu
op_mod
l_int|1
comma
(paren
op_mod
l_int|5
)paren
id|nop
macro_line|# NOP ALERT (spit, gasp)
l_int|6
suffix:colon
op_logical_or
op_mod
l_int|2
comma
op_mod
l_int|1
id|addu
op_mod
l_int|0
comma
op_mod
l_int|2
id|sltu
"$"
l_int|1
comma
op_mod
l_int|0
comma
op_mod
l_int|2
id|addu
op_mod
l_int|0
comma
"$"
l_int|1
l_int|7
suffix:colon
dot
id|set
id|at
dot
id|set
id|reorder
"&quot;"
suffix:colon
l_string|&quot;=r&quot;
(paren
id|sum
)paren
comma
l_string|&quot;=r&quot;
(paren
id|scratch1
)paren
comma
l_string|&quot;=r&quot;
(paren
id|scratch2
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|sum
)paren
comma
l_string|&quot;r&quot;
(paren
id|len
)paren
comma
l_string|&quot;r&quot;
(paren
id|buff
)paren
suffix:colon
l_string|&quot;$1&quot;
)paren
suffix:semicolon
r_return
id|sum
suffix:semicolon
)brace
multiline_comment|/*&n; * copy from fs while checksumming, otherwise like csum_partial&n; */
DECL|function|csum_partial_copy
r_int
r_int
id|csum_partial_copy
c_func
(paren
r_const
r_char
op_star
id|src
comma
r_char
op_star
id|dst
comma
r_int
id|len
comma
r_int
id|sum
)paren
(brace
multiline_comment|/*&n;&t; * It&squot;s 2:30 am and I don&squot;t feel like doing it real ...&n;&t; * This is lots slower than the real thing (tm)&n;&t; */
id|sum
op_assign
id|csum_partial
c_func
(paren
id|src
comma
id|len
comma
id|sum
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dst
comma
id|src
comma
id|len
)paren
suffix:semicolon
r_return
id|sum
suffix:semicolon
)brace
eof
