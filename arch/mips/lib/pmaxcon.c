multiline_comment|/* ----------------------------------------------------------------------&n; * console.c&n; *&n; * Copyright (C) 1994 by Waldorf Electronic,&n; * written by Ralf Baechle and Andreas Busse&n; * Copyright (C) 1995 Paul M. Antoine (PMAX)&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive for&n; * more details.&n; * ---------------------------------------------------------------------- */
multiline_comment|/*&n; * FIXME: This file is hacked to be hardwired for the Personal DECStation&n; *        Only thought of as a debugging console output&n; */
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
DECL|variable|size_x
r_static
r_int
r_int
id|size_x
suffix:semicolon
DECL|variable|size_y
r_static
r_int
r_int
id|size_y
suffix:semicolon
DECL|variable|cursor_x
r_static
r_int
r_int
id|cursor_x
suffix:semicolon
DECL|variable|cursor_y
r_static
r_int
r_int
id|cursor_y
suffix:semicolon
DECL|variable|vram_addr
r_static
r_volatile
r_int
r_int
op_star
id|vram_addr
suffix:semicolon
DECL|variable|console_needs_init
r_static
r_int
id|console_needs_init
op_assign
l_int|1
suffix:semicolon
r_extern
r_struct
id|bootinfo
id|boot_info
suffix:semicolon
r_extern
r_struct
id|screen_info
id|screen_info
suffix:semicolon
multiline_comment|/*&n; * Here is the base address of the prom calls&n; */
DECL|variable|pmax_rex_base
r_int
r_int
id|pmax_rex_base
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ----------------------------------------------------------------------&n; * init_console()&n; * ---------------------------------------------------------------------- */
DECL|function|init_console
r_void
id|init_console
c_func
(paren
r_void
)paren
(brace
id|size_x
op_assign
l_int|80
suffix:semicolon
id|size_y
op_assign
l_int|50
suffix:semicolon
id|cursor_x
op_assign
l_int|0
suffix:semicolon
id|cursor_y
op_assign
l_int|0
suffix:semicolon
id|vram_addr
op_assign
(paren
r_int
r_int
op_star
)paren
l_int|0xe10b8000
suffix:semicolon
id|console_needs_init
op_assign
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|set_size_x
id|set_size_x
c_func
(paren
r_int
r_int
id|x
)paren
(brace
id|size_x
op_assign
id|x
suffix:semicolon
)brace
r_void
DECL|function|set_size_y
id|set_size_y
c_func
(paren
r_int
r_int
id|y
)paren
(brace
id|size_y
op_assign
id|y
suffix:semicolon
)brace
r_void
DECL|function|set_vram
id|set_vram
c_func
(paren
r_int
r_int
op_star
id|vram
)paren
(brace
id|vram_addr
op_assign
id|vram
suffix:semicolon
)brace
multiline_comment|/*&n; * FIXME: Temporary hack - changed its name to avoid conflict in&n; *&t;  drivers/char/vga.c that shouldn&squot;t be there &lt;sigh&gt;  PMA&n; */
r_void
DECL|function|set_pmax_cursor
id|set_pmax_cursor
c_func
(paren
r_int
r_int
id|x
comma
r_int
r_int
id|y
)paren
(brace
id|cursor_x
op_assign
id|x
suffix:semicolon
id|cursor_y
op_assign
id|y
suffix:semicolon
)brace
r_void
DECL|function|print_char
id|print_char
c_func
(paren
r_int
r_int
id|x
comma
r_int
r_int
id|y
comma
r_int
r_char
id|c
)paren
(brace
r_volatile
r_int
r_int
op_star
id|caddr
suffix:semicolon
multiline_comment|/*  caddr = vram_addr + (y * size_x) + x;&n;  *caddr = (*caddr &amp; 0xff00) | 0x0f00 | (unsigned short) c;&n;*/
id|pmax_putch
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|scroll
id|scroll
c_func
(paren
r_void
)paren
(brace
r_volatile
r_int
r_int
op_star
id|caddr
suffix:semicolon
r_register
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;  caddr = vram_addr;&n;  for(i=0; i&lt;size_x * (size_y-1); i++)&n;    *(caddr++) = *(caddr + size_x);&n;&n;   blank last line &n;  &n;  caddr = vram_addr + (size_x * (size_y-1));&n;  for(i=0; i&lt;size_x; i++)&n;    *(caddr++) = (*caddr &amp; 0xff00) | (unsigned short) &squot; &squot;;&n;*/
id|pmax_putch
c_func
(paren
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
DECL|function|print_string
r_void
id|print_string
c_func
(paren
r_const
r_int
r_char
op_star
id|str
)paren
(brace
r_int
r_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|console_needs_init
)paren
id|init_console
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;  while((c = *str++))&n;    switch(c)&n;      {&n;      case &squot;&bslash;n&squot;:&n;&t;cursor_x = 0;&n;&t;cursor_y++;&n;&t;if(cursor_y == size_y)&n;&t;  {&n;&t;    scroll();&n;&t;    cursor_y = size_y - 1;&n;&t;  }&n;&t;break;&n;&n;      default:&n;&t;print_char(cursor_x, cursor_y, c);&n;&t;cursor_x++;&n;&t;if(cursor_x == size_x)&n;&t;  {&n;&t;    cursor_x = 0;&n;&t;    cursor_y++;&n;&t;    if(cursor_y == size_y)&n;&t;      {&n;&t;&t;scroll();&n;&t;&t;cursor_y = size_y - 1;&n;&t;      }&n;&t;  }&n;&t;break;&n;      }&n;*/
id|pmax_printf
c_func
(paren
id|str
)paren
suffix:semicolon
)brace
multiline_comment|/* end of file */
eof
