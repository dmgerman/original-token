multiline_comment|/*&n; *  arch/mips/ddb5074/pci.c -- NEC DDB Vrc-5074 PCI access routines&n; *&n; *  Copyright (C) 2000 Geert Uytterhoeven &lt;geert@sonycom.com&gt;&n; *                     Albert Dorofeev &lt;albert@sonycom.com&gt;&n; *                     Sony Suprastructure Center Europe (SUPC-E), Brussels&n; *&n; *  $Id: pci.c,v 1.4 2000/02/18 00:02:17 ralf Exp $&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm-mips/nile4.h&gt;
DECL|function|nile4_pre_pci_access0
r_static
id|u32
id|nile4_pre_pci_access0
c_func
(paren
r_int
id|slot_num
)paren
(brace
id|u32
id|pci_addr
op_assign
l_int|0
suffix:semicolon
id|u32
id|virt_addr
op_assign
id|NILE4_PCI_CFG_BASE
suffix:semicolon
multiline_comment|/* Set window 1 address 8000000 - 64 bit - 2 MB (PCI config space) */
id|nile4_set_pdar
c_func
(paren
id|NILE4_PCIW1
comma
id|PHYSADDR
c_func
(paren
id|virt_addr
)paren
comma
l_int|0x00200000
comma
l_int|64
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot_num
OG
l_int|2
)paren
id|pci_addr
op_assign
l_int|0x00040000
op_lshift
id|slot_num
suffix:semicolon
r_else
id|virt_addr
op_add_assign
l_int|0x00040000
op_lshift
id|slot_num
suffix:semicolon
id|nile4_set_pmr
c_func
(paren
id|NILE4_PCIINIT1
comma
id|NILE4_PCICMD_CFG
comma
id|pci_addr
)paren
suffix:semicolon
r_return
id|virt_addr
suffix:semicolon
)brace
DECL|function|nile4_post_pci_access0
r_static
r_void
id|nile4_post_pci_access0
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Set window 1 back to address 8000000 - 64 bit - 128 MB (PCI IO space) */
id|nile4_set_pdar
c_func
(paren
id|NILE4_PCIW1
comma
id|PHYSADDR
c_func
(paren
id|NILE4_PCI_MEM_BASE
)paren
comma
l_int|0x08000000
comma
l_int|64
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|nile4_set_pmr
c_func
(paren
id|NILE4_PCIINIT1
comma
id|NILE4_PCICMD_MEM
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|nile4_pci_read_config_dword
r_static
r_int
id|nile4_pci_read_config_dword
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u32
op_star
id|val
)paren
(brace
r_int
id|slot_num
comma
id|func_num
suffix:semicolon
id|u32
id|base
suffix:semicolon
multiline_comment|/*&n;     *  For starters let&squot;s do configuration cycle 0 only (one bus only)&n;     */
r_if
c_cond
(paren
id|dev-&gt;bus-&gt;number
)paren
r_return
id|PCIBIOS_FUNC_NOT_SUPPORTED
suffix:semicolon
id|slot_num
op_assign
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
suffix:semicolon
id|func_num
op_assign
id|PCI_FUNC
c_func
(paren
id|dev-&gt;devfn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot_num
op_eq
l_int|5
)paren
(brace
multiline_comment|/*&n;&t; *  This is Nile 4 and it will crash if we access it like other&n;&t; *   devices&n;&t; */
op_star
id|val
op_assign
id|nile4_in32
c_func
(paren
id|NILE4_PCI_BASE
op_plus
id|where
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
id|base
op_assign
id|nile4_pre_pci_access0
c_func
(paren
id|slot_num
)paren
suffix:semicolon
op_star
id|val
op_assign
op_star
(paren
(paren
r_volatile
id|u32
op_star
)paren
(paren
id|base
op_plus
(paren
id|func_num
op_lshift
l_int|8
)paren
op_plus
(paren
id|where
op_amp
l_int|0xfc
)paren
)paren
)paren
suffix:semicolon
id|nile4_post_pci_access0
c_func
(paren
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|nile4_pci_write_config_dword
r_static
r_int
id|nile4_pci_write_config_dword
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u32
id|val
)paren
(brace
r_int
id|slot_num
comma
id|func_num
suffix:semicolon
id|u32
id|base
suffix:semicolon
multiline_comment|/*&n;     *  For starters let&squot;s do configuration cycle 0 only (one bus only)&n;     */
r_if
c_cond
(paren
id|dev-&gt;bus-&gt;number
)paren
r_return
id|PCIBIOS_FUNC_NOT_SUPPORTED
suffix:semicolon
id|slot_num
op_assign
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
suffix:semicolon
id|func_num
op_assign
id|PCI_FUNC
c_func
(paren
id|dev-&gt;devfn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot_num
op_eq
l_int|5
)paren
(brace
multiline_comment|/*&n;&t; *  This is Nile 4 and it will crash if we access it like other&n;&t; *   devices&n;&t; */
id|nile4_out32
c_func
(paren
id|NILE4_PCI_BASE
op_plus
id|where
comma
id|val
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
id|base
op_assign
id|nile4_pre_pci_access0
c_func
(paren
id|slot_num
)paren
suffix:semicolon
op_star
(paren
(paren
r_volatile
id|u32
op_star
)paren
(paren
id|base
op_plus
(paren
id|func_num
op_lshift
l_int|8
)paren
op_plus
(paren
id|where
op_amp
l_int|0xfc
)paren
)paren
)paren
op_assign
id|val
suffix:semicolon
id|nile4_post_pci_access0
c_func
(paren
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|nile4_pci_read_config_word
r_static
r_int
id|nile4_pci_read_config_word
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u16
op_star
id|val
)paren
(brace
r_int
id|status
suffix:semicolon
id|u32
id|result
suffix:semicolon
id|status
op_assign
id|nile4_pci_read_config_dword
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|result
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
id|where
op_amp
l_int|2
)paren
id|result
op_rshift_assign
l_int|16
suffix:semicolon
op_star
id|val
op_assign
id|result
op_amp
l_int|0xffff
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|nile4_pci_read_config_byte
r_static
r_int
id|nile4_pci_read_config_byte
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u8
op_star
id|val
)paren
(brace
r_int
id|status
suffix:semicolon
id|u32
id|result
suffix:semicolon
id|status
op_assign
id|nile4_pci_read_config_dword
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|result
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
id|where
op_amp
l_int|1
)paren
id|result
op_rshift_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|where
op_amp
l_int|2
)paren
id|result
op_rshift_assign
l_int|16
suffix:semicolon
op_star
id|val
op_assign
id|result
op_amp
l_int|0xff
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|nile4_pci_write_config_word
r_static
r_int
id|nile4_pci_write_config_word
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u16
id|val
)paren
(brace
r_int
id|status
comma
id|shift
op_assign
l_int|0
suffix:semicolon
id|u32
id|result
suffix:semicolon
id|status
op_assign
id|nile4_pci_read_config_dword
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|result
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
id|where
op_amp
l_int|2
)paren
id|shift
op_add_assign
l_int|16
suffix:semicolon
id|result
op_and_assign
op_complement
(paren
l_int|0xffff
op_lshift
id|shift
)paren
suffix:semicolon
id|result
op_or_assign
id|val
op_lshift
id|shift
suffix:semicolon
r_return
id|nile4_pci_write_config_dword
c_func
(paren
id|dev
comma
id|where
comma
id|result
)paren
suffix:semicolon
)brace
DECL|function|nile4_pci_write_config_byte
r_static
r_int
id|nile4_pci_write_config_byte
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u8
id|val
)paren
(brace
r_int
id|status
comma
id|shift
op_assign
l_int|0
suffix:semicolon
id|u32
id|result
suffix:semicolon
id|status
op_assign
id|nile4_pci_read_config_dword
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|result
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
id|where
op_amp
l_int|2
)paren
id|shift
op_add_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|where
op_amp
l_int|1
)paren
id|shift
op_add_assign
l_int|8
suffix:semicolon
id|result
op_and_assign
op_complement
(paren
l_int|0xff
op_lshift
id|shift
)paren
suffix:semicolon
id|result
op_or_assign
id|val
op_lshift
id|shift
suffix:semicolon
r_return
id|nile4_pci_write_config_dword
c_func
(paren
id|dev
comma
id|where
comma
id|result
)paren
suffix:semicolon
)brace
DECL|variable|nile4_pci_ops
r_struct
id|pci_ops
id|nile4_pci_ops
op_assign
(brace
id|nile4_pci_read_config_byte
comma
id|nile4_pci_read_config_word
comma
id|nile4_pci_read_config_dword
comma
id|nile4_pci_write_config_byte
comma
id|nile4_pci_write_config_word
comma
id|nile4_pci_write_config_dword
)brace
suffix:semicolon
DECL|function|pcibios_claim_resources
r_static
r_void
id|__init
id|pcibios_claim_resources
c_func
(paren
r_struct
id|list_head
op_star
id|bus_list
)paren
(brace
r_struct
id|list_head
op_star
id|ln
comma
op_star
id|dn
suffix:semicolon
r_struct
id|pci_bus
op_star
id|bus
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_for
c_loop
(paren
id|ln
op_assign
id|bus_list-&gt;next
suffix:semicolon
id|ln
op_ne
id|bus_list
suffix:semicolon
id|ln
op_assign
id|ln-&gt;next
)paren
(brace
id|bus
op_assign
id|pci_bus_b
c_func
(paren
id|ln
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dn
op_assign
id|bus-&gt;devices.next
suffix:semicolon
id|dn
op_ne
op_amp
id|bus-&gt;devices
suffix:semicolon
id|dn
op_assign
id|dn-&gt;next
)paren
(brace
id|dev
op_assign
id|pci_dev_b
c_func
(paren
id|dn
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|PCI_NUM_RESOURCES
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_struct
id|resource
op_star
id|r
op_assign
op_amp
id|dev-&gt;resource
(braket
id|idx
)braket
suffix:semicolon
r_struct
id|resource
op_star
id|pr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r-&gt;start
)paren
r_continue
suffix:semicolon
id|pr
op_assign
id|pci_find_parent_resource
c_func
(paren
id|dev
comma
id|r
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
op_logical_or
id|request_resource
c_func
(paren
id|pr
comma
id|r
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PCI: Address space collision on region %d of device %s&bslash;n&quot;
comma
id|idx
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* We probably should disable the region, shouldn&squot;t we? */
)brace
)brace
)brace
id|pcibios_claim_resources
c_func
(paren
op_amp
id|bus-&gt;children
)paren
suffix:semicolon
)brace
)brace
DECL|function|pcibios_init
r_void
id|pcibios_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PCI: Probing PCI hardware&bslash;n&quot;
)paren
suffix:semicolon
id|ioport_resource.end
op_assign
l_int|0x1ffffff
suffix:semicolon
id|pci_scan_bus
c_func
(paren
l_int|0
comma
op_amp
id|nile4_pci_ops
comma
l_int|NULL
)paren
suffix:semicolon
id|pcibios_claim_resources
c_func
(paren
op_amp
id|pci_root_buses
)paren
suffix:semicolon
)brace
DECL|function|pcibios_fixup_bus
r_void
id|pcibios_fixup_bus
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
)paren
(brace
r_struct
id|list_head
op_star
id|dn
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_extern
r_struct
id|pci_dev
op_star
id|pci_pmu
suffix:semicolon
multiline_comment|/* for LEDs D2 and D3 */
r_int
id|slot_num
comma
id|func_num
suffix:semicolon
id|u8
id|t8
suffix:semicolon
multiline_comment|/*&n;     *  FIXME: PMON doesn&squot;t autoconfigure the PCI devices&n;     *         For now we just hardcode them for our configuration&n;     */
id|printk
c_func
(paren
l_string|&quot;PCI: Configuring PCI devices (hardcoded)&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dn
op_assign
id|bus-&gt;devices.next
suffix:semicolon
id|dn
op_ne
op_amp
id|bus-&gt;devices
suffix:semicolon
id|dn
op_assign
id|dn-&gt;next
)paren
(brace
id|dev
op_assign
id|pci_dev_b
c_func
(paren
id|dn
)paren
suffix:semicolon
id|slot_num
op_assign
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
suffix:semicolon
id|func_num
op_assign
id|PCI_FUNC
c_func
(paren
id|dev-&gt;devfn
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  Device %2d: &quot;
comma
id|slot_num
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|slot_num
)paren
(brace
r_case
l_int|0
suffix:colon
id|printk
c_func
(paren
l_string|&quot;[onboard] Acer Labs M1533 Aladdin IV&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|nile4_to_irq
c_func
(paren
id|NILE4_INT_INTE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|printk
c_func
(paren
l_string|&quot;[onboard] DEC DC21140&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|nile4_to_irq
c_func
(paren
id|NILE4_INT_INTA
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_assign
l_int|0x100000
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|end
op_assign
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_plus
l_int|0x7f
suffix:semicolon
id|nile4_pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_BASE_ADDRESS_0
comma
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
op_assign
l_int|0x1000000
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|1
)braket
dot
id|end
op_assign
id|dev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
op_plus
l_int|0x7f
suffix:semicolon
id|nile4_pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_BASE_ADDRESS_0
comma
id|dev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|printk
c_func
(paren
l_string|&quot;[slot 1]  Realtek 8029&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|nile4_to_irq
c_func
(paren
id|NILE4_INT_INTA
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_assign
l_int|0x800000
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|end
op_assign
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_plus
l_int|0x1f
suffix:semicolon
id|nile4_pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_BASE_ADDRESS_0
comma
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|printk
c_func
(paren
l_string|&quot;[slot 2]  DEC DC21140 (#2)&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|nile4_to_irq
c_func
(paren
id|NILE4_INT_INTB
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_assign
l_int|0x1000000
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|end
op_assign
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_plus
l_int|0x7f
suffix:semicolon
id|nile4_pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_BASE_ADDRESS_0
comma
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
op_assign
l_int|0x4000000
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|1
)braket
dot
id|end
op_assign
id|dev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
op_plus
l_int|0x7f
suffix:semicolon
id|nile4_pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_BASE_ADDRESS_0
comma
id|dev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|printk
c_func
(paren
l_string|&quot;[slot 3]  Promise Technology IDE UltraDMA/33&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; or 3Com 3c905 :-)&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|nile4_to_irq
c_func
(paren
id|NILE4_INT_INTC
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_assign
l_int|0x1800000
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|end
op_assign
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_plus
l_int|0x7fffff
suffix:semicolon
id|nile4_pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_BASE_ADDRESS_0
comma
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|printk
c_func
(paren
l_string|&quot;[onboard] NEC Vrc-5074 Nile 4 Host Bridge&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Fixup so the serial driver can use the UART&n;&t;&t; */
id|dev-&gt;irq
op_assign
id|nile4_to_irq
c_func
(paren
id|NILE4_INT_UART
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_assign
id|PHYSADDR
c_func
(paren
id|NILE4_BASE
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|end
op_assign
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_plus
id|NILE4_SIZE
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|flags
op_assign
id|IORESOURCE_MEM
op_or
id|PCI_BASE_ADDRESS_MEM_TYPE_64
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|printk
c_func
(paren
l_string|&quot;[onboard] Acer Labs M7101 PMU&bslash;n&quot;
)paren
suffix:semicolon
id|pci_pmu
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Program the lines for LEDs D2 and D3 to output */
id|nile4_pci_read_config_byte
c_func
(paren
id|dev
comma
l_int|0x7d
comma
op_amp
id|t8
)paren
suffix:semicolon
id|t8
op_or_assign
l_int|0xc0
suffix:semicolon
id|nile4_pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0x7d
comma
id|t8
)paren
suffix:semicolon
multiline_comment|/* Turn LEDs D2 and D3 off */
id|nile4_pci_read_config_byte
c_func
(paren
id|dev
comma
l_int|0x7e
comma
op_amp
id|t8
)paren
suffix:semicolon
id|t8
op_or_assign
l_int|0xc0
suffix:semicolon
id|nile4_pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0x7e
comma
id|t8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|13
suffix:colon
id|printk
c_func
(paren
l_string|&quot;[onboard] Acer Labs M5237 USB&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|nile4_to_irq
c_func
(paren
id|NILE4_INT_INTE
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_assign
l_int|0x1001000
suffix:semicolon
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|end
op_assign
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
op_plus
l_int|0xfff
suffix:semicolon
id|nile4_pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_BASE_ADDRESS_0
comma
id|dev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|pcibios_setup
r_char
op_star
id|pcibios_setup
(paren
r_char
op_star
id|str
)paren
(brace
r_return
id|str
suffix:semicolon
)brace
DECL|function|pcibios_update_resource
r_void
id|__init
id|pcibios_update_resource
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|resource
op_star
id|root
comma
r_struct
id|resource
op_star
id|res
comma
r_int
id|resource
)paren
(brace
r_int
r_int
id|where
comma
id|size
suffix:semicolon
id|u32
id|reg
suffix:semicolon
id|where
op_assign
id|PCI_BASE_ADDRESS_0
op_plus
(paren
id|resource
op_star
l_int|4
)paren
suffix:semicolon
id|size
op_assign
id|res-&gt;end
op_minus
id|res-&gt;start
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|reg
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|reg
op_amp
id|size
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
(paren
id|res-&gt;start
op_minus
id|root-&gt;start
)paren
)paren
op_amp
op_complement
id|size
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|dev
comma
id|where
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|pcibios_update_irq
r_void
id|__init
id|pcibios_update_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|irq
)paren
(brace
id|pci_write_config_byte
c_func
(paren
id|dev
comma
id|PCI_INTERRUPT_LINE
comma
id|irq
)paren
suffix:semicolon
)brace
DECL|function|pcibios_fixup_pbus_ranges
r_void
id|__init
id|pcibios_fixup_pbus_ranges
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_struct
id|pbus_set_ranges_data
op_star
id|ranges
)paren
(brace
id|ranges-&gt;io_start
op_sub_assign
id|bus-&gt;resource
(braket
l_int|0
)braket
op_member_access_from_pointer
id|start
suffix:semicolon
id|ranges-&gt;io_end
op_sub_assign
id|bus-&gt;resource
(braket
l_int|0
)braket
op_member_access_from_pointer
id|start
suffix:semicolon
id|ranges-&gt;mem_start
op_sub_assign
id|bus-&gt;resource
(braket
l_int|1
)braket
op_member_access_from_pointer
id|start
suffix:semicolon
id|ranges-&gt;mem_end
op_sub_assign
id|bus-&gt;resource
(braket
l_int|1
)braket
op_member_access_from_pointer
id|start
suffix:semicolon
)brace
DECL|function|pcibios_enable_device
r_int
id|__init
id|pcibios_enable_device
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcibios_enable_device for %04x:%04x&bslash;n&quot;
comma
id|dev-&gt;vendor
comma
id|dev-&gt;device
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;pcibios_enable_device: not yet implemented&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|pcibios_align_resource
r_void
id|__init
id|pcibios_align_resource
c_func
(paren
r_void
op_star
id|data
comma
r_struct
id|resource
op_star
id|res
comma
r_int
r_int
id|size
)paren
(brace
)brace
DECL|variable|pcibios_fixups
r_struct
id|pci_fixup
id|pcibios_fixups
(braket
)braket
op_assign
(brace
)brace
suffix:semicolon
eof
