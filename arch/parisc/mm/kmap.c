multiline_comment|/*&n;** Stolen mostly from arch/parisc/kernel/pci-dma.c&n;*/
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/pgalloc.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/page.h&gt;&t;&t;/* get_order */
DECL|macro|flush_cache_all
macro_line|#undef flush_cache_all
DECL|macro|flush_cache_all
mdefine_line|#define flush_cache_all flush_all_caches
DECL|typedef|pte_iterator_t
r_typedef
r_void
(paren
op_star
id|pte_iterator_t
)paren
(paren
id|pte_t
op_star
id|pte
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* XXX This routine could be used with iterate_page() to replace&n; * unmap_uncached_page() and save a little code space but I didn&squot;t&n; * do that since I&squot;m not certain whether this is the right path. -PB&n; */
r_static
r_void
id|unmap_cached_pte
c_func
(paren
id|pte_t
op_star
id|pte
comma
r_int
r_int
id|arg
)paren
(brace
id|pte_t
id|page
op_assign
op_star
id|pte
suffix:semicolon
id|pte_clear
c_func
(paren
id|pte
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pte_none
c_func
(paren
id|page
)paren
)paren
(brace
r_if
c_cond
(paren
id|pte_present
c_func
(paren
id|page
)paren
)paren
(brace
r_int
r_int
id|map_nr
op_assign
id|pte_pagenr
c_func
(paren
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|map_nr
OL
id|max_mapnr
)paren
id|__free_page
c_func
(paren
id|mem_map
op_plus
id|map_nr
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;Whee.. Swapped out page in kernel page table&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
multiline_comment|/* These two routines should probably check a few things... */
DECL|function|set_uncached
r_static
r_void
id|set_uncached
c_func
(paren
id|pte_t
op_star
id|pte
comma
r_int
r_int
id|arg
)paren
(brace
id|pte_val
c_func
(paren
op_star
id|pte
)paren
op_or_assign
id|_PAGE_NO_CACHE
suffix:semicolon
)brace
DECL|function|set_cached
r_static
r_void
id|set_cached
c_func
(paren
id|pte_t
op_star
id|pte
comma
r_int
r_int
id|arg
)paren
(brace
id|pte_val
c_func
(paren
op_star
id|pte
)paren
op_and_assign
op_complement
id|_PAGE_NO_CACHE
suffix:semicolon
)brace
DECL|function|iterate_pte
r_static
r_inline
r_void
id|iterate_pte
c_func
(paren
id|pmd_t
op_star
id|pmd
comma
r_int
r_int
id|address
comma
r_int
r_int
id|size
comma
id|pte_iterator_t
id|op
comma
r_int
r_int
id|arg
)paren
(brace
id|pte_t
op_star
id|pte
suffix:semicolon
r_int
r_int
id|end
suffix:semicolon
r_if
c_cond
(paren
id|pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|pmd_bad
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|pmd_ERROR
c_func
(paren
op_star
id|pmd
)paren
suffix:semicolon
id|pmd_clear
c_func
(paren
id|pmd
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pte
op_assign
id|pte_offset
c_func
(paren
id|pmd
comma
id|address
)paren
suffix:semicolon
id|address
op_and_assign
op_complement
id|PMD_MASK
suffix:semicolon
id|end
op_assign
id|address
op_plus
id|size
suffix:semicolon
r_if
c_cond
(paren
id|end
OG
id|PMD_SIZE
)paren
id|end
op_assign
id|PMD_SIZE
suffix:semicolon
r_do
(brace
id|op
c_func
(paren
id|pte
comma
id|arg
)paren
suffix:semicolon
id|address
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|pte
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|address
OL
id|end
)paren
suffix:semicolon
)brace
DECL|function|iterate_pmd
r_static
r_inline
r_void
id|iterate_pmd
c_func
(paren
id|pgd_t
op_star
id|dir
comma
r_int
r_int
id|address
comma
r_int
r_int
id|size
comma
id|pte_iterator_t
id|op
comma
r_int
r_int
id|arg
)paren
(brace
id|pmd_t
op_star
id|pmd
suffix:semicolon
r_int
r_int
id|end
suffix:semicolon
r_if
c_cond
(paren
id|pgd_none
c_func
(paren
op_star
id|dir
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|pgd_bad
c_func
(paren
op_star
id|dir
)paren
)paren
(brace
id|pgd_ERROR
c_func
(paren
op_star
id|dir
)paren
suffix:semicolon
id|pgd_clear
c_func
(paren
id|dir
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pmd
op_assign
id|pmd_offset
c_func
(paren
id|dir
comma
id|address
)paren
suffix:semicolon
id|address
op_and_assign
op_complement
id|PGDIR_MASK
suffix:semicolon
id|end
op_assign
id|address
op_plus
id|size
suffix:semicolon
r_if
c_cond
(paren
id|end
OG
id|PGDIR_SIZE
)paren
id|end
op_assign
id|PGDIR_SIZE
suffix:semicolon
r_do
(brace
id|iterate_pte
c_func
(paren
id|pmd
comma
id|address
comma
id|end
op_minus
id|address
comma
id|op
comma
id|arg
)paren
suffix:semicolon
id|address
op_assign
(paren
id|address
op_plus
id|PMD_SIZE
)paren
op_amp
id|PMD_MASK
suffix:semicolon
id|pmd
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|address
OL
id|end
)paren
suffix:semicolon
)brace
DECL|function|iterate_pages
r_static
r_void
id|iterate_pages
c_func
(paren
r_int
r_int
id|address
comma
r_int
r_int
id|size
comma
id|pte_iterator_t
id|op
comma
r_int
r_int
id|arg
)paren
(brace
id|pgd_t
op_star
id|dir
suffix:semicolon
r_int
r_int
id|end
op_assign
id|address
op_plus
id|size
suffix:semicolon
id|dir
op_assign
id|pgd_offset_k
c_func
(paren
id|address
)paren
suffix:semicolon
id|flush_cache_all
c_func
(paren
)paren
suffix:semicolon
r_do
(brace
id|iterate_pmd
c_func
(paren
id|dir
comma
id|address
comma
id|end
op_minus
id|address
comma
id|op
comma
id|arg
)paren
suffix:semicolon
id|address
op_assign
(paren
id|address
op_plus
id|PGDIR_SIZE
)paren
op_amp
id|PGDIR_MASK
suffix:semicolon
id|dir
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|address
op_logical_and
(paren
id|address
OL
id|end
)paren
)paren
suffix:semicolon
id|flush_tlb_all
c_func
(paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|kernel_set_cachemode
id|kernel_set_cachemode
c_func
(paren
r_int
r_int
id|vaddr
comma
r_int
r_int
id|size
comma
r_int
id|what
)paren
(brace
r_switch
c_cond
(paren
id|what
)paren
(brace
r_case
id|IOMAP_FULL_CACHING
suffix:colon
id|iterate_pages
c_func
(paren
id|vaddr
comma
id|size
comma
id|set_cached
comma
l_int|0
)paren
suffix:semicolon
id|flush_tlb_range
c_func
(paren
op_amp
id|init_mm
comma
id|vaddr
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IOMAP_NOCACHE_SER
suffix:colon
id|iterate_pages
c_func
(paren
id|vaddr
comma
id|size
comma
id|set_uncached
comma
l_int|0
)paren
suffix:semicolon
id|flush_tlb_range
c_func
(paren
op_amp
id|init_mm
comma
id|vaddr
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;kernel_set_cachemode mode %d not understood&bslash;n&quot;
comma
id|what
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
eof
