multiline_comment|/* atomic.c: atomic operations which got too long to be inlined all over&n; * the place.&n; * &n; * Copyright 1999 Philipp Rumpf (prumpf@tux.org */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#ifdef CONFIG_SMP
DECL|variable|__atomic_hash
id|spinlock_t
id|__atomic_hash
(braket
id|ATOMIC_HASH_SIZE
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|ATOMIC_HASH_SIZE
op_minus
l_int|1
)paren
)braket
op_assign
id|SPIN_LOCK_UNLOCKED
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|__atomic_lock
id|spinlock_t
id|__atomic_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
macro_line|#ifndef __LP64__
DECL|function|__xchg
r_int
r_int
id|__xchg
c_func
(paren
r_int
r_int
id|x
comma
r_int
r_int
op_star
id|ptr
comma
r_int
id|size
)paren
(brace
r_int
r_int
id|temp
comma
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
id|x
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;__xchg called with bad pointer&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|__atomic_lock
comma
id|flags
)paren
suffix:semicolon
id|temp
op_assign
op_star
id|ptr
suffix:semicolon
op_star
id|ptr
op_assign
id|x
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|__atomic_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|temp
suffix:semicolon
)brace
macro_line|#else
DECL|function|__xchg
r_int
r_int
id|__xchg
c_func
(paren
r_int
r_int
id|x
comma
r_int
r_int
op_star
id|ptr
comma
r_int
id|size
)paren
(brace
r_int
r_int
id|temp
comma
id|flags
suffix:semicolon
r_int
r_int
op_star
id|ptr32
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
l_int|8
)paren
(brace
id|try_long
suffix:colon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|__atomic_lock
comma
id|flags
)paren
suffix:semicolon
id|temp
op_assign
op_star
id|ptr
suffix:semicolon
op_star
id|ptr
op_assign
id|x
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|__atomic_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|temp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_eq
l_int|4
)paren
(brace
id|ptr32
op_assign
(paren
r_int
r_int
op_star
)paren
id|ptr
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|__atomic_lock
comma
id|flags
)paren
suffix:semicolon
id|temp
op_assign
(paren
r_int
r_int
)paren
op_star
id|ptr32
suffix:semicolon
op_star
id|ptr32
op_assign
(paren
r_int
r_int
)paren
id|x
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|__atomic_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|temp
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;__xchg called with bad pointer&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|try_long
suffix:semicolon
)brace
macro_line|#endif
eof
