multiline_comment|/*&n; * Bright Star Engineering Inc.&n; *&n; * code for readng parameters from the&n; * parameter blocks of the boot block&n; * flash memory&n; *&n; */
DECL|function|strcmp
r_static
r_int
id|strcmp
c_func
(paren
r_const
r_char
op_star
id|s1
comma
r_const
r_char
op_star
id|s2
)paren
(brace
r_while
c_loop
(paren
op_star
id|s1
op_ne
l_char|&squot;&bslash;0&squot;
op_logical_and
op_star
id|s1
op_eq
op_star
id|s2
)paren
(brace
id|s1
op_increment
suffix:semicolon
id|s2
op_increment
suffix:semicolon
)brace
r_return
(paren
op_star
(paren
r_int
r_char
op_star
)paren
id|s1
)paren
op_minus
(paren
op_star
(paren
r_int
r_char
op_star
)paren
id|s2
)paren
suffix:semicolon
)brace
DECL|struct|pblk_t
r_struct
id|pblk_t
(brace
DECL|member|type
r_char
id|type
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
)brace
suffix:semicolon
DECL|function|bse_getflashparam
r_static
r_char
op_star
id|bse_getflashparam
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_int
r_int
id|esize
suffix:semicolon
r_char
op_star
id|q
comma
op_star
id|r
suffix:semicolon
r_int
r_char
op_star
id|p
comma
op_star
id|e
suffix:semicolon
r_struct
id|pblk_t
op_star
id|thepb
op_assign
(paren
r_struct
id|pblk_t
op_star
)paren
l_int|0x00004000
suffix:semicolon
r_struct
id|pblk_t
op_star
id|altpb
op_assign
(paren
r_struct
id|pblk_t
op_star
)paren
l_int|0x00006000
suffix:semicolon
r_if
c_cond
(paren
id|thepb-&gt;type
op_amp
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|altpb-&gt;type
op_amp
l_int|1
)paren
(brace
multiline_comment|/* no valid param block */
r_return
(paren
r_char
op_star
)paren
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* altpb is valid */
r_struct
id|pblk_t
op_star
id|tmp
suffix:semicolon
id|tmp
op_assign
id|thepb
suffix:semicolon
id|thepb
op_assign
id|altpb
suffix:semicolon
id|altpb
op_assign
id|tmp
suffix:semicolon
)brace
)brace
id|p
op_assign
(paren
r_char
op_star
)paren
id|thepb
op_plus
r_sizeof
(paren
r_struct
id|pblk_t
)paren
suffix:semicolon
id|e
op_assign
id|p
op_plus
id|thepb-&gt;size
suffix:semicolon
r_while
c_loop
(paren
id|p
OL
id|e
)paren
(brace
id|q
op_assign
id|p
suffix:semicolon
id|esize
op_assign
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|esize
op_eq
l_int|0xFF
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|esize
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|esize
OG
l_int|127
)paren
(brace
id|esize
op_assign
(paren
id|esize
op_amp
l_int|0x7F
)paren
op_lshift
l_int|8
op_or
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|q
op_increment
suffix:semicolon
)brace
id|q
op_increment
suffix:semicolon
id|r
op_assign
id|q
suffix:semicolon
r_if
c_cond
(paren
op_star
id|r
op_logical_and
(paren
(paren
id|name
op_eq
l_int|0
)paren
op_logical_or
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
id|r
)paren
)paren
)paren
)paren
(brace
r_while
c_loop
(paren
op_star
id|q
op_increment
)paren
suffix:semicolon
r_return
id|q
suffix:semicolon
)brace
id|p
op_add_assign
id|esize
suffix:semicolon
)brace
r_return
(paren
r_char
op_star
)paren
l_int|0
suffix:semicolon
)brace
DECL|function|bse_setup
r_void
id|bse_setup
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* extract the linux cmdline from flash */
r_char
op_star
id|name
op_assign
id|bse_getflashparam
c_func
(paren
l_string|&quot;linuxboot&quot;
)paren
suffix:semicolon
r_char
op_star
id|x
op_assign
(paren
r_char
op_star
)paren
l_int|0xc0000100
suffix:semicolon
r_if
c_cond
(paren
id|name
)paren
(brace
r_while
c_loop
(paren
op_star
id|name
)paren
op_star
id|x
op_increment
op_assign
op_star
id|name
op_increment
suffix:semicolon
)brace
op_star
id|x
op_assign
l_int|0
suffix:semicolon
)brace
eof
