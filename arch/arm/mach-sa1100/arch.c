multiline_comment|/*&n; * linux/arch/arm/mach-sa1100/arch.c&n; *&n; * Architecture specific fixups.  This is where any&n; * parameters in the params struct are fixed up, or&n; * any additional architecture specific information&n; * is pulled from the params struct.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/elf.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/mach-types.h&gt;
macro_line|#include &lt;asm/mach/arch.h&gt;
r_extern
r_void
id|setup_initrd
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|size
)paren
suffix:semicolon
r_extern
r_void
id|setup_ramdisk
c_func
(paren
r_int
id|doload
comma
r_int
id|prompt
comma
r_int
id|start
comma
r_int
r_int
id|rd_sz
)paren
suffix:semicolon
DECL|function|victor_power_off
r_static
r_void
id|victor_power_off
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* switch off power supply */
id|mdelay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|GPCR
op_assign
id|GPIO_GPIO23
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|xp860_power_off
r_static
r_void
id|xp860_power_off
c_func
(paren
r_void
)paren
(brace
id|GPDR
op_or_assign
id|GPIO_GPIO20
suffix:semicolon
id|GPSR
op_assign
id|GPIO_GPIO20
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|GPCR
op_assign
id|GPIO_GPIO20
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
r_extern
r_void
id|__init
id|sa1100_map_io
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|macro|SET_BANK
mdefine_line|#define SET_BANK(__nr,__start,__size) &bslash;&n;&t;mi-&gt;bank[__nr].start = (__start), &bslash;&n;&t;mi-&gt;bank[__nr].size = (__size), &bslash;&n;&t;mi-&gt;bank[__nr].node = (((unsigned)(__start) - PHYS_OFFSET) &gt;&gt; 27)
r_static
r_void
id|__init
DECL|function|fixup_sa1100
id|fixup_sa1100
c_func
(paren
r_struct
id|machine_desc
op_star
id|desc
comma
r_struct
id|param_struct
op_star
id|params
comma
r_char
op_star
op_star
id|cmdline
comma
r_struct
id|meminfo
op_star
id|mi
)paren
(brace
r_if
c_cond
(paren
id|machine_is_assabet
c_func
(paren
)paren
)paren
(brace
multiline_comment|/* &n;&t;&t; * On Assabet, we must probe for the Neponset board *before*&n;&t;&t; * paging_init() has occured to actually determine the amount&n;&t;&t; * of RAM available.&n;&t;&t; */
r_extern
r_void
id|map_sa1100_gpio_regs
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|get_assabet_scr
c_func
(paren
r_void
)paren
suffix:semicolon
id|map_sa1100_gpio_regs
c_func
(paren
)paren
suffix:semicolon
id|get_assabet_scr
c_func
(paren
)paren
suffix:semicolon
id|SET_BANK
c_func
(paren
l_int|0
comma
l_int|0xc0000000
comma
l_int|32
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|mi-&gt;nr_banks
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|machine_has_neponset
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Neponset expansion board detected&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t; * Note that Neponset RAM is slower...&n;&t;&t;&t; * and still untested. &n;&t;&t;&t; * This would be a candidate for&n;&t;&t;&t; * _real_ NUMA support. &n;&t;&t;&t; */
singleline_comment|//SET_BANK( 1, 0xd0000000, 32*1024*1024 );
singleline_comment|//mi-&gt;nr_banks = 2;
)brace
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|RAMDISK_MAJOR
comma
l_int|0
)paren
suffix:semicolon
id|setup_ramdisk
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|8192
)paren
suffix:semicolon
id|setup_initrd
c_func
(paren
l_int|0xc0800000
comma
l_int|3
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|machine_is_brutus
c_func
(paren
)paren
)paren
(brace
id|SET_BANK
c_func
(paren
l_int|0
comma
l_int|0xc0000000
comma
l_int|4
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|SET_BANK
c_func
(paren
l_int|1
comma
l_int|0xc8000000
comma
l_int|4
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|SET_BANK
c_func
(paren
l_int|2
comma
l_int|0xd0000000
comma
l_int|4
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|SET_BANK
c_func
(paren
l_int|3
comma
l_int|0xd8000000
comma
l_int|4
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|mi-&gt;nr_banks
op_assign
l_int|4
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|RAMDISK_MAJOR
comma
l_int|0
)paren
suffix:semicolon
id|setup_ramdisk
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|8192
)paren
suffix:semicolon
id|setup_initrd
c_func
(paren
id|__phys_to_virt
c_func
(paren
l_int|0xd8000000
)paren
comma
l_int|3
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|machine_is_cerf
c_func
(paren
)paren
)paren
(brace
singleline_comment|// 16Meg Ram.
id|SET_BANK
c_func
(paren
l_int|0
comma
l_int|0xc0000000
comma
l_int|8
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|SET_BANK
c_func
(paren
l_int|1
comma
l_int|0xc8000000
comma
l_int|8
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
singleline_comment|// comment this out for 8MB Cerfs
id|mi-&gt;nr_banks
op_assign
l_int|2
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|RAMDISK_MAJOR
comma
l_int|0
)paren
suffix:semicolon
id|setup_ramdisk
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|8192
)paren
suffix:semicolon
singleline_comment|// Save 2Meg for RAMDisk
id|setup_initrd
c_func
(paren
l_int|0xc0500000
comma
l_int|3
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|machine_is_empeg
c_func
(paren
)paren
)paren
(brace
id|SET_BANK
c_func
(paren
l_int|0
comma
l_int|0xc0000000
comma
l_int|4
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|SET_BANK
c_func
(paren
l_int|1
comma
l_int|0xc8000000
comma
l_int|4
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|mi-&gt;nr_banks
op_assign
l_int|2
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
l_int|3
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* /dev/hda1 */
id|setup_ramdisk
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|4096
)paren
suffix:semicolon
id|setup_initrd
c_func
(paren
l_int|0xd0000000
op_plus
(paren
(paren
l_int|1024
op_minus
l_int|320
)paren
op_star
l_int|1024
)paren
comma
(paren
l_int|320
op_star
l_int|1024
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|machine_is_lart
c_func
(paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Note that LART is a special case - it doesn&squot;t use physical&n;&t;&t; * address line A23 on the DRAM, so we effectively have 4 * 8MB&n;&t;&t; * in two SA1100 banks.&n;&t;&t; */
id|SET_BANK
c_func
(paren
l_int|0
comma
l_int|0xc0000000
comma
l_int|8
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|SET_BANK
c_func
(paren
l_int|1
comma
l_int|0xc1000000
comma
l_int|8
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|SET_BANK
c_func
(paren
l_int|2
comma
l_int|0xc8000000
comma
l_int|8
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|SET_BANK
c_func
(paren
l_int|3
comma
l_int|0xc9000000
comma
l_int|8
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|mi-&gt;nr_banks
op_assign
l_int|4
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|RAMDISK_MAJOR
comma
l_int|0
)paren
suffix:semicolon
id|setup_ramdisk
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|8192
)paren
suffix:semicolon
id|setup_initrd
c_func
(paren
l_int|0xc0400000
comma
l_int|4
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|machine_is_thinclient
c_func
(paren
)paren
op_logical_or
id|machine_is_graphicsclient
c_func
(paren
)paren
)paren
(brace
id|SET_BANK
c_func
(paren
l_int|0
comma
l_int|0xc0000000
comma
l_int|16
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|mi-&gt;nr_banks
op_assign
l_int|1
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|RAMDISK_MAJOR
comma
l_int|0
)paren
suffix:semicolon
id|setup_ramdisk
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|8192
)paren
suffix:semicolon
id|setup_initrd
c_func
(paren
id|__phys_to_virt
c_func
(paren
l_int|0xc0800000
)paren
comma
l_int|4
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|machine_is_nanoengine
c_func
(paren
)paren
)paren
(brace
id|SET_BANK
c_func
(paren
l_int|0
comma
l_int|0xc0000000
comma
l_int|32
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|mi-&gt;nr_banks
op_assign
l_int|1
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|RAMDISK_MAJOR
comma
l_int|0
)paren
suffix:semicolon
id|setup_ramdisk
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|8192
)paren
suffix:semicolon
id|setup_initrd
c_func
(paren
id|__phys_to_virt
c_func
(paren
l_int|0xc0800000
)paren
comma
l_int|4
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
multiline_comment|/* Get command line parameters passed from the loader (if any) */
r_if
c_cond
(paren
op_star
(paren
(paren
r_char
op_star
)paren
l_int|0xc0000100
)paren
)paren
(brace
op_star
id|cmdline
op_assign
(paren
(paren
r_char
op_star
)paren
l_int|0xc0000100
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|machine_is_tifon
c_func
(paren
)paren
)paren
(brace
id|SET_BANK
c_func
(paren
l_int|0
comma
l_int|0xc0000000
comma
l_int|16
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|SET_BANK
c_func
(paren
l_int|1
comma
l_int|0xc8000000
comma
l_int|16
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|mi-&gt;nr_banks
op_assign
l_int|2
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|UNNAMED_MAJOR
comma
l_int|0
)paren
suffix:semicolon
id|setup_ramdisk
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|4096
)paren
suffix:semicolon
id|setup_initrd
c_func
(paren
l_int|0xd0000000
op_plus
l_int|0x1100004
comma
l_int|0x140000
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|machine_is_victor
c_func
(paren
)paren
)paren
(brace
id|SET_BANK
c_func
(paren
l_int|0
comma
l_int|0xc0000000
comma
l_int|4
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|mi-&gt;nr_banks
op_assign
l_int|1
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
l_int|60
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Get command line parameters passed from the loader (if any) */
r_if
c_cond
(paren
op_star
(paren
(paren
r_char
op_star
)paren
l_int|0xc0000000
)paren
)paren
(brace
id|strcpy
c_func
(paren
op_star
id|cmdline
comma
(paren
(paren
r_char
op_star
)paren
l_int|0xc0000000
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* power off if any problem */
id|strcat
c_func
(paren
op_star
id|cmdline
comma
l_string|&quot; panic=1&quot;
)paren
suffix:semicolon
id|pm_power_off
op_assign
id|victor_power_off
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|machine_is_xp860
c_func
(paren
)paren
)paren
(brace
id|SET_BANK
c_func
(paren
l_int|0
comma
l_int|0xc0000000
comma
l_int|32
op_star
l_int|1024
op_star
l_int|1024
)paren
suffix:semicolon
id|mi-&gt;nr_banks
op_assign
l_int|1
suffix:semicolon
id|pm_power_off
op_assign
id|xp860_power_off
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_SA1100_ASSABET
id|MACHINE_START
c_func
(paren
id|ASSABET
comma
l_string|&quot;Intel-Assabet&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_BITSY
id|MACHINE_START
c_func
(paren
id|BITSY
comma
l_string|&quot;Compaq Bitsy&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|BOOT_PARAMS
c_func
(paren
l_int|0xc0000100
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_BRUTUS
id|MACHINE_START
c_func
(paren
id|BRUTUS
comma
l_string|&quot;Intel Brutus (SA1100 eval board)&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_CERF
id|MACHINE_START
c_func
(paren
id|CERF
comma
l_string|&quot;Intrinsyc CerfBoard&quot;
)paren
id|MAINTAINER
c_func
(paren
l_string|&quot;Pieter Truter&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_EMPEG
id|MACHINE_START
c_func
(paren
id|EMPEG
comma
l_string|&quot;empeg MP3 Car Audio Player&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_GRAPHICSCLIENT
id|MACHINE_START
c_func
(paren
id|GRAPHICSCLIENT
comma
l_string|&quot;ADS GraphicsClient&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_ITSY
id|MACHINE_START
c_func
(paren
id|ITSY
comma
l_string|&quot;Compaq Itsy&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|BOOT_PARAMS
(paren
l_int|0xc0000100
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_LART
id|MACHINE_START
c_func
(paren
id|LART
comma
l_string|&quot;LART&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_NANOENGINE
id|MACHINE_START
c_func
(paren
id|NANOENGINE
comma
l_string|&quot;BSE nanoEngine&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_PLEB
id|MACHINE_START
c_func
(paren
id|PLEB
comma
l_string|&quot;PLEB&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_THINCLIENT
id|MACHINE_START
c_func
(paren
id|THINCLIENT
comma
l_string|&quot;ADS ThinClient&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_TIFON
id|MACHINE_START
c_func
(paren
id|TIFON
comma
l_string|&quot;Tifon&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_VICTOR
id|MACHINE_START
c_func
(paren
id|VICTOR
comma
l_string|&quot;VisuAide Victor&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
macro_line|#ifdef CONFIG_SA1100_XP860
id|MACHINE_START
c_func
(paren
id|XP860
comma
l_string|&quot;XP860&quot;
)paren
id|BOOT_MEM
c_func
(paren
l_int|0xc0000000
comma
l_int|0x80000000
comma
l_int|0xf8000000
)paren
id|FIXUP
c_func
(paren
id|fixup_sa1100
)paren
id|MAPIO
c_func
(paren
id|sa1100_map_io
)paren
id|MACHINE_END
macro_line|#endif
eof
