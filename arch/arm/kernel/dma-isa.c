multiline_comment|/*&n; * arch/arm/kernel/dma-isa.c: ISA DMA primitives&n; *&n; * Copyright (C) Russell King&n; *&n; * Taken from various sources, including:&n; *  linux/include/asm/dma.h: Defines for using and allocating dma channels.&n; *    Written by Hennus Bergman, 1992.&n; *    High DMA channel support &amp; info by Hannu Savolainen and John Boyd, Nov. 1992.&n; *  arch/arm/kernel/dma-ebsa285.c&n; *  Copyright (C) 1998 Phil Blundell&n; */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;dma.h&quot;
macro_line|#include &quot;dma-isa.h&quot;
DECL|macro|ISA_DMA_MASK
mdefine_line|#define ISA_DMA_MASK&t;&t;0
DECL|macro|ISA_DMA_MODE
mdefine_line|#define ISA_DMA_MODE&t;&t;1
DECL|macro|ISA_DMA_CLRFF
mdefine_line|#define ISA_DMA_CLRFF&t;&t;2
DECL|macro|ISA_DMA_PGHI
mdefine_line|#define ISA_DMA_PGHI&t;&t;3
DECL|macro|ISA_DMA_PGLO
mdefine_line|#define ISA_DMA_PGLO&t;&t;4
DECL|macro|ISA_DMA_ADDR
mdefine_line|#define ISA_DMA_ADDR&t;&t;5
DECL|macro|ISA_DMA_COUNT
mdefine_line|#define ISA_DMA_COUNT&t;&t;6
DECL|variable|isa_dma_port
r_static
r_int
r_int
id|isa_dma_port
(braket
l_int|8
)braket
(braket
l_int|7
)braket
op_assign
(brace
multiline_comment|/* MASK   MODE   CLRFF  PAGE_HI PAGE_LO ADDR COUNT */
(brace
l_int|0x0a
comma
l_int|0x0b
comma
l_int|0x0c
comma
l_int|0x487
comma
l_int|0x087
comma
l_int|0x00
comma
l_int|0x01
)brace
comma
(brace
l_int|0x0a
comma
l_int|0x0b
comma
l_int|0x0c
comma
l_int|0x483
comma
l_int|0x083
comma
l_int|0x02
comma
l_int|0x03
)brace
comma
(brace
l_int|0x0a
comma
l_int|0x0b
comma
l_int|0x0c
comma
l_int|0x481
comma
l_int|0x081
comma
l_int|0x04
comma
l_int|0x05
)brace
comma
(brace
l_int|0x0a
comma
l_int|0x0b
comma
l_int|0x0c
comma
l_int|0x482
comma
l_int|0x082
comma
l_int|0x06
comma
l_int|0x07
)brace
comma
(brace
l_int|0xd4
comma
l_int|0xd6
comma
l_int|0xd8
comma
l_int|0x000
comma
l_int|0x000
comma
l_int|0xc0
comma
l_int|0xc2
)brace
comma
(brace
l_int|0xd4
comma
l_int|0xd6
comma
l_int|0xd8
comma
l_int|0x48b
comma
l_int|0x08b
comma
l_int|0xc4
comma
l_int|0xc6
)brace
comma
(brace
l_int|0xd4
comma
l_int|0xd6
comma
l_int|0xd8
comma
l_int|0x489
comma
l_int|0x089
comma
l_int|0xc8
comma
l_int|0xca
)brace
comma
(brace
l_int|0xd4
comma
l_int|0xd6
comma
l_int|0xd8
comma
l_int|0x48a
comma
l_int|0x08a
comma
l_int|0xcc
comma
l_int|0xce
)brace
)brace
suffix:semicolon
DECL|function|isa_request_dma
r_int
id|isa_request_dma
c_func
(paren
r_int
id|channel
comma
id|dma_t
op_star
id|dma
comma
r_const
r_char
op_star
id|dev_name
)paren
(brace
r_if
c_cond
(paren
id|channel
op_ne
l_int|4
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|isa_free_dma
r_void
id|isa_free_dma
c_func
(paren
r_int
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
multiline_comment|/* nothing to do */
)brace
DECL|function|isa_get_dma_residue
r_int
id|isa_get_dma_residue
c_func
(paren
r_int
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
r_int
r_int
id|io_port
op_assign
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_COUNT
)braket
suffix:semicolon
r_int
id|count
suffix:semicolon
id|count
op_assign
l_int|1
op_plus
id|inb
c_func
(paren
id|io_port
)paren
op_plus
(paren
id|inb
c_func
(paren
id|io_port
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_return
id|channel
OL
l_int|4
ques
c_cond
id|count
suffix:colon
(paren
id|count
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|isa_enable_dma
r_void
id|isa_enable_dma
c_func
(paren
r_int
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
r_int
r_int
id|address
comma
id|length
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;invalid
)paren
(brace
id|address
op_assign
id|dma-&gt;buf.address
suffix:semicolon
id|length
op_assign
id|dma-&gt;buf.length
op_minus
l_int|1
suffix:semicolon
id|outb
c_func
(paren
id|address
op_rshift
l_int|24
comma
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_PGHI
)braket
)paren
suffix:semicolon
id|outb
c_func
(paren
id|address
op_rshift
l_int|16
comma
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_PGLO
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channel
op_ge
l_int|4
)paren
(brace
id|address
op_rshift_assign
l_int|1
suffix:semicolon
id|length
op_assign
(paren
id|length
op_rshift
l_int|1
)paren
op_amp
l_int|0xfe
suffix:semicolon
multiline_comment|/* why &amp;0xfe? */
)brace
id|outb
c_func
(paren
l_int|0
comma
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_CLRFF
)braket
)paren
suffix:semicolon
id|outb
c_func
(paren
id|address
comma
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_ADDR
)braket
)paren
suffix:semicolon
id|outb
c_func
(paren
id|address
op_rshift
l_int|8
comma
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_ADDR
)braket
)paren
suffix:semicolon
id|outb
c_func
(paren
id|length
comma
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_COUNT
)braket
)paren
suffix:semicolon
id|outb
c_func
(paren
id|length
op_rshift
l_int|8
comma
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_COUNT
)braket
)paren
suffix:semicolon
id|outb
c_func
(paren
id|dma-&gt;dma_mode
op_or
(paren
id|channel
op_amp
l_int|3
)paren
comma
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_MODE
)braket
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dma-&gt;dma_mode
)paren
(brace
r_case
id|DMA_MODE_READ
suffix:colon
id|dma_cache_inv
c_func
(paren
id|__bus_to_virt
c_func
(paren
id|dma-&gt;buf.address
)paren
comma
id|dma-&gt;buf.length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_MODE_WRITE
suffix:colon
id|dma_cache_wback
c_func
(paren
id|__bus_to_virt
c_func
(paren
id|dma-&gt;buf.address
)paren
comma
id|dma-&gt;buf.length
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dma-&gt;invalid
op_assign
l_int|0
suffix:semicolon
)brace
id|outb
c_func
(paren
id|channel
op_amp
l_int|3
comma
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_MASK
)braket
)paren
suffix:semicolon
)brace
DECL|function|isa_disable_dma
r_void
id|isa_disable_dma
c_func
(paren
r_int
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
id|outb
c_func
(paren
id|channel
op_or
l_int|4
comma
id|isa_dma_port
(braket
id|channel
)braket
(braket
id|ISA_DMA_MASK
)braket
)paren
suffix:semicolon
)brace
eof
