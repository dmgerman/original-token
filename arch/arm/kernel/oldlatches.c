multiline_comment|/*&n; *  linux/arch/arm/kernel/oldlatches.c&n; *&n; *  Copyright (C) David Alan Gilbert 1995/1996,2000&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; *  Support for the latches on the old Archimedes which control the floppy,&n; *  hard disc and printer&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/mach-types.h&gt;
macro_line|#include &lt;asm/arch/oldlatches.h&gt;
DECL|variable|latch_a_copy
r_static
r_int
r_char
id|latch_a_copy
suffix:semicolon
DECL|variable|latch_b_copy
r_static
r_int
r_char
id|latch_b_copy
suffix:semicolon
multiline_comment|/* newval=(oldval &amp; ~mask)|newdata */
DECL|function|oldlatch_aupdate
r_void
id|oldlatch_aupdate
c_func
(paren
r_int
r_char
id|mask
comma
r_int
r_char
id|newdata
)paren
(brace
r_if
c_cond
(paren
id|machine_is_archimedes
c_func
(paren
)paren
)paren
(brace
id|latch_a_copy
op_assign
(paren
id|latch_a_copy
op_amp
op_complement
id|mask
)paren
op_or
id|newdata
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Latch: A = 0x%02x&bslash;n&quot;
comma
id|latch_a_copy
)paren
suffix:semicolon
id|__raw_writeb
c_func
(paren
id|latch_a_copy
comma
id|LATCHA_BASE
)paren
suffix:semicolon
)brace
r_else
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* newval=(oldval &amp; ~mask)|newdata */
DECL|function|oldlatch_bupdate
r_void
id|oldlatch_bupdate
c_func
(paren
r_int
r_char
id|mask
comma
r_int
r_char
id|newdata
)paren
(brace
r_if
c_cond
(paren
id|machine_is_archimedes
c_func
(paren
)paren
)paren
(brace
id|latch_b_copy
op_assign
(paren
id|latch_b_copy
op_amp
op_complement
id|mask
)paren
op_or
id|newdata
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Latch: B = 0x%02x&bslash;n&quot;
comma
id|latch_b_copy
)paren
suffix:semicolon
id|__raw_writeb
c_func
(paren
id|latch_b_copy
comma
id|LATCHB_BASE
)paren
suffix:semicolon
)brace
r_else
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|oldlatch_init
r_static
r_void
id|__init
id|oldlatch_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|machine_is_archimedes
c_func
(paren
)paren
)paren
(brace
id|oldlatch_aupdate
c_func
(paren
l_int|0xff
comma
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* Thats no FDC reset...*/
id|oldlatch_bupdate
c_func
(paren
l_int|0xff
comma
id|LATCHB_FDCRESET
)paren
suffix:semicolon
)brace
)brace
DECL|variable|oldlatch_init
id|initcall
c_func
(paren
id|oldlatch_init
)paren
suffix:semicolon
DECL|variable|oldlatch_aupdate
id|EXPORT_SYMBOL
c_func
(paren
id|oldlatch_aupdate
)paren
suffix:semicolon
DECL|variable|oldlatch_bupdate
id|EXPORT_SYMBOL
c_func
(paren
id|oldlatch_bupdate
)paren
suffix:semicolon
eof
