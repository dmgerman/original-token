multiline_comment|/*&n; *  linux/arch/arm/kernel/dma-rpc.c&n; *&n; *  Copyright (C) 1998 Russell King&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; *  DMA functions specific to RiscPC architecture&n; */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/mman.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/fiq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/mach/dma.h&gt;
macro_line|#include &lt;asm/hardware/iomd.h&gt;
macro_line|#if 0
r_typedef
r_enum
(brace
id|dma_size_8
op_assign
l_int|1
comma
id|dma_size_16
op_assign
l_int|2
comma
id|dma_size_32
op_assign
l_int|4
comma
id|dma_size_128
op_assign
l_int|16
)brace
id|dma_size_t
suffix:semicolon
r_typedef
r_struct
(brace
id|dma_size_t
id|transfersize
suffix:semicolon
)brace
id|dma_t
suffix:semicolon
macro_line|#endif
DECL|macro|TRANSFER_SIZE
mdefine_line|#define TRANSFER_SIZE&t;2
DECL|macro|CURA
mdefine_line|#define CURA&t;(0)
DECL|macro|ENDA
mdefine_line|#define ENDA&t;((IOMD_IO0ENDA - IOMD_IO0CURA) &lt;&lt; 2)
DECL|macro|CURB
mdefine_line|#define CURB&t;((IOMD_IO0CURB - IOMD_IO0CURA) &lt;&lt; 2)
DECL|macro|ENDB
mdefine_line|#define ENDB&t;((IOMD_IO0ENDB - IOMD_IO0CURA) &lt;&lt; 2)
DECL|macro|CR
mdefine_line|#define CR&t;((IOMD_IO0CR - IOMD_IO0CURA) &lt;&lt; 2)
DECL|macro|ST
mdefine_line|#define ST&t;((IOMD_IO0ST - IOMD_IO0CURA) &lt;&lt; 2)
DECL|macro|state_prog_a
mdefine_line|#define state_prog_a&t;0
DECL|macro|state_wait_a
mdefine_line|#define state_wait_a&t;1
DECL|macro|state_wait_b
mdefine_line|#define state_wait_b&t;2
DECL|function|iomd_get_next_sg
r_static
r_void
id|iomd_get_next_sg
c_func
(paren
r_struct
id|scatterlist
op_star
id|sg
comma
id|dma_t
op_star
id|dma
)paren
(brace
r_int
r_int
id|end
comma
id|offset
comma
id|flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;sg
)paren
(brace
id|sg-&gt;dma_address
op_assign
id|dma-&gt;sg-&gt;dma_address
suffix:semicolon
id|offset
op_assign
id|sg-&gt;dma_address
op_amp
op_complement
id|PAGE_MASK
suffix:semicolon
id|end
op_assign
id|offset
op_plus
id|dma-&gt;sg-&gt;length
suffix:semicolon
r_if
c_cond
(paren
id|end
OG
id|PAGE_SIZE
)paren
id|end
op_assign
id|PAGE_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_plus
(paren
r_int
)paren
id|TRANSFER_SIZE
OG
id|end
)paren
id|flags
op_or_assign
id|DMA_END_L
suffix:semicolon
id|sg-&gt;length
op_assign
id|end
op_minus
id|TRANSFER_SIZE
suffix:semicolon
id|dma-&gt;sg-&gt;length
op_sub_assign
id|end
op_minus
id|offset
suffix:semicolon
id|dma-&gt;sg-&gt;dma_address
op_add_assign
id|end
op_minus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;sg-&gt;length
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|dma-&gt;sgcount
OG
l_int|1
)paren
(brace
id|dma-&gt;sg
op_increment
suffix:semicolon
id|dma-&gt;sgcount
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|dma-&gt;sg
op_assign
l_int|NULL
suffix:semicolon
id|flags
op_or_assign
id|DMA_END_S
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|flags
op_assign
id|DMA_END_S
op_or
id|DMA_END_L
suffix:semicolon
id|sg-&gt;dma_address
op_assign
l_int|0
suffix:semicolon
id|sg-&gt;length
op_assign
l_int|0
suffix:semicolon
)brace
id|sg-&gt;length
op_or_assign
id|flags
suffix:semicolon
)brace
DECL|function|iomd_setup_dma_a
r_static
r_inline
r_void
id|iomd_setup_dma_a
c_func
(paren
r_struct
id|scatterlist
op_star
id|sg
comma
id|dma_t
op_star
id|dma
)paren
(brace
id|outl_t
c_func
(paren
id|sg-&gt;dma_address
comma
id|dma-&gt;dma_base
op_plus
id|CURA
)paren
suffix:semicolon
id|outl_t
c_func
(paren
id|sg-&gt;length
comma
id|dma-&gt;dma_base
op_plus
id|ENDA
)paren
suffix:semicolon
)brace
DECL|function|iomd_setup_dma_b
r_static
r_inline
r_void
id|iomd_setup_dma_b
c_func
(paren
r_struct
id|scatterlist
op_star
id|sg
comma
id|dma_t
op_star
id|dma
)paren
(brace
id|outl_t
c_func
(paren
id|sg-&gt;dma_address
comma
id|dma-&gt;dma_base
op_plus
id|CURB
)paren
suffix:semicolon
id|outl_t
c_func
(paren
id|sg-&gt;length
comma
id|dma-&gt;dma_base
op_plus
id|ENDB
)paren
suffix:semicolon
)brace
DECL|function|iomd_dma_handle
r_static
r_void
id|iomd_dma_handle
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|dma_t
op_star
id|dma
op_assign
(paren
id|dma_t
op_star
)paren
id|dev_id
suffix:semicolon
r_int
r_int
id|status
op_assign
l_int|0
comma
id|no_buffer
op_assign
id|dma-&gt;sg
op_eq
l_int|NULL
suffix:semicolon
r_do
(brace
r_switch
c_cond
(paren
id|dma-&gt;state
)paren
(brace
r_case
id|state_prog_a
suffix:colon
id|iomd_get_next_sg
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
id|iomd_setup_dma_a
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
id|dma-&gt;state
op_assign
id|state_wait_a
suffix:semicolon
r_case
id|state_wait_a
suffix:colon
id|status
op_assign
id|inb_t
c_func
(paren
id|dma-&gt;dma_base
op_plus
id|ST
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|status
op_amp
(paren
id|DMA_ST_OFL
op_or
id|DMA_ST_INT
op_or
id|DMA_ST_AB
)paren
)paren
(brace
r_case
id|DMA_ST_OFL
op_or
id|DMA_ST_INT
suffix:colon
id|iomd_get_next_sg
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
id|iomd_setup_dma_a
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_ST_INT
suffix:colon
id|iomd_get_next_sg
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
id|iomd_setup_dma_b
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
id|dma-&gt;state
op_assign
id|state_wait_b
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_ST_OFL
op_or
id|DMA_ST_INT
op_or
id|DMA_ST_AB
suffix:colon
id|iomd_setup_dma_b
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
id|dma-&gt;state
op_assign
id|state_wait_b
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|state_wait_b
suffix:colon
id|status
op_assign
id|inb_t
c_func
(paren
id|dma-&gt;dma_base
op_plus
id|ST
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|status
op_amp
(paren
id|DMA_ST_OFL
op_or
id|DMA_ST_INT
op_or
id|DMA_ST_AB
)paren
)paren
(brace
r_case
id|DMA_ST_OFL
op_or
id|DMA_ST_INT
op_or
id|DMA_ST_AB
suffix:colon
id|iomd_get_next_sg
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
id|iomd_setup_dma_b
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_ST_INT
op_or
id|DMA_ST_AB
suffix:colon
id|iomd_get_next_sg
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
id|iomd_setup_dma_a
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
id|dma-&gt;state
op_assign
id|state_wait_a
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_ST_OFL
op_or
id|DMA_ST_INT
suffix:colon
id|iomd_setup_dma_a
c_func
(paren
op_amp
id|dma-&gt;cur_sg
comma
id|dma
)paren
suffix:semicolon
id|dma-&gt;state
op_assign
id|state_wait_a
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|dma-&gt;sg
op_logical_and
(paren
id|status
op_amp
id|DMA_ST_INT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|no_buffer
)paren
id|disable_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|function|iomd_request_dma
r_static
r_int
id|iomd_request_dma
c_func
(paren
id|dmach_t
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
r_return
id|request_irq
c_func
(paren
id|dma-&gt;dma_irq
comma
id|iomd_dma_handle
comma
id|SA_INTERRUPT
comma
id|dma-&gt;device_id
comma
id|dma
)paren
suffix:semicolon
)brace
DECL|function|iomd_free_dma
r_static
r_void
id|iomd_free_dma
c_func
(paren
id|dmach_t
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
id|free_irq
c_func
(paren
id|dma-&gt;dma_irq
comma
id|dma
)paren
suffix:semicolon
)brace
DECL|function|iomd_enable_dma
r_static
r_void
id|iomd_enable_dma
c_func
(paren
id|dmach_t
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
r_int
r_int
id|dma_base
op_assign
id|dma-&gt;dma_base
suffix:semicolon
r_int
r_int
id|ctrl
op_assign
id|TRANSFER_SIZE
op_or
id|DMA_CR_E
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;invalid
)paren
(brace
id|dma-&gt;invalid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Cope with ISA-style drivers which expect cache&n;&t;&t; * coherence.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|dma-&gt;using_sg
)paren
(brace
id|dma-&gt;buf.dma_address
op_assign
id|pci_map_single
c_func
(paren
l_int|NULL
comma
id|dma-&gt;buf.address
comma
id|dma-&gt;buf.length
comma
id|dma-&gt;dma_mode
op_eq
id|DMA_MODE_READ
ques
c_cond
id|PCI_DMA_FROMDEVICE
suffix:colon
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
)brace
id|outb_t
c_func
(paren
id|DMA_CR_C
comma
id|dma_base
op_plus
id|CR
)paren
suffix:semicolon
id|dma-&gt;state
op_assign
id|state_prog_a
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma-&gt;dma_mode
op_eq
id|DMA_MODE_READ
)paren
id|ctrl
op_or_assign
id|DMA_CR_D
suffix:semicolon
id|outb_t
c_func
(paren
id|ctrl
comma
id|dma_base
op_plus
id|CR
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dma-&gt;dma_irq
)paren
suffix:semicolon
)brace
DECL|function|iomd_disable_dma
r_static
r_void
id|iomd_disable_dma
c_func
(paren
id|dmach_t
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
r_int
r_int
id|dma_base
op_assign
id|dma-&gt;dma_base
suffix:semicolon
r_int
r_int
id|ctrl
suffix:semicolon
id|disable_irq
c_func
(paren
id|dma-&gt;dma_irq
)paren
suffix:semicolon
id|ctrl
op_assign
id|inb_t
c_func
(paren
id|dma_base
op_plus
id|CR
)paren
suffix:semicolon
id|outb_t
c_func
(paren
id|ctrl
op_amp
op_complement
id|DMA_CR_E
comma
id|dma_base
op_plus
id|CR
)paren
suffix:semicolon
)brace
DECL|function|iomd_set_dma_speed
r_static
r_int
id|iomd_set_dma_speed
c_func
(paren
id|dmach_t
id|channel
comma
id|dma_t
op_star
id|dma
comma
r_int
id|cycle
)paren
(brace
r_int
id|tcr
comma
id|speed
suffix:semicolon
r_if
c_cond
(paren
id|cycle
OL
l_int|188
)paren
id|speed
op_assign
l_int|3
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cycle
op_le
l_int|250
)paren
id|speed
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cycle
OL
l_int|438
)paren
id|speed
op_assign
l_int|1
suffix:semicolon
r_else
id|speed
op_assign
l_int|0
suffix:semicolon
id|tcr
op_assign
id|inb
c_func
(paren
id|IOMD_DMATCR
)paren
suffix:semicolon
id|speed
op_and_assign
l_int|3
suffix:semicolon
r_switch
c_cond
(paren
id|channel
)paren
(brace
r_case
id|DMA_0
suffix:colon
id|tcr
op_assign
(paren
id|tcr
op_amp
op_complement
l_int|0x03
)paren
op_or
id|speed
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_1
suffix:colon
id|tcr
op_assign
(paren
id|tcr
op_amp
op_complement
l_int|0x0c
)paren
op_or
(paren
id|speed
op_lshift
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_2
suffix:colon
id|tcr
op_assign
(paren
id|tcr
op_amp
op_complement
l_int|0x30
)paren
op_or
(paren
id|speed
op_lshift
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_3
suffix:colon
id|tcr
op_assign
(paren
id|tcr
op_amp
op_complement
l_int|0xc0
)paren
op_or
(paren
id|speed
op_lshift
l_int|6
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|outb
c_func
(paren
id|tcr
comma
id|IOMD_DMATCR
)paren
suffix:semicolon
r_return
id|speed
suffix:semicolon
)brace
DECL|variable|iomd_dma_ops
r_static
r_struct
id|dma_ops
id|iomd_dma_ops
op_assign
(brace
id|type
suffix:colon
l_string|&quot;IOMD&quot;
comma
id|request
suffix:colon
id|iomd_request_dma
comma
id|free
suffix:colon
id|iomd_free_dma
comma
id|enable
suffix:colon
id|iomd_enable_dma
comma
id|disable
suffix:colon
id|iomd_disable_dma
comma
id|setspeed
suffix:colon
id|iomd_set_dma_speed
comma
)brace
suffix:semicolon
DECL|variable|fh
r_static
r_struct
id|fiq_handler
id|fh
op_assign
(brace
id|name
suffix:colon
l_string|&quot;floppydma&quot;
)brace
suffix:semicolon
DECL|function|floppy_enable_dma
r_static
r_void
id|floppy_enable_dma
c_func
(paren
id|dmach_t
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
r_void
op_star
id|fiqhandler_start
suffix:semicolon
r_int
r_int
id|fiqhandler_length
suffix:semicolon
r_struct
id|pt_regs
id|regs
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;dma_mode
op_eq
id|DMA_MODE_READ
)paren
(brace
r_extern
r_int
r_char
id|floppy_fiqin_start
comma
id|floppy_fiqin_end
suffix:semicolon
id|fiqhandler_start
op_assign
op_amp
id|floppy_fiqin_start
suffix:semicolon
id|fiqhandler_length
op_assign
op_amp
id|floppy_fiqin_end
op_minus
op_amp
id|floppy_fiqin_start
suffix:semicolon
)brace
r_else
(brace
r_extern
r_int
r_char
id|floppy_fiqout_start
comma
id|floppy_fiqout_end
suffix:semicolon
id|fiqhandler_start
op_assign
op_amp
id|floppy_fiqout_start
suffix:semicolon
id|fiqhandler_length
op_assign
op_amp
id|floppy_fiqout_end
op_minus
op_amp
id|floppy_fiqout_start
suffix:semicolon
)brace
id|regs.ARM_r9
op_assign
id|dma-&gt;buf.length
suffix:semicolon
id|regs.ARM_r10
op_assign
(paren
r_int
r_int
)paren
id|dma-&gt;buf.address
suffix:semicolon
id|regs.ARM_fp
op_assign
(paren
r_int
r_int
)paren
id|PCIO_FLOPPYDMABASE
suffix:semicolon
r_if
c_cond
(paren
id|claim_fiq
c_func
(paren
op_amp
id|fh
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;floppydma: couldn&squot;t claim FIQ.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|set_fiq_handler
c_func
(paren
id|fiqhandler_start
comma
id|fiqhandler_length
)paren
suffix:semicolon
id|set_fiq_regs
c_func
(paren
op_amp
id|regs
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dma-&gt;dma_irq
)paren
suffix:semicolon
)brace
DECL|function|floppy_disable_dma
r_static
r_void
id|floppy_disable_dma
c_func
(paren
id|dmach_t
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
id|disable_irq
c_func
(paren
id|dma-&gt;dma_irq
)paren
suffix:semicolon
id|release_fiq
c_func
(paren
op_amp
id|fh
)paren
suffix:semicolon
)brace
DECL|function|floppy_get_residue
r_static
r_int
id|floppy_get_residue
c_func
(paren
id|dmach_t
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
r_struct
id|pt_regs
id|regs
suffix:semicolon
id|get_fiq_regs
c_func
(paren
op_amp
id|regs
)paren
suffix:semicolon
r_return
id|regs.ARM_r9
suffix:semicolon
)brace
DECL|variable|floppy_dma_ops
r_static
r_struct
id|dma_ops
id|floppy_dma_ops
op_assign
(brace
id|type
suffix:colon
l_string|&quot;FIQDMA&quot;
comma
id|enable
suffix:colon
id|floppy_enable_dma
comma
id|disable
suffix:colon
id|floppy_disable_dma
comma
id|residue
suffix:colon
id|floppy_get_residue
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * This is virtual DMA - we don&squot;t need anything here.&n; */
DECL|function|sound_enable_disable_dma
r_static
r_void
id|sound_enable_disable_dma
c_func
(paren
id|dmach_t
id|channel
comma
id|dma_t
op_star
id|dma
)paren
(brace
)brace
DECL|variable|sound_dma_ops
r_static
r_struct
id|dma_ops
id|sound_dma_ops
op_assign
(brace
id|type
suffix:colon
l_string|&quot;VIRTUAL&quot;
comma
id|enable
suffix:colon
id|sound_enable_disable_dma
comma
id|disable
suffix:colon
id|sound_enable_disable_dma
comma
)brace
suffix:semicolon
DECL|function|arch_dma_init
r_void
id|__init
id|arch_dma_init
c_func
(paren
id|dma_t
op_star
id|dma
)paren
(brace
id|outb
c_func
(paren
l_int|0
comma
id|IOMD_IO0CR
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|IOMD_IO1CR
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|IOMD_IO2CR
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|IOMD_IO3CR
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xa0
comma
id|IOMD_DMATCR
)paren
suffix:semicolon
id|dma
(braket
id|DMA_0
)braket
dot
id|dma_base
op_assign
id|ioaddr
c_func
(paren
id|IOMD_IO0CURA
)paren
suffix:semicolon
id|dma
(braket
id|DMA_0
)braket
dot
id|dma_irq
op_assign
id|IRQ_DMA0
suffix:semicolon
id|dma
(braket
id|DMA_0
)braket
dot
id|d_ops
op_assign
op_amp
id|iomd_dma_ops
suffix:semicolon
id|dma
(braket
id|DMA_1
)braket
dot
id|dma_base
op_assign
id|ioaddr
c_func
(paren
id|IOMD_IO1CURA
)paren
suffix:semicolon
id|dma
(braket
id|DMA_1
)braket
dot
id|dma_irq
op_assign
id|IRQ_DMA1
suffix:semicolon
id|dma
(braket
id|DMA_1
)braket
dot
id|d_ops
op_assign
op_amp
id|iomd_dma_ops
suffix:semicolon
id|dma
(braket
id|DMA_2
)braket
dot
id|dma_base
op_assign
id|ioaddr
c_func
(paren
id|IOMD_IO2CURA
)paren
suffix:semicolon
id|dma
(braket
id|DMA_2
)braket
dot
id|dma_irq
op_assign
id|IRQ_DMA2
suffix:semicolon
id|dma
(braket
id|DMA_2
)braket
dot
id|d_ops
op_assign
op_amp
id|iomd_dma_ops
suffix:semicolon
id|dma
(braket
id|DMA_3
)braket
dot
id|dma_base
op_assign
id|ioaddr
c_func
(paren
id|IOMD_IO3CURA
)paren
suffix:semicolon
id|dma
(braket
id|DMA_3
)braket
dot
id|dma_irq
op_assign
id|IRQ_DMA3
suffix:semicolon
id|dma
(braket
id|DMA_3
)braket
dot
id|d_ops
op_assign
op_amp
id|iomd_dma_ops
suffix:semicolon
id|dma
(braket
id|DMA_S0
)braket
dot
id|dma_base
op_assign
id|ioaddr
c_func
(paren
id|IOMD_SD0CURA
)paren
suffix:semicolon
id|dma
(braket
id|DMA_S0
)braket
dot
id|dma_irq
op_assign
id|IRQ_DMAS0
suffix:semicolon
id|dma
(braket
id|DMA_S0
)braket
dot
id|d_ops
op_assign
op_amp
id|iomd_dma_ops
suffix:semicolon
id|dma
(braket
id|DMA_S1
)braket
dot
id|dma_base
op_assign
id|ioaddr
c_func
(paren
id|IOMD_SD1CURA
)paren
suffix:semicolon
id|dma
(braket
id|DMA_S1
)braket
dot
id|dma_irq
op_assign
id|IRQ_DMAS1
suffix:semicolon
id|dma
(braket
id|DMA_S1
)braket
dot
id|d_ops
op_assign
op_amp
id|iomd_dma_ops
suffix:semicolon
id|dma
(braket
id|DMA_VIRTUAL_FLOPPY
)braket
dot
id|dma_irq
op_assign
l_int|64
suffix:semicolon
id|dma
(braket
id|DMA_VIRTUAL_FLOPPY
)braket
dot
id|d_ops
op_assign
op_amp
id|floppy_dma_ops
suffix:semicolon
id|dma
(braket
id|DMA_VIRTUAL_SOUND
)braket
dot
id|d_ops
op_assign
op_amp
id|sound_dma_ops
suffix:semicolon
multiline_comment|/*&n;&t; * Setup DMA channels 2,3 to be for podules&n;&t; * and channels 0,1 for internal devices&n;&t; */
id|outb
c_func
(paren
id|DMA_EXT_IO3
op_or
id|DMA_EXT_IO2
comma
id|IOMD_DMAEXT
)paren
suffix:semicolon
)brace
eof
