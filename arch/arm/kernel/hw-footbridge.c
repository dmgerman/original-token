multiline_comment|/*&n; * arch/arm/kernel/hw-footbridge.c&n; *&n; * Footbridge-dependent machine fixup&n; *&n; * Copyright (C) 1998, 1999 Russell King, Phil Blundell&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/dec21285.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/leds.h&gt;
macro_line|#include &lt;asm/system.h&gt;
DECL|macro|IRDA_IO_BASE
mdefine_line|#define IRDA_IO_BASE&t;&t;0x180
DECL|macro|ETHER10_IO_BASE
mdefine_line|#define ETHER10_IO_BASE&t;&t;0x301
DECL|macro|GP1_IO_BASE
mdefine_line|#define GP1_IO_BASE&t;&t;0x338
DECL|macro|GP2_IO_BASE
mdefine_line|#define GP2_IO_BASE&t;&t;0x33a
DECL|macro|DEC21143_IO_BASE
mdefine_line|#define DEC21143_IO_BASE&t;0x401
DECL|macro|DEC21143_MEM_BASE
mdefine_line|#define DEC21143_MEM_BASE&t;0x00800000
DECL|macro|CYBER2000_MEM_BASE
mdefine_line|#define CYBER2000_MEM_BASE&t;0x01000000
DECL|variable|have_isa_bridge
r_int
id|have_isa_bridge
suffix:semicolon
r_extern
r_int
id|setup_arm_irq
c_func
(paren
r_int
comma
r_struct
id|irqaction
op_star
)paren
suffix:semicolon
r_extern
r_void
id|pci_set_cmd
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
r_int
id|clear
comma
r_int
r_int
id|set
)paren
suffix:semicolon
r_extern
r_void
id|pci_set_base_addr
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|idx
comma
r_int
r_int
id|addr
)paren
suffix:semicolon
r_extern
r_void
id|pci_set_irq_line
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
r_int
id|irq
)paren
suffix:semicolon
r_extern
r_void
(paren
op_star
id|kd_mksound
)paren
(paren
r_int
r_int
id|hz
comma
r_int
r_int
id|ticks
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
DECL|variable|__initdata
r_static
r_int
id|irqmap_ebsa
(braket
)braket
id|__initdata
op_assign
(brace
id|IRQ_IN1
comma
id|IRQ_IN0
comma
id|IRQ_PCI
comma
id|IRQ_IN3
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|ebsa_irqval
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
)paren
(brace
r_int
r_char
id|pin
suffix:semicolon
id|pcibios_read_config_byte
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
id|PCI_INTERRUPT_PIN
comma
op_amp
id|pin
)paren
suffix:semicolon
r_return
id|irqmap_ebsa
(braket
(paren
id|PCI_SLOT
c_func
(paren
id|dev-&gt;devfn
)paren
op_plus
id|pin
)paren
op_amp
l_int|3
)braket
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_CATS
DECL|variable|__initdata
r_static
r_int
id|irqmap_cats
(braket
)braket
id|__initdata
op_assign
(brace
id|IRQ_PCI
comma
id|IRQ_IN0
comma
id|IRQ_IN1
comma
id|IRQ_IN3
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_int
id|cats_irqval
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;irq
op_ge
l_int|128
)paren
r_return
l_int|16
op_plus
(paren
id|dev-&gt;irq
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;irq
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_case
l_int|4
suffix:colon
r_return
id|irqmap_cats
(braket
id|dev-&gt;irq
op_minus
l_int|1
)braket
suffix:semicolon
r_case
l_int|0
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;PCI: device %02x:%02x has unknown irq line %x&bslash;n&quot;
comma
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pcibios_fixup_ebsa285
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
)paren
(brace
multiline_comment|/* Latency timer of 32 */
id|pci_write_config_byte
c_func
(paren
id|dev
comma
id|PCI_LATENCY_TIMER
comma
l_int|32
)paren
suffix:semicolon
multiline_comment|/* 32-byte cache line size */
id|pci_write_config_byte
c_func
(paren
id|dev
comma
id|PCI_CACHE_LINE_SIZE
comma
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Set SysErr enable, Parity enable */
id|pci_set_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
id|PCI_COMMAND_FAST_BACK
op_or
id|PCI_COMMAND_SERR
op_or
id|PCI_COMMAND_PARITY
)paren
suffix:semicolon
multiline_comment|/* If this device is an ISA bridge, set the&n;&t; * have_isa_bridge flag.  We will then go looking&n;&t; * for things like keyboard, etc&n;&t; */
r_if
c_cond
(paren
(paren
id|dev
op_member_access_from_pointer
r_class
op_rshift
l_int|8
)paren
op_eq
id|PCI_CLASS_BRIDGE_ISA
op_logical_or
(paren
id|dev
op_member_access_from_pointer
r_class
op_rshift
l_int|8
)paren
op_eq
id|PCI_CLASS_BRIDGE_EISA
)paren
id|have_isa_bridge
op_assign
op_logical_neg
l_int|0
suffix:semicolon
multiline_comment|/* sort out the irq mapping for this device */
r_switch
c_cond
(paren
id|machine_arch_type
)paren
(brace
r_case
id|MACH_TYPE_EBSA285
suffix:colon
id|dev-&gt;irq
op_assign
id|ebsa_irqval
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Turn on bus mastering - boot loader doesn&squot;t&n;&t;&t; * - perhaps it should! - dag&n;&t;&t; */
id|pci_set_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
id|PCI_COMMAND_MASTER
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_CATS
r_case
id|MACH_TYPE_CATS
suffix:colon
id|dev-&gt;irq
op_assign
id|cats_irqval
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Turn on bus mastering - boot loader doesn&squot;t&n;&t;&t; * - perhaps it should! - dag&n;&t;&t; */
id|pci_set_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
id|PCI_COMMAND_MASTER
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_NETWINDER
r_case
id|MACH_TYPE_NETWINDER
suffix:colon
multiline_comment|/* disable ROM */
id|pci_write_config_dword
c_func
(paren
id|dev
comma
id|PCI_ROM_ADDRESS
comma
l_int|0
)paren
suffix:semicolon
DECL|macro|DEV
mdefine_line|#define DEV(v,d) ((v)&lt;&lt;16|(d))
r_switch
c_cond
(paren
id|DEV
c_func
(paren
id|dev-&gt;vendor
comma
id|dev-&gt;device
)paren
)paren
(brace
multiline_comment|/* Ether 100 */
r_case
id|DEV
c_func
(paren
id|PCI_VENDOR_ID_DEC
comma
id|PCI_DEVICE_ID_DEC_21142
)paren
suffix:colon
id|pci_set_base_addr
c_func
(paren
id|dev
comma
l_int|0
comma
id|DEC21143_IO_BASE
)paren
suffix:semicolon
id|pci_set_base_addr
c_func
(paren
id|dev
comma
l_int|1
comma
id|DEC21143_MEM_BASE
)paren
suffix:semicolon
id|pci_set_cmd
c_func
(paren
id|dev
comma
l_int|0
comma
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_MEMORY
op_or
id|PCI_COMMAND_IO
)paren
suffix:semicolon
multiline_comment|/* Put the chip to sleep in case the driver isn&squot;t loaded */
id|pci_write_config_dword
c_func
(paren
id|dev
comma
l_int|0x40
comma
l_int|0x80000000
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|IRQ_NETWINDER_ETHER100
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Ether 10 */
r_case
id|DEV
c_func
(paren
id|PCI_VENDOR_ID_WINBOND2
comma
l_int|0x5a5a
)paren
suffix:colon
id|pci_set_base_addr
c_func
(paren
id|dev
comma
l_int|0
comma
id|ETHER10_IO_BASE
)paren
suffix:semicolon
id|pci_set_cmd
c_func
(paren
id|dev
comma
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_MEMORY
comma
id|PCI_COMMAND_IO
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|IRQ_NETWINDER_ETHER10
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* ISA bridge */
r_case
id|DEV
c_func
(paren
id|PCI_VENDOR_ID_WINBOND
comma
id|PCI_DEVICE_ID_WINBOND_83C553
)paren
suffix:colon
id|pci_set_base_addr
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|pci_set_cmd
c_func
(paren
id|dev
comma
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_MEMORY
comma
id|PCI_COMMAND_IO
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Enable all memory requests from ISA to be channeled to PCI&n;&t;&t;&t; */
id|pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0x48
comma
l_int|255
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Disable ping-pong (as per errata)&n;&t;&t;&t; */
id|pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0x42
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Enable PCI packet retry&n;&t;&t;&t; */
id|pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0x40
comma
l_int|0x22
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Do not use PCI CPU park enable, park on&n;&t;&t;&t; * last master, disable GAT bit&n;&t;&t;&t; */
id|pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0x83
comma
l_int|0x02
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Default rotating priorities&n;&t;&t;&t; */
id|pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0x80
comma
l_int|0xe0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Rotate bank 4&n;&t;&t;&t; */
id|pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0x81
comma
l_int|0x01
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* IDE */
r_case
id|DEV
c_func
(paren
id|PCI_VENDOR_ID_WINBOND
comma
id|PCI_DEVICE_ID_WINBOND_82C105
)paren
suffix:colon
id|pci_set_base_addr
c_func
(paren
id|dev
comma
l_int|0
comma
l_int|0x1f1
)paren
suffix:semicolon
id|pci_set_base_addr
c_func
(paren
id|dev
comma
l_int|1
comma
l_int|0x3f5
)paren
suffix:semicolon
id|pci_set_base_addr
c_func
(paren
id|dev
comma
l_int|2
comma
l_int|0x171
)paren
suffix:semicolon
id|pci_set_base_addr
c_func
(paren
id|dev
comma
l_int|3
comma
l_int|0x375
)paren
suffix:semicolon
id|pci_set_base_addr
c_func
(paren
id|dev
comma
l_int|4
comma
l_int|0xe801
)paren
suffix:semicolon
id|pci_set_cmd
c_func
(paren
id|dev
comma
id|PCI_COMMAND_MEMORY
comma
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_IO
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|IRQ_ISA_HARDDISK1
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* VGA */
r_case
id|DEV
c_func
(paren
id|PCI_VENDOR_ID_INTERG
comma
l_int|0x2000
)paren
suffix:colon
id|pci_set_base_addr
c_func
(paren
id|dev
comma
l_int|0
comma
id|CYBER2000_MEM_BASE
)paren
suffix:semicolon
id|pci_set_cmd
c_func
(paren
id|dev
comma
id|PCI_COMMAND_MASTER
comma
id|PCI_COMMAND_IO
op_or
id|PCI_COMMAND_MEMORY
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|IRQ_NETWINDER_VGA
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
)brace
)brace
r_static
r_inline
r_void
DECL|function|report_pci_dev_error
id|report_pci_dev_error
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|pci_devices
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_int
r_int
id|status
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|dev
comma
id|PCI_STATUS
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0xf900
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;PCI: [%04X:%04X] status = %X&bslash;n&quot;
comma
id|dev-&gt;vendor
comma
id|dev-&gt;device
comma
id|status
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|dev
comma
id|PCI_STATUS
comma
id|status
op_amp
l_int|0xf900
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#else
DECL|macro|report_pci_dev_error
mdefine_line|#define report_pci_dev_error()
macro_line|#endif
multiline_comment|/*&n; * Warn on PCI errors.  Please report any occurances!&n; */
r_static
r_void
DECL|function|irq_pci_err
id|irq_pci_err
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_static
r_int
r_int
id|next_warn
suffix:semicolon
r_int
r_int
id|cmd
op_assign
op_star
id|CSR_PCICMD
op_amp
l_int|0x0000ffff
suffix:semicolon
r_int
r_int
id|ctrl
op_assign
(paren
op_star
id|CSR_SA110_CNTL
)paren
op_amp
l_int|0xffffde07
suffix:semicolon
r_int
r_int
id|irqstatus
op_assign
op_star
id|CSR_IRQ_RAWSTATUS
suffix:semicolon
r_int
id|warn
op_assign
id|time_after_eq
c_func
(paren
id|jiffies
comma
id|next_warn
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|SA110_CNTL_DISCARDTIMER
suffix:semicolon
r_if
c_cond
(paren
id|warn
)paren
(brace
id|next_warn
op_assign
id|jiffies
op_plus
l_int|3
op_star
id|HZ
op_div
l_int|100
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;PCI: &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irqstatus
op_amp
(paren
l_int|1
op_lshift
l_int|31
)paren
)paren
(brace
r_if
c_cond
(paren
id|warn
)paren
id|printk
c_func
(paren
l_string|&quot;parity error &quot;
)paren
suffix:semicolon
id|cmd
op_or_assign
l_int|1
op_lshift
l_int|31
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irqstatus
op_amp
(paren
l_int|1
op_lshift
l_int|30
)paren
)paren
(brace
r_if
c_cond
(paren
id|warn
)paren
id|printk
c_func
(paren
l_string|&quot;target abort &quot;
)paren
suffix:semicolon
id|cmd
op_or_assign
l_int|1
op_lshift
l_int|28
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irqstatus
op_amp
(paren
l_int|1
op_lshift
l_int|29
)paren
)paren
(brace
r_if
c_cond
(paren
id|warn
)paren
id|printk
c_func
(paren
l_string|&quot;master abort &quot;
)paren
suffix:semicolon
id|cmd
op_or_assign
l_int|1
op_lshift
l_int|29
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irqstatus
op_amp
(paren
l_int|1
op_lshift
l_int|28
)paren
)paren
(brace
r_if
c_cond
(paren
id|warn
)paren
id|printk
c_func
(paren
l_string|&quot;data parity error &quot;
)paren
suffix:semicolon
id|cmd
op_or_assign
l_int|1
op_lshift
l_int|24
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irqstatus
op_amp
(paren
l_int|1
op_lshift
l_int|27
)paren
)paren
(brace
r_if
c_cond
(paren
id|warn
)paren
id|printk
c_func
(paren
l_string|&quot;discard timer expired &quot;
)paren
suffix:semicolon
id|ctrl
op_and_assign
op_complement
id|SA110_CNTL_DISCARDTIMER
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irqstatus
op_amp
(paren
l_int|1
op_lshift
l_int|23
)paren
)paren
(brace
r_if
c_cond
(paren
id|warn
)paren
id|printk
c_func
(paren
l_string|&quot;system error &quot;
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|SA110_CNTL_RXSERR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|warn
)paren
id|printk
c_func
(paren
l_string|&quot;pc=[&lt;%08lX&gt;]&bslash;n&quot;
comma
id|instruction_pointer
c_func
(paren
id|regs
)paren
)paren
suffix:semicolon
id|report_pci_dev_error
c_func
(paren
)paren
suffix:semicolon
op_star
id|CSR_PCICMD
op_assign
id|cmd
suffix:semicolon
op_star
id|CSR_SA110_CNTL
op_assign
id|ctrl
suffix:semicolon
)brace
DECL|variable|irq_pci_error
r_static
r_struct
id|irqaction
id|irq_pci_error
op_assign
(brace
id|irq_pci_err
comma
id|SA_INTERRUPT
comma
l_int|0
comma
l_string|&quot;PCI error&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|pcibios_init_ebsa285
c_func
(paren
r_void
)paren
)paren
(brace
id|setup_arm_irq
c_func
(paren
id|IRQ_PCI_ERR
comma
op_amp
id|irq_pci_error
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Netwinder stuff&n; */
macro_line|#ifdef CONFIG_ARCH_NETWINDER
multiline_comment|/*&n; * Winbond WB83977F accessibility stuff&n; */
DECL|function|wb977_open
r_static
r_inline
r_void
id|wb977_open
c_func
(paren
r_void
)paren
(brace
id|outb
c_func
(paren
l_int|0x87
comma
l_int|0x370
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x87
comma
l_int|0x370
)paren
suffix:semicolon
)brace
DECL|function|wb977_close
r_static
r_inline
r_void
id|wb977_close
c_func
(paren
r_void
)paren
(brace
id|outb
c_func
(paren
l_int|0xaa
comma
l_int|0x370
)paren
suffix:semicolon
)brace
DECL|function|wb977_wb
r_static
r_inline
r_void
id|wb977_wb
c_func
(paren
r_int
id|reg
comma
r_int
id|val
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
l_int|0x370
)paren
suffix:semicolon
id|outb
c_func
(paren
id|val
comma
l_int|0x371
)paren
suffix:semicolon
)brace
DECL|function|wb977_ww
r_static
r_inline
r_void
id|wb977_ww
c_func
(paren
r_int
id|reg
comma
r_int
id|val
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
l_int|0x370
)paren
suffix:semicolon
id|outb
c_func
(paren
id|val
op_rshift
l_int|8
comma
l_int|0x371
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
op_plus
l_int|1
comma
l_int|0x370
)paren
suffix:semicolon
id|outb
c_func
(paren
id|val
comma
l_int|0x371
)paren
suffix:semicolon
)brace
DECL|macro|wb977_device_select
mdefine_line|#define wb977_device_select(dev)&t;wb977_wb(0x07, dev)
DECL|macro|wb977_device_disable
mdefine_line|#define wb977_device_disable()&t;&t;wb977_wb(0x30, 0x00)
DECL|macro|wb977_device_enable
mdefine_line|#define wb977_device_enable()&t;&t;wb977_wb(0x30, 0x01)
multiline_comment|/*&n; * This is a lock for accessing ports GP1_IO_BASE and GP2_IO_BASE&n; */
DECL|variable|gpio_lock
id|spinlock_t
id|__netwinder_data
id|gpio_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|current_gpio_op
r_static
r_int
r_int
id|__netwinder_data
id|current_gpio_op
op_assign
l_int|0
suffix:semicolon
DECL|variable|current_gpio_io
r_static
r_int
r_int
id|__netwinder_data
id|current_gpio_io
op_assign
l_int|0
suffix:semicolon
DECL|variable|current_cpld
r_static
r_int
r_int
id|__netwinder_data
id|current_cpld
op_assign
l_int|0
suffix:semicolon
DECL|function|gpio_modify_op
r_void
id|__netwinder_text
id|gpio_modify_op
c_func
(paren
r_int
id|mask
comma
r_int
id|set
)paren
(brace
r_int
r_int
id|new_gpio
comma
id|changed
suffix:semicolon
id|new_gpio
op_assign
(paren
id|current_gpio_op
op_amp
op_complement
id|mask
)paren
op_or
id|set
suffix:semicolon
id|changed
op_assign
id|new_gpio
op_xor
id|current_gpio_op
suffix:semicolon
id|current_gpio_op
op_assign
id|new_gpio
suffix:semicolon
r_if
c_cond
(paren
id|changed
op_amp
l_int|0xff
)paren
id|outb
c_func
(paren
id|new_gpio
comma
id|GP1_IO_BASE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|changed
op_amp
l_int|0xff00
)paren
id|outb
c_func
(paren
id|new_gpio
op_rshift
l_int|8
comma
id|GP2_IO_BASE
)paren
suffix:semicolon
)brace
DECL|function|__gpio_modify_io
r_static
r_inline
r_void
id|__gpio_modify_io
c_func
(paren
r_int
id|mask
comma
r_int
id|in
)paren
(brace
r_int
r_int
id|new_gpio
comma
id|changed
suffix:semicolon
r_int
id|port
suffix:semicolon
id|new_gpio
op_assign
(paren
id|current_gpio_io
op_amp
op_complement
id|mask
)paren
op_or
id|in
suffix:semicolon
id|changed
op_assign
id|new_gpio
op_xor
id|current_gpio_io
suffix:semicolon
id|current_gpio_io
op_assign
id|new_gpio
suffix:semicolon
id|changed
op_rshift_assign
l_int|1
suffix:semicolon
id|new_gpio
op_rshift_assign
l_int|1
suffix:semicolon
id|wb977_device_select
c_func
(paren
l_int|7
)paren
suffix:semicolon
r_for
c_loop
(paren
id|port
op_assign
l_int|0xe1
suffix:semicolon
id|changed
op_logical_and
id|port
OL
l_int|0xe8
suffix:semicolon
id|changed
op_rshift_assign
l_int|1
)paren
(brace
id|wb977_wb
c_func
(paren
id|port
comma
id|new_gpio
op_amp
l_int|1
)paren
suffix:semicolon
id|port
op_add_assign
l_int|1
suffix:semicolon
id|new_gpio
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|wb977_device_select
c_func
(paren
l_int|8
)paren
suffix:semicolon
r_for
c_loop
(paren
id|port
op_assign
l_int|0xe8
suffix:semicolon
id|changed
op_logical_and
id|port
OL
l_int|0xec
suffix:semicolon
id|changed
op_rshift_assign
l_int|1
)paren
(brace
id|wb977_wb
c_func
(paren
id|port
comma
id|new_gpio
op_amp
l_int|1
)paren
suffix:semicolon
id|port
op_add_assign
l_int|1
suffix:semicolon
id|new_gpio
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|gpio_modify_io
r_void
id|__netwinder_text
id|gpio_modify_io
c_func
(paren
r_int
id|mask
comma
r_int
id|in
)paren
(brace
multiline_comment|/* Open up the SuperIO chip */
id|wb977_open
c_func
(paren
)paren
suffix:semicolon
id|__gpio_modify_io
c_func
(paren
id|mask
comma
id|in
)paren
suffix:semicolon
multiline_comment|/* Close up the EFER gate */
id|wb977_close
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|gpio_read
r_int
id|__netwinder_text
id|gpio_read
c_func
(paren
r_void
)paren
(brace
r_return
id|inb
c_func
(paren
id|GP1_IO_BASE
)paren
op_or
id|inb
c_func
(paren
id|GP2_IO_BASE
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialise the Winbond W83977F global registers&n; */
DECL|function|wb977_init_global
r_static
r_inline
r_void
id|wb977_init_global
c_func
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; * Enable R/W config registers&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x26
comma
l_int|0x40
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Power down FDC (not used)&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x22
comma
l_int|0xfe
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * GP12, GP11, CIRRX, IRRXH, GP10&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x2a
comma
l_int|0xc1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * GP23, GP22, GP21, GP20, GP13&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x2b
comma
l_int|0x6b
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * GP17, GP16, GP15, GP14&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x2c
comma
l_int|0x55
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialise the Winbond W83977F printer port&n; */
DECL|function|wb977_init_printer
r_static
r_inline
r_void
id|wb977_init_printer
c_func
(paren
r_void
)paren
(brace
id|wb977_device_select
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * mode 1 == EPP&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0xf0
comma
l_int|0x01
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialise the Winbond W83977F keyboard controller&n; */
DECL|function|wb977_init_keyboard
r_static
r_inline
r_void
id|wb977_init_keyboard
c_func
(paren
r_void
)paren
(brace
id|wb977_device_select
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Keyboard controller address&n;&t; */
id|wb977_ww
c_func
(paren
l_int|0x60
comma
l_int|0x0060
)paren
suffix:semicolon
id|wb977_ww
c_func
(paren
l_int|0x62
comma
l_int|0x0064
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Keyboard IRQ 1, active high, edge trigger&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x70
comma
l_int|1
)paren
suffix:semicolon
id|wb977_wb
c_func
(paren
l_int|0x71
comma
l_int|0x02
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Mouse IRQ 5, active high, edge trigger&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x72
comma
l_int|5
)paren
suffix:semicolon
id|wb977_wb
c_func
(paren
l_int|0x73
comma
l_int|0x02
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * KBC 8MHz&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0xf0
comma
l_int|0x40
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Enable device&n;&t; */
id|wb977_device_enable
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialise the Winbond W83977F Infra-Red device&n; */
DECL|function|wb977_init_irda
r_static
r_inline
r_void
id|wb977_init_irda
c_func
(paren
r_void
)paren
(brace
id|wb977_device_select
c_func
(paren
l_int|6
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * IR base address&n;&t; */
id|wb977_ww
c_func
(paren
l_int|0x60
comma
id|IRDA_IO_BASE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * IRDA IRQ 6, active high, edge trigger&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x70
comma
l_int|6
)paren
suffix:semicolon
id|wb977_wb
c_func
(paren
l_int|0x71
comma
l_int|0x02
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * RX DMA - ISA DMA 0&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x74
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * TX DMA - Disable Tx DMA&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x75
comma
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Append CRC, Enable bank selection&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0xf0
comma
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Enable device&n;&t; */
id|wb977_device_enable
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialise Winbond W83977F general purpose IO&n; */
DECL|function|wb977_init_gpio
r_static
r_inline
r_void
id|wb977_init_gpio
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/*&n;&t; * Set up initial I/O definitions&n;&t; */
id|current_gpio_io
op_assign
op_minus
l_int|1
suffix:semicolon
id|__gpio_modify_io
c_func
(paren
op_minus
l_int|1
comma
id|GPIO_DONE
op_or
id|GPIO_WDTIMER
)paren
suffix:semicolon
id|wb977_device_select
c_func
(paren
l_int|7
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Group1 base address&n;&t; */
id|wb977_ww
c_func
(paren
l_int|0x60
comma
id|GP1_IO_BASE
)paren
suffix:semicolon
id|wb977_ww
c_func
(paren
l_int|0x62
comma
l_int|0
)paren
suffix:semicolon
id|wb977_ww
c_func
(paren
l_int|0x64
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * GP10 (Orage button) IRQ 10, active high, edge trigger&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0x70
comma
l_int|10
)paren
suffix:semicolon
id|wb977_wb
c_func
(paren
l_int|0x71
comma
l_int|0x02
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * GP10: Debounce filter enabled, IRQ, input&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0xe0
comma
l_int|0x19
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Enable Group1&n;&t; */
id|wb977_device_enable
c_func
(paren
)paren
suffix:semicolon
id|wb977_device_select
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Group2 base address&n;&t; */
id|wb977_ww
c_func
(paren
l_int|0x60
comma
id|GP2_IO_BASE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Clear watchdog timer regs&n;&t; *  - timer disable&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0xf2
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  - disable LED, no mouse nor keyboard IRQ&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0xf3
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  - timer counting, disable power LED, disable timeouot&n;&t; */
id|wb977_wb
c_func
(paren
l_int|0xf4
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Enable group2&n;&t; */
id|wb977_device_enable
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Set Group1/Group2 outputs&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gpio_lock
comma
id|flags
)paren
suffix:semicolon
id|gpio_modify_op
c_func
(paren
op_minus
l_int|1
comma
id|GPIO_RED_LED
op_or
id|GPIO_FAN
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gpio_loc
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialise the Winbond W83977F chip.&n; */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|wb977_init
c_func
(paren
r_void
)paren
)paren
(brace
id|request_region
c_func
(paren
l_int|0x370
comma
l_int|2
comma
l_string|&quot;W83977AF configuration&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Open up the SuperIO chip&n;&t; */
id|wb977_open
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Initialise the global registers&n;&t; */
id|wb977_init_global
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Initialise the various devices in&n;&t; * the multi-IO chip.&n;&t; */
id|wb977_init_printer
c_func
(paren
)paren
suffix:semicolon
id|wb977_init_keyboard
c_func
(paren
)paren
suffix:semicolon
id|wb977_init_irda
c_func
(paren
)paren
suffix:semicolon
id|wb977_init_gpio
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Close up the EFER gate&n;&t; */
id|wb977_close
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cpld_modify
r_void
id|__netwinder_text
id|cpld_modify
c_func
(paren
r_int
id|mask
comma
r_int
id|set
)paren
(brace
r_int
id|msk
suffix:semicolon
id|current_cpld
op_assign
(paren
id|current_cpld
op_amp
op_complement
id|mask
)paren
op_or
id|set
suffix:semicolon
id|gpio_modify_io
c_func
(paren
id|GPIO_DATA
comma
l_int|0
)paren
suffix:semicolon
id|gpio_modify_op
c_func
(paren
id|GPIO_IOLOAD
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|msk
op_assign
l_int|8
suffix:semicolon
id|msk
suffix:semicolon
id|msk
op_rshift_assign
l_int|1
)paren
(brace
r_int
id|bit
op_assign
id|current_cpld
op_amp
id|msk
suffix:semicolon
id|gpio_modify_op
c_func
(paren
id|GPIO_DATA
op_or
id|GPIO_IOCLK
comma
id|bit
ques
c_cond
id|GPIO_DATA
suffix:colon
l_int|0
)paren
suffix:semicolon
id|gpio_modify_op
c_func
(paren
id|GPIO_IOCLK
comma
id|GPIO_IOCLK
)paren
suffix:semicolon
)brace
id|gpio_modify_op
c_func
(paren
id|GPIO_IOCLK
op_or
id|GPIO_DATA
comma
l_int|0
)paren
suffix:semicolon
id|gpio_modify_op
c_func
(paren
id|GPIO_IOLOAD
op_or
id|GPIO_DSCLK
comma
id|GPIO_IOLOAD
op_or
id|GPIO_DSCLK
)paren
suffix:semicolon
id|gpio_modify_op
c_func
(paren
id|GPIO_IOLOAD
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|cpld_init
c_func
(paren
r_void
)paren
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gpio_lock
comma
id|flags
)paren
suffix:semicolon
id|cpld_modify
c_func
(paren
op_minus
l_int|1
comma
id|CPLD_UNMUTE
op_or
l_int|4
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gpio_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_int
r_char
id|rwa_unlock
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x6a
comma
l_int|0xb5
comma
l_int|0xda
comma
l_int|0xed
comma
l_int|0xf6
comma
l_int|0xfb
comma
l_int|0x7d
comma
l_int|0xbe
comma
l_int|0xdf
comma
l_int|0x6f
comma
l_int|0x37
comma
l_int|0x1b
comma
l_int|0x0d
comma
l_int|0x86
comma
l_int|0xc3
comma
l_int|0x61
comma
l_int|0xb0
comma
l_int|0x58
comma
l_int|0x2c
comma
l_int|0x16
comma
l_int|0x8b
comma
l_int|0x45
comma
l_int|0xa2
comma
l_int|0xd1
comma
l_int|0xe8
comma
l_int|0x74
comma
l_int|0x3a
comma
l_int|0x9d
comma
l_int|0xce
comma
l_int|0xe7
comma
l_int|0x73
comma
l_int|0x39
)brace
suffix:semicolon
macro_line|#ifndef DEBUG
DECL|macro|dprintk
mdefine_line|#define dprintk if (0) printk
macro_line|#else
DECL|macro|dprintk
mdefine_line|#define dprintk printk
macro_line|#endif
DECL|macro|WRITE_RWA
mdefine_line|#define WRITE_RWA(r,v) do { outb((r), 0x279); outb((v), 0xa79); } while (0)
DECL|function|rwa010_unlock
r_static
r_inline
r_void
id|rwa010_unlock
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|2
comma
l_int|2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|rwa_unlock
)paren
suffix:semicolon
id|i
op_increment
)paren
id|outb
c_func
(paren
id|rwa_unlock
(braket
id|i
)braket
comma
l_int|0x279
)paren
suffix:semicolon
)brace
DECL|function|rwa010_read_ident
r_static
r_inline
r_void
id|rwa010_read_ident
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|si
(braket
l_int|9
)braket
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|3
comma
l_int|0
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0
comma
l_int|128
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
l_int|0x279
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;Identifier: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
(brace
id|si
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
r_int
id|bit
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x203
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|bit
op_assign
id|inb
c_func
(paren
l_int|0x203
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%02X &quot;
comma
id|bit
)paren
suffix:semicolon
id|si
(braket
id|i
)braket
op_or_assign
id|bit
op_lshift
id|j
suffix:semicolon
)brace
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%02X &quot;
comma
id|si
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|rwa010_global_init
r_static
r_inline
r_void
id|rwa010_global_init
c_func
(paren
r_void
)paren
(brace
id|WRITE_RWA
c_func
(paren
l_int|6
comma
l_int|2
)paren
suffix:semicolon
singleline_comment|// Assign a card no = 2
id|dprintk
c_func
(paren
l_string|&quot;Card no = %d&bslash;n&quot;
comma
id|inb
c_func
(paren
l_int|0x203
)paren
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|7
comma
l_int|3
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x30
comma
l_int|0
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|7
comma
l_int|4
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x30
comma
l_int|0
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|7
comma
l_int|2
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x30
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|rwa010_game_port_init
r_static
r_inline
r_void
id|rwa010_game_port_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|7
comma
l_int|5
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;Slider base: &quot;
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x61
comma
l_int|1
)paren
suffix:semicolon
id|i
op_assign
id|inb
c_func
(paren
l_int|0x203
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x60
comma
l_int|2
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%02X%02X (201)&bslash;n&quot;
comma
id|inb
c_func
(paren
l_int|0x203
)paren
comma
id|i
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x30
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|rwa010_waveartist_init
r_static
r_inline
r_void
id|rwa010_waveartist_init
c_func
(paren
r_int
id|base
comma
r_int
id|irq
comma
r_int
id|dma
)paren
(brace
r_int
id|i
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|7
comma
l_int|0
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;WaveArtist base: &quot;
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x61
comma
id|base
)paren
suffix:semicolon
id|i
op_assign
id|inb
c_func
(paren
l_int|0x203
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x60
comma
id|base
op_rshift
l_int|8
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%02X%02X (%X),&quot;
comma
id|inb
c_func
(paren
l_int|0x203
)paren
comma
id|i
comma
id|base
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x70
comma
id|irq
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot; irq: %d (%d),&quot;
comma
id|inb
c_func
(paren
l_int|0x203
)paren
comma
id|irq
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x74
comma
id|dma
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot; dma: %d (%d)&bslash;n&quot;
comma
id|inb
c_func
(paren
l_int|0x203
)paren
comma
id|dma
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x30
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|rwa010_soundblaster_init
r_static
r_inline
r_void
id|rwa010_soundblaster_init
c_func
(paren
r_int
id|sb_base
comma
r_int
id|al_base
comma
r_int
id|irq
comma
r_int
id|dma
)paren
(brace
r_int
id|i
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|7
comma
l_int|1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;SoundBlaster base: &quot;
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x61
comma
id|sb_base
)paren
suffix:semicolon
id|i
op_assign
id|inb
c_func
(paren
l_int|0x203
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x60
comma
id|sb_base
op_rshift
l_int|8
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%02X%02X (%X),&quot;
comma
id|inb
c_func
(paren
l_int|0x203
)paren
comma
id|i
comma
id|sb_base
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot; irq: &quot;
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x70
comma
id|irq
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%d (%d),&quot;
comma
id|inb
c_func
(paren
l_int|0x203
)paren
comma
id|irq
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot; 8-bit DMA: &quot;
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x74
comma
id|dma
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%d (%d)&bslash;n&quot;
comma
id|inb
c_func
(paren
l_int|0x203
)paren
comma
id|dma
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;AdLib base: &quot;
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x63
comma
id|al_base
)paren
suffix:semicolon
id|i
op_assign
id|inb
c_func
(paren
l_int|0x203
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x62
comma
id|al_base
op_rshift
l_int|8
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%02X%02X (%X)&bslash;n&quot;
comma
id|inb
c_func
(paren
l_int|0x203
)paren
comma
id|i
comma
id|al_base
)paren
suffix:semicolon
id|WRITE_RWA
c_func
(paren
l_int|0x30
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|rwa010_soundblaster_reset
r_static
r_void
id|rwa010_soundblaster_reset
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
l_int|0x226
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
l_int|0x226
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|inb
c_func
(paren
l_int|0x22e
)paren
op_amp
l_int|0x80
)paren
r_break
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;SoundBlaster: DSP reset failed&bslash;n&quot;
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;SoundBlaster DSP reset: %02X (AA)&bslash;n&quot;
comma
id|inb
c_func
(paren
l_int|0x22a
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
l_int|0x22c
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;SoundBlaster: DSP not ready&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|outb
c_func
(paren
l_int|0xe1
comma
l_int|0x22c
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;SoundBlaster DSP id: &quot;
)paren
suffix:semicolon
id|i
op_assign
id|inb
c_func
(paren
l_int|0x22a
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|i
op_or_assign
id|inb
c_func
(paren
l_int|0x22a
)paren
op_lshift
l_int|8
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%04X&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
l_int|0x22c
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;SoundBlaster: could not turn speaker off&bslash;n&quot;
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xd3
comma
l_int|0x22c
)paren
suffix:semicolon
)brace
multiline_comment|/* turn on OPL3 */
id|outb
c_func
(paren
l_int|5
comma
l_int|0x38a
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|1
comma
l_int|0x38b
)paren
suffix:semicolon
)brace
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_static
r_void
id|rwa010_init
c_func
(paren
r_void
)paren
)paren
(brace
id|rwa010_unlock
c_func
(paren
)paren
suffix:semicolon
id|rwa010_read_ident
c_func
(paren
)paren
suffix:semicolon
id|rwa010_global_init
c_func
(paren
)paren
suffix:semicolon
id|rwa010_game_port_init
c_func
(paren
)paren
suffix:semicolon
id|rwa010_waveartist_init
c_func
(paren
l_int|0x250
comma
l_int|3
comma
l_int|7
)paren
suffix:semicolon
id|rwa010_soundblaster_init
c_func
(paren
l_int|0x220
comma
l_int|0x388
comma
l_int|3
comma
l_int|1
)paren
suffix:semicolon
id|rwa010_soundblaster_reset
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|gpio_lock
id|EXPORT_SYMBOL
c_func
(paren
id|gpio_lock
)paren
suffix:semicolon
DECL|variable|gpio_modify_op
id|EXPORT_SYMBOL
c_func
(paren
id|gpio_modify_op
)paren
suffix:semicolon
DECL|variable|gpio_modify_io
id|EXPORT_SYMBOL
c_func
(paren
id|gpio_modify_io
)paren
suffix:semicolon
DECL|variable|cpld_modify
id|EXPORT_SYMBOL
c_func
(paren
id|cpld_modify
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_LEDS
DECL|macro|DEFAULT_LEDS
mdefine_line|#define DEFAULT_LEDS&t;0
macro_line|#else
DECL|macro|DEFAULT_LEDS
mdefine_line|#define DEFAULT_LEDS&t;GPIO_GREEN_LED
macro_line|#endif
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|hw_init
c_func
(paren
r_void
)paren
)paren
(brace
macro_line|#ifdef CONFIG_ARCH_NETWINDER
multiline_comment|/*&n;&t; * this ought to have a better home...&n;&t; * Since this calls the above routines, which are&n;&t; * compiled only if CONFIG_ARCH_NETWINDER is set,&n;&t; * these should only be parsed by the compiler&n;&t; * in the same circumstance.&n;&t; */
r_if
c_cond
(paren
id|machine_is_netwinder
c_func
(paren
)paren
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|wb977_init
c_func
(paren
)paren
suffix:semicolon
id|cpld_init
c_func
(paren
)paren
suffix:semicolon
id|rwa010_init
c_func
(paren
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gpio_lock
comma
id|flags
)paren
suffix:semicolon
id|gpio_modify_op
c_func
(paren
id|GPIO_RED_LED
op_or
id|GPIO_GREEN_LED
comma
id|DEFAULT_LEDS
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gpio_lock
comma
id|flags
)paren
suffix:semicolon
)brace
macro_line|#endif
id|leds_event
c_func
(paren
id|led_start
)paren
suffix:semicolon
)brace
eof
