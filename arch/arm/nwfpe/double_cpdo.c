multiline_comment|/*&n;    NetWinder Floating Point Emulator&n;    (c) Rebel.com, 1998-1999&n;&n;    Direct questions, comments to Scott Bambrough &lt;scottb@netwinder.org&gt;&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
macro_line|#include &quot;softfloat.h&quot;
macro_line|#include &quot;fpopcode.h&quot;
macro_line|#include &quot;fpa11.h&quot;
r_extern
id|FPA11
op_star
id|fpa11
suffix:semicolon
id|float64
id|getDoubleConstant
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
id|float64
id|float64_exp
c_func
(paren
id|float64
id|Fm
)paren
suffix:semicolon
id|float64
id|float64_ln
c_func
(paren
id|float64
id|Fm
)paren
suffix:semicolon
id|float64
id|float64_sin
c_func
(paren
id|float64
id|rFm
)paren
suffix:semicolon
id|float64
id|float64_cos
c_func
(paren
id|float64
id|rFm
)paren
suffix:semicolon
id|float64
id|float64_arcsin
c_func
(paren
id|float64
id|rFm
)paren
suffix:semicolon
id|float64
id|float64_arctan
c_func
(paren
id|float64
id|rFm
)paren
suffix:semicolon
id|float64
id|float64_log
c_func
(paren
id|float64
id|rFm
)paren
suffix:semicolon
id|float64
id|float64_tan
c_func
(paren
id|float64
id|rFm
)paren
suffix:semicolon
id|float64
id|float64_arccos
c_func
(paren
id|float64
id|rFm
)paren
suffix:semicolon
id|float64
id|float64_pow
c_func
(paren
id|float64
id|rFn
comma
id|float64
id|rFm
)paren
suffix:semicolon
id|float64
id|float64_pol
c_func
(paren
id|float64
id|rFn
comma
id|float64
id|rFm
)paren
suffix:semicolon
DECL|function|DoubleCPDO
r_int
r_int
id|DoubleCPDO
c_func
(paren
r_const
r_int
r_int
id|opcode
)paren
(brace
id|float64
id|rFm
comma
id|rFn
suffix:semicolon
r_int
r_int
id|Fd
comma
id|Fm
comma
id|Fn
comma
id|nRc
op_assign
l_int|1
suffix:semicolon
singleline_comment|//printk(&quot;DoubleCPDO(0x%08x)&bslash;n&quot;,opcode);
id|Fm
op_assign
id|getFm
c_func
(paren
id|opcode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CONSTANT_FM
c_func
(paren
id|opcode
)paren
)paren
(brace
id|rFm
op_assign
id|getDoubleConstant
c_func
(paren
id|Fm
)paren
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|fpa11-&gt;fType
(braket
id|Fm
)braket
)paren
(brace
r_case
id|typeSingle
suffix:colon
id|rFm
op_assign
id|float32_to_float64
c_func
(paren
id|fpa11-&gt;fpreg
(braket
id|Fm
)braket
dot
id|fSingle
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|typeDouble
suffix:colon
id|rFm
op_assign
id|fpa11-&gt;fpreg
(braket
id|Fm
)braket
dot
id|fDouble
suffix:semicolon
r_break
suffix:semicolon
r_case
id|typeExtended
suffix:colon
singleline_comment|// !! patb
singleline_comment|//printk(&quot;not implemented! why not?&bslash;n&quot;);
singleline_comment|//!! ScottB
singleline_comment|// should never get here, if extended involved
singleline_comment|// then other operand should be promoted then
singleline_comment|// ExtendedCPDO called.
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|MONADIC_INSTRUCTION
c_func
(paren
id|opcode
)paren
)paren
(brace
id|Fn
op_assign
id|getFn
c_func
(paren
id|opcode
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|fpa11-&gt;fType
(braket
id|Fn
)braket
)paren
(brace
r_case
id|typeSingle
suffix:colon
id|rFn
op_assign
id|float32_to_float64
c_func
(paren
id|fpa11-&gt;fpreg
(braket
id|Fn
)braket
dot
id|fSingle
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|typeDouble
suffix:colon
id|rFn
op_assign
id|fpa11-&gt;fpreg
(braket
id|Fn
)braket
dot
id|fDouble
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|Fd
op_assign
id|getFd
c_func
(paren
id|opcode
)paren
suffix:semicolon
multiline_comment|/* !! this switch isn&squot;t optimized; better (opcode &amp; MASK_ARITHMETIC_OPCODE)&gt;&gt;24, sort of */
r_switch
c_cond
(paren
id|opcode
op_amp
id|MASK_ARITHMETIC_OPCODE
)paren
(brace
multiline_comment|/* dyadic opcodes */
r_case
id|ADF_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_add
c_func
(paren
id|rFn
comma
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MUF_CODE
suffix:colon
r_case
id|FML_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_mul
c_func
(paren
id|rFn
comma
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUF_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_sub
c_func
(paren
id|rFn
comma
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RSF_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_sub
c_func
(paren
id|rFm
comma
id|rFn
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DVF_CODE
suffix:colon
r_case
id|FDV_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_div
c_func
(paren
id|rFn
comma
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RDF_CODE
suffix:colon
r_case
id|FRD_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_div
c_func
(paren
id|rFm
comma
id|rFn
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|POW_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_pow
c_func
(paren
id|rFn
comma
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RPW_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_pow
c_func
(paren
id|rFm
comma
id|rFn
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|RMF_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_rem
c_func
(paren
id|rFn
comma
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|POL_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_pol
c_func
(paren
id|rFn
comma
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
multiline_comment|/* monadic opcodes */
r_case
id|MVF_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|rFm
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MNF_CODE
suffix:colon
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|rFm
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_xor_assign
l_int|0x80000000
suffix:semicolon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|rFm
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ABS_CODE
suffix:colon
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|rFm
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_and_assign
l_int|0x7fffffff
suffix:semicolon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|rFm
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RND_CODE
suffix:colon
r_case
id|URD_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|int32_to_float64
c_func
(paren
id|float64_to_int32
c_func
(paren
id|rFm
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SQT_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_sqrt
c_func
(paren
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|LOG_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_log
c_func
(paren
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LGN_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_ln
c_func
(paren
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXP_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_exp
c_func
(paren
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIN_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_sin
c_func
(paren
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COS_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_cos
c_func
(paren
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TAN_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_tan
c_func
(paren
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ASN_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_arcsin
c_func
(paren
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACS_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_arccos
c_func
(paren
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATN_CODE
suffix:colon
id|fpa11-&gt;fpreg
(braket
id|Fd
)braket
dot
id|fDouble
op_assign
id|float64_arctan
c_func
(paren
id|rFm
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|NRM_CODE
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
(brace
id|nRc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
l_int|0
op_ne
id|nRc
)paren
id|fpa11-&gt;fType
(braket
id|Fd
)braket
op_assign
id|typeDouble
suffix:semicolon
r_return
id|nRc
suffix:semicolon
)brace
macro_line|#if 0
id|float64
id|float64_exp
c_func
(paren
id|float64
id|rFm
)paren
(brace
r_return
id|rFm
suffix:semicolon
singleline_comment|//series
)brace
id|float64
id|float64_ln
c_func
(paren
id|float64
id|rFm
)paren
(brace
r_return
id|rFm
suffix:semicolon
singleline_comment|//series
)brace
id|float64
id|float64_sin
c_func
(paren
id|float64
id|rFm
)paren
(brace
r_return
id|rFm
suffix:semicolon
singleline_comment|//series
)brace
id|float64
id|float64_cos
c_func
(paren
id|float64
id|rFm
)paren
(brace
r_return
id|rFm
suffix:semicolon
singleline_comment|//series
)brace
macro_line|#if 0
id|float64
id|float64_arcsin
c_func
(paren
id|float64
id|rFm
)paren
(brace
singleline_comment|//series
)brace
id|float64
id|float64_arctan
c_func
(paren
id|float64
id|rFm
)paren
(brace
singleline_comment|//series
)brace
macro_line|#endif
id|float64
id|float64_log
c_func
(paren
id|float64
id|rFm
)paren
(brace
r_return
id|float64_div
c_func
(paren
id|float64_ln
c_func
(paren
id|rFm
)paren
comma
id|getDoubleConstant
c_func
(paren
l_int|7
)paren
)paren
suffix:semicolon
)brace
id|float64
id|float64_tan
c_func
(paren
id|float64
id|rFm
)paren
(brace
r_return
id|float64_div
c_func
(paren
id|float64_sin
c_func
(paren
id|rFm
)paren
comma
id|float64_cos
c_func
(paren
id|rFm
)paren
)paren
suffix:semicolon
)brace
id|float64
id|float64_arccos
c_func
(paren
id|float64
id|rFm
)paren
(brace
r_return
id|rFm
suffix:semicolon
singleline_comment|//return float64_sub(halfPi,float64_arcsin(rFm));
)brace
id|float64
id|float64_pow
c_func
(paren
id|float64
id|rFn
comma
id|float64
id|rFm
)paren
(brace
r_return
id|float64_exp
c_func
(paren
id|float64_mul
c_func
(paren
id|rFm
comma
id|float64_ln
c_func
(paren
id|rFn
)paren
)paren
)paren
suffix:semicolon
)brace
id|float64
id|float64_pol
c_func
(paren
id|float64
id|rFn
comma
id|float64
id|rFm
)paren
(brace
r_return
id|float64_arctan
c_func
(paren
id|float64_div
c_func
(paren
id|rFn
comma
id|rFm
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
