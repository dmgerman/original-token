multiline_comment|/*&n; * arch/arm/mm/mm-ebsa285.c&n; *&n; * Extra MM routines for the EBSA285 architecture&n; *&n; * Copyright (C) 1998 Russell King&n; */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/proc/mm-init.h&gt;
multiline_comment|/*    Logical    Physical&n; * 0xfff00000&t;0x40000000&t;X-Bus&n; * 0xffe00000&t;0x7c000000&t;PCI I/O space&n; * 0xfe000000&t;0x42000000&t;CSR&n; * 0xfd000000&t;0x78000000&t;Outbound write flush&n; * 0xfc000000&t;0x79000000&t;PCI IACK/special space&n; * 0xf9000000&t;0x7a000000&t;PCI Config type 1&n; * 0xf8000000&t;0x7b000000&t;PCI Config type 0&n; */
DECL|struct|mapping
r_static
r_struct
id|mapping
(brace
DECL|member|virtual
r_int
r_int
r_virtual
suffix:semicolon
DECL|member|physical
r_int
r_int
id|physical
suffix:semicolon
DECL|member|length
r_int
r_int
id|length
suffix:semicolon
DECL|variable|io_mapping
)brace
id|io_mapping
(braket
)braket
op_assign
(brace
multiline_comment|/*&n;&t; * This is to allow us to fiddle with the EEPROM&n;&t; *  This entry will go away in time&n;&t; */
(brace
l_int|0xd8000000
comma
l_int|0x41000000
comma
l_int|0x00400000
)brace
comma
multiline_comment|/*&n;&t; * These ones are so that we can fiddle&n;&t; *  with the various cards (eg VGA)&n;&t; *  until we&squot;re happy with them...&n;&t; */
(brace
l_int|0xdc000000
comma
l_int|0x7c000000
comma
l_int|0x00100000
)brace
comma
(brace
l_int|0xe0000000
comma
l_int|0x80000000
comma
l_int|0x10000000
)brace
comma
(brace
l_int|0xf8000000
comma
l_int|0x7b000000
comma
l_int|0x01000000
)brace
comma
multiline_comment|/* Type 0 Config */
(brace
l_int|0xf9000000
comma
l_int|0x7a000000
comma
l_int|0x01000000
)brace
comma
multiline_comment|/* Type 1 Config */
(brace
l_int|0xfc000000
comma
l_int|0x79000000
comma
l_int|0x01000000
)brace
comma
multiline_comment|/* PCI IACK&t; */
(brace
l_int|0xfd000000
comma
l_int|0x78000000
comma
l_int|0x01000000
)brace
comma
multiline_comment|/* Outbound wflsh*/
(brace
l_int|0xfe000000
comma
l_int|0x42000000
comma
l_int|0x01000000
)brace
comma
multiline_comment|/* CSR&t;&t; */
(brace
l_int|0xffe00000
comma
l_int|0x7c000000
comma
l_int|0x00100000
)brace
comma
multiline_comment|/* PCI I/O&t; */
(brace
l_int|0xfff00000
comma
l_int|0x40000000
comma
l_int|0x00100000
)brace
comma
multiline_comment|/* X-Bus&t; */
)brace
suffix:semicolon
DECL|macro|SIZEOFIO
mdefine_line|#define SIZEOFIO (sizeof(io_mapping) / sizeof(io_mapping[0]))
multiline_comment|/* map in IO */
DECL|function|setup_io_pagetables
r_int
r_int
id|setup_io_pagetables
c_func
(paren
r_int
r_int
id|start_mem
)paren
(brace
r_struct
id|mapping
op_star
id|mp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mp
op_assign
id|io_mapping
suffix:semicolon
id|i
OL
id|SIZEOFIO
suffix:semicolon
id|i
op_increment
comma
id|mp
op_increment
)paren
(brace
r_while
c_loop
(paren
(paren
id|mp
op_member_access_from_pointer
r_virtual
op_amp
l_int|1048575
op_logical_or
id|mp-&gt;physical
op_amp
l_int|1048575
)paren
op_logical_and
id|mp-&gt;length
op_ge
id|PAGE_SIZE
)paren
(brace
id|alloc_init_page
c_func
(paren
op_amp
id|start_mem
comma
id|mp
op_member_access_from_pointer
r_virtual
comma
id|mp-&gt;physical
comma
id|DOMAIN_IO
comma
id|PTE_AP_WRITE
)paren
suffix:semicolon
id|mp-&gt;length
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
id|mp
op_member_access_from_pointer
r_virtual
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|mp-&gt;physical
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_while
c_loop
(paren
id|mp-&gt;length
op_ge
l_int|1048576
)paren
(brace
r_if
c_cond
(paren
id|mp
op_member_access_from_pointer
r_virtual
OG
l_int|0xf0000000
)paren
id|alloc_init_section
c_func
(paren
op_amp
id|start_mem
comma
id|mp
op_member_access_from_pointer
r_virtual
comma
id|mp-&gt;physical
comma
id|DOMAIN_IO
comma
id|PMD_SECT_AP_WRITE
)paren
suffix:semicolon
r_else
id|alloc_init_section
c_func
(paren
op_amp
id|start_mem
comma
id|mp
op_member_access_from_pointer
r_virtual
comma
id|mp-&gt;physical
comma
id|DOMAIN_USER
comma
id|PMD_SECT_AP_WRITE
op_or
id|PMD_SECT_AP_READ
)paren
suffix:semicolon
id|mp-&gt;length
op_sub_assign
l_int|1048576
suffix:semicolon
id|mp
op_member_access_from_pointer
r_virtual
op_add_assign
l_int|1048576
suffix:semicolon
id|mp-&gt;physical
op_add_assign
l_int|1048576
suffix:semicolon
)brace
r_while
c_loop
(paren
id|mp-&gt;length
op_ge
id|PAGE_SIZE
)paren
(brace
id|alloc_init_page
c_func
(paren
op_amp
id|start_mem
comma
id|mp
op_member_access_from_pointer
r_virtual
comma
id|mp-&gt;physical
comma
id|DOMAIN_IO
comma
id|PTE_AP_WRITE
)paren
suffix:semicolon
id|mp-&gt;length
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
id|mp
op_member_access_from_pointer
r_virtual
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|mp-&gt;physical
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
r_return
id|start_mem
suffix:semicolon
)brace
eof
