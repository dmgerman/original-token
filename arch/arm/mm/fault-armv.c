multiline_comment|/*&n; *  linux/arch/arm/mm/fault-armv.c&n; *&n; *  Copyright (C) 1995  Linus Torvalds&n; *  Modifications for ARM processor (c) 1995-1999 Russell King&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/mman.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/unaligned.h&gt;
DECL|macro|FAULT_CODE_READ
mdefine_line|#define FAULT_CODE_READ&t;&t;0x02
DECL|macro|DO_COW
mdefine_line|#define DO_COW(m)&t;&t;(!((m) &amp; FAULT_CODE_READ))
DECL|macro|READ_FAULT
mdefine_line|#define READ_FAULT(m)&t;&t;((m) &amp; FAULT_CODE_READ)
r_extern
r_void
id|die_if_kernel
c_func
(paren
r_const
r_char
op_star
id|str
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|err
)paren
suffix:semicolon
macro_line|#include &quot;fault-common.c&quot;
macro_line|#ifdef DEBUG
DECL|function|sp_valid
r_static
r_int
id|sp_valid
c_func
(paren
r_int
r_int
op_star
id|sp
)paren
(brace
r_int
r_int
id|addr
op_assign
(paren
r_int
r_int
)paren
id|sp
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_ge
l_int|0xb0000000
op_logical_and
id|addr
OL
l_int|0xd0000000
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_ge
l_int|0x03ff0000
op_logical_and
id|addr
OL
l_int|0x04000000
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ALIGNMENT_TRAP
multiline_comment|/*&n; * 32-bit misaligned trap handler (c) 1998 San Mehat (CCC) -July 1998&n; * /proc/sys/debug/alignment, modified and integrated into&n; * Linux 2.1 by Russell King&n; *&n; * NOTE!!! This is not portable onto the ARM6/ARM7 processors yet.  Also,&n; * it seems to give a severe performance impact (1 abort/ms - NW runs at&n; * ARM6 speeds) with GCC 2.7.2.2 - needs checking with a later GCC/EGCS.&n; *&n; * IMHO, I don&squot;t think that the trap handler is advantageous on ARM6,7&n; * processors (they&squot;ll run like an ARM3).  We&squot;ll see.&n; */
DECL|macro|CODING_BITS
mdefine_line|#define CODING_BITS(i)&t;(i &amp; 0x0e000000)
DECL|macro|LDST_I_BIT
mdefine_line|#define LDST_I_BIT(i)&t;(i &amp; (1 &lt;&lt; 26))&t;&t;/* Immediate constant&t;*/
DECL|macro|LDST_P_BIT
mdefine_line|#define LDST_P_BIT(i)&t;(i &amp; (1 &lt;&lt; 24))&t;&t;/* Preindex&t;&t;*/
DECL|macro|LDST_U_BIT
mdefine_line|#define LDST_U_BIT(i)&t;(i &amp; (1 &lt;&lt; 23))&t;&t;/* Add offset&t;&t;*/
DECL|macro|LDST_W_BIT
mdefine_line|#define LDST_W_BIT(i)&t;(i &amp; (1 &lt;&lt; 21))&t;&t;/* Writeback&t;&t;*/
DECL|macro|LDST_L_BIT
mdefine_line|#define LDST_L_BIT(i)&t;(i &amp; (1 &lt;&lt; 20))&t;&t;/* Load&t;&t;&t;*/
DECL|macro|LDSTH_I_BIT
mdefine_line|#define LDSTH_I_BIT(i)&t;(i &amp; (1 &lt;&lt; 22))&t;&t;/* half-word immed&t;*/
DECL|macro|LDM_S_BIT
mdefine_line|#define LDM_S_BIT(i)&t;(i &amp; (1 &lt;&lt; 22))&t;&t;/* write CPSR from SPSR&t;*/
DECL|macro|RN_BITS
mdefine_line|#define RN_BITS(i)&t;((i &gt;&gt; 16) &amp; 15)&t;/* Rn&t;&t;&t;*/
DECL|macro|RD_BITS
mdefine_line|#define RD_BITS(i)&t;((i &gt;&gt; 12) &amp; 15)&t;/* Rd&t;&t;&t;*/
DECL|macro|RM_BITS
mdefine_line|#define RM_BITS(i)&t;(i &amp; 15)&t;&t;/* Rm&t;&t;&t;*/
DECL|macro|REGMASK_BITS
mdefine_line|#define REGMASK_BITS(i)&t;(i &amp; 0xffff)
DECL|macro|OFFSET_BITS
mdefine_line|#define OFFSET_BITS(i)&t;(i &amp; 0x0fff)
DECL|macro|IS_SHIFT
mdefine_line|#define IS_SHIFT(i)&t;(i &amp; 0x0ff0)
DECL|macro|SHIFT_BITS
mdefine_line|#define SHIFT_BITS(i)&t;((i &gt;&gt; 7) &amp; 0x1f)
DECL|macro|SHIFT_TYPE
mdefine_line|#define SHIFT_TYPE(i)&t;(i &amp; 0x60)
DECL|macro|SHIFT_LSL
mdefine_line|#define SHIFT_LSL&t;0x00
DECL|macro|SHIFT_LSR
mdefine_line|#define SHIFT_LSR&t;0x20
DECL|macro|SHIFT_ASR
mdefine_line|#define SHIFT_ASR&t;0x40
DECL|macro|SHIFT_RORRRX
mdefine_line|#define SHIFT_RORRRX&t;0x60
DECL|variable|ai_user
r_static
r_int
r_int
id|ai_user
suffix:semicolon
DECL|variable|ai_sys
r_static
r_int
r_int
id|ai_sys
suffix:semicolon
DECL|variable|ai_skipped
r_static
r_int
r_int
id|ai_skipped
suffix:semicolon
DECL|variable|ai_half
r_static
r_int
r_int
id|ai_half
suffix:semicolon
DECL|variable|ai_word
r_static
r_int
r_int
id|ai_word
suffix:semicolon
DECL|variable|ai_multi
r_static
r_int
r_int
id|ai_multi
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
DECL|function|proc_alignment_read
r_static
r_int
id|proc_alignment_read
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_char
op_star
id|p
op_assign
id|page
suffix:semicolon
r_int
id|len
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;User:&bslash;t&bslash;t%li&bslash;n&quot;
comma
id|ai_user
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;System:&bslash;t&bslash;t%li&bslash;n&quot;
comma
id|ai_sys
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Skipped:&bslash;t%li&bslash;n&quot;
comma
id|ai_skipped
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Half:&bslash;t&bslash;t%li&bslash;n&quot;
comma
id|ai_half
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Word:&bslash;t&bslash;t%li&bslash;n&quot;
comma
id|ai_word
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Multi:&bslash;t&bslash;t%li&bslash;n&quot;
comma
id|ai_multi
)paren
suffix:semicolon
id|len
op_assign
(paren
id|p
op_minus
id|page
)paren
op_minus
id|off
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
op_star
id|eof
op_assign
(paren
id|len
op_le
id|count
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; * This needs to be done after sysctl_init, otherwise sys/&n; * will be overwritten.&n; */
DECL|function|alignment_init
r_static
r_int
id|__init
id|alignment_init
c_func
(paren
r_void
)paren
(brace
id|create_proc_read_entry
c_func
(paren
l_string|&quot;sys/debug/alignment&quot;
comma
l_int|0
comma
l_int|NULL
comma
id|proc_alignment_read
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|alignment_init
id|__initcall
c_func
(paren
id|alignment_init
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_SYSCTL */
r_static
r_int
DECL|function|do_alignment
id|do_alignment
c_func
(paren
r_int
r_int
id|addr
comma
r_int
id|error_code
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|instr
comma
id|rd
comma
id|rn
comma
id|correction
comma
id|nr_regs
comma
id|regbits
suffix:semicolon
r_int
r_int
id|eaddr
suffix:semicolon
r_union
(brace
r_int
r_int
id|un
suffix:semicolon
r_int
r_int
id|sn
suffix:semicolon
)brace
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|user_mode
c_func
(paren
id|regs
)paren
)paren
(brace
id|set_cr
c_func
(paren
id|cr_no_alignment
)paren
suffix:semicolon
id|ai_user
op_add_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ai_sys
op_add_assign
l_int|1
suffix:semicolon
id|instr
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|instruction_pointer
c_func
(paren
id|regs
)paren
suffix:semicolon
id|correction
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* sometimes 8 on ARMv3 */
id|regs-&gt;ARM_pc
op_add_assign
id|correction
op_plus
l_int|4
suffix:semicolon
id|rd
op_assign
id|RD_BITS
c_func
(paren
id|instr
)paren
suffix:semicolon
id|rn
op_assign
id|RN_BITS
c_func
(paren
id|instr
)paren
suffix:semicolon
id|eaddr
op_assign
id|regs-&gt;uregs
(braket
id|rn
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|CODING_BITS
c_func
(paren
id|instr
)paren
)paren
(brace
r_case
l_int|0x00000000
suffix:colon
r_if
c_cond
(paren
(paren
id|instr
op_amp
l_int|0x0ff00ff0
)paren
op_eq
l_int|0x01000090
)paren
(brace
id|ai_skipped
op_add_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unaligned trap: not handling swp instruction&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|instr
op_amp
l_int|0x0e000090
)paren
op_eq
l_int|0x00000090
)paren
op_logical_and
(paren
id|instr
op_amp
l_int|0x60
)paren
op_ne
l_int|0
)paren
(brace
id|ai_half
op_add_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|LDSTH_I_BIT
c_func
(paren
id|instr
)paren
)paren
id|offset.un
op_assign
(paren
id|instr
op_amp
l_int|0xf00
)paren
op_rshift
l_int|4
op_or
(paren
id|instr
op_amp
l_int|15
)paren
suffix:semicolon
r_else
id|offset.un
op_assign
id|regs-&gt;uregs
(braket
id|RM_BITS
c_func
(paren
id|instr
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|LDST_P_BIT
c_func
(paren
id|instr
)paren
)paren
(brace
r_if
c_cond
(paren
id|LDST_U_BIT
c_func
(paren
id|instr
)paren
)paren
id|eaddr
op_add_assign
id|offset.un
suffix:semicolon
r_else
id|eaddr
op_sub_assign
id|offset.un
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LDST_L_BIT
c_func
(paren
id|instr
)paren
)paren
id|regs-&gt;uregs
(braket
id|rd
)braket
op_assign
id|get_unaligned
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|eaddr
)paren
suffix:semicolon
r_else
id|put_unaligned
c_func
(paren
id|regs-&gt;uregs
(braket
id|rd
)braket
comma
(paren
r_int
r_int
op_star
)paren
id|eaddr
)paren
suffix:semicolon
multiline_comment|/* signed half-word? */
r_if
c_cond
(paren
id|instr
op_amp
l_int|0x40
)paren
id|regs-&gt;uregs
(braket
id|rd
)braket
op_assign
(paren
r_int
)paren
(paren
(paren
r_int
)paren
id|regs-&gt;uregs
(braket
id|rd
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|LDST_P_BIT
c_func
(paren
id|instr
)paren
)paren
(brace
r_if
c_cond
(paren
id|LDST_U_BIT
c_func
(paren
id|instr
)paren
)paren
id|eaddr
op_add_assign
id|offset.un
suffix:semicolon
r_else
id|eaddr
op_sub_assign
id|offset.un
suffix:semicolon
id|regs-&gt;uregs
(braket
id|rn
)braket
op_assign
id|eaddr
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|LDST_W_BIT
c_func
(paren
id|instr
)paren
)paren
id|regs-&gt;uregs
(braket
id|rn
)braket
op_assign
id|eaddr
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|ai_skipped
op_add_assign
l_int|1
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Alignment trap: not handling instruction %08X at %08lX&quot;
comma
id|instr
comma
id|regs-&gt;ARM_pc
op_minus
id|correction
op_minus
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04000000
suffix:colon
id|offset.un
op_assign
id|OFFSET_BITS
c_func
(paren
id|instr
)paren
suffix:semicolon
r_goto
id|ldr_str
suffix:semicolon
r_case
l_int|0x06000000
suffix:colon
id|offset.un
op_assign
id|regs-&gt;uregs
(braket
id|RM_BITS
c_func
(paren
id|instr
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|IS_SHIFT
c_func
(paren
id|instr
)paren
)paren
(brace
r_int
r_int
id|shiftval
op_assign
id|SHIFT_BITS
c_func
(paren
id|instr
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|SHIFT_TYPE
c_func
(paren
id|instr
)paren
)paren
(brace
r_case
id|SHIFT_LSL
suffix:colon
id|offset.un
op_lshift_assign
id|shiftval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SHIFT_LSR
suffix:colon
id|offset.un
op_rshift_assign
id|shiftval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SHIFT_ASR
suffix:colon
id|offset.sn
op_rshift_assign
id|shiftval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SHIFT_RORRRX
suffix:colon
r_if
c_cond
(paren
id|shiftval
op_eq
l_int|0
)paren
(brace
id|offset.un
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;ARM_cpsr
op_amp
id|CC_C_BIT
)paren
id|offset.un
op_or_assign
l_int|1
op_lshift
l_int|31
suffix:semicolon
)brace
r_else
id|offset.un
op_assign
id|offset.un
op_rshift
id|shiftval
op_or
id|offset.un
op_lshift
(paren
l_int|32
op_minus
id|shiftval
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|ldr_str
suffix:colon
id|ai_word
op_add_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|LDST_P_BIT
c_func
(paren
id|instr
)paren
)paren
(brace
r_if
c_cond
(paren
id|LDST_U_BIT
c_func
(paren
id|instr
)paren
)paren
id|eaddr
op_add_assign
id|offset.un
suffix:semicolon
r_else
id|eaddr
op_sub_assign
id|offset.un
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|LDST_W_BIT
c_func
(paren
id|instr
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Not handling ldrt/strt correctly&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|addr
op_ne
id|eaddr
)paren
id|printk
c_func
(paren
l_string|&quot;PC = %08lx, instr = %08x, addr = %08lx, eaddr = %08lx&bslash;n&quot;
comma
id|instruction_pointer
c_func
(paren
id|regs
)paren
comma
id|instr
comma
id|addr
comma
id|eaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|LDST_L_BIT
c_func
(paren
id|instr
)paren
)paren
(brace
id|regs-&gt;uregs
(braket
id|rd
)braket
op_assign
id|get_unaligned
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|eaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rd
op_eq
l_int|15
)paren
id|correction
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|put_unaligned
c_func
(paren
id|regs-&gt;uregs
(braket
id|rd
)braket
comma
(paren
r_int
r_int
op_star
)paren
id|eaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|LDST_P_BIT
c_func
(paren
id|instr
)paren
)paren
(brace
r_if
c_cond
(paren
id|LDST_U_BIT
c_func
(paren
id|instr
)paren
)paren
id|eaddr
op_add_assign
id|offset.un
suffix:semicolon
r_else
id|eaddr
op_sub_assign
id|offset.un
suffix:semicolon
id|regs-&gt;uregs
(braket
id|rn
)braket
op_assign
id|eaddr
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|LDST_W_BIT
c_func
(paren
id|instr
)paren
)paren
id|regs-&gt;uregs
(braket
id|rn
)braket
op_assign
id|eaddr
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x08000000
suffix:colon
r_if
c_cond
(paren
id|LDM_S_BIT
c_func
(paren
id|instr
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;Alignment trap: not handling LDM with s-bit&bslash;n&quot;
)paren
suffix:semicolon
id|ai_multi
op_add_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|regbits
op_assign
id|REGMASK_BITS
c_func
(paren
id|instr
)paren
comma
id|nr_regs
op_assign
l_int|0
suffix:semicolon
id|regbits
suffix:semicolon
id|regbits
op_rshift_assign
l_int|1
)paren
id|nr_regs
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|LDST_U_BIT
c_func
(paren
id|instr
)paren
)paren
id|eaddr
op_sub_assign
id|nr_regs
suffix:semicolon
r_if
c_cond
(paren
(paren
id|LDST_U_BIT
c_func
(paren
id|instr
)paren
op_eq
l_int|0
op_logical_and
id|LDST_P_BIT
c_func
(paren
id|instr
)paren
op_eq
l_int|0
)paren
op_logical_or
(paren
id|LDST_U_BIT
c_func
(paren
id|instr
)paren
op_logical_and
id|LDST_P_BIT
c_func
(paren
id|instr
)paren
)paren
)paren
id|eaddr
op_add_assign
l_int|4
suffix:semicolon
r_for
c_loop
(paren
id|regbits
op_assign
id|REGMASK_BITS
c_func
(paren
id|instr
)paren
comma
id|rd
op_assign
l_int|0
suffix:semicolon
id|regbits
suffix:semicolon
id|regbits
op_rshift_assign
l_int|1
comma
id|rd
op_add_assign
l_int|1
)paren
r_if
c_cond
(paren
id|regbits
op_amp
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|LDST_L_BIT
c_func
(paren
id|instr
)paren
)paren
(brace
id|regs-&gt;uregs
(braket
id|rd
)braket
op_assign
id|get_unaligned
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|eaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rd
op_eq
l_int|15
)paren
id|correction
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|put_unaligned
c_func
(paren
id|regs-&gt;uregs
(braket
id|rd
)braket
comma
(paren
r_int
r_int
op_star
)paren
id|eaddr
)paren
suffix:semicolon
id|eaddr
op_add_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LDST_W_BIT
c_func
(paren
id|instr
)paren
)paren
(brace
r_if
c_cond
(paren
id|LDST_P_BIT
c_func
(paren
id|instr
)paren
op_logical_and
op_logical_neg
id|LDST_U_BIT
c_func
(paren
id|instr
)paren
)paren
id|eaddr
op_sub_assign
id|nr_regs
suffix:semicolon
r_else
r_if
c_cond
(paren
id|LDST_P_BIT
c_func
(paren
id|instr
)paren
)paren
id|eaddr
op_sub_assign
l_int|4
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|LDST_U_BIT
c_func
(paren
id|instr
)paren
)paren
id|eaddr
op_sub_assign
l_int|4
op_plus
id|nr_regs
suffix:semicolon
id|regs-&gt;uregs
(braket
id|rn
)braket
op_assign
id|eaddr
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|regs-&gt;ARM_pc
op_sub_assign
id|correction
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else
DECL|macro|do_alignment
mdefine_line|#define do_alignment NULL
macro_line|#endif
macro_line|#ifdef CONFIG_DEBUG_USER
r_static
r_int
DECL|function|do_sect_fault
id|do_sect_fault
c_func
(paren
r_int
r_int
id|addr
comma
r_int
id|error_code
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|user_mode
c_func
(paren
id|regs
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: permission fault on section, &quot;
l_string|&quot;address=0x%08lx, code %d&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|addr
comma
id|error_code
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
(brace
r_int
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_int
op_star
id|sp
suffix:semicolon
id|sp
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|regs-&gt;ARM_sp
op_minus
l_int|128
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|20
op_logical_and
id|sp_valid
c_func
(paren
id|sp
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%p: &quot;
comma
id|sp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
op_logical_and
id|sp_valid
c_func
(paren
id|sp
)paren
suffix:semicolon
id|i
op_add_assign
l_int|1
comma
id|sp
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%08lx &quot;
comma
op_star
id|sp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
id|c_backtrace
c_func
(paren
id|regs-&gt;ARM_fp
comma
id|regs-&gt;ARM_cpsr
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_return
l_int|1
suffix:semicolon
multiline_comment|/* not fixed up */
)brace
macro_line|#else
DECL|macro|do_sect_fault
mdefine_line|#define do_sect_fault NULL
macro_line|#endif
DECL|struct|fsr_info
r_static
r_const
r_struct
id|fsr_info
(brace
DECL|member|fn
r_int
(paren
op_star
id|fn
)paren
(paren
r_int
r_int
id|addr
comma
r_int
id|error_code
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
DECL|member|sig
r_int
id|sig
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|fsr_info
)brace
id|fsr_info
(braket
)braket
op_assign
(brace
(brace
l_int|NULL
comma
id|SIGSEGV
comma
l_string|&quot;vector exception&quot;
)brace
comma
(brace
id|do_alignment
comma
id|SIGBUS
comma
l_string|&quot;alignment exception&quot;
)brace
comma
(brace
l_int|NULL
comma
id|SIGKILL
comma
l_string|&quot;terminal exception&quot;
)brace
comma
(brace
id|do_alignment
comma
id|SIGBUS
comma
l_string|&quot;alignment exception&quot;
)brace
comma
(brace
l_int|NULL
comma
id|SIGBUS
comma
l_string|&quot;external abort on linefetch&quot;
)brace
comma
(brace
id|do_page_fault
comma
id|SIGSEGV
comma
l_string|&quot;page fault&quot;
)brace
comma
(brace
l_int|NULL
comma
id|SIGBUS
comma
l_string|&quot;external abort on linefetch&quot;
)brace
comma
(brace
id|do_page_fault
comma
id|SIGSEGV
comma
l_string|&quot;page fault&quot;
)brace
comma
(brace
l_int|NULL
comma
id|SIGBUS
comma
l_string|&quot;external abort on non-linefetch&quot;
)brace
comma
(brace
l_int|NULL
comma
id|SIGSEGV
comma
l_string|&quot;domain fault&quot;
)brace
comma
(brace
l_int|NULL
comma
id|SIGBUS
comma
l_string|&quot;external abort on non-linefetch&quot;
)brace
comma
(brace
l_int|NULL
comma
id|SIGSEGV
comma
l_string|&quot;domain fault&quot;
)brace
comma
(brace
l_int|NULL
comma
id|SIGBUS
comma
l_string|&quot;external abort on translation&quot;
)brace
comma
(brace
id|do_sect_fault
comma
id|SIGSEGV
comma
l_string|&quot;section permission fault&quot;
)brace
comma
(brace
l_int|NULL
comma
id|SIGBUS
comma
l_string|&quot;external abort on translation&quot;
)brace
comma
(brace
id|do_page_fault
comma
id|SIGSEGV
comma
l_string|&quot;page permission fault&quot;
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * Currently dropped down to debug level&n; */
DECL|macro|BUG_PROC_MSG
mdefine_line|#define BUG_PROC_MSG &bslash;&n;  KERN_DEBUG &quot;Weird data abort (%08X).&bslash;n&quot; &bslash;&n;  KERN_DEBUG &quot;Please see http:
singleline_comment|//www.arm.linux.org.uk/state.html for &quot; &bslash;
l_string|&quot;more information&bslash;n&quot;
id|asmlinkage
r_void
DECL|function|do_DataAbort
id|do_DataAbort
c_func
(paren
r_int
r_int
id|addr
comma
r_int
id|error_code
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|fsr
)paren
(brace
r_const
r_struct
id|fsr_info
op_star
id|inf
op_assign
id|fsr_info
op_plus
(paren
id|fsr
op_amp
l_int|15
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_eq
id|regs-&gt;ARM_pc
)paren
r_goto
id|weirdness
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inf-&gt;fn
)paren
r_goto
id|bad
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inf
op_member_access_from_pointer
id|fn
c_func
(paren
id|addr
comma
id|error_code
comma
id|regs
)paren
)paren
r_return
suffix:semicolon
id|bad
suffix:colon
id|force_sig
c_func
(paren
id|inf-&gt;sig
comma
id|current
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;Unhandled fault: %s (%X) at 0x%08lx&bslash;n&quot;
comma
id|inf-&gt;name
comma
id|fsr
comma
id|addr
)paren
suffix:semicolon
id|show_pte
c_func
(paren
id|current-&gt;mm
comma
id|addr
)paren
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;Oops&quot;
comma
id|regs
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
id|weirdness
suffix:colon
r_if
c_cond
(paren
id|user_mode
c_func
(paren
id|regs
)paren
)paren
(brace
r_static
r_int
id|first
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|first
)paren
multiline_comment|/*&n;&t;&t;&t; * I want statistical information on this problem,&n;&t;&t;&t; * but we don&squot;t want to hastle the users too much.&n;&t;&t;&t; */
id|printk
c_func
(paren
id|BUG_PROC_MSG
comma
id|fsr
)paren
suffix:semicolon
id|first
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|inf-&gt;fn
op_logical_or
id|inf
op_member_access_from_pointer
id|fn
c_func
(paren
id|addr
comma
id|error_code
comma
id|regs
)paren
)paren
r_goto
id|bad
suffix:semicolon
)brace
id|asmlinkage
r_int
DECL|function|do_PrefetchAbort
id|do_PrefetchAbort
c_func
(paren
r_int
r_int
id|addr
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|do_page_fault
c_func
(paren
id|addr
comma
id|FAULT_CODE_READ
comma
id|regs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
eof
