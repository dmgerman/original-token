multiline_comment|/*&n; *  linux/arch/arm/mm/mm-sa1100.c&n; *&n; *  Copyright (C) 1998-1999 Russell King&n; *  Copyright (C) 1999 Hugo Fiennes&n; *&n; *  Extra MM routines for the SA1100 architecture&n; *&n; *  1999/12/04 Nicolas Pitre &lt;nico@cam.org&gt;&n; *&t;Converted memory definition for struct meminfo initialisations.&n; *&t;Memory is listed physically now.&n; *&n; *  2000/04/07 Nicolas Pitre &lt;nico@cam.org&gt;&n; *&t;Reworked for run-time selection of memory definitions&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/mach-types.h&gt;
macro_line|#include &lt;asm/mach/map.h&gt;
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|standard_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
multiline_comment|/* virtual     physical    length      domain     r  w  c  b */
"&bslash;"
(brace
l_int|0xf6000000
comma
l_int|0x20000000
comma
l_int|0x01000000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* PCMCIA0 IO */
(brace
l_int|0xf7000000
comma
l_int|0x30000000
comma
l_int|0x01000000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* PCMCIA1 IO */
(brace
l_int|0xf8000000
comma
l_int|0x80000000
comma
l_int|0x02000000
comma
id|DOMAIN_IO
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* PCM */
(brace
l_int|0xfa000000
comma
l_int|0x90000000
comma
l_int|0x02000000
comma
id|DOMAIN_IO
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* SCM */
(brace
l_int|0xfc000000
comma
l_int|0xa0000000
comma
l_int|0x02000000
comma
id|DOMAIN_IO
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* MER */
(brace
l_int|0xfe000000
comma
l_int|0xb0000000
comma
l_int|0x02000000
comma
id|DOMAIN_IO
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* LCD + DMA */
id|LAST_DESC
)brace
suffix:semicolon
multiline_comment|/*&n; * Typically, static virtual address mappings are as follow:&n; * &n; * 0xe8000000-0xefffffff:&t;flash memory (especially when multiple flash&n; * &t;&t;&t;&t;banks need to be mapped contigously)&n; * 0xf0000000-0xf3ffffff:&t;miscellaneous stuff (CPLDs, etc.)&n; * 0xf4000000-0xf4ffffff:&t;SA-1111&n; * 0xf5000000-0xf5ffffff:&t;reserved (used by cache flushing area)&n; * 0xf6000000-0xffffffff:&t;reserved (internal SA1100 IO defined above)&n; * &n; * Below 0xe8000000 is reserved for vm allocation.&n; */
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|assabet_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_ASSABET
(brace
l_int|0xe8000000
comma
l_int|0x00000000
comma
l_int|0x02000000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash bank 0 */
(brace
l_int|0xf0000000
comma
l_int|0x10000000
comma
l_int|0x00100000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* System Registers */
(brace
l_int|0xf1000000
comma
l_int|0x12000000
comma
l_int|0x00100000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Board Control Register */
(brace
l_int|0xf2800000
comma
l_int|0x4b800000
comma
l_int|0x00800000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* MQ200 */
(brace
l_int|0xf4000000
comma
l_int|0x40000000
comma
l_int|0x00100000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* SA-1111 */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|bitsy_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_BITSY
(brace
l_int|0xe8000000
comma
l_int|0x00000000
comma
l_int|0x02000000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash bank 0 */
(brace
l_int|0xf0000000
comma
l_int|0x49000000
comma
l_int|0x02000000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* EGPIO 0 */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|cerf_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_CERF
(brace
l_int|0xe8000000
comma
l_int|0x00000000
comma
l_int|0x01000000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash bank 0 */
(brace
l_int|0xf0000000
comma
l_int|0x08000000
comma
l_int|0x00100000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Crystal Chip */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|empeg_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_EMPEG
(brace
id|EMPEG_FLASHBASE
comma
l_int|0x00000000
comma
l_int|0x00200000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|graphicsclient_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_GRAPHICSCLIENT
(brace
l_int|0xe8000000
comma
l_int|0x08000000
comma
l_int|0x01000000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash bank 1 */
(brace
l_int|0xf0000000
comma
l_int|0x10000000
comma
l_int|0x00400000
comma
id|DOMAIN_IO
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* CPLD */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|lart_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_LART
(brace
l_int|0xe8000000
comma
l_int|0x00000000
comma
l_int|0x00400000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* main flash memory */
(brace
l_int|0xec000000
comma
l_int|0x08000000
comma
l_int|0x00400000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* main flash, alternative location */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|nanoengine_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_NANOENGINE
(brace
l_int|0xe8000000
comma
l_int|0x00000000
comma
l_int|0x02000000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash bank 0 */
(brace
l_int|0xf0000000
comma
l_int|0x10000000
comma
l_int|0x00100000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* System Registers */
(brace
l_int|0xf1000000
comma
l_int|0x18A00000
comma
l_int|0x00100000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Internal PCI Config Space */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|thinclient_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_THINCLIENT
macro_line|#if 0
(brace
l_int|0xe8000000
comma
l_int|0x00000000
comma
l_int|0x01000000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash bank 0 when JP1 2-4 */
macro_line|#else
(brace
l_int|0xe8000000
comma
l_int|0x08000000
comma
l_int|0x01000000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash bank 1 when JP1 3-4 */
macro_line|#endif
(brace
l_int|0xf0000000
comma
l_int|0x10000000
comma
l_int|0x00400000
comma
id|DOMAIN_IO
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* CPLD */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|tifon_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_TIFON
(brace
l_int|0xe8000000
comma
l_int|0x00000000
comma
l_int|0x00800000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash bank 1 */
(brace
l_int|0xe8800000
comma
l_int|0x08000000
comma
l_int|0x00800000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash bank 2 */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|victor_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_VICTOR
(brace
l_int|0xe8000000
comma
l_int|0x00000000
comma
l_int|0x00200000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Flash */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|xp860_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SA1100_XP860
(brace
l_int|0xf4000000
comma
l_int|0x40000000
comma
l_int|0x00800000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* SA-1111 */
(brace
l_int|0xf0000000
comma
l_int|0x10000000
comma
l_int|0x00100000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* SCSI */
(brace
l_int|0xf1000000
comma
l_int|0x18000000
comma
l_int|0x00100000
comma
id|DOMAIN_IO
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* LAN */
macro_line|#endif
id|LAST_DESC
)brace
suffix:semicolon
DECL|function|sa1100_map_io
r_void
id|__init
id|sa1100_map_io
c_func
(paren
r_void
)paren
(brace
r_struct
id|map_desc
op_star
id|desc
op_assign
l_int|NULL
suffix:semicolon
id|iotable_init
c_func
(paren
id|standard_io_desc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|machine_is_assabet
c_func
(paren
)paren
)paren
id|desc
op_assign
id|assabet_io_desc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_nanoengine
c_func
(paren
)paren
)paren
id|desc
op_assign
id|nanoengine_io_desc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_bitsy
c_func
(paren
)paren
)paren
id|desc
op_assign
id|bitsy_io_desc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_cerf
c_func
(paren
)paren
)paren
id|desc
op_assign
id|cerf_io_desc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_empeg
c_func
(paren
)paren
)paren
id|desc
op_assign
id|empeg_io_desc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_graphicsclient
c_func
(paren
)paren
)paren
id|desc
op_assign
id|graphicsclient_io_desc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_lart
c_func
(paren
)paren
)paren
id|desc
op_assign
id|lart_io_desc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_thinclient
c_func
(paren
)paren
)paren
id|desc
op_assign
id|thinclient_io_desc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_tifon
c_func
(paren
)paren
)paren
id|desc
op_assign
id|tifon_io_desc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_victor
c_func
(paren
)paren
)paren
id|desc
op_assign
id|victor_io_desc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|machine_is_xp860
c_func
(paren
)paren
)paren
id|desc
op_assign
id|xp860_io_desc
suffix:semicolon
r_if
c_cond
(paren
id|desc
)paren
id|iotable_init
c_func
(paren
id|desc
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_DISCONTIGMEM
multiline_comment|/*&n; * Our node_data structure for discontigous memory.&n; * There is 4 possible nodes i.e. the 4 SA1100 RAM banks.&n; */
DECL|variable|node_bootmem_data
r_static
id|bootmem_data_t
id|node_bootmem_data
(braket
l_int|4
)braket
suffix:semicolon
DECL|variable|sa1100_node_data
id|pg_data_t
id|sa1100_node_data
(braket
l_int|4
)braket
op_assign
(brace
(brace
id|bdata
suffix:colon
op_amp
id|node_bootmem_data
(braket
l_int|0
)braket
)brace
comma
(brace
id|bdata
suffix:colon
op_amp
id|node_bootmem_data
(braket
l_int|1
)braket
)brace
comma
(brace
id|bdata
suffix:colon
op_amp
id|node_bootmem_data
(braket
l_int|2
)braket
)brace
comma
(brace
id|bdata
suffix:colon
op_amp
id|node_bootmem_data
(braket
l_int|3
)braket
)brace
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * On Assabet, we must probe for the Neponset board *before* paging_init() &n; * has occured to actually determine the amount of RAM available.  To do so, &n; * we map the appropriate IO section in the page table here in order to &n; * access GPIO registers.&n; */
DECL|function|map_sa1100_gpio_regs
r_void
id|__init
id|map_sa1100_gpio_regs
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|phys
op_assign
id|_GPLR
op_amp
id|PMD_MASK
suffix:semicolon
r_int
r_int
id|virt
op_assign
id|io_p2v
c_func
(paren
id|phys
)paren
suffix:semicolon
r_int
id|prot
op_assign
id|PMD_TYPE_SECT
op_or
id|PMD_SECT_AP_WRITE
op_or
id|PMD_DOMAIN
c_func
(paren
id|DOMAIN_IO
)paren
suffix:semicolon
id|pmd_t
id|pmd
suffix:semicolon
id|pmd_val
c_func
(paren
id|pmd
)paren
op_assign
id|phys
op_or
id|prot
suffix:semicolon
id|set_pmd
c_func
(paren
id|pmd_offset
c_func
(paren
id|pgd_offset_k
c_func
(paren
id|virt
)paren
comma
id|virt
)paren
comma
id|pmd
)paren
suffix:semicolon
)brace
eof
