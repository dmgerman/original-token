multiline_comment|/*&n; * csum_partial_copy - do IP checksumming and copy&n; *&n; * (C) Copyright 1996 Linus Torvalds&n; *&n; * Don&squot;t look at this too closely - you&squot;ll go mad. The things&n; * we do for performance..&n; */
DECL|macro|ldq_u
mdefine_line|#define ldq_u(x,y) &bslash;&n;__asm__(&quot;ldq_u %0,%1&quot;:&quot;=r&quot; (x):&quot;m&quot; (*(unsigned long *)(y)))
DECL|macro|stq_u
mdefine_line|#define stq_u(x,y) &bslash;&n;__asm__(&quot;stq_u %1,%0&quot;:&quot;=m&quot; (*(unsigned long *)(y)):&quot;r&quot; (x))
DECL|macro|extql
mdefine_line|#define extql(x,y,z) &bslash;&n;__asm__ __volatile__(&quot;extql %1,%2,%0&quot;:&quot;=r&quot; (z):&quot;r&quot; (x),&quot;r&quot; (y))
DECL|macro|extqh
mdefine_line|#define extqh(x,y,z) &bslash;&n;__asm__ __volatile__(&quot;extqh %1,%2,%0&quot;:&quot;=r&quot; (z):&quot;r&quot; (x),&quot;r&quot; (y))
DECL|macro|mskql
mdefine_line|#define mskql(x,y,z) &bslash;&n;__asm__ __volatile__(&quot;mskql %1,%2,%0&quot;:&quot;=r&quot; (z):&quot;r&quot; (x),&quot;r&quot; (y))
DECL|macro|mskqh
mdefine_line|#define mskqh(x,y,z) &bslash;&n;__asm__ __volatile__(&quot;mskqh %1,%2,%0&quot;:&quot;=r&quot; (z):&quot;r&quot; (x),&quot;r&quot; (y))
DECL|macro|insql
mdefine_line|#define insql(x,y,z) &bslash;&n;__asm__ __volatile__(&quot;insql %1,%2,%0&quot;:&quot;=r&quot; (z):&quot;r&quot; (x),&quot;r&quot; (y))
DECL|macro|insqh
mdefine_line|#define insqh(x,y,z) &bslash;&n;__asm__ __volatile__(&quot;insqh %1,%2,%0&quot;:&quot;=r&quot; (z):&quot;r&quot; (x),&quot;r&quot; (y))
multiline_comment|/*&n; * Ok. This isn&squot;t fun, but this is the EASY case.&n; */
DECL|function|csum_partial_copy_aligned
r_static
r_inline
r_int
r_int
id|csum_partial_copy_aligned
c_func
(paren
r_int
r_int
op_star
id|src
comma
r_int
r_int
op_star
id|dst
comma
r_int
id|len
comma
r_int
r_int
id|checksum
)paren
(brace
r_int
r_int
id|word
comma
id|carry
op_assign
l_int|0
suffix:semicolon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|word
op_assign
op_star
id|src
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ge
l_int|0
)paren
(brace
id|checksum
op_add_assign
id|carry
suffix:semicolon
id|src
op_increment
suffix:semicolon
id|checksum
op_add_assign
id|word
suffix:semicolon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|carry
op_assign
id|checksum
OL
id|word
suffix:semicolon
op_star
id|dst
op_assign
id|word
suffix:semicolon
id|word
op_assign
op_star
id|src
suffix:semicolon
id|dst
op_increment
suffix:semicolon
)brace
id|len
op_add_assign
l_int|8
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
(brace
r_int
r_int
id|tmp
op_assign
op_star
id|dst
suffix:semicolon
id|mskql
c_func
(paren
id|word
comma
id|len
comma
id|word
)paren
suffix:semicolon
id|checksum
op_add_assign
id|word
suffix:semicolon
id|mskqh
c_func
(paren
id|tmp
comma
id|len
comma
id|tmp
)paren
suffix:semicolon
id|carry
op_assign
id|checksum
OL
id|word
suffix:semicolon
op_star
id|dst
op_assign
id|word
op_or
id|tmp
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
)brace
r_return
id|checksum
suffix:semicolon
)brace
multiline_comment|/*&n; * This is even less fun, but this is still reasonably&n; * easy.&n; */
DECL|function|csum_partial_copy_dest_aligned
r_static
r_inline
r_int
r_int
id|csum_partial_copy_dest_aligned
c_func
(paren
r_int
r_int
op_star
id|src
comma
r_int
r_int
op_star
id|dst
comma
r_int
r_int
id|soff
comma
r_int
id|len
comma
r_int
r_int
id|checksum
)paren
(brace
r_int
r_int
id|first
comma
id|word
comma
id|carry
op_assign
l_int|0
suffix:semicolon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|first
op_assign
id|src
(braket
l_int|0
)braket
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ge
l_int|0
)paren
(brace
r_int
r_int
id|second
suffix:semicolon
id|second
op_assign
id|src
(braket
l_int|1
)braket
suffix:semicolon
id|extql
c_func
(paren
id|first
comma
id|soff
comma
id|word
)paren
suffix:semicolon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|extqh
c_func
(paren
id|second
comma
id|soff
comma
id|first
)paren
suffix:semicolon
id|src
op_increment
suffix:semicolon
id|word
op_or_assign
id|first
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
id|first
op_assign
id|second
suffix:semicolon
id|checksum
op_add_assign
id|word
suffix:semicolon
op_star
id|dst
op_assign
id|word
suffix:semicolon
id|carry
op_assign
id|checksum
OL
id|word
suffix:semicolon
id|dst
op_increment
suffix:semicolon
)brace
id|len
op_add_assign
l_int|8
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_int
r_int
id|second
suffix:semicolon
id|second
op_assign
id|src
(braket
l_int|1
)braket
suffix:semicolon
id|tmp
op_assign
op_star
id|dst
suffix:semicolon
id|extql
c_func
(paren
id|first
comma
id|soff
comma
id|word
)paren
suffix:semicolon
id|extqh
c_func
(paren
id|second
comma
id|soff
comma
id|first
)paren
suffix:semicolon
id|word
op_or_assign
id|first
suffix:semicolon
id|mskql
c_func
(paren
id|word
comma
id|len
comma
id|word
)paren
suffix:semicolon
id|checksum
op_add_assign
id|word
suffix:semicolon
id|mskqh
c_func
(paren
id|tmp
comma
id|len
comma
id|tmp
)paren
suffix:semicolon
id|carry
op_assign
id|checksum
OL
id|word
suffix:semicolon
op_star
id|dst
op_assign
id|word
op_or
id|tmp
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
)brace
r_return
id|checksum
suffix:semicolon
)brace
multiline_comment|/*&n; * This is slightly less fun than the above..&n; */
DECL|function|csum_partial_copy_src_aligned
r_static
r_inline
r_int
r_int
id|csum_partial_copy_src_aligned
c_func
(paren
r_int
r_int
op_star
id|src
comma
r_int
r_int
op_star
id|dst
comma
r_int
r_int
id|doff
comma
r_int
id|len
comma
r_int
r_int
id|checksum
)paren
(brace
r_int
r_int
id|word
comma
id|carry
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|partial_dest
suffix:semicolon
id|partial_dest
op_assign
op_star
id|dst
suffix:semicolon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|mskql
c_func
(paren
id|partial_dest
comma
id|doff
comma
id|partial_dest
)paren
suffix:semicolon
id|word
op_assign
op_star
id|src
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ge
l_int|0
)paren
(brace
r_int
r_int
id|second_dest
suffix:semicolon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
id|src
op_increment
suffix:semicolon
id|checksum
op_add_assign
id|word
suffix:semicolon
id|insql
c_func
(paren
id|word
comma
id|doff
comma
id|second_dest
)paren
suffix:semicolon
op_star
id|dst
op_assign
id|partial_dest
op_or
id|second_dest
suffix:semicolon
id|insqh
c_func
(paren
id|word
comma
id|doff
comma
id|partial_dest
)paren
suffix:semicolon
id|carry
op_assign
id|checksum
OL
id|word
suffix:semicolon
id|word
op_assign
op_star
id|src
suffix:semicolon
id|dst
op_increment
suffix:semicolon
)brace
id|len
op_add_assign
id|doff
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ge
l_int|0
)paren
(brace
r_int
r_int
id|second_dest
suffix:semicolon
id|mskql
c_func
(paren
id|word
comma
id|len
op_minus
id|doff
comma
id|word
)paren
suffix:semicolon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|src
op_increment
suffix:semicolon
id|checksum
op_add_assign
id|word
suffix:semicolon
id|insql
c_func
(paren
id|word
comma
id|doff
comma
id|second_dest
)paren
suffix:semicolon
op_star
id|dst
op_assign
id|partial_dest
op_or
id|second_dest
suffix:semicolon
id|insqh
c_func
(paren
id|word
comma
id|doff
comma
id|partial_dest
)paren
suffix:semicolon
id|carry
op_assign
id|checksum
OL
id|word
suffix:semicolon
id|word
op_assign
op_star
id|src
suffix:semicolon
id|dst
op_increment
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|len
op_amp
l_int|7
)paren
(brace
r_int
r_int
id|second_dest
suffix:semicolon
id|second_dest
op_assign
op_star
id|dst
suffix:semicolon
id|mskql
c_func
(paren
id|word
comma
id|len
op_minus
id|doff
comma
id|word
)paren
suffix:semicolon
id|checksum
op_add_assign
id|word
suffix:semicolon
id|mskqh
c_func
(paren
id|second_dest
comma
id|len
comma
id|second_dest
)paren
suffix:semicolon
id|carry
op_assign
id|checksum
OL
id|word
suffix:semicolon
id|insql
c_func
(paren
id|word
comma
id|doff
comma
id|word
)paren
suffix:semicolon
op_star
id|dst
op_assign
id|partial_dest
op_or
id|word
op_or
id|second_dest
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
)brace
r_return
id|checksum
suffix:semicolon
)brace
multiline_comment|/*&n; * This is so totally un-fun that it&squot;s frightening. Don&squot;t&n; * look at this too closely, you&squot;ll go blind.&n; */
DECL|function|csum_partial_copy_unaligned
r_static
r_inline
r_int
r_int
id|csum_partial_copy_unaligned
c_func
(paren
r_int
r_int
op_star
id|src
comma
r_int
r_int
op_star
id|dst
comma
r_int
r_int
id|soff
comma
r_int
r_int
id|doff
comma
r_int
id|len
comma
r_int
r_int
id|checksum
)paren
(brace
r_int
r_int
id|first
comma
id|carry
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|partial_dest
suffix:semicolon
id|partial_dest
op_assign
id|dst
(braket
l_int|0
)braket
suffix:semicolon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|first
op_assign
id|src
(braket
l_int|0
)braket
suffix:semicolon
id|mskql
c_func
(paren
id|partial_dest
comma
id|doff
comma
id|partial_dest
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ge
l_int|0
)paren
(brace
r_int
r_int
id|second
comma
id|word
suffix:semicolon
r_int
r_int
id|second_dest
suffix:semicolon
id|second
op_assign
id|src
(braket
l_int|1
)braket
suffix:semicolon
id|extql
c_func
(paren
id|first
comma
id|soff
comma
id|word
)paren
suffix:semicolon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
id|src
op_increment
suffix:semicolon
id|extqh
c_func
(paren
id|second
comma
id|soff
comma
id|first
)paren
suffix:semicolon
id|word
op_or_assign
id|first
suffix:semicolon
id|first
op_assign
id|second
suffix:semicolon
id|checksum
op_add_assign
id|word
suffix:semicolon
id|insql
c_func
(paren
id|word
comma
id|doff
comma
id|second_dest
)paren
suffix:semicolon
op_star
id|dst
op_assign
id|partial_dest
op_or
id|second_dest
suffix:semicolon
id|carry
op_assign
id|checksum
OL
id|word
suffix:semicolon
id|insqh
c_func
(paren
id|word
comma
id|doff
comma
id|partial_dest
)paren
suffix:semicolon
id|dst
op_increment
suffix:semicolon
)brace
id|len
op_add_assign
id|doff
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ge
l_int|0
)paren
(brace
r_int
r_int
id|second
comma
id|word
suffix:semicolon
r_int
r_int
id|second_dest
suffix:semicolon
id|second
op_assign
id|src
(braket
l_int|1
)braket
suffix:semicolon
id|extql
c_func
(paren
id|first
comma
id|soff
comma
id|word
)paren
suffix:semicolon
id|len
op_sub_assign
l_int|8
suffix:semicolon
id|src
op_increment
suffix:semicolon
id|extqh
c_func
(paren
id|second
comma
id|soff
comma
id|first
)paren
suffix:semicolon
id|word
op_or_assign
id|first
suffix:semicolon
id|first
op_assign
id|second
suffix:semicolon
id|mskql
c_func
(paren
id|word
comma
id|len
op_minus
id|doff
comma
id|word
)paren
suffix:semicolon
id|checksum
op_add_assign
id|word
suffix:semicolon
id|insql
c_func
(paren
id|word
comma
id|doff
comma
id|second_dest
)paren
suffix:semicolon
op_star
id|dst
op_assign
id|partial_dest
op_or
id|second_dest
suffix:semicolon
id|carry
op_assign
id|checksum
OL
id|word
suffix:semicolon
id|insqh
c_func
(paren
id|word
comma
id|doff
comma
id|partial_dest
)paren
suffix:semicolon
id|dst
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|len
op_amp
l_int|7
)paren
(brace
r_int
r_int
id|second
comma
id|word
suffix:semicolon
r_int
r_int
id|second_dest
suffix:semicolon
id|second
op_assign
id|src
(braket
l_int|1
)braket
suffix:semicolon
id|extql
c_func
(paren
id|first
comma
id|soff
comma
id|word
)paren
suffix:semicolon
id|extqh
c_func
(paren
id|second
comma
id|soff
comma
id|first
)paren
suffix:semicolon
id|word
op_or_assign
id|first
suffix:semicolon
id|second_dest
op_assign
op_star
id|dst
suffix:semicolon
id|mskql
c_func
(paren
id|word
comma
id|len
op_minus
id|doff
comma
id|word
)paren
suffix:semicolon
id|checksum
op_add_assign
id|word
suffix:semicolon
id|mskqh
c_func
(paren
id|second_dest
comma
id|len
comma
id|second_dest
)paren
suffix:semicolon
id|carry
op_assign
id|checksum
OL
id|word
suffix:semicolon
id|insql
c_func
(paren
id|word
comma
id|doff
comma
id|word
)paren
suffix:semicolon
op_star
id|dst
op_assign
id|partial_dest
op_or
id|word
op_or
id|second_dest
suffix:semicolon
id|checksum
op_add_assign
id|carry
suffix:semicolon
)brace
r_return
id|checksum
suffix:semicolon
)brace
DECL|function|csum_partial_copy
r_int
r_int
id|csum_partial_copy
c_func
(paren
r_char
op_star
id|src
comma
r_char
op_star
id|dst
comma
r_int
id|len
comma
r_int
id|sum
)paren
(brace
r_int
r_int
id|checksum
op_assign
(paren
r_int
)paren
id|sum
suffix:semicolon
r_int
r_int
id|soff
op_assign
l_int|7
op_amp
(paren
r_int
r_int
)paren
id|src
suffix:semicolon
r_int
r_int
id|doff
op_assign
l_int|7
op_amp
(paren
r_int
r_int
)paren
id|dst
suffix:semicolon
id|src
op_assign
(paren
r_char
op_star
)paren
(paren
op_complement
l_int|7UL
op_amp
(paren
r_int
r_int
)paren
id|src
)paren
suffix:semicolon
id|dst
op_assign
(paren
r_char
op_star
)paren
(paren
op_complement
l_int|7UL
op_amp
(paren
r_int
r_int
)paren
id|dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|soff
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|doff
)paren
id|checksum
op_assign
id|csum_partial_copy_aligned
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|src
comma
(paren
r_int
r_int
op_star
)paren
id|dst
comma
id|len
comma
id|checksum
)paren
suffix:semicolon
r_else
id|checksum
op_assign
id|csum_partial_copy_src_aligned
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|src
comma
(paren
r_int
r_int
op_star
)paren
id|dst
comma
id|doff
comma
id|len
comma
id|checksum
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|doff
)paren
id|checksum
op_assign
id|csum_partial_copy_dest_aligned
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|src
comma
(paren
r_int
r_int
op_star
)paren
id|dst
comma
id|soff
comma
id|len
comma
id|checksum
)paren
suffix:semicolon
r_else
id|checksum
op_assign
id|csum_partial_copy_unaligned
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|src
comma
(paren
r_int
r_int
op_star
)paren
id|dst
comma
id|soff
comma
id|doff
comma
id|len
comma
id|checksum
)paren
suffix:semicolon
)brace
multiline_comment|/* 64 -&gt; 33 bits */
id|checksum
op_assign
(paren
id|checksum
op_amp
l_int|0xffffffff
)paren
op_plus
(paren
id|checksum
op_rshift
l_int|32
)paren
suffix:semicolon
multiline_comment|/* 33 -&gt; &lt; 32 bits */
id|checksum
op_assign
(paren
id|checksum
op_amp
l_int|0xffff
)paren
op_plus
(paren
id|checksum
op_rshift
l_int|16
)paren
suffix:semicolon
multiline_comment|/* 32 -&gt; 16 bits */
id|checksum
op_assign
(paren
id|checksum
op_amp
l_int|0xffff
)paren
op_plus
(paren
id|checksum
op_rshift
l_int|16
)paren
suffix:semicolon
id|checksum
op_assign
(paren
id|checksum
op_amp
l_int|0xffff
)paren
op_plus
(paren
id|checksum
op_rshift
l_int|16
)paren
suffix:semicolon
)brace
r_return
id|checksum
suffix:semicolon
)brace
eof
