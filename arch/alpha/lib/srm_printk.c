multiline_comment|/*&n; *&t;arch/alpha/lib/srm_printk.c&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/console.h&gt;
r_int
DECL|function|srm_printk
id|srm_printk
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
r_static
r_char
id|buf
(braket
l_int|1024
)braket
suffix:semicolon
id|va_list
id|args
suffix:semicolon
r_int
id|len
comma
id|num_lf
suffix:semicolon
r_char
op_star
id|src
comma
op_star
id|dst
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|len
op_assign
id|vsprintf
c_func
(paren
id|buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
multiline_comment|/* count number of linefeeds in string: */
id|num_lf
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|src
op_assign
id|buf
suffix:semicolon
op_star
id|src
suffix:semicolon
op_increment
id|src
)paren
(brace
r_if
c_cond
(paren
op_star
id|src
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
op_increment
id|num_lf
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|num_lf
)paren
(brace
multiline_comment|/* expand each linefeed into carriage-return/linefeed: */
r_for
c_loop
(paren
id|dst
op_assign
id|src
op_plus
id|num_lf
suffix:semicolon
id|src
op_ge
id|buf
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
op_star
id|src
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
op_star
id|dst
op_decrement
op_assign
l_char|&squot;&bslash;r&squot;
suffix:semicolon
)brace
op_star
id|dst
op_decrement
op_assign
op_star
id|src
op_decrement
suffix:semicolon
)brace
)brace
id|srm_puts
c_func
(paren
id|buf
comma
id|num_lf
op_plus
id|len
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
eof
