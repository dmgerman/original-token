multiline_comment|/*&n; * SMC 37C669 initialization code&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/hwrpb.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#if 0
macro_line|# define DBG_DEVS(args)         printk args
macro_line|#else
DECL|macro|DBG_DEVS
macro_line|# define DBG_DEVS(args)
macro_line|#endif
DECL|macro|KB
mdefine_line|#define KB              1024
DECL|macro|MB
mdefine_line|#define MB              (1024*KB)
DECL|macro|GB
mdefine_line|#define GB              (1024*MB)
DECL|macro|SMC_DEBUG
mdefine_line|#define SMC_DEBUG   0
multiline_comment|/* File:&t;smcc669_def.h&n; *&n; * Copyright (C) 1997 by&n; * Digital Equipment Corporation, Maynard, Massachusetts.&n; * All rights reserved.&n; *&n; * This software is furnished under a license and may be used and copied&n; * only  in  accordance  of  the  terms  of  such  license  and with the&n; * inclusion of the above copyright notice. This software or  any  other&n; * copies thereof may not be provided or otherwise made available to any&n; * other person.  No title to and  ownership of the  software is  hereby&n; * transferred.&n; *&n; * The information in this software is  subject to change without notice&n; * and  should  not  be  construed  as a commitment by Digital Equipment&n; * Corporation.&n; *&n; * Digital assumes no responsibility for the use  or  reliability of its&n; * software on equipment which is not supplied by Digital.&n; *&n; *&n; * Abstract:&t;&n; *&n; *&t;This file contains header definitions for the SMC37c669 &n; *&t;Super I/O controller. &n; *&n; * Author:&t;&n; *&n; *&t;Eric Rasmussen&n; *&n; * Modification History:&n; *&n; *&t;er&t;28-Jan-1997&t;Initial Entry&n; */
macro_line|#ifndef __SMC37c669_H
DECL|macro|__SMC37c669_H
mdefine_line|#define __SMC37c669_H
multiline_comment|/*&n;** Macros for handling device IRQs&n;**&n;** The mask acts as a flag used in mapping actual ISA IRQs (0 - 15) &n;** to device IRQs (A - H).&n;*/
DECL|macro|SMC37c669_DEVICE_IRQ_MASK
mdefine_line|#define SMC37c669_DEVICE_IRQ_MASK&t;0x80000000
DECL|macro|SMC37c669_DEVICE_IRQ
mdefine_line|#define SMC37c669_DEVICE_IRQ( __i )&t;&bslash;&n;&t;((SMC37c669_DEVICE_IRQ_MASK) | (__i))
DECL|macro|SMC37c669_IS_DEVICE_IRQ
mdefine_line|#define SMC37c669_IS_DEVICE_IRQ(__i)&t;&bslash;&n;&t;(((__i) &amp; (SMC37c669_DEVICE_IRQ_MASK)) == (SMC37c669_DEVICE_IRQ_MASK))
DECL|macro|SMC37c669_RAW_DEVICE_IRQ
mdefine_line|#define SMC37c669_RAW_DEVICE_IRQ(__i)&t;&bslash;&n;&t;((__i) &amp; ~(SMC37c669_DEVICE_IRQ_MASK))
multiline_comment|/*&n;** Macros for handling device DRQs&n;**&n;** The mask acts as a flag used in mapping actual ISA DMA&n;** channels to device DMA channels (A - C).&n;*/
DECL|macro|SMC37c669_DEVICE_DRQ_MASK
mdefine_line|#define SMC37c669_DEVICE_DRQ_MASK&t;0x80000000
DECL|macro|SMC37c669_DEVICE_DRQ
mdefine_line|#define SMC37c669_DEVICE_DRQ(__d)&t;&bslash;&n;&t;((SMC37c669_DEVICE_DRQ_MASK) | (__d))
DECL|macro|SMC37c669_IS_DEVICE_DRQ
mdefine_line|#define SMC37c669_IS_DEVICE_DRQ(__d)&t;&bslash;&n;&t;(((__d) &amp; (SMC37c669_DEVICE_DRQ_MASK)) == (SMC37c669_DEVICE_DRQ_MASK))
DECL|macro|SMC37c669_RAW_DEVICE_DRQ
mdefine_line|#define SMC37c669_RAW_DEVICE_DRQ(__d)&t;&bslash;&n;&t;((__d) &amp; ~(SMC37c669_DEVICE_DRQ_MASK))
DECL|macro|SMC37c669_DEVICE_ID
mdefine_line|#define SMC37c669_DEVICE_ID&t;0x3
multiline_comment|/*&n;** SMC37c669 Device Function Definitions&n;*/
DECL|macro|SERIAL_0
mdefine_line|#define SERIAL_0&t;0
DECL|macro|SERIAL_1
mdefine_line|#define SERIAL_1&t;1
DECL|macro|PARALLEL_0
mdefine_line|#define PARALLEL_0&t;2
DECL|macro|FLOPPY_0
mdefine_line|#define FLOPPY_0&t;3
DECL|macro|IDE_0
mdefine_line|#define IDE_0&t;&t;4
DECL|macro|NUM_FUNCS
mdefine_line|#define NUM_FUNCS&t;5
multiline_comment|/*&n;** Default Device Function Mappings&n;*/
DECL|macro|COM1_BASE
mdefine_line|#define COM1_BASE&t;0x3F8
DECL|macro|COM1_IRQ
mdefine_line|#define COM1_IRQ&t;4
DECL|macro|COM2_BASE
mdefine_line|#define COM2_BASE&t;0x2F8
DECL|macro|COM2_IRQ
mdefine_line|#define COM2_IRQ&t;3
DECL|macro|PARP_BASE
mdefine_line|#define PARP_BASE&t;0x3BC
DECL|macro|PARP_IRQ
mdefine_line|#define PARP_IRQ&t;7
DECL|macro|PARP_DRQ
mdefine_line|#define PARP_DRQ&t;3
DECL|macro|FDC_BASE
mdefine_line|#define FDC_BASE&t;0x3F0
DECL|macro|FDC_IRQ
mdefine_line|#define FDC_IRQ&t;&t;6
DECL|macro|FDC_DRQ
mdefine_line|#define FDC_DRQ&t;&t;2
multiline_comment|/*&n;** Configuration On/Off Key Definitions&n;*/
DECL|macro|SMC37c669_CONFIG_ON_KEY
mdefine_line|#define SMC37c669_CONFIG_ON_KEY&t;&t;0x55
DECL|macro|SMC37c669_CONFIG_OFF_KEY
mdefine_line|#define SMC37c669_CONFIG_OFF_KEY&t;0xAA
multiline_comment|/*&n;** SMC 37c669 Device IRQs&n;*/
DECL|macro|SMC37c669_DEVICE_IRQ_A
mdefine_line|#define SMC37c669_DEVICE_IRQ_A&t;    ( SMC37c669_DEVICE_IRQ( 0x01 ) )
DECL|macro|SMC37c669_DEVICE_IRQ_B
mdefine_line|#define SMC37c669_DEVICE_IRQ_B&t;    ( SMC37c669_DEVICE_IRQ( 0x02 ) )
DECL|macro|SMC37c669_DEVICE_IRQ_C
mdefine_line|#define SMC37c669_DEVICE_IRQ_C&t;    ( SMC37c669_DEVICE_IRQ( 0x03 ) )
DECL|macro|SMC37c669_DEVICE_IRQ_D
mdefine_line|#define SMC37c669_DEVICE_IRQ_D&t;    ( SMC37c669_DEVICE_IRQ( 0x04 ) )
DECL|macro|SMC37c669_DEVICE_IRQ_E
mdefine_line|#define SMC37c669_DEVICE_IRQ_E&t;    ( SMC37c669_DEVICE_IRQ( 0x05 ) )
DECL|macro|SMC37c669_DEVICE_IRQ_F
mdefine_line|#define SMC37c669_DEVICE_IRQ_F&t;    ( SMC37c669_DEVICE_IRQ( 0x06 ) )
multiline_comment|/*      SMC37c669_DEVICE_IRQ_G&t;    *** RESERVED ***/
DECL|macro|SMC37c669_DEVICE_IRQ_H
mdefine_line|#define SMC37c669_DEVICE_IRQ_H&t;    ( SMC37c669_DEVICE_IRQ( 0x08 ) )
multiline_comment|/*&n;** SMC 37c669 Device DMA Channel Definitions&n;*/
DECL|macro|SMC37c669_DEVICE_DRQ_A
mdefine_line|#define SMC37c669_DEVICE_DRQ_A&t;&t;    ( SMC37c669_DEVICE_DRQ( 0x01 ) )
DECL|macro|SMC37c669_DEVICE_DRQ_B
mdefine_line|#define SMC37c669_DEVICE_DRQ_B&t;&t;    ( SMC37c669_DEVICE_DRQ( 0x02 ) )
DECL|macro|SMC37c669_DEVICE_DRQ_C
mdefine_line|#define SMC37c669_DEVICE_DRQ_C&t;&t;    ( SMC37c669_DEVICE_DRQ( 0x03 ) )
multiline_comment|/*&n;** Configuration Register Index Definitions&n;*/
DECL|macro|SMC37c669_CR00_INDEX
mdefine_line|#define SMC37c669_CR00_INDEX&t;    0x00
DECL|macro|SMC37c669_CR01_INDEX
mdefine_line|#define SMC37c669_CR01_INDEX&t;    0x01
DECL|macro|SMC37c669_CR02_INDEX
mdefine_line|#define SMC37c669_CR02_INDEX&t;    0x02
DECL|macro|SMC37c669_CR03_INDEX
mdefine_line|#define SMC37c669_CR03_INDEX&t;    0x03
DECL|macro|SMC37c669_CR04_INDEX
mdefine_line|#define SMC37c669_CR04_INDEX&t;    0x04
DECL|macro|SMC37c669_CR05_INDEX
mdefine_line|#define SMC37c669_CR05_INDEX&t;    0x05
DECL|macro|SMC37c669_CR06_INDEX
mdefine_line|#define SMC37c669_CR06_INDEX&t;    0x06
DECL|macro|SMC37c669_CR07_INDEX
mdefine_line|#define SMC37c669_CR07_INDEX&t;    0x07
DECL|macro|SMC37c669_CR08_INDEX
mdefine_line|#define SMC37c669_CR08_INDEX&t;    0x08
DECL|macro|SMC37c669_CR09_INDEX
mdefine_line|#define SMC37c669_CR09_INDEX&t;    0x09
DECL|macro|SMC37c669_CR0A_INDEX
mdefine_line|#define SMC37c669_CR0A_INDEX&t;    0x0A
DECL|macro|SMC37c669_CR0B_INDEX
mdefine_line|#define SMC37c669_CR0B_INDEX&t;    0x0B
DECL|macro|SMC37c669_CR0C_INDEX
mdefine_line|#define SMC37c669_CR0C_INDEX&t;    0x0C
DECL|macro|SMC37c669_CR0D_INDEX
mdefine_line|#define SMC37c669_CR0D_INDEX&t;    0x0D
DECL|macro|SMC37c669_CR0E_INDEX
mdefine_line|#define SMC37c669_CR0E_INDEX&t;    0x0E
DECL|macro|SMC37c669_CR0F_INDEX
mdefine_line|#define SMC37c669_CR0F_INDEX&t;    0x0F
DECL|macro|SMC37c669_CR10_INDEX
mdefine_line|#define SMC37c669_CR10_INDEX&t;    0x10
DECL|macro|SMC37c669_CR11_INDEX
mdefine_line|#define SMC37c669_CR11_INDEX&t;    0x11
DECL|macro|SMC37c669_CR12_INDEX
mdefine_line|#define SMC37c669_CR12_INDEX&t;    0x12
DECL|macro|SMC37c669_CR13_INDEX
mdefine_line|#define SMC37c669_CR13_INDEX&t;    0x13
DECL|macro|SMC37c669_CR14_INDEX
mdefine_line|#define SMC37c669_CR14_INDEX&t;    0x14
DECL|macro|SMC37c669_CR15_INDEX
mdefine_line|#define SMC37c669_CR15_INDEX&t;    0x15
DECL|macro|SMC37c669_CR16_INDEX
mdefine_line|#define SMC37c669_CR16_INDEX&t;    0x16
DECL|macro|SMC37c669_CR17_INDEX
mdefine_line|#define SMC37c669_CR17_INDEX&t;    0x17
DECL|macro|SMC37c669_CR18_INDEX
mdefine_line|#define SMC37c669_CR18_INDEX&t;    0x18
DECL|macro|SMC37c669_CR19_INDEX
mdefine_line|#define SMC37c669_CR19_INDEX&t;    0x19
DECL|macro|SMC37c669_CR1A_INDEX
mdefine_line|#define SMC37c669_CR1A_INDEX&t;    0x1A
DECL|macro|SMC37c669_CR1B_INDEX
mdefine_line|#define SMC37c669_CR1B_INDEX&t;    0x1B
DECL|macro|SMC37c669_CR1C_INDEX
mdefine_line|#define SMC37c669_CR1C_INDEX&t;    0x1C
DECL|macro|SMC37c669_CR1D_INDEX
mdefine_line|#define SMC37c669_CR1D_INDEX&t;    0x1D
DECL|macro|SMC37c669_CR1E_INDEX
mdefine_line|#define SMC37c669_CR1E_INDEX&t;    0x1E
DECL|macro|SMC37c669_CR1F_INDEX
mdefine_line|#define SMC37c669_CR1F_INDEX&t;    0x1F
DECL|macro|SMC37c669_CR20_INDEX
mdefine_line|#define SMC37c669_CR20_INDEX&t;    0x20
DECL|macro|SMC37c669_CR21_INDEX
mdefine_line|#define SMC37c669_CR21_INDEX&t;    0x21
DECL|macro|SMC37c669_CR22_INDEX
mdefine_line|#define SMC37c669_CR22_INDEX&t;    0x22
DECL|macro|SMC37c669_CR23_INDEX
mdefine_line|#define SMC37c669_CR23_INDEX&t;    0x23
DECL|macro|SMC37c669_CR24_INDEX
mdefine_line|#define SMC37c669_CR24_INDEX&t;    0x24
DECL|macro|SMC37c669_CR25_INDEX
mdefine_line|#define SMC37c669_CR25_INDEX&t;    0x25
DECL|macro|SMC37c669_CR26_INDEX
mdefine_line|#define SMC37c669_CR26_INDEX&t;    0x26
DECL|macro|SMC37c669_CR27_INDEX
mdefine_line|#define SMC37c669_CR27_INDEX&t;    0x27
DECL|macro|SMC37c669_CR28_INDEX
mdefine_line|#define SMC37c669_CR28_INDEX&t;    0x28
DECL|macro|SMC37c669_CR29_INDEX
mdefine_line|#define SMC37c669_CR29_INDEX&t;    0x29
multiline_comment|/*&n;** Configuration Register Alias Definitions&n;*/
DECL|macro|SMC37c669_DEVICE_ID_INDEX
mdefine_line|#define SMC37c669_DEVICE_ID_INDEX&t;&t;    SMC37c669_CR0D_INDEX
DECL|macro|SMC37c669_DEVICE_REVISION_INDEX
mdefine_line|#define SMC37c669_DEVICE_REVISION_INDEX&t;&t;    SMC37c669_CR0E_INDEX
DECL|macro|SMC37c669_FDC_BASE_ADDRESS_INDEX
mdefine_line|#define SMC37c669_FDC_BASE_ADDRESS_INDEX&t;    SMC37c669_CR20_INDEX
DECL|macro|SMC37c669_IDE_BASE_ADDRESS_INDEX
mdefine_line|#define SMC37c669_IDE_BASE_ADDRESS_INDEX&t;    SMC37c669_CR21_INDEX
DECL|macro|SMC37c669_IDE_ALTERNATE_ADDRESS_INDEX
mdefine_line|#define SMC37c669_IDE_ALTERNATE_ADDRESS_INDEX&t;    SMC37c669_CR22_INDEX
DECL|macro|SMC37c669_PARALLEL0_BASE_ADDRESS_INDEX
mdefine_line|#define SMC37c669_PARALLEL0_BASE_ADDRESS_INDEX&t;    SMC37c669_CR23_INDEX
DECL|macro|SMC37c669_SERIAL0_BASE_ADDRESS_INDEX
mdefine_line|#define SMC37c669_SERIAL0_BASE_ADDRESS_INDEX&t;    SMC37c669_CR24_INDEX
DECL|macro|SMC37c669_SERIAL1_BASE_ADDRESS_INDEX
mdefine_line|#define SMC37c669_SERIAL1_BASE_ADDRESS_INDEX&t;    SMC37c669_CR25_INDEX
DECL|macro|SMC37c669_PARALLEL_FDC_DRQ_INDEX
mdefine_line|#define SMC37c669_PARALLEL_FDC_DRQ_INDEX&t;    SMC37c669_CR26_INDEX
DECL|macro|SMC37c669_PARALLEL_FDC_IRQ_INDEX
mdefine_line|#define SMC37c669_PARALLEL_FDC_IRQ_INDEX&t;    SMC37c669_CR27_INDEX
DECL|macro|SMC37c669_SERIAL_IRQ_INDEX
mdefine_line|#define SMC37c669_SERIAL_IRQ_INDEX&t;&t;    SMC37c669_CR28_INDEX
multiline_comment|/*&n;** Configuration Register Definitions&n;**&n;** The INDEX (write only) and DATA (read/write) ports are effective &n;** only when the chip is in the Configuration State.&n;*/
DECL|struct|_SMC37c669_CONFIG_REGS
r_typedef
r_struct
id|_SMC37c669_CONFIG_REGS
(brace
DECL|member|index_port
r_int
r_char
id|index_port
suffix:semicolon
DECL|member|data_port
r_int
r_char
id|data_port
suffix:semicolon
DECL|typedef|SMC37c669_CONFIG_REGS
)brace
id|SMC37c669_CONFIG_REGS
suffix:semicolon
multiline_comment|/*&n;** CR00 - default value 0x28&n;**&n;**  IDE_EN (CR00&lt;1:0&gt;):&n;**&t;0x - 30ua pull-ups on nIDEEN, nHDCS0, NHDCS1&n;**&t;11 - IRQ_H available as IRQ output,&n;**&t;     IRRX2, IRTX2 available as alternate IR pins&n;**&t;10 - nIDEEN, nHDCS0, nHDCS1 used to control IDE&n;**&n;**  VALID (CR00&lt;7&gt;):&n;**&t;A high level on this software controlled bit can&n;**&t;be used to indicate that a valid configuration&n;**&t;cycle has occurred.  The control software must&n;**&t;take care to set this bit at the appropriate times.&n;**&t;Set to zero after power up.  This bit has no&n;**&t;effect on any other hardware in the chip.&n;**&n;*/
DECL|union|_SMC37c669_CR00
r_typedef
r_union
id|_SMC37c669_CR00
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|ide_en
r_int
id|ide_en
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* See note above&t;&t;*/
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;*/
DECL|member|fdc_pwr
r_int
id|fdc_pwr
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = supply power to FDC  */
DECL|member|reserved2
r_int
id|reserved2
suffix:colon
l_int|3
suffix:semicolon
multiline_comment|/* Read as 010b&t;&t;*/
DECL|member|valid
r_int
id|valid
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* See note above&t;&t;*/
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR00
)brace
id|SMC37c669_CR00
suffix:semicolon
multiline_comment|/*&n;** CR01 - default value 0x9C&n;*/
DECL|union|_SMC37c669_CR01
r_typedef
r_union
id|_SMC37c669_CR01
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;    */
DECL|member|ppt_pwr
r_int
id|ppt_pwr
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = supply power to PPT&t;    */
DECL|member|ppt_mode
r_int
id|ppt_mode
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = Printer mode, 0 = EPP    */
DECL|member|reserved2
r_int
id|reserved2
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Read as 1&t;&t;    */
DECL|member|reserved3
r_int
id|reserved3
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;    */
DECL|member|lock_crx
r_int
id|lock_crx
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Lock CR00 - CR18&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR01
)brace
id|SMC37c669_CR01
suffix:semicolon
multiline_comment|/*&n;** CR02 - default value 0x88&n;*/
DECL|union|_SMC37c669_CR02
r_typedef
r_union
id|_SMC37c669_CR02
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|3
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;    */
DECL|member|uart1_pwr
r_int
id|uart1_pwr
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = supply power to UART1    */
DECL|member|reserved2
r_int
id|reserved2
suffix:colon
l_int|3
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;    */
DECL|member|uart2_pwr
r_int
id|uart2_pwr
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = supply power to UART2    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR02
)brace
id|SMC37c669_CR02
suffix:semicolon
multiline_comment|/*&n;** CR03 - default value 0x78&n;**&n;**  CR03&lt;7&gt;&t;CR03&lt;2&gt;&t;    Pin 94&n;**  -------&t;-------&t;    ------&n;**     0&t;   X&t;    DRV2 (input)&n;**     1&t;   0&t;    ADRX&n;**     1&t;   1&t;    IRQ_B&n;**&n;**  CR03&lt;6&gt;&t;CR03&lt;5&gt;&t;    Op Mode&n;**  -------&t;-------&t;    -------&n;**     0&t;   0&t;    Model 30&n;**     0&t;   1&t;    PS/2&n;**     1&t;   0&t;    Reserved&n;**     1&t;   1&t;    AT Mode&n;*/
DECL|union|_SMC37c669_CR03
r_typedef
r_union
id|_SMC37c669_CR03
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|pwrgd_gamecs
r_int
id|pwrgd_gamecs
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = PWRGD, 0 = GAMECS&t;    */
DECL|member|fdc_mode2
r_int
id|fdc_mode2
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = Enhanced Mode 2&t;    */
DECL|member|pin94_0
r_int
id|pin94_0
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;    */
DECL|member|drvden
r_int
id|drvden
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = high, 0 - output&t;    */
DECL|member|op_mode
r_int
id|op_mode
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|pin94_1
r_int
id|pin94_1
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR03
)brace
id|SMC37c669_CR03
suffix:semicolon
multiline_comment|/*&n;** CR04 - default value 0x00&n;**&n;**  PP_EXT_MODE:&n;**&t;If CR01&lt;PP_MODE&gt; = 0 and PP_EXT_MODE =&n;**&t;    00 - Standard and Bidirectional&n;**&t;    01 - EPP mode and SPP&n;**&t;    10 - ECP mode&n;**&t;&t; In this mode, 2 drives can be supported&n;**&t;&t; directly, 3 or 4 drives must use external&n;**&t;&t; 4 drive support.  SPP can be selected&n;**&t;&t; through the ECR register of ECP as mode 000.&n;**&t;    11 - ECP mode and EPP mode&n;**&t;&t; In this mode, 2 drives can be supported&n;**&t;&t; directly, 3 or 4 drives must use external&n;**&t;&t; 4 drive support.  SPP can be selected&n;**&t;&t; through the ECR register of ECP as mode 000.&n;**&t;&t; In this mode, EPP can be selected through&n;**&t;&t; the ECR register of ECP as mode 100.&n;**&n;**  PP_FDC:&n;**&t;00 - Normal&n;**&t;01 - PPFD1&n;**&t;10 - PPFD2&n;**&t;11 - Reserved&n;**&n;**  MIDI1:&n;**&t;Serial Clock Select: &n;**&t;    A low level on this bit disables MIDI support,&n;**&t;    clock = divide by 13.  A high level on this &n;**&t;    bit enables MIDI support, clock = divide by 12.&n;**&n;**&t;MIDI operates at 31.25 Kbps which can be derived &n;**&t;from 125 KHz (24 MHz / 12 = 2 MHz, 2 MHz / 16 = 125 KHz)&n;**&n;**  ALT_IO:&n;**&t;0 - Use pins IRRX, IRTX&n;**&t;1 - Use pins IRRX2, IRTX2&n;**&n;**&t;If this bit is set, the IR receive and transmit&n;**&t;functions will not be available on pins 25 and 26&n;**&t;unless CR00&lt;IDE_EN&gt; = 11.&n;*/
DECL|union|_SMC37c669_CR04
r_typedef
r_union
id|_SMC37c669_CR04
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|ppt_ext_mode
r_int
id|ppt_ext_mode
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|ppt_fdc
r_int
id|ppt_fdc
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|midi1
r_int
id|midi1
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|midi2
r_int
id|midi2
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|epp_type
r_int
id|epp_type
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 0 = EPP 1.9, 1 = EPP 1.7&t;    */
DECL|member|alt_io
r_int
id|alt_io
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR04
)brace
id|SMC37c669_CR04
suffix:semicolon
multiline_comment|/*&n;** CR05 - default value 0x00&n;**&n;**  DEN_SEL:&n;**&t;00 - Densel output normal&n;**&t;01 - Reserved&n;**&t;10 - Densel output 1&n;**&t;11 - Densel output 0&n;**&n;*/
DECL|union|_SMC37c669_CR05
r_typedef
r_union
id|_SMC37c669_CR05
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;&t;&t;*/
DECL|member|fdc_dma_mode
r_int
id|fdc_dma_mode
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 0 = burst, 1 = non-burst&t;&t;&t;*/
DECL|member|den_sel
r_int
id|den_sel
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* See note above&t;&t;&t;&t;*/
DECL|member|swap_drv
r_int
id|swap_drv
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Swap the FDC motor selects&t;&t;*/
DECL|member|extx4
r_int
id|extx4
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 0 = 2 drive, 1 = external 4 drive decode&t;*/
DECL|member|reserved2
r_int
id|reserved2
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;&t;&t;*/
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR05
)brace
id|SMC37c669_CR05
suffix:semicolon
multiline_comment|/*&n;** CR06 - default value 0xFF&n;*/
DECL|union|_SMC37c669_CR06
r_typedef
r_union
id|_SMC37c669_CR06
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|floppy_a
r_int
id|floppy_a
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* Type of floppy drive A&t;    */
DECL|member|floppy_b
r_int
id|floppy_b
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* Type of floppy drive B&t;    */
DECL|member|floppy_c
r_int
id|floppy_c
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* Type of floppy drive C&t;    */
DECL|member|floppy_d
r_int
id|floppy_d
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* Type of floppy drive D&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR06
)brace
id|SMC37c669_CR06
suffix:semicolon
multiline_comment|/*&n;** CR07 - default value 0x00&n;**&n;**  Auto Power Management CR07&lt;7:4&gt;:&n;**&t;0 - Auto Powerdown disabled (default)&n;**&t;1 - Auto Powerdown enabled&n;**&n;**&t;This bit is reset to the default state by POR or&n;**&t;a hardware reset.&n;**&n;*/
DECL|union|_SMC37c669_CR07
r_typedef
r_union
id|_SMC37c669_CR07
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|floppy_boot
r_int
id|floppy_boot
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* 0 = A:, 1 = B:&t;&t;    */
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;    */
DECL|member|ppt_en
r_int
id|ppt_en
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|uart1_en
r_int
id|uart1_en
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|uart2_en
r_int
id|uart2_en
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|fdc_en
r_int
id|fdc_en
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR07
)brace
id|SMC37c669_CR07
suffix:semicolon
multiline_comment|/*&n;** CR08 - default value 0x00&n;*/
DECL|union|_SMC37c669_CR08
r_typedef
r_union
id|_SMC37c669_CR08
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|zero
r_int
id|zero
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* 0&t;&t;&t;    */
DECL|member|addrx7_4
r_int
id|addrx7_4
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* ADR&lt;7:3&gt; for ADRx decode&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR08
)brace
id|SMC37c669_CR08
suffix:semicolon
multiline_comment|/*&n;** CR09 - default value 0x00&n;**&n;**  ADRx_CONFIG:&n;**&t;00 - ADRx disabled&n;**&t;01 - 1 byte decode A&lt;3:0&gt; = 0000b&n;**&t;10 - 8 byte block decode A&lt;3:0&gt; = 0XXXb&n;**&t;11 - 16 byte block decode A&lt;3:0&gt; = XXXXb&n;**&n;*/
DECL|union|_SMC37c669_CR09
r_typedef
r_union
id|_SMC37c669_CR09
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|adra8
r_int
id|adra8
suffix:colon
l_int|3
suffix:semicolon
multiline_comment|/* ADR&lt;10:8&gt; for ADRx decode    */
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|3
suffix:semicolon
DECL|member|adrx_config
r_int
id|adrx_config
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR09
)brace
id|SMC37c669_CR09
suffix:semicolon
multiline_comment|/*&n;** CR0A - default value 0x00&n;*/
DECL|union|_SMC37c669_CR0A
r_typedef
r_union
id|_SMC37c669_CR0A
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|ecp_fifo_threshold
r_int
id|ecp_fifo_threshold
suffix:colon
l_int|4
suffix:semicolon
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|4
suffix:semicolon
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR0A
)brace
id|SMC37c669_CR0A
suffix:semicolon
multiline_comment|/*&n;** CR0B - default value 0x00&n;*/
DECL|union|_SMC37c669_CR0B
r_typedef
r_union
id|_SMC37c669_CR0B
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|fdd0_drtx
r_int
id|fdd0_drtx
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* FDD0 Data Rate Table&t;    */
DECL|member|fdd1_drtx
r_int
id|fdd1_drtx
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* FDD1 Data Rate Table&t;    */
DECL|member|fdd2_drtx
r_int
id|fdd2_drtx
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* FDD2 Data Rate Table&t;    */
DECL|member|fdd3_drtx
r_int
id|fdd3_drtx
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* FDD3 Data Rate Table&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR0B
)brace
id|SMC37c669_CR0B
suffix:semicolon
multiline_comment|/*&n;** CR0C - default value 0x00&n;**&n;**  UART2_MODE:&n;**&t;000 - Standard (default)&n;**&t;001 - IrDA (HPSIR)&n;**&t;010 - Amplitude Shift Keyed IR @500 KHz&n;**&t;011 - Reserved&n;**&t;1xx - Reserved&n;**&n;*/
DECL|union|_SMC37c669_CR0C
r_typedef
r_union
id|_SMC37c669_CR0C
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|uart2_rcv_polarity
r_int
id|uart2_rcv_polarity
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = invert RX&t;&t;*/
DECL|member|uart2_xmit_polarity
r_int
id|uart2_xmit_polarity
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = invert TX&t;&t;*/
DECL|member|uart2_duplex
r_int
id|uart2_duplex
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = full, 0 = half&t;*/
DECL|member|uart2_mode
r_int
id|uart2_mode
suffix:colon
l_int|3
suffix:semicolon
multiline_comment|/* See note above&t;&t;*/
DECL|member|uart1_speed
r_int
id|uart1_speed
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = high speed enabled&t;*/
DECL|member|uart2_speed
r_int
id|uart2_speed
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = high speed enabled&t;*/
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR0C
)brace
id|SMC37c669_CR0C
suffix:semicolon
multiline_comment|/*&n;** CR0D - default value 0x03&n;**&n;**  Device ID Register - read only&n;*/
DECL|union|_SMC37c669_CR0D
r_typedef
r_union
id|_SMC37c669_CR0D
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|device_id
r_int
id|device_id
suffix:colon
l_int|8
suffix:semicolon
multiline_comment|/* Returns 0x3 in this field    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR0D
)brace
id|SMC37c669_CR0D
suffix:semicolon
multiline_comment|/*&n;** CR0E - default value 0x02&n;**&n;**  Device Revision Register - read only&n;*/
DECL|union|_SMC37c669_CR0E
r_typedef
r_union
id|_SMC37c669_CR0E
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|device_rev
r_int
id|device_rev
suffix:colon
l_int|8
suffix:semicolon
multiline_comment|/* Returns 0x2 in this field    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR0E
)brace
id|SMC37c669_CR0E
suffix:semicolon
multiline_comment|/*&n;** CR0F - default value 0x00&n;*/
DECL|union|_SMC37c669_CR0F
r_typedef
r_union
id|_SMC37c669_CR0F
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|test0
r_int
id|test0
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Reserved - set to 0&t;    */
DECL|member|test1
r_int
id|test1
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Reserved - set to 0&t;    */
DECL|member|test2
r_int
id|test2
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Reserved - set to 0&t;    */
DECL|member|test3
r_int
id|test3
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Reserved - set t0 0&t;    */
DECL|member|test4
r_int
id|test4
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Reserved - set to 0&t;    */
DECL|member|test5
r_int
id|test5
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Reserved - set t0 0&t;    */
DECL|member|test6
r_int
id|test6
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Reserved - set t0 0&t;    */
DECL|member|test7
r_int
id|test7
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Reserved - set to 0&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR0F
)brace
id|SMC37c669_CR0F
suffix:semicolon
multiline_comment|/*&n;** CR10 - default value 0x00&n;*/
DECL|union|_SMC37c669_CR10
r_typedef
r_union
id|_SMC37c669_CR10
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|3
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;    */
DECL|member|pll_gain
r_int
id|pll_gain
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = 3V, 2 = 5V operation    */
DECL|member|pll_stop
r_int
id|pll_stop
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = stop PLLs&t;&t;    */
DECL|member|ace_stop
r_int
id|ace_stop
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 1 = stop UART clocks&t;    */
DECL|member|pll_clock_ctrl
r_int
id|pll_clock_ctrl
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 0 = 14.318 MHz, 1 = 24 MHz  */
DECL|member|ir_test
r_int
id|ir_test
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Enable IR test mode&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR10
)brace
id|SMC37c669_CR10
suffix:semicolon
multiline_comment|/*&n;** CR11 - default value 0x00&n;*/
DECL|union|_SMC37c669_CR11
r_typedef
r_union
id|_SMC37c669_CR11
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|ir_loopback
r_int
id|ir_loopback
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Internal IR loop back&t;&t;    */
DECL|member|test_10ms
r_int
id|test_10ms
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Test 10ms autopowerdown FDC timeout  */
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|6
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR11
)brace
id|SMC37c669_CR11
suffix:semicolon
multiline_comment|/*&n;** CR12 - CR1D are reserved registers&n;*/
multiline_comment|/*&n;** CR1E - default value 0x80&n;**&n;**  GAMECS:&n;**&t;00 - GAMECS disabled&n;**&t;01 - 1 byte decode ADR&lt;3:0&gt; = 0001b&n;**&t;10 - 8 byte block decode ADR&lt;3:0&gt; = 0XXXb&n;**&t;11 - 16 byte block decode ADR&lt;3:0&gt; = XXXXb&n;**&n;*/
DECL|union|_SMC37c66_CR1E
r_typedef
r_union
id|_SMC37c66_CR1E
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|gamecs_config
r_int
id|gamecs_config
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|gamecs_addr9_4
r_int
id|gamecs_addr9_4
suffix:colon
l_int|6
suffix:semicolon
multiline_comment|/* GAMECS Addr&lt;9:4&gt;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR1E
)brace
id|SMC37c669_CR1E
suffix:semicolon
multiline_comment|/*&n;** CR1F - default value 0x00&n;**&n;**  DT0 DT1 DRVDEN0 DRVDEN1 Drive Type&n;**  --- --- ------- ------- ----------&n;**   0   0  DENSEL  DRATE0  4/2/1 MB 3.5&quot;&n;**                          2/1 MB 5.25&quot;&n;**                          2/1.6/1 MB 3.5&quot; (3-mode)&n;**   0   1  DRATE1  DRATE0&n;**   1   0  nDENSEL DRATE0  PS/2&n;**   1   1  DRATE0  DRATE1&n;**&n;**  Note: DENSEL, DRATE1, and DRATE0 map onto two output&n;**&t;  pins - DRVDEN0 and DRVDEN1.&n;**&n;*/
DECL|union|_SMC37c669_CR1F
r_typedef
r_union
id|_SMC37c669_CR1F
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|fdd0_drive_type
r_int
id|fdd0_drive_type
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* FDD0 drive type&t;    */
DECL|member|fdd1_drive_type
r_int
id|fdd1_drive_type
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* FDD1 drive type&t;    */
DECL|member|fdd2_drive_type
r_int
id|fdd2_drive_type
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* FDD2 drive type&t;    */
DECL|member|fdd3_drive_type
r_int
id|fdd3_drive_type
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* FDD3 drive type&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR1F
)brace
id|SMC37c669_CR1F
suffix:semicolon
multiline_comment|/*&n;** CR20 - default value 0x3C&n;**&n;**  FDC Base Address Register&n;**&t;- To disable this decode set Addr&lt;9:8&gt; = 0&n;**&t;- A&lt;10&gt; = 0, A&lt;3:0&gt; = 0XXXb to access.&n;**&n;*/
DECL|union|_SMC37c669_CR20
r_typedef
r_union
id|_SMC37c669_CR20
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|zero
r_int
id|zero
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* 0&t;&t;&t;    */
DECL|member|addr9_4
r_int
id|addr9_4
suffix:colon
l_int|6
suffix:semicolon
multiline_comment|/* FDC Addr&lt;9:4&gt;&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR20
)brace
id|SMC37c669_CR20
suffix:semicolon
multiline_comment|/*&n;** CR21 - default value 0x3C&n;**&n;**  IDE Base Address Register&n;**&t;- To disable this decode set Addr&lt;9:8&gt; = 0&n;**&t;- A&lt;10&gt; = 0, A&lt;3:0&gt; = 0XXXb to access.&n;**&n;*/
DECL|union|_SMC37c669_CR21
r_typedef
r_union
id|_SMC37c669_CR21
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|zero
r_int
id|zero
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* 0&t;&t;&t;    */
DECL|member|addr9_4
r_int
id|addr9_4
suffix:colon
l_int|6
suffix:semicolon
multiline_comment|/* IDE Addr&lt;9:4&gt;&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR21
)brace
id|SMC37c669_CR21
suffix:semicolon
multiline_comment|/*&n;** CR22 - default value 0x3D&n;**&n;**  IDE Alternate Status Base Address Register&n;**&t;- To disable this decode set Addr&lt;9:8&gt; = 0&n;**&t;- A&lt;10&gt; = 0, A&lt;3:0&gt; = 0110b to access.&n;**&n;*/
DECL|union|_SMC37c669_CR22
r_typedef
r_union
id|_SMC37c669_CR22
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|zero
r_int
id|zero
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* 0&t;&t;&t;    */
DECL|member|addr9_4
r_int
id|addr9_4
suffix:colon
l_int|6
suffix:semicolon
multiline_comment|/* IDE Alt Status Addr&lt;9:4&gt;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR22
)brace
id|SMC37c669_CR22
suffix:semicolon
multiline_comment|/*&n;** CR23 - default value 0x00&n;**&n;**  Parallel Port Base Address Register&n;**&t;- To disable this decode set Addr&lt;9:8&gt; = 0&n;**&t;- A&lt;10&gt; = 0 to access.&n;**&t;- If EPP is enabled, A&lt;2:0&gt; = XXXb to access.&n;**&t;  If EPP is NOT enabled, A&lt;1:0&gt; = XXb to access&n;**&n;*/
DECL|union|_SMC37c669_CR23
r_typedef
r_union
id|_SMC37c669_CR23
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|addr9_2
r_int
id|addr9_2
suffix:colon
l_int|8
suffix:semicolon
multiline_comment|/* Parallel Port Addr&lt;9:2&gt;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR23
)brace
id|SMC37c669_CR23
suffix:semicolon
multiline_comment|/*&n;** CR24 - default value 0x00&n;**&n;**  UART1 Base Address Register&n;**&t;- To disable this decode set Addr&lt;9:8&gt; = 0&n;**&t;- A&lt;10&gt; = 0, A&lt;2:0&gt; = XXXb to access.&n;**&n;*/
DECL|union|_SMC37c669_CR24
r_typedef
r_union
id|_SMC37c669_CR24
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|zero
r_int
id|zero
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 0&t;&t;&t;    */
DECL|member|addr9_3
r_int
id|addr9_3
suffix:colon
l_int|7
suffix:semicolon
multiline_comment|/* UART1 Addr&lt;9:3&gt;&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR24
)brace
id|SMC37c669_CR24
suffix:semicolon
multiline_comment|/*&n;** CR25 - default value 0x00&n;**&n;**  UART2 Base Address Register&n;**&t;- To disable this decode set Addr&lt;9:8&gt; = 0&n;**&t;- A&lt;10&gt; = 0, A&lt;2:0&gt; = XXXb to access.&n;**&n;*/
DECL|union|_SMC37c669_CR25
r_typedef
r_union
id|_SMC37c669_CR25
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|zero
r_int
id|zero
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* 0&t;&t;&t;    */
DECL|member|addr9_3
r_int
id|addr9_3
suffix:colon
l_int|7
suffix:semicolon
multiline_comment|/* UART2 Addr&lt;9:3&gt;&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR25
)brace
id|SMC37c669_CR25
suffix:semicolon
multiline_comment|/*&n;** CR26 - default value 0x00&n;**&n;**  Parallel Port / FDC DMA Select Register&n;**&n;**  D3 - D0&t;  DMA&n;**  D7 - D4&t;Selected&n;**  -------&t;--------&n;**   0000&t; None&n;**   0001&t; DMA_A&n;**   0010&t; DMA_B&n;**   0011&t; DMA_C&n;**&n;*/
DECL|union|_SMC37c669_CR26
r_typedef
r_union
id|_SMC37c669_CR26
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|ppt_drq
r_int
id|ppt_drq
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|fdc_drq
r_int
id|fdc_drq
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR26
)brace
id|SMC37c669_CR26
suffix:semicolon
multiline_comment|/*&n;** CR27 - default value 0x00&n;**&n;**  Parallel Port / FDC IRQ Select Register&n;**&n;**  D3 - D0&t;  IRQ&n;**  D7 - D4&t;Selected&n;**  -------&t;--------&n;**   0000&t; None&n;**   0001&t; IRQ_A&n;**   0010&t; IRQ_B&n;**   0011&t; IRQ_C&n;**   0100&t; IRQ_D&n;**   0101&t; IRQ_E&n;**   0110&t; IRQ_F&n;**   0111&t; Reserved&n;**   1000&t; IRQ_H&n;**&n;**  Any unselected IRQ REQ is in tristate&n;**&n;*/
DECL|union|_SMC37c669_CR27
r_typedef
r_union
id|_SMC37c669_CR27
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|ppt_irq
r_int
id|ppt_irq
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|fdc_irq
r_int
id|fdc_irq
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR27
)brace
id|SMC37c669_CR27
suffix:semicolon
multiline_comment|/*&n;** CR28 - default value 0x00&n;**&n;**  UART IRQ Select Register&n;**&n;**  D3 - D0&t;  IRQ&n;**  D7 - D4&t;Selected&n;**  -------&t;--------&n;**   0000&t; None&n;**   0001&t; IRQ_A&n;**   0010&t; IRQ_B&n;**   0011&t; IRQ_C&n;**   0100&t; IRQ_D&n;**   0101&t; IRQ_E&n;**   0110&t; IRQ_F&n;**   0111&t; Reserved&n;**   1000&t; IRQ_H&n;**   1111&t; share with UART1 (only for UART2)&n;**&n;**  Any unselected IRQ REQ is in tristate&n;**&n;**  To share an IRQ between UART1 and UART2, set&n;**  UART1 to use the desired IRQ and set UART2 to&n;**  0xF to enable sharing mechanism.&n;**&n;*/
DECL|union|_SMC37c669_CR28
r_typedef
r_union
id|_SMC37c669_CR28
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|uart2_irq
r_int
id|uart2_irq
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|uart1_irq
r_int
id|uart1_irq
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR28
)brace
id|SMC37c669_CR28
suffix:semicolon
multiline_comment|/*&n;** CR29 - default value 0x00&n;**&n;**  IRQIN IRQ Select Register&n;**&n;**  D3 - D0&t;  IRQ&n;**  D7 - D4&t;Selected&n;**  -------&t;--------&n;**   0000&t; None&n;**   0001&t; IRQ_A&n;**   0010&t; IRQ_B&n;**   0011&t; IRQ_C&n;**   0100&t; IRQ_D&n;**   0101&t; IRQ_E&n;**   0110&t; IRQ_F&n;**   0111&t; Reserved&n;**   1000&t; IRQ_H&n;**&n;**  Any unselected IRQ REQ is in tristate&n;**&n;*/
DECL|union|_SMC37c669_CR29
r_typedef
r_union
id|_SMC37c669_CR29
(brace
DECL|member|as_uchar
r_int
r_char
id|as_uchar
suffix:semicolon
r_struct
(brace
DECL|member|irqin_irq
r_int
id|irqin_irq
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* See note above&t;&t;    */
DECL|member|reserved1
r_int
id|reserved1
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* RAZ&t;&t;&t;    */
DECL|member|by_field
)brace
id|by_field
suffix:semicolon
DECL|typedef|SMC37c669_CR29
)brace
id|SMC37c669_CR29
suffix:semicolon
multiline_comment|/*&n;** Aliases of Configuration Register formats (should match&n;** the set of index aliases).&n;**&n;** Note that CR24 and CR25 have the same format and are the&n;** base address registers for UART1 and UART2.  Because of&n;** this we only define 1 alias here - for CR24 - as the serial&n;** base address register.&n;**&n;** Note that CR21 and CR22 have the same format and are the&n;** base address and alternate status address registers for&n;** the IDE controller.  Because of this we only define 1 alias&n;** here - for CR21 - as the IDE address register.&n;**&n;*/
DECL|typedef|SMC37c669_DEVICE_ID_REGISTER
r_typedef
id|SMC37c669_CR0D
id|SMC37c669_DEVICE_ID_REGISTER
suffix:semicolon
DECL|typedef|SMC37c669_DEVICE_REVISION_REGISTER
r_typedef
id|SMC37c669_CR0E
id|SMC37c669_DEVICE_REVISION_REGISTER
suffix:semicolon
DECL|typedef|SMC37c669_FDC_BASE_ADDRESS_REGISTER
r_typedef
id|SMC37c669_CR20
id|SMC37c669_FDC_BASE_ADDRESS_REGISTER
suffix:semicolon
DECL|typedef|SMC37c669_IDE_ADDRESS_REGISTER
r_typedef
id|SMC37c669_CR21
id|SMC37c669_IDE_ADDRESS_REGISTER
suffix:semicolon
DECL|typedef|SMC37c669_PARALLEL_BASE_ADDRESS_REGISTER
r_typedef
id|SMC37c669_CR23
id|SMC37c669_PARALLEL_BASE_ADDRESS_REGISTER
suffix:semicolon
DECL|typedef|SMC37c669_SERIAL_BASE_ADDRESS_REGISTER
r_typedef
id|SMC37c669_CR24
id|SMC37c669_SERIAL_BASE_ADDRESS_REGISTER
suffix:semicolon
DECL|typedef|SMC37c669_PARALLEL_FDC_DRQ_REGISTER
r_typedef
id|SMC37c669_CR26
id|SMC37c669_PARALLEL_FDC_DRQ_REGISTER
suffix:semicolon
DECL|typedef|SMC37c669_PARALLEL_FDC_IRQ_REGISTER
r_typedef
id|SMC37c669_CR27
id|SMC37c669_PARALLEL_FDC_IRQ_REGISTER
suffix:semicolon
DECL|typedef|SMC37c669_SERIAL_IRQ_REGISTER
r_typedef
id|SMC37c669_CR28
id|SMC37c669_SERIAL_IRQ_REGISTER
suffix:semicolon
multiline_comment|/*&n;** ISA/Device IRQ Translation Table Entry Definition&n;*/
DECL|struct|_SMC37c669_IRQ_TRANSLATION_ENTRY
r_typedef
r_struct
id|_SMC37c669_IRQ_TRANSLATION_ENTRY
(brace
DECL|member|device_irq
r_int
id|device_irq
suffix:semicolon
DECL|member|isa_irq
r_int
id|isa_irq
suffix:semicolon
DECL|typedef|SMC37c669_IRQ_TRANSLATION_ENTRY
)brace
id|SMC37c669_IRQ_TRANSLATION_ENTRY
suffix:semicolon
multiline_comment|/*&n;** ISA/Device DMA Translation Table Entry Definition&n;*/
DECL|struct|_SMC37c669_DRQ_TRANSLATION_ENTRY
r_typedef
r_struct
id|_SMC37c669_DRQ_TRANSLATION_ENTRY
(brace
DECL|member|device_drq
r_int
id|device_drq
suffix:semicolon
DECL|member|isa_drq
r_int
id|isa_drq
suffix:semicolon
DECL|typedef|SMC37c669_DRQ_TRANSLATION_ENTRY
)brace
id|SMC37c669_DRQ_TRANSLATION_ENTRY
suffix:semicolon
multiline_comment|/*&n;** External Interface Function Prototype Declarations&n;*/
id|SMC37c669_CONFIG_REGS
op_star
id|SMC37c669_detect
c_func
(paren
r_int
)paren
suffix:semicolon
r_int
r_int
id|SMC37c669_enable_device
c_func
(paren
r_int
r_int
id|func
)paren
suffix:semicolon
r_int
r_int
id|SMC37c669_disable_device
c_func
(paren
r_int
r_int
id|func
)paren
suffix:semicolon
r_int
r_int
id|SMC37c669_configure_device
c_func
(paren
r_int
r_int
id|func
comma
r_int
id|port
comma
r_int
id|irq
comma
r_int
id|drq
)paren
suffix:semicolon
r_void
id|SMC37c669_display_device_info
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif&t;/* __SMC37c669_H */
multiline_comment|/* file:&t;smcc669.c&n; *&n; * Copyright (C) 1997 by&n; * Digital Equipment Corporation, Maynard, Massachusetts.&n; * All rights reserved.&n; *&n; * This software is furnished under a license and may be used and copied&n; * only  in  accordance  of  the  terms  of  such  license  and with the&n; * inclusion of the above copyright notice. This software or  any  other&n; * copies thereof may not be provided or otherwise made available to any&n; * other person.  No title to and  ownership of the  software is  hereby&n; * transferred.&n; *&n; * The information in this software is  subject to change without notice&n; * and  should  not  be  construed  as a commitment by digital equipment&n; * corporation.&n; *&n; * Digital assumes no responsibility for the use  or  reliability of its&n; * software on equipment which is not supplied by digital.&n; */
multiline_comment|/*&n; *++&n; *  FACILITY:&n; *&n; *      Alpha SRM Console Firmware&n; *&n; *  MODULE DESCRIPTION:&n; *&n; *&t;SMC37c669 Super I/O controller configuration routines.&n; *&n; *  AUTHORS:&n; *&n; *&t;Eric Rasmussen&n; *&n; *  CREATION DATE:&n; *  &n; *&t;28-Jan-1997&n; *&n; *  MODIFICATION HISTORY:&n; *&t;&n; *&t;er&t;01-May-1997&t;Fixed pointer conversion errors in &n; *&t;&t;&t;&t;SMC37c669_get_device_config().&n; *      er&t;28-Jan-1997&t;Initial version.&n; *&n; *--&n; */
macro_line|#if 0
multiline_comment|/* $INCLUDE_OPTIONS$ */
macro_line|#include    &quot;cp$inc:platform_io.h&quot;
multiline_comment|/* $INCLUDE_OPTIONS_END$ */
macro_line|#include    &quot;cp$src:common.h&quot;
macro_line|#include    &quot;cp$inc:prototypes.h&quot;
macro_line|#include    &quot;cp$src:kernel_def.h&quot;
macro_line|#include    &quot;cp$src:msg_def.h&quot;
macro_line|#include    &quot;cp$src:smcc669_def.h&quot;
multiline_comment|/* Platform-specific includes */
macro_line|#include    &quot;cp$src:platform.h&quot;
macro_line|#endif
macro_line|#ifndef TRUE
DECL|macro|TRUE
mdefine_line|#define TRUE 1
macro_line|#endif
macro_line|#ifndef FALSE
DECL|macro|FALSE
mdefine_line|#define FALSE 0
macro_line|#endif
DECL|macro|wb
mdefine_line|#define wb( _x_, _y_ )&t;outb( _y_, (unsigned int)((unsigned long)_x_) )
DECL|macro|rb
mdefine_line|#define rb( _x_ )&t;inb( (unsigned int)((unsigned long)_x_) )
multiline_comment|/*&n;** Local storage for device configuration information.&n;**&n;** Since the SMC37c669 does not provide an explicit&n;** mechanism for enabling/disabling individual device &n;** functions, other than unmapping the device, local &n;** storage for device configuration information is &n;** allocated here for use in implementing our own &n;** function enable/disable scheme.&n;*/
DECL|struct|DEVICE_CONFIG
r_static
r_struct
id|DEVICE_CONFIG
(brace
DECL|member|port1
r_int
r_int
id|port1
suffix:semicolon
DECL|member|port2
r_int
r_int
id|port2
suffix:semicolon
DECL|member|irq
r_int
r_int
id|irq
suffix:semicolon
DECL|member|drq
r_int
r_int
id|drq
suffix:semicolon
DECL|variable|local_config
)brace
id|local_config
(braket
id|NUM_FUNCS
)braket
suffix:semicolon
multiline_comment|/*&n;** List of all possible addresses for the Super I/O chip&n;*/
DECL|variable|__initdata
r_static
r_int
r_int
id|SMC37c669_Addresses
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x3F0UL
comma
multiline_comment|/* Primary address&t;    */
l_int|0x370UL
comma
multiline_comment|/* Secondary address    */
l_int|0UL
multiline_comment|/* End of list&t;    */
)brace
suffix:semicolon
multiline_comment|/*&n;** Global Pointer to the Super I/O device&n;*/
DECL|variable|__initdata
r_static
id|SMC37c669_CONFIG_REGS
op_star
id|SMC37c669
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;** IRQ Translation Table&n;**&n;** The IRQ translation table is a list of SMC37c669 device &n;** and standard ISA IRQs.&n;**&n;*/
DECL|variable|__initdata
r_static
id|SMC37c669_IRQ_TRANSLATION_ENTRY
op_star
id|SMC37c669_irq_table
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;** The following definition is for the default IRQ &n;** translation table.&n;*/
r_static
id|SMC37c669_IRQ_TRANSLATION_ENTRY
id|SMC37c669_default_irq_table
(braket
)braket
DECL|variable|__initdata
id|__initdata
op_assign
(brace
(brace
id|SMC37c669_DEVICE_IRQ_A
comma
op_minus
l_int|1
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_B
comma
op_minus
l_int|1
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_C
comma
l_int|7
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_D
comma
l_int|6
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_E
comma
l_int|4
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_F
comma
l_int|3
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_H
comma
op_minus
l_int|1
)brace
comma
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
multiline_comment|/* End of table */
)brace
suffix:semicolon
multiline_comment|/*&n;** The following definition is for the MONET (XP1000) IRQ &n;** translation table.&n;*/
r_static
id|SMC37c669_IRQ_TRANSLATION_ENTRY
id|SMC37c669_monet_irq_table
(braket
)braket
DECL|variable|__initdata
id|__initdata
op_assign
(brace
(brace
id|SMC37c669_DEVICE_IRQ_A
comma
op_minus
l_int|1
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_B
comma
op_minus
l_int|1
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_C
comma
l_int|6
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_D
comma
l_int|7
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_E
comma
l_int|4
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_F
comma
l_int|3
)brace
comma
(brace
id|SMC37c669_DEVICE_IRQ_H
comma
op_minus
l_int|1
)brace
comma
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
multiline_comment|/* End of table */
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|SMC37c669_IRQ_TRANSLATION_ENTRY
op_star
id|SMC37c669_irq_tables
(braket
)braket
id|__initdata
op_assign
(brace
id|SMC37c669_default_irq_table
comma
id|SMC37c669_monet_irq_table
)brace
suffix:semicolon
multiline_comment|/*&n;** DRQ Translation Table&n;**&n;** The DRQ translation table is a list of SMC37c669 device and&n;** ISA DMA channels.&n;**&n;*/
DECL|variable|__initdata
r_static
id|SMC37c669_DRQ_TRANSLATION_ENTRY
op_star
id|SMC37c669_drq_table
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;** The following definition is the default DRQ&n;** translation table.&n;*/
r_static
id|SMC37c669_DRQ_TRANSLATION_ENTRY
id|SMC37c669_default_drq_table
(braket
)braket
DECL|variable|__initdata
id|__initdata
op_assign
(brace
(brace
id|SMC37c669_DEVICE_DRQ_A
comma
l_int|2
)brace
comma
(brace
id|SMC37c669_DEVICE_DRQ_B
comma
l_int|3
)brace
comma
(brace
id|SMC37c669_DEVICE_DRQ_C
comma
op_minus
l_int|1
)brace
comma
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
multiline_comment|/* End of table */
)brace
suffix:semicolon
multiline_comment|/*&n;** Local Function Prototype Declarations&n;*/
r_static
r_int
r_int
id|SMC37c669_is_device_enabled
c_func
(paren
r_int
r_int
id|func
)paren
suffix:semicolon
macro_line|#if 0
r_static
r_int
r_int
id|SMC37c669_get_device_config
c_func
(paren
r_int
r_int
id|func
comma
r_int
op_star
id|port
comma
r_int
op_star
id|irq
comma
r_int
op_star
id|drq
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|SMC37c669_config_mode
c_func
(paren
r_int
r_int
id|enable
)paren
suffix:semicolon
r_static
r_int
r_char
id|SMC37c669_read_config
c_func
(paren
r_int
r_char
id|index
)paren
suffix:semicolon
r_static
r_void
id|SMC37c669_write_config
c_func
(paren
r_int
r_char
id|index
comma
r_int
r_char
id|data
)paren
suffix:semicolon
r_static
r_void
id|SMC37c669_init_local_config
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_struct
id|DEVICE_CONFIG
op_star
id|SMC37c669_get_config
c_func
(paren
r_int
r_int
id|func
)paren
suffix:semicolon
r_static
r_int
id|SMC37c669_xlate_irq
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_int
id|SMC37c669_xlate_drq
c_func
(paren
r_int
r_int
id|drq
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/*&n;** External Data Declarations&n;*/
r_extern
r_struct
id|LOCK
id|spl_atomic
suffix:semicolon
multiline_comment|/*&n;** External Function Prototype Declarations&n;*/
multiline_comment|/* From kernel_alpha.mar */
r_extern
id|spinlock
c_func
(paren
r_struct
id|LOCK
op_star
id|spl
)paren
suffix:semicolon
r_extern
id|spinunlock
c_func
(paren
r_struct
id|LOCK
op_star
id|spl
)paren
suffix:semicolon
multiline_comment|/* From filesys.c */
r_int
id|allocinode
c_func
(paren
r_char
op_star
id|name
comma
r_int
id|can_create
comma
r_struct
id|INODE
op_star
op_star
id|ipp
)paren
suffix:semicolon
r_extern
r_int
id|null_procedure
c_func
(paren
r_void
)paren
suffix:semicolon
r_int
id|smcc669_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_int
id|smcc669_open
c_func
(paren
r_struct
id|FILE
op_star
id|fp
comma
r_char
op_star
id|info
comma
r_char
op_star
id|next
comma
r_char
op_star
id|mode
)paren
suffix:semicolon
r_int
id|smcc669_read
c_func
(paren
r_struct
id|FILE
op_star
id|fp
comma
r_int
id|size
comma
r_int
id|number
comma
r_int
r_char
op_star
id|buf
)paren
suffix:semicolon
r_int
id|smcc669_write
c_func
(paren
r_struct
id|FILE
op_star
id|fp
comma
r_int
id|size
comma
r_int
id|number
comma
r_int
r_char
op_star
id|buf
)paren
suffix:semicolon
r_int
id|smcc669_close
c_func
(paren
r_struct
id|FILE
op_star
id|fp
)paren
suffix:semicolon
r_struct
id|DDB
id|smc_ddb
op_assign
(brace
l_string|&quot;smc&quot;
comma
multiline_comment|/* how this routine wants to be called&t;*/
id|smcc669_read
comma
multiline_comment|/* read routine&t;&t;&t;&t;*/
id|smcc669_write
comma
multiline_comment|/* write routine&t;&t;&t;*/
id|smcc669_open
comma
multiline_comment|/* open routine&t;&t;&t;&t;*/
id|smcc669_close
comma
multiline_comment|/* close routine&t;&t;&t;*/
id|null_procedure
comma
multiline_comment|/* name expansion routine&t;&t;*/
id|null_procedure
comma
multiline_comment|/* delete routine&t;&t;&t;*/
id|null_procedure
comma
multiline_comment|/* create routine&t;&t;&t;*/
id|null_procedure
comma
multiline_comment|/* setmode&t;&t;&t;&t;*/
id|null_procedure
comma
multiline_comment|/* validation routine&t;&t;&t;*/
l_int|0
comma
multiline_comment|/* class specific use&t;&t;&t;*/
l_int|1
comma
multiline_comment|/* allows information&t;&t;&t;*/
l_int|0
comma
multiline_comment|/* must be stacked&t;&t;&t;*/
l_int|0
comma
multiline_comment|/* is a flash update driver&t;&t;*/
l_int|0
comma
multiline_comment|/* is a block device&t;&t;&t;*/
l_int|0
comma
multiline_comment|/* not seekable&t;&t;&t;&t;*/
l_int|0
comma
multiline_comment|/* is an Ethernet device&t;&t;*/
l_int|0
comma
multiline_comment|/* is a filesystem driver&t;&t;*/
)brace
suffix:semicolon
macro_line|#endif
DECL|macro|spinlock
mdefine_line|#define spinlock(x)
DECL|macro|spinunlock
mdefine_line|#define spinunlock(x)
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function detects the presence of an SMC37c669 Super I/O&n;**&t;controller.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**&t;None&n;**&n;**  RETURN VALUE:&n;**&n;**      Returns a pointer to the device if found, otherwise,&n;**&t;the NULL pointer is returned.&n;**&n;**  SIDE EFFECTS:&n;**&n;**      None&n;**&n;**--&n;*/
DECL|function|SMC37c669_detect
id|SMC37c669_CONFIG_REGS
op_star
id|__init
id|SMC37c669_detect
c_func
(paren
r_int
id|index
)paren
(brace
r_int
id|i
suffix:semicolon
id|SMC37c669_DEVICE_ID_REGISTER
id|id
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_Addresses
(braket
id|i
)braket
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/*&n;** Initialize the device pointer even though we don&squot;t yet know if&n;** the controller is at this address.  The support functions access&n;** the controller through this device pointer so we need to set it&n;** even when we are looking ...&n;*/
id|SMC37c669
op_assign
(paren
id|SMC37c669_CONFIG_REGS
op_star
)paren
id|SMC37c669_Addresses
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/*&n;** Enter configuration mode&n;*/
id|SMC37c669_config_mode
c_func
(paren
id|TRUE
)paren
suffix:semicolon
multiline_comment|/*&n;** Read the device id&n;*/
id|id.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_DEVICE_ID_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;** Exit configuration mode&n;*/
id|SMC37c669_config_mode
c_func
(paren
id|FALSE
)paren
suffix:semicolon
multiline_comment|/*&n;** Does the device id match?  If so, assume we have found an&n;** SMC37c669 controller at this address.&n;*/
r_if
c_cond
(paren
id|id.by_field.device_id
op_eq
id|SMC37c669_DEVICE_ID
)paren
(brace
multiline_comment|/*&n;** Initialize the IRQ and DRQ translation tables.&n;*/
id|SMC37c669_irq_table
op_assign
id|SMC37c669_irq_tables
(braket
id|index
)braket
suffix:semicolon
id|SMC37c669_drq_table
op_assign
id|SMC37c669_default_drq_table
suffix:semicolon
multiline_comment|/*&n;** erfix&n;**&n;** If the platform can&squot;t use the IRQ and DRQ defaults set up in this &n;** file, it should call a platform-specific external routine at this &n;** point to reset the IRQ and DRQ translation table pointers to point &n;** at the appropriate tables for the platform.  If the defaults are &n;** acceptable, then the external routine should do nothing.&n;*/
multiline_comment|/*&n;** Put the chip back into configuration mode&n;*/
id|SMC37c669_config_mode
c_func
(paren
id|TRUE
)paren
suffix:semicolon
multiline_comment|/*&n;** Initialize local storage for configuration information&n;*/
id|SMC37c669_init_local_config
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;** Exit configuration mode&n;*/
id|SMC37c669_config_mode
c_func
(paren
id|FALSE
)paren
suffix:semicolon
multiline_comment|/*&n;** SMC37c669 controller found, break out of search loop&n;*/
r_break
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;** Otherwise, we did not find an SMC37c669 controller at this&n;** address so set the device pointer to NULL.&n;*/
id|SMC37c669
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
id|SMC37c669
suffix:semicolon
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function enables an SMC37c669 device function.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      func:&n;**          Which device function to enable&n;**&n;**  RETURN VALUE:&n;**&n;**      Returns TRUE is the device function was enabled, otherwise, FALSE&n;**&n;**  SIDE EFFECTS:&n;**&n;**      {@description or none@}&n;**&n;**  DESIGN:&n;**&n;**      Enabling a device function in the SMC37c669 controller involves&n;**&t;setting all of its mappings (port, irq, drq ...).  A local &n;**&t;&quot;shadow&quot; copy of the device configuration is kept so we can&n;**&t;just set each mapping to what the local copy says.&n;**&n;**&t;This function ALWAYS updates the local shadow configuration of&n;**&t;the device function being enabled, even if the device is always&n;**&t;enabled.  To avoid replication of code, functions such as&n;**&t;configure_device set up the local copy and then call this &n;**&t;function to the update the real device.&n;**&n;**--&n;*/
DECL|function|SMC37c669_enable_device
r_int
r_int
id|__init
id|SMC37c669_enable_device
(paren
r_int
r_int
id|func
)paren
(brace
r_int
r_int
id|ret_val
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/*&n;** Put the device into configuration mode&n;*/
id|SMC37c669_config_mode
c_func
(paren
id|TRUE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|func
)paren
(brace
r_case
id|SERIAL_0
suffix:colon
(brace
id|SMC37c669_SERIAL_BASE_ADDRESS_REGISTER
id|base_addr
suffix:semicolon
id|SMC37c669_SERIAL_IRQ_REGISTER
id|irq
suffix:semicolon
multiline_comment|/*&n;** Enable the serial 1 IRQ mapping&n;*/
id|irq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_SERIAL_IRQ_INDEX
)paren
suffix:semicolon
id|irq.by_field.uart1_irq
op_assign
id|SMC37c669_RAW_DEVICE_IRQ
c_func
(paren
id|SMC37c669_xlate_irq
c_func
(paren
id|local_config
(braket
id|func
)braket
dot
id|irq
)paren
)paren
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_SERIAL_IRQ_INDEX
comma
id|irq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Enable the serial 1 port base address mapping&n;*/
id|base_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|base_addr.by_field.addr9_3
op_assign
id|local_config
(braket
id|func
)braket
dot
id|port1
op_rshift
l_int|3
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_SERIAL0_BASE_ADDRESS_INDEX
comma
id|base_addr.as_uchar
)paren
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|SERIAL_1
suffix:colon
(brace
id|SMC37c669_SERIAL_BASE_ADDRESS_REGISTER
id|base_addr
suffix:semicolon
id|SMC37c669_SERIAL_IRQ_REGISTER
id|irq
suffix:semicolon
multiline_comment|/*&n;** Enable the serial 2 IRQ mapping&n;*/
id|irq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_SERIAL_IRQ_INDEX
)paren
suffix:semicolon
id|irq.by_field.uart2_irq
op_assign
id|SMC37c669_RAW_DEVICE_IRQ
c_func
(paren
id|SMC37c669_xlate_irq
c_func
(paren
id|local_config
(braket
id|func
)braket
dot
id|irq
)paren
)paren
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_SERIAL_IRQ_INDEX
comma
id|irq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Enable the serial 2 port base address mapping&n;*/
id|base_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|base_addr.by_field.addr9_3
op_assign
id|local_config
(braket
id|func
)braket
dot
id|port1
op_rshift
l_int|3
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_SERIAL1_BASE_ADDRESS_INDEX
comma
id|base_addr.as_uchar
)paren
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|PARALLEL_0
suffix:colon
(brace
id|SMC37c669_PARALLEL_BASE_ADDRESS_REGISTER
id|base_addr
suffix:semicolon
id|SMC37c669_PARALLEL_FDC_IRQ_REGISTER
id|irq
suffix:semicolon
id|SMC37c669_PARALLEL_FDC_DRQ_REGISTER
id|drq
suffix:semicolon
multiline_comment|/*&n;** Enable the parallel port DMA channel mapping&n;*/
id|drq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_DRQ_INDEX
)paren
suffix:semicolon
id|drq.by_field.ppt_drq
op_assign
id|SMC37c669_RAW_DEVICE_DRQ
c_func
(paren
id|SMC37c669_xlate_drq
c_func
(paren
id|local_config
(braket
id|func
)braket
dot
id|drq
)paren
)paren
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_DRQ_INDEX
comma
id|drq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Enable the parallel port IRQ mapping&n;*/
id|irq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_IRQ_INDEX
)paren
suffix:semicolon
id|irq.by_field.ppt_irq
op_assign
id|SMC37c669_RAW_DEVICE_IRQ
c_func
(paren
id|SMC37c669_xlate_irq
c_func
(paren
id|local_config
(braket
id|func
)braket
dot
id|irq
)paren
)paren
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_IRQ_INDEX
comma
id|irq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Enable the parallel port base address mapping&n;*/
id|base_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|base_addr.by_field.addr9_2
op_assign
id|local_config
(braket
id|func
)braket
dot
id|port1
op_rshift
l_int|2
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_PARALLEL0_BASE_ADDRESS_INDEX
comma
id|base_addr.as_uchar
)paren
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FLOPPY_0
suffix:colon
(brace
id|SMC37c669_FDC_BASE_ADDRESS_REGISTER
id|base_addr
suffix:semicolon
id|SMC37c669_PARALLEL_FDC_IRQ_REGISTER
id|irq
suffix:semicolon
id|SMC37c669_PARALLEL_FDC_DRQ_REGISTER
id|drq
suffix:semicolon
multiline_comment|/*&n;** Enable the floppy controller DMA channel mapping&n;*/
id|drq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_DRQ_INDEX
)paren
suffix:semicolon
id|drq.by_field.fdc_drq
op_assign
id|SMC37c669_RAW_DEVICE_DRQ
c_func
(paren
id|SMC37c669_xlate_drq
c_func
(paren
id|local_config
(braket
id|func
)braket
dot
id|drq
)paren
)paren
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_DRQ_INDEX
comma
id|drq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Enable the floppy controller IRQ mapping&n;*/
id|irq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_IRQ_INDEX
)paren
suffix:semicolon
id|irq.by_field.fdc_irq
op_assign
id|SMC37c669_RAW_DEVICE_IRQ
c_func
(paren
id|SMC37c669_xlate_irq
c_func
(paren
id|local_config
(braket
id|func
)braket
dot
id|irq
)paren
)paren
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_IRQ_INDEX
comma
id|irq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Enable the floppy controller base address mapping&n;*/
id|base_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|base_addr.by_field.addr9_4
op_assign
id|local_config
(braket
id|func
)braket
dot
id|port1
op_rshift
l_int|4
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_FDC_BASE_ADDRESS_INDEX
comma
id|base_addr.as_uchar
)paren
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|IDE_0
suffix:colon
(brace
id|SMC37c669_IDE_ADDRESS_REGISTER
id|ide_addr
suffix:semicolon
multiline_comment|/*&n;** Enable the IDE alternate status base address mapping&n;*/
id|ide_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|ide_addr.by_field.addr9_4
op_assign
id|local_config
(braket
id|func
)braket
dot
id|port2
op_rshift
l_int|4
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_IDE_ALTERNATE_ADDRESS_INDEX
comma
id|ide_addr.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Enable the IDE controller base address mapping&n;*/
id|ide_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|ide_addr.by_field.addr9_4
op_assign
id|local_config
(braket
id|func
)braket
dot
id|port1
op_rshift
l_int|4
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_IDE_BASE_ADDRESS_INDEX
comma
id|ide_addr.as_uchar
)paren
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;** Exit configuration mode and return&n;*/
id|SMC37c669_config_mode
c_func
(paren
id|FALSE
)paren
suffix:semicolon
r_return
id|ret_val
suffix:semicolon
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function disables a device function within the&n;**&t;SMC37c669 Super I/O controller.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      func:&n;**          Which function to disable&n;**&n;**  RETURN VALUE:&n;**&n;**      Return TRUE if the device function was disabled, otherwise, FALSE&n;**&n;**  SIDE EFFECTS:&n;**&n;**      {@description or none@}&n;**&n;**  DESIGN:&n;**&n;**      Disabling a function in the SMC37c669 device involves&n;**&t;disabling all the function&squot;s mappings (port, irq, drq ...).&n;**&t;A shadow copy of the device configuration is maintained&n;**&t;in local storage so we won&squot;t worry aboving saving the&n;**&t;current configuration information.&n;**&n;**--&n;*/
DECL|function|SMC37c669_disable_device
r_int
r_int
id|__init
id|SMC37c669_disable_device
(paren
r_int
r_int
id|func
)paren
(brace
r_int
r_int
id|ret_val
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/*&n;** Put the device into configuration mode&n;*/
id|SMC37c669_config_mode
c_func
(paren
id|TRUE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|func
)paren
(brace
r_case
id|SERIAL_0
suffix:colon
(brace
id|SMC37c669_SERIAL_BASE_ADDRESS_REGISTER
id|base_addr
suffix:semicolon
id|SMC37c669_SERIAL_IRQ_REGISTER
id|irq
suffix:semicolon
multiline_comment|/*&n;** Disable the serial 1 IRQ mapping&n;*/
id|irq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_SERIAL_IRQ_INDEX
)paren
suffix:semicolon
id|irq.by_field.uart1_irq
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_SERIAL_IRQ_INDEX
comma
id|irq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Disable the serial 1 port base address mapping&n;*/
id|base_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_SERIAL0_BASE_ADDRESS_INDEX
comma
id|base_addr.as_uchar
)paren
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|SERIAL_1
suffix:colon
(brace
id|SMC37c669_SERIAL_BASE_ADDRESS_REGISTER
id|base_addr
suffix:semicolon
id|SMC37c669_SERIAL_IRQ_REGISTER
id|irq
suffix:semicolon
multiline_comment|/*&n;** Disable the serial 2 IRQ mapping&n;*/
id|irq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_SERIAL_IRQ_INDEX
)paren
suffix:semicolon
id|irq.by_field.uart2_irq
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_SERIAL_IRQ_INDEX
comma
id|irq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Disable the serial 2 port base address mapping&n;*/
id|base_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_SERIAL1_BASE_ADDRESS_INDEX
comma
id|base_addr.as_uchar
)paren
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|PARALLEL_0
suffix:colon
(brace
id|SMC37c669_PARALLEL_BASE_ADDRESS_REGISTER
id|base_addr
suffix:semicolon
id|SMC37c669_PARALLEL_FDC_IRQ_REGISTER
id|irq
suffix:semicolon
id|SMC37c669_PARALLEL_FDC_DRQ_REGISTER
id|drq
suffix:semicolon
multiline_comment|/*&n;** Disable the parallel port DMA channel mapping&n;*/
id|drq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_DRQ_INDEX
)paren
suffix:semicolon
id|drq.by_field.ppt_drq
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_DRQ_INDEX
comma
id|drq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Disable the parallel port IRQ mapping&n;*/
id|irq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_IRQ_INDEX
)paren
suffix:semicolon
id|irq.by_field.ppt_irq
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_IRQ_INDEX
comma
id|irq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Disable the parallel port base address mapping&n;*/
id|base_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_PARALLEL0_BASE_ADDRESS_INDEX
comma
id|base_addr.as_uchar
)paren
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FLOPPY_0
suffix:colon
(brace
id|SMC37c669_FDC_BASE_ADDRESS_REGISTER
id|base_addr
suffix:semicolon
id|SMC37c669_PARALLEL_FDC_IRQ_REGISTER
id|irq
suffix:semicolon
id|SMC37c669_PARALLEL_FDC_DRQ_REGISTER
id|drq
suffix:semicolon
multiline_comment|/*&n;** Disable the floppy controller DMA channel mapping&n;*/
id|drq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_DRQ_INDEX
)paren
suffix:semicolon
id|drq.by_field.fdc_drq
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_DRQ_INDEX
comma
id|drq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Disable the floppy controller IRQ mapping&n;*/
id|irq.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_IRQ_INDEX
)paren
suffix:semicolon
id|irq.by_field.fdc_irq
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_IRQ_INDEX
comma
id|irq.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Disable the floppy controller base address mapping&n;*/
id|base_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_FDC_BASE_ADDRESS_INDEX
comma
id|base_addr.as_uchar
)paren
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|IDE_0
suffix:colon
(brace
id|SMC37c669_IDE_ADDRESS_REGISTER
id|ide_addr
suffix:semicolon
multiline_comment|/*&n;** Disable the IDE alternate status base address mapping&n;*/
id|ide_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_IDE_ALTERNATE_ADDRESS_INDEX
comma
id|ide_addr.as_uchar
)paren
suffix:semicolon
multiline_comment|/*&n;** Disable the IDE controller base address mapping&n;*/
id|ide_addr.as_uchar
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
id|SMC37c669_IDE_BASE_ADDRESS_INDEX
comma
id|ide_addr.as_uchar
)paren
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;** Exit configuration mode and return&n;*/
id|SMC37c669_config_mode
c_func
(paren
id|FALSE
)paren
suffix:semicolon
r_return
id|ret_val
suffix:semicolon
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function configures a device function within the &n;**&t;SMC37c669 Super I/O controller.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      func:&n;**          Which device function&n;**       &n;**      port:&n;**          I/O port for the function to use&n;**&t; &n;**      irq:&n;**          IRQ for the device function to use&n;**&t; &n;**      drq:&n;**          DMA channel for the device function to use&n;**&n;**  RETURN VALUE:&n;**&n;**      Returns TRUE if the device function was configured, &n;**&t;otherwise, FALSE.&n;**&n;**  SIDE EFFECTS:&n;**&n;**      {@description or none@}&n;**&n;**  DESIGN:&n;**&n;**&t;If this function returns TRUE, the local shadow copy of&n;**&t;the configuration is also updated.  If the device function&n;**&t;is currently disabled, only the local shadow copy is &n;**&t;updated and the actual device function will be updated&n;**&t;if/when it is enabled.&n;**&n;**--&n;*/
DECL|function|SMC37c669_configure_device
r_int
r_int
id|__init
id|SMC37c669_configure_device
(paren
r_int
r_int
id|func
comma
r_int
id|port
comma
r_int
id|irq
comma
r_int
id|drq
)paren
(brace
r_struct
id|DEVICE_CONFIG
op_star
id|cp
suffix:semicolon
multiline_comment|/*&n;** Check for a valid configuration&n;*/
r_if
c_cond
(paren
(paren
id|cp
op_assign
id|SMC37c669_get_config
(paren
id|func
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/*&n;** Configuration is valid, update the local shadow copy&n;*/
r_if
c_cond
(paren
(paren
id|drq
op_amp
op_complement
l_int|0xFF
)paren
op_eq
l_int|0
)paren
(brace
id|cp-&gt;drq
op_assign
id|drq
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|irq
op_amp
op_complement
l_int|0xFF
)paren
op_eq
l_int|0
)paren
(brace
id|cp-&gt;irq
op_assign
id|irq
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|port
op_amp
op_complement
l_int|0xFFFF
)paren
op_eq
l_int|0
)paren
(brace
id|cp-&gt;port1
op_assign
id|port
suffix:semicolon
)brace
multiline_comment|/*&n;** If the device function is enabled, update the actual&n;** device configuration.&n;*/
r_if
c_cond
(paren
id|SMC37c669_is_device_enabled
c_func
(paren
id|func
)paren
)paren
(brace
id|SMC37c669_enable_device
c_func
(paren
id|func
)paren
suffix:semicolon
)brace
r_return
id|TRUE
suffix:semicolon
)brace
r_return
id|FALSE
suffix:semicolon
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function determines whether a device function&n;**&t;within the SMC37c669 controller is enabled.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      func:&n;**          Which device function&n;**&n;**  RETURN VALUE:&n;**&n;**      Returns TRUE if the device function is enabled, otherwise, FALSE&n;**&n;**  SIDE EFFECTS:&n;**&n;**      {@description or none@}&n;**&n;**  DESIGN:&n;**&n;**      To check whether a device is enabled we will only look at &n;**&t;the port base address mapping.  According to the SMC37c669&n;**&t;specification, all of the port base address mappings are&n;**&t;disabled if the addr&lt;9:8&gt; (bits &lt;7:6&gt; of the register) are&n;**&t;zero.&n;**&n;**--&n;*/
DECL|function|SMC37c669_is_device_enabled
r_static
r_int
r_int
id|__init
id|SMC37c669_is_device_enabled
(paren
r_int
r_int
id|func
)paren
(brace
r_int
r_char
id|base_addr
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|dev_ok
op_assign
id|FALSE
suffix:semicolon
r_int
r_int
id|ret_val
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/*&n;** Enter configuration mode&n;*/
id|SMC37c669_config_mode
c_func
(paren
id|TRUE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|func
)paren
(brace
r_case
id|SERIAL_0
suffix:colon
id|base_addr
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_SERIAL0_BASE_ADDRESS_INDEX
)paren
suffix:semicolon
id|dev_ok
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SERIAL_1
suffix:colon
id|base_addr
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_SERIAL1_BASE_ADDRESS_INDEX
)paren
suffix:semicolon
id|dev_ok
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PARALLEL_0
suffix:colon
id|base_addr
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL0_BASE_ADDRESS_INDEX
)paren
suffix:semicolon
id|dev_ok
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FLOPPY_0
suffix:colon
id|base_addr
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_FDC_BASE_ADDRESS_INDEX
)paren
suffix:semicolon
id|dev_ok
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IDE_0
suffix:colon
id|base_addr
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_IDE_BASE_ADDRESS_INDEX
)paren
suffix:semicolon
id|dev_ok
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;** If we have a valid device, check base_addr&lt;7:6&gt; to see if the&n;** device is enabled (mapped).&n;*/
r_if
c_cond
(paren
(paren
id|dev_ok
)paren
op_logical_and
(paren
(paren
id|base_addr
op_amp
l_int|0xC0
)paren
op_ne
l_int|0
)paren
)paren
(brace
multiline_comment|/*&n;** The mapping is not disabled, so assume that the function is &n;** enabled.&n;*/
id|ret_val
op_assign
id|TRUE
suffix:semicolon
)brace
multiline_comment|/*&n;** Exit configuration mode &n;*/
id|SMC37c669_config_mode
c_func
(paren
id|FALSE
)paren
suffix:semicolon
r_return
id|ret_val
suffix:semicolon
)brace
"&f;"
macro_line|#if 0
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function retrieves the configuration information of a &n;**&t;device function within the SMC37c699 Super I/O controller.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      func:&n;**          Which device function&n;**       &n;**      port:&n;**          I/O port returned&n;**&t; &n;**      irq:&n;**          IRQ returned&n;**&t; &n;**      drq:&n;**          DMA channel returned&n;**&n;**  RETURN VALUE:&n;**&n;**      Returns TRUE if the device configuration was successfully&n;**&t;retrieved, otherwise, FALSE.&n;**&n;**  SIDE EFFECTS:&n;**&n;**      The data pointed to by the port, irq, and drq parameters&n;**&t;my be modified even if the configuration is not successfully&n;**&t;retrieved.&n;**&n;**  DESIGN:&n;**&n;**      The device configuration is fetched from the local shadow&n;**&t;copy.  Any unused parameters will be set to -1.  Any&n;**&t;parameter which is not desired can specify the NULL&n;**&t;pointer.&n;**&n;**--&n;*/
r_static
r_int
r_int
id|__init
id|SMC37c669_get_device_config
(paren
r_int
r_int
id|func
comma
r_int
op_star
id|port
comma
r_int
op_star
id|irq
comma
r_int
op_star
id|drq
)paren
(brace
r_struct
id|DEVICE_CONFIG
op_star
id|cp
suffix:semicolon
r_int
r_int
id|ret_val
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/*&n;** Check for a valid device configuration&n;*/
r_if
c_cond
(paren
(paren
id|cp
op_assign
id|SMC37c669_get_config
c_func
(paren
id|func
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|drq
op_ne
l_int|NULL
)paren
(brace
op_star
id|drq
op_assign
id|cp-&gt;drq
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq
op_ne
l_int|NULL
)paren
(brace
op_star
id|irq
op_assign
id|cp-&gt;irq
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|port
op_ne
l_int|NULL
)paren
(brace
op_star
id|port
op_assign
id|cp-&gt;port1
suffix:semicolon
id|ret_val
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_return
id|ret_val
suffix:semicolon
)brace
macro_line|#endif
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function displays the current state of the SMC37c699&n;**&t;Super I/O controller&squot;s device functions.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      None&n;**&n;**  RETURN VALUE:&n;**&n;**      None&n;**&n;**  SIDE EFFECTS:&n;**&n;**      None&n;**&n;**--&n;*/
DECL|function|SMC37c669_display_device_info
r_void
id|__init
id|SMC37c669_display_device_info
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|SMC37c669_is_device_enabled
c_func
(paren
id|SERIAL_0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  Serial 0:    Enabled [ Port 0x%x, IRQ %d ]&bslash;n&quot;
comma
id|local_config
(braket
id|SERIAL_0
)braket
dot
id|port1
comma
id|local_config
(braket
id|SERIAL_0
)braket
dot
id|irq
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;  Serial 0:    Disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SMC37c669_is_device_enabled
c_func
(paren
id|SERIAL_1
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  Serial 1:    Enabled [ Port 0x%x, IRQ %d ]&bslash;n&quot;
comma
id|local_config
(braket
id|SERIAL_1
)braket
dot
id|port1
comma
id|local_config
(braket
id|SERIAL_1
)braket
dot
id|irq
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;  Serial 1:    Disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SMC37c669_is_device_enabled
c_func
(paren
id|PARALLEL_0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  Parallel:    Enabled [ Port 0x%x, IRQ %d/%d ]&bslash;n&quot;
comma
id|local_config
(braket
id|PARALLEL_0
)braket
dot
id|port1
comma
id|local_config
(braket
id|PARALLEL_0
)braket
dot
id|irq
comma
id|local_config
(braket
id|PARALLEL_0
)braket
dot
id|drq
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;  Parallel:    Disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SMC37c669_is_device_enabled
c_func
(paren
id|FLOPPY_0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  Floppy Ctrl: Enabled [ Port 0x%x, IRQ %d/%d ]&bslash;n&quot;
comma
id|local_config
(braket
id|FLOPPY_0
)braket
dot
id|port1
comma
id|local_config
(braket
id|FLOPPY_0
)braket
dot
id|irq
comma
id|local_config
(braket
id|FLOPPY_0
)braket
dot
id|drq
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;  Floppy Ctrl: Disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SMC37c669_is_device_enabled
c_func
(paren
id|IDE_0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  IDE 0:       Enabled [ Port 0x%x, IRQ %d ]&bslash;n&quot;
comma
id|local_config
(braket
id|IDE_0
)braket
dot
id|port1
comma
id|local_config
(braket
id|IDE_0
)braket
dot
id|irq
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;  IDE 0:       Disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function puts the SMC37c669 Super I/O controller into,&n;**&t;and takes it out of, configuration mode.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      enable:&n;**          TRUE to enter configuration mode, FALSE to exit.&n;**&n;**  RETURN VALUE:&n;**&n;**      None&n;**&n;**  SIDE EFFECTS:&n;**&n;**      The SMC37c669 controller may be left in configuration mode.&n;**&n;**--&n;*/
DECL|function|SMC37c669_config_mode
r_static
r_void
id|__init
id|SMC37c669_config_mode
c_func
(paren
r_int
r_int
id|enable
)paren
(brace
r_if
c_cond
(paren
id|enable
)paren
(brace
multiline_comment|/*&n;** To enter configuration mode, two writes in succession to the index&n;** port are required.  If a write to another address or port occurs&n;** between these two writes, the chip does not enter configuration&n;** mode.  Therefore, a spinlock is placed around the two writes to &n;** guarantee that they complete uninterrupted.&n;*/
id|spinlock
c_func
(paren
op_amp
id|spl_atomic
)paren
suffix:semicolon
id|wb
c_func
(paren
op_amp
id|SMC37c669-&gt;index_port
comma
id|SMC37c669_CONFIG_ON_KEY
)paren
suffix:semicolon
id|wb
c_func
(paren
op_amp
id|SMC37c669-&gt;index_port
comma
id|SMC37c669_CONFIG_ON_KEY
)paren
suffix:semicolon
id|spinunlock
c_func
(paren
op_amp
id|spl_atomic
)paren
suffix:semicolon
)brace
r_else
(brace
id|wb
c_func
(paren
op_amp
id|SMC37c669-&gt;index_port
comma
id|SMC37c669_CONFIG_OFF_KEY
)paren
suffix:semicolon
)brace
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function reads an SMC37c669 Super I/O controller&n;**&t;configuration register.  This function assumes that the&n;**&t;device is already in configuration mode.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      index:&n;**          Index value of configuration register to read&n;**&n;**  RETURN VALUE:&n;**&n;**      Data read from configuration register&n;**&n;**  SIDE EFFECTS:&n;**&n;**      None&n;**&n;**--&n;*/
DECL|function|SMC37c669_read_config
r_static
r_int
r_char
id|__init
id|SMC37c669_read_config
c_func
(paren
r_int
r_char
id|index
)paren
(brace
r_int
r_char
id|data
suffix:semicolon
id|wb
c_func
(paren
op_amp
id|SMC37c669-&gt;index_port
comma
id|index
)paren
suffix:semicolon
id|data
op_assign
id|rb
c_func
(paren
op_amp
id|SMC37c669-&gt;data_port
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function writes an SMC37c669 Super I/O controller&n;**&t;configuration register.  This function assumes that the&n;**&t;device is already in configuration mode.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      index:&n;**          Index of configuration register to write&n;**       &n;**      data:&n;**          Data to be written&n;**&n;**  RETURN VALUE:&n;**&n;**      None&n;**&n;**  SIDE EFFECTS:&n;**&n;**      None&n;**&n;**--&n;*/
DECL|function|SMC37c669_write_config
r_static
r_void
id|__init
id|SMC37c669_write_config
c_func
(paren
r_int
r_char
id|index
comma
r_int
r_char
id|data
)paren
(brace
id|wb
c_func
(paren
op_amp
id|SMC37c669-&gt;index_port
comma
id|index
)paren
suffix:semicolon
id|wb
c_func
(paren
op_amp
id|SMC37c669-&gt;data_port
comma
id|data
)paren
suffix:semicolon
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function initializes the local device&n;**&t;configuration storage.  This function assumes&n;**&t;that the device is already in configuration&n;**&t;mode.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      None&n;**&n;**  RETURN VALUE:&n;**&n;**      None&n;**&n;**  SIDE EFFECTS:&n;**&n;**      Local storage for device configuration information&n;**&t;is initialized.&n;**&n;**--&n;*/
DECL|function|SMC37c669_init_local_config
r_static
r_void
id|__init
id|SMC37c669_init_local_config
(paren
r_void
)paren
(brace
id|SMC37c669_SERIAL_BASE_ADDRESS_REGISTER
id|uart_base
suffix:semicolon
id|SMC37c669_SERIAL_IRQ_REGISTER
id|uart_irqs
suffix:semicolon
id|SMC37c669_PARALLEL_BASE_ADDRESS_REGISTER
id|ppt_base
suffix:semicolon
id|SMC37c669_PARALLEL_FDC_IRQ_REGISTER
id|ppt_fdc_irqs
suffix:semicolon
id|SMC37c669_PARALLEL_FDC_DRQ_REGISTER
id|ppt_fdc_drqs
suffix:semicolon
id|SMC37c669_FDC_BASE_ADDRESS_REGISTER
id|fdc_base
suffix:semicolon
id|SMC37c669_IDE_ADDRESS_REGISTER
id|ide_base
suffix:semicolon
id|SMC37c669_IDE_ADDRESS_REGISTER
id|ide_alt
suffix:semicolon
multiline_comment|/*&n;** Get serial port 1 base address &n;*/
id|uart_base.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_SERIAL0_BASE_ADDRESS_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;** Get IRQs for serial ports 1 &amp; 2&n;*/
id|uart_irqs.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_SERIAL_IRQ_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;** Store local configuration information for serial port 1&n;*/
id|local_config
(braket
id|SERIAL_0
)braket
dot
id|port1
op_assign
id|uart_base.by_field.addr9_3
op_lshift
l_int|3
suffix:semicolon
id|local_config
(braket
id|SERIAL_0
)braket
dot
id|irq
op_assign
id|SMC37c669_xlate_irq
c_func
(paren
id|SMC37c669_DEVICE_IRQ
c_func
(paren
id|uart_irqs.by_field.uart1_irq
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;** Get serial port 2 base address&n;*/
id|uart_base.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_SERIAL1_BASE_ADDRESS_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;** Store local configuration information for serial port 2&n;*/
id|local_config
(braket
id|SERIAL_1
)braket
dot
id|port1
op_assign
id|uart_base.by_field.addr9_3
op_lshift
l_int|3
suffix:semicolon
id|local_config
(braket
id|SERIAL_1
)braket
dot
id|irq
op_assign
id|SMC37c669_xlate_irq
c_func
(paren
id|SMC37c669_DEVICE_IRQ
c_func
(paren
id|uart_irqs.by_field.uart2_irq
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;** Get parallel port base address&n;*/
id|ppt_base.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL0_BASE_ADDRESS_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;** Get IRQs for parallel port and floppy controller&n;*/
id|ppt_fdc_irqs.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_IRQ_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;** Get DRQs for parallel port and floppy controller&n;*/
id|ppt_fdc_drqs.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_PARALLEL_FDC_DRQ_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;** Store local configuration information for parallel port&n;*/
id|local_config
(braket
id|PARALLEL_0
)braket
dot
id|port1
op_assign
id|ppt_base.by_field.addr9_2
op_lshift
l_int|2
suffix:semicolon
id|local_config
(braket
id|PARALLEL_0
)braket
dot
id|irq
op_assign
id|SMC37c669_xlate_irq
c_func
(paren
id|SMC37c669_DEVICE_IRQ
c_func
(paren
id|ppt_fdc_irqs.by_field.ppt_irq
)paren
)paren
suffix:semicolon
id|local_config
(braket
id|PARALLEL_0
)braket
dot
id|drq
op_assign
id|SMC37c669_xlate_drq
c_func
(paren
id|SMC37c669_DEVICE_DRQ
c_func
(paren
id|ppt_fdc_drqs.by_field.ppt_drq
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;** Get floppy controller base address&n;*/
id|fdc_base.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_FDC_BASE_ADDRESS_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;** Store local configuration information for floppy controller&n;*/
id|local_config
(braket
id|FLOPPY_0
)braket
dot
id|port1
op_assign
id|fdc_base.by_field.addr9_4
op_lshift
l_int|4
suffix:semicolon
id|local_config
(braket
id|FLOPPY_0
)braket
dot
id|irq
op_assign
id|SMC37c669_xlate_irq
c_func
(paren
id|SMC37c669_DEVICE_IRQ
c_func
(paren
id|ppt_fdc_irqs.by_field.fdc_irq
)paren
)paren
suffix:semicolon
id|local_config
(braket
id|FLOPPY_0
)braket
dot
id|drq
op_assign
id|SMC37c669_xlate_drq
c_func
(paren
id|SMC37c669_DEVICE_DRQ
c_func
(paren
id|ppt_fdc_drqs.by_field.fdc_drq
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;** Get IDE controller base address&n;*/
id|ide_base.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_IDE_BASE_ADDRESS_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;** Get IDE alternate status base address&n;*/
id|ide_alt.as_uchar
op_assign
id|SMC37c669_read_config
c_func
(paren
id|SMC37c669_IDE_ALTERNATE_ADDRESS_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;** Store local configuration information for IDE controller&n;*/
id|local_config
(braket
id|IDE_0
)braket
dot
id|port1
op_assign
id|ide_base.by_field.addr9_4
op_lshift
l_int|4
suffix:semicolon
id|local_config
(braket
id|IDE_0
)braket
dot
id|port2
op_assign
id|ide_alt.by_field.addr9_4
op_lshift
l_int|4
suffix:semicolon
id|local_config
(braket
id|IDE_0
)braket
dot
id|irq
op_assign
l_int|14
suffix:semicolon
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function returns a pointer to the local shadow&n;**&t;configuration of the requested device function.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      func:&n;**          Which device function&n;**&n;**  RETURN VALUE:&n;**&n;**      Returns a pointer to the DEVICE_CONFIG structure for the&n;**&t;requested function, otherwise, NULL.&n;**&n;**  SIDE EFFECTS:&n;**&n;**      {@description or none@}&n;**&n;**--&n;*/
DECL|function|SMC37c669_get_config
r_static
r_struct
id|DEVICE_CONFIG
op_star
id|__init
id|SMC37c669_get_config
c_func
(paren
r_int
r_int
id|func
)paren
(brace
r_struct
id|DEVICE_CONFIG
op_star
id|cp
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|func
)paren
(brace
r_case
id|SERIAL_0
suffix:colon
id|cp
op_assign
op_amp
id|local_config
(braket
id|SERIAL_0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SERIAL_1
suffix:colon
id|cp
op_assign
op_amp
id|local_config
(braket
id|SERIAL_1
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PARALLEL_0
suffix:colon
id|cp
op_assign
op_amp
id|local_config
(braket
id|PARALLEL_0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FLOPPY_0
suffix:colon
id|cp
op_assign
op_amp
id|local_config
(braket
id|FLOPPY_0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IDE_0
suffix:colon
id|cp
op_assign
op_amp
id|local_config
(braket
id|IDE_0
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|cp
suffix:semicolon
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function translates IRQs back and forth between ISA&n;**&t;IRQs and SMC37c669 device IRQs.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      irq:&n;**          The IRQ to translate&n;**&n;**  RETURN VALUE:&n;**&n;**      Returns the translated IRQ, otherwise, returns -1.&n;**&n;**  SIDE EFFECTS:&n;**&n;**      {@description or none@}&n;**&n;**--&n;*/
DECL|function|SMC37c669_xlate_irq
r_static
r_int
id|__init
id|SMC37c669_xlate_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
id|i
comma
id|translated_irq
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|SMC37c669_IS_DEVICE_IRQ
c_func
(paren
id|irq
)paren
)paren
(brace
multiline_comment|/*&n;** We are translating a device IRQ to an ISA IRQ&n;*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|SMC37c669_irq_table
(braket
id|i
)braket
dot
id|device_irq
op_ne
op_minus
l_int|1
)paren
op_logical_or
(paren
id|SMC37c669_irq_table
(braket
id|i
)braket
dot
id|isa_irq
op_ne
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|irq
op_eq
id|SMC37c669_irq_table
(braket
id|i
)braket
dot
id|device_irq
)paren
(brace
id|translated_irq
op_assign
id|SMC37c669_irq_table
(braket
id|i
)braket
dot
id|isa_irq
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/*&n;** We are translating an ISA IRQ to a device IRQ&n;*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|SMC37c669_irq_table
(braket
id|i
)braket
dot
id|isa_irq
op_ne
op_minus
l_int|1
)paren
op_logical_or
(paren
id|SMC37c669_irq_table
(braket
id|i
)braket
dot
id|device_irq
op_ne
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|irq
op_eq
id|SMC37c669_irq_table
(braket
id|i
)braket
dot
id|isa_irq
)paren
(brace
id|translated_irq
op_assign
id|SMC37c669_irq_table
(braket
id|i
)braket
dot
id|device_irq
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_return
id|translated_irq
suffix:semicolon
)brace
"&f;"
multiline_comment|/*&n;**++&n;**  FUNCTIONAL DESCRIPTION:&n;**&n;**      This function translates DMA channels back and forth between&n;**&t;ISA DMA channels and SMC37c669 device DMA channels.&n;**&n;**  FORMAL PARAMETERS:&n;**&n;**      drq:&n;**          The DMA channel to translate&n;**&n;**  RETURN VALUE:&n;**&n;**      Returns the translated DMA channel, otherwise, returns -1&n;**&n;**  SIDE EFFECTS:&n;**&n;**      {@description or none@}&n;**&n;**--&n;*/
DECL|function|SMC37c669_xlate_drq
r_static
r_int
id|__init
id|SMC37c669_xlate_drq
(paren
r_int
r_int
id|drq
)paren
(brace
r_int
id|i
comma
id|translated_drq
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|SMC37c669_IS_DEVICE_DRQ
c_func
(paren
id|drq
)paren
)paren
(brace
multiline_comment|/*&n;** We are translating a device DMA channel to an ISA DMA channel&n;*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|SMC37c669_drq_table
(braket
id|i
)braket
dot
id|device_drq
op_ne
op_minus
l_int|1
)paren
op_logical_or
(paren
id|SMC37c669_drq_table
(braket
id|i
)braket
dot
id|isa_drq
op_ne
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|drq
op_eq
id|SMC37c669_drq_table
(braket
id|i
)braket
dot
id|device_drq
)paren
(brace
id|translated_drq
op_assign
id|SMC37c669_drq_table
(braket
id|i
)braket
dot
id|isa_drq
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
multiline_comment|/*&n;** We are translating an ISA DMA channel to a device DMA channel&n;*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|SMC37c669_drq_table
(braket
id|i
)braket
dot
id|isa_drq
op_ne
op_minus
l_int|1
)paren
op_logical_or
(paren
id|SMC37c669_drq_table
(braket
id|i
)braket
dot
id|device_drq
op_ne
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|drq
op_eq
id|SMC37c669_drq_table
(braket
id|i
)braket
dot
id|isa_drq
)paren
(brace
id|translated_drq
op_assign
id|SMC37c669_drq_table
(braket
id|i
)braket
dot
id|device_drq
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_return
id|translated_drq
suffix:semicolon
)brace
"&f;"
macro_line|#if 0
r_int
id|__init
id|smcc669_init
(paren
r_void
)paren
(brace
r_struct
id|INODE
op_star
id|ip
suffix:semicolon
id|allocinode
c_func
(paren
id|smc_ddb.name
comma
l_int|1
comma
op_amp
id|ip
)paren
suffix:semicolon
id|ip-&gt;dva
op_assign
op_amp
id|smc_ddb
suffix:semicolon
id|ip-&gt;attr
op_assign
id|ATTR
"$"
id|M_WRITE
op_or
id|ATTR
"$"
id|M_READ
suffix:semicolon
id|ip-&gt;len
(braket
l_int|0
)braket
op_assign
l_int|0x30
suffix:semicolon
id|ip-&gt;misc
op_assign
l_int|0
suffix:semicolon
id|INODE_UNLOCK
c_func
(paren
id|ip
)paren
suffix:semicolon
r_return
id|msg_success
suffix:semicolon
)brace
"&f;"
r_int
id|__init
id|smcc669_open
c_func
(paren
r_struct
id|FILE
op_star
id|fp
comma
r_char
op_star
id|info
comma
r_char
op_star
id|next
comma
r_char
op_star
id|mode
)paren
(brace
r_struct
id|INODE
op_star
id|ip
suffix:semicolon
multiline_comment|/*&n;** Allow multiple readers but only one writer.  ip-&gt;misc keeps track&n;** of the number of writers&n;*/
id|ip
op_assign
id|fp-&gt;ip
suffix:semicolon
id|INODE_LOCK
c_func
(paren
id|ip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fp-&gt;mode
op_amp
id|ATTR
"$"
id|M_WRITE
)paren
(brace
r_if
c_cond
(paren
id|ip-&gt;misc
)paren
(brace
id|INODE_UNLOCK
c_func
(paren
id|ip
)paren
suffix:semicolon
r_return
id|msg_failure
suffix:semicolon
multiline_comment|/* too many writers */
)brace
id|ip-&gt;misc
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n;** Treat the information field as a byte offset&n;*/
op_star
id|fp-&gt;offset
op_assign
id|xtoi
c_func
(paren
id|info
)paren
suffix:semicolon
id|INODE_UNLOCK
c_func
(paren
id|ip
)paren
suffix:semicolon
r_return
id|msg_success
suffix:semicolon
)brace
"&f;"
r_int
id|__init
id|smcc669_close
c_func
(paren
r_struct
id|FILE
op_star
id|fp
)paren
(brace
r_struct
id|INODE
op_star
id|ip
suffix:semicolon
id|ip
op_assign
id|fp-&gt;ip
suffix:semicolon
r_if
c_cond
(paren
id|fp-&gt;mode
op_amp
id|ATTR
"$"
id|M_WRITE
)paren
(brace
id|INODE_LOCK
c_func
(paren
id|ip
)paren
suffix:semicolon
id|ip-&gt;misc
op_decrement
suffix:semicolon
id|INODE_UNLOCK
c_func
(paren
id|ip
)paren
suffix:semicolon
)brace
r_return
id|msg_success
suffix:semicolon
)brace
"&f;"
r_int
id|__init
id|smcc669_read
c_func
(paren
r_struct
id|FILE
op_star
id|fp
comma
r_int
id|size
comma
r_int
id|number
comma
r_int
r_char
op_star
id|buf
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|length
suffix:semicolon
r_int
id|nbytes
suffix:semicolon
r_struct
id|INODE
op_star
id|ip
suffix:semicolon
multiline_comment|/*&n;** Always access a byte at a time&n;*/
id|ip
op_assign
id|fp-&gt;ip
suffix:semicolon
id|length
op_assign
id|size
op_star
id|number
suffix:semicolon
id|nbytes
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_config_mode
c_func
(paren
id|TRUE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|length
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|inrange
c_func
(paren
op_star
id|fp-&gt;offset
comma
l_int|0
comma
id|ip-&gt;len
(braket
l_int|0
)braket
)paren
)paren
r_break
suffix:semicolon
op_star
id|buf
op_increment
op_assign
id|SMC37c669_read_config
c_func
(paren
op_star
id|fp-&gt;offset
)paren
suffix:semicolon
op_star
id|fp-&gt;offset
op_add_assign
l_int|1
suffix:semicolon
id|nbytes
op_increment
suffix:semicolon
)brace
id|SMC37c669_config_mode
c_func
(paren
id|FALSE
)paren
suffix:semicolon
r_return
id|nbytes
suffix:semicolon
)brace
"&f;"
r_int
id|__init
id|smcc669_write
c_func
(paren
r_struct
id|FILE
op_star
id|fp
comma
r_int
id|size
comma
r_int
id|number
comma
r_int
r_char
op_star
id|buf
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|length
suffix:semicolon
r_int
id|nbytes
suffix:semicolon
r_struct
id|INODE
op_star
id|ip
suffix:semicolon
multiline_comment|/*&n;** Always access a byte at a time&n;*/
id|ip
op_assign
id|fp-&gt;ip
suffix:semicolon
id|length
op_assign
id|size
op_star
id|number
suffix:semicolon
id|nbytes
op_assign
l_int|0
suffix:semicolon
id|SMC37c669_config_mode
c_func
(paren
id|TRUE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|length
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|inrange
c_func
(paren
op_star
id|fp-&gt;offset
comma
l_int|0
comma
id|ip-&gt;len
(braket
l_int|0
)braket
)paren
)paren
r_break
suffix:semicolon
id|SMC37c669_write_config
c_func
(paren
op_star
id|fp-&gt;offset
comma
op_star
id|buf
)paren
suffix:semicolon
op_star
id|fp-&gt;offset
op_add_assign
l_int|1
suffix:semicolon
id|buf
op_increment
suffix:semicolon
id|nbytes
op_increment
suffix:semicolon
)brace
id|SMC37c669_config_mode
c_func
(paren
id|FALSE
)paren
suffix:semicolon
r_return
id|nbytes
suffix:semicolon
)brace
macro_line|#endif
r_void
id|__init
DECL|function|SMC37c669_dump_registers
id|SMC37c669_dump_registers
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x29
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;-- CR%02x : %02x&bslash;n&quot;
comma
id|i
comma
id|SMC37c669_read_config
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*+&n; * ============================================================================&n; * = SMC_init - SMC37c669 Super I/O controller initialization                 =&n; * ============================================================================&n; *&n; * OVERVIEW:&n; *&n; *      This routine configures and enables device functions on the&n; *      SMC37c669 Super I/O controller.&n; *&n; * FORM OF CALL:&n; *&n; *      SMC_init( );&n; *&n; * RETURNS:&n; *&n; *      Nothing&n; *&n; * ARGUMENTS:&n; *&n; *      None&n; *&n; * SIDE EFFECTS:&n; *&n; *      None&n; *&n; */
DECL|function|SMC669_Init
r_void
id|__init
id|SMC669_Init
(paren
r_int
id|index
)paren
(brace
id|SMC37c669_CONFIG_REGS
op_star
id|SMC_base
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|__save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|SMC_base
op_assign
id|SMC37c669_detect
c_func
(paren
id|index
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
macro_line|#if SMC_DEBUG
id|SMC37c669_config_mode
c_func
(paren
id|TRUE
)paren
suffix:semicolon
id|SMC37c669_dump_registers
c_func
(paren
)paren
suffix:semicolon
id|SMC37c669_config_mode
c_func
(paren
id|FALSE
)paren
suffix:semicolon
id|SMC37c669_display_device_info
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|SMC37c669_disable_device
c_func
(paren
id|SERIAL_0
)paren
suffix:semicolon
id|SMC37c669_configure_device
c_func
(paren
id|SERIAL_0
comma
id|COM1_BASE
comma
id|COM1_IRQ
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|SMC37c669_enable_device
c_func
(paren
id|SERIAL_0
)paren
suffix:semicolon
id|SMC37c669_disable_device
c_func
(paren
id|SERIAL_1
)paren
suffix:semicolon
id|SMC37c669_configure_device
c_func
(paren
id|SERIAL_1
comma
id|COM2_BASE
comma
id|COM2_IRQ
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|SMC37c669_enable_device
c_func
(paren
id|SERIAL_1
)paren
suffix:semicolon
id|SMC37c669_disable_device
c_func
(paren
id|PARALLEL_0
)paren
suffix:semicolon
id|SMC37c669_configure_device
c_func
(paren
id|PARALLEL_0
comma
id|PARP_BASE
comma
id|PARP_IRQ
comma
id|PARP_DRQ
)paren
suffix:semicolon
id|SMC37c669_enable_device
c_func
(paren
id|PARALLEL_0
)paren
suffix:semicolon
id|SMC37c669_disable_device
c_func
(paren
id|FLOPPY_0
)paren
suffix:semicolon
id|SMC37c669_configure_device
c_func
(paren
id|FLOPPY_0
comma
id|FDC_BASE
comma
id|FDC_IRQ
comma
id|FDC_DRQ
)paren
suffix:semicolon
id|SMC37c669_enable_device
c_func
(paren
id|FLOPPY_0
)paren
suffix:semicolon
multiline_comment|/* Wake up sometimes forgotten floppy, especially on DP264. */
id|outb
c_func
(paren
l_int|0xc
comma
l_int|0x3f2
)paren
suffix:semicolon
id|SMC37c669_disable_device
c_func
(paren
id|IDE_0
)paren
suffix:semicolon
macro_line|#if SMC_DEBUG
id|SMC37c669_config_mode
c_func
(paren
id|TRUE
)paren
suffix:semicolon
id|SMC37c669_dump_registers
c_func
(paren
)paren
suffix:semicolon
id|SMC37c669_config_mode
c_func
(paren
id|FALSE
)paren
suffix:semicolon
id|SMC37c669_display_device_info
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SMC37c669 Super I/O Controller found @ 0x%lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|SMC_base
)paren
suffix:semicolon
)brace
r_else
(brace
id|__restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#if SMC_DEBUG
id|printk
c_func
(paren
l_string|&quot;No SMC37c669 Super I/O Controller found&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
eof
