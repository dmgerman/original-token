multiline_comment|/*&n; *&t;linux/arch/alpha/kernel/es1888.c&n; *&n; * Init the built-in ES1888 sound chip (SB16 compatible)&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;proto.h&quot;
r_void
id|__init
DECL|function|es1888_init
id|es1888_init
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Sequence of IO reads to init the audio controller */
id|inb
c_func
(paren
l_int|0x0229
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x0229
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x0229
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x022b
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x0229
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x022b
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x0229
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x0229
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x022b
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x0229
)paren
suffix:semicolon
id|inb
c_func
(paren
l_int|0x0220
)paren
suffix:semicolon
multiline_comment|/* This sets the base address to 0x220 */
multiline_comment|/* Sequence to set DMA channels */
id|outb
c_func
(paren
l_int|0x01
comma
l_int|0x0226
)paren
suffix:semicolon
multiline_comment|/* reset */
id|inb
c_func
(paren
l_int|0x0226
)paren
suffix:semicolon
multiline_comment|/* pause */
id|outb
c_func
(paren
l_int|0x00
comma
l_int|0x0226
)paren
suffix:semicolon
multiline_comment|/* release reset */
r_while
c_loop
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
l_int|0x022e
)paren
op_amp
l_int|0x80
)paren
)paren
multiline_comment|/* wait for bit 7 to assert*/
r_continue
suffix:semicolon
id|inb
c_func
(paren
l_int|0x022a
)paren
suffix:semicolon
multiline_comment|/* pause */
id|outb
c_func
(paren
l_int|0xc6
comma
l_int|0x022c
)paren
suffix:semicolon
multiline_comment|/* enable extended mode */
id|inb
c_func
(paren
l_int|0x022a
)paren
suffix:semicolon
multiline_comment|/* pause, also forces the write */
r_while
c_loop
(paren
id|inb
c_func
(paren
l_int|0x022c
)paren
op_amp
l_int|0x80
)paren
multiline_comment|/* wait for bit 7 to deassert */
r_continue
suffix:semicolon
id|outb
c_func
(paren
l_int|0xb1
comma
l_int|0x022c
)paren
suffix:semicolon
multiline_comment|/* setup for write to Interrupt CR */
r_while
c_loop
(paren
id|inb
c_func
(paren
l_int|0x022c
)paren
op_amp
l_int|0x80
)paren
multiline_comment|/* wait for bit 7 to deassert */
r_continue
suffix:semicolon
id|outb
c_func
(paren
l_int|0x14
comma
l_int|0x022c
)paren
suffix:semicolon
multiline_comment|/* set IRQ 5 */
r_while
c_loop
(paren
id|inb
c_func
(paren
l_int|0x022c
)paren
op_amp
l_int|0x80
)paren
multiline_comment|/* wait for bit 7 to deassert */
r_continue
suffix:semicolon
id|outb
c_func
(paren
l_int|0xb2
comma
l_int|0x022c
)paren
suffix:semicolon
multiline_comment|/* setup for write to DMA CR */
r_while
c_loop
(paren
id|inb
c_func
(paren
l_int|0x022c
)paren
op_amp
l_int|0x80
)paren
multiline_comment|/* wait for bit 7 to deassert */
r_continue
suffix:semicolon
id|outb
c_func
(paren
l_int|0x18
comma
l_int|0x022c
)paren
suffix:semicolon
multiline_comment|/* set DMA channel 1 */
id|inb
c_func
(paren
l_int|0x022c
)paren
suffix:semicolon
multiline_comment|/* force the write */
)brace
eof
