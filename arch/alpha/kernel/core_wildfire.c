multiline_comment|/*&n; *  linux/arch/alpha/kernel/core_wildfire.c&n; *&n; *  Wildfire support.&n; *&n; *  Copyright (C) 2000 Andrea Arcangeli &lt;andrea@suse.de&gt; SuSE&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
DECL|macro|__EXTERN_INLINE
mdefine_line|#define __EXTERN_INLINE inline
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/core_wildfire.h&gt;
DECL|macro|__EXTERN_INLINE
macro_line|#undef __EXTERN_INLINE
macro_line|#include &quot;proto.h&quot;
macro_line|#include &quot;pci_impl.h&quot;
DECL|macro|DEBUG_MCHECK
mdefine_line|#define DEBUG_MCHECK 0&t;&t;/* 0 = minimal, 1 = debug, 2 = debug+dump.  */
DECL|macro|DEBUG_CONFIG
mdefine_line|#define DEBUG_CONFIG 0
DECL|macro|DEBUG_DUMP_REGS
mdefine_line|#define DEBUG_DUMP_REGS 0
DECL|macro|DEBUG_DUMP_CONFIG
mdefine_line|#define DEBUG_DUMP_CONFIG 1
macro_line|#if DEBUG_CONFIG
DECL|macro|DBG_CFG
macro_line|# define DBG_CFG(args)&t;printk args
macro_line|#else
DECL|macro|DBG_CFG
macro_line|# define DBG_CFG(args)
macro_line|#endif
macro_line|#if DEBUG_DUMP_REGS
r_static
r_void
id|wildfire_dump_pci_regs
c_func
(paren
r_int
id|qbbno
comma
r_int
id|hoseno
)paren
suffix:semicolon
r_static
r_void
id|wildfire_dump_pca_regs
c_func
(paren
r_int
id|qbbno
comma
r_int
id|pcano
)paren
suffix:semicolon
r_static
r_void
id|wildfire_dump_qsa_regs
c_func
(paren
r_int
id|qbbno
)paren
suffix:semicolon
r_static
r_void
id|wildfire_dump_qsd_regs
c_func
(paren
r_int
id|qbbno
)paren
suffix:semicolon
r_static
r_void
id|wildfire_dump_iop_regs
c_func
(paren
r_int
id|qbbno
)paren
suffix:semicolon
r_static
r_void
id|wildfire_dump_gp_regs
c_func
(paren
r_int
id|qbbno
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if DEBUG_DUMP_CONFIG
r_static
r_void
id|wildfire_dump_hardware_config
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|wildfire_hard_qbb_map
r_int
r_char
id|wildfire_hard_qbb_map
(braket
id|WILDFIRE_MAX_QBB
)braket
suffix:semicolon
DECL|variable|wildfire_soft_qbb_map
r_int
r_char
id|wildfire_soft_qbb_map
(braket
id|WILDFIRE_MAX_QBB
)braket
suffix:semicolon
DECL|macro|QBB_MAP_EMPTY
mdefine_line|#define QBB_MAP_EMPTY&t;0xff
DECL|variable|wildfire_hard_qbb_mask
r_int
r_int
id|wildfire_hard_qbb_mask
suffix:semicolon
DECL|variable|wildfire_soft_qbb_mask
r_int
r_int
id|wildfire_soft_qbb_mask
suffix:semicolon
DECL|variable|wildfire_gp_mask
r_int
r_int
id|wildfire_gp_mask
suffix:semicolon
DECL|variable|wildfire_hs_mask
r_int
r_int
id|wildfire_hs_mask
suffix:semicolon
DECL|variable|wildfire_iop_mask
r_int
r_int
id|wildfire_iop_mask
suffix:semicolon
DECL|variable|wildfire_ior_mask
r_int
r_int
id|wildfire_ior_mask
suffix:semicolon
DECL|variable|wildfire_pca_mask
r_int
r_int
id|wildfire_pca_mask
suffix:semicolon
DECL|variable|wildfire_cpu_mask
r_int
r_int
id|wildfire_cpu_mask
suffix:semicolon
DECL|variable|wildfire_mem_mask
r_int
r_int
id|wildfire_mem_mask
suffix:semicolon
r_void
id|__init
DECL|function|wildfire_init_hose
id|wildfire_init_hose
c_func
(paren
r_int
id|qbbno
comma
r_int
id|hoseno
)paren
(brace
r_struct
id|pci_controler
op_star
id|hose
suffix:semicolon
id|wildfire_pci
op_star
id|pci
suffix:semicolon
id|hose
op_assign
id|alloc_pci_controler
c_func
(paren
)paren
suffix:semicolon
id|hose-&gt;io_space
op_assign
id|alloc_resource
c_func
(paren
)paren
suffix:semicolon
id|hose-&gt;mem_space
op_assign
id|alloc_resource
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* This is for userland consumption. */
id|hose-&gt;sparse_mem_base
op_assign
l_int|0
suffix:semicolon
id|hose-&gt;sparse_io_base
op_assign
l_int|0
suffix:semicolon
id|hose-&gt;dense_mem_base
op_assign
id|WILDFIRE_MEM
c_func
(paren
id|qbbno
comma
id|hoseno
)paren
suffix:semicolon
id|hose-&gt;dense_io_base
op_assign
id|WILDFIRE_IO
c_func
(paren
id|qbbno
comma
id|hoseno
)paren
suffix:semicolon
id|hose-&gt;config_space_base
op_assign
id|WILDFIRE_CONF
c_func
(paren
id|qbbno
comma
id|hoseno
)paren
suffix:semicolon
id|hose-&gt;index
op_assign
(paren
id|qbbno
op_lshift
l_int|3
)paren
op_plus
id|hoseno
suffix:semicolon
id|hose-&gt;io_space-&gt;start
op_assign
id|WILDFIRE_IO
c_func
(paren
id|qbbno
comma
id|hoseno
)paren
op_minus
id|WILDFIRE_IO_BIAS
suffix:semicolon
id|hose-&gt;io_space-&gt;end
op_assign
id|hose-&gt;io_space-&gt;start
op_plus
id|WILDFIRE_IO_SPACE
op_minus
l_int|1
suffix:semicolon
id|hose-&gt;io_space-&gt;name
op_assign
id|pci_io_names
(braket
id|hoseno
)braket
suffix:semicolon
id|hose-&gt;io_space-&gt;flags
op_assign
id|IORESOURCE_IO
suffix:semicolon
id|hose-&gt;mem_space-&gt;start
op_assign
id|WILDFIRE_MEM
c_func
(paren
id|qbbno
comma
id|hoseno
)paren
op_minus
id|WILDFIRE_MEM_BIAS
suffix:semicolon
id|hose-&gt;mem_space-&gt;end
op_assign
id|hose-&gt;mem_space-&gt;start
op_plus
l_int|0xffffffff
suffix:semicolon
id|hose-&gt;mem_space-&gt;name
op_assign
id|pci_mem_names
(braket
id|hoseno
)braket
suffix:semicolon
id|hose-&gt;mem_space-&gt;flags
op_assign
id|IORESOURCE_MEM
suffix:semicolon
r_if
c_cond
(paren
id|request_resource
c_func
(paren
op_amp
id|ioport_resource
comma
id|hose-&gt;io_space
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Failed to request IO on qbb %d hose %d&bslash;n&quot;
comma
id|qbbno
comma
id|hoseno
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_resource
c_func
(paren
op_amp
id|iomem_resource
comma
id|hose-&gt;mem_space
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Failed to request MEM on qbb %d hose %d&bslash;n&quot;
comma
id|qbbno
comma
id|hoseno
)paren
suffix:semicolon
macro_line|#if DEBUG_DUMP_REGS
id|wildfire_dump_pci_regs
c_func
(paren
id|qbbno
comma
id|hoseno
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;         * Set up the PCI to main memory translation windows.&n;         *&n;         * Note: Window 3 is scatter-gather only&n;         * &n;         * Window 0 is scatter-gather 8MB at 8MB (for isa)&n;&t; * Window 1 is direct access 1GB at 1GB&n;&t; * Window 2 is direct access 1GB at 2GB&n;         * Window 3 is scatter-gather 128MB at 3GB&n;         * ??? We ought to scale window 3 memory.&n;         *&n;         */
id|hose-&gt;sg_isa
op_assign
id|iommu_arena_new
c_func
(paren
id|hose
comma
l_int|0x00800000
comma
l_int|0x00800000
comma
l_int|0
)paren
suffix:semicolon
id|hose-&gt;sg_pci
op_assign
id|iommu_arena_new
c_func
(paren
id|hose
comma
l_int|0xc0000000
comma
l_int|0x08000000
comma
l_int|0
)paren
suffix:semicolon
id|pci
op_assign
id|WILDFIRE_pci
c_func
(paren
id|qbbno
comma
id|hoseno
)paren
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|0
)braket
dot
id|wbase.csr
op_assign
id|hose-&gt;sg_isa-&gt;dma_base
op_or
l_int|3
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|0
)braket
dot
id|wmask.csr
op_assign
(paren
id|hose-&gt;sg_isa-&gt;size
op_minus
l_int|1
)paren
op_amp
l_int|0xfff00000
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|0
)braket
dot
id|tbase.csr
op_assign
id|virt_to_phys
c_func
(paren
id|hose-&gt;sg_isa-&gt;ptes
)paren
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|1
)braket
dot
id|wbase.csr
op_assign
l_int|0x40000000
op_or
l_int|1
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|1
)braket
dot
id|wmask.csr
op_assign
(paren
l_int|0x40000000
op_minus
l_int|1
)paren
op_amp
l_int|0xfff00000
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|1
)braket
dot
id|tbase.csr
op_assign
l_int|0
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|2
)braket
dot
id|wbase.csr
op_assign
l_int|0x80000000
op_or
l_int|1
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|2
)braket
dot
id|wmask.csr
op_assign
(paren
l_int|0x40000000
op_minus
l_int|1
)paren
op_amp
l_int|0xfff00000
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|2
)braket
dot
id|tbase.csr
op_assign
l_int|0x40000000
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|3
)braket
dot
id|wbase.csr
op_assign
id|hose-&gt;sg_pci-&gt;dma_base
op_or
l_int|3
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|3
)braket
dot
id|wmask.csr
op_assign
(paren
id|hose-&gt;sg_pci-&gt;size
op_minus
l_int|1
)paren
op_amp
l_int|0xfff00000
suffix:semicolon
id|pci-&gt;pci_window
(braket
l_int|3
)braket
dot
id|tbase.csr
op_assign
id|virt_to_phys
c_func
(paren
id|hose-&gt;sg_pci-&gt;ptes
)paren
suffix:semicolon
id|wildfire_pci_tbi
c_func
(paren
id|hose
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Flush TLB at the end. */
)brace
r_void
id|__init
DECL|function|wildfire_init_pca
id|wildfire_init_pca
c_func
(paren
r_int
id|qbbno
comma
r_int
id|pcano
)paren
(brace
multiline_comment|/* Test for PCA existence first. */
r_if
c_cond
(paren
op_logical_neg
id|WILDFIRE_PCA_EXISTS
c_func
(paren
id|qbbno
comma
id|pcano
)paren
)paren
r_return
suffix:semicolon
macro_line|#if DEBUG_DUMP_REGS
id|wildfire_dump_pca_regs
c_func
(paren
id|qbbno
comma
id|pcano
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Do both hoses of the PCA. */
id|wildfire_init_hose
c_func
(paren
id|qbbno
comma
(paren
id|pcano
op_lshift
l_int|1
)paren
op_plus
l_int|0
)paren
suffix:semicolon
id|wildfire_init_hose
c_func
(paren
id|qbbno
comma
(paren
id|pcano
op_lshift
l_int|1
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|wildfire_init_qbb
id|wildfire_init_qbb
c_func
(paren
r_int
id|qbbno
)paren
(brace
r_int
id|pcano
suffix:semicolon
multiline_comment|/* Test for QBB existence first. */
r_if
c_cond
(paren
op_logical_neg
id|WILDFIRE_QBB_EXISTS
c_func
(paren
id|qbbno
)paren
)paren
r_return
suffix:semicolon
macro_line|#if DEBUG_DUMP_REGS
id|wildfire_dump_qsa_regs
c_func
(paren
id|qbbno
)paren
suffix:semicolon
id|wildfire_dump_qsd_regs
c_func
(paren
id|qbbno
)paren
suffix:semicolon
id|wildfire_dump_iop_regs
c_func
(paren
id|qbbno
)paren
suffix:semicolon
id|wildfire_dump_gp_regs
c_func
(paren
id|qbbno
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Init all PCAs here. */
r_for
c_loop
(paren
id|pcano
op_assign
l_int|0
suffix:semicolon
id|pcano
OL
id|WILDFIRE_PCA_PER_QBB
suffix:semicolon
id|pcano
op_increment
)paren
(brace
id|wildfire_init_pca
c_func
(paren
id|qbbno
comma
id|pcano
)paren
suffix:semicolon
)brace
)brace
r_void
id|__init
DECL|function|wildfire_hardware_probe
id|wildfire_hardware_probe
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|temp
suffix:semicolon
r_int
r_int
id|hard_qbb
comma
id|soft_qbb
suffix:semicolon
id|wildfire_fast_qsd
op_star
id|fast
op_assign
id|WILDFIRE_fast_qsd
c_func
(paren
)paren
suffix:semicolon
id|wildfire_qsd
op_star
id|qsd
suffix:semicolon
id|wildfire_qsa
op_star
id|qsa
suffix:semicolon
id|wildfire_iop
op_star
id|iop
suffix:semicolon
id|wildfire_gp
op_star
id|gp
suffix:semicolon
id|wildfire_ne
op_star
id|ne
suffix:semicolon
id|wildfire_fe
op_star
id|fe
suffix:semicolon
r_int
id|i
suffix:semicolon
id|temp
op_assign
id|fast-&gt;qsd_whami.csr
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;fast QSD_WHAMI at base %p is 0x%lx&bslash;n&quot;
comma
id|fast
comma
id|temp
)paren
suffix:semicolon
macro_line|#endif
id|hard_qbb
op_assign
(paren
id|temp
op_rshift
l_int|8
)paren
op_amp
l_int|7
suffix:semicolon
id|soft_qbb
op_assign
(paren
id|temp
op_rshift
l_int|4
)paren
op_amp
l_int|7
suffix:semicolon
multiline_comment|/* Init the HW configuration variables. */
id|wildfire_hard_qbb_mask
op_assign
(paren
l_int|1
op_lshift
id|hard_qbb
)paren
suffix:semicolon
id|wildfire_soft_qbb_mask
op_assign
(paren
l_int|1
op_lshift
id|soft_qbb
)paren
suffix:semicolon
id|wildfire_gp_mask
op_assign
l_int|0
suffix:semicolon
id|wildfire_hs_mask
op_assign
l_int|0
suffix:semicolon
id|wildfire_iop_mask
op_assign
l_int|0
suffix:semicolon
id|wildfire_ior_mask
op_assign
l_int|0
suffix:semicolon
id|wildfire_pca_mask
op_assign
l_int|0
suffix:semicolon
id|wildfire_cpu_mask
op_assign
l_int|0
suffix:semicolon
id|wildfire_mem_mask
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|wildfire_hard_qbb_map
comma
id|QBB_MAP_EMPTY
comma
id|WILDFIRE_MAX_QBB
)paren
suffix:semicolon
id|memset
c_func
(paren
id|wildfire_soft_qbb_map
comma
id|QBB_MAP_EMPTY
comma
id|WILDFIRE_MAX_QBB
)paren
suffix:semicolon
multiline_comment|/* First, determine which QBBs are present. */
id|qsa
op_assign
id|WILDFIRE_qsa
c_func
(paren
id|soft_qbb
)paren
suffix:semicolon
id|temp
op_assign
id|qsa-&gt;qsa_qbb_id.csr
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;QSA_QBB_ID at base %p is 0x%lx&bslash;n&quot;
comma
id|qsa
comma
id|temp
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x40
)paren
multiline_comment|/* Is there an HS? */
id|wildfire_hs_mask
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* Is there a GP? */
id|gp
op_assign
id|WILDFIRE_gp
c_func
(paren
id|soft_qbb
)paren
suffix:semicolon
id|temp
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|temp
op_or_assign
id|gp-&gt;gpa_qbb_map
(braket
id|i
)braket
dot
id|csr
op_lshift
(paren
id|i
op_star
l_int|8
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;GPA_QBB_MAP[%d] at base %p is 0x%lx&bslash;n&quot;
comma
id|i
comma
id|gp
comma
id|temp
)paren
suffix:semicolon
macro_line|#endif
)brace
r_for
c_loop
(paren
id|hard_qbb
op_assign
l_int|0
suffix:semicolon
id|hard_qbb
OL
id|WILDFIRE_MAX_QBB
suffix:semicolon
id|hard_qbb
op_increment
)paren
(brace
r_if
c_cond
(paren
id|temp
op_amp
l_int|8
)paren
(brace
multiline_comment|/* Is there a QBB? */
id|soft_qbb
op_assign
id|temp
op_amp
l_int|7
suffix:semicolon
id|wildfire_hard_qbb_mask
op_or_assign
(paren
l_int|1
op_lshift
id|hard_qbb
)paren
suffix:semicolon
id|wildfire_soft_qbb_mask
op_or_assign
(paren
l_int|1
op_lshift
id|soft_qbb
)paren
suffix:semicolon
)brace
id|temp
op_rshift_assign
l_int|4
suffix:semicolon
)brace
id|wildfire_gp_mask
op_assign
id|wildfire_soft_qbb_mask
suffix:semicolon
)brace
multiline_comment|/* Next determine each QBBs resources. */
r_for
c_loop
(paren
id|soft_qbb
op_assign
l_int|0
suffix:semicolon
id|soft_qbb
OL
id|WILDFIRE_MAX_QBB
suffix:semicolon
id|soft_qbb
op_increment
)paren
(brace
r_if
c_cond
(paren
id|WILDFIRE_QBB_EXISTS
c_func
(paren
id|soft_qbb
)paren
)paren
(brace
id|qsd
op_assign
id|WILDFIRE_qsd
c_func
(paren
id|soft_qbb
)paren
suffix:semicolon
id|temp
op_assign
id|qsd-&gt;qsd_whami.csr
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;QSD_WHAMI at base %p is 0x%lx&bslash;n&quot;
comma
id|qsd
comma
id|temp
)paren
suffix:semicolon
macro_line|#endif
id|hard_qbb
op_assign
(paren
id|temp
op_rshift
l_int|8
)paren
op_amp
l_int|7
suffix:semicolon
id|wildfire_hard_qbb_map
(braket
id|hard_qbb
)braket
op_assign
id|soft_qbb
suffix:semicolon
id|wildfire_soft_qbb_map
(braket
id|soft_qbb
)braket
op_assign
id|hard_qbb
suffix:semicolon
id|qsa
op_assign
id|WILDFIRE_qsa
c_func
(paren
id|soft_qbb
)paren
suffix:semicolon
id|temp
op_assign
id|qsa-&gt;qsa_qbb_pop
(braket
l_int|0
)braket
dot
id|csr
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;QSA_QBB_POP_0 at base %p is 0x%lx&bslash;n&quot;
comma
id|qsa
comma
id|temp
)paren
suffix:semicolon
macro_line|#endif
id|wildfire_cpu_mask
op_or_assign
(paren
(paren
id|temp
op_rshift
l_int|0
)paren
op_amp
l_int|0xf
)paren
op_lshift
(paren
id|soft_qbb
op_lshift
l_int|2
)paren
suffix:semicolon
id|wildfire_mem_mask
op_or_assign
(paren
(paren
id|temp
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)paren
op_lshift
(paren
id|soft_qbb
op_lshift
l_int|2
)paren
suffix:semicolon
id|temp
op_assign
id|qsa-&gt;qsa_qbb_pop
(braket
l_int|1
)braket
dot
id|csr
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;QSA_QBB_POP_1 at base %p is 0x%lx&bslash;n&quot;
comma
id|qsa
comma
id|temp
)paren
suffix:semicolon
macro_line|#endif
id|wildfire_iop_mask
op_or_assign
(paren
l_int|1
op_lshift
id|soft_qbb
)paren
suffix:semicolon
id|wildfire_ior_mask
op_or_assign
(paren
(paren
id|temp
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)paren
op_lshift
(paren
id|soft_qbb
op_lshift
l_int|2
)paren
suffix:semicolon
id|temp
op_assign
id|qsa-&gt;qsa_qbb_id.csr
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;QSA_QBB_ID at %p is 0x%lx&bslash;n&quot;
comma
id|qsa
comma
id|temp
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x20
)paren
id|wildfire_gp_mask
op_or_assign
(paren
l_int|1
op_lshift
id|soft_qbb
)paren
suffix:semicolon
multiline_comment|/* Probe for PCA existence here. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WILDFIRE_PCA_PER_QBB
suffix:semicolon
id|i
op_increment
)paren
(brace
id|iop
op_assign
id|WILDFIRE_iop
c_func
(paren
id|soft_qbb
)paren
suffix:semicolon
id|ne
op_assign
id|WILDFIRE_ne
c_func
(paren
id|soft_qbb
comma
id|i
)paren
suffix:semicolon
id|fe
op_assign
id|WILDFIRE_fe
c_func
(paren
id|soft_qbb
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|iop-&gt;iop_hose
(braket
id|i
)braket
dot
id|init.csr
op_amp
l_int|1
)paren
op_eq
l_int|1
op_logical_and
(paren
(paren
id|ne-&gt;ne_what_am_i.csr
op_amp
l_int|0xf00000300
)paren
op_eq
l_int|0x100000300
)paren
op_logical_and
(paren
(paren
id|fe-&gt;fe_what_am_i.csr
op_amp
l_int|0xf00000300
)paren
op_eq
l_int|0x100000200
)paren
)paren
(brace
id|wildfire_pca_mask
op_or_assign
l_int|1
op_lshift
(paren
(paren
id|soft_qbb
op_lshift
l_int|2
)paren
op_plus
id|i
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
macro_line|#if DEBUG_DUMP_CONFIG
id|wildfire_dump_hardware_config
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
r_void
id|__init
DECL|function|wildfire_init_arch
id|wildfire_init_arch
c_func
(paren
r_void
)paren
(brace
r_int
id|qbbno
suffix:semicolon
multiline_comment|/* With multiple PCI buses, we play with I/O as physical addrs.  */
id|ioport_resource.end
op_assign
op_complement
l_int|0UL
suffix:semicolon
id|iomem_resource.end
op_assign
op_complement
l_int|0UL
suffix:semicolon
multiline_comment|/* Probe the hardware for info about configuration. */
id|wildfire_hardware_probe
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Now init all the found QBBs. */
r_for
c_loop
(paren
id|qbbno
op_assign
l_int|0
suffix:semicolon
id|qbbno
OL
id|WILDFIRE_MAX_QBB
suffix:semicolon
id|qbbno
op_increment
)paren
(brace
id|wildfire_init_qbb
c_func
(paren
id|qbbno
)paren
suffix:semicolon
)brace
multiline_comment|/* Normal direct PCI DMA mapping. */
id|__direct_map_base
op_assign
l_int|0x40000000UL
suffix:semicolon
id|__direct_map_size
op_assign
l_int|0x80000000UL
suffix:semicolon
)brace
r_void
DECL|function|wildfire_machine_check
id|wildfire_machine_check
c_func
(paren
r_int
r_int
id|vector
comma
r_int
r_int
id|la_ptr
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* magic */
id|draina
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* FIXME: clear pci errors */
id|wrmces
c_func
(paren
l_int|0x7
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|process_mcheck_info
c_func
(paren
id|vector
comma
id|la_ptr
comma
id|regs
comma
l_string|&quot;WILDFIRE&quot;
comma
id|mcheck_expected
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|wildfire_kill_arch
id|wildfire_kill_arch
c_func
(paren
r_int
id|mode
)paren
(brace
)brace
r_void
DECL|function|wildfire_pci_tbi
id|wildfire_pci_tbi
c_func
(paren
r_struct
id|pci_controler
op_star
id|hose
comma
id|dma_addr_t
id|start
comma
id|dma_addr_t
id|end
)paren
(brace
r_int
id|qbbno
op_assign
id|hose-&gt;index
op_rshift
l_int|3
suffix:semicolon
r_int
id|hoseno
op_assign
id|hose-&gt;index
op_amp
l_int|7
suffix:semicolon
id|wildfire_pci
op_star
id|pci
op_assign
id|WILDFIRE_pci
c_func
(paren
id|qbbno
comma
id|hoseno
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|pci-&gt;pci_flush_tlb.csr
suffix:semicolon
multiline_comment|/* reading does the trick */
)brace
r_static
r_int
DECL|function|mk_conf_addr
id|mk_conf_addr
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
r_int
r_int
op_star
id|pci_addr
comma
r_int
r_char
op_star
id|type1
)paren
(brace
r_struct
id|pci_controler
op_star
id|hose
op_assign
id|dev-&gt;sysdata
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
id|u8
id|bus
op_assign
id|dev-&gt;bus-&gt;number
suffix:semicolon
id|u8
id|device_fn
op_assign
id|dev-&gt;devfn
suffix:semicolon
id|DBG_CFG
c_func
(paren
(paren
l_string|&quot;mk_conf_addr(bus=%d ,device_fn=0x%x, where=0x%x, &quot;
l_string|&quot;pci_addr=0x%p, type1=0x%p)&bslash;n&quot;
comma
id|bus
comma
id|device_fn
comma
id|where
comma
id|pci_addr
comma
id|type1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hose-&gt;first_busno
op_eq
id|dev-&gt;bus-&gt;number
)paren
id|bus
op_assign
l_int|0
suffix:semicolon
op_star
id|type1
op_assign
(paren
id|bus
op_ne
l_int|0
)paren
suffix:semicolon
id|addr
op_assign
(paren
id|bus
op_lshift
l_int|16
)paren
op_or
(paren
id|device_fn
op_lshift
l_int|8
)paren
op_or
id|where
suffix:semicolon
id|addr
op_or_assign
id|hose-&gt;config_space_base
suffix:semicolon
op_star
id|pci_addr
op_assign
id|addr
suffix:semicolon
id|DBG_CFG
c_func
(paren
(paren
l_string|&quot;mk_conf_addr: returning pci_addr 0x%lx&bslash;n&quot;
comma
id|addr
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|wildfire_read_config_byte
id|wildfire_read_config_byte
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u8
op_star
id|value
)paren
(brace
r_int
r_int
id|addr
suffix:semicolon
r_int
r_char
id|type1
suffix:semicolon
r_if
c_cond
(paren
id|mk_conf_addr
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|addr
comma
op_amp
id|type1
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
op_star
id|value
op_assign
id|__kernel_ldbu
c_func
(paren
op_star
(paren
id|vucp
)paren
id|addr
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_static
r_int
DECL|function|wildfire_read_config_word
id|wildfire_read_config_word
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u16
op_star
id|value
)paren
(brace
r_int
r_int
id|addr
suffix:semicolon
r_int
r_char
id|type1
suffix:semicolon
r_if
c_cond
(paren
id|mk_conf_addr
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|addr
comma
op_amp
id|type1
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
op_star
id|value
op_assign
id|__kernel_ldwu
c_func
(paren
op_star
(paren
id|vusp
)paren
id|addr
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_static
r_int
DECL|function|wildfire_read_config_dword
id|wildfire_read_config_dword
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u32
op_star
id|value
)paren
(brace
r_int
r_int
id|addr
suffix:semicolon
r_int
r_char
id|type1
suffix:semicolon
r_if
c_cond
(paren
id|mk_conf_addr
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|addr
comma
op_amp
id|type1
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
op_star
id|value
op_assign
op_star
(paren
id|vuip
)paren
id|addr
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_static
r_int
DECL|function|wildfire_write_config_byte
id|wildfire_write_config_byte
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u8
id|value
)paren
(brace
r_int
r_int
id|addr
suffix:semicolon
r_int
r_char
id|type1
suffix:semicolon
r_if
c_cond
(paren
id|mk_conf_addr
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|addr
comma
op_amp
id|type1
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
id|__kernel_stb
c_func
(paren
id|value
comma
op_star
(paren
id|vucp
)paren
id|addr
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|__kernel_ldbu
c_func
(paren
op_star
(paren
id|vucp
)paren
id|addr
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_static
r_int
DECL|function|wildfire_write_config_word
id|wildfire_write_config_word
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u16
id|value
)paren
(brace
r_int
r_int
id|addr
suffix:semicolon
r_int
r_char
id|type1
suffix:semicolon
r_if
c_cond
(paren
id|mk_conf_addr
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|addr
comma
op_amp
id|type1
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
id|__kernel_stw
c_func
(paren
id|value
comma
op_star
(paren
id|vusp
)paren
id|addr
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|__kernel_ldwu
c_func
(paren
op_star
(paren
id|vusp
)paren
id|addr
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_static
r_int
DECL|function|wildfire_write_config_dword
id|wildfire_write_config_dword
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|where
comma
id|u32
id|value
)paren
(brace
r_int
r_int
id|addr
suffix:semicolon
r_int
r_char
id|type1
suffix:semicolon
r_if
c_cond
(paren
id|mk_conf_addr
c_func
(paren
id|dev
comma
id|where
comma
op_amp
id|addr
comma
op_amp
id|type1
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
op_star
(paren
id|vuip
)paren
id|addr
op_assign
id|value
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
op_star
(paren
id|vuip
)paren
id|addr
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|variable|wildfire_pci_ops
r_struct
id|pci_ops
id|wildfire_pci_ops
op_assign
(brace
id|read_byte
suffix:colon
id|wildfire_read_config_byte
comma
id|read_word
suffix:colon
id|wildfire_read_config_word
comma
id|read_dword
suffix:colon
id|wildfire_read_config_dword
comma
id|write_byte
suffix:colon
id|wildfire_write_config_byte
comma
id|write_word
suffix:colon
id|wildfire_write_config_word
comma
id|write_dword
suffix:colon
id|wildfire_write_config_dword
)brace
suffix:semicolon
macro_line|#if DEBUG_DUMP_REGS
r_static
r_void
id|__init
DECL|function|wildfire_dump_pci_regs
id|wildfire_dump_pci_regs
c_func
(paren
r_int
id|qbbno
comma
r_int
id|hoseno
)paren
(brace
id|wildfire_pci
op_star
id|pci
op_assign
id|WILDFIRE_pci
c_func
(paren
id|qbbno
comma
id|hoseno
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PCI registers for QBB %d hose %d (%p)&bslash;n&quot;
comma
id|qbbno
comma
id|hoseno
comma
id|pci
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCI_IO_ADDR_EXT: 0x%16lx&bslash;n&quot;
comma
id|pci-&gt;pci_io_addr_ext.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCI_CTRL:        0x%16lx&bslash;n&quot;
comma
id|pci-&gt;pci_ctrl.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCI_ERR_SUM:     0x%16lx&bslash;n&quot;
comma
id|pci-&gt;pci_err_sum.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCI_ERR_ADDR:    0x%16lx&bslash;n&quot;
comma
id|pci-&gt;pci_err_addr.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCI_STALL_CNT:   0x%16lx&bslash;n&quot;
comma
id|pci-&gt;pci_stall_cnt.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCI_PEND_INT:    0x%16lx&bslash;n&quot;
comma
id|pci-&gt;pci_pend_int.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCI_SENT_INT:    0x%16lx&bslash;n&quot;
comma
id|pci-&gt;pci_sent_int.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; DMA window registers for QBB %d hose %d (%p)&bslash;n&quot;
comma
id|qbbno
comma
id|hoseno
comma
id|pci
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;  window %d: 0x%16lx 0x%16lx 0x%16lx&bslash;n&quot;
comma
id|i
comma
id|pci-&gt;pci_window
(braket
id|i
)braket
dot
id|wbase.csr
comma
id|pci-&gt;pci_window
(braket
id|i
)braket
dot
id|wmask.csr
comma
id|pci-&gt;pci_window
(braket
id|i
)braket
dot
id|tbase.csr
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|wildfire_dump_pca_regs
id|wildfire_dump_pca_regs
c_func
(paren
r_int
id|qbbno
comma
r_int
id|pcano
)paren
(brace
id|wildfire_pca
op_star
id|pca
op_assign
id|WILDFIRE_pca
c_func
(paren
id|qbbno
comma
id|pcano
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PCA registers for QBB %d PCA %d (%p)&bslash;n&quot;
comma
id|qbbno
comma
id|pcano
comma
id|pca
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCA_WHAT_AM_I: 0x%16lx&bslash;n&quot;
comma
id|pca-&gt;pca_what_am_i.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCA_ERR_SUM:   0x%16lx&bslash;n&quot;
comma
id|pca-&gt;pca_err_sum.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCA_PEND_INT:  0x%16lx&bslash;n&quot;
comma
id|pca-&gt;pca_pend_int.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCA_SENT_INT:  0x%16lx&bslash;n&quot;
comma
id|pca-&gt;pca_sent_int.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCA_STDIO_EL:  0x%16lx&bslash;n&quot;
comma
id|pca-&gt;pca_stdio_edge_level.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; PCA target registers for QBB %d PCA %d (%p)&bslash;n&quot;
comma
id|qbbno
comma
id|pcano
comma
id|pca
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;  target %d: 0x%16lx 0x%16lx&bslash;n&quot;
comma
id|i
comma
id|pca-&gt;pca_int
(braket
id|i
)braket
dot
id|target.csr
comma
id|pca-&gt;pca_int
(braket
id|i
)braket
dot
id|enable.csr
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|wildfire_dump_qsa_regs
id|wildfire_dump_qsa_regs
c_func
(paren
r_int
id|qbbno
)paren
(brace
id|wildfire_qsa
op_star
id|qsa
op_assign
id|WILDFIRE_qsa
c_func
(paren
id|qbbno
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;QSA registers for QBB %d (%p)&bslash;n&quot;
comma
id|qbbno
comma
id|qsa
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSA_QBB_ID:      0x%16lx&bslash;n&quot;
comma
id|qsa-&gt;qsa_qbb_id.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSA_PORT_ENA:    0x%16lx&bslash;n&quot;
comma
id|qsa-&gt;qsa_port_ena.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSA_REF_INT:     0x%16lx&bslash;n&quot;
comma
id|qsa-&gt;qsa_ref_int.csr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSA_CONFIG_%d:    0x%16lx&bslash;n&quot;
comma
id|i
comma
id|qsa-&gt;qsa_config
(braket
id|i
)braket
dot
id|csr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSA_QBB_POP_%d:   0x%16lx&bslash;n&quot;
comma
id|i
comma
id|qsa-&gt;qsa_qbb_pop
(braket
l_int|0
)braket
dot
id|csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|wildfire_dump_qsd_regs
id|wildfire_dump_qsd_regs
c_func
(paren
r_int
id|qbbno
)paren
(brace
id|wildfire_qsd
op_star
id|qsd
op_assign
id|WILDFIRE_qsd
c_func
(paren
id|qbbno
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;QSD registers for QBB %d (%p)&bslash;n&quot;
comma
id|qbbno
comma
id|qsd
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSD_WHAMI:         0x%16lx&bslash;n&quot;
comma
id|qsd-&gt;qsd_whami.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSD_REV:           0x%16lx&bslash;n&quot;
comma
id|qsd-&gt;qsd_rev.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSD_PORT_PRESENT:  0x%16lx&bslash;n&quot;
comma
id|qsd-&gt;qsd_port_present.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSD_PORT_ACTUVE:   0x%16lx&bslash;n&quot;
comma
id|qsd-&gt;qsd_port_active.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSD_FAULT_ENA:     0x%16lx&bslash;n&quot;
comma
id|qsd-&gt;qsd_fault_ena.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSD_CPU_INT_ENA:   0x%16lx&bslash;n&quot;
comma
id|qsd-&gt;qsd_cpu_int_ena.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSD_MEM_CONFIG:    0x%16lx&bslash;n&quot;
comma
id|qsd-&gt;qsd_mem_config.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; QSD_ERR_SUM:       0x%16lx&bslash;n&quot;
comma
id|qsd-&gt;qsd_err_sum.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|wildfire_dump_iop_regs
id|wildfire_dump_iop_regs
c_func
(paren
r_int
id|qbbno
)paren
(brace
id|wildfire_iop
op_star
id|iop
op_assign
id|WILDFIRE_iop
c_func
(paren
id|qbbno
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IOP registers for QBB %d (%p)&bslash;n&quot;
comma
id|qbbno
comma
id|iop
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; IOA_CONFIG:          0x%16lx&bslash;n&quot;
comma
id|iop-&gt;ioa_config.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; IOD_CONFIG:          0x%16lx&bslash;n&quot;
comma
id|iop-&gt;iod_config.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; IOP_SWITCH_CREDITS:  0x%16lx&bslash;n&quot;
comma
id|iop-&gt;iop_switch_credits.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; IOP_HOSE_CREDITS:    0x%16lx&bslash;n&quot;
comma
id|iop-&gt;iop_hose_credits.csr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; IOP_HOSE_%d_INIT:     0x%16lx&bslash;n&quot;
comma
id|i
comma
id|iop-&gt;iop_hose
(braket
id|i
)braket
dot
id|init.csr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; IOP_DEV_INT_TARGET_%d: 0x%16lx&bslash;n&quot;
comma
id|i
comma
id|iop-&gt;iop_dev_int
(braket
id|i
)braket
dot
id|target.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|wildfire_dump_gp_regs
id|wildfire_dump_gp_regs
c_func
(paren
r_int
id|qbbno
)paren
(brace
id|wildfire_gp
op_star
id|gp
op_assign
id|WILDFIRE_gp
c_func
(paren
id|qbbno
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;GP registers for QBB %d (%p)&bslash;n&quot;
comma
id|qbbno
comma
id|gp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; GPA_QBB_MAP_%d:     0x%16lx&bslash;n&quot;
comma
id|i
comma
id|gp-&gt;gpa_qbb_map
(braket
id|i
)braket
dot
id|csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; GPA_MEM_POP_MAP:   0x%16lx&bslash;n&quot;
comma
id|gp-&gt;gpa_mem_pop_map.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; GPA_SCRATCH:       0x%16lx&bslash;n&quot;
comma
id|gp-&gt;gpa_scratch.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; GPA_DIAG:          0x%16lx&bslash;n&quot;
comma
id|gp-&gt;gpa_diag.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; GPA_CONFIG_0:      0x%16lx&bslash;n&quot;
comma
id|gp-&gt;gpa_config_0.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; GPA_INIT_ID:       0x%16lx&bslash;n&quot;
comma
id|gp-&gt;gpa_init_id.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; GPA_CONFIG_2:      0x%16lx&bslash;n&quot;
comma
id|gp-&gt;gpa_config_2.csr
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* DUMP_REGS */
macro_line|#if DEBUG_DUMP_CONFIG
r_static
r_void
id|__init
DECL|function|wildfire_dump_hardware_config
id|wildfire_dump_hardware_config
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Probed Hardware Configuration&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; hard_qbb_mask:  0x%16lx&bslash;n&quot;
comma
id|wildfire_hard_qbb_mask
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; soft_qbb_mask:  0x%16lx&bslash;n&quot;
comma
id|wildfire_soft_qbb_mask
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; gp_mask:        0x%16lx&bslash;n&quot;
comma
id|wildfire_gp_mask
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; hs_mask:        0x%16lx&bslash;n&quot;
comma
id|wildfire_hs_mask
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; iop_mask:       0x%16lx&bslash;n&quot;
comma
id|wildfire_iop_mask
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; ior_mask:       0x%16lx&bslash;n&quot;
comma
id|wildfire_ior_mask
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; pca_mask:       0x%16lx&bslash;n&quot;
comma
id|wildfire_pca_mask
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; cpu_mask:       0x%16lx&bslash;n&quot;
comma
id|wildfire_cpu_mask
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot; mem_mask:       0x%16lx&bslash;n&quot;
comma
id|wildfire_mem_mask
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; hard_qbb_map: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WILDFIRE_MAX_QBB
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|wildfire_hard_qbb_map
(braket
id|i
)braket
op_eq
id|QBB_MAP_EMPTY
)paren
id|printk
c_func
(paren
l_string|&quot;--- &quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%3d &quot;
comma
id|wildfire_hard_qbb_map
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; soft_qbb_map: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|WILDFIRE_MAX_QBB
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|wildfire_soft_qbb_map
(braket
id|i
)braket
op_eq
id|QBB_MAP_EMPTY
)paren
id|printk
c_func
(paren
l_string|&quot;--- &quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%3d &quot;
comma
id|wildfire_soft_qbb_map
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* DUMP_CONFIG */
eof
