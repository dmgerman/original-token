multiline_comment|/*&n; * linux/kernel/itimer.c&n; *&n; * (C) 1992 Darren Senn&n; */
multiline_comment|/* These are all the functions necessary to implement itimers */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;signal.h&gt;
macro_line|#include &lt;sys/time.h&gt;
macro_line|#include &lt;errno.h&gt;
DECL|function|tvtojiffies
r_static
r_int
r_int
id|tvtojiffies
c_func
(paren
r_struct
id|timeval
op_star
id|value
)paren
(brace
r_return
(paren
r_int
r_int
)paren
id|value-&gt;tv_sec
op_star
id|HZ
op_plus
(paren
r_int
r_int
)paren
(paren
id|value-&gt;tv_usec
op_plus
(paren
l_int|1000000
op_div
id|HZ
op_minus
l_int|1
)paren
)paren
op_div
(paren
l_int|1000000
op_div
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|jiffiestotv
r_static
r_void
id|jiffiestotv
c_func
(paren
r_int
r_int
id|jiffies
comma
r_struct
id|timeval
op_star
id|value
)paren
(brace
id|value-&gt;tv_usec
op_assign
(paren
id|jiffies
op_mod
id|HZ
)paren
op_star
(paren
l_int|1000000
op_div
id|HZ
)paren
suffix:semicolon
id|value-&gt;tv_sec
op_assign
id|jiffies
op_div
id|HZ
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|_getitimer
r_int
id|_getitimer
c_func
(paren
r_int
id|which
comma
r_struct
id|itimerval
op_star
id|value
)paren
(brace
r_register
r_int
r_int
id|val
comma
id|interval
suffix:semicolon
r_switch
c_cond
(paren
id|which
)paren
(brace
r_case
id|ITIMER_REAL
suffix:colon
id|val
op_assign
id|current-&gt;it_real_value
suffix:semicolon
id|interval
op_assign
id|current-&gt;it_real_incr
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITIMER_VIRTUAL
suffix:colon
id|val
op_assign
id|current-&gt;it_virt_value
suffix:semicolon
id|interval
op_assign
id|current-&gt;it_virt_incr
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITIMER_PROF
suffix:colon
id|val
op_assign
id|current-&gt;it_prof_value
suffix:semicolon
id|interval
op_assign
id|current-&gt;it_prof_incr
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|jiffiestotv
c_func
(paren
id|val
comma
op_amp
id|value-&gt;it_value
)paren
suffix:semicolon
id|jiffiestotv
c_func
(paren
id|interval
comma
op_amp
id|value-&gt;it_interval
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sys_getitimer
r_int
id|sys_getitimer
c_func
(paren
r_int
id|which
comma
r_struct
id|itimerval
op_star
id|value
)paren
(brace
r_struct
id|itimerval
id|get_buffer
suffix:semicolon
r_int
id|k
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|k
op_assign
id|_getitimer
c_func
(paren
id|which
comma
op_amp
id|get_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|k
OL
l_int|0
)paren
r_return
id|k
suffix:semicolon
id|verify_area
c_func
(paren
id|value
comma
r_sizeof
(paren
r_struct
id|itimerval
)paren
)paren
suffix:semicolon
id|memcpy_tofs
c_func
(paren
id|value
comma
op_amp
id|get_buffer
comma
r_sizeof
(paren
id|get_buffer
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|_setitimer
r_int
id|_setitimer
c_func
(paren
r_int
id|which
comma
r_struct
id|itimerval
op_star
id|value
comma
r_struct
id|itimerval
op_star
id|ovalue
)paren
(brace
r_register
r_int
r_int
id|i
comma
id|j
suffix:semicolon
r_int
id|k
suffix:semicolon
id|i
op_assign
id|tvtojiffies
c_func
(paren
op_amp
id|value-&gt;it_interval
)paren
suffix:semicolon
id|j
op_assign
id|tvtojiffies
c_func
(paren
op_amp
id|value-&gt;it_value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ovalue
op_logical_and
(paren
id|k
op_assign
id|_getitimer
c_func
(paren
id|which
comma
id|ovalue
)paren
)paren
OL
l_int|0
)paren
r_return
id|k
suffix:semicolon
r_switch
c_cond
(paren
id|which
)paren
(brace
r_case
id|ITIMER_REAL
suffix:colon
id|current-&gt;it_real_value
op_assign
id|j
suffix:semicolon
id|current-&gt;it_real_incr
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITIMER_VIRTUAL
suffix:colon
id|current-&gt;it_virt_value
op_assign
id|j
suffix:semicolon
id|current-&gt;it_virt_incr
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITIMER_PROF
suffix:colon
id|current-&gt;it_prof_value
op_assign
id|j
suffix:semicolon
id|current-&gt;it_prof_incr
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sys_setitimer
r_int
id|sys_setitimer
c_func
(paren
r_int
id|which
comma
r_struct
id|itimerval
op_star
id|value
comma
r_struct
id|itimerval
op_star
id|ovalue
)paren
(brace
r_struct
id|itimerval
id|set_buffer
comma
id|get_buffer
suffix:semicolon
r_int
id|k
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|set_buffer
comma
l_int|0
comma
r_sizeof
(paren
id|set_buffer
)paren
)paren
suffix:semicolon
r_else
id|memcpy_fromfs
c_func
(paren
op_amp
id|set_buffer
comma
id|value
comma
r_sizeof
(paren
id|set_buffer
)paren
)paren
suffix:semicolon
id|k
op_assign
id|_setitimer
c_func
(paren
id|which
comma
op_amp
id|set_buffer
comma
id|ovalue
ques
c_cond
op_amp
id|get_buffer
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|k
OL
l_int|0
op_logical_or
op_logical_neg
id|ovalue
)paren
r_return
id|k
suffix:semicolon
id|verify_area
c_func
(paren
id|ovalue
comma
r_sizeof
(paren
r_struct
id|itimerval
)paren
)paren
suffix:semicolon
id|memcpy_tofs
c_func
(paren
id|ovalue
comma
op_amp
id|get_buffer
comma
r_sizeof
(paren
id|get_buffer
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
