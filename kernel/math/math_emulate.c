multiline_comment|/*&n; * linux/kernel/math/math_emulate.c&n; *&n; * (C) 1991 Linus Torvalds&n; */
multiline_comment|/*&n; * Limited emulation 27.12.91 - mostly loads/stores, which gcc wants&n; * even for soft-float, unless you use bruce evans&squot; patches. The patches&n; * are great, but they have to be re-applied for every version, and the&n; * library is different for soft-float and 80387. So emulation is more&n; * practical, even though it&squot;s slower.&n; *&n; * 28.12.91 - loads/stores work, even BCD. I&squot;ll have to start thinking&n; * about add/sub/mul/div. Urgel. I should find some good source, but I&squot;ll&n; * just fake up something.&n; *&n; * 30.12.91 - add/sub/mul/div/com seem to work mostly. I should really&n; * test every possible combination.&n; */
multiline_comment|/*&n; * This file is full of ugly macros etc: one problem was that gcc simply&n; * didn&squot;t want to make the structures as they should be: it has to try to&n; * align them. Sickening code, but at least I&squot;ve hidden the ugly things&n; * in this one file: the other files don&squot;t need to know about these things.&n; *&n; * The other files also don&squot;t care about ST(x) etc - they just get addresses&n; * to 80-bit temporary reals, and do with them as they please. I wanted to&n; * hide most of the 387-specific things here.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#ifdef KERNEL_MATH_EMULATION
macro_line|#include &lt;signal.h&gt;
DECL|macro|__ALIGNED_TEMP_REAL
mdefine_line|#define __ALIGNED_TEMP_REAL 1
macro_line|#include &lt;linux/math_emu.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
DECL|macro|bswapw
mdefine_line|#define bswapw(x) __asm__(&quot;xchgb %%al,%%ah&quot;:&quot;=a&quot; (x):&quot;0&quot; ((short)x))
DECL|macro|ST
mdefine_line|#define ST(x) (*__st((x)))
DECL|macro|PST
mdefine_line|#define PST(x) ((const temp_real *) __st((x)))
multiline_comment|/*&n; * We don&squot;t want these inlined - it gets too messy in the machine-code.&n; */
r_static
r_void
id|fpop
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|fpush
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|fxchg
c_func
(paren
id|temp_real_unaligned
op_star
id|a
comma
id|temp_real_unaligned
op_star
id|b
)paren
suffix:semicolon
r_static
id|temp_real_unaligned
op_star
id|__st
c_func
(paren
r_int
id|i
)paren
suffix:semicolon
DECL|function|do_emu
r_static
r_void
id|do_emu
c_func
(paren
r_struct
id|info
op_star
id|info
)paren
(brace
r_int
r_int
id|code
suffix:semicolon
id|temp_real
id|tmp
suffix:semicolon
r_char
op_star
id|address
suffix:semicolon
r_if
c_cond
(paren
id|I387.cwd
op_amp
id|I387.swd
op_amp
l_int|0x3f
)paren
id|I387.swd
op_or_assign
l_int|0x8000
suffix:semicolon
r_else
id|I387.swd
op_and_assign
l_int|0x7fff
suffix:semicolon
id|ORIG_EIP
op_assign
id|EIP
suffix:semicolon
multiline_comment|/* 0x0007 means user code space */
r_if
c_cond
(paren
id|CS
op_ne
l_int|0x000F
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;math_emulate: %04x:%08x&bslash;n&bslash;r&quot;
comma
id|CS
comma
id|EIP
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Math emulation needed in kernel&quot;
)paren
suffix:semicolon
)brace
id|code
op_assign
id|get_fs_word
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|EIP
)paren
suffix:semicolon
id|bswapw
c_func
(paren
id|code
)paren
suffix:semicolon
id|code
op_and_assign
l_int|0x7ff
suffix:semicolon
id|I387.fip
op_assign
id|EIP
suffix:semicolon
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|I387.fcs
op_assign
id|CS
suffix:semicolon
op_star
(paren
l_int|1
op_plus
(paren
r_int
r_int
op_star
)paren
op_amp
id|I387.fcs
)paren
op_assign
id|code
suffix:semicolon
id|EIP
op_add_assign
l_int|2
suffix:semicolon
r_switch
c_cond
(paren
id|code
)paren
(brace
r_case
l_int|0x1d0
suffix:colon
multiline_comment|/* fnop */
r_return
suffix:semicolon
r_case
l_int|0x1d1
suffix:colon
r_case
l_int|0x1d2
suffix:colon
r_case
l_int|0x1d3
suffix:colon
r_case
l_int|0x1d4
suffix:colon
r_case
l_int|0x1d5
suffix:colon
r_case
l_int|0x1d6
suffix:colon
r_case
l_int|0x1d7
suffix:colon
id|math_abort
c_func
(paren
id|info
comma
l_int|1
op_lshift
(paren
id|SIGILL
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_case
l_int|0x1e0
suffix:colon
id|ST
c_func
(paren
l_int|0
)paren
dot
id|exponent
op_xor_assign
l_int|0x8000
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1e1
suffix:colon
id|ST
c_func
(paren
l_int|0
)paren
dot
id|exponent
op_and_assign
l_int|0x7fff
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1e2
suffix:colon
r_case
l_int|0x1e3
suffix:colon
id|math_abort
c_func
(paren
id|info
comma
l_int|1
op_lshift
(paren
id|SIGILL
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_case
l_int|0x1e4
suffix:colon
id|ftst
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1e5
suffix:colon
id|printk
c_func
(paren
l_string|&quot;fxam not implemented&bslash;n&bslash;r&quot;
)paren
suffix:semicolon
id|math_abort
c_func
(paren
id|info
comma
l_int|1
op_lshift
(paren
id|SIGILL
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_case
l_int|0x1e6
suffix:colon
r_case
l_int|0x1e7
suffix:colon
id|math_abort
c_func
(paren
id|info
comma
l_int|1
op_lshift
(paren
id|SIGILL
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_case
l_int|0x1e8
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|ST
c_func
(paren
l_int|0
)paren
op_assign
id|CONST1
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1e9
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|ST
c_func
(paren
l_int|0
)paren
op_assign
id|CONSTL2T
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1ea
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|ST
c_func
(paren
l_int|0
)paren
op_assign
id|CONSTL2E
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1eb
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|ST
c_func
(paren
l_int|0
)paren
op_assign
id|CONSTPI
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1ec
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|ST
c_func
(paren
l_int|0
)paren
op_assign
id|CONSTLG2
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1ed
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|ST
c_func
(paren
l_int|0
)paren
op_assign
id|CONSTLN2
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1ee
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|ST
c_func
(paren
l_int|0
)paren
op_assign
id|CONSTZ
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1ef
suffix:colon
id|math_abort
c_func
(paren
id|info
comma
l_int|1
op_lshift
(paren
id|SIGILL
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_case
l_int|0x1f0
suffix:colon
r_case
l_int|0x1f1
suffix:colon
r_case
l_int|0x1f2
suffix:colon
r_case
l_int|0x1f3
suffix:colon
r_case
l_int|0x1f4
suffix:colon
r_case
l_int|0x1f5
suffix:colon
r_case
l_int|0x1f6
suffix:colon
r_case
l_int|0x1f7
suffix:colon
r_case
l_int|0x1f8
suffix:colon
r_case
l_int|0x1f9
suffix:colon
r_case
l_int|0x1fa
suffix:colon
r_case
l_int|0x1fb
suffix:colon
r_case
l_int|0x1fd
suffix:colon
r_case
l_int|0x1fe
suffix:colon
r_case
l_int|0x1ff
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%04x fxxx not implemented&bslash;n&bslash;r&quot;
comma
id|code
op_plus
l_int|0xd800
)paren
suffix:semicolon
id|math_abort
c_func
(paren
id|info
comma
l_int|1
op_lshift
(paren
id|SIGILL
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_case
l_int|0x1fc
suffix:colon
id|frndint
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x2e9
suffix:colon
id|fucom
c_func
(paren
id|PST
c_func
(paren
l_int|1
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x3d0
suffix:colon
r_case
l_int|0x3d1
suffix:colon
r_return
suffix:semicolon
r_case
l_int|0x3e2
suffix:colon
id|I387.swd
op_and_assign
l_int|0x7f00
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x3e3
suffix:colon
id|I387.cwd
op_assign
l_int|0x037f
suffix:semicolon
id|I387.swd
op_assign
l_int|0x0000
suffix:semicolon
id|I387.twd
op_assign
l_int|0x0000
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x3e4
suffix:colon
r_return
suffix:semicolon
r_case
l_int|0x6d9
suffix:colon
id|fcom
c_func
(paren
id|PST
c_func
(paren
l_int|1
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x7e0
suffix:colon
op_star
(paren
r_int
op_star
)paren
op_amp
id|EAX
op_assign
id|I387.swd
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|code
op_rshift
l_int|3
)paren
(brace
r_case
l_int|0x18
suffix:colon
id|fadd
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x19
suffix:colon
id|fmul
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1a
suffix:colon
id|fcom
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1b
suffix:colon
id|fcom
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1c
suffix:colon
id|real_to_real
c_func
(paren
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tmp.exponent
op_xor_assign
l_int|0x8000
suffix:semicolon
id|fadd
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1d
suffix:colon
id|ST
c_func
(paren
l_int|0
)paren
dot
id|exponent
op_xor_assign
l_int|0x8000
suffix:semicolon
id|fadd
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1e
suffix:colon
id|fdiv
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x1f
suffix:colon
id|fdiv
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x38
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|ST
c_func
(paren
l_int|0
)paren
op_assign
id|ST
c_func
(paren
(paren
id|code
op_amp
l_int|7
)paren
op_plus
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x39
suffix:colon
id|fxchg
c_func
(paren
op_amp
id|ST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x3b
suffix:colon
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
op_assign
id|ST
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x98
suffix:colon
id|fadd
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x99
suffix:colon
id|fmul
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x9a
suffix:colon
id|fcom
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x9b
suffix:colon
id|fcom
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x9c
suffix:colon
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
dot
id|exponent
op_xor_assign
l_int|0x8000
suffix:semicolon
id|fadd
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x9d
suffix:colon
id|real_to_real
c_func
(paren
op_amp
id|ST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tmp.exponent
op_xor_assign
l_int|0x8000
suffix:semicolon
id|fadd
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x9e
suffix:colon
id|fdiv
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x9f
suffix:colon
id|fdiv
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xb8
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ffree not implemented&bslash;n&bslash;r&quot;
)paren
suffix:semicolon
id|math_abort
c_func
(paren
id|info
comma
l_int|1
op_lshift
(paren
id|SIGILL
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_case
l_int|0xb9
suffix:colon
id|fxchg
c_func
(paren
op_amp
id|ST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xba
suffix:colon
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
op_assign
id|ST
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xbb
suffix:colon
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
op_assign
id|ST
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xbc
suffix:colon
id|fucom
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xbd
suffix:colon
id|fucom
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xd8
suffix:colon
id|fadd
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xd9
suffix:colon
id|fmul
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xda
suffix:colon
id|fcom
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xdc
suffix:colon
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
dot
id|exponent
op_xor_assign
l_int|0x8000
suffix:semicolon
id|fadd
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xdd
suffix:colon
id|real_to_real
c_func
(paren
op_amp
id|ST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tmp.exponent
op_xor_assign
l_int|0x8000
suffix:semicolon
id|fadd
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xde
suffix:colon
id|fdiv
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xdf
suffix:colon
id|fdiv
c_func
(paren
id|PST
c_func
(paren
id|code
op_amp
l_int|7
)paren
comma
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xf8
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ffree not implemented&bslash;n&bslash;r&quot;
)paren
suffix:semicolon
id|math_abort
c_func
(paren
id|info
comma
l_int|1
op_lshift
(paren
id|SIGILL
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xf9
suffix:colon
id|fxchg
c_func
(paren
op_amp
id|ST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xfa
suffix:colon
r_case
l_int|0xfb
suffix:colon
id|ST
c_func
(paren
id|code
op_amp
l_int|7
)paren
op_assign
id|ST
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
(paren
id|code
op_rshift
l_int|3
)paren
op_amp
l_int|0xe7
)paren
(brace
r_case
l_int|0x22
suffix:colon
id|put_short_real
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x23
suffix:colon
id|put_short_real
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x24
suffix:colon
id|address
op_assign
id|ea
c_func
(paren
id|info
comma
id|code
)paren
suffix:semicolon
r_for
c_loop
(paren
id|code
op_assign
l_int|0
suffix:semicolon
id|code
OL
l_int|7
suffix:semicolon
id|code
op_increment
)paren
(brace
(paren
(paren
r_int
op_star
)paren
op_amp
id|I387
)paren
(braket
id|code
)braket
op_assign
id|get_fs_long
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|address
)paren
suffix:semicolon
id|address
op_add_assign
l_int|4
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
l_int|0x25
suffix:colon
id|address
op_assign
id|ea
c_func
(paren
id|info
comma
id|code
)paren
suffix:semicolon
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|I387.cwd
op_assign
id|get_fs_word
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|address
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x26
suffix:colon
id|address
op_assign
id|ea
c_func
(paren
id|info
comma
id|code
)paren
suffix:semicolon
id|verify_area
c_func
(paren
id|address
comma
l_int|28
)paren
suffix:semicolon
r_for
c_loop
(paren
id|code
op_assign
l_int|0
suffix:semicolon
id|code
OL
l_int|7
suffix:semicolon
id|code
op_increment
)paren
(brace
id|put_fs_long
c_func
(paren
(paren
(paren
r_int
op_star
)paren
op_amp
id|I387
)paren
(braket
id|code
)braket
comma
(paren
r_int
r_int
op_star
)paren
id|address
)paren
suffix:semicolon
id|address
op_add_assign
l_int|4
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
l_int|0x27
suffix:colon
id|address
op_assign
id|ea
c_func
(paren
id|info
comma
id|code
)paren
suffix:semicolon
id|verify_area
c_func
(paren
id|address
comma
l_int|2
)paren
suffix:semicolon
id|put_fs_word
c_func
(paren
id|I387.cwd
comma
(paren
r_int
op_star
)paren
id|address
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x62
suffix:colon
id|put_long_int
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x63
suffix:colon
id|put_long_int
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x65
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|get_temp_real
c_func
(paren
op_amp
id|tmp
comma
id|info
comma
id|code
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0x67
suffix:colon
id|put_temp_real
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xa2
suffix:colon
id|put_long_real
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xa3
suffix:colon
id|put_long_real
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xa4
suffix:colon
id|address
op_assign
id|ea
c_func
(paren
id|info
comma
id|code
)paren
suffix:semicolon
r_for
c_loop
(paren
id|code
op_assign
l_int|0
suffix:semicolon
id|code
OL
l_int|27
suffix:semicolon
id|code
op_increment
)paren
(brace
(paren
(paren
r_int
op_star
)paren
op_amp
id|I387
)paren
(braket
id|code
)braket
op_assign
id|get_fs_long
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|address
)paren
suffix:semicolon
id|address
op_add_assign
l_int|4
suffix:semicolon
)brace
r_return
suffix:semicolon
r_case
l_int|0xa6
suffix:colon
id|address
op_assign
id|ea
c_func
(paren
id|info
comma
id|code
)paren
suffix:semicolon
id|verify_area
c_func
(paren
id|address
comma
l_int|108
)paren
suffix:semicolon
r_for
c_loop
(paren
id|code
op_assign
l_int|0
suffix:semicolon
id|code
OL
l_int|27
suffix:semicolon
id|code
op_increment
)paren
(brace
id|put_fs_long
c_func
(paren
(paren
(paren
r_int
op_star
)paren
op_amp
id|I387
)paren
(braket
id|code
)braket
comma
(paren
r_int
r_int
op_star
)paren
id|address
)paren
suffix:semicolon
id|address
op_add_assign
l_int|4
suffix:semicolon
)brace
id|I387.cwd
op_assign
l_int|0x037f
suffix:semicolon
id|I387.swd
op_assign
l_int|0x0000
suffix:semicolon
id|I387.twd
op_assign
l_int|0x0000
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xa7
suffix:colon
id|address
op_assign
id|ea
c_func
(paren
id|info
comma
id|code
)paren
suffix:semicolon
id|verify_area
c_func
(paren
id|address
comma
l_int|2
)paren
suffix:semicolon
id|put_fs_word
c_func
(paren
id|I387.swd
comma
(paren
r_int
op_star
)paren
id|address
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xe2
suffix:colon
id|put_short_int
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xe3
suffix:colon
id|put_short_int
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xe4
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|get_BCD
c_func
(paren
op_amp
id|tmp
comma
id|info
comma
id|code
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xe5
suffix:colon
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|get_longlong_int
c_func
(paren
op_amp
id|tmp
comma
id|info
comma
id|code
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xe6
suffix:colon
id|put_BCD
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|0xe7
suffix:colon
id|put_longlong_int
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
id|info
comma
id|code
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|code
op_rshift
l_int|9
)paren
(brace
r_case
l_int|0
suffix:colon
id|get_short_real
c_func
(paren
op_amp
id|tmp
comma
id|info
comma
id|code
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|get_long_int
c_func
(paren
op_amp
id|tmp
comma
id|info
comma
id|code
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|get_long_real
c_func
(paren
op_amp
id|tmp
comma
id|info
comma
id|code
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|get_short_int
c_func
(paren
op_amp
id|tmp
comma
id|info
comma
id|code
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
(paren
id|code
op_rshift
l_int|3
)paren
op_amp
l_int|0x27
)paren
(brace
r_case
l_int|0
suffix:colon
id|fadd
c_func
(paren
op_amp
id|tmp
comma
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|1
suffix:colon
id|fmul
c_func
(paren
op_amp
id|tmp
comma
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|2
suffix:colon
id|fcom
c_func
(paren
op_amp
id|tmp
comma
id|PST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|3
suffix:colon
id|fcom
c_func
(paren
op_amp
id|tmp
comma
id|PST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|fpop
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|4
suffix:colon
id|tmp.exponent
op_xor_assign
l_int|0x8000
suffix:semicolon
id|fadd
c_func
(paren
op_amp
id|tmp
comma
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|5
suffix:colon
id|ST
c_func
(paren
l_int|0
)paren
dot
id|exponent
op_xor_assign
l_int|0x8000
suffix:semicolon
id|fadd
c_func
(paren
op_amp
id|tmp
comma
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|6
suffix:colon
id|fdiv
c_func
(paren
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|7
suffix:colon
id|fdiv
c_func
(paren
op_amp
id|tmp
comma
id|PST
c_func
(paren
l_int|0
)paren
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|code
op_amp
l_int|0x138
)paren
op_eq
l_int|0x100
)paren
(brace
id|fpush
c_func
(paren
)paren
suffix:semicolon
id|real_to_real
c_func
(paren
op_amp
id|tmp
comma
op_amp
id|ST
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Unknown math-insns: %04x:%08x %04x&bslash;n&bslash;r&quot;
comma
id|CS
comma
id|EIP
comma
id|code
)paren
suffix:semicolon
id|math_abort
c_func
(paren
id|info
comma
l_int|1
op_lshift
(paren
id|SIGFPE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|math_emulate
r_void
id|math_emulate
c_func
(paren
r_int
id|___false
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|current-&gt;used_math
)paren
(brace
id|current-&gt;used_math
op_assign
l_int|1
suffix:semicolon
id|I387.cwd
op_assign
l_int|0x037f
suffix:semicolon
id|I387.swd
op_assign
l_int|0x0000
suffix:semicolon
id|I387.twd
op_assign
l_int|0x0000
suffix:semicolon
)brace
id|do_emu
c_func
(paren
(paren
r_struct
id|info
op_star
)paren
op_amp
id|___false
)paren
suffix:semicolon
)brace
DECL|function|__math_abort
r_void
id|__math_abort
c_func
(paren
r_struct
id|info
op_star
id|info
comma
r_int
r_int
id|signal
)paren
(brace
id|EIP
op_assign
id|ORIG_EIP
suffix:semicolon
id|current-&gt;signal
op_or_assign
id|signal
suffix:semicolon
id|__asm__
c_func
(paren
l_string|&quot;movl %0,%%esp ; ret&quot;
op_scope_resolution
l_string|&quot;g&quot;
(paren
(paren
(paren
r_int
)paren
id|info
)paren
op_minus
l_int|4
)paren
)paren
suffix:semicolon
)brace
DECL|function|fpop
r_static
r_void
id|fpop
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|I387.swd
op_amp
l_int|0xffffc7ff
suffix:semicolon
id|I387.swd
op_add_assign
l_int|0x00000800
suffix:semicolon
id|I387.swd
op_and_assign
l_int|0x00003800
suffix:semicolon
id|I387.swd
op_or_assign
id|tmp
suffix:semicolon
)brace
DECL|function|fpush
r_static
r_void
id|fpush
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|I387.swd
op_amp
l_int|0xffffc7ff
suffix:semicolon
id|I387.swd
op_add_assign
l_int|0x00003800
suffix:semicolon
id|I387.swd
op_and_assign
l_int|0x00003800
suffix:semicolon
id|I387.swd
op_or_assign
id|tmp
suffix:semicolon
)brace
DECL|function|fxchg
r_static
r_void
id|fxchg
c_func
(paren
id|temp_real_unaligned
op_star
id|a
comma
id|temp_real_unaligned
op_star
id|b
)paren
(brace
id|temp_real_unaligned
id|c
suffix:semicolon
id|c
op_assign
op_star
id|a
suffix:semicolon
op_star
id|a
op_assign
op_star
id|b
suffix:semicolon
op_star
id|b
op_assign
id|c
suffix:semicolon
)brace
DECL|function|__st
r_static
id|temp_real_unaligned
op_star
id|__st
c_func
(paren
r_int
id|i
)paren
(brace
id|i
op_add_assign
id|I387.swd
op_rshift
l_int|11
suffix:semicolon
id|i
op_and_assign
l_int|7
suffix:semicolon
r_return
(paren
id|temp_real_unaligned
op_star
)paren
(paren
id|i
op_star
l_int|10
op_plus
(paren
r_char
op_star
)paren
(paren
id|I387.st_space
)paren
)paren
suffix:semicolon
)brace
macro_line|#else /* no math emulation */
macro_line|#include &lt;signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
DECL|function|math_emulate
r_void
id|math_emulate
c_func
(paren
r_int
id|___false
)paren
(brace
id|current-&gt;signal
op_or_assign
l_int|1
op_lshift
(paren
id|SIGFPE
op_minus
l_int|1
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* KERNEL_MATH_EMULATION */
eof
