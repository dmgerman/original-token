multiline_comment|/*&n; * linux/kernel/math/math_emulate.c&n; *&n; * (C) 1991 Linus Torvalds&n; */
multiline_comment|/*&n; * This directory should contain the math-emulation code.&n; * Currently only results in a signal.&n; */
macro_line|#include &lt;signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
DECL|function|math_emulate
r_void
id|math_emulate
c_func
(paren
r_int
id|edi
comma
r_int
id|esi
comma
r_int
id|ebp
comma
r_int
id|sys_call_ret
comma
r_int
id|eax
comma
r_int
id|ebx
comma
r_int
id|ecx
comma
r_int
id|edx
comma
r_int
r_int
id|fs
comma
r_int
r_int
id|es
comma
r_int
r_int
id|ds
comma
r_int
r_int
id|eip
comma
r_int
r_int
id|cs
comma
r_int
r_int
id|eflags
comma
r_int
r_int
id|ss
comma
r_int
r_int
id|esp
)paren
(brace
r_int
r_char
id|first
comma
id|second
suffix:semicolon
multiline_comment|/* 0x0007 means user code space */
r_if
c_cond
(paren
id|cs
op_ne
l_int|0x000F
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;math_emulate: %04x:%08x&bslash;n&bslash;r&quot;
comma
id|cs
comma
id|eip
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Math emulation needed in kernel&quot;
)paren
suffix:semicolon
)brace
id|first
op_assign
id|get_fs_byte
c_func
(paren
(paren
r_char
op_star
)paren
(paren
(paren
op_star
op_amp
id|eip
)paren
op_increment
)paren
)paren
suffix:semicolon
id|second
op_assign
id|get_fs_byte
c_func
(paren
(paren
r_char
op_star
)paren
(paren
(paren
op_star
op_amp
id|eip
)paren
op_increment
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%04x:%08x %02x %02x&bslash;n&bslash;r&quot;
comma
id|cs
comma
id|eip
op_minus
l_int|2
comma
id|first
comma
id|second
)paren
suffix:semicolon
id|current-&gt;signal
op_or_assign
l_int|1
op_lshift
(paren
id|SIGFPE
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|math_error
r_void
id|math_error
c_func
(paren
r_void
)paren
(brace
id|__asm__
c_func
(paren
l_string|&quot;fnclex&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|last_task_used_math
)paren
id|last_task_used_math-&gt;signal
op_or_assign
l_int|1
op_lshift
(paren
id|SIGFPE
op_minus
l_int|1
)paren
suffix:semicolon
)brace
eof
