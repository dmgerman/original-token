multiline_comment|/*&n; * linux/kernel/math/ea.c&n; *&n; * Copyright (C) 1991, 1992 Linus Torvalds&n; */
multiline_comment|/*&n; * Calculate the effective address.&n; */
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/math_emu.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
DECL|variable|__regoffset
r_static
r_int
id|__regoffset
(braket
)braket
op_assign
(brace
m_offsetof
(paren
r_struct
id|info
comma
id|___eax
)paren
comma
m_offsetof
(paren
r_struct
id|info
comma
id|___ecx
)paren
comma
m_offsetof
(paren
r_struct
id|info
comma
id|___edx
)paren
comma
m_offsetof
(paren
r_struct
id|info
comma
id|___ebx
)paren
comma
m_offsetof
(paren
r_struct
id|info
comma
id|___esp
)paren
comma
m_offsetof
(paren
r_struct
id|info
comma
id|___ebp
)paren
comma
m_offsetof
(paren
r_struct
id|info
comma
id|___esi
)paren
comma
m_offsetof
(paren
r_struct
id|info
comma
id|___edi
)paren
)brace
suffix:semicolon
DECL|macro|REG
mdefine_line|#define REG(x) (*(long *)(__regoffset[(x)]+(char *) info))
DECL|function|sib
r_static
r_char
op_star
id|sib
c_func
(paren
r_struct
id|info
op_star
id|info
comma
r_int
id|mod
)paren
(brace
r_int
r_char
id|ss
comma
id|index
comma
id|base
suffix:semicolon
r_int
id|offset
op_assign
l_int|0
suffix:semicolon
id|base
op_assign
id|get_fs_byte
c_func
(paren
(paren
r_char
op_star
)paren
id|EIP
)paren
suffix:semicolon
id|EIP
op_increment
suffix:semicolon
id|ss
op_assign
id|base
op_rshift
l_int|6
suffix:semicolon
id|index
op_assign
(paren
id|base
op_rshift
l_int|3
)paren
op_amp
l_int|7
suffix:semicolon
id|base
op_and_assign
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
l_int|4
)paren
id|offset
op_assign
l_int|0
suffix:semicolon
r_else
id|offset
op_assign
id|REG
c_func
(paren
id|index
)paren
suffix:semicolon
id|offset
op_lshift_assign
id|ss
suffix:semicolon
r_if
c_cond
(paren
id|mod
op_logical_or
id|base
op_ne
l_int|5
)paren
id|offset
op_add_assign
id|REG
c_func
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mod
op_eq
l_int|1
)paren
(brace
id|offset
op_add_assign
(paren
r_int
r_char
)paren
id|get_fs_byte
c_func
(paren
(paren
r_char
op_star
)paren
id|EIP
)paren
suffix:semicolon
id|EIP
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|mod
op_eq
l_int|2
op_logical_or
id|base
op_eq
l_int|5
)paren
(brace
id|offset
op_add_assign
(paren
r_int
)paren
id|get_fs_long
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|EIP
)paren
suffix:semicolon
id|EIP
op_add_assign
l_int|4
suffix:semicolon
)brace
id|I387.foo
op_assign
id|offset
suffix:semicolon
id|I387.fos
op_assign
l_int|0x17
suffix:semicolon
r_return
(paren
r_char
op_star
)paren
id|offset
suffix:semicolon
)brace
DECL|function|ea
r_char
op_star
id|ea
c_func
(paren
r_struct
id|info
op_star
id|info
comma
r_int
r_int
id|code
)paren
(brace
r_int
r_char
id|mod
comma
id|rm
suffix:semicolon
r_int
op_star
id|tmp
suffix:semicolon
r_int
id|offset
op_assign
l_int|0
suffix:semicolon
id|mod
op_assign
(paren
id|code
op_rshift
l_int|6
)paren
op_amp
l_int|3
suffix:semicolon
id|rm
op_assign
id|code
op_amp
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|rm
op_eq
l_int|4
op_logical_and
id|mod
op_ne
l_int|3
)paren
r_return
id|sib
c_func
(paren
id|info
comma
id|mod
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rm
op_eq
l_int|5
op_logical_and
op_logical_neg
id|mod
)paren
(brace
id|offset
op_assign
id|get_fs_long
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|EIP
)paren
suffix:semicolon
id|EIP
op_add_assign
l_int|4
suffix:semicolon
id|I387.foo
op_assign
id|offset
suffix:semicolon
id|I387.fos
op_assign
l_int|0x17
suffix:semicolon
r_return
(paren
r_char
op_star
)paren
id|offset
suffix:semicolon
)brace
id|tmp
op_assign
op_amp
id|REG
c_func
(paren
id|rm
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mod
)paren
(brace
r_case
l_int|0
suffix:colon
id|offset
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|offset
op_assign
(paren
r_int
r_char
)paren
id|get_fs_byte
c_func
(paren
(paren
r_char
op_star
)paren
id|EIP
)paren
suffix:semicolon
id|EIP
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|offset
op_assign
(paren
r_int
)paren
id|get_fs_long
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|EIP
)paren
suffix:semicolon
id|EIP
op_add_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|math_abort
c_func
(paren
id|info
comma
id|SIGILL
)paren
suffix:semicolon
)brace
id|I387.foo
op_assign
id|offset
suffix:semicolon
id|I387.fos
op_assign
l_int|0x17
suffix:semicolon
r_return
id|offset
op_plus
(paren
r_char
op_star
)paren
op_star
id|tmp
suffix:semicolon
)brace
eof
