multiline_comment|/*&n; *  linux/kernel/console.c&n; *&n; *  (C) 1991  Linus Torvalds&n; */
multiline_comment|/*&n; *&t;console.c&n; *&n; * This module implements the console io functions&n; *&t;&squot;void con_init(void)&squot;&n; *&t;&squot;void con_write(struct tty_queue * queue)&squot;&n; * Hopefully this will be a rather complete VT102 implementation.&n; *&n; * Beeping thanks to John T Kohl.&n; */
multiline_comment|/*&n; *  NOTE!!! We sometimes disable and enable interrupts for a short while&n; * (to put a word in video IO), but this will work even for keyboard&n; * interrupts. We know interrupts aren&squot;t enabled when getting a keyboard&n; * interrupt, as we use trap-gates. Hopefully all is well.&n; */
multiline_comment|/*&n; * Code to check for different video-cards mostly by Galen Hunt,&n; * &lt;g-hunt@ee.utah.edu&gt;&n; */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
multiline_comment|/*&n; * These are set up by the setup-routine at boot-time:&n; */
DECL|macro|ORIG_X
mdefine_line|#define ORIG_X&t;&t;&t;(*(unsigned char *)0x90000)
DECL|macro|ORIG_Y
mdefine_line|#define ORIG_Y&t;&t;&t;(*(unsigned char *)0x90001)
DECL|macro|ORIG_VIDEO_PAGE
mdefine_line|#define ORIG_VIDEO_PAGE&t;&t;(*(unsigned short *)0x90004)
DECL|macro|ORIG_VIDEO_MODE
mdefine_line|#define ORIG_VIDEO_MODE&t;&t;((*(unsigned short *)0x90006) &amp; 0xff)
DECL|macro|ORIG_VIDEO_COLS
mdefine_line|#define ORIG_VIDEO_COLS &t;(((*(unsigned short *)0x90006) &amp; 0xff00) &gt;&gt; 8)
DECL|macro|ORIG_VIDEO_LINES
mdefine_line|#define ORIG_VIDEO_LINES&t;(25)
DECL|macro|ORIG_VIDEO_EGA_AX
mdefine_line|#define ORIG_VIDEO_EGA_AX&t;(*(unsigned short *)0x90008)
DECL|macro|ORIG_VIDEO_EGA_BX
mdefine_line|#define ORIG_VIDEO_EGA_BX&t;(*(unsigned short *)0x9000a)
DECL|macro|ORIG_VIDEO_EGA_CX
mdefine_line|#define ORIG_VIDEO_EGA_CX&t;(*(unsigned short *)0x9000c)
DECL|macro|VIDEO_TYPE_MDA
mdefine_line|#define VIDEO_TYPE_MDA&t;&t;0x10&t;/* Monochrome Text Display&t;*/
DECL|macro|VIDEO_TYPE_CGA
mdefine_line|#define VIDEO_TYPE_CGA&t;&t;0x11&t;/* CGA Display &t;&t;&t;*/
DECL|macro|VIDEO_TYPE_EGAM
mdefine_line|#define VIDEO_TYPE_EGAM&t;&t;0x20&t;/* EGA/VGA in Monochrome Mode&t;*/
DECL|macro|VIDEO_TYPE_EGAC
mdefine_line|#define VIDEO_TYPE_EGAC&t;&t;0x21&t;/* EGA/VGA in Color Mode&t;*/
DECL|macro|NPAR
mdefine_line|#define NPAR 16
r_extern
r_void
id|keyboard_interrupt
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|video_type
r_static
r_int
r_char
id|video_type
suffix:semicolon
multiline_comment|/* Type of display being used&t;*/
DECL|variable|video_num_columns
r_static
r_int
r_int
id|video_num_columns
suffix:semicolon
multiline_comment|/* Number of text columns&t;*/
DECL|variable|video_size_row
r_static
r_int
r_int
id|video_size_row
suffix:semicolon
multiline_comment|/* Bytes per row&t;&t;*/
DECL|variable|video_num_lines
r_static
r_int
r_int
id|video_num_lines
suffix:semicolon
multiline_comment|/* Number of test lines&t;&t;*/
DECL|variable|video_page
r_static
r_int
r_char
id|video_page
suffix:semicolon
multiline_comment|/* Initial video page&t;&t;*/
DECL|variable|video_mem_start
r_static
r_int
r_int
id|video_mem_start
suffix:semicolon
multiline_comment|/* Start of video RAM&t;&t;*/
DECL|variable|video_mem_end
r_static
r_int
r_int
id|video_mem_end
suffix:semicolon
multiline_comment|/* End of video RAM (sort of)&t;*/
DECL|variable|video_port_reg
r_static
r_int
r_int
id|video_port_reg
suffix:semicolon
multiline_comment|/* Video register select port&t;*/
DECL|variable|video_port_val
r_static
r_int
r_int
id|video_port_val
suffix:semicolon
multiline_comment|/* Video register value port&t;*/
DECL|variable|video_erase_char
r_static
r_int
r_int
id|video_erase_char
suffix:semicolon
multiline_comment|/* Char+Attrib to erase with&t;*/
DECL|variable|origin
r_static
r_int
r_int
id|origin
suffix:semicolon
multiline_comment|/* Used for EGA/VGA fast scroll&t;*/
DECL|variable|scr_end
r_static
r_int
r_int
id|scr_end
suffix:semicolon
multiline_comment|/* Used for EGA/VGA fast scroll&t;*/
DECL|variable|pos
r_static
r_int
r_int
id|pos
suffix:semicolon
DECL|variable|x
DECL|variable|y
r_static
r_int
r_int
id|x
comma
id|y
suffix:semicolon
DECL|variable|top
DECL|variable|bottom
r_static
r_int
r_int
id|top
comma
id|bottom
suffix:semicolon
DECL|variable|state
r_static
r_int
r_int
id|state
op_assign
l_int|0
suffix:semicolon
DECL|variable|npar
DECL|variable|par
r_static
r_int
r_int
id|npar
comma
id|par
(braket
id|NPAR
)braket
suffix:semicolon
DECL|variable|ques
r_static
r_int
r_int
id|ques
op_assign
l_int|0
suffix:semicolon
DECL|variable|attr
r_static
r_int
r_char
id|attr
op_assign
l_int|0x07
suffix:semicolon
r_static
r_void
id|sysbeep
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; * this is what the terminal answers to a ESC-Z or csi0c&n; * query (= vt100 response).&n; */
DECL|macro|RESPONSE
mdefine_line|#define RESPONSE &quot;&bslash;033[?1;2c&quot;
multiline_comment|/* NOTE! gotoxy thinks x==video_num_columns is ok */
DECL|function|gotoxy
r_static
r_inline
r_void
id|gotoxy
c_func
(paren
r_int
r_int
id|new_x
comma
r_int
r_int
id|new_y
)paren
(brace
r_if
c_cond
(paren
id|new_x
OG
id|video_num_columns
op_logical_or
id|new_y
op_ge
id|video_num_lines
)paren
r_return
suffix:semicolon
id|x
op_assign
id|new_x
suffix:semicolon
id|y
op_assign
id|new_y
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|set_origin
r_static
r_inline
r_void
id|set_origin
c_func
(paren
r_void
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|12
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|origin
op_minus
id|video_mem_start
)paren
op_rshift
l_int|9
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|13
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|origin
op_minus
id|video_mem_start
)paren
op_rshift
l_int|1
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|scrup
r_static
r_void
id|scrup
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|video_type
op_eq
id|VIDEO_TYPE_EGAC
op_logical_or
id|video_type
op_eq
id|VIDEO_TYPE_EGAM
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|top
op_logical_and
id|bottom
op_eq
id|video_num_lines
)paren
(brace
id|origin
op_add_assign
id|video_size_row
suffix:semicolon
id|pos
op_add_assign
id|video_size_row
suffix:semicolon
id|scr_end
op_add_assign
id|video_size_row
suffix:semicolon
r_if
c_cond
(paren
id|scr_end
OG
id|video_mem_end
)paren
(brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;movsl&bslash;n&bslash;t&quot;
l_string|&quot;movl _video_num_columns,%1&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
comma
l_string|&quot;c&quot;
(paren
(paren
id|video_num_lines
op_minus
l_int|1
)paren
op_star
id|video_num_columns
op_rshift
l_int|1
)paren
comma
l_string|&quot;D&quot;
(paren
id|video_mem_start
)paren
comma
l_string|&quot;S&quot;
(paren
id|origin
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
comma
l_string|&quot;si&quot;
)paren
suffix:semicolon
id|scr_end
op_sub_assign
id|origin
op_minus
id|video_mem_start
suffix:semicolon
id|pos
op_sub_assign
id|origin
op_minus
id|video_mem_start
suffix:semicolon
id|origin
op_assign
id|video_mem_start
suffix:semicolon
)brace
r_else
(brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
comma
l_string|&quot;c&quot;
(paren
id|video_num_columns
)paren
comma
l_string|&quot;D&quot;
(paren
id|scr_end
op_minus
id|video_size_row
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
)paren
suffix:semicolon
)brace
id|set_origin
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;movsl&bslash;n&bslash;t&quot;
l_string|&quot;movl _video_num_columns,%%ecx&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
comma
l_string|&quot;c&quot;
(paren
(paren
id|bottom
op_minus
id|top
op_minus
l_int|1
)paren
op_star
id|video_num_columns
op_rshift
l_int|1
)paren
comma
l_string|&quot;D&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
id|top
)paren
comma
l_string|&quot;S&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
(paren
id|top
op_plus
l_int|1
)paren
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
comma
l_string|&quot;si&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* Not EGA/VGA */
(brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;movsl&bslash;n&bslash;t&quot;
l_string|&quot;movl _video_num_columns,%%ecx&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
comma
l_string|&quot;c&quot;
(paren
(paren
id|bottom
op_minus
id|top
op_minus
l_int|1
)paren
op_star
id|video_num_columns
op_rshift
l_int|1
)paren
comma
l_string|&quot;D&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
id|top
)paren
comma
l_string|&quot;S&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
(paren
id|top
op_plus
l_int|1
)paren
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
comma
l_string|&quot;si&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|scrdown
r_static
r_void
id|scrdown
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|video_type
op_eq
id|VIDEO_TYPE_EGAC
op_logical_or
id|video_type
op_eq
id|VIDEO_TYPE_EGAM
)paren
(brace
id|__asm__
c_func
(paren
l_string|&quot;std&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;movsl&bslash;n&bslash;t&quot;
l_string|&quot;addl $2,%%edi&bslash;n&bslash;t&quot;
multiline_comment|/* %edi has been decremented by 4 */
l_string|&quot;movl _video_num_columns,%%ecx&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
comma
l_string|&quot;c&quot;
(paren
(paren
id|bottom
op_minus
id|top
op_minus
l_int|1
)paren
op_star
id|video_num_columns
op_rshift
l_int|1
)paren
comma
l_string|&quot;D&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
id|bottom
op_minus
l_int|4
)paren
comma
l_string|&quot;S&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
(paren
id|bottom
op_minus
l_int|1
)paren
op_minus
l_int|4
)paren
suffix:colon
l_string|&quot;ax&quot;
comma
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
comma
l_string|&quot;si&quot;
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* Not EGA/VGA */
(brace
id|__asm__
c_func
(paren
l_string|&quot;std&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;movsl&bslash;n&bslash;t&quot;
l_string|&quot;addl $2,%%edi&bslash;n&bslash;t&quot;
multiline_comment|/* %edi has been decremented by 4 */
l_string|&quot;movl _video_num_columns,%%ecx&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
comma
l_string|&quot;c&quot;
(paren
(paren
id|bottom
op_minus
id|top
op_minus
l_int|1
)paren
op_star
id|video_num_columns
op_rshift
l_int|1
)paren
comma
l_string|&quot;D&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
id|bottom
op_minus
l_int|4
)paren
comma
l_string|&quot;S&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
(paren
id|bottom
op_minus
l_int|1
)paren
op_minus
l_int|4
)paren
suffix:colon
l_string|&quot;ax&quot;
comma
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
comma
l_string|&quot;si&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|lf
r_static
r_void
id|lf
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|y
op_plus
l_int|1
OL
id|bottom
)paren
(brace
id|y
op_increment
suffix:semicolon
id|pos
op_add_assign
id|video_size_row
suffix:semicolon
r_return
suffix:semicolon
)brace
id|scrup
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ri
r_static
r_void
id|ri
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|y
OG
id|top
)paren
(brace
id|y
op_decrement
suffix:semicolon
id|pos
op_sub_assign
id|video_size_row
suffix:semicolon
r_return
suffix:semicolon
)brace
id|scrdown
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cr
r_static
r_void
id|cr
c_func
(paren
r_void
)paren
(brace
id|pos
op_sub_assign
id|x
op_lshift
l_int|1
suffix:semicolon
id|x
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|del
r_static
r_void
id|del
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|x
)paren
(brace
id|pos
op_sub_assign
l_int|2
suffix:semicolon
id|x
op_decrement
suffix:semicolon
op_star
(paren
r_int
r_int
op_star
)paren
id|pos
op_assign
id|video_erase_char
suffix:semicolon
)brace
)brace
DECL|function|csi_J
r_static
r_void
id|csi_J
c_func
(paren
r_int
id|par
)paren
(brace
r_int
id|count
id|__asm__
c_func
(paren
l_string|&quot;cx&quot;
)paren
suffix:semicolon
r_int
id|start
id|__asm__
c_func
(paren
l_string|&quot;di&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|par
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* erase from cursor to end of display */
id|count
op_assign
(paren
id|scr_end
op_minus
id|pos
)paren
op_rshift
l_int|1
suffix:semicolon
id|start
op_assign
id|pos
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* erase from start to cursor */
id|count
op_assign
(paren
id|pos
op_minus
id|origin
)paren
op_rshift
l_int|1
suffix:semicolon
id|start
op_assign
id|origin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* erase whole display */
id|count
op_assign
id|video_num_columns
op_star
id|video_num_lines
suffix:semicolon
id|start
op_assign
id|origin
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;c&quot;
(paren
id|count
)paren
comma
l_string|&quot;D&quot;
(paren
id|start
)paren
comma
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
)paren
suffix:semicolon
)brace
DECL|function|csi_K
r_static
r_void
id|csi_K
c_func
(paren
r_int
id|par
)paren
(brace
r_int
id|count
id|__asm__
c_func
(paren
l_string|&quot;cx&quot;
)paren
suffix:semicolon
r_int
id|start
id|__asm__
c_func
(paren
l_string|&quot;di&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|par
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* erase from cursor to end of line */
r_if
c_cond
(paren
id|x
op_ge
id|video_num_columns
)paren
r_return
suffix:semicolon
id|count
op_assign
id|video_num_columns
op_minus
id|x
suffix:semicolon
id|start
op_assign
id|pos
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* erase from start of line to cursor */
id|start
op_assign
id|pos
op_minus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
id|count
op_assign
(paren
id|x
OL
id|video_num_columns
)paren
ques
c_cond
id|x
suffix:colon
id|video_num_columns
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* erase whole line */
id|start
op_assign
id|pos
op_minus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
id|count
op_assign
id|video_num_columns
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;c&quot;
(paren
id|count
)paren
comma
l_string|&quot;D&quot;
(paren
id|start
)paren
comma
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
)paren
suffix:semicolon
)brace
DECL|function|csi_m
r_void
id|csi_m
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|npar
suffix:semicolon
id|i
op_increment
)paren
r_switch
c_cond
(paren
id|par
(braket
id|i
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
id|attr
op_assign
l_int|0x07
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|attr
op_assign
l_int|0x0f
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|attr
op_assign
l_int|0x0f
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|attr
op_assign
l_int|0x70
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|27
suffix:colon
id|attr
op_assign
l_int|0x07
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|set_cursor
r_static
r_inline
r_void
id|set_cursor
c_func
(paren
r_void
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|14
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|pos
op_minus
id|video_mem_start
)paren
op_rshift
l_int|9
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|15
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|pos
op_minus
id|video_mem_start
)paren
op_rshift
l_int|1
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|respond
r_static
r_void
id|respond
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_char
op_star
id|p
op_assign
id|RESPONSE
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
)paren
(brace
id|PUTCH
c_func
(paren
op_star
id|p
comma
id|tty-&gt;read_q
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|copy_to_cooked
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
DECL|function|insert_char
r_static
r_void
id|insert_char
c_func
(paren
r_void
)paren
(brace
r_int
id|i
op_assign
id|x
suffix:semicolon
r_int
r_int
id|tmp
comma
id|old
op_assign
id|video_erase_char
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_while
c_loop
(paren
id|i
op_increment
OL
id|video_num_columns
)paren
(brace
id|tmp
op_assign
op_star
id|p
suffix:semicolon
op_star
id|p
op_assign
id|old
suffix:semicolon
id|old
op_assign
id|tmp
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
)brace
DECL|function|insert_line
r_static
r_void
id|insert_line
c_func
(paren
r_void
)paren
(brace
r_int
id|oldtop
comma
id|oldbottom
suffix:semicolon
id|oldtop
op_assign
id|top
suffix:semicolon
id|oldbottom
op_assign
id|bottom
suffix:semicolon
id|top
op_assign
id|y
suffix:semicolon
id|bottom
op_assign
id|video_num_lines
suffix:semicolon
id|scrdown
c_func
(paren
)paren
suffix:semicolon
id|top
op_assign
id|oldtop
suffix:semicolon
id|bottom
op_assign
id|oldbottom
suffix:semicolon
)brace
DECL|function|delete_char
r_static
r_void
id|delete_char
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|x
op_ge
id|video_num_columns
)paren
r_return
suffix:semicolon
id|i
op_assign
id|x
suffix:semicolon
r_while
c_loop
(paren
op_increment
id|i
OL
id|video_num_columns
)paren
(brace
op_star
id|p
op_assign
op_star
(paren
id|p
op_plus
l_int|1
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
op_star
id|p
op_assign
id|video_erase_char
suffix:semicolon
)brace
DECL|function|delete_line
r_static
r_void
id|delete_line
c_func
(paren
r_void
)paren
(brace
r_int
id|oldtop
comma
id|oldbottom
suffix:semicolon
id|oldtop
op_assign
id|top
suffix:semicolon
id|oldbottom
op_assign
id|bottom
suffix:semicolon
id|top
op_assign
id|y
suffix:semicolon
id|bottom
op_assign
id|video_num_lines
suffix:semicolon
id|scrup
c_func
(paren
)paren
suffix:semicolon
id|top
op_assign
id|oldtop
suffix:semicolon
id|bottom
op_assign
id|oldbottom
suffix:semicolon
)brace
DECL|function|csi_at
r_static
r_void
id|csi_at
c_func
(paren
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_columns
)paren
id|nr
op_assign
id|video_num_columns
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|insert_char
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|csi_L
r_static
r_void
id|csi_L
c_func
(paren
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_lines
)paren
id|nr
op_assign
id|video_num_lines
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|insert_line
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|csi_P
r_static
r_void
id|csi_P
c_func
(paren
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_columns
)paren
id|nr
op_assign
id|video_num_columns
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|delete_char
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|csi_M
r_static
r_void
id|csi_M
c_func
(paren
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_lines
)paren
id|nr
op_assign
id|video_num_lines
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|delete_line
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|saved_x
r_static
r_int
id|saved_x
op_assign
l_int|0
suffix:semicolon
DECL|variable|saved_y
r_static
r_int
id|saved_y
op_assign
l_int|0
suffix:semicolon
DECL|function|save_cur
r_static
r_void
id|save_cur
c_func
(paren
r_void
)paren
(brace
id|saved_x
op_assign
id|x
suffix:semicolon
id|saved_y
op_assign
id|y
suffix:semicolon
)brace
DECL|function|restore_cur
r_static
r_void
id|restore_cur
c_func
(paren
r_void
)paren
(brace
id|gotoxy
c_func
(paren
id|saved_x
comma
id|saved_y
)paren
suffix:semicolon
)brace
DECL|function|con_write
r_void
id|con_write
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_int
id|nr
suffix:semicolon
r_char
id|c
suffix:semicolon
id|nr
op_assign
id|CHARS
c_func
(paren
id|tty-&gt;write_q
)paren
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
(brace
id|GETCH
c_func
(paren
id|tty-&gt;write_q
comma
id|c
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|c
OG
l_int|31
op_logical_and
id|c
OL
l_int|127
)paren
(brace
r_if
c_cond
(paren
id|x
op_ge
id|video_num_columns
)paren
(brace
id|x
op_sub_assign
id|video_num_columns
suffix:semicolon
id|pos
op_sub_assign
id|video_size_row
suffix:semicolon
id|lf
c_func
(paren
)paren
suffix:semicolon
)brace
id|__asm__
c_func
(paren
l_string|&quot;movb _attr,%%ah&bslash;n&bslash;t&quot;
l_string|&quot;movw %%ax,%1&bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|c
)paren
comma
l_string|&quot;m&quot;
(paren
op_star
(paren
r_int
op_star
)paren
id|pos
)paren
suffix:colon
l_string|&quot;ax&quot;
)paren
suffix:semicolon
id|pos
op_add_assign
l_int|2
suffix:semicolon
id|x
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|27
)paren
id|state
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|10
op_logical_or
id|c
op_eq
l_int|11
op_logical_or
id|c
op_eq
l_int|12
)paren
id|lf
c_func
(paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|13
)paren
id|cr
c_func
(paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
id|ERASE_CHAR
c_func
(paren
id|tty
)paren
)paren
id|del
c_func
(paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|x
)paren
(brace
id|x
op_decrement
suffix:semicolon
id|pos
op_sub_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|9
)paren
(brace
id|c
op_assign
l_int|8
op_minus
(paren
id|x
op_amp
l_int|7
)paren
suffix:semicolon
id|x
op_add_assign
id|c
suffix:semicolon
id|pos
op_add_assign
id|c
op_lshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|x
OG
id|video_num_columns
)paren
(brace
id|x
op_sub_assign
id|video_num_columns
suffix:semicolon
id|pos
op_sub_assign
id|video_size_row
suffix:semicolon
id|lf
c_func
(paren
)paren
suffix:semicolon
)brace
id|c
op_assign
l_int|9
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|7
)paren
id|sysbeep
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|state
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;[&squot;
)paren
id|state
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;E&squot;
)paren
id|gotoxy
c_func
(paren
l_int|0
comma
id|y
op_plus
l_int|1
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;M&squot;
)paren
id|ri
c_func
(paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;D&squot;
)paren
id|lf
c_func
(paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;Z&squot;
)paren
id|respond
c_func
(paren
id|tty
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|x
op_eq
l_char|&squot;7&squot;
)paren
id|save_cur
c_func
(paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|x
op_eq
l_char|&squot;8&squot;
)paren
id|restore_cur
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_for
c_loop
(paren
id|npar
op_assign
l_int|0
suffix:semicolon
id|npar
OL
id|NPAR
suffix:semicolon
id|npar
op_increment
)paren
(brace
id|par
(braket
id|npar
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|npar
op_assign
l_int|0
suffix:semicolon
id|state
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|ques
op_assign
(paren
id|c
op_eq
l_char|&squot;?&squot;
)paren
)paren
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;;&squot;
op_logical_and
id|npar
OL
id|NPAR
op_minus
l_int|1
)paren
(brace
id|npar
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_ge
l_char|&squot;0&squot;
op_logical_and
id|c
op_le
l_char|&squot;9&squot;
)paren
(brace
id|par
(braket
id|npar
)braket
op_assign
l_int|10
op_star
id|par
(braket
id|npar
)braket
op_plus
id|c
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|state
op_assign
l_int|4
suffix:semicolon
r_case
l_int|4
suffix:colon
id|state
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;G&squot;
suffix:colon
r_case
l_char|&squot;`&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
id|gotoxy
c_func
(paren
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;A&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|x
comma
id|y
op_minus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;B&squot;
suffix:colon
r_case
l_char|&squot;e&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|x
comma
id|y
op_plus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;C&squot;
suffix:colon
r_case
l_char|&squot;a&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|x
op_plus
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|x
op_minus
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;E&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
l_int|0
comma
id|y
op_plus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;F&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
l_int|0
comma
id|y
op_minus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;d&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
id|gotoxy
c_func
(paren
id|x
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;H&squot;
suffix:colon
r_case
l_char|&squot;f&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|par
(braket
l_int|1
)braket
)paren
id|par
(braket
l_int|1
)braket
op_decrement
suffix:semicolon
id|gotoxy
c_func
(paren
id|par
(braket
l_int|1
)braket
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;J&squot;
suffix:colon
id|csi_J
c_func
(paren
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;K&squot;
suffix:colon
id|csi_K
c_func
(paren
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;L&squot;
suffix:colon
id|csi_L
c_func
(paren
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|csi_M
c_func
(paren
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;P&squot;
suffix:colon
id|csi_P
c_func
(paren
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;@&squot;
suffix:colon
id|csi_at
c_func
(paren
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;m&squot;
suffix:colon
id|csi_m
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;r&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|1
)braket
)paren
id|par
(braket
l_int|1
)braket
op_assign
id|video_num_lines
suffix:semicolon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
OL
id|par
(braket
l_int|1
)braket
op_logical_and
id|par
(braket
l_int|1
)braket
op_le
id|video_num_lines
)paren
(brace
id|top
op_assign
id|par
(braket
l_int|0
)braket
suffix:semicolon
id|bottom
op_assign
id|par
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_char|&squot;s&squot;
suffix:colon
id|save_cur
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;u&squot;
suffix:colon
id|restore_cur
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
id|set_cursor
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  void con_init(void);&n; *&n; * This routine initalizes console interrupts, and does nothing&n; * else. If you want the screen to clear, call tty_write with&n; * the appropriate escape-sequece.&n; *&n; * Reads the information preserved by setup.s to determine the current display&n; * type and sets everything accordingly.&n; */
DECL|function|con_init
r_void
id|con_init
c_func
(paren
r_void
)paren
(brace
r_register
r_int
r_char
id|a
suffix:semicolon
r_char
op_star
id|display_desc
op_assign
l_string|&quot;????&quot;
suffix:semicolon
r_char
op_star
id|display_ptr
suffix:semicolon
id|video_num_columns
op_assign
id|ORIG_VIDEO_COLS
suffix:semicolon
id|video_size_row
op_assign
id|video_num_columns
op_star
l_int|2
suffix:semicolon
id|video_num_lines
op_assign
id|ORIG_VIDEO_LINES
suffix:semicolon
id|video_page
op_assign
id|ORIG_VIDEO_PAGE
suffix:semicolon
id|video_erase_char
op_assign
l_int|0x0720
suffix:semicolon
r_if
c_cond
(paren
id|ORIG_VIDEO_MODE
op_eq
l_int|7
)paren
multiline_comment|/* Is this a monochrome display? */
(brace
id|video_mem_start
op_assign
l_int|0xb0000
suffix:semicolon
id|video_port_reg
op_assign
l_int|0x3b4
suffix:semicolon
id|video_port_val
op_assign
l_int|0x3b5
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ORIG_VIDEO_EGA_BX
op_amp
l_int|0xff
)paren
op_ne
l_int|0x10
)paren
(brace
id|video_type
op_assign
id|VIDEO_TYPE_EGAM
suffix:semicolon
id|video_mem_end
op_assign
l_int|0xb8000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;EGAm&quot;
suffix:semicolon
)brace
r_else
(brace
id|video_type
op_assign
id|VIDEO_TYPE_MDA
suffix:semicolon
id|video_mem_end
op_assign
l_int|0xb2000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;*MDA&quot;
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* If not, it is color. */
(brace
id|video_mem_start
op_assign
l_int|0xb8000
suffix:semicolon
id|video_port_reg
op_assign
l_int|0x3d4
suffix:semicolon
id|video_port_val
op_assign
l_int|0x3d5
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ORIG_VIDEO_EGA_BX
op_amp
l_int|0xff
)paren
op_ne
l_int|0x10
)paren
(brace
id|video_type
op_assign
id|VIDEO_TYPE_EGAC
suffix:semicolon
id|video_mem_end
op_assign
l_int|0xbc000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;EGAc&quot;
suffix:semicolon
)brace
r_else
(brace
id|video_type
op_assign
id|VIDEO_TYPE_CGA
suffix:semicolon
id|video_mem_end
op_assign
l_int|0xba000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;*CGA&quot;
suffix:semicolon
)brace
)brace
multiline_comment|/* Let the user known what kind of display driver we are using */
id|display_ptr
op_assign
(paren
(paren
r_char
op_star
)paren
id|video_mem_start
)paren
op_plus
id|video_size_row
op_minus
l_int|8
suffix:semicolon
r_while
c_loop
(paren
op_star
id|display_desc
)paren
(brace
op_star
id|display_ptr
op_increment
op_assign
op_star
id|display_desc
op_increment
suffix:semicolon
id|display_ptr
op_increment
suffix:semicolon
)brace
multiline_comment|/* Initialize the variables used for scrolling (mostly EGA/VGA)&t;*/
id|origin
op_assign
id|video_mem_start
suffix:semicolon
id|scr_end
op_assign
id|video_mem_start
op_plus
id|video_num_lines
op_star
id|video_size_row
suffix:semicolon
id|top
op_assign
l_int|0
suffix:semicolon
id|bottom
op_assign
id|video_num_lines
suffix:semicolon
id|gotoxy
c_func
(paren
id|ORIG_X
comma
id|ORIG_Y
)paren
suffix:semicolon
id|set_trap_gate
c_func
(paren
l_int|0x21
comma
op_amp
id|keyboard_interrupt
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|inb_p
c_func
(paren
l_int|0x21
)paren
op_amp
l_int|0xfd
comma
l_int|0x21
)paren
suffix:semicolon
id|a
op_assign
id|inb_p
c_func
(paren
l_int|0x61
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|a
op_or
l_int|0x80
comma
l_int|0x61
)paren
suffix:semicolon
id|outb
c_func
(paren
id|a
comma
l_int|0x61
)paren
suffix:semicolon
)brace
multiline_comment|/* from bsd-net-2: */
DECL|function|sysbeepstop
r_void
id|sysbeepstop
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* disable counter 2 */
id|outb
c_func
(paren
id|inb_p
c_func
(paren
l_int|0x61
)paren
op_amp
l_int|0xFC
comma
l_int|0x61
)paren
suffix:semicolon
)brace
DECL|variable|beepcount
r_int
id|beepcount
op_assign
l_int|0
suffix:semicolon
DECL|function|sysbeep
r_static
r_void
id|sysbeep
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* enable counter 2 */
id|outb_p
c_func
(paren
id|inb_p
c_func
(paren
l_int|0x61
)paren
op_or
l_int|3
comma
l_int|0x61
)paren
suffix:semicolon
multiline_comment|/* set command for counter 2, 2 byte write */
id|outb_p
c_func
(paren
l_int|0xB6
comma
l_int|0x43
)paren
suffix:semicolon
multiline_comment|/* send 0x637 for 750 HZ */
id|outb_p
c_func
(paren
l_int|0x37
comma
l_int|0x42
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x06
comma
l_int|0x42
)paren
suffix:semicolon
multiline_comment|/* 1/8 second */
id|beepcount
op_assign
id|HZ
op_div
l_int|8
suffix:semicolon
)brace
eof
