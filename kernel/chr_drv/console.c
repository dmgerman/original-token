multiline_comment|/*&n; *  linux/kernel/console.c&n; *&n; *  (C) 1991  Linus Torvalds&n; */
multiline_comment|/*&n; *&t;console.c&n; *&n; * This module implements the console io functions&n; *&t;&squot;void con_init(void)&squot;&n; *&t;&squot;void con_write(struct tty_queue * queue)&squot;&n; * Hopefully this will be a rather complete VT102 implementation.&n; *&n; * Beeping thanks to John T Kohl.&n; * &n; * Virtual Consoles, Screen Blanking, Screen Dumping, Color, Graphics&n; *   Chars, and VT100 enhancements by Peter MacDonald.&n; */
multiline_comment|/*&n; *  NOTE!!! We sometimes disable and enable interrupts for a short while&n; * (to put a word in video IO), but this will work even for keyboard&n; * interrupts. We know interrupts aren&squot;t enabled when getting a keyboard&n; * interrupt, as we use trap-gates. Hopefully all is well.&n; */
multiline_comment|/*&n; * Code to check for different video-cards mostly by Galen Hunt,&n; * &lt;g-hunt@ee.utah.edu&gt;&n; */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;string.h&gt;
macro_line|#include &lt;errno.h&gt;
DECL|macro|DEF_TERMIOS
mdefine_line|#define DEF_TERMIOS &bslash;&n;(struct termios) { &bslash;&n;&t;ICRNL, &bslash;&n;&t;OPOST | ONLCR, &bslash;&n;&t;0, &bslash;&n;&t;IXON | ISIG | ICANON | ECHO | ECHOCTL | ECHOKE, &bslash;&n;&t;0, &bslash;&n;&t;INIT_C_CC &bslash;&n;}
r_static
r_void
id|blank_screen
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|unblank_screen
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; * These are set up by the setup-routine at boot-time:&n; */
DECL|macro|ORIG_X
mdefine_line|#define ORIG_X&t;&t;&t;(*(unsigned char *)0x90000)
DECL|macro|ORIG_Y
mdefine_line|#define ORIG_Y&t;&t;&t;(*(unsigned char *)0x90001)
DECL|macro|ORIG_VIDEO_PAGE
mdefine_line|#define ORIG_VIDEO_PAGE&t;&t;(*(unsigned short *)0x90004)
DECL|macro|ORIG_VIDEO_MODE
mdefine_line|#define ORIG_VIDEO_MODE&t;&t;((*(unsigned short *)0x90006) &amp; 0xff)
DECL|macro|ORIG_VIDEO_COLS
mdefine_line|#define ORIG_VIDEO_COLS &t;(((*(unsigned short *)0x90006) &amp; 0xff00) &gt;&gt; 8)
DECL|macro|ORIG_VIDEO_LINES
mdefine_line|#define ORIG_VIDEO_LINES&t;((*(unsigned short *)0x9000e) &amp; 0xff)
DECL|macro|ORIG_VIDEO_EGA_AX
mdefine_line|#define ORIG_VIDEO_EGA_AX&t;(*(unsigned short *)0x90008)
DECL|macro|ORIG_VIDEO_EGA_BX
mdefine_line|#define ORIG_VIDEO_EGA_BX&t;(*(unsigned short *)0x9000a)
DECL|macro|ORIG_VIDEO_EGA_CX
mdefine_line|#define ORIG_VIDEO_EGA_CX&t;(*(unsigned short *)0x9000c)
DECL|macro|VIDEO_TYPE_MDA
mdefine_line|#define VIDEO_TYPE_MDA&t;&t;0x10&t;/* Monochrome Text Display&t;*/
DECL|macro|VIDEO_TYPE_CGA
mdefine_line|#define VIDEO_TYPE_CGA&t;&t;0x11&t;/* CGA Display &t;&t;&t;*/
DECL|macro|VIDEO_TYPE_EGAM
mdefine_line|#define VIDEO_TYPE_EGAM&t;&t;0x20&t;/* EGA/VGA in Monochrome Mode&t;*/
DECL|macro|VIDEO_TYPE_EGAC
mdefine_line|#define VIDEO_TYPE_EGAC&t;&t;0x21&t;/* EGA/VGA in Color Mode&t;*/
DECL|macro|NPAR
mdefine_line|#define NPAR 16
DECL|variable|NR_CONSOLES
r_int
id|NR_CONSOLES
op_assign
l_int|0
suffix:semicolon
r_extern
r_void
id|keyboard_interrupt
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|set_leds
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
r_char
id|kapplic
suffix:semicolon
r_extern
r_int
r_char
id|kleds
suffix:semicolon
r_extern
r_int
r_char
id|kmode
suffix:semicolon
DECL|variable|video_num_columns
r_int
r_int
id|video_num_columns
suffix:semicolon
multiline_comment|/* Number of text columns&t;*/
DECL|variable|video_num_lines
r_int
r_int
id|video_num_lines
suffix:semicolon
multiline_comment|/* Number of test lines&t;&t;*/
DECL|variable|video_type
r_static
r_int
r_char
id|video_type
suffix:semicolon
multiline_comment|/* Type of display being used&t;*/
DECL|variable|video_mem_base
r_static
r_int
r_int
id|video_mem_base
suffix:semicolon
multiline_comment|/* Base of video memory&t;&t;*/
DECL|variable|video_mem_term
r_static
r_int
r_int
id|video_mem_term
suffix:semicolon
multiline_comment|/* End of video memory&t;&t;*/
DECL|variable|video_size_row
r_static
r_int
r_int
id|video_size_row
suffix:semicolon
multiline_comment|/* Bytes per row&t;&t;*/
DECL|variable|video_page
r_static
r_int
r_char
id|video_page
suffix:semicolon
multiline_comment|/* Initial video page&t;&t;*/
DECL|variable|video_port_reg
r_static
r_int
r_int
id|video_port_reg
suffix:semicolon
multiline_comment|/* Video register select port&t;*/
DECL|variable|video_port_val
r_static
r_int
r_int
id|video_port_val
suffix:semicolon
multiline_comment|/* Video register value port&t;*/
DECL|variable|can_do_colour
r_static
r_int
id|can_do_colour
op_assign
l_int|0
suffix:semicolon
r_static
r_struct
(brace
DECL|member|vc_video_erase_char
r_int
r_int
id|vc_video_erase_char
suffix:semicolon
DECL|member|vc_attr
r_int
r_char
id|vc_attr
suffix:semicolon
DECL|member|vc_def_attr
r_int
r_char
id|vc_def_attr
suffix:semicolon
DECL|member|vc_bold_attr
r_int
id|vc_bold_attr
suffix:semicolon
DECL|member|vc_ques
r_int
r_int
id|vc_ques
suffix:semicolon
DECL|member|vc_state
r_int
r_int
id|vc_state
suffix:semicolon
DECL|member|vc_restate
r_char
op_star
id|vc_restate
suffix:semicolon
DECL|member|vc_checkin
r_int
r_int
id|vc_checkin
suffix:semicolon
DECL|member|vc_origin
r_int
r_int
id|vc_origin
suffix:semicolon
multiline_comment|/* Used for EGA/VGA fast scroll&t;*/
DECL|member|vc_scr_end
r_int
r_int
id|vc_scr_end
suffix:semicolon
multiline_comment|/* Used for EGA/VGA fast scroll&t;*/
DECL|member|vc_pos
r_int
r_int
id|vc_pos
suffix:semicolon
DECL|member|vc_x
DECL|member|vc_y
r_int
r_int
id|vc_x
comma
id|vc_y
suffix:semicolon
DECL|member|vc_top
DECL|member|vc_bottom
r_int
r_int
id|vc_top
comma
id|vc_bottom
suffix:semicolon
DECL|member|vc_npar
DECL|member|vc_par
r_int
r_int
id|vc_npar
comma
id|vc_par
(braket
id|NPAR
)braket
suffix:semicolon
DECL|member|vc_video_mem_start
r_int
r_int
id|vc_video_mem_start
suffix:semicolon
multiline_comment|/* Start of video RAM&t;&t;*/
DECL|member|vc_video_mem_end
r_int
r_int
id|vc_video_mem_end
suffix:semicolon
multiline_comment|/* End of video RAM (sort of)&t;*/
DECL|member|vc_saved_x
r_int
r_int
id|vc_saved_x
suffix:semicolon
DECL|member|vc_saved_y
r_int
r_int
id|vc_saved_y
suffix:semicolon
DECL|member|vc_iscolor
r_int
r_int
id|vc_iscolor
suffix:semicolon
DECL|member|vc_kbdapplic
r_int
r_char
id|vc_kbdapplic
suffix:semicolon
DECL|member|vc_kbdleds
r_int
r_char
id|vc_kbdleds
suffix:semicolon
DECL|member|vc_kbdmode
r_int
r_char
id|vc_kbdmode
suffix:semicolon
DECL|member|vc_translate
r_char
op_star
id|vc_translate
suffix:semicolon
DECL|variable|vc_cons
)brace
id|vc_cons
(braket
id|MAX_CONSOLES
)braket
suffix:semicolon
DECL|macro|MEM_BUFFER_SIZE
mdefine_line|#define MEM_BUFFER_SIZE (2*80*50*8) 
DECL|variable|vc_scrbuf
r_int
r_int
op_star
id|vc_scrbuf
(braket
id|MAX_CONSOLES
)braket
suffix:semicolon
DECL|variable|vc_scrmembuf
r_int
r_int
id|vc_scrmembuf
(braket
id|MEM_BUFFER_SIZE
op_div
l_int|2
)braket
suffix:semicolon
DECL|variable|console_blanked
r_static
r_int
id|console_blanked
op_assign
l_int|0
suffix:semicolon
DECL|macro|origin
mdefine_line|#define origin&t;&t;(vc_cons[currcons].vc_origin)
DECL|macro|scr_end
mdefine_line|#define scr_end&t;&t;(vc_cons[currcons].vc_scr_end)
DECL|macro|pos
mdefine_line|#define pos&t;&t;(vc_cons[currcons].vc_pos)
DECL|macro|top
mdefine_line|#define top&t;&t;(vc_cons[currcons].vc_top)
DECL|macro|bottom
mdefine_line|#define bottom&t;&t;(vc_cons[currcons].vc_bottom)
DECL|macro|x
mdefine_line|#define x&t;&t;(vc_cons[currcons].vc_x)
DECL|macro|y
mdefine_line|#define y&t;&t;(vc_cons[currcons].vc_y)
DECL|macro|state
mdefine_line|#define state&t;&t;(vc_cons[currcons].vc_state)
DECL|macro|restate
mdefine_line|#define restate&t;&t;(vc_cons[currcons].vc_restate)
DECL|macro|checkin
mdefine_line|#define checkin&t;&t;(vc_cons[currcons].vc_checkin)
DECL|macro|npar
mdefine_line|#define npar&t;&t;(vc_cons[currcons].vc_npar)
DECL|macro|par
mdefine_line|#define par&t;&t;(vc_cons[currcons].vc_par)
DECL|macro|ques
mdefine_line|#define ques&t;&t;(vc_cons[currcons].vc_ques)
DECL|macro|attr
mdefine_line|#define attr&t;&t;(vc_cons[currcons].vc_attr)
DECL|macro|saved_x
mdefine_line|#define saved_x&t;&t;(vc_cons[currcons].vc_saved_x)
DECL|macro|saved_y
mdefine_line|#define saved_y&t;&t;(vc_cons[currcons].vc_saved_y)
DECL|macro|translate
mdefine_line|#define translate&t;(vc_cons[currcons].vc_translate)
DECL|macro|video_mem_start
mdefine_line|#define video_mem_start&t;(vc_cons[currcons].vc_video_mem_start)
DECL|macro|video_mem_end
mdefine_line|#define video_mem_end&t;(vc_cons[currcons].vc_video_mem_end)
DECL|macro|def_attr
mdefine_line|#define def_attr&t;(vc_cons[currcons].vc_def_attr)
DECL|macro|video_erase_char
mdefine_line|#define video_erase_char  (vc_cons[currcons].vc_video_erase_char)&t;
DECL|macro|iscolor
mdefine_line|#define iscolor&t;&t;(vc_cons[currcons].vc_iscolor)
DECL|macro|kbdapplic
mdefine_line|#define kbdapplic&t;(vc_cons[currcons].vc_kbdapplic)
DECL|macro|kbdmode
mdefine_line|#define kbdmode&t;&t;(vc_cons[currcons].vc_kbdmode)
DECL|macro|kbdleds
mdefine_line|#define kbdleds&t;&t;(vc_cons[currcons].vc_kbdleds)
DECL|variable|blankinterval
r_int
id|blankinterval
op_assign
l_int|5
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
DECL|variable|screen_size
r_static
r_int
id|screen_size
op_assign
l_int|0
suffix:semicolon
r_static
r_void
id|sysbeep
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; * this is what the terminal answers to a ESC-Z or csi0c&n; * query (= vt100 response).&n; */
DECL|macro|RESPONSE
mdefine_line|#define RESPONSE &quot;&bslash;033[?1;2c&quot;
DECL|variable|translations
r_static
r_char
op_star
id|translations
(braket
)braket
op_assign
(brace
multiline_comment|/* 8-bit Latin-1 mapped to the PC charater set: &squot;&bslash;0&squot; means non-printable */
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot; !&bslash;&quot;#$%&amp;&squot;()*+,-./0123456789:;&lt;=&gt;?&quot;
l_string|&quot;@ABCDEFGHIJKLMNOPQRSTUVWXYZ[&bslash;&bslash;]^_&quot;
l_string|&quot;`abcdefghijklmnopqrstuvwxyz{|}~&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;040&bslash;255&bslash;233&bslash;234&bslash;376&bslash;235&bslash;174&bslash;025&bslash;376&bslash;376&bslash;246&bslash;256&bslash;252&bslash;055&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;370&bslash;361&bslash;375&bslash;376&bslash;376&bslash;346&bslash;024&bslash;371&bslash;376&bslash;376&bslash;247&bslash;257&bslash;254&bslash;253&bslash;376&bslash;250&quot;
l_string|&quot;&bslash;376&bslash;376&bslash;376&bslash;376&bslash;216&bslash;217&bslash;222&bslash;200&bslash;376&bslash;220&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;376&bslash;245&bslash;376&bslash;376&bslash;376&bslash;376&bslash;231&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&bslash;232&bslash;376&bslash;376&bslash;341&quot;
l_string|&quot;&bslash;205&bslash;240&bslash;203&bslash;376&bslash;204&bslash;206&bslash;221&bslash;207&bslash;212&bslash;202&bslash;210&bslash;211&bslash;215&bslash;241&bslash;214&bslash;213&quot;
l_string|&quot;&bslash;376&bslash;244&bslash;225&bslash;242&bslash;223&bslash;376&bslash;224&bslash;366&bslash;376&bslash;227&bslash;243&bslash;226&bslash;201&bslash;376&bslash;376&bslash;230&quot;
comma
multiline_comment|/* vt100 graphics */
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot; !&bslash;&quot;#$%&amp;&squot;()*+,-./0123456789:;&lt;=&gt;?&quot;
l_string|&quot;@ABCDEFGHIJKLMNOPQRSTUVWXYZ[&bslash;&bslash;]^ &quot;
l_string|&quot;&bslash;004&bslash;261&bslash;007&bslash;007&bslash;007&bslash;007&bslash;370&bslash;361&bslash;007&bslash;007&bslash;275&bslash;267&bslash;326&bslash;323&bslash;327&bslash;304&quot;
l_string|&quot;&bslash;304&bslash;304&bslash;304&bslash;304&bslash;307&bslash;266&bslash;320&bslash;322&bslash;272&bslash;363&bslash;362&bslash;343&bslash;007&bslash;234&bslash;007&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&bslash;0&quot;
l_string|&quot;&bslash;040&bslash;255&bslash;233&bslash;234&bslash;376&bslash;235&bslash;174&bslash;025&bslash;376&bslash;376&bslash;246&bslash;256&bslash;252&bslash;055&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;370&bslash;361&bslash;375&bslash;376&bslash;376&bslash;346&bslash;024&bslash;371&bslash;376&bslash;376&bslash;247&bslash;257&bslash;254&bslash;253&bslash;376&bslash;250&quot;
l_string|&quot;&bslash;376&bslash;376&bslash;376&bslash;376&bslash;216&bslash;217&bslash;222&bslash;200&bslash;376&bslash;220&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&quot;
l_string|&quot;&bslash;376&bslash;245&bslash;376&bslash;376&bslash;376&bslash;376&bslash;231&bslash;376&bslash;376&bslash;376&bslash;376&bslash;376&bslash;232&bslash;376&bslash;376&bslash;341&quot;
l_string|&quot;&bslash;205&bslash;240&bslash;203&bslash;376&bslash;204&bslash;206&bslash;221&bslash;207&bslash;212&bslash;202&bslash;210&bslash;211&bslash;215&bslash;241&bslash;214&bslash;213&quot;
l_string|&quot;&bslash;376&bslash;244&bslash;225&bslash;242&bslash;223&bslash;376&bslash;224&bslash;366&bslash;376&bslash;227&bslash;243&bslash;226&bslash;201&bslash;376&bslash;376&bslash;230&quot;
)brace
suffix:semicolon
DECL|macro|NORM_TRANS
mdefine_line|#define NORM_TRANS (translations[0])
DECL|macro|GRAF_TRANS
mdefine_line|#define GRAF_TRANS (translations[1])
multiline_comment|/* NOTE! gotoxy thinks x==video_num_columns is ok */
DECL|function|gotoxy
r_static
r_inline
r_void
id|gotoxy
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|new_x
comma
r_int
r_int
id|new_y
)paren
(brace
r_if
c_cond
(paren
id|new_x
OG
id|video_num_columns
op_logical_or
id|new_y
op_ge
id|video_num_lines
)paren
r_return
suffix:semicolon
id|x
op_assign
id|new_x
suffix:semicolon
id|y
op_assign
id|new_y
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|set_origin
r_static
r_inline
r_void
id|set_origin
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|video_type
op_ne
id|VIDEO_TYPE_EGAC
op_logical_and
id|video_type
op_ne
id|VIDEO_TYPE_EGAM
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|currcons
op_ne
id|fg_console
)paren
r_return
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|12
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|origin
op_minus
id|video_mem_base
)paren
op_rshift
l_int|9
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|13
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|origin
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|scrup
r_static
r_void
id|scrup
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|t
comma
r_int
r_int
id|b
)paren
(brace
r_int
id|hardscroll
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|b
OG
id|video_num_lines
op_logical_or
id|t
op_ge
id|b
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|video_type
op_ne
id|VIDEO_TYPE_EGAC
op_logical_and
id|video_type
op_ne
id|VIDEO_TYPE_EGAM
)paren
id|hardscroll
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t
op_logical_or
id|b
op_ne
id|video_num_lines
)paren
id|hardscroll
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hardscroll
)paren
(brace
id|origin
op_add_assign
id|video_size_row
suffix:semicolon
id|pos
op_add_assign
id|video_size_row
suffix:semicolon
id|scr_end
op_add_assign
id|video_size_row
suffix:semicolon
r_if
c_cond
(paren
id|scr_end
OG
id|video_mem_end
)paren
(brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;movsl&bslash;n&bslash;t&quot;
l_string|&quot;movl _video_num_columns,%1&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
comma
l_string|&quot;c&quot;
(paren
(paren
id|video_num_lines
op_minus
l_int|1
)paren
op_star
id|video_num_columns
op_rshift
l_int|1
)paren
comma
l_string|&quot;D&quot;
(paren
id|video_mem_start
)paren
comma
l_string|&quot;S&quot;
(paren
id|origin
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
comma
l_string|&quot;si&quot;
)paren
suffix:semicolon
id|scr_end
op_sub_assign
id|origin
op_minus
id|video_mem_start
suffix:semicolon
id|pos
op_sub_assign
id|origin
op_minus
id|video_mem_start
suffix:semicolon
id|origin
op_assign
id|video_mem_start
suffix:semicolon
)brace
r_else
(brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
comma
l_string|&quot;c&quot;
(paren
id|video_num_columns
)paren
comma
l_string|&quot;D&quot;
(paren
id|scr_end
op_minus
id|video_size_row
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
)paren
suffix:semicolon
)brace
id|set_origin
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
r_else
(brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;movsl&bslash;n&bslash;t&quot;
l_string|&quot;movl _video_num_columns,%%ecx&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
comma
l_string|&quot;c&quot;
(paren
(paren
id|b
op_minus
id|t
op_minus
l_int|1
)paren
op_star
id|video_num_columns
op_rshift
l_int|1
)paren
comma
l_string|&quot;D&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
id|t
)paren
comma
l_string|&quot;S&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
(paren
id|t
op_plus
l_int|1
)paren
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
comma
l_string|&quot;si&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|scrdown
r_static
r_void
id|scrdown
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|t
comma
r_int
r_int
id|b
)paren
(brace
r_if
c_cond
(paren
id|b
OG
id|video_num_lines
op_logical_or
id|t
op_ge
id|b
)paren
r_return
suffix:semicolon
id|__asm__
c_func
(paren
l_string|&quot;std&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;movsl&bslash;n&bslash;t&quot;
l_string|&quot;addl $2,%%edi&bslash;n&bslash;t&quot;
multiline_comment|/* %edi has been decremented by 4 */
l_string|&quot;movl _video_num_columns,%%ecx&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&bslash;n&bslash;t&quot;
l_string|&quot;cld&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
comma
l_string|&quot;c&quot;
(paren
(paren
id|b
op_minus
id|t
op_minus
l_int|1
)paren
op_star
id|video_num_columns
op_rshift
l_int|1
)paren
comma
l_string|&quot;D&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
id|b
op_minus
l_int|4
)paren
comma
l_string|&quot;S&quot;
(paren
id|origin
op_plus
id|video_size_row
op_star
(paren
id|b
op_minus
l_int|1
)paren
op_minus
l_int|4
)paren
suffix:colon
l_string|&quot;ax&quot;
comma
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
comma
l_string|&quot;si&quot;
)paren
suffix:semicolon
)brace
DECL|function|lf
r_static
r_void
id|lf
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|y
op_plus
l_int|1
OL
id|bottom
)paren
(brace
id|y
op_increment
suffix:semicolon
id|pos
op_add_assign
id|video_size_row
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
id|scrup
c_func
(paren
id|currcons
comma
id|top
comma
id|bottom
)paren
suffix:semicolon
)brace
DECL|function|ri
r_static
r_void
id|ri
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|y
OG
id|top
)paren
(brace
id|y
op_decrement
suffix:semicolon
id|pos
op_sub_assign
id|video_size_row
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
id|scrdown
c_func
(paren
id|currcons
comma
id|top
comma
id|bottom
)paren
suffix:semicolon
)brace
DECL|function|cr
r_static
r_void
id|cr
c_func
(paren
r_int
id|currcons
)paren
(brace
id|pos
op_sub_assign
id|x
op_lshift
l_int|1
suffix:semicolon
id|x
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|del
r_static
r_void
id|del
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|x
)paren
(brace
id|pos
op_sub_assign
l_int|2
suffix:semicolon
id|x
op_decrement
suffix:semicolon
op_star
(paren
r_int
r_int
op_star
)paren
id|pos
op_assign
id|video_erase_char
suffix:semicolon
)brace
)brace
DECL|function|csi_J
r_static
r_void
id|csi_J
c_func
(paren
r_int
id|currcons
comma
r_int
id|vpar
)paren
(brace
r_int
r_int
id|count
suffix:semicolon
r_int
r_int
id|start
suffix:semicolon
r_switch
c_cond
(paren
id|vpar
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* erase from cursor to end of display */
id|count
op_assign
(paren
id|scr_end
op_minus
id|pos
)paren
op_rshift
l_int|1
suffix:semicolon
id|start
op_assign
id|pos
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* erase from start to cursor */
id|count
op_assign
(paren
id|pos
op_minus
id|origin
)paren
op_rshift
l_int|1
suffix:semicolon
id|start
op_assign
id|origin
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* erase whole display */
id|count
op_assign
id|video_num_columns
op_star
id|video_num_lines
suffix:semicolon
id|start
op_assign
id|origin
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;c&quot;
(paren
id|count
)paren
comma
l_string|&quot;D&quot;
(paren
id|start
)paren
comma
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
)paren
suffix:semicolon
)brace
DECL|function|csi_K
r_static
r_void
id|csi_K
c_func
(paren
r_int
id|currcons
comma
r_int
id|vpar
)paren
(brace
r_int
id|count
suffix:semicolon
r_int
id|start
suffix:semicolon
r_switch
c_cond
(paren
id|vpar
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* erase from cursor to end of line */
r_if
c_cond
(paren
id|x
op_ge
id|video_num_columns
)paren
r_return
suffix:semicolon
id|count
op_assign
id|video_num_columns
op_minus
id|x
suffix:semicolon
id|start
op_assign
id|pos
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* erase from start of line to cursor */
id|start
op_assign
id|pos
op_minus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
id|count
op_assign
(paren
id|x
OL
id|video_num_columns
)paren
ques
c_cond
id|x
suffix:colon
id|video_num_columns
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* erase whole line */
id|start
op_assign
id|pos
op_minus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
id|count
op_assign
id|video_num_columns
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
suffix:semicolon
)brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&bslash;n&bslash;t&quot;
op_scope_resolution
l_string|&quot;c&quot;
(paren
id|count
)paren
comma
l_string|&quot;D&quot;
(paren
id|start
)paren
comma
l_string|&quot;a&quot;
(paren
id|video_erase_char
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
)paren
suffix:semicolon
)brace
DECL|function|csi_m
r_static
r_void
id|csi_m
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
id|i
suffix:semicolon
r_static
r_int
id|conv_table
(braket
l_int|8
)braket
op_assign
(brace
l_int|0
comma
l_int|4
comma
l_int|2
comma
l_int|6
comma
l_int|1
comma
l_int|5
comma
l_int|3
comma
l_int|7
)brace
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|npar
suffix:semicolon
id|i
op_increment
)paren
r_switch
c_cond
(paren
id|par
(braket
id|i
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
id|attr
op_assign
id|def_attr
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* default */
r_case
l_int|1
suffix:colon
id|attr
op_assign
(paren
id|iscolor
ques
c_cond
id|attr
op_or
l_int|0x08
suffix:colon
id|attr
op_or
l_int|0x0f
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* bold */
multiline_comment|/*case 4: attr=attr|0x01;break;*/
multiline_comment|/* underline */
r_case
l_int|4
suffix:colon
multiline_comment|/* bold */
r_if
c_cond
(paren
op_logical_neg
id|iscolor
)paren
id|attr
op_or_assign
l_int|0x01
suffix:semicolon
r_else
(brace
multiline_comment|/* check if forground == background */
r_if
c_cond
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|vc_bold_attr
op_ne
op_minus
l_int|1
)paren
id|attr
op_assign
(paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|vc_bold_attr
op_amp
l_int|0x0f
)paren
op_or
(paren
l_int|0xf0
op_amp
(paren
id|attr
)paren
)paren
suffix:semicolon
r_else
(brace
r_int
id|newattr
op_assign
(paren
id|attr
op_amp
l_int|0xf0
)paren
op_or
(paren
l_int|0xf
op_amp
(paren
op_complement
id|attr
)paren
)paren
suffix:semicolon
id|attr
op_assign
(paren
(paren
id|newattr
op_amp
l_int|0xf
)paren
op_eq
(paren
(paren
id|attr
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)paren
ques
c_cond
(paren
id|attr
op_amp
l_int|0xf0
)paren
op_or
(paren
(paren
(paren
id|attr
op_amp
l_int|0xf
)paren
op_plus
l_int|1
)paren
op_mod
l_int|0xf
)paren
suffix:colon
id|newattr
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|attr
op_assign
id|attr
op_or
l_int|0x80
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* blinking */
r_case
l_int|7
suffix:colon
id|attr
op_assign
(paren
id|attr
op_amp
l_int|0x88
)paren
op_or
(paren
(paren
id|attr
op_lshift
l_int|4
)paren
op_amp
l_int|0x70
)paren
op_or
(paren
(paren
id|attr
op_rshift
l_int|4
)paren
op_amp
l_int|0x07
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* negative */
r_case
l_int|22
suffix:colon
id|attr
op_assign
id|attr
op_amp
l_int|0xf7
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* not bold */
r_case
l_int|24
suffix:colon
id|attr
op_assign
id|attr
op_amp
l_int|0xfe
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* not underline */
r_case
l_int|25
suffix:colon
id|attr
op_assign
id|attr
op_amp
l_int|0x7f
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* not blinking */
r_case
l_int|27
suffix:colon
id|attr
op_assign
id|def_attr
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* positive image */
r_case
l_int|39
suffix:colon
id|attr
op_assign
(paren
id|attr
op_amp
l_int|0xf8
)paren
op_or
(paren
id|def_attr
op_amp
l_int|0x07
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|49
suffix:colon
id|attr
op_assign
(paren
id|attr
op_amp
l_int|0x8f
)paren
op_or
(paren
id|def_attr
op_amp
l_int|0x70
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|can_do_colour
)paren
r_break
suffix:semicolon
id|iscolor
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|par
(braket
id|i
)braket
op_ge
l_int|30
)paren
op_logical_and
(paren
id|par
(braket
id|i
)braket
op_le
l_int|37
)paren
)paren
id|attr
op_assign
(paren
id|attr
op_amp
l_int|0xf8
)paren
op_or
id|conv_table
(braket
id|par
(braket
id|i
)braket
op_minus
l_int|30
)braket
suffix:semicolon
r_else
multiline_comment|/* Background color */
r_if
c_cond
(paren
(paren
id|par
(braket
id|i
)braket
op_ge
l_int|40
)paren
op_logical_and
(paren
id|par
(braket
id|i
)braket
op_le
l_int|47
)paren
)paren
id|attr
op_assign
(paren
id|attr
op_amp
l_int|0x8f
)paren
op_or
(paren
id|conv_table
(braket
id|par
(braket
id|i
)braket
op_minus
l_int|40
)braket
op_lshift
l_int|4
)paren
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
)brace
DECL|function|set_cursor
r_static
r_inline
r_void
id|set_cursor
c_func
(paren
r_int
id|currcons
)paren
(brace
r_if
c_cond
(paren
id|currcons
op_ne
id|fg_console
)paren
r_return
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|14
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|pos
op_minus
id|video_mem_base
)paren
op_rshift
l_int|9
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|15
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|pos
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|hide_cursor
r_static
r_inline
r_void
id|hide_cursor
c_func
(paren
r_int
id|currcons
)paren
(brace
id|outb_p
c_func
(paren
l_int|14
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|scr_end
op_minus
id|video_mem_base
)paren
op_rshift
l_int|9
)paren
comma
id|video_port_val
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|15
comma
id|video_port_reg
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
op_amp
(paren
(paren
id|scr_end
op_minus
id|video_mem_base
)paren
op_rshift
l_int|1
)paren
comma
id|video_port_val
)paren
suffix:semicolon
)brace
DECL|function|respond
r_static
r_void
id|respond
c_func
(paren
r_int
id|currcons
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_char
op_star
id|p
op_assign
id|RESPONSE
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
)paren
(brace
id|PUTCH
c_func
(paren
op_star
id|p
comma
id|tty-&gt;read_q
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|TTY_READ_FLUSH
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
DECL|function|insert_char
r_static
r_void
id|insert_char
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
r_int
id|i
op_assign
id|x
suffix:semicolon
r_int
r_int
id|tmp
comma
id|old
op_assign
id|video_erase_char
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_while
c_loop
(paren
id|i
op_increment
OL
id|video_num_columns
)paren
(brace
id|tmp
op_assign
op_star
id|p
suffix:semicolon
op_star
id|p
op_assign
id|old
suffix:semicolon
id|old
op_assign
id|tmp
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
)brace
DECL|function|insert_line
r_static
r_void
id|insert_line
c_func
(paren
r_int
id|currcons
)paren
(brace
id|scrdown
c_func
(paren
id|currcons
comma
id|y
comma
id|bottom
)paren
suffix:semicolon
)brace
DECL|function|delete_char
r_static
r_void
id|delete_char
c_func
(paren
r_int
id|currcons
)paren
(brace
r_int
r_int
id|i
op_assign
id|x
suffix:semicolon
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|x
op_ge
id|video_num_columns
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
op_increment
id|i
OL
id|video_num_columns
)paren
(brace
op_star
id|p
op_assign
op_star
(paren
id|p
op_plus
l_int|1
)paren
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
op_star
id|p
op_assign
id|video_erase_char
suffix:semicolon
)brace
DECL|function|delete_line
r_static
r_void
id|delete_line
c_func
(paren
r_int
id|currcons
)paren
(brace
id|scrup
c_func
(paren
id|currcons
comma
id|y
comma
id|bottom
)paren
suffix:semicolon
)brace
DECL|function|csi_at
r_static
r_void
id|csi_at
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_columns
)paren
id|nr
op_assign
id|video_num_columns
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|insert_char
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|csi_L
r_static
r_void
id|csi_L
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_lines
)paren
id|nr
op_assign
id|video_num_lines
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|insert_line
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|csi_P
r_static
r_void
id|csi_P
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_columns
)paren
id|nr
op_assign
id|video_num_columns
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|delete_char
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|csi_M
r_static
r_void
id|csi_M
c_func
(paren
r_int
id|currcons
comma
r_int
r_int
id|nr
)paren
(brace
r_if
c_cond
(paren
id|nr
OG
id|video_num_lines
)paren
id|nr
op_assign
id|video_num_lines
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
id|nr
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|nr
op_decrement
)paren
id|delete_line
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
DECL|function|save_cur
r_static
r_void
id|save_cur
c_func
(paren
r_int
id|currcons
)paren
(brace
id|saved_x
op_assign
id|x
suffix:semicolon
id|saved_y
op_assign
id|y
suffix:semicolon
)brace
DECL|function|restore_cur
r_static
r_void
id|restore_cur
c_func
(paren
r_int
id|currcons
)paren
(brace
id|gotoxy
c_func
(paren
id|currcons
comma
id|saved_x
comma
id|saved_y
)paren
suffix:semicolon
)brace
DECL|enumerator|ESnormal
DECL|enumerator|ESesc
DECL|enumerator|ESsquare
DECL|enumerator|ESgetpars
DECL|enumerator|ESgotpars
DECL|enumerator|ESfunckey
r_enum
(brace
id|ESnormal
comma
id|ESesc
comma
id|ESsquare
comma
id|ESgetpars
comma
id|ESgotpars
comma
id|ESfunckey
comma
DECL|enumerator|ESsetterm
DECL|enumerator|ESsetgraph
DECL|enumerator|ESgraph
DECL|enumerator|ESgresc
DECL|enumerator|ESignore
id|ESsetterm
comma
id|ESsetgraph
comma
id|ESgraph
comma
id|ESgresc
comma
id|ESignore
)brace
suffix:semicolon
DECL|function|con_write
r_void
id|con_write
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_int
r_char
id|c
suffix:semicolon
r_int
r_int
id|currcons
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|tty-&gt;write_q-&gt;proc_list
)paren
suffix:semicolon
id|currcons
op_assign
id|tty
op_minus
id|tty_table
suffix:semicolon
r_if
c_cond
(paren
id|currcons
op_ge
id|MAX_CONSOLES
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;con_write: illegal tty&bslash;n&bslash;r&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|EMPTY
c_func
(paren
id|tty-&gt;write_q
)paren
)paren
(brace
r_if
c_cond
(paren
id|tty-&gt;stopped
)paren
r_break
suffix:semicolon
id|GETCH
c_func
(paren
id|tty-&gt;write_q
comma
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_int|24
op_logical_or
id|c
op_eq
l_int|26
)paren
id|state
op_assign
id|ESnormal
suffix:semicolon
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
id|ESnormal
suffix:colon
r_if
c_cond
(paren
id|translate
(braket
id|c
)braket
)paren
(brace
id|c
op_assign
id|translate
(braket
id|c
)braket
suffix:semicolon
r_while
c_loop
(paren
id|x
op_ge
id|video_num_columns
)paren
(brace
id|x
op_sub_assign
id|video_num_columns
suffix:semicolon
id|pos
op_sub_assign
id|video_size_row
suffix:semicolon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
op_star
(paren
r_char
op_star
)paren
id|pos
op_assign
id|c
suffix:semicolon
op_star
(paren
r_char
op_star
)paren
(paren
id|pos
op_plus
l_int|1
)paren
op_assign
id|attr
suffix:semicolon
id|pos
op_add_assign
l_int|2
suffix:semicolon
id|x
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|27
)paren
id|state
op_assign
id|ESesc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|10
op_logical_or
id|c
op_eq
l_int|11
op_logical_or
id|c
op_eq
l_int|12
)paren
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|13
)paren
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|127
)paren
id|del
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|x
)paren
(brace
id|x
op_decrement
suffix:semicolon
id|pos
op_sub_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|9
)paren
(brace
id|c
op_assign
l_int|8
op_minus
(paren
id|x
op_amp
l_int|7
)paren
suffix:semicolon
id|x
op_add_assign
id|c
suffix:semicolon
id|pos
op_add_assign
id|c
op_lshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|x
OG
id|video_num_columns
)paren
(brace
id|x
op_sub_assign
id|video_num_columns
suffix:semicolon
id|pos
op_sub_assign
id|video_size_row
suffix:semicolon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
id|c
op_assign
l_int|9
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|7
)paren
id|sysbeep
c_func
(paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|14
)paren
(brace
id|checkin
op_assign
l_int|1
suffix:semicolon
id|translate
op_assign
id|restate
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_eq
l_int|15
)paren
(brace
id|translate
op_assign
id|NORM_TRANS
suffix:semicolon
id|checkin
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ESesc
suffix:colon
id|state
op_assign
id|ESnormal
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;[&squot;
suffix:colon
id|state
op_assign
id|ESsquare
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;E&squot;
suffix:colon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
id|y
op_plus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|ri
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;Z&squot;
suffix:colon
id|respond
c_func
(paren
id|currcons
comma
id|tty
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;7&squot;
suffix:colon
id|save_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;8&squot;
suffix:colon
id|restore_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;(&squot;
suffix:colon
r_case
l_char|&squot;)&squot;
suffix:colon
id|state
op_assign
id|ESsetgraph
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;P&squot;
suffix:colon
id|state
op_assign
id|ESsetterm
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;#&squot;
suffix:colon
id|state
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;c&squot;
suffix:colon
id|tty-&gt;termios
op_assign
id|DEF_TERMIOS
suffix:semicolon
id|state
op_assign
id|ESnormal
suffix:semicolon
id|restate
op_assign
id|NORM_TRANS
suffix:semicolon
id|checkin
op_assign
l_int|0
suffix:semicolon
id|top
op_assign
l_int|0
suffix:semicolon
id|bottom
op_assign
id|video_num_lines
suffix:semicolon
id|translate
op_assign
id|NORM_TRANS
suffix:semicolon
r_case
l_char|&squot;&gt;&squot;
suffix:colon
multiline_comment|/* Numeric keypad */
id|kbdapplic
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|currcons
op_eq
id|fg_console
)paren
id|kapplic
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;=&squot;
suffix:colon
multiline_comment|/* Appl. keypad */
id|kbdapplic
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|currcons
op_eq
id|fg_console
)paren
id|kapplic
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ESsquare
suffix:colon
r_for
c_loop
(paren
id|npar
op_assign
l_int|0
suffix:semicolon
id|npar
OL
id|NPAR
suffix:semicolon
id|npar
op_increment
)paren
(brace
id|par
(braket
id|npar
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|npar
op_assign
l_int|0
suffix:semicolon
id|state
op_assign
id|ESgetpars
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;[&squot;
)paren
(brace
multiline_comment|/* Function key */
id|state
op_assign
id|ESfunckey
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ques
op_assign
(paren
id|c
op_eq
l_char|&squot;?&squot;
)paren
)paren
r_break
suffix:semicolon
r_case
id|ESgetpars
suffix:colon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;;&squot;
op_logical_and
id|npar
OL
id|NPAR
op_minus
l_int|1
)paren
(brace
id|npar
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_ge
l_char|&squot;0&squot;
op_logical_and
id|c
op_le
l_char|&squot;9&squot;
)paren
(brace
id|par
(braket
id|npar
)braket
op_mul_assign
l_int|10
suffix:semicolon
id|par
(braket
id|npar
)braket
op_add_assign
id|c
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|state
op_assign
id|ESgotpars
suffix:semicolon
r_case
id|ESgotpars
suffix:colon
id|state
op_assign
id|ESnormal
suffix:semicolon
r_if
c_cond
(paren
id|ques
)paren
(brace
id|ques
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;G&squot;
suffix:colon
r_case
l_char|&squot;`&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;A&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|y
op_minus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;B&squot;
suffix:colon
r_case
l_char|&squot;e&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|y
op_plus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;C&squot;
suffix:colon
r_case
l_char|&squot;a&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
op_plus
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
op_minus
id|par
(braket
l_int|0
)braket
comma
id|y
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;E&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
id|y
op_plus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;F&squot;
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
id|y
op_minus
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;d&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|x
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;H&squot;
suffix:colon
r_case
l_char|&squot;f&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|par
(braket
l_int|1
)braket
)paren
id|par
(braket
l_int|1
)braket
op_decrement
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|1
)braket
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;J&squot;
suffix:colon
id|csi_J
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;K&squot;
suffix:colon
id|csi_K
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;L&squot;
suffix:colon
id|csi_L
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|csi_M
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;P&squot;
suffix:colon
id|csi_P
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;@&squot;
suffix:colon
id|csi_at
c_func
(paren
id|currcons
comma
id|par
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;m&squot;
suffix:colon
id|csi_m
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;r&squot;
suffix:colon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
)paren
id|par
(braket
l_int|0
)braket
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|par
(braket
l_int|1
)braket
)paren
id|par
(braket
l_int|1
)braket
op_assign
id|video_num_lines
suffix:semicolon
r_if
c_cond
(paren
id|par
(braket
l_int|0
)braket
OL
id|par
(braket
l_int|1
)braket
op_logical_and
id|par
(braket
l_int|1
)braket
op_le
id|video_num_lines
)paren
(brace
id|top
op_assign
id|par
(braket
l_int|0
)braket
suffix:semicolon
id|bottom
op_assign
id|par
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_char|&squot;s&squot;
suffix:colon
id|save_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;u&squot;
suffix:colon
id|restore_cur
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;l&squot;
suffix:colon
multiline_comment|/* blank interval */
r_case
l_char|&squot;b&squot;
suffix:colon
multiline_comment|/* bold attribute */
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|npar
op_ge
l_int|2
)paren
op_logical_and
(paren
(paren
id|par
(braket
l_int|1
)braket
op_minus
l_int|13
)paren
op_eq
id|par
(braket
l_int|0
)braket
)paren
op_logical_and
(paren
(paren
id|par
(braket
l_int|2
)braket
op_minus
l_int|17
)paren
op_eq
id|par
(braket
l_int|0
)braket
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c
op_eq
l_char|&squot;l&squot;
)paren
op_logical_and
(paren
id|par
(braket
l_int|0
)braket
op_le
l_int|60
)paren
)paren
(brace
id|blankinterval
op_assign
id|HZ
op_star
l_int|60
op_star
id|par
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;b&squot;
)paren
id|vc_cons
(braket
id|currcons
)braket
dot
id|vc_bold_attr
op_assign
id|par
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ESfunckey
suffix:colon
id|state
op_assign
id|ESnormal
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ESsetterm
suffix:colon
multiline_comment|/* Setterm functions. */
id|state
op_assign
id|ESnormal
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;S&squot;
)paren
(brace
id|def_attr
op_assign
id|attr
suffix:semicolon
id|video_erase_char
op_assign
(paren
id|video_erase_char
op_amp
l_int|0x0ff
)paren
op_or
(paren
id|def_attr
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;L&squot;
)paren
multiline_comment|/*linewrap on*/
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;l&squot;
)paren
multiline_comment|/*linewrap off*/
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ESsetgraph
suffix:colon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;0&squot;
)paren
(brace
r_if
c_cond
(paren
id|checkin
)paren
id|translate
op_assign
id|GRAF_TRANS
suffix:semicolon
id|restate
op_assign
id|GRAF_TRANS
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;B&squot;
)paren
id|translate
op_assign
id|restate
op_assign
id|NORM_TRANS
suffix:semicolon
id|state
op_assign
id|ESnormal
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|state
op_assign
id|ESnormal
suffix:semicolon
)brace
)brace
id|set_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|timer_active
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|BLANK_TIMER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
l_int|0
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BLANK_TIMER
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|blankinterval
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
id|jiffies
op_plus
id|blankinterval
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BLANK_TIMER
suffix:semicolon
)brace
)brace
DECL|function|do_keyboard_interrupt
r_void
id|do_keyboard_interrupt
c_func
(paren
r_void
)paren
(brace
id|TTY_READ_FLUSH
c_func
(paren
id|TTY_TABLE
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|timer_active
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|BLANK_TIMER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|console_blanked
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
l_int|0
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BLANK_TIMER
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|blankinterval
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
id|jiffies
op_plus
id|blankinterval
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BLANK_TIMER
suffix:semicolon
)brace
)brace
DECL|function|memsetw
r_void
op_star
id|memsetw
c_func
(paren
r_void
op_star
id|s
comma
r_int
r_int
id|c
comma
r_int
id|count
)paren
(brace
id|__asm__
c_func
(paren
l_string|&quot;cld&bslash;n&bslash;t&quot;
l_string|&quot;rep&bslash;n&bslash;t&quot;
l_string|&quot;stosw&quot;
op_scope_resolution
l_string|&quot;a&quot;
(paren
id|c
)paren
comma
l_string|&quot;D&quot;
(paren
id|s
)paren
comma
l_string|&quot;c&quot;
(paren
id|count
)paren
suffix:colon
l_string|&quot;cx&quot;
comma
l_string|&quot;di&quot;
)paren
suffix:semicolon
r_return
id|s
suffix:semicolon
)brace
multiline_comment|/*&n; *  void con_init(void);&n; *&n; * This routine initalizes console interrupts, and does nothing&n; * else. If you want the screen to clear, call tty_write with&n; * the appropriate escape-sequece.&n; *&n; * Reads the information preserved by setup.s to determine the current display&n; * type and sets everything accordingly.&n; */
DECL|function|con_init
r_void
id|con_init
c_func
(paren
r_void
)paren
(brace
r_register
r_int
r_char
id|a
suffix:semicolon
r_char
op_star
id|display_desc
op_assign
l_string|&quot;????&quot;
suffix:semicolon
r_char
op_star
id|display_ptr
suffix:semicolon
r_int
id|currcons
op_assign
l_int|0
suffix:semicolon
r_int
id|base
comma
id|term
suffix:semicolon
r_int
id|video_memory
suffix:semicolon
r_int
id|saveterm
comma
id|savebase
suffix:semicolon
id|video_num_columns
op_assign
id|ORIG_VIDEO_COLS
suffix:semicolon
id|video_size_row
op_assign
id|video_num_columns
op_star
l_int|2
suffix:semicolon
id|video_num_lines
op_assign
id|ORIG_VIDEO_LINES
suffix:semicolon
id|video_page
op_assign
id|ORIG_VIDEO_PAGE
suffix:semicolon
id|video_erase_char
op_assign
l_int|0x0720
suffix:semicolon
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|fn
op_assign
id|blank_screen
suffix:semicolon
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|blankinterval
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
id|jiffies
op_plus
id|blankinterval
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BLANK_TIMER
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ORIG_VIDEO_MODE
op_eq
l_int|7
)paren
multiline_comment|/* Is this a monochrome display? */
(brace
id|video_mem_base
op_assign
l_int|0xb0000
suffix:semicolon
id|video_port_reg
op_assign
l_int|0x3b4
suffix:semicolon
id|video_port_val
op_assign
l_int|0x3b5
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ORIG_VIDEO_EGA_BX
op_amp
l_int|0xff
)paren
op_ne
l_int|0x10
)paren
(brace
id|video_type
op_assign
id|VIDEO_TYPE_EGAM
suffix:semicolon
id|video_mem_term
op_assign
l_int|0xb8000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;EGAm&quot;
suffix:semicolon
)brace
r_else
(brace
id|video_type
op_assign
id|VIDEO_TYPE_MDA
suffix:semicolon
id|video_mem_term
op_assign
l_int|0xb2000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;*MDA&quot;
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* If not, it is color. */
(brace
id|can_do_colour
op_assign
l_int|1
suffix:semicolon
id|video_mem_base
op_assign
l_int|0xb8000
suffix:semicolon
id|video_port_reg
op_assign
l_int|0x3d4
suffix:semicolon
id|video_port_val
op_assign
l_int|0x3d5
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ORIG_VIDEO_EGA_BX
op_amp
l_int|0xff
)paren
op_ne
l_int|0x10
)paren
(brace
id|video_type
op_assign
id|VIDEO_TYPE_EGAC
suffix:semicolon
id|video_mem_term
op_assign
l_int|0xc0000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;EGAc&quot;
suffix:semicolon
)brace
r_else
(brace
id|video_type
op_assign
id|VIDEO_TYPE_CGA
suffix:semicolon
id|video_mem_term
op_assign
l_int|0xba000
suffix:semicolon
id|display_desc
op_assign
l_string|&quot;*CGA&quot;
suffix:semicolon
)brace
)brace
multiline_comment|/* Let the user known what kind of display driver we are using */
id|display_ptr
op_assign
(paren
(paren
r_char
op_star
)paren
id|video_mem_base
)paren
op_plus
id|video_size_row
op_minus
l_int|8
suffix:semicolon
r_while
c_loop
(paren
op_star
id|display_desc
)paren
(brace
op_star
id|display_ptr
op_increment
op_assign
op_star
id|display_desc
op_increment
suffix:semicolon
id|display_ptr
op_increment
suffix:semicolon
)brace
id|savebase
op_assign
id|video_mem_base
suffix:semicolon
id|saveterm
op_assign
id|video_mem_term
suffix:semicolon
id|memsetw
c_func
(paren
id|vc_scrmembuf
comma
id|video_erase_char
comma
id|MEM_BUFFER_SIZE
op_div
l_int|2
)paren
suffix:semicolon
id|video_mem_base
op_assign
(paren
r_int
)paren
id|vc_scrmembuf
suffix:semicolon
id|video_mem_term
op_assign
(paren
r_int
)paren
op_amp
(paren
id|vc_scrmembuf
(braket
id|MEM_BUFFER_SIZE
op_div
l_int|2
)braket
)paren
suffix:semicolon
id|video_memory
op_assign
id|video_mem_term
op_minus
id|video_mem_base
suffix:semicolon
id|screen_size
op_assign
(paren
id|video_num_lines
op_star
id|video_size_row
)paren
suffix:semicolon
id|NR_CONSOLES
op_assign
id|video_memory
op_div
id|screen_size
suffix:semicolon
r_if
c_cond
(paren
id|NR_CONSOLES
OG
id|MAX_CONSOLES
)paren
id|NR_CONSOLES
op_assign
id|MAX_CONSOLES
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|NR_CONSOLES
)paren
id|NR_CONSOLES
op_assign
l_int|1
suffix:semicolon
id|video_memory
op_assign
id|screen_size
suffix:semicolon
multiline_comment|/* Initialize the variables used for scrolling (mostly EGA/VGA)&t;*/
id|base
op_assign
id|origin
op_assign
id|video_mem_start
op_assign
id|video_mem_base
suffix:semicolon
id|term
op_assign
id|video_mem_end
op_assign
id|base
op_plus
id|video_memory
suffix:semicolon
id|scr_end
op_assign
id|video_mem_start
op_plus
id|screen_size
suffix:semicolon
id|top
op_assign
l_int|0
suffix:semicolon
id|bottom
op_assign
id|video_num_lines
suffix:semicolon
id|attr
op_assign
l_int|0x07
suffix:semicolon
id|def_attr
op_assign
l_int|0x07
suffix:semicolon
id|restate
op_assign
id|NORM_TRANS
suffix:semicolon
id|state
op_assign
id|ESnormal
suffix:semicolon
id|checkin
op_assign
l_int|0
suffix:semicolon
id|ques
op_assign
l_int|0
suffix:semicolon
id|iscolor
op_assign
l_int|0
suffix:semicolon
id|translate
op_assign
id|NORM_TRANS
suffix:semicolon
id|kbdleds
op_assign
l_int|2
suffix:semicolon
id|kbdmode
op_assign
l_int|0
suffix:semicolon
id|kbdapplic
op_assign
l_int|0
suffix:semicolon
id|vc_cons
(braket
l_int|0
)braket
dot
id|vc_bold_attr
op_assign
op_minus
l_int|1
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
id|ORIG_X
comma
id|ORIG_Y
)paren
suffix:semicolon
r_for
c_loop
(paren
id|currcons
op_assign
l_int|1
suffix:semicolon
id|currcons
OL
id|NR_CONSOLES
suffix:semicolon
id|currcons
op_increment
)paren
(brace
id|vc_cons
(braket
id|currcons
)braket
op_assign
id|vc_cons
(braket
l_int|0
)braket
suffix:semicolon
id|origin
op_assign
id|video_mem_start
op_assign
(paren
id|base
op_add_assign
id|video_memory
)paren
suffix:semicolon
id|scr_end
op_assign
id|origin
op_plus
id|video_num_lines
op_star
id|video_size_row
suffix:semicolon
id|video_mem_end
op_assign
(paren
id|term
op_add_assign
id|video_memory
)paren
suffix:semicolon
id|gotoxy
c_func
(paren
id|currcons
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|currcons
op_assign
l_int|0
suffix:semicolon
id|currcons
OL
id|NR_CONSOLES
suffix:semicolon
id|currcons
op_increment
)paren
id|vc_scrbuf
(braket
id|currcons
)braket
op_assign
(paren
r_int
r_int
op_star
)paren
id|origin
suffix:semicolon
id|currcons
op_assign
l_int|0
suffix:semicolon
id|video_mem_base
op_assign
id|savebase
suffix:semicolon
id|video_mem_term
op_assign
id|saveterm
suffix:semicolon
id|video_mem_start
op_assign
id|video_mem_base
suffix:semicolon
id|video_mem_end
op_assign
id|video_mem_term
suffix:semicolon
id|origin
op_assign
id|video_mem_start
suffix:semicolon
id|scr_end
op_assign
id|video_mem_start
op_plus
id|video_num_lines
op_star
id|video_size_row
suffix:semicolon
id|top
op_assign
l_int|0
suffix:semicolon
id|bottom
op_assign
id|video_num_lines
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
id|update_screen
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|set_trap_gate
c_func
(paren
l_int|0x21
comma
op_amp
id|keyboard_interrupt
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|inb_p
c_func
(paren
l_int|0x21
)paren
op_amp
l_int|0xfd
comma
l_int|0x21
)paren
suffix:semicolon
id|a
op_assign
id|inb_p
c_func
(paren
l_int|0x61
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|a
op_or
l_int|0x80
comma
l_int|0x61
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|a
comma
l_int|0x61
)paren
suffix:semicolon
)brace
DECL|function|kbdsave
r_void
id|kbdsave
c_func
(paren
r_int
id|new_console
)paren
(brace
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
id|kbdmode
op_assign
id|kmode
suffix:semicolon
id|kbdleds
op_assign
id|kleds
suffix:semicolon
id|kbdapplic
op_assign
id|kapplic
suffix:semicolon
id|currcons
op_assign
id|new_console
suffix:semicolon
id|kmode
op_assign
(paren
id|kmode
op_amp
l_int|0x3F
)paren
op_or
(paren
id|kbdmode
op_amp
l_int|0xC0
)paren
suffix:semicolon
id|kleds
op_assign
id|kbdleds
suffix:semicolon
id|kapplic
op_assign
id|kbdapplic
suffix:semicolon
id|set_leds
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|get_scrmem
r_static
r_void
id|get_scrmem
c_func
(paren
r_int
id|currcons
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|vc_scrbuf
(braket
id|fg_console
)braket
comma
(paren
r_void
op_star
)paren
id|origin
comma
id|screen_size
)paren
suffix:semicolon
id|video_mem_start
op_assign
(paren
r_int
r_int
)paren
id|vc_scrbuf
(braket
id|fg_console
)braket
suffix:semicolon
id|origin
op_assign
id|video_mem_start
suffix:semicolon
id|scr_end
op_assign
id|video_mem_end
op_assign
id|video_mem_start
op_plus
id|screen_size
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|set_scrmem
r_static
r_void
id|set_scrmem
c_func
(paren
r_int
id|currcons
)paren
(brace
id|video_mem_start
op_assign
id|video_mem_base
suffix:semicolon
id|video_mem_end
op_assign
id|video_mem_term
suffix:semicolon
id|origin
op_assign
id|video_mem_start
suffix:semicolon
id|scr_end
op_assign
id|video_mem_start
op_plus
id|screen_size
suffix:semicolon
id|pos
op_assign
id|origin
op_plus
id|y
op_star
id|video_size_row
op_plus
(paren
id|x
op_lshift
l_int|1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|video_mem_base
comma
(paren
r_void
op_star
)paren
id|vc_scrbuf
(braket
id|fg_console
)braket
comma
id|screen_size
)paren
suffix:semicolon
)brace
DECL|function|blank_screen
r_void
id|blank_screen
c_func
(paren
r_void
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|fn
op_assign
id|unblank_screen
suffix:semicolon
id|get_scrmem
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|hide_cursor
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|console_blanked
op_assign
l_int|1
suffix:semicolon
id|memsetw
c_func
(paren
(paren
r_void
op_star
)paren
id|video_mem_base
comma
l_int|0x0020
comma
id|video_mem_term
op_minus
id|video_mem_base
)paren
suffix:semicolon
)brace
DECL|function|unblank_screen
r_void
id|unblank_screen
c_func
(paren
r_void
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|fn
op_assign
id|blank_screen
suffix:semicolon
r_if
c_cond
(paren
id|blankinterval
)paren
(brace
id|timer_table
(braket
id|BLANK_TIMER
)braket
dot
id|expires
op_assign
id|jiffies
op_plus
id|blankinterval
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BLANK_TIMER
suffix:semicolon
)brace
id|console_blanked
op_assign
l_int|0
suffix:semicolon
id|set_scrmem
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|set_origin
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|set_cursor
c_func
(paren
id|fg_console
)paren
suffix:semicolon
)brace
DECL|function|update_screen
r_void
id|update_screen
c_func
(paren
r_int
id|new_console
)paren
(brace
r_static
r_int
id|lock
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|new_console
op_eq
id|fg_console
op_logical_or
id|lock
)paren
r_return
suffix:semicolon
id|lock
op_assign
l_int|1
suffix:semicolon
id|kbdsave
c_func
(paren
id|new_console
)paren
suffix:semicolon
id|get_scrmem
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|fg_console
op_assign
id|new_console
suffix:semicolon
id|set_scrmem
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|set_origin
c_func
(paren
id|fg_console
)paren
suffix:semicolon
id|set_cursor
c_func
(paren
id|new_console
)paren
suffix:semicolon
id|lock
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* from bsd-net-2: */
DECL|function|sysbeepstop
r_static
r_void
id|sysbeepstop
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* disable counter 2 */
id|outb
c_func
(paren
id|inb_p
c_func
(paren
l_int|0x61
)paren
op_amp
l_int|0xFC
comma
l_int|0x61
)paren
suffix:semicolon
)brace
DECL|function|sysbeep
r_static
r_void
id|sysbeep
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* enable counter 2 */
id|outb_p
c_func
(paren
id|inb_p
c_func
(paren
l_int|0x61
)paren
op_or
l_int|3
comma
l_int|0x61
)paren
suffix:semicolon
multiline_comment|/* set command for counter 2, 2 byte write */
id|outb_p
c_func
(paren
l_int|0xB6
comma
l_int|0x43
)paren
suffix:semicolon
multiline_comment|/* send 0x637 for 750 HZ */
id|outb_p
c_func
(paren
l_int|0x37
comma
l_int|0x42
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x06
comma
l_int|0x42
)paren
suffix:semicolon
multiline_comment|/* 1/8 second */
id|timer_table
(braket
id|BEEP_TIMER
)braket
dot
id|expires
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|8
suffix:semicolon
id|timer_table
(braket
id|BEEP_TIMER
)braket
dot
id|fn
op_assign
id|sysbeepstop
suffix:semicolon
id|timer_active
op_or_assign
l_int|1
op_lshift
id|BEEP_TIMER
suffix:semicolon
)brace
DECL|function|do_screendump
r_int
id|do_screendump
c_func
(paren
r_int
id|arg
)paren
(brace
r_char
op_star
id|sptr
comma
op_star
id|buf
op_assign
(paren
r_char
op_star
)paren
id|arg
suffix:semicolon
r_int
id|currcons
comma
id|l
suffix:semicolon
id|verify_area
c_func
(paren
id|buf
comma
l_int|2
op_plus
id|video_num_columns
op_star
id|video_num_lines
)paren
suffix:semicolon
id|currcons
op_assign
id|get_fs_byte
c_func
(paren
id|buf
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|currcons
OL
l_int|0
)paren
op_logical_or
(paren
id|currcons
OG
id|NR_CONSOLES
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|put_fs_byte
c_func
(paren
(paren
r_char
)paren
(paren
id|video_num_lines
)paren
comma
id|buf
op_increment
)paren
suffix:semicolon
id|put_fs_byte
c_func
(paren
(paren
r_char
)paren
(paren
id|video_num_columns
)paren
comma
id|buf
op_increment
)paren
suffix:semicolon
id|currcons
op_assign
(paren
id|currcons
ques
c_cond
id|currcons
op_minus
l_int|1
suffix:colon
id|fg_console
)paren
suffix:semicolon
id|sptr
op_assign
(paren
r_char
op_star
)paren
id|origin
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
id|video_num_lines
op_star
id|video_num_columns
suffix:semicolon
id|l
OG
l_int|0
suffix:semicolon
id|l
op_decrement
comma
id|sptr
op_increment
)paren
id|put_fs_byte
c_func
(paren
op_star
id|sptr
op_increment
comma
id|buf
op_increment
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|console_print
r_void
id|console_print
c_func
(paren
r_const
r_char
op_star
id|b
)paren
(brace
r_int
id|currcons
op_assign
id|fg_console
suffix:semicolon
r_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|currcons
OL
l_int|0
op_logical_or
id|currcons
op_ge
id|NR_CONSOLES
)paren
id|currcons
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|c
op_assign
op_star
(paren
id|b
op_increment
)paren
)paren
(brace
r_if
c_cond
(paren
id|c
op_eq
l_int|10
)paren
(brace
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c
op_eq
l_int|13
)paren
(brace
id|cr
c_func
(paren
id|currcons
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_while
c_loop
(paren
id|x
op_ge
id|video_num_columns
)paren
(brace
id|x
op_sub_assign
id|video_num_columns
suffix:semicolon
id|pos
op_sub_assign
id|video_size_row
suffix:semicolon
id|lf
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
op_star
(paren
r_char
op_star
)paren
id|pos
op_assign
id|c
suffix:semicolon
op_star
(paren
r_char
op_star
)paren
(paren
id|pos
op_plus
l_int|1
)paren
op_assign
id|attr
suffix:semicolon
id|pos
op_add_assign
l_int|2
suffix:semicolon
id|x
op_increment
suffix:semicolon
)brace
id|set_cursor
c_func
(paren
id|currcons
)paren
suffix:semicolon
)brace
eof
