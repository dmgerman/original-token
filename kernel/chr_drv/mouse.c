multiline_comment|/*&n; * linux/kernel/chr_drv/mouse.c&n; *&n; * Generic mouse open routine by Johan Myreen&n; *&n; * Based on code from Linus&n; *&n; * Teemu Rantanen&squot;s Microsoft Busmouse support and Derrick Cole&squot;s&n; *   changes incorporated into 0.97pl4&n; *   by Peter Cervasio (pete%q106fm.uucp@wupost.wustl.edu) (08SEP92)&n; *   See busmouse.c for particulars.&n; *&n; * Made things a lot mode modular - easy to compile in just one or two&n; * of the mouse drivers, as they are now completely independent. Linus.&n; */
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/mouse.h&gt;
multiline_comment|/*&n; * note that you can remove any or all of the drivers by undefining&n; * the minor values in &lt;linux/mouse.h&gt;&n; */
r_extern
r_struct
id|file_operations
id|bus_mouse_fops
suffix:semicolon
r_extern
r_struct
id|file_operations
id|psaux_fops
suffix:semicolon
r_extern
r_struct
id|file_operations
id|ms_bus_mouse_fops
suffix:semicolon
r_extern
r_struct
id|file_operations
id|atixl_busmouse_fops
suffix:semicolon
r_extern
r_int
r_int
id|bus_mouse_init
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
r_int
id|psaux_init
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
r_int
id|ms_bus_mouse_init
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
r_int
id|atixl_busmouse_init
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
DECL|function|mouse_open
r_static
r_int
id|mouse_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|MINOR
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|minor
)paren
(brace
macro_line|#ifdef BUSMOUSE_MINOR
r_case
id|BUSMOUSE_MINOR
suffix:colon
id|file-&gt;f_op
op_assign
op_amp
id|bus_mouse_fops
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef PSMOUSE_MINOR
r_case
id|PSMOUSE_MINOR
suffix:colon
id|file-&gt;f_op
op_assign
op_amp
id|psaux_fops
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef MS_BUSMOUSE_MINOR
r_case
id|MS_BUSMOUSE_MINOR
suffix:colon
id|file-&gt;f_op
op_assign
op_amp
id|ms_bus_mouse_fops
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef ATIXL_BUSMOUSE_MINOR
r_case
id|ATIXL_BUSMOUSE_MINOR
suffix:colon
id|file-&gt;f_op
op_assign
op_amp
id|atixl_busmouse_fops
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
id|file-&gt;f_op
op_member_access_from_pointer
id|open
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
)brace
DECL|variable|mouse_fops
r_static
r_struct
id|file_operations
id|mouse_fops
op_assign
(brace
l_int|NULL
comma
multiline_comment|/* seek */
l_int|NULL
comma
multiline_comment|/* read */
l_int|NULL
comma
multiline_comment|/* write */
l_int|NULL
comma
multiline_comment|/* readdir */
l_int|NULL
comma
multiline_comment|/* select */
l_int|NULL
comma
multiline_comment|/* ioctl */
l_int|NULL
comma
multiline_comment|/* mmap */
id|mouse_open
comma
l_int|NULL
multiline_comment|/* release */
)brace
suffix:semicolon
DECL|function|mouse_init
r_int
r_int
id|mouse_init
c_func
(paren
r_int
r_int
id|kmem_start
)paren
(brace
macro_line|#ifdef BUSMOUSE_MINOR
id|kmem_start
op_assign
id|bus_mouse_init
c_func
(paren
id|kmem_start
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef PSMOUSE_MINOR
id|kmem_start
op_assign
id|psaux_init
c_func
(paren
id|kmem_start
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef MS_BUSMOUSE_MINOR
id|kmem_start
op_assign
id|ms_bus_mouse_init
c_func
(paren
id|kmem_start
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef ATIXL_BUSMOUSE_MINOR
id|kmem_start
op_assign
id|atixl_busmouse_init
c_func
(paren
id|kmem_start
)paren
suffix:semicolon
macro_line|#endif
id|chrdev_fops
(braket
l_int|10
)braket
op_assign
op_amp
id|mouse_fops
suffix:semicolon
r_return
id|kmem_start
suffix:semicolon
)brace
eof
