multiline_comment|/*---------------------------------------------------------------------------+&n; |  fpu_aux.c                                                                |&n; |                                                                           |&n; | Code to implement some of the FPU auxiliary instructions.                 |&n; |                                                                           |&n; | Copyright (C) 1992    W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |&n; |                       Australia.  E-mail apm233m@vaxc.cc.monash.edu.au    |&n; |                                                                           |&n; |                                                                           |&n; +---------------------------------------------------------------------------*/
macro_line|#include &quot;fpu_system.h&quot;
macro_line|#include &quot;exception.h&quot;
macro_line|#include &quot;fpu_emu.h&quot;
macro_line|#include &quot;status_w.h&quot;
DECL|function|fclex
r_static
r_void
id|fclex
c_func
(paren
)paren
(brace
id|status_word
op_and_assign
op_complement
(paren
id|SW_B
op_or
id|SW_ES
op_or
id|SW_SF
op_or
id|SW_PE
op_or
id|SW_UE
op_or
id|SW_OE
op_or
id|SW_ZE
op_or
id|SW_DE
op_or
id|SW_IE
)paren
suffix:semicolon
id|FPU_entry_eip
op_assign
id|ip_offset
suffix:semicolon
multiline_comment|/* We want no net effect */
)brace
multiline_comment|/* Needs to be externally visible */
DECL|function|finit
r_void
id|finit
c_func
(paren
)paren
(brace
r_int
id|r
suffix:semicolon
id|control_word
op_assign
l_int|0x037e
suffix:semicolon
id|status_word
op_assign
l_int|0
suffix:semicolon
id|top
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|r
op_assign
l_int|0
suffix:semicolon
id|r
OL
l_int|8
suffix:semicolon
id|r
op_increment
)paren
(brace
id|regs
(braket
id|r
)braket
dot
id|sign
op_assign
l_int|0
suffix:semicolon
id|regs
(braket
id|r
)braket
dot
id|tag
op_assign
id|TW_Empty
suffix:semicolon
id|regs
(braket
id|r
)braket
dot
id|exp
op_assign
l_int|0
suffix:semicolon
id|regs
(braket
id|r
)braket
dot
id|sigh
op_assign
l_int|0
suffix:semicolon
id|regs
(braket
id|r
)braket
dot
id|sigl
op_assign
l_int|0
suffix:semicolon
)brace
id|FPU_entry_eip
op_assign
id|ip_offset
suffix:semicolon
multiline_comment|/* We want no net effect */
)brace
DECL|variable|finit_table
r_static
id|FUNC
id|finit_table
(braket
)braket
op_assign
(brace
id|Un_impl
comma
id|Un_impl
comma
id|fclex
comma
id|finit
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
)brace
suffix:semicolon
DECL|function|finit_
r_void
id|finit_
c_func
(paren
)paren
(brace
(paren
id|finit_table
(braket
id|FPU_rm
)braket
)paren
(paren
)paren
suffix:semicolon
)brace
DECL|function|fstsw_ax
r_static
r_void
id|fstsw_ax
c_func
(paren
)paren
(brace
id|status_word
op_and_assign
op_complement
id|SW_TOP
suffix:semicolon
id|status_word
op_or_assign
(paren
id|top
op_amp
l_int|7
)paren
op_lshift
id|SW_TOPS
suffix:semicolon
op_star
(paren
r_int
op_star
)paren
op_amp
id|FPU_EAX
op_assign
id|status_word
suffix:semicolon
)brace
DECL|variable|fstsw_table
r_static
id|FUNC
id|fstsw_table
(braket
)braket
op_assign
(brace
id|fstsw_ax
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
)brace
suffix:semicolon
DECL|function|fstsw_
r_void
id|fstsw_
c_func
(paren
)paren
(brace
(paren
id|fstsw_table
(braket
id|FPU_rm
)braket
)paren
(paren
)paren
suffix:semicolon
)brace
DECL|function|fnop
r_static
r_void
id|fnop
c_func
(paren
)paren
(brace
)brace
DECL|variable|fp_nop_table
id|FUNC
id|fp_nop_table
(braket
)braket
op_assign
(brace
id|fnop
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
comma
id|Un_impl
)brace
suffix:semicolon
DECL|function|fp_nop
r_void
id|fp_nop
c_func
(paren
)paren
(brace
(paren
id|fp_nop_table
(braket
id|FPU_rm
)braket
)paren
(paren
)paren
suffix:semicolon
)brace
DECL|function|fld_i_
r_void
id|fld_i_
c_func
(paren
)paren
(brace
id|FPU_REG
op_star
id|st_new_ptr
suffix:semicolon
r_if
c_cond
(paren
id|STACK_OVERFLOW
)paren
(brace
id|stack_overflow
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* fld st(i) */
r_if
c_cond
(paren
id|NOT_EMPTY
c_func
(paren
id|FPU_rm
)paren
)paren
(brace
id|reg_move
c_func
(paren
op_amp
id|st
c_func
(paren
id|FPU_rm
)paren
comma
id|st_new_ptr
)paren
suffix:semicolon
id|push
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|control_word
op_amp
id|EX_Invalid
)paren
(brace
multiline_comment|/* The masked response */
id|push
c_func
(paren
)paren
suffix:semicolon
id|stack_underflow
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
id|EXCEPTION
c_func
(paren
id|EX_StackUnder
)paren
suffix:semicolon
)brace
)brace
DECL|function|fxch_i
r_void
id|fxch_i
c_func
(paren
)paren
(brace
multiline_comment|/* fxch st(i) */
id|FPU_REG
id|t
suffix:semicolon
r_register
id|FPU_REG
op_star
id|sti_ptr
op_assign
op_amp
id|st
c_func
(paren
id|FPU_rm
)paren
suffix:semicolon
id|reg_move
c_func
(paren
id|FPU_st0_ptr
comma
op_amp
id|t
)paren
suffix:semicolon
id|reg_move
c_func
(paren
id|sti_ptr
comma
id|FPU_st0_ptr
)paren
suffix:semicolon
id|reg_move
c_func
(paren
op_amp
id|t
comma
id|sti_ptr
)paren
suffix:semicolon
)brace
DECL|function|ffree_
r_void
id|ffree_
c_func
(paren
)paren
(brace
multiline_comment|/* ffree st(i) */
id|st
c_func
(paren
id|FPU_rm
)paren
dot
id|tag
op_assign
id|TW_Empty
suffix:semicolon
)brace
DECL|function|fst_i_
r_void
id|fst_i_
c_func
(paren
)paren
(brace
multiline_comment|/* fst st(i) */
id|reg_move
c_func
(paren
id|FPU_st0_ptr
comma
op_amp
id|st
c_func
(paren
id|FPU_rm
)paren
)paren
suffix:semicolon
)brace
DECL|function|fstp_i
r_void
id|fstp_i
c_func
(paren
)paren
(brace
multiline_comment|/* fstp st(i) */
id|reg_move
c_func
(paren
id|FPU_st0_ptr
comma
op_amp
id|st
c_func
(paren
id|FPU_rm
)paren
)paren
suffix:semicolon
id|pop
c_func
(paren
)paren
suffix:semicolon
)brace
eof
