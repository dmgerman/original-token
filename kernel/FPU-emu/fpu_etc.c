multiline_comment|/*---------------------------------------------------------------------------+&n; |  fpu_etc.c                                                                |&n; |                                                                           |&n; | Implement a few FPU instructions.                                         |&n; |                                                                           |&n; | Copyright (C) 1992,1993                                                   |&n; |                       W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |&n; |                       Australia.  E-mail apm233m@vaxc.cc.monash.edu.au    |&n; |                                                                           |&n; |                                                                           |&n; +---------------------------------------------------------------------------*/
macro_line|#include &quot;fpu_system.h&quot;
macro_line|#include &quot;exception.h&quot;
macro_line|#include &quot;fpu_emu.h&quot;
macro_line|#include &quot;status_w.h&quot;
macro_line|#include &quot;reg_constant.h&quot;
DECL|function|fchs
r_static
r_void
id|fchs
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|NOT_EMPTY_0
)paren
(brace
id|FPU_st0_ptr-&gt;sign
op_xor_assign
id|SIGN_POS
op_xor
id|SIGN_NEG
suffix:semicolon
id|status_word
op_and_assign
op_complement
id|SW_C1
suffix:semicolon
)brace
r_else
id|stack_underflow
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|fabs
r_static
r_void
id|fabs
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|FPU_st0_tag
op_xor
id|TW_Empty
)paren
(brace
id|FPU_st0_ptr-&gt;sign
op_assign
id|SIGN_POS
suffix:semicolon
id|status_word
op_and_assign
op_complement
id|SW_C1
suffix:semicolon
)brace
r_else
id|stack_underflow
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ftst_
r_static
r_void
id|ftst_
c_func
(paren
r_void
)paren
(brace
r_switch
c_cond
(paren
id|FPU_st0_tag
)paren
(brace
r_case
id|TW_Zero
suffix:colon
id|setcc
c_func
(paren
id|SW_C3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TW_Valid
suffix:colon
macro_line|#ifdef DENORM_OPERAND
r_if
c_cond
(paren
(paren
id|FPU_st0_ptr-&gt;exp
op_le
id|EXP_UNDER
)paren
op_logical_and
(paren
id|denormal_operand
c_func
(paren
)paren
)paren
)paren
r_return
suffix:semicolon
macro_line|#endif DENORM_OPERAND
r_if
c_cond
(paren
id|FPU_st0_ptr-&gt;sign
op_eq
id|SIGN_POS
)paren
id|setcc
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_else
id|setcc
c_func
(paren
id|SW_C0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TW_NaN
suffix:colon
id|setcc
c_func
(paren
id|SW_C0
op_or
id|SW_C2
op_or
id|SW_C3
)paren
suffix:semicolon
multiline_comment|/* Operand is not comparable */
id|EXCEPTION
c_func
(paren
id|EX_Invalid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TW_Infinity
suffix:colon
r_if
c_cond
(paren
id|FPU_st0_ptr-&gt;sign
op_eq
id|SIGN_POS
)paren
id|setcc
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_else
id|setcc
c_func
(paren
id|SW_C0
)paren
suffix:semicolon
id|EXCEPTION
c_func
(paren
id|EX_Invalid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TW_Empty
suffix:colon
id|setcc
c_func
(paren
id|SW_C0
op_or
id|SW_C2
op_or
id|SW_C3
)paren
suffix:semicolon
id|EXCEPTION
c_func
(paren
id|EX_StackUnder
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|setcc
c_func
(paren
id|SW_C0
op_or
id|SW_C2
op_or
id|SW_C3
)paren
suffix:semicolon
multiline_comment|/* Operand is not comparable */
id|EXCEPTION
c_func
(paren
id|EX_INTERNAL
op_or
l_int|0x14
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|fxam
r_static
r_void
id|fxam
c_func
(paren
r_void
)paren
(brace
r_int
id|c
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|FPU_st0_tag
)paren
(brace
r_case
id|TW_Empty
suffix:colon
id|c
op_assign
id|SW_C3
op_or
id|SW_C0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TW_Zero
suffix:colon
id|c
op_assign
id|SW_C3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TW_Valid
suffix:colon
multiline_comment|/* This will need to be changed if TW_Denormal is ever used. */
r_if
c_cond
(paren
id|FPU_st0_ptr-&gt;exp
op_le
id|EXP_UNDER
)paren
id|c
op_assign
id|SW_C2
op_or
id|SW_C3
suffix:semicolon
multiline_comment|/* Denormal */
r_else
id|c
op_assign
id|SW_C3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TW_NaN
suffix:colon
id|c
op_assign
id|SW_C0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TW_Infinity
suffix:colon
id|c
op_assign
id|SW_C2
op_or
id|SW_C0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|FPU_st0_ptr-&gt;sign
op_eq
id|SIGN_NEG
)paren
id|c
op_or_assign
id|SW_C1
suffix:semicolon
id|setcc
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
DECL|variable|fp_etc_table
r_static
id|FUNC
id|fp_etc_table
(braket
)braket
op_assign
(brace
id|fchs
comma
id|fabs
comma
id|Un_impl
comma
id|Un_impl
comma
id|ftst_
comma
id|fxam
comma
id|Un_impl
comma
id|Un_impl
)brace
suffix:semicolon
DECL|function|fp_etc
r_void
id|fp_etc
c_func
(paren
)paren
(brace
(paren
id|fp_etc_table
(braket
id|FPU_rm
)braket
)paren
(paren
)paren
suffix:semicolon
)brace
eof
