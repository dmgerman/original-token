multiline_comment|/*&n; *  linux/kernel/sys.c&n; *&n; *  (C) 1991  Linus Torvalds&n; */
macro_line|#include &lt;errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;sys/times.h&gt;
macro_line|#include &lt;sys/utsname.h&gt;
DECL|function|sys_ftime
r_int
id|sys_ftime
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_break
r_int
id|sys_break
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_ptrace
r_int
id|sys_ptrace
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_stty
r_int
id|sys_stty
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_gtty
r_int
id|sys_gtty
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_rename
r_int
id|sys_rename
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_prof
r_int
id|sys_prof
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_setregid
r_int
id|sys_setregid
c_func
(paren
r_int
id|rgid
comma
r_int
id|egid
)paren
(brace
r_if
c_cond
(paren
id|rgid
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|current-&gt;gid
op_eq
id|rgid
)paren
op_logical_or
id|suser
c_func
(paren
)paren
)paren
id|current-&gt;gid
op_assign
id|rgid
suffix:semicolon
r_else
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|egid
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|current-&gt;gid
op_eq
id|egid
)paren
op_logical_or
(paren
id|current-&gt;egid
op_eq
id|egid
)paren
op_logical_or
(paren
id|current-&gt;sgid
op_eq
id|egid
)paren
op_logical_or
id|suser
c_func
(paren
)paren
)paren
id|current-&gt;egid
op_assign
id|egid
suffix:semicolon
r_else
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sys_setgid
r_int
id|sys_setgid
c_func
(paren
r_int
id|gid
)paren
(brace
r_return
id|sys_setregid
c_func
(paren
id|gid
comma
id|gid
)paren
suffix:semicolon
)brace
DECL|function|sys_acct
r_int
id|sys_acct
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_phys
r_int
id|sys_phys
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_lock
r_int
id|sys_lock
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_mpx
r_int
id|sys_mpx
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_ulimit
r_int
id|sys_ulimit
c_func
(paren
)paren
(brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
DECL|function|sys_time
r_int
id|sys_time
c_func
(paren
r_int
op_star
id|tloc
)paren
(brace
r_int
id|i
suffix:semicolon
id|i
op_assign
id|CURRENT_TIME
suffix:semicolon
r_if
c_cond
(paren
id|tloc
)paren
(brace
id|verify_area
c_func
(paren
id|tloc
comma
l_int|4
)paren
suffix:semicolon
id|put_fs_long
c_func
(paren
id|i
comma
(paren
r_int
r_int
op_star
)paren
id|tloc
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/*&n; * Unprivileged users may change the real user id to the effective uid&n; * or vice versa.&n; */
DECL|function|sys_setreuid
r_int
id|sys_setreuid
c_func
(paren
r_int
id|ruid
comma
r_int
id|euid
)paren
(brace
r_int
id|old_ruid
op_assign
id|current-&gt;uid
suffix:semicolon
r_if
c_cond
(paren
id|ruid
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|current-&gt;euid
op_eq
id|ruid
)paren
op_logical_or
(paren
id|old_ruid
op_eq
id|ruid
)paren
op_logical_or
id|suser
c_func
(paren
)paren
)paren
id|current-&gt;uid
op_assign
id|ruid
suffix:semicolon
r_else
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|euid
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|old_ruid
op_eq
id|euid
)paren
op_logical_or
(paren
id|current-&gt;euid
op_eq
id|euid
)paren
op_logical_or
id|suser
c_func
(paren
)paren
)paren
id|current-&gt;euid
op_assign
id|euid
suffix:semicolon
r_else
(brace
id|current-&gt;uid
op_assign
id|old_ruid
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sys_setuid
r_int
id|sys_setuid
c_func
(paren
r_int
id|uid
)paren
(brace
r_return
id|sys_setreuid
c_func
(paren
id|uid
comma
id|uid
)paren
suffix:semicolon
)brace
DECL|function|sys_stime
r_int
id|sys_stime
c_func
(paren
r_int
op_star
id|tptr
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|startup_time
op_assign
id|get_fs_long
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|tptr
)paren
op_minus
id|jiffies
op_div
id|HZ
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sys_times
r_int
id|sys_times
c_func
(paren
r_struct
id|tms
op_star
id|tbuf
)paren
(brace
r_if
c_cond
(paren
id|tbuf
)paren
(brace
id|verify_area
c_func
(paren
id|tbuf
comma
r_sizeof
op_star
id|tbuf
)paren
suffix:semicolon
id|put_fs_long
c_func
(paren
id|current-&gt;utime
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|tbuf-&gt;tms_utime
)paren
suffix:semicolon
id|put_fs_long
c_func
(paren
id|current-&gt;stime
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|tbuf-&gt;tms_stime
)paren
suffix:semicolon
id|put_fs_long
c_func
(paren
id|current-&gt;cutime
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|tbuf-&gt;tms_cutime
)paren
suffix:semicolon
id|put_fs_long
c_func
(paren
id|current-&gt;cstime
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|tbuf-&gt;tms_cstime
)paren
suffix:semicolon
)brace
r_return
id|jiffies
suffix:semicolon
)brace
DECL|function|sys_brk
r_int
id|sys_brk
c_func
(paren
r_int
r_int
id|end_data_seg
)paren
(brace
r_if
c_cond
(paren
id|end_data_seg
op_ge
id|current-&gt;end_code
op_logical_and
id|end_data_seg
OL
id|current-&gt;start_stack
op_minus
l_int|16384
)paren
id|current-&gt;brk
op_assign
id|end_data_seg
suffix:semicolon
r_return
id|current-&gt;brk
suffix:semicolon
)brace
multiline_comment|/*&n; * This needs some heave checking ...&n; * I just haven&squot;t get the stomach for it. I also don&squot;t fully&n; * understand sessions/pgrp etc. Let somebody who does explain it.&n; */
DECL|function|sys_setpgid
r_int
id|sys_setpgid
c_func
(paren
r_int
id|pid
comma
r_int
id|pgid
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pid
)paren
id|pid
op_assign
id|current-&gt;pid
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pgid
)paren
id|pgid
op_assign
id|current-&gt;pid
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_TASKS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|task
(braket
id|i
)braket
op_logical_and
id|task
(braket
id|i
)braket
op_member_access_from_pointer
id|pid
op_eq
id|pid
)paren
(brace
r_if
c_cond
(paren
id|task
(braket
id|i
)braket
op_member_access_from_pointer
id|leader
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|task
(braket
id|i
)braket
op_member_access_from_pointer
id|session
op_ne
id|current-&gt;session
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|task
(braket
id|i
)braket
op_member_access_from_pointer
id|pgrp
op_assign
id|pgid
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
DECL|function|sys_getpgrp
r_int
id|sys_getpgrp
c_func
(paren
r_void
)paren
(brace
r_return
id|current-&gt;pgrp
suffix:semicolon
)brace
DECL|function|sys_setsid
r_int
id|sys_setsid
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;leader
op_logical_and
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|current-&gt;leader
op_assign
l_int|1
suffix:semicolon
id|current-&gt;session
op_assign
id|current-&gt;pgrp
op_assign
id|current-&gt;pid
suffix:semicolon
id|current-&gt;tty
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
id|current-&gt;pgrp
suffix:semicolon
)brace
DECL|function|sys_uname
r_int
id|sys_uname
c_func
(paren
r_struct
id|utsname
op_star
id|name
)paren
(brace
r_static
r_struct
id|utsname
id|thisname
op_assign
(brace
l_string|&quot;linux .0&quot;
comma
l_string|&quot;nodename&quot;
comma
l_string|&quot;release &quot;
comma
l_string|&quot;version &quot;
comma
l_string|&quot;machine &quot;
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|name
)paren
r_return
op_minus
id|ERROR
suffix:semicolon
id|verify_area
c_func
(paren
id|name
comma
r_sizeof
op_star
id|name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
op_star
id|name
suffix:semicolon
id|i
op_increment
)paren
(brace
id|put_fs_byte
c_func
(paren
(paren
(paren
r_char
op_star
)paren
op_amp
id|thisname
)paren
(braket
id|i
)braket
comma
id|i
op_plus
(paren
r_char
op_star
)paren
id|name
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sys_umask
r_int
id|sys_umask
c_func
(paren
r_int
id|mask
)paren
(brace
r_int
id|old
op_assign
id|current-&gt;umask
suffix:semicolon
id|current-&gt;umask
op_assign
id|mask
op_amp
l_int|0777
suffix:semicolon
r_return
(paren
id|old
)paren
suffix:semicolon
)brace
eof
