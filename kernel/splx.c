multiline_comment|/*&n; * splx.c - SYSV DDI/DKI ipl manipulation functions&n; *&n; * Internally, many unices use a range of different interrupt &n; * priveledge levels, ie from &quot;allow all interrupts&quot; (7) to &n; * &quot;allow no interrupts.&quot; (0) under SYSV.&n; *&n; * This a simple splx() function behaves as the SYSV DDI/DKI function does,&n; * although since Linux only implements the equivalent of level 0 (cli) and&n; * level 7 (sti), this implementation only implements those levels.&n; * &n; * Also, unlike the current Linux routines, splx() also returns the &n; * old priveledge level so that it can be restored.&n; */
macro_line|#include &lt;asm/system.h&gt;
DECL|function|splx
r_int
id|splx
(paren
r_int
id|new_level
)paren
(brace
r_register
r_int
id|old_level
comma
id|tmp
suffix:semicolon
id|save_flags
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|old_level
op_assign
(paren
id|tmp
op_amp
l_int|0x200
)paren
ques
c_cond
l_int|7
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|new_level
)paren
id|sti
c_func
(paren
)paren
suffix:semicolon
r_else
id|cli
c_func
(paren
)paren
suffix:semicolon
r_return
id|old_level
suffix:semicolon
)brace
eof
