multiline_comment|/*&n; *&t;NET2Debugged, generic socket properties.&n; *&n; *&t;This module provides the generic option control and memory handling&n; *&t;for a socket of any kind.&n; *&n; * Version:&t;@(#)sock.c&t;1.28&t;26/12/93&n; *&n; * Authors:&t;Alan Cox &lt;iiitac@pyr.swan.ac.uk&gt;&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &quot;inet.h&quot;
macro_line|#include &quot;dev.h&quot;
macro_line|#include &quot;ip.h&quot;
macro_line|#include &quot;protocol.h&quot;
macro_line|#include &quot;arp.h&quot;
macro_line|#include &quot;route.h&quot;
macro_line|#include &quot;tcp.h&quot;
macro_line|#include &quot;udp.h&quot;
macro_line|#include &quot;skbuff.h&quot;
macro_line|#include &quot;sock.h&quot;
macro_line|#include &quot;raw.h&quot;
macro_line|#include &quot;icmp.h&quot;
r_static
id|__inline__
r_int
DECL|function|min
id|min
c_func
(paren
r_int
r_int
id|a
comma
r_int
r_int
id|b
)paren
(brace
r_if
c_cond
(paren
id|a
OL
id|b
)paren
r_return
id|a
suffix:semicolon
r_return
id|b
suffix:semicolon
)brace
macro_line|#ifdef SOCK_DEBUG
DECL|function|print_sk
r_void
id|print_sk
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  print_sk(NULL)&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;  wmem_alloc = %lu&bslash;n&quot;
comma
id|sk-&gt;wmem_alloc
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  rmem_alloc = %lu&bslash;n&quot;
comma
id|sk-&gt;rmem_alloc
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  send_head = %p&bslash;n&quot;
comma
id|sk-&gt;send_head
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  state = %d&bslash;n&quot;
comma
id|sk-&gt;state
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  wback = %p, rqueue = %p&bslash;n&quot;
comma
id|sk-&gt;wback
comma
id|sk-&gt;rqueue
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  wfront = %p&bslash;n&quot;
comma
id|sk-&gt;wfront
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  daddr = %lX, saddr = %lX&bslash;n&quot;
comma
id|sk-&gt;daddr
comma
id|sk-&gt;saddr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  num = %d&quot;
comma
id|sk-&gt;num
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; next = %p&bslash;n&quot;
comma
id|sk-&gt;next
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  send_seq = %ld, acked_seq = %ld, copied_seq = %ld&bslash;n&quot;
comma
id|sk-&gt;send_seq
comma
id|sk-&gt;acked_seq
comma
id|sk-&gt;copied_seq
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  rcv_ack_seq = %ld, window_seq = %ld, fin_seq = %ld&bslash;n&quot;
comma
id|sk-&gt;rcv_ack_seq
comma
id|sk-&gt;window_seq
comma
id|sk-&gt;fin_seq
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  prot = %p&bslash;n&quot;
comma
id|sk-&gt;prot
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  pair = %p, back_log = %p&bslash;n&quot;
comma
id|sk-&gt;pair
comma
id|sk-&gt;back_log
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  inuse = %d , blog = %d&bslash;n&quot;
comma
id|sk-&gt;inuse
comma
id|sk-&gt;blog
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  dead = %d delay_acks=%d&bslash;n&quot;
comma
id|sk-&gt;dead
comma
id|sk-&gt;delay_acks
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  retransmits = %ld, timeout = %d&bslash;n&quot;
comma
id|sk-&gt;retransmits
comma
id|sk-&gt;timeout
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  cong_window = %d, packets_out = %d&bslash;n&quot;
comma
id|sk-&gt;cong_window
comma
id|sk-&gt;packets_out
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  urg = %d shutdown=%d&bslash;n&quot;
comma
id|sk-&gt;urg
comma
id|sk-&gt;shutdown
)paren
suffix:semicolon
)brace
DECL|function|print_skb
r_void
id|print_skb
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  print_skb(NULL)&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;  prev = %p, next = %p&bslash;n&quot;
comma
id|skb-&gt;prev
comma
id|skb-&gt;next
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  sk = %p link3 = %p&bslash;n&quot;
comma
id|skb-&gt;sk
comma
id|skb-&gt;link3
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  mem_addr = %p, mem_len = %lu&bslash;n&quot;
comma
id|skb-&gt;mem_addr
comma
id|skb-&gt;mem_len
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  used = %d free = %d&bslash;n&quot;
comma
id|skb-&gt;used
comma
id|skb-&gt;free
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *&t;This is meant for all protocols to use and covers goings on&n; *&t;at the socket level. Everything here is generic.&n; */
DECL|function|sock_setsockopt
r_int
id|sock_setsockopt
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_int
id|val
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|linger
id|ling
suffix:semicolon
r_if
c_cond
(paren
id|optval
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|optval
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|val
op_assign
id|get_fs_long
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|optval
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|SO_TYPE
suffix:colon
r_case
id|SO_ERROR
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_case
id|SO_DEBUG
suffix:colon
id|sk-&gt;debug
op_assign
id|val
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SO_DONTROUTE
suffix:colon
multiline_comment|/* Still to be implemented */
r_return
l_int|0
suffix:semicolon
r_case
id|SO_BROADCAST
suffix:colon
id|sk-&gt;broadcast
op_assign
id|val
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SO_SNDBUF
suffix:colon
r_if
c_cond
(paren
id|val
OG
l_int|32767
)paren
(brace
id|val
op_assign
l_int|32767
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
OL
l_int|256
)paren
(brace
id|val
op_assign
l_int|256
suffix:semicolon
)brace
id|sk-&gt;sndbuf
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SO_LINGER
suffix:colon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|optval
comma
r_sizeof
(paren
id|ling
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|memcpy_fromfs
c_func
(paren
op_amp
id|ling
comma
id|optval
comma
r_sizeof
(paren
id|ling
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ling.l_onoff
op_eq
l_int|0
)paren
(brace
id|sk-&gt;linger
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|sk-&gt;lingertime
op_assign
id|ling.l_linger
suffix:semicolon
id|sk-&gt;linger
op_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SO_RCVBUF
suffix:colon
r_if
c_cond
(paren
id|val
OG
l_int|32767
)paren
(brace
id|val
op_assign
l_int|32767
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
OL
l_int|256
)paren
(brace
id|val
op_assign
l_int|256
suffix:semicolon
)brace
id|sk-&gt;rcvbuf
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SO_REUSEADDR
suffix:colon
r_if
c_cond
(paren
id|val
)paren
id|sk-&gt;reuse
op_assign
l_int|1
suffix:semicolon
r_else
id|sk-&gt;reuse
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SO_KEEPALIVE
suffix:colon
r_if
c_cond
(paren
id|val
)paren
id|sk-&gt;keepopen
op_assign
l_int|1
suffix:semicolon
r_else
id|sk-&gt;keepopen
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SO_OOBINLINE
suffix:colon
r_if
c_cond
(paren
id|val
)paren
id|sk-&gt;urginline
op_assign
l_int|1
suffix:semicolon
r_else
id|sk-&gt;urginline
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SO_NO_CHECK
suffix:colon
r_if
c_cond
(paren
id|val
)paren
id|sk-&gt;no_check
op_assign
l_int|1
suffix:semicolon
r_else
id|sk-&gt;no_check
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SO_PRIORITY
suffix:colon
r_if
c_cond
(paren
id|val
op_ge
l_int|0
op_logical_and
id|val
OL
id|DEV_NUMBUFFS
)paren
(brace
id|sk-&gt;priority
op_assign
id|val
suffix:semicolon
)brace
r_else
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
)brace
DECL|function|sock_getsockopt
r_int
id|sock_getsockopt
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
r_int
id|val
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|linger
id|ling
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|SO_DEBUG
suffix:colon
id|val
op_assign
id|sk-&gt;debug
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_DONTROUTE
suffix:colon
multiline_comment|/* One last option to implement */
id|val
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_BROADCAST
suffix:colon
id|val
op_assign
id|sk-&gt;broadcast
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_LINGER
suffix:colon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|optval
comma
r_sizeof
(paren
id|ling
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|optlen
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|put_fs_long
c_func
(paren
r_sizeof
(paren
id|ling
)paren
comma
(paren
r_int
r_int
op_star
)paren
id|optlen
)paren
suffix:semicolon
id|ling.l_onoff
op_assign
id|sk-&gt;linger
suffix:semicolon
id|ling.l_linger
op_assign
id|sk-&gt;lingertime
suffix:semicolon
id|memcpy_tofs
c_func
(paren
id|optval
comma
op_amp
id|ling
comma
r_sizeof
(paren
id|ling
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SO_SNDBUF
suffix:colon
id|val
op_assign
id|sk-&gt;sndbuf
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_RCVBUF
suffix:colon
id|val
op_assign
id|sk-&gt;rcvbuf
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_REUSEADDR
suffix:colon
id|val
op_assign
id|sk-&gt;reuse
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_KEEPALIVE
suffix:colon
id|val
op_assign
id|sk-&gt;keepopen
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_TYPE
suffix:colon
r_if
c_cond
(paren
id|sk-&gt;prot
op_eq
op_amp
id|tcp_prot
)paren
id|val
op_assign
id|SOCK_STREAM
suffix:semicolon
r_else
id|val
op_assign
id|SOCK_DGRAM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_ERROR
suffix:colon
id|val
op_assign
id|sk-&gt;err
suffix:semicolon
id|sk-&gt;err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_OOBINLINE
suffix:colon
id|val
op_assign
id|sk-&gt;urginline
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_NO_CHECK
suffix:colon
id|val
op_assign
id|sk-&gt;no_check
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_PRIORITY
suffix:colon
id|val
op_assign
id|sk-&gt;priority
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|optlen
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|put_fs_long
c_func
(paren
r_sizeof
(paren
r_int
)paren
comma
(paren
r_int
r_int
op_star
)paren
id|optlen
)paren
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|optval
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|put_fs_long
c_func
(paren
id|val
comma
(paren
r_int
r_int
op_star
)paren
id|optval
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sock_wmalloc
r_void
op_star
id|sock_wmalloc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|size
comma
r_int
id|force
comma
r_int
id|priority
)paren
(brace
r_if
c_cond
(paren
id|sk
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;wmem_alloc
op_plus
id|size
OL
id|sk-&gt;sndbuf
op_logical_or
id|force
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sk-&gt;wmem_alloc
op_add_assign
id|size
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|alloc_skb
c_func
(paren
id|size
comma
id|priority
)paren
suffix:semicolon
)brace
id|DPRINTF
c_func
(paren
(paren
id|DBG_INET
comma
l_string|&quot;sock_wmalloc(%X,%d,%d,%d) returning NULL&bslash;n&quot;
comma
id|sk
comma
id|size
comma
id|force
comma
id|priority
)paren
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|alloc_skb
c_func
(paren
id|size
comma
id|priority
)paren
suffix:semicolon
)brace
DECL|function|sock_rmalloc
r_void
op_star
id|sock_rmalloc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|size
comma
r_int
id|force
comma
r_int
id|priority
)paren
(brace
r_if
c_cond
(paren
id|sk
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;rmem_alloc
op_plus
id|size
OL
id|sk-&gt;rcvbuf
op_logical_or
id|force
)paren
(brace
r_void
op_star
id|c
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|priority
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
)paren
id|sk-&gt;rmem_alloc
op_add_assign
id|size
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|c
suffix:semicolon
)brace
id|DPRINTF
c_func
(paren
(paren
id|DBG_INET
comma
l_string|&quot;sock_rmalloc(%X,%d,%d,%d) returning NULL&bslash;n&quot;
comma
id|sk
comma
id|size
comma
id|force
comma
id|priority
)paren
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|alloc_skb
c_func
(paren
id|size
comma
id|priority
)paren
suffix:semicolon
)brace
DECL|function|sock_rspace
r_int
r_int
id|sock_rspace
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
id|amt
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;rmem_alloc
op_ge
id|sk-&gt;rcvbuf
op_minus
l_int|2
op_star
id|MIN_WINDOW
)paren
r_return
l_int|0
suffix:semicolon
id|amt
op_assign
id|min
c_func
(paren
(paren
id|sk-&gt;rcvbuf
op_minus
id|sk-&gt;rmem_alloc
)paren
op_div
l_int|2
op_minus
id|MIN_WINDOW
comma
id|MAX_WINDOW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amt
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|amt
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sock_wspace
r_int
r_int
id|sock_wspace
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_if
c_cond
(paren
id|sk
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;shutdown
op_amp
id|SEND_SHUTDOWN
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;wmem_alloc
op_ge
id|sk-&gt;sndbuf
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|sk-&gt;sndbuf
op_minus
id|sk-&gt;wmem_alloc
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sock_wfree
r_void
id|sock_wfree
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_void
op_star
id|mem
comma
r_int
r_int
id|size
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
id|DBG_INET
comma
l_string|&quot;sock_wfree(sk=%X, mem=%X, size=%d)&bslash;n&quot;
comma
id|sk
comma
id|mem
comma
id|size
)paren
)paren
suffix:semicolon
id|IS_SKB
c_func
(paren
id|mem
)paren
suffix:semicolon
id|skb
op_assign
id|mem
suffix:semicolon
id|kfree_skbmem
c_func
(paren
id|mem
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
id|sk-&gt;wmem_alloc
op_sub_assign
id|size
suffix:semicolon
multiline_comment|/* In case it might be waiting for more memory. */
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
id|sk
op_member_access_from_pointer
id|write_space
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;destroy
op_logical_and
id|sk-&gt;wmem_alloc
op_eq
l_int|0
op_logical_and
id|sk-&gt;rmem_alloc
op_eq
l_int|0
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
id|DBG_INET
comma
l_string|&quot;recovered lost memory, sock = %X&bslash;n&quot;
comma
id|sk
)paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
)brace
DECL|function|sock_rfree
r_void
id|sock_rfree
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_void
op_star
id|mem
comma
r_int
r_int
id|size
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|DPRINTF
c_func
(paren
(paren
id|DBG_INET
comma
l_string|&quot;sock_rfree(sk=%X, mem=%X, size=%d)&bslash;n&quot;
comma
id|sk
comma
id|mem
comma
id|size
)paren
)paren
suffix:semicolon
id|IS_SKB
c_func
(paren
id|mem
)paren
suffix:semicolon
id|skb
op_assign
id|mem
suffix:semicolon
id|kfree_skbmem
c_func
(paren
id|mem
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
id|sk-&gt;rmem_alloc
op_sub_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;destroy
op_logical_and
id|sk-&gt;wmem_alloc
op_eq
l_int|0
op_logical_and
id|sk-&gt;rmem_alloc
op_eq
l_int|0
)paren
(brace
id|DPRINTF
c_func
(paren
(paren
id|DBG_INET
comma
l_string|&quot;recovered lot memory, sock = %X&bslash;n&quot;
comma
id|sk
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
eof
