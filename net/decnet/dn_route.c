multiline_comment|/*&n; * DECnet       An implementation of the DECnet protocol suite for the LINUX&n; *              operating system.  DECnet is implemented using the  BSD Socket&n; *              interface as the means of communication with the user level.&n; *&n; *              DECnet Routing Functions (Endnode and Router)&n; *&n; * Authors:     Steve Whitehouse &lt;SteveW@ACM.org&gt;&n; *              Eduardo Marcelo Serrat &lt;emserrat@geocities.com&gt;&n; *&n; * Changes:&n; *              Steve Whitehouse : Fixes to allow &quot;intra-ethernet&quot; and&n; *                                 &quot;return-to-sender&quot; bits on outgoing&n; *                                 packets.&n; *&t;&t;Steve Whitehouse : Timeouts for cached routes.&n; *              Steve Whitehouse : Use dst cache for input routes too.&n; *              Steve Whitehouse : Fixed error values in dn_send_skb.&n; *              Steve Whitehouse : Rework routing functions to better fit&n; *                                 DECnet routing design&n; *              Alexey Kuznetsov : New SMP locking&n; *              Steve Whitehouse : More SMP locking changes &amp; dn_cache_dump()&n; *              Steve Whitehouse : Prerouting NF hook, now really is prerouting.&n; *&t;&t;&t;&t;   Fixed possible skb leak in rtnetlink funcs.&n; *              Steve Whitehouse : Dave Miller&squot;s dynamic hash table sizing and&n; *                                 Alexey Kuznetsov&squot;s finer grained locking&n; *                                 from ipv4/route.c.&n; *              Steve Whitehouse : Routing is now starting to look like a&n; *                                 sensible set of code now, mainly due to&n; *                                 my copying the IPv4 routing code. The&n; *                                 hooks here are modified and will continue&n; *                                 to evolve for a while.&n; *              Steve Whitehouse : Real SMP at last :-) Also new netfilter&n; *                                 stuff. Look out raw sockets your days&n; *                                 are numbered!&n; */
multiline_comment|/******************************************************************************&n;    (c) 1995-1998 E.M. Serrat&t;&t;emserrat@geocities.com&n;    &n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;*******************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/netfilter_decnet.h&gt;
macro_line|#include &lt;asm/errno.h&gt;
macro_line|#include &lt;net/neighbour.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/dn.h&gt;
macro_line|#include &lt;net/dn_dev.h&gt;
macro_line|#include &lt;net/dn_nsp.h&gt;
macro_line|#include &lt;net/dn_route.h&gt;
macro_line|#include &lt;net/dn_neigh.h&gt;
macro_line|#include &lt;net/dn_fib.h&gt;
DECL|struct|dn_rt_hash_bucket
r_struct
id|dn_rt_hash_bucket
(brace
DECL|member|chain
r_struct
id|dn_route
op_star
id|chain
suffix:semicolon
DECL|member|lock
id|rwlock_t
id|lock
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|__aligned__
c_func
(paren
l_int|8
)paren
)paren
)paren
suffix:semicolon
r_extern
r_struct
id|neigh_table
id|dn_neigh_table
suffix:semicolon
DECL|variable|dn_hiord_addr
r_static
r_int
r_char
id|dn_hiord_addr
(braket
l_int|6
)braket
op_assign
(brace
l_int|0xAA
comma
l_int|0x00
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|variable|dn_rt_min_delay
r_int
id|dn_rt_min_delay
op_assign
l_int|2
op_star
id|HZ
suffix:semicolon
DECL|variable|dn_rt_max_delay
r_int
id|dn_rt_max_delay
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
DECL|variable|dn_rt_deadline
r_static
r_int
r_int
id|dn_rt_deadline
op_assign
l_int|0
suffix:semicolon
r_static
r_int
id|dn_dst_gc
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
comma
id|__u32
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_reroute
c_func
(paren
r_struct
id|dst_entry
op_star
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_negative_advice
c_func
(paren
r_struct
id|dst_entry
op_star
)paren
suffix:semicolon
r_static
r_void
id|dn_dst_link_failure
c_func
(paren
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
r_static
r_int
id|dn_route_input
c_func
(paren
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
r_static
r_void
id|dn_run_flush
c_func
(paren
r_int
r_int
id|dummy
)paren
suffix:semicolon
DECL|variable|dn_rt_hash_table
r_static
r_struct
id|dn_rt_hash_bucket
op_star
id|dn_rt_hash_table
suffix:semicolon
DECL|variable|dn_rt_hash_mask
r_static
r_int
id|dn_rt_hash_mask
suffix:semicolon
DECL|variable|dn_route_timer
r_static
r_struct
id|timer_list
id|dn_route_timer
suffix:semicolon
DECL|variable|dn_rt_flush_timer
r_static
r_struct
id|timer_list
id|dn_rt_flush_timer
op_assign
(brace
id|function
suffix:colon
id|dn_run_flush
)brace
suffix:semicolon
DECL|variable|decnet_dst_gc_interval
r_int
id|decnet_dst_gc_interval
op_assign
l_int|2
suffix:semicolon
DECL|variable|dn_dst_ops
r_static
r_struct
id|dst_ops
id|dn_dst_ops
op_assign
(brace
id|PF_DECnet
comma
id|__constant_htons
c_func
(paren
id|ETH_P_DNA_RT
)paren
comma
l_int|128
comma
id|dn_dst_gc
comma
id|dn_dst_check
comma
id|dn_dst_reroute
comma
l_int|NULL
comma
id|dn_dst_negative_advice
comma
id|dn_dst_link_failure
comma
r_sizeof
(paren
r_struct
id|dn_route
)paren
comma
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
)brace
suffix:semicolon
DECL|function|dn_hash
r_static
id|__inline__
r_int
id|dn_hash
c_func
(paren
r_int
r_int
id|src
comma
r_int
r_int
id|dst
)paren
(brace
r_int
r_int
id|tmp
op_assign
id|src
op_xor
id|dst
suffix:semicolon
id|tmp
op_xor_assign
(paren
id|tmp
op_rshift
l_int|3
)paren
suffix:semicolon
id|tmp
op_xor_assign
(paren
id|tmp
op_rshift
l_int|5
)paren
suffix:semicolon
id|tmp
op_xor_assign
(paren
id|tmp
op_rshift
l_int|10
)paren
suffix:semicolon
r_return
id|dn_rt_hash_mask
op_amp
(paren
r_int
)paren
id|tmp
suffix:semicolon
)brace
DECL|function|dn_dst_check_expire
r_static
r_void
id|SMP_TIMER_NAME
c_func
(paren
id|dn_dst_check_expire
)paren
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
comma
op_star
op_star
id|rtp
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
r_int
id|expire
op_assign
l_int|120
op_star
id|HZ
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|dn_rt_hash_mask
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rtp
op_assign
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|chain
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rt
op_assign
op_star
id|rtp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
)paren
op_logical_or
(paren
id|now
op_minus
id|rt-&gt;u.dst.lastuse
)paren
OL
id|expire
)paren
(brace
id|rtp
op_assign
op_amp
id|rt-&gt;u.rt_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
op_star
id|rtp
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|dst_free
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
)brace
id|write_unlock
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|now
)paren
OG
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|mod_timer
c_func
(paren
op_amp
id|dn_route_timer
comma
id|now
op_plus
id|decnet_dst_gc_interval
op_star
id|HZ
)paren
suffix:semicolon
)brace
id|SMP_TIMER_DEFINE
c_func
(paren
id|dn_dst_check_expire
comma
id|dn_dst_task
)paren
suffix:semicolon
DECL|function|dn_dst_gc
r_static
r_int
id|dn_dst_gc
c_func
(paren
r_void
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
comma
op_star
op_star
id|rtp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
r_int
id|expire
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|dn_rt_hash_mask
suffix:semicolon
id|i
op_increment
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
id|rtp
op_assign
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|chain
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rt
op_assign
op_star
id|rtp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
)paren
op_logical_or
(paren
id|now
op_minus
id|rt-&gt;u.dst.lastuse
)paren
OL
id|expire
)paren
(brace
id|rtp
op_assign
op_amp
id|rt-&gt;u.rt_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
op_star
id|rtp
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|dst_free
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_dst_check
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|__u32
id|cookie
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|dn_dst_reroute
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_reroute
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * This is called through sendmsg() when you specify MSG_TRYHARD&n; * and there is already a route in cache.&n; */
DECL|function|dn_dst_negative_advice
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_negative_advice
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|dn_dst_link_failure
r_static
r_void
id|dn_dst_link_failure
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|dn_insert_route
r_static
r_void
id|dn_insert_route
c_func
(paren
r_struct
id|dn_route
op_star
id|rt
comma
r_int
id|hash
)paren
(brace
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
op_assign
id|rt
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|rt-&gt;u.dst.__use
op_increment
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|now
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
DECL|function|dn_run_flush
r_void
id|SMP_TIMER_NAME
c_func
(paren
id|dn_run_flush
)paren
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
comma
op_star
id|next
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dn_rt_hash_mask
suffix:semicolon
id|i
op_increment
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt
op_assign
id|xchg
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|chain
comma
l_int|NULL
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|nothing_to_declare
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|next
)paren
(brace
id|next
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|dst_free
c_func
(paren
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
)paren
suffix:semicolon
)brace
id|nothing_to_declare
suffix:colon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
)brace
id|SMP_TIMER_DEFINE
c_func
(paren
id|dn_run_flush
comma
id|dn_flush_task
)paren
suffix:semicolon
DECL|variable|dn_rt_flush_lock
r_static
id|spinlock_t
id|dn_rt_flush_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|function|dn_rt_cache_flush
r_void
id|dn_rt_cache_flush
c_func
(paren
r_int
id|delay
)paren
(brace
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
id|user_mode
op_assign
op_logical_neg
id|in_interrupt
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delay
OL
l_int|0
)paren
id|delay
op_assign
id|dn_rt_min_delay
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|dn_rt_flush_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|dn_rt_flush_timer
)paren
op_logical_and
id|delay
OG
l_int|0
op_logical_and
id|dn_rt_deadline
)paren
(brace
r_int
id|tmo
op_assign
(paren
r_int
)paren
(paren
id|dn_rt_deadline
op_minus
id|now
)paren
suffix:semicolon
r_if
c_cond
(paren
id|user_mode
op_logical_and
id|tmo
OL
id|dn_rt_max_delay
op_minus
id|dn_rt_min_delay
)paren
id|tmo
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|delay
OG
id|tmo
)paren
id|delay
op_assign
id|tmo
suffix:semicolon
)brace
r_if
c_cond
(paren
id|delay
op_le
l_int|0
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_rt_flush_lock
)paren
suffix:semicolon
id|dn_run_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dn_rt_deadline
op_eq
l_int|0
)paren
id|dn_rt_deadline
op_assign
id|now
op_plus
id|dn_rt_max_delay
suffix:semicolon
id|dn_rt_flush_timer.expires
op_assign
id|now
op_plus
id|delay
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dn_rt_flush_timer
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|dn_rt_flush_lock
)paren
suffix:semicolon
)brace
DECL|function|dn_route_rx_packet
r_static
r_int
id|dn_route_rx_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dn_route_input
c_func
(paren
id|skb
)paren
)paren
op_eq
l_int|0
)paren
r_return
id|skb-&gt;dst
op_member_access_from_pointer
id|input
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_route_rx_long
r_static
r_int
id|dn_route_rx_long
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_int
r_char
op_star
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|21
)paren
multiline_comment|/* 20 for long header, 1 for shortest nsp */
r_goto
id|drop_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|20
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Destination info */
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;dst
op_assign
id|dn_htons
c_func
(paren
id|dn_eth2dn
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|ptr
comma
id|dn_hiord_addr
comma
l_int|4
)paren
op_ne
l_int|0
)paren
r_goto
id|drop_it
suffix:semicolon
id|ptr
op_add_assign
l_int|6
suffix:semicolon
multiline_comment|/* Source info */
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;src
op_assign
id|dn_htons
c_func
(paren
id|dn_eth2dn
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|ptr
comma
id|dn_hiord_addr
comma
l_int|4
)paren
op_ne
l_int|0
)paren
r_goto
id|drop_it
suffix:semicolon
id|ptr
op_add_assign
l_int|6
suffix:semicolon
multiline_comment|/* Other junk */
id|ptr
op_increment
suffix:semicolon
id|cb-&gt;hops
op_assign
op_star
id|ptr
op_increment
suffix:semicolon
multiline_comment|/* Visit Count */
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_PRE_ROUTING
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_route_rx_packet
)paren
suffix:semicolon
id|drop_it
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_route_rx_short
r_static
r_int
id|dn_route_rx_short
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_int
r_char
op_star
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|6
)paren
multiline_comment|/* 5 for short header + 1 for shortest nsp */
r_goto
id|drop_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|5
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|cb-&gt;dst
op_assign
op_star
(paren
id|dn_address
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;src
op_assign
op_star
(paren
id|dn_address
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;hops
op_assign
op_star
id|ptr
op_amp
l_int|0x3f
suffix:semicolon
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_PRE_ROUTING
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_route_rx_packet
)paren
suffix:semicolon
id|drop_it
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_route_discard
r_static
r_int
id|dn_route_discard
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_route_ptp_hello
r_static
r_int
id|dn_route_ptp_hello
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|dn_dev_hello
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dn_neigh_pointopoint_hello
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_route_rcv
r_int
id|dn_route_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
suffix:semicolon
r_int
r_char
id|flags
op_assign
l_int|0
suffix:semicolon
r_int
id|padlen
op_assign
l_int|0
suffix:semicolon
id|__u16
id|len
op_assign
id|dn_ntohs
c_func
(paren
op_star
(paren
id|__u16
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn
op_assign
(paren
r_struct
id|dn_dev
op_star
)paren
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dn
op_eq
l_int|NULL
)paren
r_goto
id|dump_it
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_share_check
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|skb-&gt;len
)paren
r_goto
id|dump_it
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|flags
op_assign
op_star
id|skb-&gt;data
suffix:semicolon
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
id|cb-&gt;stamp
op_assign
id|jiffies
suffix:semicolon
id|cb-&gt;iif
op_assign
id|dev-&gt;ifindex
suffix:semicolon
multiline_comment|/*&n;&t; * If we have padding, remove it.&n;&t; */
r_if
c_cond
(paren
id|flags
op_amp
id|DN_RT_F_PF
)paren
(brace
id|padlen
op_assign
id|flags
op_amp
op_complement
id|DN_RT_F_PF
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|padlen
)paren
suffix:semicolon
id|flags
op_assign
op_star
id|skb-&gt;data
suffix:semicolon
)brace
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/*&n;&t; * Weed out future version DECnet&n;&t; */
r_if
c_cond
(paren
id|flags
op_amp
id|DN_RT_F_VER
)paren
r_goto
id|dump_it
suffix:semicolon
id|cb-&gt;rt_flags
op_assign
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|decnet_debug_level
op_amp
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_route_rcv: got 0x%02x from %s [%d %d %d]&bslash;n&quot;
comma
(paren
r_int
)paren
id|flags
comma
(paren
id|dev
)paren
ques
c_cond
id|dev-&gt;name
suffix:colon
l_string|&quot;???&quot;
comma
id|len
comma
id|skb-&gt;len
comma
id|padlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|DN_RT_PKT_CNTL
)paren
(brace
r_switch
c_cond
(paren
id|flags
op_amp
id|DN_RT_CNTL_MSK
)paren
(brace
r_case
id|DN_RT_PKT_INIT
suffix:colon
id|dn_dev_init_pkt
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DN_RT_PKT_VERI
suffix:colon
id|dn_dev_veri_pkt
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dn-&gt;parms.state
op_ne
id|DN_DEV_S_RU
)paren
r_goto
id|dump_it
suffix:semicolon
r_switch
c_cond
(paren
id|flags
op_amp
id|DN_RT_CNTL_MSK
)paren
(brace
r_case
id|DN_RT_PKT_HELO
suffix:colon
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_HELLO
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_route_ptp_hello
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|DN_RT_PKT_L1RT
suffix:colon
r_case
id|DN_RT_PKT_L2RT
suffix:colon
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_ROUTE
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_route_discard
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|DN_RT_PKT_ERTH
suffix:colon
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_HELLO
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_neigh_router_hello
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|DN_RT_PKT_EEDH
suffix:colon
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_HELLO
comma
id|skb
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
id|dn_neigh_endnode_hello
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|dn-&gt;parms.state
op_ne
id|DN_DEV_S_RU
)paren
r_goto
id|dump_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Pull flags */
r_switch
c_cond
(paren
id|flags
op_amp
id|DN_RT_PKT_MSK
)paren
(brace
r_case
id|DN_RT_PKT_LONG
suffix:colon
r_return
id|dn_route_rx_long
c_func
(paren
id|skb
)paren
suffix:semicolon
r_case
id|DN_RT_PKT_SHORT
suffix:colon
r_return
id|dn_route_rx_short
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
id|dump_it
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_output
r_static
r_int
id|dn_output
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dst_entry
op_star
id|dst
op_assign
id|skb-&gt;dst
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
op_assign
(paren
r_struct
id|dn_route
op_star
)paren
id|dst
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dst-&gt;dev
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|dst-&gt;neighbour
)paren
op_eq
l_int|NULL
)paren
r_goto
id|error
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|cb-&gt;src
op_assign
id|rt-&gt;rt_saddr
suffix:semicolon
id|cb-&gt;dst
op_assign
id|rt-&gt;rt_daddr
suffix:semicolon
multiline_comment|/*&n;&t; * Always set the Intra-Ethernet bit on all outgoing packets&n;&t; * originated on this node. Only valid flag from upper layers&n;&t; * is return-to-sender-requested. Set hop count to 0 too.&n;&t; */
id|cb-&gt;rt_flags
op_and_assign
op_complement
id|DN_RT_F_RQR
suffix:semicolon
id|cb-&gt;rt_flags
op_or_assign
id|DN_RT_F_IE
suffix:semicolon
id|cb-&gt;hops
op_assign
l_int|0
suffix:semicolon
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_LOCAL_OUT
comma
id|skb
comma
l_int|NULL
comma
id|dev
comma
id|neigh-&gt;output
)paren
suffix:semicolon
id|error
suffix:colon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_output: This should not happen&bslash;n&quot;
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_DECNET_ROUTER
DECL|function|dn_forward
r_static
r_int
id|dn_forward
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
op_assign
id|skb-&gt;dst
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|dst-&gt;neighbour
)paren
op_eq
l_int|NULL
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/*&n;&t; * Hop count exceeded.&n;&t; */
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|cb-&gt;hops
OG
l_int|30
)paren
r_goto
id|drop
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dst-&gt;dev
suffix:semicolon
multiline_comment|/*&n;&t; * If packet goes out same interface it came in on, then set&n;&t; * the Intra-Ethernet bit. This has no effect for short&n;&t; * packets, so we don&squot;t need to test for them here.&n;&t; */
r_if
c_cond
(paren
id|cb-&gt;iif
op_eq
id|dst-&gt;dev-&gt;ifindex
)paren
id|cb-&gt;rt_flags
op_or_assign
id|DN_RT_F_IE
suffix:semicolon
r_else
id|cb-&gt;rt_flags
op_and_assign
op_complement
id|DN_RT_F_IE
suffix:semicolon
r_return
id|NF_HOOK
c_func
(paren
id|PF_DECnet
comma
id|NF_DN_FORWARD
comma
id|skb
comma
id|dev
comma
id|skb-&gt;dev
comma
id|neigh-&gt;output
)paren
suffix:semicolon
id|error
suffix:colon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_forward: This should not happen&bslash;n&quot;
)paren
suffix:semicolon
id|drop
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Drop packet. This is used for endnodes and for&n; * when we should not be forwarding packets from&n; * this dest.&n; */
DECL|function|dn_blackhole
r_static
r_int
id|dn_blackhole
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Used to catch bugs. This should never normally get&n; * called.&n; */
DECL|function|dn_rt_bug
r_static
r_int
id|dn_rt_bug
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_rt_bug: skb from:%04x to:%04x&bslash;n&quot;
comma
id|cb-&gt;src
comma
id|cb-&gt;dst
)paren
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|dn_route_output_slow
r_static
r_int
id|dn_route_output_slow
c_func
(paren
r_struct
id|dst_entry
op_star
op_star
id|pprt
comma
id|dn_address
id|dst
comma
id|dn_address
id|src
comma
r_int
id|flags
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|decnet_default_device
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_int
id|hash
suffix:semicolon
macro_line|#ifdef CONFIG_DECNET_ROUTER
r_struct
id|dn_fib_key
id|key
suffix:semicolon
r_struct
id|dn_fib_res
id|res
suffix:semicolon
r_int
id|err
suffix:semicolon
id|key.src
op_assign
id|src
suffix:semicolon
id|key.dst
op_assign
id|dst
suffix:semicolon
id|key.iif
op_assign
l_int|0
suffix:semicolon
id|key.oif
op_assign
l_int|0
suffix:semicolon
id|key.fwmark
op_assign
l_int|0
suffix:semicolon
id|key.scope
op_assign
id|RT_SCOPE_UNIVERSE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dn_fib_lookup
c_func
(paren
op_amp
id|key
comma
op_amp
id|res
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|res.type
)paren
(brace
r_case
id|RTN_UNICAST
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * This method of handling multipath&n;&t;&t;&t;&t; * routes is a hack and will change.&n;&t;&t;&t;&t; * It works for now though.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|res.fi-&gt;fib_nhs
)paren
id|dn_fib_select_multipath
c_func
(paren
op_amp
id|key
comma
op_amp
id|res
)paren
suffix:semicolon
id|neigh
op_assign
id|__neigh_lookup
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|DN_FIB_RES_GW
c_func
(paren
id|res
)paren
comma
id|DN_FIB_RES_DEV
c_func
(paren
id|res
)paren
comma
l_int|1
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|neigh
)paren
r_break
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RTN_UNREACHABLE
suffix:colon
id|err
op_assign
op_minus
id|EHOSTUNREACH
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dn_fib_res_put
c_func
(paren
op_amp
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_goto
id|got_route
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
op_ne
op_minus
id|ESRCH
)paren
r_return
id|err
suffix:semicolon
macro_line|#endif 
multiline_comment|/* Look in On-Ethernet cache first */
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MSG_TRYHARD
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|dn_neigh_lookup
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|dst
)paren
)paren
op_ne
l_int|NULL
)paren
r_goto
id|got_route
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dn_db
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Try default router */
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|neigh_clone
c_func
(paren
id|dn_db-&gt;router
)paren
)paren
op_ne
l_int|NULL
)paren
r_goto
id|got_route
suffix:semicolon
multiline_comment|/* Send to default device (and hope for the best) if above fail */
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|__neigh_lookup
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|dst
comma
id|dev
comma
l_int|1
)paren
)paren
op_ne
l_int|NULL
)paren
r_goto
id|got_route
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
id|got_route
suffix:colon
r_if
c_cond
(paren
(paren
id|rt
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|dn_dst_ops
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dn_db
op_assign
(paren
r_struct
id|dn_dev
op_star
)paren
id|neigh-&gt;dev-&gt;dn_ptr
suffix:semicolon
id|rt-&gt;key.saddr
op_assign
id|src
suffix:semicolon
id|rt-&gt;rt_saddr
op_assign
id|src
suffix:semicolon
id|rt-&gt;key.daddr
op_assign
id|dst
suffix:semicolon
id|rt-&gt;rt_daddr
op_assign
id|dst
suffix:semicolon
id|rt-&gt;key.oif
op_assign
id|neigh
ques
c_cond
id|neigh-&gt;dev-&gt;ifindex
suffix:colon
op_minus
l_int|1
suffix:semicolon
id|rt-&gt;key.iif
op_assign
l_int|0
suffix:semicolon
id|rt-&gt;key.fwmark
op_assign
l_int|0
suffix:semicolon
id|rt-&gt;u.dst.neighbour
op_assign
id|neigh
suffix:semicolon
id|rt-&gt;u.dst.dev
op_assign
id|neigh
ques
c_cond
id|neigh-&gt;dev
suffix:colon
l_int|NULL
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|dn_output
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|dn_rt_bug
suffix:semicolon
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|neigh-&gt;dev
comma
id|rt-&gt;rt_daddr
)paren
)paren
id|rt-&gt;u.dst.input
op_assign
id|dn_nsp_rx
suffix:semicolon
id|hash
op_assign
id|dn_hash
c_func
(paren
id|rt-&gt;key.saddr
comma
id|rt-&gt;key.daddr
)paren
suffix:semicolon
id|dn_insert_route
c_func
(paren
id|rt
comma
id|hash
)paren
suffix:semicolon
op_star
id|pprt
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_route_output
r_int
id|dn_route_output
c_func
(paren
r_struct
id|dst_entry
op_star
op_star
id|pprt
comma
id|dn_address
id|dst
comma
id|dn_address
id|src
comma
r_int
id|flags
)paren
(brace
r_int
id|hash
op_assign
id|dn_hash
c_func
(paren
id|src
comma
id|dst
)paren
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MSG_TRYHARD
)paren
)paren
(brace
id|read_lock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
(paren
id|dst
op_eq
id|rt-&gt;key.daddr
)paren
op_logical_and
(paren
id|src
op_eq
id|rt-&gt;key.saddr
)paren
op_logical_and
(paren
id|rt-&gt;key.iif
op_eq
l_int|0
)paren
op_logical_and
(paren
id|rt-&gt;key.oif
op_ne
l_int|0
)paren
)paren
(brace
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|rt-&gt;u.dst.__use
op_increment
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
op_star
id|pprt
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
r_return
id|dn_route_output_slow
c_func
(paren
id|pprt
comma
id|dst
comma
id|src
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|dn_route_input_slow
r_static
r_int
id|dn_route_input_slow
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
op_assign
l_int|NULL
suffix:semicolon
r_int
(paren
op_star
id|dnrt_input
)paren
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_int
(paren
op_star
id|dnrt_output
)paren
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
id|u32
id|fwmark
op_assign
l_int|0
suffix:semicolon
r_int
id|hash
suffix:semicolon
id|dn_address
id|saddr
op_assign
id|cb-&gt;src
suffix:semicolon
id|dn_address
id|daddr
op_assign
id|cb-&gt;dst
suffix:semicolon
macro_line|#ifdef CONFIG_DECNET_ROUTER
r_struct
id|dn_fib_key
id|key
suffix:semicolon
r_struct
id|dn_fib_res
id|res
suffix:semicolon
r_int
id|err
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dn_db
op_assign
id|dev-&gt;dn_ptr
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t; * In this case we&squot;ve just received a packet from a source&n;&t; * outside ourselves pretending to come from us. We don&squot;t&n;&t; * allow it any further to prevent routing loops, spoofing and&n;&t; * other nasties. Loopback packets already have the dst attached&n;&t; * so this only affects packets which have originated elsewhere.&n;&t; */
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|dev
comma
id|cb-&gt;src
)paren
)paren
r_return
op_minus
id|ENOTUNIQ
suffix:semicolon
multiline_comment|/*&n;&t; * Default is to create a drop everything entry&n;&t; */
id|dnrt_input
op_assign
id|dn_blackhole
suffix:semicolon
id|dnrt_output
op_assign
id|dn_rt_bug
suffix:semicolon
multiline_comment|/*&n;&t; * Is the destination us ?&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|dn_dev_islocal
c_func
(paren
id|dev
comma
id|cb-&gt;dst
)paren
)paren
r_goto
id|non_local_input
suffix:semicolon
multiline_comment|/*&n;&t; * Local input... find source of skb&n;&t; */
id|dnrt_input
op_assign
id|dn_nsp_rx
suffix:semicolon
id|dnrt_output
op_assign
id|dn_output
suffix:semicolon
id|saddr
op_assign
id|cb-&gt;dst
suffix:semicolon
id|daddr
op_assign
id|cb-&gt;src
suffix:semicolon
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|neigh_lookup
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|cb-&gt;src
comma
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
r_goto
id|add_entry
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;router
op_logical_and
(paren
(paren
id|neigh
op_assign
id|neigh_clone
c_func
(paren
id|dn_db-&gt;router
)paren
)paren
op_ne
l_int|NULL
)paren
)paren
r_goto
id|add_entry
suffix:semicolon
id|neigh
op_assign
id|neigh_create
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|cb-&gt;src
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_ERR
c_func
(paren
id|neigh
)paren
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_ETHER
)paren
id|memcpy
c_func
(paren
id|neigh-&gt;ha
comma
id|skb-&gt;mac.ethernet-&gt;h_source
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_goto
id|add_entry
suffix:semicolon
)brace
r_return
id|PTR_ERR
c_func
(paren
id|neigh
)paren
suffix:semicolon
id|non_local_input
suffix:colon
macro_line|#ifdef CONFIG_DECNET_ROUTER
multiline_comment|/*&n;&t; * Destination is another node... find next hop in&n;&t; * routing table here.&n;&t; */
id|key.src
op_assign
id|cb-&gt;src
suffix:semicolon
id|key.dst
op_assign
id|cb-&gt;dst
suffix:semicolon
id|key.iif
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|key.oif
op_assign
l_int|0
suffix:semicolon
id|key.scope
op_assign
id|RT_SCOPE_UNIVERSE
suffix:semicolon
macro_line|#ifdef CONFIG_DECNET_ROUTE_FWMARK
id|key.fwmark
op_assign
id|skb-&gt;nfmark
suffix:semicolon
macro_line|#else
id|key.fwmark
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dn_fib_lookup
c_func
(paren
op_amp
id|key
comma
op_amp
id|res
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|res.type
)paren
(brace
r_case
id|RTN_UNICAST
suffix:colon
r_if
c_cond
(paren
id|res.fi-&gt;fib_nhs
)paren
id|dn_fib_select_multipath
c_func
(paren
op_amp
id|key
comma
op_amp
id|res
)paren
suffix:semicolon
id|neigh
op_assign
id|__neigh_lookup
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|DN_FIB_RES_GW
c_func
(paren
id|res
)paren
comma
id|DN_FIB_RES_DEV
c_func
(paren
id|res
)paren
comma
l_int|1
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|neigh
)paren
r_break
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|dnrt_input
op_assign
id|dn_forward
suffix:semicolon
id|fwmark
op_assign
id|key.fwmark
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RTN_UNREACHABLE
suffix:colon
id|dnrt_input
op_assign
id|dn_blackhole
suffix:semicolon
id|fwmark
op_assign
id|key.fwmark
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dn_fib_res_put
c_func
(paren
op_amp
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_goto
id|add_entry
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
macro_line|#endif /* CONFIG_DECNET_ROUTER */
id|add_entry
suffix:colon
r_if
c_cond
(paren
(paren
id|rt
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|dn_dst_ops
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|rt-&gt;key.saddr
op_assign
id|cb-&gt;src
suffix:semicolon
id|rt-&gt;rt_saddr
op_assign
id|saddr
suffix:semicolon
id|rt-&gt;key.daddr
op_assign
id|cb-&gt;dst
suffix:semicolon
id|rt-&gt;rt_daddr
op_assign
id|daddr
suffix:semicolon
id|rt-&gt;key.oif
op_assign
l_int|0
suffix:semicolon
id|rt-&gt;key.iif
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|rt-&gt;key.fwmark
op_assign
id|fwmark
suffix:semicolon
id|rt-&gt;u.dst.neighbour
op_assign
id|neigh
suffix:semicolon
id|rt-&gt;u.dst.dev
op_assign
id|neigh
ques
c_cond
id|neigh-&gt;dev
suffix:colon
l_int|NULL
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|dnrt_output
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|dnrt_input
suffix:semicolon
id|hash
op_assign
id|dn_hash
c_func
(paren
id|rt-&gt;key.saddr
comma
id|rt-&gt;key.daddr
)paren
suffix:semicolon
id|dn_insert_route
c_func
(paren
id|rt
comma
id|hash
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_route_input
r_int
id|dn_route_input
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_int
id|hash
op_assign
id|dn_hash
c_func
(paren
id|cb-&gt;src
comma
id|cb-&gt;dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;dst
)paren
r_return
l_int|0
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
id|rt
op_ne
l_int|NULL
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
(paren
id|rt-&gt;key.saddr
op_eq
id|cb-&gt;src
)paren
op_logical_and
(paren
id|rt-&gt;key.daddr
op_eq
id|cb-&gt;dst
)paren
op_logical_and
(paren
id|rt-&gt;key.oif
op_eq
l_int|0
)paren
op_logical_and
macro_line|#ifdef CONFIG_DECNET_ROUTE_FWMARK
(paren
id|rt-&gt;key.fwmark
op_eq
id|skb-&gt;nfmark
)paren
op_logical_and
macro_line|#endif
(paren
id|rt-&gt;key.iif
op_eq
id|cb-&gt;iif
)paren
)paren
(brace
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|rt-&gt;u.dst.__use
op_increment
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_return
id|dn_route_input_slow
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_RTNETLINK
DECL|function|dn_rt_fill_info
r_static
r_int
id|dn_rt_fill_info
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|pid
comma
id|u32
id|seq
comma
r_int
id|event
comma
r_int
id|nowait
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
(paren
r_struct
id|dn_route
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_struct
id|rtmsg
op_star
id|r
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
id|pid
comma
id|seq
comma
id|event
comma
r_sizeof
(paren
op_star
id|r
)paren
)paren
suffix:semicolon
id|r
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_assign
id|nowait
ques
c_cond
id|NLM_F_MULTI
suffix:colon
l_int|0
suffix:semicolon
id|r-&gt;rtm_family
op_assign
id|AF_DECnet
suffix:semicolon
id|r-&gt;rtm_dst_len
op_assign
l_int|16
suffix:semicolon
id|r-&gt;rtm_src_len
op_assign
l_int|16
suffix:semicolon
id|r-&gt;rtm_tos
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtm_table
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtm_type
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtm_flags
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtm_scope
op_assign
id|RT_SCOPE_UNIVERSE
suffix:semicolon
id|r-&gt;rtm_protocol
op_assign
id|RTPROT_UNSPEC
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_DST
comma
l_int|2
comma
op_amp
id|rt-&gt;rt_daddr
)paren
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_SRC
comma
l_int|2
comma
op_amp
id|rt-&gt;rt_saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.dev
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_OIF
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;u.dst.dev-&gt;ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.window
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTAX_WINDOW
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;u.dst.window
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.rtt
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTAX_RTT
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;u.dst.rtt
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|rtattr_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * This is called by both endnodes and routers now.&n; */
DECL|function|dn_cache_getroute
r_int
id|dn_cache_getroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|in_skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
suffix:semicolon
id|dn_address
id|dst
op_assign
l_int|0
suffix:semicolon
id|dn_address
id|src
op_assign
l_int|0
suffix:semicolon
r_int
id|iif
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|NLMSG_GOODSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|src
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|dst
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_IIF
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|iif
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_IIF
op_minus
l_int|1
)braket
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iif
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|iif
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;dn_ptr
)paren
(brace
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_DNA_RT
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|cb-&gt;src
op_assign
id|src
suffix:semicolon
id|cb-&gt;dst
op_assign
id|dst
suffix:semicolon
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|dn_route_input
c_func
(paren
id|skb
)paren
suffix:semicolon
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|cb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dn_skb_cb
)paren
)paren
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|dn_route
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|dn_route_output
c_func
(paren
(paren
r_struct
id|dst_entry
op_star
op_star
)paren
op_amp
id|rt
comma
id|dst
comma
id|src
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|rt-&gt;u.dst.error
)paren
id|err
op_assign
id|rt-&gt;u.dst.error
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;dev
)paren
id|dev_put
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out_free
suffix:semicolon
id|skb-&gt;dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
op_assign
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
suffix:semicolon
id|err
op_assign
id|dn_rt_fill_info
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|nlh-&gt;nlmsg_seq
comma
id|RTM_NEWROUTE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
r_goto
id|out_free
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
id|out_free
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * For routers, this is called from dn_fib_dump, but for endnodes its&n; * called directly from the rtnetlink dispatch table.&n; */
DECL|function|dn_cache_dump
r_int
id|dn_cache_dump
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
suffix:semicolon
r_int
id|h
comma
id|s_h
suffix:semicolon
r_int
id|idx
comma
id|s_idx
suffix:semicolon
r_if
c_cond
(paren
id|NLMSG_PAYLOAD
c_func
(paren
id|cb-&gt;nlh
comma
l_int|0
)paren
OL
r_sizeof
(paren
r_struct
id|rtmsg
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
(paren
r_struct
id|rtmsg
op_star
)paren
id|NLMSG_DATA
c_func
(paren
id|cb-&gt;nlh
)paren
)paren
op_member_access_from_pointer
id|rtm_flags
op_amp
id|RTM_F_CLONED
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|s_h
op_assign
id|cb-&gt;args
(braket
l_int|0
)braket
suffix:semicolon
id|s_idx
op_assign
id|idx
op_assign
id|cb-&gt;args
(braket
l_int|1
)braket
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
op_le
id|dn_rt_hash_mask
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|h
OL
id|s_h
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|h
OG
id|s_h
)paren
id|s_idx
op_assign
l_int|0
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|h
)braket
dot
id|lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|dn_rt_hash_table
(braket
id|h
)braket
dot
id|chain
comma
id|idx
op_assign
l_int|0
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.rt_next
comma
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|idx
OL
id|s_idx
)paren
r_continue
suffix:semicolon
id|skb-&gt;dst
op_assign
id|dst_clone
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_rt_fill_info
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|cb-&gt;skb
)paren
dot
id|pid
comma
id|cb-&gt;nlh-&gt;nlmsg_seq
comma
id|RTM_NEWROUTE
comma
l_int|1
)paren
op_le
l_int|0
)paren
(brace
id|dst_release
c_func
(paren
id|xchg
c_func
(paren
op_amp
id|skb-&gt;dst
comma
l_int|NULL
)paren
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|h
)braket
dot
id|lock
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|dst_release
c_func
(paren
id|xchg
c_func
(paren
op_amp
id|skb-&gt;dst
comma
l_int|NULL
)paren
)paren
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|h
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
id|done
suffix:colon
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
id|h
suffix:semicolon
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|idx
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_RTNETLINK */
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|decnet_cache_get_info
r_static
r_int
id|decnet_cache_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
id|buf1
(braket
id|DN_ASCBUF_LEN
)braket
comma
id|buf2
(braket
id|DN_ASCBUF_LEN
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|dn_rt_hash_mask
suffix:semicolon
id|i
op_increment
)paren
(brace
id|read_lock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
id|rt
op_assign
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|chain
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|rt
op_ne
l_int|NULL
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.rt_next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-8s %-7s %-7s %04d %04d %04d&bslash;n&quot;
comma
id|rt-&gt;u.dst.dev
ques
c_cond
id|rt-&gt;u.dst.dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
comma
id|dn_addr2asc
c_func
(paren
id|dn_ntohs
c_func
(paren
id|rt-&gt;rt_daddr
)paren
comma
id|buf1
)paren
comma
id|dn_addr2asc
c_func
(paren
id|dn_ntohs
c_func
(paren
id|rt-&gt;rt_saddr
)paren
comma
id|buf2
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
)paren
comma
id|rt-&gt;u.dst.__use
comma
(paren
r_int
)paren
id|rt-&gt;u.dst.rtt
)paren
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_break
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_break
suffix:semicolon
)brace
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
DECL|function|dn_route_init
r_void
id|__init
id|dn_route_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|goal
comma
id|order
suffix:semicolon
id|dn_dst_ops.kmem_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;dn_dst_cache&quot;
comma
r_sizeof
(paren
r_struct
id|dn_route
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dn_dst_ops.kmem_cachep
)paren
id|panic
c_func
(paren
l_string|&quot;DECnet: Failed to allocate dn_dst_cache&bslash;n&quot;
)paren
suffix:semicolon
id|dn_route_timer.function
op_assign
id|dn_dst_check_expire
suffix:semicolon
id|dn_route_timer.expires
op_assign
id|jiffies
op_plus
id|decnet_dst_gc_interval
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dn_route_timer
)paren
suffix:semicolon
id|goal
op_assign
id|num_physpages
op_rshift
(paren
l_int|26
op_minus
id|PAGE_SHIFT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
l_int|0
suffix:semicolon
(paren
l_int|1UL
op_lshift
id|order
)paren
OL
id|goal
suffix:semicolon
id|order
op_increment
)paren
(brace
multiline_comment|/* NOTHING */
suffix:semicolon
)brace
multiline_comment|/*&n;         * Only want 1024 entries max, since the table is very, very unlikely&n;         * to be larger than that.&n;         */
r_while
c_loop
(paren
id|order
op_logical_and
(paren
(paren
(paren
(paren
l_int|1UL
op_lshift
id|order
)paren
op_star
id|PAGE_SIZE
)paren
op_div
r_sizeof
(paren
r_struct
id|dn_rt_hash_bucket
)paren
)paren
op_ge
l_int|2048
)paren
)paren
(brace
id|order
op_decrement
suffix:semicolon
)brace
r_do
(brace
id|dn_rt_hash_mask
op_assign
(paren
l_int|1UL
op_lshift
id|order
)paren
op_star
id|PAGE_SIZE
op_div
r_sizeof
(paren
r_struct
id|dn_rt_hash_bucket
)paren
suffix:semicolon
r_while
c_loop
(paren
id|dn_rt_hash_mask
op_amp
(paren
id|dn_rt_hash_mask
op_minus
l_int|1
)paren
)paren
(brace
id|dn_rt_hash_mask
op_decrement
suffix:semicolon
)brace
id|dn_rt_hash_table
op_assign
(paren
r_struct
id|dn_rt_hash_bucket
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_ATOMIC
comma
id|order
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|dn_rt_hash_table
op_eq
l_int|NULL
op_logical_and
op_decrement
id|order
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dn_rt_hash_table
)paren
id|panic
c_func
(paren
l_string|&quot;Failed to allocate DECnet route cache hash table&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;DECnet: Routing cache hash table of %u buckets, %ldKbytes&bslash;n&quot;
comma
id|dn_rt_hash_mask
comma
(paren
r_int
)paren
(paren
id|dn_rt_hash_mask
op_star
r_sizeof
(paren
r_struct
id|dn_rt_hash_bucket
)paren
)paren
op_div
l_int|1024
)paren
suffix:semicolon
id|dn_rt_hash_mask
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|dn_rt_hash_mask
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
id|dn_rt_hash_table
(braket
id|i
)braket
dot
id|chain
op_assign
l_int|NULL
suffix:semicolon
)brace
id|dn_dst_ops.gc_thresh
op_assign
(paren
id|dn_rt_hash_mask
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_create
c_func
(paren
l_string|&quot;decnet_cache&quot;
comma
l_int|0
comma
id|decnet_cache_get_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
)brace
DECL|function|dn_route_cleanup
r_void
id|__exit
id|dn_route_cleanup
c_func
(paren
r_void
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|dn_route_timer
)paren
suffix:semicolon
id|dn_run_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_remove
c_func
(paren
l_string|&quot;decnet_cache&quot;
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
)brace
eof
