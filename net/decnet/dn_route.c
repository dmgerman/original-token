multiline_comment|/*&n; * DECnet       An implementation of the DECnet protocol suite for the LINUX&n; *              operating system.  DECnet is implemented using the  BSD Socket&n; *              interface as the means of communication with the user level.&n; *&n; *              DECnet Routing Functions (Endnode and Router)&n; *&n; * Authors:     Steve Whitehouse &lt;SteveW@ACM.org&gt;&n; *              Eduardo Marcelo Serrat &lt;emserrat@geocities.com&gt;&n; *&n; * Changes:&n; *              Steve Whitehouse : Fixes to allow &quot;intra-ethernet&quot; and&n; *                                 &quot;return-to-sender&quot; bits on outgoing&n; *                                 packets.&n; *&t;&t;Steve Whitehouse : Timeouts for cached routes.&n; *              Steve Whitehouse : Use dst cache for input routes too.&n; *              Steve Whitehouse : Fixed error values in dn_send_skb.&n; */
multiline_comment|/******************************************************************************&n;    (c) 1995-1998 E.M. Serrat&t;&t;emserrat@geocities.com&n;    &n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;*******************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/firewall.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/errno.h&gt;
macro_line|#include &lt;net/neighbour.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/dn.h&gt;
macro_line|#include &lt;net/dn_dev.h&gt;
macro_line|#include &lt;net/dn_nsp.h&gt;
macro_line|#include &lt;net/dn_route.h&gt;
macro_line|#include &lt;net/dn_neigh.h&gt;
macro_line|#include &lt;net/dn_fib.h&gt;
macro_line|#include &lt;net/dn_raw.h&gt;
r_extern
r_struct
id|neigh_table
id|dn_neigh_table
suffix:semicolon
DECL|macro|DN_HASHBUCKETS
mdefine_line|#define DN_HASHBUCKETS 16
DECL|variable|dn_hiord_addr
r_static
r_int
r_char
id|dn_hiord_addr
(braket
l_int|6
)braket
op_assign
(brace
l_int|0xAA
comma
l_int|0x00
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
r_static
r_int
id|dn_dst_gc
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
comma
id|__u32
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_reroute
c_func
(paren
r_struct
id|dst_entry
op_star
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_negative_advice
c_func
(paren
r_struct
id|dst_entry
op_star
)paren
suffix:semicolon
r_static
r_void
id|dn_dst_link_failure
c_func
(paren
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
r_static
r_int
id|dn_route_input
c_func
(paren
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
DECL|variable|dn_route_cache
r_static
r_struct
id|dn_route
op_star
id|dn_route_cache
(braket
id|DN_HASHBUCKETS
)braket
suffix:semicolon
DECL|variable|dn_route_timer
r_static
r_struct
id|timer_list
id|dn_route_timer
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|0L
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|decnet_dst_gc_interval
r_int
id|decnet_dst_gc_interval
op_assign
l_int|2
suffix:semicolon
DECL|variable|dn_dst_ops
r_static
r_struct
id|dst_ops
id|dn_dst_ops
op_assign
(brace
id|PF_DECnet
comma
id|__constant_htons
c_func
(paren
id|ETH_P_DNA_RT
)paren
comma
l_int|128
comma
id|dn_dst_gc
comma
id|dn_dst_check
comma
id|dn_dst_reroute
comma
l_int|NULL
comma
id|dn_dst_negative_advice
comma
id|dn_dst_link_failure
comma
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
)brace
suffix:semicolon
DECL|function|dn_hash
r_static
id|__inline__
r_int
id|dn_hash
c_func
(paren
r_int
r_int
id|dest
)paren
(brace
r_int
r_int
id|tmp
op_assign
(paren
id|dest
op_amp
l_int|0xff
)paren
op_xor
(paren
id|dest
op_rshift
l_int|8
)paren
suffix:semicolon
r_return
(paren
id|tmp
op_amp
l_int|0x0f
)paren
op_xor
(paren
id|tmp
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|dn_dst_check_expire
r_static
r_void
id|dn_dst_check_expire
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
comma
op_star
op_star
id|rtp
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
r_int
id|expire
op_assign
l_int|120
op_star
id|HZ
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DN_HASHBUCKETS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rtp
op_assign
op_amp
id|dn_route_cache
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
(paren
id|rt
op_assign
op_star
id|rtp
)paren
suffix:semicolon
id|rtp
op_assign
op_amp
id|rt-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.use
)paren
op_logical_or
(paren
id|now
op_minus
id|rt-&gt;u.dst.lastuse
)paren
OL
id|expire
)paren
r_continue
suffix:semicolon
op_star
id|rtp
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|dst_free
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|now
)paren
OG
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|dn_route_timer.expires
op_assign
id|now
op_plus
id|decnet_dst_gc_interval
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dn_route_timer
)paren
suffix:semicolon
)brace
DECL|function|dn_dst_gc
r_static
r_int
id|dn_dst_gc
c_func
(paren
r_void
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
comma
op_star
op_star
id|rtp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
r_int
id|expire
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DN_HASHBUCKETS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rtp
op_assign
op_amp
id|dn_route_cache
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
(paren
id|rt
op_assign
op_star
id|rtp
)paren
suffix:semicolon
id|rtp
op_assign
op_amp
id|rt-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.use
)paren
op_logical_or
(paren
id|now
op_minus
id|rt-&gt;u.dst.lastuse
)paren
OL
id|expire
)paren
r_continue
suffix:semicolon
op_star
id|rtp
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|dst_free
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_dst_check
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|__u32
id|cookie
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|dn_dst_reroute
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_reroute
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * This is called through sendmsg() when you specify MSG_TRYHARD&n; * and there is already a route in cache.&n; */
DECL|function|dn_dst_negative_advice
r_static
r_struct
id|dst_entry
op_star
id|dn_dst_negative_advice
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|dn_dst_link_failure
r_static
r_void
id|dn_dst_link_failure
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|dn_insert_route
r_static
r_void
id|dn_insert_route
c_func
(paren
r_struct
id|dn_route
op_star
id|rt
)paren
(brace
r_int
id|hash
op_assign
id|dn_hash
c_func
(paren
id|rt-&gt;rt_daddr
)paren
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
id|dn_route_cache
(braket
id|hash
)braket
suffix:semicolon
id|dn_route_cache
(braket
id|hash
)braket
op_assign
id|rt
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;u.dst.refcnt
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;u.dst.use
)paren
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|now
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_DECNET_MODULE)
DECL|function|dn_run_flush
r_static
r_void
id|dn_run_flush
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
comma
op_star
id|next
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DN_HASHBUCKETS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|rt
op_assign
id|xchg
c_func
(paren
op_amp
id|dn_route_cache
(braket
id|i
)braket
comma
l_int|NULL
)paren
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|next
)paren
(brace
id|next
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|dst_free
c_func
(paren
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* CONFIG_DECNET_MODULE */
DECL|function|dn_route_rx_long
r_static
r_int
id|dn_route_rx_long
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_int
r_char
op_star
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|21
)paren
multiline_comment|/* 20 for long header, 1 for shortest nsp */
r_goto
id|drop_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|20
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Destination info */
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;dst
op_assign
id|dn_htons
c_func
(paren
id|dn_eth2dn
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|ptr
comma
id|dn_hiord_addr
comma
l_int|4
)paren
op_ne
l_int|0
)paren
r_goto
id|drop_it
suffix:semicolon
id|ptr
op_add_assign
l_int|6
suffix:semicolon
multiline_comment|/* Source info */
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;src
op_assign
id|dn_htons
c_func
(paren
id|dn_eth2dn
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|ptr
comma
id|dn_hiord_addr
comma
l_int|4
)paren
op_ne
l_int|0
)paren
r_goto
id|drop_it
suffix:semicolon
id|ptr
op_add_assign
l_int|6
suffix:semicolon
multiline_comment|/* Other junk */
id|ptr
op_increment
suffix:semicolon
id|cb-&gt;hops
op_assign
op_star
id|ptr
op_increment
suffix:semicolon
multiline_comment|/* Visit Count */
r_if
c_cond
(paren
id|dn_route_input
c_func
(paren
id|skb
)paren
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef CONFIG_DECNET_FW
r_struct
id|neighbour
op_star
id|neigh
op_assign
id|skb-&gt;dst-&gt;neighbour
suffix:semicolon
r_switch
c_cond
(paren
id|call_in_firewall
c_func
(paren
id|PF_DECnet
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|skb
)paren
)paren
(brace
r_case
id|FW_REJECT
suffix:colon
id|neigh-&gt;ops
op_member_access_from_pointer
id|error_report
c_func
(paren
id|neigh
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FW_BLOCK
suffix:colon
r_default
suffix:colon
r_goto
id|drop_it
suffix:semicolon
r_case
id|FW_ACCEPT
suffix:colon
)brace
macro_line|#endif /* CONFIG_DECNET_FW */
r_return
id|skb-&gt;dst
op_member_access_from_pointer
id|input
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|drop_it
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_route_rx_short
r_static
r_int
id|dn_route_rx_short
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_int
r_char
op_star
id|ptr
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|6
)paren
multiline_comment|/* 5 for short header + 1 for shortest nsp */
r_goto
id|drop_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|5
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|cb-&gt;dst
op_assign
op_star
(paren
id|dn_address
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;src
op_assign
op_star
(paren
id|dn_address
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
id|cb-&gt;hops
op_assign
op_star
id|ptr
op_amp
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
id|dn_route_input
c_func
(paren
id|skb
)paren
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef CONFIG_DECNET_FW
r_struct
id|neighbour
op_star
id|neigh
op_assign
id|skb-&gt;dst-&gt;neighbour
suffix:semicolon
r_switch
c_cond
(paren
id|call_in_firewall
c_func
(paren
id|PF_DECnet
comma
id|skb-&gt;dev
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|skb
)paren
)paren
(brace
r_case
id|FW_REJECT
suffix:colon
id|neigh-&gt;ops
op_member_access_from_pointer
id|error_report
c_func
(paren
id|neigh
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FW_BLOCK
suffix:colon
r_default
suffix:colon
r_goto
id|drop_it
suffix:semicolon
r_case
id|FW_ACCEPT
suffix:colon
)brace
macro_line|#endif /* CONFIG_DECNET_FW */
r_return
id|skb-&gt;dst
op_member_access_from_pointer
id|input
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|drop_it
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_route_rcv
r_int
id|dn_route_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_int
r_char
id|flags
op_assign
l_int|0
suffix:semicolon
r_int
id|padlen
op_assign
l_int|0
suffix:semicolon
id|__u16
id|len
op_assign
id|dn_ntohs
c_func
(paren
op_star
(paren
id|__u16
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn
op_assign
(paren
r_struct
id|dn_dev
op_star
)paren
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dn
op_eq
l_int|NULL
)paren
r_goto
id|dump_it
suffix:semicolon
id|cb-&gt;stamp
op_assign
id|jiffies
suffix:semicolon
id|cb-&gt;iif
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|skb-&gt;len
)paren
r_goto
id|dump_it
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|flags
op_assign
op_star
id|skb-&gt;data
suffix:semicolon
multiline_comment|/*&n;&t; * If we have padding, remove it.&n;&t; */
r_if
c_cond
(paren
id|flags
op_amp
id|DN_RT_F_PF
)paren
(brace
id|padlen
op_assign
id|flags
op_amp
op_complement
id|DN_RT_F_PF
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|padlen
)paren
suffix:semicolon
id|flags
op_assign
op_star
id|skb-&gt;data
suffix:semicolon
)brace
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/*&n;&t; * Weed out future version DECnet&n;&t; */
r_if
c_cond
(paren
id|flags
op_amp
id|DN_RT_F_VER
)paren
r_goto
id|dump_it
suffix:semicolon
id|cb-&gt;rt_flags
op_assign
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|dn-&gt;parms.setsrc
)paren
id|dn-&gt;parms
dot
id|setsrc
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* printk(KERN_DEBUG &quot;dn_route_rcv: got 0x%02x from %s [%d %d %d]&bslash;n&quot;, (int)flags,&n;&t;&t;&t;&t;(dev) ? dev-&gt;name : &quot;???&quot;, len, skb-&gt;len, padlen);  */
macro_line|#ifdef CONFIG_DECNET_RAW
id|dn_raw_rx_routing
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_DECNET_RAW */
r_if
c_cond
(paren
id|flags
op_amp
id|DN_RT_PKT_CNTL
)paren
(brace
r_switch
c_cond
(paren
id|flags
op_amp
id|DN_RT_CNTL_MSK
)paren
(brace
r_case
id|DN_RT_PKT_INIT
suffix:colon
id|dn_dev_init_pkt
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DN_RT_PKT_VERI
suffix:colon
id|dn_dev_veri_pkt
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dn-&gt;parms.state
op_ne
id|DN_DEV_S_RU
)paren
r_goto
id|dump_it
suffix:semicolon
r_switch
c_cond
(paren
id|flags
op_amp
id|DN_RT_CNTL_MSK
)paren
(brace
r_case
id|DN_RT_PKT_HELO
suffix:colon
id|dn_dev_hello
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dn_neigh_pointopoint_hello
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|DN_RT_PKT_L1RT
suffix:colon
r_case
id|DN_RT_PKT_L2RT
suffix:colon
macro_line|#ifdef CONFIG_DECNET_ROUTER
r_return
id|dn_fib_rt_message
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#else
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_DECNET_ROUTER */
r_case
id|DN_RT_PKT_ERTH
suffix:colon
id|dn_neigh_router_hello
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|DN_RT_PKT_EEDH
suffix:colon
id|dn_neigh_endnode_hello
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|dn-&gt;parms.state
op_ne
id|DN_DEV_S_RU
)paren
r_goto
id|dump_it
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Pull flags */
r_switch
c_cond
(paren
id|flags
op_amp
id|DN_RT_PKT_MSK
)paren
(brace
r_case
id|DN_RT_PKT_LONG
suffix:colon
r_return
id|dn_route_rx_long
c_func
(paren
id|skb
)paren
suffix:semicolon
r_case
id|DN_RT_PKT_SHORT
suffix:colon
r_return
id|dn_route_rx_short
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
id|dump_it
suffix:colon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_route_rcv: Dumping packet&bslash;n&quot;
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_send_skb
r_void
id|dn_send_skb
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|skb-&gt;sk
suffix:semicolon
r_struct
id|dn_scp
op_star
id|scp
op_assign
op_amp
id|sk-&gt;protinfo.dn
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
(brace
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|scp-&gt;stamp
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* Record time packet was sent */
multiline_comment|/* printk(KERN_DEBUG &quot;dn_send_skb&bslash;n&quot;); */
r_if
c_cond
(paren
id|sk-&gt;dst_cache
op_logical_and
id|sk-&gt;dst_cache-&gt;obsolete
)paren
(brace
id|dst_release
c_func
(paren
id|sk-&gt;dst_cache
)paren
suffix:semicolon
id|sk-&gt;dst_cache
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;dst_cache
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|dn_route_output
c_func
(paren
id|sk
)paren
op_ne
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|sk-&gt;err
op_assign
id|EHOSTUNREACH
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|skb-&gt;dst
op_assign
id|dst_clone
c_func
(paren
id|sk-&gt;dst_cache
)paren
suffix:semicolon
id|sk-&gt;dst_cache
op_member_access_from_pointer
id|output
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|dn_output
r_static
r_int
id|dn_output
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dst_entry
op_star
id|dst
op_assign
id|skb-&gt;dst
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
op_assign
(paren
r_struct
id|dn_route
op_star
)paren
id|dst
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dst-&gt;dev
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dst-&gt;neighbour
)paren
r_goto
id|error
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|cb-&gt;src
op_assign
id|rt-&gt;rt_saddr
suffix:semicolon
id|cb-&gt;dst
op_assign
id|rt-&gt;rt_daddr
suffix:semicolon
multiline_comment|/*&n;&t; * Always set the Intra-Ethernet bit on all outgoing packets&n;&t; * originated on this node. Only valid flag from upper layers&n;&t; * is return-to-sender-requested. Set hop count to 0 too.&n;&t; */
id|cb-&gt;rt_flags
op_and_assign
op_complement
id|DN_RT_F_RQR
suffix:semicolon
id|cb-&gt;rt_flags
op_or_assign
id|DN_RT_F_IE
suffix:semicolon
id|cb-&gt;hops
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Filter through the outgoing firewall&n;&t; */
macro_line|#ifdef CONFIG_DECNET_FW
r_switch
c_cond
(paren
id|call_out_firewall
c_func
(paren
id|PF_DECnet
comma
id|dst-&gt;dev
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|skb
)paren
)paren
(brace
r_case
id|FW_REJECT
suffix:colon
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|drop
suffix:semicolon
r_case
id|FW_BLOCK
suffix:colon
r_default
suffix:colon
id|err
op_assign
l_int|0
suffix:semicolon
r_goto
id|drop
suffix:semicolon
r_case
id|FW_ACCEPT
suffix:colon
)brace
macro_line|#endif /* CONFIG_DECNET_FW */
r_return
id|dst-&gt;neighbour
op_member_access_from_pointer
id|output
c_func
(paren
id|skb
)paren
suffix:semicolon
id|error
suffix:colon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_output: This should not happen&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_DECNET_FW
id|drop
suffix:colon
macro_line|#endif
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_DECNET_ROUTER
DECL|function|dn_l2_forward
r_static
r_int
id|dn_l2_forward
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
op_assign
id|skb-&gt;dst
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dst-&gt;neighbour
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/*&n;&t; * Hop count exceeded.&n;&t; */
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|cb-&gt;hops
OG
l_int|30
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/*&n;&t; * Forwarding firewall&n;&t; */
macro_line|#ifdef CONFIG_DECNET_FW
r_switch
c_cond
(paren
id|call_fw_firewall
c_func
(paren
id|PF_DECnet
comma
id|dst-&gt;dev
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|skb
)paren
)paren
(brace
r_case
id|FW_REJECT
suffix:colon
id|dst-&gt;neighbour-&gt;ops
op_member_access_from_pointer
id|error_report
c_func
(paren
id|dst-&gt;neighbour
comma
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
r_case
id|FW_BLOCK
suffix:colon
r_default
suffix:colon
r_goto
id|drop
suffix:semicolon
r_case
id|FW_ACCEPT
suffix:colon
)brace
macro_line|#endif /* CONFIG_DECNET_FW */
id|skb-&gt;dev
op_assign
id|dst-&gt;dev
suffix:semicolon
multiline_comment|/*&n;&t; * If packet goes out same interface it came in on, then set&n;&t; * the Intra-Ethernet bit. This has no effect for short&n;&t; * packets, so we don&squot;t need to test for them here.&n;&t; */
r_if
c_cond
(paren
id|cb-&gt;iif
op_eq
id|dst-&gt;dev-&gt;ifindex
)paren
id|cb-&gt;rt_flags
op_or_assign
id|DN_RT_F_IE
suffix:semicolon
r_else
id|cb-&gt;rt_flags
op_and_assign
op_complement
id|DN_RT_F_IE
suffix:semicolon
macro_line|#ifdef CONFIG_DECNET_FW
r_switch
c_cond
(paren
id|call_out_firewall
c_func
(paren
id|PF_DECnet
comma
id|dst-&gt;dev
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|skb
)paren
)paren
(brace
r_case
id|FW_REJECT
suffix:colon
id|dst-&gt;neighbour-&gt;ops
op_member_access_from_pointer
id|error_report
c_func
(paren
id|dst-&gt;neighbour
comma
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
r_case
id|FW_BLOCK
suffix:colon
r_default
suffix:colon
r_goto
id|drop
suffix:semicolon
r_case
id|FW_ACCEPT
suffix:colon
)brace
macro_line|#endif /* CONFIG_DECNET_FW */
r_return
id|dst-&gt;neighbour
op_member_access_from_pointer
id|output
c_func
(paren
id|skb
)paren
suffix:semicolon
id|error
suffix:colon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_forward: This should not happen&bslash;n&quot;
)paren
suffix:semicolon
id|drop
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * Simple frontend to the l2 routing function which filters&n; * traffic not in our area when we should only do l1&n; * routing.&n; */
DECL|function|dn_l1_forward
r_static
r_int
id|dn_l1_forward
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dn_ntohs
c_func
(paren
id|cb-&gt;dst
op_xor
id|decnet_address
)paren
op_amp
l_int|0xfc00
)paren
op_eq
l_int|0
)paren
r_return
id|dn_l2_forward
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Drop packet. This is used for endnodes and for&n; * when we should not be forwarding packets from&n; * this dest.&n; */
DECL|function|dn_blackhole
r_static
r_int
id|dn_blackhole
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Used to catch bugs. This should never normally get&n; * called.&n; */
DECL|function|dn_rt_bug
r_static
r_int
id|dn_rt_bug
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
(brace
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_rt_bug: skb from:%04x to:%04x&bslash;n&quot;
comma
id|cb-&gt;src
comma
id|cb-&gt;dst
)paren
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|dn_route_output_slow
r_static
r_int
id|dn_route_output_slow
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
op_amp
id|sk-&gt;protinfo.dn
suffix:semicolon
id|dn_address
id|dest
op_assign
id|dn_saddr2dn
c_func
(paren
op_amp
id|scp-&gt;peer
)paren
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|decnet_default_device
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_int
r_char
id|addr
(braket
l_int|6
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_DECNET_ROUTER
r_if
c_cond
(paren
(paren
id|decnet_node_type
op_eq
id|DN_RT_INFO_L1RT
)paren
op_logical_or
(paren
id|decnet_node_type
op_eq
id|DN_RT_INFO_L2RT
)paren
)paren
(brace
macro_line|#if 0
r_struct
id|dn_fib_ent
op_star
id|fe
op_assign
id|dn_fib_lookup
c_func
(paren
id|dest
comma
id|decnet_address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fe
op_ne
l_int|NULL
)paren
(brace
id|neigh
op_assign
id|neigh_clone
c_func
(paren
id|fe-&gt;neigh
)paren
suffix:semicolon
id|dn_fib_release
c_func
(paren
id|fe
)paren
suffix:semicolon
r_goto
id|got_route
suffix:semicolon
)brace
macro_line|#endif
)brace
macro_line|#endif 
id|dn_dn2eth
c_func
(paren
id|addr
comma
id|dest
)paren
suffix:semicolon
multiline_comment|/* Look in On-Ethernet cache first */
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|dn_neigh_lookup
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|addr
)paren
)paren
op_ne
l_int|NULL
)paren
r_goto
id|got_route
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* FIXME: We need to change this for routing nodes */
multiline_comment|/* Send to default router if that doesn&squot;t work */
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|neigh_lookup
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|addr
comma
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
r_goto
id|got_route
suffix:semicolon
multiline_comment|/* Send to default device (and hope for the best) if above fail */
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|__neigh_lookup
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|addr
comma
id|dev
comma
l_int|1
)paren
)paren
op_ne
l_int|NULL
)paren
r_goto
id|got_route
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
id|got_route
suffix:colon
r_if
c_cond
(paren
(paren
id|rt
op_assign
id|dst_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dn_route
)paren
comma
op_amp
id|dn_dst_ops
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dn_db
op_assign
(paren
r_struct
id|dn_dev
op_star
)paren
id|neigh-&gt;dev-&gt;dn_ptr
suffix:semicolon
id|rt-&gt;rt_saddr
op_assign
id|decnet_address
suffix:semicolon
id|rt-&gt;rt_daddr
op_assign
id|dest
suffix:semicolon
id|rt-&gt;rt_oif
op_assign
id|neigh-&gt;dev-&gt;ifindex
suffix:semicolon
id|rt-&gt;rt_iif
op_assign
l_int|0
suffix:semicolon
id|rt-&gt;u.dst.neighbour
op_assign
id|neigh
suffix:semicolon
id|rt-&gt;u.dst.dev
op_assign
id|neigh-&gt;dev
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|dn_output
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|dn_rt_bug
suffix:semicolon
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|neigh-&gt;dev
comma
id|rt-&gt;rt_daddr
)paren
)paren
id|rt-&gt;u.dst.input
op_assign
id|dn_nsp_rx
suffix:semicolon
id|dn_insert_route
c_func
(paren
id|rt
)paren
suffix:semicolon
id|sk-&gt;dst_cache
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_route_output
r_int
id|dn_route_output
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|dn_scp
op_star
id|scp
op_assign
op_amp
id|sk-&gt;protinfo.dn
suffix:semicolon
id|dn_address
id|dest
op_assign
id|dn_saddr2dn
c_func
(paren
op_amp
id|scp-&gt;peer
)paren
suffix:semicolon
r_int
id|hash
op_assign
id|dn_hash
c_func
(paren
id|dest
)paren
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|src
op_assign
id|dn_saddr2dn
c_func
(paren
op_amp
id|scp-&gt;addr
)paren
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|dn_route_cache
(braket
id|hash
)braket
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
(paren
id|dest
op_eq
id|rt-&gt;rt_daddr
)paren
op_logical_and
(paren
id|src
op_eq
id|rt-&gt;rt_saddr
)paren
op_logical_and
(paren
id|rt-&gt;rt_iif
op_eq
l_int|0
)paren
op_logical_and
(paren
id|rt-&gt;rt_oif
op_ne
l_int|0
)paren
)paren
(brace
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;u.dst.use
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;u.dst.refcnt
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|sk-&gt;dst_cache
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_return
id|dn_route_output_slow
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
DECL|function|dn_route_input_slow
r_static
r_int
id|dn_route_input_slow
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
id|addr
(braket
l_int|6
)braket
suffix:semicolon
multiline_comment|/*&n;&t; * In this case we&squot;ve just received a packet from a source&n;&t; * outside ourselves pretending to come from us. We don&squot;t&n;&t; * allow it any further to prevent routing loops, spoofing and&n;&t; * other nasties. Loopback packets already have the dst attached&n;&t; * so this only affects packets which have originated elsewhere.&n;&t; */
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|dev
comma
id|cb-&gt;src
)paren
)paren
r_return
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_DECNET_ROUTER
r_if
c_cond
(paren
(paren
id|decnet_node_type
op_eq
id|DN_RT_INFO_L1RT
)paren
op_logical_or
(paren
id|decnet_node_type
op_eq
id|DN_RT_INFO_L2RT
)paren
)paren
(brace
macro_line|#if 0
r_struct
id|dn_fib_ent
op_star
id|fe
op_assign
l_int|NULL
suffix:semicolon
id|fe
op_assign
id|dn_fib_lookup
c_func
(paren
id|cb-&gt;src
comma
id|cb-&gt;dst
)paren
suffix:semicolon
multiline_comment|/* Try routing table first */
r_if
c_cond
(paren
id|fe
op_ne
l_int|NULL
)paren
(brace
id|neigh
op_assign
id|neigh_clone
c_func
(paren
id|fe-&gt;neigh
)paren
suffix:semicolon
id|dn_fib_release
c_func
(paren
id|fe
)paren
suffix:semicolon
r_goto
id|got_route
suffix:semicolon
)brace
macro_line|#endif
)brace
macro_line|#endif
id|dn_dn2eth
c_func
(paren
id|addr
comma
id|cb-&gt;src
)paren
suffix:semicolon
multiline_comment|/* Now see if we are directly connected */
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|dn_neigh_lookup
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|addr
)paren
)paren
op_ne
l_int|NULL
)paren
r_goto
id|got_route
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* FIXME: Try the default router here .... */
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|__neigh_lookup
c_func
(paren
op_amp
id|dn_neigh_table
comma
op_amp
id|addr
comma
id|dev
comma
l_int|1
)paren
)paren
op_ne
l_int|NULL
)paren
r_goto
id|got_route
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
id|got_route
suffix:colon
r_if
c_cond
(paren
(paren
id|rt
op_assign
id|dst_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dn_route
)paren
comma
op_amp
id|dn_dst_ops
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|rt-&gt;rt_saddr
op_assign
id|cb-&gt;dst
suffix:semicolon
id|rt-&gt;rt_daddr
op_assign
id|cb-&gt;src
suffix:semicolon
id|rt-&gt;rt_oif
op_assign
l_int|0
suffix:semicolon
id|rt-&gt;rt_iif
op_assign
id|neigh-&gt;dev-&gt;ifindex
suffix:semicolon
id|rt-&gt;u.dst.neighbour
op_assign
id|neigh
suffix:semicolon
id|rt-&gt;u.dst.dev
op_assign
id|neigh-&gt;dev
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|dn_output
suffix:semicolon
r_switch
c_cond
(paren
id|decnet_node_type
)paren
(brace
r_case
id|DN_RT_INFO_ENDN
suffix:colon
id|rt-&gt;u.dst.input
op_assign
id|dn_blackhole
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_DECNET_ROUTER
r_case
id|DN_RT_INFO_L1RT
suffix:colon
id|rt-&gt;u.dst.input
op_assign
id|dn_l1_forward
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DN_RT_INFO_L2RT
suffix:colon
id|rt-&gt;u.dst.input
op_assign
id|dn_l2_forward
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_DECNET_ROUTER */
r_default
suffix:colon
id|rt-&gt;u.dst.input
op_assign
id|dn_blackhole
suffix:semicolon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dn_route_input_slow: What kind of node are we?&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dn_dev_islocal
c_func
(paren
id|dev
comma
id|cb-&gt;dst
)paren
)paren
id|rt-&gt;u.dst.input
op_assign
id|dn_nsp_rx
suffix:semicolon
id|dn_insert_route
c_func
(paren
id|rt
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_route_input
r_int
id|dn_route_input
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
suffix:semicolon
r_struct
id|dn_skb_cb
op_star
id|cb
op_assign
(paren
r_struct
id|dn_skb_cb
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
r_int
id|hash
op_assign
id|dn_hash
c_func
(paren
id|cb-&gt;src
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;dst
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|dn_route_cache
(braket
id|hash
)braket
suffix:semicolon
id|rt
op_ne
l_int|NULL
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
(paren
id|rt-&gt;rt_saddr
op_eq
id|cb-&gt;dst
)paren
op_logical_and
(paren
id|rt-&gt;rt_daddr
op_eq
id|cb-&gt;src
)paren
op_logical_and
(paren
id|rt-&gt;rt_oif
op_eq
l_int|0
)paren
op_logical_and
(paren
id|rt-&gt;rt_iif
op_eq
id|cb-&gt;iif
)paren
)paren
(brace
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;u.dst.use
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;u.dst.refcnt
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|dn_route_input_slow
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_DECNET_ROUTER
macro_line|#ifdef CONFIG_RTNETLINK
DECL|function|dn_rt_fill_info
r_static
r_int
id|dn_rt_fill_info
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|pid
comma
id|u32
id|seq
comma
r_int
id|event
comma
r_int
id|nowait
)paren
(brace
r_struct
id|dn_route
op_star
id|rt
op_assign
(paren
r_struct
id|dn_route
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_struct
id|rtmsg
op_star
id|r
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
id|pid
comma
id|seq
comma
id|event
comma
r_sizeof
(paren
op_star
id|r
)paren
)paren
suffix:semicolon
id|r
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_assign
id|nowait
ques
c_cond
id|NLM_F_MULTI
suffix:colon
l_int|0
suffix:semicolon
id|r-&gt;rtm_family
op_assign
id|AF_DECnet
suffix:semicolon
id|r-&gt;rtm_dst_len
op_assign
l_int|16
suffix:semicolon
id|r-&gt;rtm_src_len
op_assign
l_int|16
suffix:semicolon
id|r-&gt;rtm_tos
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtm_table
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtm_type
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtm_scope
op_assign
id|RT_SCOPE_UNIVERSE
suffix:semicolon
id|r-&gt;rtm_protocol
op_assign
id|RTPROT_UNSPEC
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_DST
comma
l_int|2
comma
op_amp
id|rt-&gt;rt_daddr
)paren
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_SRC
comma
l_int|2
comma
op_amp
id|rt-&gt;rt_saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.dev
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_OIF
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;u.dst.dev-&gt;ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.window
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTAX_WINDOW
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;u.dst.window
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.rtt
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTAX_RTT
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;u.dst.rtt
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|rtattr_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|dn_fib_rtm_getroute
r_int
id|dn_fib_rtm_getroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|in_skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
multiline_comment|/* struct rtmsg *rtm = NLMSG_DATA(nlh); */
r_struct
id|dn_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
id|dn_address
id|dst
op_assign
l_int|0
suffix:semicolon
id|dn_address
id|src
op_assign
l_int|0
suffix:semicolon
r_int
id|iif
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|NLMSG_GOODSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|src
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|dst
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_IIF
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|iif
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_IIF
op_minus
l_int|1
)braket
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iif
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|iif
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;dn_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_DNA_RT
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|dn_route_input
c_func
(paren
id|skb
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|dn_route
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|rt-&gt;u.dst.error
)paren
id|err
op_assign
id|rt-&gt;u.dst.error
suffix:semicolon
)brace
r_else
(brace
r_int
id|oif
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|oif
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|skb-&gt;dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
op_assign
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
suffix:semicolon
id|err
op_assign
id|dn_rt_fill_info
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|nlh-&gt;nlmsg_seq
comma
id|RTM_NEWROUTE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
op_minus
id|EMSGSIZE
suffix:semicolon
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_RTNETLINK */
macro_line|#endif /* CONFIG_DECNET_ROUTER */
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|decnet_cache_get_info
r_static
r_int
id|decnet_cache_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_struct
id|dn_route
op_star
id|rt
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
id|buf1
(braket
id|DN_ASCBUF_LEN
)braket
comma
id|buf2
(braket
id|DN_ASCBUF_LEN
)braket
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DN_HASHBUCKETS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rt
op_assign
id|dn_route_cache
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|rt
op_ne
l_int|NULL
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.rt_next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-8s %-7s %-7s %04d %04d %04d&bslash;n&quot;
comma
id|rt-&gt;u.dst.dev
ques
c_cond
id|rt-&gt;u.dst.dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
comma
id|dn_addr2asc
c_func
(paren
id|dn_ntohs
c_func
(paren
id|rt-&gt;rt_daddr
)paren
comma
id|buf1
)paren
comma
id|dn_addr2asc
c_func
(paren
id|dn_ntohs
c_func
(paren
id|rt-&gt;rt_saddr
)paren
comma
id|buf2
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.use
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.refcnt
)paren
comma
(paren
r_int
)paren
id|rt-&gt;u.dst.rtt
)paren
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_break
suffix:semicolon
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|variable|proc_net_decnet_cache
r_static
r_struct
id|proc_dir_entry
id|proc_net_decnet_cache
op_assign
(brace
id|PROC_NET_DN_CACHE
comma
l_int|12
comma
l_string|&quot;decnet_cache&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|decnet_cache_get_info
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
DECL|function|dn_route_init
r_void
id|__init
id|dn_route_init
c_func
(paren
r_void
)paren
(brace
id|memset
c_func
(paren
id|dn_route_cache
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dn_route
op_star
)paren
op_star
id|DN_HASHBUCKETS
)paren
suffix:semicolon
id|dn_route_timer.function
op_assign
id|dn_dst_check_expire
suffix:semicolon
id|dn_route_timer.expires
op_assign
id|jiffies
op_plus
id|decnet_dst_gc_interval
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dn_route_timer
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_decnet_cache
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
)brace
macro_line|#ifdef CONFIG_DECNET_MODULE
DECL|function|dn_route_cleanup
r_void
id|dn_route_cleanup
c_func
(paren
r_void
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|dn_route_timer
)paren
suffix:semicolon
id|dn_run_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_unregister
c_func
(paren
id|PROC_NET_DN_CACHE
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
)brace
macro_line|#endif /* CONFIG_DECNET_MODULE */
eof
