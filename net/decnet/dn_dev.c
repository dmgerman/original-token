multiline_comment|/*&n; * DECnet       An implementation of the DECnet protocol suite for the LINUX&n; *              operating system.  DECnet is implemented using the  BSD Socket&n; *              interface as the means of communication with the user level.&n; *&n; *              DECnet Device Layer&n; *&n; * Authors:     Steve Whitehouse &lt;SteveW@ACM.org&gt;&n; *              Eduardo Marcelo Serrat &lt;emserrat@geocities.com&gt;&n; *&n; * Changes:&n; *          Steve Whitehouse : Devices now see incoming frames so they&n; *                             can mark on who it came from.&n; *          Steve Whitehouse : Fixed bug in creating neighbours. Each neighbour&n; *                             can now have a device specific setup func.&n; *          Steve Whitehouse : Added /proc/sys/net/decnet/conf/&lt;dev&gt;/&n; *          Steve Whitehouse : Fixed bug which sometimes killed timer&n; *          Steve Whitehouse : Multiple ifaddr support&n; *          Steve Whitehouse : SIOCGIFCONF is now a compile time option&n; *          Steve Whitehouse : /proc/sys/net/decnet/conf/&lt;sys&gt;/forwarding&n; *          Steve Whitehouse : Removed timer1 - its a user space issue now&n; *         Patrick Caulfield : Fixed router hello message format&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/if_ether.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;net/neighbour.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/dn.h&gt;
macro_line|#include &lt;net/dn_dev.h&gt;
macro_line|#include &lt;net/dn_route.h&gt;
macro_line|#include &lt;net/dn_neigh.h&gt;
macro_line|#include &lt;net/dn_fib.h&gt;
DECL|macro|DN_IFREQ_SIZE
mdefine_line|#define DN_IFREQ_SIZE (sizeof(struct ifreq) - sizeof(struct sockaddr) + sizeof(struct sockaddr_dn))
DECL|variable|dn_rt_all_end_mcast
r_static
r_char
id|dn_rt_all_end_mcast
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|0xAB
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|variable|dn_rt_all_rt_mcast
r_static
r_char
id|dn_rt_all_rt_mcast
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|0xAB
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x03
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|variable|dn_hiord
r_static
r_char
id|dn_hiord
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|0xAA
comma
l_int|0x00
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|variable|dn_eco_version
r_static
r_int
r_char
id|dn_eco_version
(braket
l_int|3
)braket
op_assign
(brace
l_int|0x02
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
r_extern
r_struct
id|neigh_table
id|dn_neigh_table
suffix:semicolon
DECL|variable|decnet_default_device
r_struct
id|net_device
op_star
id|decnet_default_device
op_assign
l_int|NULL
suffix:semicolon
r_static
r_struct
id|dn_dev
op_star
id|dn_dev_create
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
op_star
id|err
)paren
suffix:semicolon
r_static
r_void
id|dn_dev_delete
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_RTNETLINK
r_static
r_void
id|rtmsg_ifa
c_func
(paren
r_int
id|event
comma
r_struct
id|dn_ifaddr
op_star
id|ifa
)paren
suffix:semicolon
macro_line|#endif
r_static
r_int
id|dn_eth_up
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_void
id|dn_send_brd_hello
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#if 0
r_static
r_void
id|dn_send_ptp_hello
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|dn_dev_list
r_static
r_struct
id|dn_dev_parms
id|dn_dev_list
(braket
)braket
op_assign
(brace
(brace
id|ARPHRD_ETHER
comma
multiline_comment|/* Ethernet */
id|DN_DEV_BCAST
comma
id|DN_DEV_S_RU
comma
l_int|0
comma
l_int|1498
comma
l_int|1
comma
l_int|10
comma
l_int|0
comma
l_string|&quot;ethernet&quot;
comma
id|NET_DECNET_CONF_ETHER
comma
id|dn_eth_up
comma
l_int|NULL
comma
id|dn_send_brd_hello
comma
l_int|NULL
)brace
comma
(brace
id|ARPHRD_IPGRE
comma
multiline_comment|/* DECnet tunneled over GRE in IP */
id|DN_DEV_BCAST
comma
id|DN_DEV_S_RU
comma
l_int|0
comma
l_int|1400
comma
l_int|1
comma
l_int|10
comma
l_int|0
comma
l_string|&quot;ipgre&quot;
comma
id|NET_DECNET_CONF_GRE
comma
l_int|NULL
comma
l_int|NULL
comma
id|dn_send_brd_hello
comma
l_int|NULL
)brace
comma
macro_line|#if 0
(brace
id|ARPHRD_X25
comma
multiline_comment|/* Bog standard X.25 */
id|DN_DEV_UCAST
comma
id|DN_DEV_S_DS
comma
l_int|0
comma
l_int|230
comma
l_int|1
comma
l_int|120
comma
l_int|0
comma
l_string|&quot;x25&quot;
comma
id|NET_DECNET_CONF_X25
comma
l_int|NULL
comma
l_int|NULL
comma
id|dn_send_ptp_hello
comma
l_int|NULL
)brace
comma
macro_line|#endif
macro_line|#if 0
(brace
id|ARPHRD_PPP
comma
multiline_comment|/* DECnet over PPP */
id|DN_DEV_BCAST
comma
id|DN_DEV_S_RU
comma
l_int|0
comma
l_int|230
comma
l_int|1
comma
l_int|10
comma
l_int|0
comma
l_string|&quot;ppp&quot;
comma
id|NET_DECNET_CONF_PPP
comma
l_int|NULL
comma
l_int|NULL
comma
id|dn_send_brd_hello
comma
l_int|NULL
)brace
comma
macro_line|#endif
macro_line|#if 0
(brace
id|ARPHRD_DDCMP
comma
multiline_comment|/* DECnet over DDCMP */
id|DN_DEV_UCAST
comma
id|DN_DEV_S_DS
comma
l_int|0
comma
l_int|230
comma
l_int|1
comma
l_int|120
comma
l_int|0
comma
l_string|&quot;ddcmp&quot;
comma
id|NET_DECNET_CONF_DDCMP
comma
l_int|NULL
comma
l_int|NULL
comma
id|dn_send_ptp_hello
comma
l_int|NULL
)brace
comma
macro_line|#endif
(brace
id|ARPHRD_LOOPBACK
comma
multiline_comment|/* Loopback interface - always last */
id|DN_DEV_BCAST
comma
id|DN_DEV_S_RU
comma
l_int|0
comma
l_int|1498
comma
l_int|1
comma
l_int|10
comma
l_int|0
comma
l_string|&quot;loopback&quot;
comma
id|NET_DECNET_CONF_LOOPBACK
comma
l_int|NULL
comma
l_int|NULL
comma
id|dn_send_brd_hello
comma
l_int|NULL
)brace
)brace
suffix:semicolon
DECL|macro|DN_DEV_LIST_SIZE
mdefine_line|#define DN_DEV_LIST_SIZE (sizeof(dn_dev_list)/sizeof(struct dn_dev_parms))
DECL|macro|DN_DEV_PARMS_OFFSET
mdefine_line|#define DN_DEV_PARMS_OFFSET(x) ((int) ((char *) &amp;((struct dn_dev_parms *)0)-&gt;x))
macro_line|#ifdef CONFIG_SYSCTL
DECL|variable|min_t2
r_static
r_int
id|min_t2
(braket
)braket
op_assign
(brace
l_int|1
)brace
suffix:semicolon
DECL|variable|max_t2
r_static
r_int
id|max_t2
(braket
)braket
op_assign
(brace
l_int|60
)brace
suffix:semicolon
multiline_comment|/* No max specified, but this seems sensible */
DECL|variable|min_t3
r_static
r_int
id|min_t3
(braket
)braket
op_assign
(brace
l_int|1
)brace
suffix:semicolon
DECL|variable|max_t3
r_static
r_int
id|max_t3
(braket
)braket
op_assign
(brace
l_int|8191
)brace
suffix:semicolon
multiline_comment|/* Must fit in 16 bits when multiplied by BCT3MULT or T3MULT */
DECL|variable|min_priority
r_static
r_int
id|min_priority
(braket
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|variable|max_priority
r_static
r_int
id|max_priority
(braket
)braket
op_assign
(brace
l_int|127
)brace
suffix:semicolon
multiline_comment|/* From DECnet spec */
r_static
r_int
id|dn_forwarding_proc
c_func
(paren
id|ctl_table
op_star
comma
r_int
comma
r_struct
id|file
op_star
comma
r_void
op_star
comma
r_int
op_star
)paren
suffix:semicolon
r_static
r_int
id|dn_forwarding_sysctl
c_func
(paren
id|ctl_table
op_star
id|table
comma
r_int
op_star
id|name
comma
r_int
id|nlen
comma
r_void
op_star
id|oldval
comma
r_int
op_star
id|oldlenp
comma
r_void
op_star
id|newval
comma
r_int
id|newlen
comma
r_void
op_star
op_star
id|context
)paren
suffix:semicolon
DECL|struct|dn_dev_sysctl_table
r_static
r_struct
id|dn_dev_sysctl_table
(brace
DECL|member|sysctl_header
r_struct
id|ctl_table_header
op_star
id|sysctl_header
suffix:semicolon
DECL|member|dn_dev_vars
id|ctl_table
id|dn_dev_vars
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|dn_dev_dev
id|ctl_table
id|dn_dev_dev
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|dn_dev_conf_dir
id|ctl_table
id|dn_dev_conf_dir
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|dn_dev_proto_dir
id|ctl_table
id|dn_dev_proto_dir
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|dn_dev_root_dir
id|ctl_table
id|dn_dev_root_dir
(braket
l_int|2
)braket
suffix:semicolon
DECL|variable|dn_dev_sysctl
)brace
id|dn_dev_sysctl
op_assign
(brace
l_int|NULL
comma
(brace
(brace
id|NET_DECNET_CONF_DEV_FORWARDING
comma
l_string|&quot;forwarding&quot;
comma
(paren
r_void
op_star
)paren
id|DN_DEV_PARMS_OFFSET
c_func
(paren
id|forwarding
)paren
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
id|dn_forwarding_proc
comma
id|dn_forwarding_sysctl
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
id|NET_DECNET_CONF_DEV_PRIORITY
comma
l_string|&quot;priority&quot;
comma
(paren
r_void
op_star
)paren
id|DN_DEV_PARMS_OFFSET
c_func
(paren
id|priority
)paren
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
id|proc_dointvec_minmax
comma
id|sysctl_intvec
comma
l_int|NULL
comma
op_amp
id|min_priority
comma
op_amp
id|max_priority
)brace
comma
(brace
id|NET_DECNET_CONF_DEV_T2
comma
l_string|&quot;t2&quot;
comma
(paren
r_void
op_star
)paren
id|DN_DEV_PARMS_OFFSET
c_func
(paren
id|t2
)paren
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
id|proc_dointvec_minmax
comma
id|sysctl_intvec
comma
l_int|NULL
comma
op_amp
id|min_t2
comma
op_amp
id|max_t2
)brace
comma
(brace
id|NET_DECNET_CONF_DEV_T3
comma
l_string|&quot;t3&quot;
comma
(paren
r_void
op_star
)paren
id|DN_DEV_PARMS_OFFSET
c_func
(paren
id|t3
)paren
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
id|proc_dointvec_minmax
comma
id|sysctl_intvec
comma
l_int|NULL
comma
op_amp
id|min_t3
comma
op_amp
id|max_t3
)brace
comma
(brace
l_int|0
)brace
)brace
comma
(brace
(brace
l_int|0
comma
l_string|&quot;&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|dn_dev_sysctl.dn_dev_vars
)brace
comma
(brace
l_int|0
)brace
)brace
comma
(brace
(brace
id|NET_DECNET_CONF
comma
l_string|&quot;conf&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|dn_dev_sysctl.dn_dev_dev
)brace
comma
(brace
l_int|0
)brace
)brace
comma
(brace
(brace
id|NET_DECNET
comma
l_string|&quot;decnet&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|dn_dev_sysctl.dn_dev_conf_dir
)brace
comma
(brace
l_int|0
)brace
)brace
comma
(brace
(brace
id|CTL_NET
comma
l_string|&quot;net&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|dn_dev_sysctl.dn_dev_proto_dir
)brace
comma
(brace
l_int|0
)brace
)brace
)brace
suffix:semicolon
DECL|function|dn_dev_sysctl_register
r_static
r_void
id|dn_dev_sysctl_register
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|dn_dev_parms
op_star
id|parms
)paren
(brace
r_struct
id|dn_dev_sysctl_table
op_star
id|t
suffix:semicolon
r_int
id|i
suffix:semicolon
id|t
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|memcpy
c_func
(paren
id|t
comma
op_amp
id|dn_dev_sysctl
comma
r_sizeof
(paren
op_star
id|t
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_sizeof
(paren
id|t-&gt;dn_dev_vars
)paren
op_div
r_sizeof
(paren
id|t-&gt;dn_dev_vars
(braket
l_int|0
)braket
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|offset
op_assign
(paren
r_int
)paren
id|t-&gt;dn_dev_vars
(braket
id|i
)braket
dot
id|data
suffix:semicolon
id|t-&gt;dn_dev_vars
(braket
id|i
)braket
dot
id|data
op_assign
(paren
(paren
r_char
op_star
)paren
id|parms
)paren
op_plus
id|offset
suffix:semicolon
id|t-&gt;dn_dev_vars
(braket
id|i
)braket
dot
id|de
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
)paren
(brace
id|t-&gt;dn_dev_dev
(braket
l_int|0
)braket
dot
id|procname
op_assign
id|dev-&gt;name
suffix:semicolon
id|t-&gt;dn_dev_dev
(braket
l_int|0
)braket
dot
id|ctl_name
op_assign
id|dev-&gt;ifindex
suffix:semicolon
)brace
r_else
(brace
id|t-&gt;dn_dev_dev
(braket
l_int|0
)braket
dot
id|procname
op_assign
id|parms-&gt;name
suffix:semicolon
id|t-&gt;dn_dev_dev
(braket
l_int|0
)braket
dot
id|ctl_name
op_assign
id|parms-&gt;ctl_name
suffix:semicolon
)brace
id|t-&gt;dn_dev_dev
(braket
l_int|0
)braket
dot
id|child
op_assign
id|t-&gt;dn_dev_vars
suffix:semicolon
id|t-&gt;dn_dev_dev
(braket
l_int|0
)braket
dot
id|de
op_assign
l_int|NULL
suffix:semicolon
id|t-&gt;dn_dev_conf_dir
(braket
l_int|0
)braket
dot
id|child
op_assign
id|t-&gt;dn_dev_dev
suffix:semicolon
id|t-&gt;dn_dev_conf_dir
(braket
l_int|0
)braket
dot
id|de
op_assign
l_int|NULL
suffix:semicolon
id|t-&gt;dn_dev_proto_dir
(braket
l_int|0
)braket
dot
id|child
op_assign
id|t-&gt;dn_dev_conf_dir
suffix:semicolon
id|t-&gt;dn_dev_proto_dir
(braket
l_int|0
)braket
dot
id|de
op_assign
l_int|NULL
suffix:semicolon
id|t-&gt;dn_dev_root_dir
(braket
l_int|0
)braket
dot
id|child
op_assign
id|t-&gt;dn_dev_proto_dir
suffix:semicolon
id|t-&gt;dn_dev_root_dir
(braket
l_int|0
)braket
dot
id|de
op_assign
l_int|NULL
suffix:semicolon
id|t-&gt;dn_dev_vars
(braket
l_int|0
)braket
dot
id|extra1
op_assign
(paren
r_void
op_star
)paren
id|dev
suffix:semicolon
id|t-&gt;sysctl_header
op_assign
id|register_sysctl_table
c_func
(paren
id|t-&gt;dn_dev_root_dir
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;sysctl_header
op_eq
l_int|NULL
)paren
id|kfree
c_func
(paren
id|t
)paren
suffix:semicolon
r_else
id|parms-&gt;sysctl
op_assign
id|t
suffix:semicolon
)brace
DECL|function|dn_dev_sysctl_unregister
r_static
r_void
id|dn_dev_sysctl_unregister
c_func
(paren
r_struct
id|dn_dev_parms
op_star
id|parms
)paren
(brace
r_if
c_cond
(paren
id|parms-&gt;sysctl
)paren
(brace
r_struct
id|dn_dev_sysctl_table
op_star
id|t
op_assign
id|parms-&gt;sysctl
suffix:semicolon
id|parms-&gt;sysctl
op_assign
l_int|NULL
suffix:semicolon
id|unregister_sysctl_table
c_func
(paren
id|t-&gt;sysctl_header
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
)brace
DECL|function|dn_forwarding_proc
r_static
r_int
id|dn_forwarding_proc
c_func
(paren
id|ctl_table
op_star
id|table
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filep
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|lenp
)paren
(brace
macro_line|#ifdef CONFIG_DECNET_ROUTER
r_struct
id|net_device
op_star
id|dev
op_assign
id|table-&gt;extra1
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|tmp
comma
id|old
suffix:semicolon
r_if
c_cond
(paren
id|table-&gt;extra1
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
id|old
op_assign
id|dn_db-&gt;parms.forwarding
suffix:semicolon
id|err
op_assign
id|proc_dointvec
c_func
(paren
id|table
comma
id|write
comma
id|filep
comma
id|buffer
comma
id|lenp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_ge
l_int|0
)paren
op_logical_and
id|write
)paren
(brace
r_if
c_cond
(paren
id|dn_db-&gt;parms.forwarding
OL
l_int|0
)paren
id|dn_db-&gt;parms.forwarding
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.forwarding
OG
l_int|2
)paren
id|dn_db-&gt;parms.forwarding
op_assign
l_int|2
suffix:semicolon
multiline_comment|/*&n;&t;&t; * What an ugly hack this is... its works, just. It&n;&t;&t; * would be nice if sysctl/proc were just that little&n;&t;&t; * bit more flexible so I don&squot;t have to write a special&n;&t;&t; * routine, or suffer hacks like this - SJW&n;&t;&t; */
id|tmp
op_assign
id|dn_db-&gt;parms.forwarding
suffix:semicolon
id|dn_db-&gt;parms.forwarding
op_assign
id|old
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.down
)paren
id|dn_db-&gt;parms
dot
id|down
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dn_db-&gt;parms.forwarding
op_assign
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.up
)paren
id|dn_db-&gt;parms
dot
id|up
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
macro_line|#else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
)brace
DECL|function|dn_forwarding_sysctl
r_static
r_int
id|dn_forwarding_sysctl
c_func
(paren
id|ctl_table
op_star
id|table
comma
r_int
op_star
id|name
comma
r_int
id|nlen
comma
r_void
op_star
id|oldval
comma
r_int
op_star
id|oldlenp
comma
r_void
op_star
id|newval
comma
r_int
id|newlen
comma
r_void
op_star
op_star
id|context
)paren
(brace
macro_line|#ifdef CONFIG_DECNET_ROUTER
r_struct
id|net_device
op_star
id|dev
op_assign
id|table-&gt;extra1
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_int
id|value
suffix:semicolon
r_if
c_cond
(paren
id|table-&gt;extra1
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|newval
op_logical_and
id|newlen
)paren
(brace
r_if
c_cond
(paren
id|newlen
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|get_user
c_func
(paren
id|value
comma
(paren
r_int
op_star
)paren
id|newval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|value
OG
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.down
)paren
id|dn_db-&gt;parms
dot
id|down
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dn_db-&gt;parms.forwarding
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.up
)paren
id|dn_db-&gt;parms
dot
id|up
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
macro_line|#else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
)brace
macro_line|#else /* CONFIG_SYSCTL */
DECL|function|dn_dev_sysctl_unregister
r_static
r_void
id|dn_dev_sysctl_unregister
c_func
(paren
r_struct
id|dn_dev_parms
op_star
id|parms
)paren
(brace
)brace
DECL|function|dn_dev_sysctl_register
r_static
r_void
id|dn_dev_sysctl_register
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|dn_dev_parms
op_star
id|parms
)paren
(brace
)brace
macro_line|#endif /* CONFIG_SYSCTL */
DECL|function|dn_dev_alloc_ifa
r_static
r_struct
id|dn_ifaddr
op_star
id|dn_dev_alloc_ifa
c_func
(paren
r_void
)paren
(brace
r_struct
id|dn_ifaddr
op_star
id|ifa
suffix:semicolon
id|ifa
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|ifa
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa
)paren
(brace
id|memset
c_func
(paren
id|ifa
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|ifa
)paren
)paren
suffix:semicolon
)brace
r_return
id|ifa
suffix:semicolon
)brace
DECL|function|dn_dev_free_ifa
r_static
id|__inline__
r_void
id|dn_dev_free_ifa
c_func
(paren
r_struct
id|dn_ifaddr
op_star
id|ifa
)paren
(brace
id|kfree
c_func
(paren
id|ifa
)paren
suffix:semicolon
)brace
DECL|function|dn_dev_del_ifa
r_static
r_void
id|dn_dev_del_ifa
c_func
(paren
r_struct
id|dn_dev
op_star
id|dn_db
comma
r_struct
id|dn_ifaddr
op_star
op_star
id|ifap
comma
r_int
id|destroy
)paren
(brace
r_struct
id|dn_ifaddr
op_star
id|ifa1
op_assign
op_star
id|ifap
suffix:semicolon
op_star
id|ifap
op_assign
id|ifa1-&gt;ifa_next
suffix:semicolon
macro_line|#ifdef CONFIG_RTNETLINK
id|rtmsg_ifa
c_func
(paren
id|RTM_DELADDR
comma
id|ifa1
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_RTNETLINK */
r_if
c_cond
(paren
id|destroy
)paren
(brace
id|dn_dev_free_ifa
c_func
(paren
id|ifa1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;ifa_list
op_eq
l_int|NULL
)paren
id|dn_dev_delete
c_func
(paren
id|dn_db-&gt;dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|dn_dev_insert_ifa
r_static
r_int
id|dn_dev_insert_ifa
c_func
(paren
r_struct
id|dn_dev
op_star
id|dn_db
comma
r_struct
id|dn_ifaddr
op_star
id|ifa
)paren
(brace
multiline_comment|/*&n;&t; * FIXME: Duplicate check here.&n;&t; */
id|ifa-&gt;ifa_next
op_assign
id|dn_db-&gt;ifa_list
suffix:semicolon
id|dn_db-&gt;ifa_list
op_assign
id|ifa
suffix:semicolon
macro_line|#ifdef CONFIG_RTNETLINK
id|rtmsg_ifa
c_func
(paren
id|RTM_NEWADDR
comma
id|ifa
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_RTNETLINK */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_dev_set_ifa
r_static
r_int
id|dn_dev_set_ifa
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|dn_ifaddr
op_star
id|ifa
)paren
(brace
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dn_db
op_eq
l_int|NULL
)paren
(brace
r_int
id|err
suffix:semicolon
id|dn_db
op_assign
id|dn_dev_create
c_func
(paren
id|dev
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_db
op_eq
l_int|NULL
)paren
r_return
id|err
suffix:semicolon
)brace
id|ifa-&gt;ifa_dev
op_assign
id|dn_db
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
id|ifa-&gt;ifa_scope
op_assign
id|RT_SCOPE_HOST
suffix:semicolon
r_return
id|dn_dev_insert_ifa
c_func
(paren
id|dn_db
comma
id|ifa
)paren
suffix:semicolon
)brace
DECL|function|dn_dev_ioctl
r_int
id|dn_dev_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_char
id|buffer
(braket
id|DN_IFREQ_SIZE
)braket
suffix:semicolon
r_struct
id|ifreq
op_star
id|ifr
op_assign
(paren
r_struct
id|ifreq
op_star
)paren
id|buffer
suffix:semicolon
r_struct
id|sockaddr_dn
op_star
id|sdn
op_assign
(paren
r_struct
id|sockaddr_dn
op_star
)paren
op_amp
id|ifr-&gt;ifr_addr
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|dn_ifaddr
op_star
id|ifa
op_assign
l_int|NULL
comma
op_star
op_star
id|ifap
op_assign
l_int|NULL
suffix:semicolon
r_int
id|exclusive
op_assign
l_int|0
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|ifr
comma
id|arg
comma
id|DN_IFREQ_SIZE
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ifr-&gt;ifr_name
(braket
id|IFNAMSIZ
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_KMOD
id|dev_load
c_func
(paren
id|ifr-&gt;ifr_name
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGIFADDR
suffix:colon
r_break
suffix:semicolon
r_case
id|SIOCSIFADDR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|sdn-&gt;sdn_family
op_ne
id|AF_DECnet
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|exclusive
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|__dev_get_by_name
c_func
(paren
id|ifr-&gt;ifr_name
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dn_db
op_assign
id|dev-&gt;dn_ptr
)paren
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|ifap
op_assign
op_amp
id|dn_db-&gt;ifa_list
suffix:semicolon
(paren
id|ifa
op_assign
op_star
id|ifap
)paren
op_ne
l_int|NULL
suffix:semicolon
id|ifap
op_assign
op_amp
id|ifa-&gt;ifa_next
)paren
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ifr-&gt;ifr_name
comma
id|ifa-&gt;ifa_label
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifa
op_eq
l_int|NULL
op_logical_and
id|cmd
op_ne
id|SIOCSIFADDR
)paren
(brace
id|ret
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGIFADDR
suffix:colon
op_star
(paren
(paren
id|dn_address
op_star
)paren
id|sdn-&gt;sdn_nodeaddr
)paren
op_assign
id|ifa-&gt;ifa_local
suffix:semicolon
r_goto
id|rarok
suffix:semicolon
r_case
id|SIOCSIFADDR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|ifa
)paren
(brace
r_if
c_cond
(paren
(paren
id|ifa
op_assign
id|dn_dev_alloc_ifa
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ret
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|ifa-&gt;ifa_label
comma
id|dev-&gt;name
comma
id|IFNAMSIZ
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ifa-&gt;ifa_local
op_eq
id|dn_saddr2dn
c_func
(paren
id|sdn
)paren
)paren
r_break
suffix:semicolon
id|dn_dev_del_ifa
c_func
(paren
id|dn_db
comma
id|ifap
comma
l_int|0
)paren
suffix:semicolon
)brace
id|ifa-&gt;ifa_local
op_assign
id|dn_saddr2dn
c_func
(paren
id|sdn
)paren
suffix:semicolon
id|ret
op_assign
id|dn_dev_set_ifa
c_func
(paren
id|dev
comma
id|ifa
)paren
suffix:semicolon
)brace
id|done
suffix:colon
r_if
c_cond
(paren
id|exclusive
)paren
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
id|rarok
suffix:colon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
id|ifr
comma
id|DN_IFREQ_SIZE
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_RTNETLINK
DECL|function|dn_dev_by_index
r_static
r_struct
id|dn_dev
op_star
id|dn_dev_by_index
c_func
(paren
r_int
id|ifindex
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_dev
op_assign
l_int|NULL
suffix:semicolon
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|dn_dev
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|dn_dev
suffix:semicolon
)brace
DECL|function|dn_dev_rtm_deladdr
r_static
r_int
id|dn_dev_rtm_deladdr
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_struct
id|ifaddrmsg
op_star
id|ifm
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|dn_ifaddr
op_star
id|ifa
comma
op_star
op_star
id|ifap
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dn_db
op_assign
id|dn_dev_by_index
c_func
(paren
id|ifm-&gt;ifa_index
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_for
c_loop
(paren
id|ifap
op_assign
op_amp
id|dn_db-&gt;ifa_list
suffix:semicolon
(paren
id|ifa
op_assign
op_star
id|ifap
)paren
op_ne
l_int|NULL
suffix:semicolon
id|ifap
op_assign
op_amp
id|ifa-&gt;ifa_next
)paren
(brace
r_void
op_star
id|tmp
op_assign
id|rta
(braket
id|IFA_LOCAL
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_logical_and
id|memcmp
c_func
(paren
id|RTA_DATA
c_func
(paren
id|tmp
)paren
comma
op_amp
id|ifa-&gt;ifa_local
comma
l_int|2
)paren
)paren
op_logical_or
(paren
id|rta
(braket
id|IFA_LABEL
op_minus
l_int|1
)braket
op_logical_and
id|strcmp
c_func
(paren
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_LABEL
op_minus
l_int|1
)braket
)paren
comma
id|ifa-&gt;ifa_label
)paren
)paren
)paren
r_continue
suffix:semicolon
id|dn_dev_del_ifa
c_func
(paren
id|dn_db
comma
id|ifap
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
DECL|function|dn_dev_rtm_newaddr
r_static
r_int
id|dn_dev_rtm_newaddr
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_struct
id|ifaddrmsg
op_star
id|ifm
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|dn_ifaddr
op_star
id|ifa
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|IFA_LOCAL
op_minus
l_int|1
)braket
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|__dev_get_by_index
c_func
(paren
id|ifm-&gt;ifa_index
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dn_db
op_assign
id|dev-&gt;dn_ptr
)paren
op_eq
l_int|NULL
)paren
(brace
r_int
id|err
suffix:semicolon
id|dn_db
op_assign
id|dn_dev_create
c_func
(paren
id|dev
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dn_db
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ifa
op_assign
id|dn_dev_alloc_ifa
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ifa-&gt;ifa_local
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_LOCAL
op_minus
l_int|1
)braket
)paren
comma
l_int|2
)paren
suffix:semicolon
id|ifa-&gt;ifa_flags
op_assign
id|ifm-&gt;ifa_flags
suffix:semicolon
id|ifa-&gt;ifa_scope
op_assign
id|ifm-&gt;ifa_scope
suffix:semicolon
id|ifa-&gt;ifa_dev
op_assign
id|dn_db
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|IFA_LABEL
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
id|ifa-&gt;ifa_label
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_LABEL
op_minus
l_int|1
)braket
)paren
comma
id|IFNAMSIZ
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|ifa-&gt;ifa_label
comma
id|dev-&gt;name
comma
id|IFNAMSIZ
)paren
suffix:semicolon
r_return
id|dn_dev_insert_ifa
c_func
(paren
id|dn_db
comma
id|ifa
)paren
suffix:semicolon
)brace
DECL|function|dn_dev_fill_ifaddr
r_static
r_int
id|dn_dev_fill_ifaddr
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|dn_ifaddr
op_star
id|ifa
comma
id|u32
id|pid
comma
id|u32
id|seq
comma
r_int
id|event
)paren
(brace
r_struct
id|ifaddrmsg
op_star
id|ifm
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
id|pid
comma
id|seq
comma
id|event
comma
r_sizeof
(paren
op_star
id|ifm
)paren
)paren
suffix:semicolon
id|ifm
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|ifm-&gt;ifa_family
op_assign
id|AF_DECnet
suffix:semicolon
id|ifm-&gt;ifa_prefixlen
op_assign
l_int|16
suffix:semicolon
id|ifm-&gt;ifa_flags
op_assign
id|ifa-&gt;ifa_flags
op_or
id|IFA_F_PERMANENT
suffix:semicolon
id|ifm-&gt;ifa_scope
op_assign
id|ifa-&gt;ifa_scope
suffix:semicolon
id|ifm-&gt;ifa_index
op_assign
id|ifa-&gt;ifa_dev-&gt;dev-&gt;ifindex
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|IFA_LOCAL
comma
l_int|2
comma
op_amp
id|ifa-&gt;ifa_local
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_label
(braket
l_int|0
)braket
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|IFA_LABEL
comma
id|IFNAMSIZ
comma
op_amp
id|ifa-&gt;ifa_label
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|rtattr_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|rtmsg_ifa
r_static
r_void
id|rtmsg_ifa
c_func
(paren
r_int
id|event
comma
r_struct
id|dn_ifaddr
op_star
id|ifa
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|size
op_assign
id|NLMSG_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|ifaddrmsg
)paren
op_plus
l_int|128
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|netlink_set_err
c_func
(paren
id|rtnl
comma
l_int|0
comma
id|RTMGRP_DECnet_IFADDR
comma
id|ENOBUFS
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dn_dev_fill_ifaddr
c_func
(paren
id|skb
comma
id|ifa
comma
l_int|0
comma
l_int|0
comma
id|event
)paren
OL
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|netlink_set_err
c_func
(paren
id|rtnl
comma
l_int|0
comma
id|RTMGRP_DECnet_IFADDR
comma
id|EINVAL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|RTMGRP_DECnet_IFADDR
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|rtnl
comma
id|skb
comma
l_int|0
comma
id|RTMGRP_DECnet_IFADDR
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
DECL|function|dn_dev_dump_ifaddr
r_static
r_int
id|dn_dev_dump_ifaddr
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_int
id|idx
comma
id|dn_idx
suffix:semicolon
r_int
id|s_idx
comma
id|s_dn_idx
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_struct
id|dn_ifaddr
op_star
id|ifa
suffix:semicolon
id|s_idx
op_assign
id|cb-&gt;args
(braket
l_int|0
)braket
suffix:semicolon
id|s_dn_idx
op_assign
id|dn_idx
op_assign
id|cb-&gt;args
(braket
l_int|1
)braket
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
comma
id|idx
op_assign
l_int|0
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|dn_db
op_assign
id|dev-&gt;dn_ptr
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|idx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|idx
OL
id|s_idx
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|idx
OG
id|s_idx
)paren
id|s_dn_idx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dn_db
op_assign
id|dev-&gt;dn_ptr
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|ifa
op_assign
id|dn_db-&gt;ifa_list
comma
id|dn_idx
op_assign
l_int|0
suffix:semicolon
id|ifa
suffix:semicolon
id|ifa
op_assign
id|ifa-&gt;ifa_next
comma
id|dn_idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dn_idx
OL
id|s_dn_idx
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dn_dev_fill_ifaddr
c_func
(paren
id|skb
comma
id|ifa
comma
id|NETLINK_CB
c_func
(paren
id|cb-&gt;skb
)paren
dot
id|pid
comma
id|cb-&gt;nlh-&gt;nlmsg_seq
comma
id|RTM_NEWADDR
)paren
op_le
l_int|0
)paren
r_goto
id|done
suffix:semicolon
)brace
)brace
id|done
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
id|idx
suffix:semicolon
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|dn_idx
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_RTNETLINK */
DECL|function|dn_send_endnode_hello
r_static
r_void
id|dn_send_endnode_hello
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|endnode_hello_message
op_star
id|msg
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
r_int
op_star
id|pktlen
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
(paren
r_struct
id|dn_dev
op_star
)paren
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
l_int|NULL
comma
r_sizeof
(paren
op_star
id|msg
)paren
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|endnode_hello_message
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|msg
)paren
)paren
suffix:semicolon
id|msg-&gt;msgflg
op_assign
l_int|0x0D
suffix:semicolon
id|memcpy
c_func
(paren
id|msg-&gt;tiver
comma
id|dn_eco_version
comma
l_int|3
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|msg-&gt;id
comma
id|decnet_ether_address
comma
l_int|6
)paren
suffix:semicolon
id|msg-&gt;iinfo
op_assign
id|DN_RT_INFO_ENDN
suffix:semicolon
id|msg-&gt;blksize
op_assign
id|dn_htons
c_func
(paren
id|dn_db-&gt;parms.blksize
)paren
suffix:semicolon
id|msg-&gt;area
op_assign
l_int|0x00
suffix:semicolon
id|memset
c_func
(paren
id|msg-&gt;seed
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|msg-&gt;neighbor
comma
id|dn_hiord
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;router
)paren
(brace
r_struct
id|dn_neigh
op_star
id|dn
op_assign
(paren
r_struct
id|dn_neigh
op_star
)paren
id|dn_db-&gt;router
suffix:semicolon
id|dn_dn2eth
c_func
(paren
id|msg-&gt;neighbor
comma
id|dn-&gt;addr
)paren
suffix:semicolon
)brace
id|msg-&gt;timer
op_assign
id|dn_htons
c_func
(paren
(paren
r_int
r_int
)paren
id|dn_db-&gt;parms.t3
)paren
suffix:semicolon
id|msg-&gt;mpd
op_assign
l_int|0x00
suffix:semicolon
id|msg-&gt;datalen
op_assign
l_int|0x02
suffix:semicolon
id|memset
c_func
(paren
id|msg-&gt;data
comma
l_int|0xAA
comma
l_int|2
)paren
suffix:semicolon
id|pktlen
op_assign
(paren
r_int
r_int
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
op_star
id|pktlen
op_assign
id|dn_htons
c_func
(paren
id|skb-&gt;len
op_minus
l_int|2
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|dn_rt_finish_output
c_func
(paren
id|skb
comma
id|dn_rt_all_rt_mcast
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_DECNET_ROUTER
DECL|macro|DRDELAY
mdefine_line|#define DRDELAY (5 * HZ)
DECL|function|dn_am_i_a_router
r_static
r_int
id|dn_am_i_a_router
c_func
(paren
r_struct
id|dn_neigh
op_star
id|dn
comma
r_struct
id|dn_dev
op_star
id|dn_db
)paren
(brace
multiline_comment|/* First check time since device went up */
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|dn_db-&gt;uptime
)paren
OL
id|DRDELAY
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* If there is no router, then yes... */
r_if
c_cond
(paren
op_logical_neg
id|dn_db-&gt;router
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* otherwise only if we have a higher priority or.. */
r_if
c_cond
(paren
id|dn-&gt;priority
OL
id|dn_db-&gt;parms.priority
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* if we have equal priority and a higher node number */
r_if
c_cond
(paren
id|dn-&gt;priority
op_ne
id|dn_db-&gt;parms.priority
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dn_ntohs
c_func
(paren
id|dn-&gt;addr
)paren
OL
id|dn_ntohs
c_func
(paren
id|decnet_address
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dn_send_router_hello
r_static
r_void
id|dn_send_router_hello
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|n
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_struct
id|dn_neigh
op_star
id|dn
op_assign
(paren
r_struct
id|dn_neigh
op_star
)paren
id|dn_db-&gt;router
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
r_int
r_char
op_star
id|i1
comma
op_star
id|i2
suffix:semicolon
r_int
r_int
op_star
id|pktlen
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.blksize
OL
(paren
l_int|26
op_plus
l_int|7
)paren
)paren
r_return
suffix:semicolon
id|n
op_assign
id|dn_db-&gt;parms.blksize
op_minus
l_int|26
suffix:semicolon
id|n
op_div_assign
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
l_int|32
)paren
id|n
op_assign
l_int|32
suffix:semicolon
id|size
op_assign
l_int|2
op_plus
l_int|26
op_plus
l_int|7
op_star
id|n
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
l_int|NULL
comma
id|size
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|ptr
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|size
)paren
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
id|DN_RT_PKT_CNTL
op_or
id|DN_RT_PKT_ERTH
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* ECO */
op_star
id|ptr
op_increment
op_assign
l_int|0
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|ptr
comma
id|decnet_ether_address
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|ptr
op_add_assign
id|ETH_ALEN
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
id|dn_db-&gt;parms.forwarding
op_eq
l_int|1
ques
c_cond
id|DN_RT_INFO_L1RT
suffix:colon
id|DN_RT_INFO_L2RT
suffix:semicolon
op_star
(paren
(paren
r_int
r_int
op_star
)paren
id|ptr
)paren
op_assign
id|dn_htons
c_func
(paren
id|dn_db-&gt;parms.blksize
)paren
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
id|dn_db-&gt;parms.priority
suffix:semicolon
multiline_comment|/* Priority */
op_star
id|ptr
op_increment
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Area: Reserved */
op_star
(paren
(paren
r_int
r_int
op_star
)paren
id|ptr
)paren
op_assign
id|dn_htons
c_func
(paren
(paren
r_int
r_int
)paren
id|dn_db-&gt;parms.t3
)paren
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* MPD: Reserved */
id|i1
op_assign
id|ptr
op_increment
suffix:semicolon
id|memset
c_func
(paren
id|ptr
comma
l_int|0
comma
l_int|7
)paren
suffix:semicolon
multiline_comment|/* Name: Reserved */
id|ptr
op_add_assign
l_int|7
suffix:semicolon
id|i2
op_assign
id|ptr
op_increment
suffix:semicolon
id|n
op_assign
id|dn_neigh_elist
c_func
(paren
id|dev
comma
id|ptr
comma
id|n
)paren
suffix:semicolon
op_star
id|i2
op_assign
l_int|7
op_star
id|n
suffix:semicolon
op_star
id|i1
op_assign
l_int|8
op_plus
op_star
id|i2
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
(paren
l_int|27
op_plus
op_star
id|i2
)paren
)paren
suffix:semicolon
id|pktlen
op_assign
(paren
r_int
r_int
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
op_star
id|pktlen
op_assign
id|dn_htons
c_func
(paren
id|skb-&gt;len
op_minus
l_int|2
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|dn_am_i_a_router
c_func
(paren
id|dn
comma
id|dn_db
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb2
op_assign
id|skb_copy
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
(brace
id|dn_rt_finish_output
c_func
(paren
id|skb2
comma
id|dn_rt_all_end_mcast
)paren
suffix:semicolon
)brace
)brace
id|dn_rt_finish_output
c_func
(paren
id|skb
comma
id|dn_rt_all_rt_mcast
)paren
suffix:semicolon
)brace
DECL|function|dn_send_brd_hello
r_static
r_void
id|dn_send_brd_hello
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
(paren
r_struct
id|dn_dev
op_star
)paren
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.forwarding
op_eq
l_int|0
)paren
id|dn_send_endnode_hello
c_func
(paren
id|dev
)paren
suffix:semicolon
r_else
id|dn_send_router_hello
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|dn_send_brd_hello
r_static
r_void
id|dn_send_brd_hello
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dn_send_endnode_hello
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if 0
r_static
r_void
id|dn_send_ptp_hello
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|tdlen
op_assign
l_int|16
suffix:semicolon
r_int
id|size
op_assign
id|dev-&gt;hard_header_len
op_plus
l_int|2
op_plus
l_int|4
op_plus
id|tdlen
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dn_alloc_skb
c_func
(paren
l_int|NULL
comma
id|size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
r_struct
id|dn_neigh
op_star
id|dn
op_assign
(paren
r_struct
id|dn_neigh
op_star
)paren
id|dn_db-&gt;router
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_push
c_func
(paren
id|skb
comma
id|dev-&gt;hard_header_len
)paren
suffix:semicolon
id|ptr
op_assign
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
op_plus
l_int|4
op_plus
id|tdlen
)paren
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
id|DN_RT_PKT_HELO
suffix:semicolon
op_star
(paren
(paren
id|dn_address
op_star
)paren
id|ptr
)paren
op_assign
id|decnet_address
suffix:semicolon
id|ptr
op_add_assign
l_int|2
suffix:semicolon
op_star
id|ptr
op_increment
op_assign
id|tdlen
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tdlen
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|ptr
op_increment
op_assign
l_int|0252
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dn_am_i_a_router
c_func
(paren
id|dn
comma
id|dn_db
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb2
op_assign
id|skb_copy
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
(brace
id|dn_rt_finish_output
c_func
(paren
id|skb2
comma
id|dn_rt_all_end_mcast
)paren
suffix:semicolon
)brace
)brace
id|dn_rt_finish_output
c_func
(paren
id|skb
comma
id|dn_rt_all_rt_mcast
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|dn_eth_up
r_static
r_int
id|dn_eth_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.forwarding
op_eq
l_int|0
)paren
id|dev_mc_add
c_func
(paren
id|dev
comma
id|dn_rt_all_end_mcast
comma
id|ETH_ALEN
comma
l_int|0
)paren
suffix:semicolon
r_else
id|dev_mc_add
c_func
(paren
id|dev
comma
id|dn_rt_all_rt_mcast
comma
id|ETH_ALEN
comma
l_int|0
)paren
suffix:semicolon
id|dev_mc_upload
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dn_db-&gt;use_long
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|dn_dev_set_timer
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|function|dn_dev_timer_func
r_static
r_void
id|dn_dev_timer_func
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|arg
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;t3
op_le
id|dn_db-&gt;parms.t2
)paren
(brace
r_if
c_cond
(paren
id|dn_db-&gt;parms.timer3
)paren
id|dn_db-&gt;parms
dot
id|timer3
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dn_db-&gt;t3
op_assign
id|dn_db-&gt;parms.t3
suffix:semicolon
)brace
r_else
(brace
id|dn_db-&gt;t3
op_sub_assign
id|dn_db-&gt;parms.t2
suffix:semicolon
)brace
id|dn_dev_set_timer
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|dn_dev_set_timer
r_static
r_void
id|dn_dev_set_timer
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.t2
OG
id|dn_db-&gt;parms.t3
)paren
id|dn_db-&gt;parms.t2
op_assign
id|dn_db-&gt;parms.t3
suffix:semicolon
id|dn_db-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|dn_db-&gt;timer.function
op_assign
id|dn_dev_timer_func
suffix:semicolon
id|dn_db-&gt;timer.expires
op_assign
id|jiffies
op_plus
(paren
id|dn_db-&gt;parms.t2
op_star
id|HZ
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dn_db-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|dn_dev_create
r_struct
id|dn_dev
op_star
id|dn_dev_create
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
op_star
id|err
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dn_dev_parms
op_star
id|p
op_assign
id|dn_dev_list
suffix:semicolon
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DN_DEV_LIST_SIZE
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;type
op_eq
id|dev-&gt;type
)paren
r_break
suffix:semicolon
)brace
op_star
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|DN_DEV_LIST_SIZE
)paren
r_return
l_int|NULL
suffix:semicolon
op_star
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dn_db
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dn_dev
)paren
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|dn_db
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dn_dev
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dn_db-&gt;parms
comma
id|p
comma
r_sizeof
(paren
r_struct
id|dn_dev_parms
)paren
)paren
suffix:semicolon
id|dev-&gt;dn_ptr
op_assign
id|dn_db
suffix:semicolon
id|dn_db-&gt;dev
op_assign
id|dev
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|dn_db-&gt;timer
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dn_db-&gt;addr
comma
id|decnet_ether_address
comma
id|ETH_ALEN
)paren
suffix:semicolon
multiline_comment|/* To go... */
id|dn_db-&gt;uptime
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.up
)paren
(brace
r_if
c_cond
(paren
id|dn_db-&gt;parms
dot
id|up
c_func
(paren
id|dev
)paren
OL
l_int|0
)paren
(brace
id|dev-&gt;dn_ptr
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|dn_db
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
id|dn_db-&gt;neigh_parms
op_assign
id|neigh_parms_alloc
c_func
(paren
id|dev
comma
op_amp
id|dn_neigh_table
)paren
suffix:semicolon
multiline_comment|/* dn_db-&gt;neigh_parms-&gt;neigh_setup = dn_db-&gt;parms.neigh_setup; */
id|dn_dev_sysctl_register
c_func
(paren
id|dev
comma
op_amp
id|dn_db-&gt;parms
)paren
suffix:semicolon
id|dn_dev_set_timer
c_func
(paren
id|dev
)paren
suffix:semicolon
op_star
id|err
op_assign
l_int|0
suffix:semicolon
r_return
id|dn_db
suffix:semicolon
)brace
multiline_comment|/*&n; * This processes a device up event. We only start up&n; * the loopback device &amp; ethernet devices with correct&n; * MAC addreses automatically. Others must be started&n; * specifically.&n; */
DECL|function|dn_dev_up
r_void
id|dn_dev_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|dn_ifaddr
op_star
id|ifa
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;type
op_ne
id|ARPHRD_ETHER
)paren
op_logical_and
(paren
id|dev-&gt;type
op_ne
id|ARPHRD_LOOPBACK
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_ETHER
)paren
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|dev-&gt;dev_addr
comma
id|decnet_ether_address
comma
id|ETH_ALEN
)paren
op_ne
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ifa
op_assign
id|dn_dev_alloc_ifa
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|ifa-&gt;ifa_local
op_assign
id|decnet_address
suffix:semicolon
id|ifa-&gt;ifa_flags
op_assign
l_int|0
suffix:semicolon
id|ifa-&gt;ifa_scope
op_assign
id|RT_SCOPE_UNIVERSE
suffix:semicolon
id|strcpy
c_func
(paren
id|ifa-&gt;ifa_label
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dn_dev_set_ifa
c_func
(paren
id|dev
comma
id|ifa
)paren
suffix:semicolon
)brace
DECL|function|dn_dev_delete
r_static
r_void
id|dn_dev_delete
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dn_db
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|dn_db-&gt;timer
)paren
suffix:semicolon
id|dn_dev_sysctl_unregister
c_func
(paren
op_amp
id|dn_db-&gt;parms
)paren
suffix:semicolon
id|neigh_ifdown
c_func
(paren
op_amp
id|dn_neigh_table
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
id|decnet_default_device
)paren
id|decnet_default_device
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;parms.down
)paren
id|dn_db-&gt;parms
dot
id|down
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;dn_ptr
op_assign
l_int|NULL
suffix:semicolon
id|neigh_parms_release
c_func
(paren
op_amp
id|dn_neigh_table
comma
id|dn_db-&gt;neigh_parms
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;router
)paren
id|neigh_release
c_func
(paren
id|dn_db-&gt;router
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_db-&gt;peer
)paren
id|neigh_release
c_func
(paren
id|dn_db-&gt;peer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dn_db
)paren
suffix:semicolon
)brace
DECL|function|dn_dev_down
r_void
id|dn_dev_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
id|dev-&gt;dn_ptr
suffix:semicolon
r_struct
id|dn_ifaddr
op_star
id|ifa
suffix:semicolon
r_if
c_cond
(paren
id|dn_db
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ifa
op_assign
id|dn_db-&gt;ifa_list
)paren
op_ne
l_int|NULL
)paren
(brace
id|dn_dev_del_ifa
c_func
(paren
id|dn_db
comma
op_amp
id|dn_db-&gt;ifa_list
comma
l_int|0
)paren
suffix:semicolon
id|dn_dev_free_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
)brace
id|dn_dev_delete
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|dn_dev_init_pkt
r_void
id|dn_dev_init_pkt
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|dn_dev_veri_pkt
r_void
id|dn_dev_veri_pkt
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|dn_dev_hello
r_void
id|dn_dev_hello
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|dn_dev_devices_off
r_void
id|dn_dev_devices_off
c_func
(paren
r_void
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
id|dn_dev_down
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|dn_dev_devices_on
r_void
id|dn_dev_devices_on
c_func
(paren
r_void
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
id|dn_dev_up
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_DECNET_SIOCGIFCONF
multiline_comment|/*&n; * Now we support multiple addresses per interface.&n; * Since we don&squot;t want to break existing code, you have to enable&n; * it as a compile time option. Probably you should use the&n; * rtnetlink interface instead.&n; */
DECL|function|dnet_gifconf
r_int
id|dnet_gifconf
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|dn_dev
op_star
id|dn_db
op_assign
(paren
r_struct
id|dn_dev
op_star
)paren
id|dev-&gt;dn_ptr
suffix:semicolon
r_struct
id|dn_ifaddr
op_star
id|ifa
suffix:semicolon
r_struct
id|ifreq
op_star
id|ifr
op_assign
(paren
r_struct
id|ifreq
op_star
)paren
id|buf
suffix:semicolon
r_int
id|done
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dn_db
op_eq
l_int|NULL
)paren
op_logical_or
(paren
(paren
id|ifa
op_assign
id|dn_db-&gt;ifa_list
)paren
op_eq
l_int|NULL
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|ifa
suffix:semicolon
id|ifa
op_assign
id|ifa-&gt;ifa_next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ifr
)paren
(brace
id|done
op_add_assign
r_sizeof
(paren
id|DN_IFREQ_SIZE
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
id|DN_IFREQ_SIZE
)paren
r_return
id|done
suffix:semicolon
id|memset
c_func
(paren
id|ifr
comma
l_int|0
comma
id|DN_IFREQ_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_label
)paren
id|strcpy
c_func
(paren
id|ifr-&gt;ifr_name
comma
id|ifa-&gt;ifa_label
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|ifr-&gt;ifr_name
comma
id|dev-&gt;name
)paren
suffix:semicolon
(paren
r_struct
id|sockaddr_dn
op_star
)paren
op_amp
id|ifr-&gt;ifr_addr.sdn_family
op_assign
id|AF_DECnet
suffix:semicolon
(paren
r_struct
id|sockaddr_dn
op_star
)paren
op_amp
id|ifr-&gt;ifr_addr.sdn_add.a_len
op_assign
l_int|2
suffix:semicolon
(paren
op_star
(paren
id|dn_address
op_star
)paren
(paren
r_struct
id|sockaddr_dn
op_star
)paren
op_amp
id|ifr-&gt;ifr_addr.sdn_add.a_addr
)paren
op_assign
id|ifa-&gt;ifa_local
suffix:semicolon
id|ifr
op_assign
(paren
r_struct
id|ifreq
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|ifr
op_plus
id|DN_IFREQ_SIZE
)paren
suffix:semicolon
id|len
op_sub_assign
id|DN_IFREQ_SIZE
suffix:semicolon
id|done
op_add_assign
id|DN_IFREQ_SIZE
suffix:semicolon
)brace
r_return
id|done
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_DECNET_SIOCGIFCONF */
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|dn_type2asc
r_static
r_char
op_star
id|dn_type2asc
c_func
(paren
r_char
id|type
)paren
(brace
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|DN_DEV_BCAST
suffix:colon
r_return
l_string|&quot;B&quot;
suffix:semicolon
r_case
id|DN_DEV_UCAST
suffix:colon
r_return
l_string|&quot;U&quot;
suffix:semicolon
r_case
id|DN_DEV_MPOINT
suffix:colon
r_return
l_string|&quot;M&quot;
suffix:semicolon
)brace
r_return
l_string|&quot;?&quot;
suffix:semicolon
)brace
DECL|function|decnet_dev_get_info
r_static
r_int
id|decnet_dev_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_struct
id|dn_dev
op_star
id|dn_db
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_char
id|peer_buf
(braket
id|DN_ASCBUF_LEN
)braket
suffix:semicolon
r_char
id|router_buf
(braket
id|DN_ASCBUF_LEN
)braket
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Name     Flags T1   Timer1 T3   Timer3 BlkSize Pri State DevType    Router Peer&bslash;n&quot;
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|dn_db
op_assign
(paren
r_struct
id|dn_dev
op_star
)paren
id|dev-&gt;dn_ptr
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-8s %1s     %04u %04u   %04lu %04lu   %04hu    %03d %02x    %-10s %-7s %-7s&bslash;n&quot;
comma
id|dev-&gt;name
ques
c_cond
id|dev-&gt;name
suffix:colon
l_string|&quot;???&quot;
comma
id|dn_type2asc
c_func
(paren
id|dn_db-&gt;parms.mode
)paren
comma
l_int|0
comma
l_int|0
comma
id|dn_db-&gt;t3
comma
id|dn_db-&gt;parms.t3
comma
id|dn_db-&gt;parms.blksize
comma
id|dn_db-&gt;parms.priority
comma
id|dn_db-&gt;parms.state
comma
id|dn_db-&gt;parms.name
comma
id|dn_db-&gt;router
ques
c_cond
id|dn_addr2asc
c_func
(paren
id|dn_ntohs
c_func
(paren
op_star
(paren
id|dn_address
op_star
)paren
id|dn_db-&gt;router-&gt;primary_key
)paren
comma
id|router_buf
)paren
suffix:colon
l_string|&quot;&quot;
comma
id|dn_db-&gt;peer
ques
c_cond
id|dn_addr2asc
c_func
(paren
id|dn_ntohs
c_func
(paren
op_star
(paren
id|dn_address
op_star
)paren
id|dn_db-&gt;peer-&gt;primary_key
)paren
comma
id|peer_buf
)paren
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_break
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
macro_line|#ifdef CONFIG_RTNETLINK
DECL|variable|dnet_rtnetlink_table
r_static
r_struct
id|rtnetlink_link
id|dnet_rtnetlink_table
(braket
id|RTM_MAX
op_minus
id|RTM_BASE
op_plus
l_int|1
)braket
op_assign
(brace
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
id|dn_dev_rtm_newaddr
comma
l_int|NULL
comma
)brace
comma
(brace
id|dn_dev_rtm_deladdr
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
id|dn_dev_dump_ifaddr
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
macro_line|#ifdef CONFIG_DECNET_ROUTER
(brace
id|dn_fib_rtm_newroute
comma
l_int|NULL
comma
)brace
comma
(brace
id|dn_fib_rtm_delroute
comma
l_int|NULL
comma
)brace
comma
(brace
id|dn_cache_getroute
comma
id|dn_fib_dump
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
macro_line|#else
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
id|dn_cache_getroute
comma
id|dn_cache_dump
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
macro_line|#endif
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
macro_line|#ifdef CONFIG_DECNET_ROUTER
(brace
id|dn_fib_rtm_newrule
comma
l_int|NULL
comma
)brace
comma
(brace
id|dn_fib_rtm_delrule
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
id|dn_fib_dump_rules
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
macro_line|#else
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
macro_line|#endif
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_RTNETLINK */
DECL|function|dn_dev_init
r_void
id|__init
id|dn_dev_init
c_func
(paren
r_void
)paren
(brace
id|dn_dev_devices_on
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_DECNET_SIOCGIFCONF
id|register_gifconf
c_func
(paren
id|PF_DECnet
comma
id|dnet_gifconf
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_DECNET_SIOCGIFCONF */
macro_line|#ifdef CONFIG_RTNETLINK
id|rtnetlink_links
(braket
id|PF_DECnet
)braket
op_assign
id|dnet_rtnetlink_table
suffix:semicolon
macro_line|#endif /* CONFIG_RTNETLINK */
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_create
c_func
(paren
l_string|&quot;decnet_dev&quot;
comma
l_int|0
comma
id|decnet_dev_get_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
macro_line|#ifdef CONFIG_SYSCTL
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DN_DEV_LIST_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dn_dev_sysctl_register
c_func
(paren
l_int|NULL
comma
op_amp
id|dn_dev_list
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_SYSCTL */
)brace
DECL|function|dn_dev_cleanup
r_void
id|__exit
id|dn_dev_cleanup
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_RTNETLINK
id|rtnetlink_links
(braket
id|PF_DECnet
)braket
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* CONFIG_RTNETLINK */
macro_line|#ifdef CONFIG_DECNET_SIOCGIFCONF
id|unregister_gifconf
c_func
(paren
id|PF_DECnet
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_DECNET_SIOCGIFCONF */
macro_line|#ifdef CONFIG_SYSCTL
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DN_DEV_LIST_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dn_dev_sysctl_unregister
c_func
(paren
op_amp
id|dn_dev_list
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_SYSCTL */
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_remove
c_func
(paren
l_string|&quot;decnet_dev&quot;
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
id|dn_dev_devices_off
c_func
(paren
)paren
suffix:semicolon
)brace
eof
