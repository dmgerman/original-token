multiline_comment|/*&n; * DECnet       An implementation of the DECnet protocol suite for the LINUX&n; *              operating system.  DECnet is implemented using the  BSD Socket&n; *              interface as the means of communication with the user level.&n; *&n; *              DECnet Routing Forwarding Information Base (Routing Tables)&n; *&n; * Author:      Steve Whitehouse &lt;SteveW@ACM.org&gt;&n; *              Mostly copied from the IPv4 routing code&n; *&n; *&n; * Changes:&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/route.h&gt; /* RTF_xxx */
macro_line|#include &lt;net/neighbour.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;net/dn.h&gt;
macro_line|#include &lt;net/dn_route.h&gt;
macro_line|#include &lt;net/dn_fib.h&gt;
macro_line|#include &lt;net/dn_neigh.h&gt;
macro_line|#include &lt;net/dn_dev.h&gt;
DECL|struct|dn_zone
r_struct
id|dn_zone
(brace
DECL|member|dz_next
r_struct
id|dn_zone
op_star
id|dz_next
suffix:semicolon
DECL|member|dz_hash
r_struct
id|dn_fib_node
op_star
op_star
id|dz_hash
suffix:semicolon
DECL|member|dz_nent
r_int
id|dz_nent
suffix:semicolon
DECL|member|dz_divisor
r_int
id|dz_divisor
suffix:semicolon
DECL|member|dz_hashmask
id|u32
id|dz_hashmask
suffix:semicolon
DECL|macro|DZ_HASHMASK
mdefine_line|#define DZ_HASHMASK(dz)&t;((dz)-&gt;dz_hashmask)
DECL|member|dz_order
r_int
id|dz_order
suffix:semicolon
DECL|member|dz_mask
id|u32
id|dz_mask
suffix:semicolon
DECL|macro|DZ_MASK
mdefine_line|#define DZ_MASK(dz)&t;((dz)-&gt;dz_mask)
)brace
suffix:semicolon
DECL|struct|dn_hash
r_struct
id|dn_hash
(brace
DECL|member|dh_zones
r_struct
id|dn_zone
op_star
id|dh_zones
(braket
l_int|17
)braket
suffix:semicolon
DECL|member|dh_zone_list
r_struct
id|dn_zone
op_star
id|dh_zone_list
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|dz_key_0
mdefine_line|#define dz_key_0(key)&t;&t;((key).datum = 0)
DECL|macro|dz_prefix
mdefine_line|#define dz_prefix(key,dz)&t;((key).datum)
DECL|macro|for_nexthops
mdefine_line|#define for_nexthops(fi) { int nhsel; const struct dn_fib_nh *nh;&bslash;&n;        for(nhsel = 0, nh = (fi)-&gt;fib_nh; nhsel &lt; (fi)-&gt;fib_nhs; nh++, nhsel++)
DECL|macro|endfor_nexthops
mdefine_line|#define endfor_nexthops(fi) }
DECL|macro|DN_MAX_DIVISOR
mdefine_line|#define DN_MAX_DIVISOR 1024
DECL|macro|DN_S_ZOMBIE
mdefine_line|#define DN_S_ZOMBIE 1
DECL|macro|DN_S_ACCESSED
mdefine_line|#define DN_S_ACCESSED 2
DECL|macro|DN_FIB_SCAN
mdefine_line|#define DN_FIB_SCAN(f, fp) &bslash;&n;for( ; ((f) = *(fp)) != NULL; (fp) = &amp;(f)-&gt;fn_next)
DECL|macro|DN_FIB_SCAN_KEY
mdefine_line|#define DN_FIB_SCAN_KEY(f, fp, key) &bslash;&n;for( ; ((f) = *(fp)) != NULL &amp;&amp; dn_key_eq((f)-&gt;fn_key, (key)); (fp) = &amp;(f)-&gt;fn_next)
DECL|variable|dn_fib_tables_lock
r_static
id|rwlock_t
id|dn_fib_tables_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|dn_fib_tables
r_static
r_struct
id|dn_fib_table
op_star
id|dn_fib_tables
(braket
id|DN_NUM_TABLES
op_plus
l_int|1
)braket
suffix:semicolon
DECL|variable|dn_hash_kmem
r_static
id|kmem_cache_t
op_star
id|dn_hash_kmem
suffix:semicolon
DECL|variable|dn_fib_hash_zombies
r_static
r_int
id|dn_fib_hash_zombies
op_assign
l_int|0
suffix:semicolon
DECL|function|dn_hash
r_static
id|__inline__
id|dn_fib_idx_t
id|dn_hash
c_func
(paren
id|dn_fib_key_t
id|key
comma
r_struct
id|dn_zone
op_star
id|dz
)paren
(brace
id|u32
id|h
op_assign
id|ntohs
c_func
(paren
id|key.datum
)paren
op_rshift
(paren
l_int|16
op_minus
id|dz-&gt;dz_order
)paren
suffix:semicolon
id|h
op_xor_assign
(paren
id|h
op_rshift
l_int|10
)paren
suffix:semicolon
id|h
op_xor_assign
(paren
id|h
op_rshift
l_int|6
)paren
suffix:semicolon
id|h
op_xor_assign
(paren
id|h
op_rshift
l_int|3
)paren
suffix:semicolon
id|h
op_and_assign
id|DZ_HASHMASK
c_func
(paren
id|dz
)paren
suffix:semicolon
r_return
op_star
(paren
id|dn_fib_idx_t
op_star
)paren
op_amp
id|h
suffix:semicolon
)brace
DECL|function|dz_key
r_static
id|__inline__
id|dn_fib_key_t
id|dz_key
c_func
(paren
id|u16
id|dst
comma
r_struct
id|dn_zone
op_star
id|dz
)paren
(brace
id|dn_fib_key_t
id|k
suffix:semicolon
id|k.datum
op_assign
id|dst
op_amp
id|DZ_MASK
c_func
(paren
id|dz
)paren
suffix:semicolon
r_return
id|k
suffix:semicolon
)brace
DECL|function|dn_chain_p
r_static
id|__inline__
r_struct
id|dn_fib_node
op_star
op_star
id|dn_chain_p
c_func
(paren
id|dn_fib_key_t
id|key
comma
r_struct
id|dn_zone
op_star
id|dz
)paren
(brace
r_return
op_amp
id|dz-&gt;dz_hash
(braket
id|dn_hash
c_func
(paren
id|key
comma
id|dz
)paren
dot
id|datum
)braket
suffix:semicolon
)brace
DECL|function|dz_chain
r_static
id|__inline__
r_struct
id|dn_fib_node
op_star
id|dz_chain
c_func
(paren
id|dn_fib_key_t
id|key
comma
r_struct
id|dn_zone
op_star
id|dz
)paren
(brace
r_return
id|dz-&gt;dz_hash
(braket
id|dn_hash
c_func
(paren
id|key
comma
id|dz
)paren
dot
id|datum
)braket
suffix:semicolon
)brace
DECL|function|dn_key_eq
r_static
id|__inline__
r_int
id|dn_key_eq
c_func
(paren
id|dn_fib_key_t
id|a
comma
id|dn_fib_key_t
id|b
)paren
(brace
r_return
id|a.datum
op_eq
id|b.datum
suffix:semicolon
)brace
DECL|function|dn_key_leq
r_static
id|__inline__
r_int
id|dn_key_leq
c_func
(paren
id|dn_fib_key_t
id|a
comma
id|dn_fib_key_t
id|b
)paren
(brace
r_return
id|a.datum
op_le
id|b.datum
suffix:semicolon
)brace
DECL|function|dn_rebuild_zone
r_static
id|__inline__
r_void
id|dn_rebuild_zone
c_func
(paren
r_struct
id|dn_zone
op_star
id|dz
comma
r_struct
id|dn_fib_node
op_star
op_star
id|old_ht
comma
r_int
id|old_divisor
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dn_fib_node
op_star
id|f
comma
op_star
op_star
id|fp
comma
op_star
id|next
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|old_divisor
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|f
op_assign
id|old_ht
(braket
id|i
)braket
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fn_next
)paren
(brace
id|next
op_assign
id|f-&gt;fn_next
suffix:semicolon
r_for
c_loop
(paren
id|fp
op_assign
id|dn_chain_p
c_func
(paren
id|f-&gt;fn_key
comma
id|dz
)paren
suffix:semicolon
op_star
id|fp
op_logical_and
id|dn_key_leq
c_func
(paren
(paren
op_star
id|fp
)paren
op_member_access_from_pointer
id|fn_key
comma
id|f-&gt;fn_key
)paren
suffix:semicolon
id|fp
op_assign
op_amp
(paren
op_star
id|fp
)paren
op_member_access_from_pointer
id|fn_next
)paren
(brace
multiline_comment|/* NOTHING */
suffix:semicolon
)brace
id|f-&gt;fn_next
op_assign
op_star
id|fp
suffix:semicolon
op_star
id|fp
op_assign
id|f
suffix:semicolon
)brace
)brace
)brace
DECL|function|dn_rehash_zone
r_static
r_void
id|dn_rehash_zone
c_func
(paren
r_struct
id|dn_zone
op_star
id|dz
)paren
(brace
r_struct
id|dn_fib_node
op_star
op_star
id|ht
comma
op_star
op_star
id|old_ht
suffix:semicolon
r_int
id|old_divisor
comma
id|new_divisor
suffix:semicolon
id|u32
id|new_hashmask
suffix:semicolon
id|old_divisor
op_assign
id|dz-&gt;dz_divisor
suffix:semicolon
r_switch
c_cond
(paren
id|old_divisor
)paren
(brace
r_case
l_int|16
suffix:colon
id|new_divisor
op_assign
l_int|256
suffix:semicolon
id|new_hashmask
op_assign
l_int|0xFF
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;DECnet: dn_rehash_zone: BUG! %d&bslash;n&quot;
comma
id|old_divisor
)paren
suffix:semicolon
r_case
l_int|256
suffix:colon
id|new_divisor
op_assign
l_int|1024
suffix:semicolon
id|new_hashmask
op_assign
l_int|0x3FF
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ht
op_assign
id|kmalloc
c_func
(paren
id|new_divisor
op_star
r_sizeof
(paren
r_struct
id|dn_fib_node
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ht
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
id|ht
comma
l_int|0
comma
id|new_divisor
op_star
r_sizeof
(paren
r_struct
id|dn_fib_node
op_star
)paren
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
id|old_ht
op_assign
id|dz-&gt;dz_hash
suffix:semicolon
id|dz-&gt;dz_hash
op_assign
id|ht
suffix:semicolon
id|dz-&gt;dz_hashmask
op_assign
id|new_hashmask
suffix:semicolon
id|dz-&gt;dz_divisor
op_assign
id|new_divisor
suffix:semicolon
id|dn_rebuild_zone
c_func
(paren
id|dz
comma
id|old_ht
comma
id|old_divisor
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|old_ht
)paren
suffix:semicolon
)brace
DECL|function|dn_free_node
r_static
r_void
id|dn_free_node
c_func
(paren
r_struct
id|dn_fib_node
op_star
id|f
)paren
(brace
id|dn_fib_release_info
c_func
(paren
id|DN_FIB_INFO
c_func
(paren
id|f
)paren
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|dn_hash_kmem
comma
id|f
)paren
suffix:semicolon
)brace
DECL|function|dn_new_zone
r_static
r_struct
id|dn_zone
op_star
id|dn_new_zone
c_func
(paren
r_struct
id|dn_hash
op_star
id|table
comma
r_int
id|z
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dn_zone
op_star
id|dz
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dn_zone
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dz
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|dz
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dn_zone
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|z
)paren
(brace
id|dz-&gt;dz_divisor
op_assign
l_int|16
suffix:semicolon
id|dz-&gt;dz_hashmask
op_assign
l_int|0x0F
suffix:semicolon
)brace
r_else
(brace
id|dz-&gt;dz_divisor
op_assign
l_int|1
suffix:semicolon
id|dz-&gt;dz_hashmask
op_assign
l_int|0
suffix:semicolon
)brace
id|dz-&gt;dz_hash
op_assign
id|kmalloc
c_func
(paren
id|dz-&gt;dz_divisor
op_star
r_sizeof
(paren
r_struct
id|dn_fib_node
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dz-&gt;dz_hash
)paren
(brace
id|kfree
c_func
(paren
id|dz
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|dz-&gt;dz_hash
comma
l_int|0
comma
id|dz-&gt;dz_divisor
op_star
r_sizeof
(paren
r_struct
id|dn_fib_node
op_star
)paren
)paren
suffix:semicolon
id|dz-&gt;dz_order
op_assign
id|z
suffix:semicolon
id|dz-&gt;dz_mask
op_assign
id|dnet_make_mask
c_func
(paren
id|z
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|z
op_plus
l_int|1
suffix:semicolon
id|i
op_le
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|table-&gt;dh_zones
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OG
l_int|16
)paren
(brace
id|dz-&gt;dz_next
op_assign
id|table-&gt;dh_zone_list
suffix:semicolon
id|table-&gt;dh_zone_list
op_assign
id|dz
suffix:semicolon
)brace
r_else
(brace
id|dz-&gt;dz_next
op_assign
id|table-&gt;dh_zones
(braket
id|i
)braket
op_member_access_from_pointer
id|dz_next
suffix:semicolon
id|table-&gt;dh_zones
(braket
id|i
)braket
op_member_access_from_pointer
id|dz_next
op_assign
id|dz
suffix:semicolon
)brace
id|table-&gt;dh_zones
(braket
id|z
)braket
op_assign
id|dz
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_return
id|dz
suffix:semicolon
)brace
DECL|function|dn_fib_nh_match
r_static
r_int
id|dn_fib_nh_match
c_func
(paren
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_struct
id|dn_kern_rta
op_star
id|rta
comma
r_struct
id|dn_fib_info
op_star
id|fi
)paren
(brace
r_struct
id|rtnexthop
op_star
id|nhp
suffix:semicolon
r_int
id|nhlen
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_priority
op_logical_and
op_star
id|rta-&gt;rta_priority
op_ne
id|fi-&gt;fib_priority
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_oif
op_logical_or
id|rta-&gt;rta_gw
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|rta-&gt;rta_oif
op_logical_or
op_star
id|rta-&gt;rta_oif
op_eq
id|fi-&gt;fib_nh-&gt;nh_oif
)paren
op_logical_and
(paren
op_logical_neg
id|rta-&gt;rta_gw
op_logical_or
id|memcmp
c_func
(paren
id|rta-&gt;rta_gw
comma
op_amp
id|fi-&gt;fib_nh-&gt;nh_gw
comma
l_int|2
)paren
op_eq
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rta-&gt;rta_mp
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|nhp
op_assign
id|RTA_DATA
c_func
(paren
id|rta-&gt;rta_mp
)paren
suffix:semicolon
id|nhlen
op_assign
id|RTA_PAYLOAD
c_func
(paren
id|rta-&gt;rta_mp
)paren
suffix:semicolon
id|for_nexthops
c_func
(paren
id|fi
)paren
(brace
r_int
id|attrlen
op_assign
id|nhlen
op_minus
r_sizeof
(paren
r_struct
id|rtnexthop
)paren
suffix:semicolon
id|dn_address
id|gw
suffix:semicolon
r_if
c_cond
(paren
id|attrlen
OL
l_int|0
op_logical_or
(paren
id|nhlen
op_sub_assign
id|nhp-&gt;rtnh_len
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|nhp-&gt;rtnh_ifindex
op_logical_and
id|nhp-&gt;rtnh_ifindex
op_ne
id|nh-&gt;nh_oif
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|attrlen
)paren
(brace
id|gw
op_assign
id|dn_fib_get_attr16
c_func
(paren
id|RTNH_DATA
c_func
(paren
id|nhp
)paren
comma
id|attrlen
comma
id|RTA_GATEWAY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gw
op_logical_and
id|gw
op_ne
id|nh-&gt;nh_gw
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|nhp
op_assign
id|RTNH_NEXT
c_func
(paren
id|nhp
)paren
suffix:semicolon
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_RTNETLINK
DECL|function|dn_fib_dump_info
r_static
r_int
id|dn_fib_dump_info
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|pid
comma
id|u32
id|seq
comma
r_int
id|event
comma
id|u8
id|tb_id
comma
id|u8
id|type
comma
id|u8
id|scope
comma
r_void
op_star
id|dst
comma
r_int
id|dst_len
comma
r_struct
id|dn_fib_info
op_star
id|fi
)paren
(brace
r_struct
id|rtmsg
op_star
id|rtm
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
id|pid
comma
id|seq
comma
id|event
comma
r_sizeof
(paren
op_star
id|rtm
)paren
)paren
suffix:semicolon
id|rtm
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|rtm-&gt;rtm_family
op_assign
id|AF_DECnet
suffix:semicolon
id|rtm-&gt;rtm_dst_len
op_assign
id|dst_len
suffix:semicolon
id|rtm-&gt;rtm_src_len
op_assign
l_int|0
suffix:semicolon
id|rtm-&gt;rtm_tos
op_assign
l_int|0
suffix:semicolon
id|rtm-&gt;rtm_table
op_assign
id|tb_id
suffix:semicolon
id|rtm-&gt;rtm_flags
op_assign
id|fi-&gt;fib_flags
suffix:semicolon
id|rtm-&gt;rtm_scope
op_assign
id|scope
suffix:semicolon
id|rtm-&gt;rtm_type
op_assign
id|type
suffix:semicolon
r_if
c_cond
(paren
id|rtm-&gt;rtm_dst_len
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_DST
comma
l_int|2
comma
id|dst
)paren
suffix:semicolon
id|rtm-&gt;rtm_protocol
op_assign
id|fi-&gt;fib_protocol
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_priority
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_PRIORITY
comma
l_int|4
comma
op_amp
id|fi-&gt;fib_priority
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_nhs
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_nh-&gt;nh_gw
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_GATEWAY
comma
l_int|2
comma
op_amp
id|fi-&gt;fib_nh-&gt;nh_gw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_nh-&gt;nh_oif
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_OIF
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|fi-&gt;fib_nh-&gt;nh_oif
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fi-&gt;fib_nhs
OG
l_int|1
)paren
(brace
r_struct
id|rtnexthop
op_star
id|nhp
suffix:semicolon
r_struct
id|rtattr
op_star
id|mp_head
suffix:semicolon
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
op_le
id|RTA_SPACE
c_func
(paren
l_int|0
)paren
)paren
r_goto
id|rtattr_failure
suffix:semicolon
id|mp_head
op_assign
(paren
r_struct
id|rtattr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|RTA_SPACE
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|for_nexthops
c_func
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
id|RTA_ALIGN
c_func
(paren
id|RTA_ALIGN
c_func
(paren
r_sizeof
(paren
op_star
id|nhp
)paren
)paren
op_plus
l_int|4
)paren
)paren
r_goto
id|rtattr_failure
suffix:semicolon
id|nhp
op_assign
(paren
r_struct
id|rtnexthop
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|RTA_ALIGN
c_func
(paren
r_sizeof
(paren
op_star
id|nhp
)paren
)paren
)paren
suffix:semicolon
id|nhp-&gt;rtnh_flags
op_assign
id|nh-&gt;nh_flags
op_amp
l_int|0xFF
suffix:semicolon
id|nhp-&gt;rtnh_hops
op_assign
id|nh-&gt;nh_weight
op_minus
l_int|1
suffix:semicolon
id|nhp-&gt;rtnh_ifindex
op_assign
id|nh-&gt;nh_oif
suffix:semicolon
r_if
c_cond
(paren
id|nh-&gt;nh_gw
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_GATEWAY
comma
l_int|2
comma
op_amp
id|nh-&gt;nh_gw
)paren
suffix:semicolon
id|nhp-&gt;rtnh_len
op_assign
id|skb-&gt;tail
op_minus
(paren
r_int
r_char
op_star
)paren
id|nhp
suffix:semicolon
)brace
id|endfor_nexthops
c_func
(paren
id|fi
)paren
suffix:semicolon
id|mp_head-&gt;rta_type
op_assign
id|RTA_MULTIPATH
suffix:semicolon
id|mp_head-&gt;rta_len
op_assign
id|skb-&gt;tail
op_minus
(paren
id|u8
op_star
)paren
id|mp_head
suffix:semicolon
)brace
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|rtattr_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|dn_rtmsg_fib
r_static
r_void
id|dn_rtmsg_fib
c_func
(paren
r_int
id|event
comma
r_struct
id|dn_fib_node
op_star
id|f
comma
r_int
id|z
comma
r_int
id|tb_id
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_struct
id|netlink_skb_parms
op_star
id|req
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u32
id|pid
op_assign
id|req
ques
c_cond
id|req-&gt;pid
suffix:colon
l_int|0
suffix:semicolon
r_int
id|size
op_assign
id|NLMSG_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|rtmsg
)paren
op_plus
l_int|256
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|dn_fib_dump_info
c_func
(paren
id|skb
comma
id|pid
comma
id|nlh-&gt;nlmsg_seq
comma
id|event
comma
id|tb_id
comma
id|f-&gt;fn_type
comma
id|f-&gt;fn_scope
comma
op_amp
id|f-&gt;fn_key
comma
id|z
comma
id|DN_FIB_INFO
c_func
(paren
id|f
)paren
)paren
OL
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|RTMGRP_DECnet_ROUTE
suffix:semicolon
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_flags
op_amp
id|NLM_F_ECHO
)paren
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|pid
comma
id|RTMGRP_DECnet_ROUTE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_flags
op_amp
id|NLM_F_ECHO
)paren
id|netlink_unicast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
)brace
DECL|function|dn_hash_dump_bucket
r_static
id|__inline__
r_int
id|dn_hash_dump_bucket
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
comma
r_struct
id|dn_fib_table
op_star
id|tb
comma
r_struct
id|dn_zone
op_star
id|dz
comma
r_struct
id|dn_fib_node
op_star
id|f
)paren
(brace
r_int
id|i
comma
id|s_i
suffix:semicolon
id|s_i
op_assign
id|cb-&gt;args
(braket
l_int|3
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|f
suffix:semicolon
id|i
op_increment
comma
id|f
op_assign
id|f-&gt;fn_next
)paren
(brace
r_if
c_cond
(paren
id|i
OL
id|s_i
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|DN_S_ZOMBIE
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dn_fib_dump_info
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|cb-&gt;skb
)paren
dot
id|pid
comma
id|cb-&gt;nlh-&gt;nlmsg_seq
comma
id|RTM_NEWROUTE
comma
id|tb-&gt;n
comma
(paren
id|f-&gt;fn_state
op_amp
id|DN_S_ZOMBIE
)paren
ques
c_cond
l_int|0
suffix:colon
id|f-&gt;fn_type
comma
id|f-&gt;fn_scope
comma
op_amp
id|f-&gt;fn_key
comma
id|dz-&gt;dz_order
comma
id|f-&gt;fn_info
)paren
OL
l_int|0
)paren
(brace
id|cb-&gt;args
(braket
l_int|3
)braket
op_assign
id|i
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|cb-&gt;args
(braket
l_int|3
)braket
op_assign
id|i
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
DECL|function|dn_hash_dump_zone
r_static
id|__inline__
r_int
id|dn_hash_dump_zone
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
comma
r_struct
id|dn_fib_table
op_star
id|tb
comma
r_struct
id|dn_zone
op_star
id|dz
)paren
(brace
r_int
id|h
comma
id|s_h
suffix:semicolon
id|s_h
op_assign
id|cb-&gt;args
(braket
l_int|2
)braket
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|dz-&gt;dz_divisor
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|h
OL
id|s_h
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|h
OG
id|s_h
)paren
id|memset
c_func
(paren
op_amp
id|cb-&gt;args
(braket
l_int|3
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|cb-&gt;args
)paren
op_minus
l_int|3
op_star
r_sizeof
(paren
id|cb-&gt;args
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dz-&gt;dz_hash
op_eq
l_int|NULL
op_logical_or
id|dz-&gt;dz_hash
(braket
id|h
)braket
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dn_hash_dump_bucket
c_func
(paren
id|skb
comma
id|cb
comma
id|tb
comma
id|dz
comma
id|dz-&gt;dz_hash
(braket
id|h
)braket
)paren
OL
l_int|0
)paren
(brace
id|cb-&gt;args
(braket
l_int|2
)braket
op_assign
id|h
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|cb-&gt;args
(braket
l_int|2
)braket
op_assign
id|h
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
DECL|function|dn_fib_table_dump
r_static
r_int
id|dn_fib_table_dump
c_func
(paren
r_struct
id|dn_fib_table
op_star
id|tb
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_int
id|m
comma
id|s_m
suffix:semicolon
r_struct
id|dn_zone
op_star
id|dz
suffix:semicolon
r_struct
id|dn_hash
op_star
id|table
op_assign
(paren
r_struct
id|dn_hash
op_star
)paren
id|tb-&gt;data
suffix:semicolon
id|s_m
op_assign
id|cb-&gt;args
(braket
l_int|1
)braket
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dz
op_assign
id|table-&gt;dh_zone_list
comma
id|m
op_assign
l_int|0
suffix:semicolon
id|dz
suffix:semicolon
id|dz
op_assign
id|dz-&gt;dz_next
comma
id|m
op_increment
)paren
(brace
r_if
c_cond
(paren
id|m
OL
id|s_m
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|m
OG
id|s_m
)paren
id|memset
c_func
(paren
op_amp
id|cb-&gt;args
(braket
l_int|2
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|cb-&gt;args
)paren
op_minus
l_int|2
op_star
r_sizeof
(paren
id|cb-&gt;args
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dn_hash_dump_zone
c_func
(paren
id|skb
comma
id|cb
comma
id|tb
comma
id|dz
)paren
OL
l_int|0
)paren
(brace
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|m
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|m
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
macro_line|#else /* no CONFIG_RTNETLINK */
DECL|macro|dn_rtmsg_fib
mdefine_line|#define dn_rtmsg_fib(event,f,z,tb_id,nlh,req)
macro_line|#endif /* CONFIG_RTNETLINK */
DECL|function|dn_fib_table_insert
r_static
r_int
id|dn_fib_table_insert
c_func
(paren
r_struct
id|dn_fib_table
op_star
id|tb
comma
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|dn_kern_rta
op_star
id|rta
comma
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|netlink_skb_parms
op_star
id|req
)paren
(brace
r_struct
id|dn_hash
op_star
id|table
op_assign
(paren
r_struct
id|dn_hash
op_star
)paren
id|tb-&gt;data
suffix:semicolon
r_struct
id|dn_fib_node
op_star
id|new_f
comma
op_star
id|f
comma
op_star
op_star
id|fp
comma
op_star
op_star
id|del_fp
suffix:semicolon
r_struct
id|dn_zone
op_star
id|dz
suffix:semicolon
r_struct
id|dn_fib_info
op_star
id|fi
suffix:semicolon
r_int
id|z
op_assign
id|r-&gt;rtm_dst_len
suffix:semicolon
r_int
id|type
op_assign
id|r-&gt;rtm_type
suffix:semicolon
id|dn_fib_key_t
id|key
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|z
OG
l_int|16
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dz
op_assign
id|table-&gt;dh_zones
(braket
id|z
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dz
op_logical_and
op_logical_neg
(paren
id|dz
op_assign
id|dn_new_zone
c_func
(paren
id|table
comma
id|z
)paren
)paren
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|dz_key_0
c_func
(paren
id|key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_dst
)paren
(brace
id|dn_address
id|dst
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dst
comma
id|rta-&gt;rta_dst
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst
op_amp
op_complement
id|DZ_MASK
c_func
(paren
id|dz
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|key
op_assign
id|dz_key
c_func
(paren
id|dst
comma
id|dz
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fi
op_assign
id|dn_fib_create_info
c_func
(paren
id|r
comma
id|rta
comma
id|n
comma
op_amp
id|err
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dz-&gt;dz_nent
OG
(paren
id|dz-&gt;dz_divisor
op_lshift
l_int|2
)paren
op_logical_and
id|dz-&gt;dz_divisor
OG
id|DN_MAX_DIVISOR
op_logical_and
(paren
id|z
op_eq
l_int|16
op_logical_or
(paren
l_int|1
op_lshift
id|z
)paren
OG
id|dz-&gt;dz_divisor
)paren
)paren
id|dn_rehash_zone
c_func
(paren
id|dz
)paren
suffix:semicolon
id|fp
op_assign
id|dn_chain_p
c_func
(paren
id|key
comma
id|dz
)paren
suffix:semicolon
id|DN_FIB_SCAN
c_func
(paren
id|f
comma
id|fp
)paren
(brace
r_if
c_cond
(paren
id|dn_key_leq
c_func
(paren
id|key
comma
id|f-&gt;fn_key
)paren
)paren
r_break
suffix:semicolon
)brace
id|del_fp
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|f
op_logical_and
(paren
id|f-&gt;fn_state
op_amp
id|DN_S_ZOMBIE
)paren
op_logical_and
id|dn_key_eq
c_func
(paren
id|f-&gt;fn_key
comma
id|key
)paren
)paren
(brace
id|del_fp
op_assign
id|fp
suffix:semicolon
id|fp
op_assign
op_amp
id|f-&gt;fn_next
suffix:semicolon
id|f
op_assign
op_star
id|fp
suffix:semicolon
r_goto
id|create
suffix:semicolon
)brace
id|DN_FIB_SCAN_KEY
c_func
(paren
id|f
comma
id|fp
comma
id|key
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_priority
op_le
id|DN_FIB_INFO
c_func
(paren
id|f
)paren
op_member_access_from_pointer
id|fib_priority
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|f
op_logical_and
id|dn_key_eq
c_func
(paren
id|f-&gt;fn_key
comma
id|key
)paren
op_logical_and
id|fi-&gt;fib_priority
op_eq
id|DN_FIB_INFO
c_func
(paren
id|f
)paren
op_member_access_from_pointer
id|fib_priority
)paren
(brace
r_struct
id|dn_fib_node
op_star
op_star
id|ins_fp
suffix:semicolon
id|err
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_if
c_cond
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_EXCL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_REPLACE
)paren
(brace
id|del_fp
op_assign
id|fp
suffix:semicolon
id|fp
op_assign
op_amp
id|f-&gt;fn_next
suffix:semicolon
id|f
op_assign
op_star
id|fp
suffix:semicolon
r_goto
id|replace
suffix:semicolon
)brace
id|ins_fp
op_assign
id|fp
suffix:semicolon
id|err
op_assign
op_minus
id|EEXIST
suffix:semicolon
id|DN_FIB_SCAN_KEY
c_func
(paren
id|f
comma
id|fp
comma
id|key
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_priority
op_ne
id|DN_FIB_INFO
c_func
(paren
id|f
)paren
op_member_access_from_pointer
id|fib_priority
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_type
op_eq
id|type
op_logical_and
id|f-&gt;fn_scope
op_eq
id|r-&gt;rtm_scope
op_logical_and
id|DN_FIB_INFO
c_func
(paren
id|f
)paren
op_eq
id|fi
)paren
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_APPEND
)paren
)paren
(brace
id|fp
op_assign
id|ins_fp
suffix:semicolon
id|f
op_assign
op_star
id|fp
suffix:semicolon
)brace
)brace
id|create
suffix:colon
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_CREATE
)paren
)paren
r_goto
id|out
suffix:semicolon
id|replace
suffix:colon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|new_f
op_assign
id|kmem_cache_alloc
c_func
(paren
id|dn_hash_kmem
comma
id|SLAB_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_f
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|new_f
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dn_fib_node
)paren
)paren
suffix:semicolon
id|new_f-&gt;fn_key
op_assign
id|key
suffix:semicolon
id|new_f-&gt;fn_type
op_assign
id|type
suffix:semicolon
id|new_f-&gt;fn_scope
op_assign
id|r-&gt;rtm_scope
suffix:semicolon
id|DN_FIB_INFO
c_func
(paren
id|new_f
)paren
op_assign
id|fi
suffix:semicolon
id|new_f-&gt;fn_next
op_assign
id|f
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
op_star
id|fp
op_assign
id|new_f
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
id|dz-&gt;dz_nent
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|del_fp
)paren
(brace
id|f
op_assign
op_star
id|del_fp
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
op_star
id|del_fp
op_assign
id|f-&gt;fn_next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|f-&gt;fn_state
op_amp
id|DN_S_ZOMBIE
)paren
)paren
id|dn_rtmsg_fib
c_func
(paren
id|RTM_DELROUTE
comma
id|f
comma
id|z
comma
id|tb-&gt;n
comma
id|n
comma
id|req
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|DN_S_ACCESSED
)paren
id|dn_rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|dn_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|dz-&gt;dz_nent
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|dn_rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|dn_rtmsg_fib
c_func
(paren
id|RTM_NEWROUTE
comma
id|new_f
comma
id|z
comma
id|tb-&gt;n
comma
id|n
comma
id|req
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
id|dn_fib_release_info
c_func
(paren
id|fi
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dn_fib_table_delete
r_static
r_int
id|dn_fib_table_delete
c_func
(paren
r_struct
id|dn_fib_table
op_star
id|tb
comma
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|dn_kern_rta
op_star
id|rta
comma
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|netlink_skb_parms
op_star
id|req
)paren
(brace
r_struct
id|dn_hash
op_star
id|table
op_assign
(paren
r_struct
id|dn_hash
op_star
)paren
id|tb-&gt;data
suffix:semicolon
r_struct
id|dn_fib_node
op_star
op_star
id|fp
comma
op_star
op_star
id|del_fp
comma
op_star
id|f
suffix:semicolon
r_int
id|z
op_assign
id|r-&gt;rtm_dst_len
suffix:semicolon
r_struct
id|dn_zone
op_star
id|dz
suffix:semicolon
id|dn_fib_key_t
id|key
suffix:semicolon
r_int
id|matched
suffix:semicolon
r_if
c_cond
(paren
id|z
OG
l_int|16
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dz
op_assign
id|table-&gt;dh_zones
(braket
id|z
)braket
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
id|dz_key_0
c_func
(paren
id|key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_dst
)paren
(brace
id|dn_address
id|dst
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dst
comma
id|rta-&gt;rta_dst
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst
op_amp
op_complement
id|DZ_MASK
c_func
(paren
id|dz
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|key
op_assign
id|dz_key
c_func
(paren
id|dst
comma
id|dz
)paren
suffix:semicolon
)brace
id|fp
op_assign
id|dn_chain_p
c_func
(paren
id|key
comma
id|dz
)paren
suffix:semicolon
id|DN_FIB_SCAN
c_func
(paren
id|f
comma
id|fp
)paren
(brace
r_if
c_cond
(paren
id|dn_key_eq
c_func
(paren
id|f-&gt;fn_key
comma
id|key
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|dn_key_leq
c_func
(paren
id|key
comma
id|f-&gt;fn_key
)paren
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
id|matched
op_assign
l_int|0
suffix:semicolon
id|del_fp
op_assign
l_int|NULL
suffix:semicolon
id|DN_FIB_SCAN_KEY
c_func
(paren
id|f
comma
id|fp
comma
id|key
)paren
(brace
r_struct
id|dn_fib_info
op_star
id|fi
op_assign
id|DN_FIB_INFO
c_func
(paren
id|f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|DN_S_ZOMBIE
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
id|matched
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|del_fp
op_eq
l_int|NULL
op_logical_and
(paren
op_logical_neg
id|r-&gt;rtm_type
op_logical_or
id|f-&gt;fn_type
op_eq
id|r-&gt;rtm_type
)paren
op_logical_and
(paren
id|r-&gt;rtm_scope
op_eq
id|RT_SCOPE_NOWHERE
op_logical_or
id|f-&gt;fn_scope
op_eq
id|r-&gt;rtm_scope
)paren
op_logical_and
(paren
op_logical_neg
id|r-&gt;rtm_protocol
op_logical_or
id|fi-&gt;fib_protocol
op_eq
id|r-&gt;rtm_protocol
)paren
op_logical_and
id|dn_fib_nh_match
c_func
(paren
id|r
comma
id|n
comma
id|rta
comma
id|fi
)paren
op_eq
l_int|0
)paren
id|del_fp
op_assign
id|fp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|del_fp
)paren
(brace
id|f
op_assign
op_star
id|del_fp
suffix:semicolon
id|dn_rtmsg_fib
c_func
(paren
id|RTM_DELROUTE
comma
id|f
comma
id|z
comma
id|tb-&gt;n
comma
id|n
comma
id|req
)paren
suffix:semicolon
r_if
c_cond
(paren
id|matched
op_ne
l_int|1
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
op_star
id|del_fp
op_assign
id|f-&gt;fn_next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|DN_S_ACCESSED
)paren
id|dn_rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|dn_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|dz-&gt;dz_nent
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|f-&gt;fn_state
op_or_assign
id|DN_S_ZOMBIE
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|DN_S_ACCESSED
)paren
(brace
id|f-&gt;fn_state
op_and_assign
op_complement
id|DN_S_ACCESSED
suffix:semicolon
id|dn_rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|dn_fib_hash_zombies
OG
l_int|128
)paren
id|dn_fib_flush
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
DECL|function|dn_flush_list
r_static
id|__inline__
r_int
id|dn_flush_list
c_func
(paren
r_struct
id|dn_fib_node
op_star
op_star
id|fp
comma
r_int
id|z
comma
r_struct
id|dn_hash
op_star
id|table
)paren
(brace
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_struct
id|dn_fib_node
op_star
id|f
suffix:semicolon
r_while
c_loop
(paren
(paren
id|f
op_assign
op_star
id|fp
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|dn_fib_info
op_star
id|fi
op_assign
id|DN_FIB_INFO
c_func
(paren
id|f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_logical_and
(paren
(paren
id|f-&gt;fn_state
op_amp
id|DN_S_ZOMBIE
)paren
op_logical_or
(paren
id|fi-&gt;fib_flags
op_amp
id|RTNH_F_DEAD
)paren
)paren
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
op_star
id|fp
op_assign
id|f-&gt;fn_next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
id|dn_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|found
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|fp
op_assign
op_amp
id|f-&gt;fn_next
suffix:semicolon
)brace
r_return
id|found
suffix:semicolon
)brace
DECL|function|dn_fib_table_flush
r_static
r_int
id|dn_fib_table_flush
c_func
(paren
r_struct
id|dn_fib_table
op_star
id|tb
)paren
(brace
r_struct
id|dn_hash
op_star
id|table
op_assign
(paren
r_struct
id|dn_hash
op_star
)paren
id|tb-&gt;data
suffix:semicolon
r_struct
id|dn_zone
op_star
id|dz
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
id|dn_fib_hash_zombies
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|dz
op_assign
id|table-&gt;dh_zone_list
suffix:semicolon
id|dz
suffix:semicolon
id|dz
op_assign
id|dz-&gt;dz_next
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|tmp
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|dz-&gt;dz_divisor
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|tmp
op_add_assign
id|dn_flush_list
c_func
(paren
op_amp
id|dz-&gt;dz_hash
(braket
id|i
)braket
comma
id|dz-&gt;dz_order
comma
id|table
)paren
suffix:semicolon
)brace
id|dz-&gt;dz_nent
op_sub_assign
id|tmp
suffix:semicolon
id|found
op_add_assign
id|tmp
suffix:semicolon
)brace
r_return
id|found
suffix:semicolon
)brace
DECL|function|dn_fib_table_lookup
r_static
r_int
id|dn_fib_table_lookup
c_func
(paren
r_struct
id|dn_fib_table
op_star
id|tb
comma
r_const
r_struct
id|dn_fib_key
op_star
id|key
comma
r_struct
id|dn_fib_res
op_star
id|res
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|dn_zone
op_star
id|dz
suffix:semicolon
r_struct
id|dn_hash
op_star
id|t
op_assign
(paren
r_struct
id|dn_hash
op_star
)paren
id|tb-&gt;data
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dz
op_assign
id|t-&gt;dh_zone_list
suffix:semicolon
id|dz
suffix:semicolon
id|dz
op_assign
id|dz-&gt;dz_next
)paren
(brace
r_struct
id|dn_fib_node
op_star
id|f
suffix:semicolon
id|dn_fib_key_t
id|k
op_assign
id|dz_key
c_func
(paren
id|key-&gt;dst
comma
id|dz
)paren
suffix:semicolon
r_for
c_loop
(paren
id|f
op_assign
id|dz_chain
c_func
(paren
id|k
comma
id|dz
)paren
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fn_next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dn_key_leq
c_func
(paren
id|k
comma
id|f-&gt;fn_key
)paren
)paren
r_break
suffix:semicolon
r_else
r_continue
suffix:semicolon
id|f-&gt;fn_state
op_or_assign
id|DN_S_ACCESSED
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|DN_S_ZOMBIE
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_scope
OL
id|key-&gt;scope
)paren
r_continue
suffix:semicolon
id|err
op_assign
id|dn_fib_semantic_match
c_func
(paren
id|f-&gt;fn_type
comma
id|DN_FIB_INFO
c_func
(paren
id|f
)paren
comma
id|key
comma
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
(brace
id|res-&gt;type
op_assign
id|f-&gt;fn_type
suffix:semicolon
id|res-&gt;scope
op_assign
id|f-&gt;fn_scope
suffix:semicolon
id|res-&gt;prefixlen
op_assign
id|dz-&gt;dz_order
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
)brace
)brace
id|err
op_assign
l_int|1
suffix:semicolon
id|out
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|dn_fib_flag_trans
r_static
r_int
id|dn_fib_flag_trans
c_func
(paren
r_int
id|type
comma
r_int
id|dead
comma
id|u16
id|mask
comma
r_struct
id|dn_fib_info
op_star
id|fi
)paren
(brace
r_static
r_int
id|type2flags
(braket
id|RTN_MAX
op_plus
l_int|1
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|RTF_REJECT
comma
id|RTF_REJECT
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_int
id|flags
op_assign
id|type2flags
(braket
id|type
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_logical_and
id|fi-&gt;fib_nh-&gt;nh_gw
)paren
id|flags
op_or_assign
id|RTF_GATEWAY
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_eq
l_int|0xFFFF
)paren
id|flags
op_or_assign
id|RTF_HOST
suffix:semicolon
r_if
c_cond
(paren
id|dead
)paren
id|flags
op_or_assign
id|RTF_UP
suffix:semicolon
r_return
id|flags
suffix:semicolon
)brace
DECL|function|dn_fib_node_get_info
r_static
r_void
id|dn_fib_node_get_info
c_func
(paren
r_int
id|type
comma
r_int
id|dead
comma
r_struct
id|dn_fib_info
op_star
id|fi
comma
id|u16
id|prefix
comma
id|u16
id|mask
comma
r_char
op_star
id|buffer
)paren
(brace
r_int
id|len
suffix:semicolon
r_int
id|flags
op_assign
id|dn_fib_flag_trans
c_func
(paren
id|type
comma
id|dead
comma
id|mask
comma
id|fi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%s&bslash;t%04x&bslash;t%04x&bslash;t%04x&bslash;t%d&bslash;t%u&bslash;t%d&bslash;t%04x&bslash;t%d&bslash;t%u&bslash;t%u&quot;
comma
id|fi-&gt;fib_dev
ques
c_cond
id|fi-&gt;fib_dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
comma
id|prefix
comma
id|fi-&gt;fib_nh-&gt;nh_gw
comma
id|flags
comma
l_int|0
comma
l_int|0
comma
id|fi-&gt;fib_priority
comma
id|mask
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;*&bslash;t%04x&bslash;t%04x&bslash;t%04x&bslash;t%d&bslash;t%u&bslash;t%d&bslash;t%04x&bslash;t%d&bslash;t%u&bslash;t%u&quot;
comma
id|prefix
comma
l_int|0
comma
id|flags
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|mask
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|buffer
op_plus
id|len
comma
l_char|&squot; &squot;
comma
l_int|127
op_minus
id|len
)paren
suffix:semicolon
id|buffer
(braket
l_int|127
)braket
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
)brace
DECL|function|dn_fib_table_get_info
r_static
r_int
id|dn_fib_table_get_info
c_func
(paren
r_struct
id|dn_fib_table
op_star
id|tb
comma
r_char
op_star
id|buffer
comma
r_int
id|first
comma
r_int
id|count
)paren
(brace
r_struct
id|dn_hash
op_star
id|table
op_assign
(paren
r_struct
id|dn_hash
op_star
)paren
id|tb-&gt;data
suffix:semicolon
r_struct
id|dn_zone
op_star
id|dz
suffix:semicolon
r_int
id|pos
op_assign
l_int|0
suffix:semicolon
r_int
id|n
op_assign
l_int|0
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dz
op_assign
id|table-&gt;dh_zone_list
suffix:semicolon
id|dz
suffix:semicolon
id|dz
op_assign
id|dz-&gt;dz_next
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dn_fib_node
op_star
id|f
suffix:semicolon
r_int
id|maxslot
op_assign
id|dz-&gt;dz_divisor
suffix:semicolon
r_struct
id|dn_fib_node
op_star
op_star
id|fp
op_assign
id|dz-&gt;dz_hash
suffix:semicolon
r_if
c_cond
(paren
id|dz-&gt;dz_nent
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_plus
id|dz-&gt;dz_nent
OL
id|first
)paren
(brace
id|pos
op_add_assign
id|dz-&gt;dz_nent
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|maxslot
suffix:semicolon
id|i
op_increment
comma
id|fp
op_increment
)paren
(brace
r_for
c_loop
(paren
id|f
op_assign
op_star
id|fp
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fn_next
)paren
(brace
r_if
c_cond
(paren
op_increment
id|pos
op_le
id|first
)paren
r_continue
suffix:semicolon
id|dn_fib_node_get_info
c_func
(paren
id|f-&gt;fn_type
comma
id|f-&gt;fn_state
op_amp
id|DN_S_ZOMBIE
comma
id|DN_FIB_INFO
c_func
(paren
id|f
)paren
comma
id|dz_prefix
c_func
(paren
id|f-&gt;fn_key
comma
id|dz
)paren
comma
id|DZ_MASK
c_func
(paren
id|dz
)paren
comma
id|buffer
)paren
suffix:semicolon
id|buffer
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|n
op_ge
id|count
)paren
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
id|out
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
DECL|function|dn_fib_get_table
r_struct
id|dn_fib_table
op_star
id|dn_fib_get_table
c_func
(paren
r_int
id|n
comma
r_int
id|create
)paren
(brace
r_struct
id|dn_fib_table
op_star
id|t
suffix:semicolon
r_if
c_cond
(paren
id|n
OL
id|DN_MIN_TABLE
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
id|DN_NUM_TABLES
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|dn_fib_tables
(braket
id|n
)braket
)paren
r_return
id|dn_fib_tables
(braket
id|n
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|create
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|in_interrupt
c_func
(paren
)paren
op_logical_and
id|net_ratelimit
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
"&quot;"
id|DECnet
suffix:colon
id|BUG
op_logical_neg
id|Attempt
id|to
id|create
id|routing
id|table
id|from
id|interrupt
"&bslash;"
id|n
"&quot;"
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|t
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dn_fib_table
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|t
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dn_fib_table
)paren
)paren
suffix:semicolon
id|t-&gt;n
op_assign
id|n
suffix:semicolon
id|t-&gt;insert
op_assign
id|dn_fib_table_insert
suffix:semicolon
id|t
op_member_access_from_pointer
r_delete
op_assign
id|dn_fib_table_delete
suffix:semicolon
id|t-&gt;lookup
op_assign
id|dn_fib_table_lookup
suffix:semicolon
id|t-&gt;flush
op_assign
id|dn_fib_table_flush
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|t-&gt;get_info
op_assign
id|dn_fib_table_get_info
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_RTNETLINK
id|t-&gt;dump
op_assign
id|dn_fib_table_dump
suffix:semicolon
macro_line|#endif
id|dn_fib_tables
(braket
id|n
)braket
op_assign
id|t
suffix:semicolon
r_return
id|t
suffix:semicolon
)brace
DECL|function|dn_fib_del_tree
r_static
r_void
id|dn_fib_del_tree
c_func
(paren
r_int
id|n
)paren
(brace
r_struct
id|dn_fib_table
op_star
id|t
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
id|t
op_assign
id|dn_fib_tables
(braket
id|n
)braket
suffix:semicolon
id|dn_fib_tables
(braket
id|n
)braket
op_assign
l_int|NULL
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|dn_fib_tables_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
)paren
(brace
id|kfree
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
)brace
DECL|function|dn_fib_empty_table
r_struct
id|dn_fib_table
op_star
id|dn_fib_empty_table
c_func
(paren
r_void
)paren
(brace
r_int
id|id
suffix:semicolon
r_for
c_loop
(paren
id|id
op_assign
id|DN_MIN_TABLE
suffix:semicolon
id|id
op_le
id|DN_NUM_TABLES
suffix:semicolon
id|id
op_increment
)paren
r_if
c_cond
(paren
id|dn_fib_tables
(braket
id|id
)braket
op_eq
l_int|NULL
)paren
r_return
id|dn_fib_get_table
c_func
(paren
id|id
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|dn_fib_table_init
r_void
id|__init
id|dn_fib_table_init
c_func
(paren
r_void
)paren
(brace
id|dn_hash_kmem
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;dn_fib_info_cache&quot;
comma
r_sizeof
(paren
r_struct
id|dn_fib_info
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|dn_fib_table_cleanup
r_void
id|__exit
id|dn_fib_table_cleanup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DN_NUM_TABLES
op_plus
l_int|1
suffix:semicolon
op_increment
id|i
)paren
id|dn_fib_del_tree
c_func
(paren
id|i
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
