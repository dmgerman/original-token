multiline_comment|/*&n; * linux/net/sunrpc/xdr.c&n; *&n; * Generic XDR support.&n; *&n; * Copyright (C) 1995, 1996 Olaf Kirch &lt;okir@monad.swb.de&gt;&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/sunrpc/xdr.h&gt;
macro_line|#include &lt;linux/sunrpc/msg_prot.h&gt;
DECL|variable|rpc_success
DECL|variable|rpc_prog_unavail
DECL|variable|rpc_prog_mismatch
DECL|variable|rpc_proc_unavail
id|u32
id|rpc_success
comma
id|rpc_prog_unavail
comma
id|rpc_prog_mismatch
comma
id|rpc_proc_unavail
comma
DECL|variable|rpc_garbage_args
DECL|variable|rpc_system_err
id|rpc_garbage_args
comma
id|rpc_system_err
suffix:semicolon
DECL|variable|rpc_auth_ok
DECL|variable|rpc_autherr_badcred
DECL|variable|rpc_autherr_rejectedcred
id|u32
id|rpc_auth_ok
comma
id|rpc_autherr_badcred
comma
id|rpc_autherr_rejectedcred
comma
DECL|variable|rpc_autherr_badverf
DECL|variable|rpc_autherr_rejectedverf
DECL|variable|rpc_autherr_tooweak
id|rpc_autherr_badverf
comma
id|rpc_autherr_rejectedverf
comma
id|rpc_autherr_tooweak
suffix:semicolon
DECL|variable|xdr_zero
DECL|variable|xdr_one
DECL|variable|xdr_two
id|u32
id|xdr_zero
comma
id|xdr_one
comma
id|xdr_two
suffix:semicolon
r_void
DECL|function|xdr_init
id|xdr_init
c_func
(paren
r_void
)paren
(brace
r_static
r_int
id|inited
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|inited
)paren
r_return
suffix:semicolon
id|xdr_zero
op_assign
id|htonl
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|xdr_one
op_assign
id|htonl
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|xdr_two
op_assign
id|htonl
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|rpc_success
op_assign
id|htonl
c_func
(paren
id|RPC_SUCCESS
)paren
suffix:semicolon
id|rpc_prog_unavail
op_assign
id|htonl
c_func
(paren
id|RPC_PROG_UNAVAIL
)paren
suffix:semicolon
id|rpc_prog_mismatch
op_assign
id|htonl
c_func
(paren
id|RPC_PROG_MISMATCH
)paren
suffix:semicolon
id|rpc_proc_unavail
op_assign
id|htonl
c_func
(paren
id|RPC_PROC_UNAVAIL
)paren
suffix:semicolon
id|rpc_garbage_args
op_assign
id|htonl
c_func
(paren
id|RPC_GARBAGE_ARGS
)paren
suffix:semicolon
id|rpc_system_err
op_assign
id|htonl
c_func
(paren
id|RPC_SYSTEM_ERR
)paren
suffix:semicolon
id|rpc_auth_ok
op_assign
id|htonl
c_func
(paren
id|RPC_AUTH_OK
)paren
suffix:semicolon
id|rpc_autherr_badcred
op_assign
id|htonl
c_func
(paren
id|RPC_AUTH_BADCRED
)paren
suffix:semicolon
id|rpc_autherr_rejectedcred
op_assign
id|htonl
c_func
(paren
id|RPC_AUTH_REJECTEDCRED
)paren
suffix:semicolon
id|rpc_autherr_badverf
op_assign
id|htonl
c_func
(paren
id|RPC_AUTH_BADVERF
)paren
suffix:semicolon
id|rpc_autherr_rejectedverf
op_assign
id|htonl
c_func
(paren
id|RPC_AUTH_REJECTEDVERF
)paren
suffix:semicolon
id|rpc_autherr_tooweak
op_assign
id|htonl
c_func
(paren
id|RPC_AUTH_TOOWEAK
)paren
suffix:semicolon
id|inited
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR functions for basic NFS types&n; */
id|u32
op_star
DECL|function|xdr_encode_netobj
id|xdr_encode_netobj
c_func
(paren
id|u32
op_star
id|p
comma
r_const
r_struct
id|xdr_netobj
op_star
id|obj
)paren
(brace
r_int
r_int
id|quadlen
op_assign
id|XDR_QUADLEN
c_func
(paren
id|obj-&gt;len
)paren
suffix:semicolon
id|p
(braket
id|quadlen
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* zero trailing bytes */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|obj-&gt;len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|obj-&gt;data
comma
id|obj-&gt;len
)paren
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
id|obj-&gt;len
)paren
suffix:semicolon
)brace
id|u32
op_star
DECL|function|xdr_decode_netobj_fixed
id|xdr_decode_netobj_fixed
c_func
(paren
id|u32
op_star
id|p
comma
r_void
op_star
id|obj
comma
r_int
r_int
id|len
)paren
(brace
r_if
c_cond
(paren
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
op_ne
id|len
)paren
r_return
l_int|NULL
suffix:semicolon
id|memcpy
c_func
(paren
id|obj
comma
id|p
comma
id|len
)paren
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
id|len
)paren
suffix:semicolon
)brace
id|u32
op_star
DECL|function|xdr_decode_netobj
id|xdr_decode_netobj
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|xdr_netobj
op_star
id|obj
)paren
(brace
r_int
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
OG
id|XDR_MAX_NETOBJ
)paren
r_return
l_int|NULL
suffix:semicolon
id|obj-&gt;len
op_assign
id|len
suffix:semicolon
id|obj-&gt;data
op_assign
(paren
id|u8
op_star
)paren
id|p
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
id|len
)paren
suffix:semicolon
)brace
id|u32
op_star
DECL|function|xdr_encode_array
id|xdr_encode_array
c_func
(paren
id|u32
op_star
id|p
comma
r_const
r_char
op_star
id|array
comma
r_int
r_int
id|len
)paren
(brace
r_int
id|quadlen
op_assign
id|XDR_QUADLEN
c_func
(paren
id|len
)paren
suffix:semicolon
id|p
(braket
id|quadlen
)braket
op_assign
l_int|0
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|array
comma
id|len
)paren
suffix:semicolon
r_return
id|p
op_plus
id|quadlen
suffix:semicolon
)brace
id|u32
op_star
DECL|function|xdr_encode_string
id|xdr_encode_string
c_func
(paren
id|u32
op_star
id|p
comma
r_const
r_char
op_star
id|string
)paren
(brace
r_return
id|xdr_encode_array
c_func
(paren
id|p
comma
id|string
comma
id|strlen
c_func
(paren
id|string
)paren
)paren
suffix:semicolon
)brace
id|u32
op_star
DECL|function|xdr_decode_string
id|xdr_decode_string
c_func
(paren
id|u32
op_star
id|p
comma
r_char
op_star
op_star
id|sp
comma
r_int
op_star
id|lenp
comma
r_int
id|maxlen
)paren
(brace
r_int
r_int
id|len
suffix:semicolon
r_char
op_star
id|string
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
OG
id|maxlen
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|lenp
)paren
op_star
id|lenp
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_mod
l_int|4
)paren
op_ne
l_int|0
)paren
(brace
id|string
op_assign
(paren
r_char
op_star
)paren
id|p
suffix:semicolon
)brace
r_else
(brace
id|string
op_assign
(paren
r_char
op_star
)paren
(paren
id|p
op_minus
l_int|1
)paren
suffix:semicolon
id|memmove
c_func
(paren
id|string
comma
id|p
comma
id|len
)paren
suffix:semicolon
)brace
id|string
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
op_star
id|sp
op_assign
id|string
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
id|len
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Realign the iovec if the server missed out some reply elements&n; * (such as post-op attributes,...)&n; * Note: This is a simple implementation that assumes that&n; *            len &lt;= iov-&gt;iov_len !!!&n; *       The RPC header (assumed to be the 1st element in the iov array)&n; *            is not shifted.&n; */
DECL|function|xdr_shift_iovec
r_void
id|xdr_shift_iovec
c_func
(paren
r_struct
id|iovec
op_star
id|iov
comma
r_int
id|nr
comma
r_int
id|len
)paren
(brace
r_struct
id|iovec
op_star
id|pvec
suffix:semicolon
r_for
c_loop
(paren
id|pvec
op_assign
id|iov
op_plus
id|nr
op_minus
l_int|1
suffix:semicolon
id|nr
OG
l_int|1
suffix:semicolon
id|nr
op_decrement
comma
id|pvec
op_decrement
)paren
(brace
r_struct
id|iovec
op_star
id|svec
op_assign
id|pvec
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|pvec-&gt;iov_len
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;RPC: Urk! Large shift of short iovec.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memmove
c_func
(paren
(paren
r_char
op_star
)paren
id|pvec-&gt;iov_base
op_plus
id|len
comma
id|pvec-&gt;iov_base
comma
id|pvec-&gt;iov_len
op_minus
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|svec-&gt;iov_len
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;RPC: Urk! Large shift of short iovec.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|pvec-&gt;iov_base
comma
(paren
r_char
op_star
)paren
id|svec-&gt;iov_base
op_plus
id|svec-&gt;iov_len
op_minus
id|len
comma
id|len
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Zero the last n bytes in an iovec array of &squot;nr&squot; elements&n; */
DECL|function|xdr_zero_iovec
r_void
id|xdr_zero_iovec
c_func
(paren
r_struct
id|iovec
op_star
id|iov
comma
r_int
id|nr
comma
r_int
id|n
)paren
(brace
r_struct
id|iovec
op_star
id|pvec
suffix:semicolon
r_for
c_loop
(paren
id|pvec
op_assign
id|iov
op_plus
id|nr
op_minus
l_int|1
suffix:semicolon
id|n
op_logical_and
id|nr
OG
l_int|0
suffix:semicolon
id|nr
op_decrement
comma
id|pvec
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|n
OL
id|pvec-&gt;iov_len
)paren
(brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|pvec-&gt;iov_base
op_plus
id|pvec-&gt;iov_len
op_minus
id|n
comma
l_int|0
comma
id|n
)paren
suffix:semicolon
id|n
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|memset
c_func
(paren
id|pvec-&gt;iov_base
comma
l_int|0
comma
id|pvec-&gt;iov_len
)paren
suffix:semicolon
id|n
op_sub_assign
id|pvec-&gt;iov_len
suffix:semicolon
)brace
)brace
)brace
eof
