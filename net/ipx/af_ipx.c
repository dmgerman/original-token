multiline_comment|/*&n; *&t;Implements an IPX socket layer (badly - but I&squot;m working on it).&n; *&n; *&t;This code is derived from work by&n; *&t;&t;Ross Biro&t;: &t;Writing the original IP stack&n; *&t;&t;Fred Van Kempen :&t;Tidying up the TCP/IP&n; *&n; *&t;Many thanks go to Keith Baker, Institute For Industrial Information&n; *&t;Technology Ltd, Swansea University for allowing me to work on this&n; *&t;in my own time even though it was in some ways related to commercial&n; *&t;work I am currently employed to do there.&n; *&n; *&t;All the material in this file is subject to the Gnu license version 2.&n; *&t;Neither Alan Cox nor the Swansea University Computer Society admit liability&n; *&t;nor provide warranty for any of this software. This material is provided &n; *&t;as is and at no charge.&t;&t;&n; *&n; *&t;Revision 0.21:&t;Uses the new generic socket option code.&n; *&t;Revision 0.22:&t;Gcc clean ups and drop out device registration. Use the&n; *&t;&t;&t;new multi-protocol edition of hard_header &n; *&t;Revision 0.23:  IPX /proc by Mark Evans.&n; *     &t;&t;&t;Adding a route will overwrite any existing route to the same&n; *&t;&t;&t;network.&n; *&t;Revision 0.24:&t;Supports new /proc with no 4K limit&n; *&t;Revision 0.25:&t;Add ephemeral sockets, passive local network &n; *&t;&t;&t;identification, support for local net 0 and&n; *&t;&t;&t;multiple datalinks &lt;Greg Page&gt;&n; *&t;Revision 0.26:  Device drop kills IPX routes via it. (needed for modules)&n; *&t;Revision 0.27:  Autobind &lt;Mark Evans&gt;&n; *&t;Revision 0.28:  Small fix for multiple local networks &lt;Thomas Winder&gt;&n; *&t;Revision 0.29:  Assorted major errors removed &lt;Mark Evans&gt;&n; *&t;&t;&t;Small correction to promisc mode error fix &lt;Alan Cox&gt;&n; *&t;&t;&t;Asynchronous I/O support.&n; *&t;&t;&t;Changed to use notifiers and the newer packet_type stuff.&n; *&t;&t;&t;Assorted major fixes &lt;Alejandro Liu&gt;&n; *&t;Revision 0.30:&t;Moved to net/ipx/...&t;&lt;Alan Cox&gt;&n; *&t;&t;&t;Don&squot;t set address length on recvfrom that errors.&n; *&t;&t;&t;Incorrect verify_area.&n; *&t;Revision 0.31:&t;New sk_buffs. This still needs a lot of testing. &lt;Alan Cox&gt;&n; *&n; *&t;TODO:&t;use sock_alloc_send_skb to allocate sending buffers. Check with Caldera first&n; *&n; * &t;Portions Copyright (c) 1995 Caldera, Inc. &lt;greg@caldera.com&gt;&n; *&t;Neither Greg Page nor Caldera, Inc. admit liability nor provide &n; *&t;warranty for any of this software. This material is provided &n; *&t;&quot;AS-IS&quot; and at no charge.&t;&t;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/ipx.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/termios.h&gt;&t;/* For TIOCOUTQ/INQ */
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;net/p8022.h&gt;
macro_line|#include &lt;net/psnap.h&gt;
macro_line|#ifdef CONFIG_IPX
multiline_comment|/* Configuration Variables */
DECL|variable|ipxcfg_max_hops
r_static
r_int
r_char
id|ipxcfg_max_hops
op_assign
l_int|16
suffix:semicolon
DECL|variable|ipxcfg_auto_select_primary
r_static
r_char
id|ipxcfg_auto_select_primary
op_assign
l_int|0
suffix:semicolon
DECL|variable|ipxcfg_auto_create_interfaces
r_static
r_char
id|ipxcfg_auto_create_interfaces
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Global Variables */
DECL|variable|p8022_datalink
r_static
r_struct
id|datalink_proto
op_star
id|p8022_datalink
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|pEII_datalink
r_static
r_struct
id|datalink_proto
op_star
id|pEII_datalink
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|p8023_datalink
r_static
r_struct
id|datalink_proto
op_star
id|p8023_datalink
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|pSNAP_datalink
r_static
r_struct
id|datalink_proto
op_star
id|pSNAP_datalink
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|ipx_interfaces
r_static
id|ipx_interface
op_star
id|ipx_interfaces
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|ipx_routes
r_static
id|ipx_route
op_star
id|ipx_routes
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|ipx_internal_net
r_static
id|ipx_interface
op_star
id|ipx_internal_net
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|ipx_primary_net
r_static
id|ipx_interface
op_star
id|ipx_primary_net
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
DECL|function|ipxcfg_set_auto_create
id|ipxcfg_set_auto_create
c_func
(paren
r_char
id|val
)paren
(brace
id|ipxcfg_auto_create_interfaces
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxcfg_set_auto_select
id|ipxcfg_set_auto_select
c_func
(paren
r_char
id|val
)paren
(brace
id|ipxcfg_auto_select_primary
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|val
op_logical_and
(paren
id|ipx_primary_net
op_eq
l_int|NULL
)paren
)paren
id|ipx_primary_net
op_assign
id|ipx_interfaces
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxcfg_get_config_data
id|ipxcfg_get_config_data
c_func
(paren
id|ipx_config_data
op_star
id|arg
)paren
(brace
id|ipx_config_data
id|vals
suffix:semicolon
id|vals.ipxcfg_auto_create_interfaces
op_assign
id|ipxcfg_auto_create_interfaces
suffix:semicolon
id|vals.ipxcfg_auto_select_primary
op_assign
id|ipxcfg_auto_select_primary
suffix:semicolon
id|memcpy_tofs
c_func
(paren
id|arg
comma
op_amp
id|vals
comma
r_sizeof
(paren
id|vals
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/***********************************************************************************************************************&bslash;&n;*&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;*&n;*&t;&t;&t;&t;&t;&t;Handlers for the socket list.&t;&t;&t;&t;&t;&t;*&n;*&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;*&n;&bslash;***********************************************************************************************************************/
multiline_comment|/*&n; *&t;Note: Sockets may not be removed _during_ an interrupt or inet_bh&n; *&t;handler using this technique. They can be added although we do not&n; *&t;use this facility.&n; */
r_static
r_void
DECL|function|ipx_remove_socket
id|ipx_remove_socket
c_func
(paren
id|ipx_socket
op_star
id|sk
)paren
(brace
id|ipx_socket
op_star
id|s
suffix:semicolon
id|ipx_interface
op_star
id|intrfc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Determine interface with which socket is associated */
id|intrfc
op_assign
id|sk-&gt;ipx_intrfc
suffix:semicolon
r_if
c_cond
(paren
id|intrfc
op_eq
l_int|NULL
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|s
op_assign
id|intrfc-&gt;if_sklist
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
id|sk
)paren
(brace
id|intrfc-&gt;if_sklist
op_assign
id|s-&gt;next
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|s
op_logical_and
id|s-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;next
op_eq
id|sk
)paren
(brace
id|s-&gt;next
op_assign
id|sk-&gt;next
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|s
op_assign
id|s-&gt;next
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This is only called from user mode. Thus it protects itself against&n; *&t;interrupt users but doesn&squot;t worry about being called during work.&n; *&t;Once it is removed from the queue no interrupt or bottom half will&n; *&t;touch it and we are (fairly 8-) ) safe.&n; */
r_static
r_void
DECL|function|ipx_destroy_socket
id|ipx_destroy_socket
c_func
(paren
id|ipx_socket
op_star
id|sk
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|ipx_remove_socket
c_func
(paren
id|sk
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
)brace
id|kfree_s
c_func
(paren
id|sk
comma
r_sizeof
(paren
op_star
id|sk
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* The following code is used to support IPX Interfaces (IPXITF).  An&n; * IPX interface is defined by a physical device and a frame type.&n; */
r_static
id|ipx_route
op_star
id|ipxrtr_lookup
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
r_void
DECL|function|ipxitf_clear_primary_net
id|ipxitf_clear_primary_net
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|ipxcfg_auto_select_primary
op_logical_and
(paren
id|ipx_interfaces
op_ne
l_int|NULL
)paren
)paren
id|ipx_primary_net
op_assign
id|ipx_interfaces
suffix:semicolon
r_else
id|ipx_primary_net
op_assign
l_int|NULL
suffix:semicolon
)brace
r_static
id|ipx_interface
op_star
DECL|function|ipxitf_find_using_phys
id|ipxitf_find_using_phys
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|datalink
)paren
(brace
id|ipx_interface
op_star
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ipx_interfaces
suffix:semicolon
id|i
op_logical_and
(paren
(paren
id|i-&gt;if_dev
op_ne
id|dev
)paren
op_logical_or
(paren
id|i-&gt;if_dlink_type
op_ne
id|datalink
)paren
)paren
suffix:semicolon
id|i
op_assign
id|i-&gt;if_next
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_static
id|ipx_interface
op_star
DECL|function|ipxitf_find_using_net
id|ipxitf_find_using_net
c_func
(paren
r_int
r_int
id|net
)paren
(brace
id|ipx_interface
op_star
id|i
suffix:semicolon
r_if
c_cond
(paren
id|net
op_eq
l_int|0L
)paren
r_return
id|ipx_primary_net
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ipx_interfaces
suffix:semicolon
id|i
op_logical_and
(paren
id|i-&gt;if_netnum
op_ne
id|net
)paren
suffix:semicolon
id|i
op_assign
id|i-&gt;if_next
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/* Sockets are bound to a particular IPX interface. */
r_static
r_void
DECL|function|ipxitf_insert_socket
id|ipxitf_insert_socket
c_func
(paren
id|ipx_interface
op_star
id|intrfc
comma
id|ipx_socket
op_star
id|sk
)paren
(brace
id|ipx_socket
op_star
id|s
suffix:semicolon
id|sk-&gt;ipx_intrfc
op_assign
id|intrfc
suffix:semicolon
id|sk-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|intrfc-&gt;if_sklist
op_eq
l_int|NULL
)paren
(brace
id|intrfc-&gt;if_sklist
op_assign
id|sk
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|s
op_assign
id|intrfc-&gt;if_sklist
suffix:semicolon
id|s-&gt;next
op_ne
l_int|NULL
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
suffix:semicolon
id|s-&gt;next
op_assign
id|sk
suffix:semicolon
)brace
)brace
r_static
id|ipx_socket
op_star
DECL|function|ipxitf_find_socket
id|ipxitf_find_socket
c_func
(paren
id|ipx_interface
op_star
id|intrfc
comma
r_int
r_int
id|port
)paren
(brace
id|ipx_socket
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
id|intrfc-&gt;if_sklist
suffix:semicolon
(paren
id|s
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|s-&gt;ipx_port
op_ne
id|port
)paren
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
suffix:semicolon
r_return
id|s
suffix:semicolon
)brace
r_static
r_void
id|ipxrtr_del_routes
c_func
(paren
id|ipx_interface
op_star
)paren
suffix:semicolon
r_static
r_void
DECL|function|ipxitf_down
id|ipxitf_down
c_func
(paren
id|ipx_interface
op_star
id|intrfc
)paren
(brace
id|ipx_interface
op_star
id|i
suffix:semicolon
id|ipx_socket
op_star
id|s
comma
op_star
id|t
suffix:semicolon
multiline_comment|/* Delete all routes associated with this interface */
id|ipxrtr_del_routes
c_func
(paren
id|intrfc
)paren
suffix:semicolon
multiline_comment|/* error sockets */
r_for
c_loop
(paren
id|s
op_assign
id|intrfc-&gt;if_sklist
suffix:semicolon
id|s
op_ne
l_int|NULL
suffix:semicolon
)paren
(brace
id|s-&gt;err
op_assign
id|ENOLINK
suffix:semicolon
id|s
op_member_access_from_pointer
id|error_report
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;ipx_intrfc
op_assign
l_int|NULL
suffix:semicolon
id|s-&gt;ipx_port
op_assign
l_int|0
suffix:semicolon
id|s-&gt;zapped
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Indicates it is no longer bound */
id|t
op_assign
id|s
suffix:semicolon
id|s
op_assign
id|s-&gt;next
suffix:semicolon
id|t-&gt;next
op_assign
l_int|NULL
suffix:semicolon
)brace
id|intrfc-&gt;if_sklist
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* remove this interface from list */
r_if
c_cond
(paren
id|intrfc
op_eq
id|ipx_interfaces
)paren
(brace
id|ipx_interfaces
op_assign
id|intrfc-&gt;if_next
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
id|ipx_interfaces
suffix:semicolon
(paren
id|i
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|i-&gt;if_next
op_ne
id|intrfc
)paren
suffix:semicolon
id|i
op_assign
id|i-&gt;if_next
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|i-&gt;if_next
op_eq
id|intrfc
)paren
)paren
id|i-&gt;if_next
op_assign
id|intrfc-&gt;if_next
suffix:semicolon
)brace
multiline_comment|/* remove this interface from *special* networks */
r_if
c_cond
(paren
id|intrfc
op_eq
id|ipx_primary_net
)paren
id|ipxitf_clear_primary_net
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intrfc
op_eq
id|ipx_internal_net
)paren
id|ipx_internal_net
op_assign
l_int|NULL
suffix:semicolon
id|kfree_s
c_func
(paren
id|intrfc
comma
r_sizeof
(paren
op_star
id|intrfc
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxitf_device_event
id|ipxitf_device_event
c_func
(paren
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
id|ptr
suffix:semicolon
id|ipx_interface
op_star
id|i
comma
op_star
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|event
op_ne
id|NETDEV_DOWN
)paren
(brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|ipx_interfaces
suffix:semicolon
id|i
op_ne
l_int|NULL
suffix:semicolon
)paren
(brace
id|tmp
op_assign
id|i-&gt;if_next
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;if_dev
op_eq
id|dev
)paren
id|ipxitf_down
c_func
(paren
id|i
)paren
suffix:semicolon
id|i
op_assign
id|tmp
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxitf_def_skb_handler
id|ipxitf_def_skb_handler
c_func
(paren
r_struct
id|sock
op_star
id|sock
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|sock_queue_rcv_skb
c_func
(paren
id|sock
comma
id|skb
)paren
)paren
OL
l_int|0
)paren
(brace
multiline_comment|/*&n;&t; &t; *&t;We do a FREE_WRITE here because this indicates how&n;&t; &t; *&t;to treat the socket with which the packet is &n;&t; &t; *&t;associated.  If this packet is associated with a&n;&t; &t; *&t;socket at all, it must be the originator of the &n;&t; &t; *&t;packet.   Incoming packets will have no socket &n;&t;&t; *&t;associated with them at this point.&n;&t; &t; */
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxitf_demux_socket
id|ipxitf_demux_socket
c_func
(paren
id|ipx_interface
op_star
id|intrfc
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|copy
)paren
(brace
id|ipx_packet
op_star
id|ipx
op_assign
(paren
id|ipx_packet
op_star
)paren
(paren
id|skb-&gt;h.raw
)paren
suffix:semicolon
id|ipx_socket
op_star
id|sock1
op_assign
l_int|NULL
comma
op_star
id|sock2
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb1
op_assign
l_int|NULL
comma
op_star
id|skb2
op_assign
l_int|NULL
suffix:semicolon
id|sock1
op_assign
id|ipxitf_find_socket
c_func
(paren
id|intrfc
comma
id|ipx-&gt;ipx_dest.sock
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;We need to check if there is a primary net and if&n;&t; *&t;this is addressed to one of the *SPECIAL* sockets because&n;&t; *&t;these need to be propagated to the primary net.&n;&t; *&t;The *SPECIAL* socket list contains: 0x452(SAP), 0x453(RIP) and&n;&t; *&t;0x456(Diagnostic).&n;&t; */
r_if
c_cond
(paren
id|ipx_primary_net
op_logical_and
(paren
id|intrfc
op_ne
id|ipx_primary_net
)paren
)paren
(brace
r_switch
c_cond
(paren
id|ntohs
c_func
(paren
id|ipx-&gt;ipx_dest.sock
)paren
)paren
(brace
r_case
l_int|0x452
suffix:colon
r_case
l_int|0x453
suffix:colon
r_case
l_int|0x456
suffix:colon
multiline_comment|/*&n;&t;&t;&t; *&t;The appropriate thing to do here is to&n;&t;&t;&t; * &t;dup the packet and route to the primary net&n;&t;&t;&t; *&t;interface via ipxitf_send; however, we&squot;ll cheat&n;&t;&t;&t; *&t;and just demux it here.&n;&t;&t;&t; */
id|sock2
op_assign
id|ipxitf_find_socket
c_func
(paren
id|ipx_primary_net
comma
id|ipx-&gt;ipx_dest.sock
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* if there is nothing to do, return */
r_if
c_cond
(paren
(paren
id|sock1
op_eq
l_int|NULL
)paren
op_logical_and
(paren
id|sock2
op_eq
l_int|NULL
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|copy
)paren
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* This next segment of code is a little awkward, but it sets it up&n;&t; * so that the appropriate number of copies of the SKB are made and &n;&t; * that skb1 and skb2 point to it (them) so that it (they) can be &n;&t; * demuxed to sock1 and/or sock2.  If we are unable to make enough&n;&t; * copies, we do as much as is possible.&n;&t; */
r_if
c_cond
(paren
id|copy
)paren
(brace
id|skb1
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb1
op_ne
l_int|NULL
)paren
(brace
id|skb1-&gt;arp
op_assign
id|skb1-&gt;free
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
id|skb1
op_assign
id|skb
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb1
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* Do we need 2 SKBs? */
r_if
c_cond
(paren
id|sock1
op_logical_and
id|sock2
)paren
(brace
id|skb2
op_assign
id|skb_clone
c_func
(paren
id|skb1
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
op_ne
l_int|NULL
)paren
(brace
id|skb2-&gt;arp
op_assign
id|skb2-&gt;free
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
id|skb2
op_assign
id|skb1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sock1
)paren
(brace
(paren
r_void
)paren
id|ipxitf_def_skb_handler
c_func
(paren
id|sock1
comma
id|skb1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb2
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|sock2
)paren
(brace
(paren
r_void
)paren
id|ipxitf_def_skb_handler
c_func
(paren
id|sock2
comma
id|skb2
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|sk_buff
op_star
DECL|function|ipxitf_adjust_skbuff
id|ipxitf_adjust_skbuff
c_func
(paren
id|ipx_interface
op_star
id|intrfc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
r_int
id|in_offset
op_assign
id|skb-&gt;h.raw
op_minus
id|skb-&gt;head
suffix:semicolon
r_int
id|out_offset
op_assign
id|intrfc-&gt;if_ipx_offset
suffix:semicolon
macro_line|#if 0
r_char
op_star
id|oldraw
suffix:semicolon
macro_line|#endif&t;
r_int
id|len
suffix:semicolon
multiline_comment|/* Hopefully, most cases */
r_if
c_cond
(paren
id|in_offset
op_ge
id|out_offset
)paren
(brace
multiline_comment|/*&t;&t;skb_push(skb,out_offset);*/
id|skb-&gt;arp
op_assign
id|skb-&gt;free
op_assign
l_int|1
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* Existing SKB will work, just need to move things around a little */
r_if
c_cond
(paren
id|in_offset
OG
id|out_offset
)paren
(brace
id|oldraw
op_assign
id|skb-&gt;h.raw
suffix:semicolon
id|skb-&gt;h.raw
op_assign
op_amp
(paren
id|skb-&gt;data
(braket
id|out_offset
)braket
)paren
suffix:semicolon
id|memmove
c_func
(paren
id|skb-&gt;h.raw
comma
id|oldraw
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|skb-&gt;len
op_add_assign
id|out_offset
suffix:semicolon
id|skb-&gt;arp
op_assign
id|skb-&gt;free
op_assign
l_int|1
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
macro_line|#endif&t;
multiline_comment|/* Need new SKB */
id|len
op_assign
id|skb-&gt;len
op_plus
id|out_offset
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
op_ne
l_int|NULL
)paren
(brace
id|skb_reserve
c_func
(paren
id|skb2
comma
id|out_offset
)paren
suffix:semicolon
id|skb2-&gt;h.raw
op_assign
id|skb_put
c_func
(paren
id|skb2
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|skb2-&gt;free
op_assign
l_int|1
suffix:semicolon
id|skb2-&gt;arp
op_assign
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|skb2-&gt;h.raw
comma
id|skb-&gt;h.raw
comma
id|skb-&gt;len
)paren
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
r_return
id|skb2
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxitf_send
id|ipxitf_send
c_func
(paren
id|ipx_interface
op_star
id|intrfc
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|node
)paren
(brace
id|ipx_packet
op_star
id|ipx
op_assign
(paren
id|ipx_packet
op_star
)paren
(paren
id|skb-&gt;h.raw
)paren
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
id|intrfc-&gt;if_dev
suffix:semicolon
r_struct
id|datalink_proto
op_star
id|dl
op_assign
id|intrfc-&gt;if_dlink
suffix:semicolon
r_char
id|dest_node
(braket
id|IPX_NODE_LEN
)braket
suffix:semicolon
r_int
id|send_to_wire
op_assign
l_int|1
suffix:semicolon
r_int
id|addr_len
suffix:semicolon
multiline_comment|/* We need to know how many skbuffs it will take to send out this&n;&t; * packet to avoid unnecessary copies.&n;&t; */
r_if
c_cond
(paren
(paren
id|dl
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|dev
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
)paren
id|send_to_wire
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* See if this should be demuxed to sockets on this interface */
r_if
c_cond
(paren
id|ipx-&gt;ipx_dest.net
op_eq
id|intrfc-&gt;if_netnum
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|intrfc-&gt;if_node
comma
id|node
comma
id|IPX_NODE_LEN
)paren
op_eq
l_int|0
)paren
r_return
id|ipxitf_demux_socket
c_func
(paren
id|intrfc
comma
id|skb
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|ipx_broadcast_node
comma
id|node
comma
id|IPX_NODE_LEN
)paren
op_eq
l_int|0
)paren
(brace
id|ipxitf_demux_socket
c_func
(paren
id|intrfc
comma
id|skb
comma
id|send_to_wire
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|send_to_wire
)paren
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* if the originating net is not equal to our net; this is routed */
r_if
c_cond
(paren
id|ipx-&gt;ipx_source.net
op_ne
id|intrfc-&gt;if_netnum
)paren
(brace
r_if
c_cond
(paren
op_increment
(paren
id|ipx-&gt;ipx_tctrl
)paren
OG
id|ipxcfg_max_hops
)paren
id|send_to_wire
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|send_to_wire
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;We do a FREE_WRITE here because this indicates how&n;&t;&t; *&t;to treat the socket with which the packet is &n;&t; &t; *&t;associated.  If this packet is associated with a&n;&t;&t; *&t;socket at all, it must be the originator of the &n;&t;&t; *&t;packet.   Routed packets will have no socket associated&n;&t;&t; *&t;with them.&n;&t;&t; */
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* determine the appropriate hardware address */
id|addr_len
op_assign
id|dev-&gt;addr_len
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|ipx_broadcast_node
comma
id|node
comma
id|IPX_NODE_LEN
)paren
op_eq
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
id|dest_node
comma
id|dev-&gt;broadcast
comma
id|addr_len
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|dest_node
comma
op_amp
(paren
id|node
(braket
id|IPX_NODE_LEN
op_minus
id|addr_len
)braket
)paren
comma
id|addr_len
)paren
suffix:semicolon
)brace
multiline_comment|/* make any compensation for differing physical/data link size */
id|skb
op_assign
id|ipxitf_adjust_skbuff
c_func
(paren
id|intrfc
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* set up data link and physical headers */
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|dl
op_member_access_from_pointer
id|datalink_header
c_func
(paren
id|dl
comma
id|skb
comma
id|dest_node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;sk
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* This is an outbound packet from this host.  We need to &n;&t;&t; * increment the write count.&n;&t;&t; */
id|skb-&gt;sk-&gt;wmem_alloc
op_add_assign
id|skb-&gt;truesize
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* Now log the packet just before transmission */
id|dump_pkt
c_func
(paren
l_string|&quot;IPX snd:&quot;
comma
(paren
id|ipx_packet
op_star
)paren
id|skb-&gt;h.raw
)paren
suffix:semicolon
id|dump_data
c_func
(paren
l_string|&quot;ETH hdr:&quot;
comma
id|skb-&gt;data
comma
id|skb-&gt;h.raw
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Send it out */
id|dev_queue_xmit
c_func
(paren
id|skb
comma
id|dev
comma
id|SOPRI_NORMAL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|ipxrtr_add_route
c_func
(paren
r_int
r_int
comma
id|ipx_interface
op_star
comma
r_int
r_char
op_star
)paren
suffix:semicolon
r_static
r_int
DECL|function|ipxitf_add_local_route
id|ipxitf_add_local_route
c_func
(paren
id|ipx_interface
op_star
id|intrfc
)paren
(brace
r_return
id|ipxrtr_add_route
c_func
(paren
id|intrfc-&gt;if_netnum
comma
id|intrfc
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_const
r_char
op_star
id|ipx_frame_name
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
r_const
r_char
op_star
id|ipx_device_name
c_func
(paren
id|ipx_interface
op_star
)paren
suffix:semicolon
r_static
r_int
id|ipxrtr_route_skb
c_func
(paren
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
r_static
r_int
DECL|function|ipxitf_rcv
id|ipxitf_rcv
c_func
(paren
id|ipx_interface
op_star
id|intrfc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|ipx_packet
op_star
id|ipx
op_assign
(paren
id|ipx_packet
op_star
)paren
(paren
id|skb-&gt;h.raw
)paren
suffix:semicolon
id|ipx_interface
op_star
id|i
suffix:semicolon
multiline_comment|/* See if we should update our network number */
r_if
c_cond
(paren
(paren
id|intrfc-&gt;if_netnum
op_eq
l_int|0L
)paren
op_logical_and
(paren
id|ipx-&gt;ipx_source.net
op_eq
id|ipx-&gt;ipx_dest.net
)paren
op_logical_and
(paren
id|ipx-&gt;ipx_source.net
op_ne
l_int|0L
)paren
)paren
(brace
multiline_comment|/* NB: NetWare servers lie about their hop count so we&n;&t;&t; * dropped the test based on it.  This is the best way&n;&t;&t; * to determine this is a 0 hop count packet.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|i
op_assign
id|ipxitf_find_using_net
c_func
(paren
id|ipx-&gt;ipx_source.net
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|intrfc-&gt;if_netnum
op_assign
id|ipx-&gt;ipx_source.net
suffix:semicolon
(paren
r_void
)paren
id|ipxitf_add_local_route
c_func
(paren
id|intrfc
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;IPX: Network number collision %lx&bslash;n&bslash;t%s %s and %s %s&bslash;n&quot;
comma
id|htonl
c_func
(paren
id|ipx-&gt;ipx_source.net
)paren
comma
id|ipx_device_name
c_func
(paren
id|i
)paren
comma
id|ipx_frame_name
c_func
(paren
id|i-&gt;if_dlink_type
)paren
comma
id|ipx_device_name
c_func
(paren
id|intrfc
)paren
comma
id|ipx_frame_name
c_func
(paren
id|intrfc-&gt;if_dlink_type
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ipx-&gt;ipx_dest.net
op_eq
l_int|0L
)paren
id|ipx-&gt;ipx_dest.net
op_assign
id|intrfc-&gt;if_netnum
suffix:semicolon
r_if
c_cond
(paren
id|ipx-&gt;ipx_source.net
op_eq
l_int|0L
)paren
id|ipx-&gt;ipx_source.net
op_assign
id|intrfc-&gt;if_netnum
suffix:semicolon
r_if
c_cond
(paren
id|intrfc-&gt;if_netnum
op_ne
id|ipx-&gt;ipx_dest.net
)paren
(brace
multiline_comment|/* We only route point-to-point packets. */
r_if
c_cond
(paren
(paren
id|skb-&gt;pkt_type
op_ne
id|PACKET_BROADCAST
)paren
op_logical_and
(paren
id|skb-&gt;pkt_type
op_ne
id|PACKET_MULTICAST
)paren
)paren
r_return
id|ipxrtr_route_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* see if we should keep it */
r_if
c_cond
(paren
(paren
id|memcmp
c_func
(paren
id|ipx_broadcast_node
comma
id|ipx-&gt;ipx_dest.node
comma
id|IPX_NODE_LEN
)paren
op_eq
l_int|0
)paren
op_logical_or
(paren
id|memcmp
c_func
(paren
id|intrfc-&gt;if_node
comma
id|ipx-&gt;ipx_dest.node
comma
id|IPX_NODE_LEN
)paren
op_eq
l_int|0
)paren
)paren
(brace
r_return
id|ipxitf_demux_socket
c_func
(paren
id|intrfc
comma
id|skb
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* we couldn&squot;t pawn it off so unload it */
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|ipxitf_insert
id|ipxitf_insert
c_func
(paren
id|ipx_interface
op_star
id|intrfc
)paren
(brace
id|ipx_interface
op_star
id|i
suffix:semicolon
id|intrfc-&gt;if_next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|ipx_interfaces
op_eq
l_int|NULL
)paren
(brace
id|ipx_interfaces
op_assign
id|intrfc
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
id|ipx_interfaces
suffix:semicolon
id|i-&gt;if_next
op_ne
l_int|NULL
suffix:semicolon
id|i
op_assign
id|i-&gt;if_next
)paren
suffix:semicolon
id|i-&gt;if_next
op_assign
id|intrfc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipxcfg_auto_select_primary
op_logical_and
(paren
id|ipx_primary_net
op_eq
l_int|NULL
)paren
)paren
id|ipx_primary_net
op_assign
id|intrfc
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxitf_create_internal
id|ipxitf_create_internal
c_func
(paren
id|ipx_interface_definition
op_star
id|idef
)paren
(brace
id|ipx_interface
op_star
id|intrfc
suffix:semicolon
multiline_comment|/* Only one primary network allowed */
r_if
c_cond
(paren
id|ipx_primary_net
op_ne
l_int|NULL
)paren
r_return
op_minus
id|EEXIST
suffix:semicolon
multiline_comment|/* Must have a valid network number */
r_if
c_cond
(paren
id|idef-&gt;ipx_network
op_eq
l_int|0L
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_if
c_cond
(paren
id|ipxitf_find_using_net
c_func
(paren
id|idef-&gt;ipx_network
)paren
op_ne
l_int|NULL
)paren
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
id|intrfc
op_assign
(paren
id|ipx_interface
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|ipx_interface
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intrfc
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|intrfc-&gt;if_dev
op_assign
l_int|NULL
suffix:semicolon
id|intrfc-&gt;if_netnum
op_assign
id|idef-&gt;ipx_network
suffix:semicolon
id|intrfc-&gt;if_dlink_type
op_assign
l_int|0
suffix:semicolon
id|intrfc-&gt;if_dlink
op_assign
l_int|NULL
suffix:semicolon
id|intrfc-&gt;if_sklist
op_assign
l_int|NULL
suffix:semicolon
id|intrfc-&gt;if_internal
op_assign
l_int|1
suffix:semicolon
id|intrfc-&gt;if_ipx_offset
op_assign
l_int|0
suffix:semicolon
id|intrfc-&gt;if_sknum
op_assign
id|IPX_MIN_EPHEMERAL_SOCKET
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|intrfc-&gt;if_node
)paren
comma
id|idef-&gt;ipx_node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|ipx_internal_net
op_assign
id|intrfc
suffix:semicolon
id|ipx_primary_net
op_assign
id|intrfc
suffix:semicolon
id|ipxitf_insert
c_func
(paren
id|intrfc
)paren
suffix:semicolon
r_return
id|ipxitf_add_local_route
c_func
(paren
id|intrfc
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipx_map_frame_type
id|ipx_map_frame_type
c_func
(paren
r_int
r_char
id|type
)paren
(brace
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|IPX_FRAME_ETHERII
suffix:colon
r_return
id|htons
c_func
(paren
id|ETH_P_IPX
)paren
suffix:semicolon
r_case
id|IPX_FRAME_8022
suffix:colon
r_return
id|htons
c_func
(paren
id|ETH_P_802_2
)paren
suffix:semicolon
r_case
id|IPX_FRAME_SNAP
suffix:colon
r_return
id|htons
c_func
(paren
id|ETH_P_SNAP
)paren
suffix:semicolon
r_case
id|IPX_FRAME_8023
suffix:colon
r_return
id|htons
c_func
(paren
id|ETH_P_802_3
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxitf_create
id|ipxitf_create
c_func
(paren
id|ipx_interface_definition
op_star
id|idef
)paren
(brace
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_int
r_int
id|dlink_type
op_assign
l_int|0
suffix:semicolon
r_struct
id|datalink_proto
op_star
id|datalink
op_assign
l_int|NULL
suffix:semicolon
id|ipx_interface
op_star
id|intrfc
suffix:semicolon
r_if
c_cond
(paren
id|idef-&gt;ipx_special
op_eq
id|IPX_INTERNAL
)paren
r_return
id|ipxitf_create_internal
c_func
(paren
id|idef
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|idef-&gt;ipx_special
op_eq
id|IPX_PRIMARY
)paren
op_logical_and
(paren
id|ipx_primary_net
op_ne
l_int|NULL
)paren
)paren
r_return
op_minus
id|EEXIST
suffix:semicolon
r_if
c_cond
(paren
(paren
id|idef-&gt;ipx_network
op_ne
l_int|0L
)paren
op_logical_and
(paren
id|ipxitf_find_using_net
c_func
(paren
id|idef-&gt;ipx_network
)paren
op_ne
l_int|NULL
)paren
)paren
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
r_switch
c_cond
(paren
id|idef-&gt;ipx_dlink_type
)paren
(brace
r_case
id|IPX_FRAME_ETHERII
suffix:colon
id|dlink_type
op_assign
id|htons
c_func
(paren
id|ETH_P_IPX
)paren
suffix:semicolon
id|datalink
op_assign
id|pEII_datalink
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPX_FRAME_8022
suffix:colon
id|dlink_type
op_assign
id|htons
c_func
(paren
id|ETH_P_802_2
)paren
suffix:semicolon
id|datalink
op_assign
id|p8022_datalink
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPX_FRAME_SNAP
suffix:colon
id|dlink_type
op_assign
id|htons
c_func
(paren
id|ETH_P_SNAP
)paren
suffix:semicolon
id|datalink
op_assign
id|pSNAP_datalink
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPX_FRAME_8023
suffix:colon
id|dlink_type
op_assign
id|htons
c_func
(paren
id|ETH_P_802_3
)paren
suffix:semicolon
id|datalink
op_assign
id|p8023_datalink
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPX_FRAME_NONE
suffix:colon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|datalink
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
id|dev
op_assign
id|dev_get
c_func
(paren
id|idef-&gt;ipx_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_return
op_minus
id|ENETDOWN
suffix:semicolon
multiline_comment|/* Check addresses are suitable */
r_if
c_cond
(paren
id|dev-&gt;addr_len
OG
id|IPX_NODE_LEN
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|intrfc
op_assign
id|ipxitf_find_using_phys
c_func
(paren
id|dev
comma
id|dlink_type
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* Ok now create */
id|intrfc
op_assign
(paren
id|ipx_interface
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|ipx_interface
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intrfc
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|intrfc-&gt;if_dev
op_assign
id|dev
suffix:semicolon
id|intrfc-&gt;if_netnum
op_assign
id|idef-&gt;ipx_network
suffix:semicolon
id|intrfc-&gt;if_dlink_type
op_assign
id|dlink_type
suffix:semicolon
id|intrfc-&gt;if_dlink
op_assign
id|datalink
suffix:semicolon
id|intrfc-&gt;if_sklist
op_assign
l_int|NULL
suffix:semicolon
id|intrfc-&gt;if_sknum
op_assign
id|IPX_MIN_EPHEMERAL_SOCKET
suffix:semicolon
multiline_comment|/* Setup primary if necessary */
r_if
c_cond
(paren
(paren
id|idef-&gt;ipx_special
op_eq
id|IPX_PRIMARY
)paren
)paren
id|ipx_primary_net
op_assign
id|intrfc
suffix:semicolon
id|intrfc-&gt;if_internal
op_assign
l_int|0
suffix:semicolon
id|intrfc-&gt;if_ipx_offset
op_assign
id|dev-&gt;hard_header_len
op_plus
id|datalink-&gt;header_length
suffix:semicolon
id|memset
c_func
(paren
id|intrfc-&gt;if_node
comma
l_int|0
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|intrfc-&gt;if_node
(braket
id|IPX_NODE_LEN
op_minus
id|dev-&gt;addr_len
)braket
)paren
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|ipxitf_insert
c_func
(paren
id|intrfc
)paren
suffix:semicolon
)brace
multiline_comment|/* If the network number is known, add a route */
r_if
c_cond
(paren
id|intrfc-&gt;if_netnum
op_eq
l_int|0L
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|ipxitf_add_local_route
c_func
(paren
id|intrfc
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxitf_delete
id|ipxitf_delete
c_func
(paren
id|ipx_interface_definition
op_star
id|idef
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|dlink_type
op_assign
l_int|0
suffix:semicolon
id|ipx_interface
op_star
id|intrfc
suffix:semicolon
r_if
c_cond
(paren
id|idef-&gt;ipx_special
op_eq
id|IPX_INTERNAL
)paren
(brace
r_if
c_cond
(paren
id|ipx_internal_net
op_ne
l_int|NULL
)paren
(brace
id|ipxitf_down
c_func
(paren
id|ipx_internal_net
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|dlink_type
op_assign
id|ipx_map_frame_type
c_func
(paren
id|idef-&gt;ipx_dlink_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dlink_type
op_eq
l_int|0
)paren
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
id|dev
op_assign
id|dev_get
c_func
(paren
id|idef-&gt;ipx_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|intrfc
op_assign
id|ipxitf_find_using_phys
c_func
(paren
id|dev
comma
id|dlink_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intrfc
op_ne
l_int|NULL
)paren
(brace
id|ipxitf_down
c_func
(paren
id|intrfc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
id|ipx_interface
op_star
DECL|function|ipxitf_auto_create
id|ipxitf_auto_create
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|dlink_type
)paren
(brace
r_struct
id|datalink_proto
op_star
id|datalink
op_assign
l_int|NULL
suffix:semicolon
id|ipx_interface
op_star
id|intrfc
suffix:semicolon
r_switch
c_cond
(paren
id|htons
c_func
(paren
id|dlink_type
)paren
)paren
(brace
r_case
id|ETH_P_IPX
suffix:colon
id|datalink
op_assign
id|pEII_datalink
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ETH_P_802_2
suffix:colon
id|datalink
op_assign
id|p8022_datalink
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ETH_P_SNAP
suffix:colon
id|datalink
op_assign
id|pSNAP_datalink
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ETH_P_802_3
suffix:colon
id|datalink
op_assign
id|p8023_datalink
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* Check addresses are suitable */
r_if
c_cond
(paren
id|dev-&gt;addr_len
OG
id|IPX_NODE_LEN
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|intrfc
op_assign
(paren
id|ipx_interface
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|ipx_interface
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intrfc
op_ne
l_int|NULL
)paren
(brace
id|intrfc-&gt;if_dev
op_assign
id|dev
suffix:semicolon
id|intrfc-&gt;if_netnum
op_assign
l_int|0L
suffix:semicolon
id|intrfc-&gt;if_dlink_type
op_assign
id|dlink_type
suffix:semicolon
id|intrfc-&gt;if_dlink
op_assign
id|datalink
suffix:semicolon
id|intrfc-&gt;if_sklist
op_assign
l_int|NULL
suffix:semicolon
id|intrfc-&gt;if_internal
op_assign
l_int|0
suffix:semicolon
id|intrfc-&gt;if_sknum
op_assign
id|IPX_MIN_EPHEMERAL_SOCKET
suffix:semicolon
id|intrfc-&gt;if_ipx_offset
op_assign
id|dev-&gt;hard_header_len
op_plus
id|datalink-&gt;header_length
suffix:semicolon
id|memset
c_func
(paren
id|intrfc-&gt;if_node
comma
l_int|0
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|intrfc-&gt;if_node
(braket
id|IPX_NODE_LEN
op_minus
id|dev-&gt;addr_len
)braket
)paren
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|ipxitf_insert
c_func
(paren
id|intrfc
)paren
suffix:semicolon
)brace
r_return
id|intrfc
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxitf_ioctl
id|ipxitf_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|err
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCSIFADDR
suffix:colon
(brace
r_struct
id|ifreq
id|ifr
suffix:semicolon
r_struct
id|sockaddr_ipx
op_star
id|sipx
suffix:semicolon
id|ipx_interface_definition
id|f
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|arg
comma
r_sizeof
(paren
id|ifr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|memcpy_fromfs
c_func
(paren
op_amp
id|ifr
comma
id|arg
comma
r_sizeof
(paren
id|ifr
)paren
)paren
suffix:semicolon
id|sipx
op_assign
(paren
r_struct
id|sockaddr_ipx
op_star
)paren
op_amp
id|ifr.ifr_addr
suffix:semicolon
r_if
c_cond
(paren
id|sipx-&gt;sipx_family
op_ne
id|AF_IPX
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|f.ipx_network
op_assign
id|sipx-&gt;sipx_network
suffix:semicolon
id|memcpy
c_func
(paren
id|f.ipx_device
comma
id|ifr.ifr_name
comma
r_sizeof
(paren
id|f.ipx_device
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|f.ipx_node
comma
id|sipx-&gt;sipx_node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|f.ipx_dlink_type
op_assign
id|sipx-&gt;sipx_type
suffix:semicolon
id|f.ipx_special
op_assign
id|sipx-&gt;sipx_special
suffix:semicolon
r_if
c_cond
(paren
id|sipx-&gt;sipx_action
op_eq
id|IPX_DLTITF
)paren
(brace
r_return
id|ipxitf_delete
c_func
(paren
op_amp
id|f
)paren
suffix:semicolon
)brace
r_else
r_return
id|ipxitf_create
c_func
(paren
op_amp
id|f
)paren
suffix:semicolon
)brace
r_case
id|SIOCGIFADDR
suffix:colon
(brace
r_struct
id|ifreq
id|ifr
suffix:semicolon
r_struct
id|sockaddr_ipx
op_star
id|sipx
suffix:semicolon
id|ipx_interface
op_star
id|ipxif
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|arg
comma
r_sizeof
(paren
id|ifr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|memcpy_fromfs
c_func
(paren
op_amp
id|ifr
comma
id|arg
comma
r_sizeof
(paren
id|ifr
)paren
)paren
suffix:semicolon
id|sipx
op_assign
(paren
r_struct
id|sockaddr_ipx
op_star
)paren
op_amp
id|ifr.ifr_addr
suffix:semicolon
id|dev
op_assign
id|dev_get
c_func
(paren
id|ifr.ifr_name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ipxif
op_assign
id|ipxitf_find_using_phys
c_func
(paren
id|dev
comma
id|ipx_map_frame_type
c_func
(paren
id|sipx-&gt;sipx_type
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipxif
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
id|sipx-&gt;sipx_network
op_assign
id|ipxif-&gt;if_netnum
suffix:semicolon
id|memcpy
c_func
(paren
id|sipx-&gt;sipx_node
comma
id|ipxif-&gt;if_node
comma
r_sizeof
(paren
id|sipx-&gt;sipx_node
)paren
)paren
suffix:semicolon
id|memcpy_tofs
c_func
(paren
id|arg
comma
op_amp
id|ifr
comma
r_sizeof
(paren
id|ifr
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SIOCAIPXITFCRT
suffix:colon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|arg
comma
r_sizeof
(paren
r_char
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
r_return
id|ipxcfg_set_auto_create
c_func
(paren
id|get_fs_byte
c_func
(paren
id|arg
)paren
)paren
suffix:semicolon
r_case
id|SIOCAIPXPRISLT
suffix:colon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|arg
comma
r_sizeof
(paren
r_char
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
r_return
id|ipxcfg_set_auto_select
c_func
(paren
id|get_fs_byte
c_func
(paren
id|arg
)paren
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
multiline_comment|/*******************************************************************************************************************&bslash;&n;*&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;            *&n;*&t;            &t;&t;&t;Routing tables for the IPX socket layer&t;&t;&t;&t;            *&n;*&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;    *&n;&bslash;*******************************************************************************************************************/
r_static
id|ipx_route
op_star
DECL|function|ipxrtr_lookup
id|ipxrtr_lookup
c_func
(paren
r_int
r_int
id|net
)paren
(brace
id|ipx_route
op_star
id|r
suffix:semicolon
r_for
c_loop
(paren
id|r
op_assign
id|ipx_routes
suffix:semicolon
(paren
id|r
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|r-&gt;ir_net
op_ne
id|net
)paren
suffix:semicolon
id|r
op_assign
id|r-&gt;ir_next
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxrtr_add_route
id|ipxrtr_add_route
c_func
(paren
r_int
r_int
id|network
comma
id|ipx_interface
op_star
id|intrfc
comma
r_int
r_char
op_star
id|node
)paren
(brace
id|ipx_route
op_star
id|rt
suffix:semicolon
multiline_comment|/* Get a route structure; either existing or create */
id|rt
op_assign
id|ipxrtr_lookup
c_func
(paren
id|network
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
id|rt
op_assign
(paren
id|ipx_route
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|ipx_route
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|rt-&gt;ir_next
op_assign
id|ipx_routes
suffix:semicolon
id|ipx_routes
op_assign
id|rt
suffix:semicolon
)brace
id|rt-&gt;ir_net
op_assign
id|network
suffix:semicolon
id|rt-&gt;ir_intrfc
op_assign
id|intrfc
suffix:semicolon
r_if
c_cond
(paren
id|node
op_eq
l_int|NULL
)paren
(brace
id|memset
c_func
(paren
id|rt-&gt;ir_router_node
comma
l_char|&squot;&bslash;0&squot;
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|rt-&gt;ir_routed
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|rt-&gt;ir_router_node
comma
id|node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|rt-&gt;ir_routed
op_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|ipxrtr_del_routes
id|ipxrtr_del_routes
c_func
(paren
id|ipx_interface
op_star
id|intrfc
)paren
(brace
id|ipx_route
op_star
op_star
id|r
comma
op_star
id|tmp
suffix:semicolon
r_for
c_loop
(paren
id|r
op_assign
op_amp
id|ipx_routes
suffix:semicolon
(paren
id|tmp
op_assign
op_star
id|r
)paren
op_ne
l_int|NULL
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|tmp-&gt;ir_intrfc
op_eq
id|intrfc
)paren
(brace
op_star
id|r
op_assign
id|tmp-&gt;ir_next
suffix:semicolon
id|kfree_s
c_func
(paren
id|tmp
comma
r_sizeof
(paren
id|ipx_route
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|r
op_assign
op_amp
(paren
id|tmp-&gt;ir_next
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
r_int
DECL|function|ipxrtr_create
id|ipxrtr_create
c_func
(paren
id|ipx_route_definition
op_star
id|rd
)paren
(brace
id|ipx_interface
op_star
id|intrfc
suffix:semicolon
multiline_comment|/* Find the appropriate interface */
id|intrfc
op_assign
id|ipxitf_find_using_net
c_func
(paren
id|rd-&gt;ipx_router_network
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intrfc
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
r_return
id|ipxrtr_add_route
c_func
(paren
id|rd-&gt;ipx_network
comma
id|intrfc
comma
id|rd-&gt;ipx_router_node
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxrtr_delete
id|ipxrtr_delete
c_func
(paren
r_int
id|net
)paren
(brace
id|ipx_route
op_star
op_star
id|r
suffix:semicolon
id|ipx_route
op_star
id|tmp
suffix:semicolon
r_for
c_loop
(paren
id|r
op_assign
op_amp
id|ipx_routes
suffix:semicolon
(paren
id|tmp
op_assign
op_star
id|r
)paren
op_ne
l_int|NULL
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|tmp-&gt;ir_net
op_eq
id|net
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp-&gt;ir_routed
)paren
)paren
(brace
multiline_comment|/* Directly connected; can&squot;t lose route */
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
op_star
id|r
op_assign
id|tmp-&gt;ir_next
suffix:semicolon
id|kfree_s
c_func
(paren
id|tmp
comma
r_sizeof
(paren
id|ipx_route
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|r
op_assign
op_amp
(paren
id|tmp-&gt;ir_next
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxrtr_route_packet
id|ipxrtr_route_packet
c_func
(paren
id|ipx_socket
op_star
id|sk
comma
r_struct
id|sockaddr_ipx
op_star
id|usipx
comma
r_const
r_void
op_star
id|ubuf
comma
r_int
id|len
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|ipx_interface
op_star
id|intrfc
suffix:semicolon
id|ipx_packet
op_star
id|ipx
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|ipx_offset
suffix:semicolon
id|ipx_route
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Find the appropriate interface on which to send packet */
r_if
c_cond
(paren
(paren
id|usipx-&gt;sipx_network
op_eq
l_int|0L
)paren
op_logical_and
(paren
id|ipx_primary_net
op_ne
l_int|NULL
)paren
)paren
(brace
id|usipx-&gt;sipx_network
op_assign
id|ipx_primary_net-&gt;if_netnum
suffix:semicolon
id|intrfc
op_assign
id|ipx_primary_net
suffix:semicolon
)brace
r_else
(brace
id|rt
op_assign
id|ipxrtr_lookup
c_func
(paren
id|usipx-&gt;sipx_network
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
)brace
id|intrfc
op_assign
id|rt-&gt;ir_intrfc
suffix:semicolon
)brace
id|ipx_offset
op_assign
id|intrfc-&gt;if_ipx_offset
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
id|ipx_packet
)paren
op_plus
id|len
suffix:semicolon
id|size
op_add_assign
id|ipx_offset
suffix:semicolon
r_if
c_cond
(paren
id|size
op_plus
id|sk-&gt;wmem_alloc
OG
id|sk-&gt;sndbuf
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|skb-&gt;sk
op_assign
id|sk
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|ipx_offset
)paren
suffix:semicolon
id|skb-&gt;free
op_assign
l_int|1
suffix:semicolon
id|skb-&gt;arp
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Fill in IPX header */
id|ipx
op_assign
(paren
id|ipx_packet
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|ipx_packet
)paren
)paren
suffix:semicolon
id|ipx-&gt;ipx_checksum
op_assign
l_int|0xFFFF
suffix:semicolon
id|ipx-&gt;ipx_pktsize
op_assign
id|htons
c_func
(paren
id|len
op_plus
r_sizeof
(paren
id|ipx_packet
)paren
)paren
suffix:semicolon
id|ipx-&gt;ipx_tctrl
op_assign
l_int|0
suffix:semicolon
id|ipx-&gt;ipx_type
op_assign
id|usipx-&gt;sipx_type
suffix:semicolon
id|skb-&gt;h.raw
op_assign
(paren
r_int
r_char
op_star
)paren
id|ipx
suffix:semicolon
id|ipx-&gt;ipx_source.net
op_assign
id|sk-&gt;ipx_intrfc-&gt;if_netnum
suffix:semicolon
id|memcpy
c_func
(paren
id|ipx-&gt;ipx_source.node
comma
id|sk-&gt;ipx_intrfc-&gt;if_node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|ipx-&gt;ipx_source.sock
op_assign
id|sk-&gt;ipx_port
suffix:semicolon
id|ipx-&gt;ipx_dest.net
op_assign
id|usipx-&gt;sipx_network
suffix:semicolon
id|memcpy
c_func
(paren
id|ipx-&gt;ipx_dest.node
comma
id|usipx-&gt;sipx_node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|ipx-&gt;ipx_dest.sock
op_assign
id|usipx-&gt;sipx_port
suffix:semicolon
id|memcpy_fromfs
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|ubuf
comma
id|len
)paren
suffix:semicolon
r_return
id|ipxitf_send
c_func
(paren
id|intrfc
comma
id|skb
comma
(paren
id|rt
op_logical_and
id|rt-&gt;ir_routed
)paren
ques
c_cond
id|rt-&gt;ir_router_node
suffix:colon
id|ipx-&gt;ipx_dest.node
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ipxrtr_route_skb
id|ipxrtr_route_skb
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|ipx_packet
op_star
id|ipx
op_assign
(paren
id|ipx_packet
op_star
)paren
(paren
id|skb-&gt;h.raw
)paren
suffix:semicolon
id|ipx_route
op_star
id|r
suffix:semicolon
id|ipx_interface
op_star
id|i
suffix:semicolon
id|r
op_assign
id|ipxrtr_lookup
c_func
(paren
id|ipx-&gt;ipx_dest.net
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* no known route */
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|i
op_assign
id|r-&gt;ir_intrfc
suffix:semicolon
(paren
r_void
)paren
id|ipxitf_send
c_func
(paren
id|i
comma
id|skb
comma
(paren
id|r-&gt;ir_routed
)paren
ques
c_cond
id|r-&gt;ir_router_node
suffix:colon
id|ipx-&gt;ipx_dest.node
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;We use a normal struct rtentry for route handling&n; */
DECL|function|ipxrtr_ioctl
r_static
r_int
id|ipxrtr_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|rtentry
id|rt
suffix:semicolon
multiline_comment|/* Use these to behave like &squot;other&squot; stacks */
r_struct
id|sockaddr_ipx
op_star
id|sg
comma
op_star
id|st
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|arg
comma
r_sizeof
(paren
id|rt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|memcpy_fromfs
c_func
(paren
op_amp
id|rt
comma
id|arg
comma
r_sizeof
(paren
id|rt
)paren
)paren
suffix:semicolon
id|sg
op_assign
(paren
r_struct
id|sockaddr_ipx
op_star
)paren
op_amp
id|rt.rt_gateway
suffix:semicolon
id|st
op_assign
(paren
r_struct
id|sockaddr_ipx
op_star
)paren
op_amp
id|rt.rt_dst
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rt.rt_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Direct routes are fixed */
r_if
c_cond
(paren
id|sg-&gt;sipx_family
op_ne
id|AF_IPX
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|st-&gt;sipx_family
op_ne
id|AF_IPX
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDELRT
suffix:colon
r_return
id|ipxrtr_delete
c_func
(paren
id|st-&gt;sipx_network
)paren
suffix:semicolon
r_case
id|SIOCADDRT
suffix:colon
(brace
r_struct
id|ipx_route_definition
id|f
suffix:semicolon
id|f.ipx_network
op_assign
id|st-&gt;sipx_network
suffix:semicolon
id|f.ipx_router_network
op_assign
id|sg-&gt;sipx_network
suffix:semicolon
id|memcpy
c_func
(paren
id|f.ipx_router_node
comma
id|sg-&gt;sipx_node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
r_return
id|ipxrtr_create
c_func
(paren
op_amp
id|f
)paren
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_static
r_const
r_char
op_star
DECL|function|ipx_frame_name
id|ipx_frame_name
c_func
(paren
r_int
r_int
id|frame
)paren
(brace
r_switch
c_cond
(paren
id|ntohs
c_func
(paren
id|frame
)paren
)paren
(brace
r_case
id|ETH_P_IPX
suffix:colon
r_return
l_string|&quot;EtherII&quot;
suffix:semicolon
r_case
id|ETH_P_802_2
suffix:colon
r_return
l_string|&quot;802.2&quot;
suffix:semicolon
r_case
id|ETH_P_SNAP
suffix:colon
r_return
l_string|&quot;SNAP&quot;
suffix:semicolon
r_case
id|ETH_P_802_3
suffix:colon
r_return
l_string|&quot;802.3&quot;
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;None&quot;
suffix:semicolon
)brace
)brace
r_static
r_const
r_char
op_star
DECL|function|ipx_device_name
id|ipx_device_name
c_func
(paren
id|ipx_interface
op_star
id|intrfc
)paren
(brace
r_return
(paren
id|intrfc-&gt;if_internal
ques
c_cond
l_string|&quot;Internal&quot;
suffix:colon
(paren
id|intrfc-&gt;if_dev
ques
c_cond
id|intrfc-&gt;if_dev-&gt;name
suffix:colon
l_string|&quot;Unknown&quot;
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Called from proc fs */
r_int
DECL|function|ipx_get_interface_info
id|ipx_get_interface_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
id|ipx_interface
op_star
id|i
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Theory.. Keep printing in the same place until we pass offset */
id|len
op_add_assign
id|sprintf
(paren
id|buffer
comma
l_string|&quot;%-11s%-15s%-9s%-11s%s&bslash;n&quot;
comma
l_string|&quot;Network&quot;
comma
l_string|&quot;Node_Address&quot;
comma
l_string|&quot;Primary&quot;
comma
l_string|&quot;Device&quot;
comma
l_string|&quot;Frame_Type&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ipx_interfaces
suffix:semicolon
id|i
op_ne
l_int|NULL
suffix:semicolon
id|i
op_assign
id|i-&gt;if_next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%08lX   &quot;
comma
id|ntohl
c_func
(paren
id|i-&gt;if_netnum
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%02X%02X%02X%02X%02X%02X   &quot;
comma
id|i-&gt;if_node
(braket
l_int|0
)braket
comma
id|i-&gt;if_node
(braket
l_int|1
)braket
comma
id|i-&gt;if_node
(braket
l_int|2
)braket
comma
id|i-&gt;if_node
(braket
l_int|3
)braket
comma
id|i-&gt;if_node
(braket
l_int|4
)braket
comma
id|i-&gt;if_node
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-9s&quot;
comma
(paren
id|i
op_eq
id|ipx_primary_net
)paren
ques
c_cond
l_string|&quot;Yes&quot;
suffix:colon
l_string|&quot;No&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-11s&quot;
comma
id|ipx_device_name
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|ipx_frame_name
c_func
(paren
id|i-&gt;if_dlink_type
)paren
)paren
suffix:semicolon
multiline_comment|/* Are we still dumping unwanted data then discard the record */
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Keep dumping into the buffer start */
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
multiline_comment|/* We have dumped enough */
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* The data in question runs from begin to begin+len */
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start of wanted data */
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Remove unwanted header data from length */
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
)brace
multiline_comment|/* Remove unwanted tail data from length */
r_return
id|len
suffix:semicolon
)brace
r_int
DECL|function|ipx_get_info
id|ipx_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
id|ipx_socket
op_star
id|s
suffix:semicolon
id|ipx_interface
op_star
id|i
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Theory.. Keep printing in the same place until we pass offset */
id|len
op_add_assign
id|sprintf
(paren
id|buffer
comma
l_string|&quot;%-15s%-28s%-10s%-10s%-7s%s&bslash;n&quot;
comma
l_string|&quot;Local_Address&quot;
comma
l_string|&quot;Remote_Address&quot;
comma
l_string|&quot;Tx_Queue&quot;
comma
l_string|&quot;Rx_Queue&quot;
comma
l_string|&quot;State&quot;
comma
l_string|&quot;Uid&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ipx_interfaces
suffix:semicolon
id|i
op_ne
l_int|NULL
suffix:semicolon
id|i
op_assign
id|i-&gt;if_next
)paren
(brace
r_for
c_loop
(paren
id|s
op_assign
id|i-&gt;if_sklist
suffix:semicolon
id|s
op_ne
l_int|NULL
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%08lX:%04X  &quot;
comma
id|htonl
c_func
(paren
id|i-&gt;if_netnum
)paren
comma
id|htons
c_func
(paren
id|s-&gt;ipx_port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-28s&quot;
comma
l_string|&quot;Not_Connected&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%08lX:%02X%02X%02X%02X%02X%02X:%04X  &quot;
comma
id|htonl
c_func
(paren
id|s-&gt;ipx_dest_addr.net
)paren
comma
id|s-&gt;ipx_dest_addr.node
(braket
l_int|0
)braket
comma
id|s-&gt;ipx_dest_addr.node
(braket
l_int|1
)braket
comma
id|s-&gt;ipx_dest_addr.node
(braket
l_int|2
)braket
comma
id|s-&gt;ipx_dest_addr.node
(braket
l_int|3
)braket
comma
id|s-&gt;ipx_dest_addr.node
(braket
l_int|4
)braket
comma
id|s-&gt;ipx_dest_addr.node
(braket
l_int|5
)braket
comma
id|htons
c_func
(paren
id|s-&gt;ipx_dest_addr.sock
)paren
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%08lX  %08lX  &quot;
comma
id|s-&gt;wmem_alloc
comma
id|s-&gt;rmem_alloc
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%02X     %03d&bslash;n&quot;
comma
id|s-&gt;state
comma
id|SOCK_INODE
c_func
(paren
id|s-&gt;socket
)paren
op_member_access_from_pointer
id|i_uid
)paren
suffix:semicolon
multiline_comment|/* Are we still dumping unwanted data then discard the record */
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Keep dumping into the buffer start */
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
multiline_comment|/* We have dumped enough */
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* The data in question runs from begin to begin+len */
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Start of wanted data */
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
multiline_comment|/* Remove unwanted header data from length */
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
)brace
multiline_comment|/* Remove unwanted tail data from length */
r_return
id|len
suffix:semicolon
)brace
DECL|function|ipx_rt_get_info
r_int
id|ipx_rt_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
id|ipx_route
op_star
id|rt
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|buffer
comma
l_string|&quot;%-11s%-13s%s&bslash;n&quot;
comma
l_string|&quot;Network&quot;
comma
l_string|&quot;Router_Net&quot;
comma
l_string|&quot;Router_Node&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|ipx_routes
suffix:semicolon
id|rt
op_ne
l_int|NULL
suffix:semicolon
id|rt
op_assign
id|rt-&gt;ir_next
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%08lX   &quot;
comma
id|ntohl
c_func
(paren
id|rt-&gt;ir_net
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;ir_routed
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%08lX     %02X%02X%02X%02X%02X%02X&bslash;n&quot;
comma
id|ntohl
c_func
(paren
id|rt-&gt;ir_intrfc-&gt;if_netnum
)paren
comma
id|rt-&gt;ir_router_node
(braket
l_int|0
)braket
comma
id|rt-&gt;ir_router_node
(braket
l_int|1
)braket
comma
id|rt-&gt;ir_router_node
(braket
l_int|2
)braket
comma
id|rt-&gt;ir_router_node
(braket
l_int|3
)braket
comma
id|rt-&gt;ir_router_node
(braket
l_int|4
)braket
comma
id|rt-&gt;ir_router_node
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_add_assign
id|sprintf
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-13s%s&bslash;n&quot;
comma
l_string|&quot;Directly&quot;
comma
l_string|&quot;Connected&quot;
)paren
suffix:semicolon
)brace
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************************************************&bslash;&n;*&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;            *&n;*&t;      Handling for system calls applied via the various interfaces to an IPX socket object&t;&t;    *&n;*&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;    *&n;&bslash;*******************************************************************************************************************/
DECL|function|ipx_fcntl
r_static
r_int
id|ipx_fcntl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|function|ipx_setsockopt
r_static
r_int
id|ipx_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
id|ipx_socket
op_star
id|sk
suffix:semicolon
r_int
id|err
comma
id|opt
suffix:semicolon
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|optval
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|optval
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|opt
op_assign
id|get_fs_long
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|optval
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|level
)paren
(brace
r_case
id|SOL_IPX
suffix:colon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|IPX_TYPE
suffix:colon
id|sk-&gt;ipx_type
op_assign
id|opt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SOL_SOCKET
suffix:colon
r_return
id|sock_setsockopt
c_func
(paren
id|sk
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
DECL|function|ipx_getsockopt
r_static
r_int
id|ipx_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
id|ipx_socket
op_star
id|sk
suffix:semicolon
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
r_switch
c_cond
(paren
id|level
)paren
(brace
r_case
id|SOL_IPX
suffix:colon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|IPX_TYPE
suffix:colon
id|val
op_assign
id|sk-&gt;ipx_type
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SOL_SOCKET
suffix:colon
r_return
id|sock_getsockopt
c_func
(paren
id|sk
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|optlen
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|put_fs_long
c_func
(paren
r_sizeof
(paren
r_int
)paren
comma
(paren
r_int
r_int
op_star
)paren
id|optlen
)paren
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|optval
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|put_fs_long
c_func
(paren
id|val
comma
(paren
r_int
r_int
op_star
)paren
id|optval
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipx_listen
r_static
r_int
id|ipx_listen
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|backlog
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|def_callback1
r_static
r_void
id|def_callback1
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
(brace
id|wake_up_interruptible
c_func
(paren
id|sk-&gt;sleep
)paren
suffix:semicolon
)brace
)brace
DECL|function|def_callback2
r_static
r_void
id|def_callback2
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|len
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
(brace
id|wake_up_interruptible
c_func
(paren
id|sk-&gt;sleep
)paren
suffix:semicolon
id|sock_wake_async
c_func
(paren
id|sk-&gt;socket
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|ipx_create
id|ipx_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
id|ipx_socket
op_star
id|sk
suffix:semicolon
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sk
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|sock-&gt;type
)paren
(brace
r_case
id|SOCK_DGRAM
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|kfree_s
c_func
(paren
(paren
r_void
op_star
)paren
id|sk
comma
r_sizeof
(paren
op_star
id|sk
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
)brace
id|sk-&gt;dead
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;broadcast
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;rcvbuf
op_assign
id|SK_RMEM_MAX
suffix:semicolon
id|sk-&gt;sndbuf
op_assign
id|SK_WMEM_MAX
suffix:semicolon
id|sk-&gt;wmem_alloc
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;rmem_alloc
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;inuse
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;shutdown
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;prot
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* So we use default free mechanisms */
id|sk-&gt;err
op_assign
l_int|0
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|sk-&gt;write_queue
)paren
suffix:semicolon
id|sk-&gt;send_head
op_assign
l_int|NULL
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|sk-&gt;back_log
)paren
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_CLOSE
suffix:semicolon
id|sk-&gt;socket
op_assign
id|sock
suffix:semicolon
id|sk-&gt;type
op_assign
id|sock-&gt;type
suffix:semicolon
id|sk-&gt;ipx_type
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* General user level IPX */
id|sk-&gt;debug
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;ipx_intrfc
op_assign
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sk-&gt;ipx_dest_addr
comma
l_char|&squot;&bslash;0&squot;
comma
r_sizeof
(paren
id|sk-&gt;ipx_dest_addr
)paren
)paren
suffix:semicolon
id|sk-&gt;ipx_port
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;mtu
op_assign
id|IPX_MTU
suffix:semicolon
r_if
c_cond
(paren
id|sock
op_ne
l_int|NULL
)paren
(brace
id|sock-&gt;data
op_assign
(paren
r_void
op_star
)paren
id|sk
suffix:semicolon
id|sk-&gt;sleep
op_assign
id|sock-&gt;wait
suffix:semicolon
)brace
id|sk-&gt;state_change
op_assign
id|def_callback1
suffix:semicolon
id|sk-&gt;data_ready
op_assign
id|def_callback2
suffix:semicolon
id|sk-&gt;write_space
op_assign
id|def_callback1
suffix:semicolon
id|sk-&gt;error_report
op_assign
id|def_callback1
suffix:semicolon
id|sk-&gt;zapped
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipx_release
r_static
r_int
id|ipx_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|peer
)paren
(brace
id|ipx_socket
op_star
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
(brace
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|sk-&gt;dead
op_assign
l_int|1
suffix:semicolon
id|sock-&gt;data
op_assign
l_int|NULL
suffix:semicolon
id|ipx_destroy_socket
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipx_dup
r_static
r_int
id|ipx_dup
c_func
(paren
r_struct
id|socket
op_star
id|newsock
comma
r_struct
id|socket
op_star
id|oldsock
)paren
(brace
r_return
id|ipx_create
c_func
(paren
id|newsock
comma
id|SOCK_DGRAM
)paren
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|ipx_first_free_socketnum
id|ipx_first_free_socketnum
c_func
(paren
id|ipx_interface
op_star
id|intrfc
)paren
(brace
r_int
r_int
id|socketNum
op_assign
id|intrfc-&gt;if_sknum
suffix:semicolon
r_if
c_cond
(paren
id|socketNum
OL
id|IPX_MIN_EPHEMERAL_SOCKET
)paren
id|socketNum
op_assign
id|IPX_MIN_EPHEMERAL_SOCKET
suffix:semicolon
r_while
c_loop
(paren
id|ipxitf_find_socket
c_func
(paren
id|intrfc
comma
id|ntohs
c_func
(paren
id|socketNum
)paren
)paren
op_ne
l_int|NULL
)paren
r_if
c_cond
(paren
id|socketNum
OG
id|IPX_MAX_EPHEMERAL_SOCKET
)paren
id|socketNum
op_assign
id|IPX_MIN_EPHEMERAL_SOCKET
suffix:semicolon
r_else
id|socketNum
op_increment
suffix:semicolon
id|intrfc-&gt;if_sknum
op_assign
id|socketNum
suffix:semicolon
r_return
id|ntohs
c_func
(paren
id|socketNum
)paren
suffix:semicolon
)brace
DECL|function|ipx_bind
r_static
r_int
id|ipx_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
id|ipx_socket
op_star
id|sk
suffix:semicolon
id|ipx_interface
op_star
id|intrfc
suffix:semicolon
r_struct
id|sockaddr_ipx
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_ipx
op_star
)paren
id|uaddr
suffix:semicolon
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;zapped
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr_len
op_ne
r_sizeof
(paren
r_struct
id|sockaddr_ipx
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|intrfc
op_assign
id|ipxitf_find_using_net
c_func
(paren
id|addr-&gt;sipx_network
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intrfc
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sipx_port
op_eq
l_int|0
)paren
(brace
id|addr-&gt;sipx_port
op_assign
id|ipx_first_free_socketnum
c_func
(paren
id|intrfc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sipx_port
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ntohs
c_func
(paren
id|addr-&gt;sipx_port
)paren
OL
id|IPX_MIN_EPHEMERAL_SOCKET
op_logical_and
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
multiline_comment|/* protect IPX system stuff like routing/sap */
multiline_comment|/* Source addresses are easy. It must be our network:node pair for&n;&t;   an interface routed to IPX with the ipx routing ioctl() */
r_if
c_cond
(paren
id|ipxitf_find_socket
c_func
(paren
id|intrfc
comma
id|addr-&gt;sipx_port
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;debug
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;IPX: bind failed because port %X in use.&bslash;n&quot;
comma
(paren
r_int
)paren
id|addr-&gt;sipx_port
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
id|sk-&gt;ipx_port
op_assign
id|addr-&gt;sipx_port
suffix:semicolon
id|ipxitf_insert_socket
c_func
(paren
id|intrfc
comma
id|sk
)paren
suffix:semicolon
id|sk-&gt;zapped
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;debug
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;IPX: socket is bound.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipx_connect
r_static
r_int
id|ipx_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
comma
r_int
id|flags
)paren
(brace
id|ipx_socket
op_star
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
r_struct
id|sockaddr_ipx
op_star
id|addr
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_CLOSE
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
r_if
c_cond
(paren
id|addr_len
op_ne
r_sizeof
(paren
op_star
id|addr
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|addr
op_assign
(paren
r_struct
id|sockaddr_ipx
op_star
)paren
id|uaddr
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;ipx_port
op_eq
l_int|0
)paren
multiline_comment|/* put the autobinding in */
(brace
r_struct
id|sockaddr_ipx
id|uaddr
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|uaddr.sipx_port
op_assign
l_int|0
suffix:semicolon
id|uaddr.sipx_network
op_assign
l_int|0L
suffix:semicolon
id|ret
op_assign
id|ipx_bind
(paren
id|sock
comma
(paren
r_struct
id|sockaddr
op_star
)paren
op_amp
id|uaddr
comma
r_sizeof
(paren
r_struct
id|sockaddr_ipx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
r_return
(paren
id|ret
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipxrtr_lookup
c_func
(paren
id|addr-&gt;sipx_network
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
)brace
id|sk-&gt;ipx_dest_addr.net
op_assign
id|addr-&gt;sipx_network
suffix:semicolon
id|sk-&gt;ipx_dest_addr.sock
op_assign
id|addr-&gt;sipx_port
suffix:semicolon
id|memcpy
c_func
(paren
id|sk-&gt;ipx_dest_addr.node
comma
id|addr-&gt;sipx_node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|sk-&gt;ipx_type
op_assign
id|addr-&gt;sipx_type
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_ESTABLISHED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipx_socketpair
r_static
r_int
id|ipx_socketpair
c_func
(paren
r_struct
id|socket
op_star
id|sock1
comma
r_struct
id|socket
op_star
id|sock2
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|ipx_accept
r_static
r_int
id|ipx_accept
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|newsock
comma
r_int
id|flags
)paren
(brace
r_if
c_cond
(paren
id|newsock-&gt;data
)paren
(brace
id|kfree_s
c_func
(paren
id|newsock-&gt;data
comma
r_sizeof
(paren
id|ipx_socket
)paren
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|ipx_getname
r_static
r_int
id|ipx_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddr_len
comma
r_int
id|peer
)paren
(brace
id|ipx_address
op_star
id|addr
suffix:semicolon
r_struct
id|sockaddr_ipx
id|sipx
suffix:semicolon
id|ipx_socket
op_star
id|sk
suffix:semicolon
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
op_star
id|uaddr_len
op_assign
r_sizeof
(paren
r_struct
id|sockaddr_ipx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
(brace
r_return
op_minus
id|ENOTCONN
suffix:semicolon
)brace
id|addr
op_assign
op_amp
id|sk-&gt;ipx_dest_addr
suffix:semicolon
id|sipx.sipx_network
op_assign
id|addr-&gt;net
suffix:semicolon
id|memcpy
c_func
(paren
id|sipx.sipx_node
comma
id|addr-&gt;node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|sipx.sipx_port
op_assign
id|addr-&gt;sock
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sk-&gt;ipx_intrfc
op_ne
l_int|NULL
)paren
(brace
id|sipx.sipx_network
op_assign
id|sk-&gt;ipx_intrfc-&gt;if_netnum
suffix:semicolon
id|memcpy
c_func
(paren
id|sipx.sipx_node
comma
id|sk-&gt;ipx_intrfc-&gt;if_node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
)brace
r_else
(brace
id|sipx.sipx_network
op_assign
l_int|0L
suffix:semicolon
id|memset
c_func
(paren
id|sipx.sipx_node
comma
l_char|&squot;&bslash;0&squot;
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
)brace
id|sipx.sipx_port
op_assign
id|sk-&gt;ipx_port
suffix:semicolon
)brace
id|sipx.sipx_family
op_assign
id|AF_IPX
suffix:semicolon
id|sipx.sipx_type
op_assign
id|sk-&gt;ipx_type
suffix:semicolon
id|memcpy
c_func
(paren
id|uaddr
comma
op_amp
id|sipx
comma
r_sizeof
(paren
id|sipx
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/*&n; * User to dump IPX packets (debugging)&n; */
r_void
id|dump_data
c_func
(paren
r_char
op_star
id|str
comma
r_int
r_char
op_star
id|d
comma
r_int
id|len
)paren
(brace
r_static
r_char
id|h2c
(braket
)braket
op_assign
l_string|&quot;0123456789ABCDEF&quot;
suffix:semicolon
r_int
id|l
comma
id|i
suffix:semicolon
r_char
op_star
id|p
comma
id|b
(braket
l_int|64
)braket
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|len
OG
l_int|0
op_logical_and
id|l
OL
l_int|16
suffix:semicolon
id|l
op_increment
)paren
(brace
id|p
op_assign
id|b
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
comma
op_decrement
id|len
)paren
(brace
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
op_star
(paren
id|p
op_increment
)paren
op_assign
id|h2c
(braket
(paren
id|d
(braket
id|i
)braket
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
)braket
suffix:semicolon
op_star
(paren
id|p
op_increment
)paren
op_assign
id|h2c
(braket
id|d
(braket
id|i
)braket
op_amp
l_int|0x0f
)braket
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
id|p
op_increment
)paren
op_assign
l_char|&squot; &squot;
suffix:semicolon
op_star
(paren
id|p
op_increment
)paren
op_assign
l_char|&squot; &squot;
suffix:semicolon
)brace
op_star
(paren
id|p
op_increment
)paren
op_assign
l_char|&squot; &squot;
suffix:semicolon
)brace
op_star
(paren
id|p
op_increment
)paren
op_assign
l_char|&squot;-&squot;
suffix:semicolon
op_star
(paren
id|p
op_increment
)paren
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
comma
op_decrement
id|len
)paren
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
op_star
(paren
id|p
op_increment
)paren
op_assign
l_char|&squot; &squot;
op_le
id|d
(braket
id|i
)braket
op_logical_and
id|d
(braket
id|i
)braket
OL
l_char|&squot;&bslash;177&squot;
ques
c_cond
id|d
(braket
id|i
)braket
suffix:colon
l_char|&squot;.&squot;
suffix:semicolon
r_else
op_star
(paren
id|p
op_increment
)paren
op_assign
l_char|&squot; &squot;
suffix:semicolon
op_star
id|p
op_assign
l_char|&squot;&bslash;000&squot;
suffix:semicolon
id|d
op_add_assign
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s-%04X: %s&bslash;n&quot;
comma
id|str
comma
id|l
op_star
l_int|8
comma
id|b
)paren
suffix:semicolon
)brace
)brace
r_void
id|dump_addr
c_func
(paren
r_char
op_star
id|str
comma
id|ipx_address
op_star
id|p
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %08X:%02X%02X%02X%02X%02X%02X:%04X&bslash;n&quot;
comma
id|str
comma
id|ntohl
c_func
(paren
id|p-&gt;net
)paren
comma
id|p-&gt;node
(braket
l_int|0
)braket
comma
id|p-&gt;node
(braket
l_int|1
)braket
comma
id|p-&gt;node
(braket
l_int|2
)braket
comma
id|p-&gt;node
(braket
l_int|3
)braket
comma
id|p-&gt;node
(braket
l_int|4
)braket
comma
id|p-&gt;node
(braket
l_int|5
)braket
comma
id|ntohs
c_func
(paren
id|p-&gt;sock
)paren
)paren
suffix:semicolon
)brace
r_void
id|dump_hdr
c_func
(paren
r_char
op_star
id|str
comma
id|ipx_packet
op_star
id|p
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: CHKSUM=%04X SIZE=%d (%04X) HOPS=%d (%02X) TYPE=%02X&bslash;n&quot;
comma
id|str
comma
id|p-&gt;ipx_checksum
comma
id|ntohs
c_func
(paren
id|p-&gt;ipx_pktsize
)paren
comma
id|ntohs
c_func
(paren
id|p-&gt;ipx_pktsize
)paren
comma
id|p-&gt;ipx_tctrl
comma
id|p-&gt;ipx_tctrl
comma
id|p-&gt;ipx_type
)paren
suffix:semicolon
id|dump_addr
c_func
(paren
l_string|&quot;  IPX-DST&quot;
comma
op_amp
id|p-&gt;ipx_dest
)paren
suffix:semicolon
id|dump_addr
c_func
(paren
l_string|&quot;  IPX-SRC&quot;
comma
op_amp
id|p-&gt;ipx_source
)paren
suffix:semicolon
)brace
r_void
id|dump_pkt
c_func
(paren
r_char
op_star
id|str
comma
id|ipx_packet
op_star
id|p
)paren
(brace
r_int
id|len
op_assign
id|ntohs
c_func
(paren
id|p-&gt;ipx_pktsize
)paren
suffix:semicolon
id|dump_hdr
c_func
(paren
id|str
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|30
)paren
id|dump_data
c_func
(paren
id|str
comma
(paren
r_int
r_char
op_star
)paren
id|p
op_plus
l_int|30
comma
id|len
op_minus
l_int|30
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|ipx_rcv
r_int
id|ipx_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
multiline_comment|/* NULL here for pt means the packet was looped back */
id|ipx_interface
op_star
id|intrfc
suffix:semicolon
id|ipx_packet
op_star
id|ipx
suffix:semicolon
id|ipx
op_assign
(paren
id|ipx_packet
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_if
c_cond
(paren
id|ipx-&gt;ipx_checksum
op_ne
id|IPX_NO_CHECKSUM
)paren
(brace
multiline_comment|/* We don&squot;t do checksum options. We can&squot;t really. Novell don&squot;t seem to have documented them.&n;&t;&t;   If you need them try the XNS checksum since IPX is basically XNS in disguise. It might be&n;&t;&t;   the same... */
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Too small */
r_if
c_cond
(paren
id|htons
c_func
(paren
id|ipx-&gt;ipx_pktsize
)paren
OL
r_sizeof
(paren
id|ipx_packet
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Determine what local ipx endpoint this is */
id|intrfc
op_assign
id|ipxitf_find_using_phys
c_func
(paren
id|dev
comma
id|pt-&gt;type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intrfc
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|ipxcfg_auto_create_interfaces
)paren
(brace
id|intrfc
op_assign
id|ipxitf_auto_create
c_func
(paren
id|dev
comma
id|pt-&gt;type
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|intrfc
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* Not one of ours */
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|ipxitf_rcv
c_func
(paren
id|intrfc
comma
id|skb
)paren
suffix:semicolon
)brace
DECL|function|ipx_sendto
r_static
r_int
id|ipx_sendto
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_const
r_void
op_star
id|ubuf
comma
r_int
id|len
comma
r_int
id|noblock
comma
r_int
id|flags
comma
r_struct
id|sockaddr
op_star
id|usip
comma
r_int
id|addr_len
)paren
(brace
id|ipx_socket
op_star
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
r_struct
id|sockaddr_ipx
op_star
id|usipx
op_assign
(paren
r_struct
id|sockaddr_ipx
op_star
)paren
id|usip
suffix:semicolon
r_struct
id|sockaddr_ipx
id|local_sipx
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;zapped
)paren
r_return
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* Socket not bound */
r_if
c_cond
(paren
id|flags
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usipx
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;ipx_port
op_eq
l_int|0
)paren
(brace
r_struct
id|sockaddr_ipx
id|uaddr
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|uaddr.sipx_port
op_assign
l_int|0
suffix:semicolon
id|uaddr.sipx_network
op_assign
l_int|0L
suffix:semicolon
id|ret
op_assign
id|ipx_bind
(paren
id|sock
comma
(paren
r_struct
id|sockaddr
op_star
)paren
op_amp
id|uaddr
comma
r_sizeof
(paren
r_struct
id|sockaddr_ipx
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr_len
OL
r_sizeof
(paren
op_star
id|usipx
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usipx-&gt;sipx_family
op_ne
id|AF_IPX
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
(brace
r_return
op_minus
id|ENOTCONN
suffix:semicolon
)brace
id|usipx
op_assign
op_amp
id|local_sipx
suffix:semicolon
id|usipx-&gt;sipx_family
op_assign
id|AF_IPX
suffix:semicolon
id|usipx-&gt;sipx_type
op_assign
id|sk-&gt;ipx_type
suffix:semicolon
id|usipx-&gt;sipx_port
op_assign
id|sk-&gt;ipx_dest_addr.sock
suffix:semicolon
id|usipx-&gt;sipx_network
op_assign
id|sk-&gt;ipx_dest_addr.net
suffix:semicolon
id|memcpy
c_func
(paren
id|usipx-&gt;sipx_node
comma
id|sk-&gt;ipx_dest_addr.node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
)brace
id|retval
op_assign
id|ipxrtr_route_packet
c_func
(paren
id|sk
comma
id|usipx
comma
id|ubuf
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_return
id|retval
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|ipx_send
r_static
r_int
id|ipx_send
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_const
r_void
op_star
id|ubuf
comma
r_int
id|size
comma
r_int
id|noblock
comma
r_int
id|flags
)paren
(brace
r_return
id|ipx_sendto
c_func
(paren
id|sock
comma
id|ubuf
comma
id|size
comma
id|noblock
comma
id|flags
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|ipx_recvfrom
r_static
r_int
id|ipx_recvfrom
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_void
op_star
id|ubuf
comma
r_int
id|size
comma
r_int
id|noblock
comma
r_int
id|flags
comma
r_struct
id|sockaddr
op_star
id|sip
comma
r_int
op_star
id|addr_len
)paren
(brace
id|ipx_socket
op_star
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
r_struct
id|sockaddr_ipx
op_star
id|sipx
op_assign
(paren
r_struct
id|sockaddr_ipx
op_star
)paren
id|sip
suffix:semicolon
r_struct
id|ipx_packet
op_star
id|ipx
op_assign
l_int|NULL
suffix:semicolon
r_int
id|copied
op_assign
l_int|0
suffix:semicolon
r_int
id|truesize
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|er
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;err
)paren
(brace
id|er
op_assign
op_minus
id|sk-&gt;err
suffix:semicolon
id|sk-&gt;err
op_assign
l_int|0
suffix:semicolon
r_return
id|er
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;zapped
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|skb
op_assign
id|skb_recv_datagram
c_func
(paren
id|sk
comma
id|flags
comma
id|noblock
comma
op_amp
id|er
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_return
id|er
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr_len
)paren
(brace
op_star
id|addr_len
op_assign
r_sizeof
(paren
op_star
id|sipx
)paren
suffix:semicolon
)brace
id|ipx
op_assign
(paren
id|ipx_packet
op_star
)paren
(paren
id|skb-&gt;h.raw
)paren
suffix:semicolon
id|truesize
op_assign
id|ntohs
c_func
(paren
id|ipx-&gt;ipx_pktsize
)paren
op_minus
r_sizeof
(paren
id|ipx_packet
)paren
suffix:semicolon
id|copied
op_assign
(paren
id|truesize
OG
id|size
)paren
ques
c_cond
id|size
suffix:colon
id|truesize
suffix:semicolon
id|skb_copy_datagram
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|ipx_packet
)paren
comma
id|ubuf
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sipx
)paren
(brace
id|sipx-&gt;sipx_family
op_assign
id|AF_IPX
suffix:semicolon
id|sipx-&gt;sipx_port
op_assign
id|ipx-&gt;ipx_source.sock
suffix:semicolon
id|memcpy
c_func
(paren
id|sipx-&gt;sipx_node
comma
id|ipx-&gt;ipx_source.node
comma
id|IPX_NODE_LEN
)paren
suffix:semicolon
id|sipx-&gt;sipx_network
op_assign
id|ipx-&gt;ipx_source.net
suffix:semicolon
id|sipx-&gt;sipx_type
op_assign
id|ipx-&gt;ipx_type
suffix:semicolon
)brace
id|skb_free_datagram
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|truesize
suffix:semicolon
)brace
DECL|function|ipx_write
r_static
r_int
id|ipx_write
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_const
r_char
op_star
id|ubuf
comma
r_int
id|size
comma
r_int
id|noblock
)paren
(brace
r_return
id|ipx_send
c_func
(paren
id|sock
comma
id|ubuf
comma
id|size
comma
id|noblock
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|ipx_recv
r_static
r_int
id|ipx_recv
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_void
op_star
id|ubuf
comma
r_int
id|size
comma
r_int
id|noblock
comma
r_int
id|flags
)paren
(brace
id|ipx_socket
op_star
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;zapped
)paren
(brace
r_return
op_minus
id|ENOTCONN
suffix:semicolon
)brace
r_return
id|ipx_recvfrom
c_func
(paren
id|sock
comma
id|ubuf
comma
id|size
comma
id|noblock
comma
id|flags
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|ipx_read
r_static
r_int
id|ipx_read
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_char
op_star
id|ubuf
comma
r_int
id|size
comma
r_int
id|noblock
)paren
(brace
r_return
id|ipx_recv
c_func
(paren
id|sock
comma
id|ubuf
comma
id|size
comma
id|noblock
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|ipx_shutdown
r_static
r_int
id|ipx_shutdown
c_func
(paren
r_struct
id|socket
op_star
id|sk
comma
r_int
id|how
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|ipx_select
r_static
r_int
id|ipx_select
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|sel_type
comma
id|select_table
op_star
id|wait
)paren
(brace
id|ipx_socket
op_star
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
r_return
id|datagram_select
c_func
(paren
id|sk
comma
id|sel_type
comma
id|wait
)paren
suffix:semicolon
)brace
DECL|function|ipx_ioctl
r_static
r_int
id|ipx_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|err
suffix:semicolon
r_int
id|amount
op_assign
l_int|0
suffix:semicolon
id|ipx_socket
op_star
id|sk
op_assign
(paren
id|ipx_socket
op_star
)paren
id|sock-&gt;data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|TIOCOUTQ
suffix:colon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|amount
op_assign
id|sk-&gt;sndbuf
op_minus
id|sk-&gt;wmem_alloc
suffix:semicolon
r_if
c_cond
(paren
id|amount
OL
l_int|0
)paren
(brace
id|amount
op_assign
l_int|0
suffix:semicolon
)brace
id|put_fs_long
c_func
(paren
id|amount
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|TIOCINQ
suffix:colon
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* These two are safe on a single CPU system as only user tasks fiddle here */
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|amount
op_assign
id|skb-&gt;len
suffix:semicolon
)brace
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|put_fs_long
c_func
(paren
id|amount
comma
(paren
r_int
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SIOCADDRT
suffix:colon
r_case
id|SIOCDELRT
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_return
id|ipxrtr_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCSIFADDR
suffix:colon
r_case
id|SIOCGIFADDR
suffix:colon
r_case
id|SIOCAIPXITFCRT
suffix:colon
r_case
id|SIOCAIPXPRISLT
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_return
id|ipxitf_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCIPXCFGDATA
suffix:colon
(brace
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|ipx_config_data
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
r_return
id|ipxcfg_get_config_data
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_case
id|SIOCGSTAMP
suffix:colon
r_if
c_cond
(paren
id|sk
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;stamp.tv_sec
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|memcpy_tofs
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|sk-&gt;stamp
comma
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SIOCGIFDSTADDR
suffix:colon
r_case
id|SIOCSIFDSTADDR
suffix:colon
r_case
id|SIOCGIFBRDADDR
suffix:colon
r_case
id|SIOCSIFBRDADDR
suffix:colon
r_case
id|SIOCGIFNETMASK
suffix:colon
r_case
id|SIOCSIFNETMASK
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
multiline_comment|/*NOTREACHED*/
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ipx_proto_ops
r_static
r_struct
id|proto_ops
id|ipx_proto_ops
op_assign
(brace
id|AF_IPX
comma
id|ipx_create
comma
id|ipx_dup
comma
id|ipx_release
comma
id|ipx_bind
comma
id|ipx_connect
comma
id|ipx_socketpair
comma
id|ipx_accept
comma
id|ipx_getname
comma
id|ipx_read
comma
id|ipx_write
comma
id|ipx_select
comma
id|ipx_ioctl
comma
id|ipx_listen
comma
id|ipx_send
comma
id|ipx_recv
comma
id|ipx_sendto
comma
id|ipx_recvfrom
comma
id|ipx_shutdown
comma
id|ipx_setsockopt
comma
id|ipx_getsockopt
comma
id|ipx_fcntl
comma
)brace
suffix:semicolon
multiline_comment|/* Called by ddi.c on kernel start up */
DECL|variable|ipx_8023_packet_type
r_static
r_struct
id|packet_type
id|ipx_8023_packet_type
op_assign
(brace
l_int|0
comma
multiline_comment|/* MUTTER ntohs(ETH_P_8023),*/
l_int|NULL
comma
multiline_comment|/* All devices */
id|ipx_rcv
comma
l_int|NULL
comma
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|ipx_dix_packet_type
r_static
r_struct
id|packet_type
id|ipx_dix_packet_type
op_assign
(brace
l_int|0
comma
multiline_comment|/* MUTTER ntohs(ETH_P_IPX),*/
l_int|NULL
comma
multiline_comment|/* All devices */
id|ipx_rcv
comma
l_int|NULL
comma
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|ipx_dev_notifier
r_static
r_struct
id|notifier_block
id|ipx_dev_notifier
op_assign
initialization_block
suffix:semicolon
r_extern
r_struct
id|datalink_proto
op_star
id|make_EII_client
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_struct
id|datalink_proto
op_star
id|make_8023_client
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|ipx_proto_init
r_void
id|ipx_proto_init
c_func
(paren
r_struct
id|net_proto
op_star
id|pro
)paren
(brace
r_int
r_char
id|val
op_assign
l_int|0xE0
suffix:semicolon
r_int
r_char
id|snapval
(braket
l_int|5
)braket
op_assign
(brace
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x81
comma
l_int|0x37
)brace
suffix:semicolon
(paren
r_void
)paren
id|sock_register
c_func
(paren
id|ipx_proto_ops.family
comma
op_amp
id|ipx_proto_ops
)paren
suffix:semicolon
id|pEII_datalink
op_assign
id|make_EII_client
c_func
(paren
)paren
suffix:semicolon
id|ipx_dix_packet_type.type
op_assign
id|htons
c_func
(paren
id|ETH_P_IPX
)paren
suffix:semicolon
id|dev_add_pack
c_func
(paren
op_amp
id|ipx_dix_packet_type
)paren
suffix:semicolon
id|p8023_datalink
op_assign
id|make_8023_client
c_func
(paren
)paren
suffix:semicolon
id|ipx_8023_packet_type.type
op_assign
id|htons
c_func
(paren
id|ETH_P_802_3
)paren
suffix:semicolon
id|dev_add_pack
c_func
(paren
op_amp
id|ipx_8023_packet_type
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p8022_datalink
op_assign
id|register_8022_client
c_func
(paren
id|val
comma
id|ipx_rcv
)paren
)paren
op_eq
l_int|NULL
)paren
id|printk
c_func
(paren
l_string|&quot;IPX: Unable to register with 802.2&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pSNAP_datalink
op_assign
id|register_snap_client
c_func
(paren
id|snapval
comma
id|ipx_rcv
)paren
)paren
op_eq
l_int|NULL
)paren
id|printk
c_func
(paren
l_string|&quot;IPX: Unable to register with SNAP&bslash;n&quot;
)paren
suffix:semicolon
id|register_netdevice_notifier
c_func
(paren
op_amp
id|ipx_dev_notifier
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Swansea University Computer Society IPX 0.31 for NET3.030&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IPX Portions Copyright (c) 1995 Caldera, Inc.&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
