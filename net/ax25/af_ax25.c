multiline_comment|/*&n; *&t;AX.25 release 038&n; *&n; *&t;This code REQUIRES 2.1.15 or higher/ NET3.038&n; *&n; *&t;This module:&n; *&t;&t;This module is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; *&n; *&t;History&n; *&t;AX.25 006&t;Alan(GW4PTS)&t;&t;Nearly died of shock - it&squot;s working 8-)&n; *&t;AX.25 007&t;Alan(GW4PTS)&t;&t;Removed the silliest bugs&n; *&t;AX.25 008&t;Alan(GW4PTS)&t;&t;Cleaned up, fixed a few state machine problems, added callbacks&n; *&t;AX.25 009&t;Alan(GW4PTS)&t;&t;Emergency patch kit to fix memory corruption&n; * &t;AX.25 010&t;Alan(GW4PTS)&t;&t;Added RAW sockets/Digipeat.&n; *&t;AX.25 011&t;Alan(GW4PTS)&t;&t;RAW socket and datagram fixes (thanks) - Raw sendto now gets PID right&n; *&t;&t;&t;&t;&t;&t;datagram sendto uses correct target address.&n; *&t;AX.25 012&t;Alan(GW4PTS)&t;&t;Correct incoming connection handling, send DM to failed connects.&n; *&t;&t;&t;&t;&t;&t;Use skb-&gt;data not skb+1. Support sk-&gt;priority correctly.&n; *&t;&t;&t;&t;&t;&t;Correct receive on SOCK_DGRAM.&n; *&t;AX.25 013&t;Alan(GW4PTS)&t;&t;Send DM to all unknown frames, missing initialiser fixed&n; *&t;&t;&t;&t;&t;&t;Leave spare SSID bits set (DAMA etc) - thanks for bug report,&n; *&t;&t;&t;&t;&t;&t;removed device registration (it&squot;s not used or needed). Clean up for&n; *&t;&t;&t;&t;&t;&t;gcc 2.5.8. PID to AX25_P_&n; *&t;AX.25 014&t;Alan(GW4PTS)&t;&t;Cleanup and NET3 merge&n; *&t;AX.25 015&t;Alan(GW4PTS)&t;&t;Internal test version.&n; *&t;AX.25 016&t;Alan(GW4PTS)&t;&t;Semi Internal version for PI card&n; *&t;&t;&t;&t;&t;&t;work.&n; *&t;AX.25 017&t;Alan(GW4PTS)&t;&t;Fixed some small bugs reported by&n; *&t;&t;&t;&t;&t;&t;G4KLX&n; *&t;AX.25 018&t;Alan(GW4PTS)&t;&t;Fixed a small error in SOCK_DGRAM&n; *&t;AX.25 019&t;Alan(GW4PTS)&t;&t;Clean ups for the non INET kernel and device ioctls in AX.25&n; *&t;AX.25 020&t;Jonathan(G4KLX)&t;&t;/proc support and other changes.&n; *&t;AX.25 021&t;Alan(GW4PTS)&t;&t;Added AX25_T1, AX25_N2, AX25_T3 as requested.&n; *&t;AX.25 022&t;Jonathan(G4KLX)&t;&t;More work on the ax25 auto router and /proc improved (again)!&n; *&t;&t;&t;Alan(GW4PTS)&t;&t;Added TIOCINQ/OUTQ&n; *&t;AX.25 023&t;Alan(GW4PTS)&t;&t;Fixed shutdown bug&n; *&t;AX.25 023&t;Alan(GW4PTS)&t;&t;Linus changed timers&n; *&t;AX.25 024&t;Alan(GW4PTS)&t;&t;Small bug fixes&n; *&t;AX.25 025&t;Alan(GW4PTS)&t;&t;More fixes, Linux 1.1.51 compatibility stuff, timers again!&n; *&t;AX.25 026&t;Alan(GW4PTS)&t;&t;Small state fix.&n; *&t;AX.25 027&t;Alan(GW4PTS)&t;&t;Socket close crash fixes.&n; *&t;AX.25 028&t;Alan(GW4PTS)&t;&t;Callsign control including settings per uid.&n; *&t;&t;&t;&t;&t;&t;Small bug fixes.&n; *&t;&t;&t;&t;&t;&t;Protocol set by sockets only.&n; *&t;&t;&t;&t;&t;&t;Small changes to allow for start of NET/ROM layer.&n; *&t;AX.25 028a&t;Jonathan(G4KLX)&t;&t;Changes to state machine.&n; *&t;AX.25 028b&t;Jonathan(G4KLX)&t;&t;Extracted ax25 control block&n; *&t;&t;&t;&t;&t;&t;from sock structure.&n; *&t;AX.25 029&t;Alan(GW4PTS)&t;&t;Combined 028b and some KA9Q code&n; *&t;&t;&t;Jonathan(G4KLX)&t;&t;and removed all the old Berkeley, added IP mode registration.&n; *&t;&t;&t;Darryl(G7LED)&t;&t;stuff. Cross-port digipeating. Minor fixes and enhancements.&n; *&t;&t;&t;Alan(GW4PTS)&t;&t;Missed suser() on axassociate checks&n; *&t;AX.25 030&t;Alan(GW4PTS)&t;&t;Added variable length headers.&n; *&t;&t;&t;Jonathan(G4KLX)&t;&t;Added BPQ Ethernet interface.&n; *&t;&t;&t;Steven(GW7RRM)&t;&t;Added digi-peating control ioctl.&n; *&t;&t;&t;&t;&t;&t;Added extended AX.25 support.&n; *&t;&t;&t;&t;&t;&t;Added AX.25 frame segmentation.&n; *&t;&t;&t;Darryl(G7LED)&t;&t;Changed connect(), recvfrom(), sendto() sockaddr/addrlen to&n; *&t;&t;&t;&t;&t;&t;fall inline with bind() and new policy.&n; *&t;&t;&t;&t;&t;&t;Moved digipeating ctl to new ax25_dev structs.&n; *&t;&t;&t;&t;&t;&t;Fixed ax25_release(), set TCP_CLOSE, wakeup app&n; *&t;&t;&t;&t;&t;&t;context, THEN make the sock dead.&n; *&t;&t;&t;Alan(GW4PTS)&t;&t;Cleaned up for single recvmsg methods.&n; *&t;&t;&t;Alan(GW4PTS)&t;&t;Fixed not clearing error on connect failure.&n; *&t;AX.25 031&t;Jonathan(G4KLX)&t;&t;Added binding to any device.&n; *&t;&t;&t;Joerg(DL1BKE)&t;&t;Added DAMA support, fixed (?) digipeating, fixed buffer locking&n; *&t;&t;&t;&t;&t;&t;for &quot;virtual connect&quot; mode... Result: Probably the&n; *&t;&t;&t;&t;&t;&t;&quot;Most Buggiest Code You&squot;ve Ever Seen&quot; (TM)&n; *&t;&t;&t;HaJo(DD8NE)&t;&t;Implementation of a T5 (idle) timer&n; *&t;&t;&t;Joerg(DL1BKE)&t;&t;Renamed T5 to IDLE and changed behaviour:&n; *&t;&t;&t;&t;&t;&t;the timer gets reloaded on every received or transmitted&n; *&t;&t;&t;&t;&t;&t;I frame for IP or NETROM. The idle timer is not active&n; *&t;&t;&t;&t;&t;&t;on &quot;vanilla AX.25&quot; connections. Furthermore added PACLEN&n; *&t;&t;&t;&t;&t;&t;to provide AX.25-layer based fragmentation (like WAMPES)&n; *      AX.25 032&t;Joerg(DL1BKE)&t;&t;Fixed DAMA timeout error.&n; *&t;&t;&t;&t;&t;&t;ax25_send_frame() limits the number of enqueued&n; *&t;&t;&t;&t;&t;&t;datagrams per socket.&n; *&t;AX.25 033&t;Jonathan(G4KLX)&t;&t;Removed auto-router.&n; *&t;&t;&t;Hans(PE1AYX)&t;&t;Converted to Module.&n; *&t;&t;&t;Joerg(DL1BKE)&t;&t;Moved BPQ Ethernet to separate driver.&n; *&t;AX.25 034&t;Jonathan(G4KLX)&t;&t;2.1 changes&n; *&t;&t;&t;Alan(GW4PTS)&t;&t;Small POSIXisations&n; *&t;AX.25 035&t;Alan(GW4PTS)&t;&t;Started fixing to the new&n; *&t;&t;&t;&t;&t;&t;format.&n; *&t;&t;&t;Hans(PE1AYX)&t;&t;Fixed interface to IP layer.&n; *&t;&t;&t;Alan(GW4PTS)&t;&t;Added asynchronous support.&n; *&t;&t;&t;Frederic(F1OAT)&t;&t;Support for pseudo-digipeating.&n; *&t;&t;&t;Jonathan(G4KLX)&t;&t;Support for packet forwarding.&n; *&t;AX.25 036&t;Jonathan(G4KLX)&t;&t;Major restructuring.&n; *&t;&t;&t;Joerg(DL1BKE)&t;&t;Fixed DAMA Slave.&n; *&t;&t;&t;Jonathan(G4KLX)&t;&t;Fix wildcard listen parameter setting.&n; *&t;AX.25 037&t;Jonathan(G4KLX)&t;&t;New timer architecture.&n; *      AX.25 038       Matthias(DG2FEF)        Small fixes to the syscall interface to make kernel&n; *                                              independent of AX25_MAX_DIGIS used by applications.&n; *                      Tomi(OH2BNS)            Fixed ax25_getname().&n; *&t;&t;&t;Joerg(DL1BKE)&t;&t;Starting to phase out the support for full_sockaddr_ax25&n; *&t;&t;&t;&t;&t;&t;with only 6 digipeaters and sockaddr_ax25 in ax25_bind(),&n; *&t;&t;&t;&t;&t;&t;ax25_connect() and ax25_sendmsg()&n; *&t;&t;&t;Joerg(DL1BKE)&t;&t;Added support for SO_BINDTODEVICE&n; *&t;&t;&t;Arnaldo C. Melo&t;&t;s/suser/capable(CAP_NET_ADMIN)/, some more cleanups&n; *&t;&t;&t;Michal Ostrowski&t;Module initialization cleanup.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;net/ax25.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/termios.h&gt;&t;/* For TIOCINQ/OUTQ */
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/netfilter.h&gt;
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/arp.h&gt;
DECL|variable|ax25_list
id|ax25_cb
op_star
r_volatile
id|ax25_list
suffix:semicolon
DECL|variable|ax25_proto_ops
r_static
r_struct
id|proto_ops
id|ax25_proto_ops
suffix:semicolon
multiline_comment|/*&n; *&t;Free an allocated ax25 control block. This is done to centralise&n; *&t;the MOD count code.&n; */
DECL|function|ax25_free_cb
r_void
id|ax25_free_cb
c_func
(paren
id|ax25_cb
op_star
id|ax25
)paren
(brace
r_if
c_cond
(paren
id|ax25-&gt;digipeat
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|ax25-&gt;digipeat
)paren
suffix:semicolon
id|ax25-&gt;digipeat
op_assign
l_int|NULL
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|ax25
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|ax25_free_sock
r_static
r_void
id|ax25_free_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|ax25_free_cb
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Socket removal during an interrupt is now safe.&n; */
DECL|function|ax25_remove_socket
r_static
r_void
id|ax25_remove_socket
c_func
(paren
id|ax25_cb
op_star
id|ax25
)paren
(brace
id|ax25_cb
op_star
id|s
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s
op_assign
id|ax25_list
)paren
op_eq
id|ax25
)paren
(brace
id|ax25_list
op_assign
id|s-&gt;next
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_while
c_loop
(paren
id|s
op_ne
l_int|NULL
op_logical_and
id|s-&gt;next
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;next
op_eq
id|ax25
)paren
(brace
id|s-&gt;next
op_assign
id|ax25-&gt;next
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|s
op_assign
id|s-&gt;next
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Kill all bound sockets on a dropped device.&n; */
DECL|function|ax25_kill_by_device
r_static
r_void
id|ax25_kill_by_device
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|ax25_dev
op_star
id|ax25_dev
suffix:semicolon
id|ax25_cb
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ax25_dev
op_assign
id|ax25_dev_ax25dev
c_func
(paren
id|dev
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
id|ax25_list
suffix:semicolon
id|s
op_ne
l_int|NULL
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;ax25_dev
op_eq
id|ax25_dev
)paren
(brace
id|s-&gt;ax25_dev
op_assign
l_int|NULL
suffix:semicolon
id|ax25_disconnect
c_func
(paren
id|s
comma
id|ENETUNREACH
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *&t;Handle device status changes.&n; */
DECL|function|ax25_device_event
r_static
r_int
id|ax25_device_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|ptr
suffix:semicolon
multiline_comment|/* Reject non AX.25 devices */
r_if
c_cond
(paren
id|dev-&gt;type
op_ne
id|ARPHRD_AX25
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|NETDEV_UP
suffix:colon
id|ax25_dev_device_up
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_DOWN
suffix:colon
id|ax25_kill_by_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ax25_rt_device_down
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ax25_dev_device_down
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Add a socket to the bound sockets list.&n; */
DECL|function|ax25_insert_socket
r_void
id|ax25_insert_socket
c_func
(paren
id|ax25_cb
op_star
id|ax25
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ax25-&gt;next
op_assign
id|ax25_list
suffix:semicolon
id|ax25_list
op_assign
id|ax25
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Find a socket that wants to accept the SABM we have just&n; *&t;received.&n; */
DECL|function|ax25_find_listener
r_struct
id|sock
op_star
id|ax25_find_listener
c_func
(paren
id|ax25_address
op_star
id|addr
comma
r_int
id|digi
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|type
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|ax25_cb
op_star
id|s
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
id|ax25_list
suffix:semicolon
id|s
op_ne
l_int|NULL
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|s-&gt;iamdigi
op_logical_and
op_logical_neg
id|digi
)paren
op_logical_or
(paren
op_logical_neg
id|s-&gt;iamdigi
op_logical_and
id|digi
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;sk
op_ne
l_int|NULL
op_logical_and
id|ax25cmp
c_func
(paren
op_amp
id|s-&gt;source_addr
comma
id|addr
)paren
op_eq
l_int|0
op_logical_and
id|s-&gt;sk-&gt;type
op_eq
id|type
op_logical_and
id|s-&gt;sk-&gt;state
op_eq
id|TCP_LISTEN
)paren
(brace
multiline_comment|/* If device is null we match any device */
r_if
c_cond
(paren
id|s-&gt;ax25_dev
op_eq
l_int|NULL
op_logical_or
id|s-&gt;ax25_dev-&gt;dev
op_eq
id|dev
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|s-&gt;sk
suffix:semicolon
)brace
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Find an AX.25 socket given both ends.&n; */
DECL|function|ax25_find_socket
r_struct
id|sock
op_star
id|ax25_find_socket
c_func
(paren
id|ax25_address
op_star
id|my_addr
comma
id|ax25_address
op_star
id|dest_addr
comma
r_int
id|type
)paren
(brace
id|ax25_cb
op_star
id|s
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
id|ax25_list
suffix:semicolon
id|s
op_ne
l_int|NULL
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;sk
op_ne
l_int|NULL
op_logical_and
id|ax25cmp
c_func
(paren
op_amp
id|s-&gt;source_addr
comma
id|my_addr
)paren
op_eq
l_int|0
op_logical_and
id|ax25cmp
c_func
(paren
op_amp
id|s-&gt;dest_addr
comma
id|dest_addr
)paren
op_eq
l_int|0
op_logical_and
id|s-&gt;sk-&gt;type
op_eq
id|type
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|s-&gt;sk
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Find an AX.25 control block given both ends. It will only pick up&n; *&t;floating AX.25 control blocks or non Raw socket bound control blocks.&n; */
DECL|function|ax25_find_cb
id|ax25_cb
op_star
id|ax25_find_cb
c_func
(paren
id|ax25_address
op_star
id|src_addr
comma
id|ax25_address
op_star
id|dest_addr
comma
id|ax25_digi
op_star
id|digi
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|ax25_cb
op_star
id|s
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
id|ax25_list
suffix:semicolon
id|s
op_ne
l_int|NULL
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;sk
op_ne
l_int|NULL
op_logical_and
id|s-&gt;sk-&gt;type
op_ne
id|SOCK_SEQPACKET
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;ax25_dev
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ax25cmp
c_func
(paren
op_amp
id|s-&gt;source_addr
comma
id|src_addr
)paren
op_eq
l_int|0
op_logical_and
id|ax25cmp
c_func
(paren
op_amp
id|s-&gt;dest_addr
comma
id|dest_addr
)paren
op_eq
l_int|0
op_logical_and
id|s-&gt;ax25_dev-&gt;dev
op_eq
id|dev
)paren
(brace
r_if
c_cond
(paren
id|digi
op_ne
l_int|NULL
op_logical_and
id|digi-&gt;ndigi
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;digipeat
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ax25digicmp
c_func
(paren
id|s-&gt;digipeat
comma
id|digi
)paren
op_ne
l_int|0
)paren
r_continue
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|s-&gt;digipeat
op_ne
l_int|NULL
op_logical_and
id|s-&gt;digipeat-&gt;ndigi
op_ne
l_int|0
)paren
r_continue
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|s
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Look for any matching address - RAW sockets can bind to arbitrary names&n; */
DECL|function|ax25_addr_match
r_struct
id|sock
op_star
id|ax25_addr_match
c_func
(paren
id|ax25_address
op_star
id|addr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|ax25_cb
op_star
id|s
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
id|ax25_list
suffix:semicolon
id|s
op_ne
l_int|NULL
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;sk
op_ne
l_int|NULL
op_logical_and
id|ax25cmp
c_func
(paren
op_amp
id|s-&gt;source_addr
comma
id|addr
)paren
op_eq
l_int|0
op_logical_and
id|s-&gt;sk-&gt;type
op_eq
id|SOCK_RAW
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|s-&gt;sk
suffix:semicolon
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ax25_send_to_raw
r_void
id|ax25_send_to_raw
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|proto
)paren
(brace
r_struct
id|sk_buff
op_star
id|copy
suffix:semicolon
r_while
c_loop
(paren
id|sk
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_RAW
op_logical_and
id|sk-&gt;protocol
op_eq
id|proto
op_logical_and
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_le
id|sk-&gt;rcvbuf
)paren
(brace
r_if
c_cond
(paren
(paren
id|copy
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|sock_queue_rcv_skb
c_func
(paren
id|sk
comma
id|copy
)paren
op_ne
l_int|0
)paren
id|kfree_skb
c_func
(paren
id|copy
)paren
suffix:semicolon
)brace
id|sk
op_assign
id|sk-&gt;next
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Deferred destroy.&n; */
r_void
id|ax25_destroy_socket
c_func
(paren
id|ax25_cb
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Handler for deferred kills.&n; */
DECL|function|ax25_destroy_timer
r_static
r_void
id|ax25_destroy_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
id|ax25_destroy_socket
c_func
(paren
(paren
id|ax25_cb
op_star
)paren
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This is called from user mode and the timers. Thus it protects itself against&n; *&t;interrupt users but doesn&squot;t worry about being called during work.&n; *&t;Once it is removed from the queue no interrupt or bottom half will&n; *&t;touch it and we are (fairly 8-) ) safe.&n; */
DECL|function|ax25_destroy_socket
r_void
id|ax25_destroy_socket
c_func
(paren
id|ax25_cb
op_star
id|ax25
)paren
multiline_comment|/* Not static as it&squot;s used by the timer */
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ax25_stop_heartbeat
c_func
(paren
id|ax25
)paren
suffix:semicolon
id|ax25_stop_t1timer
c_func
(paren
id|ax25
)paren
suffix:semicolon
id|ax25_stop_t2timer
c_func
(paren
id|ax25
)paren
suffix:semicolon
id|ax25_stop_t3timer
c_func
(paren
id|ax25
)paren
suffix:semicolon
id|ax25_stop_idletimer
c_func
(paren
id|ax25
)paren
suffix:semicolon
id|ax25_remove_socket
c_func
(paren
id|ax25
)paren
suffix:semicolon
id|ax25_clear_queues
c_func
(paren
id|ax25
)paren
suffix:semicolon
multiline_comment|/* Flush the queues */
r_if
c_cond
(paren
id|ax25-&gt;sk
op_ne
l_int|NULL
)paren
(brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|ax25-&gt;sk-&gt;receive_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;sk
op_ne
id|ax25-&gt;sk
)paren
(brace
multiline_comment|/* A pending connection */
id|skb-&gt;sk-&gt;dead
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Queue the unaccepted socket for death */
id|ax25_start_heartbeat
c_func
(paren
id|skb-&gt;sk-&gt;protinfo.ax25
)paren
suffix:semicolon
id|skb-&gt;sk-&gt;protinfo.ax25-&gt;state
op_assign
id|AX25_STATE_0
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ax25-&gt;sk
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|ax25-&gt;sk-&gt;wmem_alloc
)paren
op_ne
l_int|0
op_logical_or
id|atomic_read
c_func
(paren
op_amp
id|ax25-&gt;sk-&gt;rmem_alloc
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Defer: outstanding buffers */
id|init_timer
c_func
(paren
op_amp
id|ax25-&gt;timer
)paren
suffix:semicolon
id|ax25-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|ax25-&gt;timer.function
op_assign
id|ax25_destroy_timer
suffix:semicolon
id|ax25-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|ax25
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ax25-&gt;timer
)paren
suffix:semicolon
)brace
r_else
(brace
id|sk_free
c_func
(paren
id|ax25-&gt;sk
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|ax25_free_cb
c_func
(paren
id|ax25
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * dl1bke 960311: set parameters for existing AX.25 connections,&n; *&t;&t;  includes a KILL command to abort any connection.&n; *&t;&t;  VERY useful for debugging ;-)&n; */
DECL|function|ax25_ctl_ioctl
r_static
r_int
id|ax25_ctl_ioctl
c_func
(paren
r_const
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|ax25_ctl_struct
id|ax25_ctl
suffix:semicolon
id|ax25_digi
id|digi
suffix:semicolon
id|ax25_dev
op_star
id|ax25_dev
suffix:semicolon
id|ax25_cb
op_star
id|ax25
suffix:semicolon
r_int
r_int
id|k
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ax25_ctl
comma
id|arg
comma
r_sizeof
(paren
id|ax25_ctl
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ax25_dev
op_assign
id|ax25_addr_ax25dev
c_func
(paren
op_amp
id|ax25_ctl.port_addr
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|ax25_ctl.digi_count
OG
id|AX25_MAX_DIGIS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|digi.ndigi
op_assign
id|ax25_ctl.digi_count
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|digi.ndigi
suffix:semicolon
id|k
op_increment
)paren
id|digi.calls
(braket
id|k
)braket
op_assign
id|ax25_ctl.digi_addr
(braket
id|k
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ax25
op_assign
id|ax25_find_cb
c_func
(paren
op_amp
id|ax25_ctl.source_addr
comma
op_amp
id|ax25_ctl.dest_addr
comma
op_amp
id|digi
comma
id|ax25_dev-&gt;dev
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
r_switch
c_cond
(paren
id|ax25_ctl.cmd
)paren
(brace
r_case
id|AX25_KILL
suffix:colon
id|ax25_send_control
c_func
(paren
id|ax25
comma
id|AX25_DISC
comma
id|AX25_POLLON
comma
id|AX25_COMMAND
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_AX25_DAMA_SLAVE
r_if
c_cond
(paren
id|ax25_dev-&gt;dama.slave
op_logical_and
id|ax25-&gt;ax25_dev-&gt;values
(braket
id|AX25_VALUES_PROTOCOL
)braket
op_eq
id|AX25_PROTO_DAMA_SLAVE
)paren
id|ax25_dama_off
c_func
(paren
id|ax25
)paren
suffix:semicolon
macro_line|#endif
id|ax25_disconnect
c_func
(paren
id|ax25
comma
id|ENETRESET
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_WINDOW
suffix:colon
r_if
c_cond
(paren
id|ax25-&gt;modulus
op_eq
id|AX25_MODULUS
)paren
(brace
r_if
c_cond
(paren
id|ax25_ctl.arg
template_param
l_int|7
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ax25_ctl.arg
template_param
l_int|63
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|ax25-&gt;window
op_assign
id|ax25_ctl.arg
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_T1
suffix:colon
r_if
c_cond
(paren
id|ax25_ctl.arg
OL
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ax25-&gt;rtt
op_assign
(paren
id|ax25_ctl.arg
op_star
id|HZ
)paren
op_div
l_int|2
suffix:semicolon
id|ax25-&gt;t1
op_assign
id|ax25_ctl.arg
op_star
id|HZ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_T2
suffix:colon
r_if
c_cond
(paren
id|ax25_ctl.arg
OL
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ax25-&gt;t2
op_assign
id|ax25_ctl.arg
op_star
id|HZ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_N2
suffix:colon
r_if
c_cond
(paren
id|ax25_ctl.arg
template_param
l_int|31
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ax25-&gt;n2count
op_assign
l_int|0
suffix:semicolon
id|ax25-&gt;n2
op_assign
id|ax25_ctl.arg
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_T3
suffix:colon
r_if
c_cond
(paren
id|ax25_ctl.arg
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ax25-&gt;t3
op_assign
id|ax25_ctl.arg
op_star
id|HZ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_IDLE
suffix:colon
r_if
c_cond
(paren
id|ax25_ctl.arg
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ax25-&gt;idle
op_assign
id|ax25_ctl.arg
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_PACLEN
suffix:colon
r_if
c_cond
(paren
id|ax25_ctl.arg
template_param
l_int|65535
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ax25-&gt;paclen
op_assign
id|ax25_ctl.arg
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Fill in a created AX.25 created control block with the default&n; *&t;values for a particular device.&n; */
DECL|function|ax25_fillin_cb
r_void
id|ax25_fillin_cb
c_func
(paren
id|ax25_cb
op_star
id|ax25
comma
id|ax25_dev
op_star
id|ax25_dev
)paren
(brace
id|ax25-&gt;ax25_dev
op_assign
id|ax25_dev
suffix:semicolon
r_if
c_cond
(paren
id|ax25-&gt;ax25_dev
op_ne
l_int|NULL
)paren
(brace
id|ax25-&gt;rtt
op_assign
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_T1
)braket
op_div
l_int|2
suffix:semicolon
id|ax25-&gt;t1
op_assign
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_T1
)braket
suffix:semicolon
id|ax25-&gt;t2
op_assign
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_T2
)braket
suffix:semicolon
id|ax25-&gt;t3
op_assign
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_T3
)braket
suffix:semicolon
id|ax25-&gt;n2
op_assign
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_N2
)braket
suffix:semicolon
id|ax25-&gt;paclen
op_assign
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_PACLEN
)braket
suffix:semicolon
id|ax25-&gt;idle
op_assign
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_IDLE
)braket
suffix:semicolon
id|ax25-&gt;backoff
op_assign
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_BACKOFF
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_AXDEFMODE
)braket
)paren
(brace
id|ax25-&gt;modulus
op_assign
id|AX25_EMODULUS
suffix:semicolon
id|ax25-&gt;window
op_assign
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_EWINDOW
)braket
suffix:semicolon
)brace
r_else
(brace
id|ax25-&gt;modulus
op_assign
id|AX25_MODULUS
suffix:semicolon
id|ax25-&gt;window
op_assign
id|ax25_dev-&gt;values
(braket
id|AX25_VALUES_WINDOW
)braket
suffix:semicolon
)brace
)brace
r_else
(brace
id|ax25-&gt;rtt
op_assign
id|AX25_DEF_T1
op_div
l_int|2
suffix:semicolon
id|ax25-&gt;t1
op_assign
id|AX25_DEF_T1
suffix:semicolon
id|ax25-&gt;t2
op_assign
id|AX25_DEF_T2
suffix:semicolon
id|ax25-&gt;t3
op_assign
id|AX25_DEF_T3
suffix:semicolon
id|ax25-&gt;n2
op_assign
id|AX25_DEF_N2
suffix:semicolon
id|ax25-&gt;paclen
op_assign
id|AX25_DEF_PACLEN
suffix:semicolon
id|ax25-&gt;idle
op_assign
id|AX25_DEF_IDLE
suffix:semicolon
id|ax25-&gt;backoff
op_assign
id|AX25_DEF_BACKOFF
suffix:semicolon
r_if
c_cond
(paren
id|AX25_DEF_AXDEFMODE
)paren
(brace
id|ax25-&gt;modulus
op_assign
id|AX25_EMODULUS
suffix:semicolon
id|ax25-&gt;window
op_assign
id|AX25_DEF_EWINDOW
suffix:semicolon
)brace
r_else
(brace
id|ax25-&gt;modulus
op_assign
id|AX25_MODULUS
suffix:semicolon
id|ax25-&gt;window
op_assign
id|AX25_DEF_WINDOW
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * Create an empty AX.25 control block.&n; */
DECL|function|ax25_create_cb
id|ax25_cb
op_star
id|ax25_create_cb
c_func
(paren
r_void
)paren
(brace
id|ax25_cb
op_star
id|ax25
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ax25
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|ax25
)paren
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|memset
c_func
(paren
id|ax25
comma
l_int|0x00
comma
r_sizeof
(paren
op_star
id|ax25
)paren
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|ax25-&gt;write_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|ax25-&gt;frag_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|ax25-&gt;ack_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|ax25-&gt;reseq_queue
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ax25-&gt;timer
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ax25-&gt;t1timer
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ax25-&gt;t2timer
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ax25-&gt;t3timer
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ax25-&gt;idletimer
)paren
suffix:semicolon
id|ax25_fillin_cb
c_func
(paren
id|ax25
comma
l_int|NULL
)paren
suffix:semicolon
id|ax25-&gt;state
op_assign
id|AX25_STATE_0
suffix:semicolon
r_return
id|ax25
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handling for system calls applied via the various interfaces to an&n; *&t;AX25 socket object&n; */
DECL|function|ax25_setsockopt
r_static
r_int
id|ax25_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_char
id|devname
(braket
id|IFNAMSIZ
)braket
suffix:semicolon
r_int
id|opt
suffix:semicolon
r_if
c_cond
(paren
id|level
op_ne
id|SOL_AX25
)paren
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_if
c_cond
(paren
id|optlen
OL
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|opt
comma
(paren
r_int
op_star
)paren
id|optval
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|AX25_WINDOW
suffix:colon
r_if
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;modulus
op_eq
id|AX25_MODULUS
)paren
(brace
r_if
c_cond
(paren
id|opt
template_param
l_int|7
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|opt
template_param
l_int|63
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|sk-&gt;protinfo.ax25-&gt;window
op_assign
id|opt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AX25_T1
suffix:colon
r_if
c_cond
(paren
id|opt
OL
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;rtt
op_assign
(paren
id|opt
op_star
id|HZ
)paren
op_div
l_int|2
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;t1
op_assign
id|opt
op_star
id|HZ
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AX25_T2
suffix:colon
r_if
c_cond
(paren
id|opt
OL
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;t2
op_assign
id|opt
op_star
id|HZ
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AX25_N2
suffix:colon
r_if
c_cond
(paren
id|opt
template_param
l_int|31
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;n2
op_assign
id|opt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AX25_T3
suffix:colon
r_if
c_cond
(paren
id|opt
OL
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;t3
op_assign
id|opt
op_star
id|HZ
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AX25_IDLE
suffix:colon
r_if
c_cond
(paren
id|opt
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;idle
op_assign
id|opt
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AX25_BACKOFF
suffix:colon
r_if
c_cond
(paren
id|opt
template_param
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;backoff
op_assign
id|opt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AX25_EXTSEQ
suffix:colon
id|sk-&gt;protinfo.ax25-&gt;modulus
op_assign
id|opt
ques
c_cond
id|AX25_EMODULUS
suffix:colon
id|AX25_MODULUS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AX25_PIDINCL
suffix:colon
id|sk-&gt;protinfo.ax25-&gt;pidincl
op_assign
id|opt
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AX25_IAMDIGI
suffix:colon
id|sk-&gt;protinfo.ax25-&gt;iamdigi
op_assign
id|opt
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AX25_PACLEN
suffix:colon
r_if
c_cond
(paren
id|opt
template_param
l_int|65535
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;paclen
op_assign
id|opt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SO_BINDTODEVICE
suffix:colon
r_if
c_cond
(paren
id|optlen
OG
id|IFNAMSIZ
)paren
id|optlen
op_assign
id|IFNAMSIZ
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|devname
comma
id|optval
comma
id|optlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|dev
op_assign
id|dev_get_by_name
c_func
(paren
id|devname
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_SEQPACKET
op_logical_and
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
op_logical_or
id|sk-&gt;state
op_eq
id|TCP_LISTEN
)paren
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;ax25_dev
op_assign
id|ax25_dev_ax25dev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ax25_fillin_cb
c_func
(paren
id|sk-&gt;protinfo.ax25
comma
id|sk-&gt;protinfo.ax25-&gt;ax25_dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
)brace
DECL|function|ax25_getsockopt
r_static
r_int
id|ax25_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|ax25_dev
op_star
id|ax25_dev
suffix:semicolon
r_char
id|devname
(braket
id|IFNAMSIZ
)braket
suffix:semicolon
r_void
op_star
id|valptr
suffix:semicolon
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_int
id|maxlen
comma
id|length
suffix:semicolon
r_if
c_cond
(paren
id|level
op_ne
id|SOL_AX25
)paren
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|maxlen
comma
id|optlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|maxlen
OL
l_int|1
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|valptr
op_assign
(paren
r_void
op_star
)paren
op_amp
id|val
suffix:semicolon
id|length
op_assign
id|min
c_func
(paren
id|maxlen
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|AX25_WINDOW
suffix:colon
id|val
op_assign
id|sk-&gt;protinfo.ax25-&gt;window
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_T1
suffix:colon
id|val
op_assign
id|sk-&gt;protinfo.ax25-&gt;t1
op_div
id|HZ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_T2
suffix:colon
id|val
op_assign
id|sk-&gt;protinfo.ax25-&gt;t2
op_div
id|HZ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_N2
suffix:colon
id|val
op_assign
id|sk-&gt;protinfo.ax25-&gt;n2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_T3
suffix:colon
id|val
op_assign
id|sk-&gt;protinfo.ax25-&gt;t3
op_div
id|HZ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_IDLE
suffix:colon
id|val
op_assign
id|sk-&gt;protinfo.ax25-&gt;idle
op_div
(paren
l_int|60
op_star
id|HZ
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_BACKOFF
suffix:colon
id|val
op_assign
id|sk-&gt;protinfo.ax25-&gt;backoff
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_EXTSEQ
suffix:colon
id|val
op_assign
(paren
id|sk-&gt;protinfo.ax25-&gt;modulus
op_eq
id|AX25_EMODULUS
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_PIDINCL
suffix:colon
id|val
op_assign
id|sk-&gt;protinfo.ax25-&gt;pidincl
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_IAMDIGI
suffix:colon
id|val
op_assign
id|sk-&gt;protinfo.ax25-&gt;iamdigi
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_PACLEN
suffix:colon
id|val
op_assign
id|sk-&gt;protinfo.ax25-&gt;paclen
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SO_BINDTODEVICE
suffix:colon
id|ax25_dev
op_assign
id|sk-&gt;protinfo.ax25-&gt;ax25_dev
suffix:semicolon
r_if
c_cond
(paren
id|ax25_dev
op_ne
l_int|NULL
op_logical_and
id|ax25_dev-&gt;dev
op_ne
l_int|NULL
)paren
(brace
id|strncpy
c_func
(paren
id|devname
comma
id|ax25_dev-&gt;dev-&gt;name
comma
id|IFNAMSIZ
)paren
suffix:semicolon
id|length
op_assign
id|min
c_func
(paren
id|strlen
c_func
(paren
id|ax25_dev-&gt;dev-&gt;name
)paren
op_plus
l_int|1
comma
id|maxlen
)paren
suffix:semicolon
id|devname
(braket
id|length
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_else
(brace
op_star
id|devname
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|length
op_assign
l_int|1
suffix:semicolon
)brace
id|valptr
op_assign
(paren
r_void
op_star
)paren
id|devname
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|length
comma
id|optlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|optval
comma
id|valptr
comma
id|length
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|ax25_listen
r_static
r_int
id|ax25_listen
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|backlog
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_SEQPACKET
op_logical_and
id|sk-&gt;state
op_ne
id|TCP_LISTEN
)paren
(brace
id|sk-&gt;max_ack_backlog
op_assign
id|backlog
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_LISTEN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|ax25_create
r_int
id|ax25_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|ax25_cb
op_star
id|ax25
suffix:semicolon
r_switch
c_cond
(paren
id|sock-&gt;type
)paren
(brace
r_case
id|SOCK_DGRAM
suffix:colon
r_if
c_cond
(paren
id|protocol
op_eq
l_int|0
op_logical_or
id|protocol
op_eq
id|PF_AX25
)paren
id|protocol
op_assign
id|AX25_P_TEXT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOCK_SEQPACKET
suffix:colon
r_switch
c_cond
(paren
id|protocol
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
id|PF_AX25
suffix:colon
multiline_comment|/* For CLX */
id|protocol
op_assign
id|AX25_P_TEXT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_P_SEGMENT
suffix:colon
macro_line|#ifdef CONFIG_INET
r_case
id|AX25_P_ARP
suffix:colon
r_case
id|AX25_P_IP
suffix:colon
macro_line|#endif
macro_line|#ifdef CONFIG_NETROM
r_case
id|AX25_P_NETROM
suffix:colon
macro_line|#endif
macro_line|#ifdef CONFIG_ROSE
r_case
id|AX25_P_ROSE
suffix:colon
macro_line|#endif
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
macro_line|#ifdef CONFIG_NETROM_MODULE
r_case
id|AX25_P_NETROM
suffix:colon
r_if
c_cond
(paren
id|ax25_protocol_is_registered
c_func
(paren
id|AX25_P_NETROM
)paren
)paren
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ROSE_MODULE
r_case
id|AX25_P_ROSE
suffix:colon
r_if
c_cond
(paren
id|ax25_protocol_is_registered
c_func
(paren
id|AX25_P_ROSE
)paren
)paren
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SOCK_RAW
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|PF_AX25
comma
id|GFP_ATOMIC
comma
l_int|1
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ax25
op_assign
id|ax25_create_cb
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk-&gt;destruct
op_assign
id|ax25_free_sock
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|ax25_proto_ops
suffix:semicolon
id|sk-&gt;protocol
op_assign
id|protocol
suffix:semicolon
id|ax25-&gt;sk
op_assign
id|sk
suffix:semicolon
id|sk-&gt;protinfo.ax25
op_assign
id|ax25
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ax25_make_new
r_struct
id|sock
op_star
id|ax25_make_new
c_func
(paren
r_struct
id|sock
op_star
id|osk
comma
r_struct
id|ax25_dev
op_star
id|ax25_dev
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|ax25_cb
op_star
id|ax25
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|PF_AX25
comma
id|GFP_ATOMIC
comma
l_int|1
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ax25
op_assign
id|ax25_create_cb
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|osk-&gt;type
)paren
(brace
r_case
id|SOCK_DGRAM
suffix:colon
r_break
suffix:semicolon
r_case
id|SOCK_SEQPACKET
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
id|ax25_free_cb
c_func
(paren
id|ax25
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|sock_init_data
c_func
(paren
l_int|NULL
comma
id|sk
)paren
suffix:semicolon
id|sk-&gt;destruct
op_assign
id|ax25_free_sock
suffix:semicolon
id|sk-&gt;type
op_assign
id|osk-&gt;type
suffix:semicolon
id|sk-&gt;socket
op_assign
id|osk-&gt;socket
suffix:semicolon
id|sk-&gt;priority
op_assign
id|osk-&gt;priority
suffix:semicolon
id|sk-&gt;protocol
op_assign
id|osk-&gt;protocol
suffix:semicolon
id|sk-&gt;rcvbuf
op_assign
id|osk-&gt;rcvbuf
suffix:semicolon
id|sk-&gt;sndbuf
op_assign
id|osk-&gt;sndbuf
suffix:semicolon
id|sk-&gt;debug
op_assign
id|osk-&gt;debug
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_ESTABLISHED
suffix:semicolon
id|sk-&gt;sleep
op_assign
id|osk-&gt;sleep
suffix:semicolon
id|sk-&gt;zapped
op_assign
id|osk-&gt;zapped
suffix:semicolon
id|ax25-&gt;modulus
op_assign
id|osk-&gt;protinfo.ax25-&gt;modulus
suffix:semicolon
id|ax25-&gt;backoff
op_assign
id|osk-&gt;protinfo.ax25-&gt;backoff
suffix:semicolon
id|ax25-&gt;pidincl
op_assign
id|osk-&gt;protinfo.ax25-&gt;pidincl
suffix:semicolon
id|ax25-&gt;iamdigi
op_assign
id|osk-&gt;protinfo.ax25-&gt;iamdigi
suffix:semicolon
id|ax25-&gt;rtt
op_assign
id|osk-&gt;protinfo.ax25-&gt;rtt
suffix:semicolon
id|ax25-&gt;t1
op_assign
id|osk-&gt;protinfo.ax25-&gt;t1
suffix:semicolon
id|ax25-&gt;t2
op_assign
id|osk-&gt;protinfo.ax25-&gt;t2
suffix:semicolon
id|ax25-&gt;t3
op_assign
id|osk-&gt;protinfo.ax25-&gt;t3
suffix:semicolon
id|ax25-&gt;n2
op_assign
id|osk-&gt;protinfo.ax25-&gt;n2
suffix:semicolon
id|ax25-&gt;idle
op_assign
id|osk-&gt;protinfo.ax25-&gt;idle
suffix:semicolon
id|ax25-&gt;paclen
op_assign
id|osk-&gt;protinfo.ax25-&gt;paclen
suffix:semicolon
id|ax25-&gt;window
op_assign
id|osk-&gt;protinfo.ax25-&gt;window
suffix:semicolon
id|ax25-&gt;ax25_dev
op_assign
id|ax25_dev
suffix:semicolon
id|ax25-&gt;source_addr
op_assign
id|osk-&gt;protinfo.ax25-&gt;source_addr
suffix:semicolon
r_if
c_cond
(paren
id|osk-&gt;protinfo.ax25-&gt;digipeat
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|ax25-&gt;digipeat
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|ax25_digi
)paren
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|ax25-&gt;digipeat
comma
id|osk-&gt;protinfo.ax25-&gt;digipeat
comma
r_sizeof
(paren
id|ax25_digi
)paren
)paren
suffix:semicolon
)brace
id|sk-&gt;protinfo.ax25
op_assign
id|ax25
suffix:semicolon
id|ax25-&gt;sk
op_assign
id|sk
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
DECL|function|ax25_release
r_static
r_int
id|ax25_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_SEQPACKET
)paren
(brace
r_switch
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;state
)paren
(brace
r_case
id|AX25_STATE_0
suffix:colon
id|ax25_disconnect
c_func
(paren
id|sk-&gt;protinfo.ax25
comma
l_int|0
)paren
suffix:semicolon
id|ax25_destroy_socket
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_STATE_1
suffix:colon
r_case
id|AX25_STATE_2
suffix:colon
id|ax25_send_control
c_func
(paren
id|sk-&gt;protinfo.ax25
comma
id|AX25_DISC
comma
id|AX25_POLLON
comma
id|AX25_COMMAND
)paren
suffix:semicolon
id|ax25_disconnect
c_func
(paren
id|sk-&gt;protinfo.ax25
comma
l_int|0
)paren
suffix:semicolon
id|ax25_destroy_socket
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AX25_STATE_3
suffix:colon
r_case
id|AX25_STATE_4
suffix:colon
id|ax25_clear_queues
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;n2count
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;ax25_dev-&gt;values
(braket
id|AX25_VALUES_PROTOCOL
)braket
)paren
(brace
r_case
id|AX25_PROTO_STD_SIMPLEX
suffix:colon
r_case
id|AX25_PROTO_STD_DUPLEX
suffix:colon
id|ax25_send_control
c_func
(paren
id|sk-&gt;protinfo.ax25
comma
id|AX25_DISC
comma
id|AX25_POLLON
comma
id|AX25_COMMAND
)paren
suffix:semicolon
id|ax25_stop_t2timer
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
id|ax25_stop_t3timer
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
id|ax25_stop_idletimer
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_AX25_DAMA_SLAVE
r_case
id|AX25_PROTO_DAMA_SLAVE
suffix:colon
id|ax25_stop_t3timer
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
id|ax25_stop_idletimer
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
id|ax25_calculate_t1
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
id|ax25_start_t1timer
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;state
op_assign
id|AX25_STATE_2
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_CLOSE
suffix:semicolon
id|sk-&gt;shutdown
op_or_assign
id|SEND_SHUTDOWN
suffix:semicolon
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;dead
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;destroy
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|sk-&gt;state
op_assign
id|TCP_CLOSE
suffix:semicolon
id|sk-&gt;shutdown
op_or_assign
id|SEND_SHUTDOWN
suffix:semicolon
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;dead
op_assign
l_int|1
suffix:semicolon
id|ax25_destroy_socket
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
)brace
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;socket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Not used, but we should do this */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;We support a funny extension here so you can (as root) give any callsign&n; *&t;digipeated via a local address as source. This hack is obsolete now&n; *&t;that we&squot;ve implemented support for SO_BINDTODEVICE. It is however small &n; *&t;and trivially backward compatible.&n; */
DECL|function|ax25_bind
r_static
r_int
id|ax25_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|full_sockaddr_ax25
op_star
id|addr
op_assign
(paren
r_struct
id|full_sockaddr_ax25
op_star
)paren
id|uaddr
suffix:semicolon
id|ax25_address
op_star
id|call
suffix:semicolon
id|ax25_dev
op_star
id|ax25_dev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;zapped
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|addr_len
op_ne
r_sizeof
(paren
r_struct
id|sockaddr_ax25
)paren
op_logical_and
id|addr_len
op_ne
r_sizeof
(paren
r_struct
id|full_sockaddr_ax25
)paren
)paren
(brace
multiline_comment|/* support for old structure may go away some time */
r_if
c_cond
(paren
(paren
id|addr_len
OL
r_sizeof
(paren
r_struct
id|sockaddr_ax25
)paren
op_plus
r_sizeof
(paren
id|ax25_address
)paren
op_star
l_int|6
)paren
op_logical_or
(paren
id|addr_len
OG
r_sizeof
(paren
r_struct
id|full_sockaddr_ax25
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ax25_bind(): %s uses old (6 digipeater) socket structure.&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr-&gt;fsa_ax25.sax25_family
op_ne
id|AF_AX25
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|call
op_assign
id|ax25_findbyuid
c_func
(paren
id|current-&gt;euid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|call
op_eq
l_int|NULL
op_logical_and
id|ax25_uid_policy
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|call
op_eq
l_int|NULL
)paren
id|sk-&gt;protinfo.ax25-&gt;source_addr
op_assign
id|addr-&gt;fsa_ax25.sax25_call
suffix:semicolon
r_else
id|sk-&gt;protinfo.ax25-&gt;source_addr
op_assign
op_star
id|call
suffix:semicolon
multiline_comment|/*&n;&t; * User already set interface with SO_BINDTODEVICE&n;&t; */
r_if
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;ax25_dev
op_ne
l_int|NULL
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|addr_len
OG
r_sizeof
(paren
r_struct
id|sockaddr_ax25
)paren
op_logical_and
id|addr-&gt;fsa_ax25.sax25_ndigis
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ax25cmp
c_func
(paren
op_amp
id|addr-&gt;fsa_digipeater
(braket
l_int|0
)braket
comma
op_amp
id|null_ax25_address
)paren
op_ne
l_int|0
op_logical_and
(paren
id|ax25_dev
op_assign
id|ax25_addr_ax25dev
c_func
(paren
op_amp
id|addr-&gt;fsa_digipeater
(braket
l_int|0
)braket
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|ax25_dev
op_assign
id|ax25_addr_ax25dev
c_func
(paren
op_amp
id|addr-&gt;fsa_ax25.sax25_call
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ax25_dev
op_ne
l_int|NULL
)paren
id|ax25_fillin_cb
c_func
(paren
id|sk-&gt;protinfo.ax25
comma
id|ax25_dev
)paren
suffix:semicolon
id|done
suffix:colon
id|ax25_insert_socket
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
id|sk-&gt;zapped
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;FIXME: nonblock behaviour looks like it may have a bug.&n; */
DECL|function|ax25_connect
r_static
r_int
id|ax25_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|full_sockaddr_ax25
op_star
id|fsa
op_assign
(paren
r_struct
id|full_sockaddr_ax25
op_star
)paren
id|uaddr
suffix:semicolon
id|ax25_digi
op_star
id|digi
op_assign
l_int|NULL
suffix:semicolon
r_int
id|ct
op_assign
l_int|0
comma
id|err
suffix:semicolon
multiline_comment|/* deal with restarts */
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTING
)paren
(brace
r_switch
c_cond
(paren
id|sk-&gt;state
)paren
(brace
r_case
id|TCP_SYN_SENT
suffix:colon
multiline_comment|/* still trying */
r_return
op_minus
id|EINPROGRESS
suffix:semicolon
r_case
id|TCP_ESTABLISHED
suffix:colon
multiline_comment|/* connection established */
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|TCP_CLOSE
suffix:colon
multiline_comment|/* connection refused */
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
r_return
op_minus
id|ECONNREFUSED
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sk-&gt;state
op_eq
id|TCP_ESTABLISHED
op_logical_and
id|sk-&gt;type
op_eq
id|SOCK_SEQPACKET
)paren
r_return
op_minus
id|EISCONN
suffix:semicolon
multiline_comment|/* No reconnect on a seqpacket socket */
id|sk-&gt;state
op_assign
id|TCP_CLOSE
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
multiline_comment|/*&n;&t; * some sanity checks. code further down depends on this&n;&t; */
r_if
c_cond
(paren
id|addr_len
op_eq
r_sizeof
(paren
r_struct
id|sockaddr_ax25
)paren
)paren
(brace
multiline_comment|/* support for this will go away in early 2.5.x */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ax25_connect(): %s uses obsolete socket structure&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|addr_len
op_ne
r_sizeof
(paren
r_struct
id|full_sockaddr_ax25
)paren
)paren
(brace
multiline_comment|/* support for old structure may go away some time */
r_if
c_cond
(paren
(paren
id|addr_len
OL
r_sizeof
(paren
r_struct
id|sockaddr_ax25
)paren
op_plus
r_sizeof
(paren
id|ax25_address
)paren
op_star
l_int|6
)paren
op_logical_or
(paren
id|addr_len
OG
r_sizeof
(paren
r_struct
id|full_sockaddr_ax25
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ax25_connect(): %s uses old (6 digipeater) socket structure.&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fsa-&gt;fsa_ax25.sax25_family
op_ne
id|AF_AX25
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;digipeat
op_ne
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|sk-&gt;protinfo.ax25-&gt;digipeat
)paren
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;digipeat
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Handle digi-peaters to be used.&n;&t; */
r_if
c_cond
(paren
id|addr_len
OG
r_sizeof
(paren
r_struct
id|sockaddr_ax25
)paren
op_logical_and
id|fsa-&gt;fsa_ax25.sax25_ndigis
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Valid number of digipeaters ? */
r_if
c_cond
(paren
id|fsa-&gt;fsa_ax25.sax25_ndigis
template_param
id|AX25_MAX_DIGIS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|digi
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|ax25_digi
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|digi-&gt;ndigi
op_assign
id|fsa-&gt;fsa_ax25.sax25_ndigis
suffix:semicolon
id|digi-&gt;lastrepeat
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|ct
OL
id|fsa-&gt;fsa_ax25.sax25_ndigis
)paren
(brace
r_if
c_cond
(paren
(paren
id|fsa-&gt;fsa_digipeater
(braket
id|ct
)braket
dot
id|ax25_call
(braket
l_int|6
)braket
op_amp
id|AX25_HBIT
)paren
op_logical_and
id|sk-&gt;protinfo.ax25-&gt;iamdigi
)paren
(brace
id|digi-&gt;repeated
(braket
id|ct
)braket
op_assign
l_int|1
suffix:semicolon
id|digi-&gt;lastrepeat
op_assign
id|ct
suffix:semicolon
)brace
r_else
(brace
id|digi-&gt;repeated
(braket
id|ct
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|digi-&gt;calls
(braket
id|ct
)braket
op_assign
id|fsa-&gt;fsa_digipeater
(braket
id|ct
)braket
suffix:semicolon
id|ct
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;Must bind first - autobinding in this may or may not work. If&n;&t; *&t;the socket is already bound, check to see if the device has&n;&t; *&t;been filled in, error if it hasn&squot;t.&n;&t; */
r_if
c_cond
(paren
id|sk-&gt;zapped
)paren
(brace
multiline_comment|/* check if we can remove this feature. It is broken. */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ax25_connect(): %s uses autobind, please contact jreuter@yaina.de&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ax25_rt_autobind
c_func
(paren
id|sk-&gt;protinfo.ax25
comma
op_amp
id|fsa-&gt;fsa_ax25.sax25_call
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|ax25_fillin_cb
c_func
(paren
id|sk-&gt;protinfo.ax25
comma
id|sk-&gt;protinfo.ax25-&gt;ax25_dev
)paren
suffix:semicolon
id|ax25_insert_socket
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;ax25_dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EHOSTUNREACH
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_SEQPACKET
op_logical_and
id|ax25_find_cb
c_func
(paren
op_amp
id|sk-&gt;protinfo.ax25-&gt;source_addr
comma
op_amp
id|fsa-&gt;fsa_ax25.sax25_call
comma
id|digi
comma
id|sk-&gt;protinfo.ax25-&gt;ax25_dev-&gt;dev
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|digi
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|digi
)paren
suffix:semicolon
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
multiline_comment|/* Already such a connection */
)brace
id|sk-&gt;protinfo.ax25-&gt;dest_addr
op_assign
id|fsa-&gt;fsa_ax25.sax25_call
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;digipeat
op_assign
id|digi
suffix:semicolon
multiline_comment|/* First the easy one */
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_SEQPACKET
)paren
(brace
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_ESTABLISHED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Move to connecting socket, ax.25 lapb WAIT_UA.. */
id|sock-&gt;state
op_assign
id|SS_CONNECTING
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_SYN_SENT
suffix:semicolon
r_switch
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;ax25_dev-&gt;values
(braket
id|AX25_VALUES_PROTOCOL
)braket
)paren
(brace
r_case
id|AX25_PROTO_STD_SIMPLEX
suffix:colon
r_case
id|AX25_PROTO_STD_DUPLEX
suffix:colon
id|ax25_std_establish_data_link
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_AX25_DAMA_SLAVE
r_case
id|AX25_PROTO_DAMA_SLAVE
suffix:colon
id|sk-&gt;protinfo.ax25-&gt;modulus
op_assign
id|AX25_MODULUS
suffix:semicolon
id|sk-&gt;protinfo.ax25-&gt;window
op_assign
id|sk-&gt;protinfo.ax25-&gt;ax25_dev-&gt;values
(braket
id|AX25_VALUES_WINDOW
)braket
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;ax25_dev-&gt;dama.slave
)paren
id|ax25_ds_establish_data_link
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
r_else
id|ax25_std_establish_data_link
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
id|sk-&gt;protinfo.ax25-&gt;state
op_assign
id|AX25_STATE_1
suffix:semicolon
id|ax25_start_heartbeat
c_func
(paren
id|sk-&gt;protinfo.ax25
)paren
suffix:semicolon
multiline_comment|/* Now the loop */
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
op_logical_and
(paren
id|flags
op_amp
id|O_NONBLOCK
)paren
)paren
r_return
op_minus
id|EINPROGRESS
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* To avoid races on the sleep */
multiline_comment|/* A DM or timeout will go to closed, a UA will go to ABM */
r_while
c_loop
(paren
id|sk-&gt;state
op_eq
id|TCP_SYN_SENT
)paren
(brace
id|interruptible_sleep_on
c_func
(paren
id|sk-&gt;sleep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
(brace
multiline_comment|/* Not in ABM, not in WAIT_UA -&gt; failed */
id|sti
c_func
(paren
)paren
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
r_return
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* Always set at this point */
)brace
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ax25_accept
r_static
r_int
id|ax25_accept
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|newsock
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|sock
op_star
id|newsk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sk
op_assign
id|sock-&gt;sk
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_SEQPACKET
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_LISTEN
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t; *&t;The read queue this time is holding sockets ready to use&n;&t; *&t;hooked into the SABM we saved&n;&t; */
r_do
(brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|O_NONBLOCK
)paren
r_return
op_minus
id|EWOULDBLOCK
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
id|sk-&gt;sleep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|skb
op_eq
l_int|NULL
)paren
suffix:semicolon
id|newsk
op_assign
id|skb-&gt;sk
suffix:semicolon
id|newsk-&gt;pair
op_assign
l_int|NULL
suffix:semicolon
id|newsk-&gt;socket
op_assign
id|newsock
suffix:semicolon
id|newsk-&gt;sleep
op_assign
op_amp
id|newsock-&gt;wait
suffix:semicolon
multiline_comment|/* Now attach up the new socket */
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|sk-&gt;ack_backlog
op_decrement
suffix:semicolon
id|newsock-&gt;sk
op_assign
id|newsk
suffix:semicolon
id|newsock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ax25_getname
r_static
r_int
id|ax25_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddr_len
comma
r_int
id|peer
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|full_sockaddr_ax25
op_star
id|fsa
op_assign
(paren
r_struct
id|full_sockaddr_ax25
op_star
)paren
id|uaddr
suffix:semicolon
r_int
r_char
id|ndigi
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|peer
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|fsa-&gt;fsa_ax25.sax25_family
op_assign
id|AF_AX25
suffix:semicolon
id|fsa-&gt;fsa_ax25.sax25_call
op_assign
id|sk-&gt;protinfo.ax25-&gt;dest_addr
suffix:semicolon
id|fsa-&gt;fsa_ax25.sax25_ndigis
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;digipeat
op_ne
l_int|NULL
)paren
(brace
id|ndigi
op_assign
id|sk-&gt;protinfo.ax25-&gt;digipeat-&gt;ndigi
suffix:semicolon
id|fsa-&gt;fsa_ax25.sax25_ndigis
op_assign
id|ndigi
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ndigi
suffix:semicolon
id|i
op_increment
)paren
id|fsa-&gt;fsa_digipeater
(braket
id|i
)braket
op_assign
id|sk-&gt;protinfo.ax25-&gt;digipeat-&gt;calls
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
r_else
(brace
id|fsa-&gt;fsa_ax25.sax25_family
op_assign
id|AF_AX25
suffix:semicolon
id|fsa-&gt;fsa_ax25.sax25_call
op_assign
id|sk-&gt;protinfo.ax25-&gt;source_addr
suffix:semicolon
id|fsa-&gt;fsa_ax25.sax25_ndigis
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;ax25_dev
op_ne
l_int|NULL
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|fsa-&gt;fsa_digipeater
(braket
l_int|0
)braket
comma
id|sk-&gt;protinfo.ax25-&gt;ax25_dev-&gt;dev-&gt;dev_addr
comma
id|AX25_ADDR_LEN
)paren
suffix:semicolon
)brace
r_else
(brace
id|fsa-&gt;fsa_digipeater
(braket
l_int|0
)braket
op_assign
id|null_ax25_address
suffix:semicolon
)brace
)brace
op_star
id|uaddr_len
op_assign
r_sizeof
(paren
r_struct
id|full_sockaddr_ax25
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ax25_sendmsg
r_static
r_int
id|ax25_sendmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_ax25
op_star
id|usax
op_assign
(paren
r_struct
id|sockaddr_ax25
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|sockaddr_ax25
id|sax
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
op_star
id|asmptr
suffix:semicolon
r_int
id|size
suffix:semicolon
id|ax25_digi
op_star
id|dp
suffix:semicolon
id|ax25_digi
id|dtmp
suffix:semicolon
r_int
id|lv
suffix:semicolon
r_int
id|addr_len
op_assign
id|msg-&gt;msg_namelen
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_flags
op_amp
op_complement
(paren
id|MSG_DONTWAIT
op_or
id|MSG_EOR
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;zapped
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;shutdown
op_amp
id|SEND_SHUTDOWN
)paren
(brace
id|send_sig
c_func
(paren
id|SIGPIPE
comma
id|current
comma
l_int|0
)paren
suffix:semicolon
r_return
op_minus
id|EPIPE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;protinfo.ax25-&gt;ax25_dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
r_if
c_cond
(paren
id|usax
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|usax-&gt;sax25_family
op_ne
id|AF_AX25
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|addr_len
op_eq
r_sizeof
(paren
r_struct
id|sockaddr_ax25
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ax25_sendmsg(): %s uses obsolete socket structure&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|addr_len
op_ne
r_sizeof
(paren
r_struct
id|full_sockaddr_ax25
)paren
)paren
(brace
multiline_comment|/* support for old structure may go away some time */
r_if
c_cond
(paren
(paren
id|addr_len
OL
r_sizeof
(paren
r_struct
id|sockaddr_ax25
)paren
op_plus
r_sizeof
(paren
id|ax25_address
)paren
op_star
l_int|6
)paren
op_logical_or
(paren
id|addr_len
OG
r_sizeof
(paren
r_struct
id|full_sockaddr_ax25
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ax25_sendmsg(): %s uses old (6 digipeater) socket structure.&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr_len
OG
r_sizeof
(paren
r_struct
id|sockaddr_ax25
)paren
op_logical_and
id|usax-&gt;sax25_ndigis
op_ne
l_int|0
)paren
(brace
r_int
id|ct
op_assign
l_int|0
suffix:semicolon
r_struct
id|full_sockaddr_ax25
op_star
id|fsa
op_assign
(paren
r_struct
id|full_sockaddr_ax25
op_star
)paren
id|usax
suffix:semicolon
multiline_comment|/* Valid number of digipeaters ? */
r_if
c_cond
(paren
id|usax-&gt;sax25_ndigis
template_param
id|AX25_MAX_DIGIS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dtmp.ndigi
op_assign
id|usax-&gt;sax25_ndigis
suffix:semicolon
r_while
c_loop
(paren
id|ct
OL
id|usax-&gt;sax25_ndigis
)paren
(brace
id|dtmp.repeated
(braket
id|ct
)braket
op_assign
l_int|0
suffix:semicolon
id|dtmp.calls
(braket
id|ct
)braket
op_assign
id|fsa-&gt;fsa_digipeater
(braket
id|ct
)braket
suffix:semicolon
id|ct
op_increment
suffix:semicolon
)brace
id|dtmp.lastrepeat
op_assign
l_int|0
suffix:semicolon
)brace
id|sax
op_assign
op_star
id|usax
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_SEQPACKET
op_logical_and
id|ax25cmp
c_func
(paren
op_amp
id|sk-&gt;protinfo.ax25-&gt;dest_addr
comma
op_amp
id|sax.sax25_call
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EISCONN
suffix:semicolon
r_if
c_cond
(paren
id|usax-&gt;sax25_ndigis
op_eq
l_int|0
)paren
id|dp
op_assign
l_int|NULL
suffix:semicolon
r_else
id|dp
op_assign
op_amp
id|dtmp
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; *&t;FIXME: 1003.1g - if the socket is like this because&n;&t;&t; *&t;it has become closed (not started closed) and is VC&n;&t;&t; *&t;we ought to SIGPIPE, EPIPE&n;&t;&t; */
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|sax.sax25_family
op_assign
id|AF_AX25
suffix:semicolon
id|sax.sax25_call
op_assign
id|sk-&gt;protinfo.ax25-&gt;dest_addr
suffix:semicolon
id|dp
op_assign
id|sk-&gt;protinfo.ax25-&gt;digipeat
suffix:semicolon
)brace
id|SOCK_DEBUG
c_func
(paren
id|sk
comma
l_string|&quot;AX.25: sendto: Addresses built.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Build a packet */
id|SOCK_DEBUG
c_func
(paren
id|sk
comma
l_string|&quot;AX.25: sendto: building packet.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Assume the worst case */
id|size
op_assign
id|len
op_plus
l_int|3
op_plus
id|ax25_addr_size
c_func
(paren
id|dp
)paren
op_plus
id|AX25_BPQ_HEADER_LEN
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|size
comma
l_int|0
comma
id|msg-&gt;msg_flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|err
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|err
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|size
op_minus
id|len
)paren
suffix:semicolon
id|SOCK_DEBUG
c_func
(paren
id|sk
comma
l_string|&quot;AX.25: Appending user data&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* User data follows immediately after the AX.25 data */
id|memcpy_fromiovec
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|msg-&gt;msg_iov
comma
id|len
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Add the PID if one is not supplied by the user in the skb */
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;protinfo.ax25-&gt;pidincl
)paren
(brace
id|asmptr
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
op_star
id|asmptr
op_assign
id|sk-&gt;protocol
suffix:semicolon
)brace
id|SOCK_DEBUG
c_func
(paren
id|sk
comma
l_string|&quot;AX.25: Transmitting buffer&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_SEQPACKET
)paren
(brace
multiline_comment|/* Connected mode sockets go via the LAPB machine */
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENOTCONN
suffix:semicolon
)brace
id|ax25_output
c_func
(paren
id|sk-&gt;protinfo.ax25
comma
id|sk-&gt;protinfo.ax25-&gt;paclen
comma
id|skb
)paren
suffix:semicolon
multiline_comment|/* Shove it onto the queue and kick */
r_return
id|len
suffix:semicolon
)brace
r_else
(brace
id|asmptr
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|1
op_plus
id|ax25_addr_size
c_func
(paren
id|dp
)paren
)paren
suffix:semicolon
id|SOCK_DEBUG
c_func
(paren
id|sk
comma
l_string|&quot;Building AX.25 Header (dp=%p).&bslash;n&quot;
comma
id|dp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dp
op_ne
l_int|NULL
)paren
id|SOCK_DEBUG
c_func
(paren
id|sk
comma
l_string|&quot;Num digipeaters=%d&bslash;n&quot;
comma
id|dp-&gt;ndigi
)paren
suffix:semicolon
multiline_comment|/* Build an AX.25 header */
id|asmptr
op_add_assign
(paren
id|lv
op_assign
id|ax25_addr_build
c_func
(paren
id|asmptr
comma
op_amp
id|sk-&gt;protinfo.ax25-&gt;source_addr
comma
op_amp
id|sax.sax25_call
comma
id|dp
comma
id|AX25_COMMAND
comma
id|AX25_MODULUS
)paren
)paren
suffix:semicolon
id|SOCK_DEBUG
c_func
(paren
id|sk
comma
l_string|&quot;Built header (%d bytes)&bslash;n&quot;
comma
id|lv
)paren
suffix:semicolon
id|skb-&gt;h.raw
op_assign
id|asmptr
suffix:semicolon
id|SOCK_DEBUG
c_func
(paren
id|sk
comma
l_string|&quot;base=%p pos=%p&bslash;n&quot;
comma
id|skb-&gt;data
comma
id|asmptr
)paren
suffix:semicolon
op_star
id|asmptr
op_assign
id|AX25_UI
suffix:semicolon
multiline_comment|/* Datagram frames go straight out of the door as UI */
id|skb-&gt;dev
op_assign
id|sk-&gt;protinfo.ax25-&gt;ax25_dev-&gt;dev
suffix:semicolon
id|ax25_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
)brace
DECL|function|ax25_recvmsg
r_static
r_int
id|ax25_recvmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
comma
r_int
id|flags
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|copied
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|er
suffix:semicolon
multiline_comment|/*&n;&t; * &t;This works for seqpacket too. The receiver has ordered the&n;&t; *&t;queue for us! We do one quick check first though&n;&t; */
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_SEQPACKET
op_logical_and
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
multiline_comment|/* Now we can treat all alike */
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_recv_datagram
c_func
(paren
id|sk
comma
id|flags
op_amp
op_complement
id|MSG_DONTWAIT
comma
id|flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|er
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|er
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;protinfo.ax25-&gt;pidincl
)paren
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Remove PID */
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|copied
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|copied
OG
id|size
)paren
(brace
id|copied
op_assign
id|size
suffix:semicolon
id|msg-&gt;msg_flags
op_or_assign
id|MSG_TRUNC
suffix:semicolon
)brace
id|skb_copy_datagram_iovec
c_func
(paren
id|skb
comma
l_int|0
comma
id|msg-&gt;msg_iov
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_namelen
op_ne
l_int|0
)paren
(brace
r_struct
id|sockaddr_ax25
op_star
id|sax
op_assign
(paren
r_struct
id|sockaddr_ax25
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
id|ax25_digi
id|digi
suffix:semicolon
id|ax25_address
id|dest
suffix:semicolon
id|ax25_addr_parse
c_func
(paren
id|skb-&gt;mac.raw
op_plus
l_int|1
comma
id|skb-&gt;data
op_minus
id|skb-&gt;mac.raw
op_minus
l_int|1
comma
l_int|NULL
comma
op_amp
id|dest
comma
op_amp
id|digi
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|sax-&gt;sax25_family
op_assign
id|AF_AX25
suffix:semicolon
multiline_comment|/* We set this correctly, even though we may not let the&n;&t;&t;   application know the digi calls further down (because it&n;&t;&t;   did NOT ask to know them).  This could get political... **/
id|sax-&gt;sax25_ndigis
op_assign
id|digi.ndigi
suffix:semicolon
id|sax-&gt;sax25_call
op_assign
id|dest
suffix:semicolon
r_if
c_cond
(paren
id|sax-&gt;sax25_ndigis
op_ne
l_int|0
)paren
(brace
r_int
id|ct
suffix:semicolon
r_struct
id|full_sockaddr_ax25
op_star
id|fsa
op_assign
(paren
r_struct
id|full_sockaddr_ax25
op_star
)paren
id|sax
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|digi.ndigi
suffix:semicolon
id|ct
op_increment
)paren
id|fsa-&gt;fsa_digipeater
(braket
id|ct
)braket
op_assign
id|digi.calls
(braket
id|ct
)braket
suffix:semicolon
)brace
id|msg-&gt;msg_namelen
op_assign
r_sizeof
(paren
r_struct
id|full_sockaddr_ax25
)paren
suffix:semicolon
)brace
id|skb_free_datagram
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
r_return
id|copied
suffix:semicolon
)brace
DECL|function|ax25_shutdown
r_static
r_int
id|ax25_shutdown
c_func
(paren
r_struct
id|socket
op_star
id|sk
comma
r_int
id|how
)paren
(brace
multiline_comment|/* FIXME - generate DM and RNR states */
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|ax25_ioctl
r_static
r_int
id|ax25_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|TIOCOUTQ
suffix:colon
(brace
r_int
id|amount
suffix:semicolon
id|amount
op_assign
id|sk-&gt;sndbuf
op_minus
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amount
OL
l_int|0
)paren
id|amount
op_assign
l_int|0
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|amount
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_case
id|TIOCINQ
suffix:colon
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|amount
op_assign
l_int|0L
suffix:semicolon
multiline_comment|/* These two are safe on a single CPU system as only user tasks fiddle here */
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
)paren
op_ne
l_int|NULL
)paren
id|amount
op_assign
id|skb-&gt;len
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|amount
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_case
id|SIOCGSTAMP
suffix:colon
r_if
c_cond
(paren
id|sk
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;stamp.tv_sec
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|sk-&gt;stamp
comma
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SIOCAX25ADDUID
suffix:colon
multiline_comment|/* Add a uid to the uid/call map table */
r_case
id|SIOCAX25DELUID
suffix:colon
multiline_comment|/* Delete a uid from the uid/call map table */
r_case
id|SIOCAX25GETUID
suffix:colon
(brace
r_struct
id|sockaddr_ax25
id|sax25
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|sax25
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|sax25
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|ax25_uid_ioctl
c_func
(paren
id|cmd
comma
op_amp
id|sax25
)paren
suffix:semicolon
)brace
r_case
id|SIOCAX25NOUID
suffix:colon
(brace
multiline_comment|/* Set the default policy (default/bar) */
r_int
id|amount
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|amount
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|amount
OG
id|AX25_NOUID_BLOCK
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ax25_uid_policy
op_assign
id|amount
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SIOCADDRT
suffix:colon
r_case
id|SIOCDELRT
suffix:colon
r_case
id|SIOCAX25OPTRT
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_return
id|ax25_rt_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCAX25CTLCON
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_return
id|ax25_ctl_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCAX25GETINFO
suffix:colon
r_case
id|SIOCAX25GETINFOOLD
suffix:colon
(brace
r_struct
id|ax25_info_struct
id|ax25_info
suffix:semicolon
id|ax25_info.t1
op_assign
id|sk-&gt;protinfo.ax25-&gt;t1
op_div
id|HZ
suffix:semicolon
id|ax25_info.t2
op_assign
id|sk-&gt;protinfo.ax25-&gt;t2
op_div
id|HZ
suffix:semicolon
id|ax25_info.t3
op_assign
id|sk-&gt;protinfo.ax25-&gt;t3
op_div
id|HZ
suffix:semicolon
id|ax25_info.idle
op_assign
id|sk-&gt;protinfo.ax25-&gt;idle
op_div
(paren
l_int|60
op_star
id|HZ
)paren
suffix:semicolon
id|ax25_info.n2
op_assign
id|sk-&gt;protinfo.ax25-&gt;n2
suffix:semicolon
id|ax25_info.t1timer
op_assign
id|ax25_display_timer
c_func
(paren
op_amp
id|sk-&gt;protinfo.ax25-&gt;t1timer
)paren
op_div
id|HZ
suffix:semicolon
id|ax25_info.t2timer
op_assign
id|ax25_display_timer
c_func
(paren
op_amp
id|sk-&gt;protinfo.ax25-&gt;t2timer
)paren
op_div
id|HZ
suffix:semicolon
id|ax25_info.t3timer
op_assign
id|ax25_display_timer
c_func
(paren
op_amp
id|sk-&gt;protinfo.ax25-&gt;t3timer
)paren
op_div
id|HZ
suffix:semicolon
id|ax25_info.idletimer
op_assign
id|ax25_display_timer
c_func
(paren
op_amp
id|sk-&gt;protinfo.ax25-&gt;idletimer
)paren
op_div
(paren
l_int|60
op_star
id|HZ
)paren
suffix:semicolon
id|ax25_info.n2count
op_assign
id|sk-&gt;protinfo.ax25-&gt;n2count
suffix:semicolon
id|ax25_info.state
op_assign
id|sk-&gt;protinfo.ax25-&gt;state
suffix:semicolon
id|ax25_info.rcv_q
op_assign
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
suffix:semicolon
id|ax25_info.snd_q
op_assign
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
suffix:semicolon
id|ax25_info.vs
op_assign
id|sk-&gt;protinfo.ax25-&gt;vs
suffix:semicolon
id|ax25_info.vr
op_assign
id|sk-&gt;protinfo.ax25-&gt;vr
suffix:semicolon
id|ax25_info.va
op_assign
id|sk-&gt;protinfo.ax25-&gt;va
suffix:semicolon
id|ax25_info.vs_max
op_assign
id|sk-&gt;protinfo.ax25-&gt;vs
suffix:semicolon
multiline_comment|/* reserved */
id|ax25_info.paclen
op_assign
id|sk-&gt;protinfo.ax25-&gt;paclen
suffix:semicolon
id|ax25_info.window
op_assign
id|sk-&gt;protinfo.ax25-&gt;window
suffix:semicolon
multiline_comment|/* old structure? */
r_if
c_cond
(paren
id|cmd
op_eq
id|SIOCAX25GETINFOOLD
)paren
(brace
r_static
r_int
id|warned
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|warned
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s uses old SIOCAX25GETINFO&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|warned
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|ax25_info
comma
r_sizeof
(paren
r_struct
id|ax25_info_struct_depreciated
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|ax25_info
comma
r_sizeof
(paren
r_struct
id|ax25_info_struct
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SIOCAX25ADDFWD
suffix:colon
r_case
id|SIOCAX25DELFWD
suffix:colon
(brace
r_struct
id|ax25_fwd_struct
id|ax25_fwd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ax25_fwd
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|ax25_fwd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|ax25_fwd_ioctl
c_func
(paren
id|cmd
comma
op_amp
id|ax25_fwd
)paren
suffix:semicolon
)brace
r_case
id|SIOCGIFADDR
suffix:colon
r_case
id|SIOCSIFADDR
suffix:colon
r_case
id|SIOCGIFDSTADDR
suffix:colon
r_case
id|SIOCSIFDSTADDR
suffix:colon
r_case
id|SIOCGIFBRDADDR
suffix:colon
r_case
id|SIOCSIFBRDADDR
suffix:colon
r_case
id|SIOCGIFNETMASK
suffix:colon
r_case
id|SIOCSIFNETMASK
suffix:colon
r_case
id|SIOCGIFMETRIC
suffix:colon
r_case
id|SIOCSIFMETRIC
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
multiline_comment|/*NOTREACHED*/
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ax25_get_info
r_static
r_int
id|ax25_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
id|ax25_cb
op_star
id|ax25
suffix:semicolon
r_int
id|k
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * New format:&n;&t; * magic dev src_addr dest_addr,digi1,digi2,.. st vs vr va t1 t1 t2 t2 t3 t3 idle idle n2 n2 rtt window paclen Snd-Q Rcv-Q inode &n;&t; */
r_for
c_loop
(paren
id|ax25
op_assign
id|ax25_list
suffix:semicolon
id|ax25
op_ne
l_int|NULL
suffix:semicolon
id|ax25
op_assign
id|ax25-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%8.8lx %s %s%s &quot;
comma
(paren
r_int
)paren
id|ax25
comma
id|ax25-&gt;ax25_dev
op_eq
l_int|NULL
ques
c_cond
l_string|&quot;???&quot;
suffix:colon
id|ax25-&gt;ax25_dev-&gt;dev-&gt;name
comma
id|ax2asc
c_func
(paren
op_amp
id|ax25-&gt;source_addr
)paren
comma
id|ax25-&gt;iamdigi
ques
c_cond
l_string|&quot;*&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%s&quot;
comma
id|ax2asc
c_func
(paren
op_amp
id|ax25-&gt;dest_addr
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
(paren
id|ax25-&gt;digipeat
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|k
OL
id|ax25-&gt;digipeat-&gt;ndigi
)paren
suffix:semicolon
id|k
op_increment
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;,%s%s&quot;
comma
id|ax2asc
c_func
(paren
op_amp
id|ax25-&gt;digipeat-&gt;calls
(braket
id|k
)braket
)paren
comma
id|ax25-&gt;digipeat-&gt;repeated
(braket
id|k
)braket
ques
c_cond
l_string|&quot;*&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; %d %d %d %d %lu %lu %lu %lu %lu %lu %lu %lu %d %d %lu %d %d&quot;
comma
id|ax25-&gt;state
comma
id|ax25-&gt;vs
comma
id|ax25-&gt;vr
comma
id|ax25-&gt;va
comma
id|ax25_display_timer
c_func
(paren
op_amp
id|ax25-&gt;t1timer
)paren
op_div
id|HZ
comma
id|ax25-&gt;t1
op_div
id|HZ
comma
id|ax25_display_timer
c_func
(paren
op_amp
id|ax25-&gt;t2timer
)paren
op_div
id|HZ
comma
id|ax25-&gt;t2
op_div
id|HZ
comma
id|ax25_display_timer
c_func
(paren
op_amp
id|ax25-&gt;t3timer
)paren
op_div
id|HZ
comma
id|ax25-&gt;t3
op_div
id|HZ
comma
id|ax25_display_timer
c_func
(paren
op_amp
id|ax25-&gt;idletimer
)paren
op_div
(paren
l_int|60
op_star
id|HZ
)paren
comma
id|ax25-&gt;idle
op_div
(paren
l_int|60
op_star
id|HZ
)paren
comma
id|ax25-&gt;n2count
comma
id|ax25-&gt;n2
comma
id|ax25-&gt;rtt
op_div
id|HZ
comma
id|ax25-&gt;window
comma
id|ax25-&gt;paclen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ax25-&gt;sk
op_ne
l_int|NULL
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; %d %d %ld&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|ax25-&gt;sk-&gt;wmem_alloc
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|ax25-&gt;sk-&gt;rmem_alloc
)paren
comma
id|ax25-&gt;sk-&gt;socket
op_ne
l_int|NULL
ques
c_cond
id|ax25-&gt;sk-&gt;socket-&gt;inode-&gt;i_ino
suffix:colon
l_int|0L
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; * * *&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_break
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|variable|ax25_family_ops
r_static
r_struct
id|net_proto_family
id|ax25_family_ops
op_assign
(brace
id|PF_AX25
comma
id|ax25_create
)brace
suffix:semicolon
DECL|variable|ax25_proto_ops
r_static
r_struct
id|proto_ops
id|SOCKOPS_WRAPPED
c_func
(paren
id|ax25_proto_ops
)paren
op_assign
(brace
id|family
suffix:colon
id|PF_AX25
comma
id|release
suffix:colon
id|ax25_release
comma
id|bind
suffix:colon
id|ax25_bind
comma
id|connect
suffix:colon
id|ax25_connect
comma
id|socketpair
suffix:colon
id|sock_no_socketpair
comma
id|accept
suffix:colon
id|ax25_accept
comma
id|getname
suffix:colon
id|ax25_getname
comma
id|poll
suffix:colon
id|datagram_poll
comma
id|ioctl
suffix:colon
id|ax25_ioctl
comma
id|listen
suffix:colon
id|ax25_listen
comma
id|shutdown
suffix:colon
id|ax25_shutdown
comma
id|setsockopt
suffix:colon
id|ax25_setsockopt
comma
id|getsockopt
suffix:colon
id|ax25_getsockopt
comma
id|sendmsg
suffix:colon
id|ax25_sendmsg
comma
id|recvmsg
suffix:colon
id|ax25_recvmsg
comma
id|mmap
suffix:colon
id|sock_no_mmap
comma
)brace
suffix:semicolon
macro_line|#include &lt;linux/smp_lock.h&gt;
id|SOCKOPS_WRAP
c_func
(paren
id|ax25_proto
comma
id|PF_AX25
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Called by socket.c on kernel start up&n; */
DECL|variable|ax25_packet_type
r_static
r_struct
id|packet_type
id|ax25_packet_type
op_assign
(brace
l_int|0
comma
multiline_comment|/* MUTTER ntohs(ETH_P_AX25),*/
l_int|0
comma
multiline_comment|/* copy */
id|ax25_kiss_rcv
comma
l_int|NULL
comma
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|ax25_dev_notifier
r_static
r_struct
id|notifier_block
id|ax25_dev_notifier
op_assign
(brace
id|ax25_device_event
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|ax25_encapsulate
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_encapsulate
)paren
suffix:semicolon
DECL|variable|ax25_rebuild_header
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_rebuild_header
)paren
suffix:semicolon
DECL|variable|ax25_findbyuid
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_findbyuid
)paren
suffix:semicolon
DECL|variable|ax25_find_cb
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_find_cb
)paren
suffix:semicolon
DECL|variable|ax25_linkfail_register
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_linkfail_register
)paren
suffix:semicolon
DECL|variable|ax25_linkfail_release
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_linkfail_release
)paren
suffix:semicolon
DECL|variable|ax25_listen_register
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_listen_register
)paren
suffix:semicolon
DECL|variable|ax25_listen_release
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_listen_release
)paren
suffix:semicolon
DECL|variable|ax25_protocol_register
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_protocol_register
)paren
suffix:semicolon
DECL|variable|ax25_protocol_release
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_protocol_release
)paren
suffix:semicolon
DECL|variable|ax25_send_frame
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_send_frame
)paren
suffix:semicolon
DECL|variable|ax25_uid_policy
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_uid_policy
)paren
suffix:semicolon
DECL|variable|ax25cmp
id|EXPORT_SYMBOL
c_func
(paren
id|ax25cmp
)paren
suffix:semicolon
DECL|variable|ax2asc
id|EXPORT_SYMBOL
c_func
(paren
id|ax2asc
)paren
suffix:semicolon
DECL|variable|asc2ax
id|EXPORT_SYMBOL
c_func
(paren
id|asc2ax
)paren
suffix:semicolon
DECL|variable|null_ax25_address
id|EXPORT_SYMBOL
c_func
(paren
id|null_ax25_address
)paren
suffix:semicolon
DECL|variable|ax25_display_timer
id|EXPORT_SYMBOL
c_func
(paren
id|ax25_display_timer
)paren
suffix:semicolon
DECL|function|ax25_init
r_static
r_int
id|__init
id|ax25_init
c_func
(paren
r_void
)paren
(brace
id|sock_register
c_func
(paren
op_amp
id|ax25_family_ops
)paren
suffix:semicolon
id|ax25_packet_type.type
op_assign
id|htons
c_func
(paren
id|ETH_P_AX25
)paren
suffix:semicolon
id|dev_add_pack
c_func
(paren
op_amp
id|ax25_packet_type
)paren
suffix:semicolon
id|register_netdevice_notifier
c_func
(paren
op_amp
id|ax25_dev_notifier
)paren
suffix:semicolon
id|ax25_register_sysctl
c_func
(paren
)paren
suffix:semicolon
id|proc_net_create
c_func
(paren
l_string|&quot;ax25_route&quot;
comma
l_int|0
comma
id|ax25_rt_get_info
)paren
suffix:semicolon
id|proc_net_create
c_func
(paren
l_string|&quot;ax25&quot;
comma
l_int|0
comma
id|ax25_get_info
)paren
suffix:semicolon
id|proc_net_create
c_func
(paren
l_string|&quot;ax25_calls&quot;
comma
l_int|0
comma
id|ax25_uid_get_info
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;NET4: G4KLX/GW4PTS AX.25 for Linux. Version 0.37 for Linux NET4.0&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ax25_init
id|module_init
c_func
(paren
id|ax25_init
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jonathan Naylor G4KLX &lt;g4klx@g4klx.demon.co.uk&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;The amateur radio AX.25 link layer protocol&quot;
)paren
suffix:semicolon
DECL|function|ax25_exit
r_static
r_void
id|__exit
id|ax25_exit
c_func
(paren
r_void
)paren
(brace
id|proc_net_remove
c_func
(paren
l_string|&quot;ax25_route&quot;
)paren
suffix:semicolon
id|proc_net_remove
c_func
(paren
l_string|&quot;ax25&quot;
)paren
suffix:semicolon
id|proc_net_remove
c_func
(paren
l_string|&quot;ax25_calls&quot;
)paren
suffix:semicolon
id|ax25_rt_free
c_func
(paren
)paren
suffix:semicolon
id|ax25_uid_free
c_func
(paren
)paren
suffix:semicolon
id|ax25_dev_free
c_func
(paren
)paren
suffix:semicolon
id|ax25_unregister_sysctl
c_func
(paren
)paren
suffix:semicolon
id|unregister_netdevice_notifier
c_func
(paren
op_amp
id|ax25_dev_notifier
)paren
suffix:semicolon
id|ax25_packet_type.type
op_assign
id|htons
c_func
(paren
id|ETH_P_AX25
)paren
suffix:semicolon
id|dev_remove_pack
c_func
(paren
op_amp
id|ax25_packet_type
)paren
suffix:semicolon
id|sock_unregister
c_func
(paren
id|PF_AX25
)paren
suffix:semicolon
)brace
DECL|variable|ax25_exit
id|module_exit
c_func
(paren
id|ax25_exit
)paren
suffix:semicolon
eof
