multiline_comment|/*********************************************************************&n; *                &n; * Filename:      irlan_common.c&n; * Version:       0.1&n; * Description:   IrDA LAN Access Protocol Implementation&n; * Status:        Experimental.&n; * Author:        Dag Brattli &lt;dagb@cs.uit.no&gt;&n; * Created at:    Sun Aug 31 20:14:37 1997&n; * Modified at:   Tue Jan 19 23:11:30 1999&n; * Modified by:   Dag Brattli &lt;dagb@cs.uit.no&gt;&n; * &n; *     Copyright (c) 1997 Dag Brattli &lt;dagb@cs.uit.no&gt;, All Rights Reserved.&n; *     &n; *     This program is free software; you can redistribute it and/or &n; *     modify it under the terms of the GNU General Public License as &n; *     published by the Free Software Foundation; either version 2 of &n; *     the License, or (at your option) any later version.&n; *&n; *     Neither Dag Brattli nor University of Troms&#xfffd; admit liability nor&n; *     provide warranty for any of this software. This material is &n; *     provided &quot;AS-IS&quot; and at no charge.&n; *&n; ********************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;net/irda/irda.h&gt;
macro_line|#include &lt;net/irda/irttp.h&gt;
macro_line|#include &lt;net/irda/irlmp.h&gt;
macro_line|#include &lt;net/irda/iriap.h&gt;
macro_line|#include &lt;net/irda/timer.h&gt;
macro_line|#include &lt;net/irda/irlan_common.h&gt;
r_static
r_void
id|__irlan_close
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
suffix:semicolon
multiline_comment|/*&n; *  Master structure&n; */
DECL|variable|irlan
id|hashbin_t
op_star
id|irlan
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_static
r_int
id|irlan_proc_read
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
id|unused
)paren
suffix:semicolon
r_extern
r_struct
id|proc_dir_entry
id|proc_irda
suffix:semicolon
DECL|variable|proc_irlan
r_struct
id|proc_dir_entry
id|proc_irlan
op_assign
(brace
l_int|0
comma
l_int|5
comma
l_string|&quot;irlan&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|irlan_proc_read
comma
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * Function irlan_init (void)&n; *&n; *    Initialize IrLAN layer&n; *&n; */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|irlan_init
c_func
(paren
r_void
)paren
)paren
(brace
multiline_comment|/* Allocate master array */
id|irlan
op_assign
id|hashbin_new
c_func
(paren
id|HB_LOCAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irlan
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;IrLAN: Can&squot;t allocate hashbin!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
id|proc_register
c_func
(paren
op_amp
id|proc_irda
comma
op_amp
id|proc_irlan
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|irlan_cleanup
r_void
id|irlan_cleanup
c_func
(paren
r_void
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_unregister
c_func
(paren
op_amp
id|proc_irda
comma
id|proc_irlan.low_ino
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *  Delete hashbin and close all irlan client instances in it&n;&t; */
id|hashbin_delete
c_func
(paren
id|irlan
comma
(paren
id|FREE_FUNC
)paren
id|__irlan_close
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_open (void)&n; *&n; *    &n; *&n; */
DECL|function|irlan_open
r_struct
id|irlan_cb
op_star
id|irlan_open
c_func
(paren
r_void
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* &n;&t; *  Initialize the irlan structure. &n;&t; */
id|self
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|irlan_cb
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|self
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|irlan_cb
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Initialize local device structure&n;&t; */
id|self-&gt;magic
op_assign
id|IRLAN_MAGIC
suffix:semicolon
r_return
id|self
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_close (self)&n; *&n; *    This function closes and deallocates the IrLAN client instances. Be &n; *    aware that other functions which calles client_close() must call &n; *    hashbin_remove() first!!!&n; *&n; */
DECL|function|__irlan_close
r_void
id|__irlan_close
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* &n;&t; *  Disconnect open TSAP connections&n;&t; */
r_if
c_cond
(paren
id|self-&gt;tsap_data
)paren
(brace
id|irttp_disconnect_request
c_func
(paren
id|self-&gt;tsap_data
comma
l_int|NULL
comma
id|P_HIGH
)paren
suffix:semicolon
multiline_comment|/* FIXME: this will close the tsap before the disconenct&n;&t;&t; * frame has been sent &n;&t;&t; */
multiline_comment|/* irttp_close_tsap( self-&gt;tsap_data); */
)brace
r_if
c_cond
(paren
id|self-&gt;tsap_ctrl
)paren
(brace
id|irttp_disconnect_request
c_func
(paren
id|self-&gt;tsap_ctrl
comma
l_int|NULL
comma
id|P_HIGH
)paren
suffix:semicolon
multiline_comment|/* irttp_close_tsap( self-&gt;tsap_control); */
)brace
id|unregister_netdev
c_func
(paren
op_amp
id|self-&gt;dev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Make sure that nobody uses this instance anymore!&n;&t; */
id|self-&gt;magic
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; *  Dealloacte structure&n;&t; */
id|kfree
c_func
(paren
id|self
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_close (self)&n; *&n; *    &n; *&n; */
DECL|function|irlan_close
r_void
id|irlan_close
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|irlan_cb
op_star
id|entry
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|entry
op_assign
id|hashbin_remove
c_func
(paren
id|irlan
comma
id|self-&gt;daddr
comma
l_int|NULL
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|entry
op_eq
id|self
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|__irlan_close
c_func
(paren
id|self
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_get_provider_info (self)&n; *&n; *    Send Get Provider Information command to peer IrLAN layer&n; *&n; */
DECL|function|irlan_get_provider_info
r_void
id|irlan_get_provider_info
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|64
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), Could not allocate an skb of length %d&bslash;n&quot;
comma
l_int|64
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|TTP_HEADER
op_plus
id|LMP_HEADER
op_plus
id|LAP_HEADER
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_GET_PROVIDER_INFO
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* Zero parameters */
id|irttp_data_request
c_func
(paren
id|self-&gt;tsap_ctrl
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_open_data_channel (self)&n; *&n; *    Send an Open Data Command to provider&n; *&n; */
DECL|function|irlan_open_data_channel
r_void
id|irlan_open_data_channel
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|64
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), Could not allocate an skb of length %d&bslash;n&quot;
comma
l_int|64
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|TTP_HEADER
op_plus
id|LMP_HEADER
op_plus
id|LAP_HEADER
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Build frame */
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_OPEN_DATA_CHANNEL
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* Two parameters */
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;MEDIA&quot;
comma
l_string|&quot;802.3&quot;
)paren
suffix:semicolon
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;ACCESS_TYPE&quot;
comma
l_string|&quot;DIRECT&quot;
)paren
suffix:semicolon
multiline_comment|/* insert_string_param( skb, &quot;MODE&quot;, &quot;UNRELIABLE&quot;); */
multiline_comment|/* &t;self-&gt;use_udata = TRUE; */
id|irttp_data_request
c_func
(paren
id|self-&gt;tsap_ctrl
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_open_unicast_addr (self)&n; *&n; *    Make IrLAN provider accept ethernet frames addressed to the unicast &n; *    address.&n; *&n; */
DECL|function|irlan_open_unicast_addr
r_void
id|irlan_open_unicast_addr
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), Could not allocate an skb of length %d&bslash;n&quot;
comma
l_int|64
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|TTP_HEADER
op_plus
id|LMP_HEADER
op_plus
id|LAP_HEADER
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_FILTER_OPERATION
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* Three parameters */
id|insert_byte_param
c_func
(paren
id|skb
comma
l_string|&quot;DATA_CHAN&quot;
comma
id|self-&gt;dtsap_sel_data
)paren
suffix:semicolon
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_TYPE&quot;
comma
l_string|&quot;DIRECTED&quot;
)paren
suffix:semicolon
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_MODE&quot;
comma
l_string|&quot;FILTER&quot;
)paren
suffix:semicolon
id|irttp_data_request
c_func
(paren
id|self-&gt;tsap_ctrl
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_set_broadcast_filter (self, status)&n; *&n; *    Make IrLAN provider accept ethernet frames addressed to the broadcast&n; *    address. Be careful with the use of this one, sice there may be a lot&n; *    of broadcast traffic out there. We can still function without this&n; *    one but then _we_ have to initiate all communication with other&n; *    hosts, sice ARP request for this host will not be answered.&n; */
DECL|function|irlan_set_broadcast_filter
r_void
id|irlan_set_broadcast_filter
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
comma
r_int
id|status
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* Should only be used by client */
r_if
c_cond
(paren
op_logical_neg
id|self-&gt;client
)paren
r_return
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), Could not allocate an skb of length %d&bslash;n&quot;
comma
l_int|64
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|TTP_HEADER
op_plus
id|LMP_HEADER
op_plus
id|LAP_HEADER
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_FILTER_OPERATION
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* Three parameters */
id|insert_byte_param
c_func
(paren
id|skb
comma
l_string|&quot;DATA_CHAN&quot;
comma
id|self-&gt;dtsap_sel_data
)paren
suffix:semicolon
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_TYPE&quot;
comma
l_string|&quot;BROADCAST&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_MODE&quot;
comma
l_string|&quot;FILTER&quot;
)paren
suffix:semicolon
r_else
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_MODE&quot;
comma
l_string|&quot;NONE&quot;
)paren
suffix:semicolon
id|irttp_data_request
c_func
(paren
id|self-&gt;tsap_ctrl
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_set_multicast_filter (self, status)&n; *&n; *    Make IrLAN provider accept ethernet frames addressed to the multicast&n; *    address. &n; *&n; */
DECL|function|irlan_set_multicast_filter
r_void
id|irlan_set_multicast_filter
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
comma
r_int
id|status
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* Should only be used by client */
r_if
c_cond
(paren
op_logical_neg
id|self-&gt;client
)paren
r_return
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), Could not allocate an skb of length %d&bslash;n&quot;
comma
l_int|64
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|TTP_HEADER
op_plus
id|LMP_HEADER
op_plus
id|LAP_HEADER
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_FILTER_OPERATION
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* Three parameters */
id|insert_byte_param
c_func
(paren
id|skb
comma
l_string|&quot;DATA_CHAN&quot;
comma
id|self-&gt;dtsap_sel_data
)paren
suffix:semicolon
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_TYPE&quot;
comma
l_string|&quot;MULTICAST&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_MODE&quot;
comma
l_string|&quot;ALL&quot;
)paren
suffix:semicolon
r_else
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_MODE&quot;
comma
l_string|&quot;NONE&quot;
)paren
suffix:semicolon
id|irttp_data_request
c_func
(paren
id|self-&gt;tsap_ctrl
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_get_unicast_addr (self)&n; *&n; *    Retrives the unicast address from the IrLAN provider. This address&n; *    will be inserted into the devices structure, so the ethernet layer&n; *    can construct its packets.&n; *&n; */
DECL|function|irlan_get_unicast_addr
r_void
id|irlan_get_unicast_addr
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;irlan_client_get_unicast_addr: &quot;
l_string|&quot;Could not allocate an sk_buff of length %d&bslash;n&quot;
comma
l_int|64
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|TTP_HEADER
op_plus
id|LMP_HEADER
op_plus
id|LAP_HEADER
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_FILTER_OPERATION
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* Three parameters */
id|insert_byte_param
c_func
(paren
id|skb
comma
l_string|&quot;DATA_CHAN&quot;
comma
id|self-&gt;dtsap_sel_data
)paren
suffix:semicolon
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_TYPE&quot;
comma
l_string|&quot;DIRECTED&quot;
)paren
suffix:semicolon
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_OPERATION&quot;
comma
l_string|&quot;DYNAMIC&quot;
)paren
suffix:semicolon
id|irttp_data_request
c_func
(paren
id|self-&gt;tsap_ctrl
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_get_media_char (self)&n; *&n; *    &n; *&n; */
DECL|function|irlan_get_media_char
r_void
id|irlan_get_media_char
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|64
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;irlan_server_get_media_char: &quot;
l_string|&quot;Could not allocate an sk_buff of length %d&bslash;n&quot;
comma
l_int|64
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|TTP_HEADER
op_plus
id|LMP_HEADER
op_plus
id|LAP_HEADER
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Build frame */
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_GET_MEDIA_CHAR
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* One parameter */
id|insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;MEDIA&quot;
comma
l_string|&quot;802.3&quot;
)paren
suffix:semicolon
id|irttp_data_request
c_func
(paren
id|self-&gt;tsap_ctrl
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function insert_byte_param (skb, param, value)&n; *&n; *    Insert byte parameter into frame&n; *&n; */
DECL|function|insert_byte_param
r_int
id|insert_byte_param
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|param
comma
id|__u8
id|value
)paren
(brace
id|__u8
op_star
id|frame
suffix:semicolon
id|__u8
id|len_param
suffix:semicolon
id|__u16
id|len_value
suffix:semicolon
r_int
id|n
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;insert_param: Got NULL skb&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|len_param
op_assign
id|strlen
c_func
(paren
id|param
)paren
suffix:semicolon
id|len_value
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; *  Insert at end of sk-buffer&n;&t; */
id|frame
op_assign
id|skb-&gt;tail
suffix:semicolon
multiline_comment|/* Make space for data */
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
(paren
id|len_param
op_plus
id|len_value
op_plus
l_int|3
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;insert_param: No more space at end of skb&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|skb
comma
id|len_param
op_plus
id|len_value
op_plus
l_int|3
)paren
suffix:semicolon
multiline_comment|/* Insert parameter length */
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|len_param
suffix:semicolon
multiline_comment|/* Insert parameter */
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
id|param
comma
id|len_param
)paren
suffix:semicolon
id|n
op_add_assign
id|len_param
suffix:semicolon
multiline_comment|/* Insert value length ( 2 byte little endian format, LSB first) */
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|len_value
op_amp
l_int|0xff
suffix:semicolon
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|len_value
op_rshift
l_int|8
suffix:semicolon
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|value
suffix:semicolon
r_return
id|len_param
op_plus
id|len_value
op_plus
l_int|3
suffix:semicolon
)brace
multiline_comment|/*&n; * Function insert_string (skb, param, value)&n; *&n; *    Insert string parameter into frame&n; *&n; */
DECL|function|insert_string_param
r_int
id|insert_string_param
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|param
comma
r_char
op_star
id|value
)paren
(brace
id|__u8
op_star
id|frame
suffix:semicolon
id|__u8
id|len_param
suffix:semicolon
id|__u16
id|len_value
suffix:semicolon
r_int
id|n
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;insert_param: Got NULL skb&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|len_param
op_assign
id|strlen
c_func
(paren
id|param
)paren
suffix:semicolon
id|len_value
op_assign
id|strlen
c_func
(paren
id|value
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Insert at end of sk-buffer&n;&t; */
id|frame
op_assign
id|skb-&gt;tail
suffix:semicolon
multiline_comment|/* Make space for data */
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
(paren
id|len_param
op_plus
id|len_value
op_plus
l_int|3
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;insert_param: No more space at end of skb&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|skb
comma
id|len_param
op_plus
id|len_value
op_plus
l_int|3
)paren
suffix:semicolon
multiline_comment|/* Insert parameter length */
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|len_param
suffix:semicolon
multiline_comment|/* Insert parameter */
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
id|param
comma
id|len_param
)paren
suffix:semicolon
id|n
op_add_assign
id|len_param
suffix:semicolon
multiline_comment|/* Insert value length ( 2 byte little endian format, LSB first) */
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|len_value
op_amp
l_int|0xff
suffix:semicolon
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|len_value
op_rshift
l_int|8
suffix:semicolon
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
id|value
comma
id|len_value
)paren
suffix:semicolon
id|n
op_add_assign
id|len_value
suffix:semicolon
r_return
id|len_param
op_plus
id|len_value
op_plus
l_int|3
suffix:semicolon
)brace
multiline_comment|/*&n; * Function insert_array_param( skb, param, value, len_value)&n; *&n; *    Insert array parameter into frame&n; *&n; */
DECL|function|insert_array_param
r_int
id|insert_array_param
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|name
comma
id|__u8
op_star
id|value
comma
id|__u16
id|value_len
)paren
(brace
id|__u8
op_star
id|frame
suffix:semicolon
id|__u8
id|name_len
suffix:semicolon
r_int
id|n
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), Got NULL skb&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|name_len
op_assign
id|strlen
c_func
(paren
id|name
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Insert at end of sk-buffer&n;&t; */
id|frame
op_assign
id|skb-&gt;tail
suffix:semicolon
multiline_comment|/* Make space for data */
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
(paren
id|name_len
op_plus
id|value_len
op_plus
l_int|3
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), No more space at end of skb&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|skb
comma
id|name_len
op_plus
id|value_len
op_plus
l_int|3
)paren
suffix:semicolon
multiline_comment|/* Insert parameter length */
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|name_len
suffix:semicolon
multiline_comment|/* Insert parameter */
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
id|name
comma
id|name_len
)paren
suffix:semicolon
id|n
op_add_assign
id|name_len
suffix:semicolon
multiline_comment|/* Insert value length ( 2 byte little endian format, LSB first) */
multiline_comment|/* FIXME: should we use htons() here? */
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|value_len
op_amp
l_int|0xff
suffix:semicolon
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|value_len
op_rshift
l_int|8
suffix:semicolon
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
id|value
comma
id|value_len
)paren
suffix:semicolon
id|n
op_add_assign
id|value_len
suffix:semicolon
r_return
id|name_len
op_plus
id|value_len
op_plus
l_int|3
suffix:semicolon
)brace
multiline_comment|/*&n; * Function insert_param (skb, param, value, byte)&n; *&n; *    Insert parameter at end of buffer, structure of a parameter is:&n; *&n; *    -----------------------------------------------------------------------&n; *    | Name Length[1] | Param Name[1..255] | Val Length[2] | Value[0..1016]|&n; *    -----------------------------------------------------------------------&n; */
DECL|function|insert_param
r_int
id|insert_param
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|param
comma
r_int
id|type
comma
r_char
op_star
id|value_char
comma
id|__u8
id|value_byte
comma
id|__u16
id|value_short
)paren
(brace
id|__u8
op_star
id|frame
suffix:semicolon
id|__u8
id|len_param
suffix:semicolon
id|__u16
id|len_value
suffix:semicolon
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;insert_param: Got NULL skb&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|n
op_assign
l_int|0
suffix:semicolon
id|len_param
op_assign
id|strlen
c_func
(paren
id|param
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
l_int|1
suffix:colon
id|ASSERT
c_func
(paren
id|value_char
op_ne
l_int|NULL
comma
r_return
l_int|0
suffix:semicolon
)paren
suffix:semicolon
id|len_value
op_assign
id|strlen
c_func
(paren
id|value_char
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|len_value
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|len_value
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;Error in insert_param!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Insert at end of sk-buffer&n;&t; */
id|frame
op_assign
id|skb-&gt;tail
suffix:semicolon
multiline_comment|/* Make space for data */
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
(paren
id|len_param
op_plus
id|len_value
op_plus
l_int|3
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;insert_param: No more space at end of skb&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|skb
comma
id|len_param
op_plus
id|len_value
op_plus
l_int|3
)paren
suffix:semicolon
multiline_comment|/* Insert parameter length */
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|len_param
suffix:semicolon
multiline_comment|/* Insert parameter */
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
id|param
comma
id|len_param
)paren
suffix:semicolon
id|n
op_add_assign
id|len_param
suffix:semicolon
multiline_comment|/* Insert value length ( 2 byte little endian format, LSB first) */
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|len_value
op_amp
l_int|0xff
suffix:semicolon
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|len_value
op_rshift
l_int|8
suffix:semicolon
multiline_comment|/* Insert value */
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
l_int|1
suffix:colon
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
id|value_char
comma
id|len_value
)paren
suffix:semicolon
id|n
op_add_assign
id|len_value
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|value_byte
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|value_short
op_amp
l_int|0xff
suffix:semicolon
id|frame
(braket
id|n
op_increment
)braket
op_assign
(paren
id|value_short
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|ASSERT
c_func
(paren
id|n
op_eq
(paren
id|len_param
op_plus
id|len_value
op_plus
l_int|3
)paren
comma
r_return
l_int|0
suffix:semicolon
)paren
suffix:semicolon
r_return
id|len_param
op_plus
id|len_value
op_plus
l_int|3
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_get_response_param (buf, param, value)&n; *&n; *    Extracts a single parameter name/value pair from buffer and updates&n; *    the buffer pointer to point to the next name/value pair.&n; * &n; */
DECL|function|irlan_get_response_param
r_int
id|irlan_get_response_param
c_func
(paren
id|__u8
op_star
id|buf
comma
r_char
op_star
id|name
comma
r_char
op_star
id|value
comma
r_int
op_star
id|len
)paren
(brace
id|__u8
id|name_len
suffix:semicolon
id|__u16
id|val_len
suffix:semicolon
r_int
id|n
op_assign
l_int|0
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;irlan_get_response_param()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* get length of parameter name ( 1 byte) */
id|name_len
op_assign
id|buf
(braket
id|n
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
id|name_len
OG
l_int|254
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), name_len &gt; 254&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* get parameter name */
id|memcpy
c_func
(paren
id|name
comma
id|buf
op_plus
id|n
comma
id|name_len
)paren
suffix:semicolon
id|name
(braket
id|name_len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|n
op_add_assign
id|name_len
suffix:semicolon
multiline_comment|/*  &n;&t; *  Get length of parameter value ( 2 bytes in little endian &n;&t; *  format) &n;&t; */
id|val_len
op_assign
id|buf
(braket
id|n
op_increment
)braket
op_amp
l_int|0xff
suffix:semicolon
id|val_len
op_or_assign
id|buf
(braket
id|n
op_increment
)braket
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|val_len
OG
l_int|1016
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), parameter length to long&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
op_star
id|len
op_assign
id|val_len
suffix:semicolon
multiline_comment|/* get parameter value */
id|memcpy
c_func
(paren
id|value
comma
id|buf
op_plus
id|n
comma
id|val_len
)paren
suffix:semicolon
id|value
(braket
id|val_len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|n
op_add_assign
id|val_len
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;Parameter: %s &quot;
comma
id|name
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;Value: %s&bslash;n&quot;
comma
id|value
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
multiline_comment|/*&n; * Function irlan_client_proc_read (buf, start, offset, len, unused)&n; *&n; *    Give some info to the /proc file system&n; */
DECL|function|irlan_proc_read
r_static
r_int
id|irlan_proc_read
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
id|unused
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
id|ASSERT
c_func
(paren
id|irlan
op_ne
l_int|NULL
comma
r_return
l_int|0
suffix:semicolon
)paren
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;IrLAN&bslash;n&quot;
)paren
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|hashbin_get_first
c_func
(paren
id|irlan
)paren
suffix:semicolon
r_while
c_loop
(paren
id|self
op_ne
l_int|NULL
)paren
(brace
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
id|len
suffix:semicolon
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;ifname: %s, &quot;
comma
id|self-&gt;ifname
)paren
suffix:semicolon
multiline_comment|/* len += sprintf( buf+len, &quot;state: %s, &quot;, */
multiline_comment|/* &t;&t;&t;&t;irlan_client_state[ self-&gt;state]); */
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;saddr: %#08x&bslash;n&quot;
comma
id|self-&gt;saddr
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;daddr: %#08x&bslash;n&quot;
comma
id|self-&gt;daddr
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;tbusy: %s&bslash;n&quot;
comma
id|self-&gt;dev.tbusy
ques
c_cond
l_string|&quot;TRUE&quot;
suffix:colon
l_string|&quot;FALSE&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|hashbin_get_next
c_func
(paren
id|irlan
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;self=%p&bslash;n&quot;
comma
id|self
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Function print_ret_code (code)&n; *&n; *    Print return code of request to peer IrLAN layer.&n; *&n; */
DECL|function|print_ret_code
r_void
id|print_ret_code
c_func
(paren
id|__u8
id|code
)paren
(brace
r_switch
c_cond
(paren
id|code
)paren
(brace
r_case
l_int|0
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Success&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Insufficient resources&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Invalid command format&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Command not supported&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Parameter not supported&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Value not supported&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Not open&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Authentication required&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Invalid password&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Protocol error&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|255
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Asynchronous status&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#ifdef MODULE
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Dag Brattli &lt;dagb@cs.uit.no&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;The Linux IrDA LAN protocol&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; * Function init_module (void)&n; *&n; *    Initialize the IrLAN module, this function is called by the&n; *    modprobe(1) program.&n; */
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;(), irlan.c&bslash;n&quot;
)paren
suffix:semicolon
id|irlan_init
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function cleanup_module (void)&n; *&n; *    Remove the IrLAN module, this function is called by the rmmod(1)&n; *    program&n; */
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;--&gt; irlan, cleanup_module&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* No need to check MOD_IN_USE, as sys_delete_module() checks. */
multiline_comment|/* Free some memory */
id|irlan_cleanup
c_func
(paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;irlan, cleanup_module --&gt;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
eof
