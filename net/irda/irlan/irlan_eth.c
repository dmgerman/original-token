multiline_comment|/*********************************************************************&n; *                &n; * Filename:      irlan_eth.c&n; * Version:       &n; * Description:   &n; * Status:        Experimental.&n; * Author:        Dag Brattli &lt;dagb@cs.uit.no&gt;&n; * Created at:    Thu Oct 15 08:37:58 1998&n; * Modified at:   Sun Jun 20 20:23:33 1999&n; * Modified by:   Dag Brattli &lt;dagb@cs.uit.no&gt;&n; * Sources:       skeleton.c by Donald Becker &lt;becker@CESDIS.gsfc.nasa.gov&gt;&n; *                slip.c by Laurence Culhane,   &lt;loz@holmes.demon.co.uk&gt;&n; *                          Fred N. van Kempen, &lt;waltje@uwalt.nl.mugnet.org&gt;&n; * &n; *     Copyright (c) 1998-1999 Dag Brattli, All Rights Reserved.&n; *      &n; *     This program is free software; you can redistribute it and/or &n; *     modify it under the terms of the GNU General Public License as &n; *     published by the Free Software Foundation; either version 2 of &n; *     the License, or (at your option) any later version.&n; *  &n; *     Neither Dag Brattli nor University of Troms&#xfffd; admit liability nor&n; *     provide warranty for any of this software. This material is &n; *     provided &quot;AS-IS&quot; and at no charge.&n; *     &n; ********************************************************************/
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/irda/irda.h&gt;
macro_line|#include &lt;net/irda/irmod.h&gt;
macro_line|#include &lt;net/irda/irlan_common.h&gt;
macro_line|#include &lt;net/irda/irlan_client.h&gt;
macro_line|#include &lt;net/irda/irlan_event.h&gt;
macro_line|#include &lt;net/irda/irlan_eth.h&gt;
multiline_comment|/*&n; * Function irlan_eth_init (dev)&n; *&n; *    The network device initialization function.&n; *&n; */
DECL|function|irlan_eth_init
r_int
id|irlan_eth_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|irmanager_event
id|mgr_event
suffix:semicolon
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|dev
op_ne
l_int|NULL
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|dev-&gt;open
op_assign
id|irlan_eth_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|irlan_eth_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|irlan_eth_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|irlan_eth_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|irlan_eth_set_multicast_list
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Lets do all queueing in IrTTP instead of this device driver.&n;&t; * Queueing here as well can introduce some strange latency&n;&t; * problems, which we will avoid by setting the queue size to 0.&n;&t; */
id|dev-&gt;tx_queue_len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;provider.access_type
op_eq
id|ACCESS_DIRECT
)paren
(brace
multiline_comment|/*  &n;&t;&t; * Since we are emulating an IrLAN sever we will have to&n;&t;&t; * give ourself an ethernet address!  &n;&t;&t; */
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
l_int|0x40
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
l_int|0x00
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_assign
l_int|0x00
suffix:semicolon
id|get_random_bytes
c_func
(paren
id|dev-&gt;dev_addr
op_plus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
id|get_random_bytes
c_func
(paren
id|dev-&gt;dev_addr
op_plus
l_int|5
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * Network device has now been registered, so tell irmanager about&n;&t; * it, so it can be configured with network parameters&n;&t; */
id|mgr_event.event
op_assign
id|EVENT_IRLAN_START
suffix:semicolon
id|sprintf
c_func
(paren
id|mgr_event.devname
comma
l_string|&quot;%s&quot;
comma
id|self-&gt;ifname
)paren
suffix:semicolon
id|irmanager_notify
c_func
(paren
op_amp
id|mgr_event
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * We set this so that we only notify once, since if &n;&t; * configuration of the network device fails, the user&n;&t; * will have to sort it out first anyway. No need to &n;&t; * try again.&n;&t; */
id|self-&gt;notify_irmanager
op_assign
id|FALSE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_eth_open (dev)&n; *&n; *    Network device has been opened by user&n; *&n; */
DECL|function|irlan_eth_open
r_int
id|irlan_eth_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|dev
op_ne
l_int|NULL
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* Ready to play! */
multiline_comment|/* &t;dev-&gt;tbusy = 0; */
multiline_comment|/* Wait until data link is ready */
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|1
suffix:semicolon
id|self-&gt;notify_irmanager
op_assign
id|TRUE
suffix:semicolon
multiline_comment|/* We are now open, so time to do some work */
id|irlan_client_wakeup
c_func
(paren
id|self
comma
id|self-&gt;saddr
comma
id|self-&gt;daddr
)paren
suffix:semicolon
id|irlan_mod_inc_use_count
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_eth_close (dev)&n; *&n; *    Stop the ether network device, his function will usually be called by&n; *    ifconfig down. We should now disconnect the link, We start the &n; *    close timer, so that the instance will be removed if we are unable&n; *    to discover the remote device after the disconnect.&n; */
DECL|function|irlan_eth_close
r_int
id|irlan_eth_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Stop device */
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|0
suffix:semicolon
id|irlan_mod_dec_use_count
c_func
(paren
)paren
suffix:semicolon
id|irlan_close_data_channel
c_func
(paren
id|self
)paren
suffix:semicolon
id|irlan_close_tsaps
c_func
(paren
id|self
)paren
suffix:semicolon
id|irlan_do_client_event
c_func
(paren
id|self
comma
id|IRLAN_LMP_DISCONNECT
comma
l_int|NULL
)paren
suffix:semicolon
id|irlan_do_provider_event
c_func
(paren
id|self
comma
id|IRLAN_LMP_DISCONNECT
comma
l_int|NULL
)paren
suffix:semicolon
id|irlan_start_watchdog_timer
c_func
(paren
id|self
comma
id|IRLAN_TIMEOUT
)paren
suffix:semicolon
multiline_comment|/* Device closed by user! */
r_if
c_cond
(paren
id|self-&gt;notify_irmanager
)paren
id|self-&gt;notify_irmanager
op_assign
id|FALSE
suffix:semicolon
r_else
id|self-&gt;notify_irmanager
op_assign
id|TRUE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_eth_tx (skb)&n; *&n; *    Transmits ethernet frames over IrDA link.&n; *&n; */
DECL|function|irlan_eth_xmit
r_int
id|irlan_eth_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
l_int|0
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
l_int|0
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* Check if IrTTP can accept more frames */
r_if
c_cond
(paren
id|dev-&gt;tbusy
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* skb headroom large enough to contain all IrDA-headers? */
r_if
c_cond
(paren
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
OL
id|self-&gt;max_header_size
)paren
op_logical_or
(paren
id|skb_shared
c_func
(paren
id|skb
)paren
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|new_skb
op_assign
id|skb_realloc_headroom
c_func
(paren
id|skb
comma
id|self-&gt;max_header_size
)paren
suffix:semicolon
multiline_comment|/*  We have to free the original skb anyway */
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* Did the realloc succeed? */
r_if
c_cond
(paren
id|new_skb
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Use the new skb instead */
id|skb
op_assign
id|new_skb
suffix:semicolon
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* Now queue the packet in the transport layer */
r_if
c_cond
(paren
id|self-&gt;use_udata
)paren
id|ret
op_assign
id|irttp_udata_request
c_func
(paren
id|self-&gt;tsap_data
comma
id|skb
)paren
suffix:semicolon
r_else
id|ret
op_assign
id|irttp_data_request
c_func
(paren
id|self-&gt;tsap_data
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
multiline_comment|/*   &n;&t;&t; * IrTTPs tx queue is full, so we just have to&n;&t;&t; * drop the frame! You might think that we should&n;&t;&t; * just return -1 and don&squot;t deallocate the frame,&n;&t;&t; * but that is dangerous since it&squot;s possible that&n;&t;&t; * we have replaced the original skb with a new&n;&t;&t; * one with larger headroom, and that would really&n;&t;&t; * confuse do_dev_queue_xmit() in dev.c! I have&n;&t;&t; * tried :-) DB &n;&t;&t; */
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|self-&gt;stats.tx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|self-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|self-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_eth_receive (handle, skb)&n; *&n; *    This function gets the data that is received on the data channel&n; *&n; */
DECL|function|irlan_eth_receive
r_int
id|irlan_eth_receive
c_func
(paren
r_void
op_star
id|instance
comma
r_void
op_star
id|sap
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|instance
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
op_increment
id|self-&gt;stats.rx_dropped
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ASSERT
c_func
(paren
id|skb-&gt;len
OG
l_int|1
comma
r_return
l_int|0
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Adopt this frame! Important to set all these fields since they &n;&t; * might have been previously set by the low level IrDA network&n;&t; * device driver &n;&t; */
id|skb-&gt;dev
op_assign
op_amp
id|self-&gt;dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|skb-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* Remove eth header */
id|self-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|self-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* Eat it! */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_eth_flow (status)&n; *&n; *    Do flow control between IP/Ethernet and IrLAN/IrTTP. This is done by &n; *    controlling the dev-&gt;tbusy variable.&n; */
DECL|function|irlan_eth_flow_indication
r_void
id|irlan_eth_flow_indication
c_func
(paren
r_void
op_star
id|instance
comma
r_void
op_star
id|sap
comma
id|LOCAL_FLOW
id|flow
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|instance
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|dev
op_assign
op_amp
id|self-&gt;dev
suffix:semicolon
id|ASSERT
c_func
(paren
id|dev
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|flow
)paren
(brace
r_case
id|FLOW_STOP
suffix:colon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FLOW_START
suffix:colon
r_default
suffix:colon
multiline_comment|/* Tell upper layers that its time to transmit frames again */
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Schedule network layer */
id|mark_bh
c_func
(paren
id|NET_BH
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Function irlan_eth_rebuild_header (buff, dev, dest, skb)&n; *&n; *    If we don&squot;t want to use ARP. Currently not used!!&n; *&n; */
DECL|function|irlan_eth_rebuild_header
r_void
id|irlan_eth_rebuild_header
c_func
(paren
r_void
op_star
id|buff
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|dest
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ethhdr
op_star
id|eth
op_assign
(paren
r_struct
id|ethhdr
op_star
)paren
id|buff
suffix:semicolon
id|memcpy
c_func
(paren
id|eth-&gt;h_source
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eth-&gt;h_dest
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
multiline_comment|/* return 0; */
)brace
multiline_comment|/*&n; * Function irlan_etc_send_gratuitous_arp (dev)&n; *&n; *    Send gratuitous ARP to announce that we have changed&n; *    hardware address, so that all peers updates their ARP tables&n; */
DECL|function|irlan_eth_send_gratuitous_arp
r_void
id|irlan_eth_send_gratuitous_arp
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
multiline_comment|/* &n;&t; * When we get a new MAC address do a gratuitous ARP. This&n;&t; * is useful if we have changed access points on the same&n;&t; * subnet.  &n;&t; */
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;IrLAN: Sending gratuitous ARP&bslash;n&quot;
)paren
suffix:semicolon
id|in_dev
op_assign
id|in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev-&gt;ifa_list
)paren
id|arp_send
c_func
(paren
id|ARPOP_REQUEST
comma
id|ETH_P_ARP
comma
id|in_dev-&gt;ifa_list-&gt;ifa_address
comma
id|dev
comma
id|in_dev-&gt;ifa_list-&gt;ifa_address
comma
l_int|NULL
comma
id|dev-&gt;dev_addr
comma
l_int|NULL
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function set_multicast_list (dev)&n; *&n; *    Configure the filtering of the device&n; *&n; */
DECL|macro|HW_MAX_ADDRS
mdefine_line|#define HW_MAX_ADDRS 4 /* Must query to get it! */
DECL|function|irlan_eth_set_multicast_list
r_void
id|irlan_eth_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
id|self
op_assign
id|dev-&gt;priv
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* Check if data channel has been connected yet */
r_if
c_cond
(paren
id|self-&gt;client.state
op_ne
id|IRLAN_DATA
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
id|__FUNCTION__
l_string|&quot;(), delaying!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Enable promiscuous mode */
id|WARNING
c_func
(paren
l_string|&quot;Promiscous mode not implemented by IrLAN!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_or
id|dev-&gt;mc_count
OG
id|HW_MAX_ADDRS
)paren
(brace
multiline_comment|/* Disable promiscuous mode, use normal mode. */
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;(), Setting multicast filter&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* hardware_set_filter(NULL); */
id|irlan_set_multicast_filter
c_func
(paren
id|self
comma
id|TRUE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;(), Setting multicast filter&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Walk the address list, and load the filter */
multiline_comment|/* hardware_set_filter(dev-&gt;mc_list); */
id|irlan_set_multicast_filter
c_func
(paren
id|self
comma
id|TRUE
)paren
suffix:semicolon
)brace
r_else
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;(), Clearing multicast filter&bslash;n&quot;
)paren
suffix:semicolon
id|irlan_set_multicast_filter
c_func
(paren
id|self
comma
id|FALSE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_BROADCAST
)paren
id|irlan_set_broadcast_filter
c_func
(paren
id|self
comma
id|TRUE
)paren
suffix:semicolon
r_else
id|irlan_set_broadcast_filter
c_func
(paren
id|self
comma
id|FALSE
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_get_stats (dev)&n; *&n; *    Get the current statistics for this device&n; *&n; */
DECL|function|irlan_eth_get_stats
r_struct
id|enet_statistics
op_star
id|irlan_eth_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
l_int|NULL
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
l_int|NULL
suffix:semicolon
)paren
suffix:semicolon
r_return
op_amp
id|self-&gt;stats
suffix:semicolon
)brace
eof
