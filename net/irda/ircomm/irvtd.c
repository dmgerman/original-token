multiline_comment|/*********************************************************************&n; *                &n; * Filename:      irvtd.c&n; * Version:       &n; * Description:   A virtual tty driver implementaion,&n; *                which also may be called as &quot;Port Emulation Entity&quot;&n; *                in IrCOMM specification.&n; * Status:        Experimental.&n; * Author:        Takahide Higuchi &lt;thiguchi@pluto.dti.ne.jp&gt;&n; * Source:        irlpt.c&n; *&n; *     Copyright (c) 1998, Takahide Higuchi, &lt;thiguchi@pluto.dti.ne.jp&gt;,&n; *     All Rights Reserved.&n; *&n; *     This program is free software; you can redistribute it and/or&n; *     modify it under the terms of the GNU General Public License as&n; *     published by the Free Software Foundation; either version 2 of&n; *     the License, or (at your option) any later version.&n; *&n; *     I, Takahide Higuchi, provide no warranty for any of this software.&n; *     This material is provided &quot;AS-IS&quot; and at no charge.&n; *&n; ********************************************************************/
multiline_comment|/* #include &lt;linux/module.h&gt; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;net/irda/irda.h&gt;
macro_line|#include &lt;net/irda/irlmp.h&gt;
macro_line|#include &lt;net/irda/irvtd.h&gt;
macro_line|#include &lt;net/irda/irvtd_driver.h&gt;
DECL|variable|irvtd
r_struct
id|irvtd_cb
op_star
op_star
id|irvtd
op_assign
l_int|NULL
suffix:semicolon
r_extern
r_struct
id|ircomm_cb
op_star
op_star
id|ircomm
suffix:semicolon
macro_line|#if 0
r_static
r_char
op_star
id|rcsid
op_assign
l_string|&quot;$Id: irvtd.c,v 1.2 1998/09/27 08:37:04 takahide Exp $&quot;
suffix:semicolon
macro_line|#endif
DECL|variable|version
r_static
r_char
op_star
id|version
op_assign
l_string|&quot;IrVTD, $Revision: 1.2 $ $Date: 1998/09/27 08:37:04 $ (Takahide Higuchi)&quot;
suffix:semicolon
multiline_comment|/************************************************************&n; *    init &amp; cleanup this module &n; ************************************************************/
multiline_comment|/*&n; * Function init_module(void)&n; *&n; *   Initializes the ircomm control structure&n; *   This Function is called when you do insmod.&n; */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|irvtd_init
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;irvtd:init_module:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
multiline_comment|/* we allocate master array */
id|irvtd
op_assign
(paren
r_struct
id|irvtd_cb
op_star
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_void
op_star
)paren
op_star
id|COMM_MAX_TTY
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irvtd
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;irvtd: Can&squot;t allocate array!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|irvtd
comma
l_int|0
comma
r_sizeof
(paren
r_void
op_star
)paren
op_star
id|COMM_MAX_TTY
)paren
suffix:semicolon
multiline_comment|/* we initialize structure */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|COMM_MAX_TTY
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irvtd
(braket
id|i
)braket
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|irvtd_cb
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irvtd
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ircomm_open(): kmalloc failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|irvtd
(braket
id|i
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|irvtd_cb
)paren
)paren
suffix:semicolon
id|irvtd
(braket
id|i
)braket
op_member_access_from_pointer
id|magic
op_assign
id|IRVTD_MAGIC
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * initialize a &quot;port emulation entity&quot;&n;&t; */
r_if
c_cond
(paren
id|irvtd_register_ttydriver
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;IrCOMM: Error in ircomm_register_device&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;irvtd:init_module:done&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|irvtd_cleanup
r_void
id|irvtd_cleanup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;--&gt; ircomm:cleanup_module&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * free some resources&n;&t; */
r_if
c_cond
(paren
id|irvtd
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|COMM_MAX_TTY
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|irvtd
(braket
id|i
)braket
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;freeing structures&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* irvtd_close();  :{| */
id|kfree
c_func
(paren
id|irvtd
(braket
id|i
)braket
)paren
suffix:semicolon
id|irvtd
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;freeing master array&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|irvtd
)paren
suffix:semicolon
id|irvtd
op_assign
l_int|NULL
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;unregister_ttydriver..&bslash;n&quot;
)paren
suffix:semicolon
id|irvtd_unregister_ttydriver
c_func
(paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;ircomm:cleanup_module --&gt;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
id|irvtd_init
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function ircomm_cleanup (void)&n; *   This is called when you rmmod.&n; */
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|irvtd_cleanup
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
eof
