multiline_comment|/*********************************************************************&n; *                &n; * Filename:      ircomm_common.c&n; * Version:       &n; * Description:   An implementation of IrCOMM service interface, &n; *                state machine, and incidental function(s).&n; * Status:        Experimental.&n; * Author:        Takahide Higuchi &lt;thiguchi@pluto.dti.ne.jp&gt;&n; * Source:        irlpt_event.c&n; *&n; *     Copyright (c) 1998, Takahide Higuchi, &lt;thiguchi@pluto.dti.ne.jp&gt;,&n; *     All Rights Reserved.&n; *&n; *     This program is free software; you can redistribute it and/or&n; *     modify it under the terms of the GNU General Public License as&n; *     published by the Free Software Foundation; either version 2 of&n; *     the License, or (at your option) any later version.&n; *&n; *     I, Takahide Higuchi, provide no warranty for any of this software.&n; *     This material is provided &quot;AS-IS&quot; and at no charge.&n; *&n; ********************************************************************/
multiline_comment|/*&n; *    Reference: &n; *    &quot;&squot;IrCOMM&squot;:Serial and Parallel Port Emulation Over IR(Wire Replacement)&quot;&n; *    version 1.0, which is available at http://www.irda.org/.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;net/irda/irda.h&gt;
macro_line|#include &lt;net/irda/irlmp.h&gt;
macro_line|#include &lt;net/irda/iriap.h&gt;
macro_line|#include &lt;net/irda/irttp.h&gt;
macro_line|#include &lt;net/irda/irias_object.h&gt;
macro_line|#include &lt;net/irda/ircomm_common.h&gt;
DECL|variable|revision_date
r_static
r_char
op_star
id|revision_date
op_assign
l_string|&quot;Sun Apr 18 00:40:19 1999&quot;
suffix:semicolon
r_static
r_void
id|ircomm_state_idle
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ircomm_state_discoverywait
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ircomm_state_queryparamwait
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ircomm_state_querylsapwait
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ircomm_state_waiti
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ircomm_state_waitr
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ircomm_state_conn
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ircomm_do_event
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ircomm_next_state
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_STATE
id|state
)paren
suffix:semicolon
r_static
r_void
id|ircomm_discovery_indication
c_func
(paren
id|discovery_t
op_star
id|discovery
)paren
suffix:semicolon
r_static
r_void
id|ircomm_tx_controlchannel
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
suffix:semicolon
r_static
r_int
id|ircomm_proc_read
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
id|unused
)paren
suffix:semicolon
r_static
r_void
id|start_discovering
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
suffix:semicolon
r_static
r_void
id|query_lsapsel
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
suffix:semicolon
r_static
r_void
id|query_parameters
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
suffix:semicolon
r_static
r_void
id|queryias_done
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
suffix:semicolon
r_static
r_void
id|ircomm_getvalue_confirm
c_func
(paren
r_int
id|result
comma
id|__u16
id|obj_id
comma
r_struct
id|ias_value
op_star
id|value
comma
r_void
op_star
id|priv
)paren
suffix:semicolon
DECL|variable|discovering_instance
r_struct
id|ircomm_cb
op_star
id|discovering_instance
suffix:semicolon
multiline_comment|/*&n; * debug parameter ircomm_cs:&n; *  0 = client/server, 1 = client only 2 = server only&n; * usage for example: &n; *  insmod ircomm ircomm_cs=1&n; *  LILO boot : Linux ircomm_cs=2   etc.&n; */
DECL|variable|ircomm_cs
r_static
r_int
id|ircomm_cs
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ircomm_cs
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|variable|ircommstate
r_static
r_char
op_star
id|ircommstate
(braket
)braket
op_assign
(brace
l_string|&quot;IDLE&quot;
comma
l_string|&quot;DISCOVERY_WAIT&quot;
comma
l_string|&quot;QUERYPARAM_WAIT&quot;
comma
l_string|&quot;QUERYLSAP_WAIT&quot;
comma
l_string|&quot;WAITI&quot;
comma
l_string|&quot;WAITR&quot;
comma
l_string|&quot;CONN&quot;
comma
)brace
suffix:semicolon
DECL|variable|ircommservicetype
r_static
r_char
op_star
id|ircommservicetype
(braket
)braket
op_assign
(brace
l_string|&quot;N/A&quot;
comma
l_string|&quot;THREE_WIRE_RAW&quot;
comma
l_string|&quot;THREE_WIRE&quot;
comma
l_string|&quot;NINE_WIRE&quot;
comma
l_string|&quot;CENTRONICS&quot;
comma
)brace
suffix:semicolon
DECL|variable|ircommporttype
r_static
r_char
op_star
id|ircommporttype
(braket
)braket
op_assign
(brace
l_string|&quot;Unknown&quot;
comma
l_string|&quot;SERIAL&quot;
comma
l_string|&quot;PARALLEL&quot;
comma
)brace
suffix:semicolon
DECL|variable|ircomm
r_struct
id|ircomm_cb
op_star
op_star
id|ircomm
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|ircommevent
r_static
r_char
op_star
id|ircommevent
(braket
)braket
op_assign
(brace
l_string|&quot;IRCOMM_CONNECT_REQUEST&quot;
comma
l_string|&quot;TTP_CONNECT_INDICATION&quot;
comma
l_string|&quot;LMP_CONNECT_INDICATION&quot;
comma
l_string|&quot;TTP_CONNECT_CONFIRM&quot;
comma
l_string|&quot;TTP_DISCONNECT_INDICATION&quot;
comma
l_string|&quot;LMP_CONNECT_CONFIRM&quot;
comma
l_string|&quot;LMP_DISCONNECT_INDICATION&quot;
comma
l_string|&quot;IRCOMM_CONNECT_RESPONSE&quot;
comma
l_string|&quot;IRCOMM_DISCONNECT_REQUEST&quot;
comma
l_string|&quot;TTP_DATA_INDICATION&quot;
comma
l_string|&quot;IRCOMM_DATA_REQUEST&quot;
comma
l_string|&quot;LMP_DATA_INDICATION&quot;
comma
l_string|&quot;IRCOMM_CONTROL_REQUEST&quot;
comma
l_string|&quot;DISCOVERY_INDICATION&quot;
comma
l_string|&quot;GOT_PARAMETERS&quot;
comma
l_string|&quot;GOT_LSAPSEL&quot;
comma
l_string|&quot;QUERYIAS_ERROR&quot;
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_extern
r_struct
id|proc_dir_entry
id|proc_irda
suffix:semicolon
DECL|variable|proc_ircomm
r_struct
id|proc_dir_entry
id|proc_ircomm
op_assign
(brace
l_int|0
comma
l_int|6
comma
l_string|&quot;ircomm&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|ircomm_proc_read
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|state
r_static
r_void
(paren
op_star
id|state
(braket
)braket
)paren
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
op_assign
(brace
id|ircomm_state_idle
comma
id|ircomm_state_discoverywait
comma
id|ircomm_state_queryparamwait
comma
id|ircomm_state_querylsapwait
comma
id|ircomm_state_waiti
comma
id|ircomm_state_waitr
comma
id|ircomm_state_conn
comma
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|ircomm_init
c_func
(paren
r_void
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Linux-IrDA: IrCOMM protocol ( revision:%s ) &bslash;n&quot;
comma
id|revision_date
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* allocate master array */
id|ircomm
op_assign
(paren
r_struct
id|ircomm_cb
op_star
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ircomm_cb
op_star
)paren
op_star
id|IRCOMM_MAX_CONNECTION
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ircomm
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|__FUNCTION__
l_string|&quot;(): kmalloc failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ircomm
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ircomm_cb
op_star
)paren
op_star
id|IRCOMM_MAX_CONNECTION
)paren
suffix:semicolon
multiline_comment|/* initialize structures */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IRCOMM_MAX_CONNECTION
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ircomm
(braket
id|i
)braket
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ircomm_cb
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ircomm
(braket
id|i
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|__FUNCTION__
l_string|&quot;(): kmalloc failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ircomm
(braket
id|i
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ircomm_cb
)paren
)paren
suffix:semicolon
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|magic
op_assign
id|IRCOMM_MAGIC
suffix:semicolon
multiline_comment|/* default settings */
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|data_format
op_assign
id|CS8
suffix:semicolon
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|flow_ctrl
op_assign
id|USE_RTS
op_or
id|USE_DTR
suffix:semicolon
multiline_comment|/*TODO: is this OK? */
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|xon_char
op_assign
l_int|0x11
suffix:semicolon
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|xoff_char
op_assign
l_int|0x13
suffix:semicolon
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|enq_char
op_assign
l_int|0x05
suffix:semicolon
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|ack_char
op_assign
l_int|0x06
suffix:semicolon
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|max_txbuff_size
op_assign
id|COMM_DEFAULT_DATA_SIZE
suffix:semicolon
multiline_comment|/* 64 */
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|maxsdusize
op_assign
id|SAR_DISABLE
suffix:semicolon
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|ctrl_skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|COMM_DEFAULT_DATA_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|ctrl_skb
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;ircomm:init_module:alloc_skb failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|ctrl_skb
comma
id|COMM_HEADER_SIZE
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * we register /proc/irda/ircomm&n;&t; */
macro_line|#ifdef CONFIG_PROC_FS
id|proc_register
c_func
(paren
op_amp
id|proc_irda
comma
op_amp
id|proc_ircomm
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
id|discovering_instance
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|ircomm_cleanup
r_void
id|ircomm_cleanup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;ircomm:cleanup_module&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * free some resources&n;&t; */
r_if
c_cond
(paren
id|ircomm
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IRCOMM_MAX_CONNECTION
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ircomm
(braket
id|i
)braket
)paren
(brace
r_if
c_cond
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|ctrl_skb
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|ctrl_skb
)paren
suffix:semicolon
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|ctrl_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;freeing structures(%d)&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ircomm
(braket
id|i
)braket
)paren
suffix:semicolon
id|ircomm
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;freeing master array&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ircomm
)paren
suffix:semicolon
id|ircomm
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
id|proc_unregister
c_func
(paren
op_amp
id|proc_irda
comma
id|proc_ircomm.low_ino
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
)brace
macro_line|#endif /* MODULE */
multiline_comment|/*&n; * ---------------------------------------------------------------------- &n; * callbacks which accept incoming indication/confirm from IrTTP  (or IrLMP)&n; * ---------------------------------------------------------------------- &n; */
DECL|function|ircomm_accept_data_indication
r_static
r_int
id|ircomm_accept_data_indication
c_func
(paren
r_void
op_star
id|instance
comma
r_void
op_star
id|sap
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ircomm_cb
op_star
id|self
op_assign
(paren
r_struct
id|ircomm_cb
op_star
)paren
id|instance
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|skb
op_ne
l_int|NULL
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():&bslash;n&quot;
)paren
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|TTP_DATA_INDICATION
comma
id|skb
)paren
suffix:semicolon
id|self-&gt;rx_packets
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ircomm_accept_connect_confirm
r_static
r_void
id|ircomm_accept_connect_confirm
c_func
(paren
r_void
op_star
id|instance
comma
r_void
op_star
id|sap
comma
r_struct
id|qos_info
op_star
id|qos
comma
id|__u32
id|maxsdusize
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ircomm_cb
op_star
id|self
op_assign
(paren
r_struct
id|ircomm_cb
op_star
)paren
id|instance
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|skb
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|qos
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(): got connected!&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|maxsdusize
op_eq
id|SAR_DISABLE
)paren
(brace
id|self-&gt;max_txbuff_size
op_assign
id|qos-&gt;data_size.value
suffix:semicolon
)brace
r_else
(brace
id|ASSERT
c_func
(paren
id|maxsdusize
op_ge
id|COMM_DEFAULT_DATA_SIZE
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|self-&gt;max_txbuff_size
op_assign
id|maxsdusize
suffix:semicolon
multiline_comment|/* use fragmentation */
)brace
id|self-&gt;qos
op_assign
id|qos
suffix:semicolon
id|self-&gt;null_modem_mode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* disable null modem emulation */
id|ircomm_do_event
c_func
(paren
id|self
comma
id|TTP_CONNECT_CONFIRM
comma
id|skb
)paren
suffix:semicolon
)brace
DECL|function|ircomm_accept_connect_indication
r_static
r_void
id|ircomm_accept_connect_indication
c_func
(paren
r_void
op_star
id|instance
comma
r_void
op_star
id|sap
comma
r_struct
id|qos_info
op_star
id|qos
comma
id|__u32
id|maxsdusize
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ircomm_cb
op_star
id|self
op_assign
(paren
r_struct
id|ircomm_cb
op_star
)paren
id|instance
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|skb
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|qos
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|maxsdusize
op_eq
id|SAR_DISABLE
)paren
(brace
id|self-&gt;max_txbuff_size
op_assign
id|qos-&gt;data_size.value
suffix:semicolon
)brace
r_else
id|self-&gt;max_txbuff_size
op_assign
id|maxsdusize
suffix:semicolon
id|self-&gt;qos
op_assign
id|qos
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|TTP_CONNECT_INDICATION
comma
id|skb
)paren
suffix:semicolon
multiline_comment|/* stop connecting */
id|wake_up_interruptible
c_func
(paren
op_amp
id|self-&gt;discovery_wait
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|self-&gt;ias_wait
)paren
suffix:semicolon
)brace
DECL|function|ircomm_accept_disconnect_indication
r_static
r_void
id|ircomm_accept_disconnect_indication
c_func
(paren
r_void
op_star
id|instance
comma
r_void
op_star
id|sap
comma
id|LM_REASON
id|reason
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ircomm_cb
op_star
id|self
op_assign
(paren
r_struct
id|ircomm_cb
op_star
)paren
id|instance
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():&bslash;n&quot;
)paren
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|TTP_DISCONNECT_INDICATION
comma
id|skb
)paren
suffix:semicolon
)brace
DECL|function|ircomm_accept_flow_indication
r_static
r_void
id|ircomm_accept_flow_indication
c_func
(paren
r_void
op_star
id|instance
comma
r_void
op_star
id|sap
comma
id|LOCAL_FLOW
id|cmd
)paren
(brace
id|IRCOMM_CMD
id|command
suffix:semicolon
r_struct
id|ircomm_cb
op_star
id|self
op_assign
(paren
r_struct
id|ircomm_cb
op_star
)paren
id|instance
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FLOW_START
suffix:colon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():START&bslash;n&quot;
)paren
suffix:semicolon
id|command
op_assign
id|TX_READY
suffix:semicolon
id|self-&gt;ttp_stop
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;notify.flow_indication
)paren
(brace
id|self-&gt;notify
dot
id|flow_indication
c_func
(paren
id|self-&gt;notify.instance
comma
id|self
comma
id|command
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FLOW_STOP
suffix:colon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;:STOP&bslash;n&quot;
)paren
suffix:semicolon
id|command
op_assign
id|TX_BUSY
suffix:semicolon
id|self-&gt;ttp_stop
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;notify.flow_indication
)paren
(brace
id|self-&gt;notify
dot
id|flow_indication
c_func
(paren
id|self-&gt;notify.instance
comma
id|self
comma
id|command
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;();unknown status!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ircomm_discovery_indication()&n; *    Remote device is discovered, try query the remote IAS to see which&n; *    device it is, and which services it has.&n; */
DECL|function|ircomm_discovery_indication
r_static
r_void
id|ircomm_discovery_indication
c_func
(paren
id|discovery_t
op_star
id|discovery
)paren
(brace
r_struct
id|ircomm_cb
op_star
id|self
suffix:semicolon
id|self
op_assign
id|discovering_instance
suffix:semicolon
r_if
c_cond
(paren
id|self
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|self-&gt;daddr
op_assign
id|discovery-&gt;daddr
suffix:semicolon
id|self-&gt;saddr
op_assign
id|discovery-&gt;saddr
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():daddr=%08x&bslash;n&quot;
comma
id|self-&gt;daddr
)paren
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|DISCOVERY_INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * ircomm_getvalue_confirm()&n; * handler for iriap_getvaluebyclass_request() &n; */
DECL|function|ircomm_getvalue_confirm
r_static
r_void
id|ircomm_getvalue_confirm
c_func
(paren
r_int
id|result
comma
id|__u16
id|obj_id
comma
r_struct
id|ias_value
op_star
id|value
comma
r_void
op_star
id|priv
)paren
(brace
r_struct
id|ircomm_cb
op_star
id|self
op_assign
(paren
r_struct
id|ircomm_cb
op_star
)paren
id|priv
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|__u8
id|servicetype
op_assign
l_int|0
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* Check if request succeeded */
r_if
c_cond
(paren
id|result
op_ne
id|IAS_SUCCESS
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), got NULL value!&bslash;n&quot;
)paren
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|QUERYIAS_ERROR
comma
l_int|NULL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():type(%d)&bslash;n&quot;
comma
id|value-&gt;type
)paren
suffix:semicolon
id|self-&gt;ias_type
op_assign
id|value-&gt;type
suffix:semicolon
r_switch
c_cond
(paren
id|value-&gt;type
)paren
(brace
r_case
id|IAS_OCT_SEQ
suffix:colon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():got octet sequence:&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if 0
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|value-&gt;len
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%02x&quot;
comma
(paren
id|__u8
)paren
(paren
op_star
(paren
id|value-&gt;t.oct_seq
op_plus
id|i
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
(paren
id|value-&gt;len
)paren
op_plus
l_int|2
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|skb
op_ne
l_int|NULL
comma
id|ircomm_do_event
c_func
(paren
id|self
comma
id|QUERYIAS_ERROR
comma
l_int|NULL
)paren
suffix:semicolon
r_return
suffix:semicolon
)paren
suffix:semicolon
id|frame
op_assign
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* MSB first */
id|frame
(braket
l_int|0
)braket
op_assign
(paren
id|value-&gt;len
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
id|value-&gt;len
op_amp
l_int|0xff
suffix:semicolon
id|frame
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|value-&gt;len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|frame
comma
id|value-&gt;t.oct_seq
comma
id|value-&gt;len
)paren
suffix:semicolon
id|ircomm_parse_tuples
c_func
(paren
id|self
comma
id|skb
comma
id|IAS_PARAM
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t; * check if servicetype we want is available &n;&t;&t; */
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():peer capability is:&bslash;n&quot;
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;3wire raw: %s&bslash;n&quot;
comma
(paren
(paren
id|self-&gt;peer_servicetype
op_amp
id|THREE_WIRE_RAW
)paren
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;3wire    : %s&bslash;n&quot;
comma
(paren
(paren
id|self-&gt;peer_servicetype
op_amp
id|THREE_WIRE
)paren
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;9wire    : %s&bslash;n&quot;
comma
(paren
(paren
id|self-&gt;peer_servicetype
op_amp
id|NINE_WIRE
)paren
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;IEEE1284 : %s&bslash;n&quot;
comma
(paren
(paren
id|self-&gt;peer_servicetype
op_amp
id|CENTRONICS
)paren
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
)paren
suffix:semicolon
id|self-&gt;servicetype
op_and_assign
id|self-&gt;peer_servicetype
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|self-&gt;servicetype
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(): servicetype mismatch!&bslash;n&quot;
)paren
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|QUERYIAS_ERROR
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * then choose better one &n;&t;&t; */
r_if
c_cond
(paren
id|self-&gt;servicetype
op_amp
id|THREE_WIRE_RAW
)paren
(brace
id|servicetype
op_assign
id|THREE_WIRE_RAW
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;servicetype
op_amp
id|THREE_WIRE
)paren
(brace
id|servicetype
op_assign
id|THREE_WIRE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;servicetype
op_amp
id|NINE_WIRE
)paren
(brace
id|servicetype
op_assign
id|NINE_WIRE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;servicetype
op_amp
id|CENTRONICS
)paren
(brace
id|servicetype
op_assign
id|CENTRONICS
suffix:semicolon
)brace
id|self-&gt;servicetype
op_assign
id|servicetype
suffix:semicolon
multiline_comment|/* enter next state */
id|ircomm_do_event
c_func
(paren
id|self
comma
id|GOT_PARAMETERS
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IAS_INTEGER
suffix:colon
multiline_comment|/* LsapSel seems to be sent to me */
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():got lsapsel = %d&bslash;n&quot;
comma
id|value-&gt;t.integer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value-&gt;t.integer
op_eq
op_minus
l_int|1
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():invalid value!&bslash;n&quot;
)paren
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|QUERYIAS_ERROR
comma
l_int|NULL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|self-&gt;dlsap
op_assign
id|value-&gt;t.integer
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|GOT_LSAPSEL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IAS_MISSING
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;:got IAS_MISSING&bslash;n&quot;
)paren
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|QUERYIAS_ERROR
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;:got unknown (strange?)type!&bslash;n&quot;
)paren
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|QUERYIAS_ERROR
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* &n; * ----------------------------------------------------------------------&n; * Impl. of actions (descrived in section 7.4 of the reference)&n; * ----------------------------------------------------------------------&n; */
DECL|function|issue_connect_request
r_static
r_void
id|issue_connect_request
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|userdata
)paren
(brace
multiline_comment|/* TODO: we have to send/build userdata field which contains &n;&t;   InitialControlParameters */
r_switch
c_cond
(paren
id|self-&gt;servicetype
)paren
(brace
r_case
id|THREE_WIRE_RAW
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():THREE_WIRE_RAW is not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DEFAULT
suffix:colon
r_case
id|THREE_WIRE
suffix:colon
r_case
id|NINE_WIRE
suffix:colon
r_case
id|CENTRONICS
suffix:colon
id|irttp_connect_request
c_func
(paren
id|self-&gt;tsap
comma
id|self-&gt;dlsap
comma
id|self-&gt;saddr
comma
id|self-&gt;daddr
comma
l_int|NULL
comma
id|self-&gt;maxsdusize
comma
id|userdata
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
id|__FUNCTION__
l_string|&quot;():Illegal servicetype %d&bslash;n&quot;
comma
id|self-&gt;servicetype
)paren
suffix:semicolon
)brace
)brace
DECL|function|disconnect_indication
r_static
r_void
id|disconnect_indication
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/*&n;&t; * Not implemented parameter&quot;Reason&quot;.That is optional.&n;&t; * What is reason? maybe discribed in irmod.h?&n;&t; */
r_if
c_cond
(paren
id|self-&gt;notify.disconnect_indication
)paren
(brace
id|self-&gt;notify
dot
id|disconnect_indication
c_func
(paren
id|self-&gt;notify.instance
comma
id|self
comma
id|self-&gt;reason
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
DECL|function|connect_indication
r_static
r_void
id|connect_indication
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|qos_info
op_star
id|qos
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/* If controlparameters don&squot;t exist, we use the servicetype&quot;DEFAULT&quot;.*/
multiline_comment|/* &t;if( !ircomm_parse_controlchannel( self, data)) */
multiline_comment|/* &t;&t;self-&gt;servicetype = DEFAULT;     TODOD:fix this! TH */
r_if
c_cond
(paren
id|self-&gt;notify.connect_indication
)paren
(brace
id|self-&gt;notify
dot
id|connect_indication
c_func
(paren
id|self-&gt;notify.instance
comma
id|self
comma
id|qos
comma
l_int|0
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
macro_line|#if 0
multiline_comment|/*   it&squot;s for THREE_WIRE_RAW.*/
r_static
r_void
id|connect_indication_three_wire_raw
c_func
(paren
r_void
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;ircomm:connect_indication_threewire():not implemented!&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif 
DECL|function|connect_confirmation
r_static
r_void
id|connect_confirmation
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* give a connect_confirm to the client */
r_if
c_cond
(paren
id|self-&gt;notify.connect_confirm
)paren
(brace
id|self-&gt;notify
dot
id|connect_confirm
c_func
(paren
id|self-&gt;notify.instance
comma
id|self
comma
l_int|NULL
comma
id|SAR_DISABLE
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
DECL|function|issue_connect_response
r_static
r_void
id|issue_connect_response
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;servicetype
op_eq
id|THREE_WIRE_RAW
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():THREE_WIRE_RAW is not implemented yet&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* irlmp_connect_rsp(); */
)brace
r_else
(brace
id|irttp_connect_response
c_func
(paren
id|self-&gt;tsap
comma
id|self-&gt;maxsdusize
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
DECL|function|issue_disconnect_request
r_static
r_void
id|issue_disconnect_request
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|userdata
)paren
(brace
r_if
c_cond
(paren
id|self-&gt;servicetype
op_eq
id|THREE_WIRE_RAW
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():3wireraw is not implemented&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|irttp_disconnect_request
c_func
(paren
id|self-&gt;tsap
comma
id|userdata
comma
id|self-&gt;disconnect_priority
)paren
suffix:semicolon
)brace
DECL|function|issue_data_request
r_static
r_void
id|issue_data_request
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|userdata
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;servicetype
op_eq
id|THREE_WIRE_RAW
)paren
(brace
multiline_comment|/* irlmp_data_request(self-&gt;lmhandle,userdata); */
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():not implemented!&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():sending frame&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
id|irttp_data_request
c_func
(paren
id|self-&gt;tsap
comma
id|userdata
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|__FUNCTION__
l_string|&quot;:ttp_data_request failed&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|userdata
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|userdata
)paren
suffix:semicolon
)brace
)brace
id|self-&gt;tx_packets
op_increment
suffix:semicolon
)brace
DECL|function|issue_control_request
r_static
r_void
id|issue_control_request
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|userdata
)paren
(brace
r_int
id|err
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;servicetype
op_eq
id|THREE_WIRE_RAW
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():THREE_WIRE_RAW is not implemented&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|irttp_data_request
c_func
(paren
id|self-&gt;tsap
comma
id|userdata
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|__FUNCTION__
l_string|&quot;():ttp_data_request failed&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|userdata
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|userdata
)paren
suffix:semicolon
)brace
)brace
r_else
id|self-&gt;tx_controls
op_increment
suffix:semicolon
id|self-&gt;pending_control_tuples
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|process_data
r_static
r_void
id|process_data
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;:skb-&gt;len=%d, ircomm header = 1, clen=%d&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
(paren
r_int
)paren
id|skb-&gt;data
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* we have to parse control channel when receiving.  (see&n;&t; * page17 of IrCOMM standard) but it is not parsed here since&n;&t; * upper layer may have some receive buffer.&n;&t; *&n;&t; * hence upper layer have to parse it when it consumes a packet.&n;&t; *   -- TH&n;&t; */
multiline_comment|/* ircomm_parse_control(self, skb, CONTROL_CHANNEL); */
r_if
c_cond
(paren
id|self-&gt;notify.data_indication
op_logical_and
id|skb-&gt;len
)paren
(brace
id|self-&gt;notify
dot
id|data_indication
c_func
(paren
id|self-&gt;notify.instance
comma
id|self
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
DECL|function|ircomm_data_indication
r_int
id|ircomm_data_indication
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/* Not implemented yet:THREE_WIRE_RAW service uses this function.  */
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;ircomm_data_indication:not implemented yet!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; * ----------------------------------------------------------------------&n; * Implementation of state chart,&n; * descrived in section 7.1 of the specification.&n; * ----------------------------------------------------------------------&n; */
DECL|function|ircomm_do_event
r_static
r_void
id|ircomm_do_event
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;: STATE = %s, EVENT = %s&bslash;n&quot;
comma
id|ircommstate
(braket
id|self-&gt;state
)braket
comma
id|ircommevent
(braket
id|event
)braket
)paren
suffix:semicolon
(paren
op_star
id|state
(braket
id|self-&gt;state
)braket
)paren
(paren
id|self
comma
id|event
comma
id|skb
)paren
suffix:semicolon
)brace
DECL|function|ircomm_next_state
r_static
r_void
id|ircomm_next_state
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_STATE
id|state
)paren
(brace
id|self-&gt;state
op_assign
id|state
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;: NEXT STATE=%d(%s), servicetype=(%d)&bslash;n&quot;
comma
(paren
r_int
)paren
id|state
comma
id|ircommstate
(braket
id|self-&gt;state
)braket
comma
id|self-&gt;servicetype
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ircomm_state_idle&n; */
DECL|function|ircomm_state_idle
r_static
r_void
id|ircomm_state_idle
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|IRCOMM_CONNECT_REQUEST
suffix:colon
multiline_comment|/* ircomm_next_state(self, COMM_WAITI); */
multiline_comment|/* issue_connect_request( self, skb ); */
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_DISCOVERY_WAIT
)paren
suffix:semicolon
id|start_discovering
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TTP_CONNECT_INDICATION
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_WAITR
)paren
suffix:semicolon
id|connect_indication
c_func
(paren
id|self
comma
id|self-&gt;qos
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LMP_CONNECT_INDICATION
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():LMP_CONNECT_IND is notimplemented!&quot;
)paren
suffix:semicolon
multiline_comment|/* connect_indication_three_wire_raw(); */
multiline_comment|/* ircomm_next_state(self, COMM_WAITR); */
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():unknown event =%d(%s)&bslash;n&quot;
comma
id|event
comma
id|ircommevent
(braket
id|event
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ircomm_state_discoverywait&n; */
DECL|function|ircomm_state_discoverywait
r_static
r_void
id|ircomm_state_discoverywait
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|TTP_CONNECT_INDICATION
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_WAITR
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
id|connect_indication
c_func
(paren
id|self
comma
id|self-&gt;qos
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISCOVERY_INDICATION
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_QUERYPARAM_WAIT
)paren
suffix:semicolon
id|query_parameters
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IRCOMM_DISCONNECT_REQUEST
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QUERYIAS_ERROR
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|disconnect_indication
c_func
(paren
id|self
comma
l_int|NULL
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():unknown event =%d(%s)&bslash;n&quot;
comma
id|event
comma
id|ircommevent
(braket
id|event
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ircomm_state_queryparamwait&n; */
DECL|function|ircomm_state_queryparamwait
r_static
r_void
id|ircomm_state_queryparamwait
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|TTP_CONNECT_INDICATION
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_WAITR
)paren
suffix:semicolon
id|connect_indication
c_func
(paren
id|self
comma
id|self-&gt;qos
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GOT_PARAMETERS
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_QUERYLSAP_WAIT
)paren
suffix:semicolon
id|query_lsapsel
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IRCOMM_DISCONNECT_REQUEST
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QUERYIAS_ERROR
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|disconnect_indication
c_func
(paren
id|self
comma
l_int|NULL
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():unknown event =%d(%s)&bslash;n&quot;
comma
id|event
comma
id|ircommevent
(braket
id|event
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ircomm_state_querylsapwait&n; */
DECL|function|ircomm_state_querylsapwait
r_static
r_void
id|ircomm_state_querylsapwait
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|TTP_CONNECT_INDICATION
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_WAITR
)paren
suffix:semicolon
id|connect_indication
c_func
(paren
id|self
comma
id|self-&gt;qos
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GOT_LSAPSEL
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_WAITI
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
id|issue_connect_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IRCOMM_DISCONNECT_REQUEST
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QUERYIAS_ERROR
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|disconnect_indication
c_func
(paren
id|self
comma
l_int|NULL
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():unknown event =%d(%s)&bslash;n&quot;
comma
id|event
comma
id|ircommevent
(braket
id|event
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ircomm_state_waiti&n; */
DECL|function|ircomm_state_waiti
r_static
r_void
id|ircomm_state_waiti
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|TTP_CONNECT_CONFIRM
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_CONN
)paren
suffix:semicolon
id|connect_confirmation
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TTP_DISCONNECT_INDICATION
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|disconnect_indication
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* &t;case LMP_CONNECT_CONFIRM: */
multiline_comment|/* &t;&t;ircomm_connect_cnfirmation; */
multiline_comment|/* &t;&t;ircomm_next_state(self, COMM_CONN); */
multiline_comment|/* &t;&t;break; */
multiline_comment|/* &t;case LMP_DISCONNECT_INDICATION: */
multiline_comment|/* &t;&t;ircomm_disconnect_ind; */
multiline_comment|/* &t;&t;ircomm_next_state(self, COMM_IDLE); */
multiline_comment|/* &t;&t;break; */
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():unknown event =%d(%s)&bslash;n&quot;
comma
id|event
comma
id|ircommevent
(braket
id|event
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ircomm_state_waitr&n; */
DECL|function|ircomm_state_waitr
r_static
r_void
id|ircomm_state_waitr
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|IRCOMM_CONNECT_RESPONSE
suffix:colon
multiline_comment|/* issue_connect_response */
r_if
c_cond
(paren
id|self-&gt;servicetype
op_eq
id|THREE_WIRE_RAW
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():3WIRE_RAW is not implemented&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* irlmp_connect_response(Vpeersap,&n;&t;&t;&t; *                         ACCEPT,null);&n;&t;&t;&t; */
)brace
r_else
(brace
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_CONN
)paren
suffix:semicolon
id|issue_connect_response
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|IRCOMM_DISCONNECT_REQUEST
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|issue_disconnect_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TTP_DISCONNECT_INDICATION
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|disconnect_indication
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISCOVERY_INDICATION
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():DISCOVERY_INDICATION&bslash;n&quot;
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GOT_PARAMETERS
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():GOT_PARAMETERS&bslash;n&quot;
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GOT_LSAPSEL
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():GOT_LSAPSEL&bslash;n&quot;
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* &t;case LMP_DISCONNECT_INDICATION: */
multiline_comment|/* &t;&t;disconnect_indication();&t;&t; */
multiline_comment|/* &t;&t;ircomm_next_state(self, COMM_IDLE);&t;&t; */
multiline_comment|/* &t;&t;break; */
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;ircomm_state_waitr:unknown event =%d(%s)&bslash;n&quot;
comma
id|event
comma
id|ircommevent
(braket
id|event
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ircomm_state_conn&n; */
DECL|function|ircomm_state_conn
r_static
r_void
id|ircomm_state_conn
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|IRCOMM_EVENT
id|event
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|TTP_DATA_INDICATION
suffix:colon
id|process_data
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IRCOMM_DATA_REQUEST
suffix:colon
id|issue_data_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* &t;case LMP_DATA_INDICATION: */
multiline_comment|/* &t;&t;ircomm_data_indicated(); */
multiline_comment|/* &t;&t;break; */
r_case
id|IRCOMM_CONTROL_REQUEST
suffix:colon
id|issue_control_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TTP_DISCONNECT_INDICATION
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|disconnect_indication
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IRCOMM_DISCONNECT_REQUEST
suffix:colon
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
id|issue_disconnect_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* &t;case LM_DISCONNECT_INDICATION: */
multiline_comment|/* &t;&t;disconnect_indication(); */
multiline_comment|/* &t;&t;ircomm_next_state(self, COMM_IDLE); */
multiline_comment|/* &t;&t;break; */
r_case
id|DISCOVERY_INDICATION
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():DISCOVERY_INDICATION&bslash;n&quot;
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GOT_PARAMETERS
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():GOT_PARAMETERS&bslash;n&quot;
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GOT_LSAPSEL
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():GOT_LSAPSEL&bslash;n&quot;
)paren
suffix:semicolon
id|queryias_done
c_func
(paren
id|self
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;ircomm_state_conn:unknown event =%d(%s)&bslash;n&quot;
comma
id|event
comma
id|ircommevent
(braket
id|event
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  ----------------------------------------------------------------------&n; *  IrCOMM service interfaces and supporting functions&n; *&n; *  ----------------------------------------------------------------------&n; */
multiline_comment|/* &n; * start_discovering()&n; *&n; * start discovering and enter DISCOVERY_WAIT state&n; */
DECL|function|start_discovering
r_static
r_void
id|start_discovering
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
(brace
id|__u16
id|hints
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():servicetype = %d&bslash;n&quot;
comma
id|self-&gt;servicetype
)paren
suffix:semicolon
id|hints
op_assign
id|irlmp_service_to_hint
c_func
(paren
id|S_COMM
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():start discovering..&bslash;n&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ircomm_cs
)paren
(brace
r_case
l_int|0
suffix:colon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|self-&gt;queryias_lock
op_assign
l_int|1
suffix:semicolon
id|discovering_instance
op_assign
id|self
suffix:semicolon
id|self-&gt;skey
op_assign
id|irlmp_register_service
c_func
(paren
id|hints
)paren
suffix:semicolon
id|self-&gt;ckey
op_assign
id|irlmp_register_client
c_func
(paren
id|hints
comma
id|ircomm_discovery_indication
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* client only */
id|MOD_INC_USE_COUNT
suffix:semicolon
id|self-&gt;queryias_lock
op_assign
l_int|1
suffix:semicolon
id|discovering_instance
op_assign
id|self
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():client only mode&bslash;n&quot;
)paren
suffix:semicolon
id|self-&gt;ckey
op_assign
id|irlmp_register_client
c_func
(paren
id|hints
comma
id|ircomm_discovery_indication
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/*  server only  */
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():server only mode&bslash;n&quot;
)paren
suffix:semicolon
id|self-&gt;skey
op_assign
id|irlmp_register_service
c_func
(paren
id|hints
)paren
suffix:semicolon
id|discovering_instance
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * queryias_done(self)&n; *&n; * called when discovery process got wrong results, completed, or terminated.&n; */
DECL|function|queryias_done
r_static
r_void
id|queryias_done
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;queryias_lock
)paren
(brace
id|self-&gt;queryias_lock
op_assign
l_int|0
suffix:semicolon
id|discovering_instance
op_assign
l_int|NULL
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|irlmp_unregister_client
c_func
(paren
id|self-&gt;ckey
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ircomm_cs
op_ne
l_int|1
)paren
(brace
id|irlmp_unregister_service
c_func
(paren
id|self-&gt;skey
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|query_parameters
r_static
r_void
id|query_parameters
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():querying IAS: Parameters..&bslash;n&quot;
)paren
suffix:semicolon
id|iriap_getvaluebyclass_request
c_func
(paren
l_string|&quot;IrDA:IrCOMM&quot;
comma
l_string|&quot;Parameters&quot;
comma
id|self-&gt;saddr
comma
id|self-&gt;daddr
comma
id|ircomm_getvalue_confirm
comma
id|self
)paren
suffix:semicolon
)brace
DECL|function|query_lsapsel
r_static
r_void
id|query_lsapsel
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():querying IAS: Lsapsel...&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|self-&gt;servicetype
op_amp
id|THREE_WIRE_RAW
)paren
)paren
(brace
id|iriap_getvaluebyclass_request
c_func
(paren
l_string|&quot;IrDA:IrCOMM&quot;
comma
l_string|&quot;IrDA:TinyTP:LsapSel&quot;
comma
id|self-&gt;saddr
comma
id|self-&gt;daddr
comma
id|ircomm_getvalue_confirm
comma
id|self
)paren
suffix:semicolon
)brace
r_else
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;THREE_WIRE_RAW is not implemented!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* &n; * ircomm_connect_request()&n; * Impl. of this function is differ from one of the reference.&n; * This functin does discovery as well as sending connect request&n; */
DECL|function|ircomm_connect_request
r_void
id|ircomm_connect_request
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|__u8
id|servicetype
)paren
(brace
multiline_comment|/*&n;&t; * TODO:build a packet which contains &quot;initial control parameters&quot;&n;&t; * and send it with connect_request&n;&t; */
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():sending connect_request...&bslash;n&quot;
)paren
suffix:semicolon
id|self-&gt;servicetype
op_assign
id|servicetype
suffix:semicolon
multiline_comment|/* ircomm_control_request(self, SERVICETYPE); */
multiline_comment|/*servictype*/
id|self-&gt;maxsdusize
op_assign
id|SAR_DISABLE
suffix:semicolon
id|ircomm_do_event
c_func
(paren
id|self
comma
id|IRCOMM_CONNECT_REQUEST
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|ircomm_connect_response
r_void
id|ircomm_connect_response
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|userdata
comma
id|__u32
id|maxsdusize
)paren
(brace
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* ASSERT( userdata != NULL, return;); */
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;ircomm_connect_response:&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * TODO:build a packet which contains &quot;initial control parameters&quot;&n;&t; * and send it with connect_response&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|userdata
)paren
(brace
multiline_comment|/* FIXME: check for errors and initialize? DB */
id|userdata
op_assign
id|dev_alloc_skb
c_func
(paren
id|COMM_DEFAULT_DATA_SIZE
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|userdata
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|userdata
comma
id|COMM_HEADER_SIZE
)paren
suffix:semicolon
)brace
multiline_comment|/* enable null-modem emulation (i.e. server mode )*/
id|self-&gt;null_modem_mode
op_assign
l_int|1
suffix:semicolon
id|self-&gt;maxsdusize
op_assign
id|maxsdusize
suffix:semicolon
r_if
c_cond
(paren
id|maxsdusize
op_ne
id|SAR_DISABLE
)paren
(brace
id|self-&gt;max_txbuff_size
op_assign
id|maxsdusize
suffix:semicolon
)brace
id|ircomm_do_event
c_func
(paren
id|self
comma
id|IRCOMM_CONNECT_RESPONSE
comma
id|userdata
)paren
suffix:semicolon
)brace
DECL|function|ircomm_disconnect_request
r_void
id|ircomm_disconnect_request
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|userdata
comma
r_int
id|priority
)paren
(brace
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* unregister layer */
r_switch
c_cond
(paren
id|ircomm_cs
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* client only */
id|irlmp_unregister_client
c_func
(paren
id|ckey
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/*  server only  */
id|irlmp_unregister_service
c_func
(paren
id|skey
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
r_default
suffix:colon
id|irlmp_unregister_client
c_func
(paren
id|ckey
)paren
suffix:semicolon
id|irlmp_unregister_service
c_func
(paren
id|skey
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
id|self-&gt;disconnect_priority
op_assign
id|priority
suffix:semicolon
r_if
c_cond
(paren
id|priority
op_ne
id|P_HIGH
)paren
(brace
id|self-&gt;disconnect_priority
op_assign
id|P_NORMAL
suffix:semicolon
)brace
id|ircomm_do_event
c_func
(paren
id|self
comma
id|IRCOMM_DISCONNECT_REQUEST
comma
id|userdata
)paren
suffix:semicolon
)brace
DECL|function|ircomm_data_request
r_int
id|ircomm_data_request
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|userdata
)paren
(brace
id|__u8
op_star
id|frame
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
op_minus
id|EFAULT
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
op_minus
id|EFAULT
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|userdata
op_ne
l_int|NULL
comma
r_return
op_minus
id|EFAULT
suffix:semicolon
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;state
op_ne
id|COMM_CONN
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():not connected, data is ignored&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;ttp_stop
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;control_ch_pending
)paren
(brace
multiline_comment|/* send control_channel */
id|ircomm_tx_controlchannel
c_func
(paren
id|self
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;ttp_stop
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/* add &quot;clen&quot; field */
id|frame
op_assign
id|skb_push
c_func
(paren
id|userdata
comma
l_int|1
)paren
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* without control channel */
id|ircomm_do_event
c_func
(paren
id|self
comma
id|IRCOMM_DATA_REQUEST
comma
id|userdata
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  ----------------------------------------------------------------------&n; *  IrCOMM_control.req and friends&n; *&n; *  ----------------------------------------------------------------------&n; */
DECL|function|ircomm_tx_controlchannel
r_static
r_void
id|ircomm_tx_controlchannel
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
(brace
id|__u8
id|clen
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|self-&gt;ctrl_skb
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* &squot;self&squot; should have been checked */
id|ASSERT
c_func
(paren
op_logical_neg
id|self-&gt;ttp_stop
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;state
op_eq
id|COMM_CONN
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* add &quot;clen&quot; field */
id|clen
op_assign
id|skb-&gt;len
suffix:semicolon
id|ASSERT
c_func
(paren
id|clen
op_ne
l_int|0
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb_push
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
id|skb-&gt;data
(braket
l_int|0
)braket
op_assign
id|clen
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;tx_ctrl:&quot;
)paren
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb-&gt;len
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%02x&quot;
comma
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|ircomm_do_event
c_func
(paren
id|self
comma
id|IRCOMM_CONTROL_REQUEST
comma
id|skb
)paren
suffix:semicolon
id|self-&gt;control_ch_pending
op_assign
l_int|0
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|COMM_DEFAULT_DATA_SIZE
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|skb
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|COMM_HEADER_SIZE
)paren
suffix:semicolon
id|self-&gt;ctrl_skb
op_assign
id|skb
suffix:semicolon
)brace
DECL|function|append_tuple
r_static
r_void
id|append_tuple
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|__u8
id|instruction
comma
id|__u8
id|pl
comma
id|__u8
op_star
id|value
)paren
(brace
id|__u8
op_star
id|frame
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|i
comma
id|c
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|skb
op_assign
id|self-&gt;ctrl_skb
suffix:semicolon
id|ASSERT
c_func
(paren
id|skb
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
(paren
id|pl
op_plus
l_int|2
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;there&squot;s no room.. ignore it&bslash;n&quot;
)paren
suffix:semicolon
id|self-&gt;ignored_control_tuples
op_increment
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|frame
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|pl
op_plus
l_int|2
)paren
suffix:semicolon
id|frame
(braket
id|c
op_increment
)braket
op_assign
id|instruction
suffix:semicolon
multiline_comment|/* PI */
id|frame
(braket
id|c
op_increment
)braket
op_assign
id|pl
suffix:semicolon
multiline_comment|/* PL */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pl
suffix:semicolon
id|i
op_increment
)paren
(brace
id|frame
(braket
id|c
op_increment
)braket
op_assign
op_star
id|value
op_increment
suffix:semicolon
)brace
multiline_comment|/* PV */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|self-&gt;pending_control_tuples
op_increment
suffix:semicolon
id|self-&gt;control_ch_pending
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * ircomm_control_request();&n; * this function is exported as a request to send some control-channel tuples&n; * to peer device&n; */
DECL|function|ircomm_control_request
r_void
id|ircomm_control_request
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
id|__u8
id|instruction
)paren
(brace
id|__u8
id|pv
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* 32 max, for PORT_NAME */
id|__u8
op_star
id|value
op_assign
op_amp
id|pv
(braket
l_int|0
)braket
suffix:semicolon
id|__u32
id|temp
suffix:semicolon
r_int
id|notsupp
op_assign
l_int|0
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;servicetype
op_eq
id|THREE_WIRE_RAW
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():THREE_WIRE_RAW shuold not use me!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* find parameter and its length */
r_if
c_cond
(paren
id|self-&gt;servicetype
op_eq
id|THREE_WIRE
)paren
(brace
r_goto
id|threewire
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;servicetype
op_eq
id|NINE_WIRE
)paren
(brace
r_goto
id|ninewire
suffix:semicolon
)brace
multiline_comment|/* FIXME: centronics service is not fully implemented yet*/
r_switch
c_cond
(paren
id|instruction
)paren
(brace
r_case
id|IEEE1284_MODE_SUPPORT
suffix:colon
r_case
id|IEEE1284_DEVICEID
suffix:colon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATUS_QUERY
suffix:colon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SET_BUSY_TIMEOUT
suffix:colon
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;busy_timeout
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|1
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IEEE1284_ECP_EPP_DATA_TRANSFER
suffix:colon
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;ecp_epp_mode
suffix:semicolon
id|value
(braket
l_int|1
)braket
op_assign
id|self-&gt;channel_or_addr
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|2
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|notsupp
op_assign
l_int|1
suffix:semicolon
)brace
id|ninewire
suffix:colon
r_switch
c_cond
(paren
id|instruction
)paren
(brace
r_case
id|POLL_FOR_LINE_SETTINGS
suffix:colon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DTELINE_STATE
suffix:colon
r_if
c_cond
(paren
id|self-&gt;null_modem_mode
)paren
(brace
multiline_comment|/* null modem emulation */
multiline_comment|/* output RTS as CTS */
r_if
c_cond
(paren
id|self-&gt;dte
op_amp
id|DELTA_RTS
)paren
(brace
id|value
(braket
l_int|0
)braket
op_assign
id|DELTA_CTS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;dte
op_amp
id|MCR_RTS
)paren
(brace
id|value
(braket
l_int|0
)braket
op_or_assign
id|MSR_CTS
suffix:semicolon
)brace
multiline_comment|/* output DTR as {DSR &amp; CD &amp; RI} */
r_if
c_cond
(paren
id|self-&gt;dte
op_amp
id|DELTA_DTR
)paren
(brace
id|value
(braket
l_int|0
)braket
op_or_assign
(paren
id|DELTA_DSR
op_or
id|DELTA_RI
op_or
id|DELTA_DCD
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;dte
op_amp
id|MCR_DTR
)paren
(brace
id|value
(braket
l_int|0
)braket
op_or_assign
(paren
id|MSR_DSR
op_or
id|MSR_RI
op_or
id|MSR_DCD
)paren
suffix:semicolon
)brace
id|append_tuple
c_func
(paren
id|self
comma
id|DCELINE_STATE
comma
l_int|1
comma
id|value
)paren
suffix:semicolon
)brace
r_else
(brace
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;dte
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|1
comma
id|value
)paren
suffix:semicolon
)brace
id|self-&gt;dte
op_and_assign
op_complement
(paren
id|DELTA_RTS
op_or
id|DELTA_DTR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DCELINE_STATE
suffix:colon
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;dce
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|1
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|notsupp
op_assign
l_int|1
suffix:semicolon
)brace
id|threewire
suffix:colon
r_switch
c_cond
(paren
id|instruction
)paren
(brace
r_case
id|SERVICETYPE
suffix:colon
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;servicetype
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|1
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DATA_FORMAT
suffix:colon
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;data_format
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|1
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FLOW_CONTROL
suffix:colon
r_if
c_cond
(paren
id|self-&gt;null_modem_mode
)paren
(brace
multiline_comment|/* inside out */
id|value
(braket
l_int|0
)braket
op_assign
(paren
id|self-&gt;flow_ctrl
op_amp
l_int|0x55
)paren
op_lshift
l_int|1
suffix:semicolon
id|value
(braket
l_int|0
)braket
op_or_assign
(paren
id|self-&gt;flow_ctrl
op_amp
l_int|0xAA
)paren
op_rshift
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;flow_ctrl
suffix:semicolon
)brace
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|1
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LINESTATUS
suffix:colon
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;line_status
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|1
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BREAK_SIGNAL
suffix:colon
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;break_signal
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|1
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|XON_XOFF_CHAR
suffix:colon
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;xon_char
suffix:semicolon
id|value
(braket
l_int|1
)braket
op_assign
id|self-&gt;xoff_char
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|2
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ENQ_ACK_CHAR
suffix:colon
id|value
(braket
l_int|0
)braket
op_assign
id|self-&gt;enq_char
suffix:semicolon
id|value
(braket
l_int|1
)braket
op_assign
id|self-&gt;ack_char
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|2
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DATA_RATE
suffix:colon
id|temp
op_assign
id|self-&gt;data_rate
suffix:semicolon
id|value
(braket
l_int|3
)braket
op_assign
(paren
id|__u8
)paren
(paren
(paren
id|temp
op_rshift
l_int|24
)paren
op_amp
l_int|0x000000ff
)paren
suffix:semicolon
id|value
(braket
l_int|2
)braket
op_assign
(paren
id|__u8
)paren
(paren
(paren
id|temp
op_rshift
l_int|16
)paren
op_amp
l_int|0x000000ff
)paren
suffix:semicolon
id|value
(braket
l_int|1
)braket
op_assign
(paren
id|__u8
)paren
(paren
(paren
id|temp
op_rshift
l_int|8
)paren
op_amp
l_int|0x000000ff
)paren
suffix:semicolon
id|value
(braket
l_int|0
)braket
op_assign
(paren
id|__u8
)paren
(paren
id|temp
op_amp
l_int|0x000000ff
)paren
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
l_int|4
comma
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|PORT_NAME
suffix:colon
r_case
id|FIXED_PORT_NAME
suffix:colon
id|temp
op_assign
id|strlen
c_func
(paren
op_amp
id|self-&gt;port_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
OL
l_int|32
)paren
(brace
id|value
op_assign
(paren
id|__u8
)paren
(paren
id|self-&gt;port_name
)paren
suffix:semicolon
id|append_tuple
c_func
(paren
id|self
comma
id|instruction
comma
id|temp
comma
id|value
)paren
suffix:semicolon
)brace
r_else
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;() PORT_NAME:too long&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|notsupp
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():instruction(0x%02x)is not&quot;
l_string|&quot;implemented&bslash;n&quot;
comma
id|instruction
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|ircomm_parse_tuples
r_void
id|ircomm_parse_tuples
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|type
)paren
(brace
id|__u8
op_star
id|data
suffix:semicolon
id|__u8
id|pi
comma
id|plen
suffix:semicolon
r_int
id|clen
op_assign
l_int|0
suffix:semicolon
r_int
id|indicate
op_assign
l_int|0
suffix:semicolon
id|ASSERT
c_func
(paren
id|skb
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
macro_line|#ifdef IRCOMM_DEBUG_TUPLE
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():tuple sequence is:&bslash;n&quot;
)paren
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb-&gt;len
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%02x&quot;
comma
(paren
id|__u8
)paren
(paren
id|skb-&gt;data
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|data
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|IAS_PARAM
)paren
(brace
id|clen
op_assign
(paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_amp
l_int|0xff00
suffix:semicolon
id|clen
op_or_assign
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x00ff
suffix:semicolon
id|ASSERT
c_func
(paren
id|clen
op_le
(paren
id|skb-&gt;len
op_minus
l_int|2
)paren
op_logical_and
id|clen
op_le
l_int|1024
comma
r_goto
id|corrupted
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():IAS_PARAM len = %d&bslash;n&quot;
comma
id|clen
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* CONTROL_CHANNEL */
id|clen
op_assign
id|data
(braket
l_int|0
)braket
suffix:semicolon
id|ASSERT
c_func
(paren
id|clen
OL
id|skb-&gt;len
comma
r_goto
id|corrupted
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():CONTROL_CHANNEL:len = %d&bslash;n&quot;
comma
id|clen
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|clen
op_ge
l_int|2
)paren
(brace
id|data
op_assign
id|skb-&gt;data
suffix:semicolon
id|indicate
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* &n;&t;&t; * parse controlparameters and set value into structure &n;&t;&t; */
id|pi
op_assign
id|data
(braket
l_int|0
)braket
suffix:semicolon
id|plen
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|ASSERT
c_func
(paren
id|clen
op_ge
l_int|2
op_plus
id|plen
comma
r_goto
id|corrupted
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():instruction=0x%02x,len=%d&bslash;n&quot;
comma
id|pi
comma
id|plen
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|pi
)paren
(brace
r_case
id|POLL_FOR_LINE_SETTINGS
suffix:colon
id|ircomm_control_request
c_func
(paren
id|self
comma
id|DTELINE_STATE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SERVICETYPE
suffix:colon
id|self-&gt;peer_servicetype
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PORT_TYPE
suffix:colon
id|self-&gt;peer_port_type
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DATA_FORMAT
suffix:colon
id|self-&gt;peer_data_format
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FLOW_CONTROL
suffix:colon
id|self-&gt;peer_flow_ctrl
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|indicate
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LINESTATUS
suffix:colon
id|self-&gt;peer_line_status
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|indicate
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BREAK_SIGNAL
suffix:colon
id|self-&gt;peer_break_signal
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* indicate = 1; */
r_break
suffix:semicolon
r_case
id|DCELINE_STATE
suffix:colon
id|self-&gt;peer_dce
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|indicate
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DTELINE_STATE
suffix:colon
r_if
c_cond
(paren
id|self-&gt;null_modem_mode
)paren
(brace
multiline_comment|/* input DTR as {DSR &amp; CD &amp; RI} */
id|self-&gt;peer_dce
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|2
)braket
op_amp
id|DELTA_DTR
)paren
(brace
id|self-&gt;peer_dce
op_or_assign
(paren
id|DELTA_DSR
op_or
id|DELTA_RI
op_or
id|DELTA_DCD
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data
(braket
l_int|2
)braket
op_amp
id|MCR_DTR
)paren
(brace
id|self-&gt;peer_dce
op_or_assign
(paren
id|MSR_DSR
op_or
id|MSR_RI
op_or
id|MSR_DCD
)paren
suffix:semicolon
)brace
multiline_comment|/* rts as cts */
r_if
c_cond
(paren
id|data
(braket
l_int|2
)braket
op_amp
id|DELTA_RTS
)paren
(brace
id|self-&gt;peer_dce
op_or_assign
id|DELTA_CTS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data
(braket
l_int|2
)braket
op_amp
id|MCR_RTS
)paren
(brace
id|self-&gt;peer_dce
op_or_assign
id|MSR_CTS
suffix:semicolon
)brace
)brace
r_else
(brace
id|self-&gt;peer_dte
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
)brace
id|indicate
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|XON_XOFF_CHAR
suffix:colon
id|self-&gt;peer_xon_char
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|self-&gt;peer_xoff_char
op_assign
id|data
(braket
l_int|3
)braket
suffix:semicolon
id|indicate
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ENQ_ACK_CHAR
suffix:colon
id|self-&gt;peer_enq_char
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|self-&gt;peer_ack_char
op_assign
id|data
(braket
l_int|3
)braket
suffix:semicolon
id|indicate
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DATA_RATE
suffix:colon
id|self-&gt;peer_data_rate
op_assign
(paren
id|data
(braket
l_int|5
)braket
op_lshift
l_int|24
op_amp
id|data
(braket
l_int|4
)braket
op_lshift
l_int|16
op_amp
id|data
(braket
l_int|3
)braket
op_lshift
l_int|8
op_amp
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|indicate
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PORT_NAME
suffix:colon
id|ASSERT
c_func
(paren
id|plen
op_le
l_int|32
comma
r_goto
id|corrupted
suffix:semicolon
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|self-&gt;port_name
comma
id|data
op_plus
l_int|2
comma
id|plen
)paren
suffix:semicolon
op_star
(paren
id|__u8
op_star
)paren
(paren
id|self-&gt;port_name
op_plus
id|plen
)paren
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIXED_PORT_NAME
suffix:colon
id|ASSERT
c_func
(paren
id|plen
op_le
l_int|32
comma
r_goto
id|corrupted
suffix:semicolon
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|self-&gt;port_name
comma
id|data
op_plus
l_int|2
comma
id|plen
)paren
suffix:semicolon
op_star
(paren
id|__u8
op_star
)paren
(paren
id|self-&gt;port_name
op_plus
id|plen
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t; * We should not connect if user of IrCOMM can&squot;t&n;&t;&t;&t; * recognize the port name&n;&t;&t;&t; */
id|self-&gt;port_name_critical
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():not implemented (PI=%d)&bslash;n&quot;
comma
id|pi
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|indicate
op_logical_and
id|self-&gt;notify.flow_indication
op_logical_and
id|type
op_eq
id|CONTROL_CHANNEL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;:indicating..:&bslash;n&quot;
)paren
suffix:semicolon
id|self-&gt;pi
op_assign
id|pi
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;notify.flow_indication
)paren
(brace
id|self-&gt;notify
dot
id|flow_indication
c_func
(paren
id|self-&gt;notify.instance
comma
id|self
comma
id|CONTROL_CHANNEL
)paren
suffix:semicolon
)brace
)brace
id|skb_pull
c_func
(paren
id|skb
comma
l_int|2
op_plus
id|plen
)paren
suffix:semicolon
id|clen
op_sub_assign
(paren
l_int|2
op_plus
id|plen
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
id|corrupted
suffix:colon
id|skb_pull
c_func
(paren
id|skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
multiline_comment|/* remove suspicious data */
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * ----------------------------------------------------------------------&n; * Function ircomm_open_instance() ,ircomm_close_instance() and friends&n; *&n; * ircomm_open_instance discoveres the peer device and then issues a&n; * connect request&n; * ----------------------------------------------------------------------&n; */
DECL|function|ircomm_open_instance
r_struct
id|ircomm_cb
op_star
id|ircomm_open_instance
c_func
(paren
r_struct
id|notify_t
id|client_notify
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|ircomm_cb
op_star
id|self
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|notify_t
id|notify
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|ASSERT
c_func
(paren
id|ircomm
op_ne
l_int|NULL
comma
r_return
l_int|NULL
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* find free handle */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IRCOMM_MAX_CONNECTION
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ASSERT
c_func
(paren
id|ircomm
(braket
id|i
)braket
op_ne
l_int|NULL
comma
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|in_use
)paren
(brace
id|self
op_assign
id|ircomm
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|self
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():no free handle!&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|self-&gt;in_use
op_assign
l_int|1
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|self-&gt;notify
op_assign
id|client_notify
suffix:semicolon
id|self-&gt;ttp_stop
op_assign
l_int|0
suffix:semicolon
id|self-&gt;control_ch_pending
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* register callbacks */
id|irda_notify_init
c_func
(paren
op_amp
id|notify
)paren
suffix:semicolon
id|notify.data_indication
op_assign
id|ircomm_accept_data_indication
suffix:semicolon
id|notify.connect_confirm
op_assign
id|ircomm_accept_connect_confirm
suffix:semicolon
id|notify.connect_indication
op_assign
id|ircomm_accept_connect_indication
suffix:semicolon
id|notify.flow_indication
op_assign
id|ircomm_accept_flow_indication
suffix:semicolon
id|notify.disconnect_indication
op_assign
id|ircomm_accept_disconnect_indication
suffix:semicolon
id|notify.instance
op_assign
id|self
suffix:semicolon
id|strncpy
c_func
(paren
id|notify.name
comma
l_string|&quot;IrCOMM&quot;
comma
id|NOTIFY_MAX_NAME
)paren
suffix:semicolon
id|self-&gt;tsap
op_assign
id|irttp_open_tsap
c_func
(paren
id|LSAP_ANY
comma
id|DEFAULT_INITIAL_CREDIT
comma
op_amp
id|notify
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|self-&gt;tsap
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;failed to allocate tsap&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|ircomm_next_state
c_func
(paren
id|self
comma
id|COMM_IDLE
)paren
suffix:semicolon
r_return
(paren
id|self
)paren
suffix:semicolon
)brace
DECL|function|ircomm_close_instance
r_int
id|ircomm_close_instance
c_func
(paren
r_struct
id|ircomm_cb
op_star
id|self
)paren
(brace
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
op_minus
id|EIO
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRCOMM_MAGIC
comma
r_return
op_minus
id|EIO
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;ctrl_skb
op_ne
l_int|NULL
comma
r_return
op_minus
id|EIO
suffix:semicolon
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* shutdown ircomm layer */
r_if
c_cond
(paren
id|self-&gt;state
op_ne
id|COMM_IDLE
op_logical_and
id|self-&gt;state
op_ne
id|COMM_WAITI
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;():force disconnecting..&bslash;n&quot;
)paren
suffix:semicolon
id|ircomm_disconnect_request
c_func
(paren
id|self
comma
l_int|NULL
comma
id|P_HIGH
)paren
suffix:semicolon
)brace
id|skb_trim
c_func
(paren
id|self-&gt;ctrl_skb
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* remove a tsap */
r_if
c_cond
(paren
id|self-&gt;tsap
)paren
(brace
id|irttp_close_tsap
c_func
(paren
id|self-&gt;tsap
)paren
suffix:semicolon
)brace
id|self-&gt;tsap
op_assign
l_int|NULL
suffix:semicolon
id|self-&gt;in_use
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * ----------------------------------------------------------------------&n; * Function init_module(void) ,cleanup_module()&n; *&n; *   Initializes the ircomm control structure&n; *   These Function are called when you insmod / rmmod .&n; * ----------------------------------------------------------------------&n; */
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|ircomm_init
c_func
(paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():done.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|ircomm_cleanup
c_func
(paren
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;():done.&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
multiline_comment|/************************************************************&n; *     proc stuff&n; ************************************************************/
macro_line|#ifdef CONFIG_PROC_FS
multiline_comment|/*&n; * Function proc_ircomm_read (buf, start, offset, len, unused)&n; *&n; * this function is called if there is a access on /proc/irda/comm .&n; *&n; */
DECL|function|ircomm_proc_read
r_int
id|ircomm_proc_read
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
id|unused
)paren
(brace
r_int
id|i
comma
id|index
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IRCOMM_MAX_CONNECTION
suffix:semicolon
id|i
op_increment
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;instance %d:&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|in_use
op_eq
l_int|0
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;tunused&bslash;n&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ircomm
(braket
id|i
)braket
op_eq
l_int|NULL
op_logical_or
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|magic
op_ne
id|IRCOMM_MAGIC
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;tbroken???&bslash;n&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|servicetype
)paren
(brace
r_case
id|UNKNOWN
suffix:colon
id|index
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|THREE_WIRE_RAW
suffix:colon
id|index
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|THREE_WIRE
suffix:colon
id|index
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NINE_WIRE
suffix:colon
id|index
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CENTRONICS
suffix:colon
id|index
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|index
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;    service: %s  &quot;
comma
id|ircommservicetype
(braket
id|index
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|index
)paren
(brace
r_continue
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;porttype: %s  &quot;
comma
id|ircommporttype
(braket
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|port_type
)braket
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;state: %s  &quot;
comma
id|ircommstate
(braket
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|state
)braket
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;user: %s&bslash;n&quot;
comma
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|notify.name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;    tx packets: %d  &quot;
comma
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|tx_packets
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;rx packets: %d  &quot;
comma
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|rx_packets
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;tx controls: %d&bslash;n&quot;
comma
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|tx_controls
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;    pending tuples: %d  &quot;
comma
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|pending_control_tuples
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;    ignored tuples: %d&bslash;n&quot;
comma
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|ignored_control_tuples
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;    nullmodem emulation: %s  &quot;
comma
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|null_modem_mode
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;IrTTP: %s&bslash;n&quot;
comma
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|ttp_stop
ques
c_cond
l_string|&quot;BUSY&quot;
suffix:colon
l_string|&quot;READY&quot;
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;    Peer capability: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|peer_cap
op_amp
id|THREE_WIRE_RAW
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;3wire-raw &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|peer_cap
op_amp
id|THREE_WIRE
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;3wire &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|peer_cap
op_amp
id|NINE_WIRE
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;9wire &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|peer_cap
op_amp
id|CENTRONICS
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;centronics&quot;
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n    Port name: %s&bslash;n&quot;
comma
(paren
id|ircomm
(braket
id|i
)braket
op_member_access_from_pointer
id|port_name
)paren
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
eof
