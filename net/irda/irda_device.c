multiline_comment|/*********************************************************************&n; *                &n; * Filename:      irda_device.c&n; * Version:       0.4&n; * Description:   Abstract device driver layer and helper functions&n; * Status:        Experimental.&n; * Author:        Dag Brattli &lt;dagb@cs.uit.no&gt;&n; * Created at:    Wed Sep  2 20:22:08 1998&n; * Modified at:   Tue Feb 16 17:36:04 1999&n; * Modified by:   Dag Brattli &lt;dagb@cs.uit.no&gt;&n; * &n; *     Copyright (c) 1998 Dag Brattli, All Rights Reserved.&n; *      &n; *     This program is free software; you can redistribute it and/or &n; *     modify it under the terms of the GNU General Public License as &n; *     published by the Free Software Foundation; either version 2 of &n; *     the License, or (at your option) any later version.&n; *  &n; *     Neither Dag Brattli nor University of Troms&#xfffd; admit liability nor&n; *     provide warranty for any of this software. This material is &n; *     provided &quot;AS-IS&quot; and at no charge.&n; *     &n; ********************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/if.h&gt;
macro_line|#include &lt;linux/if_ether.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;asm/ioctls.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;net/pkt_sched.h&gt;
macro_line|#include &lt;net/irda/irda_device.h&gt;
macro_line|#include &lt;net/irda/irlap_frame.h&gt;
macro_line|#include &lt;net/irda/timer.h&gt;
macro_line|#include &lt;net/irda/wrapper.h&gt;
r_extern
r_int
id|irtty_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|pc87108_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|w83977af_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|esi_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|tekram_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|actisys_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|girbil_init
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|irda_device
id|hashbin_t
op_star
id|irda_device
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Netdevice functions */
r_static
r_int
id|irda_device_net_rebuild_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|irda_device_net_hard_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|len
)paren
suffix:semicolon
r_static
r_int
id|irda_device_net_set_config
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
suffix:semicolon
r_static
r_int
id|irda_device_net_change_mtu
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_int
id|irda_device_proc_read
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
id|unused
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_int
id|irda_device_init
c_func
(paren
r_void
)paren
)paren
(brace
multiline_comment|/* Allocate master array */
id|irda_device
op_assign
id|hashbin_new
c_func
(paren
id|HB_LOCAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irda_device
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;IrDA: Can&squot;t allocate irda_device hashbin!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * Call the init function of the device drivers that has not been&n;&t; * compiled as a module &n;&t; */
macro_line|#ifdef CONFIG_IRTTY_SIR
id|irtty_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_WINBOND_FIR
id|w83977af_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_NSC_FIR
id|pc87108_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ESI_DONGLE
id|esi_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_TEKRAM_DONGLE
id|tekram_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ACTISYS_DONGLE
id|actisys_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_GIRBIL_DONGLE
id|girbil_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|irda_device_cleanup
r_void
id|irda_device_cleanup
c_func
(paren
r_void
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|irda_device
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|hashbin_delete
c_func
(paren
id|irda_device
comma
(paren
id|FREE_FUNC
)paren
id|irda_device_close
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_device_open (self)&n; *&n; *    Open a new IrDA port device&n; *&n; */
DECL|function|irda_device_open
r_int
id|irda_device_open
c_func
(paren
r_struct
id|irda_device
op_star
id|self
comma
r_char
op_star
id|name
comma
r_void
op_star
id|priv
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Check that a minimum of allocation flags are specified */
id|ASSERT
c_func
(paren
(paren
id|self-&gt;rx_buff.flags
op_amp
(paren
id|GFP_KERNEL
op_or
id|GFP_ATOMIC
)paren
)paren
op_ne
l_int|0
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|self-&gt;tx_buff.flags
op_amp
(paren
id|GFP_KERNEL
op_or
id|GFP_ATOMIC
)paren
)paren
op_ne
l_int|0
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;tx_buff.truesize
OG
l_int|0
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;rx_buff.truesize
OG
l_int|0
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|self-&gt;rx_buff.data
op_assign
(paren
id|__u8
op_star
)paren
id|kmalloc
c_func
(paren
id|self-&gt;rx_buff.truesize
comma
id|self-&gt;rx_buff.flags
)paren
suffix:semicolon
id|self-&gt;tx_buff.data
op_assign
(paren
id|__u8
op_star
)paren
id|kmalloc
c_func
(paren
id|self-&gt;tx_buff.truesize
comma
id|self-&gt;tx_buff.flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;rx_buff.data
op_eq
l_int|NULL
op_logical_or
id|self-&gt;tx_buff.data
op_eq
l_int|NULL
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;IrDA Self: no space for buffers!&bslash;n&quot;
)paren
suffix:semicolon
id|irda_device_close
c_func
(paren
id|self
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|self-&gt;rx_buff.data
comma
l_int|0
comma
id|self-&gt;rx_buff.truesize
)paren
suffix:semicolon
id|memset
c_func
(paren
id|self-&gt;tx_buff.data
comma
l_int|0
comma
id|self-&gt;tx_buff.truesize
)paren
suffix:semicolon
id|self-&gt;magic
op_assign
id|IRDA_DEVICE_MAGIC
suffix:semicolon
id|self-&gt;rx_buff.in_frame
op_assign
id|FALSE
suffix:semicolon
id|self-&gt;rx_buff.state
op_assign
id|OUTSIDE_FRAME
suffix:semicolon
multiline_comment|/* Initialize timers */
id|init_timer
c_func
(paren
op_amp
id|self-&gt;media_busy_timer
)paren
suffix:semicolon
multiline_comment|/* Open new IrLAP layer instance */
id|self-&gt;irlap
op_assign
id|irlap_open
c_func
(paren
id|self
)paren
suffix:semicolon
multiline_comment|/* A pointer to the low level implementation */
id|self-&gt;priv
op_assign
id|priv
suffix:semicolon
multiline_comment|/* Initialize IrDA net device */
r_do
(brace
id|sprintf
c_func
(paren
id|self-&gt;name
comma
l_string|&quot;%s%d&quot;
comma
l_string|&quot;irda&quot;
comma
id|i
op_increment
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|dev_get
c_func
(paren
id|self-&gt;name
)paren
op_ne
l_int|NULL
)paren
suffix:semicolon
id|self-&gt;netdev.name
op_assign
id|self-&gt;name
suffix:semicolon
id|self-&gt;netdev.priv
op_assign
(paren
r_void
op_star
)paren
id|self
suffix:semicolon
id|self-&gt;netdev.next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|register_netdev
c_func
(paren
op_amp
id|self-&gt;netdev
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), register_netdev() failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * Make the description for the device. self-&gt;netdev.name will get&n;&t; * a name like &quot;irda0&quot; and the self-&gt;descriptin will get a name&n;&t; * like &quot;irda0 &lt;-&gt; irtty0&quot; &n;&t; */
id|strncpy
c_func
(paren
id|self-&gt;description
comma
id|self-&gt;name
comma
l_int|5
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|self-&gt;description
comma
l_string|&quot; &lt;-&gt; &quot;
)paren
suffix:semicolon
id|strncat
c_func
(paren
id|self-&gt;description
comma
id|name
comma
l_int|23
)paren
suffix:semicolon
id|hashbin_insert
c_func
(paren
id|irda_device
comma
(paren
id|QUEUE
op_star
)paren
id|self
comma
(paren
r_int
)paren
id|self
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* Open network device */
id|dev_open
c_func
(paren
op_amp
id|self-&gt;netdev
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IrDA device %s registered.&bslash;n&quot;
comma
id|self-&gt;name
)paren
suffix:semicolon
id|irda_device_set_media_busy
c_func
(paren
id|self
comma
id|FALSE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_device_close (self)&n; *&n; *    Close this instance of the irda_device, just deallocate buffers&n; *&n; */
DECL|function|__irda_device_close
r_void
id|__irda_device_close
c_func
(paren
r_struct
id|irda_device
op_star
id|self
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRDA_DEVICE_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|dev_close
c_func
(paren
op_amp
id|self-&gt;netdev
)paren
suffix:semicolon
multiline_comment|/* Remove netdevice */
id|unregister_netdev
c_func
(paren
op_amp
id|self-&gt;netdev
)paren
suffix:semicolon
multiline_comment|/* Stop timers */
id|del_timer
c_func
(paren
op_amp
id|self-&gt;todo_timer
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|self-&gt;media_busy_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;tx_buff.data
)paren
(brace
id|kfree
c_func
(paren
id|self-&gt;tx_buff.data
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;rx_buff.data
)paren
(brace
id|kfree
c_func
(paren
id|self-&gt;rx_buff.data
)paren
suffix:semicolon
)brace
id|self-&gt;magic
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_device_close (self)&n; *&n; *    &n; *&n; */
DECL|function|irda_device_close
r_void
id|irda_device_close
c_func
(paren
r_struct
id|irda_device
op_star
id|self
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRDA_DEVICE_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* Stop IrLAP */
id|irlap_close
c_func
(paren
id|self-&gt;irlap
)paren
suffix:semicolon
id|self-&gt;irlap
op_assign
l_int|NULL
suffix:semicolon
id|hashbin_remove
c_func
(paren
id|irda_device
comma
(paren
r_int
)paren
id|self
comma
l_int|NULL
)paren
suffix:semicolon
id|__irda_device_close
c_func
(paren
id|self
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_device_set_media_busy (self, status)&n; *&n; *    Called when we have detected that another station is transmiting&n; *    in contention mode.&n; */
DECL|function|irda_device_set_media_busy
r_void
id|irda_device_set_media_busy
c_func
(paren
r_struct
id|irda_device
op_star
id|self
comma
r_int
id|status
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;(%s)&bslash;n&quot;
comma
id|status
ques
c_cond
l_string|&quot;TRUE&quot;
suffix:colon
l_string|&quot;FALSE&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRDA_DEVICE_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|self-&gt;media_busy
op_assign
id|TRUE
suffix:semicolon
id|irda_device_start_mbusy_timer
c_func
(paren
id|self
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;Media busy!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|self-&gt;media_busy
op_assign
id|FALSE
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|self-&gt;media_busy_timer
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Function __irda_device_change_speed (self, speed)&n; *&n; *    When this function is called, we will have a process context so its&n; *    possible for us to sleep, wait or whatever :-)&n; */
DECL|function|__irda_device_change_speed
r_static
r_void
id|__irda_device_change_speed
c_func
(paren
r_struct
id|irda_device
op_star
id|self
comma
r_int
id|speed
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;(), &lt;%ld&gt;&bslash;n&quot;
comma
id|jiffies
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRDA_DEVICE_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Is is possible to change speed yet? Wait until the last byte &n;&t; *  has been transmitted.&n;&t; */
r_if
c_cond
(paren
id|self-&gt;wait_until_sent
)paren
(brace
id|self
op_member_access_from_pointer
id|wait_until_sent
c_func
(paren
id|self
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;change_speed
)paren
(brace
id|self
op_member_access_from_pointer
id|change_speed
c_func
(paren
id|self
comma
id|speed
)paren
suffix:semicolon
multiline_comment|/* Update the QoS value only */
id|self-&gt;qos.baud_rate.value
op_assign
id|speed
suffix:semicolon
)brace
)brace
r_else
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;(), Warning, wait_until_sent() &quot;
l_string|&quot;has not implemented by the device driver!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Function irda_device_change_speed (self, speed)&n; *&n; *    Change the speed of the currently used irda_device&n; *&n; */
DECL|function|irda_device_change_speed
r_inline
r_void
id|irda_device_change_speed
c_func
(paren
r_struct
id|irda_device
op_star
id|self
comma
r_int
id|speed
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRDA_DEVICE_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|irda_execute_as_process
c_func
(paren
id|self
comma
(paren
id|TODO_CALLBACK
)paren
id|__irda_device_change_speed
comma
id|speed
)paren
suffix:semicolon
)brace
DECL|function|irda_device_is_media_busy
r_inline
r_int
id|irda_device_is_media_busy
c_func
(paren
r_struct
id|irda_device
op_star
id|self
)paren
(brace
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
id|FALSE
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRDA_DEVICE_MAGIC
comma
r_return
id|FALSE
suffix:semicolon
)paren
suffix:semicolon
r_return
id|self-&gt;media_busy
suffix:semicolon
)brace
DECL|function|irda_device_is_receiving
r_inline
r_int
id|irda_device_is_receiving
c_func
(paren
r_struct
id|irda_device
op_star
id|self
)paren
(brace
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
id|FALSE
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRDA_DEVICE_MAGIC
comma
r_return
id|FALSE
suffix:semicolon
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;is_receiving
)paren
r_return
id|self
op_member_access_from_pointer
id|is_receiving
c_func
(paren
id|self
)paren
suffix:semicolon
r_else
r_return
id|FALSE
suffix:semicolon
)brace
DECL|function|irda_device_get_qos
r_inline
r_struct
id|qos_info
op_star
id|irda_device_get_qos
c_func
(paren
r_struct
id|irda_device
op_star
id|self
)paren
(brace
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
l_int|NULL
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRDA_DEVICE_MAGIC
comma
r_return
l_int|NULL
suffix:semicolon
)paren
suffix:semicolon
r_return
op_amp
id|self-&gt;qos
suffix:semicolon
)brace
DECL|function|irda_device_todo_expired
r_void
id|irda_device_todo_expired
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|irda_device
op_star
id|self
op_assign
(paren
r_struct
id|irda_device
op_star
)paren
id|data
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Check that we still exist */
r_if
c_cond
(paren
op_logical_neg
id|self
op_logical_or
id|self-&gt;magic
op_ne
id|IRDA_DEVICE_MAGIC
)paren
(brace
r_return
suffix:semicolon
)brace
id|__irda_device_change_speed
c_func
(paren
id|self
comma
id|self-&gt;new_speed
)paren
suffix:semicolon
)brace
DECL|function|irda_device_get_stats
r_static
r_struct
id|enet_statistics
op_star
id|irda_device_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|irda_device
op_star
id|priv
op_assign
(paren
r_struct
id|irda_device
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|priv-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_device_setup (dev)&n; *&n; *    This function should be used by low level device drivers in a similar way&n; *    as ether_setup() is used by normal network device drivers&n; */
DECL|function|irda_device_setup
r_int
id|irda_device_setup
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|irda_device
op_star
id|self
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|dev
op_ne
l_int|NULL
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irda_device
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRDA_DEVICE_MAGIC
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|irda_device_get_stats
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
id|irda_device_net_rebuild_header
suffix:semicolon
id|dev-&gt;set_config
op_assign
id|irda_device_net_set_config
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|irda_device_net_change_mtu
suffix:semicolon
multiline_comment|/*  &t;dev-&gt;hard_header     = irda_device_net_hard_header; */
id|dev-&gt;hard_header_len
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;addr_len
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_IRDA
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* Short queues in IrDA */
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
op_amp
id|self-&gt;irlap-&gt;saddr
comma
l_int|4
)paren
suffix:semicolon
id|memset
c_func
(paren
id|dev-&gt;broadcast
comma
l_int|0xff
comma
l_int|4
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
l_int|2048
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|dev_init_buffers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;flags
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_device_net_rebuild_header (buff, dev, dst, skb)&n; *&n; *    &n; *&n; */
DECL|function|irda_device_net_rebuild_header
r_static
r_int
id|irda_device_net_rebuild_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|DEBUG
c_func
(paren
l_int|4
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|irda_device_net_hard_header
r_static
r_int
id|irda_device_net_hard_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
id|len
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* skb_push(skb,PPP_HARD_HDR_LEN); */
multiline_comment|/* return PPP_HARD_HDR_LEN; */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|irda_device_net_set_config
r_static
r_int
id|irda_device_net_set_config
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|irda_device_net_change_mtu
r_static
r_int
id|irda_device_net_change_mtu
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
id|__FUNCTION__
l_string|&quot;()&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_device_transmit_finished (void)&n; *&n; *    Check if there is still some frames in the transmit queue for this&n; *    device&n; *&n; */
DECL|function|irda_device_txqueue_empty
r_int
id|irda_device_txqueue_empty
c_func
(paren
r_struct
id|irda_device
op_star
id|self
)paren
(brace
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRDA_DEVICE_MAGIC
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* FIXME: check if this is the right way of doing it? */
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|self-&gt;netdev.qdisc-&gt;q
)paren
)paren
r_return
id|FALSE
suffix:semicolon
r_return
id|TRUE
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_get_mtt (skb)&n; *&n; *    Utility function for getting the &n; *&n; */
DECL|function|irda_get_mtt
id|__inline__
r_int
id|irda_get_mtt
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
(paren
(paren
r_struct
id|irlap_skb_cb
op_star
)paren
(paren
id|skb-&gt;cb
)paren
)paren
op_member_access_from_pointer
id|mtt
suffix:semicolon
)brace
multiline_comment|/*&n; * Function setup_dma (idev, buffer, count, mode)&n; *&n; *    Setup the DMA channel&n; *&n; */
DECL|function|setup_dma
r_void
id|setup_dma
c_func
(paren
r_int
id|channel
comma
r_char
op_star
id|buffer
comma
r_int
id|count
comma
r_int
id|mode
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|disable_dma
c_func
(paren
id|channel
)paren
suffix:semicolon
id|clear_dma_ff
c_func
(paren
id|channel
)paren
suffix:semicolon
id|set_dma_mode
c_func
(paren
id|channel
comma
id|mode
)paren
suffix:semicolon
id|set_dma_addr
c_func
(paren
id|channel
comma
id|virt_to_bus
c_func
(paren
id|buffer
)paren
)paren
suffix:semicolon
id|set_dma_count
c_func
(paren
id|channel
comma
id|count
)paren
suffix:semicolon
id|enable_dma
c_func
(paren
id|channel
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|irda_device_print_flags
r_int
id|irda_device_print_flags
c_func
(paren
r_struct
id|irda_device
op_star
id|idev
comma
r_char
op_star
id|buf
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;t&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;netdev.flags
op_amp
id|IFF_UP
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;UP &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev-&gt;netdev.tbusy
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;RUNNING &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;flags
op_amp
id|IFF_SIR
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;SIR &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;flags
op_amp
id|IFF_MIR
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;MIR &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;flags
op_amp
id|IFF_FIR
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;FIR &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;flags
op_amp
id|IFF_PIO
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;PIO &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;flags
op_amp
id|IFF_DMA
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;DMA &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;flags
op_amp
id|IFF_DONGLE
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;DONGLE &quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_device_proc_read (buf, start, offset, len, unused)&n; *&n; *    Give some info to the /proc file system&n; *&n; */
DECL|function|irda_device_proc_read
r_int
id|irda_device_proc_read
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
id|unused
)paren
(brace
r_struct
id|irda_device
op_star
id|self
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irda_device
op_star
)paren
id|hashbin_get_first
c_func
(paren
id|irda_device
)paren
suffix:semicolon
r_while
c_loop
(paren
id|self
op_ne
l_int|NULL
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%s,&quot;
comma
id|self-&gt;name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;tbinding: %s&bslash;n&quot;
comma
id|self-&gt;description
)paren
suffix:semicolon
id|len
op_add_assign
id|irda_device_print_flags
c_func
(paren
id|self
comma
id|buf
op_plus
id|len
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;tbps&bslash;tmaxtt&bslash;tdsize&bslash;twinsize&bslash;taddbofs&bslash;tmintt&bslash;tldisc&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;t%d&bslash;t&quot;
comma
id|self-&gt;qos.baud_rate.value
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%d&bslash;t&quot;
comma
id|self-&gt;qos.max_turn_time.value
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%d&bslash;t&quot;
comma
id|self-&gt;qos.data_size.value
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%d&bslash;t&quot;
comma
id|self-&gt;qos.window_size.value
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%d&bslash;t&quot;
comma
id|self-&gt;qos.additional_bofs.value
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%d&bslash;t&quot;
comma
id|self-&gt;qos.min_turn_time.value
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%d&quot;
comma
id|self-&gt;qos.link_disc_time.value
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irda_device
op_star
)paren
id|hashbin_get_next
c_func
(paren
id|irda_device
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
eof
