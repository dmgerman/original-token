multiline_comment|/*********************************************************************&n; *                &n; * Filename:      timer.c&n; * Version:       &n; * Description:   &n; * Status:        Experimental.&n; * Author:        Dag Brattli &lt;dagb@cs.uit.no&gt;&n; * Created at:    Sat Aug 16 00:59:29 1997&n; * Modified at:   Wed Dec  8 12:50:34 1999&n; * Modified by:   Dag Brattli &lt;dagb@cs.uit.no&gt;&n; * &n; *     Copyright (c) 1997, 1999 Dag Brattli &lt;dagb@cs.uit.no&gt;, &n; *     All Rights Reserved.&n; *     &n; *     This program is free software; you can redistribute it and/or &n; *     modify it under the terms of the GNU General Public License as &n; *     published by the Free Software Foundation; either version 2 of &n; *     the License, or (at your option) any later version.&n; *&n; *     Neither Dag Brattli nor University of Troms&#xfffd; admit liability nor&n; *     provide warranty for any of this software. This material is &n; *     provided &quot;AS-IS&quot; and at no charge.&n; *&n; ********************************************************************/
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;net/irda/timer.h&gt;
macro_line|#include &lt;net/irda/irda.h&gt;
macro_line|#include &lt;net/irda/irtty.h&gt;
macro_line|#include &lt;net/irda/irlap.h&gt;
macro_line|#include &lt;net/irda/irlmp_event.h&gt;
r_static
r_void
id|irlap_slot_timer_expired
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|irlap_query_timer_expired
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|irlap_final_timer_expired
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|irlap_wd_timer_expired
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|irlap_backoff_timer_expired
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|irlap_media_busy_expired
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
multiline_comment|/*&n; * Function irda_start_timer (timer, timeout)&n; *&n; *    Start an IrDA timer&n; *&n; */
DECL|function|irda_start_timer
r_void
id|irda_start_timer
c_func
(paren
r_struct
id|timer_list
op_star
id|ptimer
comma
r_int
id|timeout
comma
r_void
op_star
id|data
comma
id|TIMER_CALLBACK
id|callback
)paren
(brace
id|del_timer
c_func
(paren
id|ptimer
)paren
suffix:semicolon
id|ptimer-&gt;data
op_assign
(paren
r_int
r_int
)paren
id|data
suffix:semicolon
multiline_comment|/* &n;&t; * For most architectures void * is the same as unsigned long, but&n;&t; * at least we try to use void * as long as possible. Since the &n;&t; * timer functions use unsigned long, we cast the function here&n;&t; */
id|ptimer-&gt;function
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
id|callback
suffix:semicolon
id|ptimer-&gt;expires
op_assign
id|jiffies
op_plus
id|timeout
suffix:semicolon
id|add_timer
c_func
(paren
id|ptimer
)paren
suffix:semicolon
)brace
DECL|function|irlap_start_slot_timer
r_void
id|irlap_start_slot_timer
c_func
(paren
r_struct
id|irlap_cb
op_star
id|self
comma
r_int
id|timeout
)paren
(brace
id|irda_start_timer
c_func
(paren
op_amp
id|self-&gt;slot_timer
comma
id|timeout
comma
(paren
r_void
op_star
)paren
id|self
comma
id|irlap_slot_timer_expired
)paren
suffix:semicolon
)brace
DECL|function|irlap_start_query_timer
r_void
id|irlap_start_query_timer
c_func
(paren
r_struct
id|irlap_cb
op_star
id|self
comma
r_int
id|timeout
)paren
(brace
id|irda_start_timer
c_func
(paren
op_amp
id|self-&gt;query_timer
comma
id|timeout
comma
(paren
r_void
op_star
)paren
id|self
comma
id|irlap_query_timer_expired
)paren
suffix:semicolon
)brace
DECL|function|irlap_start_final_timer
r_void
id|irlap_start_final_timer
c_func
(paren
r_struct
id|irlap_cb
op_star
id|self
comma
r_int
id|timeout
)paren
(brace
id|irda_start_timer
c_func
(paren
op_amp
id|self-&gt;final_timer
comma
id|timeout
comma
(paren
r_void
op_star
)paren
id|self
comma
id|irlap_final_timer_expired
)paren
suffix:semicolon
)brace
DECL|function|irlap_start_wd_timer
r_void
id|irlap_start_wd_timer
c_func
(paren
r_struct
id|irlap_cb
op_star
id|self
comma
r_int
id|timeout
)paren
(brace
id|irda_start_timer
c_func
(paren
op_amp
id|self-&gt;wd_timer
comma
id|timeout
comma
(paren
r_void
op_star
)paren
id|self
comma
id|irlap_wd_timer_expired
)paren
suffix:semicolon
)brace
DECL|function|irlap_start_backoff_timer
r_void
id|irlap_start_backoff_timer
c_func
(paren
r_struct
id|irlap_cb
op_star
id|self
comma
r_int
id|timeout
)paren
(brace
id|irda_start_timer
c_func
(paren
op_amp
id|self-&gt;backoff_timer
comma
id|timeout
comma
(paren
r_void
op_star
)paren
id|self
comma
id|irlap_backoff_timer_expired
)paren
suffix:semicolon
)brace
DECL|function|irlap_start_mbusy_timer
r_void
id|irlap_start_mbusy_timer
c_func
(paren
r_struct
id|irlap_cb
op_star
id|self
)paren
(brace
id|irda_start_timer
c_func
(paren
op_amp
id|self-&gt;media_busy_timer
comma
id|MEDIABUSY_TIMEOUT
comma
(paren
r_void
op_star
)paren
id|self
comma
id|irlap_media_busy_expired
)paren
suffix:semicolon
)brace
DECL|function|irlap_stop_mbusy_timer
r_void
id|irlap_stop_mbusy_timer
c_func
(paren
r_struct
id|irlap_cb
op_star
id|self
)paren
(brace
multiline_comment|/* If timer is activated, kill it! */
r_if
c_cond
(paren
id|timer_pending
c_func
(paren
op_amp
id|self-&gt;media_busy_timer
)paren
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|self-&gt;media_busy_timer
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IRDA_ULTRA
multiline_comment|/* Send any pending Ultra frames if any */
r_if
c_cond
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|self-&gt;txq_ultra
)paren
)paren
multiline_comment|/* Note : we don&squot;t send the frame, just post an event.&n;&t;&t; * Frames will be sent only if we are in NDM mode (see&n;&t;&t; * irlap_event.c).&n;&t;&t; * Also, moved this code from irlap_media_busy_expired()&n;&t;&t; * to here to catch properly all cases...&n;&t;&t; * Jean II */
id|irlap_do_event
c_func
(paren
id|self
comma
id|SEND_UI_FRAME
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_IRDA_ULTRA */
)brace
DECL|function|irlmp_start_watchdog_timer
r_void
id|irlmp_start_watchdog_timer
c_func
(paren
r_struct
id|lsap_cb
op_star
id|self
comma
r_int
id|timeout
)paren
(brace
id|irda_start_timer
c_func
(paren
op_amp
id|self-&gt;watchdog_timer
comma
id|timeout
comma
(paren
r_void
op_star
)paren
id|self
comma
id|irlmp_watchdog_timer_expired
)paren
suffix:semicolon
)brace
DECL|function|irlmp_start_discovery_timer
r_void
id|irlmp_start_discovery_timer
c_func
(paren
r_struct
id|irlmp_cb
op_star
id|self
comma
r_int
id|timeout
)paren
(brace
id|irda_start_timer
c_func
(paren
op_amp
id|self-&gt;discovery_timer
comma
id|timeout
comma
(paren
r_void
op_star
)paren
id|self
comma
id|irlmp_discovery_timer_expired
)paren
suffix:semicolon
)brace
DECL|function|irlmp_start_idle_timer
r_void
id|irlmp_start_idle_timer
c_func
(paren
r_struct
id|lap_cb
op_star
id|self
comma
r_int
id|timeout
)paren
(brace
id|irda_start_timer
c_func
(paren
op_amp
id|self-&gt;idle_timer
comma
id|timeout
comma
(paren
r_void
op_star
)paren
id|self
comma
id|irlmp_idle_timer_expired
)paren
suffix:semicolon
)brace
DECL|function|irlmp_stop_idle_timer
r_void
id|irlmp_stop_idle_timer
c_func
(paren
r_struct
id|lap_cb
op_star
id|self
)paren
(brace
multiline_comment|/* If timer is activated, kill it! */
r_if
c_cond
(paren
id|timer_pending
c_func
(paren
op_amp
id|self-&gt;idle_timer
)paren
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|self-&gt;idle_timer
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Function irlap_slot_timer_expired (data)&n; *&n; *    IrLAP slot timer has expired&n; *&n; */
DECL|function|irlap_slot_timer_expired
r_static
r_void
id|irlap_slot_timer_expired
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|irlap_cb
op_star
id|self
op_assign
(paren
r_struct
id|irlap_cb
op_star
)paren
id|data
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|LAP_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|irlap_do_event
c_func
(paren
id|self
comma
id|SLOT_TIMER_EXPIRED
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlap_query_timer_expired (data)&n; *&n; *    IrLAP query timer has expired&n; *&n; */
DECL|function|irlap_query_timer_expired
r_static
r_void
id|irlap_query_timer_expired
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|irlap_cb
op_star
id|self
op_assign
(paren
r_struct
id|irlap_cb
op_star
)paren
id|data
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|LAP_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|irlap_do_event
c_func
(paren
id|self
comma
id|QUERY_TIMER_EXPIRED
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_final_timer_expired (data)&n; *&n; *    &n; *&n; */
DECL|function|irlap_final_timer_expired
r_static
r_void
id|irlap_final_timer_expired
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|irlap_cb
op_star
id|self
op_assign
(paren
r_struct
id|irlap_cb
op_star
)paren
id|data
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|LAP_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|irlap_do_event
c_func
(paren
id|self
comma
id|FINAL_TIMER_EXPIRED
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_wd_timer_expired (data)&n; *&n; *    &n; *&n; */
DECL|function|irlap_wd_timer_expired
r_static
r_void
id|irlap_wd_timer_expired
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|irlap_cb
op_star
id|self
op_assign
(paren
r_struct
id|irlap_cb
op_star
)paren
id|data
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|LAP_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|irlap_do_event
c_func
(paren
id|self
comma
id|WD_TIMER_EXPIRED
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irda_backoff_timer_expired (data)&n; *&n; *    &n; *&n; */
DECL|function|irlap_backoff_timer_expired
r_static
r_void
id|irlap_backoff_timer_expired
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|irlap_cb
op_star
id|self
op_assign
(paren
r_struct
id|irlap_cb
op_star
)paren
id|data
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|LAP_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|irlap_do_event
c_func
(paren
id|self
comma
id|BACKOFF_TIMER_EXPIRED
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irtty_media_busy_expired (data)&n; *&n; *    &n; */
DECL|function|irlap_media_busy_expired
r_void
id|irlap_media_busy_expired
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|irlap_cb
op_star
id|self
op_assign
(paren
r_struct
id|irlap_cb
op_star
)paren
id|data
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|irda_device_set_media_busy
c_func
(paren
id|self-&gt;netdev
comma
id|FALSE
)paren
suffix:semicolon
multiline_comment|/* Note : will deal with Ultra frames */
)brace
eof
