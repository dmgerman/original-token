multiline_comment|/*&n; *&t;AARP:&t;&t;An implementation of the AppleTalk AARP protocol for&n; *&t;&t;&t;Ethernet &squot;ELAP&squot;.&n; *&n; *&t;&t;Alan Cox  &lt;Alan.Cox@linux.org&gt;&n; *&n; *&t;This doesn&squot;t fit cleanly with the IP arp. Potentially we can use&n; *&t;the generic neighbour discovery code to clean this up.&n; *&n; *&t;FIXME:&n; *&t;&t;We ought to handle the retransmits with a single list and a &n; *&t;separate fast timer for when it is needed.&n; *&t;&t;Use neighbour discovery code.&n; *&t;&t;Token Ring Support.&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; *&n; *&n; *&t;References:&n; *&t;&t;Inside AppleTalk (2nd Ed).&n; *&t;Fixes:&n; *&t;&t;Jaume Grau&t;-&t;flush caches on AARP_PROBE&n; *&t;&t;Rob Newberry&t;-&t;Added proxy AARP and AARP proc fs, &n; *&t;&t;&t;&t;&t;moved probing from DDP module.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#if defined(CONFIG_ATALK) || defined(CONFIG_ATALK_MODULE) 
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/if_ether.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/datalink.h&gt;
macro_line|#include &lt;net/psnap.h&gt;
macro_line|#include &lt;linux/atalk.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
DECL|variable|sysctl_aarp_expiry_time
r_int
id|sysctl_aarp_expiry_time
op_assign
id|AARP_EXPIRY_TIME
suffix:semicolon
DECL|variable|sysctl_aarp_tick_time
r_int
id|sysctl_aarp_tick_time
op_assign
id|AARP_TICK_TIME
suffix:semicolon
DECL|variable|sysctl_aarp_retransmit_limit
r_int
id|sysctl_aarp_retransmit_limit
op_assign
id|AARP_RETRANSMIT_LIMIT
suffix:semicolon
DECL|variable|sysctl_aarp_resolve_time
r_int
id|sysctl_aarp_resolve_time
op_assign
id|AARP_RESOLVE_TIME
suffix:semicolon
multiline_comment|/*&n; *&t;Lists of aarp entries&n; */
DECL|struct|aarp_entry
r_struct
id|aarp_entry
(brace
multiline_comment|/* These first two are only used for unresolved entries */
DECL|member|last_sent
r_int
r_int
id|last_sent
suffix:semicolon
multiline_comment|/* Last time we xmitted the aarp request */
DECL|member|packet_queue
r_struct
id|sk_buff_head
id|packet_queue
suffix:semicolon
multiline_comment|/* Queue of frames wait for resolution */
DECL|member|status
r_int
id|status
suffix:semicolon
multiline_comment|/* Used for proxy AARP */
DECL|member|expires_at
r_int
r_int
id|expires_at
suffix:semicolon
multiline_comment|/* Entry expiry time */
DECL|member|target_addr
r_struct
id|at_addr
id|target_addr
suffix:semicolon
multiline_comment|/* DDP Address */
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
multiline_comment|/* Device to use */
DECL|member|hwaddr
r_char
id|hwaddr
(braket
l_int|6
)braket
suffix:semicolon
multiline_comment|/* Physical i/f address of target/router */
DECL|member|xmit_count
r_int
r_int
id|xmit_count
suffix:semicolon
multiline_comment|/* When this hits 10 we give up */
DECL|member|next
r_struct
id|aarp_entry
op_star
id|next
suffix:semicolon
multiline_comment|/* Next entry in chain */
)brace
suffix:semicolon
multiline_comment|/*&n; *&t;Hashed list of resolved, unresolved and proxy entries&n; */
DECL|variable|resolved
r_static
r_struct
id|aarp_entry
op_star
id|resolved
(braket
id|AARP_HASH_SIZE
)braket
suffix:semicolon
DECL|variable|unresolved
r_static
r_struct
id|aarp_entry
op_star
id|unresolved
(braket
id|AARP_HASH_SIZE
)braket
suffix:semicolon
DECL|variable|proxies
r_static
r_struct
id|aarp_entry
op_star
id|proxies
(braket
id|AARP_HASH_SIZE
)braket
suffix:semicolon
DECL|variable|unresolved_count
r_static
r_int
id|unresolved_count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* One lock protects it all. */
DECL|variable|aarp_lock
r_static
id|spinlock_t
id|aarp_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/*&n; *&t;Used to walk the list and purge/kick entries.&n; */
DECL|variable|aarp_timer
r_static
r_struct
id|timer_list
id|aarp_timer
suffix:semicolon
multiline_comment|/*&n; *&t;Delete an aarp queue&n; *&n; *&t;Must run under aarp_lock.&n; */
DECL|function|__aarp_expire
r_static
r_void
id|__aarp_expire
c_func
(paren
r_struct
id|aarp_entry
op_star
id|a
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|a-&gt;packet_queue
)paren
)paren
op_ne
l_int|NULL
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|a
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send an aarp queue entry request&n; *&n; *&t;Must run under aarp_lock.&n; */
DECL|function|__aarp_send_query
r_static
r_void
id|__aarp_send_query
c_func
(paren
r_struct
id|aarp_entry
op_star
id|a
)paren
(brace
r_static
r_char
id|aarp_eth_multicast
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|0x09
comma
l_int|0x00
comma
l_int|0x07
comma
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
)brace
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|a-&gt;dev
suffix:semicolon
r_int
id|len
op_assign
id|dev-&gt;hard_header_len
op_plus
r_sizeof
(paren
r_struct
id|elapaarp
)paren
op_plus
id|aarp_dl-&gt;header_length
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_struct
id|elapaarp
op_star
id|eah
suffix:semicolon
r_struct
id|at_addr
op_star
id|sat
op_assign
id|atalk_find_dev_addr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|sat
op_eq
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Set up the buffer.&n;&t; */
id|skb_reserve
c_func
(paren
id|skb
comma
id|dev-&gt;hard_header_len
op_plus
id|aarp_dl-&gt;header_length
)paren
suffix:semicolon
id|eah
op_assign
(paren
r_struct
id|elapaarp
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|elapaarp
)paren
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;h.raw
op_assign
(paren
r_void
op_star
)paren
id|eah
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Set up the ARP.&n;&t; */
id|eah-&gt;hw_type
op_assign
id|htons
c_func
(paren
id|AARP_HW_TYPE_ETHERNET
)paren
suffix:semicolon
id|eah-&gt;pa_type
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|eah-&gt;hw_len
op_assign
id|ETH_ALEN
suffix:semicolon
id|eah-&gt;pa_len
op_assign
id|AARP_PA_ALEN
suffix:semicolon
id|eah-&gt;function
op_assign
id|htons
c_func
(paren
id|AARP_REQUEST
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eah-&gt;hw_src
comma
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_src_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_src_net
op_assign
id|sat-&gt;s_net
suffix:semicolon
id|eah-&gt;pa_src_node
op_assign
id|sat-&gt;s_node
suffix:semicolon
id|memset
c_func
(paren
id|eah-&gt;hw_dst
comma
l_char|&squot;&bslash;0&squot;
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_dst_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_dst_net
op_assign
id|a-&gt;target_addr.s_net
suffix:semicolon
id|eah-&gt;pa_dst_node
op_assign
id|a-&gt;target_addr.s_node
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Add ELAP headers and set target to the AARP multicast.&n;&t; */
id|aarp_dl
op_member_access_from_pointer
id|datalink_header
c_func
(paren
id|aarp_dl
comma
id|skb
comma
id|aarp_eth_multicast
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Send it.&n;&t; */
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Update the sending count&n;&t; */
id|a-&gt;xmit_count
op_increment
suffix:semicolon
)brace
multiline_comment|/* This runs under aarp_lock and in softint context, so only&n; * atomic memory allocations can be used.&n; */
DECL|function|aarp_send_reply
r_static
r_void
id|aarp_send_reply
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|at_addr
op_star
id|us
comma
r_struct
id|at_addr
op_star
id|them
comma
r_int
r_char
op_star
id|sha
)paren
(brace
r_int
id|len
op_assign
id|dev-&gt;hard_header_len
op_plus
r_sizeof
(paren
r_struct
id|elapaarp
)paren
op_plus
id|aarp_dl-&gt;header_length
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_struct
id|elapaarp
op_star
id|eah
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Set up the buffer.&n;&t; */
id|skb_reserve
c_func
(paren
id|skb
comma
id|dev-&gt;hard_header_len
op_plus
id|aarp_dl-&gt;header_length
)paren
suffix:semicolon
id|eah
op_assign
(paren
r_struct
id|elapaarp
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|elapaarp
)paren
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;h.raw
op_assign
(paren
r_void
op_star
)paren
id|eah
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Set up the ARP.&n;&t; */
id|eah-&gt;hw_type
op_assign
id|htons
c_func
(paren
id|AARP_HW_TYPE_ETHERNET
)paren
suffix:semicolon
id|eah-&gt;pa_type
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|eah-&gt;hw_len
op_assign
id|ETH_ALEN
suffix:semicolon
id|eah-&gt;pa_len
op_assign
id|AARP_PA_ALEN
suffix:semicolon
id|eah-&gt;function
op_assign
id|htons
c_func
(paren
id|AARP_REPLY
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eah-&gt;hw_src
comma
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_src_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_src_net
op_assign
id|us-&gt;s_net
suffix:semicolon
id|eah-&gt;pa_src_node
op_assign
id|us-&gt;s_node
suffix:semicolon
r_if
c_cond
(paren
id|sha
op_eq
l_int|NULL
)paren
id|memset
c_func
(paren
id|eah-&gt;hw_dst
comma
l_char|&squot;&bslash;0&squot;
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|eah-&gt;hw_dst
comma
id|sha
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_dst_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_dst_net
op_assign
id|them-&gt;s_net
suffix:semicolon
id|eah-&gt;pa_dst_node
op_assign
id|them-&gt;s_node
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Add ELAP headers and set target to the AARP multicast.&n;&t; */
id|aarp_dl
op_member_access_from_pointer
id|datalink_header
c_func
(paren
id|aarp_dl
comma
id|skb
comma
id|sha
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Send it.&n;&t; */
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send probe frames. Called from aarp_probe_network and aarp_proxy_probe_network.&n; */
DECL|function|aarp_send_probe
r_void
id|aarp_send_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|at_addr
op_star
id|us
)paren
(brace
r_int
id|len
op_assign
id|dev-&gt;hard_header_len
op_plus
r_sizeof
(paren
r_struct
id|elapaarp
)paren
op_plus
id|aarp_dl-&gt;header_length
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_struct
id|elapaarp
op_star
id|eah
suffix:semicolon
r_static
r_char
id|aarp_eth_multicast
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|0x09
comma
l_int|0x00
comma
l_int|0x07
comma
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
)brace
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Set up the buffer.&n;&t; */
id|skb_reserve
c_func
(paren
id|skb
comma
id|dev-&gt;hard_header_len
op_plus
id|aarp_dl-&gt;header_length
)paren
suffix:semicolon
id|eah
op_assign
(paren
r_struct
id|elapaarp
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|elapaarp
)paren
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;h.raw
op_assign
(paren
r_void
op_star
)paren
id|eah
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Set up the ARP.&n;&t; */
id|eah-&gt;hw_type
op_assign
id|htons
c_func
(paren
id|AARP_HW_TYPE_ETHERNET
)paren
suffix:semicolon
id|eah-&gt;pa_type
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|eah-&gt;hw_len
op_assign
id|ETH_ALEN
suffix:semicolon
id|eah-&gt;pa_len
op_assign
id|AARP_PA_ALEN
suffix:semicolon
id|eah-&gt;function
op_assign
id|htons
c_func
(paren
id|AARP_PROBE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eah-&gt;hw_src
comma
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_src_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_src_net
op_assign
id|us-&gt;s_net
suffix:semicolon
id|eah-&gt;pa_src_node
op_assign
id|us-&gt;s_node
suffix:semicolon
id|memset
c_func
(paren
id|eah-&gt;hw_dst
comma
l_char|&squot;&bslash;0&squot;
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|eah-&gt;pa_dst_zero
op_assign
l_int|0
suffix:semicolon
id|eah-&gt;pa_dst_net
op_assign
id|us-&gt;s_net
suffix:semicolon
id|eah-&gt;pa_dst_node
op_assign
id|us-&gt;s_node
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Add ELAP headers and set target to the AARP multicast.&n;&t; */
id|aarp_dl
op_member_access_from_pointer
id|datalink_header
c_func
(paren
id|aarp_dl
comma
id|skb
comma
id|aarp_eth_multicast
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Send it.&n;&t; */
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle an aarp timer expire&n; *&n; *&t;Must run under the aarp_lock.&n; */
DECL|function|__aarp_expire_timer
r_static
r_void
id|__aarp_expire_timer
c_func
(paren
r_struct
id|aarp_entry
op_star
op_star
id|n
)paren
(brace
r_struct
id|aarp_entry
op_star
id|t
suffix:semicolon
r_while
c_loop
(paren
(paren
op_star
id|n
)paren
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* Expired ? */
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|expires_at
)paren
)paren
(brace
id|t
op_assign
op_star
id|n
suffix:semicolon
op_star
id|n
op_assign
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|__aarp_expire
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
r_else
(brace
id|n
op_assign
op_amp
(paren
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *&t;Kick all pending requests 5 times a second.&n; *&n; *&t;Must run under the aarp_lock.&n; */
DECL|function|__aarp_kick
r_static
r_void
id|__aarp_kick
c_func
(paren
r_struct
id|aarp_entry
op_star
op_star
id|n
)paren
(brace
r_struct
id|aarp_entry
op_star
id|t
suffix:semicolon
r_while
c_loop
(paren
(paren
op_star
id|n
)paren
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* Expired - if this will be the 11th transmit, we delete&n;&t;&t; * instead.&n;&t;&t; */
r_if
c_cond
(paren
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|xmit_count
op_ge
id|sysctl_aarp_retransmit_limit
)paren
(brace
id|t
op_assign
op_star
id|n
suffix:semicolon
op_star
id|n
op_assign
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|__aarp_expire
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
r_else
(brace
id|__aarp_send_query
c_func
(paren
op_star
id|n
)paren
suffix:semicolon
id|n
op_assign
op_amp
(paren
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *&t;A device has gone down. Take all entries referring to the device&n; *&t;and remove them.&n; *&n; *&t;Must run under the aarp_lock.&n; */
DECL|function|__aarp_expire_device
r_static
r_void
id|__aarp_expire_device
c_func
(paren
r_struct
id|aarp_entry
op_star
op_star
id|n
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|aarp_entry
op_star
id|t
suffix:semicolon
r_while
c_loop
(paren
(paren
op_star
id|n
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|dev
op_eq
id|dev
)paren
(brace
id|t
op_assign
op_star
id|n
suffix:semicolon
op_star
id|n
op_assign
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|__aarp_expire
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
r_else
(brace
id|n
op_assign
op_amp
(paren
(paren
op_star
id|n
)paren
op_member_access_from_pointer
id|next
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *&t;Handle the timer event &n; */
DECL|function|aarp_expire_timeout
r_static
r_void
id|aarp_expire_timeout
c_func
(paren
r_int
r_int
id|unused
)paren
(brace
r_int
id|ct
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|AARP_HASH_SIZE
suffix:semicolon
id|ct
op_increment
)paren
(brace
id|__aarp_expire_timer
c_func
(paren
op_amp
id|resolved
(braket
id|ct
)braket
)paren
suffix:semicolon
id|__aarp_kick
c_func
(paren
op_amp
id|unresolved
(braket
id|ct
)braket
)paren
suffix:semicolon
id|__aarp_expire_timer
c_func
(paren
op_amp
id|unresolved
(braket
id|ct
)braket
)paren
suffix:semicolon
id|__aarp_expire_timer
c_func
(paren
op_amp
id|proxies
(braket
id|ct
)braket
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|aarp_timer
comma
id|jiffies
op_plus
(paren
id|unresolved_count
ques
c_cond
id|sysctl_aarp_tick_time
suffix:colon
id|sysctl_aarp_expiry_time
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Network device notifier chain handler.&n; */
DECL|function|aarp_device_event
r_static
r_int
id|aarp_device_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_int
id|ct
suffix:semicolon
r_if
c_cond
(paren
id|event
op_eq
id|NETDEV_DOWN
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|AARP_HASH_SIZE
suffix:semicolon
id|ct
op_increment
)paren
(brace
id|__aarp_expire_device
c_func
(paren
op_amp
id|resolved
(braket
id|ct
)braket
comma
id|ptr
)paren
suffix:semicolon
id|__aarp_expire_device
c_func
(paren
op_amp
id|unresolved
(braket
id|ct
)braket
comma
id|ptr
)paren
suffix:semicolon
id|__aarp_expire_device
c_func
(paren
op_amp
id|proxies
(braket
id|ct
)braket
comma
id|ptr
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Create a new aarp entry.  This must use GFP_ATOMIC because it&n; *&t;runs while holding spinlocks.&n; */
DECL|function|aarp_alloc
r_static
r_struct
id|aarp_entry
op_star
id|aarp_alloc
c_func
(paren
r_void
)paren
(brace
r_struct
id|aarp_entry
op_star
id|a
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|aarp_entry
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|a-&gt;packet_queue
)paren
suffix:semicolon
r_return
id|a
suffix:semicolon
)brace
multiline_comment|/*&n; * Find an entry. We might return an expired but not yet purged entry. We&n; * don&squot;t care as it will do no harm.&n; *&n; * This must run under the aarp_lock.&n; */
DECL|function|__aarp_find_entry
r_static
r_struct
id|aarp_entry
op_star
id|__aarp_find_entry
c_func
(paren
r_struct
id|aarp_entry
op_star
id|list
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|at_addr
op_star
id|sat
)paren
(brace
r_while
c_loop
(paren
id|list
)paren
(brace
r_if
c_cond
(paren
id|list-&gt;target_addr.s_net
op_eq
id|sat-&gt;s_net
op_logical_and
id|list-&gt;target_addr.s_node
op_eq
id|sat-&gt;s_node
op_logical_and
id|list-&gt;dev
op_eq
id|dev
)paren
r_break
suffix:semicolon
id|list
op_assign
id|list-&gt;next
suffix:semicolon
)brace
r_return
id|list
suffix:semicolon
)brace
multiline_comment|/* Called from the DDP code, and thus must be exported. */
DECL|function|aarp_proxy_remove
r_void
id|aarp_proxy_remove
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|at_addr
op_star
id|sa
)paren
(brace
r_struct
id|aarp_entry
op_star
id|a
suffix:semicolon
r_int
id|hash
suffix:semicolon
id|hash
op_assign
id|sa-&gt;s_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|proxies
(braket
id|hash
)braket
comma
id|dev
comma
id|sa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
)paren
id|a-&gt;expires_at
op_assign
id|jiffies
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* This must run under aarp_lock. */
DECL|function|__aarp_proxy_find
r_static
r_struct
id|at_addr
op_star
id|__aarp_proxy_find
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|at_addr
op_star
id|sa
)paren
(brace
r_struct
id|at_addr
op_star
id|retval
suffix:semicolon
r_struct
id|aarp_entry
op_star
id|a
suffix:semicolon
r_int
id|hash
suffix:semicolon
id|hash
op_assign
id|sa-&gt;s_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|retval
op_assign
l_int|NULL
suffix:semicolon
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|proxies
(braket
id|hash
)braket
comma
id|dev
comma
id|sa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
op_ne
l_int|NULL
)paren
id|retval
op_assign
id|sa
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * Probe a Phase 1 device or a device that requires its Net:Node to&n; * be set via an ioctl.&n; */
DECL|function|aarp_send_probe_phase1
r_void
id|aarp_send_probe_phase1
c_func
(paren
r_struct
id|atalk_iface
op_star
id|iface
)paren
(brace
r_struct
id|ifreq
id|atreq
suffix:semicolon
r_struct
id|sockaddr_at
op_star
id|sa
op_assign
(paren
r_struct
id|sockaddr_at
op_star
)paren
op_amp
id|atreq.ifr_addr
suffix:semicolon
id|sa-&gt;sat_addr.s_node
op_assign
id|iface-&gt;address.s_node
suffix:semicolon
id|sa-&gt;sat_addr.s_net
op_assign
id|ntohs
c_func
(paren
id|iface-&gt;address.s_net
)paren
suffix:semicolon
multiline_comment|/* We pass the Net:Node to the drivers/cards by a Device ioctl. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|iface-&gt;dev
op_member_access_from_pointer
id|do_ioctl
c_func
(paren
id|iface-&gt;dev
comma
op_amp
id|atreq
comma
id|SIOCSIFADDR
)paren
)paren
)paren
(brace
(paren
r_void
)paren
id|iface-&gt;dev
op_member_access_from_pointer
id|do_ioctl
c_func
(paren
id|iface-&gt;dev
comma
op_amp
id|atreq
comma
id|SIOCGIFADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|iface-&gt;address.s_net
op_ne
id|htons
c_func
(paren
id|sa-&gt;sat_addr.s_net
)paren
)paren
op_logical_or
(paren
id|iface-&gt;address.s_node
op_ne
id|sa-&gt;sat_addr.s_node
)paren
)paren
id|iface-&gt;status
op_or_assign
id|ATIF_PROBE_FAIL
suffix:semicolon
id|iface-&gt;address.s_net
op_assign
id|htons
c_func
(paren
id|sa-&gt;sat_addr.s_net
)paren
suffix:semicolon
id|iface-&gt;address.s_node
op_assign
id|sa-&gt;sat_addr.s_node
suffix:semicolon
)brace
)brace
DECL|function|aarp_probe_network
r_void
id|aarp_probe_network
c_func
(paren
r_struct
id|atalk_iface
op_star
id|atif
)paren
(brace
r_if
c_cond
(paren
id|atif-&gt;dev-&gt;type
op_eq
id|ARPHRD_LOCALTLK
op_logical_or
id|atif-&gt;dev-&gt;type
op_eq
id|ARPHRD_PPP
)paren
(brace
id|aarp_send_probe_phase1
c_func
(paren
id|atif
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|AARP_RETRANSMIT_LIMIT
suffix:semicolon
id|count
op_increment
)paren
(brace
id|aarp_send_probe
c_func
(paren
id|atif-&gt;dev
comma
op_amp
id|atif-&gt;address
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Defer 1/10th&n;&t;&t;&t; */
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atif-&gt;status
op_amp
id|ATIF_PROBE_FAIL
)paren
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|aarp_proxy_probe_network
r_int
id|aarp_proxy_probe_network
c_func
(paren
r_struct
id|atalk_iface
op_star
id|atif
comma
r_struct
id|at_addr
op_star
id|sa
)paren
(brace
r_struct
id|aarp_entry
op_star
id|entry
suffix:semicolon
r_int
r_int
id|count
suffix:semicolon
r_int
id|hash
comma
id|retval
suffix:semicolon
multiline_comment|/*&n;&t; * we don&squot;t currently support LocalTalk or PPP for proxy AARP;&n;&t; * if someone wants to try and add it, have fun&n;&t; */
r_if
c_cond
(paren
id|atif-&gt;dev-&gt;type
op_eq
id|ARPHRD_LOCALTLK
)paren
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
id|atif-&gt;dev-&gt;type
op_eq
id|ARPHRD_PPP
)paren
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
multiline_comment|/* &n;&t; * create a new AARP entry with the flags set to be published -- &n;&t; * we need this one to hang around even if it&squot;s in use&n;&t; */
id|entry
op_assign
id|aarp_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|entry-&gt;expires_at
op_assign
op_minus
l_int|1
suffix:semicolon
id|entry-&gt;status
op_assign
id|ATIF_PROBE
suffix:semicolon
id|entry-&gt;target_addr.s_node
op_assign
id|sa-&gt;s_node
suffix:semicolon
id|entry-&gt;target_addr.s_net
op_assign
id|sa-&gt;s_net
suffix:semicolon
id|entry-&gt;dev
op_assign
id|atif-&gt;dev
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|hash
op_assign
id|sa-&gt;s_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|entry-&gt;next
op_assign
id|proxies
(braket
id|hash
)braket
suffix:semicolon
id|proxies
(braket
id|hash
)braket
op_assign
id|entry
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|AARP_RETRANSMIT_LIMIT
suffix:semicolon
id|count
op_increment
)paren
(brace
id|aarp_send_probe
c_func
(paren
id|atif-&gt;dev
comma
id|sa
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Defer 1/10th&n;&t;&t; */
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;status
op_amp
id|ATIF_PROBE_FAIL
)paren
r_break
suffix:semicolon
)brace
id|retval
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;status
op_amp
id|ATIF_PROBE_FAIL
)paren
(brace
multiline_comment|/* free the entry */
id|entry-&gt;expires_at
op_assign
id|jiffies
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* return network full */
id|retval
op_assign
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* clear the probing flag */
id|entry-&gt;status
op_and_assign
op_complement
id|ATIF_PROBE
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send a DDP frame&n; */
DECL|function|aarp_send_ddp
r_int
id|aarp_send_ddp
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|at_addr
op_star
id|sa
comma
r_void
op_star
id|hwaddr
)paren
(brace
r_static
r_char
id|ddp_eth_multicast
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|0x09
comma
l_int|0x00
comma
l_int|0x07
comma
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
)brace
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_struct
id|aarp_entry
op_star
id|a
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Check for LocalTalk first&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_LOCALTLK
)paren
(brace
r_struct
id|at_addr
op_star
id|at
op_assign
id|atalk_find_dev_addr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ddpehdr
op_star
id|ddp
op_assign
(paren
r_struct
id|ddpehdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_int
id|ft
op_assign
l_int|2
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Compressible ?&n;&t;&t; * &n;&t;&t; *&t;IFF: src_net==dest_net==device_net&n;&t;&t; *&t;(zero matches anything)&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|ddp-&gt;deh_snet
op_eq
l_int|0
op_logical_or
id|at-&gt;s_net
op_eq
id|ddp-&gt;deh_snet
)paren
op_logical_and
(paren
id|ddp-&gt;deh_dnet
op_eq
l_int|0
op_logical_or
id|at-&gt;s_net
op_eq
id|ddp-&gt;deh_dnet
)paren
)paren
(brace
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|ddpehdr
)paren
op_minus
l_int|4
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;The upper two remaining bytes are the port &n;&t;&t;&t; *&t;numbers&t;we just happen to need. Now put the &n;&t;&t;&t; *&t;length in the lower two.&n;&t;&t;&t; */
op_star
(paren
(paren
id|__u16
op_star
)paren
id|skb-&gt;data
)paren
op_assign
id|htons
c_func
(paren
id|skb-&gt;len
)paren
suffix:semicolon
id|ft
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; *&t;Nice and easy. No AARP type protocols occur here&n;&t;&t; *&t;so we can just shovel it out with a 3 byte LLAP header&n;&t;&t; */
id|skb_push
c_func
(paren
id|skb
comma
l_int|3
)paren
suffix:semicolon
id|skb-&gt;data
(braket
l_int|0
)braket
op_assign
id|sa-&gt;s_node
suffix:semicolon
id|skb-&gt;data
(braket
l_int|1
)braket
op_assign
id|at-&gt;s_node
suffix:semicolon
id|skb-&gt;data
(braket
l_int|2
)braket
op_assign
id|ft
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;sk
)paren
id|skb-&gt;priority
op_assign
id|skb-&gt;sk-&gt;priority
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;On a PPP link we neither compress nor aarp.&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_PPP
)paren
(brace
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_PPPTALK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;sk
)paren
id|skb-&gt;priority
op_assign
id|skb-&gt;sk-&gt;priority
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Non ELAP we cannot do.&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;type
op_ne
id|ARPHRD_ETHER
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_ATALK
)paren
suffix:semicolon
id|hash
op_assign
id|sa-&gt;s_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Do we have a resolved entry ?&n;&t; */
r_if
c_cond
(paren
id|sa-&gt;s_node
op_eq
id|ATADDR_BCAST
)paren
(brace
id|ddp_dl
op_member_access_from_pointer
id|datalink_header
c_func
(paren
id|ddp_dl
comma
id|skb
comma
id|ddp_eth_multicast
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;sk
)paren
id|skb-&gt;priority
op_assign
id|skb-&gt;sk-&gt;priority
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|spin_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|resolved
(braket
id|hash
)braket
comma
id|dev
comma
id|sa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;Return 1 and fill in the address&n;&t;&t; */
id|a-&gt;expires_at
op_assign
id|jiffies
op_plus
(paren
id|sysctl_aarp_expiry_time
op_star
l_int|10
)paren
suffix:semicolon
id|ddp_dl
op_member_access_from_pointer
id|datalink_header
c_func
(paren
id|ddp_dl
comma
id|skb
comma
id|a-&gt;hwaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;sk
)paren
(brace
id|skb-&gt;priority
op_assign
id|skb-&gt;sk-&gt;priority
suffix:semicolon
)brace
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Do we have an unresolved entry: This is the less common path&n;&t; */
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|unresolved
(braket
id|hash
)braket
comma
id|dev
comma
id|sa
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;Queue onto the unresolved queue&n;&t;&t; */
id|skb_queue_tail
c_func
(paren
op_amp
id|a-&gt;packet_queue
comma
id|skb
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Allocate a new entry&n;&t; */
id|a
op_assign
id|aarp_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;Whoops slipped... good job it&squot;s an unreliable &n;&t;&t; *&t;protocol 8)&t;&n;&t;&t; */
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Set up the queue&n;&t; */
id|skb_queue_tail
c_func
(paren
op_amp
id|a-&gt;packet_queue
comma
id|skb
)paren
suffix:semicolon
id|a-&gt;expires_at
op_assign
id|jiffies
op_plus
id|sysctl_aarp_resolve_time
suffix:semicolon
id|a-&gt;dev
op_assign
id|dev
suffix:semicolon
id|a-&gt;next
op_assign
id|unresolved
(braket
id|hash
)braket
suffix:semicolon
id|a-&gt;target_addr
op_assign
op_star
id|sa
suffix:semicolon
id|a-&gt;xmit_count
op_assign
l_int|0
suffix:semicolon
id|unresolved
(braket
id|hash
)braket
op_assign
id|a
suffix:semicolon
id|unresolved_count
op_increment
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Send an initial request for the address&n;&t; */
id|__aarp_send_query
c_func
(paren
id|a
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Switch to fast timer if needed (That is if this is the&n;&t; *&t;first unresolved entry to get added)&n;&t; */
r_if
c_cond
(paren
id|unresolved_count
op_eq
l_int|1
)paren
id|mod_timer
c_func
(paren
op_amp
id|aarp_timer
comma
id|jiffies
op_plus
id|sysctl_aarp_tick_time
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Now finally, it is safe to drop the lock.&n;&t; */
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Tell the ddp layer we have taken over for this frame.&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;An entry in the aarp unresolved queue has become resolved. Send&n; *&t;all the frames queued under it.&n; *&n; *&t;Must run under aarp_lock.&n; */
DECL|function|__aarp_resolved
r_static
r_void
id|__aarp_resolved
c_func
(paren
r_struct
id|aarp_entry
op_star
op_star
id|list
comma
r_struct
id|aarp_entry
op_star
id|a
comma
r_int
id|hash
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_while
c_loop
(paren
op_star
id|list
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_star
id|list
op_eq
id|a
)paren
(brace
id|unresolved_count
op_decrement
suffix:semicolon
op_star
id|list
op_assign
id|a-&gt;next
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t; *&t;Move into the resolved list &n;&t;&t;&t; */
id|a-&gt;next
op_assign
id|resolved
(braket
id|hash
)braket
suffix:semicolon
id|resolved
(braket
id|hash
)braket
op_assign
id|a
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;Kick frames off &n;&t;&t;&t; */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|a-&gt;packet_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|a-&gt;expires_at
op_assign
id|jiffies
op_plus
(paren
id|sysctl_aarp_expiry_time
op_star
l_int|10
)paren
suffix:semicolon
id|ddp_dl
op_member_access_from_pointer
id|datalink_header
c_func
(paren
id|ddp_dl
comma
id|skb
comma
id|a-&gt;hwaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;sk
)paren
id|skb-&gt;priority
op_assign
id|skb-&gt;sk-&gt;priority
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|list
op_assign
op_amp
(paren
(paren
op_star
id|list
)paren
op_member_access_from_pointer
id|next
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *&t;This is called by the SNAP driver whenever we see an AARP SNAP&n; *&t;frame. We currently only support Ethernet.&n; */
DECL|function|aarp_rcv
r_static
r_int
id|aarp_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|elapaarp
op_star
id|ea
op_assign
(paren
r_struct
id|elapaarp
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|aarp_entry
op_star
id|a
suffix:semicolon
r_struct
id|at_addr
id|sa
comma
op_star
id|ma
comma
id|da
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_struct
id|atalk_iface
op_star
id|ifa
suffix:semicolon
multiline_comment|/*&n;&t; *&t;We only do Ethernet SNAP AARP.&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;type
op_ne
id|ARPHRD_ETHER
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Frame size ok ?&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|ea
)paren
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ea-&gt;function
op_assign
id|ntohs
c_func
(paren
id|ea-&gt;function
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Sanity check fields.&n;&t; */
r_if
c_cond
(paren
id|ea-&gt;function
template_param
id|AARP_PROBE
op_logical_or
id|ea-&gt;hw_len
op_ne
id|ETH_ALEN
op_logical_or
id|ea-&gt;pa_len
op_ne
id|AARP_PA_ALEN
op_logical_or
id|ea-&gt;pa_src_zero
op_ne
l_int|0
op_logical_or
id|ea-&gt;pa_dst_zero
op_ne
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Looks good.&n;&t; */
id|hash
op_assign
id|ea-&gt;pa_src_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Build an address.&n;&t; */
id|sa.s_node
op_assign
id|ea-&gt;pa_src_node
suffix:semicolon
id|sa.s_net
op_assign
id|ea-&gt;pa_src_net
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Process the packet.&n;&t; *&t;Check for replies of me.&n;&t; */
id|ifa
op_assign
id|atalk_find_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa
op_eq
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifa-&gt;status
op_amp
id|ATIF_PROBE
)paren
(brace
r_if
c_cond
(paren
id|ifa-&gt;address.s_node
op_eq
id|ea-&gt;pa_dst_node
op_logical_and
id|ifa-&gt;address.s_net
op_eq
id|ea-&gt;pa_dst_net
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; *&t;Fail the probe (in use)&n;&t;&t;&t; */
id|ifa-&gt;status
op_or_assign
id|ATIF_PROBE_FAIL
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * Check for replies of proxy AARP entries&n;&t; */
id|da.s_node
op_assign
id|ea-&gt;pa_dst_node
suffix:semicolon
id|da.s_net
op_assign
id|ea-&gt;pa_dst_net
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|proxies
(braket
id|hash
)braket
comma
id|dev
comma
op_amp
id|da
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|a-&gt;status
op_amp
id|ATIF_PROBE
)paren
(brace
id|a-&gt;status
op_or_assign
id|ATIF_PROBE_FAIL
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * we do not respond to probe or request packets for&n;&t;&t;&t; * this address while we are probing this address&n;&t;&t;&t; */
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_switch
c_cond
(paren
id|ea-&gt;function
)paren
(brace
r_case
id|AARP_REPLY
suffix:colon
r_if
c_cond
(paren
id|unresolved_count
op_eq
l_int|0
)paren
multiline_comment|/* Speed up */
r_break
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;Find the entry.&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|unresolved
(braket
id|hash
)braket
comma
id|dev
comma
op_amp
id|sa
)paren
)paren
op_eq
l_int|NULL
op_logical_or
(paren
id|dev
op_ne
id|a-&gt;dev
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;We can fill one in - this is good.&n;&t;&t;&t; */
id|memcpy
c_func
(paren
id|a-&gt;hwaddr
comma
id|ea-&gt;hw_src
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|__aarp_resolved
c_func
(paren
op_amp
id|unresolved
(braket
id|hash
)braket
comma
id|a
comma
id|hash
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unresolved_count
op_eq
l_int|0
)paren
id|mod_timer
c_func
(paren
op_amp
id|aarp_timer
comma
id|jiffies
op_plus
id|sysctl_aarp_expiry_time
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AARP_REQUEST
suffix:colon
r_case
id|AARP_PROBE
suffix:colon
multiline_comment|/*&n;&t;&t;&t; *&t;If it is my address set ma to my address and reply. We can treat probe and&n;&t;&t;&t; *&t;request the same. Probe simply means we shouldn&squot;t cache the querying host, &n;&t;&t;&t; *&t;as in a probe they are proposing an address not using one.&n;&t;&t;&t; *&t;&n;&t;&t;&t; *&t;Support for proxy-AARP added.  We check if the address is one&n;&t;&t;&t; *&t;of our proxies before we toss the packet out.&n;&t;&t;&t; */
id|sa.s_node
op_assign
id|ea-&gt;pa_dst_node
suffix:semicolon
id|sa.s_net
op_assign
id|ea-&gt;pa_dst_net
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * See if we have a matching proxy.&n;&t;&t;&t; */
id|ma
op_assign
id|__aarp_proxy_find
c_func
(paren
id|dev
comma
op_amp
id|sa
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ma
)paren
(brace
id|ma
op_assign
op_amp
id|ifa-&gt;address
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * We need to make a copy of the entry.&n;&t;&t;&t;&t; */
id|da.s_node
op_assign
id|sa.s_node
suffix:semicolon
id|da.s_net
op_assign
id|da.s_net
suffix:semicolon
id|ma
op_assign
op_amp
id|da
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ea-&gt;function
op_eq
id|AARP_PROBE
)paren
(brace
multiline_comment|/* A probe implies someone trying to get an&n;&t;&t;&t;&t; * address. So as a precaution flush any&n;&t;&t;&t;&t; * entries we have for this address.&n;&t;&t;&t;&t; */
r_struct
id|aarp_entry
op_star
id|a
op_assign
id|__aarp_find_entry
c_func
(paren
id|resolved
(braket
id|sa.s_node
op_mod
(paren
id|AARP_HASH_SIZE
op_minus
l_int|1
)paren
)braket
comma
id|skb-&gt;dev
comma
op_amp
id|sa
)paren
suffix:semicolon
multiline_comment|/* Make it expire next tick - that avoids us&n;&t;&t;&t;&t; * getting into a probe/flush/learn/probe/flush/learn&n;&t;&t;&t;&t; * cycle during probing of a slow to respond host addr.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|a
op_ne
l_int|NULL
)paren
(brace
id|a-&gt;expires_at
op_assign
id|jiffies
op_minus
l_int|1
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|aarp_timer
comma
id|jiffies
op_plus
id|sysctl_aarp_tick_time
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sa.s_node
op_ne
id|ma-&gt;s_node
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|sa.s_net
op_logical_and
id|ma-&gt;s_net
op_logical_and
id|sa.s_net
op_ne
id|ma-&gt;s_net
)paren
r_break
suffix:semicolon
id|sa.s_node
op_assign
id|ea-&gt;pa_src_node
suffix:semicolon
id|sa.s_net
op_assign
id|ea-&gt;pa_src_net
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;aarp_my_address has found the address to use for us.&n;&t;&t;&t; */
id|aarp_send_reply
c_func
(paren
id|dev
comma
id|ma
comma
op_amp
id|sa
comma
id|ea-&gt;hw_src
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|variable|aarp_notifier
r_static
r_struct
id|notifier_block
id|aarp_notifier
op_assign
(brace
id|aarp_device_event
comma
l_int|NULL
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|aarp_snap_id
r_static
r_char
id|aarp_snap_id
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x80
comma
l_int|0xF3
)brace
suffix:semicolon
DECL|function|aarp_proto_init
r_void
id|__init
id|aarp_proto_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
(paren
id|aarp_dl
op_assign
id|register_snap_client
c_func
(paren
id|aarp_snap_id
comma
id|aarp_rcv
)paren
)paren
op_eq
l_int|NULL
)paren
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;Unable to register AARP with SNAP.&bslash;n&quot;
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|aarp_timer
)paren
suffix:semicolon
id|aarp_timer.function
op_assign
id|aarp_expire_timeout
suffix:semicolon
id|aarp_timer.data
op_assign
l_int|0
suffix:semicolon
id|aarp_timer.expires
op_assign
id|jiffies
op_plus
id|sysctl_aarp_expiry_time
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|aarp_timer
)paren
suffix:semicolon
id|register_netdevice_notifier
c_func
(paren
op_amp
id|aarp_notifier
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Remove the AARP entries associated with a device.&n; */
DECL|function|aarp_device_down
r_void
id|aarp_device_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ct
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|AARP_HASH_SIZE
suffix:semicolon
id|ct
op_increment
)paren
(brace
id|__aarp_expire_device
c_func
(paren
op_amp
id|resolved
(braket
id|ct
)braket
comma
id|dev
)paren
suffix:semicolon
id|__aarp_expire_device
c_func
(paren
op_amp
id|unresolved
(braket
id|ct
)braket
comma
id|dev
)paren
suffix:semicolon
id|__aarp_expire_device
c_func
(paren
op_amp
id|proxies
(braket
id|ct
)braket
comma
id|dev
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Called from proc fs&n; */
DECL|function|aarp_get_info
r_static
r_int
id|aarp_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
multiline_comment|/* we should dump all our AARP entries */
r_struct
id|aarp_entry
op_star
id|entry
suffix:semicolon
r_int
id|len
comma
id|ct
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%-10.10s  &quot;&quot;%-10.10s&quot;&quot;%-18.18s&quot;&quot;%12.12s&quot;&quot;%12.12s&quot;&quot; xmit_count  status&bslash;n&quot;
comma
l_string|&quot;address&quot;
comma
l_string|&quot;device&quot;
comma
l_string|&quot;hw addr&quot;
comma
l_string|&quot;last_sent&quot;
comma
l_string|&quot;expires&quot;
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|AARP_HASH_SIZE
suffix:semicolon
id|ct
op_increment
)paren
(brace
r_for
c_loop
(paren
id|entry
op_assign
id|resolved
(braket
id|ct
)braket
suffix:semicolon
id|entry
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%6u:%-3u  &quot;
comma
(paren
r_int
r_int
)paren
id|ntohs
c_func
(paren
id|entry-&gt;target_addr.s_net
)paren
comma
(paren
r_int
r_int
)paren
(paren
id|entry-&gt;target_addr.s_node
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-10.10s&quot;
comma
id|entry-&gt;dev-&gt;name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%2.2X:%2.2X:%2.2X:%2.2X:%2.2X:%2.2X&quot;
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|0
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|1
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|2
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|3
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|4
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|5
)braket
op_amp
l_int|0x000000FF
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%12lu &quot;&quot;%12lu &quot;
comma
(paren
r_int
r_int
)paren
id|entry-&gt;last_sent
comma
(paren
r_int
r_int
)paren
id|entry-&gt;expires_at
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%10u&quot;
comma
(paren
r_int
r_int
)paren
id|entry-&gt;xmit_count
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;   resolved&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|AARP_HASH_SIZE
suffix:semicolon
id|ct
op_increment
)paren
(brace
r_for
c_loop
(paren
id|entry
op_assign
id|unresolved
(braket
id|ct
)braket
suffix:semicolon
id|entry
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%6u:%-3u  &quot;
comma
(paren
r_int
r_int
)paren
id|ntohs
c_func
(paren
id|entry-&gt;target_addr.s_net
)paren
comma
(paren
r_int
r_int
)paren
(paren
id|entry-&gt;target_addr.s_node
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-10.10s&quot;
comma
id|entry-&gt;dev-&gt;name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%2.2X:%2.2X:%2.2X:%2.2X:%2.2X:%2.2X&quot;
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|0
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|1
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|2
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|3
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|4
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|5
)braket
op_amp
l_int|0x000000FF
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%12lu &quot;&quot;%12lu &quot;
comma
(paren
r_int
r_int
)paren
id|entry-&gt;last_sent
comma
(paren
r_int
r_int
)paren
id|entry-&gt;expires_at
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%10u&quot;
comma
(paren
r_int
r_int
)paren
id|entry-&gt;xmit_count
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; unresolved&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|AARP_HASH_SIZE
suffix:semicolon
id|ct
op_increment
)paren
(brace
r_for
c_loop
(paren
id|entry
op_assign
id|proxies
(braket
id|ct
)braket
suffix:semicolon
id|entry
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%6u:%-3u  &quot;
comma
(paren
r_int
r_int
)paren
id|ntohs
c_func
(paren
id|entry-&gt;target_addr.s_net
)paren
comma
(paren
r_int
r_int
)paren
(paren
id|entry-&gt;target_addr.s_node
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-10.10s&quot;
comma
id|entry-&gt;dev-&gt;name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%2.2X:%2.2X:%2.2X:%2.2X:%2.2X:%2.2X&quot;
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|0
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|1
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|2
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|3
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|4
)braket
op_amp
l_int|0x000000FF
)paren
comma
(paren
r_int
)paren
(paren
id|entry-&gt;hwaddr
(braket
l_int|5
)braket
op_amp
l_int|0x000000FF
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%12lu &quot;&quot;%12lu &quot;
comma
(paren
r_int
r_int
)paren
id|entry-&gt;last_sent
comma
(paren
r_int
r_int
)paren
id|entry-&gt;expires_at
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%10u&quot;
comma
(paren
r_int
r_int
)paren
id|entry-&gt;xmit_count
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;      proxy&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|aarp_lock
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#ifdef MODULE
multiline_comment|/*&n; * General module cleanup. Called from cleanup_module() in ddp.c.&n; */
DECL|function|aarp_cleanup_module
r_void
id|aarp_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|aarp_timer
)paren
suffix:semicolon
id|unregister_netdevice_notifier
c_func
(paren
op_amp
id|aarp_notifier
)paren
suffix:semicolon
id|unregister_snap_client
c_func
(paren
id|aarp_snap_id
)paren
suffix:semicolon
)brace
macro_line|#endif  /* MODULE */
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|aarp_register_proc_fs
r_void
id|aarp_register_proc_fs
c_func
(paren
r_void
)paren
(brace
id|proc_net_create
c_func
(paren
l_string|&quot;aarp&quot;
comma
l_int|0
comma
id|aarp_get_info
)paren
suffix:semicolon
)brace
DECL|function|aarp_unregister_proc_fs
r_void
id|aarp_unregister_proc_fs
c_func
(paren
r_void
)paren
(brace
id|proc_net_remove
c_func
(paren
l_string|&quot;aarp&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif  /* CONFIG_ATALK || CONFIG_ATALK_MODULE */
eof
