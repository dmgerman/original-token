multiline_comment|/*&n; *&t;Linux INET6 implementation&n; *&t;FIB front-end.&n; *&n; *&t;Authors:&n; *&t;Pedro Roque&t;&t;&lt;roque@di.fc.ul.pt&gt;&t;&n; *&n; *&t;$Id: route.c,v 1.18 1997/10/17 00:15:05 freitag Exp $&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#ifdef &t;CONFIG_PROC_FS
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#endif
macro_line|#include &lt;net/snmp.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/ip6_fib.h&gt;
macro_line|#include &lt;net/ip6_route.h&gt;
macro_line|#include &lt;net/ndisc.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|macro|CONFIG_RT6_POLICY
macro_line|#undef CONFIG_RT6_POLICY
multiline_comment|/* Set to 3 to get tracing. */
DECL|macro|RT6_DEBUG
mdefine_line|#define RT6_DEBUG 2
macro_line|#if RT6_DEBUG &gt;= 3
DECL|macro|RDBG
mdefine_line|#define RDBG(x) printk x
macro_line|#else
DECL|macro|RDBG
mdefine_line|#define RDBG(x)
macro_line|#endif
r_static
r_struct
id|dst_entry
op_star
id|ip6_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|u32
id|cookie
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|ip6_dst_reroute
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|ip6_pkt_discard
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
DECL|variable|ip6_dst_ops
r_struct
id|dst_ops
id|ip6_dst_ops
op_assign
(brace
id|AF_INET6
comma
id|ip6_dst_check
comma
id|ip6_dst_reroute
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|ip6_null_entry
r_struct
id|rt6_info
id|ip6_null_entry
op_assign
(brace
(brace
(brace
l_int|NULL
comma
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
comma
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_minus
id|ENETUNREACH
comma
l_int|NULL
comma
l_int|NULL
comma
id|ip6_pkt_discard
comma
id|ip6_pkt_discard
comma
op_amp
id|ip6_dst_ops
)brace
)brace
comma
l_int|NULL
comma
(brace
(brace
(brace
l_int|0
)brace
)brace
)brace
comma
l_int|256
comma
id|RTF_REJECT
op_or
id|RTF_NONEXTHOP
comma
op_complement
l_int|0UL
comma
l_int|0
comma
(brace
l_int|NULL
)brace
comma
(brace
(brace
(brace
(brace
l_int|0
)brace
)brace
)brace
comma
l_int|128
)brace
comma
(brace
(brace
(brace
(brace
l_int|0
)brace
)brace
)brace
comma
l_int|128
)brace
)brace
suffix:semicolon
DECL|variable|ip6_routing_table
r_struct
id|fib6_node
id|ip6_routing_table
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|ip6_null_entry
comma
l_int|0
comma
id|RTN_ROOT
op_or
id|RTN_TL_ROOT
comma
l_int|0
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_RT6_POLICY
DECL|variable|ip6_rt_policy
r_int
id|ip6_rt_policy
op_assign
l_int|0
suffix:semicolon
DECL|variable|rt6_pol_list
r_struct
id|pol_chain
op_star
id|rt6_pol_list
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
id|rt6_flow_match_in
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|rt6_flow_match_out
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
r_static
r_struct
id|rt6_info
op_star
id|rt6_flow_lookup
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|fl_acc_args
op_star
id|args
)paren
suffix:semicolon
macro_line|#else
DECL|macro|ip6_rt_policy
mdefine_line|#define ip6_rt_policy (0)
macro_line|#endif
DECL|variable|rt6_tbl_lock
r_static
id|atomic_t
id|rt6_tbl_lock
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
DECL|variable|rt6_bh_mask
r_static
r_int
id|rt6_bh_mask
op_assign
l_int|0
suffix:semicolon
DECL|macro|RT_BH_REQUEST
mdefine_line|#define RT_BH_REQUEST&t;&t;1
DECL|macro|RT_BH_GC
mdefine_line|#define RT_BH_GC&t;&t;2
r_static
r_void
id|__rt6_run_bh
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;request queue operations&n; *&t;FIFO queue/dequeue&n; */
DECL|variable|request_queue
r_static
r_struct
id|rt6_req
id|request_queue
op_assign
(brace
l_int|0
comma
l_int|NULL
comma
op_amp
id|request_queue
comma
op_amp
id|request_queue
)brace
suffix:semicolon
DECL|function|rtreq_queue
r_static
id|__inline__
r_void
id|rtreq_queue
c_func
(paren
r_struct
id|rt6_req
op_star
id|req
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|rt6_req
op_star
id|next
op_assign
op_amp
id|request_queue
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|req-&gt;prev
op_assign
id|next-&gt;prev
suffix:semicolon
id|req-&gt;prev-&gt;next
op_assign
id|req
suffix:semicolon
id|next-&gt;prev
op_assign
id|req
suffix:semicolon
id|req-&gt;next
op_assign
id|next
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|rtreq_dequeue
r_static
id|__inline__
r_struct
id|rt6_req
op_star
id|rtreq_dequeue
c_func
(paren
r_void
)paren
(brace
r_struct
id|rt6_req
op_star
id|next
op_assign
op_amp
id|request_queue
suffix:semicolon
r_struct
id|rt6_req
op_star
id|head
suffix:semicolon
id|head
op_assign
id|next-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|head
op_eq
id|next
)paren
r_return
l_int|NULL
suffix:semicolon
id|head-&gt;next-&gt;prev
op_assign
id|head-&gt;prev
suffix:semicolon
id|next-&gt;next
op_assign
id|head-&gt;next
suffix:semicolon
id|head-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|head-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
r_return
id|head
suffix:semicolon
)brace
DECL|function|rtreq_add
r_void
id|rtreq_add
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_int
id|operation
)paren
(brace
r_struct
id|rt6_req
op_star
id|rtreq
suffix:semicolon
id|rtreq
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_req
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtreq
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
id|rtreq
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rt6_req
)paren
)paren
suffix:semicolon
id|rtreq-&gt;operation
op_assign
id|operation
suffix:semicolon
id|rtreq-&gt;ptr
op_assign
id|rt
suffix:semicolon
id|rtreq_queue
c_func
(paren
id|rtreq
)paren
suffix:semicolon
id|rt6_bh_mask
op_or_assign
id|RT_BH_REQUEST
suffix:semicolon
)brace
DECL|function|rt6_lock
r_static
id|__inline__
r_void
id|rt6_lock
c_func
(paren
r_void
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|rt6_tbl_lock
)paren
suffix:semicolon
)brace
DECL|function|rt6_unlock
r_static
id|__inline__
r_void
id|rt6_unlock
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|rt6_tbl_lock
)paren
op_logical_and
id|rt6_bh_mask
)paren
(brace
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|__rt6_run_bh
c_func
(paren
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Route lookup&n; */
DECL|function|rt6_device_match
r_static
id|__inline__
r_struct
id|rt6_info
op_star
id|rt6_device_match
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|device
op_star
id|dev
comma
r_int
id|strict
)paren
(brace
r_struct
id|rt6_info
op_star
id|sprt
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;rt6_device_match: (%p,%p,%d) &quot;
comma
id|rt
comma
id|dev
comma
id|strict
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
r_for
c_loop
(paren
id|sprt
op_assign
id|rt
suffix:semicolon
id|sprt
suffix:semicolon
id|sprt
op_assign
id|sprt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
id|sprt-&gt;rt6i_dev
op_eq
id|dev
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;match --&gt; %p&bslash;n&quot;
comma
id|sprt
)paren
)paren
suffix:semicolon
r_return
id|sprt
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|strict
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;nomatch &amp; STRICT --&gt; ip6_null_entry&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_amp
id|ip6_null_entry
suffix:semicolon
)brace
)brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;!dev or (no match and !strict) --&gt; rt(%p)&bslash;n&quot;
comma
id|rt
)paren
)paren
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;pointer to the last default router chosen&n; */
DECL|variable|rt6_dflt_pointer
r_static
r_struct
id|rt6_info
op_star
id|rt6_dflt_pointer
op_assign
l_int|NULL
suffix:semicolon
DECL|function|rt6_best_dflt
r_static
r_struct
id|rt6_info
op_star
id|rt6_best_dflt
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|rt6_info
op_star
id|match
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rt6_info
op_star
id|sprt
suffix:semicolon
r_int
id|mpri
op_assign
l_int|0
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;rt6_best_dflt(%p,%p): &quot;
comma
id|rt
comma
id|dev
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|sprt
op_assign
id|rt
suffix:semicolon
id|sprt
suffix:semicolon
id|sprt
op_assign
id|sprt-&gt;u.next
)paren
(brace
r_struct
id|nd_neigh
op_star
id|ndn
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;sprt(%p): &quot;
comma
id|sprt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ndn
op_assign
(paren
r_struct
id|nd_neigh
op_star
)paren
id|sprt-&gt;rt6i_nexthop
)paren
)paren
(brace
r_int
id|m
op_assign
op_minus
l_int|1
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;nxthop(%p,%d) &quot;
comma
id|ndn
comma
id|ndn-&gt;ndn_nud_state
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ndn-&gt;ndn_nud_state
)paren
(brace
r_case
id|NUD_REACHABLE
suffix:colon
id|RDBG
c_func
(paren
(paren
l_string|&quot;NUD_REACHABLE &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sprt
op_ne
id|rt6_dflt_pointer
)paren
(brace
id|rt
op_assign
id|sprt
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;sprt!=dflt_ptr -&gt; %p&bslash;n&quot;
comma
id|sprt
)paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;m=2, &quot;
)paren
)paren
suffix:semicolon
id|m
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NUD_DELAY
suffix:colon
id|RDBG
c_func
(paren
(paren
l_string|&quot;NUD_DELAY, m=1, &quot;
)paren
)paren
suffix:semicolon
id|m
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NUD_STALE
suffix:colon
id|RDBG
c_func
(paren
(paren
l_string|&quot;NUD_STALE, m=1, &quot;
)paren
)paren
suffix:semicolon
id|m
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|sprt-&gt;rt6i_dev
op_eq
id|dev
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;dev&amp;&amp;sprt-&gt;rt6i_dev==dev(%p), m+=2, &quot;
comma
id|dev
)paren
)paren
suffix:semicolon
id|m
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|m
op_ge
id|mpri
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;m&gt;=mpri setmatch, &quot;
)paren
)paren
suffix:semicolon
id|mpri
op_assign
id|m
suffix:semicolon
id|match
op_assign
id|sprt
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|match
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;match, set rt, &quot;
)paren
)paren
suffix:semicolon
id|rt
op_assign
id|match
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; *&t;No default routers are known to be reachable.&n;&t;&t; *&t;SHOULD round robin&n;&t;&t; */
id|RDBG
c_func
(paren
(paren
l_string|&quot;!match, trying rt6_dflt_pointer, &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt6_dflt_pointer
)paren
(brace
r_struct
id|rt6_info
op_star
id|next
suffix:semicolon
r_if
c_cond
(paren
(paren
id|next
op_assign
id|rt6_dflt_pointer-&gt;u.next
)paren
op_logical_and
id|next-&gt;u.dst.error
op_eq
l_int|0
)paren
id|rt
op_assign
id|next
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|rt6_dflt_pointer
op_assign
id|rt
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;returning %p, dflt_ptr set&bslash;n&quot;
comma
id|rt
)paren
)paren
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
DECL|function|rt6_lookup
r_struct
id|rt6_info
op_star
id|rt6_lookup
c_func
(paren
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|device
op_star
id|dev
comma
r_int
id|flags
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;rt6_lookup(%p,%p,%p,%x) from %p&bslash;n&quot;
comma
id|daddr
comma
id|saddr
comma
id|dev
comma
id|flags
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|rt6_lock
c_func
(paren
)paren
suffix:semicolon
id|fn
op_assign
id|fib6_lookup
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|daddr
comma
id|saddr
)paren
suffix:semicolon
id|rt
op_assign
id|rt6_device_match
c_func
(paren
id|fn-&gt;leaf
comma
id|dev
comma
id|flags
op_amp
id|RTF_LINKRT
)paren
suffix:semicolon
id|rt6_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
DECL|function|rt6_cow
r_static
r_struct
id|rt6_info
op_star
id|rt6_cow
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|saddr
)paren
(brace
multiline_comment|/*&n;&t; *&t;Clone the route.&n;&t; */
id|rt
op_assign
id|ip6_rt_copy
c_func
(paren
id|rt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst.addr
comma
id|daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_gateway
comma
id|daddr
)paren
suffix:semicolon
id|rt-&gt;rt6i_dst.plen
op_assign
l_int|128
suffix:semicolon
id|rt-&gt;rt6i_flags
op_or_assign
id|RTF_CACHE
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_src.plen
)paren
(brace
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_src.addr
comma
id|saddr
)paren
suffix:semicolon
id|rt-&gt;rt6i_src.plen
op_assign
l_int|128
suffix:semicolon
)brace
id|rt-&gt;rt6i_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|rt-&gt;rt6i_dev
comma
op_amp
id|rt-&gt;rt6i_gateway
)paren
suffix:semicolon
id|rtreq_add
c_func
(paren
id|rt
comma
id|RT_OPER_ADD
)paren
suffix:semicolon
)brace
r_else
(brace
id|rt
op_assign
op_amp
id|ip6_null_entry
suffix:semicolon
)brace
r_return
id|rt
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_RT6_POLICY
DECL|function|rt6_flow_lookup_in
r_static
id|__inline__
r_struct
id|rt6_info
op_star
id|rt6_flow_lookup_in
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|in6_addr
op_star
id|daddr
comma
op_star
id|saddr
suffix:semicolon
r_struct
id|fl_acc_args
id|arg
suffix:semicolon
id|arg.type
op_assign
id|FL_ARG_FORWARD
suffix:semicolon
id|arg.fl_u.skb
op_assign
id|skb
suffix:semicolon
id|saddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
suffix:semicolon
id|daddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
suffix:semicolon
r_return
id|rt6_flow_lookup
c_func
(paren
id|rt
comma
id|daddr
comma
id|saddr
comma
op_amp
id|arg
)paren
suffix:semicolon
)brace
DECL|function|rt6_flow_lookup_out
r_static
id|__inline__
r_struct
id|rt6_info
op_star
id|rt6_flow_lookup_out
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|flowi
op_star
id|fl
)paren
(brace
r_struct
id|fl_acc_args
id|arg
suffix:semicolon
id|arg.type
op_assign
id|FL_ARG_ORIGIN
suffix:semicolon
id|arg.fl_u.fl_o.sk
op_assign
id|sk
suffix:semicolon
id|arg.fl_u.fl_o.flow
op_assign
id|fl
suffix:semicolon
r_return
id|rt6_flow_lookup
c_func
(paren
id|rt
comma
id|fl-&gt;nl_u.ip6_u.daddr
comma
id|fl-&gt;nl_u.ip6_u.saddr
comma
op_amp
id|arg
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|ip6_route_input
r_void
id|ip6_route_input
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;ip6_route_input(%p) from %p&bslash;n&quot;
comma
id|skb
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|rt6_lock
c_func
(paren
)paren
suffix:semicolon
id|fn
op_assign
id|fib6_lookup
c_func
(paren
op_amp
id|ip6_routing_table
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
suffix:semicolon
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_CACHE
)paren
)paren
(brace
r_if
c_cond
(paren
id|ip6_rt_policy
op_eq
l_int|0
)paren
(brace
id|rt
op_assign
id|rt6_device_match
c_func
(paren
id|rt
comma
id|skb-&gt;dev
comma
l_int|0
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_RT6_POLICY
r_if
c_cond
(paren
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_FLOW
)paren
)paren
(brace
r_struct
id|rt6_info
op_star
id|sprt
suffix:semicolon
r_for
c_loop
(paren
id|sprt
op_assign
id|rt
suffix:semicolon
id|sprt
suffix:semicolon
id|sprt
op_assign
id|sprt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
id|rt6_flow_match_in
c_func
(paren
id|sprt
comma
id|skb
)paren
)paren
(brace
id|rt
op_assign
id|sprt
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
)brace
id|rt
op_assign
id|rt6_device_match
c_func
(paren
id|rt
comma
id|skb-&gt;dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ip6_rt_policy
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|rt-&gt;rt6i_nexthop
op_logical_and
id|rt-&gt;rt6i_dev
op_logical_and
(paren
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_NONEXTHOP
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|rt
op_assign
id|rt6_cow
c_func
(paren
id|rt
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
macro_line|#ifdef CONFIG_RT6_POLICY
id|rt
op_assign
id|rt6_flow_lookup_in
c_func
(paren
id|rt
comma
id|skb
)paren
suffix:semicolon
macro_line|#endif
)brace
id|out
suffix:colon
id|dst
op_assign
id|dst_clone
c_func
(paren
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
)paren
suffix:semicolon
id|rt6_unlock
c_func
(paren
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
id|dst
suffix:semicolon
id|dst
op_member_access_from_pointer
id|input
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|ip6_route_output
r_struct
id|dst_entry
op_star
id|ip6_route_output
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|flowi
op_star
id|fl
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
r_int
id|strict
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;ip6_route_output(%p,%p) from(%p)&quot;
comma
id|sk
comma
id|fl
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|strict
op_assign
id|ipv6_addr_type
c_func
(paren
id|fl-&gt;nl_u.ip6_u.daddr
)paren
op_amp
id|IPV6_ADDR_MULTICAST
suffix:semicolon
id|rt6_lock
c_func
(paren
)paren
suffix:semicolon
macro_line|#if RT6_DEBUG &gt;= 3
id|RDBG
c_func
(paren
(paren
l_string|&quot;lkup(&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fl-&gt;nl_u.ip6_u.daddr
)paren
(brace
r_struct
id|in6_addr
op_star
id|addr
op_assign
id|fl-&gt;nl_u.ip6_u.daddr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;daddr[&quot;
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;%04x%c&quot;
comma
id|addr-&gt;s6_addr16
(braket
id|i
)braket
comma
id|i
op_eq
l_int|7
ques
c_cond
l_char|&squot;]&squot;
suffix:colon
l_char|&squot;:&squot;
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|fl-&gt;nl_u.ip6_u.saddr
)paren
(brace
r_struct
id|in6_addr
op_star
id|addr
op_assign
id|fl-&gt;nl_u.ip6_u.saddr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;saddr[&quot;
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;%04x%c&quot;
comma
id|addr-&gt;s6_addr16
(braket
id|i
)braket
comma
id|i
op_eq
l_int|7
ques
c_cond
l_char|&squot;]&squot;
suffix:colon
l_char|&squot;:&squot;
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|fn
op_assign
id|fib6_lookup
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|fl-&gt;nl_u.ip6_u.daddr
comma
id|fl-&gt;nl_u.ip6_u.saddr
)paren
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;--&gt;(%p[%s])) &quot;
comma
id|fn
comma
id|fn
op_eq
op_amp
id|ip6_routing_table
ques
c_cond
l_string|&quot;ROOT&quot;
suffix:colon
l_string|&quot;!ROOT&quot;
)paren
)paren
suffix:semicolon
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_CACHE
)paren
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;RTF_CACHE &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ip6_rt_policy
op_eq
l_int|0
)paren
(brace
id|rt
op_assign
id|rt6_device_match
c_func
(paren
id|rt
comma
id|fl-&gt;dev
comma
id|strict
)paren
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;devmatch(%p) &quot;
comma
id|rt
)paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_RT6_POLICY
r_if
c_cond
(paren
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_FLOW
)paren
)paren
(brace
r_struct
id|rt6_info
op_star
id|sprt
suffix:semicolon
r_for
c_loop
(paren
id|sprt
op_assign
id|rt
suffix:semicolon
id|sprt
suffix:semicolon
id|sprt
op_assign
id|sprt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
id|rt6_flow_match_out
c_func
(paren
id|sprt
comma
id|sk
)paren
)paren
(brace
id|rt
op_assign
id|sprt
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
)brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;!RTF_CACHE &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_DEFAULT
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;RTF_DEFAULT &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_metric
op_ge
id|IP6_RT_PRIO_ADDRCONF
)paren
(brace
id|rt
op_assign
id|rt6_best_dflt
c_func
(paren
id|rt
comma
id|fl-&gt;dev
)paren
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;best_dflt(%p) &quot;
comma
id|rt
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|rt
op_assign
id|rt6_device_match
c_func
(paren
id|rt
comma
id|fl-&gt;dev
comma
id|strict
)paren
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;!RTF_DEFAULT devmatch(%p) &quot;
comma
id|rt
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ip6_rt_policy
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|rt-&gt;rt6i_nexthop
op_logical_and
id|rt-&gt;rt6i_dev
op_logical_and
(paren
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_NONEXTHOP
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|rt
op_assign
id|rt6_cow
c_func
(paren
id|rt
comma
id|fl-&gt;nl_u.ip6_u.daddr
comma
id|fl-&gt;nl_u.ip6_u.saddr
)paren
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;(!nhop&amp;&amp;rt6i_dev&amp;&amp;!RTF_NONEXTHOP) cow(%p) &quot;
comma
id|rt
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
macro_line|#ifdef CONFIG_RT6_POLICY
id|rt
op_assign
id|rt6_flow_lookup_out
c_func
(paren
id|rt
comma
id|sk
comma
id|fl
)paren
suffix:semicolon
macro_line|#endif
)brace
id|out
suffix:colon
id|dst
op_assign
id|dst_clone
c_func
(paren
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
)paren
suffix:semicolon
id|rt6_unlock
c_func
(paren
)paren
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;dclone/ret(%p)&bslash;n&quot;
comma
id|dst
)paren
)paren
suffix:semicolon
r_return
id|dst
suffix:semicolon
)brace
DECL|function|rt6_ins
r_void
id|rt6_ins
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
)paren
(brace
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|rt6_tbl_lock
)paren
op_eq
l_int|1
)paren
id|fib6_add
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|rt
)paren
suffix:semicolon
r_else
id|rtreq_add
c_func
(paren
id|rt
comma
id|RT_OPER_ADD
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Destination cache support functions&n; */
DECL|function|ip6_dst_check
r_struct
id|dst_entry
op_star
id|ip6_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|u32
id|cookie
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;ip6dstchk(%p,%08x)[%p]&bslash;n&quot;
comma
id|dst
comma
id|cookie
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_node
op_logical_and
(paren
id|rt-&gt;rt6i_node-&gt;fn_sernum
op_eq
id|cookie
)paren
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;rt6i_nexthop
)paren
id|ndisc_event_send
c_func
(paren
id|rt-&gt;rt6i_nexthop
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|dst
suffix:semicolon
)brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ip6_dst_reroute
r_struct
id|dst_entry
op_star
id|ip6_dst_reroute
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/*&n;&t; *&t;FIXME&n;&t; */
id|RDBG
c_func
(paren
(paren
l_string|&quot;ip6_dst_reroute(%p,%p)[%p] (AIEEE)&bslash;n&quot;
comma
id|dst
comma
id|skb
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Clean host part of a prefix. Not necessary in radix tree,&n;   but results in cleaner routing tables.&n;&n;   Remove it only when all the things will work!&n; */
DECL|function|ipv6_wash_prefix
r_static
r_void
id|ipv6_wash_prefix
c_func
(paren
r_struct
id|in6_addr
op_star
id|pfx
comma
r_int
id|plen
)paren
(brace
r_int
id|b
op_assign
id|plen
op_amp
l_int|0x7
suffix:semicolon
r_int
id|o
op_assign
(paren
id|plen
op_plus
l_int|7
)paren
op_rshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|o
OL
l_int|16
)paren
id|memset
c_func
(paren
id|pfx-&gt;s6_addr
op_plus
id|o
comma
l_int|0
comma
l_int|16
op_minus
id|o
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b
op_ne
l_int|0
)paren
id|pfx-&gt;s6_addr
(braket
id|plen
op_rshift
l_int|3
)braket
op_and_assign
(paren
l_int|0xFF
op_lshift
(paren
l_int|8
op_minus
id|b
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; */
DECL|function|ip6_route_add
r_struct
id|rt6_info
op_star
id|ip6_route_add
c_func
(paren
r_struct
id|in6_rtmsg
op_star
id|rtmsg
comma
r_int
op_star
id|err
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|addr_type
suffix:semicolon
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_dst_len
OG
l_int|128
op_logical_or
id|rtmsg-&gt;rtmsg_src_len
OG
l_int|128
)paren
(brace
op_star
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|err
op_assign
l_int|0
suffix:semicolon
id|rt
op_assign
id|dst_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_info
)paren
comma
op_amp
id|ip6_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;dalloc fails, &quot;
)paren
)paren
suffix:semicolon
op_star
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr_type
op_amp
id|IPV6_ADDR_MULTICAST
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;MCAST, &quot;
)paren
)paren
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|ip6_mc_input
suffix:semicolon
)brace
r_else
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;!MCAST &quot;
)paren
)paren
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|ip6_forward
suffix:semicolon
)brace
id|rt-&gt;u.dst.output
op_assign
id|dev_queue_xmit
suffix:semicolon
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_ifindex
)paren
(brace
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|rtmsg-&gt;rtmsg_ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
op_star
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst.addr
comma
op_amp
id|rtmsg-&gt;rtmsg_dst
)paren
suffix:semicolon
id|rt-&gt;rt6i_dst.plen
op_assign
id|rtmsg-&gt;rtmsg_dst_len
suffix:semicolon
id|ipv6_wash_prefix
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst.addr
comma
id|rt-&gt;rt6i_dst.plen
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_src.addr
comma
op_amp
id|rtmsg-&gt;rtmsg_src
)paren
suffix:semicolon
id|rt-&gt;rt6i_src.plen
op_assign
id|rtmsg-&gt;rtmsg_src_len
suffix:semicolon
id|ipv6_wash_prefix
c_func
(paren
op_amp
id|rt-&gt;rt6i_src.addr
comma
id|rt-&gt;rt6i_src.plen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_flags
op_amp
id|RTF_GATEWAY
)paren
(brace
r_struct
id|in6_addr
op_star
id|gw_addr
suffix:semicolon
r_int
id|gwa_type
suffix:semicolon
id|gw_addr
op_assign
op_amp
id|rtmsg-&gt;rtmsg_gateway
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_gateway
comma
op_amp
id|rtmsg-&gt;rtmsg_gateway
)paren
suffix:semicolon
id|gwa_type
op_assign
id|ipv6_addr_type
c_func
(paren
id|gw_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gwa_type
op_ne
(paren
id|IPV6_ADDR_LINKLOCAL
op_or
id|IPV6_ADDR_UNICAST
)paren
)paren
(brace
r_struct
id|rt6_info
op_star
id|grt
suffix:semicolon
multiline_comment|/* IPv6 strictly inhibits using not link-local&n;&t;&t;&t;   addresses as nexthop address.&n;&t;&t;&t;   It is very good, but in some (rare!) curcumstances&n;&t;&t;&t;   (SIT, NBMA NOARP links) it is handy to allow&n;&t;&t;&t;   some exceptions.&n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|gwa_type
op_amp
id|IPV6_ADDR_UNICAST
)paren
)paren
(brace
op_star
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|grt
op_assign
id|rt6_lookup
c_func
(paren
id|gw_addr
comma
l_int|NULL
comma
id|dev
comma
id|RTF_LINKRT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|grt
op_eq
l_int|NULL
op_logical_or
(paren
id|grt-&gt;rt6i_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
(brace
op_star
id|err
op_assign
op_minus
id|EHOSTUNREACH
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|dev
op_assign
id|grt-&gt;rt6i_dev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
op_star
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rt-&gt;rt6i_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|dev
comma
id|gw_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_nexthop
op_eq
l_int|NULL
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;!nxthop, &quot;
)paren
)paren
suffix:semicolon
op_star
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;nxthop, &quot;
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;!dev, &quot;
)paren
)paren
suffix:semicolon
op_star
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rt-&gt;rt6i_metric
op_assign
id|rtmsg-&gt;rtmsg_metric
suffix:semicolon
id|rt-&gt;rt6i_dev
op_assign
id|dev
suffix:semicolon
id|rt-&gt;u.dst.pmtu
op_assign
id|dev-&gt;mtu
suffix:semicolon
id|rt-&gt;rt6i_flags
op_assign
id|rtmsg-&gt;rtmsg_flags
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;rt6ins(%p) &quot;
comma
id|rt
)paren
)paren
suffix:semicolon
id|rt6_lock
c_func
(paren
)paren
suffix:semicolon
id|rt6_ins
c_func
(paren
id|rt
)paren
suffix:semicolon
id|rt6_unlock
c_func
(paren
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
op_star
id|err
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;dfree(%p) &quot;
comma
id|rt
)paren
)paren
suffix:semicolon
id|dst_free
c_func
(paren
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt
)paren
suffix:semicolon
id|rt
op_assign
l_int|NULL
suffix:semicolon
)brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;ret(%p)&bslash;n&quot;
comma
id|rt
)paren
)paren
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
DECL|function|ip6_del_rt
r_int
id|ip6_del_rt
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
)paren
(brace
id|rt6_lock
c_func
(paren
)paren
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|rt6_dflt_pointer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|rt6_tbl_lock
)paren
op_eq
l_int|1
)paren
id|fib6_del
c_func
(paren
id|rt
)paren
suffix:semicolon
r_else
id|rtreq_add
c_func
(paren
id|rt
comma
id|RT_OPER_DEL
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|rt6_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ip6_route_del
r_int
id|ip6_route_del
c_func
(paren
r_struct
id|in6_rtmsg
op_star
id|rtmsg
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Find device&n;&t; */
r_if
c_cond
(paren
id|rtmsg-&gt;rtmsg_ifindex
)paren
(brace
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|rtmsg-&gt;rtmsg_ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Find route&n;&t; */
id|rt
op_assign
id|rt6_lookup
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_dst
comma
op_amp
id|rtmsg-&gt;rtmsg_src
comma
id|dev
comma
id|dev
ques
c_cond
id|RTF_LINKRT
suffix:colon
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Blow it away&n;&t; */
r_if
c_cond
(paren
id|rt
op_logical_and
id|rt-&gt;rt6i_dst.plen
op_eq
id|rtmsg-&gt;rtmsg_dst_len
op_logical_and
id|rt-&gt;rt6i_src.plen
op_eq
id|rtmsg-&gt;rtmsg_src_len
)paren
(brace
id|ip6_del_rt
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;bottom handler, runs with atomic_bh protection&n; */
DECL|function|__rt6_run_bh
r_void
id|__rt6_run_bh
c_func
(paren
r_void
)paren
(brace
r_struct
id|rt6_req
op_star
id|rtreq
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rtreq
op_assign
id|rtreq_dequeue
c_func
(paren
)paren
)paren
)paren
(brace
r_switch
c_cond
(paren
id|rtreq-&gt;operation
)paren
(brace
r_case
id|RT_OPER_ADD
suffix:colon
id|fib6_add
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|rtreq-&gt;ptr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RT_OPER_DEL
suffix:colon
id|fib6_del
c_func
(paren
id|rtreq-&gt;ptr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|kfree
c_func
(paren
id|rtreq
)paren
suffix:semicolon
)brace
id|rt6_bh_mask
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NETLINK
multiline_comment|/*&n; *&t;NETLINK interface&n; *&t;routing socket moral equivalent&n; */
DECL|function|rt6_msgrcv
r_static
r_int
id|rt6_msgrcv
c_func
(paren
r_int
id|unit
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_struct
id|in6_rtmsg
op_star
id|rtmsg
suffix:semicolon
r_int
id|err
suffix:semicolon
r_while
c_loop
(paren
id|skb-&gt;len
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;len
OL
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
(brace
id|count
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rtmsg
op_assign
(paren
r_struct
id|in6_rtmsg
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
id|count
op_add_assign
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|rtmsg-&gt;rtmsg_type
)paren
(brace
r_case
id|RTMSG_NEWROUTE
suffix:colon
id|ip6_route_add
c_func
(paren
id|rtmsg
comma
op_amp
id|err
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RTMSG_DELROUTE
suffix:colon
id|ip6_route_del
c_func
(paren
id|rtmsg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|count
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
suffix:semicolon
)brace
id|out
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_NETLINK */
DECL|function|rt6_sndrtmsg
r_static
r_void
id|rt6_sndrtmsg
c_func
(paren
r_struct
id|in6_rtmsg
op_star
id|rtmsg
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
comma
op_amp
id|rtmsg
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NETLINK
r_if
c_cond
(paren
id|netlink_post
c_func
(paren
id|NETLINK_ROUTE6
comma
id|skb
)paren
)paren
macro_line|#endif
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
DECL|function|rt6_sndmsg
r_void
id|rt6_sndmsg
c_func
(paren
r_int
id|type
comma
r_struct
id|in6_addr
op_star
id|dst
comma
r_struct
id|in6_addr
op_star
id|src
comma
r_struct
id|in6_addr
op_star
id|gw
comma
r_struct
id|device
op_star
id|dev
comma
r_int
id|dstlen
comma
r_int
id|srclen
comma
r_int
id|metric
comma
id|__u32
id|flags
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|in6_rtmsg
op_star
id|msg
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|in6_rtmsg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|msg
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
id|msg-&gt;rtmsg_type
op_assign
id|type
suffix:semicolon
r_if
c_cond
(paren
id|dst
)paren
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;rtmsg_dst
comma
id|dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|src
)paren
(brace
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;rtmsg_src
comma
id|src
)paren
suffix:semicolon
id|msg-&gt;rtmsg_src_len
op_assign
id|srclen
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gw
)paren
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;rtmsg_gateway
comma
id|gw
)paren
suffix:semicolon
id|msg-&gt;rtmsg_dst_len
op_assign
id|dstlen
suffix:semicolon
id|msg-&gt;rtmsg_metric
op_assign
id|metric
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
id|msg-&gt;rtmsg_ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|msg-&gt;rtmsg_flags
op_assign
id|flags
suffix:semicolon
macro_line|#ifdef CONFIG_NETLINK
r_if
c_cond
(paren
id|netlink_post
c_func
(paren
id|NETLINK_ROUTE6
comma
id|skb
)paren
)paren
macro_line|#endif
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle redirects&n; */
DECL|function|rt6_redirect
r_struct
id|rt6_info
op_star
id|rt6_redirect
c_func
(paren
r_struct
id|in6_addr
op_star
id|dest
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|in6_addr
op_star
id|target
comma
r_struct
id|device
op_star
id|dev
comma
r_int
id|on_link
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
comma
op_star
id|nrt
suffix:semicolon
multiline_comment|/* Locate old route to this destination. */
id|rt
op_assign
id|rt6_lookup
c_func
(paren
id|dest
comma
l_int|NULL
comma
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
op_logical_or
id|rt-&gt;u.dst.error
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* Duplicate redirect: silently ignore. */
r_if
c_cond
(paren
id|ipv6_addr_cmp
c_func
(paren
id|target
comma
op_amp
id|rt-&gt;rt6i_gateway
)paren
op_eq
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* Current route is on-link; redirect is always invalid. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
macro_line|#if !defined(CONFIG_IPV6_EUI64) || defined(CONFIG_IPV6_NO_PB)
multiline_comment|/*&n;&t; *&t;During transition gateways have more than&n;&t; *&t;one link local address. Certainly, it is violation&n;&t; *&t;of basic principles, but it is temparary.&n;&t; */
multiline_comment|/*&n;&t; *&t;RFC 1970 specifies that redirects should only be&n;&t; *&t;accepted if they come from the nexthop to the target.&n;&t; *&t;Due to the way default routers are chosen, this notion&n;&t; *&t;is a bit fuzzy and one might need to check all default&n;&t; *&t;routers.&n;&t; */
r_if
c_cond
(paren
id|ipv6_addr_cmp
c_func
(paren
id|saddr
comma
op_amp
id|rt-&gt;rt6i_gateway
)paren
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_DEFAULT
)paren
(brace
id|rt
op_assign
id|ip6_routing_table.leaf
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_cmp
c_func
(paren
id|saddr
comma
op_amp
id|rt-&gt;rt6i_gateway
)paren
)paren
r_goto
id|source_ok
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rt6_redirect: source isn&squot;t a valid nexthop &quot;
l_string|&quot;for redirect target&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|source_ok
suffix:colon
macro_line|#endif
multiline_comment|/*&n;&t; *&t;We have finally decided to accept it.&n;&t; */
r_if
c_cond
(paren
id|rt-&gt;rt6i_dst.plen
op_eq
l_int|128
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;Already a host route.&n;&t;&t; *&n;&t;&t; */
r_if
c_cond
(paren
id|rt-&gt;rt6i_nexthop
)paren
id|neigh_release
c_func
(paren
id|rt-&gt;rt6i_nexthop
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;purge hh_cache&n;&t;&t; */
id|rt-&gt;rt6i_flags
op_or_assign
id|RTF_MODIFIED
op_or
id|RTF_CACHE
suffix:semicolon
r_if
c_cond
(paren
id|on_link
)paren
id|rt-&gt;rt6i_flags
op_and_assign
op_complement
id|RTF_GATEWAY
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_gateway
comma
id|target
)paren
suffix:semicolon
id|rt-&gt;rt6i_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|rt-&gt;rt6i_dev
comma
id|target
)paren
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
id|nrt
op_assign
id|ip6_rt_copy
c_func
(paren
id|rt
)paren
suffix:semicolon
id|nrt-&gt;rt6i_flags
op_assign
id|RTF_GATEWAY
op_or
id|RTF_UP
op_or
id|RTF_DYNAMIC
op_or
id|RTF_CACHE
suffix:semicolon
r_if
c_cond
(paren
id|on_link
)paren
id|nrt-&gt;rt6i_flags
op_and_assign
op_complement
id|RTF_GATEWAY
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|nrt-&gt;rt6i_dst.addr
comma
id|dest
)paren
suffix:semicolon
id|nrt-&gt;rt6i_dst.plen
op_assign
l_int|128
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|nrt-&gt;rt6i_gateway
comma
id|target
)paren
suffix:semicolon
id|nrt-&gt;rt6i_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|nrt-&gt;rt6i_dev
comma
id|target
)paren
suffix:semicolon
id|nrt-&gt;rt6i_dev
op_assign
id|dev
suffix:semicolon
id|nrt-&gt;u.dst.pmtu
op_assign
id|dev-&gt;mtu
suffix:semicolon
id|rt6_lock
c_func
(paren
)paren
suffix:semicolon
id|rt6_ins
c_func
(paren
id|nrt
)paren
suffix:semicolon
id|rt6_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|nrt
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle ICMP &quot;packet too big&quot; messages&n; *&t;i.e. Path MTU discovery&n; */
DECL|function|rt6_pmtu_discovery
r_void
id|rt6_pmtu_discovery
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_struct
id|device
op_star
id|dev
comma
r_int
id|pmtu
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_if
c_cond
(paren
id|pmtu
template_param
l_int|65536
)paren
(brace
macro_line|#if RT6_DEBUG &gt;= 1
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rt6_pmtu_discovery: invalid MTU value %d&bslash;n&quot;
comma
id|pmtu
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
id|rt
op_assign
id|rt6_lookup
c_func
(paren
id|addr
comma
l_int|NULL
comma
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
op_logical_or
id|rt-&gt;u.dst.error
)paren
(brace
macro_line|#if RT6_DEBUG &gt;= 2
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rt6_pmtu_discovery: no route to host&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
multiline_comment|/* It is wrong, but I plugged the hole here.&n;&t;   On-link routes are cloned differently,&n;&t;   look at rt6_redirect --ANK&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt-&gt;rt6i_dst.plen
op_eq
l_int|128
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;host route&n;&t;&t; */
id|rt-&gt;u.dst.pmtu
op_assign
id|pmtu
suffix:semicolon
id|rt-&gt;rt6i_flags
op_or_assign
id|RTF_MODIFIED
suffix:semicolon
r_return
suffix:semicolon
)brace
id|rt
op_assign
id|ip6_rt_copy
c_func
(paren
id|rt
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst.addr
comma
id|addr
)paren
suffix:semicolon
id|rt-&gt;rt6i_dst.plen
op_assign
l_int|128
suffix:semicolon
id|rt-&gt;rt6i_flags
op_or_assign
(paren
id|RTF_DYNAMIC
op_or
id|RTF_CACHE
)paren
suffix:semicolon
id|rt6_lock
c_func
(paren
)paren
suffix:semicolon
id|rt6_ins
c_func
(paren
id|rt
)paren
suffix:semicolon
id|rt6_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Misc support functions&n; */
DECL|function|ip6_rt_copy
r_struct
id|rt6_info
op_star
id|ip6_rt_copy
c_func
(paren
r_struct
id|rt6_info
op_star
id|ort
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
id|dst_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_info
)paren
comma
op_amp
id|ip6_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
id|rt-&gt;u.dst.input
op_assign
id|ort-&gt;u.dst.input
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|ort-&gt;u.dst.output
suffix:semicolon
id|rt-&gt;u.dst.pmtu
op_assign
id|ort-&gt;u.dst.pmtu
suffix:semicolon
id|rt-&gt;rt6i_dev
op_assign
id|ort-&gt;rt6i_dev
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_gateway
comma
op_amp
id|ort-&gt;rt6i_gateway
)paren
suffix:semicolon
id|rt-&gt;rt6i_keylen
op_assign
id|ort-&gt;rt6i_keylen
suffix:semicolon
id|rt-&gt;rt6i_flags
op_assign
id|ort-&gt;rt6i_flags
suffix:semicolon
id|rt-&gt;rt6i_metric
op_assign
id|ort-&gt;rt6i_metric
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst
comma
op_amp
id|ort-&gt;rt6i_dst
comma
r_sizeof
(paren
r_struct
id|rt6key
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rt-&gt;rt6i_src
comma
op_amp
id|ort-&gt;rt6i_src
comma
r_sizeof
(paren
r_struct
id|rt6key
)paren
)paren
suffix:semicolon
)brace
r_return
id|rt
suffix:semicolon
)brace
DECL|function|rt6_get_dflt_router
r_struct
id|rt6_info
op_star
id|rt6_get_dflt_router
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;rt6_get_dflt_router(%p,%p)[%p]&quot;
comma
id|addr
comma
id|dev
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
macro_line|#if RT6_DEBUG &gt;= 3
(brace
r_int
id|i
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;addr[&quot;
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;%04x%c&quot;
comma
id|addr-&gt;s6_addr16
(braket
id|i
)braket
comma
id|i
op_eq
l_int|7
ques
c_cond
l_char|&squot;]&squot;
suffix:colon
l_char|&squot;:&squot;
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|RDBG
c_func
(paren
(paren
l_string|&quot;&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|rt6_lock
c_func
(paren
)paren
suffix:semicolon
id|fn
op_assign
op_amp
id|ip6_routing_table
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.next
)paren
(brace
r_if
c_cond
(paren
id|dev
op_eq
id|rt-&gt;rt6i_dev
op_logical_and
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst.addr
comma
id|addr
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|rt6_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
DECL|function|rt6_add_dflt_router
r_struct
id|rt6_info
op_star
id|rt6_add_dflt_router
c_func
(paren
r_struct
id|in6_addr
op_star
id|gwaddr
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|err
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;rt6_add_dflt_router(%p,%p)[%p] &quot;
comma
id|gwaddr
comma
id|dev
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
macro_line|#if RT6_DEBUG &gt;= 3
(brace
r_struct
id|in6_addr
op_star
id|addr
op_assign
id|gwaddr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;gwaddr[&quot;
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;%04x%c&quot;
comma
id|addr-&gt;s6_addr16
(braket
id|i
)braket
comma
id|i
op_eq
l_int|7
ques
c_cond
l_char|&squot;]&squot;
suffix:colon
l_char|&squot;:&squot;
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|RDBG
c_func
(paren
(paren
l_string|&quot;&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|rtmsg
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
id|rtmsg.rtmsg_type
op_assign
id|RTMSG_NEWROUTE
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rtmsg.rtmsg_gateway
comma
id|gwaddr
)paren
suffix:semicolon
id|rtmsg.rtmsg_metric
op_assign
l_int|1024
suffix:semicolon
id|rtmsg.rtmsg_flags
op_assign
id|RTF_GATEWAY
op_or
id|RTF_ADDRCONF
op_or
id|RTF_DEFAULT
op_or
id|RTF_UP
suffix:semicolon
id|rtmsg.rtmsg_ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|rt
op_assign
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rt6_add_dflt: ip6_route_add error %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
)brace
r_return
id|rt
suffix:semicolon
)brace
DECL|function|rt6_purge_dflt_routers
r_void
id|rt6_purge_dflt_routers
c_func
(paren
r_int
id|last_resort
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
id|u32
id|flags
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;rt6_purge_dflt_routers(%d)[%p]&bslash;n&quot;
comma
id|last_resort
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|fn
op_assign
op_amp
id|ip6_routing_table
suffix:semicolon
id|rt6_dflt_pointer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|last_resort
)paren
id|flags
op_assign
id|RTF_ALLONLINK
suffix:semicolon
r_else
id|flags
op_assign
id|RTF_DEFAULT
op_or
id|RTF_ADDRCONF
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
(paren
id|rt-&gt;rt6i_flags
op_amp
id|flags
)paren
)paren
(brace
r_struct
id|rt6_info
op_star
id|drt
suffix:semicolon
macro_line|#if RT6_DEBUG &gt;= 2
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rt6_purge_dflt: deleting entry&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|drt
op_assign
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.next
suffix:semicolon
id|ip6_del_rt
c_func
(paren
id|drt
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rt
op_assign
id|rt-&gt;u.next
suffix:semicolon
)brace
)brace
DECL|function|ipv6_route_ioctl
r_int
id|ipv6_route_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_int
id|err
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;ipv6_route_ioctl(%d,%p)&bslash;n&quot;
comma
id|cmd
comma
id|arg
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCADDRT
suffix:colon
multiline_comment|/* Add a route */
r_case
id|SIOCDELRT
suffix:colon
multiline_comment|/* Delete a route */
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|err
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|rtmsg
comma
id|arg
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCADDRT
suffix:colon
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
op_amp
id|err
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDELRT
suffix:colon
id|err
op_assign
id|ip6_route_del
c_func
(paren
op_amp
id|rtmsg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
id|rt6_sndrtmsg
c_func
(paren
op_amp
id|rtmsg
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Drop the packet on the floor&n; */
DECL|function|ip6_pkt_discard
r_int
id|ip6_pkt_discard
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|ipv6_statistics.Ip6OutNoRoutes
op_increment
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Add address&n; */
DECL|function|ip6_rt_addr_add
r_int
id|ip6_rt_addr_add
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;ip6_rt_addr_add(%p,%p)[%p]&bslash;n&quot;
comma
id|addr
comma
id|dev
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
)paren
suffix:semicolon
macro_line|#if RT6_DEBUG &gt;= 3
(brace
r_int
id|i
suffix:semicolon
id|RDBG
c_func
(paren
(paren
l_string|&quot;addr[&quot;
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|RDBG
c_func
(paren
(paren
l_string|&quot;%04x%c&quot;
comma
id|addr-&gt;s6_addr16
(braket
id|i
)braket
comma
id|i
op_eq
l_int|7
ques
c_cond
l_char|&squot;]&squot;
suffix:colon
l_char|&squot;:&squot;
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|RDBG
c_func
(paren
(paren
l_string|&quot;&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|rt
op_assign
id|dst_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_info
)paren
comma
op_amp
id|ip6_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|rt
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rt6_info
)paren
)paren
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|ip6_input
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|dev_queue_xmit
suffix:semicolon
id|rt-&gt;rt6i_dev
op_assign
id|dev_get
c_func
(paren
l_string|&quot;lo&quot;
)paren
suffix:semicolon
id|rt-&gt;u.dst.pmtu
op_assign
id|rt-&gt;rt6i_dev-&gt;mtu
suffix:semicolon
id|rt-&gt;rt6i_flags
op_assign
id|RTF_UP
op_or
id|RTF_NONEXTHOP
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt6i_dst.addr
comma
id|addr
)paren
suffix:semicolon
id|rt-&gt;rt6i_dst.plen
op_assign
l_int|128
suffix:semicolon
id|rt6_lock
c_func
(paren
)paren
suffix:semicolon
id|rt6_ins
c_func
(paren
id|rt
)paren
suffix:semicolon
id|rt6_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_RT6_POLICY
DECL|function|rt6_flow_match_in
r_static
r_int
id|rt6_flow_match_in
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|flow_filter
op_star
id|frule
suffix:semicolon
r_struct
id|pkt_filter
op_star
id|filter
suffix:semicolon
r_int
id|res
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|frule
op_assign
id|rt-&gt;rt6i_filter
)paren
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|frule-&gt;type
op_ne
id|FLR_INPUT
)paren
(brace
id|res
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_for
c_loop
(paren
id|filter
op_assign
id|frule-&gt;u.filter
suffix:semicolon
id|filter
suffix:semicolon
id|filter
op_assign
id|filter-&gt;next
)paren
(brace
id|__u32
op_star
id|word
suffix:semicolon
id|word
op_assign
(paren
id|__u32
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
id|word
op_add_assign
id|filter-&gt;offset
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|word
op_xor
id|filter-&gt;value
)paren
op_amp
id|filter-&gt;mask
)paren
(brace
id|res
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|out
suffix:colon
r_return
id|res
suffix:semicolon
)brace
DECL|function|rt6_flow_match_out
r_static
r_int
id|rt6_flow_match_out
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|flow_filter
op_star
id|frule
suffix:semicolon
r_int
id|res
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|frule
op_assign
id|rt-&gt;rt6i_filter
)paren
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|frule-&gt;type
op_ne
id|FLR_INPUT
)paren
(brace
id|res
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|frule-&gt;u.sk
op_ne
id|sk
)paren
id|res
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|res
suffix:semicolon
)brace
DECL|function|rt6_flow_lookup
r_static
r_struct
id|rt6_info
op_star
id|rt6_flow_lookup
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|fl_acc_args
op_star
id|args
)paren
(brace
r_struct
id|flow_rule
op_star
id|frule
suffix:semicolon
r_struct
id|rt6_info
op_star
id|nrt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|pol_chain
op_star
id|pol
suffix:semicolon
r_for
c_loop
(paren
id|pol
op_assign
id|rt6_pol_list
suffix:semicolon
id|pol
suffix:semicolon
id|pol
op_assign
id|pol-&gt;next
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_struct
id|rt6_info
op_star
id|sprt
suffix:semicolon
id|fn
op_assign
id|fib6_lookup
c_func
(paren
id|pol-&gt;rules
comma
id|daddr
comma
id|saddr
)paren
suffix:semicolon
r_do
(brace
r_for
c_loop
(paren
id|sprt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|sprt
suffix:semicolon
id|sprt
op_assign
id|sprt-&gt;u.next
)paren
(brace
r_int
id|res
suffix:semicolon
id|frule
op_assign
id|sprt-&gt;rt6i_flowr
suffix:semicolon
macro_line|#if RT6_DEBUG &gt;= 2
r_if
c_cond
(paren
id|frule
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;NULL flowr&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
macro_line|#endif
id|res
op_assign
id|frule-&gt;ops
op_member_access_from_pointer
id|accept
c_func
(paren
id|rt
comma
id|sprt
comma
id|args
comma
op_amp
id|nrt
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|res
)paren
(brace
r_case
id|FLOWR_SELECT
suffix:colon
r_goto
id|found
suffix:semicolon
r_case
id|FLOWR_CLEAR
suffix:colon
r_goto
id|next_policy
suffix:semicolon
r_case
id|FLOWR_NODECISION
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|error
suffix:semicolon
)brace
suffix:semicolon
)brace
id|fn
op_assign
id|fn-&gt;parent
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_TL_ROOT
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|next_policy
suffix:colon
)brace
id|error
suffix:colon
r_return
op_amp
id|ip6_null_entry
suffix:semicolon
id|found
suffix:colon
r_if
c_cond
(paren
id|nrt
op_eq
l_int|NULL
)paren
r_goto
id|error
suffix:semicolon
id|nrt-&gt;rt6i_flags
op_or_assign
id|RTF_CACHE
suffix:semicolon
id|rt6_ins
c_func
(paren
id|nrt
)paren
suffix:semicolon
r_return
id|nrt
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *&t;/proc&n; */
macro_line|#ifdef CONFIG_PROC_FS
DECL|macro|RT6_INFO_LEN
mdefine_line|#define RT6_INFO_LEN (32 + 4 + 32 + 4 + 32 + 40 + 5 + 1)
DECL|struct|rt6_proc_arg
r_struct
id|rt6_proc_arg
(brace
DECL|member|buffer
r_char
op_star
id|buffer
suffix:semicolon
DECL|member|offset
r_int
id|offset
suffix:semicolon
DECL|member|length
r_int
id|length
suffix:semicolon
DECL|member|skip
r_int
id|skip
suffix:semicolon
DECL|member|len
r_int
id|len
suffix:semicolon
)brace
suffix:semicolon
DECL|function|rt6_info_node
r_static
r_void
id|rt6_info_node
c_func
(paren
r_struct
id|fib6_node
op_star
id|fn
comma
r_void
op_star
id|p_arg
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|rt6_proc_arg
op_star
id|arg
op_assign
(paren
r_struct
id|rt6_proc_arg
op_star
)paren
id|p_arg
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.next
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|arg-&gt;skip
OL
id|arg-&gt;offset
op_div
id|RT6_INFO_LEN
)paren
(brace
id|arg-&gt;skip
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|arg-&gt;len
op_ge
id|arg-&gt;length
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%02x&quot;
comma
id|rt-&gt;rt6i_dst.addr.s6_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|2
suffix:semicolon
)brace
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot; %02x &quot;
comma
id|rt-&gt;rt6i_dst.plen
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%02x&quot;
comma
id|rt-&gt;rt6i_src.addr.s6_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|2
suffix:semicolon
)brace
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot; %02x &quot;
comma
id|rt-&gt;rt6i_src.plen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_nexthop
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|nd_neigh
op_star
id|ndn
suffix:semicolon
id|ndn
op_assign
(paren
r_struct
id|nd_neigh
op_star
)paren
id|rt-&gt;rt6i_nexthop
suffix:semicolon
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%02x&quot;
comma
id|ndn-&gt;ndn_addr.s6_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;00000000000000000000000000000000&quot;
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|32
suffix:semicolon
)brace
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot; %08lx %08x %08x %08lx %8s&bslash;n&quot;
comma
id|rt-&gt;rt6i_metric
comma
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;rt6i_use
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;rt6i_ref
)paren
comma
id|rt-&gt;rt6i_flags
comma
id|rt-&gt;rt6i_dev
ques
c_cond
id|rt-&gt;rt6i_dev-&gt;name
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|rt6_proc_info
r_static
r_int
id|rt6_proc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_struct
id|rt6_proc_arg
id|arg
suffix:semicolon
id|arg.buffer
op_assign
id|buffer
suffix:semicolon
id|arg.offset
op_assign
id|offset
suffix:semicolon
id|arg.length
op_assign
id|length
suffix:semicolon
id|arg.skip
op_assign
l_int|0
suffix:semicolon
id|arg.len
op_assign
l_int|0
suffix:semicolon
id|fib6_walk_tree
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|rt6_info_node
comma
op_amp
id|arg
comma
id|RT6_FILTER_RTNODES
)paren
suffix:semicolon
id|rt6_info_node
c_func
(paren
op_amp
id|ip6_routing_table
comma
op_amp
id|arg
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
suffix:semicolon
r_if
c_cond
(paren
id|offset
)paren
op_star
id|start
op_add_assign
id|offset
op_mod
id|RT6_INFO_LEN
suffix:semicolon
id|arg.len
op_sub_assign
id|offset
op_mod
id|RT6_INFO_LEN
suffix:semicolon
r_if
c_cond
(paren
id|arg.len
OG
id|length
)paren
(brace
id|arg.len
op_assign
id|length
suffix:semicolon
)brace
r_if
c_cond
(paren
id|arg.len
OL
l_int|0
)paren
(brace
id|arg.len
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|arg.len
suffix:semicolon
)brace
DECL|macro|PTR_SZ
mdefine_line|#define PTR_SZ (sizeof(void *) * 2)
DECL|macro|FI_LINE_SZ
mdefine_line|#define FI_LINE_SZ (2 * (PTR_SZ) + 7 + 32 + 4 + 32 + 4)
DECL|function|rt6_tree_node
r_static
r_void
id|rt6_tree_node
c_func
(paren
r_struct
id|fib6_node
op_star
id|fn
comma
r_void
op_star
id|p_arg
)paren
(brace
r_struct
id|rt6_proc_arg
op_star
id|arg
op_assign
(paren
r_struct
id|rt6_proc_arg
op_star
)paren
id|p_arg
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_char
id|f
suffix:semicolon
r_int
id|i
suffix:semicolon
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
r_if
c_cond
(paren
id|arg-&gt;skip
OL
id|arg-&gt;offset
op_div
id|FI_LINE_SZ
)paren
(brace
id|arg-&gt;skip
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|arg-&gt;len
op_plus
id|FI_LINE_SZ
op_ge
id|arg-&gt;length
)paren
r_return
suffix:semicolon
id|f
op_assign
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_RTINFO
)paren
ques
c_cond
l_char|&squot;r&squot;
suffix:colon
l_char|&squot;n&squot;
suffix:semicolon
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%p %p %02x %c &quot;
comma
id|fn
comma
id|fn-&gt;parent
comma
id|fn-&gt;fn_bit
comma
id|f
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%02x&quot;
comma
id|rt-&gt;rt6i_dst.addr.s6_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|2
suffix:semicolon
)brace
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot; %02x &quot;
comma
id|rt-&gt;rt6i_dst.plen
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%02x&quot;
comma
id|rt-&gt;rt6i_src.addr.s6_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|2
suffix:semicolon
)brace
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot; %02x&bslash;n&quot;
comma
id|rt-&gt;rt6i_src.plen
)paren
suffix:semicolon
)brace
DECL|function|rt6_proc_tree
r_static
r_int
id|rt6_proc_tree
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_struct
id|rt6_proc_arg
id|arg
suffix:semicolon
id|arg.buffer
op_assign
id|buffer
suffix:semicolon
id|arg.offset
op_assign
id|offset
suffix:semicolon
id|arg.length
op_assign
id|length
suffix:semicolon
id|arg.skip
op_assign
l_int|0
suffix:semicolon
id|arg.len
op_assign
l_int|0
suffix:semicolon
id|fib6_walk_tree
c_func
(paren
op_amp
id|ip6_routing_table
comma
id|rt6_tree_node
comma
op_amp
id|arg
comma
l_int|0
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
suffix:semicolon
r_if
c_cond
(paren
id|offset
)paren
op_star
id|start
op_add_assign
id|offset
op_mod
id|RT6_INFO_LEN
suffix:semicolon
id|arg.len
op_sub_assign
id|offset
op_mod
id|RT6_INFO_LEN
suffix:semicolon
r_if
c_cond
(paren
id|arg.len
OG
id|length
)paren
(brace
id|arg.len
op_assign
id|length
suffix:semicolon
)brace
r_if
c_cond
(paren
id|arg.len
OL
l_int|0
)paren
(brace
id|arg.len
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|arg.len
suffix:semicolon
)brace
r_extern
r_struct
id|rt6_statistics
id|rt6_stats
suffix:semicolon
DECL|function|rt6_proc_stats
r_static
r_int
id|rt6_proc_stats
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_int
id|len
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04x %04x %04x %04x %04x&bslash;n&quot;
comma
id|rt6_stats.fib_nodes
comma
id|rt6_stats.fib_route_nodes
comma
id|rt6_stats.fib_rt_alloc
comma
id|rt6_stats.fib_rt_entries
comma
id|rt6_stats.fib_rt_cache
)paren
suffix:semicolon
id|len
op_sub_assign
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|variable|proc_rt6_info
r_static
r_struct
id|proc_dir_entry
id|proc_rt6_info
op_assign
(brace
id|PROC_NET_RT6
comma
l_int|10
comma
l_string|&quot;ipv6_route&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|rt6_proc_info
)brace
suffix:semicolon
DECL|variable|proc_rt6_stats
r_static
r_struct
id|proc_dir_entry
id|proc_rt6_stats
op_assign
(brace
id|PROC_NET_RT6_STATS
comma
l_int|9
comma
l_string|&quot;rt6_stats&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|rt6_proc_stats
)brace
suffix:semicolon
DECL|variable|proc_rt6_tree
r_static
r_struct
id|proc_dir_entry
id|proc_rt6_tree
op_assign
(brace
id|PROC_NET_RT6_TREE
comma
l_int|7
comma
l_string|&quot;ip6_fib&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|rt6_proc_tree
)brace
suffix:semicolon
macro_line|#endif&t;/* CONFIG_PROC_FS */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|ip6_route_init
c_func
(paren
r_void
)paren
)paren
(brace
macro_line|#ifdef &t;CONFIG_PROC_FS
id|proc_net_register
c_func
(paren
op_amp
id|proc_rt6_info
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
id|proc_rt6_stats
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
id|proc_rt6_tree
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_NETLINK
id|netlink_attach
c_func
(paren
id|NETLINK_ROUTE6
comma
id|rt6_msgrcv
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef MODULE
DECL|function|ip6_route_cleanup
r_void
id|ip6_route_cleanup
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_unregister
c_func
(paren
id|PROC_NET_RT6
)paren
suffix:semicolon
id|proc_net_unregister
c_func
(paren
id|PROC_NET_RT6_TREE
)paren
suffix:semicolon
id|proc_net_unregister
c_func
(paren
id|PROC_NET_RT6_STATS
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_NETLINK
id|netlink_detach
c_func
(paren
id|NETLINK_ROUTE6
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if 0
id|fib6_flush
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif&t;/* MODULE */
eof
