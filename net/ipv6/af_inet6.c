multiline_comment|/*&n; *&t;AF_INET6 socket family&n; *&t;Linux INET6 implementation &n; *&n; *&t;Authors:&n; *&t;Pedro Roque&t;&t;&lt;roque@di.fc.ul.pt&gt;&t;&n; *&n; *&t;Adapted from linux/net/ipv4/af_inet.c&n; *&n; *&t;$Id: af_inet6.c,v 1.16 1997/03/18 18:24:26 davem Exp $&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/icmpv6.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/udp.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/sit.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/inet_common.h&gt;
macro_line|#include &lt;net/transp_v6.h&gt;
macro_line|#include &lt;net/ip6_route.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
r_extern
r_struct
id|proto_ops
id|inet6_stream_ops
suffix:semicolon
r_extern
r_struct
id|proto_ops
id|inet6_dgram_ops
suffix:semicolon
multiline_comment|/* IPv6 procfs goodies... */
macro_line|#ifdef CONFIG_PROC_FS
r_extern
r_int
id|raw6_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|tcp6_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|udp6_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|afinet6_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
macro_line|#endif
DECL|function|inet6_create
r_static
r_int
id|inet6_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|proto
op_star
id|prot
suffix:semicolon
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
r_goto
id|do_oom
suffix:semicolon
multiline_comment|/* Note for tcp that also wiped the dummy_th block for us. */
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_STREAM
op_logical_or
id|sock-&gt;type
op_eq
id|SOCK_SEQPACKET
)paren
(brace
r_if
c_cond
(paren
id|protocol
op_logical_and
id|protocol
op_ne
id|IPPROTO_TCP
)paren
r_goto
id|free_and_noproto
suffix:semicolon
id|protocol
op_assign
id|IPPROTO_TCP
suffix:semicolon
id|sk-&gt;no_check
op_assign
id|TCP_NO_CHECK
suffix:semicolon
id|prot
op_assign
op_amp
id|tcpv6_prot
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|inet6_stream_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_DGRAM
)paren
(brace
r_if
c_cond
(paren
id|protocol
op_logical_and
id|protocol
op_ne
id|IPPROTO_UDP
)paren
r_goto
id|free_and_noproto
suffix:semicolon
id|protocol
op_assign
id|IPPROTO_UDP
suffix:semicolon
id|sk-&gt;no_check
op_assign
id|UDP_NO_CHECK
suffix:semicolon
id|prot
op_assign
op_amp
id|udpv6_prot
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|inet6_dgram_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_RAW
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_goto
id|free_and_badperm
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|protocol
)paren
r_goto
id|free_and_noproto
suffix:semicolon
id|prot
op_assign
op_amp
id|rawv6_prot
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|inet6_dgram_ops
suffix:semicolon
id|sk-&gt;reuse
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;num
op_assign
id|protocol
suffix:semicolon
)brace
r_else
(brace
r_goto
id|free_and_badtype
suffix:semicolon
)brace
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk-&gt;zapped
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;family
op_assign
id|AF_INET6
suffix:semicolon
id|sk-&gt;protocol
op_assign
id|protocol
suffix:semicolon
id|sk-&gt;prot
op_assign
id|prot
suffix:semicolon
id|sk-&gt;backlog_rcv
op_assign
id|prot-&gt;backlog_rcv
suffix:semicolon
id|sk-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|sk
suffix:semicolon
id|sk-&gt;timer.function
op_assign
op_amp
id|net_timer
suffix:semicolon
id|sk-&gt;net_pinfo.af_inet6.hop_limit
op_assign
id|ipv6_config.hop_limit
suffix:semicolon
id|sk-&gt;net_pinfo.af_inet6.mcast_hops
op_assign
id|IPV6_DEFAULT_MCASTHOPS
suffix:semicolon
id|sk-&gt;net_pinfo.af_inet6.mc_loop
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Init the ipv4 part of the socket since we can have sockets&n;&t; * using v6 API for ipv4.&n;&t; */
id|sk-&gt;ip_ttl
op_assign
l_int|64
suffix:semicolon
id|sk-&gt;ip_mc_loop
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;ip_mc_ttl
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;ip_mc_index
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;ip_mc_list
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_RAW
op_logical_and
id|protocol
op_eq
id|IPPROTO_RAW
)paren
id|sk-&gt;ip_hdrincl
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;num
)paren
(brace
multiline_comment|/* It assumes that any protocol which allows&n;&t;&t; * the user to assign a number at socket&n;&t;&t; * creation time automatically shares.&n;&t;&t; */
id|sk-&gt;dummy_th.source
op_assign
id|ntohs
c_func
(paren
id|sk-&gt;num
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;hash
)paren
(brace
id|sk-&gt;prot
op_member_access_from_pointer
id|hash
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|add_to_prot_sklist
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;init
)paren
(brace
r_int
id|err
op_assign
id|sk-&gt;prot
op_member_access_from_pointer
id|init
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
(brace
id|destroy_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|free_and_badtype
suffix:colon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
id|free_and_badperm
suffix:colon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
id|free_and_noproto
suffix:colon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
id|do_oom
suffix:colon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
DECL|function|inet6_dup
r_static
r_int
id|inet6_dup
c_func
(paren
r_struct
id|socket
op_star
id|newsock
comma
r_struct
id|socket
op_star
id|oldsock
)paren
(brace
r_return
id|inet6_create
c_func
(paren
id|newsock
comma
id|oldsock-&gt;sk-&gt;protocol
)paren
suffix:semicolon
)brace
multiline_comment|/* bind for INET6 API */
DECL|function|inet6_bind
r_static
r_int
id|inet6_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sockaddr_in6
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|__u32
id|v4addr
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|snum
op_assign
l_int|0
suffix:semicolon
r_int
id|addr_type
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* If the socket has its own bind function then use it. */
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;bind
)paren
(brace
r_return
id|sk-&gt;prot
op_member_access_from_pointer
id|bind
c_func
(paren
id|sk
comma
id|uaddr
comma
id|addr_len
)paren
suffix:semicolon
)brace
multiline_comment|/* Check these errors (active socket, bad address length, double bind). */
r_if
c_cond
(paren
(paren
id|sk-&gt;state
op_ne
id|TCP_CLOSE
)paren
op_logical_or
(paren
id|addr_len
OL
r_sizeof
(paren
r_struct
id|sockaddr_in6
)paren
)paren
op_logical_or
(paren
id|sk-&gt;num
op_ne
l_int|0
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|snum
op_assign
id|ntohs
c_func
(paren
id|addr-&gt;sin6_port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snum
op_eq
l_int|0
)paren
id|snum
op_assign
id|sk-&gt;prot
op_member_access_from_pointer
id|good_socknum
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snum
OL
id|PROT_SOCK
op_logical_and
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
op_amp
id|addr-&gt;sin6_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|addr_type
op_amp
id|IPV6_ADDR_MULTICAST
)paren
op_logical_and
id|sock-&gt;type
op_eq
id|SOCK_STREAM
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Check if the address belongs to the host. */
r_if
c_cond
(paren
id|addr_type
op_eq
id|IPV6_ADDR_MAPPED
)paren
(brace
id|v4addr
op_assign
id|addr-&gt;sin6_addr.s6_addr32
(braket
l_int|3
)braket
suffix:semicolon
r_if
c_cond
(paren
id|__ip_chk_addr
c_func
(paren
id|v4addr
)paren
op_ne
id|IS_MYADDR
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|addr_type
op_ne
id|IPV6_ADDR_ANY
)paren
(brace
multiline_comment|/* ipv4 addr of the socket is invalid.  Only the&n;&t;&t;&t; * unpecified and mapped address have a v4 equivalent.&n;&t;&t;&t; */
id|v4addr
op_assign
id|LOOPBACK4_IPV6
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|addr_type
op_amp
id|IPV6_ADDR_MULTICAST
)paren
)paren
(brace
r_if
c_cond
(paren
id|ipv6_chk_addr
c_func
(paren
op_amp
id|addr-&gt;sin6_addr
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
)brace
)brace
id|sk-&gt;rcv_saddr
op_assign
id|v4addr
suffix:semicolon
id|sk-&gt;saddr
op_assign
id|v4addr
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sk-&gt;net_pinfo.af_inet6.rcv_saddr
comma
op_amp
id|addr-&gt;sin6_addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|addr_type
op_amp
id|IPV6_ADDR_MULTICAST
)paren
)paren
id|memcpy
c_func
(paren
op_amp
id|sk-&gt;net_pinfo.af_inet6.saddr
comma
op_amp
id|addr-&gt;sin6_addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
multiline_comment|/* Make sure we are allowed to bind here. */
r_if
c_cond
(paren
id|sk-&gt;prot
op_member_access_from_pointer
id|verify_bind
c_func
(paren
id|sk
comma
id|snum
)paren
)paren
(brace
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
id|sk-&gt;num
op_assign
id|snum
suffix:semicolon
id|sk-&gt;dummy_th.source
op_assign
id|ntohs
c_func
(paren
id|sk-&gt;num
)paren
suffix:semicolon
id|sk-&gt;dummy_th.dest
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;daddr
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;prot
op_member_access_from_pointer
id|rehash
c_func
(paren
id|sk
)paren
suffix:semicolon
id|add_to_prot_sklist
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|inet6_release
r_static
r_int
id|inet6_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|peer
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|inet_release
c_func
(paren
id|sock
comma
id|peer
)paren
suffix:semicolon
)brace
DECL|function|inet6_socketpair
r_static
r_int
id|inet6_socketpair
c_func
(paren
r_struct
id|socket
op_star
id|sock1
comma
r_struct
id|socket
op_star
id|sock2
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This does both peername and sockname.&n; */
DECL|function|inet6_getname
r_static
r_int
id|inet6_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddr_len
comma
r_int
id|peer
)paren
(brace
r_struct
id|sockaddr_in6
op_star
id|sin
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|sin-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|tcp_connected
c_func
(paren
id|sk-&gt;state
)paren
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|sin-&gt;sin6_port
op_assign
id|sk-&gt;dummy_th.dest
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin-&gt;sin6_addr
comma
op_amp
id|sk-&gt;net_pinfo.af_inet6.daddr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ipv6_addr_type
c_func
(paren
op_amp
id|sk-&gt;net_pinfo.af_inet6.rcv_saddr
)paren
op_eq
id|IPV6_ADDR_ANY
)paren
id|memcpy
c_func
(paren
op_amp
id|sin-&gt;sin6_addr
comma
op_amp
id|sk-&gt;net_pinfo.af_inet6.saddr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
op_amp
id|sin-&gt;sin6_addr
comma
op_amp
id|sk-&gt;net_pinfo.af_inet6.rcv_saddr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin-&gt;sin6_port
op_assign
id|sk-&gt;dummy_th.source
suffix:semicolon
)brace
op_star
id|uaddr_len
op_assign
r_sizeof
(paren
op_star
id|sin
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|inet6_ioctl
r_static
r_int
id|inet6_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|pid
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FIOSETOWN
suffix:colon
r_case
id|SIOCSPGRP
suffix:colon
id|err
op_assign
id|get_user
c_func
(paren
id|pid
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* see sock_no_fcntl */
r_if
c_cond
(paren
id|current-&gt;pid
op_ne
id|pid
op_logical_and
id|current-&gt;pgrp
op_ne
op_minus
id|pid
op_logical_and
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sk-&gt;proc
op_assign
id|pid
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FIOGETOWN
suffix:colon
r_case
id|SIOCGPGRP
suffix:colon
id|err
op_assign
id|put_user
c_func
(paren
id|sk-&gt;proc
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCGSTAMP
suffix:colon
r_if
c_cond
(paren
id|sk-&gt;stamp.tv_sec
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|err
op_assign
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|sk-&gt;stamp
comma
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCADDRT
suffix:colon
r_case
id|SIOCDELRT
suffix:colon
r_return
id|ipv6_route_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCGIFCONF
suffix:colon
r_case
id|SIOCGIFFLAGS
suffix:colon
r_case
id|SIOCSIFFLAGS
suffix:colon
r_case
id|SIOCADDMULTI
suffix:colon
r_case
id|SIOCDELMULTI
suffix:colon
multiline_comment|/*&n;&n;  this ioctls deal with addresses&n;  must process the addr info before&n;  calling dev_ioctl to perform dev specific functions&n;&n;&t;case SIOCGIFADDR:&n;&t;case SIOCSIFADDR:&n;&n;&n;&t;case SIOCGIFDSTADDR:&n;&n;&t;case SIOCGIFBRDADDR:&n;&t;case SIOCSIFBRDADDR:&n;&t;case SIOCGIFNETMASK:&n;&t;case SIOCSIFNETMASK:&n;&t;*/
r_case
id|SIOCGIFMETRIC
suffix:colon
r_case
id|SIOCSIFMETRIC
suffix:colon
r_case
id|SIOCGIFMEM
suffix:colon
r_case
id|SIOCSIFMEM
suffix:colon
r_case
id|SIOCGIFMTU
suffix:colon
r_case
id|SIOCSIFMTU
suffix:colon
r_case
id|SIOCSIFLINK
suffix:colon
r_case
id|SIOCGIFHWADDR
suffix:colon
r_case
id|SIOCSIFHWADDR
suffix:colon
r_case
id|SIOCSIFMAP
suffix:colon
r_case
id|SIOCGIFMAP
suffix:colon
r_case
id|SIOCSIFSLAVE
suffix:colon
r_case
id|SIOCGIFSLAVE
suffix:colon
r_case
id|SIOGIFINDEX
suffix:colon
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCSIFADDR
suffix:colon
r_return
id|addrconf_add_ifaddr
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCSIFDSTADDR
suffix:colon
r_return
id|addrconf_set_dstaddr
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|cmd
op_ge
id|SIOCDEVPRIVATE
)paren
op_logical_and
(paren
id|cmd
op_le
(paren
id|SIOCDEVPRIVATE
op_plus
l_int|15
)paren
)paren
)paren
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;ioctl
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|sk-&gt;prot
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|sk
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
multiline_comment|/*NOTREACHED*/
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|inet6_stream_ops
r_struct
id|proto_ops
id|inet6_stream_ops
op_assign
(brace
id|AF_INET6
comma
id|inet6_dup
comma
id|inet6_release
comma
id|inet6_bind
comma
id|inet_stream_connect
comma
multiline_comment|/* ok&t;&t;*/
id|inet6_socketpair
comma
multiline_comment|/* a do nothing&t;*/
id|inet_accept
comma
multiline_comment|/* ok&t;&t;*/
id|inet6_getname
comma
id|inet_poll
comma
multiline_comment|/* ok&t;&t;*/
id|inet6_ioctl
comma
multiline_comment|/* must change  */
id|inet_listen
comma
multiline_comment|/* ok&t;&t;*/
id|inet_shutdown
comma
multiline_comment|/* ok&t;&t;*/
id|inet_setsockopt
comma
multiline_comment|/* ok&t;&t;*/
id|inet_getsockopt
comma
multiline_comment|/* ok&t;&t;*/
id|sock_no_fcntl
comma
multiline_comment|/* ok&t;&t;*/
id|inet_sendmsg
comma
multiline_comment|/* ok&t;&t;*/
id|inet_recvmsg
multiline_comment|/* ok&t;&t;*/
)brace
suffix:semicolon
DECL|variable|inet6_dgram_ops
r_struct
id|proto_ops
id|inet6_dgram_ops
op_assign
(brace
id|AF_INET6
comma
id|inet6_dup
comma
id|inet6_release
comma
id|inet6_bind
comma
id|inet_dgram_connect
comma
multiline_comment|/* ok&t;&t;*/
id|inet6_socketpair
comma
multiline_comment|/* a do nothing&t;*/
id|inet_accept
comma
multiline_comment|/* ok&t;&t;*/
id|inet6_getname
comma
id|datagram_poll
comma
multiline_comment|/* ok&t;&t;*/
id|inet6_ioctl
comma
multiline_comment|/* must change  */
id|sock_no_listen
comma
multiline_comment|/* ok&t;&t;*/
id|inet_shutdown
comma
multiline_comment|/* ok&t;&t;*/
id|inet_setsockopt
comma
multiline_comment|/* ok&t;&t;*/
id|inet_getsockopt
comma
multiline_comment|/* ok&t;&t;*/
id|sock_no_fcntl
comma
multiline_comment|/* ok&t;&t;*/
id|inet_sendmsg
comma
multiline_comment|/* ok&t;&t;*/
id|inet_recvmsg
multiline_comment|/* ok&t;&t;*/
)brace
suffix:semicolon
DECL|variable|inet6_family_ops
r_struct
id|net_proto_family
id|inet6_family_ops
op_assign
(brace
id|AF_INET6
comma
id|inet6_create
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
DECL|variable|proc_net_raw6
r_static
r_struct
id|proc_dir_entry
id|proc_net_raw6
op_assign
(brace
id|PROC_NET_RAW6
comma
l_int|4
comma
l_string|&quot;raw6&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|raw6_get_info
)brace
suffix:semicolon
DECL|variable|proc_net_tcp6
r_static
r_struct
id|proc_dir_entry
id|proc_net_tcp6
op_assign
(brace
id|PROC_NET_TCP6
comma
l_int|4
comma
l_string|&quot;tcp6&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|tcp6_get_info
)brace
suffix:semicolon
DECL|variable|proc_net_udp6
r_static
r_struct
id|proc_dir_entry
id|proc_net_udp6
op_assign
(brace
id|PROC_NET_RAW6
comma
l_int|4
comma
l_string|&quot;udp6&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|udp6_get_info
)brace
suffix:semicolon
DECL|variable|proc_net_sockstat6
r_static
r_struct
id|proc_dir_entry
id|proc_net_sockstat6
op_assign
(brace
id|PROC_NET_SOCKSTAT6
comma
l_int|9
comma
l_string|&quot;sockstat6&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|afinet6_get_info
)brace
suffix:semicolon
macro_line|#endif&t;/* CONFIG_PROC_FS */
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
macro_line|#else
r_void
id|inet6_proto_init
c_func
(paren
r_struct
id|net_proto
op_star
id|pro
)paren
macro_line|#endif
(brace
r_struct
id|sk_buff
op_star
id|dummy_skb
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;IPv6 v0.2 for NET3.037&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|ipv6_options
)paren
OG
r_sizeof
(paren
id|dummy_skb-&gt;cb
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;inet6_proto_init: size fault&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef MODULE
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#else
r_return
suffix:semicolon
macro_line|#endif
)brace
(paren
r_void
)paren
id|sock_register
c_func
(paren
op_amp
id|inet6_family_ops
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;ipngwg API draft makes clear that the correct semantics&n;&t; *&t;for TCP and UDP is to consider one TCP and UDP instance&n;&t; *&t;in a host availiable by both INET and INET6 APIs and&n;&t; *&t;able to communicate via both network protocols.&n;&t; */
id|ipv6_init
c_func
(paren
)paren
suffix:semicolon
id|icmpv6_init
c_func
(paren
op_amp
id|inet6_family_ops
)paren
suffix:semicolon
id|addrconf_init
c_func
(paren
)paren
suffix:semicolon
id|sit_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* init v6 transport protocols */
id|udpv6_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* add /proc entries here */
id|tcpv6_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Create /proc/foo6 entries. */
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_raw6
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_tcp6
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_udp6
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_sockstat6
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef MODULE
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef MODULE
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|sit_cleanup
c_func
(paren
)paren
suffix:semicolon
id|ipv6_cleanup
c_func
(paren
)paren
suffix:semicolon
id|sock_unregister
c_func
(paren
id|AF_INET6
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_unregister
c_func
(paren
id|proc_net_raw6.low_ino
)paren
suffix:semicolon
id|proc_net_unregister
c_func
(paren
id|proc_net_tcp6.low_ino
)paren
suffix:semicolon
id|proc_net_unregister
c_func
(paren
id|proc_net_udp6.low_ino
)paren
suffix:semicolon
id|proc_net_unregister
c_func
(paren
id|proc_net_sockstat6.low_ino
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif&t;/* MODULE */
eof
