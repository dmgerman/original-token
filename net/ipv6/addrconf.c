multiline_comment|/*&n; *&t;IPv6 Address [auto]configuration&n; *&t;Linux INET6 implementation&n; *&n; *&t;Authors:&n; *&t;Pedro Roque&t;&t;&lt;roque@di.fc.ul.pt&gt;&t;&n; *&n; *&t;$Id: addrconf.c,v 1.18 1997/04/16 05:58:03 davem Exp $&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
multiline_comment|/*&n; *&t;Changes:&n; *&n; *&t;Janos Farkas&t;&t;&t;:&t;delete timer on ifdown&n; *&t;&lt;chexum@bankinf.banki.hu&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/snmp.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/ndisc.h&gt;
macro_line|#include &lt;net/ip6_route.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;net/sit.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
multiline_comment|/* Set to 3 to get tracing... */
DECL|macro|ACONF_DEBUG
mdefine_line|#define ACONF_DEBUG 2
macro_line|#if ACONF_DEBUG &gt;= 3
DECL|macro|ADBG
mdefine_line|#define ADBG(x) printk x
macro_line|#else
DECL|macro|ADBG
mdefine_line|#define ADBG(x)
macro_line|#endif
multiline_comment|/*&n; *&t;Configured unicast address list&n; */
DECL|variable|inet6_addr_lst
r_struct
id|inet6_ifaddr
op_star
id|inet6_addr_lst
(braket
id|IN6_ADDR_HSIZE
)braket
suffix:semicolon
multiline_comment|/*&n; *&t;Hash list of configured multicast addresses&n; */
DECL|variable|inet6_mcast_lst
r_struct
id|ifmcaddr6
op_star
id|inet6_mcast_lst
(braket
id|IN6_ADDR_HSIZE
)braket
suffix:semicolon
multiline_comment|/*&n; *&t;AF_INET6 device list&n; */
DECL|variable|inet6_dev_lst
r_struct
id|inet6_dev
op_star
id|inet6_dev_lst
(braket
id|IN6_ADDR_HSIZE
)braket
suffix:semicolon
DECL|variable|addr_list_lock
r_static
id|atomic_t
id|addr_list_lock
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_void
id|addrconf_verify
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
DECL|variable|addr_chk_timer
r_static
r_struct
id|timer_list
id|addr_chk_timer
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
id|addrconf_verify
)brace
suffix:semicolon
r_static
r_int
id|addrconf_ifdown
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|addrconf_dad_start
c_func
(paren
r_struct
id|inet6_ifaddr
op_star
id|ifp
)paren
suffix:semicolon
r_static
r_void
id|addrconf_dad_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|addrconf_dad_completed
c_func
(paren
r_struct
id|inet6_ifaddr
op_star
id|ifp
)paren
suffix:semicolon
r_static
r_void
id|addrconf_rs_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
DECL|function|ipv6_addr_type
r_int
id|ipv6_addr_type
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
id|u32
id|st
suffix:semicolon
id|st
op_assign
id|addr-&gt;s6_addr32
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* &n;&t; * UCast Provider Based Address&n;&t; * 0x4/3&n;&t; */
r_if
c_cond
(paren
(paren
id|st
op_amp
id|__constant_htonl
c_func
(paren
l_int|0xE0000000
)paren
)paren
op_eq
id|__constant_htonl
c_func
(paren
l_int|0x40000000
)paren
)paren
r_return
id|IPV6_ADDR_UNICAST
suffix:semicolon
r_if
c_cond
(paren
(paren
id|st
op_amp
id|__constant_htonl
c_func
(paren
l_int|0xFF000000
)paren
)paren
op_eq
id|__constant_htonl
c_func
(paren
l_int|0xFF000000
)paren
)paren
(brace
r_int
id|type
op_assign
id|IPV6_ADDR_MULTICAST
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|st
op_amp
id|__constant_htonl
c_func
(paren
l_int|0x00FF0000
)paren
)paren
)paren
(brace
r_case
id|__constant_htonl
c_func
(paren
l_int|0x00010000
)paren
suffix:colon
id|type
op_or_assign
id|IPV6_ADDR_LOOPBACK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|__constant_htonl
c_func
(paren
l_int|0x00020000
)paren
suffix:colon
id|type
op_or_assign
id|IPV6_ADDR_LINKLOCAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|__constant_htonl
c_func
(paren
l_int|0x00050000
)paren
suffix:colon
id|type
op_or_assign
id|IPV6_ADDR_SITELOCAL
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
id|type
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|st
op_amp
id|__constant_htonl
c_func
(paren
l_int|0xFFC00000
)paren
)paren
op_eq
id|__constant_htonl
c_func
(paren
l_int|0xFE800000
)paren
)paren
r_return
(paren
id|IPV6_ADDR_LINKLOCAL
op_or
id|IPV6_ADDR_UNICAST
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|st
op_amp
id|__constant_htonl
c_func
(paren
l_int|0xFFC00000
)paren
)paren
op_eq
id|__constant_htonl
c_func
(paren
l_int|0xFEC00000
)paren
)paren
r_return
(paren
id|IPV6_ADDR_SITELOCAL
op_or
id|IPV6_ADDR_UNICAST
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|addr-&gt;s6_addr32
(braket
l_int|0
)braket
op_or
id|addr-&gt;s6_addr32
(braket
l_int|1
)braket
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|addr-&gt;s6_addr32
(braket
l_int|2
)braket
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|addr-&gt;in6_u.u6_addr32
(braket
l_int|3
)braket
op_eq
l_int|0
)paren
r_return
id|IPV6_ADDR_ANY
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;s6_addr32
(braket
l_int|3
)braket
op_eq
id|__constant_htonl
c_func
(paren
l_int|0x00000001
)paren
)paren
r_return
(paren
id|IPV6_ADDR_LOOPBACK
op_or
id|IPV6_ADDR_UNICAST
)paren
suffix:semicolon
r_return
(paren
id|IPV6_ADDR_COMPATv4
op_or
id|IPV6_ADDR_UNICAST
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr-&gt;s6_addr32
(braket
l_int|2
)braket
op_eq
id|__constant_htonl
c_func
(paren
l_int|0x0000ffff
)paren
)paren
r_return
id|IPV6_ADDR_MAPPED
suffix:semicolon
)brace
r_return
id|IPV6_ADDR_RESERVED
suffix:semicolon
)brace
DECL|function|ipv6_add_dev
r_static
r_struct
id|inet6_dev
op_star
id|ipv6_add_dev
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|inet6_dev
op_star
id|ndev
comma
op_star
op_star
id|bptr
comma
op_star
id|iter
suffix:semicolon
r_int
id|hash
suffix:semicolon
id|ndev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|inet6_dev
)paren
comma
id|gfp_any
c_func
(paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ndev
)paren
(brace
id|memset
c_func
(paren
id|ndev
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|inet6_dev
)paren
)paren
suffix:semicolon
id|ndev-&gt;dev
op_assign
id|dev
suffix:semicolon
id|hash
op_assign
id|ipv6_devindex_hash
c_func
(paren
id|dev-&gt;ifindex
)paren
suffix:semicolon
id|bptr
op_assign
op_amp
id|inet6_dev_lst
(braket
id|hash
)braket
suffix:semicolon
id|iter
op_assign
op_star
id|bptr
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|iter
suffix:semicolon
id|iter
op_assign
id|iter-&gt;next
)paren
id|bptr
op_assign
op_amp
id|iter-&gt;next
suffix:semicolon
op_star
id|bptr
op_assign
id|ndev
suffix:semicolon
)brace
r_return
id|ndev
suffix:semicolon
)brace
DECL|function|addrconf_forwarding_on
r_void
id|addrconf_forwarding_on
c_func
(paren
r_void
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IN6_ADDR_HSIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|idev
op_assign
id|inet6_dev_lst
(braket
id|i
)braket
suffix:semicolon
id|idev
suffix:semicolon
id|idev
op_assign
id|idev-&gt;next
)paren
(brace
macro_line|#if ACONF_DEBUG &gt;= 2
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dev %s&bslash;n&quot;
comma
id|idev-&gt;dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|idev-&gt;dev-&gt;type
op_eq
id|ARPHRD_ETHER
)paren
(brace
r_struct
id|in6_addr
id|maddr
suffix:semicolon
macro_line|#if ACONF_DEBUG &gt;= 2
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;joining all-routers&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|idev-&gt;router
op_assign
l_int|1
suffix:semicolon
id|ipv6_addr_all_routers
c_func
(paren
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_inc
c_func
(paren
id|idev-&gt;dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|ipv6_get_idev
r_struct
id|inet6_dev
op_star
id|ipv6_get_idev
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_int
id|hash
suffix:semicolon
id|hash
op_assign
id|ipv6_devindex_hash
c_func
(paren
id|dev-&gt;ifindex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idev
op_assign
id|inet6_dev_lst
(braket
id|hash
)braket
suffix:semicolon
id|idev
suffix:semicolon
id|idev
op_assign
id|idev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|idev-&gt;dev
op_eq
id|dev
)paren
r_return
id|idev
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ipv6_add_addr
r_struct
id|inet6_ifaddr
op_star
id|ipv6_add_addr
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
comma
r_struct
id|in6_addr
op_star
id|addr
comma
r_int
id|scope
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifa
suffix:semicolon
r_int
id|hash
suffix:semicolon
id|ifa
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|inet6_ifaddr
)paren
comma
id|gfp_any
c_func
(paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa
op_eq
l_int|NULL
)paren
(brace
id|ADBG
c_func
(paren
(paren
l_string|&quot;ipv6_add_addr: malloc failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ifa
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|inet6_ifaddr
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ifa-&gt;addr
comma
id|addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ifa-&gt;timer
)paren
suffix:semicolon
id|ifa-&gt;scope
op_assign
id|scope
suffix:semicolon
id|ifa-&gt;idev
op_assign
id|idev
suffix:semicolon
multiline_comment|/* Add to list. */
id|hash
op_assign
id|ipv6_addr_hash
c_func
(paren
id|addr
)paren
suffix:semicolon
id|ifa-&gt;lst_next
op_assign
id|inet6_addr_lst
(braket
id|hash
)braket
suffix:semicolon
id|inet6_addr_lst
(braket
id|hash
)braket
op_assign
id|ifa
suffix:semicolon
multiline_comment|/* Add to inet6_dev unicast addr list. */
id|ifa-&gt;if_next
op_assign
id|idev-&gt;addr_list
suffix:semicolon
id|idev-&gt;addr_list
op_assign
id|ifa
suffix:semicolon
r_return
id|ifa
suffix:semicolon
)brace
DECL|function|ipv6_del_addr
r_void
id|ipv6_del_addr
c_func
(paren
r_struct
id|inet6_ifaddr
op_star
id|ifp
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|iter
comma
op_star
op_star
id|back
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|addr_list_lock
)paren
)paren
(brace
id|ifp-&gt;flags
op_or_assign
id|ADDR_INVALID
suffix:semicolon
r_return
suffix:semicolon
)brace
id|hash
op_assign
id|ipv6_addr_hash
c_func
(paren
op_amp
id|ifp-&gt;addr
)paren
suffix:semicolon
id|iter
op_assign
id|inet6_addr_lst
(braket
id|hash
)braket
suffix:semicolon
id|back
op_assign
op_amp
id|inet6_addr_lst
(braket
id|hash
)braket
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|iter
suffix:semicolon
id|iter
op_assign
id|iter-&gt;lst_next
)paren
(brace
r_if
c_cond
(paren
id|iter
op_eq
id|ifp
)paren
(brace
op_star
id|back
op_assign
id|ifp-&gt;lst_next
suffix:semicolon
id|ifp-&gt;lst_next
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|back
op_assign
op_amp
(paren
id|iter-&gt;lst_next
)paren
suffix:semicolon
)brace
id|iter
op_assign
id|ifp-&gt;idev-&gt;addr_list
suffix:semicolon
id|back
op_assign
op_amp
id|ifp-&gt;idev-&gt;addr_list
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|iter
suffix:semicolon
id|iter
op_assign
id|iter-&gt;if_next
)paren
(brace
r_if
c_cond
(paren
id|iter
op_eq
id|ifp
)paren
(brace
op_star
id|back
op_assign
id|ifp-&gt;if_next
suffix:semicolon
id|ifp-&gt;if_next
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|back
op_assign
op_amp
(paren
id|iter-&gt;if_next
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|ifp
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Choose an apropriate source address&n; *&t;should do:&n; *&t;i)&t;get an address with an apropriate scope&n; *&t;ii)&t;see if there is a specific route for the destination and use&n; *&t;&t;an address of the attached interface &n; *&t;iii)&t;don&squot;t use deprecated addresses&n; *&n; *&t;at the moment I believe only iii) is missing.&n; */
DECL|function|ipv6_get_saddr
r_struct
id|inet6_ifaddr
op_star
id|ipv6_get_saddr
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
r_struct
id|in6_addr
op_star
id|daddr
)paren
(brace
r_int
id|scope
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifp
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|match
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|i
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
id|dev
op_assign
id|rt-&gt;rt6i_dev
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|addr_list_lock
)paren
suffix:semicolon
id|scope
op_assign
id|ipv6_addr_scope
c_func
(paren
id|daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_logical_and
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_ALLONLINK
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;route for the &quot;all destinations on link&quot; rule&n;&t;&t; *&t;when no routers are present&n;&t;&t; */
id|scope
op_assign
id|IFA_LINK
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;known dev&n;&t; *&t;search dev and walk through dev addresses&n;&t; */
r_if
c_cond
(paren
id|dev
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
id|scope
op_assign
id|IFA_HOST
suffix:semicolon
id|hash
op_assign
id|ipv6_devindex_hash
c_func
(paren
id|dev-&gt;ifindex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idev
op_assign
id|inet6_dev_lst
(braket
id|hash
)braket
suffix:semicolon
id|idev
suffix:semicolon
id|idev
op_assign
id|idev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|idev-&gt;dev
op_eq
id|dev
)paren
(brace
r_for
c_loop
(paren
id|ifp
op_assign
id|idev-&gt;addr_list
suffix:semicolon
id|ifp
suffix:semicolon
id|ifp
op_assign
id|ifp-&gt;if_next
)paren
(brace
r_if
c_cond
(paren
id|ifp-&gt;scope
op_eq
id|scope
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ifp-&gt;flags
op_amp
id|ADDR_STATUS
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ifp-&gt;flags
op_amp
id|ADDR_INVALID
)paren
)paren
id|match
op_assign
id|ifp
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|scope
op_eq
id|IFA_LINK
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; *&t;dev == NULL or search failed for specified dev&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IN6_ADDR_HSIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|ifp
op_assign
id|inet6_addr_lst
(braket
id|i
)braket
suffix:semicolon
id|ifp
suffix:semicolon
id|ifp
op_assign
id|ifp-&gt;lst_next
)paren
(brace
r_if
c_cond
(paren
id|ifp-&gt;scope
op_eq
id|scope
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ifp-&gt;flags
op_amp
id|ADDR_STATUS
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ifp-&gt;flags
op_amp
id|ADDR_INVALID
)paren
)paren
id|match
op_assign
id|ifp
suffix:semicolon
)brace
)brace
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|ifp
op_eq
l_int|NULL
op_logical_and
id|match
)paren
id|ifp
op_assign
id|match
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|addr_list_lock
)paren
suffix:semicolon
r_return
id|ifp
suffix:semicolon
)brace
DECL|function|ipv6_get_lladdr
r_struct
id|inet6_ifaddr
op_star
id|ipv6_get_lladdr
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_int
id|hash
suffix:semicolon
id|hash
op_assign
id|ipv6_devindex_hash
c_func
(paren
id|dev-&gt;ifindex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idev
op_assign
id|inet6_dev_lst
(braket
id|hash
)braket
suffix:semicolon
id|idev
suffix:semicolon
id|idev
op_assign
id|idev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|idev-&gt;dev
op_eq
id|dev
)paren
(brace
r_for
c_loop
(paren
id|ifp
op_assign
id|idev-&gt;addr_list
suffix:semicolon
id|ifp
suffix:semicolon
id|ifp
op_assign
id|ifp-&gt;if_next
)paren
(brace
r_if
c_cond
(paren
id|ifp-&gt;scope
op_eq
id|IFA_LINK
)paren
r_return
id|ifp
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Retrieve the ifaddr struct from an v6 address&n; *&t;Called from ipv6_rcv to check if the address belongs &n; *&t;to the host.&n; */
DECL|function|ipv6_chk_addr
r_struct
id|inet6_ifaddr
op_star
id|ipv6_chk_addr
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
id|u8
id|hash
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|addr_list_lock
)paren
suffix:semicolon
id|hash
op_assign
id|ipv6_addr_hash
c_func
(paren
id|addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ifp
op_assign
id|inet6_addr_lst
(braket
id|hash
)braket
suffix:semicolon
id|ifp
suffix:semicolon
id|ifp
op_assign
id|ifp-&gt;lst_next
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|ifp-&gt;addr
comma
id|addr
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|atomic_dec
c_func
(paren
op_amp
id|addr_list_lock
)paren
suffix:semicolon
r_return
id|ifp
suffix:semicolon
)brace
DECL|function|addrconf_prefix_rcv
r_void
id|addrconf_prefix_rcv
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u8
op_star
id|opt
comma
r_int
id|len
)paren
(brace
r_struct
id|prefix_info
op_star
id|pinfo
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|__u32
id|valid_lft
suffix:semicolon
id|__u32
id|prefered_lft
suffix:semicolon
r_int
id|addr_type
suffix:semicolon
r_int
r_int
id|rt_expires
suffix:semicolon
id|pinfo
op_assign
(paren
r_struct
id|prefix_info
op_star
)paren
id|opt
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
r_sizeof
(paren
r_struct
id|prefix_info
)paren
)paren
(brace
id|ADBG
c_func
(paren
(paren
l_string|&quot;addrconf: prefix option too short&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Validation checks ([ADDRCONF], page 19)&n;&t; */
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
op_amp
id|pinfo-&gt;prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr_type
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
r_return
suffix:semicolon
id|valid_lft
op_assign
id|ntohl
c_func
(paren
id|pinfo-&gt;valid
)paren
suffix:semicolon
id|prefered_lft
op_assign
id|ntohl
c_func
(paren
id|pinfo-&gt;prefered
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prefered_lft
OG
id|valid_lft
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;addrconf: prefix option has invalid lifetime&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;If we where using an &quot;all destinations on link&quot; route&n;&t; *&t;delete it&n;&t; */
id|rt6_purge_dflt_routers
c_func
(paren
id|RTF_ALLONLINK
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Two things going on here:&n;&t; *&t;1) Add routes for on-link prefixes&n;&t; *&t;2) Configure prefixes with the auto flag set&n;&t; */
id|rt_expires
op_assign
id|jiffies
op_plus
id|valid_lft
op_star
id|HZ
suffix:semicolon
r_if
c_cond
(paren
id|rt_expires
OL
id|jiffies
)paren
id|rt_expires
op_assign
op_complement
l_int|0
suffix:semicolon
id|rt
op_assign
id|rt6_lookup
c_func
(paren
op_amp
id|pinfo-&gt;prefix
comma
l_int|NULL
comma
id|dev
comma
id|RTF_LINKRT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_logical_and
(paren
(paren
id|rt-&gt;rt6i_flags
op_amp
(paren
id|RTF_GATEWAY
op_or
id|RTF_DEFAULT
)paren
)paren
op_eq
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|pinfo-&gt;onlink
op_eq
l_int|0
op_logical_or
id|valid_lft
op_eq
l_int|0
)paren
(brace
id|ip6_del_rt
c_func
(paren
id|rt
)paren
suffix:semicolon
id|rt
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|rt-&gt;rt6i_expires
op_assign
id|rt_expires
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|pinfo-&gt;onlink
op_logical_and
id|valid_lft
)paren
(brace
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_int
id|err
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|rtmsg
comma
l_int|0
comma
r_sizeof
(paren
id|rtmsg
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;adding on link route&bslash;n&quot;
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rtmsg.rtmsg_dst
comma
op_amp
id|pinfo-&gt;prefix
)paren
suffix:semicolon
id|rtmsg.rtmsg_dst_len
op_assign
id|pinfo-&gt;prefix_len
suffix:semicolon
id|rtmsg.rtmsg_metric
op_assign
id|IP6_RT_PRIO_ADDRCONF
suffix:semicolon
id|rtmsg.rtmsg_ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|rtmsg.rtmsg_flags
op_assign
id|RTF_UP
op_or
id|RTF_ADDRCONF
suffix:semicolon
id|rtmsg.rtmsg_info
op_assign
id|rt_expires
suffix:semicolon
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
op_amp
id|err
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pinfo-&gt;autoconf
op_logical_and
id|ipv6_config.autoconf
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_struct
id|in6_addr
id|addr
suffix:semicolon
r_int
id|plen
suffix:semicolon
id|plen
op_assign
id|pinfo-&gt;prefix_len
op_rshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|plen
op_plus
id|dev-&gt;addr_len
op_eq
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|addr
comma
op_amp
id|pinfo-&gt;prefix
comma
id|plen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|addr.s6_addr
op_plus
id|plen
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
)brace
r_else
(brace
id|ADBG
c_func
(paren
(paren
l_string|&quot;addrconf: prefix_len invalid&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ifp
op_assign
id|ipv6_chk_addr
c_func
(paren
op_amp
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifp
op_eq
l_int|NULL
op_logical_and
id|valid_lft
)paren
(brace
r_struct
id|inet6_dev
op_star
id|in6_dev
op_assign
id|ipv6_get_idev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev
op_eq
l_int|NULL
)paren
id|ADBG
c_func
(paren
(paren
l_string|&quot;addrconf: device not configured&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ifp
op_assign
id|ipv6_add_addr
c_func
(paren
id|in6_dev
comma
op_amp
id|addr
comma
id|addr_type
op_amp
id|IPV6_ADDR_SCOPE_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_MULTICAST
)paren
(brace
r_struct
id|in6_addr
id|maddr
suffix:semicolon
multiline_comment|/* Join to solicited addr multicast group. */
id|addrconf_addr_solict_mult
c_func
(paren
op_amp
id|addr
comma
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_inc
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
)brace
id|ifp-&gt;prefix_len
op_assign
id|pinfo-&gt;prefix_len
suffix:semicolon
id|addrconf_dad_start
c_func
(paren
id|ifp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifp
op_logical_and
id|valid_lft
op_eq
l_int|0
)paren
(brace
id|ipv6_del_addr
c_func
(paren
id|ifp
)paren
suffix:semicolon
id|ifp
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifp
)paren
(brace
id|ifp-&gt;valid_lft
op_assign
id|valid_lft
suffix:semicolon
id|ifp-&gt;prefered_lft
op_assign
id|prefered_lft
suffix:semicolon
id|ifp-&gt;tstamp
op_assign
id|jiffies
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *&t;Set destination address.&n; *&t;Special case for SIT interfaces where we create a new &quot;virtual&quot;&n; *&t;device.&n; */
DECL|function|addrconf_set_dstaddr
r_int
id|addrconf_set_dstaddr
c_func
(paren
r_void
op_star
id|arg
)paren
(brace
r_struct
id|in6_ifreq
id|ireq
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ireq
comma
id|arg
comma
r_sizeof
(paren
r_struct
id|in6_ifreq
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|err_exit
suffix:semicolon
)brace
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|ireq.ifr6_ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_SIT
)paren
(brace
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipv6_addr_type
c_func
(paren
op_amp
id|ireq.ifr6_addr
)paren
op_amp
id|IPV6_ADDR_COMPATv4
)paren
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
id|dev
op_assign
id|sit_add_tunnel
c_func
(paren
id|ireq.ifr6_addr.s6_addr32
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_else
id|err
op_assign
l_int|0
suffix:semicolon
)brace
id|err_exit
suffix:colon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Manual configuration of address on an interface&n; */
DECL|function|addrconf_add_ifaddr
r_int
id|addrconf_add_ifaddr
c_func
(paren
r_void
op_star
id|arg
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|in6_ifreq
id|ireq
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_int
id|scope
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ireq
comma
id|arg
comma
r_sizeof
(paren
r_struct
id|in6_ifreq
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|ireq.ifr6_ifindex
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|idev
op_assign
id|ipv6_get_idev
c_func
(paren
id|dev
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|scope
op_assign
id|ipv6_addr_scope
c_func
(paren
op_amp
id|ireq.ifr6_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ifp
op_assign
id|ipv6_add_addr
c_func
(paren
id|idev
comma
op_amp
id|ireq.ifr6_addr
comma
id|scope
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|ifp-&gt;prefix_len
op_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_MULTICAST
)paren
(brace
r_struct
id|in6_addr
id|maddr
suffix:semicolon
multiline_comment|/* Join to solicited addr multicast group. */
id|addrconf_addr_solict_mult
c_func
(paren
op_amp
id|ireq.ifr6_addr
comma
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_inc
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
)brace
id|ifp-&gt;prefix_len
op_assign
id|ireq.ifr6_prefixlen
suffix:semicolon
id|ifp-&gt;flags
op_or_assign
id|ADDR_PERMANENT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
(paren
id|IFF_NOARP
op_or
id|IFF_LOOPBACK
)paren
)paren
)paren
id|addrconf_dad_start
c_func
(paren
id|ifp
)paren
suffix:semicolon
r_else
id|ip6_rt_addr_add
c_func
(paren
op_amp
id|ifp-&gt;addr
comma
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sit_route_add
r_static
r_void
id|sit_route_add
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|err
suffix:semicolon
id|ADBG
c_func
(paren
(paren
l_string|&quot;sit_route_add(%s): &quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|rtmsg
comma
l_int|0
comma
r_sizeof
(paren
id|rtmsg
)paren
)paren
suffix:semicolon
id|rtmsg.rtmsg_type
op_assign
id|RTMSG_NEWROUTE
suffix:semicolon
id|rtmsg.rtmsg_metric
op_assign
id|IP6_RT_PRIO_ADDRCONF
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;pa_dstaddr
op_eq
l_int|0
)paren
(brace
id|ADBG
c_func
(paren
(paren
l_string|&quot;pa_dstaddr=0, &quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* prefix length - 96 bytes &quot;::d.d.d.d&quot; */
id|rtmsg.rtmsg_dst_len
op_assign
l_int|96
suffix:semicolon
id|rtmsg.rtmsg_flags
op_assign
id|RTF_NONEXTHOP
op_or
id|RTF_UP
suffix:semicolon
)brace
r_else
(brace
id|ADBG
c_func
(paren
(paren
l_string|&quot;pa_dstaddr=%08x, &quot;
comma
id|dev-&gt;pa_dstaddr
)paren
)paren
suffix:semicolon
id|rtmsg.rtmsg_dst_len
op_assign
l_int|10
suffix:semicolon
id|rtmsg.rtmsg_dst.s6_addr32
(braket
l_int|0
)braket
op_assign
id|__constant_htonl
c_func
(paren
l_int|0xfe800000
)paren
suffix:semicolon
id|rtmsg.rtmsg_dst.s6_addr32
(braket
l_int|3
)braket
op_assign
id|dev-&gt;pa_dstaddr
suffix:semicolon
id|rtmsg.rtmsg_gateway.s6_addr32
(braket
l_int|3
)braket
op_assign
id|dev-&gt;pa_dstaddr
suffix:semicolon
id|rtmsg.rtmsg_flags
op_assign
id|RTF_UP
suffix:semicolon
)brace
id|rtmsg.rtmsg_ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|ADBG
c_func
(paren
(paren
l_string|&quot;doing ip6_route_add()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|rt
op_assign
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
macro_line|#if ACONF_DEBUG &gt;= 1
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sit_route_add: error %d in route_add&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
macro_line|#endif
)brace
id|ADBG
c_func
(paren
(paren
l_string|&quot;sit_route_add(cont): &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;pa_dstaddr
)paren
(brace
r_struct
id|rt6_info
op_star
id|mrt
suffix:semicolon
id|ADBG
c_func
(paren
(paren
l_string|&quot;pa_dstaddr != 0, &quot;
)paren
)paren
suffix:semicolon
id|rt-&gt;rt6i_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|dev
comma
op_amp
id|rtmsg.rtmsg_gateway
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_nexthop
op_eq
l_int|NULL
)paren
(brace
id|ADBG
c_func
(paren
(paren
l_string|&quot;can&squot;t get neighbour&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sit_route: get_neigh failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; *&t;Add multicast route.&n;&t;&t; */
id|ADBG
c_func
(paren
(paren
l_string|&quot;add MULT, &quot;
)paren
)paren
suffix:semicolon
id|ipv6_addr_set
c_func
(paren
op_amp
id|rtmsg.rtmsg_dst
comma
id|__constant_htonl
c_func
(paren
l_int|0xFF000000
)paren
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|rtmsg.rtmsg_dst_len
op_assign
l_int|8
suffix:semicolon
id|rtmsg.rtmsg_flags
op_assign
id|RTF_UP
suffix:semicolon
id|rtmsg.rtmsg_metric
op_assign
id|IP6_RT_PRIO_ADDRCONF
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|rtmsg.rtmsg_gateway
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|ADBG
c_func
(paren
(paren
l_string|&quot;doing ip6_route_add()&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|mrt
op_assign
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mrt
)paren
id|mrt-&gt;rt6i_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|dev
comma
op_amp
id|rtmsg.rtmsg_dst
)paren
suffix:semicolon
)brace
r_else
(brace
id|ADBG
c_func
(paren
(paren
l_string|&quot;pa_dstaddr==0&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|sit_add_v4_addrs
r_static
r_void
id|sit_add_v4_addrs
c_func
(paren
r_struct
id|inet6_dev
op_star
id|idev
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_struct
id|in6_addr
id|addr
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_int
id|scope
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|addr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;dev-&gt;pa_dstaddr
)paren
(brace
id|addr.s6_addr32
(braket
l_int|0
)braket
op_assign
id|__constant_htonl
c_func
(paren
l_int|0xfe800000
)paren
suffix:semicolon
id|scope
op_assign
id|IFA_LINK
suffix:semicolon
)brace
r_else
(brace
id|scope
op_assign
id|IPV6_ADDR_COMPATv4
suffix:semicolon
)brace
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
op_ne
l_int|NULL
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;family
op_eq
id|AF_INET
op_logical_and
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
(brace
r_int
id|flag
op_assign
id|scope
suffix:semicolon
id|addr.s6_addr32
(braket
l_int|3
)braket
op_assign
id|dev-&gt;pa_addr
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
(brace
r_if
c_cond
(paren
id|idev-&gt;dev-&gt;pa_dstaddr
)paren
r_continue
suffix:semicolon
id|flag
op_or_assign
id|IFA_HOST
suffix:semicolon
)brace
id|ifp
op_assign
id|ipv6_add_addr
c_func
(paren
id|idev
comma
op_amp
id|addr
comma
id|flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifp
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|ifp-&gt;flags
op_or_assign
id|ADDR_PERMANENT
suffix:semicolon
id|ip6_rt_addr_add
c_func
(paren
op_amp
id|ifp-&gt;addr
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|init_loopback
r_static
r_void
id|init_loopback
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|in6_addr
id|addr
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* ::1 */
id|memset
c_func
(paren
op_amp
id|addr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|addr.s6_addr
(braket
l_int|15
)braket
op_assign
l_int|1
suffix:semicolon
id|idev
op_assign
id|ipv6_add_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;init loopback: add_dev failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ifp
op_assign
id|ipv6_add_addr
c_func
(paren
id|idev
comma
op_amp
id|addr
comma
id|IFA_HOST
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifp
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;init_loopback: add_addr failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ifp-&gt;flags
op_or_assign
id|ADDR_PERMANENT
suffix:semicolon
id|err
op_assign
id|ip6_rt_addr_add
c_func
(paren
op_amp
id|addr
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;init_loopback: error in route_add&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|addrconf_eth_config
r_static
r_void
id|addrconf_eth_config
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|in6_addr
id|addr
suffix:semicolon
r_struct
id|in6_addr
id|maddr
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|addr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
multiline_comment|/* Generate link local address. */
id|addr.s6_addr
(braket
l_int|0
)braket
op_assign
l_int|0xFE
suffix:semicolon
id|addr.s6_addr
(braket
l_int|1
)braket
op_assign
l_int|0x80
suffix:semicolon
id|memcpy
c_func
(paren
id|addr.s6_addr
op_plus
(paren
r_sizeof
(paren
r_struct
id|in6_addr
)paren
op_minus
id|dev-&gt;addr_len
)paren
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|idev
op_assign
id|ipv6_add_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|ifp
op_assign
id|ipv6_add_addr
c_func
(paren
id|idev
comma
op_amp
id|addr
comma
id|IFA_LINK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifp
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|ifp-&gt;flags
op_assign
id|ADDR_PERMANENT
suffix:semicolon
id|ifp-&gt;prefix_len
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* Join to all nodes multicast group. */
id|ipv6_addr_all_nodes
c_func
(paren
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_inc
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_config.forwarding
)paren
(brace
id|idev-&gt;router
op_assign
l_int|1
suffix:semicolon
id|ipv6_addr_all_routers
c_func
(paren
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_inc
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
)brace
multiline_comment|/* Join to solicited addr multicast group. */
id|addrconf_addr_solict_mult
c_func
(paren
op_amp
id|addr
comma
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_inc
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
multiline_comment|/* Start duplicate address detection. */
id|addrconf_dad_start
c_func
(paren
id|ifp
)paren
suffix:semicolon
)brace
DECL|function|addrconf_notify
r_int
id|addrconf_notify
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
id|dev
op_assign
(paren
r_struct
id|device
op_star
)paren
id|data
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|NETDEV_UP
suffix:colon
r_switch
c_cond
(paren
id|dev-&gt;type
)paren
(brace
r_case
id|ARPHRD_SIT
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;sit device up: %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t; * Configure the tunnel with one of our IPv4 &n;&t;&t;&t; * addresses... we should configure all of &n;&t;&t;&t; * our v4 addrs in the tunnel&n;&t;&t;&t; */
id|idev
op_assign
id|ipv6_add_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|sit_add_v4_addrs
c_func
(paren
id|idev
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *  we do an hack for now to configure the tunnel&n;&t;&t;&t; *  route.&n;&t;&t;&t; */
id|sit_route_add
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ARPHRD_LOOPBACK
suffix:colon
id|init_loopback
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ARPHRD_ETHER
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Configuring eth interface&bslash;n&quot;
)paren
suffix:semicolon
id|addrconf_eth_config
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|rt6_sndmsg
c_func
(paren
id|RTMSG_NEWDEVICE
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
id|dev
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_DOWN
suffix:colon
multiline_comment|/*&n;&t;&t; *&t;Remove all addresses from this interface&n;&t;&t; *&t;and take the interface out of the list.&n;&t;&t; */
r_if
c_cond
(paren
id|addrconf_ifdown
c_func
(paren
id|dev
)paren
op_eq
l_int|0
)paren
(brace
macro_line|#if 0
id|rt6_ifdown
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#endif
id|rt6_sndmsg
c_func
(paren
id|RTMSG_DELDEVICE
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
id|dev
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
id|NOTIFY_OK
suffix:semicolon
)brace
DECL|function|addrconf_ifdown
r_static
r_int
id|addrconf_ifdown
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
comma
op_star
op_star
id|bidev
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifa
comma
op_star
op_star
id|bifa
suffix:semicolon
r_int
id|i
comma
id|hash
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|hash
op_assign
id|ipv6_devindex_hash
c_func
(paren
id|dev-&gt;ifindex
)paren
suffix:semicolon
id|bidev
op_assign
op_amp
id|inet6_dev_lst
(braket
id|hash
)braket
suffix:semicolon
r_for
c_loop
(paren
id|idev
op_assign
id|inet6_dev_lst
(braket
id|hash
)braket
suffix:semicolon
id|idev
suffix:semicolon
id|idev
op_assign
id|idev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|idev-&gt;dev
op_eq
id|dev
)paren
(brace
op_star
id|bidev
op_assign
id|idev-&gt;next
suffix:semicolon
r_break
suffix:semicolon
)brace
id|bidev
op_assign
op_amp
id|idev-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;addrconf_ifdown: device not found&bslash;n&quot;
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;FIXME: clear multicast group membership&n;&t; */
multiline_comment|/*&n;&t; *&t;clean addr_list&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bifa
op_assign
op_amp
id|inet6_addr_lst
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|ifa
op_assign
id|inet6_addr_lst
(braket
id|i
)braket
suffix:semicolon
id|ifa
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|ifa-&gt;idev
op_eq
id|idev
)paren
(brace
op_star
id|bifa
op_assign
id|ifa-&gt;lst_next
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|ifa-&gt;timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ifa
)paren
suffix:semicolon
id|ifa
op_assign
op_star
id|bifa
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|ifa
op_assign
id|ifa-&gt;lst_next
suffix:semicolon
id|bifa
op_assign
op_amp
id|ifa-&gt;lst_next
suffix:semicolon
)brace
)brace
id|kfree
c_func
(paren
id|idev
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|addrconf_rs_timer
r_static
r_void
id|addrconf_rs_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
id|ifp
op_assign
(paren
r_struct
id|inet6_ifaddr
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_config.forwarding
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ifp-&gt;idev-&gt;if_flags
op_amp
id|IF_RA_RCVD
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;Announcement received after solicitation&n;&t;&t; *&t;was sent&n;&t;&t; */
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifp-&gt;probes
op_increment
op_le
id|ipv6_config.rtr_solicits
)paren
(brace
r_struct
id|in6_addr
id|all_routers
suffix:semicolon
id|ipv6_addr_set
c_func
(paren
op_amp
id|all_routers
comma
id|__constant_htonl
c_func
(paren
l_int|0xff020000U
)paren
comma
l_int|0
comma
l_int|0
comma
id|__constant_htonl
c_func
(paren
l_int|0x2U
)paren
)paren
suffix:semicolon
id|ndisc_send_rs
c_func
(paren
id|ifp-&gt;idev-&gt;dev
comma
op_amp
id|ifp-&gt;addr
comma
op_amp
id|all_routers
)paren
suffix:semicolon
id|ifp-&gt;timer.function
op_assign
id|addrconf_rs_timer
suffix:semicolon
id|ifp-&gt;timer.expires
op_assign
(paren
id|jiffies
op_plus
id|ipv6_config.rtr_solicit_interval
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ifp-&gt;timer
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_int
id|err
suffix:semicolon
macro_line|#if ACONF_DEBUG &gt;= 2
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: no IPv6 routers present&bslash;n&quot;
comma
id|ifp-&gt;idev-&gt;dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
id|memset
c_func
(paren
op_amp
id|rtmsg
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
id|rtmsg.rtmsg_type
op_assign
id|RTMSG_NEWROUTE
suffix:semicolon
id|rtmsg.rtmsg_metric
op_assign
id|IP6_RT_PRIO_ADDRCONF
suffix:semicolon
id|rtmsg.rtmsg_flags
op_assign
(paren
id|RTF_ALLONLINK
op_or
id|RTF_ADDRCONF
op_or
id|RTF_DEFAULT
op_or
id|RTF_UP
)paren
suffix:semicolon
id|rtmsg.rtmsg_ifindex
op_assign
id|ifp-&gt;idev-&gt;dev-&gt;ifindex
suffix:semicolon
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
op_amp
id|err
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Duplicate Address Detection&n; */
DECL|function|addrconf_dad_start
r_static
r_void
id|addrconf_dad_start
c_func
(paren
r_struct
id|inet6_ifaddr
op_star
id|ifp
)paren
(brace
r_static
r_int
id|rand_seed
op_assign
l_int|1
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_int
r_int
id|rand_num
suffix:semicolon
id|dev
op_assign
id|ifp-&gt;idev-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_MULTICAST
)paren
(brace
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_struct
id|rt6_info
op_star
id|mrt
suffix:semicolon
r_int
id|err
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|rtmsg
comma
l_int|0
comma
r_sizeof
(paren
id|rtmsg
)paren
)paren
suffix:semicolon
id|ipv6_addr_set
c_func
(paren
op_amp
id|rtmsg.rtmsg_dst
comma
id|__constant_htonl
c_func
(paren
l_int|0xFF000000
)paren
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|rtmsg.rtmsg_dst_len
op_assign
l_int|8
suffix:semicolon
id|rtmsg.rtmsg_metric
op_assign
id|IP6_RT_PRIO_ADDRCONF
suffix:semicolon
id|rtmsg.rtmsg_ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|rtmsg.rtmsg_flags
op_assign
id|RTF_UP
suffix:semicolon
id|mrt
op_assign
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dad_start: mcast route add failed&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|mrt-&gt;rt6i_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|dev
comma
op_amp
id|rtmsg.rtmsg_dst
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rand_seed
)paren
(brace
id|rand_seed
op_assign
l_int|0
suffix:semicolon
id|nd_rand_seed
op_assign
id|ifp-&gt;addr.s6_addr32
(braket
l_int|3
)braket
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|ifp-&gt;timer
)paren
suffix:semicolon
id|ifp-&gt;probes
op_assign
id|ipv6_config.dad_transmits
suffix:semicolon
id|ifp-&gt;flags
op_or_assign
id|DAD_INCOMPLETE
suffix:semicolon
id|rand_num
op_assign
id|ipv6_random
c_func
(paren
)paren
op_mod
id|ipv6_config.rtr_solicit_delay
suffix:semicolon
id|ifp-&gt;timer.function
op_assign
id|addrconf_dad_timer
suffix:semicolon
id|ifp-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|ifp
suffix:semicolon
id|ifp-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|rand_num
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ifp-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|addrconf_dad_timer
r_static
r_void
id|addrconf_dad_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_struct
id|in6_addr
id|unspec
suffix:semicolon
r_struct
id|in6_addr
id|mcaddr
suffix:semicolon
id|ifp
op_assign
(paren
r_struct
id|inet6_ifaddr
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|ifp-&gt;probes
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * DAD was successful&n;&t;&t; */
id|ifp-&gt;flags
op_and_assign
op_complement
id|DAD_INCOMPLETE
suffix:semicolon
id|addrconf_dad_completed
c_func
(paren
id|ifp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ifp-&gt;probes
op_decrement
suffix:semicolon
multiline_comment|/* send a neighbour solicitation for our addr */
id|memset
c_func
(paren
op_amp
id|unspec
comma
l_int|0
comma
r_sizeof
(paren
id|unspec
)paren
)paren
suffix:semicolon
id|addrconf_addr_solict_mult
c_func
(paren
op_amp
id|ifp-&gt;addr
comma
op_amp
id|mcaddr
)paren
suffix:semicolon
id|ndisc_send_ns
c_func
(paren
id|ifp-&gt;idev-&gt;dev
comma
l_int|NULL
comma
op_amp
id|ifp-&gt;addr
comma
op_amp
id|mcaddr
comma
op_amp
id|unspec
)paren
suffix:semicolon
id|ifp-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|ipv6_config.rtr_solicit_interval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ifp-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|addrconf_dad_completed
r_static
r_void
id|addrconf_dad_completed
c_func
(paren
r_struct
id|inet6_ifaddr
op_star
id|ifp
)paren
(brace
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_int
id|err
suffix:semicolon
id|dev
op_assign
id|ifp-&gt;idev-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_addr_type
c_func
(paren
op_amp
id|ifp-&gt;addr
)paren
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
(brace
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_struct
id|in6_addr
id|all_routers
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;1) configure a link route for this interface&n;&t;&t; *&t;2) send a (delayed) router solicitation&n;&t;&t; */
id|memset
c_func
(paren
op_amp
id|rtmsg
comma
l_int|0
comma
r_sizeof
(paren
id|rtmsg
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rtmsg.rtmsg_dst
comma
op_amp
id|ifp-&gt;addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|rtmsg.rtmsg_dst_len
op_assign
id|ifp-&gt;prefix_len
suffix:semicolon
id|rtmsg.rtmsg_metric
op_assign
id|IP6_RT_PRIO_ADDRCONF
suffix:semicolon
id|rtmsg.rtmsg_ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|rtmsg.rtmsg_flags
op_assign
id|RTF_UP
suffix:semicolon
id|ip6_route_add
c_func
(paren
op_amp
id|rtmsg
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;dad_complete: error in route_add&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_config.forwarding
op_eq
l_int|0
)paren
(brace
id|ipv6_addr_set
c_func
(paren
op_amp
id|all_routers
comma
id|__constant_htonl
c_func
(paren
l_int|0xff020000U
)paren
comma
l_int|0
comma
l_int|0
comma
id|__constant_htonl
c_func
(paren
l_int|0x2U
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;If a host as already performed a random delay&n;&t;&t;&t; *&t;[...] as part of DAD [...] there is no need&n;&t;&t;&t; *&t;to delay again before sending the first RS&n;&t;&t;&t; */
id|ndisc_send_rs
c_func
(paren
id|ifp-&gt;idev-&gt;dev
comma
op_amp
id|ifp-&gt;addr
comma
op_amp
id|all_routers
)paren
suffix:semicolon
id|ifp-&gt;probes
op_assign
l_int|1
suffix:semicolon
id|ifp-&gt;timer.function
op_assign
id|addrconf_rs_timer
suffix:semicolon
id|ifp-&gt;timer.expires
op_assign
(paren
id|jiffies
op_plus
id|ipv6_config.rtr_solicit_interval
)paren
suffix:semicolon
id|ifp-&gt;idev-&gt;if_flags
op_or_assign
id|IF_RS_SENT
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ifp-&gt;timer
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;configure the address for reception&n;&t; */
id|ip6_rt_addr_add
c_func
(paren
op_amp
id|ifp-&gt;addr
comma
id|dev
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|iface_proc_info
r_static
r_int
id|iface_proc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IN6_ADDR_HSIZE
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|ifp
op_assign
id|inet6_addr_lst
(braket
id|i
)braket
suffix:semicolon
id|ifp
suffix:semicolon
id|ifp
op_assign
id|ifp-&gt;lst_next
)paren
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%02x&quot;
comma
id|ifp-&gt;addr.s6_addr
(braket
id|j
)braket
)paren
suffix:semicolon
id|len
op_add_assign
l_int|2
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; %02x %02x %02x %02x %8s&bslash;n&quot;
comma
id|ifp-&gt;idev-&gt;dev-&gt;ifindex
comma
id|ifp-&gt;prefix_len
comma
id|ifp-&gt;scope
comma
id|ifp-&gt;flags
comma
id|ifp-&gt;idev-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
suffix:semicolon
id|len
op_sub_assign
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|variable|iface_proc_entry
r_struct
id|proc_dir_entry
id|iface_proc_entry
op_assign
(brace
l_int|0
comma
l_int|8
comma
l_string|&quot;if_inet6&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|iface_proc_info
)brace
suffix:semicolon
macro_line|#endif&t;/* CONFIG_PROC_FS */
multiline_comment|/*&n; *&t;Periodic address status verification&n; */
DECL|function|addrconf_verify
r_void
id|addrconf_verify
c_func
(paren
r_int
r_int
id|foo
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IN6_ADDR_HSIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|ifp
op_assign
id|inet6_addr_lst
(braket
id|i
)braket
suffix:semicolon
id|ifp
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ifp-&gt;flags
op_amp
id|ADDR_PERMANENT
)paren
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|bp
suffix:semicolon
r_int
r_int
id|age
suffix:semicolon
id|age
op_assign
(paren
id|now
op_minus
id|ifp-&gt;tstamp
)paren
op_div
id|HZ
suffix:semicolon
r_if
c_cond
(paren
id|age
OG
id|ifp-&gt;prefered_lft
)paren
id|ifp-&gt;flags
op_or_assign
id|ADDR_DEPRECATED
suffix:semicolon
id|bp
op_assign
id|ifp
suffix:semicolon
id|ifp
op_assign
id|ifp-&gt;lst_next
suffix:semicolon
r_if
c_cond
(paren
id|age
OG
id|bp-&gt;valid_lft
)paren
id|ipv6_del_addr
c_func
(paren
id|bp
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|ifp
op_assign
id|ifp-&gt;lst_next
suffix:semicolon
)brace
)brace
id|addr_chk_timer.expires
op_assign
id|jiffies
op_plus
id|ADDR_CHECK_FREQUENCY
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|addr_chk_timer
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Init / cleanup code&n; */
DECL|function|addrconf_init
r_void
id|addrconf_init
c_func
(paren
)paren
(brace
r_struct
id|device
op_star
id|dev
suffix:semicolon
multiline_comment|/*&n;&t; *&t;init address and device hash lists&n;&t; */
id|memset
c_func
(paren
id|inet6_addr_lst
comma
l_int|0
comma
id|IN6_ADDR_HSIZE
op_star
r_sizeof
(paren
r_struct
id|inet6_ifaddr
op_star
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|inet6_mcast_lst
comma
l_int|0
comma
id|IN6_ADDR_HSIZE
op_star
r_sizeof
(paren
r_struct
id|ifmcaddr6
op_star
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|inet6_dev_lst
comma
l_int|0
comma
id|IN6_ADDR_HSIZE
op_star
r_sizeof
(paren
r_struct
id|inet6_dev
op_star
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Init loopback device&n;&t; */
id|dev
op_assign
id|dev_get
c_func
(paren
l_string|&quot;lo&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
id|init_loopback
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;and maybe:&n;&t; *&t;search availiable AF_INET devs and try to configure them&n;&t; */
id|dev
op_assign
id|dev_get
c_func
(paren
l_string|&quot;eth0&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
id|addrconf_eth_config
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_register
c_func
(paren
op_amp
id|iface_proc_entry
)paren
suffix:semicolon
macro_line|#endif
id|addr_chk_timer.expires
op_assign
id|jiffies
op_plus
id|ADDR_CHECK_FREQUENCY
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|addr_chk_timer
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|addrconf_cleanup
r_void
id|addrconf_cleanup
c_func
(paren
r_void
)paren
(brace
r_struct
id|inet6_dev
op_star
id|idev
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifa
suffix:semicolon
r_int
id|i
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|addr_chk_timer
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;clean dev list.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IN6_ADDR_HSIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|idev
op_assign
id|inet6_dev_lst
(braket
id|i
)braket
suffix:semicolon
id|idev
suffix:semicolon
)paren
(brace
r_struct
id|inet6_dev
op_star
id|back
suffix:semicolon
id|back
op_assign
id|idev
suffix:semicolon
id|idev
op_assign
id|idev-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|back
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;clean addr_list&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IN6_ADDR_HSIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|ifa
op_assign
id|inet6_addr_lst
(braket
id|i
)braket
suffix:semicolon
id|ifa
suffix:semicolon
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|bifa
suffix:semicolon
id|bifa
op_assign
id|ifa
suffix:semicolon
id|ifa
op_assign
id|ifa-&gt;lst_next
suffix:semicolon
id|kfree
c_func
(paren
id|bifa
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_unregister
c_func
(paren
id|iface_proc_entry.low_ino
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif&t;/* MODULE */
eof
