multiline_comment|/*&n; *&t;TCP over IPv6&n; *&t;Linux INET6 implementation &n; *&n; *&t;Authors:&n; *&t;Pedro Roque&t;&t;&lt;roque@di.fc.ul.pt&gt;&t;&n; *&n; *&t;$Id: tcp_ipv6.c,v 1.44 1997/12/13 21:53:18 kuznet Exp $&n; *&n; *&t;Based on: &n; *&t;linux/net/ipv4/tcp.c&n; *&t;linux/net/ipv4/tcp_input.c&n; *&t;linux/net/ipv4/tcp_output.c&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ipv6.h&gt;
macro_line|#include &lt;linux/icmpv6.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/ndisc.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/transp_v6.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;net/ip6_route.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|macro|ICMP_PARANOIA
mdefine_line|#define ICMP_PARANOIA
r_extern
r_int
id|sysctl_tcp_sack
suffix:semicolon
r_extern
r_int
id|sysctl_tcp_timestamps
suffix:semicolon
r_extern
r_int
id|sysctl_tcp_window_scaling
suffix:semicolon
r_static
r_void
id|tcp_v6_send_reset
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|tcp_v6_send_check
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|tcphdr
op_star
id|th
comma
r_int
id|len
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|tcp_v6_backlog_rcv
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|tcp_v6_build_header
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|tcp_v6_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_struct
id|open_request
op_star
id|tcp_v6_search_req
c_func
(paren
r_struct
id|tcp_opt
op_star
id|tp
comma
r_struct
id|ipv6hdr
op_star
id|ip6h
comma
r_struct
id|tcphdr
op_star
id|th
comma
r_struct
id|open_request
op_star
op_star
id|prevp
)paren
suffix:semicolon
DECL|variable|ipv6_mapped
r_static
r_struct
id|tcp_func
id|ipv6_mapped
suffix:semicolon
DECL|variable|ipv6_specific
r_static
r_struct
id|tcp_func
id|ipv6_specific
suffix:semicolon
multiline_comment|/* I have no idea if this is a good hash for v6 or not. -DaveM */
DECL|function|tcp_v6_hashfn
r_static
id|__inline__
r_int
id|tcp_v6_hashfn
c_func
(paren
r_struct
id|in6_addr
op_star
id|laddr
comma
id|u16
id|lport
comma
r_struct
id|in6_addr
op_star
id|faddr
comma
id|u16
id|fport
)paren
(brace
r_int
id|hashent
op_assign
(paren
id|lport
op_xor
id|fport
)paren
suffix:semicolon
id|hashent
op_xor_assign
(paren
id|laddr-&gt;s6_addr32
(braket
l_int|0
)braket
op_xor
id|laddr-&gt;s6_addr32
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|hashent
op_xor_assign
(paren
id|faddr-&gt;s6_addr32
(braket
l_int|0
)braket
op_xor
id|faddr-&gt;s6_addr32
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|hashent
op_xor_assign
(paren
id|faddr-&gt;s6_addr32
(braket
l_int|2
)braket
op_xor
id|faddr-&gt;s6_addr32
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
(paren
id|hashent
op_amp
(paren
(paren
id|TCP_HTABLE_SIZE
op_div
l_int|2
)paren
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|tcp_v6_sk_hashfn
r_static
id|__inline__
r_int
id|tcp_v6_sk_hashfn
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|in6_addr
op_star
id|laddr
op_assign
op_amp
id|sk-&gt;net_pinfo.af_inet6.rcv_saddr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|faddr
op_assign
op_amp
id|sk-&gt;net_pinfo.af_inet6.daddr
suffix:semicolon
id|__u16
id|lport
op_assign
id|sk-&gt;num
suffix:semicolon
id|__u16
id|fport
op_assign
id|sk-&gt;dummy_th.dest
suffix:semicolon
r_return
id|tcp_v6_hashfn
c_func
(paren
id|laddr
comma
id|lport
comma
id|faddr
comma
id|fport
)paren
suffix:semicolon
)brace
multiline_comment|/* Grrr, addr_type already calculated by caller, but I don&squot;t want&n; * to add some silly &quot;cookie&quot; argument to this method just for that.&n; */
DECL|function|tcp_v6_verify_bind
r_static
r_int
id|tcp_v6_verify_bind
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|snum
)paren
(brace
r_struct
id|sock
op_star
id|sk2
suffix:semicolon
r_int
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
op_amp
id|sk-&gt;net_pinfo.af_inet6.rcv_saddr
)paren
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
comma
id|sk_reuse
op_assign
id|sk-&gt;reuse
suffix:semicolon
id|SOCKHASH_LOCK
c_func
(paren
)paren
suffix:semicolon
id|sk2
op_assign
id|tcp_bound_hash
(braket
id|tcp_sk_bhashfn
c_func
(paren
id|sk
)paren
)braket
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|sk2
op_ne
l_int|NULL
suffix:semicolon
id|sk2
op_assign
id|sk2-&gt;bind_next
)paren
(brace
r_if
c_cond
(paren
(paren
id|sk2-&gt;num
op_eq
id|snum
)paren
op_logical_and
(paren
id|sk2
op_ne
id|sk
)paren
)paren
(brace
r_int
r_char
id|state
op_assign
id|sk2-&gt;state
suffix:semicolon
r_int
id|sk2_reuse
op_assign
id|sk2-&gt;reuse
suffix:semicolon
r_if
c_cond
(paren
id|addr_type
op_eq
id|IPV6_ADDR_ANY
op_logical_or
(paren
op_logical_neg
id|sk2-&gt;rcv_saddr
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|sk2_reuse
)paren
op_logical_or
(paren
op_logical_neg
id|sk_reuse
)paren
op_logical_or
(paren
id|state
op_eq
id|TCP_LISTEN
)paren
)paren
(brace
id|retval
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|sk-&gt;net_pinfo.af_inet6.rcv_saddr
comma
op_amp
id|sk2-&gt;net_pinfo.af_inet6.rcv_saddr
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|sk_reuse
)paren
op_logical_or
(paren
op_logical_neg
id|sk2_reuse
)paren
op_logical_or
(paren
id|state
op_eq
id|TCP_LISTEN
)paren
)paren
(brace
id|retval
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
id|SOCKHASH_UNLOCK
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|tcp_v6_hash
r_static
r_void
id|tcp_v6_hash
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
r_char
id|state
suffix:semicolon
id|SOCKHASH_LOCK
c_func
(paren
)paren
suffix:semicolon
id|state
op_assign
id|sk-&gt;state
suffix:semicolon
r_if
c_cond
(paren
id|state
op_ne
id|TCP_CLOSE
)paren
(brace
r_struct
id|sock
op_star
op_star
id|skp
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
id|TCP_LISTEN
)paren
(brace
id|skp
op_assign
op_amp
id|tcp_listening_hash
(braket
id|tcp_sk_listen_hashfn
c_func
(paren
id|sk
)paren
)braket
suffix:semicolon
)brace
r_else
id|skp
op_assign
op_amp
id|tcp_established_hash
(braket
id|tcp_v6_sk_hashfn
c_func
(paren
id|sk
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sk-&gt;next
op_assign
op_star
id|skp
)paren
op_ne
l_int|NULL
)paren
(brace
(paren
op_star
id|skp
)paren
op_member_access_from_pointer
id|pprev
op_assign
op_amp
id|sk-&gt;next
suffix:semicolon
)brace
op_star
id|skp
op_assign
id|sk
suffix:semicolon
id|sk-&gt;pprev
op_assign
id|skp
suffix:semicolon
id|tcp_sk_bindify
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|SOCKHASH_UNLOCK
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|tcp_v6_unhash
r_static
r_void
id|tcp_v6_unhash
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|SOCKHASH_LOCK
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;pprev
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;next
)paren
(brace
id|sk-&gt;next-&gt;pprev
op_assign
id|sk-&gt;pprev
suffix:semicolon
)brace
op_star
id|sk-&gt;pprev
op_assign
id|sk-&gt;next
suffix:semicolon
id|sk-&gt;pprev
op_assign
l_int|NULL
suffix:semicolon
id|tcp_sk_unbindify
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|SOCKHASH_UNLOCK
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|tcp_v6_rehash
r_static
r_void
id|tcp_v6_rehash
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
r_char
id|state
suffix:semicolon
id|SOCKHASH_LOCK
c_func
(paren
)paren
suffix:semicolon
id|state
op_assign
id|sk-&gt;state
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;pprev
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;next
)paren
(brace
id|sk-&gt;next-&gt;pprev
op_assign
id|sk-&gt;pprev
suffix:semicolon
)brace
op_star
id|sk-&gt;pprev
op_assign
id|sk-&gt;next
suffix:semicolon
id|sk-&gt;pprev
op_assign
l_int|NULL
suffix:semicolon
id|tcp_sk_unbindify
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state
op_ne
id|TCP_CLOSE
)paren
(brace
r_struct
id|sock
op_star
op_star
id|skp
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
id|TCP_LISTEN
)paren
(brace
id|skp
op_assign
op_amp
id|tcp_listening_hash
(braket
id|tcp_sk_listen_hashfn
c_func
(paren
id|sk
)paren
)braket
suffix:semicolon
)brace
r_else
(brace
r_int
id|hash
op_assign
id|tcp_v6_sk_hashfn
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
id|TCP_TIME_WAIT
)paren
(brace
id|hash
op_add_assign
(paren
id|TCP_HTABLE_SIZE
op_div
l_int|2
)paren
suffix:semicolon
)brace
id|skp
op_assign
op_amp
id|tcp_established_hash
(braket
id|hash
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sk-&gt;next
op_assign
op_star
id|skp
)paren
op_ne
l_int|NULL
)paren
(brace
(paren
op_star
id|skp
)paren
op_member_access_from_pointer
id|pprev
op_assign
op_amp
id|sk-&gt;next
suffix:semicolon
)brace
op_star
id|skp
op_assign
id|sk
suffix:semicolon
id|sk-&gt;pprev
op_assign
id|skp
suffix:semicolon
id|tcp_sk_bindify
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|SOCKHASH_UNLOCK
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|tcp_v6_lookup_listener
r_static
r_struct
id|sock
op_star
id|tcp_v6_lookup_listener
c_func
(paren
r_struct
id|in6_addr
op_star
id|daddr
comma
r_int
r_int
id|hnum
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|sock
op_star
id|result
op_assign
l_int|NULL
suffix:semicolon
id|sk
op_assign
id|tcp_listening_hash
(braket
id|tcp_lhashfn
c_func
(paren
id|hnum
)paren
)braket
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|sk-&gt;num
op_eq
id|hnum
)paren
op_logical_and
(paren
id|sk-&gt;family
op_eq
id|AF_INET6
)paren
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
op_amp
id|sk-&gt;net_pinfo.af_inet6
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_any
c_func
(paren
op_amp
id|np-&gt;rcv_saddr
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|np-&gt;rcv_saddr
comma
id|daddr
)paren
)paren
(brace
r_return
id|sk
suffix:semicolon
)brace
multiline_comment|/* Best possible match. */
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|result
)paren
(brace
id|result
op_assign
id|sk
suffix:semicolon
)brace
)brace
)brace
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* Sockets in TCP_CLOSE state are _always_ taken out of the hash, so&n; * we need not check it for TCP lookups anymore, thanks Alexey. -DaveM&n; */
DECL|function|__tcp_v6_lookup
r_static
r_inline
r_struct
id|sock
op_star
id|__tcp_v6_lookup
c_func
(paren
r_struct
id|tcphdr
op_star
id|th
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
id|u16
id|sport
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
id|u16
id|dport
)paren
(brace
r_int
r_int
id|hnum
op_assign
id|ntohs
c_func
(paren
id|dport
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|hash
op_assign
id|tcp_v6_hashfn
c_func
(paren
id|daddr
comma
id|hnum
comma
id|saddr
comma
id|sport
)paren
suffix:semicolon
multiline_comment|/* Optimize here for direct hit, only listening connections can&n;&t; * have wildcards anyways.  It is assumed that this code only&n;&t; * gets called from within NET_BH.&n;&t; */
r_for
c_loop
(paren
id|sk
op_assign
id|tcp_established_hash
(braket
id|hash
)braket
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
multiline_comment|/* For IPV6 do the cheaper port and family tests first. */
r_if
c_cond
(paren
id|sk-&gt;num
op_eq
id|hnum
op_logical_and
multiline_comment|/* local port     */
id|sk-&gt;family
op_eq
id|AF_INET6
op_logical_and
multiline_comment|/* address family */
id|sk-&gt;dummy_th.dest
op_eq
id|sport
op_logical_and
multiline_comment|/* remote port    */
op_logical_neg
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|sk-&gt;net_pinfo.af_inet6.daddr
comma
id|saddr
)paren
op_logical_and
op_logical_neg
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|sk-&gt;net_pinfo.af_inet6.rcv_saddr
comma
id|daddr
)paren
)paren
(brace
r_goto
id|hit
suffix:semicolon
)brace
multiline_comment|/* You sunk my battleship! */
multiline_comment|/* Must check for a TIME_WAIT&squot;er before going to listener hash. */
r_for
c_loop
(paren
id|sk
op_assign
id|tcp_established_hash
(braket
id|hash
op_plus
(paren
id|TCP_HTABLE_SIZE
op_div
l_int|2
)paren
)braket
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
r_if
c_cond
(paren
id|sk-&gt;num
op_eq
id|hnum
op_logical_and
multiline_comment|/* local port     */
id|sk-&gt;family
op_eq
id|AF_INET6
op_logical_and
multiline_comment|/* address family */
id|sk-&gt;dummy_th.dest
op_eq
id|sport
op_logical_and
multiline_comment|/* remote port    */
op_logical_neg
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|sk-&gt;net_pinfo.af_inet6.daddr
comma
id|saddr
)paren
op_logical_and
op_logical_neg
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|sk-&gt;net_pinfo.af_inet6.rcv_saddr
comma
id|daddr
)paren
)paren
(brace
r_goto
id|hit
suffix:semicolon
)brace
id|sk
op_assign
id|tcp_v6_lookup_listener
c_func
(paren
id|daddr
comma
id|hnum
)paren
suffix:semicolon
id|hit
suffix:colon
r_return
id|sk
suffix:semicolon
)brace
DECL|macro|tcp_v6_lookup
mdefine_line|#define tcp_v6_lookup(sa, sp, da, dp) __tcp_v6_lookup((0),(sa),(sp),(da),(dp))
DECL|function|tcp_v6_check
r_static
id|__inline__
id|u16
id|tcp_v6_check
c_func
(paren
r_struct
id|tcphdr
op_star
id|th
comma
r_int
id|len
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_int
r_int
id|base
)paren
(brace
r_return
id|csum_ipv6_magic
c_func
(paren
id|saddr
comma
id|daddr
comma
id|len
comma
id|IPPROTO_TCP
comma
id|base
)paren
suffix:semicolon
)brace
DECL|function|tcp_v6_init_sequence
r_static
id|__u32
id|tcp_v6_init_sequence
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|__u32
id|si
suffix:semicolon
id|__u32
id|di
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;protocol
op_eq
id|__constant_htons
c_func
(paren
id|ETH_P_IPV6
)paren
)paren
(brace
id|si
op_assign
id|skb-&gt;nh.ipv6h-&gt;saddr.s6_addr32
(braket
l_int|3
)braket
suffix:semicolon
id|di
op_assign
id|skb-&gt;nh.ipv6h-&gt;daddr.s6_addr32
(braket
l_int|3
)braket
suffix:semicolon
)brace
r_else
(brace
id|si
op_assign
id|skb-&gt;nh.iph-&gt;saddr
suffix:semicolon
id|di
op_assign
id|skb-&gt;nh.iph-&gt;daddr
suffix:semicolon
)brace
r_return
id|secure_tcp_sequence_number
c_func
(paren
id|di
comma
id|si
comma
id|skb-&gt;h.th-&gt;dest
comma
id|skb-&gt;h.th-&gt;source
)paren
suffix:semicolon
)brace
DECL|function|tcp_v6_connect
r_static
r_int
id|tcp_v6_connect
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sockaddr_in6
op_star
id|usin
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
op_amp
id|sk-&gt;net_pinfo.af_inet6
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|tp
op_assign
op_amp
id|sk-&gt;tp_pinfo.af_tcp
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifa
suffix:semicolon
r_struct
id|in6_addr
op_star
id|saddr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
r_struct
id|tcphdr
op_star
id|th
suffix:semicolon
r_struct
id|sk_buff
op_star
id|buff
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb1
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
id|addr_type
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_CLOSE
)paren
r_return
op_minus
id|EISCONN
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Don&squot;t allow a double connect.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_any
c_func
(paren
op_amp
id|np-&gt;daddr
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr_len
OL
r_sizeof
(paren
r_struct
id|sockaddr_in6
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|usin-&gt;sin6_family
op_logical_and
id|usin-&gt;sin6_family
op_ne
id|AF_INET6
)paren
r_return
op_minus
id|EAFNOSUPPORT
suffix:semicolon
multiline_comment|/*&n;  &t; *&t;connect() to INADDR_ANY means loopback (BSD&squot;ism).&n;  &t; */
r_if
c_cond
(paren
id|ipv6_addr_any
c_func
(paren
op_amp
id|usin-&gt;sin6_addr
)paren
)paren
(brace
id|usin-&gt;sin6_addr.s6_addr
(braket
l_int|15
)braket
op_assign
l_int|0x1
suffix:semicolon
)brace
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
op_amp
id|usin-&gt;sin6_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr_type
op_amp
id|IPV6_ADDR_MULTICAST
)paren
(brace
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;connect to self not allowed&n;&t; */
r_if
c_cond
(paren
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|usin-&gt;sin6_addr
comma
op_amp
id|np-&gt;saddr
)paren
op_eq
l_int|0
op_logical_and
id|usin-&gt;sin6_port
op_eq
id|sk-&gt;dummy_th.source
)paren
r_return
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|np-&gt;daddr
comma
op_amp
id|usin-&gt;sin6_addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;TCP over IPv4&n;&t; */
r_if
c_cond
(paren
id|addr_type
op_eq
id|IPV6_ADDR_MAPPED
)paren
(brace
r_struct
id|sockaddr_in
id|sin
suffix:semicolon
r_int
id|err
suffix:semicolon
id|SOCK_DEBUG
c_func
(paren
id|sk
comma
l_string|&quot;connect: ipv4 mapped&bslash;n&quot;
)paren
suffix:semicolon
id|sin.sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin.sin_port
op_assign
id|usin-&gt;sin6_port
suffix:semicolon
id|sin.sin_addr.s_addr
op_assign
id|usin-&gt;sin6_addr.s6_addr32
(braket
l_int|3
)braket
suffix:semicolon
id|sk-&gt;tp_pinfo.af_tcp.af_specific
op_assign
op_amp
id|ipv6_mapped
suffix:semicolon
id|sk-&gt;backlog_rcv
op_assign
id|tcp_v4_do_rcv
suffix:semicolon
id|err
op_assign
id|tcp_v4_connect
c_func
(paren
id|sk
comma
(paren
r_struct
id|sockaddr
op_star
)paren
op_amp
id|sin
comma
r_sizeof
(paren
id|sin
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|sk-&gt;tp_pinfo.af_tcp.af_specific
op_assign
op_amp
id|ipv6_specific
suffix:semicolon
id|sk-&gt;backlog_rcv
op_assign
id|tcp_v6_backlog_rcv
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_any
c_func
(paren
op_amp
id|np-&gt;rcv_saddr
)paren
)paren
id|saddr
op_assign
op_amp
id|np-&gt;rcv_saddr
suffix:semicolon
id|fl.proto
op_assign
id|IPPROTO_TCP
suffix:semicolon
id|fl.nl_u.ip6_u.daddr
op_assign
op_amp
id|np-&gt;daddr
suffix:semicolon
id|fl.nl_u.ip6_u.saddr
op_assign
id|saddr
suffix:semicolon
id|fl.dev
op_assign
l_int|NULL
suffix:semicolon
id|fl.uli_u.ports.dport
op_assign
id|usin-&gt;sin6_port
suffix:semicolon
id|fl.uli_u.ports.sport
op_assign
id|sk-&gt;dummy_th.source
suffix:semicolon
id|dst
op_assign
id|ip6_route_output
c_func
(paren
id|sk
comma
op_amp
id|fl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst-&gt;error
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
id|dst-&gt;error
suffix:semicolon
)brace
id|ip6_dst_store
c_func
(paren
id|sk
comma
id|dst
)paren
suffix:semicolon
id|np-&gt;oif
op_assign
id|dst-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|saddr
op_eq
l_int|NULL
)paren
(brace
id|ifa
op_assign
id|ipv6_get_saddr
c_func
(paren
id|dst
comma
op_amp
id|np-&gt;daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
id|saddr
op_assign
op_amp
id|ifa-&gt;addr
suffix:semicolon
multiline_comment|/* set the source address */
id|ipv6_addr_copy
c_func
(paren
op_amp
id|np-&gt;rcv_saddr
comma
id|saddr
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|np-&gt;saddr
comma
id|saddr
)paren
suffix:semicolon
)brace
multiline_comment|/* FIXME: Need to do tcp_v6_unique_address() here! -DaveM */
multiline_comment|/*&n;&t; *&t;Init variables&n;&t; */
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;dummy_th.dest
op_assign
id|usin-&gt;sin6_port
suffix:semicolon
id|sk-&gt;write_seq
op_assign
id|secure_tcp_sequence_number
c_func
(paren
id|np-&gt;saddr.s6_addr32
(braket
l_int|3
)braket
comma
id|np-&gt;daddr.s6_addr32
(braket
l_int|3
)braket
comma
id|sk-&gt;dummy_th.source
comma
id|sk-&gt;dummy_th.dest
)paren
suffix:semicolon
id|tp-&gt;snd_wnd
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;snd_wl1
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;snd_wl2
op_assign
id|sk-&gt;write_seq
suffix:semicolon
id|tp-&gt;snd_una
op_assign
id|sk-&gt;write_seq
suffix:semicolon
id|tp-&gt;rcv_nxt
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;err
op_assign
l_int|0
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|buff
op_assign
id|sock_wmalloc
c_func
(paren
id|sk
comma
id|MAX_SYN_SIZE
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buff
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|tcp_v6_build_header
c_func
(paren
id|sk
comma
id|buff
)paren
suffix:semicolon
multiline_comment|/* build the tcp header */
id|th
op_assign
(paren
r_struct
id|tcphdr
op_star
)paren
id|skb_put
c_func
(paren
id|buff
comma
r_sizeof
(paren
r_struct
id|tcphdr
)paren
)paren
suffix:semicolon
id|buff-&gt;h.th
op_assign
id|th
suffix:semicolon
id|memcpy
c_func
(paren
id|th
comma
(paren
r_void
op_star
)paren
op_amp
(paren
id|sk-&gt;dummy_th
)paren
comma
r_sizeof
(paren
op_star
id|th
)paren
)paren
suffix:semicolon
id|buff-&gt;seq
op_assign
id|sk-&gt;write_seq
op_increment
suffix:semicolon
id|th-&gt;seq
op_assign
id|htonl
c_func
(paren
id|buff-&gt;seq
)paren
suffix:semicolon
id|tp-&gt;snd_nxt
op_assign
id|sk-&gt;write_seq
suffix:semicolon
id|buff-&gt;end_seq
op_assign
id|sk-&gt;write_seq
suffix:semicolon
id|th-&gt;ack
op_assign
l_int|0
suffix:semicolon
id|th-&gt;syn
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;mtu
op_assign
id|dst-&gt;pmtu
suffix:semicolon
id|sk-&gt;mss
op_assign
id|sk-&gt;mtu
op_minus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
op_minus
r_sizeof
(paren
r_struct
id|tcphdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;mss
OL
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;intial ipv6 sk-&gt;mss below 1&bslash;n&quot;
)paren
suffix:semicolon
id|sk-&gt;mss
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Sanity limit */
)brace
id|tp-&gt;window_clamp
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: shouldn&squot;t ipv6 dst cache have this? */
id|tcp_select_initial_window
c_func
(paren
id|sock_rspace
c_func
(paren
id|sk
)paren
op_div
l_int|2
comma
id|sk-&gt;mss
comma
op_amp
id|tp-&gt;rcv_wnd
comma
op_amp
id|tp-&gt;window_clamp
comma
id|sysctl_tcp_window_scaling
comma
op_amp
id|tp-&gt;rcv_wscale
)paren
suffix:semicolon
id|th-&gt;window
op_assign
id|htons
c_func
(paren
id|tp-&gt;rcv_wnd
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Put in the TCP options to say MTU.&n;&t; */
id|tmp
op_assign
id|tcp_syn_build_options
c_func
(paren
id|buff
comma
id|sk-&gt;mss
comma
id|sysctl_tcp_sack
comma
id|sysctl_tcp_timestamps
comma
id|sysctl_tcp_window_scaling
comma
id|tp-&gt;rcv_wscale
)paren
suffix:semicolon
id|th-&gt;doff
op_assign
r_sizeof
(paren
op_star
id|th
)paren
op_div
l_int|4
op_plus
(paren
id|tmp
op_rshift
l_int|2
)paren
suffix:semicolon
id|buff-&gt;csum
op_assign
l_int|0
suffix:semicolon
id|tcp_v6_send_check
c_func
(paren
id|sk
comma
id|th
comma
r_sizeof
(paren
r_struct
id|tcphdr
)paren
op_plus
id|tmp
comma
id|buff
)paren
suffix:semicolon
id|tcp_set_state
c_func
(paren
id|sk
comma
id|TCP_SYN_SENT
)paren
suffix:semicolon
multiline_comment|/* Socket identity change complete, no longer&n;&t; * in TCP_CLOSE, so rehash.&n;&t; */
id|sk-&gt;prot
op_member_access_from_pointer
id|rehash
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* FIXME: should use dcache-&gt;rtt if availiable */
id|tp-&gt;rto
op_assign
id|TCP_TIMEOUT_INIT
suffix:semicolon
id|tcp_init_xmit_timers
c_func
(paren
id|sk
)paren
suffix:semicolon
id|tp-&gt;retransmits
op_assign
l_int|0
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;write_queue
comma
id|buff
)paren
suffix:semicolon
id|tp-&gt;packets_out
op_increment
suffix:semicolon
id|buff-&gt;when
op_assign
id|jiffies
suffix:semicolon
id|skb1
op_assign
id|skb_clone
c_func
(paren
id|buff
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|skb_set_owner_w
c_func
(paren
id|skb1
comma
id|sk
)paren
suffix:semicolon
id|tcp_v6_xmit
c_func
(paren
id|skb1
)paren
suffix:semicolon
multiline_comment|/* Timer for repeating the SYN until an answer  */
id|tcp_reset_xmit_timer
c_func
(paren
id|sk
comma
id|TIME_RETRANS
comma
id|tp-&gt;rto
)paren
suffix:semicolon
id|tcp_statistics.TcpActiveOpens
op_increment
suffix:semicolon
id|tcp_statistics.TcpOutSegs
op_increment
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tcp_v6_sendmsg
r_static
r_int
id|tcp_v6_sendmsg
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
op_amp
id|sk-&gt;net_pinfo.af_inet6
suffix:semicolon
r_int
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Do sanity checking for sendmsg/sendto/send&n;&t; */
r_if
c_cond
(paren
id|msg-&gt;msg_flags
op_amp
op_complement
(paren
id|MSG_OOB
op_or
id|MSG_DONTROUTE
op_or
id|MSG_DONTWAIT
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_name
)paren
(brace
r_struct
id|sockaddr_in6
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_namelen
OL
r_sizeof
(paren
op_star
id|addr
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sin6_family
op_logical_and
id|addr-&gt;sin6_family
op_ne
id|AF_INET6
)paren
r_goto
id|out
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_eq
id|TCP_CLOSE
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|retval
op_assign
op_minus
id|EISCONN
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sin6_port
op_ne
id|sk-&gt;dummy_th.dest
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|addr-&gt;sin6_addr
comma
op_amp
id|np-&gt;daddr
)paren
)paren
r_goto
id|out
suffix:semicolon
)brace
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|retval
op_assign
id|tcp_do_sendmsg
c_func
(paren
id|sk
comma
id|msg-&gt;msg_iovlen
comma
id|msg-&gt;msg_iov
comma
id|msg-&gt;msg_flags
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|tcp_v6_err
r_void
id|tcp_v6_err
c_func
(paren
r_int
id|type
comma
r_int
id|code
comma
r_int
r_char
op_star
id|header
comma
id|__u32
id|info
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|inet6_protocol
op_star
id|protocol
)paren
(brace
r_struct
id|tcphdr
op_star
id|th
op_assign
(paren
r_struct
id|tcphdr
op_star
)paren
id|header
suffix:semicolon
r_struct
id|ipv6_pinfo
op_star
id|np
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|opening
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|tp
suffix:semicolon
macro_line|#ifdef ICMP_PARANOIA
id|__u32
id|seq
suffix:semicolon
macro_line|#endif
multiline_comment|/* XXX: length check for tcphdr missing here */
id|sk
op_assign
id|tcp_v6_lookup
c_func
(paren
id|daddr
comma
id|th-&gt;dest
comma
id|saddr
comma
id|th-&gt;source
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* XXX: Update ICMP error count */
r_return
suffix:semicolon
)brace
id|tp
op_assign
op_amp
id|sk-&gt;tp_pinfo.af_tcp
suffix:semicolon
macro_line|#ifdef ICMP_PARANOIA
id|seq
op_assign
id|ntohl
c_func
(paren
id|th-&gt;seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_LISTEN
op_logical_and
op_logical_neg
id|between
c_func
(paren
id|seq
comma
id|tp-&gt;snd_una
comma
id|tp-&gt;snd_nxt
)paren
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;icmp packet outside the tcp window:&quot;
l_string|&quot; s:%d %u,%u,%u&bslash;n&quot;
comma
(paren
r_int
)paren
id|sk-&gt;state
comma
id|seq
comma
id|tp-&gt;snd_una
comma
id|tp-&gt;snd_nxt
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
id|np
op_assign
op_amp
id|sk-&gt;net_pinfo.af_inet6
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|ICMPV6_PKT_TOOBIG
op_logical_and
id|sk-&gt;state
op_ne
id|TCP_LISTEN
)paren
(brace
multiline_comment|/* icmp should have updated the destination cache entry */
r_if
c_cond
(paren
id|sk-&gt;dst_cache
)paren
id|dst_check
c_func
(paren
op_amp
id|sk-&gt;dst_cache
comma
id|np-&gt;dst_cookie
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;dst_cache
op_eq
l_int|NULL
)paren
(brace
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
id|fl.proto
op_assign
id|IPPROTO_TCP
suffix:semicolon
id|fl.nl_u.ip6_u.daddr
op_assign
op_amp
id|np-&gt;daddr
suffix:semicolon
id|fl.nl_u.ip6_u.saddr
op_assign
op_amp
id|np-&gt;saddr
suffix:semicolon
id|fl.dev
op_assign
id|np-&gt;oif
suffix:semicolon
id|fl.uli_u.ports.dport
op_assign
id|sk-&gt;dummy_th.dest
suffix:semicolon
id|fl.uli_u.ports.sport
op_assign
id|sk-&gt;dummy_th.source
suffix:semicolon
id|dst
op_assign
id|ip6_route_output
c_func
(paren
id|sk
comma
op_amp
id|fl
)paren
suffix:semicolon
id|ip6_dst_store
c_func
(paren
id|sk
comma
id|dst
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;dst_cache-&gt;error
)paren
id|sk-&gt;err_soft
op_assign
id|sk-&gt;dst_cache-&gt;error
suffix:semicolon
r_else
id|sk-&gt;mtu
op_assign
id|sk-&gt;dst_cache-&gt;pmtu
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sock_readers
)paren
(brace
multiline_comment|/* remove later */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;tcp_v6_err: pmtu disc: socket locked.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tcp_simple_retransmit
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|opening
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Might be for an open_request */
r_switch
c_cond
(paren
id|sk-&gt;state
)paren
(brace
r_struct
id|open_request
op_star
id|req
comma
op_star
id|prev
suffix:semicolon
r_struct
id|ipv6hdr
id|hd
suffix:semicolon
r_case
id|TCP_LISTEN
suffix:colon
r_if
c_cond
(paren
id|sk-&gt;sock_readers
)paren
r_return
suffix:semicolon
multiline_comment|/* Grrrr - fix this later. */
id|ipv6_addr_copy
c_func
(paren
op_amp
id|hd.saddr
comma
id|saddr
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|hd.daddr
comma
id|daddr
)paren
suffix:semicolon
id|req
op_assign
id|tcp_v6_search_req
c_func
(paren
id|tp
comma
op_amp
id|hd
comma
id|th
comma
op_amp
id|prev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|req
)paren
r_return
suffix:semicolon
macro_line|#ifdef ICMP_PARANOIA
r_if
c_cond
(paren
id|seq
op_ne
id|req-&gt;snt_isn
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;icmp packet for openreq &quot;
l_string|&quot;with wrong seq number:%d:%d&bslash;n&quot;
comma
id|seq
comma
id|req-&gt;snt_isn
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif&t;&t;
r_if
c_cond
(paren
id|req-&gt;sk
)paren
(brace
id|sk
op_assign
id|req-&gt;sk
suffix:semicolon
multiline_comment|/* report error in accept */
)brace
r_else
(brace
id|tcp_synq_unlink
c_func
(paren
id|tp
comma
id|req
comma
id|prev
)paren
suffix:semicolon
id|req
op_member_access_from_pointer
r_class
op_member_access_from_pointer
id|destructor
c_func
(paren
id|req
)paren
suffix:semicolon
id|tcp_openreq_free
c_func
(paren
id|req
)paren
suffix:semicolon
)brace
multiline_comment|/* FALL THROUGH */
r_case
id|TCP_SYN_SENT
suffix:colon
r_case
id|TCP_SYN_RECV
suffix:colon
id|opening
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|icmpv6_err_convert
c_func
(paren
id|type
comma
id|code
comma
op_amp
id|err
)paren
op_logical_or
id|opening
)paren
(brace
id|sk-&gt;err
op_assign
id|err
suffix:semicolon
r_if
c_cond
(paren
id|opening
)paren
(brace
id|tcp_statistics.TcpAttemptFails
op_increment
suffix:semicolon
id|tcp_set_state
c_func
(paren
id|sk
comma
id|TCP_CLOSE
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|error_report
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|sk-&gt;err_soft
op_assign
id|err
suffix:semicolon
)brace
)brace
multiline_comment|/* FIXME: this is substantially similar to the ipv4 code.&n; * Can some kind of merge be done? -- erics&n; */
DECL|function|tcp_v6_send_synack
r_static
r_void
id|tcp_v6_send_synack
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|open_request
op_star
id|req
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|tcphdr
op_star
id|th
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
r_int
id|tmp
suffix:semicolon
id|skb
op_assign
id|sock_wmalloc
c_func
(paren
id|sk
comma
id|MAX_SYN_SIZE
comma
l_int|1
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|fl.proto
op_assign
id|IPPROTO_TCP
suffix:semicolon
id|fl.nl_u.ip6_u.daddr
op_assign
op_amp
id|req-&gt;af.v6_req.rmt_addr
suffix:semicolon
id|fl.nl_u.ip6_u.saddr
op_assign
op_amp
id|req-&gt;af.v6_req.loc_addr
suffix:semicolon
id|fl.dev
op_assign
id|req-&gt;af.v6_req.dev
suffix:semicolon
id|fl.uli_u.ports.dport
op_assign
id|req-&gt;rmt_port
suffix:semicolon
id|fl.uli_u.ports.sport
op_assign
id|sk-&gt;dummy_th.source
suffix:semicolon
id|dst
op_assign
id|ip6_route_output
c_func
(paren
id|sk
comma
op_amp
id|fl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst-&gt;error
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dst-&gt;dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
(paren
id|skb-&gt;dev-&gt;hard_header_len
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
)paren
suffix:semicolon
id|skb-&gt;nh.ipv6h
op_assign
(paren
r_struct
id|ipv6hdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
)paren
suffix:semicolon
id|skb-&gt;h.th
op_assign
id|th
op_assign
(paren
r_struct
id|tcphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|tcphdr
)paren
)paren
suffix:semicolon
multiline_comment|/* Yuck, make this header setup more efficient... -DaveM */
id|memset
c_func
(paren
id|th
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tcphdr
)paren
)paren
suffix:semicolon
id|th-&gt;syn
op_assign
l_int|1
suffix:semicolon
id|th-&gt;ack
op_assign
l_int|1
suffix:semicolon
id|th-&gt;source
op_assign
id|sk-&gt;dummy_th.source
suffix:semicolon
id|th-&gt;dest
op_assign
id|req-&gt;rmt_port
suffix:semicolon
id|skb-&gt;seq
op_assign
id|req-&gt;snt_isn
suffix:semicolon
id|skb-&gt;end_seq
op_assign
id|skb-&gt;seq
op_plus
l_int|1
suffix:semicolon
id|th-&gt;seq
op_assign
id|ntohl
c_func
(paren
id|skb-&gt;seq
)paren
suffix:semicolon
id|th-&gt;ack_seq
op_assign
id|htonl
c_func
(paren
id|req-&gt;rcv_isn
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Don&squot;t offer more than they did.&n;&t; * This way we don&squot;t have to memorize who said what.&n;&t; * FIXME: the selection of initial mss here doesn&squot;t quite&n;&t; * match what happens under IPV4. Figure out the right thing to do.&n;&t; */
id|req-&gt;mss
op_assign
id|min
c_func
(paren
id|sk-&gt;mss
comma
id|req-&gt;mss
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;mss
OL
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;initial req-&gt;mss below 1&bslash;n&quot;
)paren
suffix:semicolon
id|req-&gt;mss
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|req-&gt;rcv_wnd
op_eq
l_int|0
)paren
(brace
id|__u8
id|rcv_wscale
suffix:semicolon
multiline_comment|/* Set this up on the first call only */
id|req-&gt;window_clamp
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: should be in dst cache */
id|tcp_select_initial_window
c_func
(paren
id|sock_rspace
c_func
(paren
id|sk
)paren
op_div
l_int|2
comma
id|req-&gt;mss
comma
op_amp
id|req-&gt;rcv_wnd
comma
op_amp
id|req-&gt;window_clamp
comma
id|req-&gt;wscale_ok
comma
op_amp
id|rcv_wscale
)paren
suffix:semicolon
id|req-&gt;rcv_wscale
op_assign
id|rcv_wscale
suffix:semicolon
)brace
id|th-&gt;window
op_assign
id|htons
c_func
(paren
id|req-&gt;rcv_wnd
)paren
suffix:semicolon
id|tmp
op_assign
id|tcp_syn_build_options
c_func
(paren
id|skb
comma
id|req-&gt;mss
comma
id|req-&gt;sack_ok
comma
id|req-&gt;tstamp_ok
comma
id|req-&gt;wscale_ok
comma
id|req-&gt;rcv_wscale
)paren
suffix:semicolon
id|skb-&gt;csum
op_assign
l_int|0
suffix:semicolon
id|th-&gt;doff
op_assign
(paren
r_sizeof
(paren
op_star
id|th
)paren
op_plus
id|tmp
)paren
op_rshift
l_int|2
suffix:semicolon
id|th-&gt;check
op_assign
id|tcp_v6_check
c_func
(paren
id|th
comma
r_sizeof
(paren
op_star
id|th
)paren
op_plus
id|tmp
comma
op_amp
id|req-&gt;af.v6_req.loc_addr
comma
op_amp
id|req-&gt;af.v6_req.rmt_addr
comma
id|csum_partial
c_func
(paren
(paren
r_char
op_star
)paren
id|th
comma
r_sizeof
(paren
op_star
id|th
)paren
op_plus
id|tmp
comma
id|skb-&gt;csum
)paren
)paren
suffix:semicolon
id|ip6_dst_store
c_func
(paren
id|sk
comma
id|dst
)paren
suffix:semicolon
id|ip6_xmit
c_func
(paren
id|sk
comma
id|skb
comma
op_amp
id|fl
comma
id|req-&gt;af.v6_req.opt
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
id|tcp_statistics.TcpOutSegs
op_increment
suffix:semicolon
)brace
DECL|function|tcp_v6_or_free
r_static
r_void
id|tcp_v6_or_free
c_func
(paren
r_struct
id|open_request
op_star
id|req
)paren
(brace
)brace
DECL|variable|or_ipv6
r_static
r_struct
id|or_calltable
id|or_ipv6
op_assign
(brace
id|tcp_v6_send_synack
comma
id|tcp_v6_or_free
comma
id|tcp_v6_send_reset
)brace
suffix:semicolon
multiline_comment|/* FIXME: this is substantially similar to the ipv4 code.&n; * Can some kind of merge be done? -- erics&n; */
DECL|function|tcp_v6_conn_request
r_static
r_int
id|tcp_v6_conn_request
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_void
op_star
id|ptr
comma
id|__u32
id|isn
)paren
(brace
r_struct
id|tcp_opt
id|tp
suffix:semicolon
r_struct
id|open_request
op_star
id|req
suffix:semicolon
multiline_comment|/* If the socket is dead, don&squot;t accept the connection.&t;*/
r_if
c_cond
(paren
id|sk-&gt;dead
)paren
(brace
id|SOCK_DEBUG
c_func
(paren
id|sk
comma
l_string|&quot;Reset on %p: Connect on dead socket.&bslash;n&quot;
comma
id|sk
)paren
suffix:semicolon
id|tcp_statistics.TcpAttemptFails
op_increment
suffix:semicolon
r_return
op_minus
id|ENOTCONN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;protocol
op_eq
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
r_return
id|tcp_v4_conn_request
c_func
(paren
id|sk
comma
id|skb
comma
id|ptr
comma
id|isn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isn
op_eq
l_int|0
)paren
id|isn
op_assign
id|tcp_v6_init_sequence
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;There are no SYN attacks on IPv6, yet...&n;&t; */
r_if
c_cond
(paren
id|sk-&gt;ack_backlog
op_ge
id|sk-&gt;max_ack_backlog
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;droping syn ack:%d max:%d&bslash;n&quot;
comma
id|sk-&gt;ack_backlog
comma
id|sk-&gt;max_ack_backlog
)paren
suffix:semicolon
id|tcp_statistics.TcpAttemptFails
op_increment
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|req
op_assign
id|tcp_openreq_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req
op_eq
l_int|NULL
)paren
(brace
id|tcp_statistics.TcpAttemptFails
op_increment
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|sk-&gt;ack_backlog
op_increment
suffix:semicolon
id|req-&gt;rcv_wnd
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* So that tcp_send_synack() knows! */
id|req-&gt;rcv_isn
op_assign
id|skb-&gt;seq
suffix:semicolon
id|req-&gt;snt_isn
op_assign
id|isn
suffix:semicolon
id|tp.tstamp_ok
op_assign
id|tp.sack_ok
op_assign
id|tp.wscale_ok
op_assign
id|tp.snd_wscale
op_assign
l_int|0
suffix:semicolon
id|tp.in_mss
op_assign
l_int|536
suffix:semicolon
id|tcp_parse_options
c_func
(paren
id|skb-&gt;h.th
comma
op_amp
id|tp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp.saw_tstamp
)paren
id|req-&gt;ts_recent
op_assign
id|tp.rcv_tsval
suffix:semicolon
id|req-&gt;mss
op_assign
id|tp.in_mss
suffix:semicolon
id|req-&gt;tstamp_ok
op_assign
id|tp.tstamp_ok
suffix:semicolon
id|req-&gt;sack_ok
op_assign
id|tp.sack_ok
suffix:semicolon
id|req-&gt;snd_wscale
op_assign
id|tp.snd_wscale
suffix:semicolon
id|req-&gt;wscale_ok
op_assign
id|tp.wscale_ok
suffix:semicolon
id|req-&gt;rmt_port
op_assign
id|skb-&gt;h.th-&gt;source
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|req-&gt;af.v6_req.rmt_addr
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|req-&gt;af.v6_req.loc_addr
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
)paren
suffix:semicolon
id|req-&gt;af.v6_req.opt
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* FIXME: options */
id|req-&gt;af.v6_req.dev
op_assign
id|skb-&gt;dev
suffix:semicolon
multiline_comment|/* So that link locals have meaning */
id|req
op_member_access_from_pointer
r_class
op_assign
op_amp
id|or_ipv6
suffix:semicolon
id|req-&gt;retrans
op_assign
l_int|0
suffix:semicolon
id|req-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
id|tcp_v6_send_synack
c_func
(paren
id|sk
comma
id|req
)paren
suffix:semicolon
id|req-&gt;expires
op_assign
id|jiffies
op_plus
id|TCP_TIMEOUT_INIT
suffix:semicolon
id|tcp_inc_slow_timer
c_func
(paren
id|TCP_SLT_SYNACK
)paren
suffix:semicolon
id|tcp_synq_queue
c_func
(paren
op_amp
id|sk-&gt;tp_pinfo.af_tcp
comma
id|req
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
l_int|0
)paren
suffix:semicolon
m_exit
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tcp_v6_send_check
r_static
r_void
id|tcp_v6_send_check
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|tcphdr
op_star
id|th
comma
r_int
id|len
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
op_amp
id|sk-&gt;net_pinfo.af_inet6
suffix:semicolon
id|th-&gt;check
op_assign
l_int|0
suffix:semicolon
id|th-&gt;check
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|np-&gt;saddr
comma
op_amp
id|np-&gt;daddr
comma
id|len
comma
id|IPPROTO_TCP
comma
id|csum_partial
c_func
(paren
(paren
r_char
op_star
)paren
id|th
comma
id|th-&gt;doff
op_lshift
l_int|2
comma
id|skb-&gt;csum
)paren
)paren
suffix:semicolon
)brace
DECL|function|tcp_v6_syn_recv_sock
r_static
r_struct
id|sock
op_star
id|tcp_v6_syn_recv_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|open_request
op_star
id|req
comma
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|newtp
suffix:semicolon
r_struct
id|sock
op_star
id|newsk
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;protocol
op_eq
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;v6 mapped&n;&t;&t; */
id|newsk
op_assign
id|tcp_v4_syn_recv_sock
c_func
(paren
id|sk
comma
id|skb
comma
id|req
comma
id|dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newsk
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|np
op_assign
op_amp
id|newsk-&gt;net_pinfo.af_inet6
suffix:semicolon
id|ipv6_addr_set
c_func
(paren
op_amp
id|np-&gt;daddr
comma
l_int|0
comma
l_int|0
comma
id|__constant_htonl
c_func
(paren
l_int|0x0000FFFF
)paren
comma
id|newsk-&gt;daddr
)paren
suffix:semicolon
id|ipv6_addr_set
c_func
(paren
op_amp
id|np-&gt;saddr
comma
l_int|0
comma
l_int|0
comma
id|__constant_htonl
c_func
(paren
l_int|0x0000FFFF
)paren
comma
id|newsk-&gt;saddr
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|np-&gt;rcv_saddr
comma
op_amp
id|np-&gt;saddr
)paren
suffix:semicolon
id|newsk-&gt;tp_pinfo.af_tcp.af_specific
op_assign
op_amp
id|ipv6_mapped
suffix:semicolon
id|newsk-&gt;backlog_rcv
op_assign
id|tcp_v4_do_rcv
suffix:semicolon
r_return
id|newsk
suffix:semicolon
)brace
id|newsk
op_assign
id|sk_alloc
c_func
(paren
id|AF_INET6
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newsk
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|dst
)paren
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|newsk
comma
id|sk
comma
r_sizeof
(paren
op_star
id|newsk
)paren
)paren
suffix:semicolon
multiline_comment|/* Or else we die! -DaveM */
id|newsk-&gt;sklist_next
op_assign
l_int|NULL
suffix:semicolon
id|newsk-&gt;opt
op_assign
l_int|NULL
suffix:semicolon
id|newsk-&gt;dst_cache
op_assign
l_int|NULL
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|newsk-&gt;write_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|newsk-&gt;receive_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|newsk-&gt;out_of_order_queue
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|newsk-&gt;error_queue
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Unused&n;&t; */
id|newtp
op_assign
op_amp
(paren
id|newsk-&gt;tp_pinfo.af_tcp
)paren
suffix:semicolon
id|np
op_assign
op_amp
id|newsk-&gt;net_pinfo.af_inet6
suffix:semicolon
id|newtp-&gt;send_head
op_assign
l_int|NULL
suffix:semicolon
id|newtp-&gt;retrans_head
op_assign
l_int|NULL
suffix:semicolon
id|newtp-&gt;pending
op_assign
l_int|0
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|newsk-&gt;back_log
)paren
suffix:semicolon
id|newsk-&gt;prot
op_member_access_from_pointer
id|init
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|newtp-&gt;snd_cwnd_cnt
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0 /* Don&squot;t mess up the initialization we did in the init routine! */
id|newtp-&gt;snd_ssthresh
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|newtp-&gt;backoff
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;proc
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;done
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;pair
op_assign
l_int|NULL
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|newsk-&gt;wmem_alloc
comma
l_int|0
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|newsk-&gt;rmem_alloc
comma
l_int|0
)paren
suffix:semicolon
id|newsk-&gt;localroute
op_assign
id|sk-&gt;localroute
suffix:semicolon
id|newsk-&gt;err
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;shutdown
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;ack_backlog
op_assign
l_int|0
suffix:semicolon
id|newtp-&gt;fin_seq
op_assign
id|req-&gt;rcv_isn
suffix:semicolon
id|newsk-&gt;syn_seq
op_assign
id|req-&gt;rcv_isn
suffix:semicolon
id|newsk-&gt;state
op_assign
id|TCP_SYN_RECV
suffix:semicolon
id|newsk-&gt;timeout
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;write_seq
op_assign
id|req-&gt;snt_isn
suffix:semicolon
id|newtp-&gt;snd_wnd
op_assign
id|ntohs
c_func
(paren
id|skb-&gt;h.th-&gt;window
)paren
suffix:semicolon
id|newtp-&gt;max_window
op_assign
id|newtp-&gt;snd_wnd
suffix:semicolon
id|newtp-&gt;snd_wl1
op_assign
id|req-&gt;rcv_isn
suffix:semicolon
id|newtp-&gt;snd_wl2
op_assign
id|newsk-&gt;write_seq
suffix:semicolon
id|newtp-&gt;snd_una
op_assign
id|newsk-&gt;write_seq
op_increment
suffix:semicolon
id|newtp-&gt;snd_nxt
op_assign
id|newsk-&gt;write_seq
suffix:semicolon
id|newsk-&gt;urg_data
op_assign
l_int|0
suffix:semicolon
id|newtp-&gt;packets_out
op_assign
l_int|0
suffix:semicolon
id|newtp-&gt;retransmits
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;linger
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;destroy
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|newsk-&gt;timer
)paren
suffix:semicolon
id|newsk-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|newsk
suffix:semicolon
id|newsk-&gt;timer.function
op_assign
op_amp
id|net_timer
suffix:semicolon
id|tcp_init_xmit_timers
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|newsk-&gt;dummy_th.source
op_assign
id|sk-&gt;dummy_th.source
suffix:semicolon
id|newsk-&gt;dummy_th.dest
op_assign
id|req-&gt;rmt_port
suffix:semicolon
id|newsk-&gt;sock_readers
op_assign
l_int|0
suffix:semicolon
id|newtp-&gt;rcv_nxt
op_assign
id|req-&gt;rcv_isn
op_plus
l_int|1
suffix:semicolon
id|newtp-&gt;rcv_wup
op_assign
id|req-&gt;rcv_isn
op_plus
l_int|1
suffix:semicolon
id|newsk-&gt;copied_seq
op_assign
id|req-&gt;rcv_isn
op_plus
l_int|1
suffix:semicolon
id|newsk-&gt;socket
op_assign
l_int|NULL
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|np-&gt;daddr
comma
op_amp
id|req-&gt;af.v6_req.rmt_addr
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|np-&gt;saddr
comma
op_amp
id|req-&gt;af.v6_req.loc_addr
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|np-&gt;rcv_saddr
comma
op_amp
id|req-&gt;af.v6_req.loc_addr
)paren
suffix:semicolon
id|np-&gt;oif
op_assign
id|req-&gt;af.v6_req.dev
suffix:semicolon
r_if
c_cond
(paren
id|dst
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/*&n;&t;     *&t;options / mss / route cache&n;&t;     */
id|fl.proto
op_assign
id|IPPROTO_TCP
suffix:semicolon
id|fl.nl_u.ip6_u.daddr
op_assign
op_amp
id|np-&gt;daddr
suffix:semicolon
id|fl.nl_u.ip6_u.saddr
op_assign
op_amp
id|np-&gt;saddr
suffix:semicolon
id|fl.dev
op_assign
id|np-&gt;oif
suffix:semicolon
id|fl.uli_u.ports.dport
op_assign
id|newsk-&gt;dummy_th.dest
suffix:semicolon
id|fl.uli_u.ports.sport
op_assign
id|newsk-&gt;dummy_th.source
suffix:semicolon
id|dst
op_assign
id|ip6_route_output
c_func
(paren
id|newsk
comma
op_amp
id|fl
)paren
suffix:semicolon
)brace
id|ip6_dst_store
c_func
(paren
id|newsk
comma
id|dst
)paren
suffix:semicolon
id|newtp-&gt;sack_ok
op_assign
id|req-&gt;sack_ok
suffix:semicolon
id|newtp-&gt;tstamp_ok
op_assign
id|req-&gt;tstamp_ok
suffix:semicolon
id|newtp-&gt;snd_wscale
op_assign
id|req-&gt;snd_wscale
suffix:semicolon
id|newtp-&gt;wscale_ok
op_assign
id|req-&gt;wscale_ok
suffix:semicolon
id|newtp-&gt;ts_recent
op_assign
id|req-&gt;ts_recent
suffix:semicolon
r_if
c_cond
(paren
id|newtp-&gt;tstamp_ok
)paren
(brace
id|newtp-&gt;tcp_header_len
op_assign
r_sizeof
(paren
r_struct
id|tcphdr
)paren
op_plus
l_int|12
suffix:semicolon
multiline_comment|/* FIXME: define the contant. */
id|newsk-&gt;dummy_th.doff
op_add_assign
l_int|3
suffix:semicolon
)brace
r_else
(brace
id|newtp-&gt;tcp_header_len
op_assign
r_sizeof
(paren
r_struct
id|tcphdr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dst-&gt;error
)paren
id|newsk-&gt;mtu
op_assign
id|req-&gt;af.v6_req.dev-&gt;mtu
suffix:semicolon
r_else
id|newsk-&gt;mtu
op_assign
id|dst-&gt;pmtu
suffix:semicolon
id|newsk-&gt;mss
op_assign
id|min
c_func
(paren
id|req-&gt;mss
op_plus
r_sizeof
(paren
r_struct
id|tcphdr
)paren
op_minus
id|newtp-&gt;tcp_header_len
comma
(paren
id|newsk-&gt;mtu
op_minus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
op_minus
id|newtp-&gt;tcp_header_len
)paren
)paren
suffix:semicolon
multiline_comment|/* XXX tp-&gt;window_clamp??? -DaveM */
id|newsk-&gt;daddr
op_assign
id|LOOPBACK4_IPV6
suffix:semicolon
id|newsk-&gt;saddr
op_assign
id|LOOPBACK4_IPV6
suffix:semicolon
id|newsk-&gt;rcv_saddr
op_assign
id|LOOPBACK4_IPV6
suffix:semicolon
id|newsk-&gt;prot
op_member_access_from_pointer
id|hash
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|add_to_prot_sklist
c_func
(paren
id|newsk
)paren
suffix:semicolon
r_return
id|newsk
suffix:semicolon
)brace
DECL|function|tcp_v6_send_reset
r_static
r_void
id|tcp_v6_send_reset
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|tcphdr
op_star
id|th
op_assign
id|skb-&gt;h.th
comma
op_star
id|t1
suffix:semicolon
r_struct
id|sk_buff
op_star
id|buff
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
r_if
c_cond
(paren
id|th-&gt;rst
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * We need to grab some memory, and put together an RST,&n;&t; * and then put it into the queue to be sent.&n;&t; */
id|buff
op_assign
id|alloc_skb
c_func
(paren
id|MAX_RESET_SIZE
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buff
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|buff-&gt;dev
op_assign
id|skb-&gt;dev
suffix:semicolon
id|tcp_v6_build_header
c_func
(paren
l_int|NULL
comma
id|buff
)paren
suffix:semicolon
id|t1
op_assign
(paren
r_struct
id|tcphdr
op_star
)paren
id|skb_put
c_func
(paren
id|buff
comma
r_sizeof
(paren
r_struct
id|tcphdr
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|t1
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|t1
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Swap the send and the receive. &n;&t; */
id|t1-&gt;dest
op_assign
id|th-&gt;source
suffix:semicolon
id|t1-&gt;source
op_assign
id|th-&gt;dest
suffix:semicolon
id|t1-&gt;doff
op_assign
r_sizeof
(paren
op_star
id|t1
)paren
op_div
l_int|4
suffix:semicolon
id|t1-&gt;rst
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|th-&gt;ack
)paren
(brace
id|t1-&gt;seq
op_assign
id|th-&gt;ack_seq
suffix:semicolon
)brace
r_else
(brace
id|t1-&gt;ack
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|th-&gt;syn
)paren
(brace
id|t1-&gt;ack_seq
op_assign
id|th-&gt;seq
suffix:semicolon
)brace
r_else
id|t1-&gt;ack_seq
op_assign
id|htonl
c_func
(paren
id|ntohl
c_func
(paren
id|th-&gt;seq
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
id|buff-&gt;csum
op_assign
id|csum_partial
c_func
(paren
(paren
r_char
op_star
)paren
id|t1
comma
r_sizeof
(paren
op_star
id|t1
)paren
comma
l_int|0
)paren
suffix:semicolon
id|fl.nl_u.ip6_u.daddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
suffix:semicolon
id|fl.nl_u.ip6_u.saddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
suffix:semicolon
id|t1-&gt;check
op_assign
id|csum_ipv6_magic
c_func
(paren
id|fl.nl_u.ip6_u.saddr
comma
id|fl.nl_u.ip6_u.daddr
comma
r_sizeof
(paren
op_star
id|t1
)paren
comma
id|IPPROTO_TCP
comma
id|buff-&gt;csum
)paren
suffix:semicolon
id|fl.proto
op_assign
id|IPPROTO_TCP
suffix:semicolon
id|fl.dev
op_assign
id|skb-&gt;dev
suffix:semicolon
id|fl.uli_u.ports.dport
op_assign
id|t1-&gt;dest
suffix:semicolon
id|fl.uli_u.ports.sport
op_assign
id|t1-&gt;source
suffix:semicolon
id|ip6_xmit
c_func
(paren
l_int|NULL
comma
id|buff
comma
op_amp
id|fl
comma
l_int|NULL
)paren
suffix:semicolon
id|tcp_statistics.TcpOutSegs
op_increment
suffix:semicolon
id|tcp_statistics.TcpOutRsts
op_increment
suffix:semicolon
)brace
DECL|function|tcp_v6_search_req
r_static
r_struct
id|open_request
op_star
id|tcp_v6_search_req
c_func
(paren
r_struct
id|tcp_opt
op_star
id|tp
comma
r_struct
id|ipv6hdr
op_star
id|ip6h
comma
r_struct
id|tcphdr
op_star
id|th
comma
r_struct
id|open_request
op_star
op_star
id|prevp
)paren
(brace
r_struct
id|open_request
op_star
id|req
comma
op_star
id|prev
suffix:semicolon
id|__u16
id|rport
op_assign
id|th-&gt;source
suffix:semicolon
multiline_comment|/*&t;assumption: the socket is not in use.&n;&t; *&t;as we checked the user count on tcp_rcv and we&squot;re&n;&t; *&t;running from a soft interrupt.&n;&t; */
id|prev
op_assign
(paren
r_struct
id|open_request
op_star
)paren
(paren
op_amp
id|tp-&gt;syn_wait_queue
)paren
suffix:semicolon
r_for
c_loop
(paren
id|req
op_assign
id|prev-&gt;dl_next
suffix:semicolon
id|req
suffix:semicolon
id|req
op_assign
id|req-&gt;dl_next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|req-&gt;af.v6_req.rmt_addr
comma
op_amp
id|ip6h-&gt;saddr
)paren
op_logical_and
op_logical_neg
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|req-&gt;af.v6_req.loc_addr
comma
op_amp
id|ip6h-&gt;daddr
)paren
op_logical_and
id|req-&gt;rmt_port
op_eq
id|rport
)paren
(brace
op_star
id|prevp
op_assign
id|prev
suffix:semicolon
r_return
id|req
suffix:semicolon
)brace
id|prev
op_assign
id|req
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|tcp_v6_rst_req
r_static
r_void
id|tcp_v6_rst_req
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|tcp_opt
op_star
id|tp
op_assign
op_amp
id|sk-&gt;tp_pinfo.af_tcp
suffix:semicolon
r_struct
id|open_request
op_star
id|req
comma
op_star
id|prev
suffix:semicolon
id|req
op_assign
id|tcp_v6_search_req
c_func
(paren
id|tp
comma
id|skb-&gt;nh.ipv6h
comma
id|skb-&gt;h.th
comma
op_amp
id|prev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|req
)paren
r_return
suffix:semicolon
multiline_comment|/* Sequence number check required by RFC793 */
r_if
c_cond
(paren
id|before
c_func
(paren
id|skb-&gt;seq
comma
id|req-&gt;snt_isn
)paren
op_logical_or
id|after
c_func
(paren
id|skb-&gt;seq
comma
id|req-&gt;snt_isn
op_plus
l_int|1
)paren
)paren
r_return
suffix:semicolon
id|tcp_synq_unlink
c_func
(paren
id|tp
comma
id|req
comma
id|prev
)paren
suffix:semicolon
id|req
op_member_access_from_pointer
r_class
op_member_access_from_pointer
id|destructor
c_func
(paren
id|req
)paren
suffix:semicolon
id|tcp_openreq_free
c_func
(paren
id|req
)paren
suffix:semicolon
)brace
DECL|function|tcp_v6_rcv
r_int
id|tcp_v6_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|ipv6_options
op_star
id|opt
comma
r_int
r_int
id|len
comma
r_int
id|redo
comma
r_struct
id|inet6_protocol
op_star
id|protocol
)paren
(brace
r_struct
id|tcphdr
op_star
id|th
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
multiline_comment|/*&n;&t; * &quot;redo&quot; is 1 if we have already seen this skb but couldn&squot;t&n;&t; * use it at that time (the socket was locked).  In that case&n;&t; * we have already done a lot of the work (looked up the socket&n;&t; * etc).&n;&t; */
id|th
op_assign
id|skb-&gt;h.th
suffix:semicolon
id|sk
op_assign
id|skb-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|redo
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_ne
id|PACKET_HOST
)paren
r_goto
id|discard_it
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Pull up the IP header.&n;&t;&t; */
id|__skb_pull
c_func
(paren
id|skb
comma
id|skb-&gt;h.raw
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Count it even if it&squot;s bad.&n;&t;&t; */
id|tcp_statistics.TcpInSegs
op_increment
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Try to use the device checksum if provided.&n;&t;&t; */
r_switch
c_cond
(paren
id|skb-&gt;ip_summed
)paren
(brace
r_case
id|CHECKSUM_NONE
suffix:colon
id|skb-&gt;csum
op_assign
id|csum_partial
c_func
(paren
(paren
r_char
op_star
)paren
id|th
comma
id|len
comma
l_int|0
)paren
suffix:semicolon
r_case
id|CHECKSUM_HW
suffix:colon
r_if
c_cond
(paren
id|tcp_v6_check
c_func
(paren
id|th
comma
id|len
comma
id|saddr
comma
id|daddr
comma
id|skb-&gt;csum
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;tcp csum failed&bslash;n&quot;
)paren
suffix:semicolon
id|tcp_statistics.TcpInErrs
op_increment
suffix:semicolon
r_goto
id|discard_it
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
multiline_comment|/* CHECKSUM_UNNECESSARY */
)brace
suffix:semicolon
id|sk
op_assign
id|__tcp_v6_lookup
c_func
(paren
id|th
comma
id|saddr
comma
id|th-&gt;source
comma
id|daddr
comma
id|th-&gt;dest
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;socket not found&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|no_tcp_socket
suffix:semicolon
)brace
id|skb-&gt;sk
op_assign
id|sk
suffix:semicolon
id|skb-&gt;seq
op_assign
id|ntohl
c_func
(paren
id|th-&gt;seq
)paren
suffix:semicolon
id|skb-&gt;end_seq
op_assign
id|skb-&gt;seq
op_plus
id|th-&gt;syn
op_plus
id|th-&gt;fin
op_plus
id|len
op_minus
id|th-&gt;doff
op_star
l_int|4
suffix:semicolon
id|skb-&gt;ack_seq
op_assign
id|ntohl
c_func
(paren
id|th-&gt;ack_seq
)paren
suffix:semicolon
id|skb-&gt;used
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * We may need to add it to the backlog here.&n;&t; */
r_if
c_cond
(paren
id|sk-&gt;sock_readers
)paren
(brace
id|__skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;back_log
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|skb_set_owner_r
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_eq
id|TCP_ESTABLISHED
)paren
(brace
r_if
c_cond
(paren
id|tcp_rcv_established
c_func
(paren
id|sk
comma
id|skb
comma
id|th
comma
id|len
)paren
)paren
r_goto
id|no_tcp_socket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;state
op_eq
id|TCP_LISTEN
)paren
(brace
id|__u32
id|flg
op_assign
(paren
(paren
id|u32
op_star
)paren
id|th
)paren
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Check for RST */
r_if
c_cond
(paren
id|flg
op_amp
id|__constant_htonl
c_func
(paren
l_int|0x00040000
)paren
)paren
(brace
id|tcp_v6_rst_req
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* Check SYN|ACK */
r_if
c_cond
(paren
id|flg
op_amp
id|__constant_htonl
c_func
(paren
l_int|0x00120000
)paren
)paren
(brace
r_struct
id|open_request
op_star
id|req
comma
op_star
id|prev
suffix:semicolon
r_struct
id|tcp_opt
op_star
id|tp
op_assign
op_amp
(paren
id|sk-&gt;tp_pinfo.af_tcp
)paren
suffix:semicolon
id|req
op_assign
id|tcp_v6_search_req
c_func
(paren
id|tp
comma
id|skb-&gt;nh.ipv6h
comma
id|th
comma
op_amp
id|prev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req
)paren
(brace
id|sk
op_assign
id|tcp_check_req
c_func
(paren
id|sk
comma
id|skb
comma
id|req
)paren
suffix:semicolon
)brace
multiline_comment|/* else do syncookies (add them here) */
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
r_goto
id|discard_it
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|tcp_rcv_state_process
c_func
(paren
id|sk
comma
id|skb
comma
id|th
comma
id|opt
comma
id|len
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|no_tcp_socket
suffix:colon
multiline_comment|/*&n;&t; *&t;No such TCB. If th-&gt;rst is 0 send a reset&n;&t; *&t;(checked in tcp_v6_send_reset)&n;&t; */
id|tcp_v6_send_reset
c_func
(paren
id|skb
)paren
suffix:semicolon
id|discard_it
suffix:colon
multiline_comment|/*&n;&t; *&t;Discard frame&n;&t; */
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tcp_v6_rebuild_header
r_static
r_int
id|tcp_v6_rebuild_header
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
op_amp
id|sk-&gt;net_pinfo.af_inet6
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;dst_cache
)paren
id|dst_check
c_func
(paren
op_amp
id|sk-&gt;dst_cache
comma
id|np-&gt;dst_cookie
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;dst_cache
op_eq
l_int|NULL
)paren
(brace
r_struct
id|flowi
id|fl
suffix:semicolon
r_struct
id|dst_entry
op_star
id|dst
suffix:semicolon
id|fl.proto
op_assign
id|IPPROTO_TCP
suffix:semicolon
id|fl.nl_u.ip6_u.daddr
op_assign
op_amp
id|np-&gt;daddr
suffix:semicolon
id|fl.nl_u.ip6_u.saddr
op_assign
op_amp
id|np-&gt;saddr
suffix:semicolon
id|fl.dev
op_assign
id|np-&gt;oif
suffix:semicolon
id|fl.uli_u.ports.dport
op_assign
id|sk-&gt;dummy_th.dest
suffix:semicolon
id|fl.uli_u.ports.sport
op_assign
id|sk-&gt;dummy_th.source
suffix:semicolon
id|dst
op_assign
id|ip6_route_output
c_func
(paren
id|sk
comma
op_amp
id|fl
)paren
suffix:semicolon
id|ip6_dst_store
c_func
(paren
id|sk
comma
id|dst
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;dst_cache-&gt;error
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;lost route to destination&n;&t;&t; */
r_return
op_minus
id|EHOSTUNREACH
suffix:semicolon
)brace
id|skb_pull
c_func
(paren
id|skb
comma
id|skb-&gt;nh.raw
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tcp_v6_backlog_rcv
r_static
r_int
id|tcp_v6_backlog_rcv
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|res
suffix:semicolon
id|res
op_assign
id|tcp_v6_rcv
c_func
(paren
id|skb
comma
id|skb-&gt;dev
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
comma
(paren
r_struct
id|ipv6_options
op_star
)paren
id|skb-&gt;cb
comma
id|skb-&gt;len
comma
l_int|1
comma
(paren
r_struct
id|inet6_protocol
op_star
)paren
id|sk-&gt;pair
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|tcp_v6_get_sock
r_static
r_struct
id|sock
op_star
id|tcp_v6_get_sock
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|tcphdr
op_star
id|th
)paren
(brace
r_struct
id|in6_addr
op_star
id|saddr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|daddr
suffix:semicolon
id|saddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
suffix:semicolon
id|daddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
suffix:semicolon
r_return
id|tcp_v6_lookup
c_func
(paren
id|saddr
comma
id|th-&gt;source
comma
id|daddr
comma
id|th-&gt;dest
)paren
suffix:semicolon
)brace
DECL|function|tcp_v6_build_header
r_static
r_int
id|tcp_v6_build_header
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|skb_reserve
c_func
(paren
id|skb
comma
(paren
id|MAX_HEADER
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;FIXME: reserve space for option headers&n;&t; *&t;length member of np-&gt;opt&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tcp_v6_xmit
r_static
r_void
id|tcp_v6_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|skb-&gt;sk
suffix:semicolon
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
op_amp
id|sk-&gt;net_pinfo.af_inet6
suffix:semicolon
r_struct
id|flowi
id|fl
suffix:semicolon
r_int
id|err
suffix:semicolon
id|fl.proto
op_assign
id|IPPROTO_TCP
suffix:semicolon
id|fl.nl_u.ip6_u.daddr
op_assign
op_amp
id|np-&gt;daddr
suffix:semicolon
id|fl.nl_u.ip6_u.saddr
op_assign
op_amp
id|np-&gt;saddr
suffix:semicolon
id|fl.dev
op_assign
id|np-&gt;oif
suffix:semicolon
id|fl.uli_u.ports.sport
op_assign
id|sk-&gt;dummy_th.source
suffix:semicolon
id|fl.uli_u.ports.dport
op_assign
id|sk-&gt;dummy_th.dest
suffix:semicolon
id|err
op_assign
id|ip6_xmit
c_func
(paren
id|sk
comma
id|skb
comma
op_amp
id|fl
comma
id|np-&gt;opt
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;FIXME: check error handling.&n;&t; */
id|sk-&gt;err_soft
op_assign
id|err
suffix:semicolon
)brace
DECL|function|v6_addr2sockaddr
r_static
r_void
id|v6_addr2sockaddr
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr
op_star
id|uaddr
)paren
(brace
r_struct
id|ipv6_pinfo
op_star
id|np
op_assign
op_amp
id|sk-&gt;net_pinfo.af_inet6
suffix:semicolon
r_struct
id|sockaddr_in6
op_star
id|sin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
id|uaddr
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
op_amp
id|np-&gt;daddr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
id|sk-&gt;dummy_th.dest
suffix:semicolon
)brace
DECL|variable|ipv6_specific
r_static
r_struct
id|tcp_func
id|ipv6_specific
op_assign
(brace
id|tcp_v6_build_header
comma
id|tcp_v6_xmit
comma
id|tcp_v6_send_check
comma
id|tcp_v6_rebuild_header
comma
id|tcp_v6_conn_request
comma
id|tcp_v6_syn_recv_sock
comma
id|tcp_v6_get_sock
comma
id|ipv6_setsockopt
comma
id|ipv6_getsockopt
comma
id|v6_addr2sockaddr
comma
r_sizeof
(paren
r_struct
id|sockaddr_in6
)paren
)brace
suffix:semicolon
multiline_comment|/*&n; *&t;TCP over IPv4 via INET6 API&n; */
DECL|variable|ipv6_mapped
r_static
r_struct
id|tcp_func
id|ipv6_mapped
op_assign
(brace
id|tcp_v4_build_header
comma
id|ip_queue_xmit
comma
id|tcp_v4_send_check
comma
id|tcp_v4_rebuild_header
comma
id|tcp_v6_conn_request
comma
id|tcp_v6_syn_recv_sock
comma
id|tcp_v6_get_sock
comma
id|ipv6_setsockopt
comma
id|ipv6_getsockopt
comma
id|v6_addr2sockaddr
comma
r_sizeof
(paren
r_struct
id|sockaddr_in6
)paren
)brace
suffix:semicolon
DECL|function|tcp_v6_init_sock
r_static
r_int
id|tcp_v6_init_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|tcp_opt
op_star
id|tp
op_assign
op_amp
(paren
id|sk-&gt;tp_pinfo.af_tcp
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|sk-&gt;out_of_order_queue
)paren
suffix:semicolon
id|tcp_init_xmit_timers
c_func
(paren
id|sk
)paren
suffix:semicolon
id|tp-&gt;srtt
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;rto
op_assign
id|TCP_TIMEOUT_INIT
suffix:semicolon
multiline_comment|/*TCP_WRITE_TIME*/
id|tp-&gt;mdev
op_assign
id|TCP_TIMEOUT_INIT
suffix:semicolon
id|tp-&gt;ato
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;iat
op_assign
(paren
id|HZ
op_div
l_int|5
)paren
op_lshift
l_int|3
suffix:semicolon
multiline_comment|/* FIXME: right thing? */
id|tp-&gt;rcv_wnd
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;in_mss
op_assign
l_int|536
suffix:semicolon
multiline_comment|/* tp-&gt;rcv_wnd = 8192; */
id|tp-&gt;tstamp_ok
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;sack_ok
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;wscale_ok
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;snd_wscale
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;sacks
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;saw_tstamp
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;syn_backlog
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* start with only sending one packet at a time. */
id|tp-&gt;snd_cwnd
op_assign
l_int|1
suffix:semicolon
id|tp-&gt;snd_ssthresh
op_assign
l_int|0x7fffffff
suffix:semicolon
id|sk-&gt;priority
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_CLOSE
suffix:semicolon
id|sk-&gt;max_ack_backlog
op_assign
id|SOMAXCONN
suffix:semicolon
id|sk-&gt;mtu
op_assign
l_int|576
suffix:semicolon
id|sk-&gt;mss
op_assign
l_int|536
suffix:semicolon
id|sk-&gt;dummy_th.doff
op_assign
r_sizeof
(paren
id|sk-&gt;dummy_th
)paren
op_div
l_int|4
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Speed up by setting some standard state for the dummy_th.&n;&t; */
id|sk-&gt;dummy_th.ack
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;dummy_th.doff
op_assign
r_sizeof
(paren
r_struct
id|tcphdr
)paren
op_rshift
l_int|2
suffix:semicolon
multiline_comment|/* Init SYN queue. */
id|tcp_synq_init
c_func
(paren
id|tp
)paren
suffix:semicolon
id|sk-&gt;tp_pinfo.af_tcp.af_specific
op_assign
op_amp
id|ipv6_specific
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tcp_v6_destroy_sock
r_static
r_int
id|tcp_v6_destroy_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|tcp_clear_xmit_timers
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;keepopen
)paren
id|tcp_dec_slow_timer
c_func
(paren
id|TCP_SLT_KEEPALIVE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Cleanup up the write buffer.&n;&t; */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;write_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Cleans up our, hopefuly empty, out_of_order_queue&n;&t; */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;out_of_order_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Release destination entry&n;&t; */
id|dst_release
c_func
(paren
id|sk-&gt;dst_cache
)paren
suffix:semicolon
id|sk-&gt;dst_cache
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|tcpv6_prot
r_struct
id|proto
id|tcpv6_prot
op_assign
(brace
(paren
r_struct
id|sock
op_star
)paren
op_amp
id|tcpv6_prot
comma
multiline_comment|/* sklist_next */
(paren
r_struct
id|sock
op_star
)paren
op_amp
id|tcpv6_prot
comma
multiline_comment|/* sklist_prev */
id|tcp_close
comma
multiline_comment|/* close */
id|tcp_v6_connect
comma
multiline_comment|/* connect */
id|tcp_accept
comma
multiline_comment|/* accept */
l_int|NULL
comma
multiline_comment|/* retransmit */
id|tcp_write_wakeup
comma
multiline_comment|/* write_wakeup */
id|tcp_read_wakeup
comma
multiline_comment|/* read_wakeup */
id|tcp_poll
comma
multiline_comment|/* poll */
id|tcp_ioctl
comma
multiline_comment|/* ioctl */
id|tcp_v6_init_sock
comma
multiline_comment|/* init */
id|tcp_v6_destroy_sock
comma
multiline_comment|/* destroy */
id|tcp_shutdown
comma
multiline_comment|/* shutdown */
id|tcp_setsockopt
comma
multiline_comment|/* setsockopt */
id|tcp_getsockopt
comma
multiline_comment|/* getsockopt */
id|tcp_v6_sendmsg
comma
multiline_comment|/* sendmsg */
id|tcp_recvmsg
comma
multiline_comment|/* recvmsg */
l_int|NULL
comma
multiline_comment|/* bind */
id|tcp_v6_backlog_rcv
comma
multiline_comment|/* backlog_rcv */
id|tcp_v6_hash
comma
multiline_comment|/* hash */
id|tcp_v6_unhash
comma
multiline_comment|/* unhash */
id|tcp_v6_rehash
comma
multiline_comment|/* rehash */
id|tcp_good_socknum
comma
multiline_comment|/* good_socknum */
id|tcp_v6_verify_bind
comma
multiline_comment|/* verify_bind */
l_int|128
comma
multiline_comment|/* max_header */
l_int|0
comma
multiline_comment|/* retransmits */
l_string|&quot;TCPv6&quot;
comma
multiline_comment|/* name */
l_int|0
comma
multiline_comment|/* inuse */
l_int|0
multiline_comment|/* highestinuse */
)brace
suffix:semicolon
DECL|variable|tcpv6_protocol
r_static
r_struct
id|inet6_protocol
id|tcpv6_protocol
op_assign
(brace
id|tcp_v6_rcv
comma
multiline_comment|/* TCP handler&t;&t;*/
id|tcp_v6_err
comma
multiline_comment|/* TCP error control&t;*/
l_int|NULL
comma
multiline_comment|/* next&t;&t;&t;*/
id|IPPROTO_TCP
comma
multiline_comment|/* protocol ID&t;&t;*/
l_int|0
comma
multiline_comment|/* copy&t;&t;&t;*/
l_int|NULL
comma
multiline_comment|/* data&t;&t;&t;*/
l_string|&quot;TCPv6&quot;
multiline_comment|/* name&t;&t;&t;*/
)brace
suffix:semicolon
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|tcpv6_init
c_func
(paren
r_void
)paren
)paren
(brace
multiline_comment|/* register inet6 protocol */
id|inet6_add_protocol
c_func
(paren
op_amp
id|tcpv6_protocol
)paren
suffix:semicolon
)brace
eof
