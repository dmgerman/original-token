multiline_comment|/*&n; *&t;Neighbour Discovery for IPv6&n; *&t;Linux INET6 implementation &n; *&n; *&t;Authors:&n; *&t;Pedro Roque&t;&t;&lt;roque@di.fc.ul.pt&gt;&t;&n; *&t;Mike Shaver&t;&t;&lt;shaver@ingenia.com&gt;&n; *&n; *&t;$Id: ndisc.c,v 1.28 1996/10/11 16:03:06 roque Exp $&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
multiline_comment|/*&n; *&t;Interface:&n; *&n; *&t;ndisc_lookup will be called from eth.c on dev-&gt;(re)build_header&n; *&n; *&t;ndisc_rcv&n; *&t;ndisc_validate is called by higher layers when they know a neighbour&n; *&t;&t;       is reachable.&n; *&n; *&t;Manages neighbour cache&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/ipv6.h&gt;
macro_line|#include &lt;linux/icmpv6.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/snmp.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/ndisc.h&gt;
macro_line|#include &lt;net/ipv6_route.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;net/checksum.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
DECL|macro|NCACHE_NUM_BUCKETS
mdefine_line|#define NCACHE_NUM_BUCKETS 32
DECL|variable|ndisc_socket
r_static
r_struct
id|socket
id|ndisc_socket
suffix:semicolon
DECL|variable|nd_rand_seed
r_int
r_int
id|nd_rand_seed
op_assign
l_int|152L
suffix:semicolon
DECL|variable|nd_stats
r_struct
id|ndisc_statistics
id|nd_stats
suffix:semicolon
DECL|variable|neighbours
r_static
r_struct
id|neighbour
op_star
id|neighbours
(braket
id|NCACHE_NUM_BUCKETS
)braket
suffix:semicolon
DECL|variable|ndisc_timer
r_static
r_struct
id|timer_list
id|ndisc_timer
suffix:semicolon
DECL|variable|ndisc_gc_timer
r_static
r_struct
id|timer_list
id|ndisc_gc_timer
suffix:semicolon
DECL|variable|ndisc_lock
r_static
id|atomic_t
id|ndisc_lock
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n; *&t;Protocol variables&n; */
DECL|variable|nd_max_multicast_solicit
r_int
id|nd_max_multicast_solicit
op_assign
l_int|3
suffix:semicolon
DECL|variable|nd_max_unicast_solicit
r_int
id|nd_max_unicast_solicit
op_assign
l_int|3
suffix:semicolon
DECL|variable|nd_retrans_timer
r_int
id|nd_retrans_timer
op_assign
id|RETRANS_TIMER
suffix:semicolon
DECL|variable|nd_reachable_time
r_int
id|nd_reachable_time
op_assign
id|RECHABLE_TIME
suffix:semicolon
DECL|variable|nd_base_reachable_time
r_int
id|nd_base_reachable_time
op_assign
id|RECHABLE_TIME
suffix:semicolon
DECL|variable|nd_delay_first_probe
r_int
id|nd_delay_first_probe
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
DECL|variable|nd_gc_interval
r_int
id|nd_gc_interval
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
multiline_comment|/* &n; *&t;garbage collection timeout must be greater than reachable time&n; *&t;since tstamp is updated by reachable confirmations only.&n; *&t;gc_staletime actually means the time after last confirmation&n; *&t;*NOT* after the last time the entry was used.&n; */
DECL|variable|nd_gc_staletime
r_int
id|nd_gc_staletime
op_assign
l_int|3
op_star
id|RECHABLE_TIME
suffix:semicolon
DECL|variable|ndisc_insert_queue
r_static
r_struct
id|neighbour
id|ndisc_insert_queue
op_assign
(brace
(brace
(brace
(brace
l_int|0
comma
)brace
)brace
)brace
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
(brace
l_int|0
comma
)brace
comma
l_int|NULL
comma
(brace
l_int|0
comma
)brace
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|ndisc_insert_queue
comma
op_amp
id|ndisc_insert_queue
)brace
suffix:semicolon
DECL|variable|ndisc_ins_queue_len
r_static
r_int
id|ndisc_ins_queue_len
op_assign
l_int|0
suffix:semicolon
r_int
id|ndisc_event_timer
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
suffix:semicolon
r_static
r_void
id|ndisc_bh_insert
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|ipv6_random
r_int
id|ipv6_random
c_func
(paren
r_void
)paren
(brace
id|nd_rand_seed
op_assign
id|nd_rand_seed
op_star
l_int|69069L
op_plus
l_int|1
suffix:semicolon
r_return
id|nd_rand_seed
op_xor
id|jiffies
suffix:semicolon
)brace
DECL|function|rand_reach_time
r_static
id|__inline__
r_int
r_int
id|rand_reach_time
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|ipv6_random
c_func
(paren
)paren
op_mod
(paren
id|MAX_RANDOM_FACTOR
op_star
id|nd_base_reachable_time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
(paren
id|MIN_RANDOM_FACTOR
op_star
id|nd_base_reachable_time
)paren
)paren
(brace
id|val
op_add_assign
(paren
id|MIN_RANDOM_FACTOR
op_star
id|nd_base_reachable_time
)paren
suffix:semicolon
)brace
r_return
id|val
suffix:semicolon
)brace
r_void
id|ndisc_verify_reachability
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;(inline) support functions&n; */
DECL|function|ndisc_hash
r_static
id|__inline__
id|__u32
id|ndisc_hash
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
id|__u32
id|hash_val
suffix:semicolon
id|hash_val
op_assign
id|addr-&gt;s6_addr32
(braket
l_int|2
)braket
op_xor
id|addr-&gt;s6_addr32
(braket
l_int|3
)braket
suffix:semicolon
id|hash_val
op_xor_assign
id|hash_val
op_rshift
l_int|16
suffix:semicolon
r_return
(paren
id|hash_val
op_amp
(paren
id|NCACHE_NUM_BUCKETS
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|ndisc_neigh_queue
r_static
id|__inline__
r_void
id|ndisc_neigh_queue
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
r_struct
id|neighbour
op_star
id|next
op_assign
op_amp
id|ndisc_insert_queue
suffix:semicolon
id|ndisc_ins_queue_len
op_increment
suffix:semicolon
id|neigh-&gt;prev
op_assign
id|next-&gt;prev
suffix:semicolon
id|neigh-&gt;prev-&gt;next
op_assign
id|neigh
suffix:semicolon
id|next-&gt;prev
op_assign
id|neigh
suffix:semicolon
id|neigh-&gt;next
op_assign
id|next
suffix:semicolon
)brace
DECL|function|ndisc_dequeue
r_static
id|__inline__
r_struct
id|neighbour
op_star
id|ndisc_dequeue
c_func
(paren
r_void
)paren
(brace
r_struct
id|neighbour
op_star
id|next
op_assign
op_amp
id|ndisc_insert_queue
suffix:semicolon
r_struct
id|neighbour
op_star
id|head
suffix:semicolon
id|ndisc_ins_queue_len
op_decrement
suffix:semicolon
id|head
op_assign
id|next-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|head
op_eq
id|next
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|head-&gt;next-&gt;prev
op_assign
id|head-&gt;prev
suffix:semicolon
id|next-&gt;next
op_assign
id|head-&gt;next
suffix:semicolon
id|head-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|head-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
r_return
id|head
suffix:semicolon
)brace
DECL|function|ndisc_release_lock
r_static
id|__inline__
r_void
id|ndisc_release_lock
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|ndisc_lock
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_lock
op_eq
l_int|0
op_logical_and
id|ndisc_ins_queue_len
)paren
(brace
id|ndisc_bh_insert
c_func
(paren
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|ndisc_insert_neigh
r_static
r_void
id|ndisc_insert_neigh
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
r_struct
id|neighbour
op_star
id|bucket
suffix:semicolon
id|__u32
id|hash_val
op_assign
id|ndisc_hash
c_func
(paren
op_amp
id|neigh-&gt;addr
)paren
suffix:semicolon
id|bucket
op_assign
id|neighbours
(braket
id|hash_val
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bucket
)paren
(brace
id|neighbours
(braket
id|hash_val
)braket
op_assign
id|neigh
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
id|bucket-&gt;next
suffix:semicolon
id|bucket
op_assign
id|bucket-&gt;next
)paren
suffix:semicolon
id|bucket-&gt;next
op_assign
id|neigh
suffix:semicolon
id|neigh-&gt;prev
op_assign
id|bucket
suffix:semicolon
)brace
r_static
id|__inline__
r_struct
id|neighbour
op_star
DECL|function|ndisc_retrieve_neigh
id|ndisc_retrieve_neigh
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
r_struct
id|neighbour
op_star
id|iter
suffix:semicolon
id|iter
op_assign
id|neighbours
(braket
id|ndisc_hash
c_func
(paren
id|addr
)paren
)braket
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|iter
suffix:semicolon
id|iter
op_assign
id|iter-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|dev
op_eq
id|iter-&gt;dev
op_logical_and
id|ipv6_addr_cmp
c_func
(paren
id|addr
comma
op_amp
id|iter-&gt;addr
)paren
op_eq
l_int|0
)paren
r_return
id|iter
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ndisc_unlink_neigh
r_static
r_void
id|ndisc_unlink_neigh
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
r_if
c_cond
(paren
id|neigh-&gt;prev
)paren
id|neigh-&gt;prev-&gt;next
op_assign
id|neigh-&gt;next
suffix:semicolon
r_else
(brace
r_int
id|hash
op_assign
id|ndisc_hash
c_func
(paren
op_amp
id|neigh-&gt;addr
)paren
suffix:semicolon
id|neighbours
(braket
id|hash
)braket
op_assign
id|neigh-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|neigh-&gt;next
)paren
id|neigh-&gt;next-&gt;prev
op_assign
id|neigh-&gt;prev
suffix:semicolon
)brace
DECL|function|ndisc_release_neigh
r_static
r_void
id|ndisc_release_neigh
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|neigh-&gt;arp_queue
)paren
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|neigh-&gt;refcnt
op_eq
l_int|0
)paren
(brace
id|ndisc_unlink_neigh
c_func
(paren
id|neigh
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
)brace
DECL|function|ndisc_bh_insert
r_static
r_void
id|ndisc_bh_insert
c_func
(paren
r_void
)paren
(brace
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_while
c_loop
(paren
(paren
id|neigh
op_assign
id|ndisc_dequeue
c_func
(paren
)paren
)paren
)paren
(brace
id|ndisc_insert_neigh
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
)brace
DECL|function|ndisc_garbage_collect
r_static
r_void
id|ndisc_garbage_collect
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_static
r_int
r_int
id|last_rand
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; *&t;periodicly compute ReachableTime from random function&n;&t; */
r_if
c_cond
(paren
id|now
op_minus
id|last_rand
OG
id|REACH_RANDOM_INTERVAL
)paren
(brace
id|last_rand
op_assign
id|now
suffix:semicolon
id|nd_reachable_time
op_assign
id|rand_reach_time
c_func
(paren
)paren
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_lock
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ndisc_gc_timer.expires
op_assign
id|now
op_plus
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ndisc_gc_timer
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|NCACHE_NUM_BUCKETS
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|neigh
op_assign
id|neighbours
(braket
id|i
)braket
suffix:semicolon
id|neigh
suffix:semicolon
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; *&t;Release unused entries&n;&t;&t;&t; */
r_if
c_cond
(paren
id|neigh-&gt;refcnt
op_eq
l_int|0
op_logical_and
(paren
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_FAILED
)paren
op_logical_or
(paren
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_REACHABLE
)paren
op_logical_and
(paren
id|neigh-&gt;tstamp
op_le
(paren
id|now
op_minus
id|nd_gc_staletime
)paren
)paren
)paren
)paren
)paren
(brace
r_struct
id|neighbour
op_star
id|prev
suffix:semicolon
id|prev
op_assign
id|neigh
suffix:semicolon
id|neigh
op_assign
id|neigh-&gt;next
suffix:semicolon
id|ndisc_release_neigh
c_func
(paren
id|prev
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|neigh
op_assign
id|neigh-&gt;next
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ndisc_gc_timer.expires
op_assign
id|now
op_plus
id|nd_gc_interval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ndisc_gc_timer
)paren
suffix:semicolon
)brace
DECL|function|ndisc_add_timer
r_static
id|__inline__
r_void
id|ndisc_add_timer
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_int
id|timer
)paren
(brace
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
r_int
id|tval
suffix:semicolon
id|neigh-&gt;expires
op_assign
id|now
op_plus
id|timer
suffix:semicolon
id|tval
op_assign
id|del_timer
c_func
(paren
op_amp
id|ndisc_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tval
)paren
(brace
id|tval
op_assign
id|min
c_func
(paren
id|tval
comma
id|neigh-&gt;expires
)paren
suffix:semicolon
)brace
r_else
id|tval
op_assign
id|neigh-&gt;expires
suffix:semicolon
id|ndisc_timer.expires
op_assign
id|tval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ndisc_timer
)paren
suffix:semicolon
)brace
DECL|function|ndisc_del_timer
r_static
r_void
id|ndisc_del_timer
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
r_int
r_int
id|tval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_IN_TIMER
)paren
)paren
r_return
suffix:semicolon
id|tval
op_assign
id|del_timer
c_func
(paren
op_amp
id|ndisc_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tval
op_eq
id|neigh-&gt;expires
)paren
(brace
r_int
id|i
suffix:semicolon
id|tval
op_assign
op_complement
l_int|0UL
suffix:semicolon
multiline_comment|/* need to search the entire neighbour cache */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NCACHE_NUM_BUCKETS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|neigh
op_assign
id|neighbours
(braket
id|i
)braket
suffix:semicolon
id|neigh
suffix:semicolon
id|neigh
op_assign
id|neigh-&gt;next
)paren
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_IN_TIMER
)paren
(brace
id|tval
op_assign
id|min
c_func
(paren
id|tval
comma
id|neigh-&gt;expires
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|tval
op_eq
op_complement
(paren
l_int|0UL
)paren
)paren
r_return
suffix:semicolon
id|ndisc_timer.expires
op_assign
id|tval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ndisc_timer
)paren
suffix:semicolon
)brace
DECL|function|ndisc_new_neigh
r_static
r_struct
id|neighbour
op_star
id|ndisc_new_neigh
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|neigh
op_assign
(paren
r_struct
id|neighbour
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|neighbour
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ndisc: kmalloc failure&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|nd_stats.allocs
op_increment
suffix:semicolon
id|memset
c_func
(paren
id|neigh
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|neighbour
)paren
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|neigh-&gt;arp_queue
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|neigh-&gt;addr
comma
id|addr
)paren
suffix:semicolon
id|neigh-&gt;len
op_assign
l_int|128
suffix:semicolon
id|neigh-&gt;type
op_assign
id|ipv6_addr_type
c_func
(paren
id|addr
)paren
suffix:semicolon
id|neigh-&gt;dev
op_assign
id|dev
suffix:semicolon
id|neigh-&gt;tstamp
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_LOOPBACK
op_logical_or
id|dev-&gt;type
op_eq
id|ARPHRD_SIT
)paren
(brace
id|neigh-&gt;flags
op_or_assign
id|NCF_NOARP
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_lock
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Add to the cache. */
id|ndisc_insert_neigh
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
r_else
(brace
id|ndisc_neigh_queue
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|neigh
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Called when creating a new dest_cache entry for a given destination&n; *&t;is likely that an entry for the refered gateway exists in cache&n; *&n; */
DECL|function|ndisc_get_neigh
r_struct
id|neighbour
op_star
id|ndisc_get_neigh
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
multiline_comment|/*&n;&t; *&t;neighbour cache:&n;&t; *&t;cached information about nexthop and addr resolution&n;&t; */
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ncache_get_neigh: NULL device&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|ndisc_lock
)paren
suffix:semicolon
id|neigh
op_assign
id|ndisc_retrieve_neigh
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
id|ndisc_release_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
op_eq
l_int|NULL
)paren
(brace
id|neigh
op_assign
id|ndisc_new_neigh
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|neigh-&gt;refcnt
)paren
suffix:semicolon
r_return
id|neigh
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;return values&n; *&t;0 - Address Resolution succeded, send packet&n; *&t;1 - Address Resolution unfinished / packet queued&n; */
DECL|function|ndisc_eth_resolv
r_int
id|ndisc_eth_resolv
c_func
(paren
r_int
r_char
op_star
id|h_dest
comma
r_struct
id|device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
id|neigh
op_assign
id|skb-&gt;nexthop
suffix:semicolon
r_if
c_cond
(paren
id|neigh
op_eq
l_int|NULL
)paren
(brace
r_int
id|addr_type
suffix:semicolon
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
op_amp
id|skb-&gt;ipv6_hdr-&gt;daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr_type
op_amp
id|IPV6_ADDR_MULTICAST
)paren
(brace
id|ipv6_mc_map
c_func
(paren
op_amp
id|skb-&gt;ipv6_hdr-&gt;daddr
comma
id|h_dest
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ndisc_eth_resolv: nexthop is NULL&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|discard
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_eq
id|PACKET_NDISC
)paren
r_goto
id|ndisc_pkt
suffix:semicolon
r_switch
c_cond
(paren
id|neigh-&gt;nud_state
)paren
(brace
r_case
id|NUD_FAILED
suffix:colon
r_case
id|NUD_NONE
suffix:colon
id|ndisc_event_send
c_func
(paren
id|neigh
comma
id|skb
)paren
suffix:semicolon
r_case
id|NUD_INCOMPLETE
suffix:colon
r_if
c_cond
(paren
id|skb_queue_len
c_func
(paren
op_amp
id|neigh-&gt;arp_queue
)paren
op_ge
id|NDISC_QUEUE_LEN
)paren
(brace
r_struct
id|sk_buff
op_star
id|buff
suffix:semicolon
id|buff
op_assign
id|neigh-&gt;arp_queue.prev
suffix:semicolon
id|skb_unlink
c_func
(paren
id|buff
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|buff
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
id|skb_queue_head
c_func
(paren
op_amp
id|neigh-&gt;arp_queue
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_default
suffix:colon
id|ndisc_event_send
c_func
(paren
id|neigh
comma
id|skb
)paren
suffix:semicolon
)brace
id|ndisc_pkt
suffix:colon
r_if
c_cond
(paren
id|neigh-&gt;h_dest
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;neigh-&gt;h_dest is NULL&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|discard
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|h_dest
comma
id|neigh-&gt;h_dest
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|neigh-&gt;flags
op_amp
id|NCF_HHVALID
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * copy header to hh_data and move h_dest pointer&n;&t;&t; * this is strictly media dependent.&n;&t;&t; */
)brace
r_return
l_int|0
suffix:semicolon
id|discard
suffix:colon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Send the actual Neighbour Advertisement */
DECL|function|ndisc_send_na
r_void
id|ndisc_send_na
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|solicited_addr
comma
r_int
id|router
comma
r_int
id|solicited
comma
r_int
id|override
comma
r_int
id|inc_opt
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|ndisc_socket.data
suffix:semicolon
r_struct
id|nd_msg
op_star
id|msg
suffix:semicolon
r_int
id|len
comma
id|opt_len
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|err
suffix:semicolon
id|opt_len
op_assign
(paren
(paren
id|dev-&gt;addr_len
op_plus
l_int|1
)paren
op_rshift
l_int|3
)paren
op_plus
l_int|1
suffix:semicolon
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmpv6hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inc_opt
)paren
(brace
id|len
op_add_assign
id|opt_len
op_lshift
l_int|3
suffix:semicolon
)brace
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
comma
l_int|0
comma
l_int|0
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;send_na: alloc skb failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|skb-&gt;free
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_bld_hdr_2
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
id|neigh
comma
id|solicited_addr
comma
id|daddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
OL
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ndisc_send_na: ipv6_build_header returned &lt; 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;pkt_type
op_assign
id|PACKET_NDISC
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|msg-&gt;icmph.type
op_assign
id|NDISC_NEIGHBOUR_ADVERTISEMENT
suffix:semicolon
id|msg-&gt;icmph.code
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.checksum
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_unused
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_router
op_assign
id|router
suffix:semicolon
id|msg-&gt;icmph.icmp6_solicited
op_assign
id|solicited
suffix:semicolon
id|msg-&gt;icmph.icmp6_override
op_assign
id|override
suffix:semicolon
multiline_comment|/* Set the target address. */
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;target
comma
id|solicited_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inc_opt
)paren
(brace
multiline_comment|/* Set the source link-layer address option. */
id|msg-&gt;opt.opt_type
op_assign
id|ND_OPT_TARGET_LL_ADDR
suffix:semicolon
id|msg-&gt;opt.opt_len
op_assign
id|opt_len
suffix:semicolon
id|memcpy
c_func
(paren
id|msg-&gt;opt.link_addr
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opt_len
op_lshift
l_int|3
)paren
op_minus
(paren
l_int|2
op_plus
id|dev-&gt;addr_len
)paren
)paren
(brace
id|memset
c_func
(paren
id|msg-&gt;opt.link_addr
op_plus
id|dev-&gt;addr_len
comma
l_int|0
comma
(paren
id|opt_len
op_lshift
l_int|3
)paren
op_minus
(paren
l_int|2
op_plus
id|dev-&gt;addr_len
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* checksum */
id|msg-&gt;icmph.checksum
op_assign
id|csum_ipv6_magic
c_func
(paren
id|solicited_addr
comma
id|daddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|__u8
op_star
)paren
id|msg
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
id|ipv6_queue_xmit
c_func
(paren
id|sk
comma
id|skb-&gt;dev
comma
id|skb
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|ndisc_send_ns
r_void
id|ndisc_send_ns
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|in6_addr
op_star
id|solicit
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|saddr
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|ndisc_socket.data
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|nd_msg
op_star
id|msg
suffix:semicolon
r_int
id|len
comma
id|opt_len
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* length of addr in 8 octet groups.*/
id|opt_len
op_assign
(paren
(paren
id|dev-&gt;addr_len
op_plus
l_int|1
)paren
op_rshift
l_int|3
)paren
op_plus
l_int|1
suffix:semicolon
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmpv6hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
op_plus
(paren
id|opt_len
op_lshift
l_int|3
)paren
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
comma
l_int|0
comma
l_int|0
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;send_ns: alloc skb failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;free
op_assign
l_int|1
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_NDISC
suffix:semicolon
r_if
c_cond
(paren
id|saddr
op_eq
l_int|NULL
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifa
suffix:semicolon
multiline_comment|/* use link local address */
id|ifa
op_assign
id|ipv6_get_lladdr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa
)paren
(brace
id|saddr
op_assign
op_amp
id|ifa-&gt;addr
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ipv6_addr_type
c_func
(paren
id|daddr
)paren
op_eq
id|IPV6_ADDR_MULTICAST
)paren
(brace
id|nd_stats.snt_probes_mcast
op_increment
suffix:semicolon
)brace
r_else
(brace
id|nd_stats.snt_probes_ucast
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv6_bld_hdr_2
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
id|neigh
comma
id|saddr
comma
id|daddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
OL
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ndisc_send_ns: ipv6_build_header returned &lt; 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|msg-&gt;icmph.type
op_assign
id|NDISC_NEIGHBOUR_SOLICITATION
suffix:semicolon
id|msg-&gt;icmph.code
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.checksum
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_unused
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set the target address. */
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;target
comma
id|solicit
)paren
suffix:semicolon
multiline_comment|/* Set the source link-layer address option. */
id|msg-&gt;opt.opt_type
op_assign
id|ND_OPT_SOURCE_LL_ADDR
suffix:semicolon
id|msg-&gt;opt.opt_len
op_assign
id|opt_len
suffix:semicolon
id|memcpy
c_func
(paren
id|msg-&gt;opt.link_addr
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opt_len
op_lshift
l_int|3
)paren
op_minus
(paren
l_int|2
op_plus
id|dev-&gt;addr_len
)paren
)paren
(brace
id|memset
c_func
(paren
id|msg-&gt;opt.link_addr
op_plus
id|dev-&gt;addr_len
comma
l_int|0
comma
(paren
id|opt_len
op_lshift
l_int|3
)paren
op_minus
(paren
l_int|2
op_plus
id|dev-&gt;addr_len
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* checksum */
id|msg-&gt;icmph.checksum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
comma
id|daddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|__u8
op_star
)paren
id|msg
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* send it! */
id|ipv6_queue_xmit
c_func
(paren
id|sk
comma
id|skb-&gt;dev
comma
id|skb
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|ndisc_send_rs
r_void
id|ndisc_send_rs
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|in6_addr
op_star
id|daddr
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|ndisc_socket.data
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|icmpv6hdr
op_star
id|hdr
suffix:semicolon
id|__u8
op_star
id|opt
suffix:semicolon
r_int
id|len
comma
id|opt_len
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* length of addr in 8 octet groups.*/
id|opt_len
op_assign
(paren
(paren
id|dev-&gt;addr_len
op_plus
l_int|1
)paren
op_rshift
l_int|3
)paren
op_plus
l_int|1
suffix:semicolon
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmpv6hdr
)paren
op_plus
(paren
id|opt_len
op_lshift
l_int|3
)paren
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
comma
l_int|0
comma
l_int|0
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;send_ns: alloc skb failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|skb-&gt;free
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_bld_hdr_2
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
l_int|NULL
comma
id|saddr
comma
id|daddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
OL
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ndisc_send_ns: ipv6_build_header returned &lt; 0&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|hdr
op_assign
(paren
r_struct
id|icmpv6hdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|hdr-&gt;type
op_assign
id|NDISC_ROUTER_SOLICITATION
suffix:semicolon
id|hdr-&gt;code
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;checksum
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;icmp6_unused
op_assign
l_int|0
suffix:semicolon
id|opt
op_assign
(paren
id|u8
op_star
)paren
(paren
id|hdr
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Set the source link-layer address option. */
id|opt
(braket
l_int|0
)braket
op_assign
id|ND_OPT_SOURCE_LL_ADDR
suffix:semicolon
id|opt
(braket
l_int|1
)braket
op_assign
id|opt_len
suffix:semicolon
id|memcpy
c_func
(paren
id|opt
op_plus
l_int|2
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opt_len
op_lshift
l_int|3
)paren
op_minus
(paren
l_int|2
op_plus
id|dev-&gt;addr_len
)paren
)paren
(brace
id|memset
c_func
(paren
id|opt
op_plus
l_int|2
op_plus
id|dev-&gt;addr_len
comma
l_int|0
comma
(paren
id|opt_len
op_lshift
l_int|3
)paren
op_minus
(paren
l_int|2
op_plus
id|dev-&gt;addr_len
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* checksum */
id|hdr-&gt;checksum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
comma
id|daddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|__u8
op_star
)paren
id|hdr
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* send it! */
id|ipv6_queue_xmit
c_func
(paren
id|sk
comma
id|skb-&gt;dev
comma
id|skb
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|ndisc_store_hwaddr
r_static
r_int
id|ndisc_store_hwaddr
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|__u8
op_star
id|opt
comma
r_int
id|opt_len
comma
id|__u8
op_star
id|h_addr
comma
r_int
id|option
)paren
(brace
r_while
c_loop
(paren
op_star
id|opt
op_ne
id|option
op_logical_and
id|opt_len
)paren
(brace
r_int
id|len
suffix:semicolon
id|len
op_assign
id|opt
(braket
l_int|1
)braket
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;nd: option has 0 len&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|opt
op_add_assign
id|len
suffix:semicolon
id|opt_len
op_sub_assign
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|opt
op_eq
id|option
)paren
(brace
id|memcpy
c_func
(paren
id|h_addr
comma
id|opt
op_plus
l_int|2
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Called when a timer expires for a neighbour entry. */
DECL|function|ndisc_timer_handler
r_static
r_void
id|ndisc_timer_handler
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_int
r_int
id|ntimer
op_assign
op_complement
l_int|0UL
suffix:semicolon
r_int
id|i
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|ndisc_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NCACHE_NUM_BUCKETS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|neigh
op_assign
id|neighbours
(braket
id|i
)braket
suffix:semicolon
id|neigh
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_IN_TIMER
)paren
(brace
r_int
id|time
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;expires
op_le
id|now
)paren
(brace
id|time
op_assign
id|ndisc_event_timer
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
r_else
id|time
op_assign
id|neigh-&gt;expires
op_minus
id|now
suffix:semicolon
r_if
c_cond
(paren
id|time
op_eq
l_int|0
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_lock
op_eq
l_int|1
)paren
(brace
r_struct
id|neighbour
op_star
id|old
op_assign
id|neigh
suffix:semicolon
id|neigh
op_assign
id|neigh-&gt;next
suffix:semicolon
id|ndisc_release_neigh
c_func
(paren
id|old
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|ntimer
op_assign
id|min
c_func
(paren
id|ntimer
comma
id|time
)paren
suffix:semicolon
)brace
id|neigh
op_assign
id|neigh-&gt;next
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ntimer
op_ne
(paren
op_complement
l_int|0UL
)paren
)paren
(brace
id|ndisc_timer.expires
op_assign
id|jiffies
op_plus
id|ntimer
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ndisc_timer
)paren
suffix:semicolon
)brace
id|ndisc_release_lock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ndisc_event_timer
r_int
id|ndisc_event_timer
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
r_struct
id|in6_addr
op_star
id|daddr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|target
suffix:semicolon
r_struct
id|in6_addr
id|mcaddr
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_int
id|max_probes
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_DELAY
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_PROBE
suffix:semicolon
)brace
id|max_probes
op_assign
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_PROBE
ques
c_cond
id|nd_max_unicast_solicit
suffix:colon
id|nd_max_multicast_solicit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;probes
op_eq
id|max_probes
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|neigh-&gt;nud_state
op_assign
id|NUD_FAILED
suffix:semicolon
id|neigh-&gt;flags
op_or_assign
id|NCF_INVALID
suffix:semicolon
id|nd_stats.res_failed
op_increment
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|neigh-&gt;arp_queue
)paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; *&t;&quot;The sender MUST return an ICMP&n;&t;&t;&t; *&t; destination unreachable&quot;&n;&t;&t;&t; */
id|icmpv6_send
c_func
(paren
id|skb
comma
id|ICMPV6_DEST_UNREACH
comma
id|ICMPV6_ADDR_UNREACH
comma
l_int|0
comma
id|neigh-&gt;dev
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|neigh-&gt;probes
op_increment
suffix:semicolon
id|dev
op_assign
id|neigh-&gt;dev
suffix:semicolon
id|target
op_assign
op_amp
id|neigh-&gt;addr
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_INCOMPLETE
)paren
(brace
id|addrconf_addr_solict_mult
c_func
(paren
op_amp
id|neigh-&gt;addr
comma
op_amp
id|mcaddr
)paren
suffix:semicolon
id|daddr
op_assign
op_amp
id|mcaddr
suffix:semicolon
id|neigh
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|daddr
op_assign
op_amp
id|neigh-&gt;addr
suffix:semicolon
)brace
id|ndisc_send_ns
c_func
(paren
id|dev
comma
id|neigh
comma
id|target
comma
id|daddr
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|nd_retrans_timer
suffix:semicolon
)brace
DECL|function|ndisc_event_send
r_void
id|ndisc_event_send
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_struct
id|in6_addr
id|daddr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|saddr
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|neigh-&gt;nud_state
)paren
(brace
r_case
id|NUD_FAILED
suffix:colon
id|neigh-&gt;probes
op_assign
l_int|0
suffix:semicolon
r_case
id|NUD_NONE
suffix:colon
r_if
c_cond
(paren
id|skb
op_logical_and
op_logical_neg
id|skb-&gt;stamp.tv_sec
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; *&t;skb-&gt;stamp allows us to know if we are&n;&t;&t;&t; *&t;originating the skb or forwarding it.&n;&t;&t;&t; *&t;(it is set on netif_rx)&n;&t;&t;&t; */
id|saddr
op_assign
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
suffix:semicolon
)brace
id|neigh-&gt;nud_state
op_assign
id|NUD_INCOMPLETE
suffix:semicolon
id|addrconf_addr_solict_mult
c_func
(paren
op_amp
id|neigh-&gt;addr
comma
op_amp
id|daddr
)paren
suffix:semicolon
id|ndisc_send_ns
c_func
(paren
id|neigh-&gt;dev
comma
l_int|NULL
comma
op_amp
id|neigh-&gt;addr
comma
op_amp
id|daddr
comma
id|saddr
)paren
suffix:semicolon
id|ndisc_add_timer
c_func
(paren
id|neigh
comma
id|nd_retrans_timer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NUD_REACHABLE
suffix:colon
r_if
c_cond
(paren
id|now
op_minus
id|neigh-&gt;tstamp
OL
id|nd_reachable_time
)paren
r_break
suffix:semicolon
r_case
id|NUD_STALE
suffix:colon
id|neigh-&gt;nud_state
op_assign
id|NUD_DELAY
suffix:semicolon
id|ndisc_add_timer
c_func
(paren
id|neigh
comma
id|nd_delay_first_probe
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Received a neighbour announce&n; */
DECL|function|ndisc_event_na
r_void
id|ndisc_event_na
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_int
r_char
op_star
id|opt
comma
r_int
id|opt_len
comma
r_int
id|solicited
comma
r_int
id|override
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_NONE
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_INCOMPLETE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_INCOMPLETE
op_logical_or
id|override
)paren
(brace
r_if
c_cond
(paren
id|opt_len
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;no opt on NA&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* record hardware address */
id|neigh-&gt;h_dest
op_assign
id|neigh-&gt;hh_data
suffix:semicolon
id|neigh-&gt;flags
op_and_assign
op_complement
id|NCF_HHVALID
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_store_hwaddr
c_func
(paren
id|neigh-&gt;dev
comma
id|opt
comma
id|opt_len
comma
id|neigh-&gt;h_dest
comma
id|ND_OPT_TARGET_LL_ADDR
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;event_na: invalid TARGET_LL_ADDR&bslash;n&quot;
)paren
suffix:semicolon
id|neigh-&gt;h_dest
op_assign
l_int|NULL
suffix:semicolon
id|neigh-&gt;nud_state
op_assign
id|NUD_NONE
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|solicited
op_logical_or
id|override
op_logical_or
id|neigh-&gt;nud_state
op_eq
id|NUD_INCOMPLETE
)paren
(brace
id|neigh-&gt;probes
op_assign
l_int|0
suffix:semicolon
id|neigh-&gt;tstamp
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_IN_TIMER
)paren
(brace
id|ndisc_del_timer
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|solicited
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_REACHABLE
suffix:semicolon
)brace
r_else
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_STALE
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|neigh-&gt;arp_queue
)paren
)paren
)paren
(brace
r_int
id|priority
op_assign
id|SOPRI_NORMAL
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;sk
)paren
id|priority
op_assign
id|skb-&gt;sk-&gt;priority
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|skb
comma
id|neigh-&gt;dev
comma
id|priority
)paren
suffix:semicolon
)brace
)brace
DECL|function|ndisc_event_ns
r_static
r_void
id|ndisc_event_ns
c_func
(paren
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
id|u8
op_star
id|opt
suffix:semicolon
r_int
id|len
suffix:semicolon
id|opt
op_assign
id|skb-&gt;h.raw
suffix:semicolon
id|opt
op_add_assign
r_sizeof
(paren
r_struct
id|icmpv6hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
id|len
op_assign
id|skb-&gt;tail
op_minus
id|opt
suffix:semicolon
id|neigh
op_assign
id|ndisc_retrieve_neigh
c_func
(paren
id|skb-&gt;dev
comma
id|saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
op_eq
l_int|NULL
)paren
(brace
id|neigh
op_assign
id|ndisc_new_neigh
c_func
(paren
id|skb-&gt;dev
comma
id|saddr
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|neigh-&gt;nud_state
)paren
(brace
r_case
id|NUD_REACHABLE
suffix:colon
r_case
id|NUD_STALE
suffix:colon
r_case
id|NUD_DELAY
suffix:colon
r_if
c_cond
(paren
op_star
id|opt
op_ne
id|ND_OPT_SOURCE_LL_ADDR
op_logical_or
id|len
op_ne
id|neigh-&gt;dev-&gt;addr_len
op_logical_or
id|memcmp
c_func
(paren
id|neigh-&gt;h_dest
comma
id|opt
op_plus
l_int|2
comma
id|len
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_IN_TIMER
)paren
(brace
id|ndisc_del_timer
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
r_default
suffix:colon
id|neigh-&gt;flags
op_and_assign
op_complement
id|NCF_HHVALID
suffix:semicolon
id|neigh-&gt;h_dest
op_assign
id|neigh-&gt;hh_data
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_store_hwaddr
c_func
(paren
id|neigh-&gt;dev
comma
id|opt
comma
id|len
comma
id|neigh-&gt;h_dest
comma
id|ND_OPT_SOURCE_LL_ADDR
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;event_ns: invalid SOURCE_LL_ADDR&bslash;n&quot;
)paren
suffix:semicolon
id|neigh-&gt;h_dest
op_assign
l_int|NULL
suffix:semicolon
id|neigh-&gt;nud_state
op_assign
id|NUD_NONE
suffix:semicolon
r_return
suffix:semicolon
)brace
id|neigh-&gt;nud_state
op_assign
id|NUD_STALE
suffix:semicolon
id|neigh-&gt;tstamp
op_assign
id|jiffies
suffix:semicolon
id|neigh-&gt;probes
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|ndisc_get_dflt_router
r_static
r_struct
id|rt6_info
op_star
id|ndisc_get_dflt_router
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|addr
)paren
(brace
r_struct
id|rt6_info
op_star
id|iter
suffix:semicolon
r_for
c_loop
(paren
id|iter
op_assign
id|default_rt_list
suffix:semicolon
id|iter
suffix:semicolon
id|iter
op_assign
id|iter-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|dev
op_eq
id|iter-&gt;rt_dev
op_logical_and
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|iter-&gt;rt_dst
comma
id|addr
)paren
op_eq
l_int|0
)paren
(brace
r_return
id|iter
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ndisc_add_dflt_router
r_static
r_void
id|ndisc_add_dflt_router
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
)paren
(brace
r_struct
id|rt6_info
op_star
id|iter
suffix:semicolon
id|rt-&gt;rt_ref
op_increment
suffix:semicolon
id|rt-&gt;fib_node
op_assign
op_amp
id|routing_table
suffix:semicolon
id|rt6_stats.fib_rt_alloc
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|default_rt_list
op_eq
l_int|NULL
)paren
(brace
id|default_rt_list
op_assign
id|rt
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|iter
op_assign
id|default_rt_list
suffix:semicolon
id|iter-&gt;next
suffix:semicolon
id|iter
op_assign
id|iter-&gt;next
)paren
suffix:semicolon
id|iter-&gt;next
op_assign
id|rt
suffix:semicolon
)brace
DECL|function|ndisc_del_dflt_router
r_static
r_void
id|ndisc_del_dflt_router
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
)paren
(brace
r_struct
id|rt6_info
op_star
id|iter
comma
op_star
id|back
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
id|default_rt_list
)paren
(brace
id|default_rt_list
op_assign
id|rt-&gt;next
suffix:semicolon
)brace
r_else
(brace
id|back
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|iter
op_assign
id|default_rt_list
suffix:semicolon
id|iter
suffix:semicolon
id|iter
op_assign
id|iter-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|iter
op_eq
id|rt
)paren
(brace
id|back-&gt;next
op_assign
id|rt-&gt;next
suffix:semicolon
r_break
suffix:semicolon
)brace
id|back
op_assign
id|iter
suffix:semicolon
)brace
)brace
id|rt-&gt;fib_node
op_assign
l_int|NULL
suffix:semicolon
id|rt_release
c_func
(paren
id|rt
)paren
suffix:semicolon
)brace
DECL|function|ndisc_purge_dflt_routers
r_static
r_void
id|ndisc_purge_dflt_routers
c_func
(paren
r_void
)paren
(brace
r_struct
id|rt6_info
op_star
id|iter
comma
op_star
id|rt
suffix:semicolon
r_for
c_loop
(paren
id|iter
op_assign
id|default_rt_list
suffix:semicolon
id|iter
suffix:semicolon
)paren
(brace
id|rt
op_assign
id|iter
suffix:semicolon
id|iter
op_assign
id|iter-&gt;next
suffix:semicolon
id|rt_release
c_func
(paren
id|rt
)paren
suffix:semicolon
)brace
id|default_rt_list
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|ndisc_ll_addr_update
r_static
r_void
id|ndisc_ll_addr_update
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
id|u8
op_star
id|opt
comma
r_int
id|len
comma
r_int
id|type
)paren
(brace
r_switch
c_cond
(paren
id|neigh-&gt;nud_state
)paren
(brace
r_case
id|NUD_REACHABLE
suffix:colon
r_case
id|NUD_STALE
suffix:colon
r_case
id|NUD_DELAY
suffix:colon
r_if
c_cond
(paren
id|len
op_eq
id|neigh-&gt;dev-&gt;addr_len
op_logical_and
id|memcmp
c_func
(paren
id|neigh-&gt;h_dest
comma
id|opt
op_plus
l_int|2
comma
id|len
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_IN_TIMER
)paren
(brace
id|ndisc_del_timer
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
r_default
suffix:colon
id|neigh-&gt;flags
op_and_assign
op_complement
id|NCF_HHVALID
suffix:semicolon
id|neigh-&gt;h_dest
op_assign
id|neigh-&gt;hh_data
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_store_hwaddr
c_func
(paren
id|neigh-&gt;dev
comma
id|opt
comma
id|len
comma
id|neigh-&gt;h_dest
comma
id|type
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;NDISC: invalid LL_ADDR&bslash;n&quot;
)paren
suffix:semicolon
id|neigh-&gt;h_dest
op_assign
l_int|NULL
suffix:semicolon
id|neigh-&gt;nud_state
op_assign
id|NUD_NONE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|neigh-&gt;nud_state
op_assign
id|NUD_STALE
suffix:semicolon
id|neigh-&gt;tstamp
op_assign
id|jiffies
suffix:semicolon
id|neigh-&gt;probes
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|dflt_rt_lookup
r_struct
id|rt6_info
op_star
id|dflt_rt_lookup
c_func
(paren
r_void
)paren
(brace
r_struct
id|rt6_info
op_star
id|match
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|score
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|default_rt_list
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;next
)paren
(brace
r_struct
id|neighbour
op_star
id|neigh
op_assign
id|rt-&gt;rt_nexthop
suffix:semicolon
r_if
c_cond
(paren
id|score
OL
l_int|0
)paren
(brace
id|score
op_assign
l_int|0
suffix:semicolon
id|match
op_assign
id|rt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_REACHABLE
)paren
(brace
r_if
c_cond
(paren
id|score
OL
l_int|1
)paren
(brace
id|score
op_assign
l_int|1
suffix:semicolon
id|match
op_assign
id|rt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|now
op_minus
id|neigh-&gt;tstamp
OL
id|nd_reachable_time
)paren
(brace
r_return
id|rt
suffix:semicolon
)brace
)brace
)brace
r_return
id|match
suffix:semicolon
)brace
DECL|function|ndisc_router_discovery
r_static
r_void
id|ndisc_router_discovery
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ra_msg
op_star
id|ra_msg
op_assign
(paren
r_struct
id|ra_msg
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|in6_dev
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|lifetime
suffix:semicolon
r_int
id|optlen
suffix:semicolon
id|__u8
op_star
id|opt
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|ra_msg
op_plus
l_int|1
)paren
suffix:semicolon
id|optlen
op_assign
(paren
id|skb-&gt;tail
op_minus
id|skb-&gt;h.raw
)paren
op_minus
r_sizeof
(paren
r_struct
id|ra_msg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;ipv6_hdr-&gt;hop_limit
op_ne
l_int|255
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NDISC: fake router advertisment received&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;set the RA_RECV flag in the interface&n;&t; */
id|in6_dev
op_assign
id|ipv6_get_idev
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;RA: can&squot;t find in6 device&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in6_dev-&gt;if_flags
op_amp
id|IF_RS_SENT
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;flag that an RA was received after an RS was sent&n;&t;&t; *&t;out on this interface.&n;&t;&t; */
id|in6_dev-&gt;if_flags
op_or_assign
id|IF_RA_RCVD
suffix:semicolon
)brace
id|lifetime
op_assign
id|ntohs
c_func
(paren
id|ra_msg-&gt;icmph.icmp6_rt_lifetime
)paren
suffix:semicolon
id|rt
op_assign
id|ndisc_get_dflt_router
c_func
(paren
id|skb-&gt;dev
comma
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_logical_and
id|lifetime
op_eq
l_int|0
)paren
(brace
id|ndisc_del_dflt_router
c_func
(paren
id|rt
)paren
suffix:semicolon
id|rt
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
op_logical_and
id|lifetime
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ndisc_rdisc: new default router&bslash;n&quot;
)paren
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_info
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|neigh
op_assign
id|ndisc_retrieve_neigh
c_func
(paren
id|skb-&gt;dev
comma
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
op_eq
l_int|NULL
)paren
(brace
id|neigh
op_assign
id|ndisc_new_neigh
c_func
(paren
id|skb-&gt;dev
comma
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
)paren
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|neigh-&gt;refcnt
)paren
suffix:semicolon
id|neigh-&gt;flags
op_or_assign
id|NCF_ROUTER
suffix:semicolon
id|memset
c_func
(paren
id|rt
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rt6_info
)paren
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt_dst
comma
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
)paren
suffix:semicolon
id|rt-&gt;rt_metric
op_assign
l_int|1
suffix:semicolon
id|rt-&gt;rt_flags
op_assign
id|RTF_GATEWAY
op_or
id|RTF_DYNAMIC
suffix:semicolon
id|rt-&gt;rt_dev
op_assign
id|skb-&gt;dev
suffix:semicolon
id|rt-&gt;rt_nexthop
op_assign
id|neigh
suffix:semicolon
id|ndisc_add_dflt_router
c_func
(paren
id|rt
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt
)paren
(brace
id|rt-&gt;rt_expires
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
id|lifetime
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ra_msg-&gt;icmph.icmp6_hop_limit
)paren
(brace
id|ipv6_hop_limit
op_assign
id|ra_msg-&gt;icmph.icmp6_hop_limit
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Update Reachable Time and Retrans Timer&n;&t; */
r_if
c_cond
(paren
id|ra_msg-&gt;retrans_timer
)paren
(brace
id|nd_retrans_timer
op_assign
id|ntohl
c_func
(paren
id|ra_msg-&gt;retrans_timer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ra_msg-&gt;reachable_time
)paren
(brace
id|__u32
id|rtime
op_assign
id|ntohl
c_func
(paren
id|ra_msg-&gt;reachable_time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtime
op_ne
id|nd_base_reachable_time
)paren
(brace
id|nd_base_reachable_time
op_assign
id|rtime
suffix:semicolon
id|nd_gc_staletime
op_assign
l_int|3
op_star
id|nd_base_reachable_time
suffix:semicolon
id|nd_reachable_time
op_assign
id|rand_reach_time
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;Process options.&n;&t; */
r_while
c_loop
(paren
id|optlen
OG
l_int|0
)paren
(brace
r_int
id|len
suffix:semicolon
id|len
op_assign
(paren
id|opt
(braket
l_int|1
)braket
op_lshift
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;RA: opt has 0 len&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
op_star
id|opt
)paren
(brace
r_case
id|ND_OPT_SOURCE_LL_ADDR
suffix:colon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|neigh
op_assign
id|rt-&gt;rt_nexthop
suffix:semicolon
id|ndisc_ll_addr_update
c_func
(paren
id|neigh
comma
id|opt
comma
id|len
comma
id|ND_OPT_SOURCE_LL_ADDR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ND_OPT_PREFIX_INFO
suffix:colon
id|addrconf_prefix_rcv
c_func
(paren
id|skb-&gt;dev
comma
id|opt
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ND_OPT_MTU
suffix:colon
r_if
c_cond
(paren
id|rt
)paren
(brace
r_int
id|mtu
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
id|mtu
op_assign
id|htonl
c_func
(paren
op_star
(paren
id|__u32
op_star
)paren
id|opt
op_plus
l_int|4
)paren
suffix:semicolon
id|dev
op_assign
id|rt-&gt;rt_nexthop-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|mtu
OL
l_int|576
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;NDISC: router &quot;
l_string|&quot;announcement with mtu = %d&bslash;n&quot;
comma
id|mtu
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;change_mtu
)paren
(brace
id|dev
op_member_access_from_pointer
id|change_mtu
c_func
(paren
id|dev
comma
id|mtu
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;mtu
op_assign
id|mtu
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|ND_OPT_TARGET_LL_ADDR
suffix:colon
r_case
id|ND_OPT_REDIRECT_HDR
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;got illegal option with RA&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;unkown option in RA&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|optlen
op_sub_assign
id|len
suffix:semicolon
id|opt
op_add_assign
id|len
suffix:semicolon
)brace
)brace
DECL|function|ndisc_forwarding_on
r_void
id|ndisc_forwarding_on
c_func
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; *&t;forwarding was turned on&n;&t; */
id|ndisc_purge_dflt_routers
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ndisc_forwarding_off
r_void
id|ndisc_forwarding_off
c_func
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; *&t;forwarding was turned off&n;&t; */
)brace
DECL|function|ndisc_redirect_rcv
r_static
r_void
id|ndisc_redirect_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|icmpv6hdr
op_star
id|icmph
suffix:semicolon
r_struct
id|in6_addr
op_star
id|dest
suffix:semicolon
r_struct
id|in6_addr
op_star
id|target
suffix:semicolon
multiline_comment|/* new first hop to destination */
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|on_link
op_assign
l_int|0
suffix:semicolon
r_int
id|optlen
suffix:semicolon
id|u8
op_star
id|opt
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;ipv6_hdr-&gt;hop_limit
op_ne
l_int|255
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NDISC: fake ICMP redirect received&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipv6_addr_type
c_func
(paren
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
)paren
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMP redirect: source address is not linklocal&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|optlen
op_assign
id|skb-&gt;tail
op_minus
id|skb-&gt;h.raw
suffix:semicolon
id|optlen
op_sub_assign
r_sizeof
(paren
r_struct
id|icmpv6hdr
)paren
op_plus
l_int|2
op_star
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|optlen
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMP redirect: packet too small&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|icmph
op_assign
(paren
r_struct
id|icmpv6hdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
id|target
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
(paren
id|icmph
op_plus
l_int|1
)paren
suffix:semicolon
id|dest
op_assign
id|target
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_addr_type
c_func
(paren
id|dest
)paren
op_amp
id|IPV6_ADDR_MULTICAST
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMP redirect for multicast addr&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv6_addr_cmp
c_func
(paren
id|dest
comma
id|target
)paren
op_eq
l_int|0
)paren
(brace
id|on_link
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipv6_addr_type
c_func
(paren
id|target
)paren
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMP redirect: target address is not linklocal&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* passed validation tests */
id|rt
op_assign
id|ipv6_rt_redirect
c_func
(paren
id|skb-&gt;dev
comma
id|dest
comma
id|target
comma
id|on_link
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMP redirect: no route to host&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|neigh
op_assign
id|rt-&gt;rt_nexthop
suffix:semicolon
id|opt
op_assign
(paren
id|u8
op_star
)paren
(paren
id|dest
op_plus
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|optlen
OG
l_int|0
)paren
(brace
r_int
id|len
suffix:semicolon
id|len
op_assign
(paren
id|opt
(braket
l_int|1
)braket
op_lshift
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|opt
op_eq
id|ND_OPT_TARGET_LL_ADDR
)paren
(brace
id|ndisc_ll_addr_update
c_func
(paren
id|neigh
comma
id|opt
comma
id|len
comma
id|ND_OPT_TARGET_LL_ADDR
)paren
suffix:semicolon
)brace
id|opt
op_add_assign
id|len
suffix:semicolon
id|optlen
op_sub_assign
id|len
suffix:semicolon
)brace
)brace
DECL|function|ndisc_send_redirect
r_void
id|ndisc_send_redirect
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|in6_addr
op_star
id|target
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|ndisc_socket.data
suffix:semicolon
r_int
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmpv6hdr
)paren
op_plus
l_int|2
op_star
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|buff
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_struct
id|icmpv6hdr
op_star
id|icmph
suffix:semicolon
r_struct
id|in6_addr
op_star
id|addrp
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|ta_len
op_assign
l_int|0
suffix:semicolon
id|u8
op_star
id|opt
suffix:semicolon
r_int
id|rd_len
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|hlen
suffix:semicolon
id|rt
op_assign
id|fibv6_lookup
c_func
(paren
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
comma
id|skb-&gt;dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt_flags
op_amp
id|RTF_GATEWAY
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ndisc_send_redirect: not a neighbour&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_REACHABLE
)paren
(brace
id|ta_len
op_assign
(paren
(paren
id|neigh-&gt;dev-&gt;addr_len
op_plus
l_int|1
)paren
op_rshift
l_int|3
)paren
op_plus
l_int|1
suffix:semicolon
id|len
op_add_assign
(paren
id|ta_len
op_lshift
l_int|3
)paren
suffix:semicolon
)brace
id|rd_len
op_assign
id|min
c_func
(paren
l_int|536
op_minus
id|len
comma
id|ntohs
c_func
(paren
id|skb-&gt;ipv6_hdr-&gt;payload_len
)paren
op_plus
l_int|8
)paren
suffix:semicolon
id|rd_len
op_and_assign
op_complement
l_int|0x7
suffix:semicolon
id|len
op_add_assign
id|rd_len
suffix:semicolon
id|ifp
op_assign
id|ipv6_get_lladdr
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifp
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;redirect: no link_local addr for dev&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|buff
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
comma
l_int|0
comma
l_int|0
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buff
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ndisc_send_redirect: alloc_skb failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|hlen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;dev-&gt;hard_header_len
)paren
(brace
id|hlen
op_assign
(paren
id|skb-&gt;dev-&gt;hard_header_len
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|buff
comma
id|hlen
op_plus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
)paren
suffix:semicolon
id|icmph
op_assign
(paren
r_struct
id|icmpv6hdr
op_star
)paren
id|skb_put
c_func
(paren
id|buff
comma
id|len
)paren
suffix:semicolon
id|memset
c_func
(paren
id|icmph
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|icmpv6hdr
)paren
)paren
suffix:semicolon
id|icmph-&gt;type
op_assign
id|NDISC_REDIRECT
suffix:semicolon
multiline_comment|/*&n;&t; *&t;copy target and destination addresses&n;&t; */
id|addrp
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
(paren
id|icmph
op_plus
l_int|1
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
id|addrp
comma
id|target
)paren
suffix:semicolon
id|addrp
op_increment
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
id|addrp
comma
op_amp
id|skb-&gt;ipv6_hdr-&gt;daddr
)paren
suffix:semicolon
id|opt
op_assign
(paren
id|u8
op_star
)paren
(paren
id|addrp
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;include target_address option&n;&t; */
r_if
c_cond
(paren
id|ta_len
)paren
(brace
r_int
id|zb
suffix:semicolon
op_star
(paren
id|opt
op_increment
)paren
op_assign
id|ND_OPT_TARGET_LL_ADDR
suffix:semicolon
op_star
(paren
id|opt
op_increment
)paren
op_assign
id|ta_len
suffix:semicolon
id|memcpy
c_func
(paren
id|opt
comma
id|neigh-&gt;h_dest
comma
id|neigh-&gt;dev-&gt;addr_len
)paren
suffix:semicolon
id|opt
op_add_assign
id|neigh-&gt;dev-&gt;addr_len
suffix:semicolon
multiline_comment|/* &n;&t;&t; *&t;if link layer address doesn&squot;t end on a 8 byte&n;&t;&t; *&t;boundary memset(0) the remider&n;&t;&t; */
id|zb
op_assign
(paren
id|neigh-&gt;dev-&gt;addr_len
op_plus
l_int|2
)paren
op_amp
l_int|0x7
suffix:semicolon
r_if
c_cond
(paren
id|zb
)paren
(brace
r_int
id|comp
suffix:semicolon
id|comp
op_assign
l_int|8
op_minus
id|zb
suffix:semicolon
id|memset
c_func
(paren
id|opt
comma
l_int|0
comma
id|comp
)paren
suffix:semicolon
id|opt
op_add_assign
id|comp
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;build redirect option and copy skb over to the new packet.&n;&t; */
id|memset
c_func
(paren
id|opt
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
op_star
(paren
id|opt
op_increment
)paren
op_assign
id|ND_OPT_REDIRECT_HDR
suffix:semicolon
op_star
(paren
id|opt
op_increment
)paren
op_assign
(paren
id|rd_len
op_rshift
l_int|3
)paren
suffix:semicolon
id|opt
op_add_assign
l_int|6
suffix:semicolon
id|memcpy
c_func
(paren
id|opt
comma
op_amp
id|skb-&gt;ipv6_hdr
comma
id|rd_len
op_minus
l_int|8
)paren
suffix:semicolon
id|icmph-&gt;checksum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|ifp-&gt;addr
comma
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|u8
op_star
)paren
id|icmph
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
id|ipv6_xmit
c_func
(paren
id|sk
comma
id|buff
comma
op_amp
id|ifp-&gt;addr
comma
op_amp
id|skb-&gt;ipv6_hdr-&gt;saddr
comma
l_int|NULL
comma
id|IPPROTO_ICMPV6
)paren
suffix:semicolon
)brace
multiline_comment|/* Called by upper layers to validate neighbour cache entries. */
DECL|function|ndisc_validate
r_void
id|ndisc_validate
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_INCOMPLETE
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_eq
id|NUD_DELAY
)paren
(brace
id|ndisc_del_timer
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
id|nd_stats.rcv_upper_conf
op_increment
suffix:semicolon
id|neigh-&gt;nud_state
op_assign
id|NUD_REACHABLE
suffix:semicolon
id|neigh-&gt;tstamp
op_assign
id|jiffies
suffix:semicolon
)brace
DECL|function|ndisc_rcv
r_int
id|ndisc_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|ipv6_options
op_star
id|opt
comma
r_int
r_int
id|len
)paren
(brace
r_struct
id|nd_msg
op_star
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_switch
c_cond
(paren
id|msg-&gt;icmph.type
)paren
(brace
r_case
id|NDISC_NEIGHBOUR_SOLICITATION
suffix:colon
r_if
c_cond
(paren
(paren
id|ifp
op_assign
id|ipv6_chk_addr
c_func
(paren
op_amp
id|msg-&gt;target
)paren
)paren
)paren
(brace
r_int
id|addr_type
suffix:semicolon
r_if
c_cond
(paren
id|ifp-&gt;flags
op_amp
id|DAD_INCOMPLETE
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; *&t;DAD failed &n;&t;&t;&t;&t; */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;duplicate address&bslash;n&quot;
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|ifp-&gt;timer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
id|saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr_type
op_amp
id|IPV6_ADDR_UNICAST
)paren
(brace
r_int
id|inc
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t;&t; *&t;update / create cache entry&n;&t;&t;&t;&t; *&t;for the source adddress&n;&t;&t;&t;&t; */
id|nd_stats.rcv_probes_ucast
op_increment
suffix:semicolon
id|ndisc_event_ns
c_func
(paren
id|saddr
comma
id|skb
)paren
suffix:semicolon
multiline_comment|/* answer solicitation */
id|neigh
op_assign
id|ndisc_retrieve_neigh
c_func
(paren
id|dev
comma
id|saddr
)paren
suffix:semicolon
id|inc
op_assign
id|ipv6_addr_type
c_func
(paren
id|daddr
)paren
suffix:semicolon
id|inc
op_and_assign
id|IPV6_ADDR_MULTICAST
suffix:semicolon
id|ndisc_send_na
c_func
(paren
id|dev
comma
id|neigh
comma
id|saddr
comma
op_amp
id|ifp-&gt;addr
comma
id|ifp-&gt;idev-&gt;router
comma
l_int|1
comma
id|inc
comma
id|inc
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* FIXME */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ns: non unicast saddr&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|NDISC_NEIGHBOUR_ADVERTISEMENT
suffix:colon
id|neigh
op_assign
id|ndisc_retrieve_neigh
c_func
(paren
id|skb-&gt;dev
comma
op_amp
id|msg-&gt;target
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
r_if
c_cond
(paren
id|neigh-&gt;flags
op_amp
id|NCF_ROUTER
)paren
(brace
r_if
c_cond
(paren
id|msg-&gt;icmph.icmp6_router
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;&t; *&t;Change: router to host&n;&t;&t;&t;&t;&t; */
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
id|ndisc_get_dflt_router
c_func
(paren
id|skb-&gt;dev
comma
id|saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
id|ndisc_del_dflt_router
c_func
(paren
id|rt
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|msg-&gt;icmph.icmp6_router
)paren
(brace
id|neigh-&gt;flags
op_or_assign
id|NCF_ROUTER
suffix:semicolon
)brace
)brace
id|ndisc_event_na
c_func
(paren
id|neigh
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|msg-&gt;opt
comma
id|skb-&gt;tail
op_minus
(paren
id|u8
op_star
)paren
op_amp
id|msg-&gt;opt
multiline_comment|/*opt_len*/
comma
id|msg-&gt;icmph.icmp6_solicited
comma
id|msg-&gt;icmph.icmp6_override
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv6_forwarding
op_eq
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|msg-&gt;icmph.type
)paren
(brace
r_case
id|NDISC_ROUTER_ADVERTISEMENT
suffix:colon
id|ndisc_router_discovery
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NDISC_REDIRECT
suffix:colon
id|ndisc_redirect_rcv
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ndisc_get_info
r_int
id|ndisc_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|ndisc_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NCACHE_NUM_BUCKETS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|neigh
op_assign
id|neighbours
(braket
id|i
)braket
suffix:semicolon
id|neigh
suffix:semicolon
id|neigh
op_assign
id|neigh-&gt;next
)paren
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%02x&quot;
comma
id|neigh-&gt;addr.s6_addr
(braket
id|j
)braket
)paren
suffix:semicolon
id|len
op_add_assign
l_int|2
suffix:semicolon
)brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot; %02x %02x %08lx %08lx %04x %04x &quot;
comma
id|i
comma
id|neigh-&gt;nud_state
comma
id|neigh-&gt;expires
op_minus
id|now
comma
id|now
op_minus
id|neigh-&gt;tstamp
comma
id|neigh-&gt;refcnt
comma
id|neigh-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;h_dest
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|neigh-&gt;dev-&gt;addr_len
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%02x&quot;
comma
id|neigh-&gt;h_dest
(braket
id|j
)braket
)paren
suffix:semicolon
id|len
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;000000000000&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|ndisc_release_lock
c_func
(paren
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
suffix:semicolon
id|len
op_sub_assign
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|variable|ndisc_proc_entry
r_struct
id|proc_dir_entry
id|ndisc_proc_entry
op_assign
(brace
l_int|0
comma
l_int|11
comma
l_string|&quot;ndisc_cache&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|ndisc_get_info
)brace
suffix:semicolon
DECL|function|ndisc_init
r_void
id|ndisc_init
c_func
(paren
r_struct
id|proto_ops
op_star
id|ops
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Init ndisc_socket&n;&t; */
id|ndisc_socket.type
op_assign
id|SOCK_RAW
suffix:semicolon
id|ndisc_socket.ops
op_assign
id|ops
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ops
op_member_access_from_pointer
id|create
c_func
(paren
op_amp
id|ndisc_socket
comma
id|IPPROTO_ICMPV6
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Failed to create the NDISC control socket.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|sk
op_assign
id|ndisc_socket.data
suffix:semicolon
id|sk-&gt;allocation
op_assign
id|GFP_ATOMIC
suffix:semicolon
id|sk-&gt;net_pinfo.af_inet6.hop_limit
op_assign
l_int|255
suffix:semicolon
id|sk-&gt;net_pinfo.af_inet6.priority
op_assign
l_int|15
suffix:semicolon
id|sk-&gt;num
op_assign
l_int|256
suffix:semicolon
multiline_comment|/* Don&squot;t receive any data */
multiline_comment|/*&n;         * Initialize the neighbours hash buckets.&n;         */
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
id|NCACHE_NUM_BUCKETS
suffix:semicolon
id|i
op_increment
)paren
id|neighbours
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* General ND state machine timer. */
id|init_timer
c_func
(paren
op_amp
id|ndisc_timer
)paren
suffix:semicolon
id|ndisc_timer.function
op_assign
id|ndisc_timer_handler
suffix:semicolon
id|ndisc_timer.data
op_assign
l_int|0L
suffix:semicolon
id|ndisc_timer.expires
op_assign
l_int|0L
suffix:semicolon
multiline_comment|/* ND GC timer */
id|init_timer
c_func
(paren
op_amp
id|ndisc_gc_timer
)paren
suffix:semicolon
id|ndisc_gc_timer.function
op_assign
id|ndisc_garbage_collect
suffix:semicolon
id|ndisc_gc_timer.data
op_assign
l_int|0L
suffix:semicolon
id|ndisc_gc_timer.expires
op_assign
id|jiffies
op_plus
id|nd_gc_interval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ndisc_gc_timer
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IPV6_MODULE
id|ndisc_eth_hook
op_assign
id|ndisc_eth_resolv
suffix:semicolon
id|proc_register_dynamic
c_func
(paren
op_amp
id|proc_net
comma
op_amp
id|ndisc_proc_entry
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef CONFIG_IPV6_MODULE
DECL|function|ndisc_cleanup
r_void
id|ndisc_cleanup
c_func
(paren
r_void
)paren
(brace
id|ndisc_eth_hook
op_assign
l_int|NULL
suffix:semicolon
id|proc_unregister
c_func
(paren
op_amp
id|proc_net
comma
id|ndisc_proc_entry.low_ino
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|ndisc_gc_timer
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|ndisc_timer
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Local variables:&n; *  compile-command: &quot;gcc -D__KERNEL__ -I/usr/src/linux/include -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer -fno-strength-reduce -pipe -m486 -DCPU=486 -DMODULE -DMODVERSIONS -include /usr/src/linux/include/linux/modversions.h  -c -o ndisc.o ndisc.c&quot;&n; * c-file-style: &quot;Linux&quot;&n; * End:&n; */
eof
