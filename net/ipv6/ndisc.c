multiline_comment|/*&n; *&t;Neighbour Discovery for IPv6&n; *&t;Linux INET6 implementation &n; *&n; *&t;Authors:&n; *&t;Pedro Roque&t;&t;&lt;roque@di.fc.ul.pt&gt;&t;&n; *&t;Mike Shaver&t;&t;&lt;shaver@ingenia.com&gt;&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
multiline_comment|/*&n; *&t;Changes:&n; *&n; *&t;Lars Fenneberg&t;&t;&t;:&t;fixed MTU setting on receipt&n; *&t;&t;&t;&t;&t;&t;of an RA.&n; *&n; *&t;Janos Farkas&t;&t;&t;:&t;kmalloc failure checks&n; *&t;Alexey Kuznetsov&t;&t;:&t;state machine reworked&n; *&t;&t;&t;&t;&t;&t;and moved to net/core.&n; */
multiline_comment|/* Set to 3 to get tracing... */
DECL|macro|ND_DEBUG
mdefine_line|#define ND_DEBUG 1
DECL|macro|ND_PRINTK
mdefine_line|#define ND_PRINTK(x...) printk(KERN_DEBUG x)
DECL|macro|ND_NOPRINTK
mdefine_line|#define ND_NOPRINTK(x...) do { ; } while(0)
DECL|macro|ND_PRINTK0
mdefine_line|#define ND_PRINTK0 ND_PRINTK
DECL|macro|ND_PRINTK1
mdefine_line|#define ND_PRINTK1 ND_NOPRINTK
DECL|macro|ND_PRINTK2
mdefine_line|#define ND_PRINTK2 ND_NOPRINTK
macro_line|#if ND_DEBUG &gt;= 1
DECL|macro|ND_PRINTK1
macro_line|#undef ND_PRINTK1
DECL|macro|ND_PRINTK1
mdefine_line|#define ND_PRINTK1 ND_PRINTK
macro_line|#endif
macro_line|#if ND_DEBUG &gt;= 2
DECL|macro|ND_PRINTK2
macro_line|#undef ND_PRINTK2
DECL|macro|ND_PRINTK2
mdefine_line|#define ND_PRINTK2 ND_PRINTK
macro_line|#endif
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#ifdef CONFIG_SYSCTL
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/ipv6.h&gt;
macro_line|#include &lt;linux/icmpv6.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/snmp.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/ndisc.h&gt;
macro_line|#include &lt;net/ip6_route.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;net/icmp.h&gt;
macro_line|#include &lt;net/checksum.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
DECL|variable|ndisc_socket
r_static
r_struct
id|socket
op_star
id|ndisc_socket
suffix:semicolon
r_static
id|u32
id|ndisc_hash
c_func
(paren
r_const
r_void
op_star
id|pkey
comma
r_const
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ndisc_constructor
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
suffix:semicolon
r_static
r_void
id|ndisc_solicit
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|ndisc_error_report
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|pndisc_constructor
c_func
(paren
r_struct
id|pneigh_entry
op_star
id|n
)paren
suffix:semicolon
r_static
r_void
id|pndisc_destructor
c_func
(paren
r_struct
id|pneigh_entry
op_star
id|n
)paren
suffix:semicolon
r_static
r_void
id|pndisc_redo
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
DECL|variable|ndisc_generic_ops
r_static
r_struct
id|neigh_ops
id|ndisc_generic_ops
op_assign
(brace
id|AF_INET6
comma
l_int|NULL
comma
id|ndisc_solicit
comma
id|ndisc_error_report
comma
id|neigh_resolve_output
comma
id|neigh_connected_output
comma
id|dev_queue_xmit
comma
id|dev_queue_xmit
)brace
suffix:semicolon
DECL|variable|ndisc_hh_ops
r_static
r_struct
id|neigh_ops
id|ndisc_hh_ops
op_assign
(brace
id|AF_INET6
comma
l_int|NULL
comma
id|ndisc_solicit
comma
id|ndisc_error_report
comma
id|neigh_resolve_output
comma
id|neigh_resolve_output
comma
id|dev_queue_xmit
comma
id|dev_queue_xmit
)brace
suffix:semicolon
DECL|variable|ndisc_direct_ops
r_static
r_struct
id|neigh_ops
id|ndisc_direct_ops
op_assign
(brace
id|AF_INET6
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
id|dev_queue_xmit
comma
id|dev_queue_xmit
comma
id|dev_queue_xmit
comma
id|dev_queue_xmit
)brace
suffix:semicolon
DECL|variable|nd_tbl
r_struct
id|neigh_table
id|nd_tbl
op_assign
(brace
l_int|NULL
comma
id|AF_INET6
comma
r_sizeof
(paren
r_struct
id|neighbour
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
comma
id|ndisc_hash
comma
id|ndisc_constructor
comma
id|pndisc_constructor
comma
id|pndisc_destructor
comma
id|pndisc_redo
comma
l_string|&quot;ndisc_cache&quot;
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|nd_tbl
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|30
op_star
id|HZ
comma
l_int|1
op_star
id|HZ
comma
l_int|60
op_star
id|HZ
comma
l_int|30
op_star
id|HZ
comma
l_int|5
op_star
id|HZ
comma
l_int|3
comma
l_int|3
comma
l_int|0
comma
l_int|3
comma
l_int|1
op_star
id|HZ
comma
(paren
l_int|8
op_star
id|HZ
)paren
op_div
l_int|10
comma
l_int|64
comma
l_int|0
)brace
comma
l_int|30
op_star
id|HZ
comma
l_int|128
comma
l_int|512
comma
l_int|1024
comma
)brace
suffix:semicolon
DECL|macro|NDISC_OPT_SPACE
mdefine_line|#define NDISC_OPT_SPACE(len) (((len)+2+7)&amp;~7)
DECL|function|ndisc_fill_option
r_static
id|u8
op_star
id|ndisc_fill_option
c_func
(paren
id|u8
op_star
id|opt
comma
r_int
id|type
comma
r_void
op_star
id|data
comma
r_int
id|data_len
)paren
(brace
r_int
id|space
op_assign
id|NDISC_OPT_SPACE
c_func
(paren
id|data_len
)paren
suffix:semicolon
id|opt
(braket
l_int|0
)braket
op_assign
id|type
suffix:semicolon
id|opt
(braket
l_int|1
)braket
op_assign
id|space
op_rshift
l_int|3
suffix:semicolon
id|memcpy
c_func
(paren
id|opt
op_plus
l_int|2
comma
id|data
comma
id|data_len
)paren
suffix:semicolon
id|data_len
op_add_assign
l_int|2
suffix:semicolon
id|opt
op_add_assign
id|data_len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|space
op_sub_assign
id|data_len
)paren
OG
l_int|0
)paren
id|memset
c_func
(paren
id|opt
comma
l_int|0
comma
id|space
)paren
suffix:semicolon
r_return
id|opt
op_plus
id|space
suffix:semicolon
)brace
DECL|function|ndisc_mc_map
r_int
id|ndisc_mc_map
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_char
op_star
id|buf
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|dir
)paren
(brace
r_switch
c_cond
(paren
id|dev-&gt;type
)paren
(brace
r_case
id|ARPHRD_ETHER
suffix:colon
r_case
id|ARPHRD_IEEE802
suffix:colon
multiline_comment|/* Not sure. Check it later. --ANK */
r_case
id|ARPHRD_FDDI
suffix:colon
id|ipv6_eth_mc_map
c_func
(paren
id|addr
comma
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ARPHRD_IEEE802_TR
suffix:colon
id|ipv6_tr_mc_map
c_func
(paren
id|addr
comma
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|dir
)paren
(brace
id|memcpy
c_func
(paren
id|buf
comma
id|dev-&gt;broadcast
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|ndisc_hash
r_static
id|u32
id|ndisc_hash
c_func
(paren
r_const
r_void
op_star
id|pkey
comma
r_const
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u32
id|hash_val
suffix:semicolon
id|hash_val
op_assign
op_star
(paren
id|u32
op_star
)paren
(paren
id|pkey
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
op_minus
l_int|4
)paren
suffix:semicolon
id|hash_val
op_xor_assign
(paren
id|hash_val
op_rshift
l_int|16
)paren
suffix:semicolon
id|hash_val
op_xor_assign
id|hash_val
op_rshift
l_int|8
suffix:semicolon
id|hash_val
op_xor_assign
id|hash_val
op_rshift
l_int|3
suffix:semicolon
id|hash_val
op_assign
(paren
id|hash_val
op_xor
id|dev-&gt;ifindex
)paren
op_amp
id|NEIGH_HASHMASK
suffix:semicolon
r_return
id|hash_val
suffix:semicolon
)brace
DECL|function|ndisc_constructor
r_static
r_int
id|ndisc_constructor
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
r_struct
id|in6_addr
op_star
id|addr
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
op_amp
id|neigh-&gt;primary_key
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|neigh-&gt;dev
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|in6_dev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|addr_type
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev-&gt;nd_parms
)paren
id|neigh-&gt;parms
op_assign
id|in6_dev-&gt;nd_parms
suffix:semicolon
r_if
c_cond
(paren
id|addr_type
op_amp
id|IPV6_ADDR_MULTICAST
)paren
id|neigh-&gt;type
op_assign
id|RTN_MULTICAST
suffix:semicolon
r_else
id|neigh-&gt;type
op_assign
id|RTN_UNICAST
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header
op_eq
l_int|NULL
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_NOARP
suffix:semicolon
id|neigh-&gt;ops
op_assign
op_amp
id|ndisc_direct_ops
suffix:semicolon
id|neigh-&gt;output
op_assign
id|neigh-&gt;ops-&gt;queue_xmit
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|addr_type
op_amp
id|IPV6_ADDR_MULTICAST
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_NOARP
suffix:semicolon
id|ndisc_mc_map
c_func
(paren
id|addr
comma
id|neigh-&gt;ha
comma
id|dev
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
(paren
id|IFF_NOARP
op_or
id|IFF_LOOPBACK
)paren
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_NOARP
suffix:semicolon
id|memcpy
c_func
(paren
id|neigh-&gt;ha
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
id|neigh-&gt;type
op_assign
id|RTN_LOCAL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_POINTOPOINT
)paren
(brace
id|neigh-&gt;nud_state
op_assign
id|NUD_NOARP
suffix:semicolon
id|memcpy
c_func
(paren
id|neigh-&gt;ha
comma
id|dev-&gt;broadcast
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;hard_header_cache
)paren
id|neigh-&gt;ops
op_assign
op_amp
id|ndisc_hh_ops
suffix:semicolon
r_else
id|neigh-&gt;ops
op_assign
op_amp
id|ndisc_generic_ops
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_VALID
)paren
id|neigh-&gt;output
op_assign
id|neigh-&gt;ops-&gt;connected_output
suffix:semicolon
r_else
id|neigh-&gt;output
op_assign
id|neigh-&gt;ops-&gt;output
suffix:semicolon
)brace
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pndisc_constructor
r_static
r_int
id|pndisc_constructor
c_func
(paren
r_struct
id|pneigh_entry
op_star
id|n
)paren
(brace
r_struct
id|in6_addr
op_star
id|addr
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
op_amp
id|n-&gt;key
suffix:semicolon
r_struct
id|in6_addr
id|maddr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|n-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
op_logical_or
id|__in6_dev_get
c_func
(paren
id|dev
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#ifndef CONFIG_IPV6_NO_PB
id|addrconf_addr_solict_mult_old
c_func
(paren
id|addr
comma
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_inc
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_IPV6_EUI64
id|addrconf_addr_solict_mult_new
c_func
(paren
id|addr
comma
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_inc
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pndisc_destructor
r_static
r_void
id|pndisc_destructor
c_func
(paren
r_struct
id|pneigh_entry
op_star
id|n
)paren
(brace
r_struct
id|in6_addr
op_star
id|addr
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
op_amp
id|n-&gt;key
suffix:semicolon
r_struct
id|in6_addr
id|maddr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|n-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
op_logical_or
id|__in6_dev_get
c_func
(paren
id|dev
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
macro_line|#ifndef CONFIG_IPV6_NO_PB
id|addrconf_addr_solict_mult_old
c_func
(paren
id|addr
comma
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_dec
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_IPV6_EUI64
id|addrconf_addr_solict_mult_new
c_func
(paren
id|addr
comma
op_amp
id|maddr
)paren
suffix:semicolon
id|ipv6_dev_mc_dec
c_func
(paren
id|dev
comma
op_amp
id|maddr
)paren
suffix:semicolon
macro_line|#endif
)brace
r_static
r_int
DECL|function|ndisc_build_ll_hdr
id|ndisc_build_ll_hdr
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_int
id|len
)paren
(brace
r_int
r_char
id|ha
(braket
id|MAX_ADDR_LEN
)braket
suffix:semicolon
r_int
r_char
op_star
id|h_dest
op_assign
l_int|NULL
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
(paren
id|dev-&gt;hard_header_len
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_type
c_func
(paren
id|daddr
)paren
op_amp
id|IPV6_ADDR_MULTICAST
)paren
(brace
id|ndisc_mc_map
c_func
(paren
id|daddr
comma
id|ha
comma
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|h_dest
op_assign
id|ha
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|read_lock_bh
c_func
(paren
op_amp
id|neigh-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_VALID
)paren
(brace
id|memcpy
c_func
(paren
id|ha
comma
id|neigh-&gt;ha
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|h_dest
op_assign
id|ha
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|neigh-&gt;lock
)paren
suffix:semicolon
)brace
r_else
(brace
id|neigh
op_assign
id|neigh_lookup
c_func
(paren
op_amp
id|nd_tbl
comma
id|daddr
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|read_lock_bh
c_func
(paren
op_amp
id|neigh-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_VALID
)paren
(brace
id|memcpy
c_func
(paren
id|ha
comma
id|neigh-&gt;ha
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|h_dest
op_assign
id|ha
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|neigh-&gt;lock
)paren
suffix:semicolon
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dev
op_member_access_from_pointer
id|hard_header
c_func
(paren
id|skb
comma
id|dev
comma
id|ETH_P_IPV6
comma
id|h_dest
comma
l_int|NULL
comma
id|len
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send a Neighbour Advertisement&n; */
DECL|function|ndisc_send_na
r_void
id|ndisc_send_na
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|solicited_addr
comma
r_int
id|router
comma
r_int
id|solicited
comma
r_int
id|override
comma
r_int
id|inc_opt
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|ndisc_socket-&gt;sk
suffix:semicolon
r_struct
id|nd_msg
op_star
id|msg
suffix:semicolon
r_int
id|len
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|err
suffix:semicolon
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inc_opt
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
id|len
op_add_assign
id|NDISC_OPT_SPACE
c_func
(paren
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_else
id|inc_opt
op_assign
l_int|0
suffix:semicolon
)brace
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
op_plus
id|dev-&gt;hard_header_len
op_plus
l_int|15
comma
l_int|0
comma
l_int|0
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK1
c_func
(paren
l_string|&quot;send_na: alloc skb failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ndisc_build_ll_hdr
c_func
(paren
id|skb
comma
id|dev
comma
id|daddr
comma
id|neigh
comma
id|len
)paren
op_eq
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ip6_nd_hdr
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
id|solicited_addr
comma
id|daddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|msg-&gt;icmph.icmp6_type
op_assign
id|NDISC_NEIGHBOUR_ADVERTISEMENT
suffix:semicolon
id|msg-&gt;icmph.icmp6_code
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_cksum
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_unused
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_router
op_assign
id|router
suffix:semicolon
id|msg-&gt;icmph.icmp6_solicited
op_assign
id|solicited
suffix:semicolon
id|msg-&gt;icmph.icmp6_override
op_assign
op_logical_neg
op_logical_neg
id|override
suffix:semicolon
multiline_comment|/* Set the target address. */
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;target
comma
id|solicited_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inc_opt
)paren
id|ndisc_fill_option
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|msg-&gt;opt
comma
id|ND_OPT_TARGET_LL_ADDR
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
multiline_comment|/* checksum */
id|msg-&gt;icmph.icmp6_cksum
op_assign
id|csum_ipv6_magic
c_func
(paren
id|solicited_addr
comma
id|daddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|__u8
op_star
)paren
id|msg
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|Icmp6OutNeighborAdvertisements
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|Icmp6OutMsgs
)paren
suffix:semicolon
)brace
DECL|function|ndisc_send_ns
r_void
id|ndisc_send_ns
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|in6_addr
op_star
id|solicit
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|in6_addr
op_star
id|saddr
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|ndisc_socket-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|nd_msg
op_star
id|msg
suffix:semicolon
r_struct
id|in6_addr
id|addr_buf
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|err
suffix:semicolon
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
id|len
op_add_assign
id|NDISC_OPT_SPACE
c_func
(paren
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
op_plus
id|dev-&gt;hard_header_len
op_plus
l_int|15
comma
l_int|0
comma
l_int|0
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK1
c_func
(paren
l_string|&quot;send_ns: alloc skb failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|saddr
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|ipv6_get_lladdr
c_func
(paren
id|dev
comma
op_amp
id|addr_buf
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|saddr
op_assign
op_amp
id|addr_buf
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ndisc_build_ll_hdr
c_func
(paren
id|skb
comma
id|dev
comma
id|daddr
comma
id|neigh
comma
id|len
)paren
op_eq
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ip6_nd_hdr
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
id|saddr
comma
id|daddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|msg-&gt;icmph.icmp6_type
op_assign
id|NDISC_NEIGHBOUR_SOLICITATION
suffix:semicolon
id|msg-&gt;icmph.icmp6_code
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_cksum
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;icmph.icmp6_unused
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set the target address. */
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;target
comma
id|solicit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
id|ndisc_fill_option
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|msg-&gt;opt
comma
id|ND_OPT_SOURCE_LL_ADDR
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
multiline_comment|/* checksum */
id|msg-&gt;icmph.icmp6_cksum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|daddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|__u8
op_star
)paren
id|msg
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* send it! */
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|Icmp6OutNeighborSolicits
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|Icmp6OutMsgs
)paren
suffix:semicolon
)brace
DECL|function|ndisc_send_rs
r_void
id|ndisc_send_rs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|in6_addr
op_star
id|daddr
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|ndisc_socket-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|icmp6hdr
op_star
id|hdr
suffix:semicolon
id|__u8
op_star
id|opt
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|err
suffix:semicolon
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
id|len
op_add_assign
id|NDISC_OPT_SPACE
c_func
(paren
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
op_plus
id|dev-&gt;hard_header_len
op_plus
l_int|15
comma
l_int|0
comma
l_int|0
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK1
c_func
(paren
l_string|&quot;send_ns: alloc skb failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ndisc_build_ll_hdr
c_func
(paren
id|skb
comma
id|dev
comma
id|daddr
comma
l_int|NULL
comma
id|len
)paren
op_eq
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ip6_nd_hdr
c_func
(paren
id|sk
comma
id|skb
comma
id|dev
comma
id|saddr
comma
id|daddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|icmp6hdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|hdr-&gt;icmp6_type
op_assign
id|NDISC_ROUTER_SOLICITATION
suffix:semicolon
id|hdr-&gt;icmp6_code
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;icmp6_cksum
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;icmp6_unused
op_assign
l_int|0
suffix:semicolon
id|opt
op_assign
(paren
id|u8
op_star
)paren
(paren
id|hdr
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
id|ndisc_fill_option
c_func
(paren
id|opt
comma
id|ND_OPT_SOURCE_LL_ADDR
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
multiline_comment|/* checksum */
id|hdr-&gt;icmp6_cksum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|daddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|__u8
op_star
)paren
id|hdr
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* send it! */
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|Icmp6OutRouterSolicits
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|Icmp6OutMsgs
)paren
suffix:semicolon
)brace
DECL|function|ndisc_find_option
r_static
id|u8
op_star
id|ndisc_find_option
c_func
(paren
id|u8
op_star
id|opt
comma
r_int
id|opt_len
comma
r_int
id|len
comma
r_int
id|option
)paren
(brace
r_while
c_loop
(paren
id|opt_len
op_le
id|len
)paren
(brace
r_int
id|l
op_assign
id|opt
(braket
l_int|1
)braket
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|opt
(braket
l_int|0
)braket
op_eq
id|option
op_logical_and
id|l
op_ge
id|opt_len
)paren
r_return
id|opt
op_plus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|l
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ndisc: option has 0 len&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|opt
op_add_assign
id|l
suffix:semicolon
id|len
op_sub_assign
id|l
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ndisc_error_report
r_static
r_void
id|ndisc_error_report
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/*&n;&t; *&t;&quot;The sender MUST return an ICMP&n;&t; *&t; destination unreachable&quot;&n;&t; */
id|dst_link_failure
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* Called with locked neigh: either read or both */
DECL|function|ndisc_solicit
r_static
r_void
id|ndisc_solicit
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|in6_addr
op_star
id|saddr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|in6_addr
id|mcaddr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|neigh-&gt;dev
suffix:semicolon
r_struct
id|in6_addr
op_star
id|target
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
op_amp
id|neigh-&gt;primary_key
suffix:semicolon
r_int
id|probes
op_assign
id|atomic_read
c_func
(paren
op_amp
id|neigh-&gt;probes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_logical_and
id|ipv6_chk_addr
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|dev
)paren
)paren
id|saddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|probes
op_sub_assign
id|neigh-&gt;parms-&gt;ucast_probes
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_VALID
)paren
)paren
id|ND_PRINTK1
c_func
(paren
l_string|&quot;trying to ucast probe in NUD_INVALID&bslash;n&quot;
)paren
suffix:semicolon
id|ndisc_send_ns
c_func
(paren
id|dev
comma
id|neigh
comma
id|target
comma
id|target
comma
id|saddr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|probes
op_sub_assign
id|neigh-&gt;parms-&gt;app_probes
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef CONFIG_ARPD
id|neigh_app_ns
c_func
(paren
id|neigh
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef CONFIG_IPV6_EUI64
id|addrconf_addr_solict_mult_new
c_func
(paren
id|target
comma
op_amp
id|mcaddr
)paren
suffix:semicolon
id|ndisc_send_ns
c_func
(paren
id|dev
comma
l_int|NULL
comma
id|target
comma
op_amp
id|mcaddr
comma
id|saddr
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifndef CONFIG_IPV6_NO_PB
id|addrconf_addr_solict_mult_old
c_func
(paren
id|target
comma
op_amp
id|mcaddr
)paren
suffix:semicolon
id|ndisc_send_ns
c_func
(paren
id|dev
comma
l_int|NULL
comma
id|target
comma
op_amp
id|mcaddr
comma
id|saddr
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
DECL|function|ndisc_update
r_static
r_void
id|ndisc_update
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
id|u8
op_star
id|opt
comma
r_int
id|len
comma
r_int
id|type
)paren
(brace
id|opt
op_assign
id|ndisc_find_option
c_func
(paren
id|opt
comma
id|neigh-&gt;dev-&gt;addr_len
op_plus
l_int|2
comma
id|len
comma
id|type
)paren
suffix:semicolon
id|neigh_update
c_func
(paren
id|neigh
comma
id|opt
comma
id|NUD_STALE
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|ndisc_router_discovery
r_static
r_void
id|ndisc_router_discovery
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|ra_msg
op_star
id|ra_msg
op_assign
(paren
r_struct
id|ra_msg
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_struct
id|inet6_dev
op_star
id|in6_dev
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
id|lifetime
suffix:semicolon
r_int
id|optlen
suffix:semicolon
id|__u8
op_star
id|opt
op_assign
(paren
id|__u8
op_star
)paren
(paren
id|ra_msg
op_plus
l_int|1
)paren
suffix:semicolon
id|optlen
op_assign
(paren
id|skb-&gt;tail
op_minus
id|skb-&gt;h.raw
)paren
op_minus
r_sizeof
(paren
r_struct
id|ra_msg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;nh.ipv6h-&gt;hop_limit
op_ne
l_int|255
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;NDISC: fake router advertisment received&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;set the RA_RECV flag in the interface&n;&t; */
id|in6_dev
op_assign
id|in6_dev_get
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK1
c_func
(paren
l_string|&quot;RA: can&squot;t find in6 device&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in6_dev-&gt;cnf.forwarding
op_logical_or
op_logical_neg
id|in6_dev-&gt;cnf.accept_ra
)paren
(brace
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in6_dev-&gt;if_flags
op_amp
id|IF_RS_SENT
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;flag that an RA was received after an RS was sent&n;&t;&t; *&t;out on this interface.&n;&t;&t; */
id|in6_dev-&gt;if_flags
op_or_assign
id|IF_RA_RCVD
suffix:semicolon
)brace
id|lifetime
op_assign
id|ntohs
c_func
(paren
id|ra_msg-&gt;icmph.icmp6_rt_lifetime
)paren
suffix:semicolon
id|rt
op_assign
id|rt6_get_dflt_router
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_logical_and
id|lifetime
op_eq
l_int|0
)paren
(brace
id|ip6_del_rt
c_func
(paren
id|rt
)paren
suffix:semicolon
id|rt
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
op_logical_and
id|lifetime
)paren
(brace
id|ND_PRINTK2
c_func
(paren
l_string|&quot;ndisc_rdisc: adding default router&bslash;n&quot;
)paren
suffix:semicolon
id|rt
op_assign
id|rt6_add_dflt_router
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK1
c_func
(paren
l_string|&quot;route_add failed&bslash;n&quot;
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|neigh
op_assign
id|rt-&gt;rt6i_nexthop
suffix:semicolon
r_if
c_cond
(paren
id|neigh
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK1
c_func
(paren
l_string|&quot;nd: add default router: null neighbour&bslash;n&quot;
)paren
suffix:semicolon
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|neigh-&gt;flags
op_or_assign
id|NTF_ROUTER
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;If we where using an &quot;all destinations on link&quot; route&n;&t;&t; *&t;delete it&n;&t;&t; */
id|rt6_purge_dflt_routers
c_func
(paren
id|RTF_ALLONLINK
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt
)paren
id|rt-&gt;rt6i_expires
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
id|lifetime
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ra_msg-&gt;icmph.icmp6_hop_limit
)paren
id|in6_dev-&gt;cnf.hop_limit
op_assign
id|ra_msg-&gt;icmph.icmp6_hop_limit
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Update Reachable Time and Retrans Timer&n;&t; */
r_if
c_cond
(paren
id|in6_dev-&gt;nd_parms
)paren
(brace
id|__u32
id|rtime
op_assign
id|ntohl
c_func
(paren
id|ra_msg-&gt;retrans_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtime
op_logical_and
id|rtime
op_div
l_int|1000
OL
id|MAX_SCHEDULE_TIMEOUT
op_div
id|HZ
)paren
(brace
id|rtime
op_assign
(paren
id|rtime
op_star
id|HZ
)paren
op_div
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
id|rtime
OL
id|HZ
op_div
l_int|10
)paren
id|rtime
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
id|in6_dev-&gt;nd_parms-&gt;retrans_time
op_assign
id|rtime
suffix:semicolon
)brace
id|rtime
op_assign
id|ntohl
c_func
(paren
id|ra_msg-&gt;reachable_time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtime
op_logical_and
id|rtime
op_div
l_int|1000
OL
id|MAX_SCHEDULE_TIMEOUT
op_div
(paren
l_int|3
op_star
id|HZ
)paren
)paren
(brace
id|rtime
op_assign
(paren
id|rtime
op_star
id|HZ
)paren
op_div
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
id|rtime
OL
id|HZ
op_div
l_int|10
)paren
id|rtime
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|rtime
op_ne
id|in6_dev-&gt;nd_parms-&gt;base_reachable_time
)paren
(brace
id|in6_dev-&gt;nd_parms-&gt;base_reachable_time
op_assign
id|rtime
suffix:semicolon
id|in6_dev-&gt;nd_parms-&gt;gc_staletime
op_assign
l_int|3
op_star
id|rtime
suffix:semicolon
id|in6_dev-&gt;nd_parms-&gt;reachable_time
op_assign
id|neigh_rand_reach_time
c_func
(paren
id|rtime
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n;&t; *&t;Process options.&n;&t; */
r_while
c_loop
(paren
id|optlen
OG
l_int|0
)paren
(brace
r_int
id|len
op_assign
(paren
id|opt
(braket
l_int|1
)braket
op_lshift
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
(brace
id|ND_PRINTK0
c_func
(paren
l_string|&quot;RA: opt has 0 len&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
op_star
id|opt
)paren
(brace
r_case
id|ND_OPT_SOURCE_LL_ADDR
suffix:colon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|neigh
op_assign
id|rt-&gt;rt6i_nexthop
)paren
op_ne
l_int|NULL
op_logical_and
id|skb-&gt;dev-&gt;addr_len
op_plus
l_int|2
op_ge
id|len
)paren
id|neigh_update
c_func
(paren
id|neigh
comma
id|opt
op_plus
l_int|2
comma
id|NUD_STALE
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ND_OPT_PREFIX_INFO
suffix:colon
id|addrconf_prefix_rcv
c_func
(paren
id|skb-&gt;dev
comma
id|opt
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ND_OPT_MTU
suffix:colon
(brace
r_int
id|mtu
suffix:semicolon
id|mtu
op_assign
id|htonl
c_func
(paren
op_star
(paren
id|__u32
op_star
)paren
(paren
id|opt
op_plus
l_int|4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mtu
template_param
id|skb-&gt;dev-&gt;mtu
)paren
(brace
id|ND_PRINTK0
c_func
(paren
l_string|&quot;NDISC: router &quot;
l_string|&quot;announcement with mtu = %d&bslash;n&quot;
comma
id|mtu
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in6_dev-&gt;cnf.mtu6
op_ne
id|mtu
)paren
(brace
id|in6_dev-&gt;cnf.mtu6
op_assign
id|mtu
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
id|rt-&gt;u.dst.pmtu
op_assign
id|mtu
suffix:semicolon
id|rt6_mtu_change
c_func
(paren
id|skb-&gt;dev
comma
id|mtu
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|ND_OPT_TARGET_LL_ADDR
suffix:colon
r_case
id|ND_OPT_REDIRECT_HDR
suffix:colon
id|ND_PRINTK0
c_func
(paren
l_string|&quot;got illegal option with RA&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ND_PRINTK0
c_func
(paren
l_string|&quot;unkown option in RA&bslash;n&quot;
)paren
suffix:semicolon
)brace
suffix:semicolon
id|optlen
op_sub_assign
id|len
suffix:semicolon
id|opt
op_add_assign
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt
)paren
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
)brace
DECL|function|ndisc_redirect_rcv
r_static
r_void
id|ndisc_redirect_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|inet6_dev
op_star
id|in6_dev
suffix:semicolon
r_struct
id|icmp6hdr
op_star
id|icmph
suffix:semicolon
r_struct
id|in6_addr
op_star
id|dest
suffix:semicolon
r_struct
id|in6_addr
op_star
id|target
suffix:semicolon
multiline_comment|/* new first hop to destination */
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_int
id|on_link
op_assign
l_int|0
suffix:semicolon
r_int
id|optlen
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;nh.ipv6h-&gt;hop_limit
op_ne
l_int|255
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NDISC: fake ICMP redirect received&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipv6_addr_type
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
)paren
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMP redirect: source address is not linklocal&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|optlen
op_assign
id|skb-&gt;tail
op_minus
id|skb-&gt;h.raw
suffix:semicolon
id|optlen
op_sub_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
l_int|2
op_star
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|optlen
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMP redirect: packet too small&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|icmph
op_assign
(paren
r_struct
id|icmp6hdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
id|target
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
(paren
id|icmph
op_plus
l_int|1
)paren
suffix:semicolon
id|dest
op_assign
id|target
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_addr_type
c_func
(paren
id|dest
)paren
op_amp
id|IPV6_ADDR_MULTICAST
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMP redirect for multicast addr&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv6_addr_cmp
c_func
(paren
id|dest
comma
id|target
)paren
op_eq
l_int|0
)paren
(brace
id|on_link
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|ipv6_addr_type
c_func
(paren
id|target
)paren
op_amp
id|IPV6_ADDR_LINKLOCAL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ICMP redirect: target address is not linklocal&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|in6_dev
op_assign
id|in6_dev_get
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in6_dev
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev-&gt;cnf.forwarding
op_logical_or
op_logical_neg
id|in6_dev-&gt;cnf.accept_redirects
)paren
(brace
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* passed validation tests */
multiline_comment|/*&n;&t;   We install redirect only if nexthop state is valid.&n;&t; */
id|neigh
op_assign
id|__neigh_lookup
c_func
(paren
op_amp
id|nd_tbl
comma
id|target
comma
id|skb-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|ndisc_update
c_func
(paren
id|neigh
comma
(paren
id|u8
op_star
)paren
(paren
id|dest
op_plus
l_int|1
)paren
comma
id|optlen
comma
id|ND_OPT_TARGET_LL_ADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_VALID
)paren
id|rt6_redirect
c_func
(paren
id|dest
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|neigh
comma
id|on_link
)paren
suffix:semicolon
r_else
id|__neigh_event_send
c_func
(paren
id|neigh
comma
l_int|NULL
)paren
suffix:semicolon
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
)brace
DECL|function|ndisc_send_redirect
r_void
id|ndisc_send_redirect
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|in6_addr
op_star
id|target
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|ndisc_socket-&gt;sk
suffix:semicolon
r_int
id|len
op_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
l_int|2
op_star
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|buff
suffix:semicolon
r_struct
id|icmp6hdr
op_star
id|icmph
suffix:semicolon
r_struct
id|in6_addr
id|saddr_buf
suffix:semicolon
r_struct
id|in6_addr
op_star
id|addrp
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|u8
op_star
id|opt
suffix:semicolon
r_int
id|rd_len
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|hlen
suffix:semicolon
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
id|rt
op_assign
id|rt6_lookup
c_func
(paren
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
l_int|NULL
comma
id|dev-&gt;ifindex
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt6i_flags
op_amp
id|RTF_GATEWAY
)paren
(brace
id|ND_PRINTK1
c_func
(paren
l_string|&quot;ndisc_send_redirect: not a neighbour&bslash;n&quot;
)paren
suffix:semicolon
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|xrlim_allow
c_func
(paren
op_amp
id|rt-&gt;u.dst
comma
l_int|1
op_star
id|HZ
)paren
)paren
(brace
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
(brace
r_if
c_cond
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_VALID
)paren
(brace
id|len
op_add_assign
id|NDISC_OPT_SPACE
c_func
(paren
id|dev-&gt;addr_len
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* If nexthop is not valid, do not redirect!&n;&t;&t;&t;   We will make it later, when will be sure,&n;&t;&t;&t;   that it is alive.&n;&t;&t;&t; */
r_return
suffix:semicolon
)brace
)brace
id|rd_len
op_assign
id|min
c_func
(paren
id|IPV6_MIN_MTU
op_minus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
op_minus
id|len
comma
id|skb-&gt;len
op_plus
l_int|8
)paren
suffix:semicolon
id|rd_len
op_and_assign
op_complement
l_int|0x7
suffix:semicolon
id|len
op_add_assign
id|rd_len
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_get_lladdr
c_func
(paren
id|dev
comma
op_amp
id|saddr_buf
)paren
)paren
(brace
id|ND_PRINTK1
c_func
(paren
l_string|&quot;redirect: no link_local addr for dev&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|buff
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|MAX_HEADER
op_plus
id|len
op_plus
id|dev-&gt;hard_header_len
op_plus
l_int|15
comma
l_int|0
comma
l_int|0
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buff
op_eq
l_int|NULL
)paren
(brace
id|ND_PRINTK1
c_func
(paren
l_string|&quot;ndisc_send_redirect: alloc_skb failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|hlen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_build_ll_hdr
c_func
(paren
id|buff
comma
id|dev
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
l_int|NULL
comma
id|len
)paren
op_eq
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|buff
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ip6_nd_hdr
c_func
(paren
id|sk
comma
id|buff
comma
id|dev
comma
op_amp
id|saddr_buf
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|IPPROTO_ICMPV6
comma
id|len
)paren
suffix:semicolon
id|icmph
op_assign
(paren
r_struct
id|icmp6hdr
op_star
)paren
id|skb_put
c_func
(paren
id|buff
comma
id|len
)paren
suffix:semicolon
id|memset
c_func
(paren
id|icmph
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
)paren
suffix:semicolon
id|icmph-&gt;icmp6_type
op_assign
id|NDISC_REDIRECT
suffix:semicolon
multiline_comment|/*&n;&t; *&t;copy target and destination addresses&n;&t; */
id|addrp
op_assign
(paren
r_struct
id|in6_addr
op_star
)paren
(paren
id|icmph
op_plus
l_int|1
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
id|addrp
comma
id|target
)paren
suffix:semicolon
id|addrp
op_increment
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
id|addrp
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
)paren
suffix:semicolon
id|opt
op_assign
(paren
id|u8
op_star
)paren
(paren
id|addrp
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;include target_address option&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;addr_len
)paren
id|opt
op_assign
id|ndisc_fill_option
c_func
(paren
id|opt
comma
id|ND_OPT_TARGET_LL_ADDR
comma
id|neigh-&gt;ha
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;build redirect option and copy skb over to the new packet.&n;&t; */
id|memset
c_func
(paren
id|opt
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
op_star
(paren
id|opt
op_increment
)paren
op_assign
id|ND_OPT_REDIRECT_HDR
suffix:semicolon
op_star
(paren
id|opt
op_increment
)paren
op_assign
(paren
id|rd_len
op_rshift
l_int|3
)paren
suffix:semicolon
id|opt
op_add_assign
l_int|6
suffix:semicolon
id|memcpy
c_func
(paren
id|opt
comma
id|skb-&gt;nh.ipv6h
comma
id|rd_len
op_minus
l_int|8
)paren
suffix:semicolon
id|icmph-&gt;icmp6_cksum
op_assign
id|csum_ipv6_magic
c_func
(paren
op_amp
id|saddr_buf
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
comma
id|len
comma
id|IPPROTO_ICMPV6
comma
id|csum_partial
c_func
(paren
(paren
id|u8
op_star
)paren
id|icmph
comma
id|len
comma
l_int|0
)paren
)paren
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|buff
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|Icmp6OutRedirects
)paren
suffix:semicolon
id|ICMP6_INC_STATS
c_func
(paren
id|Icmp6OutMsgs
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_struct
id|neighbour
op_star
DECL|function|ndisc_recv_ns
id|ndisc_recv_ns
c_func
(paren
r_struct
id|in6_addr
op_star
id|saddr
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|u8
op_star
id|opt
suffix:semicolon
id|opt
op_assign
id|skb-&gt;h.raw
suffix:semicolon
id|opt
op_add_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
id|opt
op_assign
id|ndisc_find_option
c_func
(paren
id|opt
comma
id|skb-&gt;dev-&gt;addr_len
op_plus
l_int|2
comma
id|skb-&gt;tail
op_minus
id|opt
comma
id|ND_OPT_SOURCE_LL_ADDR
)paren
suffix:semicolon
r_return
id|neigh_event_ns
c_func
(paren
op_amp
id|nd_tbl
comma
id|opt
comma
id|saddr
comma
id|skb-&gt;dev
)paren
suffix:semicolon
)brace
DECL|function|ndisc_recv_na
r_static
id|__inline__
r_int
id|ndisc_recv_na
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|nd_msg
op_star
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
id|u8
op_star
id|opt
suffix:semicolon
id|opt
op_assign
id|skb-&gt;h.raw
suffix:semicolon
id|opt
op_add_assign
r_sizeof
(paren
r_struct
id|icmp6hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|in6_addr
)paren
suffix:semicolon
id|opt
op_assign
id|ndisc_find_option
c_func
(paren
id|opt
comma
id|skb-&gt;dev-&gt;addr_len
op_plus
l_int|2
comma
id|skb-&gt;tail
op_minus
id|opt
comma
id|ND_OPT_TARGET_LL_ADDR
)paren
suffix:semicolon
r_return
id|neigh_update
c_func
(paren
id|neigh
comma
id|opt
comma
id|msg-&gt;icmph.icmp6_solicited
ques
c_cond
id|NUD_REACHABLE
suffix:colon
id|NUD_STALE
comma
id|msg-&gt;icmph.icmp6_override
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|pndisc_redo
r_static
r_void
id|pndisc_redo
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|ndisc_rcv
c_func
(paren
id|skb
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|ndisc_rcv
r_int
id|ndisc_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_int
id|len
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
r_struct
id|in6_addr
op_star
id|saddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;saddr
suffix:semicolon
r_struct
id|in6_addr
op_star
id|daddr
op_assign
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
suffix:semicolon
r_struct
id|nd_msg
op_star
id|msg
op_assign
(paren
r_struct
id|nd_msg
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifp
suffix:semicolon
r_switch
c_cond
(paren
id|msg-&gt;icmph.icmp6_type
)paren
(brace
r_case
id|NDISC_NEIGHBOUR_SOLICITATION
suffix:colon
r_if
c_cond
(paren
(paren
id|ifp
op_assign
id|ipv6_get_ifaddr
c_func
(paren
op_amp
id|msg-&gt;target
comma
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
id|saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifp-&gt;flags
op_amp
id|IFA_F_TENTATIVE
)paren
(brace
multiline_comment|/* Address is tentative. If the source&n;&t;&t;&t;&t;   is unspecified address, it is someone&n;&t;&t;&t;&t;   does DAD, otherwise we ignore solicitations&n;&t;&t;&t;&t;   until DAD timer expires.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|addr_type
op_eq
id|IPV6_ADDR_ANY
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_IEEE802_TR
)paren
(brace
r_int
r_char
op_star
id|sadr
op_assign
id|skb-&gt;mac.raw
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|sadr
(braket
l_int|8
)braket
op_amp
l_int|0x7f
)paren
op_ne
(paren
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_amp
l_int|0x7f
)paren
)paren
op_logical_or
(paren
id|sadr
(braket
l_int|9
)braket
op_ne
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
)paren
op_logical_or
(paren
id|sadr
(braket
l_int|10
)braket
op_ne
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
)paren
op_logical_or
(paren
id|sadr
(braket
l_int|11
)braket
op_ne
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
)paren
op_logical_or
(paren
id|sadr
(braket
l_int|12
)braket
op_ne
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
)paren
op_logical_or
(paren
id|sadr
(braket
l_int|13
)braket
op_ne
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
)paren
(brace
id|addrconf_dad_failure
c_func
(paren
id|ifp
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|addrconf_dad_failure
c_func
(paren
id|ifp
)paren
suffix:semicolon
)brace
)brace
r_else
id|in6_ifa_put
c_func
(paren
id|ifp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr_type
op_eq
id|IPV6_ADDR_ANY
)paren
(brace
r_struct
id|in6_addr
id|maddr
suffix:semicolon
id|ipv6_addr_all_nodes
c_func
(paren
op_amp
id|maddr
)paren
suffix:semicolon
id|ndisc_send_na
c_func
(paren
id|dev
comma
l_int|NULL
comma
op_amp
id|maddr
comma
op_amp
id|ifp-&gt;addr
comma
id|ifp-&gt;idev-&gt;cnf.forwarding
comma
l_int|0
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|in6_ifa_put
c_func
(paren
id|ifp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr_type
op_amp
id|IPV6_ADDR_UNICAST
)paren
(brace
r_int
id|inc
op_assign
id|ipv6_addr_type
c_func
(paren
id|daddr
)paren
op_amp
id|IPV6_ADDR_MULTICAST
suffix:semicolon
r_if
c_cond
(paren
id|inc
)paren
id|nd_tbl.stats.rcv_probes_mcast
op_increment
suffix:semicolon
r_else
id|nd_tbl.stats.rcv_probes_ucast
op_increment
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t;&t; *&t;update / create cache entry&n;&t;&t;&t;&t; *&t;for the source adddress&n;&t;&t;&t;&t; */
id|neigh
op_assign
id|ndisc_recv_ns
c_func
(paren
id|saddr
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|ndisc_send_na
c_func
(paren
id|dev
comma
id|neigh
comma
id|saddr
comma
op_amp
id|ifp-&gt;addr
comma
id|ifp-&gt;idev-&gt;cnf.forwarding
comma
l_int|1
comma
id|inc
comma
id|inc
)paren
suffix:semicolon
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
)brace
id|in6_ifa_put
c_func
(paren
id|ifp
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|inet6_dev
op_star
id|in6_dev
op_assign
id|in6_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|addr_type
op_assign
id|ipv6_addr_type
c_func
(paren
id|saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev
op_logical_and
id|in6_dev-&gt;cnf.forwarding
op_logical_and
(paren
id|addr_type
op_amp
id|IPV6_ADDR_UNICAST
)paren
op_logical_and
id|pneigh_lookup
c_func
(paren
op_amp
id|nd_tbl
comma
op_amp
id|msg-&gt;target
comma
id|dev
comma
l_int|0
)paren
)paren
(brace
r_int
id|inc
op_assign
id|ipv6_addr_type
c_func
(paren
id|daddr
)paren
op_amp
id|IPV6_ADDR_MULTICAST
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;stamp.tv_sec
op_eq
l_int|0
op_logical_or
id|skb-&gt;pkt_type
op_eq
id|PACKET_HOST
op_logical_or
id|inc
op_eq
l_int|0
op_logical_or
id|in6_dev-&gt;nd_parms-&gt;proxy_delay
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|inc
)paren
id|nd_tbl.stats.rcv_probes_mcast
op_increment
suffix:semicolon
r_else
id|nd_tbl.stats.rcv_probes_ucast
op_increment
suffix:semicolon
id|neigh
op_assign
id|ndisc_recv_ns
c_func
(paren
id|saddr
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|ndisc_send_na
c_func
(paren
id|dev
comma
id|neigh
comma
id|saddr
comma
op_amp
id|msg-&gt;target
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
id|inc
)paren
suffix:semicolon
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|n
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
)paren
id|pneigh_enqueue
c_func
(paren
op_amp
id|nd_tbl
comma
id|in6_dev-&gt;nd_parms
comma
id|n
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|in6_dev
)paren
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|NDISC_NEIGHBOUR_ADVERTISEMENT
suffix:colon
r_if
c_cond
(paren
(paren
id|ipv6_addr_type
c_func
(paren
id|saddr
)paren
op_amp
id|IPV6_ADDR_MULTICAST
)paren
op_logical_and
id|msg-&gt;icmph.icmp6_solicited
)paren
(brace
id|ND_PRINTK0
c_func
(paren
l_string|&quot;NDISC: solicited NA is multicasted&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ifp
op_assign
id|ipv6_get_ifaddr
c_func
(paren
op_amp
id|msg-&gt;target
comma
id|dev
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ifp-&gt;flags
op_amp
id|IFA_F_TENTATIVE
)paren
(brace
id|addrconf_dad_failure
c_func
(paren
id|ifp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* What should we make now? The advertisement&n;&t;&t;&t;   is invalid, but ndisc specs say nothing&n;&t;&t;&t;   about it. It could be misconfiguration, or&n;&t;&t;&t;   an smart proxy agent tries to help us :-)&n;&t;&t;&t; */
id|ND_PRINTK0
c_func
(paren
l_string|&quot;%s: someone avertise our address!&bslash;n&quot;
comma
id|ifp-&gt;idev-&gt;dev-&gt;name
)paren
suffix:semicolon
id|in6_ifa_put
c_func
(paren
id|ifp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|neigh
op_assign
id|neigh_lookup
c_func
(paren
op_amp
id|nd_tbl
comma
op_amp
id|msg-&gt;target
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
r_if
c_cond
(paren
id|neigh-&gt;flags
op_amp
id|NTF_ROUTER
)paren
(brace
r_if
c_cond
(paren
id|msg-&gt;icmph.icmp6_router
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;&t; *&t;Change: router to host&n;&t;&t;&t;&t;&t; */
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
id|rt6_get_dflt_router
c_func
(paren
id|saddr
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
multiline_comment|/* It is safe only because&n;&t;&t;&t;&t;&t;&t;   we aer in BH */
id|dst_release
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
id|ip6_del_rt
c_func
(paren
id|rt
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|msg-&gt;icmph.icmp6_router
)paren
id|neigh-&gt;flags
op_or_assign
id|NTF_ROUTER
suffix:semicolon
)brace
id|ndisc_recv_na
c_func
(paren
id|neigh
comma
id|skb
)paren
suffix:semicolon
id|neigh_release
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|NDISC_ROUTER_ADVERTISEMENT
suffix:colon
id|ndisc_router_discovery
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NDISC_REDIRECT
suffix:colon
id|ndisc_redirect_rcv
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
macro_line|#ifndef CONFIG_RTNETLINK
DECL|function|ndisc_get_info
r_static
r_int
id|ndisc_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|NEIGH_HASHMASK
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|neighbour
op_star
id|neigh
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|nd_tbl.lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|neigh
op_assign
id|nd_tbl.hash_buckets
(braket
id|i
)braket
suffix:semicolon
id|neigh
suffix:semicolon
id|neigh
op_assign
id|neigh-&gt;next
)paren
(brace
r_int
id|j
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
op_plus
id|size
comma
l_string|&quot;%02x&quot;
comma
id|neigh-&gt;primary_key
(braket
id|j
)braket
)paren
suffix:semicolon
id|size
op_add_assign
l_int|2
suffix:semicolon
)brace
id|read_lock
c_func
(paren
op_amp
id|neigh-&gt;lock
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
op_plus
id|size
comma
l_string|&quot; %02x %02x %02x %02x %08lx %08lx %08x %04x %04x %04x %8s &quot;
comma
id|i
comma
l_int|128
comma
id|neigh-&gt;type
comma
id|neigh-&gt;nud_state
comma
id|now
op_minus
id|neigh-&gt;used
comma
id|now
op_minus
id|neigh-&gt;confirmed
comma
id|neigh-&gt;parms-&gt;reachable_time
comma
id|neigh-&gt;parms-&gt;gc_staletime
comma
id|atomic_read
c_func
(paren
op_amp
id|neigh-&gt;refcnt
)paren
op_minus
l_int|1
comma
id|neigh-&gt;flags
op_or
(paren
op_logical_neg
id|neigh-&gt;hh
ques
c_cond
l_int|0
suffix:colon
(paren
id|neigh-&gt;hh-&gt;hh_output
op_eq
id|dev_queue_xmit
ques
c_cond
l_int|4
suffix:colon
l_int|2
)paren
)paren
comma
id|neigh-&gt;dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|neigh-&gt;nud_state
op_amp
id|NUD_VALID
)paren
op_logical_and
id|neigh-&gt;dev-&gt;addr_len
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|neigh-&gt;dev-&gt;addr_len
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
op_plus
id|size
comma
l_string|&quot;%02x&quot;
comma
id|neigh-&gt;ha
(braket
id|j
)braket
)paren
suffix:semicolon
id|size
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
op_plus
id|size
comma
l_string|&quot;000000000000&quot;
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|neigh-&gt;lock
)paren
suffix:semicolon
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
op_plus
id|size
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_add_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_le
id|offset
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
id|offset
op_plus
id|length
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|nd_tbl.lock
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|nd_tbl.lock
)paren
suffix:semicolon
)brace
id|done
suffix:colon
op_star
id|start
op_assign
id|buffer
op_plus
id|len
op_minus
(paren
id|pos
op_minus
id|offset
)paren
suffix:semicolon
multiline_comment|/* Start of wanted data */
id|len
op_assign
id|pos
op_minus
id|offset
suffix:semicolon
multiline_comment|/* Start slop */
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
multiline_comment|/* Ending slop */
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif&t;/* CONFIG_PROC_FS */
DECL|function|ndisc_init
r_int
id|__init
id|ndisc_init
c_func
(paren
r_struct
id|net_proto_family
op_star
id|ops
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|err
suffix:semicolon
id|ndisc_socket
op_assign
id|sock_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ndisc_socket
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Failed to create the NDISC control socket.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|ndisc_socket-&gt;inode-&gt;i_uid
op_assign
l_int|0
suffix:semicolon
id|ndisc_socket-&gt;inode-&gt;i_gid
op_assign
l_int|0
suffix:semicolon
id|ndisc_socket-&gt;type
op_assign
id|SOCK_RAW
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ops
op_member_access_from_pointer
id|create
c_func
(paren
id|ndisc_socket
comma
id|IPPROTO_ICMPV6
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Failed to initializee the NDISC control socket (err %d).&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
id|sock_release
c_func
(paren
id|ndisc_socket
)paren
suffix:semicolon
id|ndisc_socket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* For safety. */
r_return
id|err
suffix:semicolon
)brace
id|sk
op_assign
id|ndisc_socket-&gt;sk
suffix:semicolon
id|sk-&gt;allocation
op_assign
id|GFP_ATOMIC
suffix:semicolon
id|sk-&gt;net_pinfo.af_inet6.hop_limit
op_assign
l_int|255
suffix:semicolon
multiline_comment|/* Do not loopback ndisc messages */
id|sk-&gt;net_pinfo.af_inet6.mc_loop
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;prot
op_member_access_from_pointer
id|unhash
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/*&n;         * Initialize the neighbour table&n;         */
id|neigh_table_init
c_func
(paren
op_amp
id|nd_tbl
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
macro_line|#ifndef CONFIG_RTNETLINK
id|proc_net_create
c_func
(paren
l_string|&quot;ndisc&quot;
comma
l_int|0
comma
id|ndisc_get_info
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef CONFIG_SYSCTL
id|neigh_sysctl_register
c_func
(paren
l_int|NULL
comma
op_amp
id|nd_tbl.parms
comma
id|NET_IPV6
comma
id|NET_IPV6_NEIGH
comma
l_string|&quot;ipv6&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ndisc_cleanup
r_void
id|ndisc_cleanup
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_PROC_FS
macro_line|#ifndef CONFIG_RTNETLINK
id|proc_net_remove
c_func
(paren
l_string|&quot;ndisc&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
id|neigh_table_clear
c_func
(paren
op_amp
id|nd_tbl
)paren
suffix:semicolon
id|sock_release
c_func
(paren
id|ndisc_socket
)paren
suffix:semicolon
id|ndisc_socket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* For safety. */
)brace
eof
