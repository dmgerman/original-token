multiline_comment|/*&n; *&t;IPv6 routing table&n; *&t;Linux INET6 implementation &n; *&n; *&t;Authors:&n; *&t;Pedro Roque&t;&t;&lt;roque@di.fc.ul.pt&gt;&t;&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#ifdef &t;CONFIG_PROC_FS
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#endif
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/snmp.h&gt;
macro_line|#include &lt;net/ipv6.h&gt;
macro_line|#include &lt;net/ndisc.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/ipv6_route.h&gt;
macro_line|#include &lt;net/addrconf.h&gt;
macro_line|#include &lt;net/netlink.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
multiline_comment|/*&n; *&t;Routing Table&n; *&n; *&t;simplified version of a radix tree&n; *&n; *&t;- every node shares it&squot;s acestors prefix&n; *&t;- the tree is ordered from less to most specific mask&n; *&t;- default routes are handled apart&n; *&n; *&t;this facilitates recursion a lot&n; */
DECL|variable|null_entry
r_static
r_struct
id|rt6_info
id|null_entry
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
(brace
(brace
(brace
l_int|0
)brace
)brace
)brace
comma
l_int|0
comma
l_int|1
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
id|RTF_REJECT
)brace
suffix:semicolon
DECL|variable|routing_table
r_struct
id|fib6_node
id|routing_table
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|null_entry
comma
l_int|0
comma
id|RTN_ROOT
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|default_rt_list
r_struct
id|rt6_info
op_star
id|default_rt_list
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|loopback_rt
r_struct
id|rt6_info
op_star
id|loopback_rt
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n; *&t;last_resort_rt - no routers present.&n; *&t;Assume all destinations on link.&n; */
DECL|variable|last_resort_rt
r_struct
id|rt6_info
op_star
id|last_resort_rt
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|request_queue
r_static
r_struct
id|rt6_req
id|request_queue
op_assign
(brace
l_int|0
comma
l_int|NULL
comma
op_amp
id|request_queue
comma
op_amp
id|request_queue
)brace
suffix:semicolon
multiline_comment|/*&n; *&t;A routing update causes an increase of the serial number on the&n; *&t;afected subtree. This allows for cached routes to be asynchronously&n; *&t;tested when modifications are made to the destination cache as a&n; *&t;result of redirects, path MTU changes, etc.&n; */
DECL|variable|rt_sernum
r_static
id|__u32
id|rt_sernum
op_assign
l_int|0
suffix:semicolon
DECL|variable|rt6_lock
r_static
id|atomic_t
id|rt6_lock
op_assign
l_int|0
suffix:semicolon
DECL|variable|rt6_bh_mask
r_static
r_int
id|rt6_bh_mask
op_assign
l_int|0
suffix:semicolon
DECL|macro|RT_BH_REQUEST
mdefine_line|#define RT_BH_REQUEST&t;1
DECL|macro|RT_BH_GC
mdefine_line|#define RT_BH_GC&t;2
r_static
r_void
id|__rt6_run_bh
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|typedef|f_pnode
r_typedef
r_void
(paren
op_star
id|f_pnode
)paren
(paren
r_struct
id|fib6_node
op_star
id|fn
comma
r_void
op_star
)paren
suffix:semicolon
r_static
r_void
id|rt6_walk_tree
c_func
(paren
id|f_pnode
id|func
comma
r_void
op_star
id|arg
comma
r_int
id|filter
)paren
suffix:semicolon
r_static
r_void
id|rt6_rt_timeout
c_func
(paren
r_struct
id|fib6_node
op_star
id|fn
comma
r_void
op_star
id|arg
)paren
suffix:semicolon
r_static
r_int
id|rt6_msgrcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
DECL|variable|rt6_stats
r_struct
id|rt6_statistics
id|rt6_stats
op_assign
(brace
l_int|1
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|rt_clients
r_static
id|atomic_t
id|rt_clients
op_assign
l_int|0
suffix:semicolon
r_void
id|rt6_timer_handler
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
DECL|variable|rt6_gc_timer
r_struct
id|timer_list
id|rt6_gc_timer
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
id|rt6_timer_handler
)brace
suffix:semicolon
DECL|function|rt6_run_bh
r_static
id|__inline__
r_void
id|rt6_run_bh
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt6_lock
op_eq
l_int|0
op_logical_and
id|rt6_bh_mask
)paren
(brace
id|__rt6_run_bh
c_func
(paren
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;request queue operations&n; *&t;FIFO queue/dequeue&n; */
DECL|function|rtreq_queue
r_static
id|__inline__
r_void
id|rtreq_queue
c_func
(paren
r_struct
id|rt6_req
op_star
id|req
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|rt6_req
op_star
id|next
op_assign
op_amp
id|request_queue
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|req-&gt;prev
op_assign
id|next-&gt;prev
suffix:semicolon
id|req-&gt;prev-&gt;next
op_assign
id|req
suffix:semicolon
id|next-&gt;prev
op_assign
id|req
suffix:semicolon
id|req-&gt;next
op_assign
id|next
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|rtreq_dequeue
r_static
id|__inline__
r_struct
id|rt6_req
op_star
id|rtreq_dequeue
c_func
(paren
r_void
)paren
(brace
r_struct
id|rt6_req
op_star
id|next
op_assign
op_amp
id|request_queue
suffix:semicolon
r_struct
id|rt6_req
op_star
id|head
suffix:semicolon
id|head
op_assign
id|next-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|head
op_eq
id|next
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|head-&gt;next-&gt;prev
op_assign
id|head-&gt;prev
suffix:semicolon
id|next-&gt;next
op_assign
id|head-&gt;next
suffix:semicolon
id|head-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|head-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
r_return
id|head
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;compare &quot;prefix length&quot; bits of an address&n; */
DECL|function|addr_match
r_static
id|__inline__
r_int
id|addr_match
c_func
(paren
r_struct
id|in6_addr
op_star
id|a1
comma
r_struct
id|in6_addr
op_star
id|a2
comma
r_int
id|prefixlen
)paren
(brace
r_int
id|pdw
suffix:semicolon
r_int
id|pbi
suffix:semicolon
id|pdw
op_assign
id|prefixlen
op_rshift
l_int|0x05
suffix:semicolon
multiline_comment|/* num of whole __u32 in prefix */
id|pbi
op_assign
id|prefixlen
op_amp
l_int|0x1f
suffix:semicolon
multiline_comment|/* num of bits in incomplete u32 in prefix */
r_if
c_cond
(paren
id|pdw
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|a1
comma
id|a2
comma
id|pdw
op_lshift
l_int|2
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pbi
)paren
(brace
id|__u32
id|w1
comma
id|w2
suffix:semicolon
id|__u32
id|mask
suffix:semicolon
id|w1
op_assign
id|a1-&gt;s6_addr32
(braket
id|pdw
)braket
suffix:semicolon
id|w2
op_assign
id|a2-&gt;s6_addr32
(braket
id|pdw
)braket
suffix:semicolon
id|mask
op_assign
id|htonl
c_func
(paren
(paren
l_int|0xffffffff
)paren
op_lshift
(paren
l_int|0x20
op_minus
id|pbi
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|w1
op_xor
id|w2
)paren
op_amp
id|mask
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;test bit. range [0-127]&n; */
DECL|function|addr_bit_set
r_static
id|__inline__
r_int
id|addr_bit_set
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_int
id|fn_bit
)paren
(brace
r_int
id|dw
suffix:semicolon
id|__u32
id|b1
suffix:semicolon
id|__u32
id|mask
suffix:semicolon
r_int
id|bit
op_assign
id|fn_bit
suffix:semicolon
id|dw
op_assign
id|bit
op_rshift
l_int|0x05
suffix:semicolon
id|b1
op_assign
id|addr-&gt;s6_addr32
(braket
id|dw
)braket
suffix:semicolon
id|bit
op_assign
op_complement
id|bit
suffix:semicolon
id|bit
op_and_assign
l_int|0x1f
suffix:semicolon
id|mask
op_assign
id|htonl
c_func
(paren
l_int|1
op_lshift
id|bit
)paren
suffix:semicolon
r_return
(paren
id|b1
op_amp
id|mask
)paren
suffix:semicolon
)brace
DECL|function|addr_bit_equal
r_static
id|__inline__
r_int
id|addr_bit_equal
c_func
(paren
r_struct
id|in6_addr
op_star
id|a1
comma
r_struct
id|in6_addr
op_star
id|a2
comma
r_int
id|fn_bit
)paren
(brace
r_int
id|dw
suffix:semicolon
id|__u32
id|b1
comma
id|b2
suffix:semicolon
id|__u32
id|mask
suffix:semicolon
r_int
id|bit
op_assign
id|fn_bit
suffix:semicolon
id|dw
op_assign
id|bit
op_rshift
l_int|0x05
suffix:semicolon
id|b1
op_assign
id|a1-&gt;s6_addr32
(braket
id|dw
)braket
suffix:semicolon
id|b2
op_assign
id|a2-&gt;s6_addr32
(braket
id|dw
)braket
suffix:semicolon
id|bit
op_assign
op_complement
id|bit
suffix:semicolon
id|bit
op_and_assign
l_int|0x1f
suffix:semicolon
id|mask
op_assign
id|htonl
c_func
(paren
l_int|1
op_lshift
id|bit
)paren
suffix:semicolon
r_return
op_logical_neg
(paren
(paren
id|b1
op_xor
id|b2
)paren
op_amp
id|mask
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;find the first different bit between two addresses&n; */
DECL|function|addr_diff
r_static
id|__inline__
r_int
id|addr_diff
c_func
(paren
r_struct
id|in6_addr
op_star
id|a1
comma
r_struct
id|in6_addr
op_star
id|a2
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|__u32
id|b1
comma
id|b2
suffix:semicolon
id|__u32
id|xb
suffix:semicolon
id|b1
op_assign
id|a1-&gt;s6_addr32
(braket
id|i
)braket
suffix:semicolon
id|b2
op_assign
id|a2-&gt;s6_addr32
(braket
id|i
)braket
suffix:semicolon
id|xb
op_assign
id|b1
op_xor
id|b2
suffix:semicolon
r_if
c_cond
(paren
id|xb
)paren
(brace
r_int
id|res
op_assign
l_int|0
suffix:semicolon
r_int
id|j
op_assign
l_int|31
suffix:semicolon
id|xb
op_assign
id|ntohl
c_func
(paren
id|xb
)paren
suffix:semicolon
r_while
c_loop
(paren
id|test_bit
c_func
(paren
id|j
comma
op_amp
id|xb
)paren
op_eq
l_int|0
)paren
(brace
id|res
op_increment
suffix:semicolon
id|j
op_decrement
suffix:semicolon
)brace
r_return
(paren
id|i
op_star
l_int|32
op_plus
id|res
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;bit values are in range [0-127]&n;&t; *&t;128 is an ilegal value as we should *never* get to&n;&t; *&t;this point since that would mean the addrs are equal&n;&t; */
r_return
l_int|128
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;add a rt to a node that may already contain routes&n; *&t;sort routes in ascending metric order so that fib lookup&n; *&t;returns the smallest metric by default&n; */
DECL|function|fib6_add_rt2node
r_static
id|__inline__
r_void
id|fib6_add_rt2node
c_func
(paren
r_struct
id|fib6_node
op_star
id|fn
comma
r_struct
id|rt6_info
op_star
id|rt
)paren
(brace
r_struct
id|rt6_info
op_star
id|iter
comma
op_star
op_star
id|back
suffix:semicolon
id|rt-&gt;fib_node
op_assign
id|fn
suffix:semicolon
id|back
op_assign
op_amp
id|fn-&gt;leaf
suffix:semicolon
r_for
c_loop
(paren
id|iter
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|iter
suffix:semicolon
id|iter
op_assign
id|iter-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|iter-&gt;rt_metric
OG
id|rt-&gt;rt_metric
)paren
(brace
r_break
suffix:semicolon
)brace
id|back
op_assign
op_amp
id|iter-&gt;next
suffix:semicolon
)brace
id|rt-&gt;next
op_assign
id|iter
suffix:semicolon
op_star
id|back
op_assign
id|rt
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Routing Table&n; */
DECL|function|fib6_add_1
r_static
r_int
id|fib6_add_1
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_struct
id|fib6_node
op_star
id|pn
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fib6_node
op_star
id|in
suffix:semicolon
r_struct
id|fib6_node
op_star
id|ln
suffix:semicolon
r_struct
id|in6_addr
op_star
id|addr
suffix:semicolon
id|__u32
id|bit
suffix:semicolon
id|__u32
id|dir
op_assign
l_int|0
suffix:semicolon
id|__u32
id|sernum
op_assign
op_increment
id|rt_sernum
suffix:semicolon
r_int
id|pbit
op_assign
id|rt-&gt;rt_prefixlen
op_minus
l_int|1
suffix:semicolon
id|addr
op_assign
op_amp
id|rt-&gt;rt_dst
suffix:semicolon
multiline_comment|/* insert node in tree */
id|fn
op_assign
op_amp
id|routing_table
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|fn
op_eq
l_int|NULL
)paren
(brace
id|ln
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fib6_node
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ln
op_eq
l_int|NULL
)paren
r_return
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|memset
c_func
(paren
id|ln
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fib6_node
)paren
)paren
suffix:semicolon
id|ln-&gt;fn_bit
op_assign
id|pbit
suffix:semicolon
id|ln-&gt;fn_flags
op_assign
id|RTN_BACKTRACK
suffix:semicolon
id|ln-&gt;parent
op_assign
id|pn
suffix:semicolon
id|ln-&gt;leaf
op_assign
id|rt
suffix:semicolon
id|ln-&gt;fn_sernum
op_assign
id|sernum
suffix:semicolon
id|rt-&gt;fib_node
op_assign
id|ln
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;rt_ref
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dir
)paren
id|pn-&gt;right
op_assign
id|ln
suffix:semicolon
r_else
id|pn-&gt;left
op_assign
id|ln
suffix:semicolon
id|rt6_stats.fib_nodes
op_increment
suffix:semicolon
id|rt6_stats.fib_route_nodes
op_increment
suffix:semicolon
id|rt6_stats.fib_rt_entries
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr_match
c_func
(paren
op_amp
id|fn-&gt;leaf-&gt;rt_dst
comma
id|addr
comma
id|fn-&gt;fn_bit
)paren
)paren
(brace
r_if
c_cond
(paren
id|pbit
op_eq
id|fn-&gt;fn_bit
op_logical_and
id|addr_bit_equal
c_func
(paren
id|addr
comma
op_amp
id|fn-&gt;leaf-&gt;rt_dst
comma
id|rt-&gt;rt_prefixlen
)paren
)paren
(brace
multiline_comment|/* clean up an intermediate node */
r_if
c_cond
(paren
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_BACKTRACK
)paren
op_eq
l_int|0
)paren
(brace
id|rt_release
c_func
(paren
id|fn-&gt;leaf
)paren
suffix:semicolon
id|fn-&gt;leaf
op_assign
l_int|NULL
suffix:semicolon
id|fn-&gt;fn_flags
op_or_assign
id|RTN_BACKTRACK
suffix:semicolon
)brace
id|fib6_add_rt2node
c_func
(paren
id|fn
comma
id|rt
)paren
suffix:semicolon
id|fn-&gt;fn_sernum
op_assign
id|sernum
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;rt_ref
)paren
suffix:semicolon
id|rt6_stats.fib_route_nodes
op_increment
suffix:semicolon
id|rt6_stats.fib_rt_entries
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pbit
OG
id|fn-&gt;fn_bit
)paren
(brace
multiline_comment|/* walk down on tree */
id|fn-&gt;fn_sernum
op_assign
id|sernum
suffix:semicolon
id|dir
op_assign
id|addr_bit_set
c_func
(paren
id|addr
comma
id|fn-&gt;fn_bit
)paren
suffix:semicolon
id|pn
op_assign
id|fn
suffix:semicolon
id|fn
op_assign
id|dir
ques
c_cond
id|fn-&gt;right
suffix:colon
id|fn-&gt;left
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; * split since we don&squot;t have a common prefix anymore or &n;&t;&t; * we have a less significant route.&n;&t;&t; * we&squot;ve to insert an intermediate node on the list&n;&t;&t; * this new node will point to the one we need to create&n;&t;&t; * and the current&n;&t;&t; */
id|pn
op_assign
id|fn-&gt;parent
suffix:semicolon
multiline_comment|/* find 1st bit in difference between the 2 addrs */
id|bit
op_assign
id|addr_diff
c_func
(paren
id|addr
comma
op_amp
id|fn-&gt;leaf-&gt;rt_dst
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t; *&t;&t;(intermediate)&t;&n;&t;&t; *&t;          /&t;   &bslash;&n;&t;&t; *&t;(new leaf node)    (old node)&n;&t;&t; */
r_if
c_cond
(paren
id|rt-&gt;rt_prefixlen
OG
id|bit
)paren
(brace
id|in
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fib6_node
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in
op_eq
l_int|NULL
)paren
r_return
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|memset
c_func
(paren
id|in
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fib6_node
)paren
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t; * new intermediate node. &n;&t;&t;&t; * RTN_BACKTRACK will&n;&t;&t;&t; * be off since that an address that chooses one of&n;&t;&t;&t; * the branches would not match less specific routes&n;&t;&t;&t; * int the other branch&n;&t;&t;&t; */
id|in-&gt;fn_bit
op_assign
id|bit
suffix:semicolon
id|in-&gt;parent
op_assign
id|pn
suffix:semicolon
id|in-&gt;leaf
op_assign
id|rt
suffix:semicolon
id|in-&gt;fn_sernum
op_assign
id|sernum
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;rt_ref
)paren
suffix:semicolon
multiline_comment|/* leaf node */
id|ln
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fib6_node
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ln
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|in
)paren
suffix:semicolon
r_return
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
)brace
multiline_comment|/* update parent pointer */
r_if
c_cond
(paren
id|dir
)paren
id|pn-&gt;right
op_assign
id|in
suffix:semicolon
r_else
id|pn-&gt;left
op_assign
id|in
suffix:semicolon
id|memset
c_func
(paren
id|ln
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fib6_node
)paren
)paren
suffix:semicolon
id|ln-&gt;fn_bit
op_assign
id|pbit
suffix:semicolon
id|ln-&gt;fn_flags
op_assign
id|RTN_BACKTRACK
suffix:semicolon
id|ln-&gt;parent
op_assign
id|in
suffix:semicolon
id|fn-&gt;parent
op_assign
id|in
suffix:semicolon
id|ln-&gt;leaf
op_assign
id|rt
suffix:semicolon
id|ln-&gt;fn_sernum
op_assign
id|sernum
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;rt_ref
)paren
suffix:semicolon
id|rt-&gt;fib_node
op_assign
id|ln
suffix:semicolon
r_if
c_cond
(paren
id|addr_bit_set
c_func
(paren
id|addr
comma
id|bit
)paren
)paren
(brace
id|in-&gt;right
op_assign
id|ln
suffix:semicolon
id|in-&gt;left
op_assign
id|fn
suffix:semicolon
)brace
r_else
(brace
id|in-&gt;left
op_assign
id|ln
suffix:semicolon
id|in-&gt;right
op_assign
id|fn
suffix:semicolon
)brace
id|rt6_stats.fib_nodes
op_add_assign
l_int|2
suffix:semicolon
id|rt6_stats.fib_route_nodes
op_increment
suffix:semicolon
id|rt6_stats.fib_rt_entries
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n;&t;&t; *&t;&t;(new leaf node)&n;&t;&t; *&t;          /&t;   &bslash;&n;&t;&t; *&t;     (old node)    NULL&n;&t;&t; */
id|ln
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fib6_node
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ln
op_eq
l_int|NULL
)paren
r_return
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|memset
c_func
(paren
id|ln
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fib6_node
)paren
)paren
suffix:semicolon
id|ln-&gt;fn_bit
op_assign
id|pbit
suffix:semicolon
id|ln-&gt;fn_flags
op_assign
id|RTN_BACKTRACK
suffix:semicolon
id|ln-&gt;parent
op_assign
id|pn
suffix:semicolon
id|ln-&gt;leaf
op_assign
id|rt
suffix:semicolon
id|ln-&gt;fn_sernum
op_assign
id|sernum
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;rt_ref
)paren
suffix:semicolon
id|rt-&gt;fib_node
op_assign
id|ln
suffix:semicolon
r_if
c_cond
(paren
id|dir
)paren
id|pn-&gt;right
op_assign
id|ln
suffix:semicolon
r_else
id|pn-&gt;left
op_assign
id|ln
suffix:semicolon
r_if
c_cond
(paren
id|addr_bit_set
c_func
(paren
op_amp
id|fn-&gt;leaf-&gt;rt_dst
comma
id|pbit
)paren
)paren
id|ln-&gt;right
op_assign
id|fn
suffix:semicolon
r_else
id|ln-&gt;left
op_assign
id|fn
suffix:semicolon
id|fn-&gt;parent
op_assign
id|ln
suffix:semicolon
id|rt6_stats.fib_nodes
op_increment
suffix:semicolon
id|rt6_stats.fib_route_nodes
op_increment
suffix:semicolon
id|rt6_stats.fib_rt_entries
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|fib6_lookup_1
r_static
r_struct
id|rt6_info
op_star
id|fib6_lookup_1
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_int
id|flags
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
comma
op_star
id|next
suffix:semicolon
r_int
id|dir
suffix:semicolon
id|fn
op_assign
op_amp
id|routing_table
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|dir
op_assign
id|addr_bit_set
c_func
(paren
id|addr
comma
id|fn-&gt;fn_bit
)paren
suffix:semicolon
id|next
op_assign
id|dir
ques
c_cond
id|fn-&gt;right
suffix:colon
id|fn-&gt;left
suffix:semicolon
r_if
c_cond
(paren
id|next
)paren
(brace
id|fn
op_assign
id|next
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_ROOT
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_BACKTRACK
)paren
(brace
r_if
c_cond
(paren
id|addr_match
c_func
(paren
op_amp
id|fn-&gt;leaf-&gt;rt_dst
comma
id|addr
comma
id|fn-&gt;leaf-&gt;rt_prefixlen
)paren
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|rt-&gt;rt_flags
op_amp
id|flags
)paren
op_eq
l_int|0
)paren
r_return
id|rt
suffix:semicolon
)brace
)brace
)brace
id|fn
op_assign
id|fn-&gt;parent
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;called to trim the tree of intermediate nodes when possible&n; */
DECL|function|fib6_del_3
r_static
r_void
id|fib6_del_3
c_func
(paren
r_struct
id|fib6_node
op_star
id|fn
)paren
(brace
r_int
id|children
op_assign
l_int|0
suffix:semicolon
r_int
id|dir
op_assign
l_int|0
suffix:semicolon
r_int
id|bit
suffix:semicolon
multiline_comment|/*&n;&t; *&t;0 or one children:&n;&t; *&t;&t;delete the node&n;&t; *&n;&t; *&t;2 children:&n;&t; *&t;&t;move the bit down&n;&t; */
r_if
c_cond
(paren
id|fn-&gt;left
)paren
(brace
id|children
op_increment
suffix:semicolon
id|dir
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fn-&gt;right
)paren
(brace
id|children
op_increment
suffix:semicolon
id|dir
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|children
OL
l_int|2
)paren
(brace
r_struct
id|fib6_node
op_star
id|child
suffix:semicolon
id|child
op_assign
id|dir
ques
c_cond
id|fn-&gt;right
suffix:colon
id|fn-&gt;left
suffix:semicolon
r_if
c_cond
(paren
id|fn-&gt;parent-&gt;left
op_eq
id|fn
)paren
(brace
id|fn-&gt;parent-&gt;left
op_assign
id|child
suffix:semicolon
)brace
r_else
(brace
id|fn-&gt;parent-&gt;right
op_assign
id|child
suffix:semicolon
)brace
r_if
c_cond
(paren
id|child
)paren
(brace
id|child-&gt;parent
op_assign
id|fn-&gt;parent
suffix:semicolon
)brace
multiline_comment|/* &n;&t;&t; *&t;try to collapse on top&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|fn-&gt;parent-&gt;fn_flags
op_amp
(paren
id|RTN_BACKTRACK
op_or
id|RTN_ROOT
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|fn-&gt;leaf
)paren
(brace
id|rt_release
c_func
(paren
id|fn-&gt;leaf
)paren
suffix:semicolon
id|fn-&gt;leaf
op_assign
l_int|NULL
suffix:semicolon
)brace
id|fib6_del_3
c_func
(paren
id|fn-&gt;parent
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_BACKTRACK
)paren
(brace
id|rt6_stats.fib_route_nodes
op_decrement
suffix:semicolon
)brace
id|rt6_stats.fib_nodes
op_decrement
suffix:semicolon
id|kfree
c_func
(paren
id|fn
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|bit
op_assign
id|addr_diff
c_func
(paren
op_amp
id|fn-&gt;left-&gt;leaf-&gt;rt_dst
comma
op_amp
id|fn-&gt;right-&gt;leaf-&gt;rt_dst
)paren
suffix:semicolon
id|fn-&gt;fn_bit
op_assign
id|bit
suffix:semicolon
id|fn-&gt;fn_flags
op_and_assign
op_complement
id|RTN_BACKTRACK
suffix:semicolon
id|fn-&gt;leaf
op_assign
id|fn-&gt;left-&gt;leaf
suffix:semicolon
id|rt6_stats.fib_route_nodes
op_decrement
suffix:semicolon
)brace
DECL|function|fib6_del_2
r_static
r_struct
id|fib6_node
op_star
id|fib6_del_2
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
id|__u32
id|prefixlen
comma
r_struct
id|in6_addr
op_star
id|gw
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_for
c_loop
(paren
id|fn
op_assign
op_amp
id|routing_table
suffix:semicolon
id|fn
suffix:semicolon
)paren
(brace
r_int
id|dir
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_BACKTRACK
)paren
op_logical_and
id|prefixlen
op_eq
id|fn-&gt;leaf-&gt;rt_prefixlen
op_logical_and
id|addr_match
c_func
(paren
op_amp
id|fn-&gt;leaf-&gt;rt_dst
comma
id|addr
comma
id|fn-&gt;leaf-&gt;rt_prefixlen
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|dir
op_assign
id|addr_bit_set
c_func
(paren
id|addr
comma
id|fn-&gt;fn_bit
)paren
suffix:semicolon
id|fn
op_assign
id|dir
ques
c_cond
id|fn-&gt;right
suffix:colon
id|fn-&gt;left
suffix:semicolon
)brace
multiline_comment|/* &n;&t; *&t;if route tree node found&n;&t; *&t;search among it&squot;s entries&n;&t; */
r_if
c_cond
(paren
id|fn
)paren
(brace
r_struct
id|rt6_info
op_star
id|back
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rt6_info
op_star
id|lf
suffix:semicolon
r_for
c_loop
(paren
id|lf
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|lf
suffix:semicolon
id|lf
op_assign
id|lf-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|gw
op_logical_and
(paren
id|ipv6_addr_cmp
c_func
(paren
id|addr
comma
op_amp
id|lf-&gt;rt_dst
)paren
op_eq
l_int|0
)paren
)paren
op_logical_or
(paren
id|dev
op_logical_and
id|dev
op_eq
id|lf-&gt;rt_dev
)paren
)paren
(brace
multiline_comment|/* delete this entry */
r_if
c_cond
(paren
id|back
op_eq
l_int|NULL
)paren
id|fn-&gt;leaf
op_assign
id|lf-&gt;next
suffix:semicolon
r_else
id|back-&gt;next
op_assign
id|lf-&gt;next
suffix:semicolon
id|lf-&gt;fib_node
op_assign
l_int|NULL
suffix:semicolon
id|rt_release
c_func
(paren
id|lf
)paren
suffix:semicolon
r_return
id|fn
suffix:semicolon
)brace
id|back
op_assign
id|lf
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|fib6_del_rt_2
r_static
r_struct
id|fib6_node
op_star
id|fib6_del_rt_2
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
id|__u32
id|prefixlen
comma
r_struct
id|rt6_info
op_star
id|rt
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
r_for
c_loop
(paren
id|fn
op_assign
op_amp
id|routing_table
suffix:semicolon
id|fn
suffix:semicolon
)paren
(brace
r_int
id|dir
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_BACKTRACK
)paren
op_logical_and
id|prefixlen
op_eq
id|fn-&gt;leaf-&gt;rt_prefixlen
op_logical_and
id|addr_match
c_func
(paren
op_amp
id|fn-&gt;leaf-&gt;rt_dst
comma
id|addr
comma
id|fn-&gt;leaf-&gt;rt_prefixlen
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|dir
op_assign
id|addr_bit_set
c_func
(paren
id|addr
comma
id|fn-&gt;fn_bit
)paren
suffix:semicolon
id|fn
op_assign
id|dir
ques
c_cond
id|fn-&gt;right
suffix:colon
id|fn-&gt;left
suffix:semicolon
)brace
multiline_comment|/* &n;&t; *&t;if route tree node found&n;&t; *&t;search among its entries&n;&t; */
r_if
c_cond
(paren
id|fn
)paren
(brace
r_struct
id|rt6_info
op_star
id|back
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rt6_info
op_star
id|lf
suffix:semicolon
r_for
c_loop
(paren
id|lf
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|lf
suffix:semicolon
id|lf
op_assign
id|lf-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|rt
op_eq
id|lf
)paren
(brace
multiline_comment|/* delete this entry */
r_if
c_cond
(paren
id|back
op_eq
l_int|NULL
)paren
id|fn-&gt;leaf
op_assign
id|lf-&gt;next
suffix:semicolon
r_else
id|back-&gt;next
op_assign
id|lf-&gt;next
suffix:semicolon
id|lf-&gt;fib_node
op_assign
l_int|NULL
suffix:semicolon
id|rt_release
c_func
(paren
id|lf
)paren
suffix:semicolon
r_return
id|fn
suffix:semicolon
)brace
id|back
op_assign
id|lf
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|fib6_del_1
r_int
id|fib6_del_1
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
id|__u32
id|prefixlen
comma
r_struct
id|in6_addr
op_star
id|gw
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
id|fn
op_assign
id|fib6_del_2
c_func
(paren
id|addr
comma
id|prefixlen
comma
id|gw
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fn
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
id|fn-&gt;leaf
op_eq
l_int|NULL
)paren
(brace
id|fib6_del_3
c_func
(paren
id|fn
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fib6_del_rt
r_int
id|fib6_del_rt
c_func
(paren
r_struct
id|rt6_info
op_star
id|rt
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
id|fn
op_assign
id|fib6_del_rt_2
c_func
(paren
op_amp
id|rt-&gt;rt_dst
comma
id|rt-&gt;rt_prefixlen
comma
id|rt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fn
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
id|fn-&gt;leaf
op_eq
l_int|NULL
)paren
(brace
id|fib6_del_3
c_func
(paren
id|fn
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fib6_flush_1
r_static
r_void
id|fib6_flush_1
c_func
(paren
r_struct
id|fib6_node
op_star
id|fn
comma
r_void
op_star
id|p_arg
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
)paren
(brace
r_struct
id|rt6_info
op_star
id|itr
suffix:semicolon
id|itr
op_assign
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;next
suffix:semicolon
id|itr-&gt;fib_node
op_assign
l_int|NULL
suffix:semicolon
id|rt_release
c_func
(paren
id|itr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_BACKTRACK
)paren
(brace
id|rt6_stats.fib_route_nodes
op_decrement
suffix:semicolon
)brace
id|rt6_stats.fib_nodes
op_decrement
suffix:semicolon
id|kfree
c_func
(paren
id|fn
)paren
suffix:semicolon
)brace
DECL|function|fib6_flush
r_void
id|fib6_flush
c_func
(paren
r_void
)paren
(brace
id|rt6_walk_tree
c_func
(paren
id|fib6_flush_1
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|ipv6_route_add
r_int
id|ipv6_route_add
c_func
(paren
r_struct
id|in6_rtmsg
op_star
id|rtmsg
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rt6_req
op_star
id|request
suffix:semicolon
r_int
id|flags
op_assign
id|rtmsg-&gt;rtmsg_flags
suffix:semicolon
id|dev
op_assign
id|dev_get
c_func
(paren
id|rtmsg-&gt;rtmsg_device
)paren
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_info
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|rt6_stats.fib_rt_alloc
op_increment
suffix:semicolon
id|memset
c_func
(paren
id|rt
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rt6_info
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rt-&gt;rt_dst
comma
op_amp
id|rtmsg-&gt;rtmsg_dst
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|rt-&gt;rt_prefixlen
op_assign
id|rtmsg-&gt;rtmsg_prefixlen
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|RTF_GATEWAY
op_or
id|RTF_NEXTHOP
)paren
)paren
(brace
multiline_comment|/* check to see if its an acceptable gateway */
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_GATEWAY
)paren
(brace
r_struct
id|rt6_info
op_star
id|gw_rt
suffix:semicolon
id|gw_rt
op_assign
id|fibv6_lookup
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_gateway
comma
l_int|NULL
comma
id|RTI_GATEWAY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gw_rt
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|EHOSTUNREACH
suffix:semicolon
)brace
id|dev
op_assign
id|gw_rt-&gt;rt_dev
suffix:semicolon
)brace
id|rt-&gt;rt_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|dev
comma
op_amp
id|rtmsg-&gt;rtmsg_gateway
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt_nexthop
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ipv6_route_add: no nexthop&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|rt-&gt;rt_dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|loopback_rt
op_eq
l_int|NULL
op_logical_and
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
)paren
(brace
id|loopback_rt
op_assign
id|rt
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ipv6_route_add: NULL dev&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|rt-&gt;rt_dev
op_assign
id|dev
suffix:semicolon
id|rt-&gt;rt_nexthop
op_assign
l_int|NULL
suffix:semicolon
)brace
id|rt-&gt;rt_metric
op_assign
id|rtmsg-&gt;rtmsg_metric
suffix:semicolon
id|rt-&gt;rt_flags
op_assign
id|rtmsg-&gt;rtmsg_flags
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt_flags
op_amp
id|RTF_ADDRCONF
)paren
(brace
id|rt-&gt;rt_expires
op_assign
id|rtmsg-&gt;rtmsg_info
suffix:semicolon
)brace
id|request
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_req
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ipv6_route_add: kmalloc failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|request-&gt;operation
op_assign
id|RT_OPER_ADD
suffix:semicolon
id|request-&gt;ptr
op_assign
id|rt
suffix:semicolon
id|request-&gt;next
op_assign
id|request-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
id|rtreq_queue
c_func
(paren
id|request
)paren
suffix:semicolon
id|rt6_bh_mask
op_or_assign
id|RT_BH_REQUEST
suffix:semicolon
id|rt6_run_bh
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipv6_route_del
r_int
id|ipv6_route_del
c_func
(paren
r_struct
id|in6_rtmsg
op_star
id|rtmsg
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
id|fib6_lookup_1
c_func
(paren
op_amp
id|rtmsg-&gt;rtmsg_dst
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rt
op_logical_or
(paren
id|rt
op_logical_and
(paren
id|rt-&gt;rt_prefixlen
op_ne
id|rtmsg-&gt;rtmsg_prefixlen
)paren
)paren
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_return
id|fib6_del_rt
c_func
(paren
id|rt
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;search the routing table&n; *&t;the flags parameter restricts the search to entries where&n; *&t;the flag is *not* set&n; */
DECL|function|fibv6_lookup
r_struct
id|rt6_info
op_star
id|fibv6_lookup
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_struct
id|device
op_star
id|src_dev
comma
r_int
id|flags
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt
op_assign
id|fib6_lookup_1
c_func
(paren
id|addr
comma
id|flags
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|src_dev
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;rt_dev
op_eq
id|src_dev
)paren
r_return
id|rt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|RTI_DEVRT
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
id|rt
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|RTI_GATEWAY
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|rt
op_assign
id|dflt_rt_lookup
c_func
(paren
)paren
)paren
)paren
(brace
r_return
id|rt
suffix:semicolon
)brace
r_return
id|last_resort_rt
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Destination Cache&n; */
DECL|function|ipv6_dst_route
r_struct
id|dest_entry
op_star
id|ipv6_dst_route
c_func
(paren
r_struct
id|in6_addr
op_star
id|daddr
comma
r_struct
id|device
op_star
id|src_dev
comma
r_int
id|flags
)paren
(brace
r_struct
id|dest_entry
op_star
id|dc
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|rt
op_assign
id|fibv6_lookup
c_func
(paren
id|daddr
comma
id|src_dev
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
r_goto
m_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt-&gt;rt_nexthop
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;We can use the generic route&n;&t;&t; *&t;(warning: the pmtu value maybe invalid)&n;&t;&t; */
id|dc
op_assign
(paren
r_struct
id|dest_entry
op_star
)paren
id|rt
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;rt_use
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|rt6_req
op_star
id|request
suffix:semicolon
r_if
c_cond
(paren
id|ipv6_chk_addr
c_func
(paren
id|daddr
)paren
op_logical_and
op_logical_neg
(paren
id|rt-&gt;rt_dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
)paren
(brace
id|rt
op_assign
id|loopback_rt
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
r_goto
m_exit
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; *&t;dynamicly allocate a new route&n;&t;&t; */
id|dc
op_assign
(paren
r_struct
id|dest_entry
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dest_entry
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;dst_route: kmalloc failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|rt6_stats.fib_rt_alloc
op_increment
suffix:semicolon
id|rt6_stats.fib_dc_alloc
op_increment
suffix:semicolon
id|memset
c_func
(paren
id|dc
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dest_entry
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dc-&gt;dc_addr
comma
id|daddr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|dc-&gt;rt.rt_prefixlen
op_assign
l_int|128
suffix:semicolon
id|dc-&gt;dc_usecnt
op_assign
l_int|1
suffix:semicolon
id|dc-&gt;rt.rt_metric
op_assign
id|rt-&gt;rt_metric
suffix:semicolon
id|dc-&gt;dc_flags
op_assign
(paren
id|rt-&gt;rt_flags
op_or
id|RTF_HOST
op_or
id|RTI_DYNAMIC
op_or
id|RTI_DCACHE
op_or
id|DCF_PMTU
)paren
suffix:semicolon
id|dc-&gt;dc_pmtu
op_assign
id|rt-&gt;rt_dev-&gt;mtu
suffix:semicolon
id|dc-&gt;rt.rt_dev
op_assign
id|rt-&gt;rt_dev
suffix:semicolon
id|dc-&gt;rt.rt_output_method
op_assign
id|rt-&gt;rt_output_method
suffix:semicolon
id|dc-&gt;dc_tstamp
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* add it to the request queue */
id|request
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_req
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;dst_route: kmalloc failed&bslash;n&quot;
)paren
suffix:semicolon
id|dc
op_assign
l_int|NULL
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|dc-&gt;dc_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|rt-&gt;rt_dev
comma
id|daddr
)paren
suffix:semicolon
id|rt6_bh_mask
op_or_assign
id|RT_BH_REQUEST
suffix:semicolon
id|request-&gt;operation
op_assign
id|RT_OPER_ADD
suffix:semicolon
id|request-&gt;ptr
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|dc
suffix:semicolon
id|request-&gt;next
op_assign
id|request-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
id|rtreq_queue
c_func
(paren
id|request
)paren
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|rt_clients
)paren
suffix:semicolon
m_exit
suffix:colon
id|atomic_dec
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|rt6_run_bh
c_func
(paren
)paren
suffix:semicolon
r_return
id|dc
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;check cache entry for vality...&n; *&t;this needs to be done as a inline func that calls&n; *&t;ipv6_slow_dst_check if entry is invalid&n; */
DECL|function|ipv6_dst_check
r_struct
id|dest_entry
op_star
id|ipv6_dst_check
c_func
(paren
r_struct
id|dest_entry
op_star
id|dc
comma
r_struct
id|in6_addr
op_star
id|daddr
comma
id|__u32
id|sernum
comma
r_int
id|flags
)paren
(brace
r_int
id|uptodate
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; *&t;destination cache becomes invalid when routing&n;&t; *&t;changes or a more specific dynamic entry is&n;&t; *&t;created.&n;&t; *&t;if route is removed from table fib_node will&n;&t; *&t;become NULL&n;&t; */
r_if
c_cond
(paren
id|dc-&gt;rt.fib_node
op_logical_and
(paren
id|dc-&gt;rt.fib_node-&gt;fn_sernum
op_eq
id|sernum
)paren
)paren
id|uptodate
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|uptodate
op_logical_and
(paren
(paren
id|dc-&gt;dc_flags
op_amp
id|DCF_INVALID
)paren
op_eq
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|dc-&gt;dc_nexthop
op_logical_and
op_logical_neg
(paren
id|dc-&gt;dc_nexthop-&gt;flags
op_amp
id|NCF_NOARP
)paren
)paren
(brace
id|ndisc_event_send
c_func
(paren
id|dc-&gt;dc_nexthop
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_return
id|dc
suffix:semicolon
)brace
multiline_comment|/* route for destination may have changed */
id|ipv6_dst_unlock
c_func
(paren
id|dc
)paren
suffix:semicolon
r_return
id|ipv6_dst_route
c_func
(paren
id|daddr
comma
l_int|NULL
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|ipv6_dst_unlock
r_void
id|ipv6_dst_unlock
c_func
(paren
r_struct
id|dest_entry
op_star
id|dc
)paren
(brace
multiline_comment|/*&n;&t; *&t;decrement counter and mark entry for deletion&n;&t; *&t;if counter reaches 0. we delay deletions in hope&n;&t; *&t;we can reuse cache entries.&n;&t; */
id|atomic_dec
c_func
(paren
op_amp
id|dc-&gt;dc_usecnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dc-&gt;dc_usecnt
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|dc-&gt;dc_flags
op_amp
id|RTI_DCACHE
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; *&t;update last usage tstamp&n;&t;&t;&t; */
id|dc-&gt;dc_tstamp
op_assign
id|jiffies
suffix:semicolon
id|rt6_bh_mask
op_or_assign
id|RT_BH_GC
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dc-&gt;rt.rt_ref
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; *&t;entry out of the routing table&n;&t;&t;&t; *&t;pending to be released on last deref&n;&t;&t;&t; */
r_if
c_cond
(paren
id|dc-&gt;dc_nexthop
)paren
(brace
id|ndisc_dec_neigh
c_func
(paren
id|dc-&gt;dc_nexthop
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dc-&gt;dc_flags
op_amp
id|RTI_DCACHE
)paren
(brace
id|rt6_stats.fib_dc_alloc
op_decrement
suffix:semicolon
)brace
id|rt6_stats.fib_rt_alloc
op_decrement
suffix:semicolon
id|kfree
c_func
(paren
id|dc
)paren
suffix:semicolon
)brace
)brace
id|atomic_dec
c_func
(paren
op_amp
id|rt_clients
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Received a packet too big icmp that lowers the mtu for this&n; *&t;address. If the route for the destination is genric we create&n; *&t;a new route with the apropriate MTU info. The route_add&n; *&t;procedure will update the serial number on the generic routes&n; *&t;belonging to the afected tree forcing clients to request a route&n; *&t;lookup.&n; */
DECL|function|rt6_handle_pmtu
r_void
id|rt6_handle_pmtu
c_func
(paren
r_struct
id|in6_addr
op_star
id|addr
comma
r_int
id|pmtu
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|rt6_req
op_star
id|req
suffix:semicolon
r_struct
id|dest_entry
op_star
id|dc
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rt6_handle_pmtu&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmtu
template_param
l_int|65536
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;invalid MTU value&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|rt
op_assign
id|fibv6_lookup
c_func
(paren
id|addr
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rt6_handle_pmtu: route not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt-&gt;rt_flags
op_amp
id|RTI_DCACHE
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;we do have a destination cache entry for this&n;&t;&t; *&t;address.&n;&t;&t; */
id|dc
op_assign
(paren
r_struct
id|dest_entry
op_star
)paren
id|rt
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;fixme: some sanity checks are likely to be needed&n;&t;&t; *&t; here&n;&t;&t; */
id|dc-&gt;dc_pmtu
op_assign
id|pmtu
suffix:semicolon
id|dc-&gt;dc_flags
op_or_assign
id|DCF_PMTU
suffix:semicolon
r_return
suffix:semicolon
)brace
id|req
op_assign
(paren
r_struct
id|rt6_req
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_req
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
multiline_comment|/* now add the new destination cache entry&t;*/
id|dc
op_assign
(paren
r_struct
id|dest_entry
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dest_entry
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|rt6_stats.fib_rt_alloc
op_increment
suffix:semicolon
id|rt6_stats.fib_dc_alloc
op_increment
suffix:semicolon
id|memset
c_func
(paren
id|dc
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dest_entry
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dc-&gt;dc_addr
comma
id|addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|dc-&gt;rt.rt_prefixlen
op_assign
l_int|128
suffix:semicolon
id|dc-&gt;rt.rt_metric
op_assign
id|rt-&gt;rt_metric
suffix:semicolon
id|dc-&gt;dc_flags
op_assign
(paren
id|rt-&gt;rt_flags
op_or
id|RTI_DYNAMIC
op_or
id|RTI_DCACHE
op_or
id|DCF_PMTU
op_or
id|RTF_HOST
)paren
suffix:semicolon
id|dc-&gt;dc_pmtu
op_assign
id|pmtu
suffix:semicolon
id|dc-&gt;dc_tstamp
op_assign
id|jiffies
suffix:semicolon
id|dc-&gt;dc_nexthop
op_assign
id|rt-&gt;rt_nexthop
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|dc-&gt;dc_nexthop-&gt;refcnt
)paren
suffix:semicolon
id|dc-&gt;rt.rt_dev
op_assign
id|rt-&gt;rt_dev
suffix:semicolon
id|dc-&gt;rt.rt_output_method
op_assign
id|rt-&gt;rt_output_method
suffix:semicolon
id|req-&gt;operation
op_assign
id|RT_OPER_ADD
suffix:semicolon
id|req-&gt;ptr
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|dc
suffix:semicolon
id|req-&gt;next
op_assign
id|req-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
id|rtreq_queue
c_func
(paren
id|req
)paren
suffix:semicolon
id|rt6_bh_mask
op_or_assign
id|RT_BH_REQUEST
suffix:semicolon
id|rt6_run_bh
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Redirect received: target is nexthop for dest&n; */
DECL|function|ipv6_rt_redirect
r_struct
id|rt6_info
op_star
id|ipv6_rt_redirect
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|in6_addr
op_star
id|dest
comma
r_struct
id|in6_addr
op_star
id|target
comma
r_int
id|on_link
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|rt6_req
op_star
id|req
suffix:semicolon
r_int
id|metric
suffix:semicolon
id|rt
op_assign
id|fibv6_lookup
c_func
(paren
id|dest
comma
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;rt_redirect: unable to locate route&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|metric
op_assign
id|rt-&gt;rt_metric
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt-&gt;rt_flags
op_amp
id|RTF_HOST
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Need to create an host route for this address */
id|rt
op_assign
(paren
r_struct
id|rt6_info
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_info
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|memset
c_func
(paren
id|rt
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rt6_info
)paren
)paren
suffix:semicolon
id|ipv6_addr_copy
c_func
(paren
op_amp
id|rt-&gt;rt_dst
comma
id|dest
)paren
suffix:semicolon
id|rt-&gt;rt_prefixlen
op_assign
l_int|128
suffix:semicolon
id|rt-&gt;rt_flags
op_assign
id|RTF_HOST
op_or
id|RTF_UP
suffix:semicolon
id|rt-&gt;rt_dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;clone rt-&gt;rt_output_method ?&n;&t;&t; */
id|rt-&gt;rt_metric
op_assign
id|metric
suffix:semicolon
id|rt6_stats.fib_rt_alloc
op_increment
suffix:semicolon
id|req
op_assign
(paren
r_struct
id|rt6_req
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_req
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|req-&gt;operation
op_assign
id|RT_OPER_ADD
suffix:semicolon
id|req-&gt;ptr
op_assign
id|rt
suffix:semicolon
id|req-&gt;next
op_assign
id|req-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
id|rtreq_queue
c_func
(paren
id|req
)paren
suffix:semicolon
id|rt6_bh_mask
op_or_assign
id|RT_BH_REQUEST
suffix:semicolon
)brace
r_else
(brace
id|rt-&gt;rt_flags
op_or_assign
id|RTF_MODIFIED
suffix:semicolon
)brace
id|rt-&gt;rt_flags
op_or_assign
id|RTF_DYNAMIC
suffix:semicolon
r_if
c_cond
(paren
id|on_link
)paren
(brace
id|rt-&gt;rt_flags
op_and_assign
op_complement
id|RTF_GATEWAY
suffix:semicolon
)brace
r_else
(brace
id|rt-&gt;rt_flags
op_or_assign
id|RTF_GATEWAY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt-&gt;rt_nexthop
)paren
(brace
r_if
c_cond
(paren
id|ipv6_addr_cmp
c_func
(paren
op_amp
id|rt-&gt;rt_nexthop-&gt;addr
comma
id|target
)paren
op_eq
l_int|0
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;rt_nexthop-&gt;refcnt
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
r_else
(brace
id|ndisc_dec_neigh
c_func
(paren
id|rt-&gt;rt_nexthop
)paren
suffix:semicolon
)brace
)brace
id|rt-&gt;rt_nexthop
op_assign
id|ndisc_get_neigh
c_func
(paren
id|dev
comma
id|target
)paren
suffix:semicolon
m_exit
suffix:colon
id|rt6_run_bh
c_func
(paren
)paren
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
DECL|function|dcache_gc_node
r_static
r_int
id|dcache_gc_node
c_func
(paren
r_struct
id|fib6_node
op_star
id|fn
comma
r_int
id|timeout
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
comma
op_star
id|back
suffix:semicolon
r_int
id|more
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
id|back
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
(paren
id|rt-&gt;rt_flags
op_amp
id|RTI_DCACHE
)paren
op_logical_and
id|rt-&gt;rt_use
op_eq
l_int|0
)paren
(brace
r_struct
id|dest_entry
op_star
id|dc
suffix:semicolon
id|dc
op_assign
(paren
r_struct
id|dest_entry
op_star
)paren
id|rt
suffix:semicolon
r_if
c_cond
(paren
id|now
op_minus
id|dc-&gt;dc_tstamp
OG
id|timeout
)paren
(brace
r_struct
id|rt6_info
op_star
id|old
suffix:semicolon
id|old
op_assign
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|back
op_eq
l_int|NULL
)paren
(brace
id|fn-&gt;leaf
op_assign
id|rt
suffix:semicolon
)brace
r_else
(brace
id|back-&gt;next
op_assign
id|rt
suffix:semicolon
)brace
id|old-&gt;fib_node
op_assign
l_int|NULL
suffix:semicolon
id|rt_release
c_func
(paren
id|old
)paren
suffix:semicolon
id|rt6_stats.fib_rt_entries
op_decrement
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
id|more
op_increment
suffix:semicolon
)brace
)brace
id|back
op_assign
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fn-&gt;leaf
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
id|more
suffix:semicolon
)brace
DECL|struct|dc_gc_args
r_struct
id|dc_gc_args
(brace
DECL|member|timeout
r_int
r_int
id|timeout
suffix:semicolon
DECL|member|more
r_int
id|more
suffix:semicolon
)brace
suffix:semicolon
DECL|function|dc_garbage_collect
r_static
r_void
id|dc_garbage_collect
c_func
(paren
r_struct
id|fib6_node
op_star
id|fn
comma
r_void
op_star
id|p_arg
)paren
(brace
r_struct
id|dc_gc_args
op_star
id|args
op_assign
(paren
r_struct
id|dc_gc_args
op_star
)paren
id|p_arg
suffix:semicolon
r_if
c_cond
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_BACKTRACK
)paren
(brace
r_if
c_cond
(paren
id|fn-&gt;fn_bit
op_eq
l_int|127
)paren
(brace
r_int
id|more
suffix:semicolon
id|more
op_assign
id|dcache_gc_node
c_func
(paren
id|fn
comma
id|args-&gt;timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|more
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|fn-&gt;parent-&gt;left
op_eq
id|fn
)paren
id|fn-&gt;parent-&gt;left
op_assign
l_int|NULL
suffix:semicolon
r_else
id|fn-&gt;parent-&gt;right
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|fn
)paren
suffix:semicolon
id|rt6_stats.fib_nodes
op_decrement
suffix:semicolon
id|rt6_stats.fib_route_nodes
op_decrement
suffix:semicolon
r_return
suffix:semicolon
)brace
id|args-&gt;more
op_add_assign
id|more
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_ROOT
)paren
)paren
(brace
r_int
id|children
op_assign
l_int|0
suffix:semicolon
r_struct
id|fib6_node
op_star
id|chld
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|fn-&gt;left
)paren
(brace
id|children
op_increment
suffix:semicolon
id|chld
op_assign
id|fn-&gt;left
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fn-&gt;right
)paren
(brace
id|children
op_increment
suffix:semicolon
id|chld
op_assign
id|fn-&gt;right
suffix:semicolon
)brace
r_if
c_cond
(paren
id|children
op_le
l_int|1
)paren
(brace
r_struct
id|fib6_node
op_star
id|pn
op_assign
id|fn-&gt;parent
suffix:semicolon
r_if
c_cond
(paren
id|pn-&gt;left
op_eq
id|fn
)paren
(brace
id|pn-&gt;left
op_assign
id|chld
suffix:semicolon
)brace
r_else
(brace
id|pn-&gt;right
op_assign
id|chld
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chld
)paren
(brace
id|chld-&gt;parent
op_assign
id|pn
suffix:semicolon
)brace
id|rt_release
c_func
(paren
id|fn-&gt;leaf
)paren
suffix:semicolon
id|rt6_stats.fib_nodes
op_decrement
suffix:semicolon
id|kfree
c_func
(paren
id|fn
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *&t;called with ints off&n; */
DECL|function|__rt6_run_bh
r_static
r_void
id|__rt6_run_bh
c_func
(paren
r_void
)paren
(brace
r_static
id|last_gc_run
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rt6_bh_mask
op_amp
id|RT_BH_REQUEST
)paren
(brace
r_struct
id|rt6_req
op_star
id|request
suffix:semicolon
r_while
c_loop
(paren
(paren
id|request
op_assign
id|rtreq_dequeue
c_func
(paren
)paren
)paren
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
id|rt
op_assign
id|request-&gt;ptr
suffix:semicolon
r_switch
c_cond
(paren
id|request-&gt;operation
)paren
(brace
r_case
id|RT_OPER_ADD
suffix:colon
id|fib6_add_1
c_func
(paren
id|rt
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RT_OPER_DEL
suffix:colon
id|fib6_del_rt
c_func
(paren
id|rt
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;rt6_run_bh: bad request in queue&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|request
)paren
suffix:semicolon
)brace
id|rt6_bh_mask
op_and_assign
op_complement
id|RT_BH_REQUEST
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt6_bh_mask
op_amp
id|RT_BH_GC
)paren
(brace
r_if
c_cond
(paren
id|jiffies
op_minus
id|last_gc_run
OG
id|DC_TIME_RUN
)paren
(brace
r_struct
id|dc_gc_args
id|args
suffix:semicolon
r_if
c_cond
(paren
id|rt6_stats.fib_dc_alloc
op_ge
id|DC_WATER_MARK
)paren
id|args.timeout
op_assign
id|DC_SHORT_TIMEOUT
suffix:semicolon
r_else
id|args.timeout
op_assign
id|DC_LONG_TIMEOUT
suffix:semicolon
id|args.more
op_assign
l_int|0
suffix:semicolon
id|rt6_walk_tree
c_func
(paren
id|dc_garbage_collect
comma
op_amp
id|args
comma
l_int|0
)paren
suffix:semicolon
id|last_gc_run
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|args.more
)paren
(brace
id|rt6_bh_mask
op_and_assign
op_complement
id|RT_BH_GC
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/*&n; *&t;Timer for expiring routes learned via addrconf and stale DC &n; *&t;entries when there is no network actuvity&n; */
DECL|function|rt6_timer_handler
r_void
id|rt6_timer_handler
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt6_lock
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|rt_clients
op_eq
l_int|0
op_logical_and
id|rt6_bh_mask
)paren
(brace
id|__rt6_run_bh
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; *&t;route expiry&n;&t;&t; */
id|rt6_walk_tree
c_func
(paren
id|rt6_rt_timeout
comma
l_int|NULL
comma
l_int|1
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|rt6_gc_timer.expires
op_assign
id|jiffies
op_plus
l_int|4
op_star
id|DC_LONG_TIMEOUT
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|rt6_gc_timer
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Check if routes should be timed out.&n; *&t;Called from rt6_walk_tree for every node.&n; */
DECL|function|rt6_rt_timeout
r_static
r_void
id|rt6_rt_timeout
c_func
(paren
r_struct
id|fib6_node
op_star
id|fn
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|rt-&gt;rt_flags
op_amp
id|RTF_ADDRCONF
)paren
op_logical_and
id|now
OG
id|rt-&gt;rt_expires
)paren
(brace
r_struct
id|rt6_req
op_star
id|req
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;request route deletion. routes will only&n;&t;&t;&t; *&t;be deleted after walk_tree completes&n;&t;&t;&t; */
id|req
op_assign
(paren
r_struct
id|rt6_req
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rt6_req
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|req-&gt;operation
op_assign
id|RT_OPER_DEL
suffix:semicolon
id|req-&gt;ptr
op_assign
id|rt
suffix:semicolon
id|req-&gt;next
op_assign
id|req-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
DECL|function|ipv6_route_ioctl
r_int
id|ipv6_route_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|in6_rtmsg
id|rtmsg
suffix:semicolon
r_int
id|err
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCADDRT
suffix:colon
multiline_comment|/* Add a route */
r_case
id|SIOCDELRT
suffix:colon
multiline_comment|/* Delete a route */
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|err
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|rtmsg
comma
id|arg
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
(paren
id|cmd
op_eq
id|SIOCDELRT
)paren
ques
c_cond
id|ipv6_route_del
c_func
(paren
op_amp
id|rtmsg
)paren
suffix:colon
id|ipv6_route_add
c_func
(paren
op_amp
id|rtmsg
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|rt6_walk_tree
r_static
r_void
id|rt6_walk_tree
c_func
(paren
id|f_pnode
id|func
comma
r_void
op_star
id|arg
comma
r_int
id|filter
)paren
(brace
r_struct
id|fib6_node
op_star
id|fn
suffix:semicolon
multiline_comment|/*&n;&t; *&t;adquire lock&n;&t; *&t;this warranties that the operation will be atomic with&n;&t; *&t;respect to the garbage collect routine that also does&n;&t; *&t;a tree transversal and tags nodes with the RTN_TAG flag&n;&t; */
id|atomic_inc
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
id|fn
op_assign
op_amp
id|routing_table
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_TAG
)paren
)paren
(brace
id|fn-&gt;fn_flags
op_or_assign
id|RTN_TAG
suffix:semicolon
r_if
c_cond
(paren
id|fn-&gt;left
)paren
(brace
id|fn
op_assign
id|fn-&gt;left
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
id|fn-&gt;fn_flags
op_and_assign
op_complement
id|RTN_TAG
suffix:semicolon
r_if
c_cond
(paren
id|fn-&gt;right
)paren
(brace
id|fn
op_assign
id|fn-&gt;right
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_do
(brace
r_struct
id|fib6_node
op_star
id|node
suffix:semicolon
r_if
c_cond
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_ROOT
)paren
r_break
suffix:semicolon
id|node
op_assign
id|fn
suffix:semicolon
id|fn
op_assign
id|fn-&gt;parent
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|node-&gt;fn_flags
op_amp
id|RTN_TAG
)paren
op_logical_and
(paren
op_logical_neg
id|filter
op_logical_or
(paren
id|node-&gt;fn_flags
op_amp
id|RTN_BACKTRACK
)paren
)paren
)paren
(brace
(paren
op_star
id|func
)paren
(paren
id|node
comma
id|arg
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_TAG
)paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_ROOT
)paren
op_logical_or
(paren
id|fn-&gt;fn_flags
op_amp
id|RTN_TAG
)paren
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|rt6_lock
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|macro|RT6_INFO_LEN
mdefine_line|#define RT6_INFO_LEN (32 + 2 + 32 + 2 + 2 + 2 + 4 + 8 + 7)
DECL|struct|rt6_proc_arg
r_struct
id|rt6_proc_arg
(brace
DECL|member|buffer
r_char
op_star
id|buffer
suffix:semicolon
DECL|member|offset
r_int
id|offset
suffix:semicolon
DECL|member|skip
r_int
id|skip
suffix:semicolon
DECL|member|len
r_int
id|len
suffix:semicolon
)brace
suffix:semicolon
DECL|function|rt6_info_node
r_static
r_void
id|rt6_info_node
c_func
(paren
r_struct
id|fib6_node
op_star
id|fn
comma
r_void
op_star
id|p_arg
)paren
(brace
r_struct
id|rt6_info
op_star
id|rt
suffix:semicolon
r_struct
id|rt6_proc_arg
op_star
id|arg
op_assign
(paren
r_struct
id|rt6_proc_arg
op_star
)paren
id|p_arg
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|fn-&gt;leaf
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;next
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|arg-&gt;skip
OL
id|arg-&gt;offset
op_div
id|RT6_INFO_LEN
)paren
(brace
id|arg-&gt;skip
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%02x&quot;
comma
id|rt-&gt;rt_dst.s6_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|2
suffix:semicolon
)brace
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot; %02x &quot;
comma
id|rt-&gt;rt_prefixlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt_nexthop
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;%02x&quot;
comma
id|rt-&gt;rt_nexthop-&gt;addr.s6_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot;00000000000000000000000000000000&quot;
)paren
suffix:semicolon
id|arg-&gt;len
op_add_assign
l_int|32
suffix:semicolon
)brace
id|arg-&gt;len
op_add_assign
id|sprintf
c_func
(paren
id|arg-&gt;buffer
op_plus
id|arg-&gt;len
comma
l_string|&quot; %02x %02x %02x %04x %8s&bslash;n&quot;
comma
id|rt-&gt;rt_metric
comma
id|rt-&gt;rt_use
comma
id|rt-&gt;rt_ref
comma
id|rt-&gt;rt_flags
comma
id|rt-&gt;rt_dev
ques
c_cond
id|rt-&gt;rt_dev-&gt;name
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|rt6_proc_info
r_static
r_int
id|rt6_proc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_struct
id|rt6_proc_arg
id|arg
suffix:semicolon
r_struct
id|fib6_node
id|sfn
suffix:semicolon
id|arg.buffer
op_assign
id|buffer
suffix:semicolon
id|arg.offset
op_assign
id|offset
suffix:semicolon
id|arg.skip
op_assign
l_int|0
suffix:semicolon
id|arg.len
op_assign
l_int|0
suffix:semicolon
id|rt6_walk_tree
c_func
(paren
id|rt6_info_node
comma
op_amp
id|arg
comma
l_int|1
)paren
suffix:semicolon
id|sfn.leaf
op_assign
id|default_rt_list
suffix:semicolon
id|rt6_info_node
c_func
(paren
op_amp
id|sfn
comma
op_amp
id|arg
)paren
suffix:semicolon
id|sfn.leaf
op_assign
id|last_resort_rt
suffix:semicolon
id|rt6_info_node
c_func
(paren
op_amp
id|sfn
comma
op_amp
id|arg
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
suffix:semicolon
r_if
c_cond
(paren
id|offset
)paren
op_star
id|start
op_add_assign
id|offset
op_mod
id|RT6_INFO_LEN
suffix:semicolon
id|arg.len
op_sub_assign
id|offset
op_mod
id|RT6_INFO_LEN
suffix:semicolon
r_if
c_cond
(paren
id|arg.len
OG
id|length
)paren
id|arg.len
op_assign
id|length
suffix:semicolon
r_return
id|arg.len
suffix:semicolon
)brace
DECL|function|rt6_proc_stats
r_static
r_int
id|rt6_proc_stats
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_int
id|len
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04x %04x %04x %04x %04x&bslash;n&quot;
comma
id|rt6_stats.fib_nodes
comma
id|rt6_stats.fib_route_nodes
comma
id|rt6_stats.fib_rt_alloc
comma
id|rt6_stats.fib_rt_entries
comma
id|rt6_stats.fib_dc_alloc
)paren
suffix:semicolon
id|len
op_sub_assign
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;/* CONFIG_PROC_FS */
DECL|function|ipv6_route_init
r_void
id|ipv6_route_init
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef &t;CONFIG_PROC_FS
id|proc_net_register
c_func
(paren
op_amp
(paren
r_struct
id|proc_dir_entry
)paren
(brace
id|PROC_NET_RT6
comma
l_int|6
comma
l_string|&quot;route6&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|rt6_proc_info
)brace
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
(paren
r_struct
id|proc_dir_entry
)paren
(brace
id|PROC_NET_RT6_STATS
comma
l_int|9
comma
l_string|&quot;rt6_stats&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|rt6_proc_stats
)brace
)paren
suffix:semicolon
macro_line|#endif
id|rt6_gc_timer.expires
op_assign
id|jiffies
op_plus
l_int|4
op_star
id|DC_LONG_TIMEOUT
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|rt6_gc_timer
)paren
suffix:semicolon
id|netlink_attach
c_func
(paren
id|NETLINK_ROUTE6
comma
id|rt6_msgrcv
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|ipv6_route_cleanup
r_void
id|ipv6_route_cleanup
c_func
(paren
r_void
)paren
(brace
id|proc_net_unregister
c_func
(paren
id|PROC_NET_RT6
)paren
suffix:semicolon
id|proc_net_unregister
c_func
(paren
id|PROC_NET_RT6_STATS
)paren
suffix:semicolon
id|netlink_detach
c_func
(paren
id|NETLINK_ROUTE6
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|rt6_gc_timer
)paren
suffix:semicolon
id|fib6_flush
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *&t;NETLINK interface&n; *&t;routing socket moral equivalent&n; */
DECL|function|rt6_msgrcv
r_static
r_int
id|rt6_msgrcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_struct
id|in6_rtmsg
op_star
id|rtmsg
suffix:semicolon
r_while
c_loop
(paren
id|skb-&gt;len
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;len
OL
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
(brace
id|count
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rtmsg
op_assign
(paren
r_struct
id|in6_rtmsg
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
id|count
op_add_assign
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|rtmsg-&gt;rtmsg_type
)paren
(brace
r_case
id|RTMSG_NEWROUTE
suffix:colon
id|ipv6_route_add
c_func
(paren
id|rtmsg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RTMSG_DELROUTE
suffix:colon
id|ipv6_route_del
c_func
(paren
id|rtmsg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|count
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|rt6_sndmsg
r_void
id|rt6_sndmsg
c_func
(paren
id|__u32
id|type
comma
r_struct
id|in6_addr
op_star
id|dst
comma
r_struct
id|in6_addr
op_star
id|gw
comma
id|__u16
id|plen
comma
id|__u16
id|metric
comma
r_char
op_star
id|devname
comma
id|__u16
id|flags
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|in6_rtmsg
op_star
id|msg
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|msg
op_assign
(paren
r_struct
id|in6_rtmsg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|in6_rtmsg
)paren
)paren
suffix:semicolon
id|msg-&gt;rtmsg_type
op_assign
id|type
suffix:semicolon
r_if
c_cond
(paren
id|dst
)paren
(brace
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;rtmsg_dst
comma
id|dst
)paren
suffix:semicolon
)brace
r_else
id|memset
c_func
(paren
op_amp
id|msg-&gt;rtmsg_dst
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gw
)paren
(brace
id|ipv6_addr_copy
c_func
(paren
op_amp
id|msg-&gt;rtmsg_gateway
comma
id|gw
)paren
suffix:semicolon
)brace
r_else
id|memset
c_func
(paren
op_amp
id|msg-&gt;rtmsg_gateway
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|msg-&gt;rtmsg_prefixlen
op_assign
id|plen
suffix:semicolon
id|msg-&gt;rtmsg_metric
op_assign
id|metric
suffix:semicolon
id|strcpy
c_func
(paren
id|msg-&gt;rtmsg_device
comma
id|devname
)paren
suffix:semicolon
id|msg-&gt;rtmsg_flags
op_assign
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|netlink_post
c_func
(paren
id|NETLINK_ROUTE6
comma
id|skb
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
)brace
)brace
eof
