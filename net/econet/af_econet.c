multiline_comment|/*&n; *&t;An implementation of the Acorn Econet and AUN protocols.&n; *&t;Philip Blundell &lt;philb@gnu.org&gt;&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License&n; *&t;as published by the Free Software Foundation; either version&n; *&t;2 of the License, or (at your option) any later version.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/if_ether.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/wireless.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/inet_common.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/if_ec.h&gt;
macro_line|#include &lt;net/udp.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
DECL|variable|econet_ops
r_static
r_struct
id|proto_ops
id|econet_ops
suffix:semicolon
DECL|variable|econet_sklist
r_static
r_struct
id|sock
op_star
id|econet_sklist
suffix:semicolon
multiline_comment|/* Since there are only 256 possible network numbers (or fewer, depends&n;   how you count) it makes sense to use a simple lookup table. */
DECL|variable|net2dev_map
r_static
r_struct
id|net_device
op_star
id|net2dev_map
(braket
l_int|256
)braket
suffix:semicolon
DECL|macro|EC_PORT_IP
mdefine_line|#define EC_PORT_IP&t;0xd2
macro_line|#ifdef CONFIG_ECONET_AUNUDP
DECL|variable|aun_queue_lock
r_static
id|spinlock_t
id|aun_queue_lock
suffix:semicolon
DECL|variable|udpsock
r_static
r_struct
id|socket
op_star
id|udpsock
suffix:semicolon
DECL|macro|AUN_PORT
mdefine_line|#define AUN_PORT&t;0x8000
DECL|struct|aunhdr
r_struct
id|aunhdr
(brace
DECL|member|code
r_int
r_char
id|code
suffix:semicolon
multiline_comment|/* AUN magic protocol byte */
DECL|member|port
r_int
r_char
id|port
suffix:semicolon
DECL|member|cb
r_int
r_char
id|cb
suffix:semicolon
DECL|member|pad
r_int
r_char
id|pad
suffix:semicolon
DECL|member|handle
r_int
r_int
id|handle
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|aun_seq
r_static
r_int
r_int
id|aun_seq
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Queue of packets waiting to be transmitted. */
DECL|variable|aun_queue
r_static
r_struct
id|sk_buff_head
id|aun_queue
suffix:semicolon
DECL|variable|ab_cleanup_timer
r_static
r_struct
id|timer_list
id|ab_cleanup_timer
suffix:semicolon
macro_line|#endif&t;&t;/* CONFIG_ECONET_AUNUDP */
multiline_comment|/* Per-packet information */
DECL|struct|ec_cb
r_struct
id|ec_cb
(brace
DECL|member|sec
r_struct
id|sockaddr_ec
id|sec
suffix:semicolon
DECL|member|cookie
r_int
r_int
id|cookie
suffix:semicolon
multiline_comment|/* Supplied by user. */
macro_line|#ifdef CONFIG_ECONET_AUNUDP
DECL|member|done
r_int
id|done
suffix:semicolon
DECL|member|seq
r_int
r_int
id|seq
suffix:semicolon
multiline_comment|/* Sequencing */
DECL|member|timeout
r_int
r_int
id|timeout
suffix:semicolon
multiline_comment|/* Timeout */
DECL|member|start
r_int
r_int
id|start
suffix:semicolon
multiline_comment|/* jiffies */
macro_line|#endif
macro_line|#ifdef CONFIG_ECONET_NATIVE
DECL|member|sent
r_void
(paren
op_star
id|sent
)paren
(paren
r_struct
id|sk_buff
op_star
comma
r_int
id|result
)paren
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
multiline_comment|/*&n; *&t;Pull a packet from our receive queue and hand it to the user.&n; *&t;If necessary we block.&n; */
DECL|function|econet_recvmsg
r_static
r_int
id|econet_recvmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_int
id|flags
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|copied
comma
id|err
suffix:semicolon
id|msg-&gt;msg_namelen
op_assign
r_sizeof
(paren
r_struct
id|sockaddr_ec
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Call the generic datagram receiver. This handles all sorts&n;&t; *&t;of horrible races and re-entrancy so we can forget about it&n;&t; *&t;in the protocol layers.&n;&t; *&n;&t; *&t;Now it will return ENETDOWN, if device have just gone down,&n;&t; *&t;but then it will block.&n;&t; */
id|skb
op_assign
id|skb_recv_datagram
c_func
(paren
id|sk
comma
id|flags
comma
id|flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|err
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;An error occurred so return it. Because skb_recv_datagram() &n;&t; *&t;handles the blocking we don&squot;t see and worry about blocking&n;&t; *&t;retries.&n;&t; */
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;You lose any data beyond the buffer you gave. If it worries a&n;&t; *&t;user program they can ask the device for its MTU anyway.&n;&t; */
id|copied
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|copied
OG
id|len
)paren
(brace
id|copied
op_assign
id|len
suffix:semicolon
id|msg-&gt;msg_flags
op_or_assign
id|MSG_TRUNC
suffix:semicolon
)brace
multiline_comment|/* We can&squot;t use skb_copy_datagram here */
id|err
op_assign
id|memcpy_toiovec
c_func
(paren
id|msg-&gt;msg_iov
comma
id|skb-&gt;data
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out_free
suffix:semicolon
id|sk-&gt;stamp
op_assign
id|skb-&gt;stamp
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_name
)paren
id|memcpy
c_func
(paren
id|msg-&gt;msg_name
comma
id|skb-&gt;cb
comma
id|msg-&gt;msg_namelen
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Free or return the buffer as appropriate. Again this&n;&t; *&t;hides all the races and re-entrancy issues from us.&n;&t; */
id|err
op_assign
id|copied
suffix:semicolon
id|out_free
suffix:colon
id|skb_free_datagram
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Bind an Econet socket.&n; */
DECL|function|econet_bind
r_static
r_int
id|econet_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sockaddr_ec
op_star
id|sec
op_assign
(paren
r_struct
id|sockaddr_ec
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Check legality&n;&t; */
r_if
c_cond
(paren
id|addr_len
OL
r_sizeof
(paren
r_struct
id|sockaddr_ec
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sec-&gt;sec_family
op_ne
id|AF_ECONET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sk-&gt;protinfo.af_econet-&gt;cb
op_assign
id|sec-&gt;cb
suffix:semicolon
id|sk-&gt;protinfo.af_econet-&gt;port
op_assign
id|sec-&gt;port
suffix:semicolon
id|sk-&gt;protinfo.af_econet-&gt;station
op_assign
id|sec-&gt;addr.station
suffix:semicolon
id|sk-&gt;protinfo.af_econet-&gt;net
op_assign
id|sec-&gt;addr.net
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Queue a transmit result for the user to be told about.&n; */
DECL|function|tx_result
r_static
r_void
id|tx_result
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
r_int
id|cookie
comma
r_int
id|result
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_struct
id|ec_cb
op_star
id|eb
suffix:semicolon
r_struct
id|sockaddr_ec
op_star
id|sec
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ec: memory squeeze, transmit result dropped.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|eb
op_assign
(paren
r_struct
id|ec_cb
op_star
)paren
op_amp
id|skb-&gt;cb
suffix:semicolon
id|sec
op_assign
(paren
r_struct
id|sockaddr_ec
op_star
)paren
op_amp
id|eb-&gt;sec
suffix:semicolon
id|memset
c_func
(paren
id|sec
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|sockaddr_ec
)paren
)paren
suffix:semicolon
id|sec-&gt;cookie
op_assign
id|cookie
suffix:semicolon
id|sec-&gt;type
op_assign
id|ECTYPE_TRANSMIT_STATUS
op_or
id|result
suffix:semicolon
id|sec-&gt;sec_family
op_assign
id|AF_ECONET
suffix:semicolon
r_if
c_cond
(paren
id|sock_queue_rcv_skb
c_func
(paren
id|sk
comma
id|skb
)paren
OL
l_int|0
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ECONET_NATIVE
multiline_comment|/*&n; *&t;Called by the Econet hardware driver when a packet transmit&n; *&t;has completed.  Tell the user.&n; */
DECL|function|ec_tx_done
r_static
r_void
id|ec_tx_done
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|result
)paren
(brace
r_struct
id|ec_cb
op_star
id|eb
op_assign
(paren
r_struct
id|ec_cb
op_star
)paren
op_amp
id|skb-&gt;cb
suffix:semicolon
id|tx_result
c_func
(paren
id|skb-&gt;sk
comma
id|eb-&gt;cookie
comma
id|result
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *&t;Send a packet.  We have to work out which device it&squot;s going out on&n; *&t;and hence whether to use real Econet or the UDP emulation.&n; */
DECL|function|econet_sendmsg
r_static
r_int
id|econet_sendmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_ec
op_star
id|saddr
op_assign
(paren
r_struct
id|sockaddr_ec
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|ec_addr
id|addr
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_char
id|port
comma
id|cb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|ec_cb
op_star
id|eb
suffix:semicolon
macro_line|#ifdef CONFIG_ECONET_NATIVE
r_int
r_int
id|proto
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ECONET_AUNUDP
r_struct
id|msghdr
id|udpmsg
suffix:semicolon
r_struct
id|iovec
id|iov
(braket
id|msg-&gt;msg_iovlen
op_plus
l_int|1
)braket
suffix:semicolon
r_struct
id|aunhdr
id|ah
suffix:semicolon
r_struct
id|sockaddr_in
id|udpdest
suffix:semicolon
id|__kernel_size_t
id|size
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mm_segment_t
id|oldfs
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *&t;Check the flags. &n;&t; */
r_if
c_cond
(paren
id|msg-&gt;msg_flags
op_amp
op_complement
id|MSG_DONTWAIT
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Get and verify the address. &n;&t; */
r_if
c_cond
(paren
id|saddr
op_eq
l_int|NULL
)paren
(brace
id|addr.station
op_assign
id|sk-&gt;protinfo.af_econet-&gt;station
suffix:semicolon
id|addr.net
op_assign
id|sk-&gt;protinfo.af_econet-&gt;net
suffix:semicolon
id|port
op_assign
id|sk-&gt;protinfo.af_econet-&gt;port
suffix:semicolon
id|cb
op_assign
id|sk-&gt;protinfo.af_econet-&gt;cb
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|msg-&gt;msg_namelen
OL
r_sizeof
(paren
r_struct
id|sockaddr_ec
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|addr.station
op_assign
id|saddr-&gt;addr.station
suffix:semicolon
id|addr.net
op_assign
id|saddr-&gt;addr.net
suffix:semicolon
id|port
op_assign
id|saddr-&gt;port
suffix:semicolon
id|cb
op_assign
id|saddr-&gt;cb
suffix:semicolon
)brace
multiline_comment|/* Look for a device with the right network number. */
id|dev
op_assign
id|net2dev_map
(braket
id|addr.net
)braket
suffix:semicolon
multiline_comment|/* If not directly reachable, use some default */
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|dev
op_assign
id|net2dev_map
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* No interfaces at all? */
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENETDOWN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_ECONET
)paren
(brace
multiline_comment|/* Real hardware Econet.  We&squot;re not worthy etc. */
macro_line|#ifdef CONFIG_ECONET_NATIVE
id|atomic_inc
c_func
(paren
op_amp
id|dev-&gt;refcnt
)paren
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|len
op_plus
id|dev-&gt;hard_header_len
op_plus
l_int|15
comma
l_int|0
comma
id|msg-&gt;msg_flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_goto
id|out_unlock
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
(paren
id|dev-&gt;hard_header_len
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|eb
op_assign
(paren
r_struct
id|ec_cb
op_star
)paren
op_amp
id|skb-&gt;cb
suffix:semicolon
id|eb-&gt;cookie
op_assign
id|saddr-&gt;cookie
suffix:semicolon
id|eb-&gt;sec
op_assign
op_star
id|saddr
suffix:semicolon
id|eb-&gt;sent
op_assign
id|ec_tx_done
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header
)paren
(brace
r_int
id|res
suffix:semicolon
r_struct
id|ec_framehdr
op_star
id|fh
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|res
op_assign
id|dev
op_member_access_from_pointer
id|hard_header
c_func
(paren
id|skb
comma
id|dev
comma
id|ntohs
c_func
(paren
id|proto
)paren
comma
op_amp
id|addr
comma
l_int|NULL
comma
id|len
)paren
suffix:semicolon
multiline_comment|/* Poke in our control byte and&n;&t;&t;&t;   port number.  Hack, hack.  */
id|fh
op_assign
(paren
r_struct
id|ec_framehdr
op_star
)paren
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|fh-&gt;cb
op_assign
id|cb
suffix:semicolon
id|fh-&gt;port
op_assign
id|port
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_ne
id|SOCK_DGRAM
)paren
(brace
id|skb-&gt;tail
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
r_goto
id|out_free
suffix:semicolon
)brace
multiline_comment|/* Copy the data. Returns -EFAULT on error */
id|err
op_assign
id|memcpy_fromiovec
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|msg-&gt;msg_iov
comma
id|len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|proto
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;priority
op_assign
id|sk-&gt;priority
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out_free
suffix:semicolon
id|err
op_assign
op_minus
id|ENETDOWN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_goto
id|out_free
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Now send it&n;&t;&t; */
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
id|out_free
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out_unlock
suffix:colon
r_if
c_cond
(paren
id|dev
)paren
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#else
id|err
op_assign
op_minus
id|EPROTOTYPE
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ECONET_AUNUDP
multiline_comment|/* AUN virtual Econet. */
r_if
c_cond
(paren
id|udpsock
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENETDOWN
suffix:semicolon
multiline_comment|/* No socket - can&squot;t send */
multiline_comment|/* Make up a UDP datagram and hand it off to some higher intellect. */
id|memset
c_func
(paren
op_amp
id|udpdest
comma
l_int|0
comma
r_sizeof
(paren
id|udpdest
)paren
)paren
suffix:semicolon
id|udpdest.sin_family
op_assign
id|AF_INET
suffix:semicolon
id|udpdest.sin_port
op_assign
id|htons
c_func
(paren
id|AUN_PORT
)paren
suffix:semicolon
multiline_comment|/* At the moment we use the stupid Acorn scheme of Econet address&n;&t;   y.x maps to IP a.b.c.x.  This should be replaced with something&n;&t;   more flexible and more aware of subnet masks.  */
(brace
r_struct
id|in_device
op_star
id|idev
op_assign
id|in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|network
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|idev
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idev-&gt;ifa_list
)paren
id|network
op_assign
id|ntohl
c_func
(paren
id|idev-&gt;ifa_list-&gt;ifa_address
)paren
op_amp
l_int|0xffffff00
suffix:semicolon
multiline_comment|/* !!! */
id|read_unlock
c_func
(paren
op_amp
id|idev-&gt;lock
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
id|udpdest.sin_addr.s_addr
op_assign
id|htonl
c_func
(paren
id|network
op_or
id|addr.station
)paren
suffix:semicolon
)brace
id|ah.port
op_assign
id|port
suffix:semicolon
id|ah.cb
op_assign
id|cb
op_amp
l_int|0x7f
suffix:semicolon
id|ah.code
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* magic */
id|ah.pad
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* tack our header on the front of the iovec */
id|size
op_assign
r_sizeof
(paren
r_struct
id|aunhdr
)paren
suffix:semicolon
id|iov
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
(paren
r_void
op_star
)paren
op_amp
id|ah
suffix:semicolon
id|iov
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
id|size
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|msg-&gt;msg_iovlen
suffix:semicolon
id|i
op_increment
)paren
(brace
r_void
op_star
id|base
op_assign
id|msg-&gt;msg_iov
(braket
id|i
)braket
dot
id|iov_base
suffix:semicolon
r_int
id|len
op_assign
id|msg-&gt;msg_iov
(braket
id|i
)braket
dot
id|iov_len
suffix:semicolon
multiline_comment|/* Check it now since we switch to KERNEL_DS later. */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|base
comma
id|len
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|iov
(braket
id|i
op_plus
l_int|1
)braket
dot
id|iov_base
op_assign
id|base
suffix:semicolon
id|iov
(braket
id|i
op_plus
l_int|1
)braket
dot
id|iov_len
op_assign
id|len
suffix:semicolon
id|size
op_add_assign
id|len
suffix:semicolon
)brace
multiline_comment|/* Get a skbuff (no data, just holds our cb information) */
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
l_int|0
comma
l_int|0
comma
id|msg-&gt;msg_flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|err
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|err
suffix:semicolon
id|eb
op_assign
(paren
r_struct
id|ec_cb
op_star
)paren
op_amp
id|skb-&gt;cb
suffix:semicolon
id|eb-&gt;cookie
op_assign
id|saddr-&gt;cookie
suffix:semicolon
id|eb-&gt;timeout
op_assign
(paren
l_int|5
op_star
id|HZ
)paren
suffix:semicolon
id|eb-&gt;start
op_assign
id|jiffies
suffix:semicolon
id|ah.handle
op_assign
id|aun_seq
suffix:semicolon
id|eb-&gt;seq
op_assign
(paren
id|aun_seq
op_increment
)paren
suffix:semicolon
id|eb-&gt;sec
op_assign
op_star
id|saddr
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|aun_queue
comma
id|skb
)paren
suffix:semicolon
id|udpmsg.msg_name
op_assign
(paren
r_void
op_star
)paren
op_amp
id|udpdest
suffix:semicolon
id|udpmsg.msg_namelen
op_assign
r_sizeof
(paren
id|udpdest
)paren
suffix:semicolon
id|udpmsg.msg_iov
op_assign
op_amp
id|iov
(braket
l_int|0
)braket
suffix:semicolon
id|udpmsg.msg_iovlen
op_assign
id|msg-&gt;msg_iovlen
op_plus
l_int|1
suffix:semicolon
id|udpmsg.msg_control
op_assign
l_int|NULL
suffix:semicolon
id|udpmsg.msg_controllen
op_assign
l_int|0
suffix:semicolon
id|udpmsg.msg_flags
op_assign
l_int|0
suffix:semicolon
id|oldfs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
multiline_comment|/* More privs :-) */
id|err
op_assign
id|sock_sendmsg
c_func
(paren
id|udpsock
comma
op_amp
id|udpmsg
comma
id|size
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|oldfs
)paren
suffix:semicolon
macro_line|#else
id|err
op_assign
op_minus
id|EPROTOTYPE
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Look up the address of a socket.&n; */
DECL|function|econet_getname
r_static
r_int
id|econet_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddr_len
comma
r_int
id|peer
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_ec
op_star
id|sec
op_assign
(paren
r_struct
id|sockaddr_ec
op_star
)paren
id|uaddr
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|sec-&gt;sec_family
op_assign
id|AF_ECONET
suffix:semicolon
id|sec-&gt;port
op_assign
id|sk-&gt;protinfo.af_econet-&gt;port
suffix:semicolon
id|sec-&gt;addr.station
op_assign
id|sk-&gt;protinfo.af_econet-&gt;station
suffix:semicolon
id|sec-&gt;addr.net
op_assign
id|sk-&gt;protinfo.af_econet-&gt;net
suffix:semicolon
op_star
id|uaddr_len
op_assign
r_sizeof
(paren
op_star
id|sec
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|econet_destroy_timer
r_static
r_void
id|econet_destroy_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
op_logical_and
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
)paren
(brace
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sk-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;econet socket destroy delayed&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Close an econet socket.&n; */
DECL|function|econet_release
r_static
r_int
id|econet_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_return
l_int|0
suffix:semicolon
id|sklist_remove_socket
c_func
(paren
op_amp
id|econet_sklist
comma
id|sk
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Now the socket is dead. No more input will appear.&n;&t; */
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* It is useless. Just for sanity. */
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;socket
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;dead
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Purge queues */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
)paren
op_ne
l_int|NULL
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_logical_or
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
)paren
(brace
id|sk-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|sk
suffix:semicolon
id|sk-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|sk-&gt;timer.function
op_assign
id|econet_destroy_timer
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Create an Econet socket&n; */
DECL|function|econet_create
r_static
r_int
id|econet_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* Econet only provides datagram services. */
r_if
c_cond
(paren
id|sock-&gt;type
op_ne
id|SOCK_DGRAM
)paren
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|PF_ECONET
comma
id|GFP_KERNEL
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|sk-&gt;reuse
op_assign
l_int|1
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|econet_ops
suffix:semicolon
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_econet
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|econet_opt
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_econet
op_eq
l_int|NULL
)paren
r_goto
id|out_free
suffix:semicolon
id|memset
c_func
(paren
id|sk-&gt;protinfo.af_econet
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|econet_opt
)paren
)paren
suffix:semicolon
id|sk-&gt;zapped
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;family
op_assign
id|PF_ECONET
suffix:semicolon
id|sk-&gt;num
op_assign
id|protocol
suffix:semicolon
id|sklist_insert_socket
c_func
(paren
op_amp
id|econet_sklist
comma
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_free
suffix:colon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle Econet specific ioctls&n; */
DECL|function|ec_dev_ioctl
r_static
r_int
id|ec_dev_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|ifreq
id|ifr
suffix:semicolon
r_struct
id|ec_device
op_star
id|edev
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|sockaddr_ec
op_star
id|sec
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Fetch the caller&squot;s info block into kernel space&n;&t; */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ifr
comma
id|arg
comma
r_sizeof
(paren
r_struct
id|ifreq
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|dev_get_by_name
c_func
(paren
id|ifr.ifr_name
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|sec
op_assign
(paren
r_struct
id|sockaddr_ec
op_star
)paren
op_amp
id|ifr.ifr_addr
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCSIFADDR
suffix:colon
id|edev
op_assign
id|dev-&gt;ec_ptr
suffix:semicolon
r_if
c_cond
(paren
id|edev
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* Magic up a new one. */
id|edev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ec_device
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|edev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;af_ec: memory squeeze.&bslash;n&quot;
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|edev
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ec_device
)paren
)paren
suffix:semicolon
id|dev-&gt;ec_ptr
op_assign
id|edev
suffix:semicolon
)brace
r_else
id|net2dev_map
(braket
id|edev-&gt;net
)braket
op_assign
l_int|NULL
suffix:semicolon
id|edev-&gt;station
op_assign
id|sec-&gt;addr.station
suffix:semicolon
id|edev-&gt;net
op_assign
id|sec-&gt;addr.net
suffix:semicolon
id|net2dev_map
(braket
id|sec-&gt;addr.net
)braket
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|net2dev_map
(braket
l_int|0
)braket
)paren
id|net2dev_map
(braket
l_int|0
)braket
op_assign
id|dev
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCGIFADDR
suffix:colon
id|edev
op_assign
id|dev-&gt;ec_ptr
suffix:semicolon
r_if
c_cond
(paren
id|edev
op_eq
l_int|NULL
)paren
(brace
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|memset
c_func
(paren
id|sec
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|sockaddr_ec
)paren
)paren
suffix:semicolon
id|sec-&gt;addr.station
op_assign
id|edev-&gt;station
suffix:semicolon
id|sec-&gt;addr.net
op_assign
id|edev-&gt;net
suffix:semicolon
id|sec-&gt;sec_family
op_assign
id|AF_ECONET
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|ifr
comma
r_sizeof
(paren
r_struct
id|ifreq
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle generic ioctls&n; */
DECL|function|econet_ioctl
r_static
r_int
id|econet_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|pid
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FIOSETOWN
suffix:colon
r_case
id|SIOCSPGRP
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|pid
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;pid
op_ne
id|pid
op_logical_and
id|current-&gt;pgrp
op_ne
op_minus
id|pid
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sk-&gt;proc
op_assign
id|pid
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FIOGETOWN
suffix:colon
r_case
id|SIOCGPGRP
suffix:colon
r_return
id|put_user
c_func
(paren
id|sk-&gt;proc
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCGSTAMP
suffix:colon
r_if
c_cond
(paren
id|sk-&gt;stamp.tv_sec
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|sk-&gt;stamp
comma
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SIOCGIFFLAGS
suffix:colon
r_case
id|SIOCSIFFLAGS
suffix:colon
r_case
id|SIOCGIFCONF
suffix:colon
r_case
id|SIOCGIFMETRIC
suffix:colon
r_case
id|SIOCSIFMETRIC
suffix:colon
r_case
id|SIOCGIFMEM
suffix:colon
r_case
id|SIOCSIFMEM
suffix:colon
r_case
id|SIOCGIFMTU
suffix:colon
r_case
id|SIOCSIFMTU
suffix:colon
r_case
id|SIOCSIFLINK
suffix:colon
r_case
id|SIOCGIFHWADDR
suffix:colon
r_case
id|SIOCSIFHWADDR
suffix:colon
r_case
id|SIOCSIFMAP
suffix:colon
r_case
id|SIOCGIFMAP
suffix:colon
r_case
id|SIOCSIFSLAVE
suffix:colon
r_case
id|SIOCGIFSLAVE
suffix:colon
r_case
id|SIOCGIFINDEX
suffix:colon
r_case
id|SIOCGIFNAME
suffix:colon
r_case
id|SIOCGIFCOUNT
suffix:colon
r_case
id|SIOCSIFHWBROADCAST
suffix:colon
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCSIFADDR
suffix:colon
r_case
id|SIOCGIFADDR
suffix:colon
r_return
id|ec_dev_ioctl
c_func
(paren
id|sock
comma
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
multiline_comment|/*NOTREACHED*/
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|econet_family_ops
r_static
r_struct
id|net_proto_family
id|econet_family_ops
op_assign
(brace
id|PF_ECONET
comma
id|econet_create
)brace
suffix:semicolon
DECL|variable|econet_ops
r_static
r_struct
id|proto_ops
id|SOCKOPS_WRAPPED
c_func
(paren
id|econet_ops
)paren
op_assign
(brace
id|family
suffix:colon
id|PF_ECONET
comma
id|release
suffix:colon
id|econet_release
comma
id|bind
suffix:colon
id|econet_bind
comma
id|connect
suffix:colon
id|sock_no_connect
comma
id|socketpair
suffix:colon
id|sock_no_socketpair
comma
id|accept
suffix:colon
id|sock_no_accept
comma
id|getname
suffix:colon
id|econet_getname
comma
id|poll
suffix:colon
id|datagram_poll
comma
id|ioctl
suffix:colon
id|econet_ioctl
comma
id|listen
suffix:colon
id|sock_no_listen
comma
id|shutdown
suffix:colon
id|sock_no_shutdown
comma
id|setsockopt
suffix:colon
id|sock_no_setsockopt
comma
id|getsockopt
suffix:colon
id|sock_no_getsockopt
comma
id|sendmsg
suffix:colon
id|econet_sendmsg
comma
id|recvmsg
suffix:colon
id|econet_recvmsg
comma
id|mmap
suffix:colon
id|sock_no_mmap
comma
)brace
suffix:semicolon
macro_line|#include &lt;linux/smp_lock.h&gt;
id|SOCKOPS_WRAP
c_func
(paren
id|econet
comma
id|PF_ECONET
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Find the listening socket, if any, for the given data.&n; */
DECL|function|ec_listening_socket
r_struct
id|sock
op_star
id|ec_listening_socket
c_func
(paren
r_int
r_char
id|port
comma
r_int
r_char
id|station
comma
r_int
r_char
id|net
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|econet_sklist
suffix:semicolon
r_while
c_loop
(paren
id|sk
)paren
(brace
r_struct
id|econet_opt
op_star
id|opt
op_assign
id|sk-&gt;protinfo.af_econet
suffix:semicolon
r_if
c_cond
(paren
(paren
id|opt-&gt;port
op_eq
id|port
op_logical_or
id|opt-&gt;port
op_eq
l_int|0
)paren
op_logical_and
(paren
id|opt-&gt;station
op_eq
id|station
op_logical_or
id|opt-&gt;station
op_eq
l_int|0
)paren
op_logical_and
(paren
id|opt-&gt;net
op_eq
id|net
op_logical_or
id|opt-&gt;net
op_eq
l_int|0
)paren
)paren
r_return
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Queue a received packet for a socket.&n; */
DECL|function|ec_queue_packet
r_static
r_int
id|ec_queue_packet
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_char
id|stn
comma
r_int
r_char
id|net
comma
r_int
r_char
id|cb
comma
r_int
r_char
id|port
)paren
(brace
r_struct
id|ec_cb
op_star
id|eb
op_assign
(paren
r_struct
id|ec_cb
op_star
)paren
op_amp
id|skb-&gt;cb
suffix:semicolon
r_struct
id|sockaddr_ec
op_star
id|sec
op_assign
(paren
r_struct
id|sockaddr_ec
op_star
)paren
op_amp
id|eb-&gt;sec
suffix:semicolon
id|memset
c_func
(paren
id|sec
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|sockaddr_ec
)paren
)paren
suffix:semicolon
id|sec-&gt;sec_family
op_assign
id|AF_ECONET
suffix:semicolon
id|sec-&gt;type
op_assign
id|ECTYPE_PACKET_RECEIVED
suffix:semicolon
id|sec-&gt;port
op_assign
id|port
suffix:semicolon
id|sec-&gt;cb
op_assign
id|cb
suffix:semicolon
id|sec-&gt;addr.net
op_assign
id|net
suffix:semicolon
id|sec-&gt;addr.station
op_assign
id|stn
suffix:semicolon
r_return
id|sock_queue_rcv_skb
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ECONET_AUNUDP
multiline_comment|/*&n; *&t;Send an AUN protocol response. &n; */
DECL|function|aun_send_response
r_static
r_void
id|aun_send_response
c_func
(paren
id|__u32
id|addr
comma
r_int
r_int
id|seq
comma
r_int
id|code
comma
r_int
id|cb
)paren
(brace
r_struct
id|sockaddr_in
id|sin
suffix:semicolon
r_struct
id|iovec
id|iov
suffix:semicolon
r_struct
id|aunhdr
id|ah
suffix:semicolon
r_struct
id|msghdr
id|udpmsg
suffix:semicolon
r_int
id|err
suffix:semicolon
id|mm_segment_t
id|oldfs
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sin
comma
l_int|0
comma
r_sizeof
(paren
id|sin
)paren
)paren
suffix:semicolon
id|sin.sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin.sin_port
op_assign
id|htons
c_func
(paren
id|AUN_PORT
)paren
suffix:semicolon
id|sin.sin_addr.s_addr
op_assign
id|addr
suffix:semicolon
id|ah.code
op_assign
id|code
suffix:semicolon
id|ah.pad
op_assign
l_int|0
suffix:semicolon
id|ah.port
op_assign
l_int|0
suffix:semicolon
id|ah.cb
op_assign
id|cb
suffix:semicolon
id|ah.handle
op_assign
id|seq
suffix:semicolon
id|iov.iov_base
op_assign
(paren
r_void
op_star
)paren
op_amp
id|ah
suffix:semicolon
id|iov.iov_len
op_assign
r_sizeof
(paren
id|ah
)paren
suffix:semicolon
id|udpmsg.msg_name
op_assign
(paren
r_void
op_star
)paren
op_amp
id|sin
suffix:semicolon
id|udpmsg.msg_namelen
op_assign
r_sizeof
(paren
id|sin
)paren
suffix:semicolon
id|udpmsg.msg_iov
op_assign
op_amp
id|iov
suffix:semicolon
id|udpmsg.msg_iovlen
op_assign
l_int|1
suffix:semicolon
id|udpmsg.msg_control
op_assign
l_int|NULL
suffix:semicolon
id|udpmsg.msg_controllen
op_assign
l_int|0
suffix:semicolon
id|udpmsg.msg_flags
op_assign
l_int|0
suffix:semicolon
id|oldfs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|sock_sendmsg
c_func
(paren
id|udpsock
comma
op_amp
id|udpmsg
comma
r_sizeof
(paren
id|ah
)paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|oldfs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle incoming AUN packets.  Work out if anybody wants them,&n; *&t;and send positive or negative acknowledgements as appropriate.&n; */
DECL|function|aun_incoming
r_static
r_void
id|aun_incoming
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|aunhdr
op_star
id|ah
comma
r_int
id|len
)paren
(brace
r_struct
id|iphdr
op_star
id|ip
op_assign
id|skb-&gt;nh.iph
suffix:semicolon
r_int
r_char
id|stn
op_assign
id|ntohl
c_func
(paren
id|ip-&gt;saddr
)paren
op_amp
l_int|0xff
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|newskb
suffix:semicolon
r_struct
id|ec_device
op_star
id|edev
op_assign
id|skb-&gt;dev-&gt;ec_ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
r_goto
id|bad
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sk
op_assign
id|ec_listening_socket
c_func
(paren
id|ah-&gt;port
comma
id|stn
comma
id|edev-&gt;net
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|bad
suffix:semicolon
multiline_comment|/* Nobody wants it */
id|newskb
op_assign
id|alloc_skb
c_func
(paren
(paren
id|len
op_minus
r_sizeof
(paren
r_struct
id|aunhdr
)paren
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newskb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;AUN: memory squeeze, dropping packet.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Send nack and hope sender tries again */
r_goto
id|bad
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|newskb
comma
id|len
op_minus
r_sizeof
(paren
r_struct
id|aunhdr
)paren
)paren
comma
(paren
r_void
op_star
)paren
(paren
id|ah
op_plus
l_int|1
)paren
comma
id|len
op_minus
r_sizeof
(paren
r_struct
id|aunhdr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ec_queue_packet
c_func
(paren
id|sk
comma
id|newskb
comma
id|stn
comma
id|edev-&gt;net
comma
id|ah-&gt;cb
comma
id|ah-&gt;port
)paren
)paren
(brace
multiline_comment|/* Socket is bankrupt. */
id|kfree_skb
c_func
(paren
id|newskb
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|aun_send_response
c_func
(paren
id|ip-&gt;saddr
comma
id|ah-&gt;handle
comma
l_int|3
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
id|bad
suffix:colon
id|aun_send_response
c_func
(paren
id|ip-&gt;saddr
comma
id|ah-&gt;handle
comma
l_int|4
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle incoming AUN transmit acknowledgements.  If the sequence&n; *      number matches something in our backlog then kill it and tell&n; *&t;the user.  If the remote took too long to reply then we may have&n; *&t;dropped the packet already.&n; */
DECL|function|aun_tx_ack
r_static
r_void
id|aun_tx_ack
c_func
(paren
r_int
r_int
id|seq
comma
r_int
id|result
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|ec_cb
op_star
id|eb
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|aun_queue_lock
comma
id|flags
)paren
suffix:semicolon
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|aun_queue
)paren
suffix:semicolon
r_while
c_loop
(paren
id|skb
op_logical_and
id|skb
op_ne
(paren
r_struct
id|sk_buff
op_star
)paren
op_amp
id|aun_queue
)paren
(brace
r_struct
id|sk_buff
op_star
id|newskb
op_assign
id|skb-&gt;next
suffix:semicolon
id|eb
op_assign
(paren
r_struct
id|ec_cb
op_star
)paren
op_amp
id|skb-&gt;cb
suffix:semicolon
r_if
c_cond
(paren
id|eb-&gt;seq
op_eq
id|seq
)paren
r_goto
id|foundit
suffix:semicolon
id|skb
op_assign
id|newskb
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|aun_queue_lock
comma
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;AUN: unknown sequence %ld&bslash;n&quot;
comma
id|seq
)paren
suffix:semicolon
r_return
suffix:semicolon
id|foundit
suffix:colon
id|tx_result
c_func
(paren
id|skb-&gt;sk
comma
id|eb-&gt;cookie
comma
id|result
)paren
suffix:semicolon
id|skb_unlink
c_func
(paren
id|skb
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|aun_queue_lock
comma
id|flags
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Deal with received AUN frames - sort out what type of thing it is&n; *&t;and hand it to the right function.&n; */
DECL|function|aun_data_available
r_static
r_void
id|aun_data_available
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|slen
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
op_star
id|data
suffix:semicolon
r_struct
id|aunhdr
op_star
id|ah
suffix:semicolon
r_struct
id|iphdr
op_star
id|ip
suffix:semicolon
r_int
id|len
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_recv_datagram
c_func
(paren
id|sk
comma
l_int|0
comma
l_int|1
comma
op_amp
id|err
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|EAGAIN
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AUN: no data available?!&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;AUN: recvfrom() error %d&bslash;n&quot;
comma
op_minus
id|err
)paren
suffix:semicolon
)brace
id|data
op_assign
id|skb-&gt;h.raw
op_plus
r_sizeof
(paren
r_struct
id|udphdr
)paren
suffix:semicolon
id|ah
op_assign
(paren
r_struct
id|aunhdr
op_star
)paren
id|data
suffix:semicolon
id|len
op_assign
id|skb-&gt;len
op_minus
r_sizeof
(paren
r_struct
id|udphdr
)paren
suffix:semicolon
id|ip
op_assign
id|skb-&gt;nh.iph
suffix:semicolon
r_switch
c_cond
(paren
id|ah-&gt;code
)paren
(brace
r_case
l_int|2
suffix:colon
id|aun_incoming
c_func
(paren
id|skb
comma
id|ah
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|aun_tx_ack
c_func
(paren
id|ah-&gt;handle
comma
id|ECTYPE_TRANSMIT_OK
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|aun_tx_ack
c_func
(paren
id|ah-&gt;handle
comma
id|ECTYPE_TRANSMIT_NOT_LISTENING
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
multiline_comment|/* This isn&squot;t quite right yet. */
r_case
l_int|5
suffix:colon
id|aun_send_response
c_func
(paren
id|ip-&gt;saddr
comma
id|ah-&gt;handle
comma
l_int|6
comma
id|ah-&gt;cb
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;unknown AUN packet (type %d)&bslash;n&quot;
comma
id|data
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
id|skb_free_datagram
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Called by the timer to manage the AUN transmit queue.  If a packet&n; *&t;was sent to a dead or nonexistent host then we will never get an&n; *&t;acknowledgement back.  After a few seconds we need to spot this and&n; *&t;drop the packet.&n; */
DECL|function|ab_cleanup
r_static
r_void
id|ab_cleanup
c_func
(paren
r_int
r_int
id|h
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|aun_queue_lock
comma
id|flags
)paren
suffix:semicolon
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|aun_queue
)paren
suffix:semicolon
r_while
c_loop
(paren
id|skb
op_logical_and
id|skb
op_ne
(paren
r_struct
id|sk_buff
op_star
)paren
op_amp
id|aun_queue
)paren
(brace
r_struct
id|sk_buff
op_star
id|newskb
op_assign
id|skb-&gt;next
suffix:semicolon
r_struct
id|ec_cb
op_star
id|eb
op_assign
(paren
r_struct
id|ec_cb
op_star
)paren
op_amp
id|skb-&gt;cb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|eb-&gt;start
)paren
OG
id|eb-&gt;timeout
)paren
(brace
id|tx_result
c_func
(paren
id|skb-&gt;sk
comma
id|eb-&gt;cookie
comma
id|ECTYPE_TRANSMIT_NOT_PRESENT
)paren
suffix:semicolon
id|skb_unlink
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|skb
op_assign
id|newskb
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|aun_queue_lock
comma
id|flags
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|ab_cleanup_timer
comma
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|2
)paren
)paren
suffix:semicolon
)brace
DECL|function|aun_udp_initialise
r_static
r_int
id|__init
id|aun_udp_initialise
c_func
(paren
r_void
)paren
(brace
r_int
id|error
suffix:semicolon
r_struct
id|sockaddr_in
id|sin
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|aun_queue
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|aun_queue_lock
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ab_cleanup_timer
)paren
suffix:semicolon
id|ab_cleanup_timer.expires
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|2
)paren
suffix:semicolon
id|ab_cleanup_timer.function
op_assign
id|ab_cleanup
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ab_cleanup_timer
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sin
comma
l_int|0
comma
r_sizeof
(paren
id|sin
)paren
)paren
suffix:semicolon
id|sin.sin_port
op_assign
id|htons
c_func
(paren
id|AUN_PORT
)paren
suffix:semicolon
multiline_comment|/* We can count ourselves lucky Acorn machines are too dim to&n;&t;   speak IPv6. :-) */
r_if
c_cond
(paren
(paren
id|error
op_assign
id|sock_create
c_func
(paren
id|PF_INET
comma
id|SOCK_DGRAM
comma
l_int|0
comma
op_amp
id|udpsock
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AUN: socket error %d&bslash;n&quot;
comma
op_minus
id|error
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|udpsock-&gt;sk-&gt;reuse
op_assign
l_int|1
suffix:semicolon
id|udpsock-&gt;sk-&gt;allocation
op_assign
id|GFP_ATOMIC
suffix:semicolon
multiline_comment|/* we&squot;re going to call it&n;&t;&t;&t;&t;&t;&t;   from interrupts */
id|error
op_assign
id|udpsock-&gt;ops
op_member_access_from_pointer
id|bind
c_func
(paren
id|udpsock
comma
(paren
r_struct
id|sockaddr
op_star
)paren
op_amp
id|sin
comma
r_sizeof
(paren
id|sin
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;AUN: bind error %d&bslash;n&quot;
comma
op_minus
id|error
)paren
suffix:semicolon
r_goto
id|release
suffix:semicolon
)brace
id|udpsock-&gt;sk-&gt;data_ready
op_assign
id|aun_data_available
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|release
suffix:colon
id|sock_release
c_func
(paren
id|udpsock
)paren
suffix:semicolon
id|udpsock
op_assign
l_int|NULL
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ECONET_NATIVE
multiline_comment|/*&n; *&t;Receive an Econet frame from a device.&n; */
DECL|function|econet_rcv
r_static
r_int
id|econet_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|ec_framehdr
op_star
id|hdr
op_assign
(paren
r_struct
id|ec_framehdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|ec_device
op_star
id|edev
op_assign
id|dev-&gt;ec_ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|edev
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
OL
r_sizeof
(paren
r_struct
id|ec_framehdr
)paren
)paren
(brace
multiline_comment|/* Frame is too small to be any use */
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* First check for encapsulated IP */
r_if
c_cond
(paren
id|hdr-&gt;port
op_eq
id|EC_PORT_IP
)paren
(brace
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|ec_framehdr
)paren
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|sk
op_assign
id|ec_listening_socket
c_func
(paren
id|hdr-&gt;port
comma
id|hdr-&gt;src_stn
comma
id|hdr-&gt;src_net
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|ec_queue_packet
c_func
(paren
id|sk
comma
id|skb
comma
id|edev-&gt;net
comma
id|hdr-&gt;src_stn
comma
id|hdr-&gt;cb
comma
id|hdr-&gt;port
)paren
suffix:semicolon
)brace
DECL|variable|econet_packet_type
r_struct
id|packet_type
id|econet_packet_type
op_assign
(brace
l_int|0
comma
l_int|NULL
comma
id|econet_rcv
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|econet_hw_initialise
r_static
r_void
id|econet_hw_initialise
c_func
(paren
r_void
)paren
(brace
id|econet_packet_type.type
op_assign
id|htons
c_func
(paren
id|ETH_P_ECONET
)paren
suffix:semicolon
id|dev_add_pack
c_func
(paren
op_amp
id|econet_packet_type
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|econet_notifier
r_static
r_int
id|econet_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|msg
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|ec_device
op_star
id|edev
suffix:semicolon
r_switch
c_cond
(paren
id|msg
)paren
(brace
r_case
id|NETDEV_UNREGISTER
suffix:colon
multiline_comment|/* A device has gone down - kill any data we hold for it. */
id|edev
op_assign
id|dev-&gt;ec_ptr
suffix:semicolon
r_if
c_cond
(paren
id|edev
)paren
(brace
r_if
c_cond
(paren
id|net2dev_map
(braket
l_int|0
)braket
op_eq
id|dev
)paren
id|net2dev_map
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|net2dev_map
(braket
id|edev-&gt;net
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|edev
)paren
suffix:semicolon
id|dev-&gt;ec_ptr
op_assign
l_int|NULL
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|variable|econet_netdev_notifier
r_struct
id|notifier_block
id|econet_netdev_notifier
op_assign
initialization_block
suffix:semicolon
DECL|function|econet_proto_exit
r_void
id|__exit
id|econet_proto_exit
c_func
(paren
r_void
)paren
(brace
r_extern
r_void
id|econet_sysctl_unregister
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ECONET_AUNUDP
id|del_timer
c_func
(paren
op_amp
id|ab_cleanup_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udpsock
)paren
id|sock_release
c_func
(paren
id|udpsock
)paren
suffix:semicolon
macro_line|#endif
id|unregister_netdevice_notifier
c_func
(paren
op_amp
id|econet_netdev_notifier
)paren
suffix:semicolon
id|sock_unregister
c_func
(paren
id|econet_family_ops.family
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
id|econet_sysctl_unregister
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|econet_proto_init
r_int
id|__init
id|econet_proto_init
c_func
(paren
r_void
)paren
(brace
r_extern
r_void
id|econet_sysctl_register
c_func
(paren
r_void
)paren
suffix:semicolon
id|sock_register
c_func
(paren
op_amp
id|econet_family_ops
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ECONET_AUNUDP
id|spin_lock_init
c_func
(paren
op_amp
id|aun_queue_lock
)paren
suffix:semicolon
id|aun_udp_initialise
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ECONET_NATIVE
id|econet_hw_initialise
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|register_netdevice_notifier
c_func
(paren
op_amp
id|econet_netdev_notifier
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
id|econet_sysctl_register
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|econet_proto_init
id|module_init
c_func
(paren
id|econet_proto_init
)paren
suffix:semicolon
DECL|variable|econet_proto_exit
id|module_exit
c_func
(paren
id|econet_proto_exit
)paren
suffix:semicolon
eof
