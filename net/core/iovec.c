multiline_comment|/*&n; *&t;iovec manipulation routines.&n; *&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; *&n; *&t;Fixes:&n; *&t;&t;Andrew Lunn&t;:&t;Errors in iovec copying.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
DECL|function|min
r_extern
r_inline
r_int
id|min
c_func
(paren
r_int
id|x
comma
r_int
id|y
)paren
(brace
r_return
id|x
OG
id|y
ques
c_cond
id|y
suffix:colon
id|x
suffix:semicolon
)brace
DECL|function|verify_iovec
r_int
id|verify_iovec
c_func
(paren
r_struct
id|msghdr
op_star
id|m
comma
r_struct
id|iovec
op_star
id|iov
comma
r_char
op_star
id|address
comma
r_int
id|mode
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|ct
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;msg_name
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|mode
op_eq
id|VERIFY_READ
)paren
(brace
id|err
op_assign
id|move_addr_to_kernel
c_func
(paren
id|m-&gt;msg_name
comma
id|m-&gt;msg_namelen
comma
id|address
)paren
suffix:semicolon
)brace
r_else
id|err
op_assign
id|verify_area
c_func
(paren
id|mode
comma
id|m-&gt;msg_name
comma
id|m-&gt;msg_namelen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|m-&gt;msg_accrights
op_ne
l_int|NULL
)paren
(brace
id|err
op_assign
id|verify_area
c_func
(paren
id|mode
comma
id|m-&gt;msg_accrights
comma
id|m-&gt;msg_accrightslen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|m-&gt;msg_iovlen
suffix:semicolon
id|ct
op_increment
)paren
(brace
id|err
op_assign
id|verify_area
c_func
(paren
id|mode
comma
id|m-&gt;msg_iov
(braket
id|ct
)braket
dot
id|iov_base
comma
id|m-&gt;msg_iov
(braket
id|ct
)braket
dot
id|iov_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|len
op_add_assign
id|m-&gt;msg_iov
(braket
id|ct
)braket
dot
id|iov_len
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Copy kernel to iovec.&n; */
DECL|function|memcpy_toiovec
r_void
id|memcpy_toiovec
c_func
(paren
r_struct
id|iovec
op_star
id|iov
comma
r_int
r_char
op_star
id|kdata
comma
r_int
id|len
)paren
(brace
r_while
c_loop
(paren
id|len
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|iov-&gt;iov_len
)paren
(brace
r_int
id|copy
op_assign
id|min
c_func
(paren
id|iov-&gt;iov_len
comma
id|len
)paren
suffix:semicolon
id|memcpy_tofs
c_func
(paren
id|iov-&gt;iov_base
comma
id|kdata
comma
id|copy
)paren
suffix:semicolon
id|kdata
op_add_assign
id|copy
suffix:semicolon
id|len
op_sub_assign
id|copy
suffix:semicolon
id|iov-&gt;iov_len
op_sub_assign
id|copy
suffix:semicolon
id|iov-&gt;iov_base
op_add_assign
id|copy
suffix:semicolon
)brace
id|iov
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Copy iovec to kernel.&n; */
DECL|function|memcpy_fromiovec
r_void
id|memcpy_fromiovec
c_func
(paren
r_int
r_char
op_star
id|kdata
comma
r_struct
id|iovec
op_star
id|iov
comma
r_int
id|len
)paren
(brace
r_while
c_loop
(paren
id|len
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|iov-&gt;iov_len
)paren
(brace
r_int
id|copy
op_assign
id|min
c_func
(paren
id|len
comma
id|iov-&gt;iov_len
)paren
suffix:semicolon
id|memcpy_fromfs
c_func
(paren
id|kdata
comma
id|iov-&gt;iov_base
comma
id|copy
)paren
suffix:semicolon
id|len
op_sub_assign
id|copy
suffix:semicolon
id|kdata
op_add_assign
id|copy
suffix:semicolon
id|iov-&gt;iov_base
op_add_assign
id|copy
suffix:semicolon
id|iov-&gt;iov_len
op_sub_assign
id|copy
suffix:semicolon
)brace
id|iov
op_increment
suffix:semicolon
)brace
)brace
eof
