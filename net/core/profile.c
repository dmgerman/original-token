macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;net/checksum.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;net/profile.h&gt;
macro_line|#ifdef CONFIG_NET_PROFILE
DECL|variable|net_profile_active
id|atomic_t
id|net_profile_active
suffix:semicolon
DECL|variable|net_profile_adjust
r_struct
id|timeval
id|net_profile_adjust
suffix:semicolon
DECL|variable|total
id|NET_PROFILE_DEFINE
c_func
(paren
id|total
)paren
suffix:semicolon
DECL|variable|net_profile_chain
r_struct
id|net_profile_slot
op_star
id|net_profile_chain
op_assign
op_amp
id|net_prof_total
suffix:semicolon
macro_line|#ifdef __alpha__
DECL|variable|alpha_lo
id|__u32
id|alpha_lo
suffix:semicolon
DECL|variable|alpha_hi
r_int
id|alpha_hi
suffix:semicolon
r_static
r_void
id|alpha_tick
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
DECL|variable|alpha_timer
r_static
r_struct
id|timer_list
id|alpha_timer
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|0L
comma
id|alpha_tick
)brace
suffix:semicolon
DECL|function|alpha_tick
r_void
id|alpha_tick
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
r_struct
id|timeval
id|dummy_stamp
suffix:semicolon
id|net_profile_stamp
c_func
(paren
op_amp
id|dummy_stamp
)paren
suffix:semicolon
id|alpha_timer.expires
op_assign
id|jiffies
op_plus
l_int|4
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|alpha_timer
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|net_profile_irq_adjust
r_void
id|net_profile_irq_adjust
c_func
(paren
r_struct
id|timeval
op_star
id|entered
comma
r_struct
id|timeval
op_star
id|leaved
)paren
(brace
r_struct
id|net_profile_slot
op_star
id|s
suffix:semicolon
id|net_profile_sub
c_func
(paren
id|entered
comma
id|leaved
)paren
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
id|net_profile_chain
suffix:semicolon
id|s
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;active
)paren
id|net_profile_add
c_func
(paren
id|leaved
comma
op_amp
id|s-&gt;irq
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|profile_read_proc
r_static
r_int
id|profile_read_proc
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_struct
id|net_profile_slot
op_star
id|s
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Slot            Hits       Hi         Lo         OnIrqHi    OnIrqLo    Ufl&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_eq
l_int|0
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|net_prof_total.active
op_assign
l_int|1
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|net_profile_active
)paren
suffix:semicolon
id|NET_PROFILE_LEAVE
c_func
(paren
id|total
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|s
op_assign
id|net_profile_chain
suffix:semicolon
id|s
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
r_struct
id|net_profile_slot
id|tmp
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|tmp
op_assign
op_star
id|s
suffix:semicolon
multiline_comment|/* Wrong, but pretty close to truth */
id|s-&gt;accumulator.tv_sec
op_assign
l_int|0
suffix:semicolon
id|s-&gt;accumulator.tv_usec
op_assign
l_int|0
suffix:semicolon
id|s-&gt;irq.tv_sec
op_assign
l_int|0
suffix:semicolon
id|s-&gt;irq.tv_usec
op_assign
l_int|0
suffix:semicolon
id|s-&gt;hits
op_assign
l_int|0
suffix:semicolon
id|s-&gt;underflow
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Repair active count, it is possible, only if code has a bug */
r_if
c_cond
(paren
id|s-&gt;active
)paren
(brace
id|s-&gt;active
op_assign
l_int|0
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|net_profile_active
)paren
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|net_profile_sub
c_func
(paren
op_amp
id|tmp.irq
comma
op_amp
id|tmp.accumulator
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-15s %-10d %-10ld %-10lu %-10lu %-10lu %d/%d&quot;
comma
id|tmp.id
comma
id|tmp.hits
comma
id|tmp.accumulator.tv_sec
comma
id|tmp.accumulator.tv_usec
comma
id|tmp.irq.tv_sec
comma
id|tmp.irq.tv_usec
comma
id|tmp.underflow
comma
id|tmp.active
)paren
suffix:semicolon
id|buffer
(braket
id|len
op_increment
)braket
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
r_goto
id|done
suffix:semicolon
)brace
)brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
id|done
suffix:colon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_eq
l_int|0
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|net_prof_total.active
op_assign
l_int|0
suffix:semicolon
id|net_prof_total.hits
op_assign
l_int|0
suffix:semicolon
id|net_profile_stamp
c_func
(paren
op_amp
id|net_prof_total.entered
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|whitehole_iph
r_struct
id|iphdr
id|whitehole_iph
suffix:semicolon
DECL|variable|whitehole_count
r_int
id|whitehole_count
suffix:semicolon
DECL|function|whitehole_xmit
r_static
r_int
id|whitehole_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_device_stats
op_star
id|stats
suffix:semicolon
id|stats
op_assign
(paren
r_struct
id|net_device_stats
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|stats-&gt;tx_packets
op_increment
suffix:semicolon
id|stats-&gt;tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|whitehole_inject
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_int
id|whitehole_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|variable|whitehole_timer
r_static
r_struct
id|timer_list
id|whitehole_timer
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|0L
comma
id|whitehole_inject
)brace
suffix:semicolon
DECL|variable|whitehole_dev
r_static
r_struct
id|net_device
id|whitehole_dev
op_assign
(brace
l_string|&quot;whitehole&quot;
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|whitehole_init
comma
)brace
suffix:semicolon
DECL|function|whitehole_open
r_static
r_int
id|whitehole_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|whitehole_count
op_assign
l_int|100000
suffix:semicolon
id|whitehole_timer.expires
op_assign
id|jiffies
op_plus
l_int|5
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|whitehole_timer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|whitehole_close
r_static
r_int
id|whitehole_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|whitehole_timer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|whitehole_inject
r_static
r_void
id|whitehole_inject
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
r_struct
id|net_device_stats
op_star
id|stats
op_assign
(paren
r_struct
id|net_device_stats
op_star
)paren
id|whitehole_dev.priv
suffix:semicolon
r_extern
r_int
id|netdev_dropping
suffix:semicolon
r_do
(brace
r_struct
id|iphdr
op_star
id|iph
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|128
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_break
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|32
)paren
suffix:semicolon
id|iph
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|iph
)paren
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
(paren
(paren
id|u8
op_star
)paren
id|iph
)paren
op_minus
l_int|14
suffix:semicolon
id|memcpy
c_func
(paren
id|iph
comma
op_amp
id|whitehole_iph
comma
r_sizeof
(paren
op_star
id|iph
)paren
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
op_amp
id|whitehole_dev
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
id|stats-&gt;rx_packets
op_increment
suffix:semicolon
id|stats-&gt;rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|whitehole_count
op_decrement
suffix:semicolon
)brace
r_while
c_loop
(paren
id|netdev_dropping
op_eq
l_int|0
op_logical_and
id|whitehole_count
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|whitehole_count
OG
l_int|0
)paren
(brace
id|whitehole_timer.expires
op_assign
id|jiffies
op_plus
l_int|1
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|whitehole_timer
)paren
suffix:semicolon
)brace
)brace
DECL|function|whitehole_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|whitehole_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_device_stats
op_star
id|stats
op_assign
(paren
r_struct
id|net_device_stats
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
id|stats
suffix:semicolon
)brace
DECL|function|whitehole_init
r_int
id|__init
id|whitehole_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dev-&gt;priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|memset
c_func
(paren
id|dev-&gt;priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
)paren
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|whitehole_get_stats
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|whitehole_xmit
suffix:semicolon
id|dev-&gt;open
op_assign
id|whitehole_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|whitehole_close
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|IFF_NOARP
suffix:semicolon
id|dev-&gt;flags
op_and_assign
op_complement
(paren
id|IFF_BROADCAST
op_or
id|IFF_MULTICAST
)paren
suffix:semicolon
id|dev-&gt;iflink
op_assign
l_int|0
suffix:semicolon
id|whitehole_iph.ihl
op_assign
l_int|5
suffix:semicolon
id|whitehole_iph.version
op_assign
l_int|4
suffix:semicolon
id|whitehole_iph.ttl
op_assign
l_int|2
suffix:semicolon
id|whitehole_iph.saddr
op_assign
id|in_aton
c_func
(paren
l_string|&quot;193.233.7.21&quot;
)paren
suffix:semicolon
id|whitehole_iph.daddr
op_assign
id|in_aton
c_func
(paren
l_string|&quot;193.233.7.10&quot;
)paren
suffix:semicolon
id|whitehole_iph.tot_len
op_assign
id|htons
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|whitehole_iph.check
op_assign
id|ip_compute_csum
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|whitehole_iph
comma
l_int|20
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|net_profile_register
r_int
id|net_profile_register
c_func
(paren
r_struct
id|net_profile_slot
op_star
id|slot
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|slot-&gt;next
op_assign
id|net_profile_chain
suffix:semicolon
id|net_profile_chain
op_assign
id|slot
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|net_profile_unregister
r_int
id|net_profile_unregister
c_func
(paren
r_struct
id|net_profile_slot
op_star
id|slot
)paren
(brace
r_struct
id|net_profile_slot
op_star
op_star
id|sp
comma
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|sp
op_assign
op_amp
id|net_profile_chain
suffix:semicolon
(paren
id|s
op_assign
op_star
id|sp
)paren
op_ne
l_int|NULL
suffix:semicolon
id|sp
op_assign
op_amp
id|s-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|s
op_eq
id|slot
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
op_star
id|sp
op_assign
id|s-&gt;next
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
DECL|function|net_profile_init
r_int
id|__init
id|net_profile_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|create_proc_read_entry
c_func
(paren
l_string|&quot;net/profile&quot;
comma
l_int|0
comma
l_int|0
comma
id|profile_read_proc
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
id|register_netdevice
c_func
(paren
op_amp
id|whitehole_dev
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Evaluating net profiler cost ...&quot;
)paren
suffix:semicolon
macro_line|#ifdef __alpha__
id|alpha_tick
c_func
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1024
suffix:semicolon
id|i
op_increment
)paren
(brace
id|NET_PROFILE_ENTER
c_func
(paren
id|total
)paren
suffix:semicolon
id|NET_PROFILE_LEAVE
c_func
(paren
id|total
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|net_prof_total.accumulator.tv_sec
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; too high!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|net_profile_adjust.tv_usec
op_assign
id|net_prof_total.accumulator.tv_usec
op_rshift
l_int|10
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%ld units&bslash;n&quot;
comma
id|net_profile_adjust.tv_usec
)paren
suffix:semicolon
)brace
id|net_prof_total.hits
op_assign
l_int|0
suffix:semicolon
id|net_profile_stamp
c_func
(paren
op_amp
id|net_prof_total.entered
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
eof
