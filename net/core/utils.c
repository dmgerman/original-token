multiline_comment|/*&n; *&t;Generic address resultion entity&n; *&n; *&t;Authors:&n; *&t;net_random Alan Cox&n; *&t;net_ratelimit Andy Kleen&n; *&n; *&t;Created by Alexey Kuznetsov &lt;kuznet@ms2.inr.ac.ru&gt;&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
DECL|variable|net_rand_seed
r_static
r_int
r_int
id|net_rand_seed
op_assign
l_int|152L
suffix:semicolon
DECL|function|net_random
r_int
r_int
id|net_random
c_func
(paren
r_void
)paren
(brace
id|net_rand_seed
op_assign
id|net_rand_seed
op_star
l_int|69069L
op_plus
l_int|1
suffix:semicolon
r_return
id|net_rand_seed
op_xor
id|jiffies
suffix:semicolon
)brace
DECL|function|net_srandom
r_void
id|net_srandom
c_func
(paren
r_int
r_int
id|entropy
)paren
(brace
id|net_rand_seed
op_xor_assign
id|entropy
suffix:semicolon
id|net_random
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|net_msg_cost
r_int
id|net_msg_cost
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
DECL|variable|net_msg_burst
r_int
id|net_msg_burst
op_assign
l_int|10
op_star
l_int|5
op_star
id|HZ
suffix:semicolon
multiline_comment|/* &n; * This enforces a rate limit: not more than one kernel message&n; * every 5secs to make a denial-of-service attack impossible.&n; *&n; * All warning printk()s should be guarded by this function. &n; */
DECL|function|net_ratelimit
r_int
id|net_ratelimit
c_func
(paren
r_void
)paren
(brace
r_static
id|spinlock_t
id|ratelimit_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_static
r_int
r_int
id|toks
op_assign
l_int|10
op_star
l_int|5
op_star
id|HZ
suffix:semicolon
r_static
r_int
r_int
id|last_msg
suffix:semicolon
r_static
r_int
id|missed
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ratelimit_lock
comma
id|flags
)paren
suffix:semicolon
id|toks
op_add_assign
id|now
op_minus
id|last_msg
suffix:semicolon
id|last_msg
op_assign
id|now
suffix:semicolon
r_if
c_cond
(paren
id|toks
OG
id|net_msg_burst
)paren
id|toks
op_assign
id|net_msg_burst
suffix:semicolon
r_if
c_cond
(paren
id|toks
op_ge
id|net_msg_cost
)paren
(brace
r_int
id|lost
op_assign
id|missed
suffix:semicolon
id|missed
op_assign
l_int|0
suffix:semicolon
id|toks
op_sub_assign
id|net_msg_cost
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ratelimit_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lost
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NET: %d messages suppressed.&bslash;n&quot;
comma
id|lost
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|missed
op_increment
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ratelimit_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
