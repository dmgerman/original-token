multiline_comment|/* el3.c: An 3c509 EtherLink3 ethernet driver for linux. */
multiline_comment|/*&n;    Written 1993 by Donald Becker.&n;&n;    Copyright 1993 United States Government as represented by the&n;    Director, National Security Agency.  This software may be used and&n;    distributed according to the terms of the GNU Public License,&n;    incorporated herein by reference.&n;    &n;    This driver should work with the 3Com EtherLinkIII series.&n;&n;    The author may be reached as becker@super.org or&n;    C/O Supercomputing Research Ctr., 17100 Science Dr., Bowie MD 20715&n;*/
DECL|variable|version
r_static
r_char
op_star
id|version
op_assign
l_string|&quot;el3.c: v0.02 8/13/93 becker@super.org&bslash;n&quot;
suffix:semicolon
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/in.h&gt;
multiline_comment|/*#include &lt;asm/system.h&gt;*/
macro_line|#include &lt;asm/io.h&gt;
macro_line|#ifndef port_read
macro_line|#include &quot;iow.h&quot;
macro_line|#endif
macro_line|#include &quot;dev.h&quot;
macro_line|#include &quot;eth.h&quot;
macro_line|#include &quot;skbuff.h&quot;
macro_line|#include &quot;arp.h&quot;
multiline_comment|/* From auto_irq.c, should be in a *.h file. */
r_extern
r_void
id|autoirq_setup
c_func
(paren
r_int
id|waittime
)paren
suffix:semicolon
r_extern
r_int
id|autoirq_report
c_func
(paren
r_int
id|waittime
)paren
suffix:semicolon
r_extern
r_struct
id|device
op_star
id|irq2dev_map
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* These should be in &lt;asm/io.h&gt;. */
DECL|macro|port_read_l
mdefine_line|#define port_read_l(port,buf,nr) &bslash;&n;__asm__(&quot;cld;rep;insl&quot;: :&quot;d&quot; (port),&quot;D&quot; (buf),&quot;c&quot; (nr):&quot;cx&quot;,&quot;di&quot;)
DECL|macro|port_write_l
mdefine_line|#define port_write_l(port,buf,nr) &bslash;&n;__asm__(&quot;cld;rep;outsl&quot;: :&quot;d&quot; (port),&quot;S&quot; (buf),&quot;c&quot; (nr):&quot;cx&quot;,&quot;si&quot;)
macro_line|#ifdef EL3_DEBUG
DECL|variable|el3_debug
r_int
id|el3_debug
op_assign
id|EL3_DEBUG
suffix:semicolon
macro_line|#else
DECL|variable|el3_debug
r_int
id|el3_debug
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
multiline_comment|/* Offsets from base I/O address. */
DECL|macro|EL3_DATA
mdefine_line|#define EL3_DATA 0x00
DECL|macro|EL3_CMD
mdefine_line|#define EL3_CMD 0x0e
DECL|macro|EL3_STATUS
mdefine_line|#define EL3_STATUS 0x0e
DECL|macro|ID_PORT
mdefine_line|#define ID_PORT 0x100
DECL|macro|EEPROM_READ
mdefine_line|#define  EEPROM_READ 0x80
multiline_comment|/* Register window 1 offsets, used in normal operation. */
DECL|macro|TX_FREE
mdefine_line|#define TX_FREE 0x0C
DECL|macro|TX_STATUS
mdefine_line|#define TX_STATUS 0x0B
DECL|macro|TX_FIFO
mdefine_line|#define TX_FIFO 0x00
DECL|macro|RX_STATUS
mdefine_line|#define RX_STATUS 0x08
DECL|macro|RX_FIFO
mdefine_line|#define RX_FIFO 0x00
DECL|struct|el3_private
r_struct
id|el3_private
(brace
DECL|member|stats
r_struct
id|enet_statistics
id|stats
suffix:semicolon
)brace
suffix:semicolon
r_static
r_int
id|el3_init
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|read_eeprom
c_func
(paren
r_int
id|index
)paren
suffix:semicolon
r_static
r_int
id|el3_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|el3_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|el3_interrupt
c_func
(paren
r_int
id|reg_ptr
)paren
suffix:semicolon
r_static
r_void
id|update_stats
c_func
(paren
r_int
id|addr
comma
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|enet_statistics
op_star
id|el3_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|el3_rx
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|el3_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
"&f;"
DECL|function|el3_probe
r_int
id|el3_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|lrs_state
op_assign
l_int|0xff
comma
id|i
suffix:semicolon
r_int
r_int
id|iobase
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Send the ID sequence to the ID_PORT. */
id|outb
c_func
(paren
l_int|0x00
comma
id|ID_PORT
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|ID_PORT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|255
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
id|lrs_state
comma
id|ID_PORT
)paren
suffix:semicolon
id|lrs_state
op_lshift_assign
l_int|1
suffix:semicolon
id|lrs_state
op_assign
id|lrs_state
op_amp
l_int|0x100
ques
c_cond
id|lrs_state
op_xor
l_int|0xcf
suffix:colon
id|lrs_state
suffix:semicolon
)brace
multiline_comment|/* The current Space.c initialization makes it difficult to have more&n;       than one adaptor initialized.  Send me email if you have a need for&n;       multiple adaptors. */
multiline_comment|/* Read in EEPROM data.&n;       Only the highest address board will stay on-line. */
(brace
r_int
op_star
id|phys_addr
op_assign
(paren
r_int
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
id|phys_addr
(braket
l_int|0
)braket
op_assign
id|htons
c_func
(paren
id|read_eeprom
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phys_addr
(braket
l_int|0
)braket
op_ne
l_int|0x6000
)paren
r_return
l_int|1
suffix:semicolon
id|phys_addr
(braket
l_int|1
)braket
op_assign
id|htons
c_func
(paren
id|read_eeprom
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|phys_addr
(braket
l_int|2
)braket
op_assign
id|htons
c_func
(paren
id|read_eeprom
c_func
(paren
l_int|2
)paren
)paren
suffix:semicolon
)brace
id|iobase
op_assign
id|read_eeprom
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|read_eeprom
c_func
(paren
l_int|9
)paren
op_rshift
l_int|12
suffix:semicolon
multiline_comment|/* Activate the adaptor at the EEPROM location (if set), else 0x320. */
r_if
c_cond
(paren
id|iobase
op_eq
l_int|0x0000
)paren
(brace
id|dev-&gt;base_addr
op_assign
l_int|0x320
suffix:semicolon
id|outb
c_func
(paren
l_int|0xf2
comma
id|ID_PORT
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;base_addr
op_assign
l_int|0x200
op_plus
(paren
(paren
id|iobase
op_amp
l_int|0x1f
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|ID_PORT
)paren
suffix:semicolon
)brace
id|outw
c_func
(paren
l_int|0x0800
comma
id|dev-&gt;base_addr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Window 0. */
id|printk
c_func
(paren
l_string|&quot;%s: 3c509 at %#3.3x  key %4.4x iobase %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
comma
id|inw
c_func
(paren
id|dev-&gt;base_addr
)paren
comma
id|iobase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|dev-&gt;base_addr
)paren
op_eq
l_int|0x6d50
)paren
(brace
id|el3_init
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_static
r_int
DECL|function|read_eeprom
id|read_eeprom
c_func
(paren
r_int
id|index
)paren
(brace
r_int
id|timer
comma
id|bit
comma
id|word
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Issue read command, and pause for at least 162 us. for it to complete.&n;       Assume extra-fast 16Mhz bus. */
id|outb
c_func
(paren
id|EEPROM_READ
op_plus
id|index
comma
id|ID_PORT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timer
op_assign
l_int|0
suffix:semicolon
id|timer
OL
l_int|162
op_star
l_int|4
op_plus
l_int|400
suffix:semicolon
id|timer
op_increment
)paren
id|SLOW_DOWN_IO
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|15
suffix:semicolon
id|bit
op_ge
l_int|0
suffix:semicolon
id|bit
op_decrement
)paren
id|word
op_assign
(paren
id|word
op_lshift
l_int|1
)paren
op_plus
(paren
id|inb
c_func
(paren
id|ID_PORT
)paren
op_amp
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;  3c509 EEPROM word %d %#4.4x.&bslash;n&quot;
comma
id|index
comma
id|word
)paren
suffix:semicolon
r_return
id|word
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_init
id|el3_init
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: EL3 at %#3x, address&quot;
comma
id|dev-&gt;name
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* Read in the station address. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2x&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* Make up a EL3-specific-data structure. */
id|dev-&gt;priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|el3_private
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|memset
c_func
(paren
id|dev-&gt;priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|el3_private
)paren
)paren
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|el3_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
multiline_comment|/* The EL3-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|el3_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|el3_start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|el3_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|el3_get_stats
suffix:semicolon
multiline_comment|/* Fill in the generic field of the device structure. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DEV_NUMBUFFS
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;buffs
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;hard_header
op_assign
id|eth_header
suffix:semicolon
id|dev-&gt;add_arp
op_assign
id|eth_add_arp
suffix:semicolon
id|dev-&gt;queue_xmit
op_assign
id|dev_queue_xmit
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
id|eth_rebuild_header
suffix:semicolon
id|dev-&gt;type_trans
op_assign
id|eth_type_trans
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
id|ETH_HLEN
suffix:semicolon
id|dev-&gt;mtu
op_assign
l_int|1500
suffix:semicolon
multiline_comment|/* eth_mtu */
id|dev-&gt;addr_len
op_assign
id|ETH_ALEN
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;addr_len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;broadcast
(braket
id|i
)braket
op_assign
l_int|0xff
suffix:semicolon
)brace
multiline_comment|/* New-style flags. */
id|dev-&gt;flags
op_assign
id|IFF_BROADCAST
suffix:semicolon
id|dev-&gt;family
op_assign
id|AF_INET
suffix:semicolon
id|dev-&gt;pa_addr
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;pa_brdaddr
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;pa_mask
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;pa_alen
op_assign
r_sizeof
(paren
r_int
r_int
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
"&f;"
r_static
r_int
DECL|function|el3_open
id|el3_open
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|el3_interrupt
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|el3_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Opening, IRQ %d  status@%x %4.4x reg4 %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
comma
id|ioaddr
op_plus
id|EL3_STATUS
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|4
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x0800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Make certain we are in window 0. */
multiline_comment|/* This is probably unnecessary. */
id|outw
c_func
(paren
l_int|0x0001
comma
id|ioaddr
op_plus
l_int|4
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|dev-&gt;irq
op_lshift
l_int|12
)paren
op_or
l_int|0x0f00
comma
id|ioaddr
op_plus
l_int|8
)paren
suffix:semicolon
id|irq2dev_map
(braket
id|dev-&gt;irq
)braket
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Set the station address in window 2 each time opened. */
id|outw
c_func
(paren
l_int|0x0802
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|outb
c_func
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|i
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x1000
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Start the thinnet transceiver. */
id|outw
c_func
(paren
l_int|0x8005
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Accept b-case and phys addr only. */
id|outw
c_func
(paren
l_int|0xA800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Turn on statistics. */
id|outw
c_func
(paren
l_int|0x2000
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Enable the receiver. */
id|outw
c_func
(paren
l_int|0x4800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Enable transmitter. */
id|outw
c_func
(paren
l_int|0x78ff
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Allow all status bits to be seen. */
id|outw
c_func
(paren
l_int|0x7098
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Set interrupt mask. */
multiline_comment|/* Switch to register set 1 for normal use. */
id|outw
c_func
(paren
l_int|0x0801
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Opened 3c509  IRQ %d  status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Always succeed */
)brace
r_static
r_int
DECL|function|el3_start_xmit
id|el3_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
(paren
r_struct
id|el3_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/* Transmitter timeout, serious problems. */
r_if
c_cond
(paren
id|dev-&gt;tbusy
)paren
(brace
r_int
id|tickssofar
op_assign
id|jiffies
op_minus
id|dev-&gt;trans_start
suffix:semicolon
r_if
c_cond
(paren
id|tickssofar
OL
l_int|10
)paren
r_return
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: transmit timed out, tx_status %4.4x status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TX_STATUS
)paren
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* Issue TX_RESET and TX_START commands. */
id|outw
c_func
(paren
l_int|0x5800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* TX_RESET */
id|outw
c_func
(paren
l_int|0x4800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* TX_START */
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|dev_tint
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Fill in the ethernet header. */
r_if
c_cond
(paren
op_logical_neg
id|skb-&gt;arp
op_logical_and
id|dev
op_member_access_from_pointer
id|rebuild_header
c_func
(paren
id|skb
op_plus
l_int|1
comma
id|dev
)paren
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|arp_queue
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;len
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: el3_start_xmit(lenght = %d) called, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
op_amp
l_int|0x0001
)paren
(brace
multiline_comment|/* IRQ line active, missed one. */
id|printk
c_func
(paren
l_string|&quot;%s: Missed interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x7800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Fake interrupt trigger. */
id|outw
c_func
(paren
l_int|0x6899
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Ack IRQ */
id|outw
c_func
(paren
l_int|0x78ff
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Allow all status bits to be seen. */
)brace
multiline_comment|/* Avoid timer-based retransmission conflicts. */
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Put out the doubleword header... */
id|outw
c_func
(paren
id|skb-&gt;len
comma
id|ioaddr
op_plus
id|TX_FIFO
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|TX_FIFO
)paren
suffix:semicolon
multiline_comment|/* ... and the packet rounded to a doubleword. */
id|port_write
c_func
(paren
id|ioaddr
op_plus
id|TX_FIFO
comma
(paren
r_void
op_star
)paren
(paren
id|skb
op_plus
l_int|1
)paren
comma
(paren
(paren
id|skb-&gt;len
op_plus
l_int|3
)paren
op_rshift
l_int|1
)paren
op_amp
op_complement
l_int|0x1
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;free
)paren
id|kfree_skb
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|TX_FREE
)paren
OG
l_int|1536
)paren
(brace
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
)brace
r_else
multiline_comment|/* Interrupt us when the FIFO has room for max-sized packet. */
id|outw
c_func
(paren
l_int|0x9000
op_plus
l_int|1536
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;        Finished queueing packet, FIFO room remaining %d.&bslash;n&quot;
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|TX_FREE
)paren
)paren
suffix:semicolon
multiline_comment|/* Clear the Tx status stack. */
(brace
r_int
id|tx_status
suffix:semicolon
r_int
id|i
op_assign
l_int|4
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|i
OG
l_int|0
op_logical_and
(paren
id|tx_status
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TX_STATUS
)paren
)paren
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|el3_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;        Tx status %4.4x.&bslash;n&quot;
comma
id|tx_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x38
)paren
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x30
)paren
id|outw
c_func
(paren
l_int|0x5800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x3C
)paren
id|outw
c_func
(paren
l_int|0x4800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|TX_STATUS
)paren
suffix:semicolon
multiline_comment|/* Pop the status stack. */
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The EL3 interrupt handler. */
r_static
r_void
DECL|function|el3_interrupt
id|el3_interrupt
c_func
(paren
r_int
id|reg_ptr
)paren
(brace
r_int
id|irq
op_assign
op_minus
(paren
(paren
(paren
r_struct
id|pt_regs
op_star
)paren
id|reg_ptr
)paren
op_member_access_from_pointer
id|orig_eax
op_plus
l_int|2
)paren
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
id|irq2dev_map
(braket
id|irq
)braket
suffix:semicolon
r_int
id|ioaddr
comma
id|status
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
l_string|&quot;el3_interrupt(): irq %d for unknown device.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;interrupt
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Re-entering the interrupt handler.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;interrupt
op_assign
l_int|1
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;%s: interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
op_amp
l_int|0x01
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x08
)paren
(brace
r_if
c_cond
(paren
id|el3_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;    TX room bit was handled.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* There&squot;s room in the FIFO for a full-sized packet. */
id|outw
c_func
(paren
l_int|0x6808
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Ack IRQ */
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|mark_bh
c_func
(paren
id|INET_BH
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x80
)paren
multiline_comment|/* Statistics full. */
id|update_stats
c_func
(paren
id|ioaddr
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x10
)paren
id|el3_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Clear the interrupts we&squot;ve handled. */
id|outw
c_func
(paren
l_int|0x6899
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Ack IRQ */
)brace
r_if
c_cond
(paren
id|el3_debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: exiting interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
op_amp
l_int|0x01
)paren
(brace
r_int
id|i
op_assign
l_int|100000
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: exiting interrupt with status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
)paren
multiline_comment|/* Delay loop to see the message. */
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
op_amp
l_int|0x0010
)paren
op_logical_and
id|i
op_increment
OL
l_int|20
)paren
id|outw
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|RX_STATUS
)paren
suffix:semicolon
)brace
id|dev-&gt;interrupt
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_struct
id|enet_statistics
op_star
DECL|function|el3_get_stats
id|el3_get_stats
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
(paren
r_struct
id|el3_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|update_stats
c_func
(paren
id|dev-&gt;base_addr
comma
id|dev
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/* Update statistics.  We change to register window 6, so this&n;   must be run single-threaded. */
DECL|function|update_stats
r_static
r_void
id|update_stats
c_func
(paren
r_int
id|ioaddr
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
(paren
r_struct
id|el3_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;   Updating the statistics.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Turn off statistics updates while reading. */
id|outw
c_func
(paren
l_int|0xB000
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Switch to the stats window, and read everything. */
id|outw
c_func
(paren
l_int|0x0806
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|lp-&gt;stats.tx_carrier_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0
)paren
suffix:semicolon
id|lp-&gt;stats.tx_heartbeat_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Multiple collisions. */
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|2
)paren
suffix:semicolon
id|lp-&gt;stats.collisions
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|3
)paren
suffix:semicolon
id|lp-&gt;stats.tx_window_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|4
)paren
suffix:semicolon
id|lp-&gt;stats.rx_fifo_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|5
)paren
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|6
)paren
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* Tx deferrals */
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|8
)paren
suffix:semicolon
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Total Rx and Tx octets. */
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|12
)paren
suffix:semicolon
multiline_comment|/* Back to window 1, and turn statistics back on. */
id|outw
c_func
(paren
l_int|0x0801
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0xA800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Print statistics on the kernel error output. */
DECL|function|printk_stats
r_void
id|printk_stats
c_func
(paren
r_struct
id|enet_statistics
op_star
id|stats
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  Ethernet statistics:  Rx packets %6d  Tx packets %6d.&bslash;n&quot;
comma
id|stats-&gt;rx_packets
comma
id|stats-&gt;tx_packets
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;   Carrier errors:   %6d.&bslash;n&quot;
comma
id|stats-&gt;tx_carrier_errors
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;   Heartbeat errors: %6d.&bslash;n&quot;
comma
id|stats-&gt;tx_heartbeat_errors
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;   Collisions:       %6d.&bslash;n&quot;
comma
id|stats-&gt;collisions
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;   Rx FIFO problems: %6d.&bslash;n&quot;
comma
id|stats-&gt;rx_fifo_errors
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_rx
id|el3_rx
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
(paren
r_struct
id|el3_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|rx_status
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;       In rx_packet(), status %4.4x, rx_status %4.4x.&bslash;n&quot;
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|RX_STATUS
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rx_status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|RX_STATUS
)paren
)paren
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x4000
)paren
(brace
multiline_comment|/* Error, update stats. */
r_int
id|error
op_assign
id|rx_status
op_amp
l_int|0x3C00
suffix:semicolon
id|lp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|error
)paren
(brace
r_case
l_int|0x2000
suffix:colon
id|lp-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2C00
suffix:colon
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3400
suffix:colon
id|lp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2400
suffix:colon
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3000
suffix:colon
id|lp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0800
suffix:colon
id|lp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|rx_status
op_amp
l_int|0x4000
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|rx_status
op_amp
l_int|0x2000
)paren
)paren
(brace
multiline_comment|/* Dribble bits are OK. */
r_int
id|length
op_assign
id|rx_status
op_amp
l_int|0x3ff
suffix:semicolon
r_int
id|sksize
op_assign
r_sizeof
(paren
r_struct
id|sk_buff
)paren
op_plus
id|length
op_plus
l_int|3
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
id|kmalloc
c_func
(paren
id|sksize
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;       Receiving packet size %d status %4.4x.&bslash;n&quot;
comma
id|length
comma
id|rx_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;lock
op_assign
l_int|0
suffix:semicolon
id|skb-&gt;mem_len
op_assign
id|sksize
suffix:semicolon
id|skb-&gt;mem_addr
op_assign
id|skb
suffix:semicolon
multiline_comment|/* &squot;skb+1&squot; points to the start of sk_buff data area. */
id|port_read
c_func
(paren
id|ioaddr
op_plus
id|RX_FIFO
comma
(paren
r_void
op_star
)paren
(paren
id|skb
op_plus
l_int|1
)paren
comma
(paren
(paren
id|length
op_plus
l_int|3
)paren
op_rshift
l_int|2
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_rint
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|skb
comma
id|length
comma
id|IN_SKBUFF
comma
id|dev
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|el3_debug
OG
l_int|6
)paren
id|printk
c_func
(paren
l_string|&quot;     dev_rint() happy, status %4.4x.&bslash;n&quot;
comma
id|inb
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x4000
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Rx discard */
r_while
c_loop
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
op_amp
l_int|0x1000
)paren
id|printk
c_func
(paren
l_string|&quot;  Waiting for 3c509 to discard packet, status %x.&bslash;n&quot;
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|6
)paren
id|printk
c_func
(paren
l_string|&quot;     discarded packet, status %4.4x.&bslash;n&quot;
comma
id|inb
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: receive buffers full.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|kfree_s
c_func
(paren
id|skb
comma
id|sksize
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|el3_debug
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Couldn&squot;t allocate a sk_buff of size %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|sksize
)paren
suffix:semicolon
)brace
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|outw
c_func
(paren
l_int|0x4000
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Rx discard */
r_while
c_loop
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
op_amp
l_int|0x1000
)paren
id|printk
c_func
(paren
l_string|&quot;  Waiting for 3c509 to discard packet, status %x.&bslash;n&quot;
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|el3_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;       Exiting rx_packet(), status %4.4x, rx_status %4.4x.&bslash;n&quot;
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|8
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_close
id|el3_close
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Shutting down ethercard.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;start
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Turn off statistics.  We update lp-&gt;stats below. */
id|outw
c_func
(paren
l_int|0xB000
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Disable the receiver and transmitter. */
id|outw
c_func
(paren
l_int|0x1800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x5000
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Turn off thinnet power. */
id|outw
c_func
(paren
l_int|0xb800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|2
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
(paren
r_struct
id|el3_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Status was %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
id|printk_stats
c_func
(paren
op_amp
id|lp-&gt;stats
)paren
suffix:semicolon
)brace
multiline_comment|/* Free the interrupt line. */
id|free_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x1000
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x0f00
comma
id|ioaddr
op_plus
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Switch back to register window 0. */
id|outw
c_func
(paren
l_int|0x0800
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|irq2dev_map
(braket
id|dev-&gt;irq
)braket
op_assign
l_int|0
suffix:semicolon
id|update_stats
c_func
(paren
id|ioaddr
comma
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
"&f;"
multiline_comment|/*&n; * Local variables:&n; *  compile-command: &quot;gcc -D__KERNEL__ -Wall -O6 -x c++ -c 3c509.c&quot;&n; * End:&n; */
eof
