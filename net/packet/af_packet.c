multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;PACKET - implements raw packet sockets.&n; *&n; * Version:&t;$Id: af_packet.c,v 1.47 2000/12/08 17:15:54 davem Exp $&n; *&n; * Authors:&t;Ross Biro, &lt;bir7@leland.Stanford.Edu&gt;&n; *&t;&t;Fred N. van Kempen, &lt;waltje@uWalt.NL.Mugnet.ORG&gt;&n; *&t;&t;Alan Cox, &lt;gw4pts@gw4pts.ampr.org&gt;&n; *&n; * Fixes:&t;&n; *&t;&t;Alan Cox&t;:&t;verify_area() now used correctly&n; *&t;&t;Alan Cox&t;:&t;new skbuff lists, look ma no backlogs!&n; *&t;&t;Alan Cox&t;:&t;tidied skbuff lists.&n; *&t;&t;Alan Cox&t;:&t;Now uses generic datagram routines I&n; *&t;&t;&t;&t;&t;added. Also fixed the peek/read crash&n; *&t;&t;&t;&t;&t;from all old Linux datagram code.&n; *&t;&t;Alan Cox&t;:&t;Uses the improved datagram code.&n; *&t;&t;Alan Cox&t;:&t;Added NULL&squot;s for socket options.&n; *&t;&t;Alan Cox&t;:&t;Re-commented the code.&n; *&t;&t;Alan Cox&t;:&t;Use new kernel side addressing&n; *&t;&t;Rob Janssen&t;:&t;Correct MTU usage.&n; *&t;&t;Dave Platt&t;:&t;Counter leaks caused by incorrect&n; *&t;&t;&t;&t;&t;interrupt locking and some slightly&n; *&t;&t;&t;&t;&t;dubious gcc output. Can you read&n; *&t;&t;&t;&t;&t;compiler: it said _VOLATILE_&n; *&t;Richard Kooijman&t;:&t;Timestamp fixes.&n; *&t;&t;Alan Cox&t;:&t;New buffers. Use sk-&gt;mac.raw.&n; *&t;&t;Alan Cox&t;:&t;sendmsg/recvmsg support.&n; *&t;&t;Alan Cox&t;:&t;Protocol setting support&n; *&t;Alexey Kuznetsov&t;:&t;Untied from IPv4 stack.&n; *&t;Cyrus Durgin&t;&t;:&t;Fixed kerneld for kmod.&n; *&t;Michal Ostrowski        :       Module initialization cleanup.&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_packet.h&gt;
macro_line|#include &lt;linux/wireless.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/if_bridge.h&gt;
macro_line|#ifdef CONFIG_NET_DIVERT
macro_line|#include &lt;linux/divert.h&gt;
macro_line|#endif /* CONFIG_NET_DIVERT */
macro_line|#ifdef CONFIG_INET
macro_line|#include &lt;net/inet_common.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_DLCI
r_extern
r_int
id|dlci_ioctl
c_func
(paren
r_int
r_int
comma
r_void
op_star
)paren
suffix:semicolon
macro_line|#endif
DECL|macro|CONFIG_SOCK_PACKET
mdefine_line|#define CONFIG_SOCK_PACKET&t;1
multiline_comment|/*&n;   Proposed replacement for SIOC{ADD,DEL}MULTI and&n;   IFF_PROMISC, IFF_ALLMULTI flags.&n;&n;   It is more expensive, but I believe,&n;   it is really correct solution: reentereble, safe and fault tolerant.&n;&n;   IFF_PROMISC/IFF_ALLMULTI/SIOC{ADD/DEL}MULTI are faked by keeping&n;   reference count and global flag, so that real status is&n;   (gflag|(count != 0)), so that we can use obsolete faulty interface&n;   not harming clever users.&n; */
DECL|macro|CONFIG_PACKET_MULTICAST
mdefine_line|#define CONFIG_PACKET_MULTICAST&t;1
multiline_comment|/*&n;   Assumptions:&n;   - if device has no dev-&gt;hard_header routine, it adds and removes ll header&n;     inside itself. In this case ll header is invisible outside of device,&n;     but higher levels still should reserve dev-&gt;hard_header_len.&n;     Some devices are enough clever to reallocate skb, when header&n;     will not fit to reserved space (tunnel), another ones are silly&n;     (PPP).&n;   - packet socket receives packets with pulled ll header,&n;     so that SOCK_RAW should push it back.&n;&n;On receive:&n;-----------&n;&n;Incoming, dev-&gt;hard_header!=NULL&n;   mac.raw -&gt; ll header&n;   data    -&gt; data&n;&n;Outgoing, dev-&gt;hard_header!=NULL&n;   mac.raw -&gt; ll header&n;   data    -&gt; ll header&n;&n;Incoming, dev-&gt;hard_header==NULL&n;   mac.raw -&gt; UNKNOWN position. It is very likely, that it points to ll header.&n;              PPP makes it, that is wrong, because introduce assymetry&n;&t;      between rx and tx paths.&n;   data    -&gt; data&n;&n;Outgoing, dev-&gt;hard_header==NULL&n;   mac.raw -&gt; data. ll header is still not built!&n;   data    -&gt; data&n;&n;Resume&n;  If dev-&gt;hard_header==NULL we are unlikely to restore sensible ll header.&n;&n;&n;On transmit:&n;------------&n;&n;dev-&gt;hard_header != NULL&n;   mac.raw -&gt; ll header&n;   data    -&gt; ll header&n;&n;dev-&gt;hard_header == NULL (ll header is added by device, we cannot control it)&n;   mac.raw -&gt; data&n;   data -&gt; data&n;&n;   We should set nh.raw on output to correct posistion,&n;   packet classifier depends on it.&n; */
multiline_comment|/* List of all packet sockets. */
DECL|variable|packet_sklist
r_static
r_struct
id|sock
op_star
id|packet_sklist
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|packet_sklist_lock
r_static
id|rwlock_t
id|packet_sklist_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|packet_socks_nr
id|atomic_t
id|packet_socks_nr
suffix:semicolon
multiline_comment|/* Private packet socket structures. */
macro_line|#ifdef CONFIG_PACKET_MULTICAST
DECL|struct|packet_mclist
r_struct
id|packet_mclist
(brace
DECL|member|next
r_struct
id|packet_mclist
op_star
id|next
suffix:semicolon
DECL|member|ifindex
r_int
id|ifindex
suffix:semicolon
DECL|member|count
r_int
id|count
suffix:semicolon
DECL|member|type
r_int
r_int
id|type
suffix:semicolon
DECL|member|alen
r_int
r_int
id|alen
suffix:semicolon
DECL|member|addr
r_int
r_char
id|addr
(braket
l_int|8
)braket
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PACKET_MMAP
r_static
r_int
id|packet_set_ring
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|tpacket_req
op_star
id|req
comma
r_int
id|closing
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|packet_flush_mclist
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
DECL|struct|packet_opt
r_struct
id|packet_opt
(brace
DECL|member|prot_hook
r_struct
id|packet_type
id|prot_hook
suffix:semicolon
DECL|member|bind_lock
id|spinlock_t
id|bind_lock
suffix:semicolon
DECL|member|running
r_char
id|running
suffix:semicolon
multiline_comment|/* prot_hook is attached*/
DECL|member|ifindex
r_int
id|ifindex
suffix:semicolon
multiline_comment|/* bound device&t;&t;*/
DECL|member|stats
r_struct
id|tpacket_stats
id|stats
suffix:semicolon
macro_line|#ifdef CONFIG_PACKET_MULTICAST
DECL|member|mclist
r_struct
id|packet_mclist
op_star
id|mclist
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PACKET_MMAP
DECL|member|mapped
id|atomic_t
id|mapped
suffix:semicolon
DECL|member|pg_vec
r_int
r_int
op_star
id|pg_vec
suffix:semicolon
DECL|member|pg_vec_order
r_int
r_int
id|pg_vec_order
suffix:semicolon
DECL|member|pg_vec_pages
r_int
r_int
id|pg_vec_pages
suffix:semicolon
DECL|member|pg_vec_len
r_int
r_int
id|pg_vec_len
suffix:semicolon
DECL|member|iovec
r_struct
id|tpacket_hdr
op_star
op_star
id|iovec
suffix:semicolon
DECL|member|frame_size
r_int
r_int
id|frame_size
suffix:semicolon
DECL|member|iovmax
r_int
r_int
id|iovmax
suffix:semicolon
DECL|member|head
r_int
r_int
id|head
suffix:semicolon
DECL|member|copy_thresh
r_int
id|copy_thresh
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
DECL|function|packet_sock_destruct
r_void
id|packet_sock_destruct
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|BUG_TRAP
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
op_eq
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Attempt to release alive packet socket: %p&bslash;n&quot;
comma
id|sk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;protinfo.destruct_hook
)paren
id|kfree
c_func
(paren
id|sk-&gt;protinfo.destruct_hook
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|packet_socks_nr
)paren
suffix:semicolon
macro_line|#ifdef PACKET_REFCNT_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;PACKET socket %p is free, %d are alive&bslash;n&quot;
comma
id|sk
comma
id|atomic_read
c_func
(paren
op_amp
id|packet_socks_nr
)paren
)paren
suffix:semicolon
macro_line|#endif
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
r_extern
r_struct
id|proto_ops
id|packet_ops
suffix:semicolon
macro_line|#ifdef CONFIG_SOCK_PACKET
r_extern
r_struct
id|proto_ops
id|packet_ops_spkt
suffix:semicolon
DECL|function|packet_rcv_spkt
r_static
r_int
id|packet_rcv_spkt
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|sockaddr_pkt
op_star
id|spkt
suffix:semicolon
multiline_comment|/*&n;&t; *&t;When we registered the protocol we saved the socket in the data&n;&t; *&t;field for just this event.&n;&t; */
id|sk
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|pt-&gt;data
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Yank back the headers [hope the device set this&n;&t; *&t;right or kerboom...]&n;&t; *&n;&t; *&t;Incoming packets have ll header pulled,&n;&t; *&t;push it back.&n;&t; *&n;&t; *&t;For outgoing ones skb-&gt;data == skb-&gt;mac.raw&n;&t; *&t;so that this procedure is noop.&n;&t; */
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_eq
id|PACKET_LOOPBACK
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|skb_share_check
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|oom
suffix:semicolon
id|spkt
op_assign
(paren
r_struct
id|sockaddr_pkt
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
id|skb_push
c_func
(paren
id|skb
comma
id|skb-&gt;data
op_minus
id|skb-&gt;mac.raw
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;The SOCK_PACKET socket receives _all_ frames.&n;&t; */
id|spkt-&gt;spkt_family
op_assign
id|dev-&gt;type
suffix:semicolon
id|strncpy
c_func
(paren
id|spkt-&gt;spkt_device
comma
id|dev-&gt;name
comma
r_sizeof
(paren
id|spkt-&gt;spkt_device
)paren
)paren
suffix:semicolon
id|spkt-&gt;spkt_protocol
op_assign
id|skb-&gt;protocol
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Charge the memory to the socket. This is done specifically&n;&t; *&t;to prevent sockets using all the memory up.&n;&t; */
r_if
c_cond
(paren
id|sock_queue_rcv_skb
c_func
(paren
id|sk
comma
id|skb
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|oom
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Output a raw packet to a device layer. This bypasses all the other&n; *&t;protocol layers and you must therefore supply it with a complete frame&n; */
DECL|function|packet_sendmsg_spkt
r_static
r_int
id|packet_sendmsg_spkt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_pkt
op_star
id|saddr
op_assign
(paren
r_struct
id|sockaddr_pkt
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
r_int
id|proto
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Get and verify the address. &n;&t; */
r_if
c_cond
(paren
id|saddr
)paren
(brace
r_if
c_cond
(paren
id|msg-&gt;msg_namelen
OL
r_sizeof
(paren
r_struct
id|sockaddr
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_namelen
op_eq
r_sizeof
(paren
r_struct
id|sockaddr_pkt
)paren
)paren
id|proto
op_assign
id|saddr-&gt;spkt_protocol
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENOTCONN
suffix:semicolon
multiline_comment|/* SOCK_PACKET must be sent giving an address */
multiline_comment|/*&n;&t; *&t;Find the device first to size check it &n;&t; */
id|saddr-&gt;spkt_device
(braket
l_int|13
)braket
op_assign
l_int|0
suffix:semicolon
id|dev
op_assign
id|dev_get_by_name
c_func
(paren
id|saddr-&gt;spkt_device
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_goto
id|out_unlock
suffix:semicolon
multiline_comment|/*&n;&t; *&t;You may not queue a frame bigger than the mtu. This is the lowest level&n;&t; *&t;raw protocol and you must do your own fragmentation at this level.&n;&t; */
id|err
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|dev-&gt;mtu
op_plus
id|dev-&gt;hard_header_len
)paren
(brace
r_goto
id|out_unlock
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|skb
op_assign
id|sock_wmalloc
c_func
(paren
id|sk
comma
id|len
op_plus
id|dev-&gt;hard_header_len
op_plus
l_int|15
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;If the write buffer is full, then tough. At this level the user gets to&n;&t; *&t;deal with the problem - do your own algorithmic backoffs. That&squot;s far&n;&t; *&t;more flexible.&n;&t; */
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_goto
id|out_unlock
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Fill it in &n;&t; */
multiline_comment|/* FIXME: Save some space for broken drivers that write a&n;&t; * hard header at transmission time by themselves. PPP is the&n;&t; * notable one here. This should really be fixed at the driver level.&n;&t; */
id|skb_reserve
c_func
(paren
id|skb
comma
(paren
id|dev-&gt;hard_header_len
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Try to align data part correctly */
r_if
c_cond
(paren
id|dev-&gt;hard_header
)paren
(brace
id|skb-&gt;data
op_sub_assign
id|dev-&gt;hard_header_len
suffix:semicolon
id|skb-&gt;tail
op_sub_assign
id|dev-&gt;hard_header_len
suffix:semicolon
)brace
multiline_comment|/* Returns -EFAULT on error */
id|err
op_assign
id|memcpy_fromiovec
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|msg-&gt;msg_iov
comma
id|len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|proto
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;priority
op_assign
id|sk-&gt;priority
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out_free
suffix:semicolon
id|err
op_assign
op_minus
id|ENETDOWN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_goto
id|out_free
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Now send it&n;&t; */
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
id|out_free
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out_unlock
suffix:colon
r_if
c_cond
(paren
id|dev
)paren
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;   This function makes lazy skb cloning in hope that most of packets&n;   are discarded by BPF.&n;&n;   Note tricky part: we DO mangle shared skb! skb-&gt;data, skb-&gt;len&n;   and skb-&gt;cb are mangled. It works because (and until) packets&n;   falling here are owned by current CPU. Output packets are cloned&n;   by dev_queue_xmit_nit(), input packets are processed by net_bh&n;   sequencially, so that if we return skb to original state on exit,&n;   we will not harm anyone.&n; */
DECL|function|packet_rcv
r_static
r_int
id|packet_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|sockaddr_ll
op_star
id|sll
suffix:semicolon
r_struct
id|packet_opt
op_star
id|po
suffix:semicolon
id|u8
op_star
id|skb_head
op_assign
id|skb-&gt;data
suffix:semicolon
macro_line|#ifdef CONFIG_FILTER
r_int
id|snaplen
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_eq
id|PACKET_LOOPBACK
)paren
r_goto
id|drop
suffix:semicolon
id|sk
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|pt-&gt;data
suffix:semicolon
id|po
op_assign
id|sk-&gt;protinfo.af_packet
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header
)paren
(brace
multiline_comment|/* The device has an explicit notion of ll header,&n;&t;&t;   exported to higher levels.&n;&n;&t;&t;   Otherwise, the device hides datails of it frame&n;&t;&t;   structure, so that corresponding packet head&n;&t;&t;   never delivered to user.&n;&t;&t; */
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_DGRAM
)paren
id|skb_push
c_func
(paren
id|skb
comma
id|skb-&gt;data
op_minus
id|skb-&gt;mac.raw
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_eq
id|PACKET_OUTGOING
)paren
(brace
multiline_comment|/* Special case: outgoing packets have ll header at head */
id|skb_pull
c_func
(paren
id|skb
comma
id|skb-&gt;nh.raw
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_FILTER
id|snaplen
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;filter
)paren
(brace
r_int
id|res
op_assign
id|snaplen
suffix:semicolon
r_struct
id|sk_filter
op_star
id|filter
suffix:semicolon
id|bh_lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|filter
op_assign
id|sk-&gt;filter
)paren
op_ne
l_int|NULL
)paren
id|res
op_assign
id|sk_run_filter
c_func
(paren
id|skb
comma
id|sk-&gt;filter-&gt;insns
comma
id|sk-&gt;filter-&gt;len
)paren
suffix:semicolon
id|bh_unlock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_eq
l_int|0
)paren
r_goto
id|drop_n_restore
suffix:semicolon
r_if
c_cond
(paren
id|snaplen
OG
id|res
)paren
id|snaplen
op_assign
id|res
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_FILTER */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_plus
id|skb-&gt;truesize
op_ge
(paren
r_int
)paren
id|sk-&gt;rcvbuf
)paren
r_goto
id|drop_n_acct
suffix:semicolon
r_if
c_cond
(paren
id|skb_shared
c_func
(paren
id|skb
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|nskb
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nskb
op_eq
l_int|NULL
)paren
r_goto
id|drop_n_acct
suffix:semicolon
r_if
c_cond
(paren
id|skb_head
op_ne
id|skb-&gt;data
)paren
(brace
id|skb-&gt;data
op_assign
id|skb_head
suffix:semicolon
id|skb-&gt;len
op_assign
id|skb-&gt;tail
op_minus
id|skb-&gt;data
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|nskb
suffix:semicolon
)brace
id|sll
op_assign
(paren
r_struct
id|sockaddr_ll
op_star
)paren
id|skb-&gt;cb
suffix:semicolon
id|sll-&gt;sll_family
op_assign
id|AF_PACKET
suffix:semicolon
id|sll-&gt;sll_hatype
op_assign
id|dev-&gt;type
suffix:semicolon
id|sll-&gt;sll_protocol
op_assign
id|skb-&gt;protocol
suffix:semicolon
id|sll-&gt;sll_pkttype
op_assign
id|skb-&gt;pkt_type
suffix:semicolon
id|sll-&gt;sll_ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|sll-&gt;sll_halen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header_parse
)paren
id|sll-&gt;sll_halen
op_assign
id|dev
op_member_access_from_pointer
id|hard_header_parse
c_func
(paren
id|skb
comma
id|sll-&gt;sll_addr
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FILTER
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|snaplen
)paren
id|__skb_trim
c_func
(paren
id|skb
comma
id|snaplen
)paren
suffix:semicolon
macro_line|#endif
id|skb_set_owner_r
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|po-&gt;stats.tp_packets
op_increment
suffix:semicolon
id|__skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;receive_queue
comma
id|skb
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|drop_n_acct
suffix:colon
id|spin_lock
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|po-&gt;stats.tp_drops
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_FILTER
id|drop_n_restore
suffix:colon
macro_line|#endif
r_if
c_cond
(paren
id|skb_head
op_ne
id|skb-&gt;data
op_logical_and
id|skb_shared
c_func
(paren
id|skb
)paren
)paren
(brace
id|skb-&gt;data
op_assign
id|skb_head
suffix:semicolon
id|skb-&gt;len
op_assign
id|skb-&gt;tail
op_minus
id|skb-&gt;data
suffix:semicolon
)brace
id|drop
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PACKET_MMAP
DECL|function|tpacket_rcv
r_static
r_int
id|tpacket_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|packet_opt
op_star
id|po
suffix:semicolon
r_struct
id|sockaddr_ll
op_star
id|sll
suffix:semicolon
r_struct
id|tpacket_hdr
op_star
id|h
suffix:semicolon
id|u8
op_star
id|skb_head
op_assign
id|skb-&gt;data
suffix:semicolon
r_int
id|snaplen
suffix:semicolon
r_int
r_int
id|status
op_assign
id|TP_STATUS_LOSING
op_or
id|TP_STATUS_USER
suffix:semicolon
r_int
r_int
id|macoff
comma
id|netoff
suffix:semicolon
r_struct
id|sk_buff
op_star
id|copy_skb
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_eq
id|PACKET_LOOPBACK
)paren
r_goto
id|drop
suffix:semicolon
id|sk
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|pt-&gt;data
suffix:semicolon
id|po
op_assign
id|sk-&gt;protinfo.af_packet
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_DGRAM
)paren
id|skb_push
c_func
(paren
id|skb
comma
id|skb-&gt;data
op_minus
id|skb-&gt;mac.raw
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_eq
id|PACKET_OUTGOING
)paren
(brace
multiline_comment|/* Special case: outgoing packets have ll header at head */
id|skb_pull
c_func
(paren
id|skb
comma
id|skb-&gt;nh.raw
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
)brace
)brace
id|snaplen
op_assign
id|skb-&gt;len
suffix:semicolon
macro_line|#ifdef CONFIG_FILTER
r_if
c_cond
(paren
id|sk-&gt;filter
)paren
(brace
r_int
id|res
op_assign
id|snaplen
suffix:semicolon
r_struct
id|sk_filter
op_star
id|filter
suffix:semicolon
id|bh_lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|filter
op_assign
id|sk-&gt;filter
)paren
op_ne
l_int|NULL
)paren
id|res
op_assign
id|sk_run_filter
c_func
(paren
id|skb
comma
id|sk-&gt;filter-&gt;insns
comma
id|sk-&gt;filter-&gt;len
)paren
suffix:semicolon
id|bh_unlock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_eq
l_int|0
)paren
r_goto
id|drop_n_restore
suffix:semicolon
r_if
c_cond
(paren
id|snaplen
OG
id|res
)paren
id|snaplen
op_assign
id|res
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_DGRAM
)paren
(brace
id|macoff
op_assign
id|netoff
op_assign
id|TPACKET_ALIGN
c_func
(paren
id|TPACKET_HDRLEN
)paren
op_plus
l_int|16
suffix:semicolon
)brace
r_else
(brace
r_int
id|maclen
op_assign
id|skb-&gt;nh.raw
op_minus
id|skb-&gt;data
suffix:semicolon
id|netoff
op_assign
id|TPACKET_ALIGN
c_func
(paren
id|TPACKET_HDRLEN
op_plus
(paren
id|maclen
OL
l_int|16
ques
c_cond
l_int|16
suffix:colon
id|maclen
)paren
)paren
suffix:semicolon
id|macoff
op_assign
id|netoff
op_minus
id|maclen
suffix:semicolon
)brace
r_if
c_cond
(paren
id|macoff
op_plus
id|snaplen
OG
id|po-&gt;frame_size
)paren
(brace
r_if
c_cond
(paren
id|po-&gt;copy_thresh
op_logical_and
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_plus
id|skb-&gt;truesize
OL
(paren
r_int
)paren
id|sk-&gt;rcvbuf
)paren
(brace
r_if
c_cond
(paren
id|skb_shared
c_func
(paren
id|skb
)paren
)paren
(brace
id|copy_skb
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
r_else
(brace
id|copy_skb
op_assign
id|skb_get
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb_head
op_assign
id|skb-&gt;data
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_skb
)paren
id|skb_set_owner_r
c_func
(paren
id|copy_skb
comma
id|sk
)paren
suffix:semicolon
)brace
id|snaplen
op_assign
id|po-&gt;frame_size
op_minus
id|macoff
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
id|snaplen
OL
l_int|0
)paren
id|snaplen
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|h
op_assign
id|po-&gt;iovec
(braket
id|po-&gt;head
)braket
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;tp_status
)paren
r_goto
id|ring_is_full
suffix:semicolon
id|po-&gt;head
op_assign
id|po-&gt;head
op_ne
id|po-&gt;iovmax
ques
c_cond
id|po-&gt;head
op_plus
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|po-&gt;stats.tp_packets
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|copy_skb
)paren
(brace
id|status
op_or_assign
id|TP_STATUS_COPY
suffix:semicolon
id|__skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;receive_queue
comma
id|copy_skb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|po-&gt;stats.tp_drops
)paren
id|status
op_and_assign
op_complement
id|TP_STATUS_LOSING
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
id|u8
op_star
)paren
id|h
op_plus
id|macoff
comma
id|skb-&gt;data
comma
id|snaplen
)paren
suffix:semicolon
id|h-&gt;tp_len
op_assign
id|skb-&gt;len
suffix:semicolon
id|h-&gt;tp_snaplen
op_assign
id|snaplen
suffix:semicolon
id|h-&gt;tp_mac
op_assign
id|macoff
suffix:semicolon
id|h-&gt;tp_net
op_assign
id|netoff
suffix:semicolon
id|h-&gt;tp_sec
op_assign
id|skb-&gt;stamp.tv_sec
suffix:semicolon
id|h-&gt;tp_usec
op_assign
id|skb-&gt;stamp.tv_usec
suffix:semicolon
id|sll
op_assign
(paren
r_struct
id|sockaddr_ll
op_star
)paren
(paren
(paren
id|u8
op_star
)paren
id|h
op_plus
id|TPACKET_ALIGN
c_func
(paren
r_sizeof
(paren
op_star
id|h
)paren
)paren
)paren
suffix:semicolon
id|sll-&gt;sll_halen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header_parse
)paren
id|sll-&gt;sll_halen
op_assign
id|dev
op_member_access_from_pointer
id|hard_header_parse
c_func
(paren
id|skb
comma
id|sll-&gt;sll_addr
)paren
suffix:semicolon
id|sll-&gt;sll_family
op_assign
id|AF_PACKET
suffix:semicolon
id|sll-&gt;sll_hatype
op_assign
id|dev-&gt;type
suffix:semicolon
id|sll-&gt;sll_protocol
op_assign
id|skb-&gt;protocol
suffix:semicolon
id|sll-&gt;sll_pkttype
op_assign
id|skb-&gt;pkt_type
suffix:semicolon
id|sll-&gt;sll_ifindex
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|h-&gt;tp_status
op_assign
id|status
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
l_int|0
)paren
suffix:semicolon
id|drop_n_restore
suffix:colon
r_if
c_cond
(paren
id|skb_head
op_ne
id|skb-&gt;data
op_logical_and
id|skb_shared
c_func
(paren
id|skb
)paren
)paren
(brace
id|skb-&gt;data
op_assign
id|skb_head
suffix:semicolon
id|skb-&gt;len
op_assign
id|skb-&gt;tail
op_minus
id|skb-&gt;data
suffix:semicolon
)brace
id|drop
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|ring_is_full
suffix:colon
id|po-&gt;stats.tp_drops
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_skb
)paren
id|kfree_skb
c_func
(paren
id|copy_skb
)paren
suffix:semicolon
r_goto
id|drop_n_restore
suffix:semicolon
)brace
macro_line|#endif
DECL|function|packet_sendmsg
r_static
r_int
id|packet_sendmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_ll
op_star
id|saddr
op_assign
(paren
r_struct
id|sockaddr_ll
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
r_int
id|proto
suffix:semicolon
r_int
r_char
op_star
id|addr
suffix:semicolon
r_int
id|ifindex
comma
id|err
comma
id|reserve
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Get and verify the address. &n;&t; */
r_if
c_cond
(paren
id|saddr
op_eq
l_int|NULL
)paren
(brace
id|ifindex
op_assign
id|sk-&gt;protinfo.af_packet-&gt;ifindex
suffix:semicolon
id|proto
op_assign
id|sk-&gt;num
suffix:semicolon
id|addr
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_namelen
OL
r_sizeof
(paren
r_struct
id|sockaddr_ll
)paren
)paren
r_goto
id|out
suffix:semicolon
id|ifindex
op_assign
id|saddr-&gt;sll_ifindex
suffix:semicolon
id|proto
op_assign
id|saddr-&gt;sll_protocol
suffix:semicolon
id|addr
op_assign
id|saddr-&gt;sll_addr
suffix:semicolon
)brace
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|ifindex
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_goto
id|out_unlock
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_RAW
)paren
id|reserve
op_assign
id|dev-&gt;hard_header_len
suffix:semicolon
id|err
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|dev-&gt;mtu
op_plus
id|reserve
)paren
r_goto
id|out_unlock
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|len
op_plus
id|dev-&gt;hard_header_len
op_plus
l_int|15
comma
l_int|0
comma
id|msg-&gt;msg_flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_goto
id|out_unlock
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
(paren
id|dev-&gt;hard_header_len
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header
)paren
(brace
r_int
id|res
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|res
op_assign
id|dev
op_member_access_from_pointer
id|hard_header
c_func
(paren
id|skb
comma
id|dev
comma
id|ntohs
c_func
(paren
id|proto
)paren
comma
id|addr
comma
l_int|NULL
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_ne
id|SOCK_DGRAM
)paren
(brace
id|skb-&gt;tail
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
r_goto
id|out_free
suffix:semicolon
)brace
multiline_comment|/* Returns -EFAULT on error */
id|err
op_assign
id|memcpy_fromiovec
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|msg-&gt;msg_iov
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out_free
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|proto
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;priority
op_assign
id|sk-&gt;priority
suffix:semicolon
id|err
op_assign
op_minus
id|ENETDOWN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
r_goto
id|out_free
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Now send it&n;&t; */
id|err
op_assign
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OG
l_int|0
op_logical_and
(paren
id|err
op_assign
id|net_xmit_errno
c_func
(paren
id|err
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out_unlock
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
id|out_free
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out_unlock
suffix:colon
r_if
c_cond
(paren
id|dev
)paren
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Close a PACKET socket. This is fairly simple. We immediately go&n; *&t;to &squot;closed&squot; state and remove our protocol entry in the device list.&n; */
DECL|function|packet_release
r_static
r_int
id|packet_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sock
op_star
op_star
id|skp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_return
l_int|0
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|packet_sklist_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|skp
op_assign
op_amp
id|packet_sklist
suffix:semicolon
op_star
id|skp
suffix:semicolon
id|skp
op_assign
op_amp
(paren
op_star
id|skp
)paren
op_member_access_from_pointer
id|next
)paren
(brace
r_if
c_cond
(paren
op_star
id|skp
op_eq
id|sk
)paren
(brace
op_star
id|skp
op_assign
id|sk-&gt;next
suffix:semicolon
id|__sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|packet_sklist_lock
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Unhook packet receive handler.&n;&t; */
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_packet-&gt;running
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;Remove the protocol hook&n;&t;&t; */
id|dev_remove_pack
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;prot_hook
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;running
op_assign
l_int|0
suffix:semicolon
id|__sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PACKET_MULTICAST
id|packet_flush_mclist
c_func
(paren
id|sk
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PACKET_MMAP
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_packet-&gt;pg_vec
)paren
(brace
r_struct
id|tpacket_req
id|req
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|req
comma
l_int|0
comma
r_sizeof
(paren
id|req
)paren
)paren
suffix:semicolon
id|packet_set_ring
c_func
(paren
id|sk
comma
op_amp
id|req
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;&t; *&t;Now the socket is dead. No more input will appear.&n;&t; */
id|sock_orphan
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Purge queues */
id|skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Attach a packet hook.&n; */
DECL|function|packet_do_bind
r_static
r_int
id|packet_do_bind
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|protocol
)paren
(brace
multiline_comment|/*&n;&t; *&t;Detach an existing hook if present.&n;&t; */
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;bind_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_packet-&gt;running
)paren
(brace
id|dev_remove_pack
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;prot_hook
)paren
suffix:semicolon
id|__sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;running
op_assign
l_int|0
suffix:semicolon
)brace
id|sk-&gt;num
op_assign
id|protocol
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;prot_hook.type
op_assign
id|protocol
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;prot_hook.dev
op_assign
id|dev
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;ifindex
op_assign
id|dev
ques
c_cond
id|dev-&gt;ifindex
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|protocol
op_eq
l_int|0
)paren
r_goto
id|out_unlock
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
(brace
id|dev_add_pack
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;prot_hook
)paren
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;running
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|sk-&gt;err
op_assign
id|ENETDOWN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
id|sk
op_member_access_from_pointer
id|error_report
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|dev_add_pack
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;prot_hook
)paren
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;running
op_assign
l_int|1
suffix:semicolon
)brace
id|out_unlock
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;bind_lock
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Bind a packet socket to a device&n; */
macro_line|#ifdef CONFIG_SOCK_PACKET
DECL|function|packet_bind_spkt
r_static
r_int
id|packet_bind_spkt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_char
id|name
(braket
l_int|15
)braket
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Check legality&n;&t; */
r_if
c_cond
(paren
id|addr_len
op_ne
r_sizeof
(paren
r_struct
id|sockaddr
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|strncpy
c_func
(paren
id|name
comma
id|uaddr-&gt;sa_data
comma
l_int|14
)paren
suffix:semicolon
id|name
(braket
l_int|14
)braket
op_assign
l_int|0
suffix:semicolon
id|dev
op_assign
id|dev_get_by_name
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|err
op_assign
id|packet_do_bind
c_func
(paren
id|sk
comma
id|dev
comma
id|sk-&gt;num
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
DECL|function|packet_bind
r_static
r_int
id|packet_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sockaddr_ll
op_star
id|sll
op_assign
(paren
r_struct
id|sockaddr_ll
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Check legality&n;&t; */
r_if
c_cond
(paren
id|addr_len
OL
r_sizeof
(paren
r_struct
id|sockaddr_ll
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sll-&gt;sll_family
op_ne
id|AF_PACKET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sll-&gt;sll_ifindex
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|sll-&gt;sll_ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|packet_do_bind
c_func
(paren
id|sk
comma
id|dev
comma
id|sll-&gt;sll_protocol
ques
c_cond
suffix:colon
id|sk-&gt;num
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Create a packet of type SOCK_PACKET. &n; */
DECL|function|packet_create
r_static
r_int
id|packet_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_RAW
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_ne
id|SOCK_DGRAM
op_logical_and
id|sock-&gt;type
op_ne
id|SOCK_RAW
macro_line|#ifdef CONFIG_SOCK_PACKET
op_logical_and
id|sock-&gt;type
op_ne
id|SOCK_PACKET
macro_line|#endif
)paren
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|PF_PACKET
comma
id|GFP_KERNEL
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|packet_ops
suffix:semicolon
macro_line|#ifdef CONFIG_SOCK_PACKET
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_PACKET
)paren
id|sock-&gt;ops
op_assign
op_amp
id|packet_ops_spkt
suffix:semicolon
macro_line|#endif
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_packet
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|packet_opt
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_packet
op_eq
l_int|NULL
)paren
r_goto
id|out_free
suffix:semicolon
id|memset
c_func
(paren
id|sk-&gt;protinfo.af_packet
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|packet_opt
)paren
)paren
suffix:semicolon
id|sk-&gt;family
op_assign
id|PF_PACKET
suffix:semicolon
id|sk-&gt;num
op_assign
id|protocol
suffix:semicolon
id|sk-&gt;destruct
op_assign
id|packet_sock_destruct
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|packet_socks_nr
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Attach a protocol block&n;&t; */
id|spin_lock_init
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;bind_lock
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;prot_hook.func
op_assign
id|packet_rcv
suffix:semicolon
macro_line|#ifdef CONFIG_SOCK_PACKET
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_PACKET
)paren
id|sk-&gt;protinfo.af_packet-&gt;prot_hook.func
op_assign
id|packet_rcv_spkt
suffix:semicolon
macro_line|#endif
id|sk-&gt;protinfo.af_packet-&gt;prot_hook.data
op_assign
(paren
r_void
op_star
)paren
id|sk
suffix:semicolon
r_if
c_cond
(paren
id|protocol
)paren
(brace
id|sk-&gt;protinfo.af_packet-&gt;prot_hook.type
op_assign
id|protocol
suffix:semicolon
id|dev_add_pack
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;prot_hook
)paren
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;running
op_assign
l_int|1
suffix:semicolon
)brace
id|write_lock_bh
c_func
(paren
op_amp
id|packet_sklist_lock
)paren
suffix:semicolon
id|sk-&gt;next
op_assign
id|packet_sklist
suffix:semicolon
id|packet_sklist
op_assign
id|sk
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|packet_sklist_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_free
suffix:colon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Pull a packet from our receive queue and hand it to the user.&n; *&t;If necessary we block.&n; */
DECL|function|packet_recvmsg
r_static
r_int
id|packet_recvmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_int
id|flags
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|copied
comma
id|err
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
op_complement
(paren
id|MSG_PEEK
op_or
id|MSG_DONTWAIT
op_or
id|MSG_TRUNC
)paren
)paren
r_goto
id|out
suffix:semicolon
macro_line|#if 0
multiline_comment|/* What error should we return now? EUNATTACH? */
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_packet-&gt;ifindex
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *&t;If the address length field is there to be filled in, we fill&n;&t; *&t;it in now.&n;&t; */
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_PACKET
)paren
id|msg-&gt;msg_namelen
op_assign
r_sizeof
(paren
r_struct
id|sockaddr_pkt
)paren
suffix:semicolon
r_else
id|msg-&gt;msg_namelen
op_assign
r_sizeof
(paren
r_struct
id|sockaddr_ll
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Call the generic datagram receiver. This handles all sorts&n;&t; *&t;of horrible races and re-entrancy so we can forget about it&n;&t; *&t;in the protocol layers.&n;&t; *&n;&t; *&t;Now it will return ENETDOWN, if device have just gone down,&n;&t; *&t;but then it will block.&n;&t; */
id|skb
op_assign
id|skb_recv_datagram
c_func
(paren
id|sk
comma
id|flags
comma
id|flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|err
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;An error occurred so return it. Because skb_recv_datagram() &n;&t; *&t;handles the blocking we don&squot;t see and worry about blocking&n;&t; *&t;retries.&n;&t; */
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;You lose any data beyond the buffer you gave. If it worries a&n;&t; *&t;user program they can ask the device for its MTU anyway.&n;&t; */
id|copied
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|copied
OG
id|len
)paren
(brace
id|copied
op_assign
id|len
suffix:semicolon
id|msg-&gt;msg_flags
op_or_assign
id|MSG_TRUNC
suffix:semicolon
)brace
multiline_comment|/* We can&squot;t use skb_copy_datagram here */
id|err
op_assign
id|memcpy_toiovec
c_func
(paren
id|msg-&gt;msg_iov
comma
id|skb-&gt;data
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out_free
suffix:semicolon
id|sock_recv_timestamp
c_func
(paren
id|msg
comma
id|sk
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_name
)paren
id|memcpy
c_func
(paren
id|msg-&gt;msg_name
comma
id|skb-&gt;cb
comma
id|msg-&gt;msg_namelen
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Free or return the buffer as appropriate. Again this&n;&t; *&t;hides all the races and re-entrancy issues from us.&n;&t; */
id|err
op_assign
(paren
id|flags
op_amp
id|MSG_TRUNC
)paren
ques
c_cond
id|skb-&gt;len
suffix:colon
id|copied
suffix:semicolon
id|out_free
suffix:colon
id|skb_free_datagram
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SOCK_PACKET
DECL|function|packet_getname_spkt
r_static
r_int
id|packet_getname_spkt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddr_len
comma
r_int
id|peer
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|uaddr-&gt;sa_family
op_assign
id|AF_PACKET
suffix:semicolon
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|sk-&gt;protinfo.af_packet-&gt;ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|strncpy
c_func
(paren
id|uaddr-&gt;sa_data
comma
id|dev-&gt;name
comma
l_int|15
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
id|memset
c_func
(paren
id|uaddr-&gt;sa_data
comma
l_int|0
comma
l_int|14
)paren
suffix:semicolon
op_star
id|uaddr_len
op_assign
r_sizeof
(paren
op_star
id|uaddr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|packet_getname
r_static
r_int
id|packet_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddr_len
comma
r_int
id|peer
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_ll
op_star
id|sll
op_assign
(paren
r_struct
id|sockaddr_ll
op_star
)paren
id|uaddr
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|sll-&gt;sll_family
op_assign
id|AF_PACKET
suffix:semicolon
id|sll-&gt;sll_ifindex
op_assign
id|sk-&gt;protinfo.af_packet-&gt;ifindex
suffix:semicolon
id|sll-&gt;sll_protocol
op_assign
id|sk-&gt;num
suffix:semicolon
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|sk-&gt;protinfo.af_packet-&gt;ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|sll-&gt;sll_hatype
op_assign
id|dev-&gt;type
suffix:semicolon
id|sll-&gt;sll_halen
op_assign
id|dev-&gt;addr_len
suffix:semicolon
id|memcpy
c_func
(paren
id|sll-&gt;sll_addr
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|sll-&gt;sll_hatype
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Bad: we have no ARPHRD_UNSPEC */
id|sll-&gt;sll_halen
op_assign
l_int|0
suffix:semicolon
)brace
op_star
id|uaddr_len
op_assign
r_sizeof
(paren
op_star
id|sll
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PACKET_MULTICAST
DECL|function|packet_dev_mc
r_static
r_void
id|packet_dev_mc
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_mclist
op_star
id|i
comma
r_int
id|what
)paren
(brace
r_switch
c_cond
(paren
id|i-&gt;type
)paren
(brace
r_case
id|PACKET_MR_MULTICAST
suffix:colon
r_if
c_cond
(paren
id|what
OG
l_int|0
)paren
id|dev_mc_add
c_func
(paren
id|dev
comma
id|i-&gt;addr
comma
id|i-&gt;alen
comma
l_int|0
)paren
suffix:semicolon
r_else
id|dev_mc_delete
c_func
(paren
id|dev
comma
id|i-&gt;addr
comma
id|i-&gt;alen
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PACKET_MR_PROMISC
suffix:colon
id|dev_set_promiscuity
c_func
(paren
id|dev
comma
id|what
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PACKET_MR_ALLMULTI
suffix:colon
id|dev_set_allmulti
c_func
(paren
id|dev
comma
id|what
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
suffix:semicolon
)brace
)brace
DECL|function|packet_dev_mclist
r_static
r_void
id|packet_dev_mclist
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_mclist
op_star
id|i
comma
r_int
id|what
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|i
suffix:semicolon
id|i
op_assign
id|i-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|i-&gt;ifindex
op_eq
id|dev-&gt;ifindex
)paren
id|packet_dev_mc
c_func
(paren
id|dev
comma
id|i
comma
id|what
)paren
suffix:semicolon
)brace
)brace
DECL|function|packet_mc_add
r_static
r_int
id|packet_mc_add
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|packet_mreq
op_star
id|mreq
)paren
(brace
r_struct
id|packet_mclist
op_star
id|ml
comma
op_star
id|i
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|err
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|dev
op_assign
id|__dev_get_by_index
c_func
(paren
id|mreq-&gt;mr_ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|done
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|mreq-&gt;mr_alen
OG
id|dev-&gt;addr_len
)paren
r_goto
id|done
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|i
op_assign
(paren
r_struct
id|packet_mclist
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|i
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|NULL
)paren
r_goto
id|done
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|ml
op_assign
id|sk-&gt;protinfo.af_packet-&gt;mclist
suffix:semicolon
id|ml
suffix:semicolon
id|ml
op_assign
id|ml-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ml-&gt;ifindex
op_eq
id|mreq-&gt;mr_ifindex
op_logical_and
id|ml-&gt;type
op_eq
id|mreq-&gt;mr_type
op_logical_and
id|ml-&gt;alen
op_eq
id|mreq-&gt;mr_alen
op_logical_and
id|memcmp
c_func
(paren
id|ml-&gt;addr
comma
id|mreq-&gt;mr_address
comma
id|ml-&gt;alen
)paren
op_eq
l_int|0
)paren
(brace
id|ml-&gt;count
op_increment
suffix:semicolon
multiline_comment|/* Free the new element ... */
id|kfree
c_func
(paren
id|i
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
)brace
id|i-&gt;type
op_assign
id|mreq-&gt;mr_type
suffix:semicolon
id|i-&gt;ifindex
op_assign
id|mreq-&gt;mr_ifindex
suffix:semicolon
id|i-&gt;alen
op_assign
id|mreq-&gt;mr_alen
suffix:semicolon
id|memcpy
c_func
(paren
id|i-&gt;addr
comma
id|mreq-&gt;mr_address
comma
id|i-&gt;alen
)paren
suffix:semicolon
id|i-&gt;count
op_assign
l_int|1
suffix:semicolon
id|i-&gt;next
op_assign
id|sk-&gt;protinfo.af_packet-&gt;mclist
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;mclist
op_assign
id|i
suffix:semicolon
id|packet_dev_mc
c_func
(paren
id|dev
comma
id|i
comma
op_plus
l_int|1
)paren
suffix:semicolon
id|done
suffix:colon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|packet_mc_drop
r_static
r_int
id|packet_mc_drop
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|packet_mreq
op_star
id|mreq
)paren
(brace
r_struct
id|packet_mclist
op_star
id|ml
comma
op_star
op_star
id|mlp
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|mlp
op_assign
op_amp
id|sk-&gt;protinfo.af_packet-&gt;mclist
suffix:semicolon
(paren
id|ml
op_assign
op_star
id|mlp
)paren
op_ne
l_int|NULL
suffix:semicolon
id|mlp
op_assign
op_amp
id|ml-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ml-&gt;ifindex
op_eq
id|mreq-&gt;mr_ifindex
op_logical_and
id|ml-&gt;type
op_eq
id|mreq-&gt;mr_type
op_logical_and
id|ml-&gt;alen
op_eq
id|mreq-&gt;mr_alen
op_logical_and
id|memcmp
c_func
(paren
id|ml-&gt;addr
comma
id|mreq-&gt;mr_address
comma
id|ml-&gt;alen
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|ml-&gt;count
op_eq
l_int|0
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
op_star
id|mlp
op_assign
id|ml-&gt;next
suffix:semicolon
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|ml-&gt;ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|packet_dev_mc
c_func
(paren
id|dev
comma
id|ml
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|ml
)paren
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
DECL|function|packet_flush_mclist
r_static
r_void
id|packet_flush_mclist
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|packet_mclist
op_star
id|ml
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_packet-&gt;mclist
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ml
op_assign
id|sk-&gt;protinfo.af_packet-&gt;mclist
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;mclist
op_assign
id|ml-&gt;next
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|dev_get_by_index
c_func
(paren
id|ml-&gt;ifindex
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|packet_dev_mc
c_func
(paren
id|dev
comma
id|ml
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|ml
)paren
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_static
r_int
DECL|function|packet_setsockopt
id|packet_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|level
op_ne
id|SOL_PACKET
)paren
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
macro_line|#ifdef CONFIG_PACKET_MULTICAST
r_case
id|PACKET_ADD_MEMBERSHIP
suffix:colon
r_case
id|PACKET_DROP_MEMBERSHIP
suffix:colon
(brace
r_struct
id|packet_mreq
id|mreq
suffix:semicolon
r_if
c_cond
(paren
id|optlen
OL
r_sizeof
(paren
id|mreq
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|mreq
comma
id|optval
comma
r_sizeof
(paren
id|mreq
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|optname
op_eq
id|PACKET_ADD_MEMBERSHIP
)paren
id|ret
op_assign
id|packet_mc_add
c_func
(paren
id|sk
comma
op_amp
id|mreq
)paren
suffix:semicolon
r_else
id|ret
op_assign
id|packet_mc_drop
c_func
(paren
id|sk
comma
op_amp
id|mreq
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_PACKET_MMAP
r_case
id|PACKET_RX_RING
suffix:colon
(brace
r_struct
id|tpacket_req
id|req
suffix:semicolon
r_if
c_cond
(paren
id|optlen
OL
r_sizeof
(paren
id|req
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|req
comma
id|optval
comma
r_sizeof
(paren
id|req
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|packet_set_ring
c_func
(paren
id|sk
comma
op_amp
id|req
comma
l_int|0
)paren
suffix:semicolon
)brace
r_case
id|PACKET_COPY_THRESH
suffix:colon
(brace
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
id|val
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|val
comma
id|optval
comma
r_sizeof
(paren
id|val
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|sk-&gt;protinfo.af_packet-&gt;copy_thresh
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
)brace
DECL|function|packet_getsockopt
r_int
id|packet_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
r_int
id|len
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|level
op_ne
id|SOL_PACKET
)paren
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|len
comma
id|optlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|PACKET_STATISTICS
suffix:colon
(brace
r_struct
id|tpacket_stats
id|st
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
r_sizeof
(paren
r_struct
id|tpacket_stats
)paren
)paren
id|len
op_assign
r_sizeof
(paren
r_struct
id|tpacket_stats
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|st
op_assign
id|sk-&gt;protinfo.af_packet-&gt;stats
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;stats
comma
l_int|0
comma
r_sizeof
(paren
id|st
)paren
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|st.tp_packets
op_add_assign
id|st.tp_drops
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|optval
comma
op_amp
id|st
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|len
comma
id|optlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|packet_notifier
r_static
r_int
id|packet_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|msg
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|packet_opt
op_star
id|po
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|packet_sklist_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|sk
op_assign
id|packet_sklist
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
(brace
id|po
op_assign
id|sk-&gt;protinfo.af_packet
suffix:semicolon
r_switch
c_cond
(paren
id|msg
)paren
(brace
r_case
id|NETDEV_DOWN
suffix:colon
r_case
id|NETDEV_UNREGISTER
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;ifindex
op_eq
id|po-&gt;ifindex
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|po-&gt;bind_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|po-&gt;running
)paren
(brace
id|dev_remove_pack
c_func
(paren
op_amp
id|po-&gt;prot_hook
)paren
suffix:semicolon
id|__sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|po-&gt;running
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;err
op_assign
id|ENETDOWN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
id|sk
op_member_access_from_pointer
id|error_report
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg
op_eq
id|NETDEV_UNREGISTER
)paren
(brace
id|po-&gt;ifindex
op_assign
op_minus
l_int|1
suffix:semicolon
id|po-&gt;prot_hook.dev
op_assign
l_int|NULL
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|po-&gt;bind_lock
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PACKET_MULTICAST
r_if
c_cond
(paren
id|po-&gt;mclist
)paren
id|packet_dev_mclist
c_func
(paren
id|dev
comma
id|po-&gt;mclist
comma
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|NETDEV_UP
suffix:colon
id|spin_lock
c_func
(paren
op_amp
id|po-&gt;bind_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;ifindex
op_eq
id|po-&gt;ifindex
op_logical_and
id|sk-&gt;num
op_logical_and
id|po-&gt;running
op_eq
l_int|0
)paren
(brace
id|dev_add_pack
c_func
(paren
op_amp
id|po-&gt;prot_hook
)paren
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|po-&gt;running
op_assign
l_int|1
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|po-&gt;bind_lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PACKET_MULTICAST
r_if
c_cond
(paren
id|po-&gt;mclist
)paren
id|packet_dev_mclist
c_func
(paren
id|dev
comma
id|po-&gt;mclist
comma
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|packet_sklist_lock
)paren
suffix:semicolon
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|function|packet_ioctl
r_static
r_int
id|packet_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|pid
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCOUTQ
suffix:colon
(brace
r_int
id|amount
op_assign
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|amount
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_case
id|SIOCINQ
suffix:colon
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|amount
op_assign
l_int|0
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|amount
op_assign
id|skb-&gt;len
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|amount
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_case
id|FIOSETOWN
suffix:colon
r_case
id|SIOCSPGRP
suffix:colon
id|err
op_assign
id|get_user
c_func
(paren
id|pid
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;pid
op_ne
id|pid
op_logical_and
id|current-&gt;pgrp
op_ne
op_minus
id|pid
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sk-&gt;proc
op_assign
id|pid
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FIOGETOWN
suffix:colon
r_case
id|SIOCGPGRP
suffix:colon
r_return
id|put_user
c_func
(paren
id|sk-&gt;proc
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCGSTAMP
suffix:colon
r_if
c_cond
(paren
id|sk-&gt;stamp.tv_sec
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|sk-&gt;stamp
comma
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
)paren
id|err
op_assign
l_int|0
suffix:semicolon
r_return
id|err
suffix:semicolon
r_case
id|SIOCGIFFLAGS
suffix:colon
macro_line|#ifndef CONFIG_INET
r_case
id|SIOCSIFFLAGS
suffix:colon
macro_line|#endif
r_case
id|SIOCGIFCONF
suffix:colon
r_case
id|SIOCGIFMETRIC
suffix:colon
r_case
id|SIOCSIFMETRIC
suffix:colon
r_case
id|SIOCGIFMEM
suffix:colon
r_case
id|SIOCSIFMEM
suffix:colon
r_case
id|SIOCGIFMTU
suffix:colon
r_case
id|SIOCSIFMTU
suffix:colon
r_case
id|SIOCSIFLINK
suffix:colon
r_case
id|SIOCGIFHWADDR
suffix:colon
r_case
id|SIOCSIFHWADDR
suffix:colon
r_case
id|SIOCSIFMAP
suffix:colon
r_case
id|SIOCGIFMAP
suffix:colon
r_case
id|SIOCSIFSLAVE
suffix:colon
r_case
id|SIOCGIFSLAVE
suffix:colon
r_case
id|SIOCGIFINDEX
suffix:colon
r_case
id|SIOCGIFNAME
suffix:colon
r_case
id|SIOCGIFCOUNT
suffix:colon
r_case
id|SIOCSIFHWBROADCAST
suffix:colon
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCGIFBR
suffix:colon
r_case
id|SIOCSIFBR
suffix:colon
macro_line|#if defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE)
macro_line|#ifdef CONFIG_INET
macro_line|#ifdef CONFIG_KMOD
r_if
c_cond
(paren
id|br_ioctl_hook
op_eq
l_int|NULL
)paren
id|request_module
c_func
(paren
l_string|&quot;bridge&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|br_ioctl_hook
op_ne
l_int|NULL
)paren
r_return
id|br_ioctl_hook
c_func
(paren
id|arg
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif&t;&t;&t;&t;
r_case
id|SIOCGIFDIVERT
suffix:colon
r_case
id|SIOCSIFDIVERT
suffix:colon
macro_line|#ifdef CONFIG_NET_DIVERT
r_return
id|divert_ioctl
c_func
(paren
id|cmd
comma
(paren
r_struct
id|divert_cf
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#else
r_return
op_minus
id|ENOPKG
suffix:semicolon
macro_line|#endif /* CONFIG_NET_DIVERT */
r_return
op_minus
id|ENOPKG
suffix:semicolon
macro_line|#ifdef CONFIG_INET
r_case
id|SIOCADDRT
suffix:colon
r_case
id|SIOCDELRT
suffix:colon
r_case
id|SIOCDARP
suffix:colon
r_case
id|SIOCGARP
suffix:colon
r_case
id|SIOCSARP
suffix:colon
r_case
id|SIOCGIFADDR
suffix:colon
r_case
id|SIOCSIFADDR
suffix:colon
r_case
id|SIOCGIFBRDADDR
suffix:colon
r_case
id|SIOCSIFBRDADDR
suffix:colon
r_case
id|SIOCGIFNETMASK
suffix:colon
r_case
id|SIOCSIFNETMASK
suffix:colon
r_case
id|SIOCGIFDSTADDR
suffix:colon
r_case
id|SIOCSIFDSTADDR
suffix:colon
r_case
id|SIOCSIFFLAGS
suffix:colon
r_case
id|SIOCADDDLCI
suffix:colon
r_case
id|SIOCDELDLCI
suffix:colon
r_return
id|inet_dgram_ops
dot
id|ioctl
c_func
(paren
id|sock
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|cmd
op_ge
id|SIOCDEVPRIVATE
)paren
op_logical_and
(paren
id|cmd
op_le
(paren
id|SIOCDEVPRIVATE
op_plus
l_int|15
)paren
)paren
)paren
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NET_RADIO
r_if
c_cond
(paren
(paren
id|cmd
op_ge
id|SIOCIWFIRST
)paren
op_logical_and
(paren
id|cmd
op_le
id|SIOCIWLAST
)paren
)paren
(brace
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/*NOTREACHED*/
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifndef CONFIG_PACKET_MMAP
DECL|macro|packet_mmap
mdefine_line|#define packet_mmap sock_no_mmap
DECL|macro|packet_poll
mdefine_line|#define packet_poll datagram_poll
macro_line|#else
DECL|function|packet_poll
r_int
r_int
id|packet_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|socket
op_star
id|sock
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|packet_opt
op_star
id|po
op_assign
id|sk-&gt;protinfo.af_packet
suffix:semicolon
r_int
r_int
id|mask
op_assign
id|datagram_poll
c_func
(paren
id|file
comma
id|sock
comma
id|wait
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|po-&gt;iovec
)paren
(brace
r_int
id|last
op_assign
id|po-&gt;head
ques
c_cond
id|po-&gt;head
op_minus
l_int|1
suffix:colon
id|po-&gt;iovmax
suffix:semicolon
r_if
c_cond
(paren
id|po-&gt;iovec
(braket
id|last
)braket
op_member_access_from_pointer
id|tp_status
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
multiline_comment|/* Dirty? Well, I still did not learn better way to account&n; * for user mmaps.&n; */
DECL|function|packet_mm_open
r_static
r_void
id|packet_mm_open
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|file
op_star
id|file
op_assign
id|vma-&gt;vm_file
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_struct
id|socket
op_star
id|sock
op_assign
op_amp
id|inode-&gt;u.socket_i
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
id|atomic_inc
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;mapped
)paren
suffix:semicolon
)brace
DECL|function|packet_mm_close
r_static
r_void
id|packet_mm_close
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|file
op_star
id|file
op_assign
id|vma-&gt;vm_file
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_struct
id|socket
op_star
id|sock
op_assign
op_amp
id|inode-&gt;u.socket_i
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
id|atomic_dec
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_packet-&gt;mapped
)paren
suffix:semicolon
)brace
DECL|variable|packet_mmap_ops
r_static
r_struct
id|vm_operations_struct
id|packet_mmap_ops
op_assign
(brace
id|open
suffix:colon
id|packet_mm_open
comma
id|close
suffix:colon
id|packet_mm_close
comma
)brace
suffix:semicolon
DECL|function|free_pg_vec
r_static
r_void
id|free_pg_vec
c_func
(paren
r_int
r_int
op_star
id|pg_vec
comma
r_int
id|order
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pg_vec
(braket
id|i
)braket
)paren
(brace
r_struct
id|page
op_star
id|page
comma
op_star
id|pend
suffix:semicolon
id|pend
op_assign
id|virt_to_page
c_func
(paren
id|pg_vec
(braket
id|i
)braket
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|order
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|page
op_assign
id|virt_to_page
c_func
(paren
id|pg_vec
(braket
id|i
)braket
)paren
suffix:semicolon
id|page
op_le
id|pend
suffix:semicolon
id|page
op_increment
)paren
id|ClearPageReserved
c_func
(paren
id|page
)paren
suffix:semicolon
id|free_pages
c_func
(paren
id|pg_vec
(braket
id|i
)braket
comma
id|order
)paren
suffix:semicolon
)brace
)brace
id|kfree
c_func
(paren
id|pg_vec
)paren
suffix:semicolon
)brace
DECL|function|packet_set_ring
r_static
r_int
id|packet_set_ring
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|tpacket_req
op_star
id|req
comma
r_int
id|closing
)paren
(brace
r_int
r_int
op_star
id|pg_vec
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|tpacket_hdr
op_star
op_star
id|io_vec
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|packet_opt
op_star
id|po
op_assign
id|sk-&gt;protinfo.af_packet
suffix:semicolon
r_int
id|order
op_assign
l_int|0
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;tp_block_nr
)paren
(brace
r_int
id|i
comma
id|l
suffix:semicolon
r_int
id|frames_per_block
suffix:semicolon
multiline_comment|/* Sanity tests and some calculations */
r_if
c_cond
(paren
(paren
r_int
)paren
id|req-&gt;tp_block_size
op_le
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;tp_block_size
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;tp_frame_size
OL
id|TPACKET_HDRLEN
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;tp_frame_size
op_amp
(paren
id|TPACKET_ALIGNMENT
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|frames_per_block
op_assign
id|req-&gt;tp_block_size
op_div
id|req-&gt;tp_frame_size
suffix:semicolon
r_if
c_cond
(paren
id|frames_per_block
op_le
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|frames_per_block
op_star
id|req-&gt;tp_block_nr
op_ne
id|req-&gt;tp_frame_nr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* OK! */
multiline_comment|/* Allocate page vector */
r_while
c_loop
(paren
(paren
id|PAGE_SIZE
op_lshift
id|order
)paren
OL
id|req-&gt;tp_block_size
)paren
id|order
op_increment
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|pg_vec
op_assign
id|kmalloc
c_func
(paren
id|req-&gt;tp_block_nr
op_star
r_sizeof
(paren
r_int
r_int
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pg_vec
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|pg_vec
comma
l_int|0
comma
id|req-&gt;tp_block_nr
op_star
r_sizeof
(paren
r_int
r_int
op_star
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|req-&gt;tp_block_nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|page
op_star
id|page
comma
op_star
id|pend
suffix:semicolon
id|pg_vec
(braket
id|i
)braket
op_assign
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
id|order
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pg_vec
(braket
id|i
)braket
)paren
r_goto
id|out_free_pgvec
suffix:semicolon
id|pend
op_assign
id|virt_to_page
c_func
(paren
id|pg_vec
(braket
id|i
)braket
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|order
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|page
op_assign
id|virt_to_page
c_func
(paren
id|pg_vec
(braket
id|i
)braket
)paren
suffix:semicolon
id|page
op_le
id|pend
suffix:semicolon
id|page
op_increment
)paren
id|SetPageReserved
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
multiline_comment|/* Page vector is allocated */
multiline_comment|/* Draw frames */
id|io_vec
op_assign
id|kmalloc
c_func
(paren
id|req-&gt;tp_frame_nr
op_star
r_sizeof
(paren
r_struct
id|tpacket_hdr
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io_vec
op_eq
l_int|NULL
)paren
r_goto
id|out_free_pgvec
suffix:semicolon
id|memset
c_func
(paren
id|io_vec
comma
l_int|0
comma
id|req-&gt;tp_frame_nr
op_star
r_sizeof
(paren
r_struct
id|tpacket_hdr
op_star
)paren
)paren
suffix:semicolon
id|l
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|req-&gt;tp_block_nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|ptr
op_assign
id|pg_vec
(braket
id|i
)braket
suffix:semicolon
r_int
id|k
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|frames_per_block
suffix:semicolon
id|k
op_increment
comma
id|l
op_increment
)paren
(brace
id|io_vec
(braket
id|l
)braket
op_assign
(paren
r_struct
id|tpacket_hdr
op_star
)paren
id|ptr
suffix:semicolon
id|io_vec
(braket
id|l
)braket
op_member_access_from_pointer
id|tp_status
op_assign
id|TP_STATUS_KERNEL
suffix:semicolon
id|ptr
op_add_assign
id|req-&gt;tp_frame_size
suffix:semicolon
)brace
)brace
multiline_comment|/* Done */
)brace
r_else
(brace
r_if
c_cond
(paren
id|req-&gt;tp_frame_nr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* Detach socket from network */
id|spin_lock
c_func
(paren
op_amp
id|po-&gt;bind_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|po-&gt;running
)paren
id|dev_remove_pack
c_func
(paren
op_amp
id|po-&gt;prot_hook
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|po-&gt;bind_lock
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|closing
op_logical_or
id|atomic_read
c_func
(paren
op_amp
id|po-&gt;mapped
)paren
op_eq
l_int|0
)paren
(brace
id|err
op_assign
l_int|0
suffix:semicolon
DECL|macro|XC
mdefine_line|#define XC(a, b) ({ __typeof__ ((a)) __t; __t = (a); (a) = (b); __t; })
id|spin_lock_bh
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|pg_vec
op_assign
id|XC
c_func
(paren
id|po-&gt;pg_vec
comma
id|pg_vec
)paren
suffix:semicolon
id|io_vec
op_assign
id|XC
c_func
(paren
id|po-&gt;iovec
comma
id|io_vec
)paren
suffix:semicolon
id|po-&gt;iovmax
op_assign
id|req-&gt;tp_frame_nr
op_minus
l_int|1
suffix:semicolon
id|po-&gt;head
op_assign
l_int|0
suffix:semicolon
id|po-&gt;frame_size
op_assign
id|req-&gt;tp_frame_size
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|sk-&gt;receive_queue.lock
)paren
suffix:semicolon
id|order
op_assign
id|XC
c_func
(paren
id|po-&gt;pg_vec_order
comma
id|order
)paren
suffix:semicolon
id|req-&gt;tp_block_nr
op_assign
id|XC
c_func
(paren
id|po-&gt;pg_vec_len
comma
id|req-&gt;tp_block_nr
)paren
suffix:semicolon
id|po-&gt;pg_vec_pages
op_assign
id|req-&gt;tp_block_size
op_div
id|PAGE_SIZE
suffix:semicolon
id|po-&gt;prot_hook.func
op_assign
id|po-&gt;iovec
ques
c_cond
id|tpacket_rcv
suffix:colon
id|packet_rcv
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
suffix:semicolon
DECL|macro|XC
macro_line|#undef XC
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|po-&gt;mapped
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;packet_mmap: vma is busy: %d&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|po-&gt;mapped
)paren
)paren
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|po-&gt;bind_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|po-&gt;running
)paren
id|dev_add_pack
c_func
(paren
op_amp
id|po-&gt;prot_hook
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|po-&gt;bind_lock
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io_vec
)paren
id|kfree
c_func
(paren
id|io_vec
)paren
suffix:semicolon
id|out_free_pgvec
suffix:colon
r_if
c_cond
(paren
id|pg_vec
)paren
id|free_pg_vec
c_func
(paren
id|pg_vec
comma
id|order
comma
id|req-&gt;tp_block_nr
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|packet_mmap
r_static
r_int
id|packet_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|packet_opt
op_star
id|po
op_assign
id|sk-&gt;protinfo.af_packet
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
r_int
r_int
id|start
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|po-&gt;pg_vec
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ne
id|po-&gt;pg_vec_len
op_star
id|po-&gt;pg_vec_pages
op_star
id|PAGE_SIZE
)paren
r_goto
id|out
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|po-&gt;mapped
)paren
suffix:semicolon
id|start
op_assign
id|vma-&gt;vm_start
suffix:semicolon
id|err
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|po-&gt;pg_vec_len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|start
comma
id|__pa
c_func
(paren
id|po-&gt;pg_vec
(braket
id|i
)braket
)paren
comma
id|po-&gt;pg_vec_pages
op_star
id|PAGE_SIZE
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_goto
id|out
suffix:semicolon
id|start
op_add_assign
id|po-&gt;pg_vec_pages
op_star
id|PAGE_SIZE
suffix:semicolon
)brace
id|vma-&gt;vm_ops
op_assign
op_amp
id|packet_mmap_ops
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SOCK_PACKET
DECL|variable|packet_ops_spkt
r_struct
id|proto_ops
id|packet_ops_spkt
op_assign
(brace
id|family
suffix:colon
id|PF_PACKET
comma
id|release
suffix:colon
id|packet_release
comma
id|bind
suffix:colon
id|packet_bind_spkt
comma
id|connect
suffix:colon
id|sock_no_connect
comma
id|socketpair
suffix:colon
id|sock_no_socketpair
comma
id|accept
suffix:colon
id|sock_no_accept
comma
id|getname
suffix:colon
id|packet_getname_spkt
comma
id|poll
suffix:colon
id|datagram_poll
comma
id|ioctl
suffix:colon
id|packet_ioctl
comma
id|listen
suffix:colon
id|sock_no_listen
comma
id|shutdown
suffix:colon
id|sock_no_shutdown
comma
id|setsockopt
suffix:colon
id|sock_no_setsockopt
comma
id|getsockopt
suffix:colon
id|sock_no_getsockopt
comma
id|sendmsg
suffix:colon
id|packet_sendmsg_spkt
comma
id|recvmsg
suffix:colon
id|packet_recvmsg
comma
id|mmap
suffix:colon
id|sock_no_mmap
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|packet_ops
r_struct
id|proto_ops
id|packet_ops
op_assign
(brace
id|family
suffix:colon
id|PF_PACKET
comma
id|release
suffix:colon
id|packet_release
comma
id|bind
suffix:colon
id|packet_bind
comma
id|connect
suffix:colon
id|sock_no_connect
comma
id|socketpair
suffix:colon
id|sock_no_socketpair
comma
id|accept
suffix:colon
id|sock_no_accept
comma
id|getname
suffix:colon
id|packet_getname
comma
id|poll
suffix:colon
id|packet_poll
comma
id|ioctl
suffix:colon
id|packet_ioctl
comma
id|listen
suffix:colon
id|sock_no_listen
comma
id|shutdown
suffix:colon
id|sock_no_shutdown
comma
id|setsockopt
suffix:colon
id|packet_setsockopt
comma
id|getsockopt
suffix:colon
id|packet_getsockopt
comma
id|sendmsg
suffix:colon
id|packet_sendmsg
comma
id|recvmsg
suffix:colon
id|packet_recvmsg
comma
id|mmap
suffix:colon
id|packet_mmap
comma
)brace
suffix:semicolon
DECL|variable|packet_family_ops
r_static
r_struct
id|net_proto_family
id|packet_family_ops
op_assign
(brace
id|PF_PACKET
comma
id|packet_create
)brace
suffix:semicolon
DECL|variable|packet_netdev_notifier
r_struct
id|notifier_block
id|packet_netdev_notifier
op_assign
initialization_block
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|packet_read_proc
r_static
r_int
id|packet_read_proc
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_struct
id|sock
op_star
id|s
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;sk       RefCnt Type Proto  Iface R Rmem   User   Inode&bslash;n&quot;
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|packet_sklist_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
id|packet_sklist
suffix:semicolon
id|s
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%p %-6d %-4d %04x   %-5d %1d %-6u %-6u %-6lu&quot;
comma
id|s
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;refcnt
)paren
comma
id|s-&gt;type
comma
id|ntohs
c_func
(paren
id|s-&gt;num
)paren
comma
id|s-&gt;protinfo.af_packet-&gt;ifindex
comma
id|s-&gt;protinfo.af_packet-&gt;running
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;rmem_alloc
)paren
comma
id|sock_i_uid
c_func
(paren
id|s
)paren
comma
id|sock_i_ino
c_func
(paren
id|s
)paren
)paren
suffix:semicolon
id|buffer
(braket
id|len
op_increment
)braket
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
r_goto
id|done
suffix:semicolon
)brace
)brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
id|done
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|packet_sklist_lock
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
DECL|function|packet_exit
r_static
r_void
id|__exit
id|packet_exit
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_PROC_FS
id|remove_proc_entry
c_func
(paren
l_string|&quot;net/packet&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|unregister_netdevice_notifier
c_func
(paren
op_amp
id|packet_netdev_notifier
)paren
suffix:semicolon
id|sock_unregister
c_func
(paren
id|PF_PACKET
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|packet_init
r_static
r_int
id|__init
id|packet_init
c_func
(paren
r_void
)paren
(brace
id|sock_register
c_func
(paren
op_amp
id|packet_family_ops
)paren
suffix:semicolon
id|register_netdevice_notifier
c_func
(paren
op_amp
id|packet_netdev_notifier
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|create_proc_read_entry
c_func
(paren
l_string|&quot;net/packet&quot;
comma
l_int|0
comma
l_int|0
comma
id|packet_read_proc
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|packet_init
id|module_init
c_func
(paren
id|packet_init
)paren
suffix:semicolon
DECL|variable|packet_exit
id|module_exit
c_func
(paren
id|packet_exit
)paren
suffix:semicolon
eof
