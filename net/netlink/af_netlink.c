multiline_comment|/*&n; * NETLINK      Kernel-user communication protocol.&n; *&n; * &t;&t;Authors:&t;Alan Cox &lt;alan@cymru.net&gt;&n; * &t;&t;&t;&t;Alexey Kuznetsov &lt;kuznet@ms2.inr.ac.ru&gt;&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; * &n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/un.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/termios.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/scm.h&gt;
DECL|macro|Nprintk
mdefine_line|#define Nprintk(a...)
macro_line|#if defined(CONFIG_NETLINK_DEV) || defined(CONFIG_NETLINK_DEV_MODULE)
DECL|macro|NL_EMULATE_DEV
mdefine_line|#define NL_EMULATE_DEV
macro_line|#endif
DECL|variable|nl_table
r_static
r_struct
id|sock
op_star
id|nl_table
(braket
id|MAX_LINKS
)braket
suffix:semicolon
DECL|variable|nl_table_lock
r_static
id|atomic_t
id|nl_table_lock
(braket
id|MAX_LINKS
)braket
suffix:semicolon
DECL|variable|nl_table_wait
r_static
r_struct
id|wait_queue
op_star
id|nl_table_wait
suffix:semicolon
macro_line|#ifdef NL_EMULATE_DEV
DECL|variable|netlink_kernel
r_static
r_struct
id|socket
op_star
id|netlink_kernel
(braket
id|MAX_LINKS
)braket
suffix:semicolon
macro_line|#endif
r_static
r_int
id|netlink_dump
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
r_static
r_void
id|netlink_destroy_callback
c_func
(paren
r_struct
id|netlink_callback
op_star
id|cb
)paren
suffix:semicolon
r_extern
id|__inline__
r_void
DECL|function|netlink_wait_on_table
id|netlink_wait_on_table
c_func
(paren
r_int
id|protocol
)paren
(brace
r_while
c_loop
(paren
id|atomic_read
c_func
(paren
op_amp
id|nl_table_lock
(braket
id|protocol
)braket
)paren
)paren
id|sleep_on
c_func
(paren
op_amp
id|nl_table_wait
)paren
suffix:semicolon
)brace
r_extern
id|__inline__
r_void
DECL|function|netlink_lock_table
id|netlink_lock_table
c_func
(paren
r_int
id|protocol
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|nl_table_lock
(braket
id|protocol
)braket
)paren
suffix:semicolon
)brace
r_extern
id|__inline__
r_void
DECL|function|netlink_unlock_table
id|netlink_unlock_table
c_func
(paren
r_int
id|protocol
comma
r_int
id|wakeup
)paren
(brace
macro_line|#if 0
multiline_comment|/* F...g gcc does not eat it! */
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|nl_table_lock
(braket
id|protocol
)braket
)paren
op_logical_and
id|wakeup
)paren
id|wake_up
c_func
(paren
op_amp
id|nl_table_wait
)paren
suffix:semicolon
macro_line|#else
id|atomic_dec
c_func
(paren
op_amp
id|nl_table_lock
(braket
id|protocol
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|nl_table_lock
(braket
id|protocol
)braket
)paren
op_logical_and
id|wakeup
)paren
id|wake_up
c_func
(paren
op_amp
id|nl_table_wait
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|netlink_lock
r_static
id|__inline__
r_void
id|netlink_lock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_netlink.locks
)paren
suffix:semicolon
)brace
DECL|function|netlink_unlock
r_static
id|__inline__
r_void
id|netlink_unlock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_netlink.locks
)paren
suffix:semicolon
)brace
DECL|function|netlink_locked
r_static
id|__inline__
r_int
id|netlink_locked
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_return
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;protinfo.af_netlink.locks
)paren
suffix:semicolon
)brace
DECL|function|netlink_lookup
r_static
id|__inline__
r_struct
id|sock
op_star
id|netlink_lookup
c_func
(paren
r_int
id|protocol
comma
id|pid_t
id|pid
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_for
c_loop
(paren
id|sk
op_assign
id|nl_table
(braket
id|protocol
)braket
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.pid
op_eq
id|pid
)paren
(brace
id|netlink_lock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_extern
r_struct
id|proto_ops
id|netlink_ops
suffix:semicolon
DECL|function|netlink_insert
r_static
r_void
id|netlink_insert
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
id|sk-&gt;next
op_assign
id|nl_table
(braket
id|sk-&gt;protocol
)braket
suffix:semicolon
id|nl_table
(braket
id|sk-&gt;protocol
)braket
op_assign
id|sk
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|netlink_remove
r_static
r_void
id|netlink_remove
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|sock
op_star
op_star
id|skp
suffix:semicolon
r_for
c_loop
(paren
id|skp
op_assign
op_amp
id|nl_table
(braket
id|sk-&gt;protocol
)braket
suffix:semicolon
op_star
id|skp
suffix:semicolon
id|skp
op_assign
op_amp
(paren
(paren
op_star
id|skp
)paren
op_member_access_from_pointer
id|next
)paren
)paren
(brace
r_if
c_cond
(paren
op_star
id|skp
op_eq
id|sk
)paren
(brace
op_star
id|skp
op_assign
id|sk-&gt;next
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
DECL|function|netlink_create
r_static
r_int
id|netlink_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_ne
id|SOCK_RAW
op_logical_and
id|sock-&gt;type
op_ne
id|SOCK_DGRAM
)paren
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
id|protocol
OL
l_int|0
op_logical_or
id|protocol
op_ge
id|MAX_LINKS
)paren
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|netlink_ops
suffix:semicolon
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|AF_NETLINK
comma
id|GFP_KERNEL
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk-&gt;destruct
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;mtu
op_assign
l_int|4096
suffix:semicolon
id|sk-&gt;protocol
op_assign
id|protocol
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_destroy_timer
r_static
r_void
id|netlink_destroy_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netlink_locked
c_func
(paren
id|sk
)paren
op_logical_and
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
op_logical_and
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
)paren
(brace
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sk-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;netlink sk destroy delayed&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|netlink_release
r_static
r_int
id|netlink_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|peer
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Wait on table before removing socket */
id|netlink_wait_on_table
c_func
(paren
id|sk-&gt;protocol
)paren
suffix:semicolon
id|netlink_remove
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.cb
)paren
(brace
id|netlink_unlock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.cb
op_member_access_from_pointer
id|done
c_func
(paren
id|sk-&gt;protinfo.af_netlink.cb
)paren
suffix:semicolon
id|netlink_destroy_callback
c_func
(paren
id|sk-&gt;protinfo.af_netlink.cb
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.cb
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* OK. Socket is unlinked, and, therefore,&n;&t;   no new packets will arrive */
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;dead
op_assign
l_int|1
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;write_queue
)paren
suffix:semicolon
multiline_comment|/* IMPORTANT! It is the major unpleasant feature of this&n;&t;   transport (and AF_UNIX datagram, when it will be repaired).&n;&t;   &n;&t;   Someone could wait on our sock-&gt;wait now.&n;&t;   We cannot release socket until waiter will remove yourself&n;&t;   from wait queue. I choose the most conservetive way of solving&n;&t;   the problem.&n;&n;&t;   We waked up this queue above, so that we need only to wait&n;&t;   when the readers release us.&n;&t; */
r_while
c_loop
(paren
id|netlink_locked
c_func
(paren
id|sk
)paren
)paren
(brace
id|current-&gt;counter
op_assign
l_int|0
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;socket
)paren
(brace
id|sk-&gt;socket
op_assign
l_int|NULL
suffix:semicolon
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_logical_or
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
)paren
(brace
id|sk-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|sk
suffix:semicolon
id|sk-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|sk-&gt;timer.function
op_assign
id|netlink_destroy_timer
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;impossible 333&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_autobind
r_static
r_int
id|netlink_autobind
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sock
op_star
id|osk
suffix:semicolon
id|netlink_wait_on_table
c_func
(paren
id|sk-&gt;protocol
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.groups
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.pid
op_assign
id|current-&gt;pid
suffix:semicolon
id|retry
suffix:colon
r_for
c_loop
(paren
id|osk
op_assign
id|nl_table
(braket
id|sk-&gt;protocol
)braket
suffix:semicolon
id|osk
suffix:semicolon
id|osk
op_assign
id|osk-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|osk-&gt;protinfo.af_netlink.pid
op_eq
id|sk-&gt;protinfo.af_netlink.pid
)paren
(brace
multiline_comment|/* Bind collision, search negative pid values. */
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.pid
OG
l_int|0
)paren
id|sk-&gt;protinfo.af_netlink.pid
op_assign
op_minus
l_int|4096
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.pid
op_decrement
suffix:semicolon
r_goto
id|retry
suffix:semicolon
)brace
)brace
id|netlink_insert
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_bind
r_static
r_int
id|netlink_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|addr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sock
op_star
id|osk
suffix:semicolon
r_struct
id|sockaddr_nl
op_star
id|nladdr
op_assign
(paren
r_struct
id|sockaddr_nl
op_star
)paren
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|nladdr-&gt;nl_family
op_ne
id|AF_NETLINK
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Only superuser is allowed to listen multicasts */
r_if
c_cond
(paren
id|nladdr-&gt;nl_groups
op_logical_and
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.pid
)paren
(brace
r_if
c_cond
(paren
id|nladdr-&gt;nl_pid
op_ne
id|sk-&gt;protinfo.af_netlink.pid
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.groups
op_assign
id|nladdr-&gt;nl_groups
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nladdr-&gt;nl_pid
op_eq
l_int|0
)paren
(brace
id|netlink_autobind
c_func
(paren
id|sock
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.groups
op_assign
id|nladdr-&gt;nl_groups
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|netlink_wait_on_table
c_func
(paren
id|sk-&gt;protocol
)paren
suffix:semicolon
r_for
c_loop
(paren
id|osk
op_assign
id|nl_table
(braket
id|sk-&gt;protocol
)braket
suffix:semicolon
id|osk
suffix:semicolon
id|osk
op_assign
id|osk-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|osk-&gt;protinfo.af_netlink.pid
op_eq
id|nladdr-&gt;nl_pid
)paren
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
id|sk-&gt;protinfo.af_netlink.pid
op_assign
id|nladdr-&gt;nl_pid
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.groups
op_assign
id|nladdr-&gt;nl_groups
suffix:semicolon
id|netlink_insert
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_connect
r_static
r_int
id|netlink_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|addr
comma
r_int
id|alen
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_nl
op_star
id|nladdr
op_assign
(paren
r_struct
id|sockaddr_nl
op_star
)paren
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sa_family
op_eq
id|AF_UNSPEC
)paren
(brace
id|sk-&gt;protinfo.af_netlink.dst_pid
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.dst_groups
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr-&gt;sa_family
op_ne
id|AF_NETLINK
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Only superuser is allowed to send multicasts */
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
op_logical_and
id|nladdr-&gt;nl_groups
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.dst_pid
op_assign
id|nladdr-&gt;nl_pid
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.dst_groups
op_assign
id|nladdr-&gt;nl_groups
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;protinfo.af_netlink.pid
)paren
id|netlink_autobind
c_func
(paren
id|sock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_getname
r_static
r_int
id|netlink_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|addr
comma
r_int
op_star
id|addr_len
comma
r_int
id|peer
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_nl
op_star
id|nladdr
op_assign
(paren
r_struct
id|sockaddr_nl
op_star
)paren
id|addr
suffix:semicolon
id|nladdr-&gt;nl_family
op_assign
id|AF_NETLINK
suffix:semicolon
op_star
id|addr_len
op_assign
r_sizeof
(paren
op_star
id|nladdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
id|nladdr-&gt;nl_pid
op_assign
id|sk-&gt;protinfo.af_netlink.dst_pid
suffix:semicolon
id|nladdr-&gt;nl_groups
op_assign
id|sk-&gt;protinfo.af_netlink.dst_groups
suffix:semicolon
)brace
r_else
(brace
id|nladdr-&gt;nl_pid
op_assign
id|sk-&gt;protinfo.af_netlink.pid
suffix:semicolon
id|nladdr-&gt;nl_groups
op_assign
id|sk-&gt;protinfo.af_netlink.groups
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_unicast
r_int
id|netlink_unicast
c_func
(paren
r_struct
id|sock
op_star
id|ssk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|pid_t
id|pid
comma
r_int
id|nonblock
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
r_int
id|protocol
op_assign
id|ssk-&gt;protocol
suffix:semicolon
id|retry
suffix:colon
r_for
c_loop
(paren
id|sk
op_assign
id|nl_table
(braket
id|protocol
)braket
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.pid
op_ne
id|pid
)paren
r_continue
suffix:semicolon
id|netlink_lock
c_func
(paren
id|sk
)paren
suffix:semicolon
macro_line|#ifdef NL_EMULATE_DEV
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.handler
)paren
(brace
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|len
op_assign
id|sk-&gt;protinfo.af_netlink
dot
id|handler
c_func
(paren
id|protocol
comma
id|skb
)paren
suffix:semicolon
id|netlink_unlock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
OG
id|sk-&gt;rcvbuf
)paren
(brace
r_if
c_cond
(paren
id|nonblock
)paren
(brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|netlink_unlock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|interruptible_sleep_on
c_func
(paren
id|sk-&gt;sleep
)paren
suffix:semicolon
id|netlink_unlock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
r_goto
id|retry
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|Nprintk
c_func
(paren
l_string|&quot;unicast_deliver %d&bslash;n&quot;
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb_set_owner_r
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;receive_queue
comma
id|skb
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
id|len
)paren
suffix:semicolon
id|netlink_unlock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ECONNREFUSED
suffix:semicolon
)brace
DECL|function|netlink_broadcast_deliver
r_static
id|__inline__
r_int
id|netlink_broadcast_deliver
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
macro_line|#ifdef NL_EMULATE_DEV
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.handler
)paren
(brace
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_netlink
dot
id|handler
c_func
(paren
id|sk-&gt;protocol
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_le
id|sk-&gt;rcvbuf
)paren
(brace
id|Nprintk
c_func
(paren
l_string|&quot;broadcast_deliver %d&bslash;n&quot;
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb_set_owner_r
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;receive_queue
comma
id|skb
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|netlink_broadcast
r_void
id|netlink_broadcast
c_func
(paren
r_struct
id|sock
op_star
id|ssk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|pid_t
id|pid
comma
r_int
id|group
comma
r_int
id|allocation
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
op_assign
l_int|NULL
suffix:semicolon
r_int
id|protocol
op_assign
id|ssk-&gt;protocol
suffix:semicolon
r_int
id|failure
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* While we sleep in clone, do not allow to change socket list */
id|netlink_lock_table
c_func
(paren
id|protocol
)paren
suffix:semicolon
r_for
c_loop
(paren
id|sk
op_assign
id|nl_table
(braket
id|protocol
)braket
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ssk
op_eq
id|sk
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.pid
op_eq
id|pid
op_logical_or
op_logical_neg
(paren
id|sk-&gt;protinfo.af_netlink.groups
op_amp
id|group
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|failure
)paren
(brace
id|sk-&gt;err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|netlink_lock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|skb-&gt;users
)paren
op_ne
l_int|1
)paren
(brace
id|skb2
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|allocation
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb2
op_assign
id|skb
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|skb2
op_eq
l_int|NULL
)paren
(brace
id|sk-&gt;err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* Clone failed. Notify ALL listeners. */
id|failure
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|netlink_broadcast_deliver
c_func
(paren
id|sk
comma
id|skb2
)paren
)paren
(brace
id|sk-&gt;err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
id|skb2
op_assign
l_int|NULL
suffix:semicolon
id|netlink_unlock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|netlink_unlock_table
c_func
(paren
id|protocol
comma
id|allocation
op_eq
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
id|kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|netlink_set_err
r_void
id|netlink_set_err
c_func
(paren
r_struct
id|sock
op_star
id|ssk
comma
id|pid_t
id|pid
comma
r_int
id|group
comma
r_int
id|code
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|protocol
op_assign
id|ssk-&gt;protocol
suffix:semicolon
id|Nprintk
c_func
(paren
l_string|&quot;seterr&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|sk
op_assign
id|nl_table
(braket
id|protocol
)braket
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|ssk
op_eq
id|sk
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.pid
op_eq
id|pid
op_logical_or
op_logical_neg
(paren
id|sk-&gt;protinfo.af_netlink.groups
op_amp
id|group
)paren
)paren
r_continue
suffix:semicolon
id|sk-&gt;err
op_assign
op_minus
id|code
suffix:semicolon
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
)brace
DECL|function|netlink_sendmsg
r_static
r_int
id|netlink_sendmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_nl
op_star
id|addr
op_assign
id|msg-&gt;msg_name
suffix:semicolon
id|pid_t
id|dst_pid
suffix:semicolon
r_int
id|dst_groups
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_flags
op_amp
id|MSG_OOB
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_flags
op_amp
op_complement
id|MSG_DONTWAIT
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;1 %08x&bslash;n&quot;
comma
id|msg-&gt;msg_flags
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg-&gt;msg_namelen
)paren
(brace
r_if
c_cond
(paren
id|addr-&gt;nl_family
op_ne
id|AF_NETLINK
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;2 %08x&bslash;n&quot;
comma
id|addr-&gt;nl_family
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dst_pid
op_assign
id|addr-&gt;nl_pid
suffix:semicolon
id|dst_groups
op_assign
id|addr-&gt;nl_groups
suffix:semicolon
r_if
c_cond
(paren
id|dst_groups
op_logical_and
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_else
(brace
id|dst_pid
op_assign
id|sk-&gt;protinfo.af_netlink.dst_pid
suffix:semicolon
id|dst_groups
op_assign
id|sk-&gt;protinfo.af_netlink.dst_groups
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;protinfo.af_netlink.pid
)paren
id|netlink_autobind
c_func
(paren
id|sock
)paren
suffix:semicolon
id|skb
op_assign
id|sock_wmalloc
c_func
(paren
id|sk
comma
id|len
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|pid
op_assign
id|sk-&gt;protinfo.af_netlink.pid
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|groups
op_assign
id|sk-&gt;protinfo.af_netlink.groups
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
op_assign
id|dst_pid
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|dst_groups
suffix:semicolon
id|memcpy
c_func
(paren
id|NETLINK_CREDS
c_func
(paren
id|skb
)paren
comma
op_amp
id|scm-&gt;creds
comma
r_sizeof
(paren
r_struct
id|ucred
)paren
)paren
suffix:semicolon
id|memcpy_fromiovec
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|msg-&gt;msg_iov
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst_groups
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|sk
comma
id|skb
comma
id|dst_pid
comma
id|dst_groups
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|sk
comma
id|skb
comma
id|dst_pid
comma
id|msg-&gt;msg_flags
op_amp
id|MSG_DONTWAIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;3&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|netlink_recvmsg
r_static
r_int
id|netlink_recvmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_int
id|flags
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|noblock
op_assign
id|flags
op_amp
id|MSG_DONTWAIT
suffix:semicolon
r_int
id|copied
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|MSG_OOB
op_or
id|MSG_PEEK
)paren
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|err
op_assign
op_minus
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|skb
op_assign
id|skb_recv_datagram
c_func
(paren
id|sk
comma
id|flags
comma
id|noblock
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
id|err
suffix:semicolon
id|msg-&gt;msg_namelen
op_assign
l_int|0
suffix:semicolon
id|copied
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|copied
)paren
(brace
id|msg-&gt;msg_flags
op_or_assign
id|MSG_TRUNC
suffix:semicolon
id|copied
op_assign
id|len
suffix:semicolon
)brace
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|err
op_assign
id|skb_copy_datagram_iovec
c_func
(paren
id|skb
comma
l_int|0
comma
id|msg-&gt;msg_iov
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_name
)paren
(brace
r_struct
id|sockaddr_nl
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_nl
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
id|addr-&gt;nl_family
op_assign
id|AF_NETLINK
suffix:semicolon
id|addr-&gt;nl_pid
op_assign
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|pid
suffix:semicolon
id|addr-&gt;nl_groups
op_assign
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
suffix:semicolon
id|msg-&gt;msg_namelen
op_assign
r_sizeof
(paren
op_star
id|addr
)paren
suffix:semicolon
)brace
id|scm-&gt;creds
op_assign
op_star
id|NETLINK_CREDS
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb_free_datagram
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.cb
op_logical_and
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_le
id|sk-&gt;rcvbuf
op_div
l_int|2
)paren
id|netlink_dump
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
ques
c_cond
id|err
suffix:colon
id|copied
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;We export these functions to other modules. They provide a &n; *&t;complete set of kernel non-blocking support for message&n; *&t;queueing.&n; */
r_struct
id|sock
op_star
DECL|function|netlink_kernel_create
id|netlink_kernel_create
c_func
(paren
r_int
id|unit
comma
r_void
(paren
op_star
id|input
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|len
)paren
)paren
(brace
r_struct
id|socket
op_star
id|sock
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_if
c_cond
(paren
id|unit
OL
l_int|0
op_logical_or
id|unit
op_ge
id|MAX_LINKS
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sock
op_assign
id|sock_alloc
c_func
(paren
)paren
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|sock-&gt;type
op_assign
id|SOCK_RAW
suffix:semicolon
r_if
c_cond
(paren
id|netlink_create
c_func
(paren
id|sock
comma
id|unit
)paren
OL
l_int|0
)paren
(brace
id|sock_release
c_func
(paren
id|sock
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|input
)paren
id|sk-&gt;data_ready
op_assign
id|input
suffix:semicolon
id|netlink_insert
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
DECL|function|netlink_destroy_callback
r_static
r_void
id|netlink_destroy_callback
c_func
(paren
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_if
c_cond
(paren
id|cb-&gt;skb
)paren
id|kfree_skb
c_func
(paren
id|cb-&gt;skb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * It looks a bit ugly.&n; * It would be better to create kernel thread.&n; */
DECL|function|netlink_dump
r_static
r_int
id|netlink_dump
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|netlink_callback
op_star
id|cb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
id|len
suffix:semicolon
id|skb
op_assign
id|sock_rmalloc
c_func
(paren
id|sk
comma
id|NLMSG_GOODSIZE
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|cb
op_assign
id|sk-&gt;protinfo.af_netlink.cb
suffix:semicolon
id|len
op_assign
id|cb
op_member_access_from_pointer
id|dump
c_func
(paren
id|skb
comma
id|cb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;receive_queue
comma
id|skb
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
id|len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|nlh
op_assign
id|__nlmsg_put
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|cb-&gt;skb
)paren
dot
id|pid
comma
id|cb-&gt;nlh-&gt;nlmsg_seq
comma
id|NLMSG_DONE
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_or_assign
id|NLM_F_MULTI
suffix:semicolon
id|memcpy
c_func
(paren
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
comma
op_amp
id|len
comma
r_sizeof
(paren
id|len
)paren
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;receive_queue
comma
id|skb
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|cb
op_member_access_from_pointer
id|done
c_func
(paren
id|cb
)paren
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.cb
op_assign
l_int|NULL
suffix:semicolon
id|netlink_destroy_callback
c_func
(paren
id|cb
)paren
suffix:semicolon
id|netlink_unlock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_dump_start
r_int
id|netlink_dump_start
c_func
(paren
r_struct
id|sock
op_star
id|ssk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_int
(paren
op_star
id|dump
)paren
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
)paren
comma
r_int
(paren
op_star
id|done
)paren
(paren
r_struct
id|netlink_callback
op_star
)paren
)paren
(brace
r_struct
id|netlink_callback
op_star
id|cb
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|cb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cb
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|memset
c_func
(paren
id|cb
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cb
)paren
)paren
suffix:semicolon
id|cb-&gt;dump
op_assign
id|dump
suffix:semicolon
id|cb-&gt;done
op_assign
id|done
suffix:semicolon
id|cb-&gt;nlh
op_assign
id|nlh
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|cb-&gt;skb
op_assign
id|skb
suffix:semicolon
id|sk
op_assign
id|netlink_lookup
c_func
(paren
id|ssk-&gt;protocol
comma
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
(brace
id|netlink_destroy_callback
c_func
(paren
id|cb
)paren
suffix:semicolon
r_return
op_minus
id|ECONNREFUSED
suffix:semicolon
)brace
multiline_comment|/* A dump is in progress... */
r_if
c_cond
(paren
id|sk-&gt;protinfo.af_netlink.cb
)paren
(brace
id|netlink_destroy_callback
c_func
(paren
id|cb
)paren
suffix:semicolon
id|netlink_unlock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|sk-&gt;protinfo.af_netlink.cb
op_assign
id|cb
suffix:semicolon
id|netlink_dump
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_ack
r_void
id|netlink_ack
c_func
(paren
r_struct
id|sk_buff
op_star
id|in_skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_int
id|err
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|rep
suffix:semicolon
r_struct
id|nlmsgerr
op_star
id|errmsg
suffix:semicolon
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
id|size
op_assign
id|NLMSG_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|nlmsgerr
)paren
)paren
suffix:semicolon
r_else
id|size
op_assign
id|NLMSG_SPACE
c_func
(paren
l_int|4
op_plus
id|nlh-&gt;nlmsg_len
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
id|rep
op_assign
id|__nlmsg_put
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|nlh-&gt;nlmsg_seq
comma
id|NLMSG_ERROR
comma
r_sizeof
(paren
r_struct
id|nlmsgerr
)paren
)paren
suffix:semicolon
id|errmsg
op_assign
id|NLMSG_DATA
c_func
(paren
id|rep
)paren
suffix:semicolon
id|errmsg-&gt;error
op_assign
id|err
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|errmsg-&gt;msg
comma
id|nlh
comma
id|err
ques
c_cond
id|nlh-&gt;nlmsg_len
suffix:colon
r_sizeof
(paren
r_struct
id|nlmsghdr
)paren
)paren
suffix:semicolon
id|netlink_unicast
c_func
(paren
id|in_skb-&gt;sk
comma
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
)brace
macro_line|#ifdef NL_EMULATE_DEV
multiline_comment|/*&n; *&t;Backward compatibility.&n; */
DECL|function|netlink_attach
r_int
id|netlink_attach
c_func
(paren
r_int
id|unit
comma
r_int
(paren
op_star
id|function
)paren
(paren
r_int
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|netlink_kernel_create
c_func
(paren
id|unit
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|sk-&gt;protinfo.af_netlink.handler
op_assign
id|function
suffix:semicolon
id|netlink_kernel
(braket
id|unit
)braket
op_assign
id|sk-&gt;socket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_detach
r_void
id|netlink_detach
c_func
(paren
r_int
id|unit
)paren
(brace
r_struct
id|socket
op_star
id|sock
op_assign
id|netlink_kernel
(braket
id|unit
)braket
suffix:semicolon
id|netlink_kernel
(braket
id|unit
)braket
op_assign
l_int|NULL
suffix:semicolon
id|sock_release
c_func
(paren
id|sock
)paren
suffix:semicolon
)brace
DECL|function|netlink_post
r_int
id|netlink_post
c_func
(paren
r_int
id|unit
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
id|netlink_kernel
(braket
id|unit
)braket
)paren
(brace
id|memset
c_func
(paren
id|skb-&gt;cb
comma
l_int|0
comma
r_sizeof
(paren
id|skb-&gt;cb
)paren
)paren
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|netlink_kernel
(braket
id|unit
)braket
op_member_access_from_pointer
id|sk
comma
id|skb
comma
l_int|0
comma
op_complement
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EUNATCH
suffix:semicolon
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if 0
multiline_comment|/* What a pity... It was good code, but at the moment it&n;   results in unnecessary complications.&n; */
multiline_comment|/*&n; *&t;&quot;High&quot; level netlink interface. (ANK)&n; *&t;&n; *&t;Features:&n; *&t;&t;- standard message format.&n; *&t;&t;- pseudo-reliable delivery. Messages can be still lost, but&n; *&t;&t;  user level will know that they were lost and can&n; *&t;&t;  recover (f.e. gated could reread FIB and device list)&n; *&t;&t;- messages are batched.&n; */
multiline_comment|/*&n; *&t;Try to deliver queued messages.&n; */
r_static
r_void
id|nlmsg_delayed_flush
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|nlmsg_flush
c_func
(paren
id|sk
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
r_static
r_void
id|nlmsg_flush
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|allocation
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;write_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;users
op_ne
l_int|1
)paren
(brace
id|skb_queue_head
c_func
(paren
op_amp
id|sk-&gt;write_queue
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|sk
comma
id|skb
comma
l_int|0
comma
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
comma
id|allocation
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
)brace
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;timer.function
)paren
id|del_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
id|sk-&gt;timer.expires
op_assign
id|jiffies
op_plus
(paren
id|sk-&gt;protinfo.af_netlink.delay
ques
c_cond
suffix:colon
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
id|sk-&gt;timer.function
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
id|nlmsg_delayed_flush
suffix:semicolon
id|sk-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|sk
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
suffix:semicolon
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Allocate room for new message. If it is impossible, return NULL.&n; */
r_void
op_star
id|nlmsg_broadcast
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
op_star
id|skbp
comma
r_int
r_int
id|type
comma
r_int
id|len
comma
r_int
id|groups
comma
r_int
id|allocation
)paren
(brace
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|rlen
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|rlen
op_assign
id|NLMSG_SPACE
c_func
(paren
id|len
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|skb
op_assign
id|sk-&gt;write_queue.tail
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
id|sk-&gt;write_queue.head
)paren
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
op_logical_or
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
id|rlen
op_logical_or
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_ne
id|groups
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|nlmsg_flush
c_func
(paren
id|sk
comma
id|allocation
)paren
suffix:semicolon
id|skb
op_assign
id|sock_wmalloc
c_func
(paren
id|rlen
OG
id|NLMSG_GOODSIZE
ques
c_cond
id|rlen
suffix:colon
id|NLMSG_GOODSIZE
comma
id|sk
comma
l_int|0
comma
id|allocation
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
id|KERN_WARNING
l_string|&quot;nlmsg at unit %d overrunned&bslash;n&quot;
comma
id|sk-&gt;protocol
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|groups
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;write_queue
comma
id|skb
)paren
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|nlh
op_assign
(paren
r_struct
id|nlmsghdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|rlen
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_type
op_assign
id|type
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|NLMSG_LENGTH
c_func
(paren
id|len
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_seq
op_assign
l_int|0
suffix:semicolon
id|nlh-&gt;nlmsg_pid
op_assign
l_int|0
suffix:semicolon
op_star
id|skbp
op_assign
id|skb
suffix:semicolon
r_return
id|nlh-&gt;nlmsg_data
suffix:semicolon
)brace
r_struct
id|sk_buff
op_star
id|nlmsg_alloc
c_func
(paren
r_int
r_int
id|type
comma
r_int
id|len
comma
r_int
r_int
id|seq
comma
r_int
r_int
id|pid
comma
r_int
id|allocation
)paren
(brace
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|rlen
suffix:semicolon
id|rlen
op_assign
id|NLMSG_SPACE
c_func
(paren
id|len
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|rlen
comma
id|allocation
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|nlh
op_assign
(paren
r_struct
id|nlmsghdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|rlen
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_type
op_assign
id|type
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|NLMSG_LENGTH
c_func
(paren
id|len
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_seq
op_assign
id|seq
suffix:semicolon
id|nlh-&gt;nlmsg_pid
op_assign
id|pid
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
r_void
id|nlmsg_release
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|atomic_dec
c_func
(paren
id|skb-&gt;users
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Kick message queue.&n; *&t;Two modes:&n; *&t;&t;- synchronous (delay==0). Messages are delivered immediately.&n; *&t;&t;- delayed. Do not deliver, but start delivery timer.&n; */
r_void
id|__nlmsg_transmit
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|allocation
)paren
(brace
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;protinfo.af_netlink.delay
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;timer.function
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
suffix:semicolon
id|sk-&gt;timer.function
op_assign
l_int|NULL
suffix:semicolon
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|nlmsg_flush
c_func
(paren
id|sk
comma
id|allocation
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;timer.function
)paren
(brace
id|sk-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|sk-&gt;protinfo.af_netlink.delay
suffix:semicolon
id|sk-&gt;timer.function
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
id|nlmsg_delayed_flush
suffix:semicolon
id|sk-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|sk
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
suffix:semicolon
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|netlink_read_proc
r_static
r_int
id|netlink_read_proc
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|sock
op_star
id|s
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;sk       Eth Pid    Groups   &quot;
l_string|&quot;Rmem     Wmem     Dump     Locks&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_LINKS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|s
op_assign
id|nl_table
(braket
id|i
)braket
suffix:semicolon
id|s
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%p %-3d %-6d %08x %-8d %-8d %p %d&quot;
comma
id|s
comma
id|s-&gt;protocol
comma
id|s-&gt;protinfo.af_netlink.pid
comma
id|s-&gt;protinfo.af_netlink.groups
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;rmem_alloc
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;wmem_alloc
)paren
comma
id|s-&gt;protinfo.af_netlink.cb
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;protinfo.af_netlink.locks
)paren
)paren
suffix:semicolon
id|buffer
(braket
id|len
op_increment
)braket
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
r_goto
id|done
suffix:semicolon
)brace
)brace
)brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
id|done
suffix:colon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|netlink_ops
r_struct
id|proto_ops
id|netlink_ops
op_assign
(brace
id|AF_NETLINK
comma
id|sock_no_dup
comma
id|netlink_release
comma
id|netlink_bind
comma
id|netlink_connect
comma
l_int|NULL
comma
l_int|NULL
comma
id|netlink_getname
comma
id|datagram_poll
comma
id|sock_no_ioctl
comma
id|sock_no_listen
comma
id|sock_no_shutdown
comma
l_int|NULL
comma
l_int|NULL
comma
id|sock_no_fcntl
comma
id|netlink_sendmsg
comma
id|netlink_recvmsg
)brace
suffix:semicolon
DECL|variable|netlink_family_ops
r_struct
id|net_proto_family
id|netlink_family_ops
op_assign
(brace
id|AF_NETLINK
comma
id|netlink_create
)brace
suffix:semicolon
DECL|function|netlink_proto_init
r_void
id|netlink_proto_init
c_func
(paren
r_struct
id|net_proto
op_star
id|pro
)paren
(brace
macro_line|#ifdef CONFIG_PROC_FS
r_struct
id|proc_dir_entry
op_star
id|ent
suffix:semicolon
macro_line|#endif
r_struct
id|sk_buff
op_star
id|dummy_skb
suffix:semicolon
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|netlink_skb_parms
)paren
OG
r_sizeof
(paren
id|dummy_skb-&gt;cb
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;netlink_proto_init: panic&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sock_register
c_func
(paren
op_amp
id|netlink_family_ops
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|ent
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;net/netlink&quot;
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|ent-&gt;read_proc
op_assign
id|netlink_read_proc
suffix:semicolon
macro_line|#endif
)brace
eof
