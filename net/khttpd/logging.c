multiline_comment|/*&n;&n;kHTTPd -- the next generation&n;&n;logging.c takes care of shutting down a connection.&n;&n;*/
multiline_comment|/****************************************************************&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2, or (at your option)&n; *&t;any later version.&n; *&n; *&t;This program is distributed in the hope that it will be useful,&n; *&t;but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *&t;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *&t;GNU General Public License for more details.&n; *&n; *&t;You should have received a copy of the GNU General Public License&n; *&t;along with this program; if not, write to the Free Software&n; *&t;Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; ****************************************************************/
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;structure.h&quot;
macro_line|#include &quot;prototypes.h&quot;
multiline_comment|/*&n;&n;Purpose:&n;&n;Logging() terminates &quot;finished&quot; connections and will eventually log them to a &n;userspace daemon.&n;&n;Return value:&n;&t;The number of requests that changed status, thus the number of connections&n;&t;that shut down.&n;*/
DECL|function|Logging
r_int
id|Logging
c_func
(paren
r_const
r_int
id|CPUNR
)paren
(brace
r_struct
id|http_request
op_star
id|CurrentRequest
comma
op_star
id|Req
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
id|EnterFunction
c_func
(paren
l_string|&quot;Logging&quot;
)paren
suffix:semicolon
id|CurrentRequest
op_assign
id|threadinfo
(braket
id|CPUNR
)braket
dot
id|LoggingQueue
suffix:semicolon
multiline_comment|/* For now, all requests are removed immediatly, but this changes&n;&t;   when userspace-logging is added. */
r_while
c_loop
(paren
id|CurrentRequest
op_ne
l_int|NULL
)paren
(brace
id|Req
op_assign
id|CurrentRequest-&gt;Next
suffix:semicolon
id|CleanUpRequest
c_func
(paren
id|CurrentRequest
)paren
suffix:semicolon
id|threadinfo
(braket
id|CPUNR
)braket
dot
id|LoggingQueue
op_assign
id|Req
suffix:semicolon
id|CurrentRequest
op_assign
id|Req
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
id|LeaveFunction
c_func
(paren
l_string|&quot;Logging&quot;
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|StopLogging
r_void
id|StopLogging
c_func
(paren
r_const
r_int
id|CPUNR
)paren
(brace
r_struct
id|http_request
op_star
id|CurrentRequest
comma
op_star
id|Next
suffix:semicolon
id|EnterFunction
c_func
(paren
l_string|&quot;StopLogging&quot;
)paren
suffix:semicolon
id|CurrentRequest
op_assign
id|threadinfo
(braket
id|CPUNR
)braket
dot
id|LoggingQueue
suffix:semicolon
r_while
c_loop
(paren
id|CurrentRequest
op_ne
l_int|NULL
)paren
(brace
id|Next
op_assign
id|CurrentRequest-&gt;Next
suffix:semicolon
id|CleanUpRequest
c_func
(paren
id|CurrentRequest
)paren
suffix:semicolon
id|CurrentRequest
op_assign
id|Next
suffix:semicolon
)brace
id|threadinfo
(braket
id|CPUNR
)braket
dot
id|LoggingQueue
op_assign
l_int|NULL
suffix:semicolon
id|LeaveFunction
c_func
(paren
l_string|&quot;StopLogging&quot;
)paren
suffix:semicolon
)brace
eof
