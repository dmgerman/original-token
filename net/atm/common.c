multiline_comment|/* net/atm/common.c - ATM sockets (common part for PVC and SVC) */
multiline_comment|/* Written 1995-2000 by Werner Almesberger, EPFL LRC/ICA */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/net.h&gt;&t;&t;/* struct socket, struct net_proto, struct&n;&t;&t;&t;&t;   proto_ops */
macro_line|#include &lt;linux/atm.h&gt;&t;&t;/* ATM stuff */
macro_line|#include &lt;linux/atmdev.h&gt;
macro_line|#include &lt;linux/atmclip.h&gt;&t;/* CLIP_*ENCAP */
macro_line|#include &lt;linux/atmarp.h&gt;&t;/* manifest constants */
macro_line|#include &lt;linux/sonet.h&gt;&t;/* for ioctls */
macro_line|#include &lt;linux/socket.h&gt;&t;/* SOL_SOCKET */
macro_line|#include &lt;linux/errno.h&gt;&t;/* error codes */
macro_line|#include &lt;linux/capability.h&gt;
macro_line|#include &lt;linux/mm.h&gt;&t;&t;/* verify_area */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/time.h&gt;&t;&t;/* struct timeval */
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;net/sock.h&gt;&t;&t;/* struct sock */
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/poll.h&gt;
macro_line|#if defined(CONFIG_ATM_LANE) || defined(CONFIG_ATM_LANE_MODULE)
macro_line|#include &lt;linux/atmlec.h&gt;
macro_line|#include &quot;lec.h&quot;
macro_line|#include &quot;lec_arpc.h&quot;
DECL|variable|atm_lane_ops
r_struct
id|atm_lane_ops
id|atm_lane_ops
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_LANE_MODULE
DECL|variable|atm_lane_ops
id|EXPORT_SYMBOL
c_func
(paren
id|atm_lane_ops
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_MPOA) || defined(CONFIG_ATM_MPOA_MODULE)
macro_line|#include &lt;linux/atmmpc.h&gt;
macro_line|#include &quot;mpc.h&quot;
DECL|variable|atm_mpoa_ops
r_struct
id|atm_mpoa_ops
id|atm_mpoa_ops
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ATM_MPOA_MODULE
DECL|variable|atm_mpoa_ops
id|EXPORT_SYMBOL
c_func
(paren
id|atm_mpoa_ops
)paren
suffix:semicolon
macro_line|#ifndef CONFIG_ATM_LANE_MODULE
DECL|variable|atm_lane_ops
id|EXPORT_SYMBOL
c_func
(paren
id|atm_lane_ops
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_TCP) || defined(CONFIG_ATM_TCP_MODULE)
macro_line|#include &lt;linux/atm_tcp.h&gt;
macro_line|#ifdef CONFIG_ATM_TCP_MODULE
DECL|variable|atm_tcp_ops
r_struct
id|atm_tcp_ops
id|atm_tcp_ops
suffix:semicolon
DECL|variable|atm_tcp_ops
id|EXPORT_SYMBOL
c_func
(paren
id|atm_tcp_ops
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#include &quot;resources.h&quot;&t;&t;/* atm_find_dev */
macro_line|#include &quot;common.h&quot;&t;&t;/* prototypes */
macro_line|#include &quot;protocols.h&quot;&t;&t;/* atm_init_&lt;transport&gt; */
macro_line|#include &quot;addr.h&quot;&t;&t;/* address registry */
macro_line|#ifdef CONFIG_ATM_CLIP
macro_line|#include &lt;net/atmclip.h&gt;&t;/* for clip_create */
macro_line|#endif
macro_line|#include &quot;signaling.h&quot;&t;&t;/* for WAITING and sigd_attach */
macro_line|#if 0
mdefine_line|#define DPRINTK(format,args...) printk(KERN_DEBUG format,##args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(format,args...)
macro_line|#endif
DECL|variable|atm_dev_lock
id|spinlock_t
id|atm_dev_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|function|alloc_tx
r_static
r_struct
id|sk_buff
op_star
id|alloc_tx
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
r_int
id|size
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;tx_inuse
)paren
op_logical_and
op_logical_neg
id|atm_may_send
c_func
(paren
id|vcc
comma
id|size
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;Sorry: tx_inuse = %d, size = %d, sndbuf = %d&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;tx_inuse
)paren
comma
id|size
comma
id|vcc-&gt;sk-&gt;sndbuf
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
)paren
)paren
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;AlTx %d += %d&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;tx_inuse
)paren
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|atomic_add
c_func
(paren
id|skb-&gt;truesize
op_plus
id|ATM_PDU_OVHD
comma
op_amp
id|vcc-&gt;tx_inuse
)paren
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
DECL|function|atm_create
r_int
id|atm_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
comma
r_int
id|family
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_STREAM
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sk
op_assign
id|alloc_atm_vcc_sk
c_func
(paren
id|family
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|vcc
op_assign
id|sk-&gt;protinfo.af_atm
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|vcc-&gt;flags
comma
l_int|0
comma
r_sizeof
(paren
id|vcc-&gt;flags
)paren
)paren
suffix:semicolon
id|vcc-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|vcc-&gt;family
op_assign
id|sock-&gt;ops-&gt;family
suffix:semicolon
id|vcc-&gt;alloc_tx
op_assign
id|alloc_tx
suffix:semicolon
id|vcc-&gt;callback
op_assign
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|vcc-&gt;local
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|sockaddr_atmsvc
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|vcc-&gt;remote
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|sockaddr_atmsvc
)paren
)paren
suffix:semicolon
id|vcc-&gt;qos.txtp.max_sdu
op_assign
l_int|1
op_lshift
l_int|16
suffix:semicolon
multiline_comment|/* for meta VCs */
id|atomic_set
c_func
(paren
op_amp
id|vcc-&gt;tx_inuse
comma
l_int|0
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|vcc-&gt;rx_inuse
comma
l_int|0
)paren
suffix:semicolon
id|vcc-&gt;push
op_assign
l_int|NULL
suffix:semicolon
id|vcc-&gt;pop
op_assign
l_int|NULL
suffix:semicolon
id|vcc-&gt;push_oam
op_assign
l_int|NULL
suffix:semicolon
id|vcc-&gt;vpi
op_assign
id|vcc-&gt;vci
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no VCI/VPI yet */
id|vcc-&gt;atm_options
op_assign
id|vcc-&gt;aal_options
op_assign
l_int|0
suffix:semicolon
id|vcc-&gt;timestamp.tv_sec
op_assign
id|vcc-&gt;timestamp.tv_usec
op_assign
l_int|0
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|vcc-&gt;sleep
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|vcc-&gt;recvq
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|vcc-&gt;listenq
)paren
suffix:semicolon
id|sk-&gt;sleep
op_assign
op_amp
id|vcc-&gt;sleep
suffix:semicolon
id|sock-&gt;sk
op_assign
id|sk
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atm_release_vcc_sk
r_void
id|atm_release_vcc_sk
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|free_sk
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|vcc
op_assign
id|sk-&gt;protinfo.af_atm
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;dev
)paren
(brace
r_if
c_cond
(paren
id|vcc-&gt;dev-&gt;ops-&gt;close
)paren
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|close
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;push
)paren
id|vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|vcc
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* atmarpd has no push */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|vcc-&gt;recvq
)paren
)paren
)paren
(brace
id|atm_return
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;dev-&gt;ops-&gt;free_rx_skb
)paren
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|free_rx_skb
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|spin_lock
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
id|fops_put
(paren
id|vcc-&gt;dev-&gt;ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;rx_inuse
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;atm_release_vcc: strange ... &quot;
l_string|&quot;rx_inuse == %d after closing&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;rx_inuse
)paren
)paren
suffix:semicolon
id|bind_vcc
c_func
(paren
id|vcc
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
id|spin_lock
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|free_sk
)paren
id|free_atm_vcc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|spin_unlock
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
)brace
DECL|function|atm_release
r_int
id|atm_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_if
c_cond
(paren
id|sock-&gt;sk
)paren
id|atm_release_vcc_sk
c_func
(paren
id|sock-&gt;sk
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atm_async_release_vcc
r_void
id|atm_async_release_vcc
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|reply
)paren
(brace
id|set_bit
c_func
(paren
id|ATM_VF_CLOSE
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|vcc-&gt;reply
op_assign
id|reply
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|vcc-&gt;sleep
)paren
suffix:semicolon
)brace
DECL|variable|atm_async_release_vcc
id|EXPORT_SYMBOL
c_func
(paren
id|atm_async_release_vcc
)paren
suffix:semicolon
DECL|function|adjust_tp
r_static
r_int
id|adjust_tp
c_func
(paren
r_struct
id|atm_trafprm
op_star
id|tp
comma
r_int
r_char
id|aal
)paren
(brace
r_int
id|max_sdu
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;traffic_class
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|aal
)paren
(brace
r_case
id|ATM_AAL0
suffix:colon
id|max_sdu
op_assign
id|ATM_CELL_SIZE
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL34
suffix:colon
id|max_sdu
op_assign
id|ATM_MAX_AAL34_PDU
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ATM: AAL problems ... &quot;
l_string|&quot;(%d)&bslash;n&quot;
comma
id|aal
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|ATM_AAL5
suffix:colon
id|max_sdu
op_assign
id|ATM_MAX_AAL5_PDU
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;max_sdu
)paren
id|tp-&gt;max_sdu
op_assign
id|max_sdu
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tp-&gt;max_sdu
OG
id|max_sdu
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;max_cdv
)paren
id|tp-&gt;max_cdv
op_assign
id|ATM_MAX_CDV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atm_do_connect_dev
r_static
r_int
id|atm_do_connect_dev
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
(brace
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vpi
op_ne
id|ATM_VPI_UNSPEC
op_logical_and
id|vpi
op_ne
id|ATM_VPI_ANY
op_logical_and
id|vpi
op_rshift
id|dev-&gt;ci_range.vpi_bits
)paren
op_logical_or
(paren
id|vci
op_ne
id|ATM_VCI_UNSPEC
op_logical_and
id|vci
op_ne
id|ATM_VCI_ANY
op_logical_and
id|vci
op_rshift
id|dev-&gt;ci_range.vci_bits
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vci
OG
l_int|0
op_logical_and
id|vci
OL
id|ATM_NOT_RSV_VCI
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_BIND_SERVICE
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
id|bind_vcc
c_func
(paren
id|vcc
comma
id|dev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vcc-&gt;qos.aal
)paren
(brace
r_case
id|ATM_AAL0
suffix:colon
id|error
op_assign
id|atm_init_aal0
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|vcc-&gt;stats
op_assign
op_amp
id|dev-&gt;stats.aal0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL34
suffix:colon
id|error
op_assign
id|atm_init_aal34
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|vcc-&gt;stats
op_assign
op_amp
id|dev-&gt;stats.aal34
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_NO_AAL
suffix:colon
multiline_comment|/* ATM_AAL5 is also used in the &quot;0 for default&quot; case */
id|vcc-&gt;qos.aal
op_assign
id|ATM_AAL5
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|ATM_AAL5
suffix:colon
id|error
op_assign
id|atm_init_aal5
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|vcc-&gt;stats
op_assign
op_amp
id|dev-&gt;stats.aal5
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|error
op_assign
op_minus
id|EPROTOTYPE
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|adjust_tp
c_func
(paren
op_amp
id|vcc-&gt;qos.txtp
comma
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|adjust_tp
c_func
(paren
op_amp
id|vcc-&gt;qos.rxtp
comma
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|bind_vcc
c_func
(paren
id|vcc
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;VCC %d.%d, AAL %d&bslash;n&quot;
comma
id|vpi
comma
id|vci
comma
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;  TX: %d, PCR %d..%d, SDU %d&bslash;n&quot;
comma
id|vcc-&gt;qos.txtp.traffic_class
comma
id|vcc-&gt;qos.txtp.min_pcr
comma
id|vcc-&gt;qos.txtp.max_pcr
comma
id|vcc-&gt;qos.txtp.max_sdu
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;  RX: %d, PCR %d..%d, SDU %d&bslash;n&quot;
comma
id|vcc-&gt;qos.rxtp.traffic_class
comma
id|vcc-&gt;qos.rxtp.min_pcr
comma
id|vcc-&gt;qos.rxtp.max_pcr
comma
id|vcc-&gt;qos.rxtp.max_sdu
)paren
suffix:semicolon
id|fops_get
(paren
id|dev-&gt;ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;ops-&gt;open
)paren
(brace
id|error
op_assign
id|dev-&gt;ops
op_member_access_from_pointer
id|open
c_func
(paren
id|vcc
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|fops_put
(paren
id|dev-&gt;ops
)paren
suffix:semicolon
id|bind_vcc
c_func
(paren
id|vcc
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atm_do_connect
r_static
r_int
id|atm_do_connect
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|itf
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
suffix:semicolon
r_int
id|return_val
suffix:semicolon
id|spin_lock
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
id|dev
op_assign
id|atm_find_dev
c_func
(paren
id|itf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
id|return_val
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_else
id|return_val
op_assign
id|atm_do_connect_dev
c_func
(paren
id|vcc
comma
id|dev
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
id|spin_unlock
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
r_return
id|return_val
suffix:semicolon
)brace
DECL|function|atm_connect_vcc
r_int
id|atm_connect_vcc
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|itf
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
(brace
r_if
c_cond
(paren
id|vpi
op_ne
id|ATM_VPI_UNSPEC
op_logical_and
id|vci
op_ne
id|ATM_VCI_UNSPEC
)paren
id|clear_bit
c_func
(paren
id|ATM_VF_PARTIAL
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_PARTIAL
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;atm_connect (TX: cl %d,bw %d-%d,sdu %d; &quot;
l_string|&quot;RX: cl %d,bw %d-%d,sdu %d,AAL %s%d)&bslash;n&quot;
comma
id|vcc-&gt;qos.txtp.traffic_class
comma
id|vcc-&gt;qos.txtp.min_pcr
comma
id|vcc-&gt;qos.txtp.max_pcr
comma
id|vcc-&gt;qos.txtp.max_sdu
comma
id|vcc-&gt;qos.rxtp.traffic_class
comma
id|vcc-&gt;qos.rxtp.min_pcr
comma
id|vcc-&gt;qos.rxtp.max_pcr
comma
id|vcc-&gt;qos.rxtp.max_sdu
comma
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL5
ques
c_cond
l_string|&quot;&quot;
suffix:colon
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot; ??? code &quot;
comma
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
ques
c_cond
l_int|0
suffix:colon
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_HASQOS
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
op_minus
id|EBADFD
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_eq
id|ATM_ANYCLASS
op_logical_or
id|vcc-&gt;qos.rxtp.traffic_class
op_eq
id|ATM_ANYCLASS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|itf
op_ne
id|ATM_ITF_ANY
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|atm_do_connect
c_func
(paren
id|vcc
comma
id|itf
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
)brace
r_else
(brace
r_struct
id|atm_dev
op_star
id|dev
suffix:semicolon
id|spin_lock
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|atm_devs
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
r_if
c_cond
(paren
op_logical_neg
id|atm_do_connect_dev
c_func
(paren
id|vcc
comma
id|dev
comma
id|vpi
comma
id|vci
)paren
)paren
r_break
suffix:semicolon
id|spin_unlock
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vpi
op_eq
id|ATM_VPI_UNSPEC
op_logical_or
id|vci
op_eq
id|ATM_VCI_UNSPEC
)paren
id|set_bit
c_func
(paren
id|ATM_VF_PARTIAL
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atm_connect
r_int
id|atm_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|itf
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
(brace
r_int
id|error
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;atm_connect (vpi %d, vci %d)&bslash;n&quot;
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTED
)paren
r_return
op_minus
id|EISCONN
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|vpi
op_logical_or
id|vci
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|error
op_assign
id|atm_connect_vcc
c_func
(paren
id|ATM_SD
c_func
(paren
id|sock
)paren
comma
id|itf
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|ATM_SD
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|flags
)paren
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atm_recvmsg
r_int
id|atm_recvmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|m
comma
r_int
id|total_len
comma
r_int
id|flags
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|eff_len
comma
id|error
suffix:semicolon
r_void
op_star
id|buff
suffix:semicolon
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTED
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
op_complement
id|MSG_DONTWAIT
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;msg_iovlen
op_ne
l_int|1
)paren
r_return
op_minus
id|ENOSYS
suffix:semicolon
multiline_comment|/* fix this later @@@ */
id|buff
op_assign
id|m-&gt;msg_iov-&gt;iov_base
suffix:semicolon
id|size
op_assign
id|m-&gt;msg_iov-&gt;iov_len
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|vcc-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|error
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* &lt;= 0 is error */
r_while
c_loop
(paren
op_logical_neg
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|vcc-&gt;recvq
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_RELEASED
comma
op_amp
id|vcc-&gt;flags
)paren
op_logical_or
id|test_bit
c_func
(paren
id|ATM_VF_CLOSE
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
id|vcc-&gt;reply
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_DONTWAIT
)paren
(brace
id|error
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|error
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|vcc-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_le
l_int|0
)paren
r_return
id|error
suffix:semicolon
id|vcc-&gt;timestamp
op_assign
id|skb-&gt;stamp
suffix:semicolon
id|eff_len
op_assign
id|skb-&gt;len
OG
id|size
ques
c_cond
id|size
suffix:colon
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;dev-&gt;ops-&gt;feedback
)paren
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|feedback
c_func
(paren
id|vcc
comma
id|skb
comma
(paren
r_int
r_int
)paren
id|skb-&gt;data
comma
(paren
r_int
r_int
)paren
id|buff
comma
id|eff_len
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;RcvM %d -= %d&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;rx_inuse
)paren
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|atm_return
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
)paren
(brace
multiline_comment|/* @@@ hack */
multiline_comment|/* iovcnt set, use scatter-gather for receive */
r_int
id|el
comma
id|cnt
suffix:semicolon
r_struct
id|iovec
op_star
id|iov
op_assign
(paren
r_struct
id|iovec
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
id|buff
suffix:semicolon
id|el
op_assign
id|eff_len
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
(paren
id|cnt
OL
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
)paren
op_logical_and
id|el
suffix:semicolon
id|cnt
op_increment
)paren
(brace
multiline_comment|/*printk(&quot;s-g???: %p -&gt; %p (%d)&bslash;n&quot;,iov-&gt;iov_base,p,iov-&gt;iov_len);*/
id|error
op_assign
id|copy_to_user
c_func
(paren
id|p
comma
id|iov-&gt;iov_base
comma
(paren
id|iov-&gt;iov_len
OG
id|el
)paren
ques
c_cond
id|el
suffix:colon
id|iov-&gt;iov_len
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_break
suffix:semicolon
id|p
op_add_assign
id|iov-&gt;iov_len
suffix:semicolon
id|el
op_sub_assign
(paren
id|iov-&gt;iov_len
OG
id|el
)paren
ques
c_cond
id|el
suffix:colon
id|iov-&gt;iov_len
suffix:semicolon
id|iov
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;dev-&gt;ops-&gt;free_rx_skb
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_else
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|free_rx_skb
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_return
id|error
ques
c_cond
id|error
suffix:colon
id|eff_len
suffix:semicolon
)brace
id|error
op_assign
id|copy_to_user
c_func
(paren
id|buff
comma
id|skb-&gt;data
comma
id|eff_len
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;dev-&gt;ops-&gt;free_rx_skb
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_else
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|free_rx_skb
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_return
id|error
ques
c_cond
id|error
suffix:colon
id|eff_len
suffix:semicolon
)brace
DECL|function|atm_sendmsg
r_int
id|atm_sendmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|m
comma
r_int
id|total_len
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|eff
comma
id|error
suffix:semicolon
r_const
r_void
op_star
id|buff
suffix:semicolon
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTED
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;msg_name
)paren
r_return
op_minus
id|EISCONN
suffix:semicolon
r_if
c_cond
(paren
id|m-&gt;msg_iovlen
op_ne
l_int|1
)paren
r_return
op_minus
id|ENOSYS
suffix:semicolon
multiline_comment|/* fix this later @@@ */
id|buff
op_assign
id|m-&gt;msg_iov-&gt;iov_base
suffix:semicolon
id|size
op_assign
id|m-&gt;msg_iov-&gt;iov_len
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_RELEASED
comma
op_amp
id|vcc-&gt;flags
)paren
op_logical_or
id|test_bit
c_func
(paren
id|ATM_VF_CLOSE
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
id|vcc-&gt;reply
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
op_minus
id|EPIPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|size
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|size
template_param
id|vcc-&gt;qos.txtp.max_sdu
)paren
r_return
op_minus
id|EMSGSIZE
suffix:semicolon
multiline_comment|/* verify_area is done by net/socket.c */
id|eff
op_assign
(paren
id|size
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
multiline_comment|/* align to word boundary */
id|add_wait_queue
c_func
(paren
op_amp
id|vcc-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|skb
op_assign
id|vcc
op_member_access_from_pointer
id|alloc_tx
c_func
(paren
id|vcc
comma
id|eff
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|m-&gt;msg_flags
op_amp
id|MSG_DONTWAIT
)paren
(brace
id|error
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|error
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_RELEASED
comma
op_amp
id|vcc-&gt;flags
)paren
op_logical_or
id|test_bit
c_func
(paren
id|ATM_VF_CLOSE
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
id|vcc-&gt;reply
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPIPE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|vcc-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|skb-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* for paths shared with net_device interfaces */
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
op_assign
l_int|0
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|atm_options
op_assign
id|vcc-&gt;atm_options
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|size
)paren
comma
id|buff
comma
id|size
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|eff
op_ne
id|size
)paren
id|memset
c_func
(paren
id|skb-&gt;data
op_plus
id|size
comma
l_int|0
comma
id|eff
op_minus
id|size
)paren
suffix:semicolon
id|error
op_assign
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|send
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_return
id|error
ques
c_cond
id|error
suffix:colon
id|size
suffix:semicolon
)brace
DECL|function|atm_poll
r_int
r_int
id|atm_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|socket
op_star
id|sock
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|vcc-&gt;sleep
comma
id|wait
)paren
suffix:semicolon
id|mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb_peek
c_func
(paren
op_amp
id|vcc-&gt;recvq
)paren
op_logical_or
id|skb_peek
c_func
(paren
op_amp
id|vcc-&gt;listenq
)paren
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_RELEASED
comma
op_amp
id|vcc-&gt;flags
)paren
op_logical_or
id|test_bit
c_func
(paren
id|ATM_VF_CLOSE
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
id|mask
op_or_assign
id|POLLHUP
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTING
)paren
(brace
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
op_logical_and
id|vcc-&gt;qos.txtp.max_sdu
op_plus
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;tx_inuse
)paren
op_plus
id|ATM_PDU_OVHD
op_le
id|vcc-&gt;sk-&gt;sndbuf
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vcc-&gt;reply
op_ne
id|WAITING
)paren
(brace
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;reply
)paren
id|mask
op_or_assign
id|POLLERR
suffix:semicolon
)brace
r_return
id|mask
suffix:semicolon
)brace
DECL|function|copy_aal_stats
r_static
r_void
id|copy_aal_stats
c_func
(paren
r_struct
id|k_atm_aal_stats
op_star
id|from
comma
r_struct
id|atm_aal_stats
op_star
id|to
)paren
(brace
DECL|macro|__HANDLE_ITEM
mdefine_line|#define __HANDLE_ITEM(i) to-&gt;i = atomic_read(&amp;from-&gt;i)
id|__AAL_STAT_ITEMS
DECL|macro|__HANDLE_ITEM
macro_line|#undef __HANDLE_ITEM
)brace
DECL|function|subtract_aal_stats
r_static
r_void
id|subtract_aal_stats
c_func
(paren
r_struct
id|k_atm_aal_stats
op_star
id|from
comma
r_struct
id|atm_aal_stats
op_star
id|to
)paren
(brace
DECL|macro|__HANDLE_ITEM
mdefine_line|#define __HANDLE_ITEM(i) atomic_sub(to-&gt;i,&amp;from-&gt;i)
id|__AAL_STAT_ITEMS
DECL|macro|__HANDLE_ITEM
macro_line|#undef __HANDLE_ITEM
)brace
DECL|function|fetch_stats
r_static
r_int
id|fetch_stats
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_struct
id|atm_dev_stats
op_star
id|arg
comma
r_int
id|zero
)paren
(brace
r_struct
id|atm_dev_stats
id|tmp
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
id|copy_aal_stats
c_func
(paren
op_amp
id|dev-&gt;stats.aal0
comma
op_amp
id|tmp.aal0
)paren
suffix:semicolon
id|copy_aal_stats
c_func
(paren
op_amp
id|dev-&gt;stats.aal34
comma
op_amp
id|tmp.aal34
)paren
suffix:semicolon
id|copy_aal_stats
c_func
(paren
op_amp
id|dev-&gt;stats.aal5
comma
op_amp
id|tmp.aal5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arg
)paren
id|error
op_assign
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|zero
op_logical_and
op_logical_neg
id|error
)paren
(brace
id|subtract_aal_stats
c_func
(paren
op_amp
id|dev-&gt;stats.aal0
comma
op_amp
id|tmp.aal0
)paren
suffix:semicolon
id|subtract_aal_stats
c_func
(paren
op_amp
id|dev-&gt;stats.aal34
comma
op_amp
id|tmp.aal34
)paren
suffix:semicolon
id|subtract_aal_stats
c_func
(paren
op_amp
id|dev-&gt;stats.aal5
comma
op_amp
id|tmp.aal5
)paren
suffix:semicolon
)brace
r_return
id|error
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|atm_ioctl
r_int
id|atm_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_int
op_star
id|tmp_buf
suffix:semicolon
r_void
op_star
id|buf
suffix:semicolon
r_int
id|error
comma
id|len
comma
id|size
comma
id|number
comma
id|ret_val
suffix:semicolon
id|ret_val
op_assign
l_int|0
suffix:semicolon
id|spin_lock
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCOUTQ
suffix:colon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTED
op_logical_or
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|ret_val
op_assign
id|put_user
c_func
(paren
id|vcc-&gt;sk-&gt;sndbuf
op_minus
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;tx_inuse
)paren
op_minus
id|ATM_PDU_OVHD
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|SIOCINQ
suffix:colon
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTED
)paren
(brace
id|ret_val
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|vcc-&gt;recvq
)paren
suffix:semicolon
id|ret_val
op_assign
id|put_user
c_func
(paren
id|skb
ques
c_cond
id|skb-&gt;len
suffix:colon
l_int|0
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_case
id|ATM_GETNAMES
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|buf
comma
op_amp
(paren
(paren
r_struct
id|atm_iobuf
op_star
)paren
id|arg
)paren
op_member_access_from_pointer
id|buffer
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|len
comma
op_amp
(paren
(paren
r_struct
id|atm_iobuf
op_star
)paren
id|arg
)paren
op_member_access_from_pointer
id|length
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|size
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|atm_devs
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
id|size
op_add_assign
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|len
)paren
(brace
id|ret_val
op_assign
op_minus
id|E2BIG
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|tmp_buf
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tmp_buf
)paren
(brace
id|ret_val
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_for
c_loop
(paren
id|dev
op_assign
id|atm_devs
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
op_star
id|tmp_buf
op_increment
op_assign
id|dev-&gt;number
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
(paren
r_char
op_star
)paren
id|tmp_buf
op_minus
id|size
comma
id|size
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|ret_val
op_assign
id|put_user
c_func
(paren
id|size
comma
op_amp
(paren
(paren
r_struct
id|atm_iobuf
op_star
)paren
id|arg
)paren
op_member_access_from_pointer
id|length
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|SIOCGSTAMP
suffix:colon
multiline_comment|/* borrowed from IP */
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;timestamp.tv_sec
)paren
(brace
id|ret_val
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|vcc-&gt;timestamp.tv_sec
op_add_assign
id|vcc-&gt;timestamp.tv_usec
op_div
l_int|1000000
suffix:semicolon
id|vcc-&gt;timestamp.tv_usec
op_mod_assign
l_int|1000000
suffix:semicolon
id|ret_val
op_assign
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|vcc-&gt;timestamp
comma
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATM_SETSC
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ATM_SETSC is obsolete&bslash;n&quot;
)paren
suffix:semicolon
id|ret_val
op_assign
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMSIGD_CTRL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; * The user/kernel protocol for exchanging signalling&n;&t;&t;&t; * info uses kernel pointers as opaque references,&n;&t;&t;&t; * so the holder of the file descriptor can scribble&n;&t;&t;&t; * on the kernel... so we should make sure that we&n;&t;&t;&t; * have the same privledges that /proc/kcore needs&n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|sigd_attach
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|ret_val
op_assign
id|error
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#ifdef CONFIG_ATM_CLIP
r_case
id|SIOCMKCLIP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_else
id|ret_val
op_assign
id|clip_create
c_func
(paren
id|arg
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMARPD_CTRL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|atm_init_atmarp
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|ret_val
op_assign
id|error
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMARP_MKIP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_else
id|ret_val
op_assign
id|clip_mkip
c_func
(paren
id|vcc
comma
id|arg
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMARP_SETENTRY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_else
id|ret_val
op_assign
id|clip_setentry
c_func
(paren
id|vcc
comma
id|arg
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMARP_ENCAP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_else
id|ret_val
op_assign
id|clip_encap
c_func
(paren
id|vcc
comma
id|arg
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_LANE) || defined(CONFIG_ATM_LANE_MODULE)
r_case
id|ATMLEC_CTRL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|atm_lane_ops.lecd_attach
op_eq
l_int|NULL
)paren
id|atm_lane_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atm_lane_ops.lecd_attach
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* try again */
id|ret_val
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|atm_lane_ops
dot
id|lecd_attach
c_func
(paren
id|vcc
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ge
l_int|0
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|ret_val
op_assign
id|error
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMLEC_MCAST
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_else
id|ret_val
op_assign
id|atm_lane_ops
dot
id|mcast_attach
c_func
(paren
id|vcc
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMLEC_DATA
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_else
id|ret_val
op_assign
id|atm_lane_ops
dot
id|vcc_attach
c_func
(paren
id|vcc
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_MPOA) || defined(CONFIG_ATM_MPOA_MODULE)
r_case
id|ATMMPC_CTRL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|atm_mpoa_ops.mpoad_attach
op_eq
l_int|NULL
)paren
id|atm_mpoa_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atm_mpoa_ops.mpoad_attach
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* try again */
id|ret_val
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|atm_mpoa_ops
dot
id|mpoad_attach
c_func
(paren
id|vcc
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ge
l_int|0
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|ret_val
op_assign
id|error
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMMPC_DATA
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_else
id|ret_val
op_assign
id|atm_mpoa_ops
dot
id|vcc_attach
c_func
(paren
id|vcc
comma
id|arg
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_TCP) || defined(CONFIG_ATM_TCP_MODULE)
r_case
id|SIOCSIFATMTCP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atm_tcp_ops.attach
)paren
(brace
id|ret_val
op_assign
op_minus
id|ENOPKG
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|fops_get
(paren
op_amp
id|atm_tcp_ops
)paren
suffix:semicolon
id|error
op_assign
id|atm_tcp_ops
dot
id|attach
c_func
(paren
id|vcc
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ge
l_int|0
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_else
id|fops_put
(paren
op_amp
id|atm_tcp_ops
)paren
suffix:semicolon
id|ret_val
op_assign
id|error
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMTCP_CREATE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atm_tcp_ops.create_persistent
)paren
(brace
id|ret_val
op_assign
op_minus
id|ENOPKG
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|atm_tcp_ops
dot
id|create_persistent
c_func
(paren
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
OL
l_int|0
)paren
id|fops_put
(paren
op_amp
id|atm_tcp_ops
)paren
suffix:semicolon
id|ret_val
op_assign
id|error
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMTCP_REMOVE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atm_tcp_ops.remove_persistent
)paren
(brace
id|ret_val
op_assign
op_minus
id|ENOPKG
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|atm_tcp_ops
dot
id|remove_persistent
c_func
(paren
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
id|fops_put
(paren
op_amp
id|atm_tcp_ops
)paren
suffix:semicolon
id|ret_val
op_assign
id|error
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|buf
comma
op_amp
(paren
(paren
r_struct
id|atmif_sioc
op_star
)paren
id|arg
)paren
op_member_access_from_pointer
id|arg
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|len
comma
op_amp
(paren
(paren
r_struct
id|atmif_sioc
op_star
)paren
id|arg
)paren
op_member_access_from_pointer
id|length
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|number
comma
op_amp
(paren
(paren
r_struct
id|atmif_sioc
op_star
)paren
id|arg
)paren
op_member_access_from_pointer
id|number
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev
op_assign
id|atm_find_dev
c_func
(paren
id|number
)paren
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|size
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|ATM_GETTYPE
suffix:colon
id|size
op_assign
id|strlen
c_func
(paren
id|dev-&gt;type
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|dev-&gt;type
comma
id|size
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ATM_GETESI
suffix:colon
id|size
op_assign
id|ESI_LEN
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|dev-&gt;esi
comma
id|size
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ATM_SETESI
suffix:colon
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ESI_LEN
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;esi
(braket
id|i
)braket
)paren
(brace
id|ret_val
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
)brace
multiline_comment|/* fall through */
r_case
id|ATM_SETESIF
suffix:colon
(brace
r_int
r_char
id|esi
(braket
id|ESI_LEN
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|esi
comma
id|buf
comma
id|ESI_LEN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|dev-&gt;esi
comma
id|esi
comma
id|ESI_LEN
)paren
suffix:semicolon
id|ret_val
op_assign
id|ESI_LEN
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_case
id|ATM_GETSTATZ
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* fall through */
r_case
id|ATM_GETSTAT
suffix:colon
id|size
op_assign
r_sizeof
(paren
r_struct
id|atm_dev_stats
)paren
suffix:semicolon
id|error
op_assign
id|fetch_stats
c_func
(paren
id|dev
comma
id|buf
comma
id|cmd
op_eq
id|ATM_GETSTATZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|ret_val
op_assign
id|error
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ATM_GETCIRANGE
suffix:colon
id|size
op_assign
r_sizeof
(paren
r_struct
id|atm_cirange
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
op_amp
id|dev-&gt;ci_range
comma
id|size
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ATM_GETLINKRATE
suffix:colon
id|size
op_assign
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
op_amp
id|dev-&gt;link_rate
comma
id|size
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ATM_RSTADDR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|reset_addr
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_ADDADDR
suffix:colon
r_case
id|ATM_DELADDR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
(brace
r_struct
id|sockaddr_atmsvc
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|addr
comma
id|buf
comma
r_sizeof
(paren
id|addr
)paren
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|ATM_ADDADDR
)paren
id|ret_val
op_assign
id|add_addr
c_func
(paren
id|dev
comma
op_amp
id|addr
)paren
suffix:semicolon
r_else
id|ret_val
op_assign
id|del_addr
c_func
(paren
id|dev
comma
op_amp
id|addr
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_case
id|ATM_GETADDR
suffix:colon
id|size
op_assign
id|get_addr
c_func
(paren
id|dev
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
l_int|0
)paren
id|ret_val
op_assign
id|size
suffix:semicolon
r_else
multiline_comment|/* may return 0, but later on size == 0 means &quot;don&squot;t&n;&t;&t;&t;   write the length&quot; */
id|ret_val
op_assign
id|put_user
c_func
(paren
id|size
comma
op_amp
(paren
(paren
r_struct
id|atmif_sioc
op_star
)paren
id|arg
)paren
op_member_access_from_pointer
id|length
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATM_SETLOOP
suffix:colon
r_if
c_cond
(paren
id|__ATM_LM_XTRMT
c_func
(paren
(paren
r_int
)paren
(paren
r_int
)paren
id|buf
)paren
op_logical_and
id|__ATM_LM_XTLOC
c_func
(paren
(paren
r_int
)paren
(paren
r_int
)paren
id|buf
)paren
OG
id|__ATM_LM_XTRMT
c_func
(paren
(paren
r_int
)paren
(paren
r_int
)paren
id|buf
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* fall through */
r_case
id|ATM_SETCIRANGE
suffix:colon
r_case
id|SONET_GETSTATZ
suffix:colon
r_case
id|SONET_SETDIAG
suffix:colon
r_case
id|SONET_CLRDIAG
suffix:colon
r_case
id|SONET_SETFRAMING
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|ret_val
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* fall through */
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;ops-&gt;ioctl
)paren
(brace
id|ret_val
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|size
op_assign
id|dev-&gt;ops
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|dev
comma
id|cmd
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
l_int|0
)paren
(brace
id|ret_val
op_assign
(paren
id|size
op_eq
op_minus
id|ENOIOCTLCMD
ques
c_cond
op_minus
id|EINVAL
suffix:colon
id|size
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|size
)paren
id|ret_val
op_assign
id|put_user
c_func
(paren
id|size
comma
op_amp
(paren
(paren
r_struct
id|atmif_sioc
op_star
)paren
id|arg
)paren
op_member_access_from_pointer
id|length
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
id|done
suffix:colon
id|spin_unlock
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
r_return
id|ret_val
suffix:semicolon
)brace
DECL|function|atm_change_qos
r_static
r_int
id|atm_change_qos
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_qos
op_star
id|qos
)paren
(brace
r_int
id|error
suffix:semicolon
multiline_comment|/*&n;&t; * Don&squot;t let the QoS change the already connected AAL type nor the&n;&t; * traffic class.&n;&t; */
r_if
c_cond
(paren
id|qos-&gt;aal
op_ne
id|vcc-&gt;qos.aal
op_logical_or
id|qos-&gt;rxtp.traffic_class
op_ne
id|vcc-&gt;qos.rxtp.traffic_class
op_logical_or
id|qos-&gt;txtp.traffic_class
op_ne
id|vcc-&gt;qos.txtp.traffic_class
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|error
op_assign
id|adjust_tp
c_func
(paren
op_amp
id|qos-&gt;txtp
comma
id|qos-&gt;aal
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|adjust_tp
c_func
(paren
op_amp
id|qos-&gt;rxtp
comma
id|qos-&gt;aal
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;dev-&gt;ops-&gt;change_qos
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;family
op_eq
id|AF_ATMPVC
)paren
r_return
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|change_qos
c_func
(paren
id|vcc
comma
id|qos
comma
id|ATM_MF_SET
)paren
suffix:semicolon
r_return
id|svc_change_qos
c_func
(paren
id|vcc
comma
id|qos
)paren
suffix:semicolon
)brace
DECL|function|check_tp
r_static
r_int
id|check_tp
c_func
(paren
r_struct
id|atm_trafprm
op_star
id|tp
)paren
(brace
multiline_comment|/* @@@ Should be merged with adjust_tp */
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;traffic_class
op_logical_or
id|tp-&gt;traffic_class
op_eq
id|ATM_ANYCLASS
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;traffic_class
op_ne
id|ATM_UBR
op_logical_and
op_logical_neg
id|tp-&gt;min_pcr
op_logical_and
op_logical_neg
id|tp-&gt;pcr
op_logical_and
op_logical_neg
id|tp-&gt;max_pcr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;min_pcr
op_eq
id|ATM_MAX_PCR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;min_pcr
op_logical_and
id|tp-&gt;max_pcr
op_logical_and
id|tp-&gt;max_pcr
op_ne
id|ATM_MAX_PCR
op_logical_and
id|tp-&gt;min_pcr
OG
id|tp-&gt;max_pcr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t; * We allow pcr to be outside [min_pcr,max_pcr], because later&n;&t; * adjustment may still push it in the valid range.&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|check_qos
r_static
r_int
id|check_qos
c_func
(paren
r_struct
id|atm_qos
op_star
id|qos
)paren
(brace
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qos-&gt;txtp.traffic_class
op_logical_and
op_logical_neg
id|qos-&gt;rxtp.traffic_class
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|qos-&gt;txtp.traffic_class
op_ne
id|qos-&gt;rxtp.traffic_class
op_logical_and
id|qos-&gt;txtp.traffic_class
op_logical_and
id|qos-&gt;rxtp.traffic_class
op_logical_and
id|qos-&gt;txtp.traffic_class
op_ne
id|ATM_ANYCLASS
op_logical_and
id|qos-&gt;rxtp.traffic_class
op_ne
id|ATM_ANYCLASS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|error
op_assign
id|check_tp
c_func
(paren
op_amp
id|qos-&gt;txtp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_return
id|check_tp
c_func
(paren
op_amp
id|qos-&gt;rxtp
)paren
suffix:semicolon
)brace
DECL|function|atm_do_setsockopt
r_static
r_int
id|atm_do_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_void
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_int
r_int
id|value
suffix:semicolon
r_int
id|error
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|SO_ATMQOS
suffix:colon
(brace
r_struct
id|atm_qos
id|qos
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|qos
comma
id|optval
comma
r_sizeof
(paren
id|qos
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|error
op_assign
id|check_qos
c_func
(paren
op_amp
id|qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTED
)paren
r_return
id|atm_change_qos
c_func
(paren
id|vcc
comma
op_amp
id|qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
)paren
r_return
op_minus
id|EBADFD
suffix:semicolon
id|vcc-&gt;qos
op_assign
id|qos
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_HASQOS
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SO_SETCLP
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|value
comma
(paren
r_int
r_int
op_star
)paren
id|optval
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|value
)paren
id|vcc-&gt;atm_options
op_or_assign
id|ATM_ATMOPT_CLP
suffix:semicolon
r_else
id|vcc-&gt;atm_options
op_and_assign
op_complement
id|ATM_ATMOPT_CLP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|level
op_eq
id|SOL_SOCKET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;dev
op_logical_or
op_logical_neg
id|vcc-&gt;dev-&gt;ops-&gt;setsockopt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|setsockopt
c_func
(paren
id|vcc
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
)brace
DECL|function|atm_do_getsockopt
r_static
r_int
id|atm_do_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_void
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|SO_ATMQOS
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_HASQOS
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|optval
comma
op_amp
id|vcc-&gt;qos
comma
r_sizeof
(paren
id|vcc-&gt;qos
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SO_SETCLP
suffix:colon
r_return
id|put_user
c_func
(paren
id|vcc-&gt;atm_options
op_amp
id|ATM_ATMOPT_CLP
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
(paren
r_int
r_int
op_star
)paren
id|optval
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SO_ATMPVC
suffix:colon
(brace
r_struct
id|sockaddr_atmpvc
id|pvc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;dev
op_logical_or
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|pvc.sap_family
op_assign
id|AF_ATMPVC
suffix:semicolon
id|pvc.sap_addr.itf
op_assign
id|vcc-&gt;dev-&gt;number
suffix:semicolon
id|pvc.sap_addr.vpi
op_assign
id|vcc-&gt;vpi
suffix:semicolon
id|pvc.sap_addr.vci
op_assign
id|vcc-&gt;vci
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|optval
comma
op_amp
id|pvc
comma
r_sizeof
(paren
id|pvc
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|level
op_eq
id|SOL_SOCKET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;dev
op_logical_or
op_logical_neg
id|vcc-&gt;dev-&gt;ops-&gt;getsockopt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|getsockopt
c_func
(paren
id|vcc
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
)brace
DECL|function|atm_setsockopt
r_int
id|atm_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_if
c_cond
(paren
id|__SO_LEVEL_MATCH
c_func
(paren
id|optname
comma
id|level
)paren
op_logical_and
id|optlen
op_ne
id|__SO_SIZE
c_func
(paren
id|optname
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|atm_do_setsockopt
c_func
(paren
id|sock
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
)brace
DECL|function|atm_getsockopt
r_int
id|atm_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|len
comma
id|optlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|__SO_LEVEL_MATCH
c_func
(paren
id|optname
comma
id|level
)paren
op_logical_and
id|len
op_ne
id|__SO_SIZE
c_func
(paren
id|optname
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|atm_do_getsockopt
c_func
(paren
id|sock
comma
id|level
comma
id|optname
comma
id|optval
comma
id|len
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * lane_mpoa_init.c: A couple of helper functions&n; * to make modular LANE and MPOA client easier to implement&n; */
multiline_comment|/*&n; * This is how it goes:&n; *&n; * if xxxx is not compiled as module, call atm_xxxx_init_ops()&n; *    from here&n; * else call atm_mpoa_init_ops() from init_module() within&n; *    the kernel when xxxx module is loaded&n; *&n; * In either case function pointers in struct atm_xxxx_ops&n; * are initialized to their correct values. Either they&n; * point to functions in the module or in the kernel&n; */
r_extern
r_struct
id|atm_mpoa_ops
id|atm_mpoa_ops
suffix:semicolon
multiline_comment|/* in common.c */
r_extern
r_struct
id|atm_lane_ops
id|atm_lane_ops
suffix:semicolon
multiline_comment|/* in common.c */
macro_line|#if defined(CONFIG_ATM_MPOA) || defined(CONFIG_ATM_MPOA_MODULE)
DECL|function|atm_mpoa_init
r_void
id|atm_mpoa_init
c_func
(paren
r_void
)paren
(brace
macro_line|#ifndef CONFIG_ATM_MPOA_MODULE /* not module */
id|atm_mpoa_init_ops
c_func
(paren
op_amp
id|atm_mpoa_ops
)paren
suffix:semicolon
macro_line|#else
id|request_module
c_func
(paren
l_string|&quot;mpoa&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_LANE) || defined(CONFIG_ATM_LANE_MODULE)
macro_line|#if defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE)
DECL|variable|br_fdb_get_hook
r_struct
id|net_bridge_fdb_entry
op_star
(paren
op_star
id|br_fdb_get_hook
)paren
(paren
r_struct
id|net_bridge
op_star
id|br
comma
r_int
r_char
op_star
id|addr
)paren
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|br_fdb_put_hook
r_void
(paren
op_star
id|br_fdb_put_hook
)paren
(paren
r_struct
id|net_bridge_fdb_entry
op_star
id|ent
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#if defined(CONFIG_ATM_LANE_MODULE) || defined(CONFIG_BRIDGE_MODULE)
DECL|variable|br_fdb_get_hook
id|EXPORT_SYMBOL
c_func
(paren
id|br_fdb_get_hook
)paren
suffix:semicolon
DECL|variable|br_fdb_put_hook
id|EXPORT_SYMBOL
c_func
(paren
id|br_fdb_put_hook
)paren
suffix:semicolon
macro_line|#endif /* defined(CONFIG_ATM_LANE_MODULE) || defined(CONFIG_BRIDGE_MODULE) */
macro_line|#endif /* defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE) */
DECL|function|atm_lane_init
r_void
id|atm_lane_init
c_func
(paren
r_void
)paren
(brace
macro_line|#ifndef CONFIG_ATM_LANE_MODULE /* not module */
id|atm_lane_init_ops
c_func
(paren
op_amp
id|atm_lane_ops
)paren
suffix:semicolon
macro_line|#else
id|request_module
c_func
(paren
l_string|&quot;lec&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
macro_line|#endif
eof
