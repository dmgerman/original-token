multiline_comment|/*&n; * lec.c: Lan Emulation driver &n; * Marko Kiiskila carnil@cs.tut.fi&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
multiline_comment|/* We are ethernet device */
macro_line|#include &lt;linux/if_ether.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
multiline_comment|/* TokenRing if needed */
macro_line|#ifdef CONFIG_TR
macro_line|#include &lt;linux/trdevice.h&gt;
macro_line|#endif
multiline_comment|/* And atm device */
macro_line|#include &lt;linux/atmdev.h&gt;
macro_line|#include &lt;linux/atmlec.h&gt;
multiline_comment|/* Proxy LEC knows about bridging */
macro_line|#if defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE)
macro_line|#include &lt;linux/if_bridge.h&gt;
macro_line|#include &quot;../bridge/br_private.h&quot;
DECL|variable|bridge_ula_lec
r_static
r_int
r_char
id|bridge_ula_lec
(braket
)braket
op_assign
(brace
l_int|0x01
comma
l_int|0x80
comma
l_int|0xc2
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* Modular too */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;lec.h&quot;
macro_line|#include &quot;lec_arpc.h&quot;
macro_line|#include &quot;resources.h&quot;  /* for bind_vcc() */
macro_line|#if 0
mdefine_line|#define DPRINTK printk
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(format,args...)
macro_line|#endif
DECL|macro|DUMP_PACKETS
mdefine_line|#define DUMP_PACKETS 0 /* 0 = None,&n;                        * 1 = 30 first bytes&n;                        * 2 = Whole packet&n;                        */
DECL|macro|LEC_UNRES_QUE_LEN
mdefine_line|#define LEC_UNRES_QUE_LEN 8 /* number of tx packets to queue for a&n;                               single destination while waiting for SVC */
r_static
r_int
id|lec_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|lec_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|lec_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|lec_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|lec_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
id|__inline__
r_struct
id|lec_arp_table
op_star
id|lec_arp_find
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_int
r_char
op_star
id|mac_addr
)paren
suffix:semicolon
r_static
id|__inline__
r_int
id|lec_arp_remove
c_func
(paren
r_struct
id|lec_arp_table
op_star
op_star
id|lec_arp_tables
comma
r_struct
id|lec_arp_table
op_star
id|to_remove
)paren
suffix:semicolon
multiline_comment|/* LANE2 functions */
r_static
r_void
id|lane2_associate_ind
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u8
op_star
id|mac_address
comma
id|u8
op_star
id|tlvs
comma
id|u32
id|sizeoftlvs
)paren
suffix:semicolon
r_static
r_int
id|lane2_resolve
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u8
op_star
id|dst_mac
comma
r_int
id|force
comma
id|u8
op_star
op_star
id|tlvs
comma
id|u32
op_star
id|sizeoftlvs
)paren
suffix:semicolon
r_static
r_int
id|lane2_associate_req
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u8
op_star
id|lan_dst
comma
id|u8
op_star
id|tlvs
comma
id|u32
id|sizeoftlvs
)paren
suffix:semicolon
DECL|variable|lane2_ops
r_static
r_struct
id|lane2_ops
id|lane2_ops
op_assign
(brace
id|lane2_resolve
comma
multiline_comment|/* resolve,             spec 3.1.3 */
id|lane2_associate_req
comma
multiline_comment|/* associate_req,       spec 3.1.4 */
l_int|NULL
multiline_comment|/* associate indicator, spec 3.1.5 */
)brace
suffix:semicolon
DECL|variable|bus_mac
r_static
r_int
r_char
id|bus_mac
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
multiline_comment|/* Device structures */
DECL|variable|dev_lec
r_static
r_struct
id|net_device
op_star
id|dev_lec
(braket
id|MAX_LEC_ITF
)braket
suffix:semicolon
multiline_comment|/* This will be called from proc.c via function pointer */
DECL|function|get_dev_lec
r_struct
id|net_device
op_star
op_star
id|get_dev_lec
(paren
r_void
)paren
(brace
r_return
op_amp
id|dev_lec
(braket
l_int|0
)braket
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE)
DECL|function|lec_handle_bridge
r_static
r_void
id|lec_handle_bridge
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ethhdr
op_star
id|eth
suffix:semicolon
r_char
op_star
id|buff
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
suffix:semicolon
multiline_comment|/* Check if this is a BPDU. If so, ask zeppelin to send&n;         * LE_TOPOLOGY_REQUEST with the same value of Topology Change bit&n;         * as the Config BPDU has */
id|eth
op_assign
(paren
r_struct
id|ethhdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|buff
op_assign
id|skb-&gt;data
op_plus
id|skb-&gt;dev-&gt;hard_header_len
suffix:semicolon
r_if
c_cond
(paren
op_star
id|buff
op_increment
op_eq
l_int|0x42
op_logical_and
op_star
id|buff
op_increment
op_eq
l_int|0x42
op_logical_and
op_star
id|buff
op_increment
op_eq
l_int|0x03
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
r_struct
id|atmlec_msg
op_star
id|mesg
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|atmlec_msg
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|skb2-&gt;len
op_assign
r_sizeof
(paren
r_struct
id|atmlec_msg
)paren
suffix:semicolon
id|mesg
op_assign
(paren
r_struct
id|atmlec_msg
op_star
)paren
id|skb2-&gt;data
suffix:semicolon
id|mesg-&gt;type
op_assign
id|l_topology_change
suffix:semicolon
id|buff
op_add_assign
l_int|4
suffix:semicolon
id|mesg-&gt;content.normal.flag
op_assign
op_star
id|buff
op_amp
l_int|0x01
suffix:semicolon
multiline_comment|/* 0x01 is topology change */
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|atm_force_charge
c_func
(paren
id|priv-&gt;lecd
comma
id|skb2-&gt;truesize
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|priv-&gt;lecd-&gt;recvq
comma
id|skb2
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|priv-&gt;lecd-&gt;sleep
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
macro_line|#endif /* defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE) */
multiline_comment|/*&n; * Modelled after tr_type_trans&n; * All multicast and ARE or STE frames go to BUS.&n; * Non source routed frames go by destination address.&n; * Last hop source routed frames go by destination address.&n; * Not last hop source routed frames go by _next_ route descriptor.&n; * Returns pointer to destination MAC address or fills in rdesc&n; * and returns NULL.&n; */
macro_line|#ifdef CONFIG_TR
DECL|function|get_tr_dst
r_int
r_char
op_star
id|get_tr_dst
c_func
(paren
r_int
r_char
op_star
id|packet
comma
r_int
r_char
op_star
id|rdesc
)paren
(brace
r_struct
id|trh_hdr
op_star
id|trh
suffix:semicolon
r_int
id|riflen
comma
id|num_rdsc
suffix:semicolon
id|trh
op_assign
(paren
r_struct
id|trh_hdr
op_star
)paren
id|packet
suffix:semicolon
r_if
c_cond
(paren
id|trh-&gt;daddr
(braket
l_int|0
)braket
op_amp
(paren
r_uint8
)paren
l_int|0x80
)paren
r_return
id|bus_mac
suffix:semicolon
multiline_comment|/* multicast */
r_if
c_cond
(paren
id|trh-&gt;saddr
(braket
l_int|0
)braket
op_amp
id|TR_RII
)paren
(brace
id|riflen
op_assign
(paren
id|ntohs
c_func
(paren
id|trh-&gt;rcf
)paren
op_amp
id|TR_RCF_LEN_MASK
)paren
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ntohs
c_func
(paren
id|trh-&gt;rcf
)paren
op_rshift
l_int|13
)paren
op_ne
l_int|0
)paren
r_return
id|bus_mac
suffix:semicolon
multiline_comment|/* ARE or STE */
)brace
r_else
r_return
id|trh-&gt;daddr
suffix:semicolon
multiline_comment|/* not source routed */
r_if
c_cond
(paren
id|riflen
OL
l_int|6
)paren
r_return
id|trh-&gt;daddr
suffix:semicolon
multiline_comment|/* last hop, source routed */
multiline_comment|/* riflen is 6 or more, packet has more than one route descriptor */
id|num_rdsc
op_assign
(paren
id|riflen
op_div
l_int|2
)paren
op_minus
l_int|1
suffix:semicolon
id|memset
c_func
(paren
id|rdesc
comma
l_int|0
comma
id|ETH_ALEN
)paren
suffix:semicolon
multiline_comment|/* offset 4 comes from LAN destination field in LE control frames */
r_if
c_cond
(paren
id|trh-&gt;rcf
op_amp
id|htons
c_func
(paren
(paren
r_uint16
)paren
id|TR_RCF_DIR_BIT
)paren
)paren
id|memcpy
c_func
(paren
op_amp
id|rdesc
(braket
l_int|4
)braket
comma
op_amp
id|trh-&gt;rseg
(braket
id|num_rdsc
op_minus
l_int|2
)braket
comma
r_sizeof
(paren
r_uint16
)paren
)paren
suffix:semicolon
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|rdesc
(braket
l_int|4
)braket
comma
op_amp
id|trh-&gt;rseg
(braket
l_int|1
)braket
comma
r_sizeof
(paren
r_uint16
)paren
)paren
suffix:semicolon
id|rdesc
(braket
l_int|5
)braket
op_assign
(paren
(paren
id|ntohs
c_func
(paren
id|trh-&gt;rseg
(braket
l_int|0
)braket
)paren
op_amp
l_int|0x000f
)paren
op_or
(paren
id|rdesc
(braket
l_int|5
)braket
op_amp
l_int|0xf0
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_TR */
multiline_comment|/*&n; * Open/initialize the netdevice. This is called (in the current kernel)&n; * sometime after booting when the &squot;ifconfig&squot; program is run.&n; *&n; * This routine should set everything up anew at each open, even&n; * registers that &quot;should&quot; only need to be set once at boot, so that&n; * there is non-reboot way to recover if something goes wrong.&n; */
r_static
r_int
DECL|function|lec_open
id|lec_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|priv-&gt;stats
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|lec_send_packet
id|lec_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|lecdatahdr_8023
op_star
id|lec_h
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|send_vcc
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|entry
suffix:semicolon
r_int
r_char
op_star
id|nb
comma
op_star
id|dst
suffix:semicolon
macro_line|#ifdef CONFIG_TR
r_int
r_char
id|rdesc
(braket
id|ETH_ALEN
)braket
suffix:semicolon
multiline_comment|/* Token Ring route descriptor */
macro_line|#endif
r_int
id|is_rdesc
suffix:semicolon
macro_line|#if DUMP_PACKETS &gt; 0
r_char
id|buf
(braket
l_int|300
)braket
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
macro_line|#endif /* DUMP_PACKETS &gt;0 */
id|DPRINTK
c_func
(paren
l_string|&quot;Lec_send_packet called&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;lecd
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s:No lecd attached&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EUNATCH
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;skbuff head:%lx data:%lx tail:%lx end:%lx&bslash;n&quot;
comma
(paren
r_int
)paren
id|skb-&gt;head
comma
(paren
r_int
)paren
id|skb-&gt;data
comma
(paren
r_int
)paren
id|skb-&gt;tail
comma
(paren
r_int
)paren
id|skb-&gt;end
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE)
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|skb-&gt;data
comma
id|bridge_ula_lec
comma
r_sizeof
(paren
id|bridge_ula_lec
)paren
)paren
op_eq
l_int|0
)paren
id|lec_handle_bridge
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Make sure we have room for lec_id */
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
OL
l_int|2
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;lec_send_packet: reallocating skb&bslash;n&quot;
)paren
suffix:semicolon
id|skb2
op_assign
id|skb_realloc_headroom
c_func
(paren
id|skb
comma
id|LEC_HEADER_LEN
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|skb
op_assign
id|skb2
suffix:semicolon
)brace
id|skb_push
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Put le header to place, works for TokenRing too */
id|lec_h
op_assign
(paren
r_struct
id|lecdatahdr_8023
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|lec_h-&gt;le_header
op_assign
id|htons
c_func
(paren
id|priv-&gt;lecid
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_TR
multiline_comment|/* Ugly. Use this to realign Token Ring packets for&n;         * e.g. PCA-200E driver. */
r_if
c_cond
(paren
id|priv-&gt;is_trdev
)paren
(brace
id|skb2
op_assign
id|skb_realloc_headroom
c_func
(paren
id|skb
comma
id|LEC_HEADER_LEN
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|skb
op_assign
id|skb2
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if DUMP_PACKETS &gt; 0
id|printk
c_func
(paren
l_string|&quot;%s: send datalen:%ld lecid:%4.4x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
comma
id|priv-&gt;lecid
)paren
suffix:semicolon
macro_line|#if DUMP_PACKETS &gt;= 2
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb-&gt;len
op_logical_and
id|i
OL
l_int|99
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|buf
op_plus
id|i
op_star
l_int|3
comma
l_string|&quot;%2.2x &quot;
comma
l_int|0xff
op_amp
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#elif DUMP_PACKETS &gt;= 1
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb-&gt;len
op_logical_and
id|i
OL
l_int|30
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|buf
op_plus
id|i
op_star
l_int|3
comma
l_string|&quot;%2.2x &quot;
comma
l_int|0xff
op_amp
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif /* DUMP_PACKETS &gt;= 1 */
r_if
c_cond
(paren
id|i
op_eq
id|skb-&gt;len
)paren
id|printk
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%s...&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
macro_line|#endif /* DUMP_PACKETS &gt; 0 */
multiline_comment|/* Minimum ethernet-frame size */
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|62
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;truesize
OL
l_int|62
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s:data packet %d / %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|nb
op_assign
(paren
r_int
r_char
op_star
)paren
id|kmalloc
c_func
(paren
l_int|64
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|nb
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|skb-&gt;head
)paren
suffix:semicolon
id|skb-&gt;head
op_assign
id|skb-&gt;data
op_assign
id|nb
suffix:semicolon
id|skb-&gt;tail
op_assign
id|nb
op_plus
l_int|62
suffix:semicolon
id|skb-&gt;end
op_assign
id|nb
op_plus
l_int|64
suffix:semicolon
id|skb-&gt;len
op_assign
l_int|62
suffix:semicolon
id|skb-&gt;truesize
op_assign
l_int|64
suffix:semicolon
)brace
r_else
(brace
id|skb-&gt;len
op_assign
l_int|62
suffix:semicolon
)brace
)brace
multiline_comment|/* Send to right vcc */
id|is_rdesc
op_assign
l_int|0
suffix:semicolon
id|dst
op_assign
id|lec_h-&gt;h_dest
suffix:semicolon
macro_line|#ifdef CONFIG_TR
r_if
c_cond
(paren
id|priv-&gt;is_trdev
)paren
(brace
id|dst
op_assign
id|get_tr_dst
c_func
(paren
id|skb-&gt;data
op_plus
l_int|2
comma
id|rdesc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst
op_eq
l_int|NULL
)paren
(brace
id|dst
op_assign
id|rdesc
suffix:semicolon
id|is_rdesc
op_assign
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
id|entry
op_assign
l_int|NULL
suffix:semicolon
id|send_vcc
op_assign
id|lec_arp_resolve
c_func
(paren
id|priv
comma
id|dst
comma
id|is_rdesc
comma
op_amp
id|entry
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;%s:send_vcc:%p vcc_flags:%x, entry:%p&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|send_vcc
comma
id|send_vcc
ques
c_cond
id|send_vcc-&gt;flags
suffix:colon
l_int|0
comma
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|send_vcc
op_logical_or
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|send_vcc-&gt;flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|entry
op_logical_and
(paren
id|entry-&gt;tx_wait.qlen
OL
id|LEC_UNRES_QUE_LEN
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;%s:lec_send_packet: queuing packet, &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;MAC address 0x%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|lec_h-&gt;h_dest
(braket
l_int|0
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|1
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|2
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|3
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|4
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|entry-&gt;tx_wait
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;%s:lec_send_packet: tx queue full or no arp entry, dropping, &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;MAC address 0x%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|lec_h-&gt;h_dest
(braket
l_int|0
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|1
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|2
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|3
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|4
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|priv-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if DUMP_PACKETS &gt; 0                    
id|printk
c_func
(paren
l_string|&quot;%s:sending to vpi:%d vci:%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|send_vcc-&gt;vpi
comma
id|send_vcc-&gt;vci
)paren
suffix:semicolon
macro_line|#endif /* DUMP_PACKETS &gt; 0 */
r_while
c_loop
(paren
id|entry
op_logical_and
(paren
id|skb2
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|entry-&gt;tx_wait
)paren
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;lec.c: emptying tx queue, &quot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;MAC address 0x%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|lec_h-&gt;h_dest
(braket
l_int|0
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|1
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|2
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|3
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|4
)braket
comma
id|lec_h-&gt;h_dest
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb2
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|send_vcc
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb2
)paren
op_member_access_from_pointer
id|iovcnt
op_assign
l_int|0
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb2
)paren
op_member_access_from_pointer
id|atm_options
op_assign
id|send_vcc-&gt;atm_options
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;%s:sending to vpi:%d vci:%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|send_vcc-&gt;vpi
comma
id|send_vcc-&gt;vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atm_may_send
c_func
(paren
id|send_vcc
comma
id|skb2-&gt;len
)paren
)paren
(brace
id|atomic_add
c_func
(paren
id|skb2-&gt;truesize
comma
op_amp
id|send_vcc-&gt;tx_inuse
)paren
suffix:semicolon
id|priv-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|priv-&gt;stats.tx_bytes
op_add_assign
id|skb2-&gt;len
suffix:semicolon
id|send_vcc
op_member_access_from_pointer
id|send
c_func
(paren
id|send_vcc
comma
id|skb2
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
)brace
)brace
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|send_vcc
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
op_assign
l_int|0
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|atm_options
op_assign
id|send_vcc-&gt;atm_options
suffix:semicolon
r_if
c_cond
(paren
id|atm_may_send
c_func
(paren
id|send_vcc
comma
id|skb-&gt;len
)paren
)paren
(brace
id|atomic_add
c_func
(paren
id|skb-&gt;truesize
comma
op_amp
id|send_vcc-&gt;tx_inuse
)paren
suffix:semicolon
id|priv-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|priv-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|send_vcc
op_member_access_from_pointer
id|send
c_func
(paren
id|send_vcc
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* Should we wait for card&squot;s device driver to notify us? */
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
macro_line|#endif        
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The inverse routine to net_open(). */
r_static
r_int
DECL|function|lec_close
id|lec_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the current statistics.&n; * This may be called with the card open or closed.&n; */
r_static
r_struct
id|net_device_stats
op_star
DECL|function|lec_get_stats
id|lec_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
op_amp
(paren
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|stats
suffix:semicolon
)brace
r_static
r_int
DECL|function|lec_atm_send
id|lec_atm_send
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|vcc-&gt;proto_data
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|atmlec_msg
op_star
id|mesg
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|entry
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|tmp
suffix:semicolon
multiline_comment|/* FIXME */
id|atomic_sub
c_func
(paren
id|skb-&gt;truesize
op_plus
id|ATM_PDU_OVHD
comma
op_amp
id|vcc-&gt;tx_inuse
)paren
suffix:semicolon
id|mesg
op_assign
(paren
r_struct
id|atmlec_msg
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|tmp
op_assign
id|skb-&gt;data
suffix:semicolon
id|tmp
op_add_assign
r_sizeof
(paren
r_struct
id|atmlec_msg
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;%s: msg from zeppelin:%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mesg-&gt;type
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mesg-&gt;type
)paren
(brace
r_case
id|l_set_mac_addr
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|mesg-&gt;content.normal.mac_addr
(braket
id|i
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|l_del_mac_addr
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|l_addr_delete
suffix:colon
id|lec_addr_delete
c_func
(paren
id|priv
comma
id|mesg-&gt;content.normal.atm_addr
comma
id|mesg-&gt;content.normal.flag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|l_topology_change
suffix:colon
id|priv-&gt;topology_change
op_assign
id|mesg-&gt;content.normal.flag
suffix:semicolon
r_break
suffix:semicolon
r_case
id|l_flush_complete
suffix:colon
id|lec_flush_complete
c_func
(paren
id|priv
comma
id|mesg-&gt;content.normal.flag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|l_narp_req
suffix:colon
multiline_comment|/* LANE2: see 7.1.35 in the lane2 spec */
id|entry
op_assign
id|lec_arp_find
c_func
(paren
id|priv
comma
id|mesg-&gt;content.normal.mac_addr
)paren
suffix:semicolon
id|lec_arp_remove
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mesg-&gt;content.normal.no_source_le_narp
)paren
r_break
suffix:semicolon
multiline_comment|/* FALL THROUGH */
r_case
id|l_arp_update
suffix:colon
id|lec_arp_update
c_func
(paren
id|priv
comma
id|mesg-&gt;content.normal.mac_addr
comma
id|mesg-&gt;content.normal.atm_addr
comma
id|mesg-&gt;content.normal.flag
comma
id|mesg-&gt;content.normal.targetless_le_arp
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;lec: in l_arp_update&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mesg-&gt;sizeoftlvs
op_ne
l_int|0
)paren
(brace
multiline_comment|/* LANE2 3.1.5 */
id|DPRINTK
c_func
(paren
l_string|&quot;lec: LANE2 3.1.5, got tlvs, size %d&bslash;n&quot;
comma
id|mesg-&gt;sizeoftlvs
)paren
suffix:semicolon
id|lane2_associate_ind
c_func
(paren
id|dev
comma
id|mesg-&gt;content.normal.mac_addr
comma
id|tmp
comma
id|mesg-&gt;sizeoftlvs
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|l_config
suffix:colon
id|priv-&gt;maximum_unknown_frame_count
op_assign
id|mesg-&gt;content.config.maximum_unknown_frame_count
suffix:semicolon
id|priv-&gt;max_unknown_frame_time
op_assign
(paren
id|mesg-&gt;content.config.max_unknown_frame_time
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;max_retry_count
op_assign
id|mesg-&gt;content.config.max_retry_count
suffix:semicolon
id|priv-&gt;aging_time
op_assign
(paren
id|mesg-&gt;content.config.aging_time
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;forward_delay_time
op_assign
(paren
id|mesg-&gt;content.config.forward_delay_time
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;arp_response_time
op_assign
(paren
id|mesg-&gt;content.config.arp_response_time
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;flush_timeout
op_assign
(paren
id|mesg-&gt;content.config.flush_timeout
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;path_switching_delay
op_assign
(paren
id|mesg-&gt;content.config.path_switching_delay
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;lane_version
op_assign
id|mesg-&gt;content.config.lane_version
suffix:semicolon
multiline_comment|/* LANE2 */
id|priv-&gt;lane2_ops
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;lane_version
OG
l_int|1
)paren
id|priv-&gt;lane2_ops
op_assign
op_amp
id|lane2_ops
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_member_access_from_pointer
id|change_mtu
c_func
(paren
id|dev
comma
id|mesg-&gt;content.config.mtu
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s: change_mtu to %d failed&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mesg-&gt;content.config.mtu
)paren
suffix:semicolon
id|priv-&gt;is_proxy
op_assign
id|mesg-&gt;content.config.is_proxy
suffix:semicolon
r_break
suffix:semicolon
r_case
id|l_flush_tran_id
suffix:colon
id|lec_set_flush_tran_id
c_func
(paren
id|priv
comma
id|mesg-&gt;content.normal.atm_addr
comma
id|mesg-&gt;content.normal.flag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|l_set_lecid
suffix:colon
id|priv-&gt;lecid
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|0xffff
op_amp
id|mesg-&gt;content.normal.flag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|l_should_bridge
suffix:colon
(brace
macro_line|#if defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE)
r_struct
id|net_bridge_fdb_entry
op_star
id|f
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;%s: bridge zeppelin asks about 0x%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mesg-&gt;content.proxy.mac_addr
(braket
l_int|0
)braket
comma
id|mesg-&gt;content.proxy.mac_addr
(braket
l_int|1
)braket
comma
id|mesg-&gt;content.proxy.mac_addr
(braket
l_int|2
)braket
comma
id|mesg-&gt;content.proxy.mac_addr
(braket
l_int|3
)braket
comma
id|mesg-&gt;content.proxy.mac_addr
(braket
l_int|4
)braket
comma
id|mesg-&gt;content.proxy.mac_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|br_fdb_get_hook
op_eq
l_int|NULL
op_logical_or
id|dev-&gt;br_port
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|f
op_assign
id|br_fdb_get_hook
c_func
(paren
id|dev-&gt;br_port-&gt;br
comma
id|mesg-&gt;content.proxy.mac_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f
op_ne
l_int|NULL
op_logical_and
id|f-&gt;dst-&gt;dev
op_ne
id|dev
op_logical_and
id|f-&gt;dst-&gt;state
op_eq
id|BR_STATE_FORWARDING
)paren
(brace
multiline_comment|/* hit from bridge table, send LE_ARP_RESPONSE */
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;%s: entry found, responding to zeppelin&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|atmlec_msg
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
op_eq
l_int|NULL
)paren
(brace
id|br_fdb_put_hook
c_func
(paren
id|f
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|skb2-&gt;len
op_assign
r_sizeof
(paren
r_struct
id|atmlec_msg
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb2-&gt;data
comma
id|mesg
comma
r_sizeof
(paren
r_struct
id|atmlec_msg
)paren
)paren
suffix:semicolon
id|atm_force_charge
c_func
(paren
id|priv-&gt;lecd
comma
id|skb2-&gt;truesize
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|priv-&gt;lecd-&gt;recvq
comma
id|skb2
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|priv-&gt;lecd-&gt;sleep
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|f
op_ne
l_int|NULL
)paren
id|br_fdb_put_hook
c_func
(paren
id|f
)paren
suffix:semicolon
macro_line|#endif /* defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE) */
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: Unknown message type %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mesg-&gt;type
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|lec_atm_close
id|lec_atm_close
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|vcc-&gt;proto_data
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|priv-&gt;lecd
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Do something needful? */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lec_arp_destroy
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_peek
c_func
(paren
op_amp
id|vcc-&gt;recvq
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s lec_atm_close: closing with messages pending&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|vcc-&gt;recvq
)paren
)paren
)paren
(brace
id|atm_return
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: Shut down!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|variable|lecdev_ops
r_static
r_struct
id|atmdev_ops
id|lecdev_ops
op_assign
(brace
id|close
suffix:colon
id|lec_atm_close
comma
id|send
suffix:colon
id|lec_atm_send
)brace
suffix:semicolon
DECL|variable|lecatm_dev
r_static
r_struct
id|atm_dev
id|lecatm_dev
op_assign
(brace
op_amp
id|lecdev_ops
comma
l_int|NULL
comma
multiline_comment|/*PHY*/
l_string|&quot;lec&quot;
comma
multiline_comment|/*type*/
l_int|999
comma
multiline_comment|/*dummy device number*/
l_int|NULL
comma
l_int|NULL
comma
multiline_comment|/*no VCCs*/
l_int|NULL
comma
l_int|NULL
comma
multiline_comment|/*no data*/
(brace
l_int|0
)brace
comma
multiline_comment|/*no flags*/
l_int|NULL
comma
multiline_comment|/* no local address*/
(brace
l_int|0
)brace
multiline_comment|/*no ESI or rest of the atm_dev struct things*/
)brace
suffix:semicolon
multiline_comment|/*&n; * LANE2: new argument struct sk_buff *data contains&n; * the LE_ARP based TLVs introduced in the LANE2 spec&n; */
r_int
DECL|function|send_to_lecd
id|send_to_lecd
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
id|atmlec_msg_type
id|type
comma
r_int
r_char
op_star
id|mac_addr
comma
r_int
r_char
op_star
id|atm_addr
comma
r_struct
id|sk_buff
op_star
id|data
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|atmlec_msg
op_star
id|mesg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv
op_logical_or
op_logical_neg
id|priv-&gt;lecd
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|atmlec_msg
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|skb-&gt;len
op_assign
r_sizeof
(paren
r_struct
id|atmlec_msg
)paren
suffix:semicolon
id|mesg
op_assign
(paren
r_struct
id|atmlec_msg
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|memset
c_func
(paren
id|mesg
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|atmlec_msg
)paren
)paren
suffix:semicolon
id|mesg-&gt;type
op_assign
id|type
suffix:semicolon
r_if
c_cond
(paren
id|data
op_ne
l_int|NULL
)paren
id|mesg-&gt;sizeoftlvs
op_assign
id|data-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|mac_addr
)paren
id|memcpy
c_func
(paren
op_amp
id|mesg-&gt;content.normal.mac_addr
comma
id|mac_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_else
id|mesg-&gt;content.normal.targetless_le_arp
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|atm_addr
)paren
id|memcpy
c_func
(paren
op_amp
id|mesg-&gt;content.normal.atm_addr
comma
id|atm_addr
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|atm_force_charge
c_func
(paren
id|priv-&gt;lecd
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|priv-&gt;lecd-&gt;recvq
comma
id|skb
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|priv-&gt;lecd-&gt;sleep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_ne
l_int|NULL
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;lec: about to send %d bytes of data&bslash;n&quot;
comma
id|data-&gt;len
)paren
suffix:semicolon
id|atm_force_charge
c_func
(paren
id|priv-&gt;lecd
comma
id|data-&gt;truesize
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|priv-&gt;lecd-&gt;recvq
comma
id|data
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|priv-&gt;lecd-&gt;sleep
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* shamelessly stolen from drivers/net/net_init.c */
DECL|function|lec_change_mtu
r_static
r_int
id|lec_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
(paren
id|new_mtu
OL
l_int|68
)paren
op_logical_or
(paren
id|new_mtu
OG
l_int|18190
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|lec_init
id|lec_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dev-&gt;change_mtu
op_assign
id|lec_change_mtu
suffix:semicolon
id|dev-&gt;open
op_assign
id|lec_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|lec_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|lec_send_packet
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|lec_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
l_int|NULL
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Initialized!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|lec_ctrl_magic
r_static
r_int
r_char
id|lec_ctrl_magic
(braket
)braket
op_assign
(brace
l_int|0xff
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x01
)brace
suffix:semicolon
r_void
DECL|function|lec_push
id|lec_push
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|vcc-&gt;proto_data
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
macro_line|#if DUMP_PACKETS &gt;0
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_char
id|buf
(braket
l_int|300
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: lec_push vcc vpi:%d vci:%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;%s: null skb&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|lec_vcc_close
c_func
(paren
id|priv
comma
id|vcc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#if DUMP_PACKETS &gt; 0
id|printk
c_func
(paren
l_string|&quot;%s: rcv datalen:%ld lecid:%4.4x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
comma
id|priv-&gt;lecid
)paren
suffix:semicolon
macro_line|#if DUMP_PACKETS &gt;= 2
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb-&gt;len
op_logical_and
id|i
OL
l_int|99
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|buf
op_plus
id|i
op_star
l_int|3
comma
l_string|&quot;%2.2x &quot;
comma
l_int|0xff
op_amp
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#elif DUMP_PACKETS &gt;= 1
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb-&gt;len
op_logical_and
id|i
OL
l_int|30
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sprintf
c_func
(paren
id|buf
op_plus
id|i
op_star
l_int|3
comma
l_string|&quot;%2.2x &quot;
comma
l_int|0xff
op_amp
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif /* DUMP_PACKETS &gt;= 1 */
r_if
c_cond
(paren
id|i
op_eq
id|skb-&gt;len
)paren
id|printk
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%s...&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
macro_line|#endif /* DUMP_PACKETS &gt; 0 */
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|skb-&gt;data
comma
id|lec_ctrl_magic
comma
l_int|4
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Control frame, to daemon*/
id|DPRINTK
c_func
(paren
l_string|&quot;%s: To daemon&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|vcc-&gt;recvq
comma
id|skb
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|vcc-&gt;sleep
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Data frame, queue to protocol handlers */
r_int
r_char
op_star
id|dst
suffix:semicolon
id|atm_return
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
r_uint16
op_star
)paren
id|skb-&gt;data
op_eq
id|htons
c_func
(paren
id|priv-&gt;lecid
)paren
op_logical_or
op_logical_neg
id|priv-&gt;lecd
)paren
(brace
multiline_comment|/* Probably looping back, or if lecd is missing,&n;                           lecd has gone down */
id|DPRINTK
c_func
(paren
l_string|&quot;Ignoring loopback frame...&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_TR
r_if
c_cond
(paren
id|priv-&gt;is_trdev
)paren
id|dst
op_assign
(paren
(paren
r_struct
id|lecdatahdr_8025
op_star
)paren
id|skb-&gt;data
)paren
op_member_access_from_pointer
id|h_dest
suffix:semicolon
r_else
macro_line|#endif
id|dst
op_assign
(paren
(paren
r_struct
id|lecdatahdr_8023
op_star
)paren
id|skb-&gt;data
)paren
op_member_access_from_pointer
id|h_dest
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dst
(braket
l_int|0
)braket
op_amp
l_int|0x01
)paren
op_logical_and
multiline_comment|/* Never filter Multi/Broadcast */
op_logical_neg
id|priv-&gt;is_proxy
op_logical_and
multiline_comment|/* Proxy wants all the packets */
id|memcmp
c_func
(paren
id|dst
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;lec_arp_empty_ones
)paren
(brace
id|lec_arp_check_empties
c_func
(paren
id|priv
comma
id|vcc
comma
id|skb
)paren
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;data
op_add_assign
l_int|2
suffix:semicolon
multiline_comment|/* skip lec_id */
macro_line|#ifdef CONFIG_TR
r_if
c_cond
(paren
id|priv-&gt;is_trdev
)paren
id|skb-&gt;protocol
op_assign
id|tr_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
r_else
macro_line|#endif
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|priv-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|priv-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_int
DECL|function|lec_vcc_attach
id|lec_vcc_attach
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|bytes_left
suffix:semicolon
r_struct
id|atmlec_ioc
id|ioc_data
suffix:semicolon
multiline_comment|/* Lecd must be up in this case */
id|bytes_left
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|ioc_data
comma
id|arg
comma
r_sizeof
(paren
r_struct
id|atmlec_ioc
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytes_left
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;lec: lec_vcc_attach, copy from user failed for %d bytes&bslash;n&quot;
comma
id|bytes_left
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ioc_data.dev_num
OL
l_int|0
op_logical_or
id|ioc_data.dev_num
op_ge
id|MAX_LEC_ITF
op_logical_or
op_logical_neg
id|dev_lec
(braket
id|ioc_data.dev_num
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|lec_vcc_added
c_func
(paren
id|dev_lec
(braket
id|ioc_data.dev_num
)braket
op_member_access_from_pointer
id|priv
comma
op_amp
id|ioc_data
comma
id|vcc
comma
id|vcc-&gt;push
)paren
suffix:semicolon
id|vcc-&gt;push
op_assign
id|lec_push
suffix:semicolon
id|vcc-&gt;proto_data
op_assign
id|dev_lec
(braket
id|ioc_data.dev_num
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|lec_mcast_attach
id|lec_mcast_attach
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|arg
)paren
(brace
r_if
c_cond
(paren
id|arg
OL
l_int|0
op_logical_or
id|arg
op_ge
id|MAX_LEC_ITF
op_logical_or
op_logical_neg
id|dev_lec
(braket
id|arg
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|vcc-&gt;proto_data
op_assign
id|dev_lec
(braket
id|arg
)braket
suffix:semicolon
r_return
(paren
id|lec_mcast_make
c_func
(paren
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev_lec
(braket
id|arg
)braket
op_member_access_from_pointer
id|priv
comma
id|vcc
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize device. */
r_int
DECL|function|lecd_attach
id|lecd_attach
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|arg
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
suffix:semicolon
r_if
c_cond
(paren
id|arg
OL
l_int|0
)paren
id|i
op_assign
l_int|0
suffix:semicolon
r_else
id|i
op_assign
id|arg
suffix:semicolon
macro_line|#ifdef CONFIG_TR
r_if
c_cond
(paren
id|arg
op_ge
id|MAX_LEC_ITF
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#else /* Reserve the top NUM_TR_DEVS for TR */
r_if
c_cond
(paren
id|arg
op_ge
(paren
id|MAX_LEC_ITF
op_minus
id|NUM_TR_DEVS
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|dev_lec
(braket
id|i
)braket
)paren
(brace
r_int
id|is_trdev
comma
id|size
suffix:semicolon
id|is_trdev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
(paren
id|MAX_LEC_ITF
op_minus
id|NUM_TR_DEVS
)paren
)paren
id|is_trdev
op_assign
l_int|1
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
r_struct
id|lec_priv
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_TR
r_if
c_cond
(paren
id|is_trdev
)paren
id|dev_lec
(braket
id|i
)braket
op_assign
id|init_trdev
c_func
(paren
l_int|NULL
comma
id|size
)paren
suffix:semicolon
r_else
macro_line|#endif
id|dev_lec
(braket
id|i
)braket
op_assign
id|init_etherdev
c_func
(paren
l_int|NULL
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_lec
(braket
id|i
)braket
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|priv
op_assign
id|dev_lec
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
suffix:semicolon
id|priv-&gt;is_trdev
op_assign
id|is_trdev
suffix:semicolon
id|sprintf
c_func
(paren
id|dev_lec
(braket
id|i
)braket
op_member_access_from_pointer
id|name
comma
l_string|&quot;lec%d&quot;
comma
id|i
)paren
suffix:semicolon
id|lec_init
c_func
(paren
id|dev_lec
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv
op_assign
id|dev_lec
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;lecd
)paren
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
id|lec_arp_init
c_func
(paren
id|priv
)paren
suffix:semicolon
id|priv-&gt;itfnum
op_assign
id|i
suffix:semicolon
multiline_comment|/* LANE2 addition */
id|priv-&gt;lecd
op_assign
id|vcc
suffix:semicolon
id|bind_vcc
c_func
(paren
id|vcc
comma
op_amp
id|lecatm_dev
)paren
suffix:semicolon
id|vcc-&gt;proto_data
op_assign
id|dev_lec
(braket
id|i
)braket
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_META
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
multiline_comment|/* Set default values to these variables */
id|priv-&gt;maximum_unknown_frame_count
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;max_unknown_frame_time
op_assign
(paren
l_int|1
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;vcc_timeout_period
op_assign
(paren
l_int|1200
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;max_retry_count
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;aging_time
op_assign
(paren
l_int|300
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;forward_delay_time
op_assign
(paren
l_int|15
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;topology_change
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;arp_response_time
op_assign
(paren
l_int|1
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;flush_timeout
op_assign
(paren
l_int|4
op_star
id|HZ
)paren
suffix:semicolon
id|priv-&gt;path_switching_delay
op_assign
(paren
l_int|6
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_lec
(braket
id|i
)braket
op_member_access_from_pointer
id|flags
op_amp
id|IFF_UP
)paren
(brace
id|netif_start_queue
c_func
(paren
id|dev_lec
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|function|atm_lane_init_ops
r_void
id|atm_lane_init_ops
c_func
(paren
r_struct
id|atm_lane_ops
op_star
id|ops
)paren
(brace
id|ops-&gt;lecd_attach
op_assign
id|lecd_attach
suffix:semicolon
id|ops-&gt;mcast_attach
op_assign
id|lec_mcast_attach
suffix:semicolon
id|ops-&gt;vcc_attach
op_assign
id|lec_vcc_attach
suffix:semicolon
id|ops-&gt;get_lecs
op_assign
id|get_dev_lec
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;lec.c: &quot;
id|__DATE__
l_string|&quot; &quot;
id|__TIME__
l_string|&quot; initialized&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|lane_module_init
r_static
r_int
id|__init
id|lane_module_init
c_func
(paren
r_void
)paren
(brace
r_extern
r_struct
id|atm_lane_ops
id|atm_lane_ops
suffix:semicolon
id|atm_lane_init_ops
c_func
(paren
op_amp
id|atm_lane_ops
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|lane_module_cleanup
r_static
r_void
id|__exit
id|lane_module_cleanup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_extern
r_struct
id|atm_lane_ops
id|atm_lane_ops
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
suffix:semicolon
id|atm_lane_ops.lecd_attach
op_assign
l_int|NULL
suffix:semicolon
id|atm_lane_ops.mcast_attach
op_assign
l_int|NULL
suffix:semicolon
id|atm_lane_ops.vcc_attach
op_assign
l_int|NULL
suffix:semicolon
id|atm_lane_ops.get_lecs
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_LEC_ITF
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev_lec
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev_lec
(braket
id|i
)braket
op_member_access_from_pointer
id|priv
suffix:semicolon
macro_line|#if defined(CONFIG_TR)
id|unregister_trdev
c_func
(paren
id|dev_lec
(braket
id|i
)braket
)paren
suffix:semicolon
macro_line|#endif
id|kfree
c_func
(paren
id|dev_lec
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev_lec
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
DECL|variable|lane_module_init
id|module_init
c_func
(paren
id|lane_module_init
)paren
suffix:semicolon
DECL|variable|lane_module_cleanup
id|module_exit
c_func
(paren
id|lane_module_cleanup
)paren
suffix:semicolon
multiline_comment|/*&n; * LANE2: 3.1.3, LE_RESOLVE.request&n; * Non force allocates memory and fills in *tlvs, fills in *sizeoftlvs.&n; * If sizeoftlvs == NULL the default TLVs associated with with this&n; * lec will be used.&n; * If dst_mac == NULL, targetless LE_ARP will be sent&n; */
DECL|function|lane2_resolve
r_static
r_int
id|lane2_resolve
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u8
op_star
id|dst_mac
comma
r_int
id|force
comma
id|u8
op_star
op_star
id|tlvs
comma
id|u32
op_star
id|sizeoftlvs
)paren
(brace
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|table
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|force
op_eq
l_int|0
)paren
(brace
id|table
op_assign
id|lec_arp_find
c_func
(paren
id|priv
comma
id|dst_mac
)paren
suffix:semicolon
r_if
c_cond
(paren
id|table
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
op_star
id|tlvs
op_assign
id|kmalloc
c_func
(paren
id|table-&gt;sizeoftlvs
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|tlvs
op_eq
l_int|NULL
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
op_star
id|tlvs
comma
id|table-&gt;tlvs
comma
id|table-&gt;sizeoftlvs
)paren
suffix:semicolon
op_star
id|sizeoftlvs
op_assign
id|table-&gt;sizeoftlvs
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sizeoftlvs
op_eq
l_int|NULL
)paren
id|retval
op_assign
id|send_to_lecd
c_func
(paren
id|priv
comma
id|l_arp_xmt
comma
id|dst_mac
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_else
(brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
op_star
id|sizeoftlvs
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|skb-&gt;len
op_assign
op_star
id|sizeoftlvs
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
op_star
id|tlvs
comma
op_star
id|sizeoftlvs
)paren
suffix:semicolon
id|retval
op_assign
id|send_to_lecd
c_func
(paren
id|priv
comma
id|l_arp_xmt
comma
id|dst_mac
comma
l_int|NULL
comma
id|skb
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * LANE2: 3.1.4, LE_ASSOCIATE.request&n; * Associate the *tlvs with the *lan_dst address.&n; * Will overwrite any previous association&n; * Returns 1 for success, 0 for failure (out of memory)&n; *&n; */
DECL|function|lane2_associate_req
r_static
r_int
id|lane2_associate_req
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u8
op_star
id|lan_dst
comma
id|u8
op_star
id|tlvs
comma
id|u32
id|sizeoftlvs
)paren
(brace
r_int
id|retval
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|lan_dst
comma
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
op_ne
l_int|0
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* not our mac address */
id|kfree
c_func
(paren
id|priv-&gt;tlvs
)paren
suffix:semicolon
multiline_comment|/* NULL if there was no previous association */
id|priv-&gt;tlvs
op_assign
id|kmalloc
c_func
(paren
id|sizeoftlvs
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;tlvs
op_eq
l_int|NULL
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
id|priv-&gt;sizeoftlvs
op_assign
id|sizeoftlvs
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;tlvs
comma
id|tlvs
comma
id|sizeoftlvs
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|sizeoftlvs
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|skb-&gt;len
op_assign
id|sizeoftlvs
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|tlvs
comma
id|sizeoftlvs
)paren
suffix:semicolon
id|retval
op_assign
id|send_to_lecd
c_func
(paren
id|priv
comma
id|l_associate_req
comma
l_int|NULL
comma
l_int|NULL
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;lec.c: lane2_associate_req() failed&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* If the previous association has changed we must&n;         * somehow notify other LANE entities about the change&n;         */
r_return
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * LANE2: 3.1.5, LE_ASSOCIATE.indication&n; *&n; */
DECL|function|lane2_associate_ind
r_static
r_void
id|lane2_associate_ind
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u8
op_star
id|mac_addr
comma
id|u8
op_star
id|tlvs
comma
id|u32
id|sizeoftlvs
)paren
(brace
macro_line|#if 0
r_int
id|i
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
macro_line|#if 0 /* Why have the TLVs in LE_ARP entries since we do not use them? When you&n;         uncomment this code, make sure the TLVs get freed when entry is killed */
r_struct
id|lec_arp_table
op_star
id|entry
op_assign
id|lec_arp_find
c_func
(paren
id|priv
comma
id|mac_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
multiline_comment|/* should not happen */
id|kfree
c_func
(paren
id|entry-&gt;tlvs
)paren
suffix:semicolon
id|entry-&gt;tlvs
op_assign
id|kmalloc
c_func
(paren
id|sizeoftlvs
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;tlvs
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|entry-&gt;sizeoftlvs
op_assign
id|sizeoftlvs
suffix:semicolon
id|memcpy
c_func
(paren
id|entry-&gt;tlvs
comma
id|tlvs
comma
id|sizeoftlvs
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;lec.c: lane2_associate_ind()&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;dump of tlvs, sizeoftlvs=%d&bslash;n&quot;
comma
id|sizeoftlvs
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|sizeoftlvs
)paren
id|printk
c_func
(paren
l_string|&quot;%02x &quot;
comma
id|tlvs
(braket
id|i
op_increment
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* tell MPOA about the TLVs we saw */
r_if
c_cond
(paren
id|priv-&gt;lane2_ops
op_logical_and
id|priv-&gt;lane2_ops-&gt;associate_indicator
)paren
(brace
id|priv-&gt;lane2_ops
op_member_access_from_pointer
id|associate_indicator
c_func
(paren
id|dev
comma
id|mac_addr
comma
id|tlvs
comma
id|sizeoftlvs
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Here starts what used to lec_arpc.c&n; *&n; * lec_arpc.c was added here when making&n; * lane client modular. October 1997&n; *&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;asm/param.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#if 0
mdefine_line|#define DPRINTK(format,args...)
multiline_comment|/*&n;#define DPRINTK printk&n;*/
macro_line|#endif
DECL|macro|DEBUG_ARP_TABLE
mdefine_line|#define DEBUG_ARP_TABLE 0
DECL|macro|LEC_ARP_REFRESH_INTERVAL
mdefine_line|#define LEC_ARP_REFRESH_INTERVAL (3*HZ)
r_static
r_void
id|lec_arp_check_expire
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
id|__inline__
r_void
id|lec_arp_expire_arp
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_void
id|dump_arp_table
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
)paren
suffix:semicolon
multiline_comment|/* &n; * Arp table funcs&n; */
DECL|macro|HASH
mdefine_line|#define HASH(ch) (ch &amp; (LEC_ARP_TABLE_SIZE -1))
r_static
id|__inline__
r_void
DECL|function|lec_arp_lock
id|lec_arp_lock
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|priv-&gt;lec_arp_lock_var
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_void
DECL|function|lec_arp_unlock
id|lec_arp_unlock
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|priv-&gt;lec_arp_lock_var
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialization of arp-cache&n; */
r_void
DECL|function|lec_arp_init
id|lec_arp_init
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|priv-&gt;lec_arp_tables
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|priv-&gt;lec_arp_timer
)paren
suffix:semicolon
id|priv-&gt;lec_arp_timer.expires
op_assign
id|jiffies
op_plus
id|LEC_ARP_REFRESH_INTERVAL
suffix:semicolon
id|priv-&gt;lec_arp_timer.data
op_assign
(paren
r_int
r_int
)paren
id|priv
suffix:semicolon
id|priv-&gt;lec_arp_timer.function
op_assign
id|lec_arp_check_expire
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|priv-&gt;lec_arp_timer
)paren
suffix:semicolon
)brace
r_void
DECL|function|lec_arp_clear_vccs
id|lec_arp_clear_vccs
c_func
(paren
r_struct
id|lec_arp_table
op_star
id|entry
)paren
(brace
r_if
c_cond
(paren
id|entry-&gt;vcc
)paren
(brace
id|entry-&gt;vcc-&gt;push
op_assign
id|entry-&gt;old_push
suffix:semicolon
macro_line|#if 0 /* August 6, 1998 */
id|set_bit
c_func
(paren
id|ATM_VF_RELEASED
comma
op_amp
id|entry-&gt;vcc-&gt;flags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|entry-&gt;vcc-&gt;flags
)paren
suffix:semicolon
id|entry-&gt;vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|entry-&gt;vcc
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
id|atm_async_release_vcc
c_func
(paren
id|entry-&gt;vcc
comma
op_minus
id|EPIPE
)paren
suffix:semicolon
id|entry-&gt;vcc
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry-&gt;recv_vcc
)paren
(brace
id|entry-&gt;recv_vcc-&gt;push
op_assign
id|entry-&gt;old_recv_push
suffix:semicolon
macro_line|#if 0
id|set_bit
c_func
(paren
id|ATM_VF_RELEASED
comma
op_amp
id|entry-&gt;recv_vcc-&gt;flags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|entry-&gt;recv_vcc-&gt;flags
)paren
suffix:semicolon
id|entry-&gt;recv_vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|entry-&gt;recv_vcc
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
id|atm_async_release_vcc
c_func
(paren
id|entry-&gt;recv_vcc
comma
op_minus
id|EPIPE
)paren
suffix:semicolon
id|entry-&gt;recv_vcc
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Insert entry to lec_arp_table&n; * LANE2: Add to the end of the list to satisfy 8.1.13&n; */
r_static
id|__inline__
r_void
DECL|function|lec_arp_put
id|lec_arp_put
c_func
(paren
r_struct
id|lec_arp_table
op_star
op_star
id|lec_arp_tables
comma
r_struct
id|lec_arp_table
op_star
id|to_put
)paren
(brace
r_int
r_int
id|place
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|tmp
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|place
op_assign
id|HASH
c_func
(paren
id|to_put-&gt;mac_addr
(braket
id|ETH_ALEN
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|tmp
op_assign
id|lec_arp_tables
(braket
id|place
)braket
suffix:semicolon
id|to_put-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_int|NULL
)paren
id|lec_arp_tables
(braket
id|place
)braket
op_assign
id|to_put
suffix:semicolon
r_else
(brace
multiline_comment|/* add to the end */
r_while
c_loop
(paren
id|tmp-&gt;next
)paren
id|tmp
op_assign
id|tmp-&gt;next
suffix:semicolon
id|tmp-&gt;next
op_assign
id|to_put
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP: Added entry:%2.2x %2.2x %2.2x %2.2x %2.2x %2.2x&bslash;n&quot;
comma
l_int|0xff
op_amp
id|to_put-&gt;mac_addr
(braket
l_int|0
)braket
comma
l_int|0xff
op_amp
id|to_put-&gt;mac_addr
(braket
l_int|1
)braket
comma
l_int|0xff
op_amp
id|to_put-&gt;mac_addr
(braket
l_int|2
)braket
comma
l_int|0xff
op_amp
id|to_put-&gt;mac_addr
(braket
l_int|3
)braket
comma
l_int|0xff
op_amp
id|to_put-&gt;mac_addr
(braket
l_int|4
)braket
comma
l_int|0xff
op_amp
id|to_put-&gt;mac_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Remove entry from lec_arp_table&n; */
r_static
id|__inline__
r_int
DECL|function|lec_arp_remove
id|lec_arp_remove
c_func
(paren
r_struct
id|lec_arp_table
op_star
op_star
id|lec_arp_tables
comma
r_struct
id|lec_arp_table
op_star
id|to_remove
)paren
(brace
r_int
r_int
id|place
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|tmp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|remove_vcc
op_assign
l_int|1
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|to_remove
)paren
(brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|place
op_assign
id|HASH
c_func
(paren
id|to_remove-&gt;mac_addr
(braket
id|ETH_ALEN
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|tmp
op_assign
id|lec_arp_tables
(braket
id|place
)braket
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
id|to_remove
)paren
(brace
id|lec_arp_tables
(braket
id|place
)braket
op_assign
id|tmp-&gt;next
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|tmp
op_logical_and
id|tmp-&gt;next
op_ne
id|to_remove
)paren
(brace
id|tmp
op_assign
id|tmp-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|tmp
)paren
(brace
multiline_comment|/* Entry was not found */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|tmp-&gt;next
op_assign
id|to_remove-&gt;next
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|to_remove-&gt;timer
)paren
suffix:semicolon
multiline_comment|/* If this is the only MAC connected to this VCC, also tear down&n;           the VCC */
r_if
c_cond
(paren
id|to_remove-&gt;status
op_ge
id|ESI_FLUSH_PENDING
)paren
(brace
multiline_comment|/*&n;                 * ESI_FLUSH_PENDING, ESI_FORWARD_DIRECT&n;                 */
r_for
c_loop
(paren
id|place
op_assign
l_int|0
suffix:semicolon
id|place
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|place
op_increment
)paren
(brace
r_for
c_loop
(paren
id|tmp
op_assign
id|lec_arp_tables
(braket
id|place
)braket
suffix:semicolon
id|tmp
op_ne
l_int|NULL
suffix:semicolon
id|tmp
op_assign
id|tmp-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|tmp-&gt;atm_addr
comma
id|to_remove-&gt;atm_addr
comma
id|ATM_ESA_LEN
)paren
op_eq
l_int|0
)paren
(brace
id|remove_vcc
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|remove_vcc
)paren
id|lec_arp_clear_vccs
c_func
(paren
id|to_remove
)paren
suffix:semicolon
)brace
id|skb_queue_purge
c_func
(paren
op_amp
id|to_remove-&gt;tx_wait
)paren
suffix:semicolon
multiline_comment|/* FIXME: good place for this? */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP: Removed entry:%2.2x %2.2x %2.2x %2.2x %2.2x %2.2x&bslash;n&quot;
comma
l_int|0xff
op_amp
id|to_remove-&gt;mac_addr
(braket
l_int|0
)braket
comma
l_int|0xff
op_amp
id|to_remove-&gt;mac_addr
(braket
l_int|1
)braket
comma
l_int|0xff
op_amp
id|to_remove-&gt;mac_addr
(braket
l_int|2
)braket
comma
l_int|0xff
op_amp
id|to_remove-&gt;mac_addr
(braket
l_int|3
)braket
comma
l_int|0xff
op_amp
id|to_remove-&gt;mac_addr
(braket
l_int|4
)braket
comma
l_int|0xff
op_amp
id|to_remove-&gt;mac_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if DEBUG_ARP_TABLE
r_static
r_char
op_star
DECL|function|get_status_string
id|get_status_string
c_func
(paren
r_int
r_char
id|st
)paren
(brace
r_switch
c_cond
(paren
id|st
)paren
(brace
r_case
id|ESI_UNKNOWN
suffix:colon
r_return
l_string|&quot;ESI_UNKNOWN&quot;
suffix:semicolon
r_case
id|ESI_ARP_PENDING
suffix:colon
r_return
l_string|&quot;ESI_ARP_PENDING&quot;
suffix:semicolon
r_case
id|ESI_VC_PENDING
suffix:colon
r_return
l_string|&quot;ESI_VC_PENDING&quot;
suffix:semicolon
r_case
id|ESI_FLUSH_PENDING
suffix:colon
r_return
l_string|&quot;ESI_FLUSH_PENDING&quot;
suffix:semicolon
r_case
id|ESI_FORWARD_DIRECT
suffix:colon
r_return
l_string|&quot;ESI_FORWARD_DIRECT&quot;
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;&lt;UNKNOWN&gt;&quot;
suffix:semicolon
)brace
)brace
macro_line|#endif
r_void
DECL|function|dump_arp_table
id|dump_arp_table
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
)paren
(brace
macro_line|#if DEBUG_ARP_TABLE
r_int
id|i
comma
id|j
comma
id|offset
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|rulla
suffix:semicolon
r_char
id|buf
(braket
l_int|1024
)braket
suffix:semicolon
r_struct
id|lec_arp_table
op_star
op_star
id|lec_arp_tables
op_assign
(paren
r_struct
id|lec_arp_table
op_star
op_star
)paren
id|priv-&gt;lec_arp_tables
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|lec_arp_empty_ones
op_assign
(paren
r_struct
id|lec_arp_table
op_star
)paren
id|priv-&gt;lec_arp_empty_ones
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|lec_no_forward
op_assign
(paren
r_struct
id|lec_arp_table
op_star
)paren
id|priv-&gt;lec_no_forward
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|mcast_fwds
op_assign
id|priv-&gt;mcast_fwds
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Dump %p:&bslash;n&quot;
comma
id|priv
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rulla
op_assign
id|lec_arp_tables
(braket
id|i
)braket
suffix:semicolon
id|offset
op_assign
l_int|0
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d: %p&bslash;n&quot;
comma
id|i
comma
id|rulla
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rulla
)paren
(brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Mac:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ETH_ALEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;%2.2x &quot;
comma
id|rulla-&gt;mac_addr
(braket
id|j
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Atm:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ATM_ESA_LEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;%2.2x &quot;
comma
id|rulla-&gt;atm_addr
(braket
id|j
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Vcc vpi:%d vci:%d, Recv_vcc vpi:%d vci:%d Last_used:%lx, Timestamp:%lx, No_tries:%d &quot;
comma
id|rulla-&gt;vcc
ques
c_cond
id|rulla-&gt;vcc-&gt;vpi
suffix:colon
l_int|0
comma
id|rulla-&gt;vcc
ques
c_cond
id|rulla-&gt;vcc-&gt;vci
suffix:colon
l_int|0
comma
id|rulla-&gt;recv_vcc
ques
c_cond
id|rulla-&gt;recv_vcc-&gt;vpi
suffix:colon
l_int|0
comma
id|rulla-&gt;recv_vcc
ques
c_cond
id|rulla-&gt;recv_vcc-&gt;vci
suffix:colon
l_int|0
comma
id|rulla-&gt;last_used
comma
id|rulla-&gt;timestamp
comma
id|rulla-&gt;no_tries
)paren
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Flags:%x, Packets_flooded:%x, Status: %s &quot;
comma
id|rulla-&gt;flags
comma
id|rulla-&gt;packets_flooded
comma
id|get_status_string
c_func
(paren
id|rulla-&gt;status
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;-&gt;%p&bslash;n&quot;
comma
id|rulla-&gt;next
)paren
suffix:semicolon
id|rulla
op_assign
id|rulla-&gt;next
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|buf
)paren
suffix:semicolon
)brace
id|rulla
op_assign
id|lec_no_forward
suffix:semicolon
r_if
c_cond
(paren
id|rulla
)paren
id|printk
c_func
(paren
l_string|&quot;No forward&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rulla
)paren
(brace
id|offset
op_assign
l_int|0
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Mac:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ETH_ALEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;%2.2x &quot;
comma
id|rulla-&gt;mac_addr
(braket
id|j
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Atm:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ATM_ESA_LEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;%2.2x &quot;
comma
id|rulla-&gt;atm_addr
(braket
id|j
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Vcc vpi:%d vci:%d, Recv_vcc vpi:%d vci:%d Last_used:%lx, Timestamp:%lx, No_tries:%d &quot;
comma
id|rulla-&gt;vcc
ques
c_cond
id|rulla-&gt;vcc-&gt;vpi
suffix:colon
l_int|0
comma
id|rulla-&gt;vcc
ques
c_cond
id|rulla-&gt;vcc-&gt;vci
suffix:colon
l_int|0
comma
id|rulla-&gt;recv_vcc
ques
c_cond
id|rulla-&gt;recv_vcc-&gt;vpi
suffix:colon
l_int|0
comma
id|rulla-&gt;recv_vcc
ques
c_cond
id|rulla-&gt;recv_vcc-&gt;vci
suffix:colon
l_int|0
comma
id|rulla-&gt;last_used
comma
id|rulla-&gt;timestamp
comma
id|rulla-&gt;no_tries
)paren
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Flags:%x, Packets_flooded:%x, Status: %s &quot;
comma
id|rulla-&gt;flags
comma
id|rulla-&gt;packets_flooded
comma
id|get_status_string
c_func
(paren
id|rulla-&gt;status
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;-&gt;%lx&bslash;n&quot;
comma
(paren
r_int
)paren
id|rulla-&gt;next
)paren
suffix:semicolon
id|rulla
op_assign
id|rulla-&gt;next
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|buf
)paren
suffix:semicolon
)brace
id|rulla
op_assign
id|lec_arp_empty_ones
suffix:semicolon
r_if
c_cond
(paren
id|rulla
)paren
id|printk
c_func
(paren
l_string|&quot;Empty ones&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rulla
)paren
(brace
id|offset
op_assign
l_int|0
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Mac:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ETH_ALEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;%2.2x &quot;
comma
id|rulla-&gt;mac_addr
(braket
id|j
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Atm:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ATM_ESA_LEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;%2.2x &quot;
comma
id|rulla-&gt;atm_addr
(braket
id|j
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Vcc vpi:%d vci:%d, Recv_vcc vpi:%d vci:%d Last_used:%lx, Timestamp:%lx, No_tries:%d &quot;
comma
id|rulla-&gt;vcc
ques
c_cond
id|rulla-&gt;vcc-&gt;vpi
suffix:colon
l_int|0
comma
id|rulla-&gt;vcc
ques
c_cond
id|rulla-&gt;vcc-&gt;vci
suffix:colon
l_int|0
comma
id|rulla-&gt;recv_vcc
ques
c_cond
id|rulla-&gt;recv_vcc-&gt;vpi
suffix:colon
l_int|0
comma
id|rulla-&gt;recv_vcc
ques
c_cond
id|rulla-&gt;recv_vcc-&gt;vci
suffix:colon
l_int|0
comma
id|rulla-&gt;last_used
comma
id|rulla-&gt;timestamp
comma
id|rulla-&gt;no_tries
)paren
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Flags:%x, Packets_flooded:%x, Status: %s &quot;
comma
id|rulla-&gt;flags
comma
id|rulla-&gt;packets_flooded
comma
id|get_status_string
c_func
(paren
id|rulla-&gt;status
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;-&gt;%lx&bslash;n&quot;
comma
(paren
r_int
)paren
id|rulla-&gt;next
)paren
suffix:semicolon
id|rulla
op_assign
id|rulla-&gt;next
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|buf
)paren
suffix:semicolon
)brace
id|rulla
op_assign
id|mcast_fwds
suffix:semicolon
r_if
c_cond
(paren
id|rulla
)paren
id|printk
c_func
(paren
l_string|&quot;Multicast Forward VCCs&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rulla
)paren
(brace
id|offset
op_assign
l_int|0
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Mac:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ETH_ALEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;%2.2x &quot;
comma
id|rulla-&gt;mac_addr
(braket
id|j
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Atm:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ATM_ESA_LEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;%2.2x &quot;
comma
id|rulla-&gt;atm_addr
(braket
id|j
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Vcc vpi:%d vci:%d, Recv_vcc vpi:%d vci:%d Last_used:%lx, Timestamp:%lx, No_tries:%d &quot;
comma
id|rulla-&gt;vcc
ques
c_cond
id|rulla-&gt;vcc-&gt;vpi
suffix:colon
l_int|0
comma
id|rulla-&gt;vcc
ques
c_cond
id|rulla-&gt;vcc-&gt;vci
suffix:colon
l_int|0
comma
id|rulla-&gt;recv_vcc
ques
c_cond
id|rulla-&gt;recv_vcc-&gt;vpi
suffix:colon
l_int|0
comma
id|rulla-&gt;recv_vcc
ques
c_cond
id|rulla-&gt;recv_vcc-&gt;vci
suffix:colon
l_int|0
comma
id|rulla-&gt;last_used
comma
id|rulla-&gt;timestamp
comma
id|rulla-&gt;no_tries
)paren
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;Flags:%x, Packets_flooded:%x, Status: %s &quot;
comma
id|rulla-&gt;flags
comma
id|rulla-&gt;packets_flooded
comma
id|get_status_string
c_func
(paren
id|rulla-&gt;status
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|offset
comma
l_string|&quot;-&gt;%lx&bslash;n&quot;
comma
(paren
r_int
)paren
id|rulla-&gt;next
)paren
suffix:semicolon
id|rulla
op_assign
id|rulla-&gt;next
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|buf
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
multiline_comment|/*&n; * Destruction of arp-cache&n; */
r_void
DECL|function|lec_arp_destroy
id|lec_arp_destroy
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|entry
comma
op_star
id|next
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|priv-&gt;lec_arp_timer
)paren
suffix:semicolon
multiline_comment|/*&n;         * Remove all entries&n;         */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|entry
op_assign
id|priv-&gt;lec_arp_tables
(braket
id|i
)braket
suffix:semicolon
id|entry
op_ne
l_int|NULL
suffix:semicolon
id|entry
op_assign
id|next
)paren
(brace
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
id|lec_arp_remove
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
)brace
id|entry
op_assign
id|priv-&gt;lec_arp_empty_ones
suffix:semicolon
r_while
c_loop
(paren
id|entry
)paren
(brace
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|lec_arp_clear_vccs
c_func
(paren
id|entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
id|next
suffix:semicolon
)brace
id|priv-&gt;lec_arp_empty_ones
op_assign
l_int|NULL
suffix:semicolon
id|entry
op_assign
id|priv-&gt;lec_no_forward
suffix:semicolon
r_while
c_loop
(paren
id|entry
)paren
(brace
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|lec_arp_clear_vccs
c_func
(paren
id|entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
id|next
suffix:semicolon
)brace
id|priv-&gt;lec_no_forward
op_assign
l_int|NULL
suffix:semicolon
id|entry
op_assign
id|priv-&gt;mcast_fwds
suffix:semicolon
r_while
c_loop
(paren
id|entry
)paren
(brace
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|lec_arp_clear_vccs
c_func
(paren
id|entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
id|next
suffix:semicolon
)brace
id|priv-&gt;mcast_fwds
op_assign
l_int|NULL
suffix:semicolon
id|priv-&gt;mcast_vcc
op_assign
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|lec_arp_table
op_star
)paren
op_star
id|LEC_ARP_TABLE_SIZE
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * Find entry by mac_address&n; */
r_static
id|__inline__
r_struct
id|lec_arp_table
op_star
DECL|function|lec_arp_find
id|lec_arp_find
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_int
r_char
op_star
id|mac_addr
)paren
(brace
r_int
r_int
id|place
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|to_return
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP: lec_arp_find :%2.2x %2.2x %2.2x %2.2x %2.2x %2.2x&bslash;n&quot;
comma
id|mac_addr
(braket
l_int|0
)braket
op_amp
l_int|0xff
comma
id|mac_addr
(braket
l_int|1
)braket
op_amp
l_int|0xff
comma
id|mac_addr
(braket
l_int|2
)braket
op_amp
l_int|0xff
comma
id|mac_addr
(braket
l_int|3
)braket
op_amp
l_int|0xff
comma
id|mac_addr
(braket
l_int|4
)braket
op_amp
l_int|0xff
comma
id|mac_addr
(braket
l_int|5
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
id|lec_arp_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|place
op_assign
id|HASH
c_func
(paren
id|mac_addr
(braket
id|ETH_ALEN
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|to_return
op_assign
id|priv-&gt;lec_arp_tables
(braket
id|place
)braket
suffix:semicolon
r_while
c_loop
(paren
id|to_return
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|mac_addr
comma
id|to_return-&gt;mac_addr
comma
id|ETH_ALEN
)paren
op_eq
l_int|0
)paren
(brace
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|to_return
suffix:semicolon
)brace
id|to_return
op_assign
id|to_return-&gt;next
suffix:semicolon
)brace
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_struct
id|lec_arp_table
op_star
DECL|function|make_entry
id|make_entry
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_int
r_char
op_star
id|mac_addr
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|to_return
suffix:semicolon
id|to_return
op_assign
(paren
r_struct
id|lec_arp_table
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|lec_arp_table
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|to_return
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;LEC: Arp entry kmalloc failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|to_return
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|lec_arp_table
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|to_return-&gt;mac_addr
comma
id|mac_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|to_return-&gt;timer
)paren
suffix:semicolon
id|to_return-&gt;timer.function
op_assign
id|lec_arp_expire_arp
suffix:semicolon
id|to_return-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|to_return
suffix:semicolon
id|to_return-&gt;last_used
op_assign
id|jiffies
suffix:semicolon
id|to_return-&gt;priv
op_assign
id|priv
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|to_return-&gt;tx_wait
)paren
suffix:semicolon
r_return
id|to_return
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; * Arp sent timer expired&n; *&n; */
r_static
r_void
DECL|function|lec_arp_expire_arp
id|lec_arp_expire_arp
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|entry
suffix:semicolon
id|entry
op_assign
(paren
r_struct
id|lec_arp_table
op_star
)paren
id|data
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;lec_arp_expire_arp&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;status
op_eq
id|ESI_ARP_PENDING
)paren
(brace
r_if
c_cond
(paren
id|entry-&gt;no_tries
op_le
id|entry-&gt;priv-&gt;max_retry_count
)paren
(brace
r_if
c_cond
(paren
id|entry-&gt;is_rdesc
)paren
id|send_to_lecd
c_func
(paren
id|entry-&gt;priv
comma
id|l_rdesc_arp_xmt
comma
id|entry-&gt;mac_addr
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|send_to_lecd
c_func
(paren
id|entry-&gt;priv
comma
id|l_arp_xmt
comma
id|entry-&gt;mac_addr
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|entry-&gt;no_tries
op_increment
suffix:semicolon
)brace
id|entry-&gt;timer.expires
op_assign
id|jiffies
op_plus
(paren
l_int|1
op_star
id|HZ
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&n; * Unknown/unused vcc expire, remove associated entry&n; *&n; */
r_static
r_void
DECL|function|lec_arp_expire_vcc
id|lec_arp_expire_vcc
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|to_remove
op_assign
(paren
r_struct
id|lec_arp_table
op_star
)paren
id|data
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|to_remove-&gt;priv
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|entry
op_assign
l_int|NULL
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|to_remove-&gt;timer
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP %p %p: lec_arp_expire_vcc vpi:%d vci:%d&bslash;n&quot;
comma
id|to_remove
comma
id|priv
comma
id|to_remove-&gt;vcc
ques
c_cond
id|to_remove-&gt;recv_vcc-&gt;vpi
suffix:colon
l_int|0
comma
id|to_remove-&gt;vcc
ques
c_cond
id|to_remove-&gt;recv_vcc-&gt;vci
suffix:colon
l_int|0
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;eo:%p nf:%p&bslash;n&quot;
comma
id|priv-&gt;lec_arp_empty_ones
comma
id|priv-&gt;lec_no_forward
)paren
suffix:semicolon
r_if
c_cond
(paren
id|to_remove
op_eq
id|priv-&gt;lec_arp_empty_ones
)paren
id|priv-&gt;lec_arp_empty_ones
op_assign
id|to_remove-&gt;next
suffix:semicolon
r_else
(brace
id|entry
op_assign
id|priv-&gt;lec_arp_empty_ones
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_logical_and
id|entry-&gt;next
op_ne
id|to_remove
)paren
id|entry
op_assign
id|entry-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
id|entry-&gt;next
op_assign
id|to_remove-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
(brace
r_if
c_cond
(paren
id|to_remove
op_eq
id|priv-&gt;lec_no_forward
)paren
(brace
id|priv-&gt;lec_no_forward
op_assign
id|to_remove-&gt;next
suffix:semicolon
)brace
r_else
(brace
id|entry
op_assign
id|priv-&gt;lec_no_forward
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_logical_and
id|entry-&gt;next
op_ne
id|to_remove
)paren
id|entry
op_assign
id|entry-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
id|entry-&gt;next
op_assign
id|to_remove-&gt;next
suffix:semicolon
)brace
)brace
id|lec_arp_clear_vccs
c_func
(paren
id|to_remove
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|to_remove
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Expire entries.&n; * 1. Re-set timer&n; * 2. For each entry, delete entries that have aged past the age limit.&n; * 3. For each entry, depending on the status of the entry, perform&n; *    the following maintenance.&n; *    a. If status is ESI_VC_PENDING or ESI_ARP_PENDING then if the&n; *       tick_count is above the max_unknown_frame_time, clear&n; *       the tick_count to zero and clear the packets_flooded counter&n; *       to zero. This supports the packet rate limit per address&n; *       while flooding unknowns.&n; *    b. If the status is ESI_FLUSH_PENDING and the tick_count is greater&n; *       than or equal to the path_switching_delay, change the status&n; *       to ESI_FORWARD_DIRECT. This causes the flush period to end&n; *       regardless of the progress of the flush protocol.&n; */
r_static
r_void
DECL|function|lec_arp_check_expire
id|lec_arp_check_expire
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|data
suffix:semicolon
r_struct
id|lec_arp_table
op_star
op_star
id|lec_arp_tables
op_assign
(paren
r_struct
id|lec_arp_table
op_star
op_star
)paren
id|priv-&gt;lec_arp_tables
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|entry
comma
op_star
id|next
suffix:semicolon
r_int
r_int
id|now
suffix:semicolon
r_int
r_int
id|time_to_check
suffix:semicolon
r_int
id|i
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|priv-&gt;lec_arp_timer
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;lec_arp_check_expire %p,%d&bslash;n&quot;
comma
id|priv
comma
id|priv-&gt;lec_arp_lock_var.counter
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;expire: eo:%p nf:%p&bslash;n&quot;
comma
id|priv-&gt;lec_arp_empty_ones
comma
id|priv-&gt;lec_no_forward
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;lec_arp_lock_var.counter
)paren
(brace
id|lec_arp_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|now
op_assign
id|jiffies
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|entry
op_assign
id|lec_arp_tables
(braket
id|i
)braket
suffix:semicolon
id|entry
op_ne
l_int|NULL
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
(paren
id|entry-&gt;flags
)paren
op_amp
id|LEC_REMOTE_FLAG
op_logical_and
id|priv-&gt;topology_change
)paren
id|time_to_check
op_assign
id|priv-&gt;forward_delay_time
suffix:semicolon
r_else
id|time_to_check
op_assign
id|priv-&gt;aging_time
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;About to expire: %lx - %lx &gt; %lx&bslash;n&quot;
comma
id|now
comma
id|entry-&gt;last_used
comma
id|time_to_check
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|now
comma
id|entry-&gt;last_used
op_plus
id|time_to_check
)paren
op_logical_and
op_logical_neg
(paren
id|entry-&gt;flags
op_amp
id|LEC_PERMANENT_FLAG
)paren
op_logical_and
op_logical_neg
(paren
id|entry-&gt;mac_addr
(braket
l_int|0
)braket
op_amp
l_int|0x01
)paren
)paren
(brace
multiline_comment|/* LANE2: 7.1.20 */
multiline_comment|/* Remove entry */
id|DPRINTK
c_func
(paren
l_string|&quot;LEC:Entry timed out&bslash;n&quot;
)paren
suffix:semicolon
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
id|lec_arp_remove
c_func
(paren
id|lec_arp_tables
comma
id|entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
id|next
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Something else */
r_if
c_cond
(paren
(paren
id|entry-&gt;status
op_eq
id|ESI_VC_PENDING
op_logical_or
id|entry-&gt;status
op_eq
id|ESI_ARP_PENDING
)paren
op_logical_and
id|time_after_eq
c_func
(paren
id|now
comma
id|entry-&gt;timestamp
op_plus
id|priv-&gt;max_unknown_frame_time
)paren
)paren
(brace
id|entry-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
id|entry-&gt;packets_flooded
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;status
op_eq
id|ESI_VC_PENDING
)paren
id|send_to_lecd
c_func
(paren
id|priv
comma
id|l_svc_setup
comma
id|entry-&gt;mac_addr
comma
id|entry-&gt;atm_addr
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry-&gt;status
op_eq
id|ESI_FLUSH_PENDING
op_logical_and
id|time_after_eq
c_func
(paren
id|now
comma
id|entry-&gt;timestamp
op_plus
id|priv-&gt;path_switching_delay
)paren
)paren
(brace
id|entry-&gt;last_used
op_assign
id|jiffies
suffix:semicolon
id|entry-&gt;status
op_assign
id|ESI_FORWARD_DIRECT
suffix:semicolon
)brace
id|entry
op_assign
id|entry-&gt;next
suffix:semicolon
)brace
)brace
)brace
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
id|priv-&gt;lec_arp_timer.expires
op_assign
id|jiffies
op_plus
id|LEC_ARP_REFRESH_INTERVAL
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|priv-&gt;lec_arp_timer
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Try to find vcc where mac_address is attached.&n; * &n; */
r_struct
id|atm_vcc
op_star
DECL|function|lec_arp_resolve
id|lec_arp_resolve
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_int
r_char
op_star
id|mac_to_find
comma
r_int
id|is_rdesc
comma
r_struct
id|lec_arp_table
op_star
op_star
id|ret_entry
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
id|mac_to_find
(braket
l_int|0
)braket
op_amp
l_int|0x01
)paren
(brace
r_switch
c_cond
(paren
id|priv-&gt;lane_version
)paren
(brace
r_case
l_int|1
suffix:colon
r_return
id|priv-&gt;mcast_vcc
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* LANE2 wants arp for multicast addresses */
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|mac_to_find
comma
id|bus_mac
comma
id|ETH_ALEN
)paren
op_eq
l_int|0
)paren
r_return
id|priv-&gt;mcast_vcc
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
id|entry
op_assign
id|lec_arp_find
c_func
(paren
id|priv
comma
id|mac_to_find
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
(brace
r_if
c_cond
(paren
id|entry-&gt;status
op_eq
id|ESI_FORWARD_DIRECT
)paren
(brace
multiline_comment|/* Connection Ok */
id|entry-&gt;last_used
op_assign
id|jiffies
suffix:semicolon
op_star
id|ret_entry
op_assign
id|entry
suffix:semicolon
r_return
id|entry-&gt;vcc
suffix:semicolon
)brace
multiline_comment|/* Data direct VC not yet set up, check to see if the unknown&n;                   frame count is greater than the limit. If the limit has&n;                   not been reached, allow the caller to send packet to&n;                   BUS. */
r_if
c_cond
(paren
id|entry-&gt;status
op_ne
id|ESI_FLUSH_PENDING
op_logical_and
id|entry-&gt;packets_flooded
OL
id|priv-&gt;maximum_unknown_frame_count
)paren
(brace
id|entry-&gt;packets_flooded
op_increment
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP: Flooding..&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|priv-&gt;mcast_vcc
suffix:semicolon
)brace
multiline_comment|/* We got here because entry-&gt;status == ESI_FLUSH_PENDING&n;&t;&t; * or BUS flood limit was reached for an entry which is&n;&t;&t; * in ESI_ARP_PENDING or ESI_VC_PENDING state.&n;&t;&t; */
op_star
id|ret_entry
op_assign
id|entry
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;lec: entry-&gt;status %d entry-&gt;vcc %p&bslash;n&quot;
comma
id|entry-&gt;status
comma
id|entry-&gt;vcc
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* No matching entry was found */
id|entry
op_assign
id|make_entry
c_func
(paren
id|priv
comma
id|mac_to_find
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP: Making entry&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
(brace
r_return
id|priv-&gt;mcast_vcc
suffix:semicolon
)brace
id|lec_arp_put
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|entry
)paren
suffix:semicolon
multiline_comment|/* We want arp-request(s) to be sent */
id|entry-&gt;packets_flooded
op_assign
l_int|1
suffix:semicolon
id|entry-&gt;status
op_assign
id|ESI_ARP_PENDING
suffix:semicolon
id|entry-&gt;no_tries
op_assign
l_int|1
suffix:semicolon
id|entry-&gt;last_used
op_assign
id|entry-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
id|entry-&gt;is_rdesc
op_assign
id|is_rdesc
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;is_rdesc
)paren
id|send_to_lecd
c_func
(paren
id|priv
comma
id|l_rdesc_arp_xmt
comma
id|mac_to_find
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|send_to_lecd
c_func
(paren
id|priv
comma
id|l_arp_xmt
comma
id|mac_to_find
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|entry-&gt;timer.expires
op_assign
id|jiffies
op_plus
(paren
l_int|1
op_star
id|HZ
)paren
suffix:semicolon
id|entry-&gt;timer.function
op_assign
id|lec_arp_expire_arp
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
r_return
id|priv-&gt;mcast_vcc
suffix:semicolon
)brace
)brace
r_int
DECL|function|lec_addr_delete
id|lec_addr_delete
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_int
r_char
op_star
id|atm_addr
comma
r_int
r_int
id|permanent
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|entry
comma
op_star
id|next
suffix:semicolon
r_int
id|i
suffix:semicolon
id|lec_arp_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;lec_addr_delete&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|entry
op_assign
id|priv-&gt;lec_arp_tables
(braket
id|i
)braket
suffix:semicolon
id|entry
op_ne
l_int|NULL
suffix:semicolon
id|entry
op_assign
id|next
)paren
(brace
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|atm_addr
comma
id|entry-&gt;atm_addr
comma
id|ATM_ESA_LEN
)paren
op_logical_and
(paren
id|permanent
op_logical_or
op_logical_neg
(paren
id|entry-&gt;flags
op_amp
id|LEC_PERMANENT_FLAG
)paren
)paren
)paren
(brace
id|lec_arp_remove
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Notifies:  Response to arp_request (atm_addr != NULL) &n; */
r_void
DECL|function|lec_arp_update
id|lec_arp_update
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_int
r_char
op_star
id|mac_addr
comma
r_int
r_char
op_star
id|atm_addr
comma
r_int
r_int
id|remoteflag
comma
r_int
r_int
id|targetless_le_arp
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|entry
comma
op_star
id|tmp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;lec:%s&quot;
comma
(paren
id|targetless_le_arp
)paren
ques
c_cond
l_string|&quot;targetless &quot;
suffix:colon
l_string|&quot; &quot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;lec_arp_update mac:%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x&bslash;n&quot;
comma
id|mac_addr
(braket
l_int|0
)braket
comma
id|mac_addr
(braket
l_int|1
)braket
comma
id|mac_addr
(braket
l_int|2
)braket
comma
id|mac_addr
(braket
l_int|3
)braket
comma
id|mac_addr
(braket
l_int|4
)braket
comma
id|mac_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|entry
op_assign
id|lec_arp_find
c_func
(paren
id|priv
comma
id|mac_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
op_logical_and
id|targetless_le_arp
)paren
r_return
suffix:semicolon
multiline_comment|/* LANE2: ignore targetless LE_ARPs for which&n;                           * we have no entry in the cache. 7.1.30&n;                           */
id|lec_arp_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;lec_arp_empty_ones
)paren
(brace
id|entry
op_assign
id|priv-&gt;lec_arp_empty_ones
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|entry-&gt;atm_addr
comma
id|atm_addr
comma
id|ATM_ESA_LEN
)paren
)paren
(brace
id|priv-&gt;lec_arp_empty_ones
op_assign
id|entry-&gt;next
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|entry-&gt;next
op_logical_and
id|memcmp
c_func
(paren
id|entry-&gt;next-&gt;atm_addr
comma
id|atm_addr
comma
id|ATM_ESA_LEN
)paren
)paren
(brace
id|entry
op_assign
id|entry-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry-&gt;next
)paren
(brace
id|tmp
op_assign
id|entry
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
suffix:semicolon
id|tmp-&gt;next
op_assign
id|entry-&gt;next
suffix:semicolon
)brace
r_else
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|tmp
op_assign
id|lec_arp_find
c_func
(paren
id|priv
comma
id|mac_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|tmp-&gt;timer
)paren
suffix:semicolon
id|tmp-&gt;status
op_assign
id|ESI_FORWARD_DIRECT
suffix:semicolon
id|memcpy
c_func
(paren
id|tmp-&gt;atm_addr
comma
id|atm_addr
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|tmp-&gt;vcc
op_assign
id|entry-&gt;vcc
suffix:semicolon
id|tmp-&gt;old_push
op_assign
id|entry-&gt;old_push
suffix:semicolon
id|tmp-&gt;last_used
op_assign
id|jiffies
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
id|tmp
suffix:semicolon
)brace
r_else
(brace
id|entry-&gt;status
op_assign
id|ESI_FORWARD_DIRECT
suffix:semicolon
id|memcpy
c_func
(paren
id|entry-&gt;mac_addr
comma
id|mac_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|entry-&gt;last_used
op_assign
id|jiffies
suffix:semicolon
id|lec_arp_put
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|entry
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|remoteflag
)paren
id|entry-&gt;flags
op_or_assign
id|LEC_REMOTE_FLAG
suffix:semicolon
r_else
id|entry-&gt;flags
op_and_assign
op_complement
id|LEC_REMOTE_FLAG
suffix:semicolon
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;After update&bslash;n&quot;
)paren
suffix:semicolon
id|dump_arp_table
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|entry
op_assign
id|lec_arp_find
c_func
(paren
id|priv
comma
id|mac_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
(brace
id|entry
op_assign
id|make_entry
c_func
(paren
id|priv
comma
id|mac_addr
)paren
suffix:semicolon
id|entry-&gt;status
op_assign
id|ESI_UNKNOWN
suffix:semicolon
id|lec_arp_put
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|entry
)paren
suffix:semicolon
multiline_comment|/* Temporary, changes before end of function */
)brace
id|memcpy
c_func
(paren
id|entry-&gt;atm_addr
comma
id|atm_addr
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|tmp
op_assign
id|priv-&gt;lec_arp_tables
(braket
id|i
)braket
suffix:semicolon
id|tmp
suffix:semicolon
id|tmp
op_assign
id|tmp-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|entry
op_ne
id|tmp
op_logical_and
op_logical_neg
id|memcmp
c_func
(paren
id|tmp-&gt;atm_addr
comma
id|atm_addr
comma
id|ATM_ESA_LEN
)paren
)paren
(brace
multiline_comment|/* Vcc to this host exists */
r_if
c_cond
(paren
id|tmp-&gt;status
OG
id|ESI_VC_PENDING
)paren
(brace
multiline_comment|/*&n;                                         * ESI_FLUSH_PENDING,&n;                                         * ESI_FORWARD_DIRECT&n;                                         */
id|entry-&gt;vcc
op_assign
id|tmp-&gt;vcc
suffix:semicolon
id|entry-&gt;old_push
op_assign
id|tmp-&gt;old_push
suffix:semicolon
)brace
id|entry-&gt;status
op_assign
id|tmp-&gt;status
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|remoteflag
)paren
id|entry-&gt;flags
op_or_assign
id|LEC_REMOTE_FLAG
suffix:semicolon
r_else
id|entry-&gt;flags
op_and_assign
op_complement
id|LEC_REMOTE_FLAG
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;status
op_eq
id|ESI_ARP_PENDING
op_logical_or
id|entry-&gt;status
op_eq
id|ESI_UNKNOWN
)paren
(brace
id|entry-&gt;status
op_assign
id|ESI_VC_PENDING
suffix:semicolon
id|send_to_lecd
c_func
(paren
id|priv
comma
id|l_svc_setup
comma
id|entry-&gt;mac_addr
comma
id|atm_addr
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;After update2&bslash;n&quot;
)paren
suffix:semicolon
id|dump_arp_table
c_func
(paren
id|priv
)paren
suffix:semicolon
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Notifies: Vcc setup ready &n; */
r_void
DECL|function|lec_vcc_added
id|lec_vcc_added
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_struct
id|atmlec_ioc
op_star
id|ioc_data
comma
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_void
(paren
op_star
id|old_push
)paren
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|entry
suffix:semicolon
r_int
id|i
comma
id|found_entry
op_assign
l_int|0
suffix:semicolon
id|lec_arp_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ioc_data-&gt;receive
op_eq
l_int|2
)paren
(brace
multiline_comment|/* Vcc for Multicast Forward. No timer, LANEv2 7.1.20 and 2.3.5.3 */
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP: Attaching mcast forward&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if 0
id|entry
op_assign
id|lec_arp_find
c_func
(paren
id|priv
comma
id|bus_mac
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;LEC_ARP: Multicast entry not found!&bslash;n&quot;
)paren
suffix:semicolon
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|entry-&gt;atm_addr
comma
id|ioc_data-&gt;atm_addr
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|entry-&gt;recv_vcc
op_assign
id|vcc
suffix:semicolon
id|entry-&gt;old_recv_push
op_assign
id|old_push
suffix:semicolon
macro_line|#endif
id|entry
op_assign
id|make_entry
c_func
(paren
id|priv
comma
id|bus_mac
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
(brace
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|entry-&gt;atm_addr
comma
id|ioc_data-&gt;atm_addr
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|entry-&gt;recv_vcc
op_assign
id|vcc
suffix:semicolon
id|entry-&gt;old_recv_push
op_assign
id|old_push
suffix:semicolon
id|entry-&gt;next
op_assign
id|priv-&gt;mcast_fwds
suffix:semicolon
id|priv-&gt;mcast_fwds
op_assign
id|entry
suffix:semicolon
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ioc_data-&gt;receive
op_eq
l_int|1
)paren
(brace
multiline_comment|/* Vcc which we don&squot;t want to make default vcc, attach it&n;                   anyway. */
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP:Attaching data direct, not default :%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x&bslash;n&quot;
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|0
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|1
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|2
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|3
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|4
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|5
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|6
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|7
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|8
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|9
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|10
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|11
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|12
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|13
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|14
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|15
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|16
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|17
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|18
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|19
)braket
)paren
suffix:semicolon
id|entry
op_assign
id|make_entry
c_func
(paren
id|priv
comma
id|bus_mac
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|entry-&gt;atm_addr
comma
id|ioc_data-&gt;atm_addr
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|memset
c_func
(paren
id|entry-&gt;mac_addr
comma
l_int|0
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|entry-&gt;recv_vcc
op_assign
id|vcc
suffix:semicolon
id|entry-&gt;old_recv_push
op_assign
id|old_push
suffix:semicolon
id|entry-&gt;status
op_assign
id|ESI_UNKNOWN
suffix:semicolon
id|entry-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|priv-&gt;vcc_timeout_period
suffix:semicolon
id|entry-&gt;timer.function
op_assign
id|lec_arp_expire_vcc
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|entry-&gt;next
op_assign
id|priv-&gt;lec_no_forward
suffix:semicolon
id|priv-&gt;lec_no_forward
op_assign
id|entry
suffix:semicolon
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|dump_arp_table
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP:Attaching data direct, default:%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x%2.2x&bslash;n&quot;
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|0
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|1
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|2
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|3
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|4
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|5
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|6
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|7
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|8
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|9
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|10
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|11
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|12
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|13
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|14
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|15
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|16
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|17
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|18
)braket
comma
id|ioc_data-&gt;atm_addr
(braket
l_int|19
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|entry
op_assign
id|priv-&gt;lec_arp_tables
(braket
id|i
)braket
suffix:semicolon
id|entry
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|ioc_data-&gt;atm_addr
comma
id|entry-&gt;atm_addr
comma
id|ATM_ESA_LEN
)paren
op_eq
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP: Attaching data direct&bslash;n&quot;
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Currently -&gt; Vcc: %d, Rvcc:%d&bslash;n&quot;
comma
id|entry-&gt;vcc
ques
c_cond
id|entry-&gt;vcc-&gt;vci
suffix:colon
l_int|0
comma
id|entry-&gt;recv_vcc
ques
c_cond
id|entry-&gt;recv_vcc-&gt;vci
suffix:colon
l_int|0
)paren
suffix:semicolon
id|found_entry
op_assign
l_int|1
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|entry-&gt;vcc
op_assign
id|vcc
suffix:semicolon
id|entry-&gt;old_push
op_assign
id|old_push
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;status
op_eq
id|ESI_VC_PENDING
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;maximum_unknown_frame_count
op_eq
l_int|0
)paren
(brace
id|entry-&gt;status
op_assign
id|ESI_FORWARD_DIRECT
suffix:semicolon
)brace
r_else
(brace
id|entry-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
id|entry-&gt;status
op_assign
id|ESI_FLUSH_PENDING
suffix:semicolon
macro_line|#if 0
id|send_to_lecd
c_func
(paren
id|priv
comma
id|l_flush_xmt
comma
l_int|NULL
comma
id|entry-&gt;atm_addr
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_else
(brace
multiline_comment|/* They were forming a connection&n;                                           to us, and we to them. Our&n;                                           ATM address is numerically lower&n;                                           than theirs, so we make connection&n;                                           we formed into default VCC (8.1.11).&n;                                           Connection they made gets torn&n;                                           down. This might confuse some&n;                                           clients. Can be changed if&n;                                           someone reports trouble... */
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|found_entry
)paren
(brace
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;After vcc was added&bslash;n&quot;
)paren
suffix:semicolon
id|dump_arp_table
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Not found, snatch address from first data packet that arrives from&n;           this vcc */
id|entry
op_assign
id|make_entry
c_func
(paren
id|priv
comma
id|bus_mac
)paren
suffix:semicolon
id|entry-&gt;vcc
op_assign
id|vcc
suffix:semicolon
id|entry-&gt;old_push
op_assign
id|old_push
suffix:semicolon
id|memcpy
c_func
(paren
id|entry-&gt;atm_addr
comma
id|ioc_data-&gt;atm_addr
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|memset
c_func
(paren
id|entry-&gt;mac_addr
comma
l_int|0
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|entry-&gt;status
op_assign
id|ESI_UNKNOWN
suffix:semicolon
id|entry-&gt;next
op_assign
id|priv-&gt;lec_arp_empty_ones
suffix:semicolon
id|priv-&gt;lec_arp_empty_ones
op_assign
id|entry
suffix:semicolon
id|entry-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|priv-&gt;vcc_timeout_period
suffix:semicolon
id|entry-&gt;timer.function
op_assign
id|lec_arp_expire_vcc
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;After vcc was added&bslash;n&quot;
)paren
suffix:semicolon
id|dump_arp_table
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_void
DECL|function|lec_flush_complete
id|lec_flush_complete
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_int
r_int
id|tran_id
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|entry
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LEC:lec_flush_complete %lx&bslash;n&quot;
comma
id|tran_id
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|entry
op_assign
id|priv-&gt;lec_arp_tables
(braket
id|i
)braket
suffix:semicolon
id|entry
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|entry-&gt;flush_tran_id
op_eq
id|tran_id
op_logical_and
id|entry-&gt;status
op_eq
id|ESI_FLUSH_PENDING
)paren
(brace
id|entry-&gt;status
op_assign
id|ESI_FORWARD_DIRECT
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP: Flushed&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
id|dump_arp_table
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_void
DECL|function|lec_set_flush_tran_id
id|lec_set_flush_tran_id
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_int
r_char
op_star
id|atm_addr
comma
r_int
r_int
id|tran_id
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|entry
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|entry
op_assign
id|priv-&gt;lec_arp_tables
(braket
id|i
)braket
suffix:semicolon
id|entry
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
)paren
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|atm_addr
comma
id|entry-&gt;atm_addr
comma
id|ATM_ESA_LEN
)paren
)paren
(brace
id|entry-&gt;flush_tran_id
op_assign
id|tran_id
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;Set flush transaction id to %lx for %p&bslash;n&quot;
comma
id|tran_id
comma
id|entry
)paren
suffix:semicolon
)brace
)brace
r_int
DECL|function|lec_mcast_make
id|lec_mcast_make
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_int
r_char
id|mac_addr
(braket
)braket
op_assign
(brace
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
r_struct
id|lec_arp_table
op_star
id|to_add
suffix:semicolon
id|lec_arp_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|to_add
op_assign
id|make_entry
c_func
(paren
id|priv
comma
id|mac_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|to_add
)paren
(brace
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|to_add-&gt;atm_addr
comma
id|vcc-&gt;remote.sas_addr.prv
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|to_add-&gt;status
op_assign
id|ESI_FORWARD_DIRECT
suffix:semicolon
id|to_add-&gt;flags
op_or_assign
id|LEC_PERMANENT_FLAG
suffix:semicolon
id|to_add-&gt;vcc
op_assign
id|vcc
suffix:semicolon
id|to_add-&gt;old_push
op_assign
id|vcc-&gt;push
suffix:semicolon
id|vcc-&gt;push
op_assign
id|lec_push
suffix:semicolon
id|priv-&gt;mcast_vcc
op_assign
id|vcc
suffix:semicolon
id|lec_arp_put
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|to_add
)paren
suffix:semicolon
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|lec_vcc_close
id|lec_vcc_close
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|entry
comma
op_star
id|next
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP: lec_vcc_close vpi:%d vci:%d&bslash;n&quot;
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
id|dump_arp_table
c_func
(paren
id|priv
)paren
suffix:semicolon
id|lec_arp_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|LEC_ARP_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|entry
op_assign
id|priv-&gt;lec_arp_tables
(braket
id|i
)braket
suffix:semicolon
id|entry
suffix:semicolon
id|entry
op_assign
id|next
)paren
(brace
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|vcc
op_eq
id|entry-&gt;vcc
)paren
(brace
id|lec_arp_remove
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;mcast_vcc
op_eq
id|vcc
)paren
(brace
id|priv-&gt;mcast_vcc
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
)brace
id|entry
op_assign
id|priv-&gt;lec_arp_empty_ones
suffix:semicolon
id|priv-&gt;lec_arp_empty_ones
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_ne
l_int|NULL
)paren
(brace
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;vcc
op_eq
id|vcc
)paren
(brace
multiline_comment|/* leave it out from the list */
id|lec_arp_clear_vccs
c_func
(paren
id|entry
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* put it back to the list */
id|entry-&gt;next
op_assign
id|priv-&gt;lec_arp_empty_ones
suffix:semicolon
id|priv-&gt;lec_arp_empty_ones
op_assign
id|entry
suffix:semicolon
)brace
id|entry
op_assign
id|next
suffix:semicolon
)brace
id|entry
op_assign
id|priv-&gt;lec_no_forward
suffix:semicolon
id|priv-&gt;lec_no_forward
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_ne
l_int|NULL
)paren
(brace
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;recv_vcc
op_eq
id|vcc
)paren
(brace
id|lec_arp_clear_vccs
c_func
(paren
id|entry
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
r_else
(brace
id|entry-&gt;next
op_assign
id|priv-&gt;lec_no_forward
suffix:semicolon
id|priv-&gt;lec_no_forward
op_assign
id|entry
suffix:semicolon
)brace
id|entry
op_assign
id|next
suffix:semicolon
)brace
id|entry
op_assign
id|priv-&gt;mcast_fwds
suffix:semicolon
id|priv-&gt;mcast_fwds
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_ne
l_int|NULL
)paren
(brace
id|next
op_assign
id|entry-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;recv_vcc
op_eq
id|vcc
)paren
(brace
id|lec_arp_clear_vccs
c_func
(paren
id|entry
)paren
suffix:semicolon
multiline_comment|/* No timer, LANEv2 7.1.20 and 2.3.5.3 */
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
r_else
(brace
id|entry-&gt;next
op_assign
id|priv-&gt;mcast_fwds
suffix:semicolon
id|priv-&gt;mcast_fwds
op_assign
id|entry
suffix:semicolon
)brace
id|entry
op_assign
id|next
suffix:semicolon
)brace
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|dump_arp_table
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_void
DECL|function|lec_arp_check_empties
id|lec_arp_check_empties
c_func
(paren
r_struct
id|lec_priv
op_star
id|priv
comma
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|lec_arp_table
op_star
id|entry
comma
op_star
id|prev
suffix:semicolon
r_struct
id|lecdatahdr_8023
op_star
id|hdr
op_assign
(paren
r_struct
id|lecdatahdr_8023
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
op_star
id|src
suffix:semicolon
macro_line|#ifdef CONFIG_TR
r_struct
id|lecdatahdr_8025
op_star
id|tr_hdr
op_assign
(paren
r_struct
id|lecdatahdr_8025
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;is_trdev
)paren
id|src
op_assign
id|tr_hdr-&gt;h_source
suffix:semicolon
r_else
macro_line|#endif
id|src
op_assign
id|hdr-&gt;h_source
suffix:semicolon
id|lec_arp_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|entry
op_assign
id|priv-&gt;lec_arp_empty_ones
suffix:semicolon
r_if
c_cond
(paren
id|vcc
op_eq
id|entry-&gt;vcc
)paren
(brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|entry-&gt;mac_addr
comma
id|src
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|entry-&gt;status
op_assign
id|ESI_FORWARD_DIRECT
suffix:semicolon
id|entry-&gt;last_used
op_assign
id|jiffies
suffix:semicolon
id|priv-&gt;lec_arp_empty_ones
op_assign
id|entry-&gt;next
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* We might have got an entry */
r_if
c_cond
(paren
(paren
id|prev
op_assign
id|lec_arp_find
c_func
(paren
id|priv
comma
id|src
)paren
)paren
)paren
(brace
id|lec_arp_remove
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|prev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|prev
)paren
suffix:semicolon
)brace
id|lec_arp_put
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|entry
)paren
suffix:semicolon
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|prev
op_assign
id|entry
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_logical_and
id|entry-&gt;vcc
op_ne
id|vcc
)paren
(brace
id|prev
op_assign
id|entry
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;LEC_ARP: Arp_check_empties: entry not found!&bslash;n&quot;
)paren
suffix:semicolon
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|entry-&gt;timer
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|entry-&gt;mac_addr
comma
id|src
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|entry-&gt;status
op_assign
id|ESI_FORWARD_DIRECT
suffix:semicolon
id|entry-&gt;last_used
op_assign
id|jiffies
suffix:semicolon
id|prev-&gt;next
op_assign
id|entry-&gt;next
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|prev
op_assign
id|lec_arp_find
c_func
(paren
id|priv
comma
id|src
)paren
)paren
)paren
(brace
id|lec_arp_remove
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|prev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|prev
)paren
suffix:semicolon
)brace
id|lec_arp_put
c_func
(paren
id|priv-&gt;lec_arp_tables
comma
id|entry
)paren
suffix:semicolon
id|lec_arp_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
eof
