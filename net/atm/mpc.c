macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
multiline_comment|/* We are an ethernet device */
macro_line|#include &lt;linux/if_ether.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/checksum.h&gt;   /* for ip_fast_csum() */
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
multiline_comment|/* And atm device */
macro_line|#include &lt;linux/atmdev.h&gt;
macro_line|#include &lt;linux/atmlec.h&gt;
macro_line|#include &lt;linux/atmmpc.h&gt;
multiline_comment|/* Modular too */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &quot;lec.h&quot;
macro_line|#include &quot;mpc.h&quot;
macro_line|#include &quot;resources.h&quot;  /* for bind_vcc() */
multiline_comment|/*&n; * mpc.c: Implementation of MPOA client kernel part &n; */
macro_line|#if 0
mdefine_line|#define dprintk printk   /* debug */
macro_line|#else
DECL|macro|dprintk
mdefine_line|#define dprintk(format,args...)
macro_line|#endif
macro_line|#if 0
mdefine_line|#define ddprintk printk  /* more debug */
macro_line|#else
DECL|macro|ddprintk
mdefine_line|#define ddprintk(format,args...)
macro_line|#endif
DECL|macro|MPOA_TAG_LEN
mdefine_line|#define MPOA_TAG_LEN 4
multiline_comment|/* mpc_daemon -&gt; kernel */
r_static
r_void
id|MPOA_trigger_rcvd
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
suffix:semicolon
r_static
r_void
id|MPOA_res_reply_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
suffix:semicolon
r_static
r_void
id|ingress_purge_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
suffix:semicolon
r_static
r_void
id|egress_purge_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
suffix:semicolon
r_static
r_void
id|mps_death
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
suffix:semicolon
r_static
r_void
id|clean_up
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
comma
r_int
id|action
)paren
suffix:semicolon
r_static
r_void
id|MPOA_cache_impos_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
suffix:semicolon
r_static
r_void
id|set_mpc_ctrl_addr_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|mesg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
suffix:semicolon
r_static
r_void
id|set_mps_mac_addr_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|mesg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
suffix:semicolon
r_static
r_uint8
op_star
id|copy_macs
c_func
(paren
r_struct
id|mpoa_client
op_star
id|mpc
comma
r_uint8
op_star
id|router_mac
comma
r_uint8
op_star
id|tlvs
comma
r_uint8
id|mps_macs
comma
r_uint8
id|device_type
)paren
suffix:semicolon
r_static
r_void
id|purge_egress_shortcut
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
id|eg_cache_entry
op_star
id|entry
)paren
suffix:semicolon
r_static
r_void
id|send_set_mps_ctrl_addr
c_func
(paren
r_char
op_star
id|addr
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
suffix:semicolon
r_static
r_void
id|mpoad_close
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
suffix:semicolon
r_static
r_int
id|msg_from_mpoad
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_void
id|mpc_push
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|mpc_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|mpoa_event_listener
c_func
(paren
r_struct
id|notifier_block
op_star
id|mpoa_notifier
comma
r_int
r_int
id|event
comma
r_void
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|mpc_timer_refresh
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|mpc_cache_check
c_func
(paren
r_int
r_int
id|checking_time
)paren
suffix:semicolon
DECL|variable|llc_snap_mpoa_ctrl
r_static
r_struct
id|llc_snap_hdr
id|llc_snap_mpoa_ctrl
op_assign
(brace
l_int|0xaa
comma
l_int|0xaa
comma
l_int|0x03
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x5e
)brace
comma
(brace
l_int|0x00
comma
l_int|0x03
)brace
multiline_comment|/* For MPOA control PDUs */
)brace
suffix:semicolon
DECL|variable|llc_snap_mpoa_data
r_static
r_struct
id|llc_snap_hdr
id|llc_snap_mpoa_data
op_assign
(brace
l_int|0xaa
comma
l_int|0xaa
comma
l_int|0x03
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x08
comma
l_int|0x00
)brace
multiline_comment|/* This is for IP PDUs only */
)brace
suffix:semicolon
DECL|variable|llc_snap_mpoa_data_tagged
r_static
r_struct
id|llc_snap_hdr
id|llc_snap_mpoa_data_tagged
op_assign
(brace
l_int|0xaa
comma
l_int|0xaa
comma
l_int|0x03
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x88
comma
l_int|0x4c
)brace
multiline_comment|/* This is for tagged data PDUs */
)brace
suffix:semicolon
DECL|variable|mpoa_notifier
r_static
r_struct
id|notifier_block
id|mpoa_notifier
op_assign
(brace
id|mpoa_event_listener
comma
l_int|NULL
comma
l_int|0
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_extern
r_int
id|mpc_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|mpc_proc_clean
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|mpcs
r_struct
id|mpoa_client
op_star
id|mpcs
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* FIXME */
DECL|variable|qos_head
r_static
r_struct
id|atm_mpoa_qos
op_star
id|qos_head
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|mpc_timer
r_static
r_struct
id|timer_list
id|mpc_timer
suffix:semicolon
DECL|function|find_mpc_by_itfnum
r_static
r_struct
id|mpoa_client
op_star
id|find_mpc_by_itfnum
c_func
(paren
r_int
id|itf
)paren
(brace
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
id|mpc
op_assign
id|mpcs
suffix:semicolon
multiline_comment|/* our global linked list */
r_while
c_loop
(paren
id|mpc
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|mpc-&gt;dev_num
op_eq
id|itf
)paren
r_return
id|mpc
suffix:semicolon
id|mpc
op_assign
id|mpc-&gt;next
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* not found */
)brace
DECL|function|find_mpc_by_vcc
r_static
r_struct
id|mpoa_client
op_star
id|find_mpc_by_vcc
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
id|mpc
op_assign
id|mpcs
suffix:semicolon
multiline_comment|/* our global linked list */
r_while
c_loop
(paren
id|mpc
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|mpc-&gt;mpoad_vcc
op_eq
id|vcc
)paren
r_return
id|mpc
suffix:semicolon
id|mpc
op_assign
id|mpc-&gt;next
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* not found */
)brace
DECL|function|find_mpc_by_lec
r_static
r_struct
id|mpoa_client
op_star
id|find_mpc_by_lec
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
id|mpc
op_assign
id|mpcs
suffix:semicolon
multiline_comment|/* our global linked list */
r_while
c_loop
(paren
id|mpc
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|mpc-&gt;dev
op_eq
id|dev
)paren
r_return
id|mpc
suffix:semicolon
id|mpc
op_assign
id|mpc-&gt;next
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* not found */
)brace
multiline_comment|/*&n; * Functions for managing QoS list&n; */
multiline_comment|/*&n; * Overwrites the old entry or makes a new one.&n; */
DECL|function|atm_mpoa_add_qos
r_struct
id|atm_mpoa_qos
op_star
id|atm_mpoa_add_qos
c_func
(paren
r_uint32
id|dst_ip
comma
r_struct
id|atm_qos
op_star
id|qos
)paren
(brace
r_struct
id|atm_mpoa_qos
op_star
id|entry
suffix:semicolon
id|entry
op_assign
id|atm_mpoa_search_qos
c_func
(paren
id|dst_ip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;qos
op_assign
op_star
id|qos
suffix:semicolon
r_return
id|entry
suffix:semicolon
)brace
id|entry
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|atm_mpoa_qos
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: atm_mpoa_add_qos: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|entry
suffix:semicolon
)brace
id|entry-&gt;ipaddr
op_assign
id|dst_ip
suffix:semicolon
id|entry-&gt;qos
op_assign
op_star
id|qos
suffix:semicolon
id|entry-&gt;next
op_assign
id|qos_head
suffix:semicolon
id|qos_head
op_assign
id|entry
suffix:semicolon
r_return
id|entry
suffix:semicolon
)brace
DECL|function|atm_mpoa_search_qos
r_struct
id|atm_mpoa_qos
op_star
id|atm_mpoa_search_qos
c_func
(paren
r_uint32
id|dst_ip
)paren
(brace
r_struct
id|atm_mpoa_qos
op_star
id|qos
suffix:semicolon
id|qos
op_assign
id|qos_head
suffix:semicolon
r_while
c_loop
(paren
id|qos
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|qos-&gt;ipaddr
op_eq
id|dst_ip
)paren
(brace
r_break
suffix:semicolon
)brace
id|qos
op_assign
id|qos-&gt;next
suffix:semicolon
)brace
r_return
id|qos
suffix:semicolon
)brace
multiline_comment|/*&n; * Returns 0 for failure&n; */
DECL|function|atm_mpoa_delete_qos
r_int
id|atm_mpoa_delete_qos
c_func
(paren
r_struct
id|atm_mpoa_qos
op_star
id|entry
)paren
(brace
r_struct
id|atm_mpoa_qos
op_star
id|curr
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
id|qos_head
)paren
(brace
id|qos_head
op_assign
id|qos_head-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|curr
op_assign
id|qos_head
suffix:semicolon
r_while
c_loop
(paren
id|curr
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|curr-&gt;next
op_eq
id|entry
)paren
(brace
id|curr-&gt;next
op_assign
id|entry-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|curr
op_assign
id|curr-&gt;next
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atm_mpoa_disp_qos
r_void
id|atm_mpoa_disp_qos
c_func
(paren
r_char
op_star
id|page
comma
r_int
op_star
id|len
)paren
(brace
r_int
r_char
op_star
id|ip
suffix:semicolon
r_char
id|ipaddr
(braket
l_int|16
)braket
suffix:semicolon
r_struct
id|atm_mpoa_qos
op_star
id|qos
suffix:semicolon
id|qos
op_assign
id|qos_head
suffix:semicolon
op_star
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
op_star
id|len
comma
l_string|&quot;QoS entries for shortcuts:&bslash;n&quot;
)paren
suffix:semicolon
op_star
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
op_star
id|len
comma
l_string|&quot;IP address&bslash;n  TX:max_pcr pcr     min_pcr max_cdv max_sdu&bslash;n  RX:max_pcr pcr     min_pcr max_cdv max_sdu&bslash;n&quot;
)paren
suffix:semicolon
id|ipaddr
(braket
r_sizeof
(paren
id|ipaddr
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_while
c_loop
(paren
id|qos
op_ne
l_int|NULL
)paren
(brace
id|ip
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|qos-&gt;ipaddr
suffix:semicolon
id|sprintf
c_func
(paren
id|ipaddr
comma
l_string|&quot;%u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
id|ip
)paren
)paren
suffix:semicolon
op_star
id|len
op_add_assign
id|sprintf
c_func
(paren
id|page
op_plus
op_star
id|len
comma
l_string|&quot;%u.%u.%u.%u&bslash;n     %-7d %-7d %-7d %-7d %-7d&bslash;n     %-7d %-7d %-7d %-7d %-7d&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|ipaddr
)paren
comma
id|qos-&gt;qos.txtp.max_pcr
comma
id|qos-&gt;qos.txtp.pcr
comma
id|qos-&gt;qos.txtp.min_pcr
comma
id|qos-&gt;qos.txtp.max_cdv
comma
id|qos-&gt;qos.txtp.max_sdu
comma
id|qos-&gt;qos.rxtp.max_pcr
comma
id|qos-&gt;qos.rxtp.pcr
comma
id|qos-&gt;qos.rxtp.min_pcr
comma
id|qos-&gt;qos.rxtp.max_cdv
comma
id|qos-&gt;qos.rxtp.max_sdu
)paren
suffix:semicolon
id|qos
op_assign
id|qos-&gt;next
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|find_lec_by_itfnum
r_static
r_struct
id|net_device
op_star
id|find_lec_by_itfnum
c_func
(paren
r_int
id|itf
)paren
(brace
r_extern
r_struct
id|atm_lane_ops
id|atm_lane_ops
suffix:semicolon
multiline_comment|/* in common.c */
r_if
c_cond
(paren
id|atm_lane_ops.get_lecs
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|atm_lane_ops
dot
id|get_lecs
c_func
(paren
)paren
(braket
id|itf
)braket
suffix:semicolon
multiline_comment|/* FIXME: something better */
)brace
DECL|function|alloc_mpc
r_static
r_struct
id|mpoa_client
op_star
id|alloc_mpc
c_func
(paren
r_void
)paren
(brace
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
id|mpc
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mpoa_client
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|mpc
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|mpoa_client
)paren
)paren
suffix:semicolon
id|mpc-&gt;ingress_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
id|mpc-&gt;egress_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
id|mpc-&gt;next
op_assign
id|mpcs
suffix:semicolon
id|atm_mpoa_init_cache
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|mpc-&gt;parameters.mpc_p1
op_assign
id|MPC_P1
suffix:semicolon
id|mpc-&gt;parameters.mpc_p2
op_assign
id|MPC_P2
suffix:semicolon
id|memset
c_func
(paren
id|mpc-&gt;parameters.mpc_p3
comma
l_int|0
comma
r_sizeof
(paren
id|mpc-&gt;parameters.mpc_p3
)paren
)paren
suffix:semicolon
id|mpc-&gt;parameters.mpc_p4
op_assign
id|MPC_P4
suffix:semicolon
id|mpc-&gt;parameters.mpc_p5
op_assign
id|MPC_P5
suffix:semicolon
id|mpc-&gt;parameters.mpc_p6
op_assign
id|MPC_P6
suffix:semicolon
id|mpcs
op_assign
id|mpc
suffix:semicolon
r_return
id|mpc
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; * start_mpc() puts the MPC on line. All the packets destined&n; * to the lec underneath us are now being monitored and &n; * shortcuts will be established.&n; *&n; */
DECL|function|start_mpc
r_static
r_void
id|start_mpc
c_func
(paren
r_struct
id|mpoa_client
op_star
id|mpc
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) start_mpc:&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_start_xmit
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) start_mpc: dev-&gt;hard_start_xmit == NULL, not starting&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|mpc-&gt;old_hard_start_xmit
op_assign
id|dev-&gt;hard_start_xmit
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|mpc_send_packet
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|stop_mpc
r_static
r_void
id|stop_mpc
c_func
(paren
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) stop_mpc:&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Lets not nullify lec device&squot;s dev-&gt;hard_start_xmit */
r_if
c_cond
(paren
id|mpc-&gt;dev-&gt;hard_start_xmit
op_ne
id|mpc_send_packet
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot; mpc already stopped, not fatal&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|mpc-&gt;dev-&gt;hard_start_xmit
op_assign
id|mpc-&gt;old_hard_start_xmit
suffix:semicolon
id|mpc-&gt;old_hard_start_xmit
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* close_shortcuts(mpc);    ??? FIXME */
r_return
suffix:semicolon
)brace
DECL|function|mpoa_device_type_string
r_static
r_const
r_char
op_star
id|__attribute__
(paren
(paren
id|unused
)paren
)paren
id|mpoa_device_type_string
c_func
(paren
r_char
id|type
)paren
(brace
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|NON_MPOA
suffix:colon
r_return
l_string|&quot;non-MPOA device&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MPS
suffix:colon
r_return
l_string|&quot;MPS&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MPC
suffix:colon
r_return
l_string|&quot;MPC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MPS_AND_MPC
suffix:colon
r_return
l_string|&quot;both MPS and MPC&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;unspecified (non-MPOA) device&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_string|&quot;&quot;
suffix:semicolon
multiline_comment|/* not reached */
)brace
multiline_comment|/*&n; * lec device calls this via its dev-&gt;priv-&gt;lane2_ops-&gt;associate_indicator()&n; * when it sees a TLV in LE_ARP packet.&n; * We fill in the pointer above when we see a LANE2 lec initializing&n; * See LANE2 spec 3.1.5&n; *&n; * Quite a big and ugly function but when you look at it&n; * all it does is to try to locate and parse MPOA Device&n; * Type TLV.&n; * We give our lec a pointer to this function and when the&n; * lec sees a TLV it uses the pointer to call this function.&n; *&n; */
DECL|function|lane2_assoc_ind
r_static
r_void
id|lane2_assoc_ind
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_uint8
op_star
id|mac_addr
comma
r_uint8
op_star
id|tlvs
comma
r_uint32
id|sizeoftlvs
)paren
(brace
r_uint32
id|type
suffix:semicolon
r_uint8
id|length
comma
id|mpoa_device_type
comma
id|number_of_mps_macs
suffix:semicolon
r_uint8
op_star
id|end_of_tlvs
suffix:semicolon
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
id|mpoa_device_type
op_assign
id|number_of_mps_macs
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* silence gcc */
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) lane2_assoc_ind: received TLV(s), &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;total length of all TLVs %d&bslash;n&quot;
comma
id|sizeoftlvs
)paren
suffix:semicolon
id|mpc
op_assign
id|find_mpc_by_lec
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Sampo-Fix: moved here from below */
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) lane2_assoc_ind: no mpc&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|end_of_tlvs
op_assign
id|tlvs
op_plus
id|sizeoftlvs
suffix:semicolon
r_while
c_loop
(paren
id|end_of_tlvs
op_minus
id|tlvs
op_ge
l_int|5
)paren
(brace
id|type
op_assign
(paren
id|tlvs
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|tlvs
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|tlvs
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|tlvs
(braket
l_int|3
)braket
suffix:semicolon
id|length
op_assign
id|tlvs
(braket
l_int|4
)braket
suffix:semicolon
id|tlvs
op_add_assign
l_int|5
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;    type 0x%x length %02x&bslash;n&quot;
comma
id|type
comma
id|length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tlvs
op_plus
id|length
OG
id|end_of_tlvs
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;TLV value extends past its buffer, aborting parse&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|type
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) lane2_assoc_ind: TLV type was 0, returning&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|type
op_ne
id|TLV_MPOA_DEVICE_TYPE
)paren
(brace
id|tlvs
op_add_assign
id|length
suffix:semicolon
r_continue
suffix:semicolon
multiline_comment|/* skip other TLVs */
)brace
id|mpoa_device_type
op_assign
op_star
id|tlvs
op_increment
suffix:semicolon
id|number_of_mps_macs
op_assign
op_star
id|tlvs
op_increment
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) MPOA device type &squot;%s&squot;, &quot;
comma
id|dev-&gt;name
comma
id|mpoa_device_type_string
c_func
(paren
id|mpoa_device_type
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpoa_device_type
op_eq
id|MPS_AND_MPC
op_logical_and
id|length
OL
(paren
l_int|42
op_plus
id|number_of_mps_macs
op_star
id|ETH_ALEN
)paren
)paren
(brace
multiline_comment|/* :) */
id|printk
c_func
(paren
l_string|&quot;&bslash;nmpoa: (%s) lane2_assoc_ind: short MPOA Device Type TLV&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|mpoa_device_type
op_eq
id|MPS
op_logical_or
id|mpoa_device_type
op_eq
id|MPC
)paren
op_logical_and
id|length
OL
l_int|22
op_plus
id|number_of_mps_macs
op_star
id|ETH_ALEN
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nmpoa: (%s) lane2_assoc_ind: short MPOA Device Type TLV&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mpoa_device_type
op_ne
id|MPS
op_logical_and
id|mpoa_device_type
op_ne
id|MPS_AND_MPC
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;ignoring non-MPS device&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpoa_device_type
op_eq
id|MPC
)paren
id|tlvs
op_add_assign
l_int|20
suffix:semicolon
r_continue
suffix:semicolon
multiline_comment|/* we are only interested in MPSs */
)brace
r_if
c_cond
(paren
id|number_of_mps_macs
op_eq
l_int|0
op_logical_and
id|mpoa_device_type
op_eq
id|MPS_AND_MPC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nmpoa: (%s) lane2_assoc_ind: MPS_AND_MPC has zero MACs&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_continue
suffix:semicolon
multiline_comment|/* someone should read the spec */
)brace
id|dprintk
c_func
(paren
l_string|&quot;this MPS has %d MAC addresses&bslash;n&quot;
comma
id|number_of_mps_macs
)paren
suffix:semicolon
multiline_comment|/* ok, now we can go and tell our daemon the control address of MPS */
id|send_set_mps_ctrl_addr
c_func
(paren
id|tlvs
comma
id|mpc
)paren
suffix:semicolon
id|tlvs
op_assign
id|copy_macs
c_func
(paren
id|mpc
comma
id|mac_addr
comma
id|tlvs
comma
id|number_of_mps_macs
comma
id|mpoa_device_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tlvs
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|end_of_tlvs
op_minus
id|tlvs
op_ne
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) lane2_assoc_ind: ignoring %d bytes of trailing TLV carbage&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|end_of_tlvs
op_minus
id|tlvs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Store at least advertizing router&squot;s MAC address&n; * plus the possible MAC address(es) to mpc-&gt;mps_macs.&n; * For a freshly allocated MPOA client mpc-&gt;mps_macs == 0.&n; */
DECL|function|copy_macs
r_static
r_uint8
op_star
id|copy_macs
c_func
(paren
r_struct
id|mpoa_client
op_star
id|mpc
comma
r_uint8
op_star
id|router_mac
comma
r_uint8
op_star
id|tlvs
comma
r_uint8
id|mps_macs
comma
r_uint8
id|device_type
)paren
(brace
r_int
id|num_macs
suffix:semicolon
id|num_macs
op_assign
(paren
id|mps_macs
OG
l_int|1
)paren
ques
c_cond
id|mps_macs
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mpc-&gt;number_of_mps_macs
op_ne
id|num_macs
)paren
(brace
multiline_comment|/* need to reallocate? */
r_if
c_cond
(paren
id|mpc-&gt;number_of_mps_macs
op_ne
l_int|0
)paren
id|kfree
c_func
(paren
id|mpc-&gt;mps_macs
)paren
suffix:semicolon
id|mpc-&gt;number_of_mps_macs
op_assign
l_int|0
suffix:semicolon
id|mpc-&gt;mps_macs
op_assign
id|kmalloc
c_func
(paren
id|num_macs
op_star
id|ETH_ALEN
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc-&gt;mps_macs
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) copy_macs: out of mem&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
id|memcpy
c_func
(paren
id|mpc-&gt;mps_macs
comma
id|router_mac
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|tlvs
op_add_assign
l_int|20
suffix:semicolon
r_if
c_cond
(paren
id|device_type
op_eq
id|MPS_AND_MPC
)paren
id|tlvs
op_add_assign
l_int|20
suffix:semicolon
r_if
c_cond
(paren
id|mps_macs
OG
l_int|0
)paren
id|memcpy
c_func
(paren
id|mpc-&gt;mps_macs
comma
id|tlvs
comma
id|mps_macs
op_star
id|ETH_ALEN
)paren
suffix:semicolon
id|tlvs
op_add_assign
id|mps_macs
op_star
id|ETH_ALEN
suffix:semicolon
id|mpc-&gt;number_of_mps_macs
op_assign
id|num_macs
suffix:semicolon
r_return
id|tlvs
suffix:semicolon
)brace
DECL|function|send_via_shortcut
r_static
r_int
id|send_via_shortcut
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
id|in_cache_entry
op_star
id|entry
suffix:semicolon
r_struct
id|iphdr
op_star
id|iph
suffix:semicolon
r_char
op_star
id|buff
suffix:semicolon
r_uint32
id|ipaddr
op_assign
l_int|0
suffix:semicolon
r_static
r_struct
(brace
r_struct
id|llc_snap_hdr
id|hdr
suffix:semicolon
r_uint32
id|tag
suffix:semicolon
)brace
id|tagged_llc_snap_hdr
op_assign
(brace
(brace
l_int|0xaa
comma
l_int|0xaa
comma
l_int|0x03
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_int|0x88
comma
l_int|0x4c
)brace
)brace
comma
l_int|0
)brace
suffix:semicolon
id|buff
op_assign
id|skb-&gt;data
op_plus
id|mpc-&gt;dev-&gt;hard_header_len
suffix:semicolon
id|iph
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|buff
suffix:semicolon
id|ipaddr
op_assign
id|iph-&gt;daddr
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: (%s) send_via_shortcut: ipaddr 0x%x&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
comma
id|ipaddr
)paren
suffix:semicolon
id|entry
op_assign
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|get
c_func
(paren
id|ipaddr
comma
id|mpc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
(brace
id|entry
op_assign
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|add_entry
c_func
(paren
id|ipaddr
comma
id|mpc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_ne
l_int|NULL
)paren
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|cache_hit
c_func
(paren
id|entry
comma
id|mpc
)paren
op_ne
id|OPEN
)paren
(brace
multiline_comment|/* threshold not exceeded or VCC not ready */
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: (%s) send_via_shortcut: cache_hit: returns != OPEN&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: (%s) send_via_shortcut: using shortcut&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* MPOA spec A.1.4, MPOA client must decrement IP ttl at least by one */
r_if
c_cond
(paren
id|iph-&gt;ttl
op_le
l_int|1
)paren
(brace
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: (%s) send_via_shortcut: IP ttl = %u, using LANE&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
comma
id|iph-&gt;ttl
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|iph-&gt;ttl
op_decrement
suffix:semicolon
id|iph-&gt;check
op_assign
l_int|0
suffix:semicolon
id|iph-&gt;check
op_assign
id|ip_fast_csum
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|iph
comma
id|iph-&gt;ihl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;ctrl_info.tag
op_ne
l_int|0
)paren
(brace
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: (%s) send_via_shortcut: adding tag 0x%x&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
comma
id|entry-&gt;ctrl_info.tag
)paren
suffix:semicolon
id|tagged_llc_snap_hdr.tag
op_assign
id|entry-&gt;ctrl_info.tag
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|ETH_HLEN
)paren
suffix:semicolon
multiline_comment|/* get rid of Eth header */
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|tagged_llc_snap_hdr
)paren
)paren
suffix:semicolon
multiline_comment|/* add LLC/SNAP header   */
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|tagged_llc_snap_hdr
comma
r_sizeof
(paren
id|tagged_llc_snap_hdr
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb_pull
c_func
(paren
id|skb
comma
id|ETH_HLEN
)paren
suffix:semicolon
multiline_comment|/* get rid of Eth header */
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|llc_snap_hdr
)paren
)paren
suffix:semicolon
multiline_comment|/* add LLC/SNAP header + tag  */
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|llc_snap_mpoa_data
comma
r_sizeof
(paren
r_struct
id|llc_snap_hdr
)paren
)paren
suffix:semicolon
)brace
id|atomic_add
c_func
(paren
id|skb-&gt;truesize
comma
op_amp
id|entry-&gt;shortcut-&gt;tx_inuse
)paren
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* just to be safe ... */
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|atm_options
op_assign
id|entry-&gt;shortcut-&gt;atm_options
suffix:semicolon
id|entry-&gt;shortcut
op_member_access_from_pointer
id|send
c_func
(paren
id|entry-&gt;shortcut
comma
id|skb
)paren
suffix:semicolon
id|entry-&gt;packets_fwded
op_increment
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Probably needs some error checks and locking, not sure...&n; */
DECL|function|mpc_send_packet
r_static
r_int
id|mpc_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|retval
suffix:semicolon
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
r_struct
id|ethhdr
op_star
id|eth
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|mpc
op_assign
id|find_mpc_by_lec
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* this should NEVER fail */
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_send_packet: no MPC found&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|non_ip
suffix:semicolon
)brace
id|eth
op_assign
(paren
r_struct
id|ethhdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|eth-&gt;h_proto
op_ne
id|htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
r_goto
id|non_ip
suffix:semicolon
multiline_comment|/* Multi-Protocol Over ATM :-) */
r_while
c_loop
(paren
id|i
OL
id|mpc-&gt;number_of_mps_macs
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|eth-&gt;h_dest
comma
(paren
id|mpc-&gt;mps_macs
op_plus
id|i
op_star
id|ETH_ALEN
)paren
comma
id|ETH_ALEN
)paren
op_eq
l_int|0
)paren
r_if
c_cond
(paren
id|send_via_shortcut
c_func
(paren
id|skb
comma
id|mpc
)paren
op_eq
l_int|0
)paren
multiline_comment|/* try shortcut */
r_return
l_int|0
suffix:semicolon
multiline_comment|/* success!     */
id|i
op_increment
suffix:semicolon
)brace
id|non_ip
suffix:colon
id|retval
op_assign
id|mpc
op_member_access_from_pointer
id|old_hard_start_xmit
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|atm_mpoa_vcc_attach
r_int
id|atm_mpoa_vcc_attach
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|arg
)paren
(brace
r_int
id|bytes_left
suffix:semicolon
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
r_struct
id|atmmpc_ioc
id|ioc_data
suffix:semicolon
id|in_cache_entry
op_star
id|in_entry
suffix:semicolon
r_uint32
id|ipaddr
suffix:semicolon
r_int
r_char
op_star
id|ip
suffix:semicolon
id|bytes_left
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|ioc_data
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_struct
id|atmmpc_ioc
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytes_left
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: mpc_vcc_attach: Short read (missed %d bytes) from userland&bslash;n&quot;
comma
id|bytes_left
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|ipaddr
op_assign
id|ioc_data.ipaddr
suffix:semicolon
r_if
c_cond
(paren
id|ioc_data.dev_num
OL
l_int|0
op_logical_or
id|ioc_data.dev_num
op_ge
id|MAX_LEC_ITF
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|mpc
op_assign
id|find_mpc_by_itfnum
c_func
(paren
id|ioc_data.dev_num
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ioc_data.type
op_eq
id|MPC_SOCKET_INGRESS
)paren
(brace
id|in_entry
op_assign
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|get
c_func
(paren
id|ipaddr
comma
id|mpc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_entry
op_eq
l_int|NULL
op_logical_or
id|in_entry-&gt;entry_state
OL
id|INGRESS_RESOLVED
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_vcc_attach: did not find RESOLVED entry from ingress cache&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_entry
op_ne
l_int|NULL
)paren
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|in_entry
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|ip
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|in_entry-&gt;ctrl_info.in_dst_ip
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_vcc_attach: attaching ingress SVC, entry = %u.%u.%u.%u&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
comma
id|ip
(braket
l_int|0
)braket
comma
id|ip
(braket
l_int|1
)braket
comma
id|ip
(braket
l_int|2
)braket
comma
id|ip
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|in_entry-&gt;shortcut
op_assign
id|vcc
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|in_entry
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_vcc_attach: attaching egress SVC&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
id|vcc-&gt;proto_data
op_assign
id|mpc-&gt;dev
suffix:semicolon
id|vcc-&gt;push
op_assign
id|mpc_push
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; */
DECL|function|mpc_vcc_close
r_static
r_void
id|mpc_vcc_close
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
id|in_cache_entry
op_star
id|in_entry
suffix:semicolon
id|eg_cache_entry
op_star
id|eg_entry
suffix:semicolon
id|mpc
op_assign
id|find_mpc_by_lec
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_vcc_close: close for unknown MPC&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_vcc_close:&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|in_entry
op_assign
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|get_by_vcc
c_func
(paren
id|vcc
comma
id|mpc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_entry
)paren
(brace
r_int
r_char
op_star
id|ip
id|__attribute__
(paren
(paren
id|unused
)paren
)paren
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|in_entry-&gt;ctrl_info.in_dst_ip
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_vcc_close: ingress SVC closed ip = %u.%u.%u.%u&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
comma
id|ip
(braket
l_int|0
)braket
comma
id|ip
(braket
l_int|1
)braket
comma
id|ip
(braket
l_int|2
)braket
comma
id|ip
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|in_entry-&gt;shortcut
op_assign
l_int|NULL
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|in_entry
)paren
suffix:semicolon
)brace
id|eg_entry
op_assign
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|get_by_vcc
c_func
(paren
id|vcc
comma
id|mpc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eg_entry
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_vcc_close: egress SVC closed&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
id|eg_entry-&gt;shortcut
op_assign
l_int|NULL
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|eg_entry
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in_entry
op_eq
l_int|NULL
op_logical_and
id|eg_entry
op_eq
l_int|NULL
)paren
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_vcc_close:  unused vcc closed&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|mpc_push
r_static
r_void
id|mpc_push
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|vcc-&gt;proto_data
suffix:semicolon
r_struct
id|sk_buff
op_star
id|new_skb
suffix:semicolon
id|eg_cache_entry
op_star
id|eg
suffix:semicolon
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
r_uint32
id|tag
suffix:semicolon
r_char
op_star
id|tmp
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_push:&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_push: null skb, closing VCC&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|mpc_vcc_close
c_func
(paren
id|vcc
comma
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|llc_snap_mpoa_ctrl
comma
r_sizeof
(paren
r_struct
id|llc_snap_hdr
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_push: control packet arrived&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|vcc-&gt;recvq
comma
id|skb
)paren
suffix:semicolon
multiline_comment|/* Pass control packets to daemon */
id|wake_up
c_func
(paren
op_amp
id|vcc-&gt;sleep
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* data coming over the shortcut */
id|atm_return
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|mpc
op_assign
id|find_mpc_by_lec
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_push: unknown MPC&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|llc_snap_mpoa_data_tagged
comma
r_sizeof
(paren
r_struct
id|llc_snap_hdr
)paren
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* MPOA tagged data */
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_push: tagged data packet arrived&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|skb-&gt;data
comma
op_amp
id|llc_snap_mpoa_data
comma
r_sizeof
(paren
r_struct
id|llc_snap_hdr
)paren
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* MPOA data */
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_push: non-tagged data packet arrived&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;           mpc_push: non-tagged data unsupported, purging&bslash;n&quot;
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_push: garbage arrived, purging&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tmp
op_assign
id|skb-&gt;data
op_plus
r_sizeof
(paren
r_struct
id|llc_snap_hdr
)paren
suffix:semicolon
id|tag
op_assign
op_star
(paren
r_uint32
op_star
)paren
id|tmp
suffix:semicolon
id|eg
op_assign
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|get_by_tag
c_func
(paren
id|tag
comma
id|mpc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eg
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_push: Didn&squot;t find egress cache entry, tag = %u&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tag
)paren
suffix:semicolon
id|purge_egress_shortcut
c_func
(paren
id|vcc
comma
l_int|NULL
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * See if ingress MPC is using shortcut we opened as a return channel.&n;&t; * This means we have a bi-directional vcc opened by us.&n;&t; */
r_if
c_cond
(paren
id|eg-&gt;shortcut
op_eq
l_int|NULL
)paren
(brace
id|eg-&gt;shortcut
op_assign
id|vcc
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mpc_push: egress SVC in use&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|llc_snap_hdr
)paren
op_plus
r_sizeof
(paren
id|tag
)paren
)paren
suffix:semicolon
multiline_comment|/* get rid of LLC/SNAP header */
id|new_skb
op_assign
id|skb_realloc_headroom
c_func
(paren
id|skb
comma
id|eg-&gt;ctrl_info.DH_length
)paren
suffix:semicolon
multiline_comment|/* LLC/SNAP is shorter than MAC header :( */
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_skb
op_eq
l_int|NULL
)paren
(brace
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|eg
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_push
c_func
(paren
id|new_skb
comma
id|eg-&gt;ctrl_info.DH_length
)paren
suffix:semicolon
multiline_comment|/* add MAC header */
id|memcpy
c_func
(paren
id|new_skb-&gt;data
comma
id|eg-&gt;ctrl_info.DLL_header
comma
id|eg-&gt;ctrl_info.DH_length
)paren
suffix:semicolon
id|new_skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|new_skb
comma
id|dev
)paren
suffix:semicolon
id|new_skb-&gt;nh.raw
op_assign
id|new_skb-&gt;data
suffix:semicolon
id|eg-&gt;latest_ip_addr
op_assign
id|new_skb-&gt;nh.iph-&gt;saddr
suffix:semicolon
id|eg-&gt;packets_rcvd
op_increment
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|eg
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|new_skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|mpc_ops
r_static
r_struct
id|atmdev_ops
id|mpc_ops
op_assign
(brace
multiline_comment|/* only send is required */
id|close
suffix:colon
id|mpoad_close
comma
id|send
suffix:colon
id|msg_from_mpoad
)brace
suffix:semicolon
DECL|variable|mpc_dev
r_static
r_struct
id|atm_dev
id|mpc_dev
op_assign
(brace
op_amp
id|mpc_ops
comma
multiline_comment|/* device operations    */
l_int|NULL
comma
multiline_comment|/* PHY operations       */
l_string|&quot;mpc&quot;
comma
multiline_comment|/* device type name     */
l_int|42
comma
multiline_comment|/* device index (dummy) */
l_int|NULL
comma
multiline_comment|/* VCC table            */
l_int|NULL
comma
multiline_comment|/* last VCC             */
l_int|NULL
comma
multiline_comment|/* per-device data      */
l_int|NULL
comma
multiline_comment|/* private PHY data     */
(brace
l_int|0
)brace
comma
multiline_comment|/* device flags         */
l_int|NULL
comma
multiline_comment|/* local ATM address    */
(brace
l_int|0
)brace
multiline_comment|/* no ESI               */
multiline_comment|/* rest of the members will be 0 */
)brace
suffix:semicolon
DECL|function|atm_mpoa_mpoad_attach
r_int
id|atm_mpoa_mpoad_attach
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|arg
)paren
(brace
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
suffix:semicolon
r_if
c_cond
(paren
id|mpcs
op_eq
l_int|NULL
)paren
(brace
id|init_timer
c_func
(paren
op_amp
id|mpc_timer
)paren
suffix:semicolon
id|mpc_timer_refresh
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* This lets us now how our LECs are doing */
id|register_netdevice_notifier
c_func
(paren
op_amp
id|mpoa_notifier
)paren
suffix:semicolon
)brace
id|mpc
op_assign
id|find_mpc_by_itfnum
c_func
(paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: mpoad_attach: allocating new mpc for itf %d&bslash;n&quot;
comma
id|arg
)paren
suffix:semicolon
id|mpc
op_assign
id|alloc_mpc
c_func
(paren
)paren
suffix:semicolon
id|mpc-&gt;dev_num
op_assign
id|arg
suffix:semicolon
id|mpc-&gt;dev
op_assign
id|find_lec_by_itfnum
c_func
(paren
id|arg
)paren
suffix:semicolon
multiline_comment|/* NULL if there was no lec */
)brace
r_if
c_cond
(paren
id|mpc-&gt;mpoad_vcc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: mpoad_attach: mpoad is already present for itf %d&bslash;n&quot;
comma
id|arg
)paren
suffix:semicolon
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mpc-&gt;dev
)paren
(brace
multiline_comment|/* check if the lec is LANE2 capable */
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|mpc-&gt;dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;lane_version
OL
l_int|2
)paren
id|mpc-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
r_else
id|priv-&gt;lane2_ops-&gt;associate_indicator
op_assign
id|lane2_assoc_ind
suffix:semicolon
)brace
id|mpc-&gt;mpoad_vcc
op_assign
id|vcc
suffix:semicolon
id|bind_vcc
c_func
(paren
id|vcc
comma
op_amp
id|mpc_dev
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_META
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc-&gt;dev
)paren
(brace
r_char
id|empty
(braket
id|ATM_ESA_LEN
)braket
suffix:semicolon
id|memset
c_func
(paren
id|empty
comma
l_int|0
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|start_mpc
c_func
(paren
id|mpc
comma
id|mpc-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* set address if mpcd e.g. gets killed and restarted.&n;&t;&t; * If we do not do it now we have to wait for the next LE_ARP&n;&t;&t; */
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|mpc-&gt;mps_ctrl_addr
comma
id|empty
comma
id|ATM_ESA_LEN
)paren
op_ne
l_int|0
)paren
id|send_set_mps_ctrl_addr
c_func
(paren
id|mpc-&gt;mps_ctrl_addr
comma
id|mpc
)paren
suffix:semicolon
)brace
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
id|arg
suffix:semicolon
)brace
DECL|function|send_set_mps_ctrl_addr
r_static
r_void
id|send_set_mps_ctrl_addr
c_func
(paren
r_char
op_star
id|addr
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
r_struct
id|k_message
id|mesg
suffix:semicolon
id|memcpy
(paren
id|mpc-&gt;mps_ctrl_addr
comma
id|addr
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|mesg.type
op_assign
id|SET_MPS_CTRL_ADDR
suffix:semicolon
id|memcpy
c_func
(paren
id|mesg.MPS_ctrl
comma
id|addr
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|msg_to_mpoad
c_func
(paren
op_amp
id|mesg
comma
id|mpc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|mpoad_close
r_static
r_void
id|mpoad_close
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|mpc
op_assign
id|find_mpc_by_vcc
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: mpoad_close: did not find MPC&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mpc-&gt;mpoad_vcc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: mpoad_close: close for non-present mpoad&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|mpc-&gt;mpoad_vcc
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|mpc-&gt;dev
)paren
(brace
r_struct
id|lec_priv
op_star
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|mpc-&gt;dev-&gt;priv
suffix:semicolon
id|priv-&gt;lane2_ops-&gt;associate_indicator
op_assign
l_int|NULL
suffix:semicolon
id|stop_mpc
c_func
(paren
id|mpc
)paren
suffix:semicolon
)brace
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|destroy_cache
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|destroy_cache
c_func
(paren
id|mpc
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|vcc-&gt;recvq
)paren
)paren
)paren
(brace
id|atm_return
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) going down&bslash;n&quot;
comma
(paren
id|mpc-&gt;dev
)paren
ques
c_cond
id|mpc-&gt;dev-&gt;name
suffix:colon
l_string|&quot;&lt;unknown&gt;&quot;
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; */
DECL|function|msg_from_mpoad
r_static
r_int
id|msg_from_mpoad
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|mpoa_client
op_star
id|mpc
op_assign
id|find_mpc_by_vcc
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_struct
id|k_message
op_star
id|mesg
op_assign
(paren
r_struct
id|k_message
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|atomic_sub
c_func
(paren
id|skb-&gt;truesize
op_plus
id|ATM_PDU_OVHD
comma
op_amp
id|vcc-&gt;tx_inuse
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: msg_from_mpoad: no mpc found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) msg_from_mpoad:&quot;
comma
(paren
id|mpc-&gt;dev
)paren
ques
c_cond
id|mpc-&gt;dev-&gt;name
suffix:colon
l_string|&quot;&lt;unknown&gt;&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mesg-&gt;type
)paren
(brace
r_case
id|MPOA_RES_REPLY_RCVD
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; mpoa_res_reply_rcvd&bslash;n&quot;
)paren
suffix:semicolon
id|MPOA_res_reply_rcvd
c_func
(paren
id|mesg
comma
id|mpc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MPOA_TRIGGER_RCVD
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; mpoa_trigger_rcvd&bslash;n&quot;
)paren
suffix:semicolon
id|MPOA_trigger_rcvd
c_func
(paren
id|mesg
comma
id|mpc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INGRESS_PURGE_RCVD
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; nhrp_purge_rcvd&bslash;n&quot;
)paren
suffix:semicolon
id|ingress_purge_rcvd
c_func
(paren
id|mesg
comma
id|mpc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EGRESS_PURGE_RCVD
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; egress_purge_reply_rcvd&bslash;n&quot;
)paren
suffix:semicolon
id|egress_purge_rcvd
c_func
(paren
id|mesg
comma
id|mpc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MPS_DEATH
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; mps_death&bslash;n&quot;
)paren
suffix:semicolon
id|mps_death
c_func
(paren
id|mesg
comma
id|mpc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CACHE_IMPOS_RCVD
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; cache_impos_rcvd&bslash;n&quot;
)paren
suffix:semicolon
id|MPOA_cache_impos_rcvd
c_func
(paren
id|mesg
comma
id|mpc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SET_MPC_CTRL_ADDR
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; set_mpc_ctrl_addr&bslash;n&quot;
)paren
suffix:semicolon
id|set_mpc_ctrl_addr_rcvd
c_func
(paren
id|mesg
comma
id|mpc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SET_MPS_MAC_ADDR
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; set_mps_mac_addr&bslash;n&quot;
)paren
suffix:semicolon
id|set_mps_mac_addr_rcvd
c_func
(paren
id|mesg
comma
id|mpc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CLEAN_UP_AND_EXIT
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; clean_up_and_exit&bslash;n&quot;
)paren
suffix:semicolon
id|clean_up
c_func
(paren
id|mesg
comma
id|mpc
comma
id|DIE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RELOAD
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; reload&bslash;n&quot;
)paren
suffix:semicolon
id|clean_up
c_func
(paren
id|mesg
comma
id|mpc
comma
id|RELOAD
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SET_MPC_PARAMS
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; set_mpc_params&bslash;n&quot;
)paren
suffix:semicolon
id|mpc-&gt;parameters
op_assign
id|mesg-&gt;content.params
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot; unknown message %d&bslash;n&quot;
comma
id|mesg-&gt;type
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Remember that this function may not do things that sleep */
DECL|function|msg_to_mpoad
r_int
id|msg_to_mpoad
c_func
(paren
r_struct
id|k_message
op_star
id|mesg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
op_logical_or
op_logical_neg
id|mpc-&gt;mpoad_vcc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: msg_to_mpoad: mesg %d to a non-existent mpoad&bslash;n&quot;
comma
id|mesg-&gt;type
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|k_message
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|k_message
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|mesg
comma
r_sizeof
(paren
r_struct
id|k_message
)paren
)paren
suffix:semicolon
id|atm_force_charge
c_func
(paren
id|mpc-&gt;mpoad_vcc
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|mpc-&gt;mpoad_vcc-&gt;recvq
comma
id|skb
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|mpc-&gt;mpoad_vcc-&gt;sleep
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mpoa_event_listener
r_static
r_int
id|mpoa_event_listener
c_func
(paren
r_struct
id|notifier_block
op_star
id|mpoa_notifier
comma
r_int
r_int
id|event
comma
r_void
op_star
id|dev_ptr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|mpoa_client
op_star
id|mpc
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
suffix:semicolon
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_ptr
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;name
op_eq
l_int|NULL
op_logical_or
id|strncmp
c_func
(paren
id|dev-&gt;name
comma
l_string|&quot;lec&quot;
comma
l_int|3
)paren
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
multiline_comment|/* we are only interested in lec:s */
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|NETDEV_REGISTER
suffix:colon
multiline_comment|/* a new lec device was allocated */
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;lane_version
OL
l_int|2
)paren
r_break
suffix:semicolon
id|priv-&gt;lane2_ops-&gt;associate_indicator
op_assign
id|lane2_assoc_ind
suffix:semicolon
id|mpc
op_assign
id|find_mpc_by_itfnum
c_func
(paren
id|priv-&gt;itfnum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: mpoa_event_listener: allocating new mpc for %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|mpc
op_assign
id|alloc_mpc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: mpoa_event_listener: no new mpc&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|mpc-&gt;dev_num
op_assign
id|priv-&gt;itfnum
suffix:semicolon
id|mpc-&gt;dev
op_assign
id|dev
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) was initialized&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_UNREGISTER
suffix:colon
multiline_comment|/* the lec device was deallocated */
id|mpc
op_assign
id|find_mpc_by_lec
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: device (%s) was deallocated&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|stop_mpc
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|mpc-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_UP
suffix:colon
multiline_comment|/* the dev was ifconfig&squot;ed up */
id|mpc
op_assign
id|find_mpc_by_lec
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|mpc-&gt;mpoad_vcc
op_ne
l_int|NULL
)paren
(brace
id|start_mpc
c_func
(paren
id|mpc
comma
id|dev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|NETDEV_DOWN
suffix:colon
multiline_comment|/* the dev was ifconfig&squot;ed down */
multiline_comment|/* this means that the flow of packets from the&n;&t;&t; * upper layer stops&n;&t;&t; */
id|mpc
op_assign
id|find_mpc_by_lec
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|mpc-&gt;mpoad_vcc
op_ne
l_int|NULL
)paren
(brace
id|stop_mpc
c_func
(paren
id|mpc
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|NETDEV_REBOOT
suffix:colon
r_case
id|NETDEV_CHANGE
suffix:colon
r_case
id|NETDEV_CHANGEMTU
suffix:colon
r_case
id|NETDEV_CHANGEADDR
suffix:colon
r_case
id|NETDEV_GOING_DOWN
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
multiline_comment|/*&n; * Functions which are called after a message is received from mpcd.&n; * Msg is reused on purpose.&n; */
DECL|function|MPOA_trigger_rcvd
r_static
r_void
id|MPOA_trigger_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
r_uint32
id|dst_ip
op_assign
id|msg-&gt;content.in_info.in_dst_ip
suffix:semicolon
id|in_cache_entry
op_star
id|entry
suffix:semicolon
id|entry
op_assign
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|get
c_func
(paren
id|dst_ip
comma
id|mpc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
(brace
id|entry
op_assign
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|add_entry
c_func
(paren
id|dst_ip
comma
id|mpc
)paren
suffix:semicolon
id|entry-&gt;entry_state
op_assign
id|INGRESS_RESOLVING
suffix:semicolon
id|msg-&gt;type
op_assign
id|SND_MPOA_RES_RQST
suffix:semicolon
id|msg-&gt;content.in_info
op_assign
id|entry-&gt;ctrl_info
suffix:semicolon
id|msg_to_mpoad
c_func
(paren
id|msg
comma
id|mpc
)paren
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
(paren
id|entry-&gt;reply_wait
)paren
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry-&gt;entry_state
op_eq
id|INGRESS_INVALID
)paren
(brace
id|entry-&gt;entry_state
op_assign
id|INGRESS_RESOLVING
suffix:semicolon
id|msg-&gt;type
op_assign
id|SND_MPOA_RES_RQST
suffix:semicolon
id|msg-&gt;content.in_info
op_assign
id|entry-&gt;ctrl_info
suffix:semicolon
id|msg_to_mpoad
c_func
(paren
id|msg
comma
id|mpc
)paren
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
(paren
id|entry-&gt;reply_wait
)paren
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) MPOA_trigger_rcvd: entry already in resolving state&bslash;n&quot;
comma
(paren
id|mpc-&gt;dev
)paren
ques
c_cond
id|mpc-&gt;dev-&gt;name
suffix:colon
l_string|&quot;&lt;unknown&gt;&quot;
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Things get complicated because we have to check if there&squot;s an egress&n; * shortcut with suitable traffic parameters we could use. &n; */
DECL|function|check_qos_and_open_shortcut
r_static
r_void
id|check_qos_and_open_shortcut
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|client
comma
id|in_cache_entry
op_star
id|entry
)paren
(brace
r_uint32
id|dst_ip
op_assign
id|msg-&gt;content.in_info.in_dst_ip
suffix:semicolon
r_int
r_char
op_star
id|ip
id|__attribute__
(paren
(paren
id|unused
)paren
)paren
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|dst_ip
suffix:semicolon
r_struct
id|atm_mpoa_qos
op_star
id|qos
op_assign
id|atm_mpoa_search_qos
c_func
(paren
id|dst_ip
)paren
suffix:semicolon
id|eg_cache_entry
op_star
id|eg_entry
op_assign
id|client-&gt;eg_ops
op_member_access_from_pointer
id|get_by_src_ip
c_func
(paren
id|dst_ip
comma
id|client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eg_entry
op_logical_and
id|eg_entry-&gt;shortcut
)paren
(brace
r_if
c_cond
(paren
id|eg_entry-&gt;shortcut-&gt;qos.txtp.traffic_class
op_amp
id|msg-&gt;qos.txtp.traffic_class
op_amp
(paren
id|qos
ques
c_cond
id|qos-&gt;qos.txtp.traffic_class
suffix:colon
id|ATM_UBR
op_or
id|ATM_CBR
)paren
)paren
(brace
r_if
c_cond
(paren
id|eg_entry-&gt;shortcut-&gt;qos.txtp.traffic_class
op_eq
id|ATM_UBR
)paren
(brace
id|entry-&gt;shortcut
op_assign
id|eg_entry-&gt;shortcut
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|eg_entry-&gt;shortcut-&gt;qos.txtp.max_pcr
OG
l_int|0
)paren
(brace
id|entry-&gt;shortcut
op_assign
id|eg_entry-&gt;shortcut
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|entry-&gt;shortcut
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) using egress SVC to reach %u.%u.%u.%u&bslash;n&quot;
comma
id|client-&gt;dev-&gt;name
comma
id|NIPQUAD
c_func
(paren
id|ip
)paren
)paren
suffix:semicolon
id|client-&gt;eg_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|eg_entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|eg_entry
op_ne
l_int|NULL
)paren
id|client-&gt;eg_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|eg_entry
)paren
suffix:semicolon
multiline_comment|/* No luck in the egress cache we must open an ingress SVC */
id|msg-&gt;type
op_assign
id|OPEN_INGRESS_SVC
suffix:semicolon
r_if
c_cond
(paren
id|qos
op_logical_and
(paren
id|qos-&gt;qos.txtp.traffic_class
op_eq
id|msg-&gt;qos.txtp.traffic_class
)paren
)paren
(brace
id|msg-&gt;qos
op_assign
id|qos-&gt;qos
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) trying to get a CBR shortcut&bslash;n&quot;
comma
id|client-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
id|memset
c_func
(paren
op_amp
id|msg-&gt;qos
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|atm_qos
)paren
)paren
suffix:semicolon
id|msg_to_mpoad
c_func
(paren
id|msg
comma
id|client
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|MPOA_res_reply_rcvd
r_static
r_void
id|MPOA_res_reply_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
r_int
r_char
op_star
id|ip
suffix:semicolon
r_uint32
id|dst_ip
op_assign
id|msg-&gt;content.in_info.in_dst_ip
suffix:semicolon
id|in_cache_entry
op_star
id|entry
op_assign
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|get
c_func
(paren
id|dst_ip
comma
id|mpc
)paren
suffix:semicolon
id|ip
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|dst_ip
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) MPOA_res_reply_rcvd: ip %u.%u.%u.%u&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
comma
id|NIPQUAD
c_func
(paren
id|ip
)paren
)paren
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: (%s) MPOA_res_reply_rcvd() entry = %p&quot;
comma
id|mpc-&gt;dev-&gt;name
comma
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nmpoa: (%s) ARGH, received res. reply for an entry that doesn&squot;t exist.&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ddprintk
c_func
(paren
l_string|&quot; entry_state = %d &quot;
comma
id|entry-&gt;entry_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;entry_state
op_eq
id|INGRESS_RESOLVED
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nmpoa: (%s) MPOA_res_reply_rcvd for RESOLVED entry!&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|entry-&gt;ctrl_info
op_assign
id|msg-&gt;content.in_info
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
(paren
id|entry-&gt;tv
)paren
)paren
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
(paren
id|entry-&gt;reply_wait
)paren
)paren
suffix:semicolon
multiline_comment|/* Used in refreshing func from now on */
id|entry-&gt;refresh_time
op_assign
l_int|0
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;entry-&gt;shortcut = %p&bslash;n&quot;
comma
id|entry-&gt;shortcut
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;entry_state
op_eq
id|INGRESS_RESOLVING
op_logical_and
id|entry-&gt;shortcut
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;entry_state
op_assign
id|INGRESS_RESOLVED
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* Shortcut already open... */
)brace
r_if
c_cond
(paren
id|entry-&gt;shortcut
op_ne
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) MPOA_res_reply_rcvd: entry-&gt;shortcut != NULL, impossible!&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|check_qos_and_open_shortcut
c_func
(paren
id|msg
comma
id|mpc
comma
id|entry
)paren
suffix:semicolon
id|entry-&gt;entry_state
op_assign
id|INGRESS_RESOLVED
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|ingress_purge_rcvd
r_static
r_void
id|ingress_purge_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
r_uint32
id|dst_ip
op_assign
id|msg-&gt;content.in_info.in_dst_ip
suffix:semicolon
r_uint32
id|mask
op_assign
id|msg-&gt;ip_mask
suffix:semicolon
r_int
r_char
op_star
id|ip
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|dst_ip
suffix:semicolon
id|in_cache_entry
op_star
id|entry
op_assign
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|get_with_mask
c_func
(paren
id|dst_ip
comma
id|mpc
comma
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) ingress_purge_rcvd: purge for a non-existing entry, &quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ip = %u.%u.%u.%u&bslash;n&quot;
comma
id|ip
(braket
l_int|0
)braket
comma
id|ip
(braket
l_int|1
)braket
comma
id|ip
(braket
l_int|2
)braket
comma
id|ip
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_do
(brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) ingress_purge_rcvd: removing an ingress entry, ip = %u.%u.%u.%u&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
comma
id|ip
(braket
l_int|0
)braket
comma
id|ip
(braket
l_int|1
)braket
comma
id|ip
(braket
l_int|2
)braket
comma
id|ip
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|mpc-&gt;ingress_lock
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|remove_entry
c_func
(paren
id|entry
comma
id|mpc
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|mpc-&gt;ingress_lock
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|get_with_mask
c_func
(paren
id|dst_ip
comma
id|mpc
comma
id|mask
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|entry
op_ne
l_int|NULL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|egress_purge_rcvd
r_static
r_void
id|egress_purge_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
r_uint32
id|cache_id
op_assign
id|msg-&gt;content.eg_info.cache_id
suffix:semicolon
id|eg_cache_entry
op_star
id|entry
op_assign
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|get_by_cache_id
c_func
(paren
id|cache_id
comma
id|mpc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) egress_purge_rcvd: purge for a non-existing entry&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|write_lock_irq
c_func
(paren
op_amp
id|mpc-&gt;egress_lock
)paren
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|remove_entry
c_func
(paren
id|entry
comma
id|mpc
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|mpc-&gt;egress_lock
)paren
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|purge_egress_shortcut
r_static
r_void
id|purge_egress_shortcut
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
id|eg_cache_entry
op_star
id|entry
)paren
(brace
r_struct
id|k_message
op_star
id|purge_msg
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: purge_egress_shortcut: entering&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: purge_egress_shortcut: vcc == NULL&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|k_message
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: purge_egress_shortcut: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|k_message
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|skb-&gt;data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|k_message
)paren
)paren
suffix:semicolon
id|purge_msg
op_assign
(paren
r_struct
id|k_message
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|purge_msg-&gt;type
op_assign
id|DATA_PLANE_PURGE
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_ne
l_int|NULL
)paren
id|purge_msg-&gt;content.eg_info
op_assign
id|entry-&gt;ctrl_info
suffix:semicolon
id|atm_force_charge
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|vcc-&gt;recvq
comma
id|skb
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|vcc-&gt;sleep
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: purge_egress_shortcut: exiting:&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Our MPS died. Tell our daemon to send NHRP data plane purge to each&n; * of the egress shortcuts we have.&n; */
DECL|function|mps_death
r_static
r_void
id|mps_death
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
id|eg_cache_entry
op_star
id|entry
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) mps_death:&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|msg-&gt;MPS_ctrl
comma
id|mpc-&gt;mps_ctrl_addr
comma
id|ATM_ESA_LEN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) mps_death: wrong MPS&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* FIXME: This knows too much of the cache structure */
id|read_lock_irq
c_func
(paren
op_amp
id|mpc-&gt;egress_lock
)paren
suffix:semicolon
id|entry
op_assign
id|mpc-&gt;eg_cache
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_ne
l_int|NULL
)paren
(brace
id|purge_egress_shortcut
c_func
(paren
id|entry-&gt;shortcut
comma
id|entry
)paren
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
suffix:semicolon
)brace
id|read_unlock_irq
c_func
(paren
op_amp
id|mpc-&gt;egress_lock
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|destroy_cache
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|destroy_cache
c_func
(paren
id|mpc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|MPOA_cache_impos_rcvd
r_static
r_void
id|MPOA_cache_impos_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
r_uint16
id|holding_time
suffix:semicolon
id|eg_cache_entry
op_star
id|entry
op_assign
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|get_by_cache_id
c_func
(paren
id|msg-&gt;content.eg_info.cache_id
comma
id|mpc
)paren
suffix:semicolon
id|holding_time
op_assign
id|msg-&gt;content.eg_info.holding_time
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) MPOA_cache_impos_rcvd: entry = %p, holding_time = %u&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
comma
id|entry
comma
id|holding_time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
op_logical_and
id|holding_time
)paren
(brace
id|entry
op_assign
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|add_entry
c_func
(paren
id|msg
comma
id|mpc
)paren
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|holding_time
)paren
(brace
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|update
c_func
(paren
id|entry
comma
id|holding_time
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|write_lock_irq
c_func
(paren
op_amp
id|mpc-&gt;egress_lock
)paren
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|remove_entry
c_func
(paren
id|entry
comma
id|mpc
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|mpc-&gt;egress_lock
)paren
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|put
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|set_mpc_ctrl_addr_rcvd
r_static
r_void
id|set_mpc_ctrl_addr_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|mesg
comma
r_struct
id|mpoa_client
op_star
id|mpc
)paren
(brace
r_struct
id|lec_priv
op_star
id|priv
suffix:semicolon
r_int
id|i
comma
id|retval
suffix:semicolon
r_uint8
id|tlv
(braket
l_int|4
op_plus
l_int|1
op_plus
l_int|1
op_plus
l_int|1
op_plus
id|ATM_ESA_LEN
)braket
suffix:semicolon
id|tlv
(braket
l_int|0
)braket
op_assign
l_int|00
suffix:semicolon
id|tlv
(braket
l_int|1
)braket
op_assign
l_int|0xa0
suffix:semicolon
id|tlv
(braket
l_int|2
)braket
op_assign
l_int|0x3e
suffix:semicolon
id|tlv
(braket
l_int|3
)braket
op_assign
l_int|0x2a
suffix:semicolon
multiline_comment|/* type  */
id|tlv
(braket
l_int|4
)braket
op_assign
l_int|1
op_plus
l_int|1
op_plus
id|ATM_ESA_LEN
suffix:semicolon
multiline_comment|/* length                           */
id|tlv
(braket
l_int|5
)braket
op_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* MPOA client                      */
id|tlv
(braket
l_int|6
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* number of MPS MAC addresses      */
id|memcpy
c_func
(paren
op_amp
id|tlv
(braket
l_int|7
)braket
comma
id|mesg-&gt;MPS_ctrl
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
multiline_comment|/* MPC ctrl ATM addr */
id|memcpy
c_func
(paren
id|mpc-&gt;our_ctrl_addr
comma
id|mesg-&gt;MPS_ctrl
comma
id|ATM_ESA_LEN
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: (%s) setting MPC ctrl ATM address to &quot;
comma
(paren
id|mpc-&gt;dev
)paren
ques
c_cond
id|mpc-&gt;dev-&gt;name
suffix:colon
l_string|&quot;&lt;unknown&gt;&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|7
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|tlv
)paren
suffix:semicolon
id|i
op_increment
)paren
id|dprintk
c_func
(paren
l_string|&quot;%02x &quot;
comma
id|tlv
(braket
id|i
)braket
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mpc-&gt;dev
)paren
(brace
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|mpc-&gt;dev-&gt;priv
suffix:semicolon
id|retval
op_assign
id|priv-&gt;lane2_ops
op_member_access_from_pointer
id|associate_req
c_func
(paren
id|mpc-&gt;dev
comma
id|mpc-&gt;dev-&gt;dev_addr
comma
id|tlv
comma
r_sizeof
(paren
id|tlv
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) MPOA device type TLV association failed&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
id|retval
op_assign
id|priv-&gt;lane2_ops
op_member_access_from_pointer
id|resolve
c_func
(paren
id|mpc-&gt;dev
comma
l_int|NULL
comma
l_int|1
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;mpoa: (%s) targetless LE_ARP request failed&bslash;n&quot;
comma
id|mpc-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|set_mps_mac_addr_rcvd
r_static
r_void
id|set_mps_mac_addr_rcvd
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;number_of_mps_macs
)paren
(brace
id|kfree
c_func
(paren
id|client-&gt;mps_macs
)paren
suffix:semicolon
)brace
id|client-&gt;number_of_mps_macs
op_assign
l_int|0
suffix:semicolon
id|client-&gt;mps_macs
op_assign
id|kmalloc
c_func
(paren
id|ETH_ALEN
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;mps_macs
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpoa: set_mps_mac_addr_rcvd: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|client-&gt;number_of_mps_macs
op_assign
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|client-&gt;mps_macs
comma
id|msg-&gt;MPS_ctrl
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * purge egress cache and tell daemon to &squot;action&squot; (DIE, RELOAD)&n; */
DECL|function|clean_up
r_static
r_void
id|clean_up
c_func
(paren
r_struct
id|k_message
op_star
id|msg
comma
r_struct
id|mpoa_client
op_star
id|mpc
comma
r_int
id|action
)paren
(brace
id|eg_cache_entry
op_star
id|entry
suffix:semicolon
id|msg-&gt;type
op_assign
id|SND_EGRESS_PURGE
suffix:semicolon
multiline_comment|/* FIXME: This knows too much of the cache structure */
id|read_lock_irq
c_func
(paren
op_amp
id|mpc-&gt;egress_lock
)paren
suffix:semicolon
id|entry
op_assign
id|mpc-&gt;eg_cache
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_ne
l_int|NULL
)paren
(brace
id|msg-&gt;content.eg_info
op_assign
id|entry-&gt;ctrl_info
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: cache_id %u&bslash;n&quot;
comma
id|entry-&gt;ctrl_info.cache_id
)paren
suffix:semicolon
id|msg_to_mpoad
c_func
(paren
id|msg
comma
id|mpc
)paren
suffix:semicolon
id|entry
op_assign
id|entry-&gt;next
suffix:semicolon
)brace
id|read_unlock_irq
c_func
(paren
op_amp
id|mpc-&gt;egress_lock
)paren
suffix:semicolon
id|msg-&gt;type
op_assign
id|action
suffix:semicolon
id|msg_to_mpoad
c_func
(paren
id|msg
comma
id|mpc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|mpc_timer_refresh
r_static
r_void
id|mpc_timer_refresh
c_func
(paren
)paren
(brace
id|mpc_timer.expires
op_assign
id|jiffies
op_plus
(paren
id|MPC_P2
op_star
id|HZ
)paren
suffix:semicolon
id|mpc_timer.data
op_assign
id|mpc_timer.expires
suffix:semicolon
id|mpc_timer.function
op_assign
id|mpc_cache_check
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|mpc_timer
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|mpc_cache_check
r_static
r_void
id|mpc_cache_check
c_func
(paren
r_int
r_int
id|checking_time
)paren
(brace
r_struct
id|mpoa_client
op_star
id|mpc
op_assign
id|mpcs
suffix:semicolon
r_static
r_int
r_int
id|previous_resolving_check_time
op_assign
l_int|0
suffix:semicolon
r_static
r_int
r_int
id|previous_refresh_time
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|mpc
op_ne
l_int|NULL
)paren
(brace
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|clear_count
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|clear_expired
c_func
(paren
id|mpc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|checking_time
op_minus
id|previous_resolving_check_time
OG
id|mpc-&gt;parameters.mpc_p4
op_star
id|HZ
)paren
(brace
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|check_resolving
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|previous_resolving_check_time
op_assign
id|checking_time
suffix:semicolon
)brace
r_if
c_cond
(paren
id|checking_time
op_minus
id|previous_refresh_time
OG
id|mpc-&gt;parameters.mpc_p5
op_star
id|HZ
)paren
(brace
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|refresh
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|previous_refresh_time
op_assign
id|checking_time
suffix:semicolon
)brace
id|mpc
op_assign
id|mpc-&gt;next
suffix:semicolon
)brace
id|mpc_timer_refresh
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|atm_mpoa_init_ops
r_void
id|atm_mpoa_init_ops
c_func
(paren
r_struct
id|atm_mpoa_ops
op_star
id|ops
)paren
(brace
id|ops-&gt;mpoad_attach
op_assign
id|atm_mpoa_mpoad_attach
suffix:semicolon
id|ops-&gt;vcc_attach
op_assign
id|atm_mpoa_vcc_attach
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_if
c_cond
(paren
id|mpc_proc_init
c_func
(paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;mpoa: failed to initialize /proc/mpoa&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;mpoa: /proc/mpoa initialized&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;mpc.c: &quot;
id|__DATE__
l_string|&quot; &quot;
id|__TIME__
l_string|&quot; initialized&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_extern
r_struct
id|atm_mpoa_ops
id|atm_mpoa_ops
suffix:semicolon
id|atm_mpoa_init_ops
c_func
(paren
op_amp
id|atm_mpoa_ops
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_extern
r_struct
id|atm_mpoa_ops
id|atm_mpoa_ops
suffix:semicolon
r_struct
id|mpoa_client
op_star
id|mpc
comma
op_star
id|tmp
suffix:semicolon
r_struct
id|atm_mpoa_qos
op_star
id|qos
comma
op_star
id|nextqos
suffix:semicolon
r_struct
id|lec_priv
op_star
id|priv
suffix:semicolon
r_if
c_cond
(paren
id|MOD_IN_USE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mpc.c: module in use&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
id|mpc_proc_clean
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|del_timer
c_func
(paren
op_amp
id|mpc_timer
)paren
suffix:semicolon
id|unregister_netdevice_notifier
c_func
(paren
op_amp
id|mpoa_notifier
)paren
suffix:semicolon
id|atm_mpoa_ops.mpoad_attach
op_assign
l_int|NULL
suffix:semicolon
id|atm_mpoa_ops.vcc_attach
op_assign
l_int|NULL
suffix:semicolon
id|mpc
op_assign
id|mpcs
suffix:semicolon
id|mpcs
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|mpc
op_ne
l_int|NULL
)paren
(brace
id|tmp
op_assign
id|mpc-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|mpc-&gt;dev
op_ne
l_int|NULL
)paren
(brace
id|stop_mpc
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|priv
op_assign
(paren
r_struct
id|lec_priv
op_star
)paren
id|mpc-&gt;dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;lane2_ops
op_ne
l_int|NULL
)paren
id|priv-&gt;lane2_ops-&gt;associate_indicator
op_assign
l_int|NULL
suffix:semicolon
)brace
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: cleanup_module: about to clear caches&bslash;n&quot;
)paren
suffix:semicolon
id|mpc-&gt;in_ops
op_member_access_from_pointer
id|destroy_cache
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|mpc-&gt;eg_ops
op_member_access_from_pointer
id|destroy_cache
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: cleanup_module: caches cleared&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|mpc-&gt;mps_macs
)paren
suffix:semicolon
id|memset
c_func
(paren
id|mpc
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|mpoa_client
)paren
)paren
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: cleanup_module: about to kfree %p&bslash;n&quot;
comma
id|mpc
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|mpc
)paren
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;mpoa: cleanup_module: next mpc is at %p&bslash;n&quot;
comma
id|tmp
)paren
suffix:semicolon
id|mpc
op_assign
id|tmp
suffix:semicolon
)brace
id|qos
op_assign
id|qos_head
suffix:semicolon
id|qos_head
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|qos
op_ne
l_int|NULL
)paren
(brace
id|nextqos
op_assign
id|qos-&gt;next
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mpoa: cleanup_module: freeing qos entry %p&bslash;n&quot;
comma
id|qos
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|qos
)paren
suffix:semicolon
id|qos
op_assign
id|nextqos
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
eof
