multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;ROUTE - implementation of the IP router.&n; *&n; * Version:&t;$Id: route.c,v 1.91 2000/10/03 07:29:00 anton Exp $&n; *&n; * Authors:&t;Ross Biro, &lt;bir7@leland.Stanford.Edu&gt;&n; *&t;&t;Fred N. van Kempen, &lt;waltje@uWalt.NL.Mugnet.ORG&gt;&n; *&t;&t;Alan Cox, &lt;gw4pts@gw4pts.ampr.org&gt;&n; *&t;&t;Linus Torvalds, &lt;Linus.Torvalds@helsinki.fi&gt;&n; *&t;&t;Alexey Kuznetsov, &lt;kuznet@ms2.inr.ac.ru&gt;&n; *&n; * Fixes:&n; *&t;&t;Alan Cox&t;:&t;Verify area fixes.&n; *&t;&t;Alan Cox&t;:&t;cli() protects routing changes&n; *&t;&t;Rui Oliveira&t;:&t;ICMP routing table updates&n; *&t;&t;(rco@di.uminho.pt)&t;Routing table insertion and update&n; *&t;&t;Linus Torvalds&t;:&t;Rewrote bits to be sensible&n; *&t;&t;Alan Cox&t;:&t;Added BSD route gw semantics&n; *&t;&t;Alan Cox&t;:&t;Super /proc &gt;4K &n; *&t;&t;Alan Cox&t;:&t;MTU in route table&n; *&t;&t;Alan Cox&t;: &t;MSS actually. Also added the window&n; *&t;&t;&t;&t;&t;clamper.&n; *&t;&t;Sam Lantinga&t;:&t;Fixed route matching in rt_del()&n; *&t;&t;Alan Cox&t;:&t;Routing cache support.&n; *&t;&t;Alan Cox&t;:&t;Removed compatibility cruft.&n; *&t;&t;Alan Cox&t;:&t;RTF_REJECT support.&n; *&t;&t;Alan Cox&t;:&t;TCP irtt support.&n; *&t;&t;Jonathan Naylor&t;:&t;Added Metric support.&n; *&t;Miquel van Smoorenburg&t;:&t;BSD API fixes.&n; *&t;Miquel van Smoorenburg&t;:&t;Metrics.&n; *&t;&t;Alan Cox&t;:&t;Use __u32 properly&n; *&t;&t;Alan Cox&t;:&t;Aligned routing errors more closely with BSD&n; *&t;&t;&t;&t;&t;our system is still very different.&n; *&t;&t;Alan Cox&t;:&t;Faster /proc handling&n; *&t;Alexey Kuznetsov&t;:&t;Massive rework to support tree based routing,&n; *&t;&t;&t;&t;&t;routing caches and better behaviour.&n; *&t;&t;&n; *&t;&t;Olaf Erb&t;:&t;irtt wasn&squot;t being copied right.&n; *&t;&t;Bjorn Ekwall&t;:&t;Kerneld route support.&n; *&t;&t;Alan Cox&t;:&t;Multicast fixed (I hope)&n; * &t;&t;Pavel Krauz&t;:&t;Limited broadcast fixed&n; *&t;&t;Mike McLagan&t;:&t;Routing by source&n; *&t;Alexey Kuznetsov&t;:&t;End of old history. Splitted to fib.c and&n; *&t;&t;&t;&t;&t;route.c and rewritten from scratch.&n; *&t;&t;Andi Kleen&t;:&t;Load-limit warning messages.&n; *&t;Vitaly E. Lavrov&t;:&t;Transparent proxy revived after year coma.&n; *&t;Vitaly E. Lavrov&t;:&t;Race condition in ip_route_input_slow.&n; *&t;Tobias Ringstrom&t;:&t;Uninitialized res.type in ip_route_output_slow.&n; *&t;Vladimir V. Ivanov&t;:&t;IP rule info (flowid) is really useful.&n; *&t;&t;Marc Boucher&t;:&t;routing by fwmark&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/igmp.h&gt;
macro_line|#include &lt;linux/pkt_sched.h&gt;
macro_line|#include &lt;linux/mroute.h&gt;
macro_line|#include &lt;linux/netfilter_ipv4.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;net/inetpeer.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/ip_fib.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/icmp.h&gt;
macro_line|#ifdef CONFIG_SYSCTL
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#endif
DECL|macro|IP_MAX_MTU
mdefine_line|#define IP_MAX_MTU&t;0xFFF0
DECL|macro|RT_GC_TIMEOUT
mdefine_line|#define RT_GC_TIMEOUT (300*HZ)
DECL|variable|ip_rt_min_delay
r_int
id|ip_rt_min_delay
op_assign
l_int|2
op_star
id|HZ
suffix:semicolon
DECL|variable|ip_rt_max_delay
r_int
id|ip_rt_max_delay
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
DECL|variable|ip_rt_max_size
r_int
id|ip_rt_max_size
suffix:semicolon
DECL|variable|ip_rt_gc_timeout
r_int
id|ip_rt_gc_timeout
op_assign
id|RT_GC_TIMEOUT
suffix:semicolon
DECL|variable|ip_rt_gc_interval
r_int
id|ip_rt_gc_interval
op_assign
l_int|60
op_star
id|HZ
suffix:semicolon
DECL|variable|ip_rt_gc_min_interval
r_int
id|ip_rt_gc_min_interval
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
DECL|variable|ip_rt_redirect_number
r_int
id|ip_rt_redirect_number
op_assign
l_int|9
suffix:semicolon
DECL|variable|ip_rt_redirect_load
r_int
id|ip_rt_redirect_load
op_assign
id|HZ
op_div
l_int|50
suffix:semicolon
DECL|variable|ip_rt_redirect_silence
r_int
id|ip_rt_redirect_silence
op_assign
(paren
(paren
id|HZ
op_div
l_int|50
)paren
op_lshift
(paren
l_int|9
op_plus
l_int|1
)paren
)paren
suffix:semicolon
DECL|variable|ip_rt_error_cost
r_int
id|ip_rt_error_cost
op_assign
id|HZ
suffix:semicolon
DECL|variable|ip_rt_error_burst
r_int
id|ip_rt_error_burst
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
DECL|variable|ip_rt_gc_elasticity
r_int
id|ip_rt_gc_elasticity
op_assign
l_int|8
suffix:semicolon
DECL|variable|ip_rt_mtu_expires
r_int
id|ip_rt_mtu_expires
op_assign
l_int|10
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
DECL|variable|ip_rt_min_pmtu
r_int
id|ip_rt_min_pmtu
op_assign
l_int|512
op_plus
l_int|20
op_plus
l_int|20
suffix:semicolon
DECL|variable|ip_rt_min_advmss
r_int
id|ip_rt_min_advmss
op_assign
l_int|536
suffix:semicolon
DECL|variable|rt_deadline
r_static
r_int
r_int
id|rt_deadline
suffix:semicolon
DECL|macro|RTprint
mdefine_line|#define RTprint(a...)&t;printk(KERN_DEBUG a)
DECL|variable|rt_flush_timer
r_static
r_struct
id|timer_list
id|rt_flush_timer
suffix:semicolon
DECL|variable|rt_periodic_timer
r_static
r_struct
id|timer_list
id|rt_periodic_timer
suffix:semicolon
multiline_comment|/*&n; *&t;Interface to generic destination cache.&n; */
r_static
r_struct
id|dst_entry
op_star
id|ipv4_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|u32
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|ipv4_dst_reroute
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
r_static
r_void
id|ipv4_dst_destroy
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|ipv4_negative_advice
c_func
(paren
r_struct
id|dst_entry
op_star
)paren
suffix:semicolon
r_static
r_void
id|ipv4_link_failure
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|rt_garbage_collect
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|ipv4_dst_ops
r_struct
id|dst_ops
id|ipv4_dst_ops
op_assign
(brace
id|AF_INET
comma
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
comma
l_int|0
comma
id|rt_garbage_collect
comma
id|ipv4_dst_check
comma
id|ipv4_dst_reroute
comma
id|ipv4_dst_destroy
comma
id|ipv4_negative_advice
comma
id|ipv4_link_failure
comma
r_sizeof
(paren
r_struct
id|rtable
)paren
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_INET_ECN
DECL|macro|ECN_OR_COST
mdefine_line|#define ECN_OR_COST(class)&t;TC_PRIO_##class
macro_line|#else
DECL|macro|ECN_OR_COST
mdefine_line|#define ECN_OR_COST(class)&t;TC_PRIO_FILLER
macro_line|#endif
DECL|variable|ip_tos2prio
id|__u8
id|ip_tos2prio
(braket
l_int|16
)braket
op_assign
(brace
id|TC_PRIO_BESTEFFORT
comma
id|ECN_OR_COST
c_func
(paren
id|FILLER
)paren
comma
id|TC_PRIO_BESTEFFORT
comma
id|ECN_OR_COST
c_func
(paren
id|BESTEFFORT
)paren
comma
id|TC_PRIO_BULK
comma
id|ECN_OR_COST
c_func
(paren
id|BULK
)paren
comma
id|TC_PRIO_BULK
comma
id|ECN_OR_COST
c_func
(paren
id|BULK
)paren
comma
id|TC_PRIO_INTERACTIVE
comma
id|ECN_OR_COST
c_func
(paren
id|INTERACTIVE
)paren
comma
id|TC_PRIO_INTERACTIVE
comma
id|ECN_OR_COST
c_func
(paren
id|INTERACTIVE
)paren
comma
id|TC_PRIO_INTERACTIVE_BULK
comma
id|ECN_OR_COST
c_func
(paren
id|INTERACTIVE_BULK
)paren
comma
id|TC_PRIO_INTERACTIVE_BULK
comma
id|ECN_OR_COST
c_func
(paren
id|INTERACTIVE_BULK
)paren
)brace
suffix:semicolon
multiline_comment|/*&n; * Route cache.&n; */
multiline_comment|/* The locking scheme is rather straight forward:&n; *&n; * 1) A BH protected rwlocks protect buckets of the central route hash.&n; * 2) Only writers remove entries, and they hold the lock&n; *    as they look at rtable reference counts.&n; * 3) Only readers acquire references to rtable entries,&n; *    they do so with atomic increments and with the&n; *    lock held.&n; */
DECL|struct|rt_hash_bucket
r_struct
id|rt_hash_bucket
(brace
DECL|member|chain
r_struct
id|rtable
op_star
id|chain
suffix:semicolon
DECL|member|lock
id|rwlock_t
id|lock
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|__aligned__
c_func
(paren
l_int|8
)paren
)paren
)paren
suffix:semicolon
DECL|variable|rt_hash_table
r_static
r_struct
id|rt_hash_bucket
op_star
id|rt_hash_table
suffix:semicolon
DECL|variable|rt_hash_mask
r_static
r_int
id|rt_hash_mask
suffix:semicolon
DECL|variable|rt_hash_log
r_static
r_int
id|rt_hash_log
suffix:semicolon
r_static
r_int
id|rt_intern_hash
c_func
(paren
r_int
id|hash
comma
r_struct
id|rtable
op_star
id|rth
comma
r_struct
id|rtable
op_star
op_star
id|res
)paren
suffix:semicolon
DECL|function|rt_hash_code
r_static
id|__inline__
r_int
id|rt_hash_code
c_func
(paren
id|u32
id|daddr
comma
id|u32
id|saddr
comma
id|u8
id|tos
)paren
(brace
r_int
id|hash
op_assign
(paren
(paren
id|daddr
op_amp
l_int|0xF0F0F0F0
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
id|daddr
op_amp
l_int|0x0F0F0F0F
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|hash
op_xor_assign
id|saddr
op_xor
id|tos
suffix:semicolon
id|hash
op_xor_assign
(paren
id|hash
op_rshift
l_int|16
)paren
suffix:semicolon
r_return
(paren
id|hash
op_xor
(paren
id|hash
op_rshift
l_int|8
)paren
)paren
op_amp
id|rt_hash_mask
suffix:semicolon
)brace
DECL|function|rt_cache_get_info
r_static
r_int
id|rt_cache_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
r_char
id|temp
(braket
l_int|129
)braket
suffix:semicolon
r_struct
id|rtable
op_star
id|r
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pos
op_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|offset
OL
l_int|128
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
l_string|&quot;Iface&bslash;tDestination&bslash;tGateway &bslash;tFlags&bslash;t&bslash;tRefCnt&bslash;tUse&bslash;tMetric&bslash;tSource&bslash;t&bslash;tMTU&bslash;tWindow&bslash;tIRTT&bslash;tTOS&bslash;tHHRef&bslash;tHHUptod&bslash;tSpecDst&quot;
)paren
suffix:semicolon
id|len
op_assign
l_int|128
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|rt_hash_mask
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|read_lock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|r
op_assign
id|rt_hash_table
(braket
id|i
)braket
dot
id|chain
suffix:semicolon
id|r
suffix:semicolon
id|r
op_assign
id|r-&gt;u.rt_next
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; *&t;Spin through entries until we are ready&n;&t;&t;&t; */
id|pos
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_le
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|temp
comma
l_string|&quot;%s&bslash;t%08lX&bslash;t%08lX&bslash;t%8X&bslash;t%d&bslash;t%u&bslash;t%d&bslash;t%08lX&bslash;t%d&bslash;t%u&bslash;t%u&bslash;t%02X&bslash;t%d&bslash;t%1d&bslash;t%08X&quot;
comma
id|r-&gt;u.dst.dev
ques
c_cond
id|r-&gt;u.dst.dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
comma
(paren
r_int
r_int
)paren
id|r-&gt;rt_dst
comma
(paren
r_int
r_int
)paren
id|r-&gt;rt_gateway
comma
id|r-&gt;rt_flags
comma
id|atomic_read
c_func
(paren
op_amp
id|r-&gt;u.dst.__refcnt
)paren
comma
id|r-&gt;u.dst.__use
comma
l_int|0
comma
(paren
r_int
r_int
)paren
id|r-&gt;rt_src
comma
(paren
r_int
)paren
id|r-&gt;u.dst.advmss
op_plus
l_int|40
comma
id|r-&gt;u.dst.window
comma
(paren
r_int
)paren
(paren
(paren
id|r-&gt;u.dst.rtt
op_rshift
l_int|3
)paren
op_plus
id|r-&gt;u.dst.rttvar
)paren
comma
id|r-&gt;key.tos
comma
id|r-&gt;u.dst.hh
ques
c_cond
id|atomic_read
c_func
(paren
op_amp
id|r-&gt;u.dst.hh-&gt;hh_refcnt
)paren
suffix:colon
op_minus
l_int|1
comma
id|r-&gt;u.dst.hh
ques
c_cond
(paren
id|r-&gt;u.dst.hh-&gt;hh_output
op_eq
id|dev_queue_xmit
)paren
suffix:colon
l_int|0
comma
id|r-&gt;rt_spec_dst
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
id|temp
)paren
suffix:semicolon
id|len
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
id|offset
op_plus
id|length
)paren
(brace
id|read_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
id|done
suffix:colon
op_star
id|start
op_assign
id|buffer
op_plus
id|len
op_minus
(paren
id|pos
op_minus
id|offset
)paren
suffix:semicolon
id|len
op_assign
id|pos
op_minus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|rt_free
r_static
id|__inline__
r_void
id|rt_free
c_func
(paren
r_struct
id|rtable
op_star
id|rt
)paren
(brace
id|dst_free
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
)brace
DECL|function|rt_drop
r_static
id|__inline__
r_void
id|rt_drop
c_func
(paren
r_struct
id|rtable
op_star
id|rt
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
id|dst_free
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
)brace
DECL|function|rt_fast_clean
r_static
id|__inline__
r_int
id|rt_fast_clean
c_func
(paren
r_struct
id|rtable
op_star
id|rth
)paren
(brace
multiline_comment|/* Kill broadcast/multicast entries very aggresively, if they&n;&t;   collide in hash table with more useful entries */
r_return
(paren
(paren
id|rth-&gt;rt_flags
op_amp
(paren
id|RTCF_BROADCAST
op_or
id|RTCF_MULTICAST
)paren
)paren
op_logical_and
id|rth-&gt;key.iif
op_logical_and
id|rth-&gt;u.rt_next
)paren
suffix:semicolon
)brace
DECL|function|rt_valuable
r_static
id|__inline__
r_int
id|rt_valuable
c_func
(paren
r_struct
id|rtable
op_star
id|rth
)paren
(brace
r_return
(paren
(paren
id|rth-&gt;rt_flags
op_amp
(paren
id|RTCF_REDIRECTED
op_or
id|RTCF_NOTIFY
)paren
)paren
op_logical_or
id|rth-&gt;u.dst.expires
)paren
suffix:semicolon
)brace
DECL|function|rt_may_expire
r_static
id|__inline__
r_int
id|rt_may_expire
c_func
(paren
r_struct
id|rtable
op_star
id|rth
comma
r_int
id|tmo1
comma
r_int
id|tmo2
)paren
(brace
r_int
id|age
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|rth-&gt;u.dst.__refcnt
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rth-&gt;u.dst.expires
op_logical_and
(paren
r_int
)paren
(paren
id|rth-&gt;u.dst.expires
op_minus
id|jiffies
)paren
op_le
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
id|age
op_assign
id|jiffies
op_minus
id|rth-&gt;u.dst.lastuse
suffix:semicolon
r_if
c_cond
(paren
id|age
op_le
id|tmo1
op_logical_and
op_logical_neg
id|rt_fast_clean
c_func
(paren
id|rth
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|age
op_le
id|tmo2
op_logical_and
id|rt_valuable
c_func
(paren
id|rth
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* This runs via a timer and thus is always in BH context. */
DECL|function|rt_check_expire
r_static
r_void
id|SMP_TIMER_NAME
c_func
(paren
id|rt_check_expire
)paren
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
id|i
comma
id|t
suffix:semicolon
r_static
r_int
id|rover
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
comma
op_star
op_star
id|rthp
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
id|i
op_assign
id|rover
suffix:semicolon
r_for
c_loop
(paren
id|t
op_assign
(paren
id|ip_rt_gc_interval
op_lshift
id|rt_hash_log
)paren
suffix:semicolon
id|t
op_ge
l_int|0
suffix:semicolon
id|t
op_sub_assign
id|ip_rt_gc_timeout
)paren
(brace
r_int
id|tmo
op_assign
id|ip_rt_gc_timeout
suffix:semicolon
id|i
op_assign
(paren
id|i
op_plus
l_int|1
)paren
op_amp
id|rt_hash_mask
suffix:semicolon
id|rthp
op_assign
op_amp
id|rt_hash_table
(braket
id|i
)braket
dot
id|chain
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rth
op_assign
op_star
id|rthp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|rth-&gt;u.dst.expires
)paren
(brace
multiline_comment|/* Entry is expired even if it is in use */
r_if
c_cond
(paren
(paren
r_int
)paren
(paren
id|now
op_minus
id|rth-&gt;u.dst.expires
)paren
op_le
l_int|0
)paren
(brace
id|tmo
op_rshift_assign
l_int|1
suffix:semicolon
id|rthp
op_assign
op_amp
id|rth-&gt;u.rt_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|rt_may_expire
c_func
(paren
id|rth
comma
id|tmo
comma
id|ip_rt_gc_timeout
)paren
)paren
(brace
id|tmo
op_rshift_assign
l_int|1
suffix:semicolon
id|rthp
op_assign
op_amp
id|rth-&gt;u.rt_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; * Cleanup aged off entries.&n;&t;&t;&t; */
op_star
id|rthp
op_assign
id|rth-&gt;u.rt_next
suffix:semicolon
id|rt_free
c_func
(paren
id|rth
)paren
suffix:semicolon
)brace
id|write_unlock
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
multiline_comment|/* Fallback loop breaker. */
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|now
)paren
OG
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|rover
op_assign
id|i
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|rt_periodic_timer
comma
id|now
op_plus
id|ip_rt_gc_interval
)paren
suffix:semicolon
)brace
id|SMP_TIMER_DEFINE
c_func
(paren
id|rt_check_expire
comma
id|rt_gc_task
)paren
suffix:semicolon
multiline_comment|/* This can run from both BH and non-BH contexts, the latter&n; * in the case of a forced flush event.&n; */
DECL|function|rt_run_flush
r_static
r_void
id|SMP_TIMER_NAME
c_func
(paren
id|rt_run_flush
)paren
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
comma
op_star
id|next
suffix:semicolon
id|rt_deadline
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|rt_hash_mask
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
id|rth
op_assign
id|rt_hash_table
(braket
id|i
)braket
dot
id|chain
suffix:semicolon
r_if
c_cond
(paren
id|rth
)paren
id|rt_hash_table
(braket
id|i
)braket
dot
id|chain
op_assign
l_int|NULL
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|i
)braket
dot
id|lock
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|rth
suffix:semicolon
id|rth
op_assign
id|next
)paren
(brace
id|next
op_assign
id|rth-&gt;u.rt_next
suffix:semicolon
id|rt_free
c_func
(paren
id|rth
)paren
suffix:semicolon
)brace
)brace
)brace
id|SMP_TIMER_DEFINE
c_func
(paren
id|rt_run_flush
comma
id|rt_cache_flush_task
)paren
suffix:semicolon
DECL|variable|rt_flush_lock
r_static
id|spinlock_t
id|rt_flush_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|function|rt_cache_flush
r_void
id|rt_cache_flush
c_func
(paren
r_int
id|delay
)paren
(brace
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
id|user_mode
op_assign
op_logical_neg
id|in_softirq
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delay
OL
l_int|0
)paren
id|delay
op_assign
id|ip_rt_min_delay
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|rt_flush_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|del_timer
c_func
(paren
op_amp
id|rt_flush_timer
)paren
op_logical_and
id|delay
OG
l_int|0
op_logical_and
id|rt_deadline
)paren
(brace
r_int
id|tmo
op_assign
(paren
r_int
)paren
(paren
id|rt_deadline
op_minus
id|now
)paren
suffix:semicolon
multiline_comment|/* If flush timer is already running&n;&t;&t;   and flush request is not immediate (delay &gt; 0):&n;&n;&t;&t;   if deadline is not achieved, prolongate timer to &quot;delay&quot;,&n;&t;&t;   otherwise fire it at deadline time.&n;&t;&t; */
r_if
c_cond
(paren
id|user_mode
op_logical_and
id|tmo
OL
id|ip_rt_max_delay
op_minus
id|ip_rt_min_delay
)paren
id|tmo
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|delay
OG
id|tmo
)paren
id|delay
op_assign
id|tmo
suffix:semicolon
)brace
r_if
c_cond
(paren
id|delay
op_le
l_int|0
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|rt_flush_lock
)paren
suffix:semicolon
id|SMP_TIMER_NAME
c_func
(paren
id|rt_run_flush
)paren
(paren
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt_deadline
op_eq
l_int|0
)paren
id|rt_deadline
op_assign
id|now
op_plus
id|ip_rt_max_delay
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|rt_flush_timer
comma
id|now
op_plus
id|delay
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|rt_flush_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;   Short description of GC goals.&n;&n;   We want to build algorithm, which will keep routing cache&n;   at some equilibrium point, when number of aged off entries&n;   is kept approximately equal to newly generated ones.&n;&n;   Current expiration strength is variable &quot;expire&quot;.&n;   We try to adjust it dynamically, so that if networking&n;   is idle expires is large enough to keep enough of warm entries,&n;   and when load increases it reduces to limit cache size.&n; */
DECL|function|rt_garbage_collect
r_static
r_int
id|rt_garbage_collect
c_func
(paren
r_void
)paren
(brace
r_static
r_int
id|expire
op_assign
id|RT_GC_TIMEOUT
suffix:semicolon
r_static
r_int
r_int
id|last_gc
suffix:semicolon
r_static
r_int
id|rover
suffix:semicolon
r_static
r_int
id|equilibrium
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
comma
op_star
op_star
id|rthp
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
id|goal
suffix:semicolon
multiline_comment|/*&n;&t; * Garbage collection is pretty expensive,&n;&t; * do not make it too frequently.&n;&t; */
r_if
c_cond
(paren
id|now
op_minus
id|last_gc
OL
id|ip_rt_gc_min_interval
op_logical_and
id|atomic_read
c_func
(paren
op_amp
id|ipv4_dst_ops.entries
)paren
OL
id|ip_rt_max_size
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Calculate number of entries, which we want to expire now. */
id|goal
op_assign
id|atomic_read
c_func
(paren
op_amp
id|ipv4_dst_ops.entries
)paren
op_minus
(paren
id|ip_rt_gc_elasticity
op_lshift
id|rt_hash_log
)paren
suffix:semicolon
r_if
c_cond
(paren
id|goal
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|equilibrium
OL
id|ipv4_dst_ops.gc_thresh
)paren
id|equilibrium
op_assign
id|ipv4_dst_ops.gc_thresh
suffix:semicolon
id|goal
op_assign
id|atomic_read
c_func
(paren
op_amp
id|ipv4_dst_ops.entries
)paren
op_minus
id|equilibrium
suffix:semicolon
r_if
c_cond
(paren
id|goal
OG
l_int|0
)paren
(brace
id|equilibrium
op_add_assign
id|min
c_func
(paren
id|goal
op_div
l_int|2
comma
id|rt_hash_mask
op_plus
l_int|1
)paren
suffix:semicolon
id|goal
op_assign
id|atomic_read
c_func
(paren
op_amp
id|ipv4_dst_ops.entries
)paren
op_minus
id|equilibrium
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* We are in dangerous area. Try to reduce cache really&n;&t;&t; * aggressively.&n;&t;&t; */
id|goal
op_assign
id|max
c_func
(paren
id|goal
op_div
l_int|2
comma
id|rt_hash_mask
op_plus
l_int|1
)paren
suffix:semicolon
id|equilibrium
op_assign
id|atomic_read
c_func
(paren
op_amp
id|ipv4_dst_ops.entries
)paren
op_minus
id|goal
suffix:semicolon
)brace
r_if
c_cond
(paren
id|now
op_minus
id|last_gc
op_ge
id|ip_rt_gc_min_interval
)paren
id|last_gc
op_assign
id|now
suffix:semicolon
r_if
c_cond
(paren
id|goal
op_le
l_int|0
)paren
(brace
id|equilibrium
op_add_assign
id|goal
suffix:semicolon
r_goto
id|work_done
suffix:semicolon
)brace
r_do
(brace
r_int
id|i
comma
id|k
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|rt_hash_mask
comma
id|k
op_assign
id|rover
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|tmo
op_assign
id|expire
suffix:semicolon
id|k
op_assign
(paren
id|k
op_plus
l_int|1
)paren
op_amp
id|rt_hash_mask
suffix:semicolon
id|rthp
op_assign
op_amp
id|rt_hash_table
(braket
id|k
)braket
dot
id|chain
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|k
)braket
dot
id|lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rth
op_assign
op_star
id|rthp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|rt_may_expire
c_func
(paren
id|rth
comma
id|tmo
comma
id|expire
)paren
)paren
(brace
id|tmo
op_rshift_assign
l_int|1
suffix:semicolon
id|rthp
op_assign
op_amp
id|rth-&gt;u.rt_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
op_star
id|rthp
op_assign
id|rth-&gt;u.rt_next
suffix:semicolon
id|rt_free
c_func
(paren
id|rth
)paren
suffix:semicolon
id|goal
op_decrement
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|k
)braket
dot
id|lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|goal
op_le
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|rover
op_assign
id|k
suffix:semicolon
r_if
c_cond
(paren
id|goal
op_le
l_int|0
)paren
r_goto
id|work_done
suffix:semicolon
multiline_comment|/* Goal is not achieved. We stop process if:&n;&n;&t;&t;   - if expire reduced to zero. Otherwise, expire is halfed.&n;&t;&t;   - if table is not full.&n;&t;&t;   - if we are called from interrupt.&n;&t;&t;   - jiffies check is just fallback/debug loop breaker.&n;&t;&t;     We will not spin here for long time in any case.&n;&t;&t; */
r_if
c_cond
(paren
id|expire
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|expire
op_rshift_assign
l_int|1
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;expire&gt;&gt; %u %d %d %d&bslash;n&quot;
comma
id|expire
comma
id|atomic_read
c_func
(paren
op_amp
id|ipv4_dst_ops.entries
)paren
comma
id|goal
comma
id|i
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|ipv4_dst_ops.entries
)paren
OL
id|ip_rt_max_size
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|in_softirq
c_func
(paren
)paren
op_logical_and
id|jiffies
op_minus
id|now
OL
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|ipv4_dst_ops.entries
)paren
OL
id|ip_rt_max_size
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;dst cache overflow&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
id|work_done
suffix:colon
id|expire
op_add_assign
id|ip_rt_gc_min_interval
suffix:semicolon
r_if
c_cond
(paren
id|expire
OG
id|ip_rt_gc_timeout
op_logical_or
id|atomic_read
c_func
(paren
op_amp
id|ipv4_dst_ops.entries
)paren
OL
id|ipv4_dst_ops.gc_thresh
)paren
id|expire
op_assign
id|ip_rt_gc_timeout
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;expire++ %u %d %d %d&bslash;n&quot;
comma
id|expire
comma
id|atomic_read
c_func
(paren
op_amp
id|ipv4_dst_ops.entries
)paren
comma
id|goal
comma
id|rover
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rt_intern_hash
r_static
r_int
id|rt_intern_hash
c_func
(paren
r_int
id|hash
comma
r_struct
id|rtable
op_star
id|rt
comma
r_struct
id|rtable
op_star
op_star
id|rp
)paren
(brace
r_struct
id|rtable
op_star
id|rth
comma
op_star
op_star
id|rthp
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
id|attempts
op_assign
op_logical_neg
id|in_softirq
c_func
(paren
)paren
suffix:semicolon
id|restart
suffix:colon
id|rthp
op_assign
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rth
op_assign
op_star
id|rthp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
op_amp
id|rth-&gt;key
comma
op_amp
id|rt-&gt;key
comma
r_sizeof
(paren
id|rt-&gt;key
)paren
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Put it first */
op_star
id|rthp
op_assign
id|rth-&gt;u.rt_next
suffix:semicolon
id|rth-&gt;u.rt_next
op_assign
id|rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
id|rt_hash_table
(braket
id|hash
)braket
dot
id|chain
op_assign
id|rth
suffix:semicolon
id|rth-&gt;u.dst.__use
op_increment
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rth-&gt;u.dst
)paren
suffix:semicolon
id|rth-&gt;u.dst.lastuse
op_assign
id|now
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
id|rt_drop
c_func
(paren
id|rt
)paren
suffix:semicolon
op_star
id|rp
op_assign
id|rth
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rthp
op_assign
op_amp
id|rth-&gt;u.rt_next
suffix:semicolon
)brace
multiline_comment|/* Try to bind route to arp only if it is output&n;&t;   route or unicast forwarding path.&n;&t; */
r_if
c_cond
(paren
id|rt-&gt;rt_type
op_eq
id|RTN_UNICAST
op_logical_or
id|rt-&gt;key.iif
op_eq
l_int|0
)paren
(brace
r_int
id|err
op_assign
id|arp_bind_neighbour
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|write_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
op_minus
id|ENOBUFS
)paren
(brace
id|rt_drop
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Neighbour tables are full and nothing&n;&t;&t;&t;   can be released. Try to shrink route cache,&n;&t;&t;&t;   it is most likely it holds some neighbour records.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|attempts
op_decrement
OG
l_int|0
)paren
(brace
r_int
id|saved_elasticity
op_assign
id|ip_rt_gc_elasticity
suffix:semicolon
r_int
id|saved_int
op_assign
id|ip_rt_gc_min_interval
suffix:semicolon
id|ip_rt_gc_elasticity
op_assign
l_int|1
suffix:semicolon
id|ip_rt_gc_min_interval
op_assign
l_int|0
suffix:semicolon
id|rt_garbage_collect
c_func
(paren
)paren
suffix:semicolon
id|ip_rt_gc_min_interval
op_assign
id|saved_int
suffix:semicolon
id|ip_rt_gc_elasticity
op_assign
id|saved_elasticity
suffix:semicolon
r_goto
id|restart
suffix:semicolon
)brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;Neighbour table overflow.&bslash;n&quot;
)paren
suffix:semicolon
id|rt_drop
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
)brace
id|rt-&gt;u.rt_next
op_assign
id|rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 2
r_if
c_cond
(paren
id|rt-&gt;u.rt_next
)paren
(brace
r_struct
id|rtable
op_star
id|trt
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;rt_cache @%02x: %u.%u.%u.%u&quot;
comma
id|hash
comma
id|NIPQUAD
c_func
(paren
id|rt-&gt;rt_dst
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|trt
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|trt
suffix:semicolon
id|trt
op_assign
id|trt-&gt;u.rt_next
)paren
id|printk
c_func
(paren
l_string|&quot; . %u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
id|trt-&gt;rt_dst
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|rt_hash_table
(braket
id|hash
)braket
dot
id|chain
op_assign
id|rt
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
op_star
id|rp
op_assign
id|rt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rt_bind_peer
r_void
id|rt_bind_peer
c_func
(paren
r_struct
id|rtable
op_star
id|rt
comma
r_int
id|create
)paren
(brace
r_static
id|spinlock_t
id|rt_peer_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_struct
id|inet_peer
op_star
id|peer
suffix:semicolon
id|peer
op_assign
id|inet_getpeer
c_func
(paren
id|rt-&gt;rt_dst
comma
id|create
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|rt_peer_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;peer
op_eq
l_int|NULL
)paren
(brace
id|rt-&gt;peer
op_assign
id|peer
suffix:semicolon
id|peer
op_assign
l_int|NULL
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|rt_peer_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
id|inet_putpeer
c_func
(paren
id|peer
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Peer allocation may fail only in serious out-of-memory conditions.  However&n; * we still can generate some output.&n; * Random ID selection looks a bit dangerous because we have no chances to&n; * select ID being unique in a reasonable period of time.&n; * But broken packet identifier may be better than no packet at all.&n; */
DECL|function|ip_select_fb_ident
r_static
r_void
id|ip_select_fb_ident
c_func
(paren
r_struct
id|iphdr
op_star
id|iph
)paren
(brace
r_static
id|spinlock_t
id|ip_fb_id_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_static
id|u32
id|ip_fallback_id
suffix:semicolon
id|u32
id|salt
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|ip_fb_id_lock
)paren
suffix:semicolon
id|salt
op_assign
id|secure_ip_id
c_func
(paren
id|ip_fallback_id
op_xor
id|iph-&gt;daddr
)paren
suffix:semicolon
id|iph-&gt;id
op_assign
id|salt
op_amp
l_int|0xFFFF
suffix:semicolon
id|ip_fallback_id
op_assign
id|salt
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|ip_fb_id_lock
)paren
suffix:semicolon
)brace
DECL|function|__ip_select_ident
r_void
id|__ip_select_ident
c_func
(paren
r_struct
id|iphdr
op_star
id|iph
comma
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;peer
op_eq
l_int|NULL
)paren
id|rt_bind_peer
c_func
(paren
id|rt
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* If peer is attached to destination, it is never detached,&n;&t;&t;   so that we need not to grab a lock to dereference it.&n;&t;&t; */
r_if
c_cond
(paren
id|rt-&gt;peer
)paren
(brace
id|iph-&gt;id
op_assign
id|inet_getid
c_func
(paren
id|rt-&gt;peer
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;rt_bind_peer(0) @%p&bslash;n&quot;
comma
id|NET_CALLER
c_func
(paren
id|iph
)paren
)paren
suffix:semicolon
)brace
id|ip_select_fb_ident
c_func
(paren
id|iph
)paren
suffix:semicolon
)brace
DECL|function|rt_del
r_static
r_void
id|rt_del
c_func
(paren
r_int
id|hash
comma
r_struct
id|rtable
op_star
id|rt
)paren
(brace
r_struct
id|rtable
op_star
op_star
id|rthp
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rthp
op_assign
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
op_star
id|rthp
suffix:semicolon
id|rthp
op_assign
op_amp
(paren
op_star
id|rthp
)paren
op_member_access_from_pointer
id|u.rt_next
)paren
(brace
r_if
c_cond
(paren
op_star
id|rthp
op_eq
id|rt
)paren
(brace
op_star
id|rthp
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|rt_free
c_func
(paren
id|rt
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
DECL|function|ip_rt_redirect
r_void
id|ip_rt_redirect
c_func
(paren
id|u32
id|old_gw
comma
id|u32
id|daddr
comma
id|u32
id|new_gw
comma
id|u32
id|saddr
comma
id|u8
id|tos
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
comma
id|k
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
comma
op_star
op_star
id|rthp
suffix:semicolon
id|u32
id|skeys
(braket
l_int|2
)braket
op_assign
(brace
id|saddr
comma
l_int|0
)brace
suffix:semicolon
r_int
id|ikeys
(braket
l_int|2
)braket
op_assign
(brace
id|dev-&gt;ifindex
comma
l_int|0
)brace
suffix:semicolon
id|tos
op_and_assign
id|IPTOS_RT_MASK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|new_gw
op_eq
id|old_gw
op_logical_or
op_logical_neg
id|IN_DEV_RX_REDIRECTS
c_func
(paren
id|in_dev
)paren
op_logical_or
id|MULTICAST
c_func
(paren
id|new_gw
)paren
op_logical_or
id|BADCLASS
c_func
(paren
id|new_gw
)paren
op_logical_or
id|ZERONET
c_func
(paren
id|new_gw
)paren
)paren
r_goto
id|reject_redirect
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IN_DEV_SHARED_MEDIA
c_func
(paren
id|in_dev
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|inet_addr_onlink
c_func
(paren
id|in_dev
comma
id|new_gw
comma
id|old_gw
)paren
)paren
r_goto
id|reject_redirect
suffix:semicolon
r_if
c_cond
(paren
id|IN_DEV_SEC_REDIRECTS
c_func
(paren
id|in_dev
)paren
op_logical_and
id|ip_fib_check_default
c_func
(paren
id|new_gw
comma
id|dev
)paren
)paren
r_goto
id|reject_redirect
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|inet_addr_type
c_func
(paren
id|new_gw
)paren
op_ne
id|RTN_UNICAST
)paren
r_goto
id|reject_redirect
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|2
suffix:semicolon
id|k
op_increment
)paren
(brace
r_int
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|skeys
(braket
id|i
)braket
op_xor
(paren
id|ikeys
(braket
id|k
)braket
op_lshift
l_int|5
)paren
comma
id|tos
)paren
suffix:semicolon
id|rthp
op_assign
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rth
op_assign
op_star
id|rthp
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_if
c_cond
(paren
id|rth-&gt;key.dst
op_ne
id|daddr
op_logical_or
id|rth-&gt;key.src
op_ne
id|skeys
(braket
id|i
)braket
op_logical_or
id|rth-&gt;key.tos
op_ne
id|tos
op_logical_or
id|rth-&gt;key.oif
op_ne
id|ikeys
(braket
id|k
)braket
op_logical_or
id|rth-&gt;key.iif
op_ne
l_int|0
)paren
(brace
id|rthp
op_assign
op_amp
id|rth-&gt;u.rt_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rth-&gt;rt_dst
op_ne
id|daddr
op_logical_or
id|rth-&gt;rt_src
op_ne
id|saddr
op_logical_or
id|rth-&gt;u.dst.error
op_logical_or
id|rth-&gt;rt_gateway
op_ne
id|old_gw
op_logical_or
id|rth-&gt;u.dst.dev
op_ne
id|dev
)paren
r_break
suffix:semicolon
id|dst_clone
c_func
(paren
op_amp
id|rth-&gt;u.dst
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
id|rt
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|ipv4_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rth
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;&t; * Copy all the information.&n;&t;&t;&t;&t; */
op_star
id|rt
op_assign
op_star
id|rth
suffix:semicolon
id|rt-&gt;u.dst.__use
op_assign
l_int|1
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.dev
)paren
id|dev_hold
c_func
(paren
id|rt-&gt;u.dst.dev
)paren
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;u.dst.neighbour
op_assign
l_int|NULL
suffix:semicolon
id|rt-&gt;u.dst.hh
op_assign
l_int|NULL
suffix:semicolon
id|rt-&gt;u.dst.obsolete
op_assign
l_int|0
suffix:semicolon
id|rt-&gt;rt_flags
op_or_assign
id|RTCF_REDIRECTED
suffix:semicolon
multiline_comment|/* Gateway is different ... */
id|rt-&gt;rt_gateway
op_assign
id|new_gw
suffix:semicolon
multiline_comment|/* Redirect received -&gt; path was valid */
id|dst_confirm
c_func
(paren
op_amp
id|rth-&gt;u.dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;peer
)paren
id|atomic_inc
c_func
(paren
op_amp
id|rt-&gt;peer-&gt;refcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arp_bind_neighbour
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
op_logical_or
op_logical_neg
(paren
id|rt-&gt;u.dst.neighbour-&gt;nud_state
op_amp
id|NUD_VALID
)paren
)paren
(brace
r_if
c_cond
(paren
id|rt-&gt;u.dst.neighbour
)paren
id|neigh_event_send
c_func
(paren
id|rt-&gt;u.dst.neighbour
comma
l_int|NULL
)paren
suffix:semicolon
id|ip_rt_put
c_func
(paren
id|rth
)paren
suffix:semicolon
id|rt_drop
c_func
(paren
id|rt
)paren
suffix:semicolon
r_goto
id|do_next
suffix:semicolon
)brace
id|rt_del
c_func
(paren
id|hash
comma
id|rth
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rt_intern_hash
c_func
(paren
id|hash
comma
id|rt
comma
op_amp
id|rt
)paren
)paren
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_goto
id|do_next
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
id|do_next
suffix:colon
suffix:semicolon
)brace
)brace
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
id|reject_redirect
suffix:colon
macro_line|#ifdef CONFIG_IP_ROUTE_VERBOSE
r_if
c_cond
(paren
id|IN_DEV_LOG_MARTIANS
c_func
(paren
id|in_dev
)paren
op_logical_and
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Redirect from %u.%u.%u.%u on %s about %u.%u.%u.%u ignored.&bslash;n&quot;
l_string|&quot;  Advised path = %u.%u.%u.%u -&gt; %u.%u.%u.%u, tos %02x&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|old_gw
)paren
comma
id|dev-&gt;name
comma
id|NIPQUAD
c_func
(paren
id|new_gw
)paren
comma
id|NIPQUAD
c_func
(paren
id|saddr
)paren
comma
id|NIPQUAD
c_func
(paren
id|daddr
)paren
comma
id|tos
)paren
suffix:semicolon
macro_line|#endif
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
DECL|function|ipv4_negative_advice
r_static
r_struct
id|dst_entry
op_star
id|ipv4_negative_advice
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|dst-&gt;obsolete
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rt-&gt;rt_flags
op_amp
id|RTCF_REDIRECTED
)paren
op_logical_or
id|rt-&gt;u.dst.expires
)paren
(brace
r_int
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|rt-&gt;key.dst
comma
id|rt-&gt;key.src
op_xor
(paren
id|rt-&gt;key.oif
op_lshift
l_int|5
)paren
comma
id|rt-&gt;key.tos
)paren
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 1
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ip_rt_advice: redirect to %u.%u.%u.%u/%02x dropped&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|rt-&gt;rt_dst
)paren
comma
id|rt-&gt;key.tos
)paren
suffix:semicolon
macro_line|#endif
id|rt_del
c_func
(paren
id|hash
comma
id|rt
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
id|dst
suffix:semicolon
)brace
multiline_comment|/*&n; * Algorithm:&n; *&t;1. The first ip_rt_redirect_number redirects are sent&n; *&t;   with exponential backoff, then we stop sending them at all,&n; *&t;   assuming that the host ignores our redirects.&n; *&t;2. If we did not see packets requiring redirects&n; *&t;   during ip_rt_redirect_silence, we assume that the host&n; *&t;   forgot redirected route and start to send redirects again.&n; *&n; * This algorithm is much cheaper and more intelligent than dumb load limiting&n; * in icmp.c.&n; *&n; * NOTE. Do not forget to inhibit load limiting for redirects (redundant)&n; * and &quot;frag. need&quot; (breaks PMTU discovery) in icmp.c.&n; */
DECL|function|ip_rt_send_redirect
r_void
id|ip_rt_send_redirect
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|in_dev_get
c_func
(paren
id|rt-&gt;u.dst.dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IN_DEV_TX_REDIRECTS
c_func
(paren
id|in_dev
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* No redirected packets during ip_rt_redirect_silence;&n;&t; * reset the algorithm.&n;&t; */
r_if
c_cond
(paren
id|jiffies
op_minus
id|rt-&gt;u.dst.rate_last
OG
id|ip_rt_redirect_silence
)paren
id|rt-&gt;u.dst.rate_tokens
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Too many ignored redirects; do not send anything&n;&t; * set u.dst.rate_last to the last seen redirected packet.&n;&t; */
r_if
c_cond
(paren
id|rt-&gt;u.dst.rate_tokens
op_ge
id|ip_rt_redirect_number
)paren
(brace
id|rt-&gt;u.dst.rate_last
op_assign
id|jiffies
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Check for load limit; set rate_last to the latest sent&n;&t; * redirect.&n;&t; */
r_if
c_cond
(paren
id|jiffies
op_minus
id|rt-&gt;u.dst.rate_last
OG
(paren
id|ip_rt_redirect_load
op_lshift
id|rt-&gt;u.dst.rate_tokens
)paren
)paren
(brace
id|icmp_send
c_func
(paren
id|skb
comma
id|ICMP_REDIRECT
comma
id|ICMP_REDIR_HOST
comma
id|rt-&gt;rt_gateway
)paren
suffix:semicolon
id|rt-&gt;u.dst.rate_last
op_assign
id|jiffies
suffix:semicolon
op_increment
id|rt-&gt;u.dst.rate_tokens
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_VERBOSE
r_if
c_cond
(paren
id|IN_DEV_LOG_MARTIANS
c_func
(paren
id|in_dev
)paren
op_logical_and
id|rt-&gt;u.dst.rate_tokens
op_eq
id|ip_rt_redirect_number
op_logical_and
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;host %u.%u.%u.%u/if%d ignores redirects for &quot;
l_string|&quot;%u.%u.%u.%u to %u.%u.%u.%u.&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|rt-&gt;rt_src
)paren
comma
id|rt-&gt;rt_iif
comma
id|NIPQUAD
c_func
(paren
id|rt-&gt;rt_dst
)paren
comma
id|NIPQUAD
c_func
(paren
id|rt-&gt;rt_gateway
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
id|out
suffix:colon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
DECL|function|ip_error
r_static
r_int
id|ip_error
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_int
r_int
id|now
suffix:semicolon
r_int
id|code
suffix:semicolon
r_switch
c_cond
(paren
id|rt-&gt;u.dst.error
)paren
(brace
r_case
id|EINVAL
suffix:colon
r_default
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|EHOSTUNREACH
suffix:colon
id|code
op_assign
id|ICMP_HOST_UNREACH
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ENETUNREACH
suffix:colon
id|code
op_assign
id|ICMP_NET_UNREACH
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EACCES
suffix:colon
id|code
op_assign
id|ICMP_PKT_FILTERED
suffix:semicolon
r_break
suffix:semicolon
)brace
id|now
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt-&gt;u.dst.rate_tokens
op_add_assign
(paren
id|now
op_minus
id|rt-&gt;u.dst.rate_last
)paren
)paren
OG
id|ip_rt_error_burst
)paren
id|rt-&gt;u.dst.rate_tokens
op_assign
id|ip_rt_error_burst
suffix:semicolon
id|rt-&gt;u.dst.rate_last
op_assign
id|now
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.rate_tokens
op_ge
id|ip_rt_error_cost
)paren
(brace
id|rt-&gt;u.dst.rate_tokens
op_sub_assign
id|ip_rt_error_cost
suffix:semicolon
id|icmp_send
c_func
(paren
id|skb
comma
id|ICMP_DEST_UNREACH
comma
id|code
comma
l_int|0
)paren
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;The last two values are not from the RFC but&n; *&t;are needed for AMPRnet AX.25 paths.&n; */
DECL|variable|mtu_plateau
r_static
r_int
r_int
id|mtu_plateau
(braket
)braket
op_assign
(brace
l_int|32000
comma
l_int|17914
comma
l_int|8166
comma
l_int|4352
comma
l_int|2002
comma
l_int|1492
comma
l_int|576
comma
l_int|296
comma
l_int|216
comma
l_int|128
)brace
suffix:semicolon
DECL|function|guess_mtu
r_static
id|__inline__
r_int
r_int
id|guess_mtu
c_func
(paren
r_int
r_int
id|old_mtu
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|mtu_plateau
)paren
op_div
r_sizeof
(paren
id|mtu_plateau
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|old_mtu
OG
id|mtu_plateau
(braket
id|i
)braket
)paren
r_return
id|mtu_plateau
(braket
id|i
)braket
suffix:semicolon
r_return
l_int|68
suffix:semicolon
)brace
DECL|function|ip_rt_frag_needed
r_int
r_int
id|ip_rt_frag_needed
c_func
(paren
r_struct
id|iphdr
op_star
id|iph
comma
r_int
r_int
id|new_mtu
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|old_mtu
op_assign
id|ntohs
c_func
(paren
id|iph-&gt;tot_len
)paren
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
id|u32
id|skeys
(braket
l_int|2
)braket
op_assign
(brace
id|iph-&gt;saddr
comma
l_int|0
comma
)brace
suffix:semicolon
id|u32
id|daddr
op_assign
id|iph-&gt;daddr
suffix:semicolon
id|u8
id|tos
op_assign
id|iph-&gt;tos
op_amp
id|IPTOS_RT_MASK
suffix:semicolon
r_int
r_int
id|est_mtu
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ipv4_config.no_pmtu_disc
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|skeys
(braket
id|i
)braket
comma
id|tos
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rth
op_assign
id|rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
id|rth
suffix:semicolon
id|rth
op_assign
id|rth-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
id|rth-&gt;key.dst
op_eq
id|daddr
op_logical_and
id|rth-&gt;key.src
op_eq
id|skeys
(braket
id|i
)braket
op_logical_and
id|rth-&gt;rt_dst
op_eq
id|daddr
op_logical_and
id|rth-&gt;rt_src
op_eq
id|iph-&gt;saddr
op_logical_and
id|rth-&gt;key.tos
op_eq
id|tos
op_logical_and
id|rth-&gt;key.iif
op_eq
l_int|0
op_logical_and
op_logical_neg
(paren
id|rth-&gt;u.dst.mxlock
op_amp
(paren
l_int|1
op_lshift
id|RTAX_MTU
)paren
)paren
)paren
(brace
r_int
r_int
id|mtu
op_assign
id|new_mtu
suffix:semicolon
r_if
c_cond
(paren
id|new_mtu
OL
l_int|68
op_logical_or
id|new_mtu
op_ge
id|old_mtu
)paren
(brace
multiline_comment|/* BSD 4.2 compatibility hack :-( */
r_if
c_cond
(paren
id|mtu
op_eq
l_int|0
op_logical_and
id|old_mtu
op_ge
id|rth-&gt;u.dst.pmtu
op_logical_and
id|old_mtu
op_ge
l_int|68
op_plus
(paren
id|iph-&gt;ihl
op_lshift
l_int|2
)paren
)paren
id|old_mtu
op_sub_assign
id|iph-&gt;ihl
op_lshift
l_int|2
suffix:semicolon
id|mtu
op_assign
id|guess_mtu
c_func
(paren
id|old_mtu
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mtu
op_le
id|rth-&gt;u.dst.pmtu
)paren
(brace
r_if
c_cond
(paren
id|mtu
OL
id|rth-&gt;u.dst.pmtu
)paren
(brace
id|dst_confirm
c_func
(paren
op_amp
id|rth-&gt;u.dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mtu
OL
id|ip_rt_min_pmtu
)paren
(brace
id|mtu
op_assign
id|ip_rt_min_pmtu
suffix:semicolon
id|rth-&gt;u.dst.mxlock
op_or_assign
(paren
l_int|1
op_lshift
id|RTAX_MTU
)paren
suffix:semicolon
)brace
id|rth-&gt;u.dst.pmtu
op_assign
id|mtu
suffix:semicolon
id|dst_set_expires
c_func
(paren
op_amp
id|rth-&gt;u.dst
comma
id|ip_rt_mtu_expires
)paren
suffix:semicolon
)brace
id|est_mtu
op_assign
id|mtu
suffix:semicolon
)brace
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
r_return
id|est_mtu
ques
c_cond
suffix:colon
id|new_mtu
suffix:semicolon
)brace
DECL|function|ip_rt_update_pmtu
r_void
id|ip_rt_update_pmtu
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
r_int
id|mtu
)paren
(brace
r_if
c_cond
(paren
id|dst-&gt;pmtu
OG
id|mtu
op_logical_and
id|mtu
op_ge
l_int|68
op_logical_and
op_logical_neg
(paren
id|dst-&gt;mxlock
op_amp
(paren
l_int|1
op_lshift
id|RTAX_MTU
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|mtu
OL
id|ip_rt_min_pmtu
)paren
(brace
id|mtu
op_assign
id|ip_rt_min_pmtu
suffix:semicolon
id|dst-&gt;mxlock
op_or_assign
(paren
l_int|1
op_lshift
id|RTAX_MTU
)paren
suffix:semicolon
)brace
id|dst-&gt;pmtu
op_assign
id|mtu
suffix:semicolon
id|dst_set_expires
c_func
(paren
id|dst
comma
id|ip_rt_mtu_expires
)paren
suffix:semicolon
)brace
)brace
DECL|function|ipv4_dst_check
r_static
r_struct
id|dst_entry
op_star
id|ipv4_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
id|u32
id|cookie
)paren
(brace
id|dst_release
c_func
(paren
id|dst
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ipv4_dst_reroute
r_static
r_struct
id|dst_entry
op_star
id|ipv4_dst_reroute
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ipv4_dst_destroy
r_static
r_void
id|ipv4_dst_destroy
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|dst
suffix:semicolon
r_struct
id|inet_peer
op_star
id|peer
op_assign
id|rt-&gt;peer
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
id|rt-&gt;peer
op_assign
l_int|NULL
suffix:semicolon
id|inet_putpeer
c_func
(paren
id|peer
)paren
suffix:semicolon
)brace
)brace
DECL|function|ipv4_link_failure
r_static
r_void
id|ipv4_link_failure
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
id|icmp_send
c_func
(paren
id|skb
comma
id|ICMP_DEST_UNREACH
comma
id|ICMP_HOST_UNREACH
comma
l_int|0
)paren
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_if
c_cond
(paren
id|rt
)paren
id|dst_set_expires
c_func
(paren
op_amp
id|rt-&gt;u.dst
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|ip_rt_bug
r_static
r_int
id|ip_rt_bug
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ip_rt_bug: %u.%u.%u.%u -&gt; %u.%u.%u.%u, %s&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|skb-&gt;nh.iph-&gt;saddr
)paren
comma
id|NIPQUAD
c_func
(paren
id|skb-&gt;nh.iph-&gt;daddr
)paren
comma
id|skb-&gt;dev
ques
c_cond
id|skb-&gt;dev-&gt;name
suffix:colon
l_string|&quot;?&quot;
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;   We do not cache source address of outgoing interface,&n;   because it is used only by IP RR, TS and SRR options,&n;   so that it out of fast path.&n;&n;   BTW remember: &quot;addr&quot; is allowed to be not aligned&n;   in IP options!&n; */
DECL|function|ip_rt_get_source
r_void
id|ip_rt_get_source
c_func
(paren
id|u8
op_star
id|addr
comma
r_struct
id|rtable
op_star
id|rt
)paren
(brace
id|u32
id|src
suffix:semicolon
r_struct
id|fib_result
id|res
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;key.iif
op_eq
l_int|0
)paren
id|src
op_assign
id|rt-&gt;rt_src
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fib_lookup
c_func
(paren
op_amp
id|rt-&gt;key
comma
op_amp
id|res
)paren
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef CONFIG_IP_ROUTE_NAT
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_NAT
)paren
id|src
op_assign
id|inet_select_addr
c_func
(paren
id|rt-&gt;u.dst.dev
comma
id|rt-&gt;rt_gateway
comma
id|RT_SCOPE_UNIVERSE
)paren
suffix:semicolon
r_else
macro_line|#endif
id|src
op_assign
id|FIB_RES_PREFSRC
c_func
(paren
id|res
)paren
suffix:semicolon
id|fib_res_put
c_func
(paren
op_amp
id|res
)paren
suffix:semicolon
)brace
r_else
id|src
op_assign
id|inet_select_addr
c_func
(paren
id|rt-&gt;u.dst.dev
comma
id|rt-&gt;rt_gateway
comma
id|RT_SCOPE_UNIVERSE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|addr
comma
op_amp
id|src
comma
l_int|4
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NET_CLS_ROUTE
DECL|function|set_class_tag
r_static
r_void
id|set_class_tag
c_func
(paren
r_struct
id|rtable
op_star
id|rt
comma
id|u32
id|tag
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|rt-&gt;u.dst.tclassid
op_amp
l_int|0xFFFF
)paren
)paren
id|rt-&gt;u.dst.tclassid
op_or_assign
id|tag
op_amp
l_int|0xFFFF
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rt-&gt;u.dst.tclassid
op_amp
l_int|0xFFFF0000
)paren
)paren
id|rt-&gt;u.dst.tclassid
op_or_assign
id|tag
op_amp
l_int|0xFFFF0000
suffix:semicolon
)brace
macro_line|#endif
DECL|function|rt_set_nexthop
r_static
r_void
id|rt_set_nexthop
c_func
(paren
r_struct
id|rtable
op_star
id|rt
comma
r_struct
id|fib_result
op_star
id|res
comma
id|u32
id|itag
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
op_assign
id|res-&gt;fi
suffix:semicolon
r_if
c_cond
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
id|FIB_RES_GW
c_func
(paren
op_star
id|res
)paren
op_logical_and
id|FIB_RES_NH
id|res.nh_scope
op_eq
id|RT_SCOPE_LINK
)paren
id|rt-&gt;rt_gateway
op_assign
id|FIB_RES_GW
c_func
(paren
op_star
id|res
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|rt-&gt;u.dst.mxlock
comma
id|fi-&gt;fib_metrics
comma
r_sizeof
(paren
id|fi-&gt;fib_metrics
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_mtu
op_eq
l_int|0
)paren
(brace
id|rt-&gt;u.dst.pmtu
op_assign
id|rt-&gt;u.dst.dev-&gt;mtu
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.mxlock
op_amp
(paren
l_int|1
op_lshift
id|RTAX_MTU
)paren
op_logical_and
id|rt-&gt;rt_gateway
op_ne
id|rt-&gt;rt_dst
op_logical_and
id|rt-&gt;u.dst.pmtu
OG
l_int|576
)paren
id|rt-&gt;u.dst.pmtu
op_assign
l_int|576
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NET_CLS_ROUTE
id|rt-&gt;u.dst.tclassid
op_assign
id|FIB_RES_NH
id|res.nh_tclassid
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|rt-&gt;u.dst.pmtu
op_assign
id|rt-&gt;u.dst.dev-&gt;mtu
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt-&gt;u.dst.pmtu
OG
id|IP_MAX_MTU
)paren
id|rt-&gt;u.dst.pmtu
op_assign
id|IP_MAX_MTU
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.advmss
op_eq
l_int|0
)paren
id|rt-&gt;u.dst.advmss
op_assign
id|max
c_func
(paren
id|rt-&gt;u.dst.dev-&gt;mtu
op_minus
l_int|40
comma
id|ip_rt_min_advmss
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.advmss
OG
l_int|65535
op_minus
l_int|40
)paren
id|rt-&gt;u.dst.advmss
op_assign
l_int|65535
op_minus
l_int|40
suffix:semicolon
macro_line|#ifdef CONFIG_NET_CLS_ROUTE
macro_line|#ifdef CONFIG_IP_MULTIPLE_TABLES
id|set_class_tag
c_func
(paren
id|rt
comma
id|fib_rules_tclass
c_func
(paren
id|res
)paren
)paren
suffix:semicolon
macro_line|#endif
id|set_class_tag
c_func
(paren
id|rt
comma
id|itag
)paren
suffix:semicolon
macro_line|#endif
id|rt-&gt;rt_type
op_assign
id|res-&gt;type
suffix:semicolon
)brace
r_static
r_int
DECL|function|ip_route_input_mc
id|ip_route_input_mc
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|daddr
comma
id|u32
id|saddr
comma
id|u8
id|tos
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|our
)paren
(brace
r_int
id|hash
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
id|u32
id|spec_dst
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|itag
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Primary sanity checks. */
r_if
c_cond
(paren
id|in_dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|saddr
)paren
op_logical_or
id|BADCLASS
c_func
(paren
id|saddr
)paren
op_logical_or
id|LOOPBACK
c_func
(paren
id|saddr
)paren
op_logical_or
id|skb-&gt;protocol
op_ne
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
r_if
c_cond
(paren
id|ZERONET
c_func
(paren
id|saddr
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|LOCAL_MCAST
c_func
(paren
id|daddr
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
id|spec_dst
op_assign
id|inet_select_addr
c_func
(paren
id|dev
comma
l_int|0
comma
id|RT_SCOPE_LINK
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|fib_validate_source
c_func
(paren
id|saddr
comma
l_int|0
comma
id|tos
comma
l_int|0
comma
id|dev
comma
op_amp
id|spec_dst
comma
op_amp
id|itag
)paren
OL
l_int|0
)paren
r_goto
id|e_inval
suffix:semicolon
id|rth
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|ipv4_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rth
)paren
r_goto
id|e_nobufs
suffix:semicolon
id|rth-&gt;u.dst.output
op_assign
id|ip_rt_bug
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|rth-&gt;u.dst.__refcnt
comma
l_int|1
)paren
suffix:semicolon
id|rth-&gt;u.dst.flags
op_assign
id|DST_HOST
suffix:semicolon
id|rth-&gt;key.dst
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;rt_dst
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;key.tos
op_assign
id|tos
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_FWMARK
id|rth-&gt;key.fwmark
op_assign
id|skb-&gt;nfmark
suffix:semicolon
macro_line|#endif
id|rth-&gt;key.src
op_assign
id|saddr
suffix:semicolon
id|rth-&gt;rt_src
op_assign
id|saddr
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_NAT
id|rth-&gt;rt_dst_map
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;rt_src_map
op_assign
id|saddr
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_NET_CLS_ROUTE
id|rth-&gt;u.dst.tclassid
op_assign
id|itag
suffix:semicolon
macro_line|#endif
id|rth-&gt;rt_iif
op_assign
id|rth-&gt;key.iif
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|rth-&gt;u.dst.dev
op_assign
op_amp
id|loopback_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|rth-&gt;u.dst.dev
)paren
suffix:semicolon
id|rth-&gt;key.oif
op_assign
l_int|0
suffix:semicolon
id|rth-&gt;rt_gateway
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;rt_spec_dst
op_assign
id|spec_dst
suffix:semicolon
id|rth-&gt;rt_type
op_assign
id|RTN_MULTICAST
suffix:semicolon
id|rth-&gt;rt_flags
op_assign
id|RTCF_MULTICAST
suffix:semicolon
r_if
c_cond
(paren
id|our
)paren
(brace
id|rth-&gt;u.dst.input
op_assign
id|ip_local_deliver
suffix:semicolon
id|rth-&gt;rt_flags
op_or_assign
id|RTCF_LOCAL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_MROUTE
r_if
c_cond
(paren
op_logical_neg
id|LOCAL_MCAST
c_func
(paren
id|daddr
)paren
op_logical_and
id|IN_DEV_MFORWARD
c_func
(paren
id|in_dev
)paren
)paren
id|rth-&gt;u.dst.input
op_assign
id|ip_mr_input
suffix:semicolon
macro_line|#endif
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|saddr
op_xor
(paren
id|dev-&gt;ifindex
op_lshift
l_int|5
)paren
comma
id|tos
)paren
suffix:semicolon
r_return
id|rt_intern_hash
c_func
(paren
id|hash
comma
id|rth
comma
(paren
r_struct
id|rtable
op_star
op_star
)paren
op_amp
id|skb-&gt;dst
)paren
suffix:semicolon
id|e_nobufs
suffix:colon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|e_inval
suffix:colon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;NOTE. We drop all the packets that has local source&n; *&t;addresses, because every properly looped back packet&n; *&t;must have correct destination already attached by output routine.&n; *&n; *&t;Such approach solves two big problems:&n; *&t;1. Not simplex devices are handled properly.&n; *&t;2. IP spoofing attempts are filtered with 100% of guarantee.&n; */
DECL|function|ip_route_input_slow
r_int
id|ip_route_input_slow
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|daddr
comma
id|u32
id|saddr
comma
id|u8
id|tos
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rt_key
id|key
suffix:semicolon
r_struct
id|fib_result
id|res
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|in_device
op_star
id|out_dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|flags
op_assign
l_int|0
suffix:semicolon
id|u32
id|itag
op_assign
l_int|0
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
r_int
id|hash
suffix:semicolon
id|u32
id|spec_dst
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
id|free_res
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; *&t;IP on this device is disabled.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|key.dst
op_assign
id|daddr
suffix:semicolon
id|key.src
op_assign
id|saddr
suffix:semicolon
id|key.tos
op_assign
id|tos
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_FWMARK
id|key.fwmark
op_assign
id|skb-&gt;nfmark
suffix:semicolon
macro_line|#endif
id|key.iif
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|key.oif
op_assign
l_int|0
suffix:semicolon
id|key.scope
op_assign
id|RT_SCOPE_UNIVERSE
suffix:semicolon
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|saddr
op_xor
(paren
id|key.iif
op_lshift
l_int|5
)paren
comma
id|tos
)paren
suffix:semicolon
multiline_comment|/* Check for the most weird martians, which can be not detected&n;&t;   by fib_lookup.&n;&t; */
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|saddr
)paren
op_logical_or
id|BADCLASS
c_func
(paren
id|saddr
)paren
op_logical_or
id|LOOPBACK
c_func
(paren
id|saddr
)paren
)paren
r_goto
id|martian_source
suffix:semicolon
r_if
c_cond
(paren
id|daddr
op_eq
l_int|0xFFFFFFFF
op_logical_or
(paren
id|saddr
op_eq
l_int|0
op_logical_and
id|daddr
op_eq
l_int|0
)paren
)paren
r_goto
id|brd_input
suffix:semicolon
multiline_comment|/* Accept zero addresses only to limited broadcast;&n;&t; * I even do not know to fix it or not. Waiting for complains :-)&n;&t; */
r_if
c_cond
(paren
id|ZERONET
c_func
(paren
id|saddr
)paren
)paren
r_goto
id|martian_source
suffix:semicolon
r_if
c_cond
(paren
id|BADCLASS
c_func
(paren
id|daddr
)paren
op_logical_or
id|ZERONET
c_func
(paren
id|daddr
)paren
op_logical_or
id|LOOPBACK
c_func
(paren
id|daddr
)paren
)paren
r_goto
id|martian_destination
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Now we are ready to route packet.&n;&t; */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fib_lookup
c_func
(paren
op_amp
id|key
comma
op_amp
id|res
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IN_DEV_FORWARD
c_func
(paren
id|in_dev
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
r_goto
id|no_route
suffix:semicolon
)brace
id|free_res
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_NAT
multiline_comment|/* Policy is applied before mapping destination,&n;&t;   but rerouting after map should be made with old source.&n;&t; */
r_if
c_cond
(paren
l_int|1
)paren
(brace
id|u32
id|src_map
op_assign
id|saddr
suffix:semicolon
r_if
c_cond
(paren
id|res.r
)paren
id|src_map
op_assign
id|fib_rules_policy
c_func
(paren
id|saddr
comma
op_amp
id|res
comma
op_amp
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_NAT
)paren
(brace
id|key.dst
op_assign
id|fib_rules_map_destination
c_func
(paren
id|daddr
comma
op_amp
id|res
)paren
suffix:semicolon
id|fib_res_put
c_func
(paren
op_amp
id|res
)paren
suffix:semicolon
id|free_res
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fib_lookup
c_func
(paren
op_amp
id|key
comma
op_amp
id|res
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
id|free_res
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_ne
id|RTN_UNICAST
)paren
r_goto
id|e_inval
suffix:semicolon
id|flags
op_or_assign
id|RTCF_DNAT
suffix:semicolon
)brace
id|key.src
op_assign
id|src_map
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_BROADCAST
)paren
r_goto
id|brd_input
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_LOCAL
)paren
(brace
r_int
id|result
suffix:semicolon
id|result
op_assign
id|fib_validate_source
c_func
(paren
id|saddr
comma
id|daddr
comma
id|tos
comma
id|loopback_dev.ifindex
comma
id|dev
comma
op_amp
id|spec_dst
comma
op_amp
id|itag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_goto
id|martian_source
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
id|flags
op_or_assign
id|RTCF_DIRECTSRC
suffix:semicolon
id|spec_dst
op_assign
id|daddr
suffix:semicolon
r_goto
id|local_input
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|IN_DEV_FORWARD
c_func
(paren
id|in_dev
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_ne
id|RTN_UNICAST
)paren
r_goto
id|martian_destination
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_MULTIPATH
r_if
c_cond
(paren
id|res.fi-&gt;fib_nhs
OG
l_int|1
op_logical_and
id|key.oif
op_eq
l_int|0
)paren
id|fib_select_multipath
c_func
(paren
op_amp
id|key
comma
op_amp
id|res
)paren
suffix:semicolon
macro_line|#endif
id|out_dev
op_assign
id|in_dev_get
c_func
(paren
id|FIB_RES_DEV
c_func
(paren
id|res
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|out_dev
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;Bug in ip_route_input_slow(). Please, report&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|e_inval
suffix:semicolon
)brace
id|err
op_assign
id|fib_validate_source
c_func
(paren
id|saddr
comma
id|daddr
comma
id|tos
comma
id|FIB_RES_OIF
c_func
(paren
id|res
)paren
comma
id|dev
comma
op_amp
id|spec_dst
comma
op_amp
id|itag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|martian_source
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|flags
op_or_assign
id|RTCF_DIRECTSRC
suffix:semicolon
r_if
c_cond
(paren
id|out_dev
op_eq
id|in_dev
op_logical_and
id|err
op_logical_and
op_logical_neg
(paren
id|flags
op_amp
(paren
id|RTCF_NAT
op_or
id|RTCF_MASQ
)paren
)paren
op_logical_and
(paren
id|IN_DEV_SHARED_MEDIA
c_func
(paren
id|out_dev
)paren
op_logical_or
id|inet_addr_onlink
c_func
(paren
id|out_dev
comma
id|saddr
comma
id|FIB_RES_GW
c_func
(paren
id|res
)paren
)paren
)paren
)paren
id|flags
op_or_assign
id|RTCF_DOREDIRECT
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;protocol
op_ne
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
(brace
multiline_comment|/* Not IP (i.e. ARP). Do not create route, if it is&n;&t;&t; * invalid for proxy arp. DNAT routes are always valid.&n;&t;&t; */
r_if
c_cond
(paren
id|out_dev
op_eq
id|in_dev
op_logical_and
op_logical_neg
(paren
id|flags
op_amp
id|RTCF_DNAT
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
)brace
id|rth
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|ipv4_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rth
)paren
r_goto
id|e_nobufs
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|rth-&gt;u.dst.__refcnt
comma
l_int|1
)paren
suffix:semicolon
id|rth-&gt;u.dst.flags
op_assign
id|DST_HOST
suffix:semicolon
id|rth-&gt;key.dst
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;rt_dst
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;key.tos
op_assign
id|tos
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_FWMARK
id|rth-&gt;key.fwmark
op_assign
id|skb-&gt;nfmark
suffix:semicolon
macro_line|#endif
id|rth-&gt;key.src
op_assign
id|saddr
suffix:semicolon
id|rth-&gt;rt_src
op_assign
id|saddr
suffix:semicolon
id|rth-&gt;rt_gateway
op_assign
id|daddr
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_NAT
id|rth-&gt;rt_src_map
op_assign
id|key.src
suffix:semicolon
id|rth-&gt;rt_dst_map
op_assign
id|key.dst
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTCF_DNAT
)paren
id|rth-&gt;rt_gateway
op_assign
id|key.dst
suffix:semicolon
macro_line|#endif
id|rth-&gt;rt_iif
op_assign
id|rth-&gt;key.iif
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|rth-&gt;u.dst.dev
op_assign
id|out_dev-&gt;dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|rth-&gt;u.dst.dev
)paren
suffix:semicolon
id|rth-&gt;key.oif
op_assign
l_int|0
suffix:semicolon
id|rth-&gt;rt_spec_dst
op_assign
id|spec_dst
suffix:semicolon
id|rth-&gt;u.dst.input
op_assign
id|ip_forward
suffix:semicolon
id|rth-&gt;u.dst.output
op_assign
id|ip_output
suffix:semicolon
id|rt_set_nexthop
c_func
(paren
id|rth
comma
op_amp
id|res
comma
id|itag
)paren
suffix:semicolon
id|rth-&gt;rt_flags
op_assign
id|flags
suffix:semicolon
macro_line|#ifdef CONFIG_NET_FASTROUTE
r_if
c_cond
(paren
id|netdev_fastroute
op_logical_and
op_logical_neg
(paren
id|flags
op_amp
(paren
id|RTCF_NAT
op_or
id|RTCF_MASQ
op_or
id|RTCF_DOREDIRECT
)paren
)paren
)paren
(brace
r_struct
id|net_device
op_star
id|odev
op_assign
id|rth-&gt;u.dst.dev
suffix:semicolon
r_if
c_cond
(paren
id|odev
op_ne
id|dev
op_logical_and
id|dev-&gt;accept_fastpath
op_logical_and
id|odev-&gt;mtu
op_ge
id|dev-&gt;mtu
op_logical_and
id|dev
op_member_access_from_pointer
id|accept_fastpath
c_func
(paren
id|dev
comma
op_amp
id|rth-&gt;u.dst
)paren
op_eq
l_int|0
)paren
id|rth-&gt;rt_flags
op_or_assign
id|RTCF_FAST
suffix:semicolon
)brace
macro_line|#endif
id|intern
suffix:colon
id|err
op_assign
id|rt_intern_hash
c_func
(paren
id|hash
comma
id|rth
comma
(paren
r_struct
id|rtable
op_star
op_star
)paren
op_amp
id|skb-&gt;dst
)paren
suffix:semicolon
id|done
suffix:colon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|out_dev
)paren
id|in_dev_put
c_func
(paren
id|out_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|free_res
)paren
id|fib_res_put
c_func
(paren
op_amp
id|res
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
id|brd_input
suffix:colon
r_if
c_cond
(paren
id|skb-&gt;protocol
op_ne
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
r_if
c_cond
(paren
id|ZERONET
c_func
(paren
id|saddr
)paren
)paren
(brace
id|spec_dst
op_assign
id|inet_select_addr
c_func
(paren
id|dev
comma
l_int|0
comma
id|RT_SCOPE_LINK
)paren
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|fib_validate_source
c_func
(paren
id|saddr
comma
l_int|0
comma
id|tos
comma
l_int|0
comma
id|dev
comma
op_amp
id|spec_dst
comma
op_amp
id|itag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|martian_source
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|flags
op_or_assign
id|RTCF_DIRECTSRC
suffix:semicolon
)brace
id|flags
op_or_assign
id|RTCF_BROADCAST
suffix:semicolon
id|res.type
op_assign
id|RTN_BROADCAST
suffix:semicolon
id|local_input
suffix:colon
id|rth
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|ipv4_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rth
)paren
r_goto
id|e_nobufs
suffix:semicolon
id|rth-&gt;u.dst.output
op_assign
id|ip_rt_bug
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|rth-&gt;u.dst.__refcnt
comma
l_int|1
)paren
suffix:semicolon
id|rth-&gt;u.dst.flags
op_assign
id|DST_HOST
suffix:semicolon
id|rth-&gt;key.dst
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;rt_dst
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;key.tos
op_assign
id|tos
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_FWMARK
id|rth-&gt;key.fwmark
op_assign
id|skb-&gt;nfmark
suffix:semicolon
macro_line|#endif
id|rth-&gt;key.src
op_assign
id|saddr
suffix:semicolon
id|rth-&gt;rt_src
op_assign
id|saddr
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_NAT
id|rth-&gt;rt_dst_map
op_assign
id|key.dst
suffix:semicolon
id|rth-&gt;rt_src_map
op_assign
id|key.src
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_NET_CLS_ROUTE
id|rth-&gt;u.dst.tclassid
op_assign
id|itag
suffix:semicolon
macro_line|#endif
id|rth-&gt;rt_iif
op_assign
id|rth-&gt;key.iif
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|rth-&gt;u.dst.dev
op_assign
op_amp
id|loopback_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|rth-&gt;u.dst.dev
)paren
suffix:semicolon
id|rth-&gt;key.oif
op_assign
l_int|0
suffix:semicolon
id|rth-&gt;rt_gateway
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;rt_spec_dst
op_assign
id|spec_dst
suffix:semicolon
id|rth-&gt;u.dst.input
op_assign
id|ip_local_deliver
suffix:semicolon
id|rth-&gt;rt_flags
op_assign
id|flags
op_or
id|RTCF_LOCAL
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_UNREACHABLE
)paren
(brace
id|rth-&gt;u.dst.input
op_assign
id|ip_error
suffix:semicolon
id|rth-&gt;u.dst.error
op_assign
op_minus
id|err
suffix:semicolon
id|rth-&gt;rt_flags
op_and_assign
op_complement
id|RTCF_LOCAL
suffix:semicolon
)brace
id|rth-&gt;rt_type
op_assign
id|res.type
suffix:semicolon
r_goto
id|intern
suffix:semicolon
id|no_route
suffix:colon
id|spec_dst
op_assign
id|inet_select_addr
c_func
(paren
id|dev
comma
l_int|0
comma
id|RT_SCOPE_UNIVERSE
)paren
suffix:semicolon
id|res.type
op_assign
id|RTN_UNREACHABLE
suffix:semicolon
r_goto
id|local_input
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Do not cache martian addresses: they should be logged (RFC1812)&n;&t; */
id|martian_destination
suffix:colon
macro_line|#ifdef CONFIG_IP_ROUTE_VERBOSE
r_if
c_cond
(paren
id|IN_DEV_LOG_MARTIANS
c_func
(paren
id|in_dev
)paren
op_logical_and
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;martian destination %u.%u.%u.%u from %u.%u.%u.%u, dev %s&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|daddr
)paren
comma
id|NIPQUAD
c_func
(paren
id|saddr
)paren
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
id|e_inval
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
id|e_nobufs
suffix:colon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|done
suffix:semicolon
id|martian_source
suffix:colon
macro_line|#ifdef CONFIG_IP_ROUTE_VERBOSE
r_if
c_cond
(paren
id|IN_DEV_LOG_MARTIANS
c_func
(paren
id|in_dev
)paren
op_logical_and
id|net_ratelimit
c_func
(paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;RFC1812 recommendation, if source is martian,&n;&t;&t; *&t;the only hint is MAC header.&n;&t;&t; */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;martian source %u.%u.%u.%u from %u.%u.%u.%u, on dev %s&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|daddr
)paren
comma
id|NIPQUAD
c_func
(paren
id|saddr
)paren
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header_len
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
id|skb-&gt;mac.raw
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ll header: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;hard_header_len
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%02x&quot;
comma
op_star
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
(paren
id|dev-&gt;hard_header_len
op_minus
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;:&quot;
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_goto
id|e_inval
suffix:semicolon
)brace
DECL|function|ip_route_input
r_int
id|ip_route_input
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|daddr
comma
id|u32
id|saddr
comma
id|u8
id|tos
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_int
id|iif
op_assign
id|dev-&gt;ifindex
suffix:semicolon
id|tos
op_and_assign
id|IPTOS_RT_MASK
suffix:semicolon
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|saddr
op_xor
(paren
id|iif
op_lshift
l_int|5
)paren
comma
id|tos
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rth
op_assign
id|rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
id|rth
suffix:semicolon
id|rth
op_assign
id|rth-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
id|rth-&gt;key.dst
op_eq
id|daddr
op_logical_and
id|rth-&gt;key.src
op_eq
id|saddr
op_logical_and
id|rth-&gt;key.iif
op_eq
id|iif
op_logical_and
id|rth-&gt;key.oif
op_eq
l_int|0
op_logical_and
macro_line|#ifdef CONFIG_IP_ROUTE_FWMARK
id|rth-&gt;key.fwmark
op_eq
id|skb-&gt;nfmark
op_logical_and
macro_line|#endif
id|rth-&gt;key.tos
op_eq
id|tos
)paren
(brace
id|rth-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rth-&gt;u.dst
)paren
suffix:semicolon
id|rth-&gt;u.dst.__use
op_increment
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
id|rth
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
multiline_comment|/* Multicast recognition logic is moved from route cache to here.&n;&t;   The problem was that too many Ethernet cards have broken/missing&n;&t;   hardware multicast filters :-( As result the host on multicasting&n;&t;   network acquires a lot of useless route cache entries, sort of&n;&t;   SDR messages from all the world. Now we try to get rid of them.&n;&t;   Really, provided software IP multicast filter is organized&n;&t;   reasonably (at least, hashed), it does not result in a slowdown&n;&t;   comparing with route cache reject entries.&n;&t;   Note, that multicast routers are not affected, because&n;&t;   route cache entry is created eventually.&n;&t; */
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|daddr
)paren
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
id|our
op_assign
id|ip_check_mc
c_func
(paren
id|in_dev
comma
id|daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|our
macro_line|#ifdef CONFIG_IP_MROUTE
op_logical_or
(paren
op_logical_neg
id|LOCAL_MCAST
c_func
(paren
id|daddr
)paren
op_logical_and
id|IN_DEV_MFORWARD
c_func
(paren
id|in_dev
)paren
)paren
macro_line|#endif
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
r_return
id|ip_route_input_mc
c_func
(paren
id|skb
comma
id|daddr
comma
id|saddr
comma
id|tos
comma
id|dev
comma
id|our
)paren
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|ip_route_input_slow
c_func
(paren
id|skb
comma
id|daddr
comma
id|saddr
comma
id|tos
comma
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Major route resolver routine.&n; */
DECL|function|ip_route_output_slow
r_int
id|ip_route_output_slow
c_func
(paren
r_struct
id|rtable
op_star
op_star
id|rp
comma
r_const
r_struct
id|rt_key
op_star
id|oldkey
)paren
(brace
r_struct
id|rt_key
id|key
suffix:semicolon
r_struct
id|fib_result
id|res
suffix:semicolon
r_int
id|flags
op_assign
l_int|0
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
r_struct
id|net_device
op_star
id|dev_out
op_assign
l_int|NULL
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_int
id|free_res
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
id|u32
id|tos
suffix:semicolon
id|tos
op_assign
id|oldkey-&gt;tos
op_amp
(paren
id|IPTOS_RT_MASK
op_or
id|RTO_ONLINK
)paren
suffix:semicolon
id|key.dst
op_assign
id|oldkey-&gt;dst
suffix:semicolon
id|key.src
op_assign
id|oldkey-&gt;src
suffix:semicolon
id|key.tos
op_assign
id|tos
op_amp
id|IPTOS_RT_MASK
suffix:semicolon
id|key.iif
op_assign
id|loopback_dev.ifindex
suffix:semicolon
id|key.oif
op_assign
id|oldkey-&gt;oif
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_FWMARK
id|key.fwmark
op_assign
id|oldkey-&gt;fwmark
suffix:semicolon
macro_line|#endif
id|key.scope
op_assign
(paren
id|tos
op_amp
id|RTO_ONLINK
)paren
ques
c_cond
id|RT_SCOPE_LINK
suffix:colon
id|RT_SCOPE_UNIVERSE
suffix:semicolon
id|res.fi
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MULTIPLE_TABLES
id|res.r
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|oldkey-&gt;src
)paren
(brace
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|oldkey-&gt;src
)paren
op_logical_or
id|BADCLASS
c_func
(paren
id|oldkey-&gt;src
)paren
op_logical_or
id|ZERONET
c_func
(paren
id|oldkey-&gt;src
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* It is equivalent to inet_addr_type(saddr) == RTN_LOCAL */
id|dev_out
op_assign
id|ip_dev_find
c_func
(paren
id|oldkey-&gt;src
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* I removed check for oif == dev_out-&gt;oif here.&n;&t;&t;   It was wrong by three reasons:&n;&t;&t;   1. ip_dev_find(saddr) can return wrong iface, if saddr is&n;&t;&t;      assigned to multiple interfaces.&n;&t;&t;   2. Moreover, we are allowed to send packets with saddr&n;&t;&t;      of another iface. --ANK&n;&t;&t; */
r_if
c_cond
(paren
id|oldkey-&gt;oif
op_eq
l_int|0
op_logical_and
(paren
id|MULTICAST
c_func
(paren
id|oldkey-&gt;dst
)paren
op_logical_or
id|oldkey-&gt;dst
op_eq
l_int|0xFFFFFFFF
)paren
)paren
(brace
multiline_comment|/* Special hack: user can direct multicasts&n;&t;&t;&t;   and limited broadcast via necessary interface&n;&t;&t;&t;   without fiddling with IP_MULTICAST_IF or IP_PKTINFO.&n;&t;&t;&t;   This hack is not just for fun, it allows&n;&t;&t;&t;   vic,vat and friends to work.&n;&t;&t;&t;   They bind socket to loopback, set ttl to zero&n;&t;&t;&t;   and expect that it will work.&n;&t;&t;&t;   From the viewpoint of routing cache they are broken,&n;&t;&t;&t;   because we are not allowed to build multicast path&n;&t;&t;&t;   with loopback source addr (look, routing cache&n;&t;&t;&t;   cannot know, that ttl is zero, so that packet&n;&t;&t;&t;   will not leave this host and route is valid).&n;&t;&t;&t;   Luckily, this hack is good workaround.&n;&t;&t;&t; */
id|key.oif
op_assign
id|dev_out-&gt;ifindex
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|dev_out
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|oldkey-&gt;oif
)paren
(brace
id|dev_out
op_assign
id|dev_get_by_index
c_func
(paren
id|oldkey-&gt;oif
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|__in_dev_get
c_func
(paren
id|dev_out
)paren
op_eq
l_int|NULL
)paren
(brace
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* Wrong error code */
)brace
r_if
c_cond
(paren
id|LOCAL_MCAST
c_func
(paren
id|oldkey-&gt;dst
)paren
op_logical_or
id|oldkey-&gt;dst
op_eq
l_int|0xFFFFFFFF
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|key.src
)paren
id|key.src
op_assign
id|inet_select_addr
c_func
(paren
id|dev_out
comma
l_int|0
comma
id|RT_SCOPE_LINK
)paren
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|key.src
)paren
(brace
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|oldkey-&gt;dst
)paren
)paren
id|key.src
op_assign
id|inet_select_addr
c_func
(paren
id|dev_out
comma
l_int|0
comma
id|key.scope
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|oldkey-&gt;dst
)paren
id|key.src
op_assign
id|inet_select_addr
c_func
(paren
id|dev_out
comma
l_int|0
comma
id|RT_SCOPE_HOST
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|key.dst
)paren
(brace
id|key.dst
op_assign
id|key.src
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key.dst
)paren
id|key.dst
op_assign
id|key.src
op_assign
id|htonl
c_func
(paren
id|INADDR_LOOPBACK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|dev_out
op_assign
op_amp
id|loopback_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|key.oif
op_assign
id|loopback_dev.ifindex
suffix:semicolon
id|res.type
op_assign
id|RTN_LOCAL
suffix:semicolon
id|flags
op_or_assign
id|RTCF_LOCAL
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fib_lookup
c_func
(paren
op_amp
id|key
comma
op_amp
id|res
)paren
)paren
(brace
id|res.fi
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|oldkey-&gt;oif
)paren
(brace
multiline_comment|/* Apparently, routing tables are wrong. Assume,&n;&t;&t;&t;   that the destination is on link.&n;&n;&t;&t;&t;   WHY? DW.&n;&t;&t;&t;   Because we are allowed to send to iface&n;&t;&t;&t;   even if it has NO routes and NO assigned&n;&t;&t;&t;   addresses. When oif is specified, routing&n;&t;&t;&t;   tables are looked up with only one purpose:&n;&t;&t;&t;   to catch if destination is gatewayed, rather than&n;&t;&t;&t;   direct. Moreover, if MSG_DONTROUTE is set,&n;&t;&t;&t;   we send packet, ignoring both routing tables&n;&t;&t;&t;   and ifaddr state. --ANK&n;&n;&n;&t;&t;&t;   We could make it even if oif is unknown,&n;&t;&t;&t;   likely IPv6, but we do not.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|key.src
op_eq
l_int|0
)paren
id|key.src
op_assign
id|inet_select_addr
c_func
(paren
id|dev_out
comma
l_int|0
comma
id|RT_SCOPE_LINK
)paren
suffix:semicolon
id|res.type
op_assign
id|RTN_UNICAST
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
)brace
id|free_res
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_NAT
)paren
r_goto
id|e_inval
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_LOCAL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|key.src
)paren
id|key.src
op_assign
id|key.dst
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|dev_out
op_assign
op_amp
id|loopback_dev
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|key.oif
op_assign
id|dev_out-&gt;ifindex
suffix:semicolon
r_if
c_cond
(paren
id|res.fi
)paren
id|fib_info_put
c_func
(paren
id|res.fi
)paren
suffix:semicolon
id|res.fi
op_assign
l_int|NULL
suffix:semicolon
id|flags
op_or_assign
id|RTCF_LOCAL
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_ROUTE_MULTIPATH
r_if
c_cond
(paren
id|res.fi-&gt;fib_nhs
OG
l_int|1
op_logical_and
id|key.oif
op_eq
l_int|0
)paren
id|fib_select_multipath
c_func
(paren
op_amp
id|key
comma
op_amp
id|res
)paren
suffix:semicolon
r_else
macro_line|#endif
r_if
c_cond
(paren
id|res.prefixlen
op_eq
l_int|0
op_logical_and
id|res.type
op_eq
id|RTN_UNICAST
op_logical_and
id|key.oif
op_eq
l_int|0
)paren
id|fib_select_default
c_func
(paren
op_amp
id|key
comma
op_amp
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key.src
)paren
id|key.src
op_assign
id|FIB_RES_PREFSRC
c_func
(paren
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|dev_out
op_assign
id|FIB_RES_DEV
c_func
(paren
id|res
)paren
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|key.oif
op_assign
id|dev_out-&gt;ifindex
suffix:semicolon
id|make_route
suffix:colon
r_if
c_cond
(paren
id|LOOPBACK
c_func
(paren
id|key.src
)paren
op_logical_and
op_logical_neg
(paren
id|dev_out-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
r_if
c_cond
(paren
id|key.dst
op_eq
l_int|0xFFFFFFFF
)paren
id|res.type
op_assign
id|RTN_BROADCAST
suffix:semicolon
r_else
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|key.dst
)paren
)paren
id|res.type
op_assign
id|RTN_MULTICAST
suffix:semicolon
r_else
r_if
c_cond
(paren
id|BADCLASS
c_func
(paren
id|key.dst
)paren
op_logical_or
id|ZERONET
c_func
(paren
id|key.dst
)paren
)paren
r_goto
id|e_inval
suffix:semicolon
r_if
c_cond
(paren
id|dev_out-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
id|flags
op_or_assign
id|RTCF_LOCAL
suffix:semicolon
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_BROADCAST
)paren
(brace
id|flags
op_or_assign
id|RTCF_BROADCAST
op_or
id|RTCF_LOCAL
suffix:semicolon
r_if
c_cond
(paren
id|res.fi
)paren
(brace
id|fib_info_put
c_func
(paren
id|res.fi
)paren
suffix:semicolon
id|res.fi
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_MULTICAST
)paren
(brace
id|flags
op_or_assign
id|RTCF_MULTICAST
op_or
id|RTCF_LOCAL
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|__in_dev_get
c_func
(paren
id|dev_out
)paren
op_logical_or
op_logical_neg
id|ip_check_mc
c_func
(paren
id|__in_dev_get
c_func
(paren
id|dev_out
)paren
comma
id|oldkey-&gt;dst
)paren
)paren
id|flags
op_and_assign
op_complement
id|RTCF_LOCAL
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
multiline_comment|/* If multicast route do not exist use&n;&t;&t;   default one, but do not gateway in this case.&n;&t;&t;   Yes, it is hack.&n;&t;&t; */
r_if
c_cond
(paren
id|res.fi
op_logical_and
id|res.prefixlen
OL
l_int|4
)paren
(brace
id|fib_info_put
c_func
(paren
id|res.fi
)paren
suffix:semicolon
id|res.fi
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|rth
op_assign
id|dst_alloc
c_func
(paren
op_amp
id|ipv4_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rth
)paren
r_goto
id|e_nobufs
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|rth-&gt;u.dst.__refcnt
comma
l_int|1
)paren
suffix:semicolon
id|rth-&gt;u.dst.flags
op_assign
id|DST_HOST
suffix:semicolon
id|rth-&gt;key.dst
op_assign
id|oldkey-&gt;dst
suffix:semicolon
id|rth-&gt;key.tos
op_assign
id|tos
suffix:semicolon
id|rth-&gt;key.src
op_assign
id|oldkey-&gt;src
suffix:semicolon
id|rth-&gt;key.iif
op_assign
l_int|0
suffix:semicolon
id|rth-&gt;key.oif
op_assign
id|oldkey-&gt;oif
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_FWMARK
id|rth-&gt;key.fwmark
op_assign
id|oldkey-&gt;fwmark
suffix:semicolon
macro_line|#endif
id|rth-&gt;rt_dst
op_assign
id|key.dst
suffix:semicolon
id|rth-&gt;rt_src
op_assign
id|key.src
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_NAT
id|rth-&gt;rt_dst_map
op_assign
id|key.dst
suffix:semicolon
id|rth-&gt;rt_src_map
op_assign
id|key.src
suffix:semicolon
macro_line|#endif
id|rth-&gt;rt_iif
op_assign
id|oldkey-&gt;oif
ques
c_cond
suffix:colon
id|dev_out-&gt;ifindex
suffix:semicolon
id|rth-&gt;u.dst.dev
op_assign
id|dev_out
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev_out
)paren
suffix:semicolon
id|rth-&gt;rt_gateway
op_assign
id|key.dst
suffix:semicolon
id|rth-&gt;rt_spec_dst
op_assign
id|key.src
suffix:semicolon
id|rth-&gt;u.dst.output
op_assign
id|ip_output
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTCF_LOCAL
)paren
(brace
id|rth-&gt;u.dst.input
op_assign
id|ip_local_deliver
suffix:semicolon
id|rth-&gt;rt_spec_dst
op_assign
id|key.dst
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|RTCF_BROADCAST
op_or
id|RTCF_MULTICAST
)paren
)paren
(brace
id|rth-&gt;rt_spec_dst
op_assign
id|key.src
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTCF_LOCAL
op_logical_and
op_logical_neg
(paren
id|dev_out-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
)paren
id|rth-&gt;u.dst.output
op_assign
id|ip_mc_output
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MROUTE
r_if
c_cond
(paren
id|res.type
op_eq
id|RTN_MULTICAST
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|in_dev_get
c_func
(paren
id|dev_out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
)paren
(brace
r_if
c_cond
(paren
id|IN_DEV_MFORWARD
c_func
(paren
id|in_dev
)paren
op_logical_and
op_logical_neg
id|LOCAL_MCAST
c_func
(paren
id|oldkey-&gt;dst
)paren
)paren
(brace
id|rth-&gt;u.dst.input
op_assign
id|ip_mr_input
suffix:semicolon
id|rth-&gt;u.dst.output
op_assign
id|ip_mc_output
suffix:semicolon
)brace
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
id|rt_set_nexthop
c_func
(paren
id|rth
comma
op_amp
id|res
comma
l_int|0
)paren
suffix:semicolon
id|rth-&gt;rt_flags
op_assign
id|flags
suffix:semicolon
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|oldkey-&gt;dst
comma
id|oldkey-&gt;src
op_xor
(paren
id|oldkey-&gt;oif
op_lshift
l_int|5
)paren
comma
id|tos
)paren
suffix:semicolon
id|err
op_assign
id|rt_intern_hash
c_func
(paren
id|hash
comma
id|rth
comma
id|rp
)paren
suffix:semicolon
id|done
suffix:colon
r_if
c_cond
(paren
id|free_res
)paren
id|fib_res_put
c_func
(paren
op_amp
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
id|dev_put
c_func
(paren
id|dev_out
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
id|e_inval
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
id|e_nobufs
suffix:colon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
DECL|function|ip_route_output_key
r_int
id|ip_route_output_key
c_func
(paren
r_struct
id|rtable
op_star
op_star
id|rp
comma
r_const
r_struct
id|rt_key
op_star
id|key
)paren
(brace
r_int
id|hash
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|key-&gt;dst
comma
id|key-&gt;src
op_xor
(paren
id|key-&gt;oif
op_lshift
l_int|5
)paren
comma
id|key-&gt;tos
)paren
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rth
op_assign
id|rt_hash_table
(braket
id|hash
)braket
dot
id|chain
suffix:semicolon
id|rth
suffix:semicolon
id|rth
op_assign
id|rth-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
id|rth-&gt;key.dst
op_eq
id|key-&gt;dst
op_logical_and
id|rth-&gt;key.src
op_eq
id|key-&gt;src
op_logical_and
id|rth-&gt;key.iif
op_eq
l_int|0
op_logical_and
id|rth-&gt;key.oif
op_eq
id|key-&gt;oif
op_logical_and
macro_line|#ifdef CONFIG_IP_ROUTE_FWMARK
id|rth-&gt;key.fwmark
op_eq
id|key-&gt;fwmark
op_logical_and
macro_line|#endif
op_logical_neg
(paren
(paren
id|rth-&gt;key.tos
op_xor
id|key-&gt;tos
)paren
op_amp
(paren
id|IPTOS_RT_MASK
op_or
id|RTO_ONLINK
)paren
)paren
op_logical_and
(paren
(paren
id|key-&gt;tos
op_amp
id|RTO_TPROXY
)paren
op_logical_or
op_logical_neg
(paren
id|rth-&gt;rt_flags
op_amp
id|RTCF_TPROXY
)paren
)paren
)paren
(brace
id|rth-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|dst_hold
c_func
(paren
op_amp
id|rth-&gt;u.dst
)paren
suffix:semicolon
id|rth-&gt;u.dst.__use
op_increment
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
op_star
id|rp
op_assign
id|rth
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|hash
)braket
dot
id|lock
)paren
suffix:semicolon
r_return
id|ip_route_output_slow
c_func
(paren
id|rp
comma
id|key
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_RTNETLINK
DECL|function|rt_fill_info
r_static
r_int
id|rt_fill_info
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|pid
comma
id|u32
id|seq
comma
r_int
id|event
comma
r_int
id|nowait
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_struct
id|rtmsg
op_star
id|r
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
r_struct
id|rta_cacheinfo
id|ci
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MROUTE
r_struct
id|rtattr
op_star
id|eptr
suffix:semicolon
macro_line|#endif
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
id|pid
comma
id|seq
comma
id|event
comma
r_sizeof
(paren
op_star
id|r
)paren
)paren
suffix:semicolon
id|r
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_assign
(paren
id|nowait
op_logical_and
id|pid
)paren
ques
c_cond
id|NLM_F_MULTI
suffix:colon
l_int|0
suffix:semicolon
id|r-&gt;rtm_family
op_assign
id|AF_INET
suffix:semicolon
id|r-&gt;rtm_dst_len
op_assign
l_int|32
suffix:semicolon
id|r-&gt;rtm_src_len
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtm_tos
op_assign
id|rt-&gt;key.tos
suffix:semicolon
id|r-&gt;rtm_table
op_assign
id|RT_TABLE_MAIN
suffix:semicolon
id|r-&gt;rtm_type
op_assign
id|rt-&gt;rt_type
suffix:semicolon
id|r-&gt;rtm_scope
op_assign
id|RT_SCOPE_UNIVERSE
suffix:semicolon
id|r-&gt;rtm_protocol
op_assign
id|RTPROT_UNSPEC
suffix:semicolon
id|r-&gt;rtm_flags
op_assign
(paren
id|rt-&gt;rt_flags
op_amp
op_complement
l_int|0xFFFF
)paren
op_or
id|RTM_F_CLONED
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt_flags
op_amp
id|RTCF_NOTIFY
)paren
id|r-&gt;rtm_flags
op_or_assign
id|RTM_F_NOTIFY
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_DST
comma
l_int|4
comma
op_amp
id|rt-&gt;rt_dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;key.src
)paren
(brace
id|r-&gt;rtm_src_len
op_assign
l_int|32
suffix:semicolon
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_SRC
comma
l_int|4
comma
op_amp
id|rt-&gt;key.src
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt-&gt;u.dst.dev
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_OIF
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;u.dst.dev-&gt;ifindex
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NET_CLS_ROUTE
r_if
c_cond
(paren
id|rt-&gt;u.dst.tclassid
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_FLOW
comma
l_int|4
comma
op_amp
id|rt-&gt;u.dst.tclassid
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rt-&gt;key.iif
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_PREFSRC
comma
l_int|4
comma
op_amp
id|rt-&gt;rt_spec_dst
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rt-&gt;rt_src
op_ne
id|rt-&gt;key.src
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_PREFSRC
comma
l_int|4
comma
op_amp
id|rt-&gt;rt_src
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;rt_dst
op_ne
id|rt-&gt;rt_gateway
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_GATEWAY
comma
l_int|4
comma
op_amp
id|rt-&gt;rt_gateway
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtnetlink_put_metrics
c_func
(paren
id|skb
comma
op_amp
id|rt-&gt;u.dst.mxlock
)paren
OL
l_int|0
)paren
r_goto
id|rtattr_failure
suffix:semicolon
id|ci.rta_lastuse
op_assign
id|jiffies
op_minus
id|rt-&gt;u.dst.lastuse
suffix:semicolon
id|ci.rta_used
op_assign
id|rt-&gt;u.dst.__use
suffix:semicolon
id|ci.rta_clntref
op_assign
id|atomic_read
c_func
(paren
op_amp
id|rt-&gt;u.dst.__refcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.expires
)paren
id|ci.rta_expires
op_assign
id|rt-&gt;u.dst.expires
op_minus
id|jiffies
suffix:semicolon
r_else
id|ci.rta_expires
op_assign
l_int|0
suffix:semicolon
id|ci.rta_error
op_assign
id|rt-&gt;u.dst.error
suffix:semicolon
id|ci.rta_id
op_assign
l_int|0
suffix:semicolon
id|ci.rta_ts
op_assign
l_int|0
suffix:semicolon
id|ci.rta_tsage
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;peer
)paren
(brace
id|ci.rta_id
op_assign
id|rt-&gt;peer-&gt;ip_id_count
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;peer-&gt;tcp_ts_stamp
)paren
(brace
id|ci.rta_ts
op_assign
id|rt-&gt;peer-&gt;tcp_ts
suffix:semicolon
id|ci.rta_tsage
op_assign
id|xtime.tv_sec
op_minus
id|rt-&gt;peer-&gt;tcp_ts_stamp
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_IP_MROUTE
id|eptr
op_assign
(paren
r_struct
id|rtattr
op_star
)paren
id|skb-&gt;tail
suffix:semicolon
macro_line|#endif
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_CACHEINFO
comma
r_sizeof
(paren
id|ci
)paren
comma
op_amp
id|ci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;key.iif
)paren
(brace
macro_line|#ifdef CONFIG_IP_MROUTE
id|u32
id|dst
op_assign
id|rt-&gt;rt_dst
suffix:semicolon
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|dst
)paren
op_logical_and
op_logical_neg
id|LOCAL_MCAST
c_func
(paren
id|dst
)paren
op_logical_and
id|ipv4_devconf.mc_forwarding
)paren
(brace
r_int
id|err
op_assign
id|ipmr_get_route
c_func
(paren
id|skb
comma
id|r
comma
id|nowait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|nowait
)paren
(brace
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_goto
id|nlmsg_failure
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|EMSGSIZE
)paren
r_goto
id|nlmsg_failure
suffix:semicolon
(paren
(paren
r_struct
id|rta_cacheinfo
op_star
)paren
id|RTA_DATA
c_func
(paren
id|eptr
)paren
)paren
op_member_access_from_pointer
id|rta_error
op_assign
id|err
suffix:semicolon
)brace
)brace
)brace
r_else
macro_line|#endif
(brace
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_IIF
comma
r_sizeof
(paren
r_int
)paren
comma
op_amp
id|rt-&gt;key.iif
)paren
suffix:semicolon
)brace
)brace
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|rtattr_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|inet_rtm_getroute
r_int
id|inet_rtm_getroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|in_skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
r_struct
id|rtmsg
op_star
id|rtm
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
op_assign
l_int|NULL
suffix:semicolon
id|u32
id|dst
op_assign
l_int|0
suffix:semicolon
id|u32
id|src
op_assign
l_int|0
suffix:semicolon
r_int
id|iif
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|NLMSG_GOODSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
multiline_comment|/* Reserve room for dummy headers, this skb can pass&n;&t;   through good chunk of routing engine.&n;&t; */
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|MAX_HEADER
op_plus
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|src
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_SRC
op_minus
l_int|1
)braket
)paren
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|dst
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_DST
op_minus
l_int|1
)braket
)paren
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_IIF
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|iif
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_IIF
op_minus
l_int|1
)braket
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iif
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|__dev_get_by_index
c_func
(paren
id|iif
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|local_bh_disable
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|ip_route_input
c_func
(paren
id|skb
comma
id|dst
comma
id|src
comma
id|rtm-&gt;rtm_tos
comma
id|dev
)paren
suffix:semicolon
id|local_bh_enable
c_func
(paren
)paren
suffix:semicolon
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|rt-&gt;u.dst.error
)paren
id|err
op_assign
op_minus
id|rt-&gt;u.dst.error
suffix:semicolon
)brace
r_else
(brace
r_int
id|oif
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|oif
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|RTA_OIF
op_minus
l_int|1
)braket
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|err
op_assign
id|ip_route_output
c_func
(paren
op_amp
id|rt
comma
id|dst
comma
id|src
comma
id|rtm-&gt;rtm_tos
comma
id|oif
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|skb-&gt;dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
r_if
c_cond
(paren
id|rtm-&gt;rtm_flags
op_amp
id|RTM_F_NOTIFY
)paren
id|rt-&gt;rt_flags
op_or_assign
id|RTCF_NOTIFY
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
op_assign
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
suffix:semicolon
id|err
op_assign
id|rt_fill_info
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|nlh-&gt;nlmsg_seq
comma
id|RTM_NEWROUTE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
op_minus
id|EMSGSIZE
suffix:semicolon
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ip_rt_dump
r_int
id|ip_rt_dump
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_int
id|h
comma
id|s_h
suffix:semicolon
r_int
id|idx
comma
id|s_idx
suffix:semicolon
id|s_h
op_assign
id|cb-&gt;args
(braket
l_int|0
)braket
suffix:semicolon
id|s_idx
op_assign
id|idx
op_assign
id|cb-&gt;args
(braket
l_int|1
)braket
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
op_le
id|rt_hash_mask
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|h
OL
id|s_h
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|h
OG
id|s_h
)paren
id|s_idx
op_assign
l_int|0
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|h
)braket
dot
id|lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt
op_assign
id|rt_hash_table
(braket
id|h
)braket
dot
id|chain
comma
id|idx
op_assign
l_int|0
suffix:semicolon
id|rt
suffix:semicolon
id|rt
op_assign
id|rt-&gt;u.rt_next
comma
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|idx
OL
id|s_idx
)paren
r_continue
suffix:semicolon
id|skb-&gt;dst
op_assign
id|dst_clone
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt_fill_info
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|cb-&gt;skb
)paren
dot
id|pid
comma
id|cb-&gt;nlh-&gt;nlmsg_seq
comma
id|RTM_NEWROUTE
comma
l_int|1
)paren
op_le
l_int|0
)paren
(brace
id|dst_release
c_func
(paren
id|xchg
c_func
(paren
op_amp
id|skb-&gt;dst
comma
l_int|NULL
)paren
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|h
)braket
dot
id|lock
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|dst_release
c_func
(paren
id|xchg
c_func
(paren
op_amp
id|skb-&gt;dst
comma
l_int|NULL
)paren
)paren
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|rt_hash_table
(braket
id|h
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
id|done
suffix:colon
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
id|h
suffix:semicolon
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|idx
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_RTNETLINK */
DECL|function|ip_rt_multicast_event
r_void
id|ip_rt_multicast_event
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
id|rt_cache_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SYSCTL
DECL|variable|flush_delay
r_static
r_int
id|flush_delay
suffix:semicolon
r_static
DECL|function|ipv4_sysctl_rtcache_flush
r_int
id|ipv4_sysctl_rtcache_flush
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|lenp
)paren
(brace
r_if
c_cond
(paren
id|write
)paren
(brace
id|proc_dointvec
c_func
(paren
id|ctl
comma
id|write
comma
id|filp
comma
id|buffer
comma
id|lenp
)paren
suffix:semicolon
id|rt_cache_flush
c_func
(paren
id|flush_delay
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|ipv4_sysctl_rtcache_flush_strategy
r_static
r_int
id|ipv4_sysctl_rtcache_flush_strategy
c_func
(paren
id|ctl_table
op_star
id|table
comma
r_int
op_star
id|name
comma
r_int
id|nlen
comma
r_void
op_star
id|oldval
comma
r_int
op_star
id|oldlenp
comma
r_void
op_star
id|newval
comma
r_int
id|newlen
comma
r_void
op_star
op_star
id|context
)paren
(brace
r_int
id|delay
suffix:semicolon
r_if
c_cond
(paren
id|newlen
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|delay
comma
(paren
r_int
op_star
)paren
id|newval
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|rt_cache_flush
c_func
(paren
id|delay
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ipv4_route_table
id|ctl_table
id|ipv4_route_table
(braket
)braket
op_assign
(brace
(brace
id|NET_IPV4_ROUTE_FLUSH
comma
l_string|&quot;flush&quot;
comma
op_amp
id|flush_delay
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|ipv4_sysctl_rtcache_flush
comma
op_amp
id|ipv4_sysctl_rtcache_flush_strategy
)brace
comma
(brace
id|NET_IPV4_ROUTE_MIN_DELAY
comma
l_string|&quot;min_delay&quot;
comma
op_amp
id|ip_rt_min_delay
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec_jiffies
comma
op_amp
id|sysctl_jiffies
)brace
comma
(brace
id|NET_IPV4_ROUTE_MAX_DELAY
comma
l_string|&quot;max_delay&quot;
comma
op_amp
id|ip_rt_max_delay
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec_jiffies
comma
op_amp
id|sysctl_jiffies
)brace
comma
(brace
id|NET_IPV4_ROUTE_GC_THRESH
comma
l_string|&quot;gc_thresh&quot;
comma
op_amp
id|ipv4_dst_ops.gc_thresh
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_ROUTE_MAX_SIZE
comma
l_string|&quot;max_size&quot;
comma
op_amp
id|ip_rt_max_size
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_ROUTE_GC_MIN_INTERVAL
comma
l_string|&quot;gc_min_interval&quot;
comma
op_amp
id|ip_rt_gc_min_interval
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec_jiffies
comma
op_amp
id|sysctl_jiffies
)brace
comma
(brace
id|NET_IPV4_ROUTE_GC_TIMEOUT
comma
l_string|&quot;gc_timeout&quot;
comma
op_amp
id|ip_rt_gc_timeout
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec_jiffies
comma
op_amp
id|sysctl_jiffies
)brace
comma
(brace
id|NET_IPV4_ROUTE_GC_INTERVAL
comma
l_string|&quot;gc_interval&quot;
comma
op_amp
id|ip_rt_gc_interval
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec_jiffies
comma
op_amp
id|sysctl_jiffies
)brace
comma
(brace
id|NET_IPV4_ROUTE_REDIRECT_LOAD
comma
l_string|&quot;redirect_load&quot;
comma
op_amp
id|ip_rt_redirect_load
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_ROUTE_REDIRECT_NUMBER
comma
l_string|&quot;redirect_number&quot;
comma
op_amp
id|ip_rt_redirect_number
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_ROUTE_REDIRECT_SILENCE
comma
l_string|&quot;redirect_silence&quot;
comma
op_amp
id|ip_rt_redirect_silence
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_ROUTE_ERROR_COST
comma
l_string|&quot;error_cost&quot;
comma
op_amp
id|ip_rt_error_cost
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_ROUTE_ERROR_BURST
comma
l_string|&quot;error_burst&quot;
comma
op_amp
id|ip_rt_error_burst
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_ROUTE_GC_ELASTICITY
comma
l_string|&quot;gc_elasticity&quot;
comma
op_amp
id|ip_rt_gc_elasticity
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_ROUTE_MTU_EXPIRES
comma
l_string|&quot;mtu_expires&quot;
comma
op_amp
id|ip_rt_mtu_expires
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec_jiffies
comma
op_amp
id|sysctl_jiffies
)brace
comma
(brace
id|NET_IPV4_ROUTE_MIN_PMTU
comma
l_string|&quot;min_pmtu&quot;
comma
op_amp
id|ip_rt_min_pmtu
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_ROUTE_MIN_ADVMSS
comma
l_string|&quot;min_adv_mss&quot;
comma
op_amp
id|ip_rt_min_advmss
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_NET_CLS_ROUTE
DECL|variable|ip_rt_acct
r_struct
id|ip_rt_acct
op_star
id|ip_rt_acct
suffix:semicolon
DECL|function|ip_rt_acct_read
r_static
r_int
id|ip_rt_acct_read
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
op_star
id|start
op_assign
id|buffer
suffix:semicolon
r_if
c_cond
(paren
(paren
id|offset
op_amp
l_int|3
)paren
op_logical_or
(paren
id|length
op_amp
l_int|3
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_plus
id|length
op_ge
r_sizeof
(paren
r_struct
id|ip_rt_acct
)paren
op_star
l_int|256
)paren
(brace
id|length
op_assign
r_sizeof
(paren
r_struct
id|ip_rt_acct
)paren
op_star
l_int|256
op_minus
id|offset
suffix:semicolon
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|length
OG
l_int|0
)paren
(brace
id|u32
op_star
id|dst
op_assign
(paren
id|u32
op_star
)paren
id|buffer
suffix:semicolon
id|u32
op_star
id|src
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
(paren
id|u8
op_star
)paren
id|ip_rt_acct
)paren
op_plus
id|offset
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dst
comma
id|src
comma
id|length
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
r_if
c_cond
(paren
id|smp_num_cpus
OG
l_int|1
op_logical_or
id|cpu_logical_map
c_func
(paren
l_int|0
)paren
op_ne
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|cnt
op_assign
id|length
op_div
l_int|4
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|smp_num_cpus
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|cpu
op_assign
id|cpu_logical_map
c_func
(paren
id|i
)paren
suffix:semicolon
r_int
id|k
suffix:semicolon
r_if
c_cond
(paren
id|cpu
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|src
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
(paren
id|u8
op_star
)paren
id|ip_rt_acct
)paren
op_plus
id|offset
op_plus
id|cpu
op_star
l_int|256
op_star
r_sizeof
(paren
r_struct
id|ip_rt_acct
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|cnt
suffix:semicolon
id|k
op_increment
)paren
id|dst
(braket
id|k
)braket
op_add_assign
id|src
(braket
id|k
)braket
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
id|length
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|ip_rt_init
r_void
id|__init
id|ip_rt_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|order
comma
id|goal
suffix:semicolon
macro_line|#ifdef CONFIG_NET_CLS_ROUTE
r_for
c_loop
(paren
id|order
op_assign
l_int|0
suffix:semicolon
(paren
id|PAGE_SIZE
op_lshift
id|order
)paren
OL
l_int|256
op_star
r_sizeof
(paren
id|ip_rt_acct
)paren
op_star
id|NR_CPUS
suffix:semicolon
id|order
op_increment
)paren
multiline_comment|/* NOTHING */
suffix:semicolon
id|ip_rt_acct
op_assign
(paren
r_struct
id|ip_rt_acct
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
id|order
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ip_rt_acct
)paren
id|panic
c_func
(paren
l_string|&quot;IP: failed to allocate ip_rt_acct&bslash;n&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|ip_rt_acct
comma
l_int|0
comma
id|PAGE_SIZE
op_lshift
id|order
)paren
suffix:semicolon
macro_line|#endif
id|ipv4_dst_ops.kmem_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;ip_dst_cache&quot;
comma
r_sizeof
(paren
r_struct
id|rtable
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipv4_dst_ops.kmem_cachep
)paren
id|panic
c_func
(paren
l_string|&quot;IP: failed to allocate ip_dst_cache&bslash;n&quot;
)paren
suffix:semicolon
id|goal
op_assign
id|num_physpages
op_rshift
(paren
l_int|26
op_minus
id|PAGE_SHIFT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
l_int|0
suffix:semicolon
(paren
l_int|1UL
op_lshift
id|order
)paren
OL
id|goal
suffix:semicolon
id|order
op_increment
)paren
multiline_comment|/* NOTHING */
suffix:semicolon
r_do
(brace
id|rt_hash_mask
op_assign
(paren
l_int|1UL
op_lshift
id|order
)paren
op_star
id|PAGE_SIZE
op_div
r_sizeof
(paren
r_struct
id|rt_hash_bucket
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rt_hash_mask
op_amp
(paren
id|rt_hash_mask
op_minus
l_int|1
)paren
)paren
id|rt_hash_mask
op_decrement
suffix:semicolon
id|rt_hash_table
op_assign
(paren
r_struct
id|rt_hash_bucket
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_ATOMIC
comma
id|order
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|rt_hash_table
op_eq
l_int|NULL
op_logical_and
op_decrement
id|order
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rt_hash_table
)paren
id|panic
c_func
(paren
l_string|&quot;Failed to allocate IP route cache hash table&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IP: routing cache hash table of %u buckets, %ldKbytes&bslash;n&quot;
comma
id|rt_hash_mask
comma
(paren
r_int
)paren
(paren
id|rt_hash_mask
op_star
r_sizeof
(paren
r_struct
id|rt_hash_bucket
)paren
)paren
op_div
l_int|1024
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rt_hash_log
op_assign
l_int|0
suffix:semicolon
(paren
l_int|1
op_lshift
id|rt_hash_log
)paren
op_ne
id|rt_hash_mask
suffix:semicolon
id|rt_hash_log
op_increment
)paren
multiline_comment|/* NOTHING */
suffix:semicolon
id|rt_hash_mask
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|rt_hash_mask
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rt_hash_table
(braket
id|i
)braket
dot
id|lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
id|rt_hash_table
(braket
id|i
)braket
dot
id|chain
op_assign
l_int|NULL
suffix:semicolon
)brace
id|ipv4_dst_ops.gc_thresh
op_assign
(paren
id|rt_hash_mask
op_plus
l_int|1
)paren
suffix:semicolon
id|ip_rt_max_size
op_assign
(paren
id|rt_hash_mask
op_plus
l_int|1
)paren
op_star
l_int|16
suffix:semicolon
id|devinet_init
c_func
(paren
)paren
suffix:semicolon
id|ip_fib_init
c_func
(paren
)paren
suffix:semicolon
id|rt_flush_timer.function
op_assign
id|rt_run_flush
suffix:semicolon
id|rt_periodic_timer.function
op_assign
id|rt_check_expire
suffix:semicolon
multiline_comment|/* All the timers, started at system startup tend&n;&t;   to synchronize. Perturb it a bit.&n;&t; */
id|rt_periodic_timer.expires
op_assign
id|jiffies
op_plus
id|net_random
c_func
(paren
)paren
op_mod
id|ip_rt_gc_interval
op_plus
id|ip_rt_gc_interval
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|rt_periodic_timer
)paren
suffix:semicolon
id|proc_net_create
(paren
l_string|&quot;rt_cache&quot;
comma
l_int|0
comma
id|rt_cache_get_info
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NET_CLS_ROUTE
id|create_proc_read_entry
c_func
(paren
l_string|&quot;net/rt_acct&quot;
comma
l_int|0
comma
l_int|0
comma
id|ip_rt_acct_read
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
